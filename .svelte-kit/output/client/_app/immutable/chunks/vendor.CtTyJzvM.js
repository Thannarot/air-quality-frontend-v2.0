var RD=Object.defineProperty;var OD=(r,i,o)=>i in r?RD(r,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[i]=o;var qt=(r,i,o)=>(OD(r,typeof i!="symbol"?i+"":i,o),o);function ln(){}const PA=r=>r;function cn(r,i){for(const o in i)r[o]=i[o];return r}function DA(r){return r()}function wM(){return Object.create(null)}function Qn(r){r.forEach(DA)}function f_(r){return typeof r=="function"}function kr(r,i){return r!=r?i==i:r!==i||r&&typeof r=="object"||typeof r=="function"}let Km;function tj(r,i){return r===i?!0:(Km||(Km=document.createElement("a")),Km.href=i,r===Km.href)}function BD(r){return Object.keys(r).length===0}function zA(r,...i){if(r==null){for(const c of i)c(void 0);return ln}const o=r.subscribe(...i);return o.unsubscribe?()=>o.unsubscribe():o}function wx(r,i,o){r.$$.on_destroy.push(zA(i,o))}function Uf(r,i,o,c){if(r){const f=LA(r,i,o,c);return r[0](f)}}function LA(r,i,o,c){return r[1]&&c?cn(o.ctx.slice(),r[1](c(i))):o.ctx}function Gf(r,i,o,c){if(r[2]&&c){const f=r[2](c(o));if(i.dirty===void 0)return f;if(typeof f=="object"){const m=[],_=Math.max(i.dirty.length,f.length);for(let v=0;v<_;v+=1)m[v]=i.dirty[v]|f[v];return m}return i.dirty|f}return i.dirty}function Hf(r,i,o,c,f,m){if(f){const _=LA(i,o,c,m);r.p(_,f)}}function Wf(r){if(r.ctx.length>32){const i=[],o=r.ctx.length/32;for(let c=0;c<o;c++)i[c]=-1;return i}return-1}function Fr(r){const i={};for(const o in r)o[0]!=="$"&&(i[o]=r[o]);return i}function lr(r,i){const o={};i=new Set(i);for(const c in r)!i.has(c)&&c[0]!=="$"&&(o[c]=r[c]);return o}function ij(r,i,o){return r.set(o),i}function FD(r){return r&&f_(r.destroy)?r.destroy:ln}function Tx(r){const i=typeof r=="string"&&r.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return i?[parseFloat(i[1]),i[2]||"px"]:[r,"px"]}const RA=typeof window<"u";let Mx=RA?()=>window.performance.now():()=>Date.now(),ov=RA?r=>requestAnimationFrame(r):ln;const Ju=new Set;function OA(r){Ju.forEach(i=>{i.c(r)||(Ju.delete(i),i.f())}),Ju.size!==0&&ov(OA)}function BA(r){let i;return Ju.size===0&&ov(OA),{promise:new Promise(o=>{Ju.add(i={c:r,f:o})}),abort(){Ju.delete(i)}}}let p_=!1;function ND(){p_=!0}function VD(){p_=!1}function jD(r,i,o,c){for(;r<i;){const f=r+(i-r>>1);o(f)<=c?r=f+1:i=f}return r}function UD(r){if(r.hydrate_init)return;r.hydrate_init=!0;let i=r.childNodes;if(r.nodeName==="HEAD"){const s=[];for(let S=0;S<i.length;S++){const P=i[S];P.claim_order!==void 0&&s.push(P)}i=s}const o=new Int32Array(i.length+1),c=new Int32Array(i.length);o[0]=-1;let f=0;for(let s=0;s<i.length;s++){const S=i[s].claim_order,P=(f>0&&i[o[f]].claim_order<=S?f+1:jD(1,f,F=>i[o[F]].claim_order,S))-1;c[s]=o[P]+1;const z=P+1;o[z]=s,f=Math.max(z,f)}const m=[],_=[];let v=i.length-1;for(let s=o[f]+1;s!=0;s=c[s-1]){for(m.push(i[s-1]);v>=s;v--)_.push(i[v]);v--}for(;v>=0;v--)_.push(i[v]);m.reverse(),_.sort((s,S)=>s.claim_order-S.claim_order);for(let s=0,S=0;s<_.length;s++){for(;S<m.length&&_[s].claim_order>=m[S].claim_order;)S++;const P=S<m.length?m[S]:null;r.insertBefore(_[s],P)}}function GD(r,i){r.appendChild(i)}function FA(r){if(!r)return document;const i=r.getRootNode?r.getRootNode():r.ownerDocument;return i&&i.host?i:r.ownerDocument}function HD(r){const i=ci("style");return i.textContent="/* empty */",WD(FA(r),i),i.sheet}function WD(r,i){return GD(r.head||r,i),i.sheet}function He(r,i){if(p_){for(UD(r),(r.actual_end_child===void 0||r.actual_end_child!==null&&r.actual_end_child.parentNode!==r)&&(r.actual_end_child=r.firstChild);r.actual_end_child!==null&&r.actual_end_child.claim_order===void 0;)r.actual_end_child=r.actual_end_child.nextSibling;i!==r.actual_end_child?(i.claim_order!==void 0||i.parentNode!==r)&&r.insertBefore(i,r.actual_end_child):r.actual_end_child=i.nextSibling}else(i.parentNode!==r||i.nextSibling!==null)&&r.appendChild(i)}function qD(r,i,o){r.insertBefore(i,o||null)}function oi(r,i,o){p_&&!o?He(r,i):(i.parentNode!==r||i.nextSibling!=o)&&r.insertBefore(i,o||null)}function Ee(r){r.parentNode&&r.parentNode.removeChild(r)}function Oa(r,i){for(let o=0;o<r.length;o+=1)r[o]&&r[o].d(i)}function ci(r){return document.createElement(r)}function Pt(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function In(r){return document.createTextNode(r)}function Kn(){return In(" ")}function Sn(){return In("")}function pt(r,i,o,c){return r.addEventListener(i,o,c),()=>r.removeEventListener(i,o,c)}function TM(r){return function(i){return i.preventDefault(),r.call(this,i)}}function nj(r){return function(i){return i.stopPropagation(),r.call(this,i)}}function rj(r){return function(i){i.target===this&&r.call(this,i)}}function ge(r,i,o){o==null?r.removeAttribute(i):r.getAttribute(i)!==o&&r.setAttribute(i,o)}const ZD=["width","height"];function nh(r,i){const o=Object.getOwnPropertyDescriptors(r.__proto__);for(const c in i)i[c]==null?r.removeAttribute(c):c==="style"?r.style.cssText=i[c]:c==="__value"?r.value=r[c]=i[c]:o[c]&&o[c].set&&ZD.indexOf(c)===-1?r[c]=i[c]:ge(r,c,i[c])}function Qr(r,i){for(const o in i)ge(r,o,i[o])}function cf(r,i,o){r.setAttributeNS("http://www.w3.org/1999/xlink",i,o)}function MM(r){return r.dataset.svelteH}function Xe(r){return Array.from(r.childNodes)}function NA(r){r.claim_info===void 0&&(r.claim_info={last_index:0,total_claimed:0})}function VA(r,i,o,c,f=!1){NA(r);const m=(()=>{for(let _=r.claim_info.last_index;_<r.length;_++){const v=r[_];if(i(v)){const s=o(v);return s===void 0?r.splice(_,1):r[_]=s,f||(r.claim_info.last_index=_),v}}for(let _=r.claim_info.last_index-1;_>=0;_--){const v=r[_];if(i(v)){const s=o(v);return s===void 0?r.splice(_,1):r[_]=s,f?s===void 0&&r.claim_info.last_index--:r.claim_info.last_index=_,v}}return c()})();return m.claim_order=r.claim_info.total_claimed,r.claim_info.total_claimed+=1,m}function jA(r,i,o,c){return VA(r,f=>f.nodeName===i,f=>{const m=[];for(let _=0;_<f.attributes.length;_++){const v=f.attributes[_];o[v.name]||m.push(v.name)}m.forEach(_=>f.removeAttribute(_))},()=>c(i))}function _i(r,i,o){return jA(r,i,o,ci)}function Rt(r,i,o){return jA(r,i,o,Pt)}function Bn(r,i){return VA(r,o=>o.nodeType===3,o=>{const c=""+i;if(o.data.startsWith(c)){if(o.data.length!==c.length)return o.splitText(c.length)}else o.data=c},()=>In(i),!0)}function Jn(r){return Bn(r," ")}function SM(r,i,o){for(let c=o;c<r.length;c+=1){const f=r[c];if(f.nodeType===8&&f.textContent.trim()===i)return c}return-1}function m_(r,i){const o=SM(r,"HTML_TAG_START",0),c=SM(r,"HTML_TAG_END",o+1);if(o===-1||c===-1)return new kc(i);NA(r);const f=r.splice(o,c-o+1);Ee(f[0]),Ee(f[f.length-1]);const m=f.slice(1,f.length-1);if(m.length===0)return new kc(i);for(const _ of m)_.claim_order=r.claim_info.total_claimed,r.claim_info.total_claimed+=1;return new kc(i,m)}function Sr(r,i){i=""+i,r.data!==i&&(r.data=i)}function Rg(r,i){i=""+i,r.wholeText!==i&&(r.data=i)}function rh(r,i){r.value=i??""}function EM(r,i,o,c){o==null?r.style.removeProperty(i):r.style.setProperty(i,o,c?"important":"")}function Jm(r,i,o){for(let c=0;c<r.options.length;c+=1){const f=r.options[c];if(f.__value===i){f.selected=!0;return}}(!o||i!==void 0)&&(r.selectedIndex=-1)}function sj(r){const i=r.querySelector(":checked");return i&&i.__value}function fi(r,i,o){r.classList.toggle(i,!!o)}function UA(r,i,{bubbles:o=!1,cancelable:c=!1}={}){return new CustomEvent(r,{detail:i,bubbles:o,cancelable:c})}class XD{constructor(i=!1){qt(this,"is_svg",!1);qt(this,"e");qt(this,"n");qt(this,"t");qt(this,"a");this.is_svg=i,this.e=this.n=null}c(i){this.h(i)}m(i,o,c=null){this.e||(this.is_svg?this.e=Pt(o.nodeName):this.e=ci(o.nodeType===11?"TEMPLATE":o.nodeName),this.t=o.tagName!=="TEMPLATE"?o:o.content,this.c(i)),this.i(c)}h(i){this.e.innerHTML=i,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(i){for(let o=0;o<this.n.length;o+=1)qD(this.t,this.n[o],i)}p(i){this.d(),this.h(i),this.i(this.a)}d(){this.n.forEach(Ee)}}class kc extends XD{constructor(o=!1,c){super(o);qt(this,"l");this.e=this.n=null,this.l=c}c(o){this.l?this.n=this.l:super.c(o)}i(o){for(let c=0;c<this.n.length;c+=1)oi(this.t,this.n[c],o)}}function oj(r,i){return new r(i)}const Og=new Map;let Bg=0;function YD(r){let i=5381,o=r.length;for(;o--;)i=(i<<5)-i^r.charCodeAt(o);return i>>>0}function KD(r,i){const o={stylesheet:HD(i),rules:{}};return Og.set(r,o),o}function AM(r,i,o,c,f,m,_,v=0){const s=16.666/c;let S=`{
`;for(let Q=0;Q<=1;Q+=s){const re=i+(o-i)*m(Q);S+=Q*100+`%{${_(re,1-re)}}
`}const P=S+`100% {${_(o,1-o)}}
}`,z=`__svelte_${YD(P)}_${v}`,F=FA(r),{stylesheet:U,rules:Z}=Og.get(F)||KD(F,r);Z[z]||(Z[z]=!0,U.insertRule(`@keyframes ${z} ${P}`,U.cssRules.length));const W=r.style.animation||"";return r.style.animation=`${W?`${W}, `:""}${z} ${c}ms linear ${f}ms 1 both`,Bg+=1,z}function JD(r,i){const o=(r.style.animation||"").split(", "),c=o.filter(i?m=>m.indexOf(i)<0:m=>m.indexOf("__svelte")===-1),f=o.length-c.length;f&&(r.style.animation=c.join(", "),Bg-=f,Bg||QD())}function QD(){ov(()=>{Bg||(Og.forEach(r=>{const{ownerNode:i}=r.stylesheet;i&&Ee(i)}),Og.clear())})}let Af;function xf(r){Af=r}function fh(){if(!Af)throw new Error("Function called outside component initialization");return Af}function aj(r){fh().$$.on_mount.push(r)}function lj(r){fh().$$.after_update.push(r)}function cj(r){fh().$$.on_destroy.push(r)}function av(){const r=fh();return(i,o,{cancelable:c=!1}={})=>{const f=r.$$.callbacks[i];if(f){const m=UA(i,o,{cancelable:c});return f.slice().forEach(_=>{_.call(r,m)}),!m.defaultPrevented}return!0}}function uj(r,i){return fh().$$.context.set(r,i),i}function Wa(r){return fh().$$.context.get(r)}function ii(r,i){const o=r.$$.callbacks[i.type];o&&o.slice().forEach(c=>c.call(this,i))}const Xu=[],_o=[];let Qu=[];const Sx=[],GA=Promise.resolve();let Ex=!1;function HA(){Ex||(Ex=!0,GA.then(qA))}function $D(){return HA(),GA}function sh(r){Qu.push(r)}function WA(r){Sx.push(r)}const J0=new Set;let Gu=0;function qA(){if(Gu!==0)return;const r=Af;do{try{for(;Gu<Xu.length;){const i=Xu[Gu];Gu++,xf(i),ez(i.$$)}}catch(i){throw Xu.length=0,Gu=0,i}for(xf(null),Xu.length=0,Gu=0;_o.length;)_o.pop()();for(let i=0;i<Qu.length;i+=1){const o=Qu[i];J0.has(o)||(J0.add(o),o())}Qu.length=0}while(Xu.length);for(;Sx.length;)Sx.pop()();Ex=!1,J0.clear(),xf(r)}function ez(r){if(r.fragment!==null){r.update(),Qn(r.before_update);const i=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,i),r.after_update.forEach(sh)}}function tz(r){const i=[],o=[];Qu.forEach(c=>r.indexOf(c)===-1?i.push(c):o.push(c)),o.forEach(c=>c()),Qu=i}let Jd;function iz(){return Jd||(Jd=Promise.resolve(),Jd.then(()=>{Jd=null})),Jd}function Q0(r,i,o){r.dispatchEvent(UA(`${i?"intro":"outro"}${o}`))}const yg=new Set;let Na;function g_(){Na={r:0,c:[],p:Na}}function __(){Na.r||Qn(Na.c),Na=Na.p}function pr(r,i){r&&r.i&&(yg.delete(r),r.i(i))}function Nr(r,i,o,c){if(r&&r.o){if(yg.has(r))return;yg.add(r),Na.c.push(()=>{yg.delete(r),c&&(o&&r.d(1),c())}),r.o(i)}else c&&c()}const nz={duration:0};function Fg(r,i,o,c){let m=i(r,o,{direction:"both"}),_=c?0:1,v=null,s=null,S=null,P;function z(){S&&JD(r,S)}function F(Z,W){const Q=Z.b-_;return W*=Math.abs(Q),{a:_,b:Z.b,d:Q,duration:W,start:Z.start,end:Z.start+W,group:Z.group}}function U(Z){const{delay:W=0,duration:Q=300,easing:re=PA,tick:ie=ln,css:ve}=m||nz,pe={start:Mx()+W,b:Z};Z||(pe.group=Na,Na.r+=1),"inert"in r&&(Z?P!==void 0&&(r.inert=P):(P=r.inert,r.inert=!0)),v||s?s=pe:(ve&&(z(),S=AM(r,_,Z,Q,W,re,ve)),Z&&ie(0,1),v=F(pe,Q),sh(()=>Q0(r,Z,"start")),BA(ke=>{if(s&&ke>s.start&&(v=F(s,Q),s=null,Q0(r,v.b,"start"),ve&&(z(),S=AM(r,_,v.b,v.duration,0,re,m.css))),v){if(ke>=v.end)ie(_=v.b,1-_),Q0(r,v.b,"end"),s||(v.b?z():--v.group.r||Qn(v.group.c)),v=null;else if(ke>=v.start){const Me=ke-v.start;_=v.a+v.d*re(Me/v.duration),ie(_,1-_)}}return!!(v||s)}))}return{run(Z){f_(m)?iz().then(()=>{m=m({direction:Z?"in":"out"}),U(Z)}):U(Z)},end(){z(),v=s=null}}}function Ar(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function $s(r,i){const o={},c={},f={$$scope:1};let m=r.length;for(;m--;){const _=r[m],v=i[m];if(v){for(const s in _)s in v||(c[s]=1);for(const s in v)f[s]||(o[s]=v[s],f[s]=1);r[m]=v}else for(const s in _)f[s]=1}for(const _ in c)_ in o||(o[_]=void 0);return o}function rz(r){return typeof r=="object"&&r!==null?r:{}}function ZA(r,i,o){const c=r.$$.props[i];c!==void 0&&(r.$$.bound[c]=o,o(r.$$.ctx[c]))}function y_(r){r&&r.c()}function x_(r,i){r&&r.l(i)}function qf(r,i,o){const{fragment:c,after_update:f}=r.$$;c&&c.m(i,o),sh(()=>{const m=r.$$.on_mount.map(DA).filter(f_);r.$$.on_destroy?r.$$.on_destroy.push(...m):Qn(m),r.$$.on_mount=[]}),f.forEach(sh)}function Zf(r,i){const o=r.$$;o.fragment!==null&&(tz(o.after_update),Qn(o.on_destroy),o.fragment&&o.fragment.d(i),o.on_destroy=o.fragment=null,o.ctx=[])}function sz(r,i){r.$$.dirty[0]===-1&&(Xu.push(r),HA(),r.$$.dirty.fill(0)),r.$$.dirty[i/31|0]|=1<<i%31}function Vr(r,i,o,c,f,m,_=null,v=[-1]){const s=Af;xf(r);const S=r.$$={fragment:null,ctx:[],props:m,update:ln,not_equal:f,bound:wM(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(s?s.$$.context:[])),callbacks:wM(),dirty:v,skip_bound:!1,root:i.target||s.$$.root};_&&_(S.root);let P=!1;if(S.ctx=o?o(r,i.props||{},(z,F,...U)=>{const Z=U.length?U[0]:F;return S.ctx&&f(S.ctx[z],S.ctx[z]=Z)&&(!S.skip_bound&&S.bound[z]&&S.bound[z](Z),P&&sz(r,z)),F}):[],S.update(),P=!0,Qn(S.before_update),S.fragment=c?c(S.ctx):!1,i.target){if(i.hydrate){ND();const z=Xe(i.target);S.fragment&&S.fragment.l(z),z.forEach(Ee)}else S.fragment&&S.fragment.c();i.intro&&pr(r.$$.fragment),qf(r,i.target,i.anchor),VD(),qA()}xf(s)}class jr{constructor(){qt(this,"$$");qt(this,"$$set")}$destroy(){Zf(this,1),this.$destroy=ln}$on(i,o){if(!f_(o))return ln;const c=this.$$.callbacks[i]||(this.$$.callbacks[i]=[]);return c.push(o),()=>{const f=c.indexOf(o);f!==-1&&c.splice(f,1)}}$set(i){this.$$set&&!BD(i)&&(this.$$.skip_bound=!0,this.$$set(i),this.$$.skip_bound=!1)}}const oz="4";new URL("sveltekit-internal://");function az(r,i){return r==="/"||i==="ignore"?r:i==="never"?r.endsWith("/")?r.slice(0,-1):r:i==="always"&&!r.endsWith("/")?r+"/":r}function lz(r){return r.split("%25").map(decodeURI).join("%25")}function cz(r){for(const i in r)r[i]=decodeURIComponent(r[i]);return r}function $0({href:r}){return r.split("#")[0]}const uz=["href","pathname","search","toString","toJSON"];function hz(r,i,o){const c=new URL(r);Object.defineProperty(c,"searchParams",{value:new Proxy(c.searchParams,{get(f,m){if(m==="get"||m==="getAll"||m==="has")return v=>(o(v),f[m](v));i();const _=Reflect.get(f,m);return typeof _=="function"?_.bind(f):_}}),enumerable:!0,configurable:!0});for(const f of uz)Object.defineProperty(c,f,{get(){return i(),r[f]},enumerable:!0,configurable:!0});return c}const dz="/__data.json",fz=".html__data.json";function pz(r){return r.endsWith(".html")?r.replace(/\.html$/,fz):r.replace(/\/$/,"")+dz}function mz(...r){let i=5381;for(const o of r)if(typeof o=="string"){let c=o.length;for(;c;)i=i*33^o.charCodeAt(--c)}else if(ArrayBuffer.isView(o)){const c=new Uint8Array(o.buffer,o.byteOffset,o.byteLength);let f=c.length;for(;f;)i=i*33^c[--f]}else throw new TypeError("value must be a string or TypedArray");return(i>>>0).toString(36)}function gz(r){const i=atob(r),o=new Uint8Array(i.length);for(let c=0;c<i.length;c++)o[c]=i.charCodeAt(c);return o.buffer}const XA=window.fetch;window.fetch=(r,i)=>((r instanceof Request?r.method:(i==null?void 0:i.method)||"GET")!=="GET"&&vf.delete(lv(r)),XA(r,i));const vf=new Map;function _z(r,i){const o=lv(r,i),c=document.querySelector(o);if(c!=null&&c.textContent){let{body:f,...m}=JSON.parse(c.textContent);const _=c.getAttribute("data-ttl");return _&&vf.set(o,{body:f,init:m,ttl:1e3*Number(_)}),c.getAttribute("data-b64")!==null&&(f=gz(f)),Promise.resolve(new Response(f,m))}return window.fetch(r,i)}function yz(r,i,o){if(vf.size>0){const c=lv(r,o),f=vf.get(c);if(f){if(performance.now()<f.ttl&&["default","force-cache","only-if-cached",void 0].includes(o==null?void 0:o.cache))return new Response(f.body,f.init);vf.delete(c)}}return window.fetch(i,o)}function lv(r,i){let c=`script[data-sveltekit-fetched][data-url=${JSON.stringify(r instanceof Request?r.url:r)}]`;if(i!=null&&i.headers||i!=null&&i.body){const f=[];i.headers&&f.push([...new Headers(i.headers)].join(",")),i.body&&(typeof i.body=="string"||ArrayBuffer.isView(i.body))&&f.push(i.body),c+=`[data-hash="${mz(...f)}"]`}return c}const xz=/^(\[)?(\.\.\.)?(\w+)(?:=(\w+))?(\])?$/;function vz(r){const i=[];return{pattern:r==="/"?/^\/$/:new RegExp(`^${wz(r).map(c=>{const f=/^\[\.\.\.(\w+)(?:=(\w+))?\]$/.exec(c);if(f)return i.push({name:f[1],matcher:f[2],optional:!1,rest:!0,chained:!0}),"(?:/(.*))?";const m=/^\[\[(\w+)(?:=(\w+))?\]\]$/.exec(c);if(m)return i.push({name:m[1],matcher:m[2],optional:!0,rest:!1,chained:!0}),"(?:/([^/]+))?";if(!c)return;const _=c.split(/\[(.+?)\](?!\])/);return"/"+_.map((s,S)=>{if(S%2){if(s.startsWith("x+"))return ex(String.fromCharCode(parseInt(s.slice(2),16)));if(s.startsWith("u+"))return ex(String.fromCharCode(...s.slice(2).split("-").map(W=>parseInt(W,16))));const P=xz.exec(s),[,z,F,U,Z]=P;return i.push({name:U,matcher:Z,optional:!!z,rest:!!F,chained:F?S===1&&_[0]==="":!1}),F?"(.*?)":z?"([^/]*)?":"([^/]+?)"}return ex(s)}).join("")}).join("")}/?$`),params:i}}function bz(r){return!/^\([^)]+\)$/.test(r)}function wz(r){return r.slice(1).split("/").filter(bz)}function Tz(r,i,o){const c={},f=r.slice(1),m=f.filter(v=>v!==void 0);let _=0;for(let v=0;v<i.length;v+=1){const s=i[v];let S=f[v-_];if(s.chained&&s.rest&&_&&(S=f.slice(v-_,v+1).filter(P=>P).join("/"),_=0),S===void 0){s.rest&&(c[s.name]="");continue}if(!s.matcher||o[s.matcher](S)){c[s.name]=S;const P=i[v+1],z=f[v+1];P&&!P.rest&&P.optional&&z&&s.chained&&(_=0),!P&&!z&&Object.keys(c).length===m.length&&(_=0);continue}if(s.optional&&s.chained){_++;continue}return}if(!_)return c}function ex(r){return r.normalize().replace(/[[\]]/g,"\\$&").replace(/%/g,"%25").replace(/\//g,"%2[Ff]").replace(/\?/g,"%3[Ff]").replace(/#/g,"%23").replace(/[.*+?^${}()|\\]/g,"\\$&")}function Mz({nodes:r,server_loads:i,dictionary:o,matchers:c}){const f=new Set(i);return Object.entries(o).map(([v,[s,S,P]])=>{const{pattern:z,params:F}=vz(v),U={id:v,exec:Z=>{const W=z.exec(Z);if(W)return Tz(W,F,c)},errors:[1,...P||[]].map(Z=>r[Z]),layouts:[0,...S||[]].map(_),leaf:m(s)};return U.errors.length=U.layouts.length=Math.max(U.errors.length,U.layouts.length),U});function m(v){const s=v<0;return s&&(v=~v),[s,r[v]]}function _(v){return v===void 0?v:[f.has(v),r[v]]}}function YA(r,i=JSON.parse){try{return i(sessionStorage[r])}catch{}}function IM(r,i,o=JSON.stringify){const c=o(i);try{sessionStorage[r]=c}catch{}}const Hu=[];function Xf(r,i=ln){let o;const c=new Set;function f(v){if(kr(r,v)&&(r=v,o)){const s=!Hu.length;for(const S of c)S[1](),Hu.push(S,r);if(s){for(let S=0;S<Hu.length;S+=2)Hu[S][0](Hu[S+1]);Hu.length=0}}}function m(v){f(v(r))}function _(v,s=ln){const S=[v,s];return c.add(S),c.size===1&&(o=i(f,m)||ln),v(r),()=>{c.delete(S),c.size===0&&o&&(o(),o=null)}}return{set:f,update:m,subscribe:_}}var kA;const xo=((kA=globalThis.__sveltekit_1nf59lp)==null?void 0:kA.base)??"";var CA;const Sz=((CA=globalThis.__sveltekit_1nf59lp)==null?void 0:CA.assets)??xo,Ez="1710601810230",KA="sveltekit:snapshot",JA="sveltekit:scroll",QA="sveltekit:states",Az="sveltekit:pageurl",$u="sveltekit:history",If="sveltekit:navigation",Ng={tap:1,hover:2,viewport:3,eager:4,off:-1,false:-1},Yf=location.origin;function $A(r){if(r instanceof URL)return r;let i=document.baseURI;if(!i){const o=document.getElementsByTagName("base");i=o.length?o[0].href:document.URL}return new URL(r,i)}function cv(){return{x:pageXOffset,y:pageYOffset}}function Wu(r,i){return r.getAttribute(`data-sveltekit-${i}`)}const kM={...Ng,"":Ng.hover};function eI(r){let i=r.assignedSlot??r.parentNode;return(i==null?void 0:i.nodeType)===11&&(i=i.host),i}function tI(r,i){for(;r&&r!==i;){if(r.nodeName.toUpperCase()==="A"&&r.hasAttribute("href"))return r;r=eI(r)}}function Ax(r,i){let o;try{o=new URL(r instanceof SVGAElement?r.href.baseVal:r.href,document.baseURI)}catch{}const c=r instanceof SVGAElement?r.target.baseVal:r.target,f=!o||!!c||v_(o,i)||(r.getAttribute("rel")||"").split(/\s+/).includes("external"),m=(o==null?void 0:o.origin)===Yf&&r.hasAttribute("download");return{url:o,external:f,target:c,download:m}}function Vg(r){let i=null,o=null,c=null,f=null,m=null,_=null,v=r;for(;v&&v!==document.documentElement;)c===null&&(c=Wu(v,"preload-code")),f===null&&(f=Wu(v,"preload-data")),i===null&&(i=Wu(v,"keepfocus")),o===null&&(o=Wu(v,"noscroll")),m===null&&(m=Wu(v,"reload")),_===null&&(_=Wu(v,"replacestate")),v=eI(v);function s(S){switch(S){case"":case"true":return!0;case"off":case"false":return!1;default:return}}return{preload_code:kM[c??"off"],preload_data:kM[f??"off"],keepfocus:s(i),noscroll:s(o),reload:s(m),replace_state:s(_)}}function CM(r){const i=Xf(r);let o=!0;function c(){o=!0,i.update(_=>_)}function f(_){o=!1,i.set(_)}function m(_){let v;return i.subscribe(s=>{(v===void 0||o&&s!==v)&&_(v=s)})}return{notify:c,set:f,subscribe:m}}function Iz(){const{set:r,subscribe:i}=Xf(!1);let o;async function c(){clearTimeout(o);try{const f=await fetch(`${Sz}/_app/version.json`,{headers:{pragma:"no-cache","cache-control":"no-cache"}});if(!f.ok)return!1;const _=(await f.json()).version!==Ez;return _&&(r(!0),clearTimeout(o)),_}catch{return!1}}return{subscribe:i,check:c}}function v_(r,i){return r.origin!==Yf||!r.pathname.startsWith(i)}const kz=-1,Cz=-2,Pz=-3,Dz=-4,zz=-5,Lz=-6;function Rz(r,i){if(typeof r=="number")return f(r,!0);if(!Array.isArray(r)||r.length===0)throw new Error("Invalid input");const o=r,c=Array(o.length);function f(m,_=!1){if(m===kz)return;if(m===Pz)return NaN;if(m===Dz)return 1/0;if(m===zz)return-1/0;if(m===Lz)return-0;if(_)throw new Error("Invalid input");if(m in c)return c[m];const v=o[m];if(!v||typeof v!="object")c[m]=v;else if(Array.isArray(v))if(typeof v[0]=="string"){const s=v[0],S=i==null?void 0:i[s];if(S)return c[m]=S(f(v[1]));switch(s){case"Date":c[m]=new Date(v[1]);break;case"Set":const P=new Set;c[m]=P;for(let U=1;U<v.length;U+=1)P.add(f(v[U]));break;case"Map":const z=new Map;c[m]=z;for(let U=1;U<v.length;U+=2)z.set(f(v[U]),f(v[U+1]));break;case"RegExp":c[m]=new RegExp(v[1],v[2]);break;case"Object":c[m]=Object(v[1]);break;case"BigInt":c[m]=BigInt(v[1]);break;case"null":const F=Object.create(null);c[m]=F;for(let U=1;U<v.length;U+=2)F[v[U]]=f(v[U+1]);break;default:throw new Error(`Unknown type ${s}`)}}else{const s=new Array(v.length);c[m]=s;for(let S=0;S<v.length;S+=1){const P=v[S];P!==Cz&&(s[S]=f(P))}}else{const s={};c[m]=s;for(const S in v){const P=v[S];s[S]=f(P)}}return c[m]}return f(0)}const iI=new Set(["load","prerender","csr","ssr","trailingSlash","config"]);[...iI];const Oz=new Set([...iI]);[...Oz];function Bz(r){return r.filter(i=>i!=null)}class b_{constructor(i,o){this.status=i,typeof o=="string"?this.body={message:o}:o?this.body=o:this.body={message:`Error: ${i}`}}toString(){return JSON.stringify(this.body)}}class nI{constructor(i,o){this.status=i,this.location=o}}class uv extends Error{constructor(i,o,c){super(c),this.status=i,this.text=o}}const Fz="x-sveltekit-invalidated",Nz="x-sveltekit-trailing-slash";function jg(r){return r instanceof b_||r instanceof uv?r.status:500}function Vz(r){return r instanceof uv?r.text:"Internal Error"}const zc=YA(JA)??{},kf=YA(KA)??{},Ga={url:CM({}),page:CM({}),navigating:Xf(null),updated:Iz()};function hv(r){zc[r]=cv()}function jz(r,i){let o=r+1;for(;zc[o];)delete zc[o],o+=1;for(o=i+1;kf[o];)delete kf[o],o+=1}function oh(r){return location.href=r.href,new Promise(()=>{})}function PM(){}let w_,Ix,Ug,Fa,kx,ph;const rI=[],Gg=[];let Ys=null;const sI=[],Uz=[];let Yu=[],rr={branch:[],error:null,url:null},dv=!1,Hg=!1,DM=!0,Cf=!1,Qd=!1,oI=!1,fv=!1,pv,Kr,Js,Ks,Wg;const bf=new Set;async function hj(r,i,o){var f,m;document.URL!==location.href&&(location.href=location.href),ph=r,w_=Mz(r),Fa=document.documentElement,kx=i,Ix=r.nodes[0],Ug=r.nodes[1],Ix(),Ug(),Kr=(f=history.state)==null?void 0:f[$u],Js=(m=history.state)==null?void 0:m[If],Kr||(Kr=Js=Date.now(),history.replaceState({...history.state,[$u]:Kr,[If]:Js},""));const c=zc[Kr];c&&(history.scrollRestoration="manual",scrollTo(c.x,c.y)),o?await Kz(kx,o):Xz(location.href,{replaceState:!0}),Yz()}function Gz(){rI.length=0,fv=!1}function aI(r){Gg.some(i=>i==null?void 0:i.snapshot)&&(kf[r]=Gg.map(i=>{var o;return(o=i==null?void 0:i.snapshot)==null?void 0:o.capture()}))}function lI(r){var i;(i=kf[r])==null||i.forEach((o,c)=>{var f,m;(m=(f=Gg[c])==null?void 0:f.snapshot)==null||m.restore(o)})}function zM(){hv(Kr),IM(JA,zc),aI(Js),IM(KA,kf)}async function cI(r,i,o,c){return xg({type:"goto",url:$A(r),keepfocus:i.keepFocus,noscroll:i.noScroll,replace_state:i.replaceState,state:i.state,redirect_count:o,nav_token:c,accept:()=>{i.invalidateAll&&(fv=!0)}})}async function Hz(r){if(r.id!==(Ys==null?void 0:Ys.id)){const i={};bf.add(i),Ys={id:r.id,token:i,promise:hI({...r,preload:i}).then(o=>(bf.delete(i),o.type==="loaded"&&o.state.error&&(Ys=null),o))}}return Ys.promise}async function tx(r){const i=w_.find(o=>o.exec(dI(r)));i&&await Promise.all([...i.layouts,i.leaf].map(o=>o==null?void 0:o[1]()))}function uI(r,i){var f;rr=r.state;const o=document.querySelector("style[data-sveltekit]");o&&o.remove(),Ks=r.props.page,pv=new ph.root({target:i,props:{...r.props,stores:Ga,components:Gg},hydrate:!0}),lI(Js);const c={from:null,to:{params:rr.params,route:{id:((f=rr.route)==null?void 0:f.id)??null},url:new URL(location.href)},willUnload:!1,type:"enter",complete:Promise.resolve()};Yu.forEach(m=>m(c)),Hg=!0}async function qg({url:r,params:i,branch:o,status:c,error:f,route:m,form:_}){let v="never";if(xo&&(r.pathname===xo||r.pathname===xo+"/"))v="always";else for(const U of o)(U==null?void 0:U.slash)!==void 0&&(v=U.slash);r.pathname=az(r.pathname,v),r.search=r.search;const s={type:"loaded",state:{url:r,params:i,branch:o,error:f,route:m},props:{constructors:Bz(o).map(U=>U.node.component),page:Ks}};_!==void 0&&(s.props.form=_);let S={},P=!Ks,z=0;for(let U=0;U<Math.max(o.length,rr.branch.length);U+=1){const Z=o[U],W=rr.branch[U];(Z==null?void 0:Z.data)!==(W==null?void 0:W.data)&&(P=!0),Z&&(S={...S,...Z.data},P&&(s.props[`data_${z}`]=S),z+=1)}return(!rr.url||r.href!==rr.url.href||rr.error!==f||_!==void 0&&_!==Ks.form||P)&&(s.props.page={error:f,params:i,route:{id:(m==null?void 0:m.id)??null},state:{},status:c,url:new URL(r),form:_??null,data:P?S:Ks.data}),s}async function mv({loader:r,parent:i,url:o,params:c,route:f,server_data_node:m}){var P,z,F;let _=null,v=!0;const s={dependencies:new Set,params:new Set,parent:!1,route:!1,url:!1,search_params:new Set},S=await r();if((P=S.universal)!=null&&P.load){let U=function(...W){for(const Q of W){const{href:re}=new URL(Q,o);s.dependencies.add(re)}};const Z={route:new Proxy(f,{get:(W,Q)=>(v&&(s.route=!0),W[Q])}),params:new Proxy(c,{get:(W,Q)=>(v&&s.params.add(Q),W[Q])}),data:(m==null?void 0:m.data)??null,url:hz(o,()=>{v&&(s.url=!0)},W=>{v&&s.search_params.add(W)}),async fetch(W,Q){let re;W instanceof Request?(re=W.url,Q={body:W.method==="GET"||W.method==="HEAD"?void 0:await W.blob(),cache:W.cache,credentials:W.credentials,headers:W.headers,integrity:W.integrity,keepalive:W.keepalive,method:W.method,mode:W.mode,redirect:W.redirect,referrer:W.referrer,referrerPolicy:W.referrerPolicy,signal:W.signal,...Q}):re=W;const ie=new URL(re,o);return v&&U(ie.href),ie.origin===o.origin&&(re=ie.href.slice(o.origin.length)),Hg?yz(re,ie.href,Q):_z(re,Q)},setHeaders:()=>{},depends:U,parent(){return v&&(s.parent=!0),i()},untrack(W){v=!1;try{return W()}finally{v=!0}}};_=await S.universal.load.call(null,Z)??null}return{node:S,loader:r,server:m,universal:(z=S.universal)!=null&&z.load?{type:"data",data:_,uses:s}:null,data:_??(m==null?void 0:m.data)??null,slash:((F=S.universal)==null?void 0:F.trailingSlash)??(m==null?void 0:m.slash)}}function LM(r,i,o,c,f,m){if(fv)return!0;if(!f)return!1;if(f.parent&&r||f.route&&i||f.url&&o)return!0;for(const _ of f.search_params)if(c.has(_))return!0;for(const _ of f.params)if(m[_]!==rr.params[_])return!0;for(const _ of f.dependencies)if(rI.some(v=>v(new URL(_))))return!0;return!1}function gv(r,i){return(r==null?void 0:r.type)==="data"?r:(r==null?void 0:r.type)==="skip"?i??null:null}function Wz(r,i){if(!r)return new Set(i.searchParams.keys());const o=new Set([...r.searchParams.keys(),...i.searchParams.keys()]);for(const c of o){const f=r.searchParams.getAll(c),m=i.searchParams.getAll(c);f.every(_=>m.includes(_))&&m.every(_=>f.includes(_))&&o.delete(c)}return o}function RM({error:r,url:i,route:o,params:c}){return{type:"loaded",state:{error:r,url:i,route:o,params:c,branch:[]},props:{page:Ks,constructors:[]}}}async function hI({id:r,invalidating:i,url:o,params:c,route:f,preload:m}){if((Ys==null?void 0:Ys.id)===r)return bf.delete(Ys.token),Ys.promise;const{errors:_,layouts:v,leaf:s}=f,S=[...v,s];_.forEach(pe=>pe==null?void 0:pe().catch(()=>{})),S.forEach(pe=>pe==null?void 0:pe[1]().catch(()=>{}));let P=null;const z=rr.url?r!==rr.url.pathname+rr.url.search:!1,F=rr.route?f.id!==rr.route.id:!1,U=Wz(rr.url,o);let Z=!1;const W=S.map((pe,ke)=>{var ot;const Me=rr.branch[ke],Ye=!!(pe!=null&&pe[0])&&((Me==null?void 0:Me.loader)!==pe[1]||LM(Z,F,z,U,(ot=Me.server)==null?void 0:ot.uses,c));return Ye&&(Z=!0),Ye});if(W.some(Boolean)){try{P=await mI(o,W)}catch(pe){const ke=await eh(pe,{url:o,params:c,route:{id:r}});return bf.has(m)?RM({error:ke,url:o,params:c,route:f}):T_({status:jg(pe),error:ke,url:o,route:f})}if(P.type==="redirect")return P}const Q=P==null?void 0:P.nodes;let re=!1;const ie=S.map(async(pe,ke)=>{var Mt;if(!pe)return;const Me=rr.branch[ke],Ye=Q==null?void 0:Q[ke];if((!Ye||Ye.type==="skip")&&pe[1]===(Me==null?void 0:Me.loader)&&!LM(re,F,z,U,(Mt=Me.universal)==null?void 0:Mt.uses,c))return Me;if(re=!0,(Ye==null?void 0:Ye.type)==="error")throw Ye;return mv({loader:pe[1],url:o,params:c,route:f,parent:async()=>{var yt;const Se={};for(let _t=0;_t<ke;_t+=1)Object.assign(Se,(yt=await ie[_t])==null?void 0:yt.data);return Se},server_data_node:gv(Ye===void 0&&pe[0]?{type:"skip"}:Ye??null,pe[0]?Me==null?void 0:Me.server:void 0)})});for(const pe of ie)pe.catch(()=>{});const ve=[];for(let pe=0;pe<S.length;pe+=1)if(S[pe])try{ve.push(await ie[pe])}catch(ke){if(ke instanceof nI)return{type:"redirect",location:ke.location};if(bf.has(m))return RM({error:await eh(ke,{params:c,url:o,route:{id:f.id}}),url:o,params:c,route:f});let Me=jg(ke),Ye;if(Q!=null&&Q.includes(ke))Me=ke.status??Me,Ye=ke.error;else if(ke instanceof b_)Ye=ke.body;else{if(await Ga.updated.check())return await oh(o);Ye=await eh(ke,{params:c,url:o,route:{id:f.id}})}const ot=await qz(pe,ve,_);return ot?await qg({url:o,params:c,branch:ve.slice(0,ot.idx).concat(ot.node),status:Me,error:Ye,route:f}):await pI(o,{id:f.id},Ye,Me)}else ve.push(void 0);return await qg({url:o,params:c,branch:ve,status:200,error:null,route:f,form:i?void 0:null})}async function qz(r,i,o){for(;r--;)if(o[r]){let c=r;for(;!i[c];)c-=1;try{return{idx:c+1,node:{node:await o[r](),loader:o[r],data:{},server:null,universal:null}}}catch{continue}}}async function T_({status:r,error:i,url:o,route:c}){const f={};let m=null;if(ph.server_loads[0]===0)try{const S=await mI(o,[!0]);if(S.type!=="data"||S.nodes[0]&&S.nodes[0].type!=="data")throw 0;m=S.nodes[0]??null}catch{(o.origin!==Yf||o.pathname!==location.pathname||dv)&&await oh(o)}const v=await mv({loader:Ix,url:o,params:f,route:c,parent:()=>Promise.resolve({}),server_data_node:gv(m)}),s={node:await Ug(),loader:Ug,universal:null,server:null,data:null};return await qg({url:o,params:f,branch:[v,s],status:r,error:i,route:null})}function _v(r,i){if(!r||v_(r,xo))return;let o;try{o=ph.hooks.reroute({url:new URL(r)})??r.pathname}catch{return}const c=dI(o);for(const f of w_){const m=f.exec(c);if(m)return{id:r.pathname+r.search,invalidating:i,route:f,params:cz(m),url:r}}}function dI(r){return lz(r.slice(xo.length)||"/")}function fI({url:r,type:i,intent:o,delta:c}){let f=!1;const m=_I(rr,o,r,i);c!==void 0&&(m.navigation.delta=c);const _={...m.navigation,cancel:()=>{f=!0,m.reject(new Error("navigation cancelled"))}};return Cf||sI.forEach(v=>v(_)),f?null:m}async function xg({type:r,url:i,popped:o,keepfocus:c,noscroll:f,replace_state:m,state:_={},redirect_count:v=0,nav_token:s={},accept:S=PM,block:P=PM}){const z=_v(i,!1),F=fI({url:i,type:r,delta:o==null?void 0:o.delta,intent:z});if(!F){P();return}const U=Kr,Z=Js;S(),Cf=!0,Hg&&Ga.navigating.set(F.navigation),Wg=s;let W=z&&await hI(z);if(!W){if(v_(i,xo))return await oh(i);W=await pI(i,{id:null},await eh(new uv(404,"Not Found",`Not found: ${i.pathname}`),{url:i,params:{},route:{id:null}}),404)}if(i=(z==null?void 0:z.url)||i,Wg!==s)return F.reject(new Error("navigation aborted")),!1;if(W.type==="redirect")if(v>=20)W=await T_({status:500,error:await eh(new Error("Redirect loop"),{url:i,params:{},route:{id:null}}),url:i,route:{id:null}});else return cI(new URL(W.location,i).href,{},v+1,s),!1;else W.props.page.status>=400&&await Ga.updated.check()&&await oh(i);if(Gz(),hv(U),aI(Z),W.props.page.url.pathname!==i.pathname&&(i.pathname=W.props.page.url.pathname),_=o?o.state:_,!o){const ve=m?0:1,pe={[$u]:Kr+=ve,[If]:Js+=ve,[QA]:_};(m?history.replaceState:history.pushState).call(history,pe,"",i),m||jz(Kr,Js)}if(Ys=null,W.props.page.state=_,Hg){rr=W.state,W.props.page&&(W.props.page.url=i);const ve=(await Promise.all(Uz.map(pe=>pe(F.navigation)))).filter(pe=>typeof pe=="function");if(ve.length>0){let pe=function(){Yu=Yu.filter(ke=>!ve.includes(ke))};ve.push(pe),Yu.push(...ve)}pv.$set(W.props),oI=!0}else uI(W,kx);const{activeElement:Q}=document;await $D();const re=o?o.scroll:f?cv():null;if(DM){const ve=i.hash&&document.getElementById(decodeURIComponent(i.hash.slice(1)));re?scrollTo(re.x,re.y):ve?ve.scrollIntoView():scrollTo(0,0)}const ie=document.activeElement!==Q&&document.activeElement!==document.body;!c&&!ie&&Jz(),DM=!0,W.props.page&&(Ks=W.props.page),Cf=!1,r==="popstate"&&lI(Js),F.fulfil(void 0),Yu.forEach(ve=>ve(F.navigation)),Ga.navigating.set(null)}async function pI(r,i,o,c){return r.origin===Yf&&r.pathname===location.pathname&&!dv?await T_({status:c,error:o,url:r,route:i}):await oh(r)}function Zz(){let r;Fa.addEventListener("mousemove",m=>{const _=m.target;clearTimeout(r),r=setTimeout(()=>{c(_,2)},20)});function i(m){c(m.composedPath()[0],1)}Fa.addEventListener("mousedown",i),Fa.addEventListener("touchstart",i,{passive:!0});const o=new IntersectionObserver(m=>{for(const _ of m)_.isIntersecting&&(tx(_.target.href),o.unobserve(_.target))},{threshold:0});function c(m,_){const v=tI(m,Fa);if(!v)return;const{url:s,external:S,download:P}=Ax(v,xo);if(S||P)return;const z=Vg(v);if(!z.reload)if(_<=z.preload_data){const F=_v(s,!1);F&&Hz(F)}else _<=z.preload_code&&tx(s.pathname)}function f(){o.disconnect();for(const m of Fa.querySelectorAll("a")){const{url:_,external:v,download:s}=Ax(m,xo);if(v||s)continue;const S=Vg(m);S.reload||(S.preload_code===Ng.viewport&&o.observe(m),S.preload_code===Ng.eager&&tx(_.pathname))}}Yu.push(f),f()}function eh(r,i){if(r instanceof b_)return r.body;const o=jg(r),c=Vz(r);return ph.hooks.handleError({error:r,event:i,status:o,message:c})??{message:c}}function Xz(r,i={}){return r=$A(r),r.origin!==Yf?Promise.reject(new Error("goto: invalid URL")):cI(r,i,0)}function Yz(){var i;history.scrollRestoration="manual",addEventListener("beforeunload",o=>{let c=!1;if(zM(),!Cf){const f=_I(rr,void 0,null,"leave"),m={...f.navigation,cancel:()=>{c=!0,f.reject(new Error("navigation cancelled"))}};sI.forEach(_=>_(m))}c?(o.preventDefault(),o.returnValue=""):history.scrollRestoration="auto"}),addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&zM()}),(i=navigator.connection)!=null&&i.saveData||Zz(),Fa.addEventListener("click",o=>{var F;if(o.button||o.which!==1||o.metaKey||o.ctrlKey||o.shiftKey||o.altKey||o.defaultPrevented)return;const c=tI(o.composedPath()[0],Fa);if(!c)return;const{url:f,external:m,target:_,download:v}=Ax(c,xo);if(!f)return;if(_==="_parent"||_==="_top"){if(window.parent!==window)return}else if(_&&_!=="_self")return;const s=Vg(c);if(!(c instanceof SVGAElement)&&f.protocol!==location.protocol&&!(f.protocol==="https:"||f.protocol==="http:")||v)return;if(m||s.reload){fI({url:f,type:"link"})?Cf=!0:o.preventDefault();return}const[P,z]=f.href.split("#");if(z!==void 0&&P===$0(location)){const[,U]=rr.url.href.split("#");if(U===z){o.preventDefault(),z===""||z==="top"&&c.ownerDocument.getElementById("top")===null?window.scrollTo({top:0}):(F=c.ownerDocument.getElementById(z))==null||F.scrollIntoView();return}if(Qd=!0,hv(Kr),r(f),!s.replace_state)return;Qd=!1}o.preventDefault(),xg({type:"link",url:f,keepfocus:s.keepfocus,noscroll:s.noscroll,replace_state:s.replace_state??f.href===location.href})}),Fa.addEventListener("submit",o=>{if(o.defaultPrevented)return;const c=HTMLFormElement.prototype.cloneNode.call(o.target),f=o.submitter;if(((f==null?void 0:f.formMethod)||c.method)!=="get")return;const _=new URL((f==null?void 0:f.hasAttribute("formaction"))&&(f==null?void 0:f.formAction)||c.action);if(v_(_,xo))return;const v=o.target,s=Vg(v);if(s.reload)return;o.preventDefault(),o.stopPropagation();const S=new FormData(v),P=f==null?void 0:f.getAttribute("name");P&&S.append(P,(f==null?void 0:f.getAttribute("value"))??""),_.search=new URLSearchParams(S).toString(),xg({type:"form",url:_,keepfocus:s.keepfocus,noscroll:s.noscroll,replace_state:s.replace_state??_.href===location.href})}),addEventListener("popstate",async o=>{var c;if((c=o.state)!=null&&c[$u]){const f=o.state[$u];if(Wg={},f===Kr)return;const m=zc[f],_=o.state[QA]??{},v=new URL(o.state[Az]??location.href),s=o.state[If],S=$0(location)===$0(rr.url);if(s===Js&&(oI||S)){r(v),zc[Kr]=cv(),m&&scrollTo(m.x,m.y),_!==Ks.state&&(Ks={...Ks,state:_},pv.$set({page:Ks})),Kr=f;return}const z=f-Kr;await xg({type:"popstate",url:v,popped:{state:_,scroll:m,delta:z},accept:()=>{Kr=f,Js=s},block:()=>{history.go(-z)},nav_token:Wg})}else if(!Qd){const f=new URL(location.href);r(f)}}),addEventListener("hashchange",()=>{Qd&&(Qd=!1,history.replaceState({...history.state,[$u]:++Kr,[If]:Js},"",location.href))});for(const o of document.querySelectorAll("link"))o.rel==="icon"&&(o.href=o.href);addEventListener("pageshow",o=>{o.persisted&&Ga.navigating.set(null)});function r(o){rr.url=o,Ga.page.set({...Ks,url:o}),Ga.page.notify()}}async function Kz(r,{status:i=200,error:o,node_ids:c,params:f,route:m,data:_,form:v}){dv=!0;const s=new URL(location.href);({params:f={},route:m={id:null}}=_v(s,!1)||{});let S;try{const P=c.map(async(U,Z)=>{const W=_[Z];return W!=null&&W.uses&&(W.uses=gI(W.uses)),mv({loader:ph.nodes[U],url:s,params:f,route:m,parent:async()=>{const Q={};for(let re=0;re<Z;re+=1)Object.assign(Q,(await P[re]).data);return Q},server_data_node:gv(W)})}),z=await Promise.all(P),F=w_.find(({id:U})=>U===m.id);if(F){const U=F.layouts;for(let Z=0;Z<U.length;Z++)U[Z]||z.splice(Z,0,void 0)}S=await qg({url:s,params:f,branch:z,status:i,error:o,form:v,route:F??null})}catch(P){if(P instanceof nI){await oh(new URL(P.location,location.href));return}S=await T_({status:jg(P),error:await eh(P,{url:s,params:f,route:m}),url:s,route:m})}S.props.page&&(S.props.page.state={}),uI(S,r)}async function mI(r,i){var f;const o=new URL(r);o.pathname=pz(r.pathname),r.pathname.endsWith("/")&&o.searchParams.append(Nz,"1"),o.searchParams.append(Fz,i.map(m=>m?"1":"0").join(""));const c=await XA(o.href);if(!c.ok){let m;throw(f=c.headers.get("content-type"))!=null&&f.includes("application/json")?m=await c.json():c.status===404?m="Not Found":c.status===500&&(m="Internal Error"),new b_(c.status,m)}return new Promise(async m=>{var z;const _=new Map,v=c.body.getReader(),s=new TextDecoder;function S(F){return Rz(F,{Promise:U=>new Promise((Z,W)=>{_.set(U,{fulfil:Z,reject:W})})})}let P="";for(;;){const{done:F,value:U}=await v.read();if(F&&!P)break;for(P+=!U&&P?`
`:s.decode(U,{stream:!0});;){const Z=P.indexOf(`
`);if(Z===-1)break;const W=JSON.parse(P.slice(0,Z));if(P=P.slice(Z+1),W.type==="redirect")return m(W);if(W.type==="data")(z=W.nodes)==null||z.forEach(Q=>{(Q==null?void 0:Q.type)==="data"&&(Q.uses=gI(Q.uses),Q.data=S(Q.data))}),m(W);else if(W.type==="chunk"){const{id:Q,data:re,error:ie}=W,ve=_.get(Q);_.delete(Q),ie?ve.reject(S(ie)):ve.fulfil(S(re))}}}})}function gI(r){return{dependencies:new Set((r==null?void 0:r.dependencies)??[]),params:new Set((r==null?void 0:r.params)??[]),parent:!!(r!=null&&r.parent),route:!!(r!=null&&r.route),url:!!(r!=null&&r.url),search_params:new Set((r==null?void 0:r.search_params)??[])}}function Jz(){const r=document.querySelector("[autofocus]");if(r)r.focus();else{const i=document.body,o=i.getAttribute("tabindex");i.tabIndex=-1,i.focus({preventScroll:!0,focusVisible:!1}),o!==null?i.setAttribute("tabindex",o):i.removeAttribute("tabindex");const c=getSelection();if(c&&c.type!=="None"){const f=[];for(let m=0;m<c.rangeCount;m+=1)f.push(c.getRangeAt(m));setTimeout(()=>{if(c.rangeCount===f.length){for(let m=0;m<c.rangeCount;m+=1){const _=f[m],v=c.getRangeAt(m);if(_.commonAncestorContainer!==v.commonAncestorContainer||_.startContainer!==v.startContainer||_.endContainer!==v.endContainer||_.startOffset!==v.startOffset||_.endOffset!==v.endOffset)return}c.removeAllRanges()}})}}}function _I(r,i,o,c){var s,S;let f,m;const _=new Promise((P,z)=>{f=P,m=z});return _.catch(()=>{}),{navigation:{from:{params:r.params,route:{id:((s=r.route)==null?void 0:s.id)??null},url:r.url},to:o&&{params:(i==null?void 0:i.params)??null,route:{id:((S=i==null?void 0:i.route)==null?void 0:S.id)??null},url:o},willUnload:!i,type:c,complete:_},fulfil:f,reject:m}}const Qz="modulepreload",$z=function(r,i){return new URL(r,i).href},OM={},dj=function(i,o,c){let f=Promise.resolve();if(o&&o.length>0){const m=document.getElementsByTagName("link");f=Promise.all(o.map(_=>{if(_=$z(_,c),_ in OM)return;OM[_]=!0;const v=_.endsWith(".css"),s=v?'[rel="stylesheet"]':"";if(!!c)for(let z=m.length-1;z>=0;z--){const F=m[z];if(F.href===_&&(!v||F.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${_}"]${s}`))return;const P=document.createElement("link");if(P.rel=v?"stylesheet":Qz,v||(P.as="script",P.crossOrigin=""),P.href=_,document.head.appendChild(P),v)return new Promise((z,F)=>{P.addEventListener("load",z),P.addEventListener("error",()=>F(new Error(`Unable to preload CSS for ${_}`)))})}))}return f.then(()=>i()).catch(m=>{const _=new Event("vite:preloadError",{cancelable:!0});if(_.payload=m,window.dispatchEvent(_),!_.defaultPrevented)throw m})};typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(oz);const eL=()=>{const r=Ga;return{page:{subscribe:r.page.subscribe},navigating:{subscribe:r.navigating.subscribe},updated:r.updated}},tL={subscribe(r){return eL().page.subscribe(r)}};function iL(r){var s;let i,o=r[0].status+"",c,f,m,_=((s=r[0].error)==null?void 0:s.message)+"",v;return{c(){i=ci("h1"),c=In(o),f=Kn(),m=ci("p"),v=In(_)},l(S){i=_i(S,"H1",{});var P=Xe(i);c=Bn(P,o),P.forEach(Ee),f=Jn(S),m=_i(S,"P",{});var z=Xe(m);v=Bn(z,_),z.forEach(Ee)},m(S,P){oi(S,i,P),He(i,c),oi(S,f,P),oi(S,m,P),He(m,v)},p(S,[P]){var z;P&1&&o!==(o=S[0].status+"")&&Sr(c,o),P&1&&_!==(_=((z=S[0].error)==null?void 0:z.message)+"")&&Sr(v,_)},i:ln,o:ln,d(S){S&&(Ee(i),Ee(f),Ee(m))}}}function nL(r,i,o){let c;return wx(r,tL,f=>o(0,c=f)),[c]}let fj=class extends jr{constructor(i){super(),Vr(this,i,nL,iL,kr,{})}};var rL=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function sL(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var yI={exports:{}};(function(r,i){var o={};(function(c,f){r.exports=f()})(rL,function(){var c,f,m;function _(s,S){if(!c)c=S;else if(!f)f=S;else{var P="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+c+")(sharedChunk); ("+f+")(sharedChunk); self.onerror = null;",z={};c(z),m=S(z),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(m.workerUrl=window.URL.createObjectURL(new Blob([P],{type:"text/javascript"})))}}_(["exports"],function(s){var S="3.2.0";let P;const z={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(P==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{P=o.API_URL_REGEX!=null?new RegExp(o.API_URL_REGEX):t}catch{P=t}}return P},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!z.API_URL)return null;try{const t=new URL(z.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},F={supported:!1,testSupport:function(t){!W&&Z&&(Q?ie(t):U=t)}};let U,Z,W=!1,Q=!1;const re=typeof self<"u"?self:{};function ie(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Z),t.isContextLost())return;F.supported=!0}catch{}t.deleteTexture(e),W=!0}re.document&&(Z=re.document.createElement("img"),Z.onload=function(){U&&ie(U),U=null,Q=!0},Z.onerror=function(){W=!0,U=null},Z.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ve="01";function pe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ke=Me;function Me(t,e,n,a){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=a}Me.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,a=0;a<8;a++){var u=this.sampleCurveX(n)-t;if(Math.abs(u)<e)return n;var d=this.sampleCurveDerivativeX(n);if(Math.abs(d)<1e-6)break;n-=u/d}var p=0,y=1;for(n=t,a=0;a<20&&(u=this.sampleCurveX(n),!(Math.abs(u-t)<e));a++)t>u?p=n:y=n,n=.5*(y-p)+p;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Ye=pe(ke),ot=Mt;function Mt(t,e){this.x=t,this.y=e}Mt.prototype={clone:function(){return new Mt(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),a=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=a,this},_rotateAround:function(t,e){var n=Math.cos(t),a=Math.sin(t),u=e.y+a*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-a*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Mt.convert=function(t){return t instanceof Mt?t:Array.isArray(t)?new Mt(t[0],t[1]):t};var Se=pe(ot);const yt=Math.PI/180,_t=180/Math.PI;function Ze(t){return t*yt}function Tt(t){return t*_t}const Zt=[[0,0],[1,0],[1,1],[0,1]];function ni(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function ui(t,e,n,a){const u=new Ye(t,e,n,a);return function(d){return u.solve(d)}}const Di=ui(.25,.1,.25,1);function ft(t,e,n){return Math.min(n,Math.max(e,t))}function yi(t,e,n){return(n=ft((n-t)/(e-t),0,1))*n*(3-2*n)}function wi(t,e,n){const a=n-e,u=((t-e)%a+a)%a+e;return u===e?n:u}function ai(t,e,n){if(!t.length)return n(null,[]);let a=t.length;const u=new Array(t.length);let d=null;t.forEach((p,y)=>{e(p,(b,T)=>{b&&(d=b),u[y]=T,--a==0&&n(d,u)})})}function nt(t){const e=[];for(const n in t)e.push(t[n]);return e}function Qe(t,...e){for(const n of e)for(const a in n)t[a]=n[a];return t}let Ii=1;function bi(){return Ii++}function rn(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Hi(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Pn(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function at(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function on(t,e){return t.indexOf(e,t.length-e.length)!==-1}function $n(t,e,n){const a={};for(const u in t)a[u]=e.call(n||this,t[u],u,t);return a}function er(t,e,n){const a={};for(const u in t)e.call(n||this,t[u],u,t)&&(a[u]=t[u]);return a}function en(t){return Array.isArray(t)?t.map(en):typeof t=="object"&&t?$n(t,en):t}const St={};function si(t){St[t]||(typeof console<"u"&&console.warn(t),St[t]=!0)}function Re(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function ee(t){let e=0;for(let n,a,u=0,d=t.length,p=d-1;u<d;p=u++)n=t[u],a=t[p],e+=(a.x-n.x)*(n.y+a.y);return e}function ce([t,e,n]){const a=Ze(e+90),u=Ze(n);return{x:t*Math.cos(a)*Math.sin(u),y:t*Math.sin(a)*Math.sin(u),z:t*Math.cos(u),azimuthal:e,polar:n}}function Te(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function it(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,a,u,d)=>{const p=u||d;return e[a]=!p||p.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let tt=null;function Et(t){try{const e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Dt(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function Ke(t,e,n,a){for(;e<n;){const u=e+n>>1;t[u]<a?e=u+1:n=u}return e}function Vt(t,e,n,a){for(;e<n;){const u=e+n>>1;t[u]<=a?e=u+1:n=u}return e}const Ct="mapbox-tiles";let zt=500,Fi=50,Ti,Dn;function un(){try{return caches}catch{}}function pn(){const t=un();t&&!Ti&&(Ti=t.open(Ct))}function Be(t){const e=t.indexOf("?");if(e<0)return t;const n=function(u){const d=u.indexOf("?");return d>0?u.slice(d+1).split("&"):[]}(t),a=n.filter(u=>{const d=u.split("=");return d[0]==="language"||d[0]==="worldview"});return a.length?`${t.slice(0,e)}?${a.join("&")}`:t.slice(0,e)}let Yt=1/0;const zi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(zi);class Ni extends Error{constructor(e,n,a){n===401&&gt(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const zn=Te()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,rs=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(zn())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,u){const d=new AbortController,p=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:zn(),referrerPolicy:a.referrerPolicy,signal:d.signal});let y=!1,b=!1;const T=(E=p.url).indexOf("sku=")>0&&gt(E);var E;a.type==="json"&&p.headers.set("Accept","application/json");const I=(D,R,B)=>{if(b)return;if(D&&D.message!=="SecurityError"&&si(D.toString()),R&&B)return C(R);const V=Date.now();fetch(p).then(G=>{if(G.ok){const $=T?G.clone():null;return C(G,$,V)}return u(new Ni(G.statusText,G.status,a.url))}).catch(G=>{G.name!=="AbortError"&&u(new Error(`${G.message} ${a.url}`))})},C=(D,R,B)=>{(a.type==="arrayBuffer"?D.arrayBuffer():a.type==="json"?D.json():D.text()).then(V=>{b||(R&&B&&function(G,$,te){if(pn(),!Ti)return;const se={status:$.status,statusText:$.statusText,headers:new Headers};$.headers.forEach((ye,we)=>se.headers.set(we,ye));const le=it($.headers.get("Cache-Control")||"");if(le["no-store"])return;le["max-age"]&&se.headers.set("Expires",new Date(te+1e3*le["max-age"]).toUTCString());const he=se.headers.get("Expires");he&&(new Date(he).getTime()-te<42e4||function(ye,we){if(Dn===void 0)try{new Response(new ReadableStream),Dn=!0}catch{Dn=!1}Dn?we(ye.body):ye.blob().then(we)}($,ye=>{const we=new Response(ye,se);pn(),Ti&&Ti.then(Ie=>Ie.put(Be(G.url),we)).catch(Ie=>si(Ie.message))}))}(p,R,B),y=!0,u(null,V,D.headers.get("Cache-Control"),D.headers.get("Expires")))}).catch(V=>{b||u(new Error(V.message))})};return T?function(D,R){if(pn(),!Ti)return R(null);const B=Be(D.url);Ti.then(V=>{V.match(B).then(G=>{const $=function(te){if(!te)return!1;const se=new Date(te.headers.get("Expires")||0),le=it(te.headers.get("Cache-Control")||"");return se>Date.now()&&!le["no-cache"]}(G);V.delete(B),$&&V.put(B,G.clone()),R(null,G,$)}).catch(R)}).catch(R)}(p,I):I(null,null),{cancel:()=>{b=!0,y||d.abort()}}}(t,e);if(Te()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(a,u){const d=new XMLHttpRequest;d.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const p in a.headers)d.setRequestHeader(p,a.headers[p]);return a.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=a.credentials==="include",d.onerror=()=>{u(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let p=d.response;if(a.type==="json")try{p=JSON.parse(d.response)}catch(y){return u(y)}u(null,p,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else u(new Ni(d.statusText,d.status,a.url))},d.send(a.body),{cancel:()=>d.abort()}}(t,e)},sr=function(t,e){return rs(Qe(t,{type:"arrayBuffer"}),e)};function xs(t){const e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}const To="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let mr,We;mr=[],We=0;const Je=function(t,e){if(F.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),We>=z.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return mr.push(d),d}We++;let n=!1;const a=()=>{if(!n)for(n=!0,We--;mr.length&&We<z.MAX_PARALLEL_IMAGE_REQUESTS;){const d=mr.shift(),{requestParameters:p,callback:y,cancelled:b}=d;b||(d.cancel=Je(p,y).cancel)}},u=sr(t,(d,p,y,b)=>{a(),d?e(d):p&&(self.createImageBitmap?function(T,E){const I=new Blob([new Uint8Array(T)],{type:"image/png"});createImageBitmap(I).then(C=>{E(null,C)}).catch(C=>{E(new Error(`Could not load image because of ${C.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(T,E)=>e(T,E,y,b)):function(T,E){const I=new Image;I.onload=()=>{E(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=To})},I.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const C=new Blob([new Uint8Array(T)],{type:"image/png"});I.src=T.byteLength?URL.createObjectURL(C):To}(p,(T,E)=>e(T,E,y,b)))});return{cancel:()=>{u.cancel(),a()}}},ut="NO_ACCESS_TOKEN";function ht(t){return t.indexOf("mapbox:")===0}function gt(t){return z.API_URL_REGEX.test(t)}function At(t){return z.API_CDN_URL_REGEX.test(t)}function It(t){return z.API_STYLE_REGEX.test(t)&&!vt(t)}function vt(t){return z.API_SPRITE_REGEX.test(t)}const jt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function mt(t){const e=t.match(jt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function pi(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const Zi="mapbox.eventData";function Jt(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ji{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=Jt(z.ACCESS_TOKEN);let a="";return a=n&&n.u?btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(u,d)=>String.fromCharCode(+("0x"+d)))):z.ACCESS_TOKEN||"",e?`${Zi}.${e}:${a}`:`${Zi}:${a}`}fetchEventData(){const e=Et("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{const u=localStorage.getItem(n);u&&(this.eventData=JSON.parse(u));const d=localStorage.getItem(a);d&&(this.anonId=d)}catch{si("Unable to read from LocalStorage")}}saveEventData(){const e=Et("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid"),u=this.anonId;if(e&&u)try{localStorage.setItem(a,u),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{si("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,a,u){if(!z.EVENTS_URL)return;const d=mt(z.EVENTS_URL);d.params.push(`access_token=${u||z.ACCESS_TOKEN||""}`);const p={event:this.type,created:new Date(e).toISOString()},y=n?Qe(p,n):p,b={url:pi(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=function(T,E){return rs(Qe(T,{method:"POST"}),E)}(b,T=>{this.pendingRequest=null,a(T),this.saveEventData(),this.processRequests(u)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const kn=new class extends Ji{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){z.EVENTS_URL&&z.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>ht(n)||gt(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Jt(z.ACCESS_TOKEN),n=e?e.u:z.ACCESS_TOKEN;let a=n!==this.eventData.tokenU;Pn(this.anonId)||(this.anonId=rn(),a=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const d=new Date(this.eventData.lastSuccess),p=new Date(u),y=(u-this.eventData.lastSuccess)/864e5;a=a||y>=1||y<-1||d.getDate()!==p.getDate()}else a=!0;a?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:S,skuId:ve,"enabled.telemetry":!1,userId:this.anonId},d=>{d||(this.eventData.lastSuccess=u,this.eventData.tokenU=n)},t):this.processRequests()}},Ln=kn.postTurnstileEvent.bind(kn),jn=new class extends Ji{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,a){this.skuToken=e,this.errorCb=a,z.EVENTS_URL&&(n||z.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(ut)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Pn(this.anonId)||(this.anonId=rn()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:S,skuId:ve,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t))}},yr=jn.postMapLoadEvent.bind(jn),es=new class extends Ji{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){z.EVENTS_URL&&(t||z.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:n}=this.queue.shift(),a=function(u){const d=performance.getEntriesByType("resource"),p=performance.getEntriesByType("mark"),y=function(D){const R={};if(D){for(const B in D)if(B!=="other")for(const V of D[B]){const G=`${B}ResolveRangeMin`,$=`${B}ResolveRangeMax`,te=`${B}RequestCount`,se=`${B}RequestCachedCount`;R[G]=Math.min(R[G]||1/0,V.startTime),R[$]=Math.max(R[$]||-1/0,V.responseEnd);const le=he=>{R[he]===void 0&&(R[he]=0),++R[he]};V.transferSize!==void 0&&V.transferSize===0&&le(se),le(te)}}return R}(function(D,R){const B={};if(D)for(const V of D){const G=R(V);B[G]===void 0&&(B[G]=[]),B[G].push(V)}return B}(d,qa)),b=window.devicePixelRatio,T=navigator.connection||navigator.mozConnection||navigator.webkitConnection,E=T?T.effectiveType:void 0,I={counters:[],metadata:[],attributes:[]},C=(D,R,B)=>{B!=null&&D.push({name:R,value:B.toString()})};for(const D in y)C(I.counters,D,y[D]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(C(I.counters,"interactionRangeMin",u.interactionRange[0]),C(I.counters,"interactionRangeMax",u.interactionRange[1])),p)for(const D of Object.keys(eo)){const R=eo[D],B=p.find(V=>V.name===R);B&&C(I.counters,R,B.startTime)}return C(I.counters,"visibilityHidden",u.visibilityHidden),C(I.attributes,"style",function(D){if(D)for(const R of D){const B=R.name.split("?")[0];if(It(B)){const V=B.split("/").slice(-2);if(V.length===2)return`mapbox://styles/${V[0]}/${V[1]}`}}}(d)),C(I.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),C(I.attributes,"fogEnabled",u.fogEnabled?"true":"false"),C(I.attributes,"projection",u.projection),C(I.attributes,"zoom",u.zoom),C(I.metadata,"devicePixelRatio",b),C(I.metadata,"connectionEffectiveType",E),C(I.metadata,"navigatorUserAgent",navigator.userAgent),C(I.metadata,"screenWidth",window.screen.width),C(I.metadata,"screenHeight",window.screen.height),C(I.metadata,"windowWidth",window.innerWidth),C(I.metadata,"windowHeight",window.innerHeight),C(I.metadata,"mapWidth",u.width/b),C(I.metadata,"mapHeight",u.height/b),C(I.metadata,"webglRenderer",u.renderer),C(I.metadata,"webglVendor",u.vendor),C(I.metadata,"sdkVersion",S),C(I.metadata,"sdkIdentifier","mapbox-gl-js"),I}(n);for(const u of a.metadata);for(const u of a.counters);for(const u of a.attributes);this.postEvent(e,a,()=>{},t)}},ss=es.postPerformanceEvent.bind(es),ts=new class extends Ji{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,a){if(!z.API_URL||!z.SESSION_PATH)return;const u=mt(z.API_URL+z.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${a||z.ACCESS_TOKEN||""}`);const d={url:pi(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(p,y){return rs(Qe(p,{method:"GET"}),y)}(d,p=>{this.pendingRequest=null,n(p),this.saveEventData(),this.processRequests(a)})}getSessionAPI(t,e,n,a){this.skuToken=e,this.errorCb=a,z.SESSION_PATH&&z.API_URL&&(n||z.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(ut)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t)}},xr=ts.getSessionAPI.bind(ts),Ur=new Set,eo={create:"create",load:"load",fullLoad:"fullLoad"};function qa(t){const e=t.name.split("?")[0];return At(e)&&e.includes("mapbox-gl.js")?"javascript":At(e)&&e.includes("mapbox-gl.css")?"css":function(n){return z.API_FONTS_REGEX.test(n)}(e)?"fontRange":vt(e)?"sprite":It(e)?"style":function(n){return z.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}function gh(t){const e=t?t.url.toString():void 0;return e?performance.getEntriesByName(e):[]}let Nc,Vc,_h,zl,$o;function tp(){return Nc==null&&(Nc=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Nc}const Cr={now:()=>zl!==void 0?zl:performance.now(),setNow(t){zl=t},restoreNow(){zl=void 0},frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:n,height:a}=t;$o||($o=document.createElement("canvas"));const u=$o.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(n>$o.width||a>$o.height)&&($o.width=n,$o.height=a),u.clearRect(-e,-e,n+2*e,a+2*e),u.drawImage(t,0,0,n,a),u.getImageData(-e,-e,n+2*e,a+2*e)},resolveURL:t=>(Vc||(Vc=document.createElement("a")),Vc.href=t,Vc.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(_h==null&&(_h=window.matchMedia("(prefers-reduced-motion: reduce)")),_h.matches)},hasCanvasFingerprintNoise(){if(!tp())return!1;const t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let n=0;for(let u=0;u<t.width;++u)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(u,0,1,1);const a=e.getImageData(0,0,t.width,t.height);n=0;for(let u=0;u<a.data.length;++u)if(u%4!=3&&n++!==a.data[u])return!0;return!1}};function jc(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function ea(t,e,n){if(n&&n[t]){const a=n[t].indexOf(e);a!==-1&&n[t].splice(a,1)}}class vs{constructor(e,n={}){Qe(this,n),this.type=e}}class ta extends vs{constructor(e,n={}){super("error",Qe({error:e},n))}}class Bs{on(e,n){return this._listeners=this._listeners||{},jc(e,n,this._listeners),this}off(e,n){return ea(e,n,this._listeners),ea(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},jc(e,n,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,n){typeof e=="string"&&(e=new vs(e,n||{}));const a=e.type;if(this.listens(a)){e.target=this;const u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const y of u)y.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const y of d)ea(a,y,this._oneTimeListeners),y.call(this,e);const p=this._eventedParent;p&&(Qe(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof ta&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var De=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Ut{constructor(e,n,a,u){this.message=(e?`${e}: `:"")+a,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}class Fs extends Ut{}function bs(t,...e){for(const n of e)for(const a in n)t[a]=n[a];return t}function Un(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function to(t){if(Array.isArray(t))return t.map(to);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=to(t[n]);return e}return Un(t)}class D_ extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var ws=D_;class yh{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[a,u]of n)this.bindings[a]=u}concat(e){return new yh(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var z_=yh;const ia={kind:"null"},et={kind:"number"},Li={kind:"string"},Oi={kind:"boolean"},os={kind:"color"},Za={kind:"object"},ki={kind:"value"},na={kind:"collator"},Mo={kind:"formatted"},Ll={kind:"resolvedImage"};function Pr(t,e){return{kind:"array",itemType:t,N:e}}function an(t){if(t.kind==="array"){const e=an(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const L_=[ia,et,Li,Oi,os,Mo,Za,Pr(ki),Ll];function ra(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ra(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const n of L_)if(!ra(n,e))return null}}return`Expected ${an(t)} but found ${an(e)} instead.`}function xh(t,e){return e.some(n=>n.kind===t.kind)}function sa(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}var Uc,Xa={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ya(t){return(t=Math.round(t))<0?0:t>255?255:t}function vh(t){return Ya(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Gc(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function bh(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{Uc={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in Xa)return Xa[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=n.indexOf("("),u=n.indexOf(")");if(a!==-1&&u+1===n.length){var d=n.substr(0,a),p=n.substr(a+1,u-(a+1)).split(","),y=1;switch(d){case"rgba":if(p.length!==4)return null;y=Gc(p.pop());case"rgb":return p.length!==3?null:[vh(p[0]),vh(p[1]),vh(p[2]),y];case"hsla":if(p.length!==4)return null;y=Gc(p.pop());case"hsl":if(p.length!==3)return null;var b=(parseFloat(p[0])%360+360)%360/360,T=Gc(p[1]),E=Gc(p[2]),I=E<=.5?E*(T+1):E+T-E*T,C=2*E-I;return[Ya(255*bh(C,I,b+1/3)),Ya(255*bh(C,I,b)),Ya(255*bh(C,I,b-1/3)),y];default:return null}}return null}}catch{}class Dr{constructor(e,n,a,u=1){this.r=e,this.g=n,this.b=a,this.a=u}static parse(e){if(!e)return;if(e instanceof Dr)return e;if(typeof e!="string")return;const n=Uc(e);return n?new Dr(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,a,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(a)},${u})`}toArray(){const{r:e,g:n,b:a,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*n/u,255*a/u,u]}toArray01(){const{r:e,g:n,b:a,a:u}=this;return u===0?[0,0,0,0]:[e/u,n/u,a/u,u]}toArray01Scaled(e){const{r:n,g:a,b:u,a:d}=this;return d===0?[0,0,0]:[n/d*e,a/d*e,u/d*e]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:a,a:u}=this;return[e,n,a,u]}toArray01Linear(){const{r:e,g:n,b:a,a:u}=this;return u===0?[0,0,0,0]:[Math.pow(e/u,2.2),Math.pow(n/u,2.2),Math.pow(a/u,2.2),u]}}Dr.black=new Dr(0,0,0,1),Dr.white=new Dr(1,1,1,1),Dr.transparent=new Dr(0,0,0,0),Dr.red=new Dr(1,0,0,1),Dr.blue=new Dr(0,0,1,1);var _n=Dr;class wh{constructor(e,n,a){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class oa{constructor(e,n,a,u,d){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=a,this.fontStack=u,this.textColor=d}}class zr{constructor(e){this.sections=e}static fromString(e){return new zr([new oa(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof zr?e:zr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);const a={};n.fontStack&&(a["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(a["font-scale"]=n.scale),n.textColor&&(a["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(a)}return e}}class as{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new as({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function ip(t,e,n,a){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[t,e,n,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[t,e,n,a]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ka(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof _n||t instanceof wh||t instanceof zr||t instanceof as)return!0;if(Array.isArray(t)){for(const e of t)if(!Ka(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!Ka(t[e]))return!1;return!0}return!1}function tr(t){if(t===null)return ia;if(typeof t=="string")return Li;if(typeof t=="boolean")return Oi;if(typeof t=="number")return et;if(t instanceof _n)return os;if(t instanceof wh)return na;if(t instanceof zr)return Mo;if(t instanceof as)return Ll;if(Array.isArray(t)){const e=t.length;let n;for(const a of t){const u=tr(a);if(n){if(n===u)continue;n=ki;break}n=u}return Pr(n||ki,e)}return Za}function Rl(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof _n||t instanceof zr||t instanceof as?t.toString():JSON.stringify(t)}class Th{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ka(e[1]))return n.error("invalid value");const a=e[1];let u=tr(a);const d=n.expectedType;return u.kind!=="array"||u.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(u=d),new Th(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof _n?["rgba"].concat(this.value.toArray()):this.value instanceof zr?this.value.serialize():this.value}}var Ja=Th,Gn=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const Mh={string:Li,number:et,boolean:Oi,object:Za};class Sh{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a,u=1;const d=e[0];if(d==="array"){let y,b;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in Mh)||T==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);y=Mh[T],u++}else y=ki;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);b=e[2],u++}a=Pr(y,b)}else a=Mh[d];const p=[];for(;u<e.length;u++){const y=n.parse(e[u],u,ki);if(!y)return null;p.push(y)}return new Sh(a,p)}evaluate(e){for(let n=0;n<this.args.length;n++){const a=this.args[n].evaluate(e);if(!ra(this.type,tr(a)))return a;if(n===this.args.length-1)throw new Gn(`Expected value to be of type ${an(this.type)}, but found ${an(tr(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){n.push(a.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&n.push(u)}}return n.concat(this.args.map(a=>a.serialize()))}}var Ts=Sh;class Ol{constructor(e){this.type=Mo,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return n.error("First argument must be an image or text section.");const u=[];let d=!1;for(let p=1;p<=e.length-1;++p){const y=e[p];if(d&&typeof y=="object"&&!Array.isArray(y)){d=!1;let b=null;if(y["font-scale"]&&(b=n.parse(y["font-scale"],1,et),!b))return null;let T=null;if(y["text-font"]&&(T=n.parse(y["text-font"],1,Pr(Li)),!T))return null;let E=null;if(y["text-color"]&&(E=n.parse(y["text-color"],1,os),!E))return null;const I=u[u.length-1];I.scale=b,I.font=T,I.textColor=E}else{const b=n.parse(e[p],1,ki);if(!b)return null;const T=b.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,u.push({content:b,scale:null,font:null,textColor:null})}}return new Ol(u)}evaluate(e){return new zr(this.sections.map(n=>{const a=n.content.evaluate(e);return tr(a)===Ll?new oa("",a,null,null,null):new oa(Rl(a),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const a={};n.scale&&(a["font-scale"]=n.scale.serialize()),n.font&&(a["text-font"]=n.font.serialize()),n.textColor&&(a["text-color"]=n.textColor.serialize()),e.push(a)}return e}}class Bl{constructor(e,n){this.type=Ll,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");const a=n.parse(e[1],1,Li);if(!a)return n.error("No image name provided.");if(e.length===2)return new Bl(a);const u=n.parse(e[2],1,Li);return u?new Bl(a,u):n.error("Secondary image variant is not a string.")}evaluate(e){const n=as.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Wi(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}const R_={"to-boolean":Oi,"to-color":os,"to-number":et,"to-string":Li};class Hc{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const a=e[0],u=[];let d=ia;if(a==="to-array"){if(!Array.isArray(e[1]))return null;const p=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);d=Pr(n.expectedType.itemType,p)}else{if(!(p>0&&Ka(e[1][0])))return null;d=Pr(tr(e[1][0]),p)}for(let y=0;y<p;y++){const b=e[1][y];let T;if(Wi(b)==="array")T=n.parse(b,void 0,d.itemType);else{const E=Wi(b);if(E!==d.itemType.kind)return n.error(`Expected ${d.itemType.kind} but found ${E}.`);T=n.registry.literal.parse(["literal",b===void 0?null:b],n)}if(!T)return null;u.push(T)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return n.error("Expected one argument.");d=R_[a];for(let p=1;p<e.length;p++){const y=n.parse(e[p],p,ki);if(!y)return null;u.push(y)}}return new Hc(d,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,a;for(const u of this.args){if(n=u.evaluate(e),a=null,n instanceof _n)return n;if(typeof n=="string"){const d=e.parseColor(n);if(d)return d}else if(Array.isArray(n)&&(a=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:ip(n[0],n[1],n[2],n[3]),!a))return new _n(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Gn(a||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const a of this.args){if(n=a.evaluate(e),n===null)return 0;const u=Number(n);if(!isNaN(u))return u}throw new Gn(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?zr.fromString(Rl(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?as.fromString(Rl(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):Rl(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ol([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Bl(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var So=Hc;const np=["Unknown","Point","LineString","Polygon"];var Eh=class{constructor(t,e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=e}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?np[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(a*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=_n.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class Eo{constructor(e,n,a,u,d){this.name=e,this.type=n,this._evaluate=a,this.args=u,this._overloadIndex=d}evaluate(e){if(!this._evaluate){const n=Eo.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const a=e[0],u=Eo.definitions[a];if(!u)return n.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(u)?u[0]:u.type,p=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=[];let b=null,T=-1;for(const[E,I]of p){if(Array.isArray(E)&&E.length!==e.length-1)continue;y.push(E),T++,b=new jh(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);const C=[];let D=!1;for(let R=1;R<e.length;R++){const B=e[R],V=Array.isArray(E)?E[R-1]:E.type,G=b.parse(B,1+C.length,V);if(!G){D=!0;break}C.push(G)}if(!D)if(Array.isArray(E)&&E.length!==C.length)b.error(`Expected ${E.length} arguments, but found ${C.length} instead.`);else{for(let R=0;R<C.length;R++){const B=Array.isArray(E)?E[R]:E.type,V=C[R];b.concat(R+1).checkSubtype(B,V.type)}if(b.errors.length===0)return new Eo(a,d,I,C,T)}}if(y.length===1)n.errors.push(...b.errors);else{const E=(y.length?y:p.map(([C])=>C)).map(rp).join(" | "),I=[];for(let C=1;C<e.length;C++){const D=n.parse(e[C],1+I.length);if(!D)return null;I.push(an(D.type))}n.error(`Expected arguments of type ${E}, but found (${I.join(", ")}) instead.`)}return null}static register(e,n){Eo.definitions=n;for(const a in n)e[a]=Eo}}function rp(t){return Array.isArray(t)?`(${t.map(an).join(", ")})`:`(${an(t.type)}...)`}var Ms=Eo;class Fl{constructor(e,n,a){this.type=na,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return n.error("Collator options argument must be an object.");const u=n.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,Oi);if(!u)return null;const d=n.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,Oi);if(!d)return null;let p=null;return a.locale&&(p=n.parse(a.locale,1,Li),!p)?null:new Fl(u,d,p)}evaluate(e){return new wh(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Ah={exports:{}};Ah.exports=function(){function t(a,u,d,p,y){for(;p>d;){if(p-d>600){var b=p-d+1,T=u-d+1,E=Math.log(b),I=.5*Math.exp(2*E/3),C=.5*Math.sqrt(E*I*(b-I)/b)*(T-b/2<0?-1:1);t(a,u,Math.max(d,Math.floor(u-T*I/b+C)),Math.min(p,Math.floor(u+(b-T)*I/b+C)),y)}var D=a[u],R=d,B=p;for(e(a,d,u),y(a[p],D)>0&&e(a,d,p);R<B;){for(e(a,R,B),R++,B--;y(a[R],D)<0;)R++;for(;y(a[B],D)>0;)B--}y(a[d],D)===0?e(a,d,B):e(a,++B,p),B<=u&&(d=B+1),u<=B&&(p=B-1)}}function e(a,u,d){var p=a[u];a[u]=a[d],a[d]=p}function n(a,u){return a<u?-1:a>u?1:0}return function(a,u,d,p,y){t(a,u,d||0,p||a.length-1,y||n)}}();var sp=pe(Ah.exports);function Wc(t){let e=0;for(let n,a,u=0,d=t.length,p=d-1;u<d;p=u++)n=t[u],a=t[p],e+=(a.x-n.x)*(n.y+a.y);return e}function Ao(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Io(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function op(t,e,n){const a=t[0]-e[0],u=t[1]-e[1],d=t[0]-n[0],p=t[1]-n[1];return a*p-d*u==0&&a*d<=0&&u*p<=0}function aa(t,e,n=!1){let a=!1;for(let y=0,b=e.length;y<b;y++){const T=e[y];for(let E=0,I=T.length,C=I-1;E<I;C=E++){const D=T[C],R=T[E];if(op(t,D,R))return n;(d=D)[1]>(u=t)[1]!=(p=R)[1]>u[1]&&u[0]<(p[0]-d[0])*(u[1]-d[1])/(p[1]-d[1])+d[0]&&(a=!a)}}var u,d,p;return a}function Ih(t,e,n,a){const u=a[0]-n[0],d=a[1]-n[1],p=(t[0]-n[0])*d-u*(t[1]-n[1]),y=(e[0]-n[0])*d-u*(e[1]-n[1]);return p>0&&y<0||p<0&&y>0}function io(t,e,n,a){return(u=[a[0]-n[0],a[1]-n[1]])[0]*(d=[e[0]-t[0],e[1]-t[1]])[1]-u[1]*d[0]!=0&&!(!Ih(t,e,n,a)||!Ih(n,a,t,e));var u,d}const Ai=8192;function O_(t,e){const n=(180+t[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(n*u*Ai),Math.round(a*u*Ai)]}function B_(t,e){for(let n=0;n<e.length;n++)if(aa(t,e[n]))return!0;return!1}function F_(t,e,n){for(const a of n)for(let u=0,d=a.length,p=d-1;u<d;p=u++)if(io(t,e,a[p],a[u]))return!0;return!1}function kh(t,e){for(let n=0;n<t.length;++n)if(!aa(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(F_(t[n],t[n+1],e))return!1;return!0}function N_(t,e){for(let n=0;n<e.length;n++)if(kh(t,e[n]))return!0;return!1}function qc(t,e,n){const a=[];for(let u=0;u<t.length;u++){const d=[];for(let p=0;p<t[u].length;p++){const y=O_(t[u][p],n);Ao(e,y),d.push(y)}a.push(d)}return a}function Ch(t,e,n){const a=[];for(let u=0;u<t.length;u++){const d=qc(t[u],e,n);a.push(d)}return a}function Ph(t,e,n,a){if(t[0]<n[0]||t[0]>n[2]){const u=.5*a;let d=t[0]-n[0]>u?-a:n[0]-t[0]>u?a:0;d===0&&(d=t[0]-n[2]>u?-a:n[2]-t[0]>u?a:0),t[0]+=d}Ao(e,t)}function la(t,e,n,a){const u=Math.pow(2,a.z)*Ai,d=[a.x*Ai,a.y*Ai],p=[];if(!t)return p;for(const y of t)for(const b of y){const T=[b.x+d[0],b.y+d[1]];Ph(T,e,n,u),p.push(T)}return p}function Dh(t,e,n,a){const u=Math.pow(2,a.z)*Ai,d=[a.x*Ai,a.y*Ai],p=[];if(!t)return p;for(const b of t){const T=[];for(const E of b){const I=[E.x+d[0],E.y+d[1]];Ao(e,I),T.push(I)}p.push(T)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of p)for(const T of b)Ph(T,e,n,u)}var y;return p}class Ns{constructor(e,n){this.type=Oi,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ka(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let u=0;u<a.features.length;++u){const d=a.features[u].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Ns(a,a.features[u].geometry)}else if(a.type==="Feature"){const u=a.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Ns(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Ns(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,a){const u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(a.type==="Polygon"){const y=qc(a.coordinates,d,p),b=la(n.geometry(),u,d,p);if(!Io(u,d))return!1;for(const T of b)if(!aa(T,y))return!1}if(a.type==="MultiPolygon"){const y=Ch(a.coordinates,d,p),b=la(n.geometry(),u,d,p);if(!Io(u,d))return!1;for(const T of b)if(!B_(T,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,a){const u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(a.type==="Polygon"){const y=qc(a.coordinates,d,p),b=Dh(n.geometry(),u,d,p);if(!Io(u,d))return!1;for(const T of b)if(!kh(T,y))return!1}if(a.type==="MultiPolygon"){const y=Ch(a.coordinates,d,p),b=Dh(n.geometry(),u,d,p);if(!Io(u,d))return!1;for(const T of b)if(!N_(T,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Zc=Ns,zh={exports:{}};zh.exports=function(){var t={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,n=e*(2-e),a=Math.PI/180,u=function(T,E){if(T===void 0)throw new Error("No latitude given.");if(E&&!t[E])throw new Error("Unknown unit "+E+". Use one of: "+Object.keys(t).join(", "));var I=6378.137*a*(E?t[E]:1),C=Math.cos(T*a),D=1/(1-n*(1-C*C)),R=Math.sqrt(D);this.kx=I*R*C,this.ky=I*R*D*(1-n)},d={units:{configurable:!0}};function p(T,E){return T[0]===E[0]&&T[1]===E[1]}function y(T,E,I){var C=b(E[0]-T[0]);return[T[0]+C*I,T[1]+(E[1]-T[1])*I]}function b(T){for(;T<-180;)T+=360;for(;T>180;)T-=360;return T}return u.fromTile=function(T,E,I){var C=Math.PI*(1-2*(T+.5)/Math.pow(2,E)),D=Math.atan(.5*(Math.exp(C)-Math.exp(-C)))/a;return new u(D,I)},d.units.get=function(){return t},u.prototype.distance=function(T,E){var I=b(T[0]-E[0])*this.kx,C=(T[1]-E[1])*this.ky;return Math.sqrt(I*I+C*C)},u.prototype.bearing=function(T,E){var I=b(E[0]-T[0])*this.kx;return Math.atan2(I,(E[1]-T[1])*this.ky)/a},u.prototype.destination=function(T,E,I){var C=I*a;return this.offset(T,Math.sin(C)*E,Math.cos(C)*E)},u.prototype.offset=function(T,E,I){return[T[0]+E/this.kx,T[1]+I/this.ky]},u.prototype.lineDistance=function(T){for(var E=0,I=0;I<T.length-1;I++)E+=this.distance(T[I],T[I+1]);return E},u.prototype.area=function(T){for(var E=0,I=0;I<T.length;I++)for(var C=T[I],D=0,R=C.length,B=R-1;D<R;B=D++)E+=b(C[D][0]-C[B][0])*(C[D][1]+C[B][1])*(I?-1:1);return Math.abs(E)/2*this.kx*this.ky},u.prototype.along=function(T,E){var I=0;if(E<=0)return T[0];for(var C=0;C<T.length-1;C++){var D=T[C],R=T[C+1],B=this.distance(D,R);if((I+=B)>E)return y(D,R,(E-(I-B))/B)}return T[T.length-1]},u.prototype.pointToSegmentDistance=function(T,E,I){var C=E[0],D=E[1],R=b(I[0]-C)*this.kx,B=(I[1]-D)*this.ky,V=0;return R===0&&B===0||((V=(b(T[0]-C)*this.kx*R+(T[1]-D)*this.ky*B)/(R*R+B*B))>1?(C=I[0],D=I[1]):V>0&&(C+=R/this.kx*V,D+=B/this.ky*V)),R=b(T[0]-C)*this.kx,B=(T[1]-D)*this.ky,Math.sqrt(R*R+B*B)},u.prototype.pointOnLine=function(T,E){for(var I,C,D,R,B=1/0,V=0;V<T.length-1;V++){var G=T[V][0],$=T[V][1],te=b(T[V+1][0]-G)*this.kx,se=(T[V+1][1]-$)*this.ky,le=0;te===0&&se===0||((le=(b(E[0]-G)*this.kx*te+(E[1]-$)*this.ky*se)/(te*te+se*se))>1?(G=T[V+1][0],$=T[V+1][1]):le>0&&(G+=te/this.kx*le,$+=se/this.ky*le));var he=(te=b(E[0]-G)*this.kx)*te+(se=(E[1]-$)*this.ky)*se;he<B&&(B=he,I=G,C=$,D=V,R=le)}return{point:[I,C],index:D,t:Math.max(0,Math.min(1,R))}},u.prototype.lineSlice=function(T,E,I){var C=this.pointOnLine(I,T),D=this.pointOnLine(I,E);if(C.index>D.index||C.index===D.index&&C.t>D.t){var R=C;C=D,D=R}var B=[C.point],V=C.index+1,G=D.index;!p(I[V],B[0])&&V<=G&&B.push(I[V]);for(var $=V+1;$<=G;$++)B.push(I[$]);return p(I[G],D.point)||B.push(D.point),B},u.prototype.lineSliceAlong=function(T,E,I){for(var C=0,D=[],R=0;R<I.length-1;R++){var B=I[R],V=I[R+1],G=this.distance(B,V);if((C+=G)>T&&D.length===0&&D.push(y(B,V,(T-(C-G))/G)),C>=E)return D.push(y(B,V,(E-(C-G))/G)),D;C>T&&D.push(V)}return D},u.prototype.bufferPoint=function(T,E){var I=E/this.ky,C=E/this.kx;return[T[0]-C,T[1]-I,T[0]+C,T[1]+I]},u.prototype.bufferBBox=function(T,E){var I=E/this.ky,C=E/this.kx;return[T[0]-C,T[1]-I,T[2]+C,T[3]+I]},u.prototype.insideBBox=function(T,E){return b(T[0]-E[0])>=0&&b(T[0]-E[2])<=0&&T[1]>=E[1]&&T[1]<=E[3]},Object.defineProperties(u,d),u}();var Lh=pe(zh.exports),Xc={exports:{}};Xc.exports=function(){var t=function(n,a){if(n===void 0&&(n=[]),a===void 0&&(a=e),this.data=n,this.length=this.data.length,this.compare=a,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function e(n,a){return n<a?-1:n>a?1:0}return t.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(this.length!==0){var n=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),n}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(n){for(var a=this.data,u=this.compare,d=a[n];n>0;){var p=n-1>>1,y=a[p];if(u(d,y)>=0)break;a[n]=y,n=p}a[n]=d},t.prototype._down=function(n){for(var a=this.data,u=this.compare,d=this.length>>1,p=a[n];n<d;){var y=1+(n<<1),b=a[y],T=y+1;if(T<this.length&&u(a[T],b)<0&&(y=T,b=a[T]),u(b,p)>=0)break;a[n]=b,n=y}a[n]=p},t}();var Yc=pe(Xc.exports),xt=8192;function ap(t,e){return e.dist-t.dist}const Kc=100,Rh=50;function lp(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Jc(t){return t[1]-t[0]+1}function no(t,e){const n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function Qc(t,e){if(t[0]>t[1])return[null,null];const n=Jc(t);if(e){if(n===2)return[t,null];const a=Math.floor(n/2);return[[t[0],t[0]+a],[t[0]+a,t[1]]]}{if(n===1)return[t,null];const a=Math.floor(n/2)-1;return[[t[0],t[0]+a],[t[0]+a+1,t[1]]]}}function ko(t,e){const n=[1/0,1/0,-1/0,-1/0];if(!no(e,t.length))return n;for(let a=e[0];a<=e[1];++a)Ao(n,t[a]);return n}function $c(t){const e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let a=0;a<t[n].length;++a)Ao(e,t[n][a]);return e}function ca(t,e,n){if(lp(t)||lp(e))return NaN;let a=0,u=0;return t[2]<e[0]&&(a=e[0]-t[2]),t[0]>e[2]&&(a=t[0]-e[2]),t[1]>e[3]&&(u=t[1]-e[3]),t[3]<e[1]&&(u=e[1]-t[3]),n.distance([0,0],[a,u])}function Oh(t,e){const n=Math.pow(2,e.z);return[(u=(t.x/xt+e.x)/n,360*u-180),(a=(t.y/xt+e.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,u}function V_(t,e){const n=[];for(let a=0;a<t.length;++a)n.push(Oh(t[a],e));return n}function Bh(t,e,n){const a=n.pointOnLine(e,t).point;return n.distance(t,a)}function Fh(t,e,n,a,u){const d=n.slice(a[0],a[1]+1);let p=1/0;for(let y=e[0];y<=e[1];++y)if((p=Math.min(p,Bh(t[y],d,u)))===0)return 0;return p}function Nh(t,e,n,a,u){const d=Math.min(u.pointToSegmentDistance(t,n,a),u.pointToSegmentDistance(e,n,a)),p=Math.min(u.pointToSegmentDistance(n,t,e),u.pointToSegmentDistance(a,t,e));return Math.min(d,p)}function j_(t,e,n,a,u){if(!no(e,t.length)||!no(a,n.length))return NaN;let d=1/0;for(let p=e[0];p<e[1];++p)for(let y=a[0];y<a[1];++y){if(io(t[p],t[p+1],n[y],n[y+1]))return 0;d=Math.min(d,Nh(t[p],t[p+1],n[y],n[y+1],u))}return d}function U_(t,e,n,a,u){if(!no(e,t.length)||!no(a,n.length))return NaN;let d=1/0;for(let p=e[0];p<=e[1];++p)for(let y=a[0];y<=a[1];++y)if((d=Math.min(d,u.distance(t[p],n[y])))===0)return d;return d}function cp(t,e,n){if(aa(t,e,!0))return 0;let a=1/0;for(const u of e){const d=u.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[d-1]&&(a=Math.min(a,n.pointToSegmentDistance(t,u[d-1],u[0])))===0||(a=Math.min(a,Bh(t,u,n)))===0)return a}return a}function G_(t,e,n,a){if(!no(e,t.length))return NaN;for(let d=e[0];d<=e[1];++d)if(aa(t[d],n,!0))return 0;let u=1/0;for(let d=e[0];d<e[1];++d)for(const p of n)for(let y=0,b=p.length,T=b-1;y<b;T=y++){if(io(t[d],t[d+1],p[T],p[y]))return 0;u=Math.min(u,Nh(t[d],t[d+1],p[T],p[y],a))}return u}function up(t,e){for(const n of t)for(let a=0;a<=n.length-1;++a)if(aa(n[a],e,!0))return!0;return!1}function hp(t,e,n,a=1/0){const u=$c(t),d=$c(e);if(a!==1/0&&ca(u,d,n)>=a)return a;if(Io(u,d)){if(up(t,e))return 0}else if(up(e,t))return 0;let p=a;for(const y of t)for(let b=0,T=y.length,E=T-1;b<T;E=b++)for(const I of e)for(let C=0,D=I.length,R=D-1;C<D;R=C++){if(io(y[E],y[b],I[R],I[C]))return 0;p=Math.min(p,Nh(y[E],y[b],I[R],I[C],n))}return p}function eu(t,e,n,a,u,d,p){if(d===null||p===null)return;const y=ca(ko(a,d),ko(u,p),n);y<e&&t.push({dist:y,range1:d,range2:p})}function H_(t,e,n,a,u=1/0){let d=Math.min(a.distance(t[0],n[0][0]),u);if(d===0)return d;const p=new Yc([{dist:0,range1:[0,t.length-1],range2:[0,0]}],ap),y=e?Rh:Kc,b=$c(n);for(;p.length;){const T=p.pop();if(T.dist>=d)continue;const E=T.range1;if(Jc(E)<=y){if(!no(E,t.length))return NaN;if(e){const I=G_(t,E,n,a);if((d=Math.min(d,I))===0)return d}else for(let I=E[0];I<=E[1];++I){const C=cp(t[I],n,a);if((d=Math.min(d,C))===0)return d}}else{const I=Qc(E,e);if(I[0]!==null){const C=ca(ko(t,I[0]),b,a);C<d&&p.push({dist:C,range1:I[0],range2:[0,0]})}if(I[1]!==null){const C=ca(ko(t,I[1]),b,a);C<d&&p.push({dist:C,range1:I[1],range2:[0,0]})}}}return d}function dp(t,e,n,a,u,d=1/0){let p=Math.min(d,u.distance(t[0],n[0]));if(p===0)return p;const y=new Yc([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],ap),b=e?Rh:Kc,T=a?Rh:Kc;for(;y.length;){const E=y.pop();if(E.dist>=p)continue;const I=E.range1,C=E.range2;if(Jc(I)<=b&&Jc(C)<=T){if(!no(I,t.length)||!no(C,n.length))return NaN;if(e&&a?p=Math.min(p,j_(t,I,n,C,u)):e||a?e&&!a?p=Math.min(p,Fh(n,C,t,I,u)):!e&&a&&(p=Math.min(p,Fh(t,I,n,C,u))):p=Math.min(p,U_(t,I,n,C,u)),p===0)return p}else{const D=Qc(I,e),R=Qc(C,a);eu(y,p,u,t,n,D[0],R[0]),eu(y,p,u,t,n,D[0],R[1]),eu(y,p,u,t,n,D[1],R[0]),eu(y,p,u,t,n,D[1],R[1])}}return p}function tu(t,e,n,a,u=1/0){let d=u;const p=ko(t,[0,t.length-1]);for(const y of n)if(!(d!==1/0&&ca(p,ko(y,[0,y.length-1]),a)>=d)&&(d=Math.min(d,dp(t,e,y,!0,a,d)),d===0))return d;return d}function Nl(t,e,n,a,u=1/0){let d=u;const p=ko(t,[0,t.length-1]);for(const y of n){if(d!==1/0&&ca(p,$c(y),a)>=d)continue;const b=H_(t,e,y,a,d);if(isNaN(b))return b;if((d=Math.min(d,b))===0)return d}return d}function iu(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class Vl{constructor(e,n){this.type=et,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Ka(e[1])){const a=e[1];if(a.type==="FeatureCollection"){for(let u=0;u<a.features.length;++u)if(iu(a.features[u].geometry.type))return new Vl(a,a.features[u].geometry)}else if(a.type==="Feature"){if(iu(a.geometry.type))return new Vl(a,a.geometry)}else if(iu(a.type))return new Vl(a,a)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const n=e.geometry(),a=e.canonicalID();if(n!=null&&a!=null){if(e.geometryType()==="Point")return function(u,d,p){const y=[];for(const T of u)for(const E of T)y.push(Oh(E,d));const b=new Lh(y[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?dp(y,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",b):p.type==="MultiLineString"?tu(y,!1,p.coordinates,b):p.type==="Polygon"||p.type==="MultiPolygon"?Nl(y,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,b):null}(n,a,this.geometries);if(e.geometryType()==="LineString")return function(u,d,p){const y=[];for(const T of u){const E=[];for(const I of T)E.push(Oh(I,d));y.push(E)}const b=new Lh(y[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return tu(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",y,b);if(p.type==="MultiLineString"){let T=1/0;for(let E=0;E<p.coordinates.length;E++){const I=tu(p.coordinates[E],!0,y,b,T);if(isNaN(I))return I;if((T=Math.min(T,I))===0)return T}return T}if(p.type==="Polygon"||p.type==="MultiPolygon"){let T=1/0;for(let E=0;E<y.length;E++){const I=Nl(y[E],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,b,T);if(isNaN(I))return I;if((T=Math.min(T,I))===0)return T}return T}return null}(n,a,this.geometries);if(e.geometryType()==="Polygon")return function(u,d,p){const y=[];for(const T of function(E,I){const C=E.length;if(C<=1)return[E];const D=[];let R,B;for(let V=0;V<C;V++){const G=Wc(E[V]);G!==0&&(E[V].area=Math.abs(G),B===void 0&&(B=G<0),B===G<0?(R&&D.push(R),R=[E[V]]):R.push(E[V]))}return R&&D.push(R),D}(u)){const E=[];for(let I=0;I<T.length;++I)E.push(V_(T[I],d));y.push(E)}const b=new Lh(y[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Nl(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",y,b);if(p.type==="MultiLineString"){let T=1/0;for(let E=0;E<p.coordinates.length;E++){const I=Nl(p.coordinates[E],!0,y,b,T);if(isNaN(I))return I;if((T=Math.min(T,I))===0)return T}return T}return p.type==="Polygon"||p.type==="MultiPolygon"?function(T,E,I){let C=1/0;for(const D of T)for(const R of E){const B=hp(D,R,I,C);if(isNaN(B))return B;if((C=Math.min(C,B))===0)return C}return C}(p.type==="Polygon"?[p.coordinates]:p.coordinates,y,b):null}(n,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var Vh=Vl;function Qa(t){if(t instanceof Ms&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Zc||t instanceof Vh)return!1;let e=!0;return t.eachChild(n=>{e&&!Qa(n)&&(e=!1)}),e}function gr(t){if(t instanceof Ms&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!gr(n)&&(e=!1)}),e}function jl(t){if(t instanceof Ms&&t.name==="config")return!1;let e=!0;return t.eachChild(n=>{e&&!jl(n)&&(e=!1)}),e}function ua(t,e){if(t instanceof Ms&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(a=>{n&&!ua(a,e)&&(n=!1)}),n}class nu{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const a=e[1];return n.scope.has(a)?new nu(a,n.scope.get(a)):n.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var fp=nu;class $a{constructor(e,n=[],a,u=new z_,d=[],p,y){this.registry=e,this.path=n,this.key=n.map(b=>`[${b}]`).join(""),this.scope=u,this.errors=d,this.expectedType=a,this._scope=p,this.options=y}parse(e,n,a,u,d={}){return n||a?this.concat(n,a,u)._parse(e,d):this._parse(e,d)}_parse(e,n){function a(u,d,p){return p==="assert"?new Ts(d,[u]):p==="coerce"?new So(d,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let d=u.parse(e,this);if(!d)return null;if(this.expectedType){const p=this.expectedType,y=d.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||y.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(p,y))return null}else d=a(d,p,n.typeAnnotation||"coerce");else d=a(d,p,n.typeAnnotation||"assert")}if(!(d instanceof Ja)&&d.type.kind!=="resolvedImage"&&ru(d)){const p=new Eh(this._scope,this.options);try{d=new Ja(d.type,d.evaluate(p))}catch(y){return this.error(y.message),null}}return d}return So.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,a){const u=typeof e=="number"?this.path.concat(e):this.path,d=a?this.scope.concat(a):this.scope;return new $a(this.registry,u,n||null,d,this.errors,this._scope,this.options)}error(e,...n){const a=`${this.key}${n.map(u=>`[${u}]`).join("")}`;this.errors.push(new ws(a,e))}checkSubtype(e,n){const a=ra(e,n);return a&&this.error(a),a}}var jh=$a;function ru(t){if(t instanceof fp)return ru(t.boundExpression);if(t instanceof Ms&&t.name==="error"||t instanceof Ms&&t.name==="config"||t instanceof Fl||t instanceof Zc||t instanceof Vh)return!1;const e=t instanceof So||t instanceof Ts;let n=!0;return t.eachChild(a=>{n=e?n&&ru(a):n&&a instanceof Ja}),!!n&&Qa(t)&&ua(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function su(t,e){const n=t.length-1;let a,u,d=0,p=n,y=0;for(;d<=p;)if(y=Math.floor((d+p)/2),a=t[y],u=t[y+1],a<=e){if(y===n||e<u)return y;d=y+1}else{if(!(a>e))throw new Gn("Input is not a number.");p=y-1}return 0}class Uh{constructor(e,n,a){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[u,d]of a)this.labels.push(u),this.outputs.push(d)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const a=n.parse(e[1],1,et);if(!a)return null;const u=[];let d=null;n.expectedType&&n.expectedType.kind!=="value"&&(d=n.expectedType);for(let p=1;p<e.length;p+=2){const y=p===1?-1/0:e[p],b=e[p+1],T=p,E=p+1;if(typeof y!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(u.length&&u[u.length-1][0]>=y)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const I=n.parse(b,E,d);if(!I)return null;d=d||I.type,u.push([y,I])}return new Uh(d,a,u)}evaluate(e){const n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return a[0].evaluate(e);const d=n.length;return u>=n[d-1]?a[d-1].evaluate(e):a[su(n,u)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var Gh=Uh;function Mi(t,e,n){return t*(1-n)+e*n}function ou(t,e,n){return t.map((a,u)=>Mi(a,e[u],n))}var Ul=Object.freeze({__proto__:null,array:ou,color:function(t,e,n){return new _n(Mi(t.r,e.r,n),Mi(t.g,e.g,n),Mi(t.b,e.b,n),Mi(t.a,e.a,n))},number:Mi});const Gl=.95047,ha=1.08883,pp=4/29,el=6/29,mp=3*el*el,W_=el*el*el,q_=Math.PI/180,Z_=180/Math.PI;function Hh(t){return t>W_?Math.pow(t,1/3):t/mp+pp}function Wh(t){return t>el?t*t*t:mp*(t-pp)}function qh(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Zh(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function gp(t){const e=Zh(t.r),n=Zh(t.g),a=Zh(t.b),u=Hh((.4124564*e+.3575761*n+.1804375*a)/Gl),d=Hh((.2126729*e+.7151522*n+.072175*a)/1);return{l:116*d-16,a:500*(u-d),b:200*(d-Hh((.0193339*e+.119192*n+.9503041*a)/ha)),alpha:t.a}}function da(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,a=isNaN(t.b)?e:e-t.b/200;return e=1*Wh(e),n=Gl*Wh(n),a=ha*Wh(a),new _n(qh(3.2404542*n-1.5371385*e-.4985314*a),qh(-.969266*n+1.8760108*e+.041556*a),qh(.0556434*n-.2040259*e+1.0572252*a),t.alpha)}function _p(t,e,n){const a=e-t;return t+n*(a>180||a<-180?a-360*Math.round(a/360):a)}const tl={forward:gp,reverse:da,interpolate:function(t,e,n){return{l:Mi(t.l,e.l,n),a:Mi(t.a,e.a,n),b:Mi(t.b,e.b,n),alpha:Mi(t.alpha,e.alpha,n)}}},Co={forward:function(t){const{l:e,a:n,b:a}=gp(t),u=Math.atan2(a,n)*Z_;return{h:u<0?u+360:u,c:Math.sqrt(n*n+a*a),l:e,alpha:t.a}},reverse:function(t){const e=t.h*q_,n=t.c;return da({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:_p(t.h,e.h,n),c:Mi(t.c,e.c,n),l:Mi(t.l,e.l,n),alpha:Mi(t.alpha,e.alpha,n)}}};var yp=Object.freeze({__proto__:null,hcl:Co,lab:tl});class au{constructor(e,n,a,u,d){this.type=e,this.operator=n,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(const[p,y]of d)this.labels.push(p),this.outputs.push(y)}static interpolationFactor(e,n,a,u){let d=0;if(e.name==="exponential")d=Vs(n,e.base,a,u);else if(e.name==="linear")d=Vs(n,1,a,u);else if(e.name==="cubic-bezier"){const p=e.controlPoints;d=new Ye(p[0],p[1],p[2],p[3]).solve(Vs(n,1,a,u))}return d}static parse(e,n){let[a,u,d,...p]=e;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const T=u[1];if(typeof T!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:T}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const T=u.slice(1);if(T.length!==4||T.some(E=>typeof E!="number"||E<0||E>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(d=n.parse(d,2,et),!d)return null;const y=[];let b=null;a==="interpolate-hcl"||a==="interpolate-lab"?b=os:n.expectedType&&n.expectedType.kind!=="value"&&(b=n.expectedType);for(let T=0;T<p.length;T+=2){const E=p[T],I=p[T+1],C=T+3,D=T+4;if(typeof E!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(y.length&&y[y.length-1][0]>=E)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',C);const R=n.parse(I,D,b);if(!R)return null;b=b||R.type,y.push([E,R])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new au(b,a,u,d,y):n.error(`Type ${an(b)} is not interpolatable.`)}evaluate(e){const n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return a[0].evaluate(e);const d=n.length;if(u>=n[d-1])return a[d-1].evaluate(e);const p=su(n,u),y=au.interpolationFactor(this.interpolation,u,n[p],n[p+1]),b=a[p].evaluate(e),T=a[p+1].evaluate(e);return this.operator==="interpolate"?Ul[this.type.kind.toLowerCase()](b,T,y):this.operator==="interpolate-hcl"?Co.reverse(Co.interpolate(Co.forward(b),Co.forward(T),y)):tl.reverse(tl.interpolate(tl.forward(b),tl.forward(T),y))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)n.push(this.labels[a],this.outputs[a].serialize());return n}}function Vs(t,e,n,a){const u=a-n,d=t-n;return u===0?0:e===1?d/u:(Math.pow(e,d)-1)/(Math.pow(e,u)-1)}var Ss=au;class Po{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let a=null;const u=n.expectedType;u&&u.kind!=="value"&&(a=u);const d=[];for(const y of e.slice(1)){const b=n.parse(y,1+d.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,d.push(b)}const p=u&&d.some(y=>ra(u,y.type));return new Po(p?ki:a,d)}evaluate(e){let n,a=null,u=0;for(const d of this.args){if(u++,a=d.evaluate(e),a&&a instanceof as&&!a.available&&(n||(n=a),a=null,u===this.args.length))return n;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var xp=Po;class Xh{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let d=1;d<e.length-1;d+=2){const p=e[d];if(typeof p!="string")return n.error(`Expected string, but found ${typeof p} instead.`,d);if(/[^a-zA-Z0-9_]/.test(p))return n.error("Variable names must contain only alphanumeric characters or '_'.",d);const y=n.parse(e[d+1],d+1);if(!y)return null;a.push([p,y])}const u=n.parse(e[e.length-1],e.length-1,n.expectedType,a);return u?new Xh(a,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,a]of this.bindings)e.push(n,a.serialize());return e.push(this.result.serialize()),e}}var vp=Xh;class Yh{constructor(e,n,a){this.type=e,this.index=n,this.input=a}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,et),u=n.parse(e[2],2,Pr(n.expectedType||ki));return a&&u?new Yh(u.type.itemType,a,u):null}evaluate(e){const n=this.index.evaluate(e),a=this.input.evaluate(e);if(n<0)throw new Gn(`Array index out of bounds: ${n} < 0.`);if(n>=a.length)throw new Gn(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n!==Math.floor(n))throw new Gn(`Array index must be an integer, but found ${n} instead.`);return a[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var X_=Yh;class lu{constructor(e,n){this.type=Oi,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,ki),u=n.parse(e[2],2,ki);return a&&u?xh(a.type,[Oi,Li,et,ia,ki])?new lu(a,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${an(a.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!sa(n,["boolean","string","number","null"]))throw new Gn(`Expected first argument to be of type boolean, string, number or null, but found ${an(tr(n))} instead.`);if(!sa(a,["string","array"]))throw new Gn(`Expected second argument to be of type array or string, but found ${an(tr(a))} instead.`);return a.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Kh=lu;class fa{constructor(e,n,a){this.type=et,this.needle=e,this.haystack=n,this.fromIndex=a}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,ki),u=n.parse(e[2],2,ki);if(!a||!u)return null;if(!xh(a.type,[Oi,Li,et,ia,ki]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${an(a.type)} instead`);if(e.length===4){const d=n.parse(e[3],3,et);return d?new fa(a,u,d):null}return new fa(a,u)}evaluate(e){const n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!sa(n,["boolean","string","number","null"]))throw new Gn(`Expected first argument to be of type boolean, string, number or null, but found ${an(tr(n))} instead.`);if(!sa(a,["string","array"]))throw new Gn(`Expected second argument to be of type array or string, but found ${an(tr(a))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return a.indexOf(n,u)}return a.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var bp=fa;class Hl{constructor(e,n,a,u,d,p){this.inputType=e,this.type=n,this.input=a,this.cases=u,this.outputs=d,this.otherwise=p}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let a,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);const d={},p=[];for(let T=2;T<e.length-1;T+=2){let E=e[T];const I=e[T+1];Array.isArray(E)||(E=[E]);const C=n.concat(T);if(E.length===0)return C.error("Expected at least one branch label.");for(const R of E){if(typeof R!="number"&&typeof R!="string")return C.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return C.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return C.error("Numeric branch labels must be integer values.");if(a){if(C.checkSubtype(a,tr(R)))return null}else a=tr(R);if(d[String(R)]!==void 0)return C.error("Branch labels must be unique.");d[String(R)]=p.length}const D=n.parse(I,T,u);if(!D)return null;u=u||D.type,p.push(D)}const y=n.parse(e[1],1,ki);if(!y)return null;const b=n.parse(e[e.length-1],e.length-1,u);return b?y.type.kind!=="value"&&n.concat(1).checkSubtype(a,y.type)?null:new Hl(a,u,y,d,p,b):null}evaluate(e){const n=this.input.evaluate(e);return(tr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),a=[],u={};for(const p of n){const y=u[this.cases[p]];y===void 0?(u[this.cases[p]]=a.length,a.push([this.cases[p],[p]])):a[y][1].push(p)}const d=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,y]of a)e.push(y.length===1?d(y[0]):y.map(d)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}var Y_=Hl;class ls{constructor(e,n,a){this.type=e,this.branches=n,this.otherwise=a}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);const u=[];for(let p=1;p<e.length-1;p+=2){const y=n.parse(e[p],p,Oi);if(!y)return null;const b=n.parse(e[p+1],p+1,a);if(!b)return null;u.push([y,b]),a=a||b.type}const d=n.parse(e[e.length-1],e.length-1,a);return d?new ls(a,u,d):null}evaluate(e){for(const[n,a]of this.branches)if(n.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,a]of this.branches)e(n),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var K_=ls;class Wl{constructor(e,n,a,u){this.type=e,this.input=n,this.beginIndex=a,this.endIndex=u}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,ki),u=n.parse(e[2],2,et);if(!a||!u)return null;if(!xh(a.type,[Pr(ki),Li,ki]))return n.error(`Expected first argument to be of type array or string, but found ${an(a.type)} instead`);if(e.length===4){const d=n.parse(e[3],3,et);return d?new Wl(a.type,a,u,d):null}return new Wl(a.type,a,u)}evaluate(e){const n=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!sa(n,["string","array"]))throw new Gn(`Expected first argument to be of type array or string, but found ${an(tr(n))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return n.slice(a,u)}return n.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var J_=Wl;function wp(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Tp(t,e,n,a){return a.compare(e,n)===0}function il(t,e,n){const a=t!=="=="&&t!=="!=";return class xI{constructor(d,p,y){this.type=Oi,this.lhs=d,this.rhs=p,this.collator=y,this.hasUntypedArgument=d.type.kind==="value"||p.type.kind==="value"}static parse(d,p){if(d.length!==3&&d.length!==4)return p.error("Expected two or three arguments.");const y=d[0];let b=p.parse(d[1],1,ki);if(!b)return null;if(!wp(y,b.type))return p.concat(1).error(`"${y}" comparisons are not supported for type '${an(b.type)}'.`);let T=p.parse(d[2],2,ki);if(!T)return null;if(!wp(y,T.type))return p.concat(2).error(`"${y}" comparisons are not supported for type '${an(T.type)}'.`);if(b.type.kind!==T.type.kind&&b.type.kind!=="value"&&T.type.kind!=="value")return p.error(`Cannot compare types '${an(b.type)}' and '${an(T.type)}'.`);a&&(b.type.kind==="value"&&T.type.kind!=="value"?b=new Ts(T.type,[b]):b.type.kind!=="value"&&T.type.kind==="value"&&(T=new Ts(b.type,[T])));let E=null;if(d.length===4){if(b.type.kind!=="string"&&T.type.kind!=="string"&&b.type.kind!=="value"&&T.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(E=p.parse(d[3],3,na),!E)return null}return new xI(b,T,E)}evaluate(d){const p=this.lhs.evaluate(d),y=this.rhs.evaluate(d);if(a&&this.hasUntypedArgument){const b=tr(p),T=tr(y);if(b.kind!==T.kind||b.kind!=="string"&&b.kind!=="number")throw new Gn(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${b.kind}, ${T.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=tr(p),T=tr(y);if(b.kind!=="string"||T.kind!=="string")return e(d,p,y)}return this.collator?n(d,p,y,this.collator.evaluate(d)):e(d,p,y)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[t];return this.eachChild(p=>{d.push(p.serialize())}),d}}}const Mp=il("==",function(t,e,n){return e===n},Tp),Jh=il("!=",function(t,e,n){return e!==n},function(t,e,n,a){return!Tp(0,e,n,a)}),Sp=il("<",function(t,e,n){return e<n},function(t,e,n,a){return a.compare(e,n)<0}),Q_=il(">",function(t,e,n){return e>n},function(t,e,n,a){return a.compare(e,n)>0}),Gr=il("<=",function(t,e,n){return e<=n},function(t,e,n,a){return a.compare(e,n)<=0}),$_=il(">=",function(t,e,n){return e>=n},function(t,e,n,a){return a.compare(e,n)>=0});class Qh{constructor(e,n,a,u,d,p){this.type=Li,this.number=e,this.locale=n,this.currency=a,this.unit=u,this.minFractionDigits=d,this.maxFractionDigits=p}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const a=n.parse(e[1],1,et);if(!a)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let d=null;if(u.locale&&(d=n.parse(u.locale,1,Li),!d))return null;let p=null;if(u.currency&&(p=n.parse(u.currency,1,Li),!p))return null;let y=null;if(u.unit&&(y=n.parse(u.unit,1,Li),!y))return null;let b=null;if(u["min-fraction-digits"]&&(b=n.parse(u["min-fraction-digits"],1,et),!b))return null;let T=null;return u["max-fraction-digits"]&&(T=n.parse(u["max-fraction-digits"],1,et),!T)?null:new Qh(a,d,p,y,b,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class $h{constructor(e){this.type=et,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=n.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${an(a.type)} instead.`):new $h(a):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Gn(`Expected value to be of type string or array, but found ${an(tr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function ql(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const ed={"==":Mp,"!=":Jh,">":Q_,"<":Sp,">=":$_,"<=":Gr,array:Ts,at:X_,boolean:Ts,case:K_,coalesce:xp,collator:Fl,format:Ol,image:Bl,in:Kh,"index-of":bp,interpolate:Ss,"interpolate-hcl":Ss,"interpolate-lab":Ss,length:$h,let:vp,literal:Ja,match:Y_,number:Ts,"number-format":Qh,object:Ts,slice:J_,step:Gh,string:Ts,"to-boolean":So,"to-color":So,"to-number":So,"to-string":So,var:fp,within:Zc,distance:Vh};function cu(t,[e,n,a,u]){e=e.evaluate(t),n=n.evaluate(t),a=a.evaluate(t);const d=u?u.evaluate(t):1,p=ip(e,n,a,d);if(p)throw new Gn(p);return new _n(e/255*d,n/255*d,a/255*d,d)}function Ep(t,[e,n,a,u]){e=e.evaluate(t),n=n.evaluate(t),a=a.evaluate(t);const d=u?u.evaluate(t):1,p=function(T,E,I,C){return typeof T=="number"&&T>=0&&T<=360?typeof E=="number"&&E>=0&&E<=100&&typeof I=="number"&&I>=0&&I<=100?C===void 0||typeof C=="number"&&C>=0&&C<=1?null:`Invalid hsla value [${[T,E,I,C].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof C=="number"?[T,E,I,C]:[T,E,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof C=="number"?[T,E,I,C]:[T,E,I]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,a,d);if(p)throw new Gn(p);const y=`hsla(${e}, ${n}%, ${a}%, ${d})`,b=_n.parse(y);if(!b)throw new Gn(`Failed to parse HSLA color: ${y}`);return b}function Ap(t,e){return t in e}function pa(t,e){const n=e[t];return n===void 0?null:n}function Ip(t,e){switch(t){case"string":return String(e);case"number":return+e;case"boolean":return!!e;case"color":return _n.parse(e)}return e}function kp(t,e,n,a){return a!==void 0&&(t=a*Math.round(t/a)),e!==void 0&&t<e&&(t=e),n!==void 0&&t>n&&(t=n),t}function td(t,e,n){e=[e,n,t.scope].filter(Boolean).join("");const a=t.getConfig(e);if(!a)return null;const{type:u,value:d,values:p,minValue:y,maxValue:b,stepValue:T}=a,E=a.default.evaluate(t);let I=E;if(d){const C=t.scope;t.scope=(C||"").split("").slice(1).join(""),I=d.evaluate(t),t.scope=C}return u&&(I=Ip(u,I)),d!==void 0&&I!==void 0&&p&&!p.includes(I)&&(I=E,u&&(I=Ip(u,I))),I===void 0||y===void 0&&b===void 0&&T===void 0||(typeof I=="number"?I=kp(I,y,b,T):Array.isArray(I)&&(I=I.map(C=>typeof C=="number"?kp(C,y,b,T):C))),I}function Do(t){return{type:t}}Ms.register(ed,{error:[{kind:"error"},[Li],(t,[e])=>{throw new Gn(e.evaluate(t))}],typeof:[Li,[ki],(t,[e])=>an(tr(e.evaluate(t)))],"to-rgba":[Pr(et,4),[os],(t,[e])=>e.evaluate(t).toArray()],rgb:[os,[et,et,et],cu],rgba:[os,[et,et,et,et],cu],hsl:[os,[et,et,et],Ep],hsla:[os,[et,et,et,et],Ep],has:{type:Oi,overloads:[[[Li],(t,[e])=>Ap(e.evaluate(t),t.properties())],[[Li,Za],(t,[e,n])=>Ap(e.evaluate(t),n.evaluate(t))]]},get:{type:ki,overloads:[[[Li],(t,[e])=>pa(e.evaluate(t),t.properties())],[[Li,Za],(t,[e,n])=>pa(e.evaluate(t),n.evaluate(t))]]},config:{type:ki,overloads:[[[Li],(t,[e])=>td(t,e.evaluate(t))],[[Li,Li],(t,[e,n])=>td(t,e.evaluate(t),n.evaluate(t))]]},"feature-state":[ki,[Li],(t,[e])=>pa(e.evaluate(t),t.featureState||{})],properties:[Za,[],t=>t.properties()],"geometry-type":[Li,[],t=>t.geometryType()],id:[ki,[],t=>t.id()],zoom:[et,[],t=>t.globals.zoom],pitch:[et,[],t=>t.globals.pitch||0],"distance-from-center":[et,[],t=>t.distanceFromCenter()],"measure-light":[et,[Li],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[et,[],t=>t.globals.heatmapDensity||0],"line-progress":[et,[],t=>t.globals.lineProgress||0],"raster-value":[et,[],t=>t.globals.rasterValue||0],"sky-radial-progress":[et,[],t=>t.globals.skyRadialProgress||0],accumulated:[ki,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[et,Do(et),(t,e)=>{let n=0;for(const a of e)n+=a.evaluate(t);return n}],"*":[et,Do(et),(t,e)=>{let n=1;for(const a of e)n*=a.evaluate(t);return n}],"-":{type:et,overloads:[[[et,et],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[et],(t,[e])=>-e.evaluate(t)]]},"/":[et,[et,et],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[et,[et,et],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[et,[],()=>Math.LN2],pi:[et,[],()=>Math.PI],e:[et,[],()=>Math.E],"^":[et,[et,et],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[et,[et],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[et,[et],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[et,[et],(t,[e])=>Math.log(e.evaluate(t))],log2:[et,[et],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[et,[et],(t,[e])=>Math.sin(e.evaluate(t))],cos:[et,[et],(t,[e])=>Math.cos(e.evaluate(t))],tan:[et,[et],(t,[e])=>Math.tan(e.evaluate(t))],asin:[et,[et],(t,[e])=>Math.asin(e.evaluate(t))],acos:[et,[et],(t,[e])=>Math.acos(e.evaluate(t))],atan:[et,[et],(t,[e])=>Math.atan(e.evaluate(t))],min:[et,Do(et),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[et,Do(et),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[et,[et],(t,[e])=>Math.abs(e.evaluate(t))],round:[et,[et],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[et,[et],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[et,[et],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Oi,[Li,ki],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[Oi,[ki],(t,[e])=>t.id()===e.value],"filter-type-==":[Oi,[Li],(t,[e])=>t.geometryType()===e.value],"filter-<":[Oi,[Li,ki],(t,[e,n])=>{const a=t.properties()[e.value],u=n.value;return typeof a==typeof u&&a<u}],"filter-id-<":[Oi,[ki],(t,[e])=>{const n=t.id(),a=e.value;return typeof n==typeof a&&n<a}],"filter->":[Oi,[Li,ki],(t,[e,n])=>{const a=t.properties()[e.value],u=n.value;return typeof a==typeof u&&a>u}],"filter-id->":[Oi,[ki],(t,[e])=>{const n=t.id(),a=e.value;return typeof n==typeof a&&n>a}],"filter-<=":[Oi,[Li,ki],(t,[e,n])=>{const a=t.properties()[e.value],u=n.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[Oi,[ki],(t,[e])=>{const n=t.id(),a=e.value;return typeof n==typeof a&&n<=a}],"filter->=":[Oi,[Li,ki],(t,[e,n])=>{const a=t.properties()[e.value],u=n.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[Oi,[ki],(t,[e])=>{const n=t.id(),a=e.value;return typeof n==typeof a&&n>=a}],"filter-has":[Oi,[ki],(t,[e])=>e.value in t.properties()],"filter-has-id":[Oi,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Oi,[Pr(Li)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Oi,[Pr(ki)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Oi,[Li,Pr(ki)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Oi,[Li,Pr(ki)],(t,[e,n])=>function(a,u,d,p){for(;d<=p;){const y=d+p>>1;if(u[y]===a)return!0;u[y]>a?p=y-1:d=y+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Oi,overloads:[[[Oi,Oi],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[Do(Oi),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Oi,overloads:[[[Oi,Oi],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[Do(Oi),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Oi,[Oi],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Oi,[Li],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Li,[Li],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Li,[Li],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Li,Do(ki),(t,e)=>e.map(n=>Rl(n.evaluate(t))).join("")],"resolved-locale":[Li,[na],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[et,[et,et,ki],(t,e)=>{const[n,a,u]=e.map(p=>p.evaluate(t));if(n>a||n===a)return n;let d;if(typeof u=="string")d=function(p){let y=0;if(p.length===0)return y;for(let b=0;b<p.length;b++)y=(y<<5)-y+p.charCodeAt(b),y&=y;return y}(u);else{if(typeof u!="number")throw new Gn(`Invalid seed input: ${u}`);d=u}return n+ql(d)()*(a-n)}]});var Zl=ed;function cs(t){return{result:"success",value:t}}function zo(t){return{result:"error",value:t}}function Cp(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function Lo(t){return t["property-type"]==="data-driven"}function Xl(t){return Cp(t.expression,"measure-light")}function id(t){return Cp(t.expression,"zoom")}function nd(t){return!!t.expression&&t.expression.interpolated}function uu(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function ey(t){return t}function Pp(t,e){const n=e.type==="color",a=t.stops&&typeof t.stops[0][0]=="object",u=a||!(a||t.property!==void 0),d=t.type||(nd(e)?"exponential":"interval");if(n&&((t=bs({},t)).stops&&(t.stops=t.stops.map(T=>[T[0],_n.parse(T[1])])),t.default=_n.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!yp[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let p,y,b;if(d==="exponential")p=Yl;else if(d==="interval")p=is;else if(d==="categorical"){p=hu,y=Object.create(null);for(const T of t.stops)y[T[0]]=T[1];b=typeof t.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);p=ty}if(a){const T={},E=[];for(let D=0;D<t.stops.length;D++){const R=t.stops[D],B=R[0].zoom;T[B]===void 0&&(T[B]={zoom:B,type:t.type,property:t.property,default:t.default,stops:[]},E.push(B)),T[B].stops.push([R[0].value,R[1]])}const I=[];for(const D of E)I.push([T[D].zoom,Pp(T[D],e)]);const C={name:"linear"};return{kind:"composite",interpolationType:C,interpolationFactor:Ss.interpolationFactor.bind(void 0,C),zoomStops:I.map(D=>D[0]),evaluate:({zoom:D},R)=>Yl({stops:I,base:t.base},e,D).evaluate(D,R)}}if(u){const T=d==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:Ss.interpolationFactor.bind(void 0,T),zoomStops:t.stops.map(E=>E[0]),evaluate:({zoom:E})=>p(t,e,E,y,b)}}return{kind:"source",evaluate(T,E){const I=E&&E.properties?E.properties[t.property]:void 0;return I===void 0?Ro(t.default,e.default):p(t,e,I,y,b)}}}function Ro(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function hu(t,e,n,a,u){return Ro(typeof n===u?a[n]:void 0,t.default,e.default)}function is(t,e,n){if(Wi(n)!=="number")return Ro(t.default,e.default);const a=t.stops.length;if(a===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[a-1][0])return t.stops[a-1][1];const u=su(t.stops.map(d=>d[0]),n);return t.stops[u][1]}function Yl(t,e,n){const a=t.base!==void 0?t.base:1;if(Wi(n)!=="number")return Ro(t.default,e.default);const u=t.stops.length;if(u===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[u-1][0])return t.stops[u-1][1];const d=su(t.stops.map(E=>E[0]),n),p=function(E,I,C,D){const R=D-C,B=E-C;return R===0?0:I===1?B/R:(Math.pow(I,B)-1)/(Math.pow(I,R)-1)}(n,a,t.stops[d][0],t.stops[d+1][0]),y=t.stops[d][1],b=t.stops[d+1][1];let T=Ul[e.type]||ey;if(t.colorSpace&&t.colorSpace!=="rgb"){const E=yp[t.colorSpace];T=(I,C)=>E.reverse(E.interpolate(E.forward(I),E.forward(C),p))}return typeof y.evaluate=="function"?{evaluate(...E){const I=y.evaluate.apply(void 0,E),C=b.evaluate.apply(void 0,E);if(I!==void 0&&C!==void 0)return T(I,C,p)}}:T(y,b,p)}function ty(t,e,n){return e.type==="color"?n=_n.parse(n):e.type==="formatted"?n=zr.fromString(n.toString()):e.type==="resolvedImage"?n=as.fromString(n.toString()):Wi(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),Ro(n,t.default,e.default)}class rd{constructor(e,n,a,u){this.expression=e,this._warningHistory={},this._evaluator=new Eh(a,u),this._defaultValue=n?function(d){return d.type==="color"&&(uu(d.default)||Array.isArray(d.default))?new _n(0,0,0,0):d.type==="color"?_n.parse(d.default)||null:d.default===void 0?null:d.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,a,u,d,p,y,b){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=u||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,a,u,d,p,y,b){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Gn(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function du(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Zl}function Kl(t,e,n,a){const u=new jh(Zl,[],e?function(p){const y={color:os,string:Li,number:et,enum:Li,boolean:Oi,formatted:Mo,resolvedImage:Ll};return p.type==="array"?Pr(y[p.value]||ki,p.length):y[p.type]}(e):void 0,void 0,void 0,n,a),d=u.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?cs(new rd(d,e,n,a)):zo(u.errors)}class Jl{constructor(e,n,a){this.kind=e,this._styleExpression=n,this.isLightConstant=a,this.isStateDependent=e!=="constant"&&!gr(n.expression),this.isConfigDependent=!jl(n.expression)}evaluateWithoutErrorHandling(e,n,a,u,d,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,u,d,p)}evaluate(e,n,a,u,d,p){return this._styleExpression.evaluate(e,n,a,u,d,p)}}class Ql{constructor(e,n,a,u,d){this.kind=e,this.zoomStops=a,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!gr(n.expression),this.isLightConstant=d,this.isConfigDependent=!jl(n.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,n,a,u,d,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,u,d,p)}evaluate(e,n,a,u,d,p){return this._styleExpression.evaluate(e,n,a,u,d,p)}interpolationFactor(e,n,a){return this.interpolationType?Ss.interpolationFactor(this.interpolationType,e,n,a):0}}function $l(t,e,n,a){if((t=Kl(t,e,n,a)).result==="error")return t;const u=t.value.expression,d=Qa(u);if(!d&&!Lo(e))return zo([new ws("","data expressions not supported")]);const p=ua(u,["zoom","pitch","distance-from-center"]);if(!p&&!id(e))return zo([new ws("","zoom expressions not supported")]);const y=ua(u,["measure-light"]);if(!y&&!Xl(e))return zo([new ws("","measure-light expression not supported")]);const b=e.expression&&e.expression.relaxZoomRestriction,T=pu(u);return T||p||b?T instanceof ws?zo([T]):T instanceof Ss&&!nd(e)?zo([new ws("",'"interpolate" expressions cannot be used with this property')]):cs(T?new Ql(d?"camera":"composite",t.value,T.labels,T instanceof Ss?T.interpolation:void 0,y):new Jl(d?"constant":"source",t.value,y)):zo([new ws("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class fu{constructor(e,n){this._parameters=e,this._specification=n,bs(this,Pp(this._parameters,this._specification))}static deserialize(e){return new fu(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function pu(t){let e=null;if(t instanceof vp)e=pu(t.result);else if(t instanceof xp){for(const n of t.args)if(e=pu(n),e)break}else(t instanceof Gh||t instanceof Ss)&&t.input instanceof Ms&&t.input.name==="zoom"&&(e=t);return e instanceof ws||t.eachChild(n=>{const a=pu(n);a instanceof ws?e=a:e&&a&&e!==a&&(e=new ws("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Hr(t){const e=t.key,n=t.value,a=t.valueSpec||{},u=t.objectElementValidators||{},d=t.style,p=t.styleSpec;let y=[];const b=Wi(n);if(b!=="object")return[new Ut(e,n,`object expected, ${b} found`)];for(const T in n){const E=T.split(".")[0];let I;u[E]?I=u[E]:a[E]?I=ir:u["*"]?I=u["*"]:a["*"]&&(I=ir),I?y=y.concat(I({key:(e&&`${e}.`)+T,value:n[T],valueSpec:a[E]||a["*"],style:d,styleSpec:p,object:n,objectKey:T},n)):y.push(new Fs(e,n[T],`unknown property "${T}"`))}for(const T in a)u[T]||a[T].required&&a[T].default===void 0&&n[T]===void 0&&y.push(new Ut(e,n,`missing required property "${T}"`));return y}function Dp(t){const e=t.value,n=t.valueSpec,a=t.style,u=t.styleSpec,d=t.key,p=t.arrayElementValidator||ir;if(Wi(e)!=="array")return[new Ut(d,e,`array expected, ${Wi(e)} found`)];if(n.length&&e.length!==n.length)return[new Ut(d,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Ut(d,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let y={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};u.$version<7&&(y.function=n.function),Wi(n.value)==="object"&&(y=n.value);let b=[];for(let T=0;T<e.length;T++)b=b.concat(p({array:e,arrayIndex:T,value:e[T],valueSpec:y,style:a,styleSpec:u,key:`${d}[${T}]`},!0));return b}function sd(t){const e=t.key,n=t.value,a=t.valueSpec;let u=Wi(n);if(u==="number"&&n!=n&&(u="NaN"),u!=="number")return[new Ut(e,n,`number expected, ${u} found`)];if("minimum"in a){let d=a.minimum;if(Wi(a.minimum)==="array"&&(d=a.minimum[t.arrayIndex]),n<d)return[new Ut(e,n,`${n} is less than the minimum value ${d}`)]}if("maximum"in a){let d=a.maximum;if(Wi(a.maximum)==="array"&&(d=a.maximum[t.arrayIndex]),n>d)return[new Ut(e,n,`${n} is greater than the maximum value ${d}`)]}return[]}function od(t){const e=t.valueSpec,n=Un(t.value.type);let a,u,d,p={};const y=n!=="categorical"&&t.value.property===void 0,b=!y,T=Wi(t.value.stops)==="array"&&Wi(t.value.stops[0])==="array"&&Wi(t.value.stops[0][0])==="object",E=Hr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(D){if(n==="identity")return[new Ut(D.key,D.value,'identity function may not have a "stops" property')];let R=[];const B=D.value;return R=R.concat(Dp({key:D.key,value:B,valueSpec:D.valueSpec,style:D.style,styleSpec:D.styleSpec,arrayElementValidator:I})),Wi(B)==="array"&&B.length===0&&R.push(new Ut(D.key,B,"array must have at least one stop")),R},default:function(D){return ir({key:D.key,value:D.value,valueSpec:e,style:D.style,styleSpec:D.styleSpec})}}});return n==="identity"&&y&&E.push(new Ut(t.key,t.value,'missing required property "property"')),n==="identity"||t.value.stops||E.push(new Ut(t.key,t.value,'missing required property "stops"')),n==="exponential"&&t.valueSpec.expression&&!nd(t.valueSpec)&&E.push(new Ut(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(b&&!Lo(t.valueSpec)?E.push(new Ut(t.key,t.value,"property functions not supported")):y&&!id(t.valueSpec)&&E.push(new Ut(t.key,t.value,"zoom functions not supported"))),n!=="categorical"&&!T||t.value.property!==void 0||E.push(new Ut(t.key,t.value,'"property" property is required')),E;function I(D){let R=[];const B=D.value,V=D.key;if(Wi(B)!=="array")return[new Ut(V,B,`array expected, ${Wi(B)} found`)];if(B.length!==2)return[new Ut(V,B,`array length 2 expected, length ${B.length} found`)];if(T){if(Wi(B[0])!=="object")return[new Ut(V,B,`object expected, ${Wi(B[0])} found`)];if(B[0].zoom===void 0)return[new Ut(V,B,"object stop key must have zoom")];if(B[0].value===void 0)return[new Ut(V,B,"object stop key must have value")];const G=Un(B[0].zoom);if(typeof G!="number")return[new Ut(V,B[0].zoom,"stop zoom values must be numbers")];if(d&&d>G)return[new Ut(V,B[0].zoom,"stop zoom values must appear in ascending order")];G!==d&&(d=G,u=void 0,p={}),R=R.concat(Hr({key:`${V}[0]`,value:B[0],valueSpec:{zoom:{}},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{zoom:sd,value:C}}))}else R=R.concat(C({key:`${V}[0]`,value:B[0],valueSpec:{},style:D.style,styleSpec:D.styleSpec},B));return du(to(B[1]))?R.concat([new Ut(`${V}[1]`,B[1],"expressions are not allowed in function stops.")]):R.concat(ir({key:`${V}[1]`,value:B[1],valueSpec:e,style:D.style,styleSpec:D.styleSpec}))}function C(D,R){const B=Wi(D.value),V=Un(D.value),G=D.value!==null?D.value:R;if(a){if(B!==a)return[new Ut(D.key,G,`${B} stop domain type must match previous stop domain type ${a}`)]}else a=B;if(B!=="number"&&B!=="string"&&B!=="boolean"&&typeof V!="number"&&typeof V!="string"&&typeof V!="boolean")return[new Ut(D.key,G,"stop domain value must be a number, string, or boolean")];if(B!=="number"&&n!=="categorical"){let $=`number expected, ${B} found`;return Lo(e)&&n===void 0&&($+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ut(D.key,G,$)]}return n!=="categorical"||B!=="number"||typeof V=="number"&&isFinite(V)&&Math.floor(V)===V?n!=="categorical"&&B==="number"&&typeof V=="number"&&typeof u=="number"&&u!==void 0&&V<u?[new Ut(D.key,G,"stop domain values must appear in ascending order")]:(u=V,n==="categorical"&&V in p?[new Ut(D.key,G,"stop domain values must be unique")]:(p[V]=!0,[])):[new Ut(D.key,G,`integer expected, found ${String(V)}`)]}}function ma(t){const e=(t.expressionContext==="property"?$l:Kl)(to(t.value),t.valueSpec);if(e.result==="error")return e.value.map(a=>new Ut(`${t.key}${a.key}`,t.value,a.message));const n=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!n.outputDefined())return[new Ut(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!gr(n))return[new Ut(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return mu(n,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!ua(n,["zoom","feature-state"]))return[new Ut(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Qa(n))return[new Ut(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function mu(t,e){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const u of e.valueSpec.expression.parameters)n.delete(u);if(n.size===0)return[];const a=[];return t instanceof Ms&&n.has(t.name)?[new Ut(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(u=>{a.push(...mu(u,e))}),a)}function ga(t){const e=t.key,n=t.value,a=t.valueSpec,u=[];return Array.isArray(a.values)?a.values.indexOf(Un(n))===-1&&u.push(new Ut(e,n,`expected one of [${a.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(a.values).indexOf(Un(n))===-1&&u.push(new Ut(e,n,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(n)} found`)),u}function gu(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!gu(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function _u(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};gu(t)||(t=yu(t));const n=t;let a=!0;try{a=function(T){if(!Oo(T))return T;let E=to(T);return zp(E),E=ad(E),E}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}const u=De[`filter_${e}`],d=Kl(a,u);let p=null;if(d.result==="error")throw new Error(d.value.map(T=>`${T.key}: ${T.message}`).join(", "));p=(T,E,I)=>d.value.evaluate(T,E,{},I);let y=null,b=null;if(a!==n){const T=Kl(n,u);if(T.result==="error")throw new Error(T.value.map(E=>`${E.key}: ${E.message}`).join(", "));y=(E,I,C,D,R)=>T.value.evaluate(E,I,{},C,void 0,void 0,D,R),b=!Qa(T.value.expression)}return{filter:p,dynamicFilter:y||void 0,needGeometry:Lp(a),needFeature:!!b}}function ad(t){if(!Array.isArray(t))return t;const e=function(n){if(iy.has(n[0])){for(let a=1;a<n.length;a++)if(Oo(n[a]))return!0}return n}(t);return e===!0?e:e.map(n=>ad(n))}function zp(t){let e=!1;const n=[];if(t[0]==="case"){for(let a=1;a<t.length-1;a+=2)e=e||Oo(t[a]),n.push(t[a+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||Oo(t[1]);for(let a=2;a<t.length-1;a+=2)n.push(t[a+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||Oo(t[1]);for(let a=1;a<t.length-1;a+=2)n.push(t[a+1])}e&&(t.length=0,t.push("any",...n));for(let a=1;a<t.length;a++)zp(t[a])}function Oo(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(Oo(t[n]))return!0;return!1}const iy=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ny(t,e){return t<e?-1:t>e?1:0}function Lp(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(Lp(t[e]))return!0;return!1}function yu(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?xu(t[1],t[2],"=="):e==="!="?vu(xu(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?xu(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(yu))):e==="all"?["all"].concat(t.slice(1).map(yu)):e==="none"?["all"].concat(t.slice(1).map(yu).map(vu)):e==="in"?Rp(t[1],t.slice(2)):e==="!in"?vu(Rp(t[1],t.slice(2))):e==="has"?Op(t[1]):e!=="!has"||vu(Op(t[1]));var n}function xu(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function Rp(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(ny)]]:["filter-in-small",t,["literal",e]]}}function Op(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function vu(t){return["!",t]}function ld(t){return gu(to(t.value))?ma(bs({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):Bp(t)}function Bp(t){const e=t.value,n=t.key;if(Wi(e)!=="array")return[new Ut(n,e,`array expected, ${Wi(e)} found`)];const a=t.styleSpec;let u,d=[];if(e.length<1)return[new Ut(n,e,"filter array must have at least 1 element")];switch(d=d.concat(ga({key:`${n}[0]`,value:e[0],valueSpec:a.filter_operator,style:t.style,styleSpec:t.styleSpec})),Un(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Un(e[1])==="$type"&&d.push(new Ut(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new Ut(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=Wi(e[1]),u!=="string"&&d.push(new Ut(`${n}[1]`,e[1],`string expected, ${u} found`)));for(let p=2;p<e.length;p++)u=Wi(e[p]),Un(e[1])==="$type"?d=d.concat(ga({key:`${n}[${p}]`,value:e[p],valueSpec:a.geometry_type,style:t.style,styleSpec:t.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&d.push(new Ut(`${n}[${p}]`,e[p],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)d=d.concat(Bp({key:`${n}[${p}]`,value:e[p],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":u=Wi(e[1]),e.length!==2?d.push(new Ut(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&d.push(new Ut(`${n}[1]`,e[1],`string expected, ${u} found`))}return d}function Fp(t,e){const n=t.key,a=t.style,u=t.layer,d=t.styleSpec,p=t.value,y=t.objectKey,b=d[`${e}_${t.layerType}`];if(!b)return[];const T=y.match(/^(.*)-transition$/);if(e==="paint"&&T&&b[T[1]]&&b[T[1]].transition)return ir({key:n,value:p,valueSpec:d.transition,style:a,styleSpec:d});const E=t.valueSpec||b[y];if(!E)return[new Fs(n,p,`unknown property "${y}"`)];let I;if(Wi(p)==="string"&&Lo(E)&&!E.tokens&&(I=/^{([^}]+)}$/.exec(p))){const D=`\`{ "type": "identity", "property": ${I?JSON.stringify(I[1]):'"_"'} }\``;return[new Ut(n,p,`"${y}" does not support interpolation syntax
Use an identity property function instead: ${D}.`)]}const C=[];if(t.layerType==="symbol")y!=="text-field"||!a||a.glyphs||a.imports||C.push(new Ut(n,p,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&uu(to(p))&&Un(p.type)==="identity"&&C.push(new Ut(n,p,'"text-font" does not support identity functions'));else if(t.layerType==="model"&&e==="paint"&&u&&u.layout&&u.layout.hasOwnProperty("model-id")&&Lo(E)&&(Xl(E)||id(E))){const D=$l(to(p),E),R=D.value.expression||D.value._styleExpression.expression;R&&!ua(R,["measure-light"])&&(y==="model-emissive-strength"&&Qa(R)&&gr(R)||C.push(new Ut(n,p,`${y} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return C.concat(ir({key:t.key,value:p,valueSpec:E,style:a,styleSpec:d,expressionContext:"property",propertyType:e,propertyKey:y}))}function Np(t){return Fp(t,"paint")}function ec(t){return Fp(t,"layout")}function Vp(t){let e=[];const n=t.value,a=t.key,u=t.style,d=t.styleSpec;n.type||n.ref||e.push(new Ut(a,n,'either "type" or "ref" is required'));let p=Un(n.type);const y=Un(n.ref);if(n.id){const b=Un(n.id);for(let T=0;T<t.arrayIndex;T++){const E=u.layers[T];Un(E.id)===b&&e.push(new Ut(a,n.id,`duplicate layer id "${n.id}", previously used at line ${E.id.__line__}`))}}if("ref"in n){let b;["type","source","source-layer","filter","layout"].forEach(T=>{T in n&&e.push(new Ut(a,n[T],`"${T}" is prohibited for ref layers`))}),u.layers.forEach(T=>{Un(T.id)===y&&(b=T)}),b?b.ref?e.push(new Ut(a,n.ref,"ref cannot reference another ref layer")):p=Un(b.type):typeof y=="string"&&e.push(new Ut(a,n.ref,`ref layer "${y}" not found`))}else if(p!=="background"&&p!=="sky"&&p!=="slot")if(n.source){const b=u.sources&&u.sources[n.source],T=b&&Un(b.type);b?T==="vector"&&p==="raster"?e.push(new Ut(a,n.source,`layer "${n.id}" requires a raster source`)):T==="raster"&&p!=="raster"?e.push(new Ut(a,n.source,`layer "${n.id}" requires a vector source`)):T!=="vector"||n["source-layer"]?T==="raster-dem"&&p!=="hillshade"?e.push(new Ut(a,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||T==="geojson"&&b.lineMetrics||e.push(new Ut(a,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ut(a,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Ut(a,n.source,`source "${n.source}" not found`))}else e.push(new Ut(a,n,'missing required property "source"'));return e=e.concat(Hr({key:a,value:n,valueSpec:d.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ir({key:`${a}.type`,value:n.type,valueSpec:d.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:b=>ld(bs({layerType:p},b)),layout:b=>Hr({layer:n,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":T=>ec(bs({layerType:p},T))}}),paint:b=>Hr({layer:n,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":T=>Np(bs({layerType:p,layer:n},T))}})}})),e}function nl(t){const e=t.value,n=t.key,a=Wi(e);return a!=="string"?[new Ut(n,e,`string expected, ${a} found`)]:[]}const tc={promoteId:function({key:t,value:e}){if(Wi(e)==="string")return nl({key:t,value:e});{const n=[];for(const a in e)n.push(...nl({key:`${t}.${a}`,value:e[a]}));return n}}};function jp(t){const e=t.value,n=t.key,a=t.styleSpec,u=t.style;if(!e.type)return[new Ut(n,e,'"type" is required')];const d=Un(e.type);let p=[];switch(["vector","raster","raster-dem"].includes(d)&&(e.url||e.tiles||p.push(new Fs(n,e,'Either "url" or "tiles" is required.'))),d){case"vector":case"raster":case"raster-dem":return p=p.concat(Hr({key:n,value:e,valueSpec:a[`source_${d.replace("-","_")}`],style:t.style,styleSpec:a,objectElementValidators:tc})),p;case"geojson":if(p=Hr({key:n,value:e,valueSpec:a.source_geojson,style:u,styleSpec:a,objectElementValidators:tc}),e.cluster)for(const y in e.clusterProperties){const[b,T]=e.clusterProperties[y],E=typeof b=="string"?[b,["accumulated"],["get",y]]:b;p.push(...ma({key:`${n}.${y}.map`,value:T,expressionContext:"cluster-map"})),p.push(...ma({key:`${n}.${y}.reduce`,value:E,expressionContext:"cluster-reduce"}))}return p;case"video":return Hr({key:n,value:e,valueSpec:a.source_video,style:u,styleSpec:a});case"image":return Hr({key:n,value:e,valueSpec:a.source_image,style:u,styleSpec:a});case"canvas":return[new Ut(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ga({key:`${n}.type`,value:e.type,valueSpec:{values:Up(a)},style:u,styleSpec:a})}}function Up(t){return t.source.reduce((e,n)=>{const a=t[n];return a.type.type==="enum"&&(e=e.concat(Object.keys(a.type.values))),e},[])}function Gp(t){const e=t.value;let n=[];if(!e)return n;const a=Wi(e);return a!=="string"?(n=n.concat([new Ut(t.key,e,`string expected, "${a}" found`)]),n):(function(u){const d=u.indexOf("://")===-1;try{return new URL(u,d?"http://example.com":void 0),!0}catch{return!1}}(e)||(n=n.concat([new Ut(t.key,e,`invalid url "${e}"`)])),n)}function cd(t){const e=t.value,n=t.styleSpec,a=n.light,u=t.style;let d=[];const p=Wi(e);if(e===void 0)return d;if(p!=="object")return d=d.concat([new Ut("light",e,`object expected, ${p} found`)]),d;for(const y in e){const b=y.match(/^(.*)-transition$/);d=d.concat(b&&a[b[1]]&&a[b[1]].transition?ir({key:y,value:e[y],valueSpec:n.transition,style:u,styleSpec:n}):a[y]?ir({key:y,value:e[y],valueSpec:a[y],style:u,styleSpec:n}):[new Ut(y,e[y],`unknown property "${y}"`)])}return d}function ud(t){const e=t.value;let n=[];if(!e)return n;const a=Wi(e);if(a!=="object")return n=n.concat([new Ut("light-3d",e,`object expected, ${a} found`)]),n;const u=t.styleSpec,d=u["light-3d"],p=t.key,y=t.style,b=t.style.lights;for(const I of["type","id"])if(!(I in e))return n=n.concat([new Ut("light-3d",e,`missing property ${I} on light`)]),n;if(e.type&&b)for(let I=0;I<t.arrayIndex;I++){const C=Un(e.type),D=b[I];Un(D.type)===C&&n.push(new Ut(p,e.id,`duplicate light type "${e.type}", previously defined at line ${D.id.__line__}`))}const T=`properties_light_${e.type}`;if(!(T in u))return n=n.concat([new Ut("light-3d",e,`Invalid light type ${e.type}`)]),n;const E=u[T];for(const I in e)if(I==="properties"){const C=e[I],D=Wi(C);if(D!=="object")return n=n.concat([new Ut("properties",C,`object expected, ${D} found`)]),n;for(const R in C)n=n.concat(E[R]?ir({key:R,value:C[R],valueSpec:E[R],style:y,styleSpec:u}):[new Fs(t.key,C[R],`unknown property "${R}"`)])}else{const C=I.match(/^(.*)-transition$/);n=n.concat(C&&d[C[1]]&&d[C[1]].transition?ir({key:I,value:e[I],valueSpec:u.transition,style:y,styleSpec:u}):d[I]?ir({key:I,value:e[I],valueSpec:d[I],style:y,styleSpec:u}):[new Fs(I,e[I],`unknown property "${I}"`)])}return n}function hd(t){const e=t.value,n=t.key,a=t.style,u=t.styleSpec,d=u.terrain;let p=[];const y=Wi(e);if(e===void 0||y==="null")return p;if(y!=="object")return p=p.concat([new Ut("terrain",e,`object expected, ${y} found`)]),p;for(const b in e){const T=b.match(/^(.*)-transition$/);p=p.concat(T&&d[T[1]]&&d[T[1]].transition?ir({key:b,value:e[b],valueSpec:u.transition,style:a,styleSpec:u}):d[b]?ir({key:b,value:e[b],valueSpec:d[b],style:a,styleSpec:u}):[new Fs(b,e[b],`unknown property "${b}"`)])}if(e.source){const b=a.sources&&a.sources[e.source],T=b&&Un(b.type);b?T!=="raster-dem"&&p.push(new Ut(n,e.source,`terrain cannot be used with a source of type ${String(T)}, it only be used with a "raster-dem" source type`)):p.push(new Ut(n,e.source,`source "${e.source}" not found`))}else p.push(new Ut(n,e,'terrain is missing required property "source"'));return p}function dd(t){const e=t.value,n=t.style,a=t.styleSpec,u=a.fog;let d=[];const p=Wi(e);if(e===void 0)return d;if(p!=="object")return d=d.concat([new Ut("fog",e,`object expected, ${p} found`)]),d;for(const y in e){const b=y.match(/^(.*)-transition$/);d=d.concat(b&&u[b[1]]&&u[b[1]].transition?ir({key:y,value:e[y],valueSpec:a.transition,style:n,styleSpec:a}):u[y]?ir({key:y,value:e[y],valueSpec:u[y],style:n,styleSpec:a}):[new Fs(y,e[y],`unknown property "${y}"`)])}return d}const bu={"*":()=>[],array:Dp,boolean:function(t){const e=t.value,n=t.key,a=Wi(e);return a!=="boolean"?[new Ut(n,e,`boolean expected, ${a} found`)]:[]},number:sd,color:function(t){const e=t.key,n=t.value,a=Wi(n);return a!=="string"?[new Ut(e,n,`color expected, ${a} found`)]:Uc(n)===null?[new Ut(e,n,`color expected, "${n}" found`)]:[]},enum:ga,filter:ld,function:od,layer:Vp,object:Hr,source:jp,model:Gp,light:cd,"light-3d":ud,terrain:hd,fog:dd,string:nl,formatted:function(t){return nl(t).length===0?[]:ma(t)},resolvedImage:function(t){return nl(t).length===0?[]:ma(t)},projection:function(t){const e=t.value,n=t.styleSpec,a=n.projection,u=t.style;let d=[];const p=Wi(e);if(p==="object")for(const y in e)d=d.concat(ir({key:y,value:e[y],valueSpec:a[y],style:u,styleSpec:n}));else p!=="string"&&(d=d.concat([new Ut("projection",e,`object or string expected, ${p} found`)]));return d},import:function(t){const{value:e,styleSpec:n}=t,{data:a,...u}=e;Object.defineProperty(u,"__line__",{value:e.__line__,enumerable:!1});let d=Hr(bs({},t,{value:u,valueSpec:n.import}));return Un(u.id)===""&&d.push(new Ut(`${t.key}.id`,u,"import id can't be an empty string")),a&&(d=d.concat(Hp(a,n,{key:`${t.key}.data`}))),d}};function ir(t,e=!1){const n=t.value,a=t.valueSpec,u=t.styleSpec;if(a.expression&&uu(Un(n)))return od(t);if(a.expression&&du(to(n)))return ma(t);if(a.type&&bu[a.type]){const d=bu[a.type](t);return e===!0&&d.length>0&&Wi(t.value)==="array"?ma(t):d}return Hr(bs({},t,{valueSpec:a.type?u[a.type]:a}))}function ry(t){const e=t.value,n=t.key,a=nl(t);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new Ut(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new Ut(n,e,'"glyphs" url must include a "{range}" token'))),a}function Hp(t,e=De,n={}){return ir({key:n.key||"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:ry,"*":()=>[]}})}function fd(t,e=De){return Es(Hp(t,e))}const sy=t=>Es(Np(t)),oy=t=>Es(ec(t));function Es(t){return t.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function Wp(t,e){let n=!1;if(e&&e.length)for(const a of e)a instanceof Fs?si(a.message):(t.fire(new ta(new Error(a.message))),n=!0);return n}var ay=js,Bo=3;function js(t,e,n){var a=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var u=new Int32Array(this.arrayBuffer);t=u[0],this.d=(e=u[1])+2*(n=u[2]);for(var d=0;d<this.d*this.d;d++){var p=u[Bo+d],y=u[Bo+d+1];a.push(p===y?null:u.subarray(p,y))}var b=u[Bo+a.length+1];this.keys=u.subarray(u[Bo+a.length],b),this.bboxes=u.subarray(b),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var T=0;T<this.d*this.d;T++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var E=n/e*t;this.min=-E,this.max=t+E}js.prototype.insert=function(t,e,n,a,u){this._forEachCell(e,n,a,u,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(u)},js.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},js.prototype._insertCell=function(t,e,n,a,u,d){this.cells[u].push(d)},js.prototype.query=function(t,e,n,a,u){var d=this.min,p=this.max;if(t<=d&&e<=d&&p<=n&&p<=a&&!u)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(t,e,n,a,this._queryCell,y,{},u),y},js.prototype._queryCell=function(t,e,n,a,u,d,p,y){var b=this.cells[u];if(b!==null)for(var T=this.keys,E=this.bboxes,I=0;I<b.length;I++){var C=b[I];if(p[C]===void 0){var D=4*C;(y?y(E[D+0],E[D+1],E[D+2],E[D+3]):t<=E[D+2]&&e<=E[D+3]&&n>=E[D+0]&&a>=E[D+1])?(p[C]=!0,d.push(T[C])):p[C]=!1}}},js.prototype._forEachCell=function(t,e,n,a,u,d,p,y){for(var b=this._convertToCellCoord(t),T=this._convertToCellCoord(e),E=this._convertToCellCoord(n),I=this._convertToCellCoord(a),C=b;C<=E;C++)for(var D=T;D<=I;D++){var R=this.d*D+C;if((!y||y(this._convertFromCellCoord(C),this._convertFromCellCoord(D),this._convertFromCellCoord(C+1),this._convertFromCellCoord(D+1)))&&u.call(this,t,e,n,a,R,d,p,y))return}},js.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},js.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},js.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Bo+this.cells.length+1+1,n=0,a=0;a<this.cells.length;a++)n+=this.cells[a].length;var u=new Int32Array(e+n+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var d=e,p=0;p<t.length;p++){var y=t[p];u[Bo+p]=d,u.set(y,d),d+=y.length}return u[Bo+t.length]=d,u.set(this.keys,d),u[Bo+t.length+1]=d+=this.keys.length,u.set(this.bboxes,d),d+=this.bboxes.length,u.buffer};var rl=pe(ay);const wu={};function Bt(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),wu[e]={klass:t,omit:n.omit||[]}}Bt(Object,"Object"),rl.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},rl.deserialize=function(t){return new rl(t.buffer)},Object.defineProperty(rl,"name",{value:"Grid"}),Bt(rl,"Grid"),Bt(_n,"Color"),Bt(Error,"Error"),Bt(zr,"Formatted"),Bt(oa,"FormattedSection"),Bt(Ni,"AJAXError"),Bt(as,"ResolvedImage"),Bt(fu,"StylePropertyFunction"),Bt(rd,"StyleExpression",{omit:["_evaluator"]}),Bt(Ql,"ZoomDependentExpression"),Bt(Jl,"ZoomConstantExpression"),Bt(Ms,"CompoundExpression",{omit:["_evaluate"]});for(const t in Zl)wu[Zl[t]._classRegistryKey]||Bt(Zl[t],`Expression${t}`);function g(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function l(t){return self.ImageBitmap&&t instanceof ImageBitmap}function h(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(g(t)||l(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.add(n.buffer),n}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const a of t)n.push(h(a,e));return n}if(t instanceof Map){const n={$name:"Map"};for(const[a,u]of t.entries())n[a]=h(u);return n}if(typeof t=="object"){const n=t.constructor,a=n._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);const u=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const d in t)t.hasOwnProperty(d)&&(wu[a].omit.indexOf(d)>=0||(u[d]=h(t[d],e)));t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(u.$name=a),u}throw new Error("can't serialize object of type "+typeof t)}function x(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||g(t)||l(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(x);if(typeof t=="object"){const e=t.$name||"Object";if(e==="Map"){const u=new Map;for(const d of Object.keys(t))d!=="$name"&&u.set(d,x(t[d]));return u}const{klass:n}=wu[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const a=Object.create(n.prototype);for(const u of Object.keys(t))u!=="$name"&&(a[u]=x(t[u]));return a}throw new Error("can't deserialize object of type "+typeof t)}const w={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function M(t){for(const e of t)if(L(e.charCodeAt(0)))return!0;return!1}function A(t){for(const e of t)if(!k(e.charCodeAt(0)))return!1;return!0}function k(t){return!(w.Arabic(t)||w["Arabic Supplement"](t)||w["Arabic Extended-A"](t)||w["Arabic Presentation Forms-A"](t)||w["Arabic Presentation Forms-B"](t))}function L(t){return!(t!==746&&t!==747&&(t<4352||!(w["Bopomofo Extended"](t)||w.Bopomofo(t)||w["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||w["CJK Compatibility Ideographs"](t)||w["CJK Compatibility"](t)||w["CJK Radicals Supplement"](t)||w["CJK Strokes"](t)||!(!w["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||w["CJK Unified Ideographs Extension A"](t)||w["CJK Unified Ideographs"](t)||w["Enclosed CJK Letters and Months"](t)||w["Hangul Compatibility Jamo"](t)||w["Hangul Jamo Extended-A"](t)||w["Hangul Jamo Extended-B"](t)||w["Hangul Jamo"](t)||w["Hangul Syllables"](t)||w.Hiragana(t)||w["Ideographic Description Characters"](t)||w.Kanbun(t)||w["Kangxi Radicals"](t)||w["Katakana Phonetic Extensions"](t)||w.Katakana(t)&&t!==12540||!(!w["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!w["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||w["Unified Canadian Aboriginal Syllabics"](t)||w["Unified Canadian Aboriginal Syllabics Extended"](t)||w["Vertical Forms"](t)||w["Yijing Hexagram Symbols"](t)||w["Yi Syllables"](t)||w["Yi Radicals"](t))))}function O(t){return!(L(t)||function(e){return!!(w["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||w["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||w["Letterlike Symbols"](e)||w["Number Forms"](e)||w["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||w["Control Pictures"](e)&&e!==9251||w["Optical Character Recognition"](e)||w["Enclosed Alphanumerics"](e)||w["Geometric Shapes"](e)||w["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||w["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||w["CJK Symbols and Punctuation"](e)||w.Katakana(e)||w["Private Use Area"](e)||w["CJK Compatibility Forms"](e)||w["Small Form Variants"](e)||w["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function N(t){return t>=1424&&t<=2303||w["Arabic Presentation Forms-A"](t)||w["Arabic Presentation Forms-B"](t)}function j(t,e){return!(!e&&N(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||w.Khmer(t))}function H(t){for(const e of t)if(N(e.charCodeAt(0)))return!0;return!1}const q="deferred",Y="loading",J="loaded";let K=null,X="unavailable",oe=null;const de=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(X="error"),K&&K(t)};function fe(){ne.fire(new vs("pluginStateChange",{pluginStatus:X,pluginURL:oe}))}const ne=new Bs,ae=function(){return X},me=function(){if(X!==q||!oe)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");X=Y,fe(),oe&&sr({url:oe},t=>{t?de(t):(X=J,fe())})},xe={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>X===J||xe.applyArabicShaping!=null,isLoading:()=>X===Y,setState(t){X=t.pluginStatus,oe=t.pluginURL},isParsed:()=>xe.applyArabicShaping!=null&&xe.processBidirectionalText!=null&&xe.processStyledBidirectionalText!=null,getPluginURL:()=>oe};class _e{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,a){for(const u of n)if(!j(u.charCodeAt(0),a))return!1;return!0}(e,xe.isLoaded())}}class be{constructor(e,n,a,u){this.property=e,this.value=n,this.expression=function(d,p,y,b){if(uu(d))return new fu(d,p);if(du(d)||Array.isArray(d)&&d.length>0){const T=$l(d,p,y,b);if(T.result==="error")throw new Error(T.value.map(E=>`${E.key}: ${E.message}`).join(", "));return T.value}{let T=d;return typeof d=="string"&&p.type==="color"&&(T=_n.parse(d)),{kind:"constant",isConfigDependent:!1,evaluate:()=>T}}}(n===void 0?e.specification.default:n,e.specification,a,u)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,a){return this.property.possiblyEvaluate(this,e,n,a)}}class Ue{constructor(e,n,a){this.property=e,this.value=new be(e,void 0,n,a)}transitioned(e,n){return new Fe(this.property,this.value,n,Qe({},e.transition,this.transition),e.now)}untransitioned(){return new Fe(this.property,this.value,null,{},0)}}class ze{constructor(e,n,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=a,this.isConfigDependent=!1}getValue(e){return en(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Ue(this._values[e].property,this._scope,this._options)),this._values[e].value=new be(this._values[e].property,n===null?void 0:en(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);const a=this._properties.properties;if(e)for(const u in e){const d=e[u];if(on(u,"-transition")){const p=u.slice(0,-11);a[p]&&this.setTransition(p,d)}else a[u]&&this.setValue(u,d)}}getTransition(e){return en(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Ue(this._values[e].property)),this._values[e].transition=en(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const a=this.getValue(n);a!==void 0&&(e[n]=a);const u=this.getTransition(n);u!==void 0&&(e[`${n}-transition`]=u)}return e}transitioned(e,n){const a=new Ae(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(e,n._values[u]);return a}untransitioned(){const e=new Ae(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Fe{constructor(e,n,a,u,d){const p=u.delay||0,y=u.duration||0;d=d||0,this.property=e,this.value=n,this.begin=d+p,this.end=this.begin+y,e.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(e,n,a){const u=e.now||0,d=this.value.possiblyEvaluate(e,n,a),p=this.prior;if(p){if(u>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(u<this.begin)return p.possiblyEvaluate(e,n,a);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,n,a),d,ni(y))}}return d}}class Ae{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,a){const u=new qe(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,n,a);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class je{constructor(e,n,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=a,this.isConfigDependent=!1}getValue(e){return en(this._values[e].value)}setValue(e,n){this._values[e]=new be(this._values[e].property,n===null?void 0:en(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const n of Object.keys(this._values)){const a=this.getValue(n);a!==void 0&&(e[n]=a)}return e}possiblyEvaluate(e,n,a){const u=new qe(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,n,a);return u}}class Oe{constructor(e,n,a){this.property=e,this.value=n,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,a,u){return this.property.evaluate(this.value,this.parameters,e,n,a,u)}}class qe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ue{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,a){const u=Ul[this.specification.type];return u?u(e,n,a):e}}class Ce{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,a,u){return new Oe(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},a,u)}:e.expression,n)}interpolate(e,n,a){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Oe(this,{kind:"constant",value:void 0},e.parameters);const u=Ul[this.specification.type];return u?new Oe(this,{kind:"constant",value:u(e.value.value,n.value.value,a)},e.parameters):e}evaluate(e,n,a,u,d,p){return e.kind==="constant"?e.value:e.evaluate(n,a,u,d,p)}}class st{constructor(e){this.specification=e}possiblyEvaluate(e,n,a,u){return!!e.expression.evaluate(n,null,{},a,u)}interpolate(){return!1}}class $e{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new _e(0,{});for(const a in e){const u=e[a];u.specification.overridable&&this.overridableProperties.push(a);const d=this.defaultPropertyValues[a]=new be(u,void 0),p=this.defaultTransitionablePropertyValues[a]=new Ue(u);this.defaultTransitioningPropertyValues[a]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=d.possiblyEvaluate(n)}}}Bt(Ce,"DataDrivenProperty"),Bt(ue,"DataConstantProperty"),Bt(st,"ColorRampProperty");const Ft="";function kt(t,e){return e?`${t}${Ft}${e}`:t}const Xt="-transition";class Lt extends Bs{constructor(e,n,a,u){if(super(),this.id=e.id,this.fqid=kt(this.id,a),this.type=e.type,this.scope=a,this.options=u,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new je(n.layout,this.scope,u),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new ze(n.paint,this.scope,u);for(const d in e.paint)this.setPaintProperty(d,e.paint[d],{validate:!1});for(const d in e.layout)this.setLayoutProperty(d,e.layout[d],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new qe(n.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,a={}){if(n!=null&&this._validate(oy,`layers.${this.id}.layout.${e}`,e,n,a))return;if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);const u=this._unevaluatedLayout;u._properties.properties[e]&&(u.setValue(e,n),this.isConfigDependent=this.isConfigDependent||u.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return on(e,Xt)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,a={}){if(n!=null&&this._validate(sy,`layers.${this.id}.paint.${e}`,e,n,a))return!1;const u=this._transitionablePaint,d=u._properties.properties;if(on(e,Xt)){const C=e.slice(0,-11);return d[C]&&u.setTransition(C,n||void 0),!1}if(!d[e])return!1;const p=u._values[e],y=p.value.isDataDriven(),b=p.value;u.setValue(e,n),this.isConfigDependent=this.isConfigDependent||u.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const T=u._values[e].value,E=T.isDataDriven(),I=on(e,"pattern")||e==="line-dasharray";return E||y||I||this._handleOverridablePaintPropertyUpdate(e,b,T)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n){return null}_handleOverridablePaintPropertyUpdate(e,n,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return er({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}_validate(e,n,a,u,d={}){return(!d||d.validate!==!1)&&Wp(this,e.call(fd,{key:n,layerType:this.type,objectKey:a,value:u,styleSpec:De,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Oe&&Lo(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=_u(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(){this._stats&&(this._stats.numRenderedVerticesInShadowPass=0,this._stats.numRenderedVerticesInTransparentPass=0)}}const Qt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class $t{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Gt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ht(t,e=1){let n=0,a=0;return{members:t.map(u=>{const d=Qt[u.type].BYTES_PER_ELEMENT,p=n=Ri(n,Math.max(e,d)),y=u.components||1;return a=Math.max(a,d),n+=d*y,{name:u.name,type:u.type,components:y,offset:p}}),size:Ri(n,Math.max(a,e)),alignment:e}}function Ri(t,e){return Math.ceil(t/e)*e}class hi extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){const u=2*e;return this.int16[u+0]=n,this.int16[u+1]=a,e}}hi.prototype.bytesPerElement=4,Bt(hi,"StructArrayLayout2i4");class hn extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,a)}emplace(e,n,a,u){const d=3*e;return this.int16[d+0]=n,this.int16[d+1]=a,this.int16[d+2]=u,e}}hn.prototype.bytesPerElement=6,Bt(hn,"StructArrayLayout3i6");class Qi extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,a,u)}emplace(e,n,a,u,d){const p=4*e;return this.int16[p+0]=n,this.int16[p+1]=a,this.int16[p+2]=u,this.int16[p+3]=d,e}}Qi.prototype.bytesPerElement=8,Bt(Qi,"StructArrayLayout4i8");class Lr extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,u,d)}emplace(e,n,a,u,d,p){const y=5*e;return this.int16[y+0]=n,this.int16[y+1]=a,this.int16[y+2]=u,this.int16[y+3]=d,this.int16[y+4]=p,e}}Lr.prototype.bytesPerElement=10,Bt(Lr,"StructArrayLayout5i10");class us extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,a,u,d,p,y)}emplace(e,n,a,u,d,p,y,b){const T=6*e,E=12*e,I=3*e;return this.int16[T+0]=n,this.int16[T+1]=a,this.uint8[E+4]=u,this.uint8[E+5]=d,this.uint8[E+6]=p,this.uint8[E+7]=y,this.float32[I+2]=b,e}}us.prototype.bytesPerElement=12,Bt(us,"StructArrayLayout2i4ub1f12");class Xi extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,a,u)}emplace(e,n,a,u,d){const p=4*e;return this.float32[p+0]=n,this.float32[p+1]=a,this.float32[p+2]=u,this.float32[p+3]=d,e}}Xi.prototype.bytesPerElement=16,Bt(Xi,"StructArrayLayout4f16");class Bi extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,u,d)}emplace(e,n,a,u,d,p){const y=6*e,b=3*e;return this.uint16[y+0]=n,this.uint16[y+1]=a,this.uint16[y+2]=u,this.uint16[y+3]=d,this.float32[b+2]=p,e}}Bi.prototype.bytesPerElement=12,Bt(Bi,"StructArrayLayout4ui1f12");class Vi extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,a,u)}emplace(e,n,a,u,d){const p=4*e;return this.uint16[p+0]=n,this.uint16[p+1]=a,this.uint16[p+2]=u,this.uint16[p+3]=d,e}}Vi.prototype.bytesPerElement=8,Bt(Vi,"StructArrayLayout4ui8");class yn extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,u,d,p)}emplace(e,n,a,u,d,p,y){const b=6*e;return this.int16[b+0]=n,this.int16[b+1]=a,this.int16[b+2]=u,this.int16[b+3]=d,this.int16[b+4]=p,this.int16[b+5]=y,e}}yn.prototype.bytesPerElement=12,Bt(yn,"StructArrayLayout6i12");class cr extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d,p,y,b,T,E,I,C){const D=this.length;return this.resize(D+1),this.emplace(D,e,n,a,u,d,p,y,b,T,E,I,C)}emplace(e,n,a,u,d,p,y,b,T,E,I,C,D){const R=12*e;return this.int16[R+0]=n,this.int16[R+1]=a,this.int16[R+2]=u,this.int16[R+3]=d,this.uint16[R+4]=p,this.uint16[R+5]=y,this.uint16[R+6]=b,this.uint16[R+7]=T,this.int16[R+8]=E,this.int16[R+9]=I,this.int16[R+10]=C,this.int16[R+11]=D,e}}cr.prototype.bytesPerElement=24,Bt(cr,"StructArrayLayout4i4ui4i24");class mn extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,u,d,p)}emplace(e,n,a,u,d,p,y){const b=10*e,T=5*e;return this.int16[b+0]=n,this.int16[b+1]=a,this.int16[b+2]=u,this.float32[T+2]=d,this.float32[T+3]=p,this.float32[T+4]=y,e}}mn.prototype.bytesPerElement=20,Bt(mn,"StructArrayLayout3i3f20");class vr extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}vr.prototype.bytesPerElement=4,Bt(vr,"StructArrayLayout1ul4");class Rr extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){const u=2*e;return this.uint16[u+0]=n,this.uint16[u+1]=a,e}}Rr.prototype.bytesPerElement=4,Bt(Rr,"StructArrayLayout2ui4");class br extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d,p,y,b,T,E,I,C,D){const R=this.length;return this.resize(R+1),this.emplace(R,e,n,a,u,d,p,y,b,T,E,I,C,D)}emplace(e,n,a,u,d,p,y,b,T,E,I,C,D,R){const B=20*e,V=10*e;return this.int16[B+0]=n,this.int16[B+1]=a,this.int16[B+2]=u,this.int16[B+3]=d,this.int16[B+4]=p,this.float32[V+3]=y,this.float32[V+4]=b,this.float32[V+5]=T,this.float32[V+6]=E,this.int16[B+14]=I,this.uint32[V+8]=C,this.uint16[B+18]=D,this.uint16[B+19]=R,e}}br.prototype.bytesPerElement=40,Bt(br,"StructArrayLayout5i4f1i1ul2ui40");class hs extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,a,u,d,p,y)}emplace(e,n,a,u,d,p,y,b){const T=8*e;return this.int16[T+0]=n,this.int16[T+1]=a,this.int16[T+2]=u,this.int16[T+4]=d,this.int16[T+5]=p,this.int16[T+6]=y,this.int16[T+7]=b,e}}hs.prototype.bytesPerElement=16,Bt(hs,"StructArrayLayout3i2i2i16");class ro extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,u,d)}emplace(e,n,a,u,d,p){const y=4*e,b=8*e;return this.float32[y+0]=n,this.float32[y+1]=a,this.float32[y+2]=u,this.int16[b+6]=d,this.int16[b+7]=p,e}}ro.prototype.bytesPerElement=16,Bt(ro,"StructArrayLayout2f1f2i16");class As extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,a,u)}emplace(e,n,a,u,d){const p=12*e,y=3*e;return this.uint8[p+0]=n,this.uint8[p+1]=a,this.float32[y+1]=u,this.float32[y+2]=d,e}}As.prototype.bytesPerElement=12,Bt(As,"StructArrayLayout2ub2f12");class tn extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,a)}emplace(e,n,a,u){const d=3*e;return this.uint16[d+0]=n,this.uint16[d+1]=a,this.uint16[d+2]=u,e}}tn.prototype.bytesPerElement=6,Bt(tn,"StructArrayLayout3ui6");class Is extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d,p,y,b,T,E,I,C,D,R,B,V,G,$,te,se,le){const he=this.length;return this.resize(he+1),this.emplace(he,e,n,a,u,d,p,y,b,T,E,I,C,D,R,B,V,G,$,te,se,le)}emplace(e,n,a,u,d,p,y,b,T,E,I,C,D,R,B,V,G,$,te,se,le,he){const ye=30*e,we=15*e,Ie=60*e;return this.int16[ye+0]=n,this.int16[ye+1]=a,this.int16[ye+2]=u,this.float32[we+2]=d,this.float32[we+3]=p,this.uint16[ye+8]=y,this.uint16[ye+9]=b,this.uint32[we+5]=T,this.uint32[we+6]=E,this.uint32[we+7]=I,this.uint16[ye+16]=C,this.uint16[ye+17]=D,this.uint16[ye+18]=R,this.float32[we+10]=B,this.float32[we+11]=V,this.uint8[Ie+48]=G,this.uint8[Ie+49]=$,this.uint8[Ie+50]=te,this.uint32[we+13]=se,this.int16[ye+28]=le,this.uint8[Ie+58]=he,e}}Is.prototype.bytesPerElement=60,Bt(Is,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Us extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d,p,y,b,T,E,I,C,D,R,B,V,G,$,te,se,le,he,ye,we,Ie,Le,Pe,Ge,ct,Ve,rt,Ne){const wt=this.length;return this.resize(wt+1),this.emplace(wt,e,n,a,u,d,p,y,b,T,E,I,C,D,R,B,V,G,$,te,se,le,he,ye,we,Ie,Le,Pe,Ge,ct,Ve,rt,Ne)}emplace(e,n,a,u,d,p,y,b,T,E,I,C,D,R,B,V,G,$,te,se,le,he,ye,we,Ie,Le,Pe,Ge,ct,Ve,rt,Ne,wt){const Ot=20*e,lt=40*e,ei=80*e;return this.float32[Ot+0]=n,this.float32[Ot+1]=a,this.int16[lt+4]=u,this.int16[lt+5]=d,this.int16[lt+6]=p,this.int16[lt+7]=y,this.int16[lt+8]=b,this.int16[lt+9]=T,this.int16[lt+10]=E,this.int16[lt+11]=I,this.int16[lt+12]=C,this.uint16[lt+13]=D,this.uint16[lt+14]=R,this.uint16[lt+15]=B,this.uint16[lt+16]=V,this.uint16[lt+17]=G,this.uint16[lt+18]=$,this.uint16[lt+19]=te,this.uint16[lt+20]=se,this.uint16[lt+21]=le,this.uint16[lt+22]=he,this.uint16[lt+23]=ye,this.uint16[lt+24]=we,this.uint16[lt+25]=Ie,this.uint16[lt+26]=Le,this.uint16[lt+27]=Pe,this.uint32[Ot+14]=Ge,this.float32[Ot+15]=ct,this.float32[Ot+16]=Ve,this.float32[Ot+17]=rt,this.float32[Ot+18]=Ne,this.uint8[ei+76]=wt,e}}Us.prototype.bytesPerElement=80,Bt(Us,"StructArrayLayout2f9i15ui1ul4f1ub80");class so extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}so.prototype.bytesPerElement=4,Bt(so,"StructArrayLayout1f4");class ic extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,u,d)}emplace(e,n,a,u,d,p){const y=5*e;return this.float32[y+0]=n,this.float32[y+1]=a,this.float32[y+2]=u,this.float32[y+3]=d,this.float32[y+4]=p,e}}ic.prototype.bytesPerElement=20,Bt(ic,"StructArrayLayout5f20");class ly extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,a,u,d,p,y)}emplace(e,n,a,u,d,p,y,b){const T=7*e;return this.float32[T+0]=n,this.float32[T+1]=a,this.float32[T+2]=u,this.float32[T+3]=d,this.float32[T+4]=p,this.float32[T+5]=y,this.float32[T+6]=b,e}}ly.prototype.bytesPerElement=28,Bt(ly,"StructArrayLayout7f28");class cy extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,a,u)}emplace(e,n,a,u,d){const p=6*e;return this.uint32[3*e+0]=n,this.uint16[p+2]=a,this.uint16[p+3]=u,this.uint16[p+4]=d,e}}cy.prototype.bytesPerElement=12,Bt(cy,"StructArrayLayout1ul3ui12");class pd extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}pd.prototype.bytesPerElement=2,Bt(pd,"StructArrayLayout1ui2");class nc extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,a)}emplace(e,n,a,u){const d=3*e;return this.float32[d+0]=n,this.float32[d+1]=a,this.float32[d+2]=u,e}}nc.prototype.bytesPerElement=12,Bt(nc,"StructArrayLayout3f12");class md extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){const u=2*e;return this.float32[u+0]=n,this.float32[u+1]=a,e}}md.prototype.bytesPerElement=8,Bt(md,"StructArrayLayout2f8");class uy extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d,p,y,b,T,E,I,C,D,R,B,V){const G=this.length;return this.resize(G+1),this.emplace(G,e,n,a,u,d,p,y,b,T,E,I,C,D,R,B,V)}emplace(e,n,a,u,d,p,y,b,T,E,I,C,D,R,B,V,G){const $=16*e;return this.float32[$+0]=n,this.float32[$+1]=a,this.float32[$+2]=u,this.float32[$+3]=d,this.float32[$+4]=p,this.float32[$+5]=y,this.float32[$+6]=b,this.float32[$+7]=T,this.float32[$+8]=E,this.float32[$+9]=I,this.float32[$+10]=C,this.float32[$+11]=D,this.float32[$+12]=R,this.float32[$+13]=B,this.float32[$+14]=V,this.float32[$+15]=G,e}}uy.prototype.bytesPerElement=64,Bt(uy,"StructArrayLayout16f64");class qp extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,a,u,d,p,y)}emplace(e,n,a,u,d,p,y,b){const T=10*e,E=5*e;return this.uint16[T+0]=n,this.uint16[T+1]=a,this.uint16[T+2]=u,this.uint16[T+3]=d,this.float32[E+2]=p,this.float32[E+3]=y,this.float32[E+4]=b,e}}qp.prototype.bytesPerElement=20,Bt(qp,"StructArrayLayout4ui3f20");class hy extends Gt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}hy.prototype.bytesPerElement=1,Bt(hy,"StructArrayLayout1ub1");class Wv extends $t{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Wv.prototype.size=40;class dy extends br{get(e){return new Wv(this,e)}}Bt(dy,"CollisionBoxArray");class qv extends $t{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}qv.prototype.size=60;class Zv extends Is{get(e){return new qv(this,e)}}Bt(Zv,"PlacedSymbolArray");class Xv extends $t{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Xv.prototype.size=80;class Yv extends Us{get(e){return new Xv(this,e)}}Bt(Yv,"SymbolInstanceArray");class Kv extends so{getoffsetX(e){return this.float32[1*e+0]}}Bt(Kv,"GlyphOffsetArray");class Jv extends hi{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Bt(Jv,"SymbolLineVertexArray");class Qv extends $t{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Qv.prototype.size=12;class $v extends cy{get(e){return new Qv(this,e)}}Bt($v,"FeatureIndexArray");class e1 extends Rr{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Bt(e1,"FillExtrusionCentroidArray");const tC=Ht([{name:"a_pos",components:2,type:"Int16"}],4),iC=Ht([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Tn{constructor(e=[]){this.segments=e}_prepareSegment(e,n,a,u){let d=this.segments[this.segments.length-1];return e>Tn.MAX_VERTEX_ARRAY_LENGTH&&si(`Max vertices per segment is ${Tn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>Tn.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==u)&&(d={vertexOffset:n,primitiveOffset:a,vertexLength:0,primitiveLength:0},u!==void 0&&(d.sortKey=u),this.segments.push(d)),d}prepareSegment(e,n,a,u){return this._prepareSegment(e,n.length,a.length,u)}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,a,u){return new Tn([{vertexOffset:e,primitiveOffset:n,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}function t1(t,e){return 256*(t=ft(Math.floor(t),0,255))+ft(Math.floor(e),0,255)}Tn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Bt(Tn,"SegmentVector");const nC=Ht([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),rC=Ht([{name:"a_dash",components:4,type:"Uint16"}]);var Zp={exports:{}},i1={exports:{}};(function(t){t.exports=function(e,n){var a,u,d,p,y,b,T,E;for(u=e.length-(a=3&e.length),d=n,y=3432918353,b=461845907,E=0;E<u;)T=255&e.charCodeAt(E)|(255&e.charCodeAt(++E))<<8|(255&e.charCodeAt(++E))<<16|(255&e.charCodeAt(++E))<<24,++E,d=27492+(65535&(p=5*(65535&(d=(d^=T=(65535&(T=(T=(65535&T)*y+(((T>>>16)*y&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(T=0,a){case 3:T^=(255&e.charCodeAt(E+2))<<16;case 2:T^=(255&e.charCodeAt(E+1))<<8;case 1:d^=T=(65535&(T=(T=(65535&(T^=255&e.charCodeAt(E)))*y+(((T>>>16)*y&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295}return d^=e.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}})(i1);var sC=i1.exports,n1={exports:{}};(function(t){t.exports=function(e,n){for(var a,u=e.length,d=n^u,p=0;u>=4;)a=1540483477*(65535&(a=255&e.charCodeAt(p)|(255&e.charCodeAt(++p))<<8|(255&e.charCodeAt(++p))<<16|(255&e.charCodeAt(++p))<<24))+((1540483477*(a>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),u-=4,++p;switch(u){case 3:d^=(255&e.charCodeAt(p+2))<<16;case 2:d^=(255&e.charCodeAt(p+1))<<8;case 1:d=1540483477*(65535&(d^=255&e.charCodeAt(p)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0}})(n1);var r1=sC,oC=n1.exports;Zp.exports=r1,Zp.exports.murmur3=r1,Zp.exports.murmur2=oC;var fy=pe(Zp.exports);class gd{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,a,u){this.ids.push(s1(e)),this.positions.push(n,a,u)}eachPosition(e,n){const a=s1(e);let u=0,d=this.ids.length-1;for(;u<d;){const p=u+d>>1;this.ids[p]>=a?d=p:u=p+1}for(;this.ids[u]===a;)n(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,n){const a=new Float64Array(e.ids),u=new Uint32Array(e.positions);return py(a,u,0,a.length-1),n&&(n.add(a.buffer),n.add(u.buffer)),{ids:a,positions:u}}static deserialize(e){const n=new gd;let a;n.ids=e.ids,n.positions=e.positions;for(const u of n.ids)u!==a&&n.uniqueIds.push(u),a=u;return n.indexed=!0,n}}function s1(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:fy(String(t))}function py(t,e,n,a){for(;n<a;){const u=t[n+a>>1];let d=n-1,p=a+1;for(;;){do d++;while(t[d]<u);do p--;while(t[p]>u);if(d>=p)break;Xp(t,d,p),Xp(e,3*d,3*p),Xp(e,3*d+1,3*p+1),Xp(e,3*d+2,3*p+2)}p-n<a-p?(py(t,e,n,p),n=p+1):(py(t,e,p+1,a),a=p)}}function Xp(t,e,n){const a=t[e];t[e]=t[n],t[n]=a}Bt(gd,"FeaturePositionMap");class _a{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class Yp extends _a{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class Wr extends _a{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class rc extends _a{constructor(e){super(e),this.current=[0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class my extends _a{constructor(e){super(e),this.current=[0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class o1 extends _a{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class a1 extends _a{constructor(e){super(e),this.current=_n.transparent}set(e,n,a){this.fetchUniformLocation(e,n)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const aC=new Float32Array(16);class _d extends _a{constructor(e){super(e),this.current=aC}set(e,n,a){if(this.fetchUniformLocation(e,n)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let u=1;u<16;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}const lC=new Float32Array(9),cC=new Float32Array(4);class gy extends _a{constructor(e){super(e),this.current=cC}set(e,n,a){if(this.fetchUniformLocation(e,n)){for(let u=0;u<4;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function _y(t){return[t1(255*t.r,255*t.g),t1(255*t.b,255*t.a)]}class yd{constructor(e,n,a){this.value=e,this.uniformNames=n.map(u=>`u_${u}`),this.type=a}setUniform(e,n,a,u,d){n.set(e,d,u.constantOr(this.value))}getBinding(e,n){return this.type==="color"?new a1(e):new Wr(e)}}class Tu{constructor(e,n){this.uniformNames=n.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,a,u,d){const p=d==="u_pattern"||d==="u_dash"?this.pattern:d==="u_pixel_ratio"?this.pixelRatio:null;p&&n.set(e,d,p)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new o1(e):new Wr(e)}}class ya{constructor(e,n,a,u){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map(d=>({name:`a_${d}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,n,a,u,d,p,y){const b=this.paintVertexArray.length,T=this.expression.evaluate(new _e(0,{brightness:p}),n,{},d,u,y);this.paintVertexArray.resize(e),this._setPaintValue(b,e,T)}updatePaintArray(e,n,a,u,d,p,y){const b=this.expression.evaluate({zoom:0,brightness:y},a,u,void 0,d);this._setPaintValue(e,n,b)}_setPaintValue(e,n,a){if(this.type==="color"){const u=_y(a);for(let d=e;d<n;d++)this.paintVertexArray.emplace(d,u[0],u[1])}else{for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class oo{constructor(e,n,a,u,d,p){this.expression=e,this.uniformNames=n.map(y=>`u_${y}_t`),this.type=a,this.useIntegerZoom=u,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=n.map(y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,n,a,u,d,p,y){const b=this.expression.evaluate(new _e(this.zoom,{brightness:p}),n,{},d,u,y),T=this.expression.evaluate(new _e(this.zoom+1,{brightness:p}),n,{},d,u,y),E=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(E,e,b,T)}updatePaintArray(e,n,a,u,d,p,y){const b=this.expression.evaluate({zoom:this.zoom,brightness:y},a,u,void 0,d),T=this.expression.evaluate({zoom:this.zoom+1,brightness:y},a,u,void 0,d);this._setPaintValue(e,n,b,T)}_setPaintValue(e,n,a,u){if(this.type==="color"){const d=_y(a),p=_y(u);for(let y=e;y<n;y++)this.paintVertexArray.emplace(y,d[0],d[1],p[0],p[1])}else{for(let d=e;d<n;d++)this.paintVertexArray.emplace(d,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,a,u,d){const p=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,y=ft(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);n.set(e,d,y)}getBinding(e,n){return new Wr(e)}}class sl{constructor(e,n,a,u,d){this.expression=e,this.layerId=d,this.paintVertexAttributes=(a==="array"?rC:nC).members;for(let p=0;p<n.length;++p);this.paintVertexArray=new u}populatePaintArray(e,n,a){const u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,n.patterns&&n.patterns[this.layerId],a)}updatePaintArray(e,n,a,u,d,p,y){this._setPaintValues(e,n,a.patterns&&a.patterns[this.layerId],p)}_setPaintValues(e,n,a,u){if(!u||!a)return;const d=u[a];if(!d)return;const{tl:p,br:y,pixelRatio:b}=d;for(let T=e;T<n;T++)this.paintVertexArray.emplace(T,p[0],p[1],y[0],y[1],b)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class sc{constructor(e,n,a=()=>!0){this.binders={},this._buffers=[];const u=[];for(const d in e.paint._values){const p=e.paint.get(d);if(!a(d)||!(p instanceof Oe&&Lo(p.property.specification)))continue;const y=hC(d,e.type),b=p.value,T=p.property.specification.type,E=!!p.property.useIntegerZoom,I=d==="line-dasharray"||d.endsWith("pattern"),C=d==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(b.kind!=="constant"||C)if(b.kind==="source"||C||I){const D=l1(d,T,"source");this.binders[d]=I?new sl(b,y,T,D,e.id):new ya(b,y,T,D),u.push(`/a_${d}`)}else{const D=l1(d,T,"composite");this.binders[d]=new oo(b,y,T,E,n,D),u.push(`/z_${d}`)}else this.binders[d]=I?new Tu(b.value,y):new yd(b.value,y,T),u.push(`/u_${d}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof ya||n instanceof oo?n.maxValue:0}populatePaintArrays(e,n,a,u,d,p,y){for(const b in this.binders){const T=this.binders[b];(T instanceof ya||T instanceof oo||T instanceof sl)&&T.populatePaintArray(e,n,a,u,d,p,y)}}setConstantPatternPositions(e){for(const n in this.binders){const a=this.binders[n];a instanceof Tu&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,n,a,u,d,p,y,b){let T=!1;const E=Object.keys(e),I=E.length!==0,C=I?E:n.uniqueIds;for(const D in this.binders){const R=this.binders[D];if((R instanceof ya||R instanceof oo||R instanceof sl)&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){const B=d.paint.get(D);R.expression=B.value;for(const V of C){const G=e[V.toString()];n.eachPosition(V,($,te,se)=>{const le=u.feature($);R.updatePaintArray(te,se,le,G,p,y,b)})}if(!I)for(const V of a.uniqueIds){const G=e[V.toString()];a.eachPosition(V,($,te,se)=>{const le=u.feature($);R.updatePaintArray(te,se,le,G,p,y,b)})}T=!0}}return T}defines(){const e=[];for(const n in this.binders){const a=this.binders[n];(a instanceof yd||a instanceof Tu)&&e.push(...a.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof ya||a instanceof oo||a instanceof sl)for(let u=0;u<a.paintVertexAttributes.length;u++)e.push(a.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof yd||a instanceof Tu||a instanceof oo)for(const u of a.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof yd||u instanceof Tu||u instanceof oo)for(const d of u.uniformNames)n.push({name:d,property:a,binding:u.getBinding(e,d)})}return n}setUniforms(e,n,a,u,d){for(const{name:p,property:y,binding:b}of a)this.binders[y].setUniform(e,b,d,u.get(y),p)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof ya||n instanceof oo||n instanceof sl)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const n in this.binders){const a=this.binders[n];(a instanceof ya||a instanceof oo||a instanceof sl)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof ya||n instanceof oo||n instanceof sl)&&n.destroy()}}}class ol{constructor(e,n,a=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new sc(u,n,a);this.needsUpload=!1,this._featureMap=new gd,this._featureMapWithoutIds=new gd,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,a,u,d,p,y,b){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(e,n,u,d,p,y,b);n.id!==void 0?this._featureMap.add(n.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,a,u,d,p){for(const y of a)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,y,u,d,p||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const uC={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function hC(t,e){return uC[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const dC={"line-pattern":{source:Bi,composite:Bi},"fill-pattern":{source:Bi,composite:Bi},"fill-extrusion-pattern":{source:Bi,composite:Bi},"line-dasharray":{source:Vi,composite:Vi}},fC={color:{source:md,composite:Xi},number:{source:so,composite:md}};function l1(t,e,n){const a=dC[t];return a&&a[n]||fC[e][n]}Bt(yd,"ConstantBinder"),Bt(Tu,"PatternConstantBinder"),Bt(ya,"SourceExpressionBinder"),Bt(sl,"PatternCompositeBinder"),Bt(oo,"CompositeExpressionBinder"),Bt(sc,"ProgramConfiguration",{omit:["_buffers"]}),Bt(ol,"ProgramConfigurationSet");class al{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Yi?new Yi(e.lng,e.lat):Yi.convert(e),this}setSouthWest(e){return this._sw=e instanceof Yi?new Yi(e.lng,e.lat):Yi.convert(e),this}extend(e){const n=this._sw,a=this._ne;let u,d;if(e instanceof Yi)u=e,d=e;else{if(!(e instanceof al))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(al.convert(e)):this.extend(Yi.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Yi.convert(e)):this;if(u=e._sw,d=e._ne,!u||!d)return this}return n||a?(n.lng=Math.min(u.lng,n.lng),n.lat=Math.min(u.lat,n.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new Yi(u.lng,u.lat),this._ne=new Yi(d.lng,d.lat)),this}getCenter(){return new Yi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Yi(this.getWest(),this.getNorth())}getSouthEast(){return new Yi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:a}=Yi.convert(e);let u=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u}static convert(e){return!e||e instanceof al?e:new al(e)}}var ur={},hr={};Object.defineProperty(hr,"__esModule",{value:!0}),hr.setMatrixArrayType=function(t){hr.ARRAY_TYPE=u1=t},hr.toRadian=function(t){return t*mC},hr.equals=function(t,e){return Math.abs(t-e)<=c1*Math.max(1,Math.abs(t),Math.abs(e))},hr.RANDOM=hr.ARRAY_TYPE=hr.EPSILON=void 0;var c1=1e-6;hr.EPSILON=c1;var u1=typeof Float32Array<"u"?Float32Array:Array;hr.ARRAY_TYPE=u1;var pC=Math.random;hr.RANDOM=pC;var mC=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Mn={};function yy(t){return yy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yy(t)}Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.create=function(){var t=new ll.ARRAY_TYPE(4);return ll.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Mn.clone=function(t){var e=new ll.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Mn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Mn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Mn.fromValues=function(t,e,n,a){var u=new ll.ARRAY_TYPE(4);return u[0]=t,u[1]=e,u[2]=n,u[3]=a,u},Mn.set=function(t,e,n,a,u){return t[0]=e,t[1]=n,t[2]=a,t[3]=u,t},Mn.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Mn.invert=function(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=n*d-u*a;return p?(t[0]=d*(p=1/p),t[1]=-a*p,t[2]=-u*p,t[3]=n*p,t):null},Mn.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},Mn.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Mn.multiply=d1,Mn.rotate=function(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],y=Math.sin(n),b=Math.cos(n);return t[0]=a*b+d*y,t[1]=u*b+p*y,t[2]=a*-y+d*b,t[3]=u*-y+p*b,t},Mn.scale=function(t,e,n){var a=e[1],u=e[2],d=e[3],p=n[0],y=n[1];return t[0]=e[0]*p,t[1]=a*p,t[2]=u*y,t[3]=d*y,t},Mn.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=-n,t[3]=a,t},Mn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Mn.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Mn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Mn.LDU=function(t,e,n,a){return t[2]=a[2]/a[0],n[0]=a[0],n[1]=a[1],n[3]=a[3]-t[2]*n[1],[t,e,n]},Mn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Mn.subtract=f1,Mn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Mn.equals=function(t,e){var n=t[0],a=t[1],u=t[2],d=t[3],p=e[0],y=e[1],b=e[2],T=e[3];return Math.abs(n-p)<=ll.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-y)<=ll.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(u-b)<=ll.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(d-T)<=ll.EPSILON*Math.max(1,Math.abs(d),Math.abs(T))},Mn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Mn.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t},Mn.sub=Mn.mul=void 0;var ll=function(t,e){if(t&&t.__esModule)return t;if(t===null||yy(t)!=="object"&&typeof t!="function")return{default:t};var n=h1(void 0);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(hr);function h1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(h1=function(a){return a?n:e})(t)}function d1(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],y=n[0],b=n[1],T=n[2],E=n[3];return t[0]=a*y+d*b,t[1]=u*y+p*b,t[2]=a*T+d*E,t[3]=u*T+p*E,t}function f1(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}Mn.mul=d1,Mn.sub=f1;var En={};function xy(t){return xy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xy(t)}Object.defineProperty(En,"__esModule",{value:!0}),En.create=function(){var t=new Fo.ARRAY_TYPE(6);return Fo.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},En.clone=function(t){var e=new Fo.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},En.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},En.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},En.fromValues=function(t,e,n,a,u,d){var p=new Fo.ARRAY_TYPE(6);return p[0]=t,p[1]=e,p[2]=n,p[3]=a,p[4]=u,p[5]=d,p},En.set=function(t,e,n,a,u,d,p){return t[0]=e,t[1]=n,t[2]=a,t[3]=u,t[4]=d,t[5]=p,t},En.invert=function(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=e[4],y=e[5],b=n*d-a*u;return b?(t[0]=d*(b=1/b),t[1]=-a*b,t[2]=-u*b,t[3]=n*b,t[4]=(u*y-d*p)*b,t[5]=(a*p-n*y)*b,t):null},En.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},En.multiply=m1,En.rotate=function(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],y=e[4],b=e[5],T=Math.sin(n),E=Math.cos(n);return t[0]=a*E+d*T,t[1]=u*E+p*T,t[2]=a*-T+d*E,t[3]=u*-T+p*E,t[4]=y,t[5]=b,t},En.scale=function(t,e,n){var a=e[1],u=e[2],d=e[3],p=e[4],y=e[5],b=n[0],T=n[1];return t[0]=e[0]*b,t[1]=a*b,t[2]=u*T,t[3]=d*T,t[4]=p,t[5]=y,t},En.translate=function(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],y=e[4],b=e[5],T=n[0],E=n[1];return t[0]=a,t[1]=u,t[2]=d,t[3]=p,t[4]=a*T+d*E+y,t[5]=u*T+p*E+b,t},En.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=-n,t[3]=a,t[4]=0,t[5]=0,t},En.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},En.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},En.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},En.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},En.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},En.subtract=g1,En.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},En.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t},En.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},En.equals=function(t,e){var n=t[0],a=t[1],u=t[2],d=t[3],p=t[4],y=t[5],b=e[0],T=e[1],E=e[2],I=e[3],C=e[4],D=e[5];return Math.abs(n-b)<=Fo.EPSILON*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(a-T)<=Fo.EPSILON*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(u-E)<=Fo.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(d-I)<=Fo.EPSILON*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(p-C)<=Fo.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(y-D)<=Fo.EPSILON*Math.max(1,Math.abs(y),Math.abs(D))},En.sub=En.mul=void 0;var Fo=function(t,e){if(t&&t.__esModule)return t;if(t===null||xy(t)!=="object"&&typeof t!="function")return{default:t};var n=p1(void 0);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(hr);function p1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(p1=function(a){return a?n:e})(t)}function m1(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],y=e[4],b=e[5],T=n[0],E=n[1],I=n[2],C=n[3],D=n[4],R=n[5];return t[0]=a*T+d*E,t[1]=u*T+p*E,t[2]=a*I+d*C,t[3]=u*I+p*C,t[4]=a*D+d*R+y,t[5]=u*D+p*R+b,t}function g1(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}En.mul=m1,En.sub=g1;var nn={};function vy(t){return vy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vy(t)}Object.defineProperty(nn,"__esModule",{value:!0}),nn.create=function(){var t=new ks.ARRAY_TYPE(9);return ks.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},nn.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},nn.clone=function(t){var e=new ks.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},nn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},nn.fromValues=function(t,e,n,a,u,d,p,y,b){var T=new ks.ARRAY_TYPE(9);return T[0]=t,T[1]=e,T[2]=n,T[3]=a,T[4]=u,T[5]=d,T[6]=p,T[7]=y,T[8]=b,T},nn.set=function(t,e,n,a,u,d,p,y,b,T){return t[0]=e,t[1]=n,t[2]=a,t[3]=u,t[4]=d,t[5]=p,t[6]=y,t[7]=b,t[8]=T,t},nn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},nn.transpose=function(t,e){if(t===e){var n=e[1],a=e[2],u=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=a,t[7]=u}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},nn.invert=function(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=e[4],y=e[5],b=e[6],T=e[7],E=e[8],I=E*p-y*T,C=-E*d+y*b,D=T*d-p*b,R=n*I+a*C+u*D;return R?(t[0]=I*(R=1/R),t[1]=(-E*a+u*T)*R,t[2]=(y*a-u*p)*R,t[3]=C*R,t[4]=(E*n-u*b)*R,t[5]=(-y*n+u*d)*R,t[6]=D*R,t[7]=(-T*n+a*b)*R,t[8]=(p*n-a*d)*R,t):null},nn.adjoint=function(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=e[4],y=e[5],b=e[6],T=e[7],E=e[8];return t[0]=p*E-y*T,t[1]=u*T-a*E,t[2]=a*y-u*p,t[3]=y*b-d*E,t[4]=n*E-u*b,t[5]=u*d-n*y,t[6]=d*T-p*b,t[7]=a*b-n*T,t[8]=n*p-a*d,t},nn.determinant=function(t){var e=t[3],n=t[4],a=t[5],u=t[6],d=t[7],p=t[8];return t[0]*(p*n-a*d)+t[1]*(-p*e+a*u)+t[2]*(d*e-n*u)},nn.multiply=y1,nn.translate=function(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=e[8],C=n[0],D=n[1];return t[0]=a,t[1]=u,t[2]=d,t[3]=p,t[4]=y,t[5]=b,t[6]=C*a+D*p+T,t[7]=C*u+D*y+E,t[8]=C*d+D*b+I,t},nn.rotate=function(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=e[8],C=Math.sin(n),D=Math.cos(n);return t[0]=D*a+C*p,t[1]=D*u+C*y,t[2]=D*d+C*b,t[3]=D*p-C*a,t[4]=D*y-C*u,t[5]=D*b-C*d,t[6]=T,t[7]=E,t[8]=I,t},nn.scale=function(t,e,n){var a=n[0],u=n[1];return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=u*e[3],t[4]=u*e[4],t[5]=u*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},nn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},nn.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=0,t[3]=-n,t[4]=a,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},nn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},nn.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},nn.fromQuat=function(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=n+n,y=a+a,b=u+u,T=n*p,E=a*p,I=a*y,C=u*p,D=u*y,R=u*b,B=d*p,V=d*y,G=d*b;return t[0]=1-I-R,t[3]=E-G,t[6]=C+V,t[1]=E+G,t[4]=1-T-R,t[7]=D-B,t[2]=C-V,t[5]=D+B,t[8]=1-T-I,t},nn.normalFromMat4=function(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=e[4],y=e[5],b=e[6],T=e[7],E=e[8],I=e[9],C=e[10],D=e[11],R=e[12],B=e[13],V=e[14],G=e[15],$=n*y-a*p,te=n*b-u*p,se=n*T-d*p,le=a*b-u*y,he=a*T-d*y,ye=u*T-d*b,we=E*B-I*R,Ie=E*V-C*R,Le=E*G-D*R,Pe=I*V-C*B,Ge=I*G-D*B,ct=C*G-D*V,Ve=$*ct-te*Ge+se*Pe+le*Le-he*Ie+ye*we;return Ve?(t[0]=(y*ct-b*Ge+T*Pe)*(Ve=1/Ve),t[1]=(b*Le-p*ct-T*Ie)*Ve,t[2]=(p*Ge-y*Le+T*we)*Ve,t[3]=(u*Ge-a*ct-d*Pe)*Ve,t[4]=(n*ct-u*Le+d*Ie)*Ve,t[5]=(a*Le-n*Ge-d*we)*Ve,t[6]=(B*ye-V*he+G*le)*Ve,t[7]=(V*se-R*ye-G*te)*Ve,t[8]=(R*he-B*se+G*$)*Ve,t):null},nn.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},nn.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},nn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},nn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},nn.subtract=x1,nn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},nn.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t[6]=e[6]+n[6]*a,t[7]=e[7]+n[7]*a,t[8]=e[8]+n[8]*a,t},nn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},nn.equals=function(t,e){var n=t[0],a=t[1],u=t[2],d=t[3],p=t[4],y=t[5],b=t[6],T=t[7],E=t[8],I=e[0],C=e[1],D=e[2],R=e[3],B=e[4],V=e[5],G=e[6],$=e[7],te=e[8];return Math.abs(n-I)<=ks.EPSILON*Math.max(1,Math.abs(n),Math.abs(I))&&Math.abs(a-C)<=ks.EPSILON*Math.max(1,Math.abs(a),Math.abs(C))&&Math.abs(u-D)<=ks.EPSILON*Math.max(1,Math.abs(u),Math.abs(D))&&Math.abs(d-R)<=ks.EPSILON*Math.max(1,Math.abs(d),Math.abs(R))&&Math.abs(p-B)<=ks.EPSILON*Math.max(1,Math.abs(p),Math.abs(B))&&Math.abs(y-V)<=ks.EPSILON*Math.max(1,Math.abs(y),Math.abs(V))&&Math.abs(b-G)<=ks.EPSILON*Math.max(1,Math.abs(b),Math.abs(G))&&Math.abs(T-$)<=ks.EPSILON*Math.max(1,Math.abs(T),Math.abs($))&&Math.abs(E-te)<=ks.EPSILON*Math.max(1,Math.abs(E),Math.abs(te))},nn.sub=nn.mul=void 0;var ks=function(t,e){if(t&&t.__esModule)return t;if(t===null||vy(t)!=="object"&&typeof t!="function")return{default:t};var n=_1(void 0);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(hr);function _1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(_1=function(a){return a?n:e})(t)}function y1(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=e[8],C=n[0],D=n[1],R=n[2],B=n[3],V=n[4],G=n[5],$=n[6],te=n[7],se=n[8];return t[0]=C*a+D*p+R*T,t[1]=C*u+D*y+R*E,t[2]=C*d+D*b+R*I,t[3]=B*a+V*p+G*T,t[4]=B*u+V*y+G*E,t[5]=B*d+V*b+G*I,t[6]=$*a+te*p+se*T,t[7]=$*u+te*y+se*E,t[8]=$*d+te*b+se*I,t}function x1(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}nn.mul=y1,nn.sub=x1;var gi={};function by(t){return by=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},by(t)}Object.defineProperty(gi,"__esModule",{value:!0}),gi.create=function(){var t=new Rn.ARRAY_TYPE(16);return Rn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},gi.clone=function(t){var e=new Rn.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},gi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},gi.fromValues=function(t,e,n,a,u,d,p,y,b,T,E,I,C,D,R,B){var V=new Rn.ARRAY_TYPE(16);return V[0]=t,V[1]=e,V[2]=n,V[3]=a,V[4]=u,V[5]=d,V[6]=p,V[7]=y,V[8]=b,V[9]=T,V[10]=E,V[11]=I,V[12]=C,V[13]=D,V[14]=R,V[15]=B,V},gi.set=function(t,e,n,a,u,d,p,y,b,T,E,I,C,D,R,B,V){return t[0]=e,t[1]=n,t[2]=a,t[3]=u,t[4]=d,t[5]=p,t[6]=y,t[7]=b,t[8]=T,t[9]=E,t[10]=I,t[11]=C,t[12]=D,t[13]=R,t[14]=B,t[15]=V,t},gi.identity=b1,gi.transpose=function(t,e){if(t===e){var n=e[1],a=e[2],u=e[3],d=e[6],p=e[7],y=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=a,t[9]=d,t[11]=e[14],t[12]=u,t[13]=p,t[14]=y}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},gi.invert=function(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=e[4],y=e[5],b=e[6],T=e[7],E=e[8],I=e[9],C=e[10],D=e[11],R=e[12],B=e[13],V=e[14],G=e[15],$=n*y-a*p,te=n*b-u*p,se=n*T-d*p,le=a*b-u*y,he=a*T-d*y,ye=u*T-d*b,we=E*B-I*R,Ie=E*V-C*R,Le=E*G-D*R,Pe=I*V-C*B,Ge=I*G-D*B,ct=C*G-D*V,Ve=$*ct-te*Ge+se*Pe+le*Le-he*Ie+ye*we;return Ve?(t[0]=(y*ct-b*Ge+T*Pe)*(Ve=1/Ve),t[1]=(u*Ge-a*ct-d*Pe)*Ve,t[2]=(B*ye-V*he+G*le)*Ve,t[3]=(C*he-I*ye-D*le)*Ve,t[4]=(b*Le-p*ct-T*Ie)*Ve,t[5]=(n*ct-u*Le+d*Ie)*Ve,t[6]=(V*se-R*ye-G*te)*Ve,t[7]=(E*ye-C*se+D*te)*Ve,t[8]=(p*Ge-y*Le+T*we)*Ve,t[9]=(a*Le-n*Ge-d*we)*Ve,t[10]=(R*he-B*se+G*$)*Ve,t[11]=(I*se-E*he-D*$)*Ve,t[12]=(y*Ie-p*Pe-b*we)*Ve,t[13]=(n*Pe-a*Ie+u*we)*Ve,t[14]=(B*te-R*le-V*$)*Ve,t[15]=(E*le-I*te+C*$)*Ve,t):null},gi.adjoint=function(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=e[4],y=e[5],b=e[6],T=e[7],E=e[8],I=e[9],C=e[10],D=e[11],R=e[12],B=e[13],V=e[14],G=e[15];return t[0]=y*(C*G-D*V)-I*(b*G-T*V)+B*(b*D-T*C),t[1]=-(a*(C*G-D*V)-I*(u*G-d*V)+B*(u*D-d*C)),t[2]=a*(b*G-T*V)-y*(u*G-d*V)+B*(u*T-d*b),t[3]=-(a*(b*D-T*C)-y*(u*D-d*C)+I*(u*T-d*b)),t[4]=-(p*(C*G-D*V)-E*(b*G-T*V)+R*(b*D-T*C)),t[5]=n*(C*G-D*V)-E*(u*G-d*V)+R*(u*D-d*C),t[6]=-(n*(b*G-T*V)-p*(u*G-d*V)+R*(u*T-d*b)),t[7]=n*(b*D-T*C)-p*(u*D-d*C)+E*(u*T-d*b),t[8]=p*(I*G-D*B)-E*(y*G-T*B)+R*(y*D-T*I),t[9]=-(n*(I*G-D*B)-E*(a*G-d*B)+R*(a*D-d*I)),t[10]=n*(y*G-T*B)-p*(a*G-d*B)+R*(a*T-d*y),t[11]=-(n*(y*D-T*I)-p*(a*D-d*I)+E*(a*T-d*y)),t[12]=-(p*(I*V-C*B)-E*(y*V-b*B)+R*(y*C-b*I)),t[13]=n*(I*V-C*B)-E*(a*V-u*B)+R*(a*C-u*I),t[14]=-(n*(y*V-b*B)-p*(a*V-u*B)+R*(a*b-u*y)),t[15]=n*(y*C-b*I)-p*(a*C-u*I)+E*(a*b-u*y),t},gi.determinant=function(t){var e=t[0],n=t[1],a=t[2],u=t[3],d=t[4],p=t[5],y=t[6],b=t[7],T=t[8],E=t[9],I=t[10],C=t[11],D=t[12],R=t[13],B=t[14],V=t[15];return(e*p-n*d)*(I*V-C*B)-(e*y-a*d)*(E*V-C*R)+(e*b-u*d)*(E*B-I*R)+(n*y-a*p)*(T*V-C*D)-(n*b-u*p)*(T*B-I*D)+(a*b-u*y)*(T*R-E*D)},gi.multiply=w1,gi.translate=function(t,e,n){var a,u,d,p,y,b,T,E,I,C,D,R,B=n[0],V=n[1],G=n[2];return e===t?(t[12]=e[0]*B+e[4]*V+e[8]*G+e[12],t[13]=e[1]*B+e[5]*V+e[9]*G+e[13],t[14]=e[2]*B+e[6]*V+e[10]*G+e[14],t[15]=e[3]*B+e[7]*V+e[11]*G+e[15]):(u=e[1],d=e[2],p=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=e[8],C=e[9],D=e[10],R=e[11],t[0]=a=e[0],t[1]=u,t[2]=d,t[3]=p,t[4]=y,t[5]=b,t[6]=T,t[7]=E,t[8]=I,t[9]=C,t[10]=D,t[11]=R,t[12]=a*B+y*V+I*G+e[12],t[13]=u*B+b*V+C*G+e[13],t[14]=d*B+T*V+D*G+e[14],t[15]=p*B+E*V+R*G+e[15]),t},gi.scale=function(t,e,n){var a=n[0],u=n[1],d=n[2];return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*u,t[5]=e[5]*u,t[6]=e[6]*u,t[7]=e[7]*u,t[8]=e[8]*d,t[9]=e[9]*d,t[10]=e[10]*d,t[11]=e[11]*d,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},gi.rotate=function(t,e,n,a){var u,d,p,y,b,T,E,I,C,D,R,B,V,G,$,te,se,le,he,ye,we,Ie,Le,Pe,Ge=a[0],ct=a[1],Ve=a[2],rt=Math.hypot(Ge,ct,Ve);return rt<Rn.EPSILON?null:(Ge*=rt=1/rt,ct*=rt,Ve*=rt,u=Math.sin(n),d=Math.cos(n),b=e[1],T=e[2],E=e[3],C=e[5],D=e[6],R=e[7],V=e[9],G=e[10],$=e[11],he=Ge*ct*(p=1-d)-Ve*u,ye=ct*ct*p+d,we=Ve*ct*p+Ge*u,Ie=Ge*Ve*p+ct*u,Le=ct*Ve*p-Ge*u,Pe=Ve*Ve*p+d,t[0]=(y=e[0])*(te=Ge*Ge*p+d)+(I=e[4])*(se=ct*Ge*p+Ve*u)+(B=e[8])*(le=Ve*Ge*p-ct*u),t[1]=b*te+C*se+V*le,t[2]=T*te+D*se+G*le,t[3]=E*te+R*se+$*le,t[4]=y*he+I*ye+B*we,t[5]=b*he+C*ye+V*we,t[6]=T*he+D*ye+G*we,t[7]=E*he+R*ye+$*we,t[8]=y*Ie+I*Le+B*Pe,t[9]=b*Ie+C*Le+V*Pe,t[10]=T*Ie+D*Le+G*Pe,t[11]=E*Ie+R*Le+$*Pe,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},gi.rotateX=function(t,e,n){var a=Math.sin(n),u=Math.cos(n),d=e[4],p=e[5],y=e[6],b=e[7],T=e[8],E=e[9],I=e[10],C=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=d*u+T*a,t[5]=p*u+E*a,t[6]=y*u+I*a,t[7]=b*u+C*a,t[8]=T*u-d*a,t[9]=E*u-p*a,t[10]=I*u-y*a,t[11]=C*u-b*a,t},gi.rotateY=function(t,e,n){var a=Math.sin(n),u=Math.cos(n),d=e[0],p=e[1],y=e[2],b=e[3],T=e[8],E=e[9],I=e[10],C=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*u-T*a,t[1]=p*u-E*a,t[2]=y*u-I*a,t[3]=b*u-C*a,t[8]=d*a+T*u,t[9]=p*a+E*u,t[10]=y*a+I*u,t[11]=b*a+C*u,t},gi.rotateZ=function(t,e,n){var a=Math.sin(n),u=Math.cos(n),d=e[0],p=e[1],y=e[2],b=e[3],T=e[4],E=e[5],I=e[6],C=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*u+T*a,t[1]=p*u+E*a,t[2]=y*u+I*a,t[3]=b*u+C*a,t[4]=T*u-d*a,t[5]=E*u-p*a,t[6]=I*u-y*a,t[7]=C*u-b*a,t},gi.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},gi.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},gi.fromRotation=function(t,e,n){var a,u,d,p=n[0],y=n[1],b=n[2],T=Math.hypot(p,y,b);return T<Rn.EPSILON?null:(p*=T=1/T,y*=T,b*=T,a=Math.sin(e),u=Math.cos(e),t[0]=p*p*(d=1-u)+u,t[1]=y*p*d+b*a,t[2]=b*p*d-y*a,t[3]=0,t[4]=p*y*d-b*a,t[5]=y*y*d+u,t[6]=b*y*d+p*a,t[7]=0,t[8]=p*b*d+y*a,t[9]=y*b*d-p*a,t[10]=b*b*d+u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},gi.fromXRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},gi.fromYRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},gi.fromZRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},gi.fromRotationTranslation=T1,gi.fromQuat2=function(t,e){var n=new Rn.ARRAY_TYPE(3),a=-e[0],u=-e[1],d=-e[2],p=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=a*a+u*u+d*d+p*p;return I>0?(n[0]=2*(y*p+E*a+b*d-T*u)/I,n[1]=2*(b*p+E*u+T*a-y*d)/I,n[2]=2*(T*p+E*d+y*u-b*a)/I):(n[0]=2*(y*p+E*a+b*d-T*u),n[1]=2*(b*p+E*u+T*a-y*d),n[2]=2*(T*p+E*d+y*u-b*a)),T1(t,e,n),t},gi.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},gi.getScaling=M1,gi.getRotation=function(t,e){var n=new Rn.ARRAY_TYPE(3);M1(n,e);var a=1/n[0],u=1/n[1],d=1/n[2],p=e[0]*a,y=e[1]*u,b=e[2]*d,T=e[4]*a,E=e[5]*u,I=e[6]*d,C=e[8]*a,D=e[9]*u,R=e[10]*d,B=p+E+R,V=0;return B>0?(V=2*Math.sqrt(B+1),t[3]=.25*V,t[0]=(I-D)/V,t[1]=(C-b)/V,t[2]=(y-T)/V):p>E&&p>R?(V=2*Math.sqrt(1+p-E-R),t[3]=(I-D)/V,t[0]=.25*V,t[1]=(y+T)/V,t[2]=(C+b)/V):E>R?(V=2*Math.sqrt(1+E-p-R),t[3]=(C-b)/V,t[0]=(y+T)/V,t[1]=.25*V,t[2]=(I+D)/V):(V=2*Math.sqrt(1+R-p-E),t[3]=(y-T)/V,t[0]=(C+b)/V,t[1]=(I+D)/V,t[2]=.25*V),t},gi.fromRotationTranslationScale=function(t,e,n,a){var u=e[0],d=e[1],p=e[2],y=e[3],b=u+u,T=d+d,E=p+p,I=u*b,C=u*T,D=u*E,R=d*T,B=d*E,V=p*E,G=y*b,$=y*T,te=y*E,se=a[0],le=a[1],he=a[2];return t[0]=(1-(R+V))*se,t[1]=(C+te)*se,t[2]=(D-$)*se,t[3]=0,t[4]=(C-te)*le,t[5]=(1-(I+V))*le,t[6]=(B+G)*le,t[7]=0,t[8]=(D+$)*he,t[9]=(B-G)*he,t[10]=(1-(I+R))*he,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},gi.fromRotationTranslationScaleOrigin=function(t,e,n,a,u){var d=e[0],p=e[1],y=e[2],b=e[3],T=d+d,E=p+p,I=y+y,C=d*T,D=d*E,R=d*I,B=p*E,V=p*I,G=y*I,$=b*T,te=b*E,se=b*I,le=a[0],he=a[1],ye=a[2],we=u[0],Ie=u[1],Le=u[2],Pe=(1-(B+G))*le,Ge=(D+se)*le,ct=(R-te)*le,Ve=(D-se)*he,rt=(1-(C+G))*he,Ne=(V+$)*he,wt=(R+te)*ye,Ot=(V-$)*ye,lt=(1-(C+B))*ye;return t[0]=Pe,t[1]=Ge,t[2]=ct,t[3]=0,t[4]=Ve,t[5]=rt,t[6]=Ne,t[7]=0,t[8]=wt,t[9]=Ot,t[10]=lt,t[11]=0,t[12]=n[0]+we-(Pe*we+Ve*Ie+wt*Le),t[13]=n[1]+Ie-(Ge*we+rt*Ie+Ot*Le),t[14]=n[2]+Le-(ct*we+Ne*Ie+lt*Le),t[15]=1,t},gi.fromQuat=function(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=n+n,y=a+a,b=u+u,T=n*p,E=a*p,I=a*y,C=u*p,D=u*y,R=u*b,B=d*p,V=d*y,G=d*b;return t[0]=1-I-R,t[1]=E+G,t[2]=C-V,t[3]=0,t[4]=E-G,t[5]=1-T-R,t[6]=D+B,t[7]=0,t[8]=C+V,t[9]=D-B,t[10]=1-T-I,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},gi.frustum=function(t,e,n,a,u,d,p){var y=1/(n-e),b=1/(u-a),T=1/(d-p);return t[0]=2*d*y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*d*b,t[6]=0,t[7]=0,t[8]=(n+e)*y,t[9]=(u+a)*b,t[10]=(p+d)*T,t[11]=-1,t[12]=0,t[13]=0,t[14]=p*d*2*T,t[15]=0,t},gi.perspectiveNO=S1,gi.perspectiveZO=function(t,e,n,a,u){var d,p=1/Math.tan(e/2);return t[0]=p/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,u!=null&&u!==1/0?(t[10]=u*(d=1/(a-u)),t[14]=u*a*d):(t[10]=-1,t[14]=-a),t},gi.perspectiveFromFieldOfView=function(t,e,n,a){var u=Math.tan(e.upDegrees*Math.PI/180),d=Math.tan(e.downDegrees*Math.PI/180),p=Math.tan(e.leftDegrees*Math.PI/180),y=Math.tan(e.rightDegrees*Math.PI/180),b=2/(p+y),T=2/(u+d);return t[0]=b,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=T,t[6]=0,t[7]=0,t[8]=-(p-y)*b*.5,t[9]=(u-d)*T*.5,t[10]=a/(n-a),t[11]=-1,t[12]=0,t[13]=0,t[14]=a*n/(n-a),t[15]=0,t},gi.orthoNO=E1,gi.orthoZO=function(t,e,n,a,u,d,p){var y=1/(e-n),b=1/(a-u),T=1/(d-p);return t[0]=-2*y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*b,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=T,t[11]=0,t[12]=(e+n)*y,t[13]=(u+a)*b,t[14]=d*T,t[15]=1,t},gi.lookAt=function(t,e,n,a){var u,d,p,y,b,T,E,I,C,D,R=e[0],B=e[1],V=e[2],G=a[0],$=a[1],te=a[2],se=n[0],le=n[1],he=n[2];return Math.abs(R-se)<Rn.EPSILON&&Math.abs(B-le)<Rn.EPSILON&&Math.abs(V-he)<Rn.EPSILON?b1(t):(E=R-se,I=B-le,C=V-he,u=$*(C*=D=1/Math.hypot(E,I,C))-te*(I*=D),d=te*(E*=D)-G*C,p=G*I-$*E,(D=Math.hypot(u,d,p))?(u*=D=1/D,d*=D,p*=D):(u=0,d=0,p=0),y=I*p-C*d,b=C*u-E*p,T=E*d-I*u,(D=Math.hypot(y,b,T))?(y*=D=1/D,b*=D,T*=D):(y=0,b=0,T=0),t[0]=u,t[1]=y,t[2]=E,t[3]=0,t[4]=d,t[5]=b,t[6]=I,t[7]=0,t[8]=p,t[9]=T,t[10]=C,t[11]=0,t[12]=-(u*R+d*B+p*V),t[13]=-(y*R+b*B+T*V),t[14]=-(E*R+I*B+C*V),t[15]=1,t)},gi.targetTo=function(t,e,n,a){var u=e[0],d=e[1],p=e[2],y=a[0],b=a[1],T=a[2],E=u-n[0],I=d-n[1],C=p-n[2],D=E*E+I*I+C*C;D>0&&(E*=D=1/Math.sqrt(D),I*=D,C*=D);var R=b*C-T*I,B=T*E-y*C,V=y*I-b*E;return(D=R*R+B*B+V*V)>0&&(R*=D=1/Math.sqrt(D),B*=D,V*=D),t[0]=R,t[1]=B,t[2]=V,t[3]=0,t[4]=I*V-C*B,t[5]=C*R-E*V,t[6]=E*B-I*R,t[7]=0,t[8]=E,t[9]=I,t[10]=C,t[11]=0,t[12]=u,t[13]=d,t[14]=p,t[15]=1,t},gi.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},gi.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},gi.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},gi.subtract=A1,gi.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},gi.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t[6]=e[6]+n[6]*a,t[7]=e[7]+n[7]*a,t[8]=e[8]+n[8]*a,t[9]=e[9]+n[9]*a,t[10]=e[10]+n[10]*a,t[11]=e[11]+n[11]*a,t[12]=e[12]+n[12]*a,t[13]=e[13]+n[13]*a,t[14]=e[14]+n[14]*a,t[15]=e[15]+n[15]*a,t},gi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},gi.equals=function(t,e){var n=t[0],a=t[1],u=t[2],d=t[3],p=t[4],y=t[5],b=t[6],T=t[7],E=t[8],I=t[9],C=t[10],D=t[11],R=t[12],B=t[13],V=t[14],G=t[15],$=e[0],te=e[1],se=e[2],le=e[3],he=e[4],ye=e[5],we=e[6],Ie=e[7],Le=e[8],Pe=e[9],Ge=e[10],ct=e[11],Ve=e[12],rt=e[13],Ne=e[14],wt=e[15];return Math.abs(n-$)<=Rn.EPSILON*Math.max(1,Math.abs(n),Math.abs($))&&Math.abs(a-te)<=Rn.EPSILON*Math.max(1,Math.abs(a),Math.abs(te))&&Math.abs(u-se)<=Rn.EPSILON*Math.max(1,Math.abs(u),Math.abs(se))&&Math.abs(d-le)<=Rn.EPSILON*Math.max(1,Math.abs(d),Math.abs(le))&&Math.abs(p-he)<=Rn.EPSILON*Math.max(1,Math.abs(p),Math.abs(he))&&Math.abs(y-ye)<=Rn.EPSILON*Math.max(1,Math.abs(y),Math.abs(ye))&&Math.abs(b-we)<=Rn.EPSILON*Math.max(1,Math.abs(b),Math.abs(we))&&Math.abs(T-Ie)<=Rn.EPSILON*Math.max(1,Math.abs(T),Math.abs(Ie))&&Math.abs(E-Le)<=Rn.EPSILON*Math.max(1,Math.abs(E),Math.abs(Le))&&Math.abs(I-Pe)<=Rn.EPSILON*Math.max(1,Math.abs(I),Math.abs(Pe))&&Math.abs(C-Ge)<=Rn.EPSILON*Math.max(1,Math.abs(C),Math.abs(Ge))&&Math.abs(D-ct)<=Rn.EPSILON*Math.max(1,Math.abs(D),Math.abs(ct))&&Math.abs(R-Ve)<=Rn.EPSILON*Math.max(1,Math.abs(R),Math.abs(Ve))&&Math.abs(B-rt)<=Rn.EPSILON*Math.max(1,Math.abs(B),Math.abs(rt))&&Math.abs(V-Ne)<=Rn.EPSILON*Math.max(1,Math.abs(V),Math.abs(Ne))&&Math.abs(G-wt)<=Rn.EPSILON*Math.max(1,Math.abs(G),Math.abs(wt))},gi.sub=gi.mul=gi.ortho=gi.perspective=void 0;var Rn=function(t,e){if(t&&t.__esModule)return t;if(t===null||by(t)!=="object"&&typeof t!="function")return{default:t};var n=v1(void 0);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(hr);function v1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(v1=function(a){return a?n:e})(t)}function b1(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function w1(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=e[8],C=e[9],D=e[10],R=e[11],B=e[12],V=e[13],G=e[14],$=e[15],te=n[0],se=n[1],le=n[2],he=n[3];return t[0]=te*a+se*y+le*I+he*B,t[1]=te*u+se*b+le*C+he*V,t[2]=te*d+se*T+le*D+he*G,t[3]=te*p+se*E+le*R+he*$,t[4]=(te=n[4])*a+(se=n[5])*y+(le=n[6])*I+(he=n[7])*B,t[5]=te*u+se*b+le*C+he*V,t[6]=te*d+se*T+le*D+he*G,t[7]=te*p+se*E+le*R+he*$,t[8]=(te=n[8])*a+(se=n[9])*y+(le=n[10])*I+(he=n[11])*B,t[9]=te*u+se*b+le*C+he*V,t[10]=te*d+se*T+le*D+he*G,t[11]=te*p+se*E+le*R+he*$,t[12]=(te=n[12])*a+(se=n[13])*y+(le=n[14])*I+(he=n[15])*B,t[13]=te*u+se*b+le*C+he*V,t[14]=te*d+se*T+le*D+he*G,t[15]=te*p+se*E+le*R+he*$,t}function T1(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],y=a+a,b=u+u,T=d+d,E=a*y,I=a*b,C=a*T,D=u*b,R=u*T,B=d*T,V=p*y,G=p*b,$=p*T;return t[0]=1-(D+B),t[1]=I+$,t[2]=C-G,t[3]=0,t[4]=I-$,t[5]=1-(E+B),t[6]=R+V,t[7]=0,t[8]=C+G,t[9]=R-V,t[10]=1-(E+D),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function M1(t,e){var n=e[4],a=e[5],u=e[6],d=e[8],p=e[9],y=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,a,u),t[2]=Math.hypot(d,p,y),t}function S1(t,e,n,a,u){var d,p=1/Math.tan(e/2);return t[0]=p/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,u!=null&&u!==1/0?(t[10]=(u+a)*(d=1/(a-u)),t[14]=2*u*a*d):(t[10]=-1,t[14]=-2*a),t}function E1(t,e,n,a,u,d,p){var y=1/(e-n),b=1/(a-u),T=1/(d-p);return t[0]=-2*y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*b,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*T,t[11]=0,t[12]=(e+n)*y,t[13]=(u+a)*b,t[14]=(p+d)*T,t[15]=1,t}function A1(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}gi.perspective=S1,gi.ortho=E1,gi.mul=w1,gi.sub=A1;var li={},mi={};function wy(t){return wy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wy(t)}Object.defineProperty(mi,"__esModule",{value:!0}),mi.create=k1,mi.clone=function(t){var e=new xa.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},mi.length=C1,mi.fromValues=function(t,e,n){var a=new xa.ARRAY_TYPE(3);return a[0]=t,a[1]=e,a[2]=n,a},mi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},mi.set=function(t,e,n,a){return t[0]=e,t[1]=n,t[2]=a,t},mi.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},mi.subtract=P1,mi.multiply=D1,mi.divide=z1,mi.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},mi.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},mi.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},mi.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},mi.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},mi.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},mi.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t},mi.distance=L1,mi.squaredDistance=R1,mi.squaredLength=O1,mi.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},mi.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},mi.normalize=function(t,e){var n=e[0],a=e[1],u=e[2],d=n*n+a*a+u*u;return d>0&&(d=1/Math.sqrt(d)),t[0]=e[0]*d,t[1]=e[1]*d,t[2]=e[2]*d,t},mi.dot=B1,mi.cross=function(t,e,n){var a=e[0],u=e[1],d=e[2],p=n[0],y=n[1],b=n[2];return t[0]=u*b-d*y,t[1]=d*p-a*b,t[2]=a*y-u*p,t},mi.lerp=function(t,e,n,a){var u=e[0],d=e[1],p=e[2];return t[0]=u+a*(n[0]-u),t[1]=d+a*(n[1]-d),t[2]=p+a*(n[2]-p),t},mi.hermite=function(t,e,n,a,u,d){var p=d*d,y=p*(2*d-3)+1,b=p*(d-2)+d,T=p*(d-1),E=p*(3-2*d);return t[0]=e[0]*y+n[0]*b+a[0]*T+u[0]*E,t[1]=e[1]*y+n[1]*b+a[1]*T+u[1]*E,t[2]=e[2]*y+n[2]*b+a[2]*T+u[2]*E,t},mi.bezier=function(t,e,n,a,u,d){var p=1-d,y=p*p,b=d*d,T=y*p,E=3*d*y,I=3*b*p,C=b*d;return t[0]=e[0]*T+n[0]*E+a[0]*I+u[0]*C,t[1]=e[1]*T+n[1]*E+a[1]*I+u[1]*C,t[2]=e[2]*T+n[2]*E+a[2]*I+u[2]*C,t},mi.random=function(t,e){e=e||1;var n=2*xa.RANDOM()*Math.PI,a=2*xa.RANDOM()-1,u=Math.sqrt(1-a*a)*e;return t[0]=Math.cos(n)*u,t[1]=Math.sin(n)*u,t[2]=a*e,t},mi.transformMat4=function(t,e,n){var a=e[0],u=e[1],d=e[2],p=n[3]*a+n[7]*u+n[11]*d+n[15];return t[0]=(n[0]*a+n[4]*u+n[8]*d+n[12])/(p=p||1),t[1]=(n[1]*a+n[5]*u+n[9]*d+n[13])/p,t[2]=(n[2]*a+n[6]*u+n[10]*d+n[14])/p,t},mi.transformMat3=function(t,e,n){var a=e[0],u=e[1],d=e[2];return t[0]=a*n[0]+u*n[3]+d*n[6],t[1]=a*n[1]+u*n[4]+d*n[7],t[2]=a*n[2]+u*n[5]+d*n[8],t},mi.transformQuat=function(t,e,n){var a=n[0],u=n[1],d=n[2],p=e[0],y=e[1],b=e[2],T=u*b-d*y,E=d*p-a*b,I=a*y-u*p,C=u*I-d*E,D=d*T-a*I,R=a*E-u*T,B=2*n[3];return E*=B,I*=B,D*=2,R*=2,t[0]=p+(T*=B)+(C*=2),t[1]=y+E+D,t[2]=b+I+R,t},mi.rotateX=function(t,e,n,a){var u=[],d=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],d[0]=u[0],d[1]=u[1]*Math.cos(a)-u[2]*Math.sin(a),d[2]=u[1]*Math.sin(a)+u[2]*Math.cos(a),t[0]=d[0]+n[0],t[1]=d[1]+n[1],t[2]=d[2]+n[2],t},mi.rotateY=function(t,e,n,a){var u=[],d=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],d[0]=u[2]*Math.sin(a)+u[0]*Math.cos(a),d[1]=u[1],d[2]=u[2]*Math.cos(a)-u[0]*Math.sin(a),t[0]=d[0]+n[0],t[1]=d[1]+n[1],t[2]=d[2]+n[2],t},mi.rotateZ=function(t,e,n,a){var u=[],d=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],d[0]=u[0]*Math.cos(a)-u[1]*Math.sin(a),d[1]=u[0]*Math.sin(a)+u[1]*Math.cos(a),d[2]=u[2],t[0]=d[0]+n[0],t[1]=d[1]+n[1],t[2]=d[2]+n[2],t},mi.angle=function(t,e){var n=t[0],a=t[1],u=t[2],d=e[0],p=e[1],y=e[2],b=Math.sqrt(n*n+a*a+u*u)*Math.sqrt(d*d+p*p+y*y),T=b&&B1(t,e)/b;return Math.acos(Math.min(Math.max(T,-1),1))},mi.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},mi.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},mi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},mi.equals=function(t,e){var n=t[0],a=t[1],u=t[2],d=e[0],p=e[1],y=e[2];return Math.abs(n-d)<=xa.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-p)<=xa.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(u-y)<=xa.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))},mi.forEach=mi.sqrLen=mi.len=mi.sqrDist=mi.dist=mi.div=mi.mul=mi.sub=void 0;var xa=function(t,e){if(t&&t.__esModule)return t;if(t===null||wy(t)!=="object"&&typeof t!="function")return{default:t};var n=I1(void 0);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(hr);function I1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(I1=function(a){return a?n:e})(t)}function k1(){var t=new xa.ARRAY_TYPE(3);return xa.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function C1(t){return Math.hypot(t[0],t[1],t[2])}function P1(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function D1(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function z1(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function L1(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function R1(t,e){var n=e[0]-t[0],a=e[1]-t[1],u=e[2]-t[2];return n*n+a*a+u*u}function O1(t){var e=t[0],n=t[1],a=t[2];return e*e+n*n+a*a}function B1(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}mi.sub=P1,mi.mul=D1,mi.div=z1,mi.dist=L1,mi.sqrDist=R1,mi.len=C1,mi.sqrLen=O1;var va,gC=(va=k1(),function(t,e,n,a,u,d){var p,y;for(e||(e=3),n||(n=0),y=a?Math.min(a*e+n,t.length):t.length,p=n;p<y;p+=e)va[0]=t[p],va[1]=t[p+1],va[2]=t[p+2],u(va,va,d),t[p]=va[0],t[p+1]=va[1],t[p+2]=va[2];return t});mi.forEach=gC;var Si={};function Ty(t){return Ty=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ty(t)}Object.defineProperty(Si,"__esModule",{value:!0}),Si.create=N1,Si.clone=function(t){var e=new Gs.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Si.fromValues=function(t,e,n,a){var u=new Gs.ARRAY_TYPE(4);return u[0]=t,u[1]=e,u[2]=n,u[3]=a,u},Si.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Si.set=function(t,e,n,a,u){return t[0]=e,t[1]=n,t[2]=a,t[3]=u,t},Si.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Si.subtract=V1,Si.multiply=j1,Si.divide=U1,Si.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Si.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Si.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},Si.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},Si.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Si.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Si.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t},Si.distance=G1,Si.squaredDistance=H1,Si.length=W1,Si.squaredLength=q1,Si.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Si.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Si.normalize=function(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=n*n+a*a+u*u+d*d;return p>0&&(p=1/Math.sqrt(p)),t[0]=n*p,t[1]=a*p,t[2]=u*p,t[3]=d*p,t},Si.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Si.cross=function(t,e,n,a){var u=n[0]*a[1]-n[1]*a[0],d=n[0]*a[2]-n[2]*a[0],p=n[0]*a[3]-n[3]*a[0],y=n[1]*a[2]-n[2]*a[1],b=n[1]*a[3]-n[3]*a[1],T=n[2]*a[3]-n[3]*a[2],E=e[0],I=e[1],C=e[2],D=e[3];return t[0]=I*T-C*b+D*y,t[1]=-E*T+C*p-D*d,t[2]=E*b-I*p+D*u,t[3]=-E*y+I*d-C*u,t},Si.lerp=function(t,e,n,a){var u=e[0],d=e[1],p=e[2],y=e[3];return t[0]=u+a*(n[0]-u),t[1]=d+a*(n[1]-d),t[2]=p+a*(n[2]-p),t[3]=y+a*(n[3]-y),t},Si.random=function(t,e){var n,a,u,d,p,y;e=e||1;do p=(n=2*Gs.RANDOM()-1)*n+(a=2*Gs.RANDOM()-1)*a;while(p>=1);do y=(u=2*Gs.RANDOM()-1)*u+(d=2*Gs.RANDOM()-1)*d;while(y>=1);var b=Math.sqrt((1-p)/y);return t[0]=e*n,t[1]=e*a,t[2]=e*u*b,t[3]=e*d*b,t},Si.transformMat4=function(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3];return t[0]=n[0]*a+n[4]*u+n[8]*d+n[12]*p,t[1]=n[1]*a+n[5]*u+n[9]*d+n[13]*p,t[2]=n[2]*a+n[6]*u+n[10]*d+n[14]*p,t[3]=n[3]*a+n[7]*u+n[11]*d+n[15]*p,t},Si.transformQuat=function(t,e,n){var a=e[0],u=e[1],d=e[2],p=n[0],y=n[1],b=n[2],T=n[3],E=T*a+y*d-b*u,I=T*u+b*a-p*d,C=T*d+p*u-y*a,D=-p*a-y*u-b*d;return t[0]=E*T+D*-p+I*-b-C*-y,t[1]=I*T+D*-y+C*-p-E*-b,t[2]=C*T+D*-b+E*-y-I*-p,t[3]=e[3],t},Si.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Si.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Si.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Si.equals=function(t,e){var n=t[0],a=t[1],u=t[2],d=t[3],p=e[0],y=e[1],b=e[2],T=e[3];return Math.abs(n-p)<=Gs.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-y)<=Gs.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(u-b)<=Gs.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(d-T)<=Gs.EPSILON*Math.max(1,Math.abs(d),Math.abs(T))},Si.forEach=Si.sqrLen=Si.len=Si.sqrDist=Si.dist=Si.div=Si.mul=Si.sub=void 0;var Gs=function(t,e){if(t&&t.__esModule)return t;if(t===null||Ty(t)!=="object"&&typeof t!="function")return{default:t};var n=F1(void 0);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(hr);function F1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(F1=function(a){return a?n:e})(t)}function N1(){var t=new Gs.ARRAY_TYPE(4);return Gs.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function V1(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function j1(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function U1(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function G1(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function H1(t,e){var n=e[0]-t[0],a=e[1]-t[1],u=e[2]-t[2],d=e[3]-t[3];return n*n+a*a+u*u+d*d}function W1(t){return Math.hypot(t[0],t[1],t[2],t[3])}function q1(t){var e=t[0],n=t[1],a=t[2],u=t[3];return e*e+n*n+a*a+u*u}Si.sub=V1,Si.mul=j1,Si.div=U1,Si.dist=G1,Si.sqrDist=H1,Si.len=W1,Si.sqrLen=q1;var _C=function(){var t=N1();return function(e,n,a,u,d,p){var y,b;for(n||(n=4),a||(a=0),b=u?Math.min(u*n+a,e.length):e.length,y=a;y<b;y+=n)t[0]=e[y],t[1]=e[y+1],t[2]=e[y+2],t[3]=e[y+3],d(t,t,p),e[y]=t[0],e[y+1]=t[1],e[y+2]=t[2],e[y+3]=t[3];return e}}();function My(t){return My=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},My(t)}Si.forEach=_C,Object.defineProperty(li,"__esModule",{value:!0}),li.create=Sy,li.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},li.setAxisAngle=X1,li.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),a=Math.sin(n/2);return a>oc.EPSILON?(t[0]=e[0]/a,t[1]=e[1]/a,t[2]=e[2]/a):(t[0]=1,t[1]=0,t[2]=0),n},li.getAngle=function(t,e){var n=eb(t,e);return Math.acos(2*n*n-1)},li.multiply=Y1,li.rotateX=function(t,e,n){n*=.5;var a=e[0],u=e[1],d=e[2],p=e[3],y=Math.sin(n),b=Math.cos(n);return t[0]=a*b+p*y,t[1]=u*b+d*y,t[2]=d*b-u*y,t[3]=p*b-a*y,t},li.rotateY=function(t,e,n){n*=.5;var a=e[0],u=e[1],d=e[2],p=e[3],y=Math.sin(n),b=Math.cos(n);return t[0]=a*b-d*y,t[1]=u*b+p*y,t[2]=d*b+a*y,t[3]=p*b-u*y,t},li.rotateZ=function(t,e,n){n*=.5;var a=e[0],u=e[1],d=e[2],p=e[3],y=Math.sin(n),b=Math.cos(n);return t[0]=a*b+u*y,t[1]=u*b-a*y,t[2]=d*b+p*y,t[3]=p*b-d*y,t},li.calculateW=function(t,e){var n=e[0],a=e[1],u=e[2];return t[0]=n,t[1]=a,t[2]=u,t[3]=Math.sqrt(Math.abs(1-n*n-a*a-u*u)),t},li.exp=K1,li.ln=J1,li.pow=function(t,e,n){return J1(t,e),$1(t,t,n),K1(t,t),t},li.slerp=Jp,li.random=function(t){var e=oc.RANDOM(),n=oc.RANDOM(),a=oc.RANDOM(),u=Math.sqrt(1-e),d=Math.sqrt(e);return t[0]=u*Math.sin(2*Math.PI*n),t[1]=u*Math.cos(2*Math.PI*n),t[2]=d*Math.sin(2*Math.PI*a),t[3]=d*Math.cos(2*Math.PI*a),t},li.invert=function(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=n*n+a*a+u*u+d*d,y=p?1/p:0;return t[0]=-n*y,t[1]=-a*y,t[2]=-u*y,t[3]=d*y,t},li.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},li.fromMat3=Q1,li.fromEuler=function(t,e,n,a){var u=.5*Math.PI/180;e*=u,n*=u,a*=u;var d=Math.sin(e),p=Math.cos(e),y=Math.sin(n),b=Math.cos(n),T=Math.sin(a),E=Math.cos(a);return t[0]=d*b*E-p*y*T,t[1]=p*y*E+d*b*T,t[2]=p*b*T-d*y*E,t[3]=p*b*E+d*y*T,t},li.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},li.setAxes=li.sqlerp=li.rotationTo=li.equals=li.exactEquals=li.normalize=li.sqrLen=li.squaredLength=li.len=li.length=li.lerp=li.dot=li.scale=li.mul=li.add=li.set=li.copy=li.fromValues=li.clone=void 0;var oc=Kp(hr),yC=Kp(nn),ba=Kp(mi),Cs=Kp(Si);function Z1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Z1=function(a){return a?n:e})(t)}function Kp(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||My(t)!=="object"&&typeof t!="function")return{default:t};var n=Z1(e);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}function Sy(){var t=new oc.ARRAY_TYPE(4);return oc.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function X1(t,e,n){n*=.5;var a=Math.sin(n);return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=Math.cos(n),t}function Y1(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],y=n[0],b=n[1],T=n[2],E=n[3];return t[0]=a*E+p*y+u*T-d*b,t[1]=u*E+p*b+d*y-a*T,t[2]=d*E+p*T+a*b-u*y,t[3]=p*E-a*y-u*b-d*T,t}function K1(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=Math.sqrt(n*n+a*a+u*u),y=Math.exp(d),b=p>0?y*Math.sin(p)/p:0;return t[0]=n*b,t[1]=a*b,t[2]=u*b,t[3]=y*Math.cos(p),t}function J1(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=Math.sqrt(n*n+a*a+u*u),y=p>0?Math.atan2(p,d)/p:0;return t[0]=n*y,t[1]=a*y,t[2]=u*y,t[3]=.5*Math.log(n*n+a*a+u*u+d*d),t}function Jp(t,e,n,a){var u,d,p,y,b,T=e[0],E=e[1],I=e[2],C=e[3],D=n[0],R=n[1],B=n[2],V=n[3];return(d=T*D+E*R+I*B+C*V)<0&&(d=-d,D=-D,R=-R,B=-B,V=-V),1-d>oc.EPSILON?(u=Math.acos(d),p=Math.sin(u),y=Math.sin((1-a)*u)/p,b=Math.sin(a*u)/p):(y=1-a,b=a),t[0]=y*T+b*D,t[1]=y*E+b*R,t[2]=y*I+b*B,t[3]=y*C+b*V,t}function Q1(t,e){var n,a=e[0]+e[4]+e[8];if(a>0)n=Math.sqrt(a+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var u=0;e[4]>e[0]&&(u=1),e[8]>e[3*u+u]&&(u=2);var d=(u+1)%3,p=(u+2)%3;n=Math.sqrt(e[3*u+u]-e[3*d+d]-e[3*p+p]+1),t[u]=.5*n,t[3]=(e[3*d+p]-e[3*p+d])*(n=.5/n),t[d]=(e[3*d+u]+e[3*u+d])*n,t[p]=(e[3*p+u]+e[3*u+p])*n}return t}li.clone=Cs.clone,li.fromValues=Cs.fromValues,li.copy=Cs.copy,li.set=Cs.set,li.add=Cs.add,li.mul=Y1;var $1=Cs.scale;li.scale=$1;var eb=Cs.dot;li.dot=eb,li.lerp=Cs.lerp;var tb=Cs.length;li.length=tb,li.len=tb;var ib=Cs.squaredLength;li.squaredLength=ib,li.sqrLen=ib;var Ey=Cs.normalize;li.normalize=Ey,li.exactEquals=Cs.exactEquals,li.equals=Cs.equals;var ao,nb,rb,xC=(ao=ba.create(),nb=ba.fromValues(1,0,0),rb=ba.fromValues(0,1,0),function(t,e,n){var a=ba.dot(e,n);return a<-.999999?(ba.cross(ao,nb,e),ba.len(ao)<1e-6&&ba.cross(ao,rb,e),ba.normalize(ao,ao),X1(t,ao,Math.PI),t):a>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(ba.cross(ao,e,n),t[0]=ao[0],t[1]=ao[1],t[2]=ao[2],t[3]=1+a,Ey(t,t))});li.rotationTo=xC;var Ay,Iy,vC=(Ay=Sy(),Iy=Sy(),function(t,e,n,a,u,d){return Jp(Ay,e,u,d),Jp(Iy,n,a,d),Jp(t,Ay,Iy,2*d*(1-d)),t});li.sqlerp=vC;var lo,bC=(lo=yC.create(),function(t,e,n,a){return lo[0]=n[0],lo[3]=n[1],lo[6]=n[2],lo[1]=a[0],lo[4]=a[1],lo[7]=a[2],lo[2]=-e[0],lo[5]=-e[1],lo[8]=-e[2],Ey(t,Q1(t,lo))});li.setAxes=bC;var Ci={};function ky(t){return ky=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ky(t)}Object.defineProperty(Ci,"__esModule",{value:!0}),Ci.create=function(){var t=new ns.ARRAY_TYPE(8);return ns.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},Ci.clone=function(t){var e=new ns.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},Ci.fromValues=function(t,e,n,a,u,d,p,y){var b=new ns.ARRAY_TYPE(8);return b[0]=t,b[1]=e,b[2]=n,b[3]=a,b[4]=u,b[5]=d,b[6]=p,b[7]=y,b},Ci.fromRotationTranslationValues=function(t,e,n,a,u,d,p){var y=new ns.ARRAY_TYPE(8);y[0]=t,y[1]=e,y[2]=n,y[3]=a;var b=.5*u,T=.5*d,E=.5*p;return y[4]=b*a+T*n-E*e,y[5]=T*a+E*t-b*n,y[6]=E*a+b*e-T*t,y[7]=-b*t-T*e-E*n,y},Ci.fromRotationTranslation=ab,Ci.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},Ci.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Ci.fromMat4=function(t,e){var n=wa.create();sb.getRotation(n,e);var a=new ns.ARRAY_TYPE(3);return sb.getTranslation(a,e),ab(t,n,a),t},Ci.copy=lb,Ci.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Ci.set=function(t,e,n,a,u,d,p,y,b){return t[0]=e,t[1]=n,t[2]=a,t[3]=u,t[4]=d,t[5]=p,t[6]=y,t[7]=b,t},Ci.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},Ci.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},Ci.getTranslation=function(t,e){var n=e[4],a=e[5],u=e[6],d=e[7],p=-e[0],y=-e[1],b=-e[2],T=e[3];return t[0]=2*(n*T+d*p+a*b-u*y),t[1]=2*(a*T+d*y+u*p-n*b),t[2]=2*(u*T+d*b+n*y-a*p),t},Ci.translate=function(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],y=.5*n[0],b=.5*n[1],T=.5*n[2],E=e[4],I=e[5],C=e[6],D=e[7];return t[0]=a,t[1]=u,t[2]=d,t[3]=p,t[4]=p*y+u*T-d*b+E,t[5]=p*b+d*y-a*T+I,t[6]=p*T+a*b-u*y+C,t[7]=-a*y-u*b-d*T+D,t},Ci.rotateX=function(t,e,n){var a=-e[0],u=-e[1],d=-e[2],p=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=y*p+E*a+b*d-T*u,C=b*p+E*u+T*a-y*d,D=T*p+E*d+y*u-b*a,R=E*p-y*a-b*u-T*d;return wa.rotateX(t,e,n),t[4]=I*(p=t[3])+R*(a=t[0])+C*(d=t[2])-D*(u=t[1]),t[5]=C*p+R*u+D*a-I*d,t[6]=D*p+R*d+I*u-C*a,t[7]=R*p-I*a-C*u-D*d,t},Ci.rotateY=function(t,e,n){var a=-e[0],u=-e[1],d=-e[2],p=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=y*p+E*a+b*d-T*u,C=b*p+E*u+T*a-y*d,D=T*p+E*d+y*u-b*a,R=E*p-y*a-b*u-T*d;return wa.rotateY(t,e,n),t[4]=I*(p=t[3])+R*(a=t[0])+C*(d=t[2])-D*(u=t[1]),t[5]=C*p+R*u+D*a-I*d,t[6]=D*p+R*d+I*u-C*a,t[7]=R*p-I*a-C*u-D*d,t},Ci.rotateZ=function(t,e,n){var a=-e[0],u=-e[1],d=-e[2],p=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=y*p+E*a+b*d-T*u,C=b*p+E*u+T*a-y*d,D=T*p+E*d+y*u-b*a,R=E*p-y*a-b*u-T*d;return wa.rotateZ(t,e,n),t[4]=I*(p=t[3])+R*(a=t[0])+C*(d=t[2])-D*(u=t[1]),t[5]=C*p+R*u+D*a-I*d,t[6]=D*p+R*d+I*u-C*a,t[7]=R*p-I*a-C*u-D*d,t},Ci.rotateByQuatAppend=function(t,e,n){var a=n[0],u=n[1],d=n[2],p=n[3],y=e[0],b=e[1],T=e[2],E=e[3];return t[0]=y*p+E*a+b*d-T*u,t[1]=b*p+E*u+T*a-y*d,t[2]=T*p+E*d+y*u-b*a,t[3]=E*p-y*a-b*u-T*d,t[4]=(y=e[4])*p+(E=e[7])*a+(b=e[5])*d-(T=e[6])*u,t[5]=b*p+E*u+T*a-y*d,t[6]=T*p+E*d+y*u-b*a,t[7]=E*p-y*a-b*u-T*d,t},Ci.rotateByQuatPrepend=function(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],y=n[0],b=n[1],T=n[2],E=n[3];return t[0]=a*E+p*y+u*T-d*b,t[1]=u*E+p*b+d*y-a*T,t[2]=d*E+p*T+a*b-u*y,t[3]=p*E-a*y-u*b-d*T,t[4]=a*(E=n[7])+p*(y=n[4])+u*(T=n[6])-d*(b=n[5]),t[5]=u*E+p*b+d*y-a*T,t[6]=d*E+p*T+a*b-u*y,t[7]=p*E-a*y-u*b-d*T,t},Ci.rotateAroundAxis=function(t,e,n,a){if(Math.abs(a)<ns.EPSILON)return lb(t,e);var u=Math.hypot(n[0],n[1],n[2]);a*=.5;var d=Math.sin(a),p=d*n[0]/u,y=d*n[1]/u,b=d*n[2]/u,T=Math.cos(a),E=e[0],I=e[1],C=e[2],D=e[3];t[0]=E*T+D*p+I*b-C*y,t[1]=I*T+D*y+C*p-E*b,t[2]=C*T+D*b+E*y-I*p,t[3]=D*T-E*p-I*y-C*b;var R=e[4],B=e[5],V=e[6],G=e[7];return t[4]=R*T+G*p+B*b-V*y,t[5]=B*T+G*y+V*p-R*b,t[6]=V*T+G*b+R*y-B*p,t[7]=G*T-R*p-B*y-V*b,t},Ci.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},Ci.multiply=cb,Ci.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},Ci.lerp=function(t,e,n,a){var u=1-a;return ub(e,n)<0&&(a=-a),t[0]=e[0]*u+n[0]*a,t[1]=e[1]*u+n[1]*a,t[2]=e[2]*u+n[2]*a,t[3]=e[3]*u+n[3]*a,t[4]=e[4]*u+n[4]*a,t[5]=e[5]*u+n[5]*a,t[6]=e[6]*u+n[6]*a,t[7]=e[7]*u+n[7]*a,t},Ci.invert=function(t,e){var n=Qp(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},Ci.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},Ci.normalize=function(t,e){var n=Qp(e);if(n>0){n=Math.sqrt(n);var a=e[0]/n,u=e[1]/n,d=e[2]/n,p=e[3]/n,y=e[4],b=e[5],T=e[6],E=e[7],I=a*y+u*b+d*T+p*E;t[0]=a,t[1]=u,t[2]=d,t[3]=p,t[4]=(y-a*I)/n,t[5]=(b-u*I)/n,t[6]=(T-d*I)/n,t[7]=(E-p*I)/n}return t},Ci.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},Ci.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},Ci.equals=function(t,e){var n=t[0],a=t[1],u=t[2],d=t[3],p=t[4],y=t[5],b=t[6],T=t[7],E=e[0],I=e[1],C=e[2],D=e[3],R=e[4],B=e[5],V=e[6],G=e[7];return Math.abs(n-E)<=ns.EPSILON*Math.max(1,Math.abs(n),Math.abs(E))&&Math.abs(a-I)<=ns.EPSILON*Math.max(1,Math.abs(a),Math.abs(I))&&Math.abs(u-C)<=ns.EPSILON*Math.max(1,Math.abs(u),Math.abs(C))&&Math.abs(d-D)<=ns.EPSILON*Math.max(1,Math.abs(d),Math.abs(D))&&Math.abs(p-R)<=ns.EPSILON*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(y-B)<=ns.EPSILON*Math.max(1,Math.abs(y),Math.abs(B))&&Math.abs(b-V)<=ns.EPSILON*Math.max(1,Math.abs(b),Math.abs(V))&&Math.abs(T-G)<=ns.EPSILON*Math.max(1,Math.abs(T),Math.abs(G))},Ci.sqrLen=Ci.squaredLength=Ci.len=Ci.length=Ci.dot=Ci.mul=Ci.setReal=Ci.getReal=void 0;var ns=Cy(hr),wa=Cy(li),sb=Cy(gi);function ob(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(ob=function(a){return a?n:e})(t)}function Cy(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||ky(t)!=="object"&&typeof t!="function")return{default:t};var n=ob(e);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}function ab(t,e,n){var a=.5*n[0],u=.5*n[1],d=.5*n[2],p=e[0],y=e[1],b=e[2],T=e[3];return t[0]=p,t[1]=y,t[2]=b,t[3]=T,t[4]=a*T+u*b-d*y,t[5]=u*T+d*p-a*b,t[6]=d*T+a*y-u*p,t[7]=-a*p-u*y-d*b,t}function lb(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function cb(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],y=n[4],b=n[5],T=n[6],E=n[7],I=e[4],C=e[5],D=e[6],R=e[7],B=n[0],V=n[1],G=n[2],$=n[3];return t[0]=a*$+p*B+u*G-d*V,t[1]=u*$+p*V+d*B-a*G,t[2]=d*$+p*G+a*V-u*B,t[3]=p*$-a*B-u*V-d*G,t[4]=a*E+p*y+u*T-d*b+I*$+R*B+C*G-D*V,t[5]=u*E+p*b+d*y-a*T+C*$+R*V+D*B-I*G,t[6]=d*E+p*T+a*b-u*y+D*$+R*G+I*V-C*B,t[7]=p*E-a*y-u*b-d*T+R*$-I*B-C*V-D*G,t}Ci.getReal=wa.copy,Ci.setReal=wa.copy,Ci.mul=cb;var ub=wa.dot;Ci.dot=ub;var hb=wa.length;Ci.length=hb,Ci.len=hb;var Qp=wa.squaredLength;Ci.squaredLength=Qp,Ci.sqrLen=Qp;var vi={};function Py(t){return Py=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Py(t)}Object.defineProperty(vi,"__esModule",{value:!0}),vi.create=fb,vi.clone=function(t){var e=new ac.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},vi.fromValues=function(t,e){var n=new ac.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},vi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},vi.set=function(t,e,n){return t[0]=e,t[1]=n,t},vi.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},vi.subtract=pb,vi.multiply=mb,vi.divide=gb,vi.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},vi.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},vi.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},vi.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},vi.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},vi.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},vi.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t},vi.distance=_b,vi.squaredDistance=yb,vi.length=xb,vi.squaredLength=vb,vi.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},vi.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},vi.normalize=function(t,e){var n=e[0],a=e[1],u=n*n+a*a;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t},vi.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},vi.cross=function(t,e,n){var a=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=a,t},vi.lerp=function(t,e,n,a){var u=e[0],d=e[1];return t[0]=u+a*(n[0]-u),t[1]=d+a*(n[1]-d),t},vi.random=function(t,e){e=e||1;var n=2*ac.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},vi.transformMat2=function(t,e,n){var a=e[0],u=e[1];return t[0]=n[0]*a+n[2]*u,t[1]=n[1]*a+n[3]*u,t},vi.transformMat2d=function(t,e,n){var a=e[0],u=e[1];return t[0]=n[0]*a+n[2]*u+n[4],t[1]=n[1]*a+n[3]*u+n[5],t},vi.transformMat3=function(t,e,n){var a=e[0],u=e[1];return t[0]=n[0]*a+n[3]*u+n[6],t[1]=n[1]*a+n[4]*u+n[7],t},vi.transformMat4=function(t,e,n){var a=e[0],u=e[1];return t[0]=n[0]*a+n[4]*u+n[12],t[1]=n[1]*a+n[5]*u+n[13],t},vi.rotate=function(t,e,n,a){var u=e[0]-n[0],d=e[1]-n[1],p=Math.sin(a),y=Math.cos(a);return t[0]=u*y-d*p+n[0],t[1]=u*p+d*y+n[1],t},vi.angle=function(t,e){var n=t[0],a=t[1],u=e[0],d=e[1],p=Math.sqrt(n*n+a*a)*Math.sqrt(u*u+d*d);return Math.acos(Math.min(Math.max(p&&(n*u+a*d)/p,-1),1))},vi.zero=function(t){return t[0]=0,t[1]=0,t},vi.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},vi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},vi.equals=function(t,e){var n=t[0],a=t[1],u=e[0],d=e[1];return Math.abs(n-u)<=ac.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(a-d)<=ac.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))},vi.forEach=vi.sqrLen=vi.sqrDist=vi.dist=vi.div=vi.mul=vi.sub=vi.len=void 0;var ac=function(t,e){if(t&&t.__esModule)return t;if(t===null||Py(t)!=="object"&&typeof t!="function")return{default:t};var n=db(void 0);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(hr);function db(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(db=function(a){return a?n:e})(t)}function fb(){var t=new ac.ARRAY_TYPE(2);return ac.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function pb(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function mb(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function gb(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function _b(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function yb(t,e){var n=e[0]-t[0],a=e[1]-t[1];return n*n+a*a}function xb(t){return Math.hypot(t[0],t[1])}function vb(t){var e=t[0],n=t[1];return e*e+n*n}vi.len=xb,vi.sub=pb,vi.mul=mb,vi.div=gb,vi.dist=_b,vi.sqrDist=yb,vi.sqrLen=vb;var wC=function(){var t=fb();return function(e,n,a,u,d,p){var y,b;for(n||(n=2),a||(a=0),b=u?Math.min(u*n+a,e.length):e.length,y=a;y<b;y+=n)t[0]=e[y],t[1]=e[y+1],d(t,t,p),e[y]=t[0],e[y+1]=t[1];return e}}();function Dy(t){return Dy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dy(t)}vi.forEach=wC,Object.defineProperty(ur,"__esModule",{value:!0}),s.e=ur.vec4=s.v=ur.vec3=ur.vec2=ur.quat2=s.q=ur.quat=s.m=ur.mat4=s.bx=ur.mat3=ur.mat2d=s.h=ur.mat2=ur.glMatrix=void 0;var TC=No(hr);ur.glMatrix=TC;var MC=No(Mn);s.h=ur.mat2=MC;var SC=No(En);ur.mat2d=SC;var EC=No(nn);s.bx=ur.mat3=EC;var AC=No(gi);s.m=ur.mat4=AC;var IC=No(li);s.q=ur.quat=IC;var kC=No(Ci);ur.quat2=kC;var CC=No(vi);ur.vec2=CC;var PC=No(mi);s.v=ur.vec3=PC;var DC=No(Si);function bb(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(bb=function(a){return a?n:e})(t)}function No(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||Dy(t)!=="object"&&typeof t!="function")return{default:t};var n=bb(e);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}s.e=ur.vec4=DC;const zC=Ht([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:$p}=zC,wb=Ht([{name:"a_pos_3",components:3,type:"Int16"}]);var xd=Ht([{name:"a_pos",type:"Int16",components:2}]),Tb={};(function(t,e){(function(n){function a(d,p,y){var b=u(256*d,256*(p=Math.pow(2,y)-p-1),y),T=u(256*(d+1),256*(p+1),y);return b[0]+","+b[1]+","+T[0]+","+T[1]}function u(d,p,y){var b=2*Math.PI*6378137/256/Math.pow(2,y);return[d*b-2*Math.PI*6378137/2,p*b-2*Math.PI*6378137/2]}n.getURL=function(d,p,y,b,T,E){return E=E||{},d+"?"+["bbox="+a(y,b,T),"format="+(E.format||"image/png"),"service="+(E.service||"WMS"),"version="+(E.version||"1.1.1"),"request="+(E.request||"GetMap"),"srs="+(E.srs||"EPSG:3857"),"width="+(E.width||256),"height="+(E.height||256),"layers="+p].join("&")},n.getTileBBox=a,n.getMercCoords=u,Object.defineProperty(n,"__esModule",{value:!0})})(e)})(0,Tb);var LC=Tb;class lc{constructor(e,n,a){this.z=e,this.x=n,this.y=a,this.key=vd(0,e,e,n,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const a=LC.getTileBBox(this.x,this.y,this.z),u=function(d,p,y){let b,T="";for(let E=d;E>0;E--)b=1<<E-1,T+=(p&b?1:0)+(y&b?2:0);return T}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Mb{constructor(e,n){this.wrap=e,this.canonical=n,this.key=vd(e,n.z,n.z,n.x,n.y)}}class _r{constructor(e,n,a,u,d){this.overscaledZ=e,this.wrap=n,this.canonical=new lc(a,+u,+d),this.key=n===0&&e===a?this.canonical.key:vd(n,e,a,u,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new _r(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new _r(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return vd(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return vd(this.wrap*+n,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new _r(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new _r(n,this.wrap,n,a,u),new _r(n,this.wrap,n,a+1,u),new _r(n,this.wrap,n,a,u+1),new _r(n,this.wrap,n,a+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new _r(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new _r(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Mb(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function vd(t,e,n,a,u){const d=1<<Math.min(n,22);let p=d*(u%d)+a%d;return t&&n<22&&(p+=d*d*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*p+n)+(e-n)}const RC=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new _r(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new _r(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new _r(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new _r(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];Bt(lc,"CanonicalTileID"),Bt(_r,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});class zy{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,a){const u=s.v.dot(n,this.dir);if(Math.abs(u)<1e-6)return!1;const d=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/u;return a[0]=this.pos[0]+this.dir[0]*d,a[1]=this.pos[1]+this.dir[1]*d,a[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,n,a){if(s.v.equals(this.pos,e)||n===0)return a[0]=a[1]=a[2]=0,!1;const[u,d,p]=this.dir,y=this.pos[0]-e[0],b=this.pos[1]-e[1],T=this.pos[2]-e[2],E=u*u+d*d+p*p,I=2*(y*u+b*d+T*p),C=I*I-4*E*(y*y+b*b+T*T-n*n);if(C<0){const D=Math.max(-I/2,0),R=y+u*D,B=b+d*D,V=T+p*D,G=Math.hypot(R,B,V);return a[0]=R*n/G,a[1]=B*n/G,a[2]=V*n/G,!1}{const D=(-I-Math.sqrt(C))/(2*E);if(D<0){const R=Math.hypot(y,b,T);return a[0]=y*n/R,a[1]=b*n/R,a[2]=T*n/R,!1}return a[0]=y+u*D,a[1]=b+d*D,a[2]=T+p*D,!0}}}class Ly{constructor(e,n,a,u,d){this.TL=e,this.TR=n,this.BR=a,this.BL=u,this.horizon=d}static fromInvProjectionMatrix(e,n,a){const u=[-1,1,1],d=[1,1,1],p=[1,-1,1],y=[-1,-1,1],b=s.v.transformMat4(u,u,e),T=s.v.transformMat4(d,d,e),E=s.v.transformMat4(p,p,e),I=s.v.transformMat4(y,y,e);return new Ly(b,T,E,I,n/a)}}function bd(t,e,n){let a=1/0,u=-1/0;const d=[];for(const p of t){s.v.sub(d,p,e);const y=s.v.dot(d,n);a=Math.min(a,y),u=Math.max(u,y)}return[a,u]}function Sb(t,e){let n=!0;for(let a=0;a<t.planes.length;a++){const u=t.planes[a];let d=0;for(let p=0;p<e.length;p++)d+=s.v.dot(u,e[p])+u[3]>=0;if(d===0)return 0;d!==e.length&&(n=!1)}return n?2:1}function Eb(t,e){for(const n of t.projections){const a=bd(e,t.points[0],n.axis);if(n.projection[1]<a[0]||n.projection[0]>a[1])return 0}return 1}function Ab(t,e){let n=0;const a=[0,0,0,0];for(let u=0;u<t.length;u++)a[0]=t[u][0],a[1]=t[u][1],a[2]=t[u][2],a[3]=1,s.e.dot(a,e)>=0&&n++;return n}class Ry{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=Hn.fromPoints(this.points),this.projections=[],this.frustumEdges=[s.v.sub([],this.points[2],this.points[3]),s.v.sub([],this.points[0],this.points[3]),s.v.sub([],this.points[4],this.points[0]),s.v.sub([],this.points[5],this.points[1]),s.v.sub([],this.points[6],this.points[2]),s.v.sub([],this.points[7],this.points[3])];for(const a of this.frustumEdges){const u=[0,-a[2],a[1]],d=[a[2],0,-a[0]];this.projections.push({axis:u,projection:bd(this.points,this.points[0],u)}),this.projections.push({axis:d,projection:bd(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(e,n,a,u){const d=Math.pow(2,a),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const E=s.e.transformMat4([],T,e),I=1/E[3]/n*d;return s.e.mul(E,E,[I,I,u?1/E[3]:I,I])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const E=s.v.sub([],p[T[0]],p[T[1]]),I=s.v.sub([],p[T[2]],p[T[1]]),C=s.v.normalize([],s.v.cross([],E,I)),D=-s.v.dot(C,p[T[1]]);return C.concat(D)}),b=[];for(let T=0;T<p.length;T++)b.push([p[T][0],p[T][1],p[T][2]]);return new Ry(b,y)}intersectsPrecise(e,n,a){for(let u=0;u<n.length;u++)if(!Ab(e,n[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!Ab(e,this.planes[u]))return 0;for(const u of a)for(const d of this.frustumEdges){const p=s.v.cross([],u,d),y=s.v.length(p);if(y===0)continue;s.v.scale(p,p,1/y);const b=bd(this.points,this.points[0],p),T=bd(e,this.points[0],p);if(b[0]>T[1]||T[0]>b[1])return 0}return 1}}class Hn{static fromPoints(e){const n=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const u of e)s.v.min(n,n,u),s.v.max(a,a,u);return new Hn(n,a)}static fromTileIdAndHeight(e,n,a){const u=1<<e.canonical.z,d=e.canonical.x,p=e.canonical.y;return new Hn([d/u,p/u,n],[(d+1)/u,(p+1)/u,a])}static applyTransform(e,n){const a=e.getCorners();for(let u=0;u<a.length;++u)s.v.transformMat4(a[u],a[u],n);return Hn.fromPoints(a)}static projectAabbCorners(e,n){const a=e.getCorners();for(let u=0;u<a.length;++u)s.v.transformMat4(a[u],a[u],n);return a}constructor(e,n){this.min=e,this.max=n,this.center=s.v.scale([],s.v.add([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],a=s.v.clone(this.min),u=s.v.clone(this.max);for(let d=0;d<n.length;d++)a[d]=n[d]?this.min[d]:this.center[d],u[d]=n[d]?this.center[d]:this.max[d];return u[2]=this.max[2],new Hn(a,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Sb(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Sb(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?Eb(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?Eb(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Bt(Hn,"Aabb");const Oy=5,Ib=6,Ps=xt/Math.PI/2,OC=16383,Mu=64,By=[Mu,32,16],Hs=-Ps,Ws=Ps,BC=[new Hn([Hs,Hs,Hs],[Ws,Ws,Ws]),new Hn([Hs,Hs,Hs],[0,0,Ws]),new Hn([0,Hs,Hs],[Ws,0,Ws]),new Hn([Hs,0,Hs],[0,Ws,Ws]),new Hn([0,0,Hs],[Ws,Ws,Ws])];function em(t){return t*Ps/Md}function kb(t,e,n,a=!0){const u=s.v.scale([],t._camera.position,t.worldSize),d=[e,n,1,1];s.e.transformMat4(d,d,t.pixelMatrixInverse),s.e.scale(d,d,1/d[3]);const p=s.v.sub([],d,u),y=s.v.normalize([],p),b=t.globeMatrix,T=[b[12],b[13],b[14]],E=s.v.sub([],T,u),I=s.v.length(E),C=s.v.normalize([],E),D=t.worldSize/(2*Math.PI),R=s.v.dot(C,y),B=Math.asin(D/I);if(B<Math.acos(R)){if(!a)return null;const Pe=[],Ge=[];s.v.scale(Pe,y,I/R),s.v.normalize(Ge,s.v.sub(Ge,Pe,E)),s.v.normalize(y,s.v.add(y,E,s.v.scale(y,Ge,Math.tan(B)*I)))}const V=[];new zy(u,y).closestPointOnSphere(T,D,V);const G=s.v.normalize([],Dt(b,0)),$=s.v.normalize([],Dt(b,1)),te=s.v.normalize([],Dt(b,2)),se=s.v.dot(G,V),le=s.v.dot($,V),he=s.v.dot(te,V),ye=Tt(Math.asin(-le/D));let we=Tt(Math.atan2(se,he));we=t.center.lng+function(Pe,Ge){const ct=(Ge-Pe+180)%360-180;return ct<-180?ct+360:ct}(t.center.lng,we);const Ie=jo(we),Le=ft(Uo(ye),0,1);return new Er(Ie,Le)}class FC{constructor(e,n,a){this.a=s.v.sub([],e,a),this.b=s.v.sub([],n,a),this.center=a;const u=s.v.normalize([],this.a),d=s.v.normalize([],this.b);this.angle=Math.acos(s.v.dot(u,d))}}function Fy(t,e){if(t.angle===0)return null;let n;return n=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(a,u,d,p){const y=Math.sin(d);return a*(Math.sin((1-p)*d)/y)+u*(Math.sin(p*d)/y)}(t.a[e],t.b[e],t.angle,ft(n,0,1))+t.center[e]}function Vo(t){if(t.z<=1)return BC[t.z+2*t.y+t.x];const e=Ny(tm(t));return Hn.fromPoints(e)}function Ta(t,e,n){return s.v.scale(t,t,1-n),s.v.scaleAndAdd(t,t,e,n)}function Cb(t,e){const n=Ma(e.zoom);if(n===0)return Vo(t);const a=tm(t),u=Ny(a),d=jo(a.getWest())*e.worldSize,p=jo(a.getEast())*e.worldSize,y=Uo(a.getNorth())*e.worldSize,b=Uo(a.getSouth())*e.worldSize,T=[d,y,0],E=[p,y,0],I=[d,b,0],C=[p,b,0],D=s.m.invert([],e.globeMatrix);return s.v.transformMat4(T,T,D),s.v.transformMat4(E,E,D),s.v.transformMat4(I,I,D),s.v.transformMat4(C,C,D),u[0]=Ta(u[0],I,n),u[1]=Ta(u[1],C,n),u[2]=Ta(u[2],E,n),u[3]=Ta(u[3],T,n),Hn.fromPoints(u)}function Pb(t,e,n){for(const a of t)s.v.transformMat4(a,a,e),s.v.scale(a,a,n)}function Db(t,e,n,a){const u=e/t.worldSize,d=t.globeMatrix;if(n.z<=1){const Ie=Vo(n).getCorners();return Pb(Ie,d,u),Hn.fromPoints(Ie)}const p=tm(n,a),y=Ny(p);Pb(y,d,u);const b=Number.MAX_VALUE,T=[-b,-b,-b],E=[b,b,b];if(p.contains(t.center)){for(const Pe of y)s.v.min(E,E,Pe),s.v.max(T,T,Pe);T[2]=0;const Ie=t.point,Le=[Ie.x*u,Ie.y*u,0];return s.v.min(E,E,Le),s.v.max(T,T,Le),new Hn(E,T)}const I=[d[12]*u,d[13]*u,d[14]*u],C=p.getCenter(),D=ft(t.center.lat,-Fn,Fn),R=ft(C.lat,-Fn,Fn),B=jo(t.center.lng),V=Uo(D);let G=B-jo(C.lng);const $=V-Uo(R);G>.5?G-=1:G<-.5&&(G+=1);let te=0;if(Math.abs(G)>Math.abs($))te=G>=0?1:3;else{te=$>=0?0:2;const Ie=[d[4]*u,d[5]*u,d[6]*u],Le=-Math.sin(Ze($>=0?p.getSouth():p.getNorth()))*Ps;s.v.scaleAndAdd(I,I,Ie,Le)}const se=y[te],le=y[(te+1)%4],he=new FC(se,le,I),ye=[Fy(he,0)||se[0],Fy(he,1)||se[1],Fy(he,2)||se[2]],we=Ma(t.zoom);if(we>0){const Ie=function({x:Pe,y:Ge,z:ct},Ve,rt,Ne,wt){const Ot=1/(1<<ct);let lt=Pe*Ot,ei=lt+Ot,Nt=Ge*Ot,bt=Nt+Ot,ti=0;const Wt=(lt+ei)/2-Ne;return Wt>.5?ti=-1:Wt<-.5&&(ti=1),lt=((lt+ti)*Ve-(Ne*=Ve))*rt+Ne,ei=((ei+ti)*Ve-Ne)*rt+Ne,Nt=(Nt*Ve-(wt*=Ve))*rt+wt,bt=(bt*Ve-wt)*rt+wt,[[lt,bt,0],[ei,bt,0],[ei,Nt,0],[lt,Nt,0]]}(n,e,t._pixelsPerMercatorPixel,B,V);for(let Pe=0;Pe<y.length;Pe++)Ta(y[Pe],Ie[Pe],we);const Le=s.v.add([],Ie[te],Ie[(te+1)%4]);s.v.scale(Le,Le,.5),Ta(ye,Le,we)}for(const Ie of y)s.v.min(E,E,Ie),s.v.max(T,T,Ie);return E[2]=Math.min(se[2],le[2]),s.v.min(E,E,ye),s.v.max(T,T,ye),new Hn(E,T)}function tm({x:t,y:e,z:n},a=!1){const u=1/(1<<n),d=new Yi(ds(t*u),e===(1<<n)-1&&a?-90:wr((e+1)*u)),p=new Yi(ds((t+1)*u),e===0&&a?90:wr(e*u));return new al(d,p)}function Ny(t){const e=Ze(t.getNorth()),n=Ze(t.getSouth()),a=Math.cos(e),u=Math.cos(n),d=Math.sin(e),p=Math.sin(n),y=t.getWest(),b=t.getEast();return[Su(u,p,y),Su(u,p,b),Su(a,d,b),Su(a,d,y)]}function Su(t,e,n,a=Ps){return n=Ze(n),[t*Math.sin(n)*a,-e*a,t*Math.cos(n)*a]}function cc(t,e,n){return Su(Math.cos(Ze(t)),Math.sin(Ze(t)),e,n)}function wd(t,e,n,a){const u=1<<n.z,d=(t/xt+n.x)/u;return cc(wr((e/xt+n.y)/u),ds(d),a)}function im({min:t,max:e}){return OC/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const zb=new Float64Array(16);function Td(t){const e=im(t),n=s.m.fromScaling(zb,[e,e,e]);return s.m.translate(n,n,s.v.negate([],t.min))}function Vy(t){const e=s.m.fromTranslation(zb,t.min),n=1/im(t);return s.m.scale(e,e,[n,n,n])}function jy(t){const e=xt/(2*Math.PI);return t/(2*Math.PI)/e}function Lb(t,e){return xt/(512*Math.pow(2,t))*im(Vo(e))}function Rb(t,e,n,a,u){const d=jy(n),p=[t,e,-n/(2*Math.PI)],y=s.m.identity(new Float64Array(16));return s.m.translate(y,y,p),s.m.scale(y,y,[d,d,d]),s.m.rotateX(y,y,Ze(-u)),s.m.rotateY(y,y,Ze(-a)),y}function Ma(t){return yi(Oy,Ib,t)}function Ob(t,e){const n=cc(e.lat,e.lng),a=function(d){const p=cc(d._center.lat,d._center.lng),y=s.v.fromValues(0,1,0);let b=s.v.cross([],y,p);const T=s.m.fromRotation([],-d.angle,p);b=s.v.transformMat4(b,b,T),s.m.fromRotation(T,-d._pitch,b);const E=s.v.normalize([],p);return s.v.scale(E,E,em(d.cameraToCenterDistance/d.pixelsPerMeter)),s.v.transformMat4(E,E,T),s.v.add([],p,E)}(t),u=s.v.subtract([],a,n);return s.v.angle(u,n)}function Uy(t,e){return Ob(t,e)>Math.PI/2*1.01}const Bb=Ze(85),NC=Math.cos(Bb),VC=Math.sin(Bb),Md=63710088e-1,Gy=2*Math.PI*Md;class cl{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new cl(wi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,a=this.lat*n,u=e.lat*n,d=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((e.lng-this.lng)*n);return Md*Math.acos(Math.min(d,1))}toBounds(e=0){const n=360*e/40075017,a=n/Math.cos(Math.PI/180*this.lat);return new al(new cl(this.lng-a,this.lat-n),new cl(this.lng+a,this.lat+n))}toEcef(e){const n=em(e);return cc(this.lat,this.lng,Ps+n)}static convert(e){if(e instanceof cl)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new cl(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new cl(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Yi=cl;const jC=0,UC=25.5;function Hy(t){return Gy*Math.cos(t*Math.PI/180)}function jo(t){return(180+t)/360}function Uo(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function qr(t,e){return t/Hy(e)}function ds(t){return 360*t-180}function wr(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Fb(t,e){return t*Hy(wr(e))}const Fn=85.051129;function Nb(t){return Math.cos(Ze(ft(t,-Fn,Fn)))}function uc(t,e){const n=ft(e,jC,UC),a=Math.pow(2,n);return Nb(t)*Gy/(512*a)}function Vb(t){return 1/Math.cos(t*Math.PI/180)}function nm(t,e=0){const n=Math.exp(Math.PI*(1-(t.y+e/xt)/(1<<t.z)*2));return 80150034*n/(n*n+1)/xt/(1<<t.z)}class Er{constructor(e,n,a=0){this.x=+e,this.y=+n,this.z=+a}static fromLngLat(e,n=0){const a=Yi.convert(e);return new Er(jo(a.lng),Uo(a.lat),qr(n,a.lat))}toLngLat(){return new Yi(ds(this.x),wr(this.y))}toAltitude(){return Fb(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Gy*Vb(wr(this.y))}}function Wy(t,e,n,a,u,d,p,y,b){const T=(e+a)/2,E=(n+u)/2,I=new Se(T,E);y(I),function(C,D,R,B,V,G){const $=R-V,te=B-G;return Math.abs((B-D)*$-(R-C)*te)/Math.hypot($,te)}(I.x,I.y,d.x,d.y,p.x,p.y)>=b?(Wy(t,e,n,T,E,d,I,y,b),Wy(t,T,E,a,u,I,p,y,b)):t.push(p)}function jb(t,e,n){let a=t[0],u=a.x,d=a.y;e(a);const p=[a];for(let y=1;y<t.length;y++){const b=t[y],{x:T,y:E}=b;e(b),Wy(p,u,d,T,E,a,b,e,n),u=T,d=E,a=b}return p}function qy(t,e,n,a){if(a(e,n)){const u=e.add(n)._mult(.5);qy(t,e,u,a),qy(t,u,n,a)}else t.push(n)}function GC(t,e){let n=t[0];const a=[n];for(let u=1;u<t.length;u++){const d=t[u];qy(a,n,d,e),n=d}return a}const Zy=Math.pow(2,14)-1,Ub=-Zy-1;function HC(t,e){const n=Math.round(t.x*e),a=Math.round(t.y*e);return t.x=ft(n,Ub,Zy),t.y=ft(a,Ub,Zy),(n<t.x||n>t.x+1||a<t.y||a>t.y+1)&&si("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Go(t,e,n){const a=t.loadGeometry(),u=t.extent,d=xt/u;if(e&&n&&n.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:y,x:b,y:T,projection:E}=n,I=C=>{const D=ds((e.x+C.x/u)/p),R=wr((e.y+C.y/u)/p),B=E.project(D,R);C.x=(B.x*y-b)*u,C.y=(B.y*y-T)*u};for(let C=0;C<a.length;C++)if(t.type!==1)a[C]=jb(a[C],I,1);else{const D=[];for(const R of a[C])R.x<0||R.x>=u||R.y<0||R.y>=u||(I(R),D.push(R));a[C]=D}}for(const p of a)for(const y of p)HC(y,d);return a}function ul(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Go(t):[]}}function rm(t,e,n,a,u){t.emplaceBack(2*e+(a+1)/2,2*n+(u+1)/2)}function sm(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class Xy{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new hi,this.indexArray=new tn,this.segments=new Tn,this.programConfigurations=new ol(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,a,u){const d=this.layers[0],p=[];let y=null;d.type==="circle"&&(y=d.layout.get("circle-sort-key"));for(const{feature:T,id:E,index:I,sourceLayerIndex:C}of e){const D=this.layers[0]._featureFilter.needGeometry,R=ul(T,D);if(!this.layers[0]._featureFilter.filter(new _e(this.zoom),R,a))continue;const B=y?y.evaluate(R,{},a):void 0,V={id:E,properties:T.properties,type:T.type,sourceLayerIndex:C,index:I,geometry:D?R.geometry:Go(T,a,u),patterns:{},sortKey:B};p.push(V)}y&&p.sort((T,E)=>T.sortKey-E.sortKey);let b=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new yn,b=u.projection);for(const T of p){const{geometry:E,index:I,sourceLayerIndex:C}=T,D=e[I].feature;this.addFeature(T,E,I,n.availableImages,a,b,n.brightness),n.featureIndex.insert(D,E,I,C,this.index)}}update(e,n,a,u,d){const p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,a,u,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,tC.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,iC.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,a,u,d,p,y){for(const b of n)for(const T of b){const E=T.x,I=T.y;if(E<0||E>=xt||I<0||I>=xt)continue;if(p){const R=p.projectTilePoint(E,I,d),B=p.upVector(d,E,I),V=this.globeExtVertexArray;sm(V,R,B),sm(V,R,B),sm(V,R,B),sm(V,R,B)}const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),D=C.vertexLength;rm(this.layoutVertexArray,E,I,-1,-1),rm(this.layoutVertexArray,E,I,1,-1),rm(this.layoutVertexArray,E,I,1,1),rm(this.layoutVertexArray,E,I,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+2,D+3),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},u,d,y)}}function Gb(t,e){for(let n=0;n<t.length;n++)if(hc(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(hc(t,e[n]))return!0;return!!Yy(t,e)}function WC(t,e,n){return!!hc(t,e)||!!Ky(e,t,n)}function Hb(t,e){if(t.length===1)return qb(e,t[0]);for(let n=0;n<e.length;n++){const a=e[n];for(let u=0;u<a.length;u++)if(hc(t,a[u]))return!0}for(let n=0;n<t.length;n++)if(qb(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Yy(t,e[n]))return!0;return!1}function qC(t,e,n){if(t.length>1){if(Yy(t,e))return!0;for(let a=0;a<e.length;a++)if(Ky(e[a],t,n))return!0}for(let a=0;a<t.length;a++)if(Ky(t[a],e,n))return!0;return!1}function Yy(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){const a=t[n],u=t[n+1];for(let d=0;d<e.length-1;d++)if(ZC(a,u,e[d],e[d+1]))return!0}return!1}function ZC(t,e,n,a){return Re(t,n,a)!==Re(e,n,a)&&Re(t,e,n)!==Re(t,e,a)}function Ky(t,e,n){const a=n*n;if(e.length===1)return t.distSqr(e[0])<a;for(let u=1;u<e.length;u++)if(Wb(t,e[u-1],e[u])<a)return!0;return!1}function Wb(t,e,n){const a=e.distSqr(n);if(a===0)return t.distSqr(e);const u=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/a;return t.distSqr(u<0?e:u>1?n:n.sub(e)._mult(u)._add(e))}function qb(t,e){let n,a,u,d=!1;for(let p=0;p<t.length;p++){n=t[p];for(let y=0,b=n.length-1;y<n.length;b=y++)a=n[y],u=n[b],a.y>e.y!=u.y>e.y&&e.x<(u.x-a.x)*(e.y-a.y)/(u.y-a.y)+a.x&&(d=!d)}return d}function hc(t,e){let n=!1;for(let a=0,u=t.length-1;a<t.length;u=a++){const d=t[a],p=t[u];d.y>e.y!=p.y>e.y&&e.x<(p.x-d.x)*(e.y-d.y)/(p.y-d.y)+d.x&&(n=!n)}return n}function Zb(t,e,n,a,u){for(const p of t)if(e<=p.x&&n<=p.y&&a>=p.x&&u>=p.y)return!0;const d=[new Se(e,n),new Se(e,u),new Se(a,u),new Se(a,n)];if(t.length>2){for(const p of d)if(hc(t,p))return!0}for(let p=0;p<t.length-1;p++)if(XC(t[p],t[p+1],d))return!0;return!1}function XC(t,e,n){const a=n[0],u=n[2];if(t.x<a.x&&e.x<a.x||t.x>u.x&&e.x>u.x||t.y<a.y&&e.y<a.y||t.y>u.y&&e.y>u.y)return!1;const d=Re(t,e,n[0]);return d!==Re(t,e,n[1])||d!==Re(t,e,n[2])||d!==Re(t,e,n[3])}function Eu(t,e,n,a,u,d){let p=e.y-t.y,y=t.x-e.x;if(d=d||0){const b=p*p+y*y;if(b===0)return!0;const T=Math.sqrt(b);p/=T,y/=T}return!((n.x-t.x)*p+(n.y-t.y)*y-d<0||(a.x-t.x)*p+(a.y-t.y)*y-d<0||(u.x-t.x)*p+(u.y-t.y)*y-d<0)}function Jy(t,e,n,a,u,d,p){return!(Eu(t,e,a,u,d,p)||Eu(e,n,a,u,d,p)||Eu(n,t,a,u,d,p)||Eu(a,u,t,e,n,p)||Eu(u,d,t,e,n,p)||Eu(d,a,t,e,n,p))}function Au(t,e,n){const a=e.paint.get(t).value;return a.kind==="constant"?a.value:n.programConfigurations.get(e.id).getMaxValue(t)}function om(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Xb(t,e,n,a,u){if(!e[0]&&!e[1])return t;const d=Se.convert(e)._mult(u);n==="viewport"&&d._rotate(-a);const p=[];for(let y=0;y<t.length;y++)p.push(t[y].sub(d));return p}function Yb(t,e,n,a){const u=Se.convert(t)._mult(a);return e==="viewport"&&u._rotate(-n),u}Bt(Xy,"CircleBucket",{omit:["layers"]});const YC=new $e({"circle-sort-key":new Ce(De.layout_circle["circle-sort-key"]),visibility:new ue(De.layout_circle.visibility)});var KC={paint:new $e({"circle-radius":new Ce(De.paint_circle["circle-radius"]),"circle-color":new Ce(De.paint_circle["circle-color"]),"circle-blur":new Ce(De.paint_circle["circle-blur"]),"circle-opacity":new Ce(De.paint_circle["circle-opacity"]),"circle-translate":new ue(De.paint_circle["circle-translate"]),"circle-translate-anchor":new ue(De.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ue(De.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ue(De.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ce(De.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ce(De.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ce(De.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ue(De.paint_circle["circle-emissive-strength"])}),layout:YC};const JC=s.m.create(),Kb=t=>{const e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Jb(t,e,n,a,u,d,p,y,b){if(d&&t.queryGeometry.isAboveHorizon)return!1;d&&(b*=t.pixelToTileUnitsFactor);const T=t.tileID.canonical,E=n.projection.upVectorScale(T,n.center.lat,n.worldSize).metersToTile;for(const I of e)for(const C of I){const D=C.add(y),R=u&&n.elevation?n.elevation.exaggeration()*u.getElevationAt(D.x,D.y,!0):0,B=n.projection.projectTilePoint(D.x,D.y,T);if(R>0){const te=n.projection.upVector(T,D.x,D.y);B.x+=te[0]*E*R,B.y+=te[1]*E*R,B.z+=te[2]*E*R}const V=d?D:QC(B.x,B.y,B.z,a),G=d?t.tilespaceRays.map(te=>eP(te,R)):t.queryGeometry.screenGeometry,$=s.e.transformMat4([],[B.x,B.y,B.z,1],a);if(!p&&d?b*=$[3]/n.cameraToCenterDistance:p&&!d&&(b*=n.cameraToCenterDistance/$[3]),d){const te=wr((C.y/xt+T.y)/(1<<T.z));b/=n.projection.pixelsPerMeter(te,1)/qr(1,te)}if(WC(G,V,b))return!0}return!1}function QC(t,e,n,a){const u=s.e.transformMat4([],[t,e,n,1],a);return new Se(u[0]/u[3],u[1]/u[3])}const Qb=s.v.fromValues(0,0,0),$C=s.v.fromValues(0,0,1);function eP(t,e){const n=s.v.create();return Qb[2]=e,t.intersectsPlane(Qb,$C,n),new Se(n[0],n[1])}class $b extends Xy{}function ew(t,{width:e,height:n},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*n*a)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*n*a);return t.width=e,t.height=n,t.data=u,t}function tw(t,e,n){const{width:a,height:u}=e;a===t.width&&u===t.height||(Qy(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,a),height:Math.min(t.height,u)},n),t.width=a,t.height=u,t.data=e.data)}function Qy(t,e,n,a,u,d,p){if(u.width===0||u.height===0)return e;if(u.width>t.width||u.height>t.height||n.x>t.width-u.width||n.y>t.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||a.x>e.width-u.width||a.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const y=t.data,b=e.data,T=d===4&&p;for(let E=0;E<u.height;E++){const I=((n.y+E)*t.width+n.x)*d,C=((a.y+E)*e.width+a.x)*d;if(T)for(let D=0;D<u.width;D++){const R=I+D*d+3,B=C+D*d;b[B+0]=255,b[B+1]=255,b[B+2]=255,b[B+3]=y[R]}else for(let D=0;D<u.width*d;D++)b[C+D]=y[I+D]}return e}Bt($b,"HeatmapBucket",{omit:["layers"]});class Sa{constructor(e,n){ew(this,e,1,n)}resize(e){tw(this,new Sa(e),1)}clone(){return new Sa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,u,d){Qy(e,n,a,u,d,1)}}class Ds{constructor(e,n){ew(this,e,4,n)}resize(e){tw(this,new Ds(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ds({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,u,d,p){Qy(e,n,a,u,d,4,p)}}class iw{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}Bt(Sa,"AlphaImage"),Bt(Ds,"RGBAImage");const tP=new $e({visibility:new ue(De.layout_heatmap.visibility)});var iP={paint:new $e({"heatmap-radius":new Ce(De.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ce(De.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ue(De.paint_heatmap["heatmap-intensity"]),"heatmap-color":new st(De.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ue(De.paint_heatmap["heatmap-opacity"])}),layout:tP};function am(t){const e={},n=t.resolution||256,a=t.clips?t.clips.length:1,u=t.image||new Ds({width:n,height:a}),d=(p,y,b)=>{e[t.evaluationKey]=b;const T=t.expression.evaluate(e);T&&(u.data[p+y+0]=Math.floor(255*T.r/T.a),u.data[p+y+1]=Math.floor(255*T.g/T.a),u.data[p+y+2]=Math.floor(255*T.b/T.a),u.data[p+y+3]=Math.floor(255*T.a))};if(t.clips)for(let p=0,y=0;p<a;++p,y+=4*n)for(let b=0,T=0;b<n;b++,T+=4){const E=b/(n-1),{start:I,end:C}=t.clips[p];d(y,T,I*(1-E)+C*E)}else for(let p=0,y=0;p<n;p++,y+=4)d(0,y,p/(n-1));return u}const nP=new $e({visibility:new ue(De.layout_hillshade.visibility)});var rP={paint:new $e({"hillshade-illumination-direction":new ue(De.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ue(De.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ue(De.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ue(De.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ue(De.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ue(De.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ue(De.paint_hillshade["hillshade-emissive-strength"])}),layout:nP};const sP=Ht([{name:"a_pos",components:2,type:"Int16"}],4),{members:oP}=sP;var $y={exports:{}};function lm(t,e,n){n=n||2;var a,u,d,p,y,b,T,E=e&&e.length,I=E?e[0]*n:t.length,C=nw(t,0,I,n,!0),D=[];if(!C||C.next===C.prev)return D;if(E&&(C=function(B,V,G,$){var te,se,le,he=[];for(te=0,se=V.length;te<se;te++)(le=nw(B,V[te]*$,te<se-1?V[te+1]*$:B.length,$,!1))===le.next&&(le.steiner=!0),he.push(pP(le));for(he.sort(hP),te=0;te<he.length;te++)G=dP(he[te],G);return G}(t,e,C,n)),t.length>80*n){a=d=t[0],u=p=t[1];for(var R=n;R<I;R+=n)(y=t[R])<a&&(a=y),(b=t[R+1])<u&&(u=b),y>d&&(d=y),b>p&&(p=b);T=(T=Math.max(d-a,p-u))!==0?32767/T:0}return Sd(C,D,n,a,u,T,0),D}function nw(t,e,n,a,u){var d,p;if(u===i0(t,e,n,a)>0)for(d=e;d<n;d+=a)p=ow(d,t[d],t[d+1],p);else for(d=n-a;d>=e;d-=a)p=ow(d,t[d],t[d+1],p);return p&&cm(p,p.next)&&(Ad(p),p=p.next),p}function dc(t,e){if(!t)return t;e||(e=t);var n,a=t;do if(n=!1,a.steiner||!cm(a,a.next)&&nr(a.prev,a,a.next)!==0)a=a.next;else{if(Ad(a),(a=e=a.prev)===a.next)break;n=!0}while(n||a!==e);return e}function Sd(t,e,n,a,u,d,p){if(t){!p&&d&&function(E,I,C,D){var R=E;do R.z===0&&(R.z=e0(R.x,R.y,I,C,D)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==E);R.prevZ.nextZ=null,R.prevZ=null,function(B){var V,G,$,te,se,le,he,ye,we=1;do{for(G=B,B=null,se=null,le=0;G;){for(le++,$=G,he=0,V=0;V<we&&(he++,$=$.nextZ);V++);for(ye=we;he>0||ye>0&&$;)he!==0&&(ye===0||!$||G.z<=$.z)?(te=G,G=G.nextZ,he--):(te=$,$=$.nextZ,ye--),se?se.nextZ=te:B=te,te.prevZ=se,se=te;G=$}se.nextZ=null,we*=2}while(le>1)}(R)}(t,a,u,d);for(var y,b,T=t;t.prev!==t.next;)if(y=t.prev,b=t.next,d?lP(t,a,u,d):aP(t))e.push(y.i/n|0),e.push(t.i/n|0),e.push(b.i/n|0),Ad(t),t=b.next,T=b.next;else if((t=b)===T){p?p===1?Sd(t=cP(dc(t),e,n),e,n,a,u,d,2):p===2&&uP(t,e,n,a,u,d):Sd(dc(t),e,n,a,u,d,1);break}}}function aP(t){var e=t.prev,n=t,a=t.next;if(nr(e,n,a)>=0)return!1;for(var u=e.x,d=n.x,p=a.x,y=e.y,b=n.y,T=a.y,E=u<d?u<p?u:p:d<p?d:p,I=y<b?y<T?y:T:b<T?b:T,C=u>d?u>p?u:p:d>p?d:p,D=y>b?y>T?y:T:b>T?b:T,R=a.next;R!==e;){if(R.x>=E&&R.x<=C&&R.y>=I&&R.y<=D&&Iu(u,y,d,b,p,T,R.x,R.y)&&nr(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function lP(t,e,n,a){var u=t.prev,d=t,p=t.next;if(nr(u,d,p)>=0)return!1;for(var y=u.x,b=d.x,T=p.x,E=u.y,I=d.y,C=p.y,D=y<b?y<T?y:T:b<T?b:T,R=E<I?E<C?E:C:I<C?I:C,B=y>b?y>T?y:T:b>T?b:T,V=E>I?E>C?E:C:I>C?I:C,G=e0(D,R,e,n,a),$=e0(B,V,e,n,a),te=t.prevZ,se=t.nextZ;te&&te.z>=G&&se&&se.z<=$;){if(te.x>=D&&te.x<=B&&te.y>=R&&te.y<=V&&te!==u&&te!==p&&Iu(y,E,b,I,T,C,te.x,te.y)&&nr(te.prev,te,te.next)>=0||(te=te.prevZ,se.x>=D&&se.x<=B&&se.y>=R&&se.y<=V&&se!==u&&se!==p&&Iu(y,E,b,I,T,C,se.x,se.y)&&nr(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;te&&te.z>=G;){if(te.x>=D&&te.x<=B&&te.y>=R&&te.y<=V&&te!==u&&te!==p&&Iu(y,E,b,I,T,C,te.x,te.y)&&nr(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;se&&se.z<=$;){if(se.x>=D&&se.x<=B&&se.y>=R&&se.y<=V&&se!==u&&se!==p&&Iu(y,E,b,I,T,C,se.x,se.y)&&nr(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function cP(t,e,n){var a=t;do{var u=a.prev,d=a.next.next;!cm(u,d)&&rw(u,a,a.next,d)&&Ed(u,d)&&Ed(d,u)&&(e.push(u.i/n|0),e.push(a.i/n|0),e.push(d.i/n|0),Ad(a),Ad(a.next),a=t=d),a=a.next}while(a!==t);return dc(a)}function uP(t,e,n,a,u,d){var p=t;do{for(var y=p.next.next;y!==p.prev;){if(p.i!==y.i&&mP(p,y)){var b=sw(p,y);return p=dc(p,p.next),b=dc(b,b.next),Sd(p,e,n,a,u,d,0),void Sd(b,e,n,a,u,d,0)}y=y.next}p=p.next}while(p!==t)}function hP(t,e){return t.x-e.x}function dP(t,e){var n=function(u,d){var p,y=d,b=u.x,T=u.y,E=-1/0;do{if(T<=y.y&&T>=y.next.y&&y.next.y!==y.y){var I=y.x+(T-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(I<=b&&I>E&&(E=I,p=y.x<y.next.x?y:y.next,I===b))return p}y=y.next}while(y!==d);if(!p)return null;var C,D=p,R=p.x,B=p.y,V=1/0;y=p;do b>=y.x&&y.x>=R&&b!==y.x&&Iu(T<B?b:E,T,R,B,T<B?E:b,T,y.x,y.y)&&(C=Math.abs(T-y.y)/(b-y.x),Ed(y,u)&&(C<V||C===V&&(y.x>p.x||y.x===p.x&&fP(p,y)))&&(p=y,V=C)),y=y.next;while(y!==D);return p}(t,e);if(!n)return e;var a=sw(n,t);return dc(a,a.next),dc(n,n.next)}function fP(t,e){return nr(t.prev,t,e.prev)<0&&nr(e.next,t,t.next)<0}function e0(t,e,n,a,u){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function pP(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Iu(t,e,n,a,u,d,p,y){return(u-p)*(e-y)>=(t-p)*(d-y)&&(t-p)*(a-y)>=(n-p)*(e-y)&&(n-p)*(d-y)>=(u-p)*(a-y)}function mP(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,a){var u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==a.i&&u.next.i!==a.i&&rw(u,u.next,n,a))return!0;u=u.next}while(u!==n);return!1}(t,e)&&(Ed(t,e)&&Ed(e,t)&&function(n,a){var u=n,d=!1,p=(n.x+a.x)/2,y=(n.y+a.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&p<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(d=!d),u=u.next;while(u!==n);return d}(t,e)&&(nr(t.prev,t,e.prev)||nr(t,e.prev,e))||cm(t,e)&&nr(t.prev,t,t.next)>0&&nr(e.prev,e,e.next)>0)}function nr(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function cm(t,e){return t.x===e.x&&t.y===e.y}function rw(t,e,n,a){var u=hm(nr(t,e,n)),d=hm(nr(t,e,a)),p=hm(nr(n,a,t)),y=hm(nr(n,a,e));return u!==d&&p!==y||!(u!==0||!um(t,n,e))||!(d!==0||!um(t,a,e))||!(p!==0||!um(n,t,a))||!(y!==0||!um(n,e,a))}function um(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function hm(t){return t>0?1:t<0?-1:0}function Ed(t,e){return nr(t.prev,t,t.next)<0?nr(t,e,t.next)>=0&&nr(t,t.prev,e)>=0:nr(t,e,t.prev)<0||nr(t,t.next,e)<0}function sw(t,e){var n=new t0(t.i,t.x,t.y),a=new t0(e.i,e.x,e.y),u=t.next,d=e.prev;return t.next=e,e.prev=t,n.next=u,u.prev=n,a.next=n,n.prev=a,d.next=a,a.prev=d,a}function ow(t,e,n,a){var u=new t0(t,e,n);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function Ad(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function t0(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function i0(t,e,n,a){for(var u=0,d=e,p=n-a;d<n;d+=a)u+=(t[p]-t[d])*(t[d+1]+t[p+1]),p=d;return u}$y.exports=lm,$y.exports.default=lm,lm.deviation=function(t,e,n,a){var u=e&&e.length,d=Math.abs(i0(t,0,u?e[0]*n:t.length,n));if(u)for(var p=0,y=e.length;p<y;p++)d-=Math.abs(i0(t,e[p]*n,p<y-1?e[p+1]*n:t.length,n));var b=0;for(p=0;p<a.length;p+=3){var T=a[p]*n,E=a[p+1]*n,I=a[p+2]*n;b+=Math.abs((t[T]-t[I])*(t[E+1]-t[T+1])-(t[T]-t[E])*(t[I+1]-t[T+1]))}return d===0&&b===0?0:Math.abs((b-d)/d)},lm.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},a=0,u=0;u<t.length;u++){for(var d=0;d<t[u].length;d++)for(var p=0;p<e;p++)n.vertices.push(t[u][d][p]);u>0&&n.holes.push(a+=t[u-1].length)}return n};var dm=pe($y.exports);function n0(t,e){const n=t.length;if(n<=1)return[t];const a=[];let u,d;for(let p=0;p<n;p++){const y=ee(t[p]);y!==0&&(t[p].area=Math.abs(y),d===void 0&&(d=y<0),d===y<0?(u&&a.push(u),u=[t[p]]):u.push(t[p]))}if(u&&a.push(u),e>1)for(let p=0;p<a.length;p++)a[p].length<=e||(sp(a[p],e,1,a[p].length-1,gP),a[p]=a[p].slice(0,e));return a}function gP(t,e){return e.area-t.area}function r0(t,e,n){const a=n.patternDependencies;let u=!1;for(const d of e){const p=d.paint.get(`${t}-pattern`);p.isConstant()||(u=!0);const y=p.constantOr(null);y&&(u=!0,a[y]=!0)}return u}function s0(t,e,n,a,u){const d=u.patternDependencies;for(const p of e){const y=p.paint.get(`${t}-pattern`).value;if(y.kind!=="constant"){let b=y.evaluate({zoom:a},n,{},u.availableImages);b=b&&b.name?b.name:b,d[b]=!0,n.patterns[p.id]=b}}return n}class fm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new hi,this.indexArray=new tn,this.indexArray2=new Rr,this.programConfigurations=new ol(e.layers,e.zoom),this.segments=new Tn,this.segments2=new Tn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,a,u){this.hasPattern=r0("fill",this.layers,n);const d=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:y,id:b,index:T,sourceLayerIndex:E}of e){const I=this.layers[0]._featureFilter.needGeometry,C=ul(y,I);if(!this.layers[0]._featureFilter.filter(new _e(this.zoom),C,a))continue;const D=d?d.evaluate(C,{},a,n.availableImages):void 0,R={id:b,properties:y.properties,type:y.type,sourceLayerIndex:E,index:T,geometry:I?C.geometry:Go(y,a,u),patterns:{},sortKey:D};p.push(R)}d&&p.sort((y,b)=>y.sortKey-b.sortKey);for(const y of p){const{geometry:b,index:T,sourceLayerIndex:E}=y;if(this.hasPattern){const I=s0("fill",this.layers,y,this.zoom,n);this.patternFeatures.push(I)}else this.addFeature(y,b,T,a,{},n.availableImages,n.brightness);n.featureIndex.insert(e[T].feature,b,T,E,this.index)}}update(e,n,a,u,d){const p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,a,u,d)}addFeatures(e,n,a,u,d,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,a,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,oP),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,a,u,d,p=[],y){for(const b of n0(n,500)){let T=0;for(const B of b)T+=B.length;const E=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),I=E.vertexLength,C=[],D=[];for(const B of b){if(B.length===0)continue;B!==b[0]&&D.push(C.length/2);const V=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),G=V.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(G+B.length-1,G),C.push(B[0].x),C.push(B[0].y);for(let $=1;$<B.length;$++)this.layoutVertexArray.emplaceBack(B[$].x,B[$].y),this.indexArray2.emplaceBack(G+$-1,G+$),C.push(B[$].x),C.push(B[$].y);V.vertexLength+=B.length,V.primitiveLength+=B.length}const R=dm(C,D);for(let B=0;B<R.length;B+=3)this.indexArray.emplaceBack(I+R[B],I+R[B+1],I+R[B+2]);E.vertexLength+=T,E.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,p,u,y)}}Bt(fm,"FillBucket",{omit:["layers","patternFeatures"]});const _P=new $e({"fill-sort-key":new Ce(De.layout_fill["fill-sort-key"]),visibility:new ue(De.layout_fill.visibility)});var yP={paint:new $e({"fill-antialias":new ue(De.paint_fill["fill-antialias"]),"fill-opacity":new Ce(De.paint_fill["fill-opacity"]),"fill-color":new Ce(De.paint_fill["fill-color"]),"fill-outline-color":new Ce(De.paint_fill["fill-outline-color"]),"fill-translate":new ue(De.paint_fill["fill-translate"]),"fill-translate-anchor":new ue(De.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ce(De.paint_fill["fill-pattern"]),"fill-emissive-strength":new ue(De.paint_fill["fill-emissive-strength"])}),layout:_P};const xP=Ht([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),vP=Ht([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),bP=Ht([{name:"a_centroid_pos",components:2,type:"Uint16"}]),wP=Ht([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),TP=Ht([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:MP}=xP;var pm={},SP=ot,aw=ku;function ku(t,e,n,a,u){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=a,this._values=u,t.readFields(EP,this,e)}function EP(t,e,n){t==1?e.id=n.readVarint():t==2?function(a,u){for(var d=a.readVarint()+a.pos;a.pos<d;){var p=u._keys[a.readVarint()],y=u._values[a.readVarint()];u.properties[p]=y}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function AP(t){for(var e,n,a=0,u=0,d=t.length,p=d-1;u<d;p=u++)a+=((n=t[p]).x-(e=t[u]).x)*(e.y+n.y);return a}ku.types=["Unknown","Point","LineString","Polygon"],ku.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,a=1,u=0,d=0,p=0,y=[];t.pos<n;){if(u<=0){var b=t.readVarint();a=7&b,u=b>>3}if(u--,a===1||a===2)d+=t.readSVarint(),p+=t.readSVarint(),a===1&&(e&&y.push(e),e=[]),e.push(new SP(d,p));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&y.push(e),y},ku.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,a=0,u=0,d=0,p=1/0,y=-1/0,b=1/0,T=-1/0;t.pos<e;){if(a<=0){var E=t.readVarint();n=7&E,a=E>>3}if(a--,n===1||n===2)(u+=t.readSVarint())<p&&(p=u),u>y&&(y=u),(d+=t.readSVarint())<b&&(b=d),d>T&&(T=d);else if(n!==7)throw new Error("unknown command "+n)}return[p,b,y,T]},ku.prototype.toGeoJSON=function(t,e,n){var a,u,d=this.extent*Math.pow(2,n),p=this.extent*t,y=this.extent*e,b=this.loadGeometry(),T=ku.types[this.type];function E(D){for(var R=0;R<D.length;R++){var B=D[R];D[R]=[360*(B.x+p)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(B.y+y)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(a=0;a<b.length;a++)I[a]=b[a][0];E(b=I);break;case 2:for(a=0;a<b.length;a++)E(b[a]);break;case 3:for(b=function(D){var R=D.length;if(R<=1)return[D];for(var B,V,G=[],$=0;$<R;$++){var te=AP(D[$]);te!==0&&(V===void 0&&(V=te<0),V===te<0?(B&&G.push(B),B=[D[$]]):B.push(D[$]))}return B&&G.push(B),G}(b),a=0;a<b.length;a++)for(u=0;u<b[a].length;u++)E(b[a][u])}b.length===1?b=b[0]:T="Multi"+T;var C={type:"Feature",geometry:{type:T,coordinates:b},properties:this.properties};return"id"in this&&(C.id=this.id),C};var IP=aw,lw=cw;function cw(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(kP,this,e),this.length=this._features.length}function kP(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(a){for(var u=null,d=a.readVarint()+a.pos;a.pos<d;){var p=a.readVarint()>>3;u=p===1?a.readString():p===2?a.readFloat():p===3?a.readDouble():p===4?a.readVarint64():p===5?a.readVarint():p===6?a.readSVarint():p===7?a.readBoolean():null}return u}(n))}cw.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new IP(this._pbf,e,this.extent,this._keys,this._values)};var CP=lw;function PP(t,e,n){if(t===3){var a=new CP(n,n.readVarint()+n.pos);a.length&&(e[a.name]=a)}}var o0=pm.VectorTile=function(t,e){this.layers=t.readFields(PP,{},e)},mm=pm.VectorTileFeature=aw;function gm(t,e,n,a){const u=[],d=a===0?(p,y,b,T,E,I)=>{p.push(new Se(I,b+(I-y)/(T-y)*(E-b)))}:(p,y,b,T,E,I)=>{p.push(new Se(y+(I-b)/(E-b)*(T-y),I))};for(const p of t){const y=[];for(const b of p){if(b.length<=2)continue;const T=[];for(let C=0;C<b.length-1;C++){const D=b[C].x,R=b[C].y,B=b[C+1].x,V=b[C+1].y,G=a===0?D:R,$=a===0?B:V;G<e?$>e&&d(T,D,R,B,V,e):G>n?$<n&&d(T,D,R,B,V,n):T.push(b[C]),$<e&&G>=e&&d(T,D,R,B,V,e),$>n&&G<=n&&d(T,D,R,B,V,n)}let E=b[b.length-1];const I=a===0?E.x:E.y;I>=e&&I<=n&&T.push(E),T.length&&(E=T[T.length-1],T[0].x===E.x&&T[0].y===E.y||T.push(T[0]),y.push(T))}y.length&&u.push(y)}return u}pm.VectorTileLayer=lw;class uw{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const a=e[n];this._stringToNumber[a]=n,this._numberToString[n]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var DP={read:function(t,e,n,a,u){var d,p,y=8*u-a-1,b=(1<<y)-1,T=b>>1,E=-7,I=n?u-1:0,C=n?-1:1,D=t[e+I];for(I+=C,d=D&(1<<-E)-1,D>>=-E,E+=y;E>0;d=256*d+t[e+I],I+=C,E-=8);for(p=d&(1<<-E)-1,d>>=-E,E+=a;E>0;p=256*p+t[e+I],I+=C,E-=8);if(d===0)d=1-T;else{if(d===b)return p?NaN:1/0*(D?-1:1);p+=Math.pow(2,a),d-=T}return(D?-1:1)*p*Math.pow(2,d-a)},write:function(t,e,n,a,u,d){var p,y,b,T=8*d-u-1,E=(1<<T)-1,I=E>>1,C=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,D=a?0:d-1,R=a?1:-1,B=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,p=E):(p=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-p))<1&&(p--,b*=2),(e+=p+I>=1?C/b:C*Math.pow(2,1-I))*b>=2&&(p++,b/=2),p+I>=E?(y=0,p=E):p+I>=1?(y=(e*b-1)*Math.pow(2,u),p+=I):(y=e*Math.pow(2,I-1)*Math.pow(2,u),p=0));u>=8;t[n+D]=255&y,D+=R,y/=256,u-=8);for(p=p<<u|y,T+=u;T>0;t[n+D]=255&p,D+=R,p/=256,T-=8);t[n+D-R]|=128*B}},hw=xn,_m=DP;function xn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}xn.Varint=0,xn.Fixed64=1,xn.Bytes=2,xn.Fixed32=5;var a0=4294967296,dw=1/a0,fw=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ea(t){return t.type===xn.Bytes?t.readVarint()+t.pos:t.pos+1}function Cu(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function pw(t,e,n){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(a);for(var u=n.pos-1;u>=t;u--)n.buf[u+a]=n.buf[u]}function zP(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function LP(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function RP(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function OP(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function BP(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function FP(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function NP(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function VP(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function jP(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function ym(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Pu(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function mw(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}xn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var a=this.readVarint(),u=a>>3,d=this.pos;this.type=7&a,t(u,e,this),this.pos===d&&this.skip(a)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=ym(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=mw(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=ym(this.buf,this.pos)+ym(this.buf,this.pos+4)*a0;return this.pos+=8,t},readSFixed64:function(){var t=ym(this.buf,this.pos)+mw(this.buf,this.pos+4)*a0;return this.pos+=8,t},readFloat:function(){var t=_m.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=_m.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,a=this.buf;return e=127&(n=a[this.pos++]),n<128?e:(e|=(127&(n=a[this.pos++]))<<7,n<128?e:(e|=(127&(n=a[this.pos++]))<<14,n<128?e:(e|=(127&(n=a[this.pos++]))<<21,n<128?e:function(u,d,p){var y,b,T=p.buf;if(y=(112&(b=T[p.pos++]))>>4,b<128||(y|=(127&(b=T[p.pos++]))<<3,b<128)||(y|=(127&(b=T[p.pos++]))<<10,b<128)||(y|=(127&(b=T[p.pos++]))<<17,b<128)||(y|=(127&(b=T[p.pos++]))<<24,b<128)||(y|=(1&(b=T[p.pos++]))<<31,b<128))return Cu(u,y,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=a[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&fw?function(n,a,u){return fw.decode(n.subarray(a,u))}(this.buf,e,t):function(n,a,u){for(var d="",p=a;p<u;){var y,b,T,E=n[p],I=null,C=E>239?4:E>223?3:E>191?2:1;if(p+C>u)break;C===1?E<128&&(I=E):C===2?(192&(y=n[p+1]))==128&&(I=(31&E)<<6|63&y)<=127&&(I=null):C===3?(b=n[p+2],(192&(y=n[p+1]))==128&&(192&b)==128&&((I=(15&E)<<12|(63&y)<<6|63&b)<=2047||I>=55296&&I<=57343)&&(I=null)):C===4&&(b=n[p+2],T=n[p+3],(192&(y=n[p+1]))==128&&(192&b)==128&&(192&T)==128&&((I=(15&E)<<18|(63&y)<<12|(63&b)<<6|63&T)<=65535||I>=1114112)&&(I=null)),I===null?(I=65533,C=1):I>65535&&(I-=65536,d+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),d+=String.fromCharCode(I),p+=C}return d}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==xn.Bytes)return t.push(this.readVarint(e));var n=Ea(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==xn.Bytes)return t.push(this.readSVarint());var e=Ea(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==xn.Bytes)return t.push(this.readBoolean());var e=Ea(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==xn.Bytes)return t.push(this.readFloat());var e=Ea(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==xn.Bytes)return t.push(this.readDouble());var e=Ea(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==xn.Bytes)return t.push(this.readFixed32());var e=Ea(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==xn.Bytes)return t.push(this.readSFixed32());var e=Ea(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==xn.Bytes)return t.push(this.readFixed64());var e=Ea(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==xn.Bytes)return t.push(this.readSFixed64());var e=Ea(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===xn.Varint)for(;this.buf[this.pos++]>127;);else if(e===xn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===xn.Fixed32)this.pos+=4;else{if(e!==xn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Pu(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Pu(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Pu(this.buf,-1&t,this.pos),Pu(this.buf,Math.floor(t*dw),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Pu(this.buf,-1&t,this.pos),Pu(this.buf,Math.floor(t*dw),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var a,u;if(e>=0?(a=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(d,p,y){y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,y.buf[y.pos]=127&(d>>>=7)}(a,0,n),function(d,p){var y=(7&d)<<4;p.buf[p.pos++]|=y|((d>>>=3)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d)))))}(u,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(a,u,d){for(var p,y,b=0;b<u.length;b++){if((p=u.charCodeAt(b))>55295&&p<57344){if(!y){p>56319||b+1===u.length?(a[d++]=239,a[d++]=191,a[d++]=189):y=p;continue}if(p<56320){a[d++]=239,a[d++]=191,a[d++]=189,y=p;continue}p=y-55296<<10|p-56320|65536,y=null}else y&&(a[d++]=239,a[d++]=191,a[d++]=189,y=null);p<128?a[d++]=p:(p<2048?a[d++]=p>>6|192:(p<65536?a[d++]=p>>12|224:(a[d++]=p>>18|240,a[d++]=p>>12&63|128),a[d++]=p>>6&63|128),a[d++]=63&p|128)}return d}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&pw(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),_m.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),_m.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var a=this.pos-n;a>=128&&pw(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a},writeMessage:function(t,e,n){this.writeTag(t,xn.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,zP,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,LP,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,BP,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,RP,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,OP,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,FP,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,NP,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,VP,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,jP,e)},writeBytesField:function(t,e){this.writeTag(t,xn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,xn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,xn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,xn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,xn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,xn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,xn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,xn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,xn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,xn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var xm=pe(hw);const UP=["tile","layer","source","sourceLayer","state"];class gw{constructor(e,n,a,u,d){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=a,this._y=u,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const n of UP)this[n]!==void 0&&(e[n]=this[n]);return e}}class GP{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,a){const u=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},Qe(this.stateChanges[e][u],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const d in this.state[e])d!==u&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const d in this.state[e][u])a[d]||(this.deletedStates[e][u][d]=null)}else for(const d in a)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][d]===null&&delete this.deletedStates[e][u][d]}removeFeatureState(e,n,a){if(this.deletedStates[e]===null)return;const u=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&n!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][a]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(a in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][a]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,n){const a=String(n),u=Qe({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const d=this.deletedStates[e][n];if(d===null)return{};for(const p in d)delete u[p]}return u}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const a={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const d={};for(const p in this.stateChanges[u])this.state[u][p]||(this.state[u][p]={}),Qe(this.state[u][p],this.stateChanges[u][p]),d[p]=this.state[u][p];a[u]=d}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const d={};if(this.deletedStates[u]===null)for(const p in this.state[u])d[p]={},this.state[u][p]={};else for(const p in this.deletedStates[u]){if(this.deletedStates[u][p]===null)this.state[u][p]={};else if(this.state[u][p])for(const y of Object.keys(this.deletedStates[u][p]))delete this.state[u][p][y];d[p]=this.state[u][p]}a[u]=a[u]||{},Qe(a[u],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const u in e)e[u].setFeatureState(a,n)}}class _w{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const a=this.toIdx(e,n);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function yw(t,e,n,a){let u=0,d=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(a[p])<1e-15){if(n[p]<t[p]||n[p]>e[p])return null}else{const y=1/a[p];let b=(t[p]-n[p])*y,T=(e[p]-n[p])*y;if(b>T){const E=b;b=T,T=E}if(b>u&&(u=b),T<d&&(d=T),u>d)return null}return u}function xw(t,e,n,a,u,d,p,y,b,T,E){const I=a-t,C=u-e,D=d-n,R=p-t,B=y-e,V=b-n,G=E[1]*V-E[2]*B,$=E[2]*R-E[0]*V,te=E[0]*B-E[1]*R,se=I*G+C*$+D*te;if(Math.abs(se)<1e-15)return null;const le=1/se,he=T[0]-t,ye=T[1]-e,we=T[2]-n,Ie=(he*G+ye*$+we*te)*le;if(Ie<0||Ie>1)return null;const Le=ye*D-we*C,Pe=we*I-he*D,Ge=he*C-ye*I,ct=(E[0]*Le+E[1]*Pe+E[2]*Ge)*le;return ct<0||Ie+ct>1?null:(R*Le+B*Pe+V*Ge)*le}function vw(t,e,n){return(t-e)/(n-e)}function bw(t,e,n,a,u,d,p,y,b){const T=1<<n,E=d-a,I=p-u,C=(t+1)/T*E+a,D=(e+0)/T*I+u,R=(e+1)/T*I+u;y[0]=(t+0)/T*E+a,y[1]=D,b[0]=C,b[1]=R}class ww{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(d){const p=Math.ceil(Math.log2(d.dim/8)),y=[];let b=Math.ceil(Math.pow(2,p));const T=1/b,E=(D,R,B,V,G)=>{const $=V?1:0,te=(D+1)*B-$,se=R*B,le=(R+1)*B-$;G[0]=D*B,G[1]=se,G[2]=te,G[3]=le};let I=new _w(b);const C=[];for(let D=0;D<b*b;D++){E(D%b,Math.floor(D/b),T,!1,C);const R=hl(C[0],C[1],d),B=hl(C[2],C[1],d),V=hl(C[2],C[3],d),G=hl(C[0],C[3],d);I.minimums.push(Math.min(R,B,V,G)),I.maximums.push(Math.max(R,B,V,G)),I.leaves.push(1)}for(y.push(I),b/=2;b>=1;b/=2){const D=y[y.length-1];I=new _w(b);for(let R=0;R<b*b;R++){E(R%b,Math.floor(R/b),2,!0,C);const B=D.getElevation(C[0],C[1]),V=D.getElevation(C[2],C[1]),G=D.getElevation(C[2],C[3]),$=D.getElevation(C[0],C[3]),te=D.isLeaf(C[0],C[1]),se=D.isLeaf(C[2],C[1]),le=D.isLeaf(C[2],C[3]),he=D.isLeaf(C[0],C[3]),ye=Math.min(B.min,V.min,G.min,$.min),we=Math.max(B.max,V.max,G.max,$.max),Ie=te&&se&&le&&he;I.maximums.push(we),I.minimums.push(ye),I.leaves.push(we-ye<=5&&Ie?1:0)}y.push(I)}return y}(this.dem),a=n.length-1,u=n[a];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(n,0,0,a,0)}raycastRoot(e,n,a,u,d,p,y=1){return yw([e,n,-100],[a,u,this.maximums[0]*y],d,p)}raycast(e,n,a,u,d,p,y=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,n,a,u,d,p,y);if(b==null)return null;const T=[],E=[],I=[],C=[],D=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;D.length>0;){const{idx:R,t:B,nodex:V,nodey:G,depth:$}=D.pop();if(this.leaves[R]){bw(V,G,$,e,n,a,u,I,C);const se=1<<$,le=(V+0)/se,he=(V+1)/se,ye=(G+0)/se,we=(G+1)/se,Ie=hl(le,ye,this.dem)*y,Le=hl(he,ye,this.dem)*y,Pe=hl(he,we,this.dem)*y,Ge=hl(le,we,this.dem)*y,ct=xw(I[0],I[1],Ie,C[0],I[1],Le,C[0],C[1],Pe,d,p),Ve=xw(C[0],C[1],Pe,I[0],C[1],Ge,I[0],I[1],Ie,d,p),rt=Math.min(ct!==null?ct:Number.MAX_VALUE,Ve!==null?Ve:Number.MAX_VALUE);if(rt!==Number.MAX_VALUE)return rt;{const Ne=s.v.scaleAndAdd([],d,p,B);if(Tw(Ie,Le,Ge,Pe,vw(Ne[0],I[0],C[0]),vw(Ne[1],I[1],C[1]))>=Ne[2])return B}continue}let te=0;for(let se=0;se<this._siblingOffset.length;se++){bw((V<<1)+this._siblingOffset[se][0],(G<<1)+this._siblingOffset[se][1],$+1,e,n,a,u,I,C),I[2]=-100,C[2]=this.maximums[this.childOffsets[R]+se]*y;const le=yw(I,C,d,p);if(le!=null){const he=le;T[se]=he;let ye=!1;for(let we=0;we<te&&!ye;we++)he>=T[E[we]]&&(E.splice(we,0,se),ye=!0);ye||(E[te]=se),te++}}for(let se=0;se<te;se++){const le=E[se];D.push({idx:this.childOffsets[R]+le,t:T[le],nodex:(V<<1)+this._siblingOffset[le][0],nodey:(G<<1)+this._siblingOffset[le][1],depth:$+1})}}return null}_addNode(e,n,a){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,a,u,d){if(e[u].isLeaf(n,a)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const p=u-1,y=e[p];let b=0,T=0;for(let E=0;E<this._siblingOffset.length;E++){const I=2*n+this._siblingOffset[E][0],C=2*a+this._siblingOffset[E][1],D=y.getElevation(I,C),R=y.isLeaf(I,C),B=this._addNode(D.min,D.max,R);R&&(b|=1<<E),T||(T=B)}for(let E=0;E<this._siblingOffset.length;E++)b&1<<E||this._construct(e,2*n+this._siblingOffset[E][0],2*a+this._siblingOffset[E][1],p,T+E)}}function Tw(t,e,n,a,u,d){return Mi(Mi(t,n,d),Mi(e,a,d),u)}function hl(t,e,n){const a=n.dim,u=ft(t*a-.5,0,a-1),d=ft(e*a-.5,0,a-1),p=Math.floor(u),y=Math.floor(d),b=Math.min(p+1,a-1),T=Math.min(y+1,a-1);return Tw(n.get(p,y),n.get(b,y),n.get(p,T),n.get(b,T),u-p,d-y)}const HP={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function WP(t,e,n){return(256*t*256+256*e+n)/10-1e4}function qP(t,e,n){return 256*t+e+n/256-32768}class vm{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,a,u=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return si(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const d=this.dim=n.height-2,p=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let b=0;b<d;b++)p[this._idx(-1,b)]=p[this._idx(0,b)],p[this._idx(d,b)]=p[this._idx(d-1,b)],p[this._idx(b,-1)]=p[this._idx(b,0)],p[this._idx(b,d)]=p[this._idx(b,d-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(d,-1)]=p[this._idx(d-1,0)],p[this._idx(-1,d)]=p[this._idx(0,d-1)],p[this._idx(d,d)]=p[this._idx(d-1,d-1)]}const y=a==="terrarium"?qP:WP;for(let b=0;b<p.length;++b){const T=4*b;this.floatView[b]=y(this.pixels[T],this.pixels[T+1],this.pixels[T+2])}this._timestamp=Cr.now()}_buildQuadTree(){this._tree=new ww(this)}get(e,n,a=!1){a&&(e=ft(e,-1,this.dim),n=ft(n,-1,this.dim));const u=this._idx(e,n);return this.floatView[u]}set(e,n,a){const u=this._idx(e,n),d=this.floatView[u];return this.floatView[u]=a,a-d}static getUnpackVector(e){return HP[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const a=[0,0,0,0],u=vm.getUnpackVector(n);let d=Math.floor((e+u[3])/u[2]);return a[2]=d%256,d=Math.floor(d/256),a[1]=d%256,d=Math.floor(d/256),a[0]=d,a}getPixels(){return new iw({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,d=n*this.dim+this.dim,p=a*this.dim,y=a*this.dim+this.dim;switch(n){case-1:u=d-1;break;case 1:d=u+1}switch(a){case-1:p=y-1;break;case 1:y=p+1}const b=-n*this.dim,T=-a*this.dim;for(let E=p;E<y;E++)for(let I=u;I<d;I++){const C=4*this._idx(I,E),D=4*this._idx(I+b,E+T);this.pixels[C+0]=e.pixels[D+0],this.pixels[C+1]=e.pixels[D+1],this.pixels[C+2]=e.pixels[D+2],this.pixels[C+3]=e.pixels[D+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Bt(vm,"DEMData"),Bt(ww,"DemMinMaxQuadTree",{omit:["dem"]});class Du{constructor(e,n,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=a}static create(e,n,a){const u=a||e.findDEMTileFor(n);if(!u||!u.dem)return;const d=u.dem,p=u.tileID,y=1<<n.canonical.z-p.canonical.z;return new Du(u,d.dim/xt/y,[(n.canonical.x/y-p.canonical.x)*d.dim,(n.canonical.y/y-p.canonical.y)*d.dim])}tileCoordToPixel(e,n){const a=n*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(a);return new Se(u,d)}getElevationAt(e,n,a,u){const d=e*this._scale+this._offset[0],p=n*this._scale+this._offset[1],y=Math.floor(d),b=Math.floor(p),T=this._dem;return u=!!u,a?Mi(Mi(T.get(y,b,u),T.get(y,b+1,u),p-b),Mi(T.get(y+1,b,u),T.get(y+1,b+1,u),p-b),d-y):T.get(y,b,u)}getElevationAtPixel(e,n,a){return this._dem.get(e,n,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*qr(1,e)*this._dem.stride}}class l0{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new rl(xt,16,0),this.featureIndexArray=new $v,this.promoteId=n}insert(e,n,a,u,d,p=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,d,p);const b=this.grid;for(let T=0;T<n.length;T++){const E=n[T],I=[1/0,1/0,-1/0,-1/0];for(let C=0;C<E.length;C++){const D=E[C];I[0]=Math.min(I[0],D.x),I[1]=Math.min(I[1],D.y),I[2]=Math.max(I[2],D.x),I[3]=Math.max(I[3],D.y)}I[0]<xt&&I[1]<xt&&I[2]>=0&&I[3]>=0&&b.insert(y,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new o0(new xm(this.rawTileData)).layers,this.sourceLayerCoder=new uw(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,a,u){this.loadVTLayers();const d=e.params||{},p=_u(d.filter),y=e.tileResult,b=e.transform,T=y.bufferedTilespaceBounds,E=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(R,B,V,G)=>Zb(y.bufferedTilespaceGeometry,R,B,V,G));E.sort(ZP);let I=null;b.elevation&&E.length>0&&(I=Du.create(b.elevation,this.tileID));const C={};let D;for(let R=0;R<E.length;R++){const B=E[R];if(B===D)continue;D=B;const V=this.featureIndexArray.get(B);let G=null;this.loadMatchingFeature(C,V,p,d.layers,d.availableImages,n,a,u,($,te,se,le=0)=>(G||(G=Go($,this.tileID.canonical,e.tileTransform)),te.queryIntersectsFeature(y,$,se,G,this.z,e.transform,e.pixelPosMatrix,I,le)))}return C}loadMatchingFeature(e,n,a,u,d,p,y,b,T){const{featureIndex:E,bucketIndex:I,sourceLayerIndex:C,layoutVertexArrayOffset:D}=n,R=this.bucketLayerIDs[I];if(u&&!function($,te){for(let se=0;se<$.length;se++)if(te.indexOf($[se])>=0)return!0;return!1}(u,R))return;const B=this.sourceLayerCoder.decode(C),V=this.vtLayers[B].feature(E);if(a.needGeometry){const $=ul(V,!0);if(!a.filter(new _e(this.tileID.overscaledZ),$,this.tileID.canonical))return}else if(!a.filter(new _e(this.tileID.overscaledZ),V))return;const G=this.getId(V,B);for(let $=0;$<R.length;$++){const te=R[$];if(u&&u.indexOf(te)<0)continue;const se=p[te];if(!se)continue;let le={};G!==void 0&&b&&(le=b.getState(se.sourceLayer||"_geojsonTileLayer",G));const he=Qe({},y[te]);he.paint=Mw(he.paint,se.paint,V,le,d),he.layout=Mw(he.layout,se.layout,V,le,d);const ye=!T||T(V,se,le,D);if(!ye)continue;const we=new gw(V,this.z,this.x,this.y,G);we.layer=he;let Ie=e[te];Ie===void 0&&(Ie=e[te]=[]),Ie.push({featureIndex:E,feature:we,intersectionZ:ye})}}lookupSymbolFeatures(e,n,a,u,d,p,y,b){const T={};this.loadVTLayers();const E=_u(d);for(const I of e)this.loadMatchingFeature(T,{bucketIndex:a,sourceLayerIndex:u,featureIndex:I,layoutVertexArrayOffset:0},E,p,y,b,n);return T}loadFeature(e){const{featureIndex:n,sourceLayerIndex:a}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(a),d=this.vtFeatures[u];if(d[n])return d[n];const p=this.vtLayers[u].feature(n);return d[n]=p,p}hasLayer(e){for(const n of this.bucketLayerIDs)for(const a of n)if(e===a)return!0;return!1}getId(e,n){let a=e.id;if(this.promoteId){const u=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];u!=null&&(a=e.properties[u]),typeof a=="boolean"&&(a=Number(a))}return a}}function Mw(t,e,n,a,u){return $n(t,(d,p)=>{const y=e instanceof qe?e.get(p):null;return y&&y.evaluate?y.evaluate(n,a,u):y})}function ZP(t,e){return e-t}Bt(l0,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const XP=Ht([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),YP=Ht([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),KP=Ht([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ht([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const JP=Ht([{name:"a_z_offset",components:1,type:"Float32"}],4),QP=Ht([{name:"a_texb",components:2,type:"Uint16"}]),$P=Ht([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),e3=Ht([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Ht([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Sw=Ht([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),t3=Ht([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ht([{name:"triangle",components:3,type:"Uint16"}]),Ht([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ht([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Ht([{type:"Float32",name:"offsetX"}]),Ht([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Tr=24;const co=128;function c0(t,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new _e(t+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:u}=n;let d=0;for(;d<a.length&&a[d]<=t;)d++;d=Math.max(0,d-1);let p=d;for(;p<a.length&&a[p]<t+1;)p++;p=Math.min(a.length-1,p);const y=a[d],b=a[p];return n.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:b,minSize:n.evaluate(new _e(y)),maxSize:n.evaluate(new _e(b)),interpolationType:u}}}function bm(t,{uSize:e,uSizeT:n},{lowerSize:a,upperSize:u}){return t.kind==="source"?a/co:t.kind==="composite"?Mi(a/co,u/co,n):e}function zu(t,e){let n=0,a=0;if(t.kind==="constant")a=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:u,minZoom:d,maxZoom:p}=t,y=u?ft(Ss.interpolationFactor(u,e,d,p),0,1):0;t.kind==="camera"?a=Mi(t.minSize,t.maxSize,y):n=y}return{uSizeT:n,uSize:a}}var i3=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:co,evaluateSizeForFeature:bm,evaluateSizeForZoom:zu,getSizeData:c0});function n3(t,e,n){return t.sections.forEach(a=>{a.text=function(u,d,p){const y=d.layout.get("text-transform").evaluate(p,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),xe.applyArabicShaping&&(u=xe.applyArabicShaping(u)),u}(a.text,e,n)}),t}const Id={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function r3(t){return t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""}function s3(t){return t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""}const u0=3;function o3(t,e,n){e.glyphs=[],t===1&&n.readMessage(a3,e)}function a3(t,e,n){if(t===3){const{id:a,bitmap:u,width:d,height:p,left:y,top:b,advance:T}=n.readMessage(l3,{});e.glyphs.push({id:a,bitmap:new Sa({width:d+2*u0,height:p+2*u0},u),metrics:{width:d,height:p,left:y,top:b,advance:T}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function l3(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}const Ew=u0,zs={horizontal:1,vertical:2,horizontalOnly:3},Aw=-17;class kd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const a=new kd;return a.scale=e||1,a.fontStack=n,a}static forImage(e){const n=new kd;return n.imageName=e,n}}class Lu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const a=new Lu;for(let u=0;u<e.sections.length;u++){const d=e.sections[u];d.image?a.addImageSection(d):a.addTextSection(d,n)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,a){let u="";for(let d=0;d<n.length;d++){const p=n.charCodeAt(d+1)||null,y=n.charCodeAt(d-1)||null;u+=!a&&(p&&O(p)&&!Id[n[d+1]]||y&&O(y)&&!Id[n[d-1]])||!Id[n[d]]?n[d]:Id[n[d]]}return u}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&wm[this.text.charCodeAt(a)];a++)e++;let n=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&wm[this.text.charCodeAt(a)];a--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const a=new Lu;return a.text=this.text.substring(e,n),a.sectionIndex=this.sectionIndex.slice(e,n),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(kd.forText(e.scale,e.fontStack||n));const a=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(a)}addImageSection(e){const n=e.image?e.image.namePrimary:"";if(n.length===0)return void si("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(kd.forImage(n)),this.sectionIndex.push(this.sections.length-1)):si("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function h0(t,e,n,a,u,d,p,y,b,T,E,I,C,D,R){const B=Lu.fromFeature(t,u);I===zs.vertical&&B.verticalizePunctuation(C);let V=[];const G=function(he,ye,we,Ie,Le,Pe){if(!he)return[];const Ge=[],ct=function(wt,Ot,lt,ei,Nt,bt){let ti=0;for(let Wt=0;Wt<wt.length();Wt++){const Kt=wt.getSection(Wt);ti+=Iw(wt.getCodePoint(Wt),Kt,ei,Nt,Ot,bt)}return ti/Math.max(1,Math.ceil(ti/lt))}(he,ye,we,Ie,Le,Pe),Ve=he.text.indexOf("")>=0;let rt=0;for(let wt=0;wt<he.length();wt++){const Ot=he.getSection(wt),lt=he.getCodePoint(wt);if(wm[lt]||(rt+=Iw(lt,Ot,Ie,Le,ye,Pe)),wt<he.length()-1){const ei=!((Ne=lt)<11904||!(w["Bopomofo Extended"](Ne)||w.Bopomofo(Ne)||w["CJK Compatibility Forms"](Ne)||w["CJK Compatibility Ideographs"](Ne)||w["CJK Compatibility"](Ne)||w["CJK Radicals Supplement"](Ne)||w["CJK Strokes"](Ne)||w["CJK Symbols and Punctuation"](Ne)||w["CJK Unified Ideographs Extension A"](Ne)||w["CJK Unified Ideographs"](Ne)||w["Enclosed CJK Letters and Months"](Ne)||w["Halfwidth and Fullwidth Forms"](Ne)||w.Hiragana(Ne)||w["Ideographic Description Characters"](Ne)||w["Kangxi Radicals"](Ne)||w["Katakana Phonetic Extensions"](Ne)||w.Katakana(Ne)||w["Vertical Forms"](Ne)||w["Yi Radicals"](Ne)||w["Yi Syllables"](Ne)));(c3[lt]||ei||Ot.imageName)&&Ge.push(Cw(wt+1,rt,ct,Ge,u3(lt,he.getCodePoint(wt+1),ei&&Ve),!1))}}var Ne;return Pw(Cw(he.length(),rt,ct,Ge,0,!0))}(B,T,d,e,a,D),{processBidirectionalText:$,processStyledBidirectionalText:te}=xe;if($&&B.sections.length===1){const he=$(B.toString(),G);for(const ye of he){const we=new Lu;we.text=ye,we.sections=B.sections;for(let Ie=0;Ie<ye.length;Ie++)we.sectionIndex.push(0);V.push(we)}}else if(te){const he=te(B.text,B.sectionIndex,G);for(const ye of he){const we=new Lu;we.text=ye[0],we.sectionIndex=ye[1],we.sections=B.sections,V.push(we)}}else V=function(he,ye){const we=[],Ie=he.text;let Le=0;for(const Pe of ye)we.push(he.substring(Le,Pe)),Le=Pe;return Le<Ie.length&&we.push(he.substring(Le,Ie.length)),we}(B,G);const se=[],le={positionedLines:se,text:B.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(he,ye,we,Ie,Le,Pe,Ge,ct,Ve,rt,Ne,wt){let Ot=0,lt=0,ei=0;const Nt=ct==="right"?1:ct==="left"?0:.5;let bt=!1;for(const Pi of Le){const di=Pi.getSections();for(const Ei of di){if(Ei.imageName)continue;const ji=ye[Ei.fontStack];if(ji&&(bt=ji.ascender!==void 0&&ji.descender!==void 0,!bt))break}if(!bt)break}let ti=0;for(const Pi of Le){Pi.trim();const di=Pi.getMaxScale(),Ei=(di-1)*Tr,ji={positionedGlyphs:[],lineOffset:0};he.positionedLines[ti]=ji;const dn=ji.positionedGlyphs;let xi=0;if(!Pi.length()){lt+=Pe,++ti;continue}let vn=0,fn=0;for(let $i=0;$i<Pi.length();$i++){const Ui=Pi.getSection($i),Cn=Pi.getSectionIndex($i),bn=Pi.getCodePoint($i);let Nn=Ui.scale,dr=null,Zr=null,Wn=null,On=Tr,Or=0;const Br=!(Ve===zs.horizontal||!Ne&&!L(bn)||Ne&&(wm[bn]||(Wt=bn,w.Arabic(Wt)||w["Arabic Supplement"](Wt)||w["Arabic Extended-A"](Wt)||w["Arabic Presentation Forms-A"](Wt)||w["Arabic Presentation Forms-B"](Wt))));if(Ui.imageName){const Xr=Ie[Ui.imageName];if(!Xr)continue;Wn=Ui.imageName,he.iconsInText=he.iconsInText||!0,Zr=Xr.paddedRect;const wn=Xr.displaySize;Nn=Nn*Tr/wt,dr={width:wn[0],height:wn[1],left:0,top:-Ew,advance:Br?wn[1]:wn[0],localGlyph:!1},Or=bt?-dr.height*Nn:Aw+di*Tr-wn[1]*Nn,On=dr.advance;const po=(Br?wn[0]:wn[1])*Nn-Tr*di;po>0&&po>xi&&(xi=po)}else{const Xr=we[Ui.fontStack];if(!Xr)continue;Xr[bn]&&(Zr=Xr[bn]);const wn=ye[Ui.fontStack];if(!wn)continue;const po=wn.glyphs[bn];if(!po)continue;if(dr=po.metrics,On=bn!==8203?Tr:0,bt){const ju=wn.ascender!==void 0?Math.abs(wn.ascender):0,ka=wn.descender!==void 0?Math.abs(wn.descender):0,Ca=(ju+ka)*Nn;vn<Ca&&(vn=Ca,fn=(ju-ka)/2*Nn),Or=-ju*Nn}else Or=Aw+(di-Nn)*Tr}Br?(he.verticalizable=!0,dn.push({glyph:bn,imageName:Wn,x:Ot,y:lt+Or,vertical:Br,scale:Nn,localGlyph:dr.localGlyph,fontStack:Ui.fontStack,sectionIndex:Cn,metrics:dr,rect:Zr}),Ot+=On*Nn+rt):(dn.push({glyph:bn,imageName:Wn,x:Ot,y:lt+Or,vertical:Br,scale:Nn,localGlyph:dr.localGlyph,fontStack:Ui.fontStack,sectionIndex:Cn,metrics:dr,rect:Zr}),Ot+=dr.advance*Nn+rt)}dn.length!==0&&(ei=Math.max(Ot-rt,ei),bt?Dw(dn,Nt,xi,fn,Pe*di/2):Dw(dn,Nt,xi,0,Pe/2)),Ot=0;const Ki=Pe*di+xi;ji.lineOffset=Math.max(xi,Ei),lt+=Ki,++ti}var Wt;const Kt=lt,{horizontalAlign:dt,verticalAlign:ri}=d0(Ge);(function(Pi,di,Ei,ji,dn,xi){const vn=(di-Ei)*dn,fn=-xi*ji;for(const Ki of Pi)for(const $i of Ki.positionedGlyphs)$i.x+=vn,$i.y+=fn})(he.positionedLines,Nt,dt,ri,ei,Kt),he.top+=-ri*Kt,he.bottom=he.top+Kt,he.left+=-dt*ei,he.right=he.left+ei,he.hasBaseline=bt}(le,e,n,a,V,p,y,b,I,T,C,R),!function(he){for(const ye of he)if(ye.positionedGlyphs.length!==0)return!1;return!0}(se)&&le}const wm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},c3={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Iw(t,e,n,a,u,d){if(e.imageName){const p=a[e.imageName];return p?p.displaySize[0]*e.scale*Tr/d+u:0}{const p=n[e.fontStack],y=p&&p.glyphs[t];return y?y.metrics.advance*e.scale+u:0}}function kw(t,e,n,a){const u=Math.pow(t-e,2);return a?t<e?u/2:2*u:u+Math.abs(n)*n}function u3(t,e,n){let a=0;return t===10&&(a-=1e4),n&&(a+=150),t!==40&&t!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function Cw(t,e,n,a,u,d){let p=null,y=kw(e,n,u,d);for(const b of a){const T=kw(e-b.x,n,u,d)+b.badness;T<=y&&(p=b,y=T)}return{index:t,x:e,priorBreak:p,badness:y}}function Pw(t){return t?Pw(t.priorBreak).concat(t.index):[]}function d0(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Dw(t,e,n,a,u){if(!(e||n||a||u))return;const d=t.length-1,p=t[d],y=(p.x+p.metrics.advance*p.scale)*e;for(let b=0;b<=d;b++)t[b].x-=y,t[b].y+=n+a+u}function h3(t,e,n,a){const{horizontalAlign:u,verticalAlign:d}=d0(a),p=n[0]-t.displaySize[0]*u,y=n[1]-t.displaySize[1]*d;return{imagePrimary:t,imageSecondary:e,top:y,bottom:y+t.displaySize[1],left:p,right:p+t.displaySize[0]}}function zw(t,e,n,a,u,d){const p=t.imagePrimary;let y;if(p.content){const V=p.content,G=p.pixelRatio||1;y=[V[0]/G,V[1]/G,p.displaySize[0]-V[2]/G,p.displaySize[1]-V[3]/G]}const b=e.left*d,T=e.right*d;let E,I,C,D;n==="width"||n==="both"?(D=u[0]+b-a[3],I=u[0]+T+a[1]):(D=u[0]+(b+T-p.displaySize[0])/2,I=D+p.displaySize[0]);const R=e.top*d,B=e.bottom*d;return n==="height"||n==="both"?(E=u[1]+R-a[0],C=u[1]+B+a[2]):(E=u[1]+(R+B-p.displaySize[1])/2,C=E+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:E,right:I,bottom:C,left:D,collisionPadding:y}}class Aa extends Se{constructor(e,n,a,u,d){super(e,n),this.angle=u,this.z=a,d!==void 0&&(this.segment=d)}clone(){return new Aa(this.x,this.y,this.z,this.angle,this.segment)}}function Lw(t,e,n,a,u){if(e.segment===void 0)return!0;let d=e,p=e.segment+1,y=0;for(;y>-n/2;){if(p--,p<0)return!1;y-=t[p].dist(d),d=t[p]}y+=t[p].dist(t[p+1]),p++;const b=[];let T=0;for(;y<n/2;){const E=t[p],I=t[p+1];if(!I)return!1;let C=t[p-1].angleTo(E)-E.angleTo(I);for(C=Math.abs((C+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:C}),T+=C;y-b[0].distance>a;)T-=b.shift().angleDelta;if(T>u)return!1;p++,y+=E.dist(I)}return!0}function Rw(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function Ow(t,e,n){return t?.6*e*n:0}function Bw(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function d3(t,e,n,a,u,d){const p=Ow(n,u,d),y=Bw(n,a)*d;let b=0;const T=Rw(t)/2;for(let E=0;E<t.length-1;E++){const I=t[E],C=t[E+1],D=I.dist(C);if(b+D>T){const R=(T-b)/D,B=Mi(I.x,C.x,R),V=Mi(I.y,C.y,R),G=new Aa(B,V,0,C.angleTo(I),E);return!p||Lw(t,G,y,p,e)?G:void 0}b+=D}}function f3(t,e,n,a,u,d,p,y,b){const T=Ow(a,d,p),E=Bw(a,u),I=E*p,C=t[0].x===0||t[0].x===b||t[0].y===0||t[0].y===b;return e-I<e/4&&(e=I+e/4),Fw(t,C?e/2*y%e:(E/2+2*d)*p*y%e,e,T,n,I,C,!1,b)}function Fw(t,e,n,a,u,d,p,y,b){const T=d/2,E=Rw(t);let I=0,C=e-n,D=[];for(let R=0;R<t.length-1;R++){const B=t[R],V=t[R+1],G=B.dist(V),$=V.angleTo(B);for(;C+n<I+G;){C+=n;const te=(C-I)/G,se=Mi(B.x,V.x,te),le=Mi(B.y,V.y,te);if(se>=0&&se<b&&le>=0&&le<b&&C-T>=0&&C+T<=E){const he=new Aa(se,le,0,$,R);a&&!Lw(t,he,d,a,u)||D.push(he)}}I+=G}return y||D.length||p||(D=Fw(t,I/2,n,a,u,d,p,!0,b)),D}function Nw(t,e,n,a,u){const d=[];for(let p=0;p<t.length;p++){const y=t[p];let b;for(let T=0;T<y.length-1;T++){let E=y[T],I=y[T+1];E.x<e&&I.x<e||(E.x<e?E=new Se(e,E.y+(e-E.x)/(I.x-E.x)*(I.y-E.y))._round():I.x<e&&(I=new Se(e,E.y+(e-E.x)/(I.x-E.x)*(I.y-E.y))._round()),E.y<n&&I.y<n||(E.y<n?E=new Se(E.x+(n-E.y)/(I.y-E.y)*(I.x-E.x),n)._round():I.y<n&&(I=new Se(E.x+(n-E.y)/(I.y-E.y)*(I.x-E.x),n)._round()),E.x>=a&&I.x>=a||(E.x>=a?E=new Se(a,E.y+(a-E.x)/(I.x-E.x)*(I.y-E.y))._round():I.x>=a&&(I=new Se(a,E.y+(a-E.x)/(I.x-E.x)*(I.y-E.y))._round()),E.y>=u&&I.y>=u||(E.y>=u?E=new Se(E.x+(u-E.y)/(I.y-E.y)*(I.x-E.x),u)._round():I.y>=u&&(I=new Se(E.x+(u-E.y)/(I.y-E.y)*(I.x-E.x),u)._round()),b&&E.equals(b[b.length-1])||(b=[E],d.push(b)),b.push(I)))))}}return d}function f0(t){let e=0,n=0;for(const p of t)e+=p.w*p.h,n=Math.max(n,p.w);t.sort((p,y)=>y.h-p.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let u=0,d=0;for(const p of t)for(let y=a.length-1;y>=0;y--){const b=a[y];if(!(p.w>b.w||p.h>b.h)){if(p.x=b.x,p.y=b.y,d=Math.max(d,p.y+p.h),u=Math.max(u,p.x+p.w),p.w===b.w&&p.h===b.h){const T=a.pop();y<a.length&&(a[y]=T)}else p.h===b.h?(b.x+=p.w,b.w-=p.w):p.w===b.w?(b.y+=p.h,b.h-=p.h):(a.push({x:b.x+p.w,y:b.y,w:b.w-p.w,h:p.h}),b.y+=p.h,b.h-=p.h);break}}return{w:u,h:d,fill:e/(u*d)||0}}Bt(Aa,"Anchor");const fs=1;class p0{constructor(e,{pixelRatio:n,version:a,stretchX:u,stretchY:d,content:p}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=u,this.stretchY=d,this.content=p,this.version=a}get tl(){return[this.paddedRect.x+fs,this.paddedRect.y+fs]}get br(){return[this.paddedRect.x+this.paddedRect.w-fs,this.paddedRect.y+this.paddedRect.h-fs]}get displaySize(){return[(this.paddedRect.w-2*fs)/this.pixelRatio,(this.paddedRect.h-2*fs)/this.pixelRatio]}}class Vw{constructor(e,n){const a={},u={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,a,d),this.addImages(n,u,d);const{w:p,h:y}=f0(d),b=new Ds({width:p||1,height:y||1});for(const T in e){const E=e[T],I=a[T].paddedRect;Ds.copy(E.data,b,{x:0,y:0},{x:I.x+fs,y:I.y+fs},E.data,E.sdf)}for(const T in n){const E=n[T],I=u[T].paddedRect,C=I.x+fs,D=I.y+fs,R=E.data.width,B=E.data.height;Ds.copy(E.data,b,{x:0,y:0},{x:C,y:D},E.data),Ds.copy(E.data,b,{x:0,y:B-1},{x:C,y:D-1},{width:R,height:1}),Ds.copy(E.data,b,{x:0,y:0},{x:C,y:D+B},{width:R,height:1}),Ds.copy(E.data,b,{x:R-1,y:0},{x:C-1,y:D},{width:1,height:B}),Ds.copy(E.data,b,{x:0,y:0},{x:C+R,y:D},{width:1,height:B})}this.image=b,this.iconPositions=a,this.patternPositions=u}addImages(e,n,a){for(const u in e){const d=e[u],p={x:0,y:0,w:d.data.width+2*fs,h:d.data.height+2*fs};a.push(p),n[u]=new p0(p,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,n,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(const u in e.getUpdatedImages(a))this.patchUpdatedImage(this.iconPositions[u],e.getImage(u,a),n),this.patchUpdatedImage(this.patternPositions[u],e.getImage(u,a),n)}patchUpdatedImage(e,n,a){if(!e||!n||e.version===n.version)return;e.version=n.version;const[u,d]=e.tl,p=!!Object.keys(this.patternPositions).length;a.update(n.data,{useMipmap:p},{x:u,y:d})}}Bt(p0,"ImagePosition"),Bt(Vw,"ImageAtlas");const Cd=1e20;function jw(t,e,n,a,u,d,p,y,b){for(let T=e;T<e+a;T++)Uw(t,n*d+T,d,u,p,y,b);for(let T=n;T<n+u;T++)Uw(t,T*d+e,1,a,p,y,b)}function Uw(t,e,n,a,u,d,p){d[0]=0,p[0]=-Cd,p[1]=Cd,u[0]=t[e];for(let y=1,b=0,T=0;y<a;y++){u[y]=t[e+y*n];const E=y*y;do{const I=d[b];T=(u[y]-u[I]+E-I*I)/(y-I)/2}while(T<=p[b]&&--b>-1);b++,d[b]=y,p[b]=T,p[b+1]=Cd}for(let y=0,b=0;y<a;y++){for(;p[b+1]<y;)b++;const T=d[b],E=y-T;t[e+y*n]=u[T]+E*E}}const uo=2,m0={none:0,ideographs:1,all:2};class Ru{constructor(e,n,a){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,a){const u=[],d=this.urls[n]||z.GLYPHS_URL;for(const p in e)for(const y of e[p])u.push({stack:p,id:y});ai(u,({stack:p,id:y},b)=>{let T=this.entries[p];T||(T=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=T.glyphs[y];if(E!==void 0)return void b(null,{stack:p,id:y,glyph:E});if(E=this._tinySDF(T,p,y),E)return T.glyphs[y]=E,void b(null,{stack:p,id:y,glyph:E});const I=Math.floor(y/256);if(256*I>65535)return void b(new Error("glyphs > 65535 not supported"));if(T.ranges[I])return void b(null,{stack:p,id:y,glyph:E});let C=T.requests[I];C||(C=T.requests[I]=[],Ru.loadGlyphRange(p,I,d,this.requestManager,(D,R)=>{if(R){T.ascender=R.ascender,T.descender=R.descender;for(const B in R.glyphs)this._doesCharSupportLocalGlyph(+B)||(T.glyphs[+B]=R.glyphs[+B]);T.ranges[I]=!0}for(const B of C)B(D,R);delete T.requests[I]})),C.push((D,R)=>{D?b(D):R&&b(null,{stack:p,id:y,glyph:R.glyphs[y]||null})})},(p,y)=>{if(p)a(p);else if(y){const b={};for(const{stack:T,id:E,glyph:I}of y)b[T]===void 0&&(b[T]={}),b[T].glyphs===void 0&&(b[T].glyphs={}),b[T].glyphs[E]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},b[T].ascender=this.entries[T].ascender,b[T].descender=this.entries[T].descender;a(null,b)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==m0.none&&(this.localGlyphMode===m0.all?!!this.localFontFamily:!!this.localFontFamily&&(w["CJK Unified Ideographs"](e)||w["Hangul Syllables"](e)||w.Hiragana(e)||w.Katakana(e)||w["CJK Symbols and Punctuation"](e)||w["CJK Unified Ideographs Extension A"](e)||w["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,a){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let d=e.tinySDF;if(!d){let B="400";/bold/i.test(n)?B="900":/medium/i.test(n)?B="500":/light/i.test(n)&&(B="200"),d=e.tinySDF=new Ru.TinySDF({fontFamily:u,fontWeight:B,fontSize:24*uo,buffer:3*uo,radius:8*uo}),d.fontWeight=B}if(this.localGlyphs[d.fontWeight][a])return this.localGlyphs[d.fontWeight][a];const p=String.fromCodePoint(a),{data:y,width:b,height:T,glyphWidth:E,glyphHeight:I,glyphLeft:C,glyphTop:D,glyphAdvance:R}=d.draw(p);return this.localGlyphs[d.fontWeight][a]={id:a,bitmap:new Sa({width:b,height:T},y),metrics:{width:E/uo,height:I/uo,left:C/uo,top:D/uo-27,advance:R/uo,localGlyph:!0}}}}Ru.loadGlyphRange=function(t,e,n,a,u){const d=256*e,p=d+255,y=a.transformRequest(a.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${d}-${p}`),zi.Glyphs);sr(y,(b,T)=>{if(b)u(b);else if(T){const E={},I=function(C){return new xm(C).readFields(o3,{})}(T);for(const C of I.glyphs)E[C.id]=C;u(null,{glyphs:E,ascender:I.ascender,descender:I.descender})}})},Ru.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:d="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=n;const y=this.size=t+4*e,b=this._createCanvas(y),T=this.ctx=b.getContext("2d",{willReadFrequently:!0});T.font=`${p} ${d} ${t}px ${u}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:d}=this.ctx.measureText(t),p=Math.ceil(n),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-u))),b=Math.min(this.size-this.buffer,p+Math.ceil(a)),T=y+2*this.buffer,E=b+2*this.buffer,I=Math.max(T*E,0),C=new Uint8ClampedArray(I),D={data:C,width:T,height:E,glyphWidth:y,glyphHeight:b,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(y===0||b===0)return D;const{ctx:R,buffer:B,gridInner:V,gridOuter:G}=this;R.clearRect(B,B,y,b),R.fillText(t,B,B+p);const $=R.getImageData(B,B,y,b);G.fill(Cd,0,I),V.fill(0,0,I);for(let te=0;te<b;te++)for(let se=0;se<y;se++){const le=$.data[4*(te*y+se)+3]/255;if(le===0)continue;const he=(te+B)*T+se+B;if(le===1)G[he]=0,V[he]=Cd;else{const ye=.5-le;G[he]=ye>0?ye*ye:0,V[he]=ye<0?ye*ye:0}}jw(G,0,0,T,E,T,this.f,this.v,this.z),jw(V,B,B,y,b,T,this.f,this.v,this.z);for(let te=0;te<I;te++){const se=Math.sqrt(G[te])-Math.sqrt(V[te]);C[te]=Math.round(255-255*(se/this.radius+this.cutoff))}return D}};const dl=fs;function Gw(t,e,n,a){const u=[],d=t.imagePrimary,p=d.pixelRatio,y=d.paddedRect.w-2*dl,b=d.paddedRect.h-2*dl,T=t.right-t.left,E=t.bottom-t.top,I=d.stretchX||[[0,y]],C=d.stretchY||[[0,b]],D=(Pe,Ge)=>Pe+Ge[1]-Ge[0],R=I.reduce(D,0),B=C.reduce(D,0),V=y-R,G=b-B;let $=0,te=R,se=0,le=B,he=0,ye=V,we=0,Ie=G;if(d.content&&a){const Pe=d.content;$=Tm(I,0,Pe[0]),se=Tm(C,0,Pe[1]),te=Tm(I,Pe[0],Pe[2]),le=Tm(C,Pe[1],Pe[3]),he=Pe[0]-$,we=Pe[1]-se,ye=Pe[2]-Pe[0]-te,Ie=Pe[3]-Pe[1]-le}const Le=(Pe,Ge,ct,Ve)=>{const rt=Mm(Pe.stretch-$,te,T,t.left),Ne=Sm(Pe.fixed-he,ye,Pe.stretch,R),wt=Mm(Ge.stretch-se,le,E,t.top),Ot=Sm(Ge.fixed-we,Ie,Ge.stretch,B),lt=Mm(ct.stretch-$,te,T,t.left),ei=Sm(ct.fixed-he,ye,ct.stretch,R),Nt=Mm(Ve.stretch-se,le,E,t.top),bt=Sm(Ve.fixed-we,Ie,Ve.stretch,B),ti=new Se(rt,wt),Wt=new Se(lt,wt),Kt=new Se(lt,Nt),dt=new Se(rt,Nt),ri=new Se(Ne/p,Ot/p),Pi=new Se(ei/p,bt/p),di=e*Math.PI/180;if(di){const fn=Math.sin(di),Ki=Math.cos(di),$i=[Ki,-fn,fn,Ki];ti._matMult($i),Wt._matMult($i),dt._matMult($i),Kt._matMult($i)}const Ei=Pe.stretch+Pe.fixed,ji=ct.stretch+ct.fixed,dn=Ge.stretch+Ge.fixed,xi=Ve.stretch+Ve.fixed,vn=t.imageSecondary;return{tl:ti,tr:Wt,bl:dt,br:Kt,texPrimary:{x:d.paddedRect.x+dl+Ei,y:d.paddedRect.y+dl+dn,w:ji-Ei,h:xi-dn},texSecondary:vn?{x:vn.paddedRect.x+dl+Ei,y:vn.paddedRect.y+dl+dn,w:ji-Ei,h:xi-dn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ri,pixelOffsetBR:Pi,minFontScaleX:ye/p/T,minFontScaleY:Ie/p/E,isSDF:n}};if(a&&(d.stretchX||d.stretchY)){const Pe=Hw(I,V,R),Ge=Hw(C,G,B);for(let ct=0;ct<Pe.length-1;ct++){const Ve=Pe[ct],rt=Pe[ct+1];for(let Ne=0;Ne<Ge.length-1;Ne++)u.push(Le(Ve,Ge[Ne],rt,Ge[Ne+1]))}}else u.push(Le({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:b+1}));return u}function Tm(t,e,n){let a=0;for(const u of t)a+=Math.max(e,Math.min(n,u[1]))-Math.max(e,Math.min(n,u[0]));return a}function Hw(t,e,n){const a=[{fixed:-dl,stretch:0}];for(const[u,d]of t){const p=a[a.length-1];a.push({fixed:u-p.stretch,stretch:p.stretch}),a.push({fixed:u-p.stretch,stretch:p.stretch+(d-u)})}return a.push({fixed:e+dl,stretch:n}),a}function Mm(t,e,n,a){return t/e*n+a}function Sm(t,e,n,a){return t-e*n/a}function p3(t,e,n,a){const u=e+t.positionedLines[a].lineOffset;return a===0?n+u/2:n+(u+(e+t.positionedLines[a-1].lineOffset))/2}function m3(t,e=1,n=!1){let a=1/0,u=1/0,d=-1/0,p=-1/0;const y=t[0];for(let D=0;D<y.length;D++){const R=y[D];(!D||R.x<a)&&(a=R.x),(!D||R.y<u)&&(u=R.y),(!D||R.x>d)&&(d=R.x),(!D||R.y>p)&&(p=R.y)}const b=Math.min(d-a,p-u);let T=b/2;const E=new Yc([],g3);if(b===0)return new Se(a,u);for(let D=a;D<d;D+=b)for(let R=u;R<p;R+=b)E.push(new Ou(D+T,R+T,T,t));let I=function(D){let R=0,B=0,V=0;const G=D[0];for(let $=0,te=G.length,se=te-1;$<te;se=$++){const le=G[$],he=G[se],ye=le.x*he.y-he.x*le.y;B+=(le.x+he.x)*ye,V+=(le.y+he.y)*ye,R+=3*ye}return new Ou(B/R,V/R,0,D)}(t),C=E.length;for(;E.length;){const D=E.pop();(D.d>I.d||!I.d)&&(I=D,n&&console.log("found best %d after %d probes",Math.round(1e4*D.d)/1e4,C)),D.max-I.d<=e||(T=D.h/2,E.push(new Ou(D.p.x-T,D.p.y-T,T,t)),E.push(new Ou(D.p.x+T,D.p.y-T,T,t)),E.push(new Ou(D.p.x-T,D.p.y+T,T,t)),E.push(new Ou(D.p.x+T,D.p.y+T,T,t)),C+=4)}return n&&(console.log(`num probes: ${C}`),console.log(`best distance: ${I.d}`)),I.p}function g3(t,e){return e.max-t.max}class Ou{constructor(e,n,a,u){this.p=new Se(e,n),this.h=a,this.d=function(d,p){let y=!1,b=1/0;for(let T=0;T<p.length;T++){const E=p[T];for(let I=0,C=E.length,D=C-1;I<C;D=I++){const R=E[I],B=E[D];R.y>d.y!=B.y>d.y&&d.x<(B.x-R.x)*(d.y-R.y)/(B.y-R.y)+R.x&&(y=!y),b=Math.min(b,Wb(d,R,B))}}return(y?1:-1)*Math.sqrt(b)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const Bu=7,g0=Number.POSITIVE_INFINITY,_3=Math.sqrt(2);function Ww(t,[e,n]){let a=0,u=0;if(n===g0){e<0&&(e=0);const d=e/_3;switch(t){case"top-right":case"top-left":u=d-Bu;break;case"bottom-right":case"bottom-left":u=-d+Bu;break;case"bottom":u=-e+Bu;break;case"top":u=e-Bu}switch(t){case"top-right":case"bottom-right":a=-d;break;case"top-left":case"bottom-left":a=d;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":u=n-Bu;break;case"bottom-right":case"bottom-left":case"bottom":u=-n+Bu}switch(t){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,u]}function y3(t,e,n,a,u,d,p,y,b,T,E){t.createArrays(),t.tilePixelRatio=xt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const I=t.layers[0].layout,C=t.layers[0]._unevaluatedLayout._values,D={};if(t.textSizeData.kind==="composite"){const{minZoom:G,maxZoom:$}=t.textSizeData;D.compositeTextSizes=[C["text-size"].possiblyEvaluate(new _e(G),y),C["text-size"].possiblyEvaluate(new _e($),y)]}if(t.iconSizeData.kind==="composite"){const{minZoom:G,maxZoom:$}=t.iconSizeData;D.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new _e(G),y),C["icon-size"].possiblyEvaluate(new _e($),y)]}D.layoutTextSize=C["text-size"].possiblyEvaluate(new _e(b+1),y),D.layoutIconSize=C["icon-size"].possiblyEvaluate(new _e(b+1),y),D.textMaxSize=C["text-size"].possiblyEvaluate(new _e(18),y);const R=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",B=I.get("text-size");let V=!1;for(const G of t.features)if(G.icon&&G.icon.nameSecondary){V=!0;break}for(const G of t.features){const $=I.get("text-font").evaluate(G,{},y).join(","),te=B.evaluate(G,{},y),se=D.layoutTextSize.evaluate(G,{},y),le=(D.layoutIconSize.evaluate(G,{},y),{horizontal:{},vertical:void 0}),he=G.text;let ye,we=[0,0];if(he){const Pe=he.toString(),Ge=I.get("text-letter-spacing").evaluate(G,{},y)*Tr,ct=I.get("text-line-height").evaluate(G,{},y)*Tr,Ve=A(Pe)?Ge:0,rt=I.get("text-anchor").evaluate(G,{},y),Ne=I.get("text-variable-anchor");if(!Ne){const Nt=I.get("text-radial-offset").evaluate(G,{},y);we=Nt?Ww(rt,[Nt*Tr,g0]):I.get("text-offset").evaluate(G,{},y).map(bt=>bt*Tr)}let wt=R?"center":I.get("text-justify").evaluate(G,{},y);const Ot=I.get("symbol-placement")==="point",lt=Ot?I.get("text-max-width").evaluate(G,{},y)*Tr:1/0,ei=Nt=>{t.allowVerticalPlacement&&M(Pe)&&(le.vertical=h0(he,e,n,u,$,lt,ct,rt,Nt,Ve,we,zs.vertical,!0,se,te))};if(!R&&Ne){const Nt=wt==="auto"?Ne.map(ti=>_0(ti)):[wt];let bt=!1;for(let ti=0;ti<Nt.length;ti++){const Wt=Nt[ti];if(!le.horizontal[Wt])if(bt)le.horizontal[Wt]=le.horizontal[0];else{const Kt=h0(he,e,n,u,$,lt,ct,"center",Wt,Ve,we,zs.horizontal,!1,se,te);Kt&&(le.horizontal[Wt]=Kt,bt=Kt.positionedLines.length===1)}}ei("left")}else{if(wt==="auto"&&(wt=_0(rt)),Ot||I.get("text-writing-mode").indexOf("horizontal")>=0||!M(Pe)){const Nt=h0(he,e,n,u,$,lt,ct,rt,wt,Ve,we,zs.horizontal,!1,se,te);Nt&&(le.horizontal[wt]=Nt)}ei(Ot?"left":wt)}}let Ie=!1;if(G.icon&&G.icon.namePrimary){const Pe=a[G.icon.namePrimary];Pe&&(ye=h3(u[G.icon.namePrimary],G.icon.nameSecondary?u[G.icon.nameSecondary]:void 0,I.get("icon-offset").evaluate(G,{},y),I.get("icon-anchor").evaluate(G,{},y)),Ie=Pe.sdf,t.sdfIcons===void 0?t.sdfIcons=Pe.sdf:t.sdfIcons!==Pe.sdf&&si("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Pe.pixelRatio!==t.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Le=Zw(le.horizontal)||le.vertical;t.iconsInText||(t.iconsInText=!!Le&&Le.iconsInText),(Le||ye)&&x3(t,G,le,ye,a,D,se,0,we,Ie,p,y,T,E,V)}d&&t.generateCollisionDebugBuffers(b,t.collisionBoxArray)}function _0(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function x3(t,e,n,a,u,d,p,y,b,T,E,I,C,D,R){let B=d.textMaxSize.evaluate(e,{},I);B===void 0&&(B=p);const V=t.layers[0].layout,G=V.get("icon-offset").evaluate(e,{},I),$=Zw(n.horizontal)||n.vertical,te=C.name==="globe",se=Tr,le=p/se,he=t.tilePixelRatio*B/se,ye=(rt=t.overscaling,t.zoom>18&&rt>2&&(rt>>=1),Math.max(xt/(512*rt),1)*V.get("symbol-spacing")),we=V.get("text-padding")*t.tilePixelRatio,Ie=V.get("icon-padding")*t.tilePixelRatio,Le=Ze(V.get("text-max-angle")),Pe=V.get("text-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",Ge=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",ct=V.get("symbol-placement"),Ve=ye/2;var rt;const Ne=V.get("icon-text-fit").evaluate(e,{},I),wt=V.get("icon-text-fit-padding").evaluate(e,{},I),Ot=Ne!=="none";let lt;t.hasAnyIconTextFit===!1&&Ot&&(t.hasAnyIconTextFit=!0),a&&Ot&&(t.allowVerticalPlacement&&n.vertical&&(lt=zw(a,n.vertical,Ne,wt,G,le)),$&&(a=zw(a,$,Ne,wt,G,le)));const ei=(Nt,bt,ti)=>{if(bt.x<0||bt.x>=xt||bt.y<0||bt.y>=xt)return;let Wt=null;if(te){const{x:Kt,y:dt,z:ri}=C.projectTilePoint(bt.x,bt.y,ti);Wt={anchor:new Aa(Kt,dt,ri,0,void 0),up:C.upVector(ti,bt.x,bt.y)}}(function(Kt,dt,ri,Pi,di,Ei,ji,dn,xi,vn,fn,Ki,$i,Ui,Cn,bn,Nn,dr,Zr,Wn,On,Or,Br,Xr,wn,po,ju){const ka=Kt.addToLineVertexArray(dt,Pi);let Ca,Yd,Kd,Ym,fM,pM,mM,gM=0,_M=0,yM=0,xM=0,W0=-1,q0=-1;const qo={};let vM=fy("");const yc=ri?ri.anchor:dt,Z0=xi.layout.get("icon-text-fit").evaluate(On,{},wn)!=="none";let X0=0,Y0=0;if(xi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[X0,Y0]=xi.layout.get("text-offset").evaluate(On,{},wn).map(ps=>ps*Tr):(X0=xi.layout.get("text-radial-offset").evaluate(On,{},wn)*Tr,Y0=g0),Kt.allowVerticalPlacement&&di.vertical){const ps=di.vertical;if(Cn)pM=y0(ps),dn&&(mM=y0(dn));else{const ms=xi.layout.get("text-rotate").evaluate(On,{},wn)+90;Kd=Em(vn,yc,dt,fn,Ki,$i,ps,Ui,ms,bn),dn&&(Ym=Em(vn,yc,dt,fn,Ki,$i,dn,dr,ms))}}if(Ei){const ps=xi.layout.get("icon-rotate").evaluate(On,{},wn),ms=Gw(Ei,ps,Br,Z0),Uu=dn?Gw(dn,ps,Br,Z0):void 0;Yd=Em(vn,yc,dt,fn,Ki,$i,Ei,dr,ps),gM=4*ms.length;const bM=Kt.iconSizeData;let xc=null;bM.kind==="source"?(xc=[co*xi.layout.get("icon-size").evaluate(On,{},wn)],xc[0]>fl&&si(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${Pd}. Reduce your "icon-size".`)):bM.kind==="composite"&&(xc=[co*Or.compositeIconSizes[0].evaluate(On,{},wn),co*Or.compositeIconSizes[1].evaluate(On,{},wn)],(xc[0]>fl||xc[1]>fl)&&si(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${Pd}. Reduce your "icon-size".`)),Kt.addSymbols(Kt.icon,ms,xc,Wn,Zr,On,!1,ri,dt,ka.lineStartIndex,ka.lineLength,-1,Xr,wn,po,ju),W0=Kt.icon.placedSymbolArray.length-1,Uu&&(_M=4*Uu.length,Kt.addSymbols(Kt.icon,Uu,xc,Wn,Zr,On,zs.vertical,ri,dt,ka.lineStartIndex,ka.lineLength,-1,Xr,wn,po,ju),q0=Kt.icon.placedSymbolArray.length-1)}for(const ps in di.horizontal){const ms=di.horizontal[ps];Ca||(vM=fy(ms.text),Cn?fM=y0(ms):Ca=Em(vn,yc,dt,fn,Ki,$i,ms,Ui,xi.layout.get("text-rotate").evaluate(On,{},wn),bn));const Uu=ms.positionedLines.length===1;if(yM+=qw(Kt,ri,dt,ms,ji,xi,Cn,On,bn,ka,di.vertical?zs.horizontal:zs.horizontalOnly,Uu?Object.keys(di.horizontal):[ps],qo,W0,Or,Xr,wn,po),Uu)break}di.vertical&&(xM+=qw(Kt,ri,dt,di.vertical,ji,xi,Cn,On,bn,ka,zs.vertical,["vertical"],qo,q0,Or,Xr,wn,po));let bl=-1;const K0=(ps,ms)=>ps?Math.max(ps,ms):ms;bl=K0(fM,bl),bl=K0(pM,bl),bl=K0(mM,bl);const LD=bl>-1?1:0;Kt.glyphOffsetArray.length>=Od.MAX_GLYPHS&&si("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),On.sortKey!==void 0&&Kt.addToSortKeyRanges(Kt.symbolInstances.length,On.sortKey),Kt.symbolInstances.emplaceBack(dt.x,dt.y,yc.x,yc.y,yc.z,qo.right>=0?qo.right:-1,qo.center>=0?qo.center:-1,qo.left>=0?qo.left:-1,qo.vertical>=0?qo.vertical:-1,W0,q0,vM,Ca!==void 0?Ca:Kt.collisionBoxArray.length,Ca!==void 0?Ca+1:Kt.collisionBoxArray.length,Kd!==void 0?Kd:Kt.collisionBoxArray.length,Kd!==void 0?Kd+1:Kt.collisionBoxArray.length,Yd!==void 0?Yd:Kt.collisionBoxArray.length,Yd!==void 0?Yd+1:Kt.collisionBoxArray.length,Ym||Kt.collisionBoxArray.length,Ym?Ym+1:Kt.collisionBoxArray.length,fn,yM,xM,gM,_M,LD,0,X0,Y0,bl,0,Z0?1:0)})(t,bt,Wt,Nt,n,a,u,lt,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,we,Pe,b,0,Ie,Ge,G,e,d,T,E,I,D,R)};if(ct==="line")for(const Nt of Nw(e.geometry,0,0,xt,xt)){const bt=f3(Nt,ye,Le,n.vertical||$,a,se,he,t.overscaling,xt);for(const ti of bt)$&&v3(t,$.text,Ve,ti)||ei(Nt,ti,I)}else if(ct==="line-center"){for(const Nt of e.geometry)if(Nt.length>1){const bt=d3(Nt,Le,n.vertical||$,a,se,he);bt&&ei(Nt,bt,I)}}else if(e.type==="Polygon")for(const Nt of n0(e.geometry,0)){const bt=m3(Nt,16);ei(Nt[0],new Aa(bt.x,bt.y,0,0,void 0),I)}else if(e.type==="LineString")for(const Nt of e.geometry)ei(Nt,new Aa(Nt[0].x,Nt[0].y,0,0,void 0),I);else if(e.type==="Point")for(const Nt of e.geometry)for(const bt of Nt)ei([bt],new Aa(bt.x,bt.y,0,0,void 0),I)}const Pd=255,fl=Pd*co;function qw(t,e,n,a,u,d,p,y,b,T,E,I,C,D,R,B,V,G){const $=function(le,he,ye,we,Ie,Le,Pe,Ge){const ct=[];if(he.positionedLines.length===0)return ct;const Ve=we.layout.get("text-rotate").evaluate(Le,{})*Math.PI/180,rt=function(ei){const Nt=ei[0],bt=ei[1],ti=Nt*bt;return ti>0?[Nt,-bt]:ti<0?[-Nt,bt]:Nt===0?[bt,Nt]:[bt,-Nt]}(ye);let Ne=Math.abs(he.top-he.bottom);for(const ei of he.positionedLines)Ne-=ei.lineOffset;const wt=he.positionedLines.length,Ot=Ne/wt;let lt=he.top-ye[1];for(let ei=0;ei<wt;++ei){const Nt=he.positionedLines[ei];lt=p3(he,Ot,lt,ei);for(const bt of Nt.positionedGlyphs){if(!bt.rect)continue;const ti=bt.rect||{};let Wt=Ew+1,Kt=!0,dt=1,ri=0;if(bt.imageName){const Wn=Pe[bt.imageName];if(!Wn)continue;if(Wn.sdf){si("SDF images are not supported in formatted text and will be ignored.");continue}Kt=!1,dt=Wn.pixelRatio,Wt=fs/dt}const Pi=(Ie||Ge)&&bt.vertical,di=bt.metrics.advance*bt.scale/2,Ei=bt.metrics,ji=bt.rect;if(ji===null)continue;Ge&&he.verticalizable&&(ri=bt.imageName?di-bt.metrics.width*bt.scale/2:0);const dn=Ie?[bt.x+di,bt.y]:[0,0];let xi=[0,0],vn=[0,0],fn=!1;Ie||(Pi?(vn=[bt.x+di+rt[0],bt.y+rt[1]-ri],fn=!0):xi=[bt.x+di+ye[0],bt.y+ye[1]-ri]);const Ki=ji.w*bt.scale/(dt*(bt.localGlyph?uo:1)),$i=ji.h*bt.scale/(dt*(bt.localGlyph?uo:1));let Ui,Cn,bn,Nn;if(Pi){const Wn=bt.y-lt,On=new Se(-di,di-Wn),Or=-Math.PI/2,Br=new Se(...vn);Ui=new Se(-di+xi[0],xi[1]),Ui._rotateAround(Or,On)._add(Br),Ui.x+=-Wn+di,Ui.y-=(Ei.left-Wt)*bt.scale;const Xr=bt.imageName?Ei.advance*bt.scale:Tr*bt.scale,wn=String.fromCodePoint(bt.glyph);r3(wn)?Ui.x+=(1-Wt)*bt.scale:s3(wn)?Ui.x+=Xr-Ei.height*bt.scale+(-Wt-1)*bt.scale:Ui.x+=bt.imageName||Ei.width+2*Wt===ji.w&&Ei.height+2*Wt===ji.h?(Xr-$i)/2:(Xr-(Ei.height+2*Wt)*bt.scale)/2,Cn=new Se(Ui.x,Ui.y-Ki),bn=new Se(Ui.x+$i,Ui.y),Nn=new Se(Ui.x+$i,Ui.y-Ki)}else{const Wn=(Ei.left-Wt)*bt.scale-di+xi[0],On=(-Ei.top-Wt)*bt.scale+xi[1],Or=Wn+Ki,Br=On+$i;Ui=new Se(Wn,On),Cn=new Se(Or,On),bn=new Se(Wn,Br),Nn=new Se(Or,Br)}if(Ve){let Wn;Wn=Ie?new Se(0,0):fn?new Se(rt[0],rt[1]):new Se(ye[0],ye[1]),Ui._rotateAround(Ve,Wn),Cn._rotateAround(Ve,Wn),bn._rotateAround(Ve,Wn),Nn._rotateAround(Ve,Wn)}const dr=new Se(0,0),Zr=new Se(0,0);ct.push({tl:Ui,tr:Cn,bl:bn,br:Nn,texPrimary:ti,texSecondary:void 0,writingMode:he.writingMode,glyphOffset:dn,sectionIndex:bt.sectionIndex,isSDF:Kt,pixelOffsetTL:dr,pixelOffsetBR:Zr,minFontScaleX:0,minFontScaleY:0})}}return ct}(0,a,b,d,p,y,u,t.allowVerticalPlacement),te=t.textSizeData;let se=null;te.kind==="source"?(se=[co*d.layout.get("text-size").evaluate(y,{},V)],se[0]>fl&&si(`${t.layerIds[0]}: Value for "text-size" is >= ${Pd}. Reduce your "text-size".`)):te.kind==="composite"&&(se=[co*R.compositeTextSizes[0].evaluate(y,{},V),co*R.compositeTextSizes[1].evaluate(y,{},V)],(se[0]>fl||se[1]>fl)&&si(`${t.layerIds[0]}: Value for "text-size" is >= ${Pd}. Reduce your "text-size".`)),t.addSymbols(t.text,$,se,b,p,y,E,e,n,T.lineStartIndex,T.lineLength,D,B,V,G,!1);for(const le of I)C[le]=t.text.placedSymbolArray.length-1;return 4*$.length}function Zw(t){for(const e in t)return t[e];return null}function Em(t,e,n,a,u,d,p,y,b,T){let E=p.top,I=p.bottom,C=p.left,D=p.right;const R=p.collisionPadding;if(R&&(C-=R[0],E-=R[1],D+=R[2],I+=R[3]),b){const B=new Se(C,E),V=new Se(D,E),G=new Se(C,I),$=new Se(D,I),te=Ze(b);let se=new Se(0,0);T&&(se=new Se(T[0],T[1])),B._rotateAround(te,se),V._rotateAround(te,se),G._rotateAround(te,se),$._rotateAround(te,se),C=Math.min(B.x,V.x,G.x,$.x),D=Math.max(B.x,V.x,G.x,$.x),E=Math.min(B.y,V.y,G.y,$.y),I=Math.max(B.y,V.y,G.y,$.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,C,E,D,I,y,a,u,d),t.length-1}function y0(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function v3(t,e,n,a){const u=t.compareText;if(e in u){const d=u[e];for(let p=d.length-1;p>=0;p--)if(a.dist(d[p])<n)return!0}else u[e]=[];return u[e].push(a),!1}function Xw(t,e){const n=t.fovAboveCenter,a=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,u=(t._camera.position[2]*t.worldSize-a)/Math.cos(t._pitch),d=Math.sin(n)*u/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),p=Math.sin(t._pitch)*d+u;return Math.min(1.01*p,u*(1/t._horizonShift))}function pl(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const n=Math.pow(2,-t.z),a=t.x*n,u=(t.x+1)*n,d=t.y*n,p=(t.y+1)*n,y=ds(a),b=ds(u),T=wr(d),E=wr(p),I=e.project(y,T),C=e.project(b,T),D=e.project(b,E),R=e.project(y,E);let B=Math.min(I.x,C.x,D.x,R.x),V=Math.min(I.y,C.y,D.y,R.y),G=Math.max(I.x,C.x,D.x,R.x),$=Math.max(I.y,C.y,D.y,R.y);const te=n/16;function se(he,ye,we,Ie,Le,Pe){const Ge=(we+Le)/2,ct=(Ie+Pe)/2,Ve=e.project(ds(Ge),wr(ct)),rt=Math.max(0,B-Ve.x,V-Ve.y,Ve.x-G,Ve.y-$);B=Math.min(B,Ve.x),G=Math.max(G,Ve.x),V=Math.min(V,Ve.y),$=Math.max($,Ve.y),rt>te&&(se(he,Ve,we,Ie,Ge,ct),se(Ve,ye,Ge,ct,Le,Pe))}se(I,C,a,d,u,d),se(C,D,u,d,u,p),se(D,R,u,p,a,p),se(R,I,a,p,a,d),B-=te,V-=te,G+=te,$+=te;const le=1/Math.max(G-B,$-V);return{scale:le,x:B*le,y:V*le,x2:G*le,y2:$*le,projection:e}}function Yw(t,{x:e,y:n},a=0){return new Se(((e-a)*t.scale-t.x)*xt,(n*t.scale-t.y)*xt)}const b3=s.m.identity(new Float32Array(16));class ml{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Yi(0,0)}projectTilePoint(e,n,a){return{x:e,y:n,z:0}}locationPoint(e,n,a=!0){return e._coordinatePoint(e.locationCoordinate(n),a)}pixelsPerMeter(e,n){return qr(1,e)*n}pixelSpaceConversion(e,n,a){return 1}farthestPixelDistance(e){return Xw(e,e.pixelsPerMeter)}pointCoordinate(e,n,a,u){const d=e.horizonLineFromTop(!1),p=new Se(n,Math.max(d,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,u))}pointCoordinate3D(e,n,a){const u=new Se(n,a);if(e.elevation)return e.elevation.pointCoordinate(u);{const d=this.pointCoordinate(e,u.x,u.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);const a=e.horizonLineFromTop();return n.y<a}createInversionMatrix(e,n){return b3}createTileMatrix(e,n,a){let u,d,p;const y=a.canonical,b=s.m.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const T=pl(y,this);u=1,d=T.x+a.wrap*T.scale,p=T.y,s.m.scale(b,b,[u/T.scale,u/T.scale,e.pixelsPerMeter/n])}else u=n/e.zoomScale(y.z),d=(y.x+Math.pow(2,y.z)*a.wrap)*u,p=y.y*u;return s.m.translate(b,b,[d,p,0]),s.m.scale(b,b,[u/xt,u/xt,1]),b}upVector(e,n,a){return[0,0,1]}upVectorScale(e,n,a){return{metersToTile:1}}}class w3 extends ml{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,a]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(Ze(n));this.n=(u+Math.sin(Ze(a)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:a,c:u,r0:d}=this,p=Ze(e-this.center[0]),y=Ze(n),b=Math.sqrt(u-2*a*Math.sin(y))/a;return{x:b*Math.sin(p*a),y:b*Math.cos(p*a)-d,z:0}}unproject(e,n){const{n:a,c:u,r0:d}=this,p=d+n;let y=Math.atan2(e,Math.abs(p))*Math.sign(p);p*a<0&&(y-=Math.PI*Math.sign(e)*Math.sign(p));const b=Ze(this.center[0])*a;y=wi(y,-Math.PI-b,Math.PI-b);const T=ft(Tt(y/a)+this.center[0],-180,180),E=Math.asin(ft((u-(e*e+p*p)*a*a)/(2*a),-1,1)),I=ft(Tt(E),-Fn,Fn);return new Yi(T,I)}}const Dd=1.340264,zd=-.081106,Ld=893e-6,Rd=.003796,Am=Math.sqrt(3)/2;class T3 extends ml{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(Am*Math.sin(n)),u=a*a,d=u*u*u;return{x:.5*(e*Math.cos(a)/(Am*(Dd+3*zd*u+d*(7*Ld+9*Rd*u)))/Math.PI+.5),y:1-.5*(a*(Dd+zd*u+d*(Ld+Rd*u))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,u=a*a,d=u*u*u;for(let E,I,C,D=0;D<12&&(I=a*(Dd+zd*u+d*(Ld+Rd*u))-n,C=Dd+3*zd*u+d*(7*Ld+9*Rd*u),E=I/C,a=ft(a-E,-Math.PI/3,Math.PI/3),u=a*a,d=u*u*u,!(Math.abs(E)<1e-12));++D);const p=Am*e*(Dd+3*zd*u+d*(7*Ld+9*Rd*u))/Math.cos(a),y=Math.asin(Math.sin(a)/Am),b=ft(180*p/Math.PI,-180,180),T=ft(180*y/Math.PI,-Fn,Fn);return new Yi(b,T)}}class M3 extends ml{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const a=360*(e-.5),u=ft(360*(.5-n),-Fn,Fn);return new Yi(a,u)}}const Fu=Math.PI/2;function Im(t){return Math.tan((Fu+t)/2)}class S3 extends ml{constructor(e){super(e),this.center=e.center||[0,30];const[n,a]=this.parallels=e.parallels||[30,30];let u=Ze(n),d=Ze(a);this.southernCenter=u+d<0,this.southernCenter&&(u=-u,d=-d);const p=Math.cos(u),y=Im(u);this.n=u===d?Math.sin(u):Math.log(p/Math.cos(d))/Math.log(Im(d)/y),this.f=p*Math.pow(Im(u),this.n)/this.n}project(e,n){n=Ze(n),this.southernCenter&&(n=-n),e=Ze(e-this.center[0]);const a=1e-6,{n:u,f:d}=this;d>0?n<-Fu+a&&(n=-Fu+a):n>Fu-a&&(n=Fu-a);const p=d/Math.pow(Im(n),u);let y=p*Math.sin(u*e),b=d-p*Math.cos(u*e);return y=.5*(y/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:y,y:this.southernCenter?b:1-b,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:a,f:u}=this,d=u-n,p=Math.sign(d),y=Math.sign(a)*Math.sqrt(e*e+d*d);let b=Math.atan2(e,Math.abs(d))*p;d*a<0&&(b-=Math.PI*Math.sign(e)*p);const T=ft(Tt(b/a)+this.center[0],-180,180),E=ft(Tt(2*Math.atan(Math.pow(u/y,1/a))-Fu),-Fn,Fn);return new Yi(T,this.southernCenter?-E:E)}}class Kw extends ml{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:jo(e),y:Uo(n),z:0}}unproject(e,n){const a=ds(e),u=wr(n);return new Yi(a,u)}}const Jw=Ze(Fn);class E3 extends ml{project(e,n){const a=(n=Ze(n))*n,u=a*a;return{x:.5*((e=Ze(e))*(.8707-.131979*a+u*(u*(.003971*a-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+a*(.015085+u*(.028874*a-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,u=25,d=0,p=a*a;do{p=a*a;const T=p*p;d=(a*(1.007226+p*(.015085+T*(.028874*p-.044475-.005916*T)))-n)/(1.007226+p*(.045255+T*(.259866*p-.311325-.005916*11*T))),a=ft(a-d,-Jw,Jw)}while(Math.abs(d)>1e-6&&--u>0);p=a*a;const y=ft(Tt(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),b=Tt(a);return new Yi(y,b)}}const Qw=Ze(Fn);class A3 extends ml{project(e,n){n=Ze(n),e=Ze(e);const a=Math.cos(n),u=2/Math.PI,d=Math.acos(a*Math.cos(e/2)),p=Math.sin(d)/d,y=.5*(e*u+2*a*Math.sin(e/2)/p)||0,b=.5*(n+Math.sin(n)/p)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,n){let a=e=(2*e-.5)*Math.PI,u=n=(2*(1-n)-1)*Math.PI,d=25;const p=1e-6;let y=0,b=0;do{const T=Math.cos(u),E=Math.sin(u),I=2*E*T,C=E*E,D=T*T,R=Math.cos(a/2),B=Math.sin(a/2),V=2*R*B,G=B*B,$=1-D*R*R,te=$?1/$:0,se=$?Math.acos(T*R)*Math.sqrt(1/$):0,le=.5*(2*se*T*B+2*a/Math.PI)-e,he=.5*(se*E+u)-n,ye=.5*te*(D*G+se*T*R*C)+1/Math.PI,we=te*(V*I/4-se*E*B),Ie=.125*te*(I*B-se*E*D*V),Le=.5*te*(C*R+se*G*T)+.5,Pe=we*Ie-Le*ye;y=(he*we-le*Le)/Pe,b=(le*Ie-he*ye)/Pe,a=ft(a-y,-Math.PI,Math.PI),u=ft(u-b,-Qw,Qw)}while((Math.abs(y)>p||Math.abs(b)>p)&&--d>0);return new Yi(Tt(a),Tt(u))}}class $w extends ml{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ze(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:a,cosPhi:u}=this;return{x:Ze(e)*u*a+.5,y:-Math.sin(Ze(n))/u*a+.5,z:0}}unproject(e,n){const{scale:a,cosPhi:u}=this,d=-(n-.5)/a,p=ft(Tt((e-.5)/a)/u,-180,180),y=Math.asin(ft(d*u,-1,1)),b=ft(Tt(y),-Fn,Fn);return new Yi(p,b)}}class I3 extends Kw{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,a){const u=wd(e,n,a),d=Td(Vo(a));return s.v.transformMat4(u,u,d),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,n){const a=cc(n.lat,n.lng),u=s.v.normalize([],a),d=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,p=qr(1,0)*xt*d;s.v.scaleAndAdd(a,a,u,p);const y=s.m.identity(new Float64Array(16));return s.m.multiply(y,e.pixelMatrix,e.globeMatrix),s.v.transformMat4(a,a,y),new Se(a[0],a[1])}pixelsPerMeter(e,n){return qr(1,0)*n}pixelSpaceConversion(e,n,a){const u=qr(1,e)*n,d=Mi(qr(1,45)*n,u,a);return this.pixelsPerMeter(e,n)/d}createTileMatrix(e,n,a){const u=Vy(Vo(a.canonical));return s.m.multiply(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,n){const{center:a}=e,u=Td(Vo(n));return s.m.rotateY(u,u,Ze(a.lng)),s.m.rotateX(u,u,Ze(a.lat)),s.m.scale(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,n,a,u){return kb(e,n,a,!0)||new Er(0,0)}pointCoordinate3D(e,n,a){const u=this.pointCoordinate(e,n,a,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,n){return!kb(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(u,d){const p=u.cameraToCenterDistance,y=u._centerAltitude*d,b=u._camera,T=u._camera.forward(),E=s.v.add([],s.v.scale([],T,-p),[0,0,y]),I=u.worldSize/(2*Math.PI),C=[0,0,-I],D=u.width/u.height,R=Math.tan(u.fovAboveCenter),B=s.v.scale([],b.up(),R),V=s.v.scale([],b.right(),R*D),G=s.v.normalize([],s.v.add([],s.v.add([],T,B),V)),$=[];let te;if(new zy(E,G).closestPointOnSphere(C,I,$)){const se=s.v.add([],$,C),le=s.v.sub([],se,E);te=Math.cos(u.fovAboveCenter)*s.v.length(le)}else{const se=s.v.sub([],E,C),le=s.v.sub([],C,E);s.v.normalize(le,le);const he=s.v.length(se)-I;te=Math.sqrt(he*(he+2*I));const ye=Math.acos(te/(I+he))-Math.acos(s.v.dot(T,le));te*=Math.cos(ye)}return 1.01*te}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=Ma(e.zoom);if(a>0){const u=Xw(e,qr(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Mi(n,u+d*(1-Math.cos(p)),Math.pow(a,10))}return n}upVector(e,n,a){return wd(n,a,e,1)}upVectorScale(e){return{metersToTile:em(im(Vo(e)))}}}function eT(t){const e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new Kw(t);case"equirectangular":return new M3(t);case"naturalEarth":return new E3(t);case"equalEarth":return new T3(t);case"winkelTripel":return new A3(t);case"albers":return n?new $w(t):new w3(t);case"lambertConformalConic":return n?new $w(t):new S3(t);case"globe":return new I3(t)}throw new Error(`Invalid projection name: ${t.name}`)}const k3=new $e({"symbol-placement":new ue(De.layout_symbol["symbol-placement"]),"symbol-spacing":new ue(De.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ue(De.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ce(De.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ue(De.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ue(De.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new ue(De.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ue(De.layout_symbol["icon-ignore-placement"]),"icon-optional":new ue(De.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ue(De.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ce(De.layout_symbol["icon-size"]),"icon-text-fit":new Ce(De.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ce(De.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ce(De.layout_symbol["icon-image"]),"icon-rotate":new Ce(De.layout_symbol["icon-rotate"]),"icon-padding":new ue(De.layout_symbol["icon-padding"]),"icon-keep-upright":new ue(De.layout_symbol["icon-keep-upright"]),"icon-offset":new Ce(De.layout_symbol["icon-offset"]),"icon-anchor":new Ce(De.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ue(De.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ue(De.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ue(De.layout_symbol["text-rotation-alignment"]),"text-field":new Ce(De.layout_symbol["text-field"]),"text-font":new Ce(De.layout_symbol["text-font"]),"text-size":new Ce(De.layout_symbol["text-size"]),"text-max-width":new Ce(De.layout_symbol["text-max-width"]),"text-line-height":new Ce(De.layout_symbol["text-line-height"]),"text-letter-spacing":new Ce(De.layout_symbol["text-letter-spacing"]),"text-justify":new Ce(De.layout_symbol["text-justify"]),"text-radial-offset":new Ce(De.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ue(De.layout_symbol["text-variable-anchor"]),"text-anchor":new Ce(De.layout_symbol["text-anchor"]),"text-max-angle":new ue(De.layout_symbol["text-max-angle"]),"text-writing-mode":new ue(De.layout_symbol["text-writing-mode"]),"text-rotate":new Ce(De.layout_symbol["text-rotate"]),"text-padding":new ue(De.layout_symbol["text-padding"]),"text-keep-upright":new ue(De.layout_symbol["text-keep-upright"]),"text-transform":new Ce(De.layout_symbol["text-transform"]),"text-offset":new Ce(De.layout_symbol["text-offset"]),"text-allow-overlap":new ue(De.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ue(De.layout_symbol["text-ignore-placement"]),"text-optional":new ue(De.layout_symbol["text-optional"]),visibility:new ue(De.layout_symbol.visibility)});var x0={paint:new $e({"icon-opacity":new Ce(De.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Ce(De.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Ce(De.paint_symbol["text-emissive-strength"]),"icon-color":new Ce(De.paint_symbol["icon-color"]),"icon-halo-color":new Ce(De.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ce(De.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ce(De.paint_symbol["icon-halo-blur"]),"icon-translate":new ue(De.paint_symbol["icon-translate"]),"icon-translate-anchor":new ue(De.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ce(De.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Ce(De.paint_symbol["text-opacity"]),"text-color":new Ce(De.paint_symbol["text-color"],{runtimeType:os,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Ce(De.paint_symbol["text-halo-color"]),"text-halo-width":new Ce(De.paint_symbol["text-halo-width"]),"text-halo-blur":new Ce(De.paint_symbol["text-halo-blur"]),"text-translate":new ue(De.paint_symbol["text-translate"]),"text-translate-anchor":new ue(De.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ue(De.paint_symbol["icon-color-saturation"])}),layout:k3};class tT{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ia,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Bt(tT,"FormatSectionOverride",{omit:["defaultValue"]});class km extends Lt{constructor(e,n,a){super(e,x0,n,a)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const u=[];for(const d of a)u.indexOf(d)<0&&u.push(d);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,a,u){const d=this.layout.get(e).evaluate(n,{},a,u),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||du(p.value)||!d?d:function(y,b){return b.replace(/{([^{}]+)}/g,(T,E)=>E in y?String(y[E]):"")}(n.properties,d)}createBucket(e){return new Od(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of x0.paint.overridableProperties){if(!km.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),a=new tT(n),u=new rd(a,n.property.specification,this.scope,this.options);let d=null;d=n.value.kind==="constant"||n.value.kind==="source"?new Jl("source",u):new Ql("composite",u,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new Oe(n.property,d,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven())&&km.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const a=e.get("text-field"),u=x0.paint.properties[n];let d=!1;const p=y=>{for(const b of y)if(u.overrides&&u.overrides.hasOverride(b))return void(d=!0)};if(a.value.kind==="constant"&&a.value.value instanceof zr)p(a.value.value.sections);else if(a.value.kind==="source"){const y=T=>{d||(T instanceof Ja&&tr(T.value)===Mo?p(T.value.sections):T instanceof Ol?p(T.sections):T.eachChild(y))},b=a.value;b._styleExpression&&y(b._styleExpression.expression)}return d}getProgramIds(){const e=this.paint.get("icon-opacity").constantOr(1)!==0,n=this.paint.get("text-opacity").constantOr(1)!==0,a=[];return e&&a.push("symbolIcon"),n&&a.push("symbolSDF"),a}getDefaultProgramParams(e,n){return{config:new sc(this,n),overrideFog:!1}}}const C3=mm.types,P3=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Cm(t,e,n,a,u,d,p,y,b,T,E,I,C){const D=y?Math.min(fl,Math.round(y[0])):0,R=y?Math.min(fl,Math.round(y[1])):0;t.emplaceBack(e,n,Math.round(32*a),Math.round(32*u),d,p,(D<<1)+(b?1:0),R,16*T,16*E,256*I,256*C)}function Pm(t,e,n){t.emplaceBack(e,n)}function Dm(t,e,n,a,u,d,p){t.emplaceBack(e,n,a,u,d,p)}function zm(t,e,n,a,u){t.emplaceBack(e,n,a,u),t.emplaceBack(e,n,a,u),t.emplaceBack(e,n,a,u),t.emplaceBack(e,n,a,u)}function D3(t){for(const e of t.sections)if(H(e.text))return!0;return!1}class v0{constructor(e){this.layoutVertexArray=new cr,this.indexArray=new tn,this.programConfigurations=e,this.segments=new Tn,this.dynamicLayoutVertexArray=new Xi,this.opacityVertexArray=new vr,this.placedSymbolArray=new Zv,this.iconTransitioningVertexArray=new Rr,this.globeExtVertexArray=new mn,this.zOffsetVertexArray=new so}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,a,u,d){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,XP.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,KP.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,P3,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,QP.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,YP.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,JP.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Bt(v0,"SymbolBuffers");class b0{constructor(e,n,a){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new a,this.segments=new Tn,this.collisionVertexArray=new As,this.collisionVertexArrayExt=new Xi}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,$P.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,e3.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Bt(b0,"CollisionBuffers");class Lm{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=s.m.identity([]),this.placementViewportMatrix=s.m.identity([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=c0(this.zoom,n["text-size"]),this.iconSizeData=c0(this.zoom,n["icon-size"]);const a=this.layers[0].layout,u=a.get("symbol-sort-key"),d=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(p=>zs[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=a.get("symbol-z-elevate")}createArrays(){this.text=new v0(new ol(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new v0(new ol(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Kv,this.lineVertexArray=new Jv,this.symbolInstances=new Yv}calculateGlyphDependencies(e,n,a,u,d){for(let p=0;p<e.length;p++){const y=e.codePointAt(p);if(y===void 0)break;if(n[y]=!0,u&&d&&y<=65535){const b=Id[e.charAt(p)];b&&(n[b.charCodeAt(0)]=!0)}}}populate(e,n,a,u){const d=this.layers[0],p=d.layout,y=this.projection.name==="globe",b=p.get("text-font"),T=p.get("text-field"),E=p.get("icon-image"),I=(T.value.kind!=="constant"||T.value.value instanceof zr&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),C=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,D=p.get("symbol-sort-key");if(this.features=[],!I&&!C)return;const R=n.iconDependencies,B=n.glyphDependencies,V=n.availableImages,G=new _e(this.zoom);for(const{feature:$,id:te,index:se,sourceLayerIndex:le}of e){const he=d._featureFilter.needGeometry,ye=ul($,he);if(!d._featureFilter.filter(G,ye,a))continue;if(he||(ye.geometry=Go($,a,u)),y&&$.type!==1&&a.z<=5){const Pe=ye.geometry,Ge=.98078528056,ct=(Ve,rt)=>{const Ne=wd(Ve.x,Ve.y,a,1),wt=wd(rt.x,rt.y,a,1);return s.v.dot(Ne,wt)<Ge};for(let Ve=0;Ve<Pe.length;Ve++)Pe[Ve]=GC(Pe[Ve],ct)}let we,Ie;if(I){const Pe=d.getValueAndResolveTokens("text-field",ye,a,V),Ge=zr.factory(Pe);D3(Ge)&&(this.hasRTLText=!0),(!this.hasRTLText||ae()==="unavailable"||this.hasRTLText&&xe.isParsed())&&(we=n3(Ge,d,ye))}if(C){const Pe=d.getValueAndResolveTokens("icon-image",ye,a,V);Ie=Pe instanceof as?Pe:as.fromString(Pe)}if(!we&&!Ie)continue;const Le=this.sortFeaturesByKey?D.evaluate(ye,{},a):void 0;if(this.features.push({id:te,text:we,icon:Ie,index:se,sourceLayerIndex:le,geometry:ye.geometry,properties:$.properties,type:C3[$.type],sortKey:Le}),Ie&&(R[Ie.namePrimary]=!0,Ie.nameSecondary&&(R[Ie.nameSecondary]=!0)),we){const Pe=b.evaluate(ye,{},a).join(","),Ge=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(zs.vertical)>=0;for(const ct of we.sections)if(ct.image)R[ct.image.namePrimary]=!0;else{const Ve=M(we.toString()),rt=ct.fontStack||Pe,Ne=B[rt]=B[rt]||{};this.calculateGlyphDependencies(ct.text,Ne,Ge,this.allowVerticalPlacement,Ve)}}}p.get("symbol-placement")==="line"&&(this.features=function($){const te={},se={},le=[];let he=0;function ye(Pe){le.push($[Pe]),he++}function we(Pe,Ge,ct){const Ve=se[Pe];return delete se[Pe],se[Ge]=Ve,le[Ve].geometry[0].pop(),le[Ve].geometry[0]=le[Ve].geometry[0].concat(ct[0]),Ve}function Ie(Pe,Ge,ct){const Ve=te[Ge];return delete te[Ge],te[Pe]=Ve,le[Ve].geometry[0].shift(),le[Ve].geometry[0]=ct[0].concat(le[Ve].geometry[0]),Ve}function Le(Pe,Ge,ct){const Ve=ct?Ge[0][Ge[0].length-1]:Ge[0][0];return`${Pe}:${Ve.x}:${Ve.y}`}for(let Pe=0;Pe<$.length;Pe++){const Ge=$[Pe],ct=Ge.geometry,Ve=Ge.text?Ge.text.toString():null;if(!Ve){ye(Pe);continue}const rt=Le(Ve,ct),Ne=Le(Ve,ct,!0);if(rt in se&&Ne in te&&se[rt]!==te[Ne]){const wt=Ie(rt,Ne,ct),Ot=we(rt,Ne,le[wt].geometry);delete te[rt],delete se[Ne],se[Le(Ve,le[Ot].geometry,!0)]=Ot,le[wt].geometry=null}else rt in se?we(rt,Ne,ct):Ne in te?Ie(rt,Ne,ct):(ye(Pe),te[rt]=he-1,se[Ne]=he-1)}return le.filter(Pe=>Pe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort(($,te)=>$.sortKey-te.sortKey)}update(e,n,a,u,d){const p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;const y=p?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,y,a,u,d),this.icon.programConfigurations.updatePaintArrays(e,n,y,a,u,d)}updateZOffset(){const e=(d,p,y)=>{a+=p,a>d.length&&d.resize(a);for(let b=-p;b<0;b++)d.emplace(b+a,y)},n=(d,p,y)=>{u+=p,u>d.length&&d.resize(u);for(let b=-p;b<0;b++)d.emplace(b+u,y)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,u=0;for(let d=0;d<this.symbolInstances.length;d++){const p=this.symbolInstances.get(d),{numHorizontalGlyphVertices:y,numVerticalGlyphVertices:b,numIconVertices:T}=p,E=p.zOffset,I=T>0;if((y>0||b>0)&&(e(this.text.zOffsetVertexArray,y,E),e(this.text.zOffsetVertexArray,b,E)),I){const{placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:D}=p;C>=0&&n(this.icon.zOffsetVertexArray,T,E),D>=0&&n(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,E)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=eT(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:d}of n)this.lineVertexArray.emplaceBack(u,d);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,n,a,u,d,p,y,b,T,E,I,C,D,R,B,V){const G=e.indexArray,$=e.layoutVertexArray,te=e.globeExtVertexArray,se=e.segments.prepareSegment(4*n.length,$,G,this.canOverlap?p.sortKey:void 0),le=this.glyphOffsetArray.length,he=se.vertexLength,ye=this.allowVerticalPlacement&&y===zs.vertical?Math.PI/2:0,we=p.text&&p.text.sections;for(let Le=0;Le<n.length;Le++){const{tl:Pe,tr:Ge,bl:ct,br:Ve,texPrimary:rt,texSecondary:Ne,pixelOffsetTL:wt,pixelOffsetBR:Ot,minFontScaleX:lt,minFontScaleY:ei,glyphOffset:Nt,isSDF:bt,sectionIndex:ti}=n[Le],Wt=se.vertexLength,Kt=Nt[1];if(Cm($,T.x,T.y,Pe.x,Kt+Pe.y,rt.x,rt.y,a,bt,wt.x,wt.y,lt,ei),Cm($,T.x,T.y,Ge.x,Kt+Ge.y,rt.x+rt.w,rt.y,a,bt,Ot.x,wt.y,lt,ei),Cm($,T.x,T.y,ct.x,Kt+ct.y,rt.x,rt.y+rt.h,a,bt,wt.x,Ot.y,lt,ei),Cm($,T.x,T.y,Ve.x,Kt+Ve.y,rt.x+rt.w,rt.y+rt.h,a,bt,Ot.x,Ot.y,lt,ei),b){const{x:dt,y:ri,z:Pi}=b.anchor,[di,Ei,ji]=b.up;Dm(te,dt,ri,Pi,di,Ei,ji),Dm(te,dt,ri,Pi,di,Ei,ji),Dm(te,dt,ri,Pi,di,Ei,ji),Dm(te,dt,ri,Pi,di,Ei,ji),zm(e.dynamicLayoutVertexArray,dt,ri,Pi,ye)}else zm(e.dynamicLayoutVertexArray,T.x,T.y,T.z,ye);if(V){const dt=Ne||rt;Pm(e.iconTransitioningVertexArray,dt.x,dt.y),Pm(e.iconTransitioningVertexArray,dt.x+dt.w,dt.y),Pm(e.iconTransitioningVertexArray,dt.x,dt.y+dt.h),Pm(e.iconTransitioningVertexArray,dt.x+dt.w,dt.y+dt.h)}G.emplaceBack(Wt,Wt+1,Wt+2),G.emplaceBack(Wt+1,Wt+2,Wt+3),se.vertexLength+=4,se.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Nt[0]),Le!==n.length-1&&ti===n[Le+1].sectionIndex||e.programConfigurations.populatePaintArrays($.length,p,p.index,{},D,R,B,we&&we[ti])}const Ie=b?b.anchor:T;e.placedSymbolArray.emplaceBack(Ie.x,Ie.y,Ie.z,T.x,T.y,le,this.glyphOffsetArray.length-le,he,E,I,T.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],y,0,!1,0,C,0)}_commitLayoutVertex(e,n,a,u,d,p,y){e.emplaceBack(n,a,u,d,p,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,n,a,u,d,p,y){const b=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),T=b.vertexLength,E=y.tileAnchorX,I=y.tileAnchorY;for(let D=0;D<4;D++)a.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,n,e.padding,y.zOffset),this._commitLayoutVertex(a.layoutVertexArray,u,d,p,E,I,new Se(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,d,p,E,I,new Se(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,d,p,E,I,new Se(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,u,d,p,E,I,new Se(e.x1,e.y2)),b.vertexLength+=4;const C=a.indexArray;C.emplaceBack(T,T+1),C.emplaceBack(T+1,T+2),C.emplaceBack(T+2,T+3),C.emplaceBack(T+3,T),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,a,u,d,p){for(let y=u;y<d;y++){const b=a.get(y),T=this.getSymbolInstanceTextSize(e,p,n,y);this._addCollisionDebugVertices(b,T,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,n,a,u,d,p){for(let y=u;y<d;y++){const b=a.get(y),T=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._addCollisionDebugVertices(b,T,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new b0(hs,Sw.members,Rr),this.iconCollisionBox=new b0(hs,Sw.members,Rr);const a=zu(this.iconSizeData,e),u=zu(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const p=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(u,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(u,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,n,a,u){const d=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:u),p=bm(this.textSizeData,e,d)/Tr;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,n,a){const u=this.icon.placedSymbolArray.get(a),d=bm(this.iconSizeData,e,u);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,n,a,u){e.emplaceBack(n,-a,-a,u),e.emplaceBack(n,a,-a,u),e.emplaceBack(n,a,a,u),e.emplaceBack(n,-a,a,u)}_updateTextDebugCollisionBoxes(e,n,a,u,d,p){for(let y=u;y<d;y++){const b=a.get(y),T=this.getSymbolInstanceTextSize(e,p,n,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,T,b.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,n,a,u,d,p){for(let y=u;y<d;y++){const b=a.get(y),T=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,T,b.padding,p.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=zu(this.iconSizeData,e),u=zu(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const p=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(u,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(u,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(a,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._updateIconDebugCollisionBoxes(a,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,a,u,d,p,y,b,T){const E={};if(n<a){const{x1:I,y1:C,x2:D,y2:R,padding:B,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:$,tileAnchorX:te,tileAnchorY:se,featureIndex:le}=e.get(n);E.textBox={x1:I,y1:C,x2:D,y2:R,padding:B,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:$,tileAnchorX:te,tileAnchorY:se},E.textFeatureIndex=le}if(u<d){const{x1:I,y1:C,x2:D,y2:R,padding:B,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:$,tileAnchorX:te,tileAnchorY:se,featureIndex:le}=e.get(u);E.verticalTextBox={x1:I,y1:C,x2:D,y2:R,padding:B,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:$,tileAnchorX:te,tileAnchorY:se},E.verticalTextFeatureIndex=le}if(p<y){const{x1:I,y1:C,x2:D,y2:R,padding:B,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:$,tileAnchorX:te,tileAnchorY:se,featureIndex:le}=e.get(p);E.iconBox={x1:I,y1:C,x2:D,y2:R,padding:B,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:$,tileAnchorX:te,tileAnchorY:se},E.iconFeatureIndex=le}if(b<T){const{x1:I,y1:C,x2:D,y2:R,padding:B,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:$,tileAnchorX:te,tileAnchorY:se,featureIndex:le}=e.get(b);E.verticalIconBox={x1:I,y1:C,x2:D,y2:R,padding:B,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:$,tileAnchorX:te,tileAnchorY:se},E.verticalIconFeatureIndex=le}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){const a=e.placedSymbolArray.get(n),u=a.vertexStartIndex+4*a.numGlyphs;for(let d=a.vertexStartIndex;d<u;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),a=Math.cos(e),u=[],d=[],p=[];for(let y=0;y<this.symbolInstances.length;++y){p.push(y);const b=this.symbolInstances.get(y);u.push(0|Math.round(n*b.tileAnchorX+a*b.tileAnchorY)),d.push(b.featureIndex)}return p.sort((y,b)=>u[y]-u[b]||d[b]-d[y]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const a=this.symbolInstances.get(n);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:T}=a;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),d>=0&&d!==u&&this.addIndicesForPlacedSymbol(this.text,d),p>=0&&p!==d&&p!==u&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Bt(Lm,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Lm.MAX_GLYPHS=65535,Lm.addDynamicAttributes=zm;var Od=Lm;const z3=Ht([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:L3}=z3,R3=Ht([{name:"a_packed",components:4,type:"Float32"}]),{members:O3}=R3,B3=mm.types,F3=Math.cos(Math.PI/180*37.5);class Rm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new us,this.layoutVertexArray2=new Xi,this.indexArray=new tn,this.programConfigurations=new ol(e.layers,e.zoom),this.segments=new Tn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,a,u){this.hasPattern=r0("line",this.layers,n);const d=this.layers[0].layout.get("line-sort-key"),p=[];for(const{feature:E,id:I,index:C,sourceLayerIndex:D}of e){const R=this.layers[0]._featureFilter.needGeometry,B=ul(E,R);if(!this.layers[0]._featureFilter.filter(new _e(this.zoom),B,a))continue;const V=d?d.evaluate(B,{},a):void 0,G={id:I,properties:E.properties,type:E.type,sourceLayerIndex:D,index:C,geometry:R?B.geometry:Go(E,a,u),patterns:{},sortKey:V};p.push(G)}d&&p.sort((E,I)=>E.sortKey-I.sortKey);const{lineAtlas:y,featureIndex:b}=n,T=this.addConstantDashes(y);for(const E of p){const{geometry:I,index:C,sourceLayerIndex:D}=E;if(T&&this.addFeatureDashes(E,y),this.hasPattern){const R=s0("line",this.layers,E,this.zoom,n);this.patternFeatures.push(R)}else this.addFeature(E,I,C,a,y.positions,n.availableImages,n.brightness);b.insert(e[C].feature,I,C,D,this.index)}}addConstantDashes(e){let n=!1;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if(u.kind!=="constant"||d.kind!=="constant")n=!0;else{const p=d.value,y=u.value;if(!y)continue;e.addDash(y,p)}}return n}addFeatureDashes(e,n){const a=this.zoom;for(const u of this.layers){const d=u.paint.get("line-dasharray").value,p=u.layout.get("line-cap").value;if(d.kind==="constant"&&p.kind==="constant")continue;let y,b;if(d.kind==="constant"){if(y=d.value,!y)continue}else y=d.evaluate({zoom:a},e);b=p.kind==="constant"?p.value:p.evaluate({zoom:a},e),n.addDash(y,b),e.patterns[u.id]=n.getKey(y,b)}}update(e,n,a,u,d){const p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,a,u,d)}addFeatures(e,n,a,u,d,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,a,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,O3)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,L3),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,a,u,d,p,y){const b=this.layers[0].layout,T=b.get("line-join").evaluate(e,{}),E=b.get("line-cap").evaluate(e,{}),I=b.get("line-miter-limit"),C=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const D of n)this.addLine(D,e,T,E,I,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,p,u,y)}addLine(e,n,a,u,d,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let G=0;G<e.length-1;G++)this.totalDistance+=e[G].dist(e[G+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=B3[n.type]==="Polygon";let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let T=0;for(;T<b-1&&e[T].equals(e[T+1]);)T++;if(b<(y?3:2))return;a==="bevel"&&(d=1.05);const E=this.overscaling<=16?15*xt/(512*this.overscaling):0,I=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let C,D,R,B,V;this.e1=this.e2=-1,y&&(C=e[b-2],V=e[T].sub(C)._unit()._perp());for(let G=T;G<b;G++){if(R=G===b-1?y?e[T+1]:void 0:e[G+1],R&&e[G].equals(R))continue;V&&(B=V),C&&(D=C),C=e[G],V=R?R.sub(C)._unit()._perp():B,B=B||V;let $=B.add(V);$.x===0&&$.y===0||$._unit();const te=B.x*V.x+B.y*V.y,se=$.x*V.x+$.y*V.y,le=se!==0?1/se:1/0,he=2*Math.sqrt(2-2*se),ye=se<F3&&D&&R,we=B.x*V.y-B.y*V.x>0;if(ye&&G>T){const Pe=C.dist(D);if(Pe>2*E){const Ge=C.sub(C.sub(D)._mult(E/Pe)._round());this.updateDistance(D,Ge),this.addCurrentVertex(Ge,B,0,0,I),D=Ge}}const Ie=D&&R;let Le=Ie?a:y?"butt":u;if(Ie&&Le==="round"&&(le<p?Le="miter":le<=2&&(Le="fakeround")),Le==="miter"&&le>d&&(Le="bevel"),Le==="bevel"&&(le>2&&(Le="flipbevel"),le<d&&(Le="miter")),D&&this.updateDistance(D,C),Le==="miter")$._mult(le),this.addCurrentVertex(C,$,0,0,I);else if(Le==="flipbevel"){if(le>100)$=V.mult(-1);else{const Pe=le*B.add(V).mag()/B.sub(V).mag();$._perp()._mult(Pe*(we?-1:1))}this.addCurrentVertex(C,$,0,0,I),this.addCurrentVertex(C,$.mult(-1),0,0,I)}else if(Le==="bevel"||Le==="fakeround"){const Pe=-Math.sqrt(le*le-1),Ge=we?Pe:0,ct=we?0:Pe;if(D&&this.addCurrentVertex(C,B,Ge,ct,I),Le==="fakeround"){const Ve=Math.round(180*he/Math.PI/20);for(let rt=1;rt<Ve;rt++){let Ne=rt/Ve;if(Ne!==.5){const Ot=Ne-.5;Ne+=Ne*Ot*(Ne-1)*((1.0904+te*(te*(3.55645-1.43519*te)-3.2452))*Ot*Ot+(.848013+te*(.215638*te-1.06021)))}const wt=V.sub(B)._mult(Ne)._add(B)._unit()._mult(we?-1:1);this.addHalfVertex(C,wt.x,wt.y,!1,we,0,I)}}R&&this.addCurrentVertex(C,V,-Ge,-ct,I)}else if(Le==="butt")this.addCurrentVertex(C,$,0,0,I);else if(Le==="square"){const Pe=D?1:-1;D||this.addCurrentVertex(C,$,Pe,Pe,I),this.addCurrentVertex(C,$,0,0,I),D&&this.addCurrentVertex(C,$,Pe,Pe,I)}else Le==="round"&&(D&&(this.addCurrentVertex(C,B,0,0,I),this.addCurrentVertex(C,B,1,1,I,!0)),R&&(this.addCurrentVertex(C,V,-1,-1,I,!0),this.addCurrentVertex(C,V,0,0,I)));if(ye&&G<b-1){const Pe=C.dist(R);if(Pe>2*E){const Ge=C.add(R.sub(C)._mult(E/Pe)._round());this.updateDistance(C,Ge),this.addCurrentVertex(Ge,V,0,0,I),C=Ge}}}}addCurrentVertex(e,n,a,u,d,p=!1){const y=n.y*u-n.x,b=-n.y-n.x*u;this.addHalfVertex(e,n.x+n.y*a,n.y-n.x*a,p,!1,a,d),this.addHalfVertex(e,y,b,p,!0,-u,d)}addHalfVertex({x:e,y:n},a,u,d,p,y,b){this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(n<<1)+(p?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const T=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),b.primitiveLength++),p?this.e2=T:this.e1=T}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}Bt(Rm,"LineBucket",{omit:["layers","patternFeatures"]});class Ia{constructor(e,n,a,u){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(n,u)}update(e,n,a){const{width:u,height:d}=e,{context:p}=this,{gl:y}=p;if(y.bindTexture(y.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!n||n.premultiply!==!1)),a||this.size&&this.size[0]===u&&this.size[1]===d){const{x:b,y:T}=a||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)y.texSubImage2D(y.TEXTURE_2D,0,b,T,y.RGBA,y.UNSIGNED_BYTE,e);else{let E=this.format,I=y.UNSIGNED_BYTE;this.format===y.R32F&&(E=y.RED,I=y.FLOAT),y.texSubImage2D(y.TEXTURE_2D,0,b,T,u,d,E,I,e.data)}}else if(this.size=[u,d],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let b=this.format;this.format===y.R8&&(b=y.RED),y.texImage2D(y.TEXTURE_2D,0,this.format,b,y.UNSIGNED_BYTE,e)}else{let b=this.format,T=this.format,E=y.UNSIGNED_BYTE;this.format===y.DEPTH_COMPONENT&&(b=y.DEPTH_COMPONENT16,E=y.UNSIGNED_SHORT),this.format===y.R8&&(T=y.RED),this.format===y.R32F&&(E=y.FLOAT,T=y.RED),y.texImage2D(y.TEXTURE_2D,0,b,u,d,0,T,E,e.data)}this.useMipmap=!!(n&&n.useMipmap),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,n,a=!1){const{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,a,u){const{context:d}=this,{gl:p}=d;p.bindTexture(p.TEXTURE_2D,this.texture),n!==this.magFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,a),this.wrapS=a),u!==this.wrapT&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,u),this.wrapT=u)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Om{constructor(e,n){this.context=e,this.texture=n}bind(e,n){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}}const qs=32,Ho=33,gl=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,a=0,u=0,d=0,p=0,y=0;for(1&e?u=d=p=qs:n=a=y=qs;(e>>=1)>1;){const T=n+u>>1,E=a+d>>1;1&e?(u=n,d=a,n=p,a=y):(n=u,a=d,u=p,d=y),p=T,y=E}const b=4*t;gl[b+0]=n,gl[b+1]=a,gl[b+2]=u,gl[b+3]=d}const Wo=new Uint16Array(2178),_l=new Uint8Array(1089),Bm=new Uint16Array(1089);function iT(t){return t===0?-.03125:t===32?.03125:0}var Fm=Ht([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const nT={type:2,extent:xt,loadGeometry:()=>[[new Se(0,0),new Se(xt+1,0),new Se(xt+1,xt+1),new Se(0,xt+1),new Se(0,0)]]};class w0{constructor(e,n,a,u,d){this.tileID=e,this.uid=bi(),this.uses=0,this.tileSize=n,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,u&&u.style&&(this._lastUpdatedBrightness=u.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<Cr.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=pl(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,d){const p={};if(!d)return p;for(const y of u){const b=y.layerIds.map(T=>d.getLayer(T)).filter(Boolean);if(b.length!==0){y.layers=b,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(T=>b.filter(E=>E.id===T)[0]));for(const T of b)p[T.fqid]=y}}return p}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const d=this.buckets[u];if(d instanceof Od){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const d=this.buckets[u];if(d instanceof Od&&d.hasRTLText){this.hasRTLText=!0,xe.isLoading()||xe.isLoaded()||ae()!=="deferred"||me();break}}this.queryPadding=0;for(const u in this.buckets){const d=this.buckets[u],p=n.style.getOwnLayer(u);if(!p)continue;const y=p.queryRadius(d);this.queryPadding=Math.max(this.queryPadding,y)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new dy}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(const u in this.buckets){const d=this.buckets[u];d.uploadPending()&&d.upload(e)}const n=e.gl,a=this.imageAtlas;if(a&&!a.uploaded){const u=!!Object.keys(a.patternPositions).length;this.imageAtlasTexture=new Ia(e,a.image,n.RGBA,{useMipmap:u}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ia(e,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Ia(e,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(e,n,a){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,a),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const u=n.style.getBrightness();(this._lastUpdatedBrightness||u)&&(this._lastUpdatedBrightness&&u&&Math.abs(this._lastUpdatedBrightness-u)<.001||(this._lastUpdatedBrightness=u,this.updateBuckets(void 0,n)))}queryRenderedFeatures(e,n,a,u,d,p,y,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:y,transform:p,params:d,tileTransform:this.tileTransform},e,n,a):{}}querySourceFeatures(e,n){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const u=a.loadVTLayers(),d=n?n.sourceLayer:"",p=u._geojsonTileLayer||u[d];if(!p)return;const y=_u(n&&n.filter),{z:b,x:T,y:E}=this.tileID.canonical,I={z:b,x:T,y:E};for(let C=0;C<p.length;C++){const D=p.feature(C);if(y.needGeometry){const V=ul(D,!0);if(!y.filter(new _e(this.tileID.overscaledZ),V,this.tileID.canonical))continue}else if(!y.filter(new _e(this.tileID.overscaledZ),D))continue;const R=a.getId(D,d),B=new gw(D,b,T,E,R);B.tile=I,e.push(B)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const a=it(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let u=!1;if(this.expirationTime>a)u=!1;else if(n)if(this.expirationTime<n)u=!0;else{const d=this.expirationTime-n;d?this.expirationTime=a+Math.max(d,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&n&&this.updateBuckets(e,n)}updateBuckets(e,n){if(!this.latestFeatureIndex)return;const a=this.latestFeatureIndex.loadVTLayers(),u=n.style.listImages(),d=n.style.getBrightness();for(const p in this.buckets){if(!n.style.hasLayer(p))continue;const y=this.buckets[p],b=y.layers[0].sourceLayer||"_geojsonTileLayer",T=a[b];let E={};if(e&&(E=e[b],!T||!E||Object.keys(E).length===0))continue;if(y.update(E,T,u,this.imageAtlas&&this.imageAtlas.patternPositions||{},d),y instanceof Rm||y instanceof fm){const C=n.style.getOwnSourceCache(y.layers[0].source);n._terrain&&n._terrain.enabled&&C&&y.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(C.id,this.tileID)}const I=n&&n.style&&n.style.getOwnLayer(p);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Cr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Cr.now()+e}setTexture(e,n){const a=n.context,u=a.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof Ia?this.texture.update(e,{useMipmap:!0}):(this.texture=new Ia(a,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE))}setDependencies(e,n){const a={};for(const u of n)a[u]=!0;this.dependencies[e]=a}hasDependency(e,n){for(const a of e){const u=this.dependencies[a];if(u){for(const d of n)if(u[d])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const a=Go(nT,this.tileID.canonical,this.tileTransform)[0],u=new hi,d=new pd;for(let p=0;p<a.length;p++){const{x:y,y:b}=a[p];u.emplaceBack(y,b),d.emplaceBack(p)}d.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(d),this._tileDebugBuffer=e.createVertexBuffer(u,xd.members),this._tileDebugSegments=Tn.simpleSegment(0,0,u.length,d.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const a=Go(nT,this.tileID.canonical,this.tileTransform)[0];let u,d;if(this.isRaster){const p=function(y,b){const T=pl(y,b),E=Math.pow(2,y.z);for(let V=0;V<Ho;V++)for(let G=0;G<Ho;G++){const $=ds((y.x+(G+iT(G))/qs)/E),te=wr((y.y+(V+iT(V))/qs)/E),se=b.project($,te),le=V*Ho+G;Wo[2*le+0]=Math.round((se.x*T.scale-T.x)*xt),Wo[2*le+1]=Math.round((se.y*T.scale-T.y)*xt)}_l.fill(0),Bm.fill(0);for(let V=2045;V>=0;V--){const G=4*V,$=gl[G+0],te=gl[G+1],se=gl[G+2],le=gl[G+3],he=$+se>>1,ye=te+le>>1,we=he+ye-te,Ie=ye+$-he,Le=te*Ho+$,Pe=le*Ho+se,Ge=ye*Ho+he,ct=Math.hypot((Wo[2*Le+0]+Wo[2*Pe+0])/2-Wo[2*Ge+0],(Wo[2*Le+1]+Wo[2*Pe+1])/2-Wo[2*Ge+1])>=16;_l[Ge]=_l[Ge]||(ct?1:0),V<1022&&(_l[Ge]=_l[Ge]||_l[(te+Ie>>1)*Ho+($+we>>1)]||_l[(le+Ie>>1)*Ho+(se+we>>1)])}const I=new Qi,C=new tn;let D=0;function R(V,G){const $=G*Ho+V;return Bm[$]===0&&(I.emplaceBack(Wo[2*$+0],Wo[2*$+1],V*xt/qs,G*xt/qs),Bm[$]=++D),Bm[$]-1}function B(V,G,$,te,se,le){const he=V+$>>1,ye=G+te>>1;if(Math.abs(V-se)+Math.abs(G-le)>1&&_l[ye*Ho+he])B(se,le,V,G,he,ye),B($,te,se,le,he,ye);else{const we=R(V,G),Ie=R($,te),Le=R(se,le);C.emplaceBack(we,Ie,Le)}}return B(0,0,qs,qs,qs,0),B(qs,qs,0,0,0,qs),{vertices:I,indices:C}}(this.tileID.canonical,n);u=p.vertices,d=p.indices}else{u=new Qi,d=new tn;for(const{x:y,y:b}of a)u.emplaceBack(y,b,0,0);const p=dm(u.int16,void 0,4);for(let y=0;y<p.length;y+=3)d.emplaceBack(p[y],p[y+1],p[y+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,Fm.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(d),this._tileBoundsSegments=Tn.simpleSegment(0,0,u.length,d.length)}_makeGlobeTileDebugBuffers(e,n){const a=n.projection;if(!a||a.name!=="globe"||n.freezeTileCoverage)return;const u=this.tileID.canonical,d=Td(Cb(u,n)),p=Ma(n.zoom);let y;p>0&&(y=s.m.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,u,n,d,y,p),this._makeGlobeTileDebugTextBuffer(e,u,n,d,y,p)}_globePoint(e,n,a,u,d,p,y){let b=wd(e,n,a);if(p){const T=1<<a.z,E=jo(u.center.lng),I=Uo(u.center.lat),C=(a.x+.5)/T-E;let D=0;C>.5?D=-1:C<-.5&&(D=1);let R=(e/xt+a.x)/T+D,B=(n/xt+a.y)/T;R=(R-E)*u._pixelsPerMercatorPixel+E,B=(B-I)*u._pixelsPerMercatorPixel+I;const V=[R*u.worldSize,B*u.worldSize,0];s.v.transformMat4(V,V,p),b=Ta(b,V,y)}return s.v.transformMat4(b,b,d)}_makeGlobeTileDebugBorderBuffer(e,n,a,u,d,p){const y=new hi,b=new pd,T=new hn,E=(C,D,R,B,V)=>{const G=(R-C)/(V-1),$=(B-D)/(V-1),te=y.length;for(let se=0;se<V;se++){const le=C+se*G,he=D+se*$;y.emplaceBack(le,he);const ye=this._globePoint(le,he,n,a,u,d,p);T.emplaceBack(ye[0],ye[1],ye[2]),b.emplaceBack(te+se)}},I=xt;E(0,0,I,0,16),E(I,0,I,I,16),E(I,I,0,I,16),E(0,I,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(b),this._tileDebugBuffer=e.createVertexBuffer(y,xd.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(T,wb.members),this._tileDebugSegments=Tn.simpleSegment(0,0,y.length,b.length)}_makeGlobeTileDebugTextBuffer(e,n,a,u,d,p){const y=xt/4,b=new hi,T=new tn,E=new hn,I=25;T.reserve(32),b.reserve(I),E.reserve(I);const C=(D,R)=>I*D+R;for(let D=0;D<I;D++){const R=D*y;for(let B=0;B<I;B++){const V=B*y;b.emplaceBack(V,R);const G=this._globePoint(V,R,n,a,u,d,p);E.emplaceBack(G[0],G[1],G[2])}}for(let D=0;D<4;D++)for(let R=0;R<4;R++){const B=C(D,R),V=C(D,R+1),G=C(D+1,R),$=C(D+1,R+1);T.emplaceBack(B,V,G),T.emplaceBack(G,V,$)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(T),this._tileDebugTextBuffer=e.createVertexBuffer(b,xd.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(E,wb.members),this._tileDebugTextSegments=Tn.simpleSegment(0,0,I,32)}destroy(e=!1){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof Ia&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.latestFeatureIndex=null,this.state="unloaded"}}class N3{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,a){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const d={value:n,timeout:void 0};if(a!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},a)),this.data[u].push(d),this.order.push(u),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const a=e.wrapped().key,u=n===void 0?0:this.data[a].indexOf(n),d=this.data[a][u];return this.data[a].splice(u,1),d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(d.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const a in this.data)for(const u of this.data[a])e(u.value)||n.push(u);for(const a of n)this.remove(a.value.tileID,a)}}class fc{constructor(e,n,a,u){this.id=fc.uniqueIdxCounter,fc.uniqueIdxCounter++,this.context=e;const d=e.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||u||n.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=fc.uniqueIdxCounter,fc.uniqueIdxCounter++;const n=this.context.gl;this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}fc.uniqueIdxCounter=0;class Nu{constructor(e,n,a){this.func=e,this.mask=n,this.range=a}}Nu.ReadOnly=!1,Nu.ReadWrite=!0,Nu.disabled=new Nu(519,Nu.ReadOnly,[0,1]);const T0=7680;class M0{constructor(e,n,a,u,d,p){this.test=e,this.ref=n,this.mask=a,this.fail=u,this.depthFail=d,this.pass=p}}M0.disabled=new M0({func:519,mask:0},0,0,T0,T0,T0);class Zs{constructor(e,n,a,u){this.blendFunction=e,this.blendColor=n,this.mask=a,this.blendEquation=u}}Zs.Replace=[1,0,1,0],Zs.disabled=new Zs(Zs.Replace,_n.transparent,[!1,!1,!1,!1]),Zs.unblended=new Zs(Zs.Replace,_n.transparent,[!0,!0,!0,!0]),Zs.alphaBlended=new Zs([1,771,1,771],_n.transparent,[!0,!0,!0,!0]),Zs.multiply=new Zs([774,0,774,0],_n.transparent,[!0,!0,!0,!0]);const S0=1029,E0=2305;class ho{constructor(e,n,a){this.enable=e,this.mode=n,this.frontFace=a}}ho.disabled=new ho(!1,S0,E0),ho.backCCW=new ho(!0,S0,E0),ho.backCW=new ho(!0,S0,2304),ho.frontCW=new ho(!0,1028,2304),ho.frontCCW=new ho(!0,1028,E0);class pc extends Bs{constructor(e,n,a){super(),this.id=e,this._onlySymbols=a,n.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new N3(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new GP,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="errored"&&(n.state!=="loaded"||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const a=this._tiles[n];a.upload(e),a.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return nt(this._tiles).map(e=>e.tileID).sort(rT).map(e=>e.key)}getRenderableIds(e,n){const a=[];for(const u in this._tiles)this._isIdRenderable(+u,e,n)&&a.push(this._tiles[u]);return e?a.sort((u,d)=>{const p=u.tileID,y=d.tileID,b=new Se(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),T=new Se(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-y.overscaledZ||T.y-b.y||T.x-b.x}).map(u=>u.tileID.key):a.map(u=>u.tileID).sort(rT).map(u=>u.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n,a){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())&&(a||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=n),this._loadTile(a,this._tileLoaded.bind(this,a,e,n)))}_tileLoaded(e,n,a,u){if(u)if(e.state="errored",u.status!==404)this._source.fire(new ta(u,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new vs("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const d=this.map.painter.terrain;this.update(this.transform,d.getScaledDemTileSize(),!0),d.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=Cr.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new vs("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let u=0;u<n.length;u++){const d=n[u];if(e.neighboringTiles&&e.neighboringTiles[d]){const p=this.getTileByID(d);a(e,p),a(p,e)}}function a(u,d){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let p=d.tileID.canonical.x-u.tileID.canonical.x;const y=d.tileID.canonical.y-u.tileID.canonical.y,b=Math.pow(2,u.tileID.canonical.z),T=d.tileID.key;p===0&&y===0||Math.abs(y)>1||(Math.abs(p)>1&&(Math.abs(p+b)===1?p+=b:Math.abs(p-b)===1&&(p-=b)),d.dem&&u.dem&&(u.dem.backfillBorder(d.dem,p,y),u.neighboringTiles&&u.neighboringTiles[T]&&(u.neighboringTiles[T].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,a,u){for(const d in this._tiles){let p=this._tiles[d];if(u[d]||!p.hasData()||p.tileID.overscaledZ<=n||p.tileID.overscaledZ>a)continue;let y=p.tileID;for(;p&&p.tileID.overscaledZ>n+1;){const T=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[T.key],p&&p.hasData()&&(y=T)}let b=y;for(;b.overscaledZ>n;)if(b=b.scaledTo(b.overscaledZ-1),e[b.key]){u[y.key]=y;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=e.overscaledZ-1;a>=n;a--){const u=e.scaledTo(a),d=this._getLoadedTile(u);if(d)return d}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const a=Math.ceil(e.width/n)+1,u=Math.ceil(e.height/n)+1,d=Math.floor(a*u*5),p=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,d):d,y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(y)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const a={};for(const u in this._tiles){const d=this._tiles[u];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+n),a[d.tileID.key]=d}this._tiles=a;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,n,a,u){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let d;if(this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(b=>new _r(b.canonical.z,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y)):(d=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(d=d.filter(b=>this._source.hasTile(b)))):d=[],d.length>0&&this.castsShadows&&u&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!A0(this._source.type)){const b=e.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!a}),T=Math.min(b,this._source.maxzoom),E=e.extendTileCoverForShadows(d,u,T);for(const I of E)this._shadowCasterTiles[I.key]=!0,d.push(I)}const p=this._updateRetainedTiles(d);if(A0(this._source.type)&&d.length!==0){const b={},T={},E=Object.keys(p);for(const C of E){const D=p[C],R=this._tiles[C];if(!R||R.fadeEndTime&&R.fadeEndTime<=Cr.now())continue;const B=this.findLoadedParent(D,Math.max(D.overscaledZ-pc.maxOverzooming,this._source.minzoom));B&&(this._addTile(B.tileID),b[B.tileID.key]=B.tileID),T[C]=D}const I=d[d.length-1].overscaledZ;for(const C in this._tiles){const D=this._tiles[C];if(p[C]||!D.hasData())continue;let R=D.tileID;for(;R.overscaledZ>I;){R=R.scaledTo(R.overscaledZ-1);const B=this._tiles[R.key];if(B&&B.hasData()&&T[R.key]){p[C]=D.tileID;break}}}for(const C in b)p[C]||(this._coveredTiles[C]=!0,p[C]=b[C])}for(const b in p)this._tiles[b].clearFadeHold();const y=function(b,T){const E=[];for(const I in b)I in T||E.push(I);return E}(this._tiles,p);for(const b of y){const T=this._tiles[b];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+b)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(e.length===0)return n;const a={},u=e.reduce((T,E)=>Math.min(T,E.overscaledZ),1/0),d=e[0].overscaledZ,p=Math.max(d-pc.maxOverzooming,this._source.minzoom),y=Math.max(d+pc.maxUnderzooming,this._source.minzoom),b={};for(const T of e){const E=this._addTile(T);n[T.key]=T,E.hasData()||u<this._source.maxzoom&&(b[T.key]=T)}this._retainLoadedChildren(b,u,y,n);for(const T of e){let E=this._tiles[T.key];if(E.hasData())continue;if(T.canonical.z>=this._source.maxzoom){const C=T.children(this._source.maxzoom)[0],D=this.getTile(C);if(D&&D.hasData()){n[C.key]=C;continue}}else{const C=T.children(this._source.maxzoom);if(n[C[0].key]&&n[C[1].key]&&n[C[2].key]&&n[C[3].key])continue}let I=E.wasRequested();for(let C=T.overscaledZ-1;C>=p;--C){const D=T.scaledTo(C);if(a[D.key]||(a[D.key]=!0,E=this.getTile(D),!E&&I&&(E=this._addTile(D)),E&&(n[D.key]=D,I=E.wasRequested(),E.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let a,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){a=this._loadedParentTiles[u.key];break}n.push(u.key);const d=u.scaledTo(u.overscaledZ-1);if(a=this._getLoadedTile(d),a)break;u=d}for(const d of n)this._loadedParentTiles[d]=a}}_addTile(e){let n=this._tiles[e.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const a=!!n;if(!a){const u=this.map?this.map.painter:null;n=new w0(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,a||this._source.fire(new vs("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=n.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,a){const u=[],d=this.transform;if(!d)return u;const p=d.projection.name==="globe",y=jo(d.center.lng);for(const b in this._tiles){const T=this._tiles[b];if(a&&T.clearQueryDebugViz(),T.holdingForFade())continue;let E;if(p){const I=T.tileID.canonical;if(I.z===0){const C=[Math.abs(ft(y,...Bd(I,-1))-y),Math.abs(ft(y,...Bd(I,1))-y)];E=[0,2*C.indexOf(Math.min(...C))-1]}else{const C=[Math.abs(ft(y,...Bd(I,-1))-y),Math.abs(ft(y,...Bd(I,0))-y),Math.abs(ft(y,...Bd(I,1))-y)];E=[C.indexOf(Math.min(...C))-1]}}else E=[0];for(const I of E){const C=e.containsTile(T,d,n,I);C&&u.push(C)}}return u}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,n){const a=this.getRenderableIds(e,n).map(d=>this._tiles[d].tileID),u=this.transform.projection.name==="globe";for(const d of a)d.projMatrix=this.transform.calculateProjMatrix(d.toUnwrapped()),d.expandedProjMatrix=u?this.transform.calculateProjMatrix(d.toUnwrapped(),!1,!0):d.projMatrix;return a}sortCoordinatesByDistance(e){const n=e.slice(),a=this.transform._camera.position,u=this.transform._camera.forward(),d={};for(const p of n){const y=1/(1<<p.canonical.z);d[p.key]=((p.canonical.x+.5)*y+p.wrap-a[0])*u[0]+((p.canonical.y+.5)*y-a[1])*u[1]-a[2]*u[2]}return n.sort((p,y)=>d[p.key]-d[y.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(A0(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=Cr.now())return!0}return!1}setFeatureState(e,n,a){this._state.updateState(e=e||"_geojsonTileLayer",n,a)}removeFeatureState(e,n,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,a)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,a){const u=this._tiles[e];u&&u.setDependencies(n,a)}reloadTilesForDependencies(e,n){for(const a in this._tiles)this._tiles[a].hasDependency(e,n)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){const y=()=>{this._sourceLoaded&&(this._source.off("data",y),this._preloadTiles(e,n))};return void this._source.on("data",y)}const a=new Map,u=Array.isArray(e)?e:[e],d=this.map.painter.terrain,p=this.usedForTerrain&&d?d.getScaledDemTileSize():this._source.tileSize;for(const y of u){const b=y.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const T of b)a.set(T.key,T);this.usedForTerrain&&y.updateElevation(!1)}ai(Array.from(a.values()),(y,b)=>{const T=new w0(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(T,E=>{this._source.type==="raster-dem"&&T.dem&&this._backfillDEM(T),b(E,T)})},n)}}function rT(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||a-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function A0(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function Bd(t,e){const n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}pc.maxOverzooming=10,pc.maxUnderzooming=3;const V3=Ht([{name:"a_pos_3f",components:3,type:"Float32"}]),j3=Ht([{name:"a_color_3f",components:3,type:"Float32"}]),U3=Ht([{name:"a_color_4f",components:4,type:"Float32"}]),G3=Ht([{name:"a_uv_2f",components:2,type:"Float32"}]),H3=Ht([{name:"a_normal_3f",components:3,type:"Float32"}]),W3=Ht([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),q3=Ht([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function sT(t,e){const n=Nm(t.projection,t.zoom,t.width,t.height),a=function(d,p,y,b,T){const E=new Yi(y.lng-180*yl,y.lat),I=new Yi(y.lng+180*yl,y.lat),C=d.project(E.lng,E.lat),D=d.project(I.lng,I.lat),R=-Math.atan2(D.y-C.y,D.x-C.x),B=Er.fromLngLat(y);B.y=ft(B.y,-1+yl,1-yl);const V=B.toLngLat(),G=d.project(V.lng,V.lat),$=Er.fromLngLat(V);$.x+=yl;const te=$.toLngLat(),se=d.project(te.lng,te.lat),le=lT(se.x-G.x,se.y-G.y,R),he=Er.fromLngLat(V);he.y+=yl;const ye=he.toLngLat(),we=d.project(ye.lng,ye.lat),Ie=lT(we.x-G.x,we.y-G.y,R),Le=Math.abs(le.x)/Math.abs(Ie.y),Pe=s.m.identity([]);s.m.rotateZ(Pe,Pe,-R*(1-(T?0:b)));const Ge=s.m.identity([]);return s.m.scale(Ge,Ge,[1,1-(1-Le)*b,1]),Ge[4]=-Ie.x/Ie.y*b,s.m.rotateZ(Ge,Ge,R),s.m.multiply(Ge,Pe,Ge),Ge}(t.projection,0,t.center,n,e),u=oT(t);return s.m.scale(a,a,[u,u,1]),a}function oT(t){const e=t.projection,n=Nm(t.projection,t.zoom,t.width,t.height),a=aT(e,t.center),u=aT(e,Yi.convert(e.center));return Math.pow(2,a*n+(1-n)*u)}function Nm(t,e,n,a,u=1/0){const d=t.range;if(!d)return 0;const p=Math.min(u,Math.max(n,a)),y=Math.log(p/1024)/Math.LN2;return yi(d[0]+y,d[1]+y,e)}const yl=1/4e4;function aT(t,e){const n=ft(e.lat,-Fn,Fn),a=new Yi(e.lng-180*yl,n),u=new Yi(e.lng+180*yl,n),d=t.project(a.lng,n),p=t.project(u.lng,n),y=Er.fromLngLat(a),b=Er.fromLngLat(u),T=p.x-d.x,E=p.y-d.y,I=b.x-y.x,C=b.y-y.y,D=Math.sqrt((I*I+C*C)/(T*T+E*E));return Math.log(D)/Math.LN2}function lT(t,e,n){const a=Math.cos(n),u=Math.sin(n);return{x:t*a-e*u,y:t*u+e*a}}function cT(t,e,n){return e*(xt/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}function uT(t,e,n){s.m.identity(t),s.m.rotateZ(t,t,Ze(e[2])),s.m.rotateX(t,t,Ze(e[0])),s.m.rotateY(t,t,Ze(e[1])),s.m.scale(t,t,n),s.m.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Vm(t,e,n,a,u,d,p,y){const b=[n[0]-e[0],n[1]-e[1],0],T=[a[0]-e[0],a[1]-e[1],0];if(s.v.length(b)<1e-12||s.v.length(T)<1e-12)return s.q.identity(t);const E=s.v.cross([],b,T);s.v.normalize(E,E),s.v.subtract(T,a,e),b[2]=(d-u)*y,T[2]=(p-u)*y;const I=b;return s.v.cross(I,b,T),s.v.normalize(I,I),s.q.rotationTo(t,E,I)}function hT(t,e,n=!1){const a=Ma(e.zoom),u=function(d,p,y){const b=p.worldSize,T=[d[12],d[13],d[14]],E=wr(T[1]/b),I=ds(T[0]/b),C=s.m.identity([]),D=qr(1,E)*b,R=qr(1,0)*b*uc(E,p.zoom),B=1/jy(b);let V=R*B;if(y){const se=Nm(p.projection,p.zoom,p.width,p.height,1024);V=B*p.projection.pixelSpaceConversion(p.center.lat,b,se)}const G=cc(E,I);s.v.add(G,G,s.v.scale([],s.v.normalize([],G),D*V*T[2]));const $=function(se){const le=[se[0],se[1],se[2]];let he=[0,1,0];const ye=s.v.cross([],he,le);return s.v.cross(he,le,ye),s.v.squaredLength(he)===0&&(he=[0,1,0],s.v.cross(ye,le,he)),s.v.normalize(ye,ye),s.v.normalize(he,he),s.v.normalize(le,le),[ye[0],ye[1],ye[2],0,he[0],he[1],he[2],0,le[0],le[1],le[2],0,se[0],se[1],se[2],1]}(G);s.m.scale(C,C,[V,V,V*D]),s.m.translate(C,C,[-T[0],-T[1],-T[2]]);const te=s.m.multiply([],p.globeMatrix,$);return s.m.multiply(te,te,C),s.m.multiply(te,te,d),te}(t,e,n);if(a>0){const d=function(p,y){const b=y.worldSize,T=qr(1,0)*b*uc(y.center.lat,y.zoom)/jy(b),E=qr(1,y.center.lat)*b,I=s.m.identity([]);return s.m.rotateY(I,I,Ze(y.center.lng)),s.m.rotateX(I,I,Ze(y.center.lat)),s.m.translate(I,I,[0,0,Ps]),s.m.scale(I,I,[T,T,T*E]),s.m.translate(I,I,[y.point.x-.5*b,y.point.y-.5*b,0]),s.m.multiply(I,I,p),s.m.multiply(I,y.globeMatrix,I)}(t,e);return function(p,y,b){const T=(R,B,V)=>{const G=s.v.length(R),$=s.v.length(B),te=Ta(R,B,V);return s.v.scale(te,te,1/s.v.length(te)*Mi(G,$,V))},E=T([p[0],p[1],p[2]],[y[0],y[1],y[2]],b),I=T([p[4],p[5],p[6]],[y[4],y[5],y[6]],b),C=T([p[8],p[9],p[10]],[y[8],y[9],y[10]],b),D=Ta([p[12],p[13],p[14]],[y[12],y[13],y[14]],b);return[E[0],E[1],E[2],0,I[0],I[1],I[2],0,C[0],C[1],C[2],0,D[0],D[1],D[2],1]}(u,d,a)}return u}const mc=64,jm={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4};function Fd(t,e,n=!1){t.uploaded||(t.gfxTexture=new Ia(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function Z3(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,V3.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,H3.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,G3.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?j3:U3).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,q3.members,!0)),t.segments=Tn.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const a=t.material;a.pbrMetallicRoughness.baseColorTexture&&Fd(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&Fd(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&Fd(a.normalTexture,e),a.occlusionTexture&&Fd(a.occlusionTexture,e,n),a.emissionTexture&&Fd(a.emissionTexture,e)}function I0(t,e,n){if(t.meshes)for(const a of t.meshes)Z3(a,e,n);if(t.children)for(const a of t.children)I0(a,e,n)}function Um(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)Um(e)}function Gm(t){if(t.meshes)for(const n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const n of t.children)Gm(n)}class dT{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class fT{constructor(){this.instancedDataArray=new uy,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class pT{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,n,a,u){this.tileToMeter=nm(a);const d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:p,id:y,index:b,sourceLayerIndex:T}of e){const E=ul(p,d);if(!this.layers[0]._featureFilter.filter(new _e(this.zoom),E,a))continue;const I={id:y,sourceLayerIndex:T,index:b,geometry:d?E.geometry:Go(p,a,u),properties:p.properties,type:p.type,patterns:{}},C=this.addFeature(I,I.geometry,E);C&&n.featureIndex.insert(p,I.geometry,b,T,this.index,this.instancesPerModel[C].instancedDataArray.length)}this.lookup=null}update(e,n,a,u){for(const d in this.instancesPerModel){const p=this.instancesPerModel[d];for(const y in e)p.idToFeaturesIndex.hasOwnProperty(y)&&this.evaluate(p.features[p.idToFeaturesIndex[y]],e[y],p,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const n in this.instancesPerModel){const a=this.instancesPerModel[n];for(const u of a.features){const d=this.layers[0],p=u.feature,y=this.canonical,b=d.paint.get("model-rotation").evaluate(p,{},y),T=d.paint.get("model-scale").evaluate(p,{},y),E=d.paint.get("model-translation").evaluate(p,{},y);s.v.exactEquals(u.rotation,b)&&s.v.exactEquals(u.scale,T)&&s.v.exactEquals(u.translation,E)||(this.evaluate(u,u.featureStates,a,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const n in this.instancesPerModel){const a=this.instancesPerModel[n];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,W3.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const n=this.instancesPerModel[e];n.instancedDataArray.length!==0&&n.instancedDataBuffer&&n.instancedDataBuffer.destroy()}}addFeature(e,n,a){const u=this.layers[0],d=u.layout.get("model-id").evaluate(a,{},this.canonical);if(!d)return si(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),d;this.instancesPerModel[d]||(this.instancesPerModel[d]=new fT);const p=this.instancesPerModel[d],y=p.instancedDataArray,b=new dT(a,y.length);for(const T of n)for(const E of T){if(E.x<0||E.x>=xt||E.y<0||E.y>=xt)continue;const I=(this.lookupDim-1)/xt,C=this.lookupDim*(E.y*I|0)+E.x*I|0;if(this.lookup){if(this.lookup[C]!==0)continue;this.lookup[C]=1}this.instanceCount++;const D=y.length;y.resize(D+1),p.instancesEvaluatedElevation.push(0),y.float32[16*D]=E.x,y.float32[16*D+1]=E.y}return b.instancedDataCount=p.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(b),this.evaluate(b,{},p,!1)),d}evaluate(e,n,a,u){const d=this.layers[0],p=e.feature,y=this.canonical,b=e.rotation=d.paint.get("model-rotation").evaluate(p,n,y),T=e.scale=d.paint.get("model-scale").evaluate(p,n,y),E=e.translation=d.paint.get("model-translation").evaluate(p,n,y),I=d.paint.get("model-color").evaluate(p,n,y);I.a=d.paint.get("model-color-mix-intensity").evaluate(p,n,y);const C=[];this.maxVerticalOffset<E[2]&&(this.maxVerticalOffset=E[2]),this.maxScale=Math.max(Math.max(this.maxScale,T[0]),Math.max(T[1],T[2])),uT(C,b,T);const D=Math.round(100*I.a)+I.b/1.05;for(let R=0;R<e.instancedDataCount;++R){const B=e.instancedDataOffset+R,V=16*B,G=a.instancedDataArray.float32;let $=0;u&&($=G[V+6]-a.instancesEvaluatedElevation[B]);const te=0|G[V+1];G[V]=(0|G[V])+I.r/1.05,G[V+1]=te+I.g/1.05,G[V+2]=D,G[V+3]=1/(y.z>10?this.tileToMeter:nm(y,te)),G[V+4]=E[0],G[V+5]=E[1],G[V+6]=E[2]+$,G[V+7]=C[0],G[V+8]=C[1],G[V+9]=C[2],G[V+10]=C[4],G[V+11]=C[5],G[V+12]=C[6],G[V+13]=C[8],G[V+14]=C[9],G[V+15]=C[10],a.instancesEvaluatedElevation[B]=E[2]}}}Bt(pT,"ModelBucket",{omit:["layers"]}),Bt(fT,"PerModelAttributes"),Bt(dT,"ModelFeature");const X3=new $e({visibility:new ue(De.layout_model.visibility),"model-id":new Ce(De.layout_model["model-id"])});var Y3={paint:new $e({"model-opacity":new ue(De.paint_model["model-opacity"]),"model-rotation":new Ce(De.paint_model["model-rotation"]),"model-scale":new Ce(De.paint_model["model-scale"]),"model-translation":new Ce(De.paint_model["model-translation"]),"model-color":new Ce(De.paint_model["model-color"]),"model-color-mix-intensity":new Ce(De.paint_model["model-color-mix-intensity"]),"model-type":new ue(De.paint_model["model-type"]),"model-cast-shadows":new ue(De.paint_model["model-cast-shadows"]),"model-receive-shadows":new ue(De.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ue(De.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Ce(De.paint_model["model-emissive-strength"]),"model-roughness":new Ce(De.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Ce(De.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ue(De.paint_model["model-cutoff-fade-range"])}),layout:X3};const k0=new Float32Array(262144),gc=new Uint8Array(262144);function mT(t){let e=0;if(t.meshes)for(const n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(const n of t.children)e=Math.max(e,mT(n));return e}const gT=["","wall","door","roof","window","lamp","logo"];class _T{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:mT(e)}}}}class yT{constructor(e,n,a,u){this.nodes=e,this.id=n,this.modelTraits|=jm.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=jm.HasMapboxMeshFeatures),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=u,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const a of n){const u=a.node;this.uploaded?this.updatePbrBuffer(u):I0(u,e,!0)}for(const a of n)Um(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(const a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),n=!0);return n}needsReEvaluation(e,n,a){const u=e.transform.projectionOptions,d=e.style.getBrightness(),p=this.brightness!==d;return!!(!this.uploaded||this.dirty||u.name!==this.projection.name||Nd(a.paint.get("model-color").value,p)||Nd(a.paint.get("model-color-mix-intensity").value,p)||Nd(a.paint.get("model-roughness").value,p)||Nd(a.paint.get("model-emissive-strength").value,p)||Nd(a.paint.get("model-height-based-emissive-strength-multiplier").value,p))&&(this.projection=u,this.brightness=d,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const a=this.getNodesInfo(),u=this.id.canonical;for(const d of a){const p=d.feature;d.evaluatedScale=n.paint.get("model-scale").evaluate(p,{},u)}}evaluate(e){const n=this.getNodesInfo();for(const a of n){if(!a.node.meshes)continue;const u=a.feature,d=a.node.meshes&&a.node.meshes[0].featureData,p=a.evaluatedColor[2],y=a.evaluatedRMEA[2],b=this.id.canonical;if(a.hasTranslucentParts=!1,d){for(let T=0;T<gT.length;T++){const E=gT[T];E.length&&(u.properties.part=E);const I=e.paint.get("model-color").evaluate(u,{},b),C=e.paint.get("model-color-mix-intensity").evaluate(u,{},b);a.evaluatedColor[T]=[I.r,I.g,I.b,C],a.evaluatedRMEA[T][0]=e.paint.get("model-roughness").evaluate(u,{},b),a.evaluatedRMEA[T][2]=e.paint.get("model-emissive-strength").evaluate(u,{},b),a.evaluatedRMEA[T][3]=I.a,a.emissionHeightBasedParams[T]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(u,{},b),!a.hasTranslucentParts&&I.a<1&&(a.hasTranslucentParts=!0)}delete u.properties.part,J3(a,p!==a.evaluatedColor[2]||y!==a.evaluatedRMEA[2])}else a.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(u,{},b);a.evaluatedScale=e.paint.get("model-scale").evaluate(u,{},b),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,a,u){const d=e.findDEMTileFor(a);if(d&&(d.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;const p=Du.create(e,a,d);if(!p)return;this.modelTraits&jm.HasMapboxMeshFeatures&&this.updateDEM(e,p,a,u);for(const y of this.getNodesInfo()){const b=y.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;const T=b.footprint.vertices;let E=p.getElevationAt(T[0].x,T[0].y,!0,!0);for(let I=1;I<T.length;I++)E=Math.min(E,p.getElevationAt(T[I].x,T[I].y,!0,!0));b.elevation=E}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,a,u){let d=n._dem._modifiedForSources[u];if(d===void 0&&(n._dem._modifiedForSources[u]=[],d=n._dem._modifiedForSources[u]),d.includes(a.canonical))return;const p=n._dem.dim;d.push(a.canonical);let y=!1;for(const b of this.getNodesInfo()){const T=b.node;if(!T.footprint||!T.footprint.grid)continue;const E=T.footprint.grid,I=n.tileCoordToPixel(E.min.x,E.min.y),C=n.tileCoordToPixel(E.max.x,E.max.y),D=Math.min(Math.min(p-C.y,I.x),Math.min(I.y,p-C.x));if(D<0)continue;const R=ft(D,2,5);let B=Math.max(0,I.x-R),V=Math.max(0,I.y-R),G=Math.min(C.x+R,p-1),$=Math.min(C.y+R,p-1);for(let he=V;he<=$;++he)for(let ye=B;ye<=G;++ye)gc[he*p+ye]=255;let te=0,se=0;for(let he=0;he<E.cellsY;++he)for(let ye=0;ye<E.cellsX;++ye){if(!E.cells[he*E.cellsX+ye])continue;const we=n.tileCoordToPixel(E.min.x+ye/E.xScale,E.min.y+he/E.yScale),Ie=n.tileCoordToPixel(E.min.x+(ye+1)/E.xScale,E.min.y+(he+1)/E.yScale);for(let Le=we.y;Le<=Math.min(Ie.y+1,p-1);++Le)for(let Pe=we.x;Pe<=Math.min(Ie.x+1,p-1);++Pe)gc[Le*p+Pe]===255&&(gc[Le*p+Pe]=0,te+=n.getElevationAtPixel(Pe,Le),se++)}const le=te/se;B=Math.max(1,I.x-R),V=Math.max(1,I.y-R),G=Math.min(C.x+R,p-2),$=Math.min(C.y+R,p-2),y=!0;for(let he=V;he<=$;++he)for(let ye=B;ye<=G;++ye)gc[he*p+ye]===0&&(k0[he*p+ye]=n._dem.set(ye,he,le));for(let he=1;he<R;++he){B=Math.max(1,I.x-he),V=Math.max(1,I.y-he),G=Math.min(C.x+he,p-2),$=Math.min(C.y+he,p-2);for(let ye=V;ye<=$;++ye)for(let we=B;we<=G;++we){const Ie=ye*p+we;if(gc[Ie]===255){let Le=0,Pe=0,Ge=-1,ct=-1;for(let Ve=-1;Ve<=1;++Ve)for(let rt=-1;rt<=1;++rt){const Ne=(ye+Ve)*p+we+rt;if(gc[Ne]>=he)continue;const wt=k0[Ne],Ot=Math.abs(wt);Ot>Pe&&(Le=wt,Pe=Ot,Ge=rt,ct=Ve)}if(Pe>.1){const Ve=1-(he+.5*Math.abs(Ge*ct))/R;let rt=n._dem.get(we,ye)+Le*Ve;const Ne=n._dem.get(we+Ge,ye+ct),wt=n._dem.get(we-Ge,ye-ct,!0);(rt-Ne)*(rt-wt)>0&&(rt=(Ne+wt)/2),k0[Ie]=n._dem.set(we,ye,rt),gc[Ie]=he}}}}}y&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=Cr.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const e of this.nodes)this.nodesInfo.push(new _T(e));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const e of this.nodes)Gm(e);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const e=this.getNodesInfo();for(const n of e)Um(n.node),Gm(n.node)}isEmpty(){return!this.nodes.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const a=n.getReplacementRegionsForTile(e.toUnwrapped()),u=this.getNodesInfo();for(let d=0;d<this.nodesInfo.length;d++){const p=u[d].node;u[d].hiddenByReplacement=!!p.footprint&&!a.find(y=>y.footprint===p.footprint)}}getHeightAtTileCoord(e,n){const a=this.getNodesInfo(),u=[];for(let d=0;d<this.nodesInfo.length;d++){const p=a[d],y=p.node.meshes[0];if(e<y.aabb.min[0]||n<y.aabb.min[1]||e>y.aabb.max[0]||n>y.aabb.max[1])continue;const b=(e-y.aabb.min[0])/(y.aabb.max[0]-y.aabb.min[0])*mc|0,T=Math.min(63,(n-y.aabb.min[1])/(y.aabb.max[1]-y.aabb.min[1])*mc|0)*mc+Math.min(63,b);if(!(y.heightmap[T]<0&&p.node.footprint))return p.hiddenByReplacement?void 0:{height:y.heightmap[T],maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};if(p.node.footprint.grid.query(new Se(e,n),new Se(e,n),u),u.length>0)return{height:void 0,maxHeight:p.feature.properties.height,hidden:p.hiddenByReplacement,verticalScale:p.evaluatedScale[2]}}}}function Nd(t,e){return!t.isLightConstant&&e}function K3(t,e,n,a,u,d,p,y){let b=(61440&e|(61440&e)>>4)>>8,T=(3840&e|(3840&e)>>4)>>4,E=240&e|(240&e)>>4;n[3]>0&&(b=Mi(b,255*n[0],n[3]),T=Mi(T,255*n[1],n[3]),E=Mi(E,255*n[2],n[3]));const I=b<<8|T,C=E<<8|Math.floor(255*a[3]),D=function(he){const ye=ft(he,0,2);return Math.min(Math.round(.5*ye*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],R=ft(u[0],0,1),B=ft(u[1],0,1),V=ft(u[2],0,1),G=ft(u[3],0,1);let $,te,se,le;if(R!==B&&p!==d&&B!==R){const he=p-d;te=1/(he*(B-R)),se=-(d+he*R)/(he*(B-R));const ye=ft(u[4],-1,1);le=Math.pow(10,ye),$=255*V<<8|255*G}else $=65535,te=0,se=1,le=1;if(t.emplaceBack(I,C,D,$,te,se,le),y){const he=y.length;y.clear();for(let ye=0;ye<he;ye++)y.emplaceBack(I,C,D,$,te,se,le)}}function J3(t,e){const n=t.node;let a=0;for(const u of n.meshes){if(n.lights&&n.lightMeshIndex===a||!u.featureData)continue;u.featureArray=new qp,u.featureArray.reserve(u.featureData.length);let d=e;for(const p of u.featureData){let y;const b=65535&p,T=(15&b)<8?15&b:0,E=p>>16&65535,I=t.evaluatedRMEA[T],C=t.evaluatedColor[T],D=t.emissionHeightBasedParams[T];if(d&&T===2&&n.lights&&(y=new qp,y.resize(10*n.lights.length)),K3(u.featureArray,E,C,I,D,u.aabb.min[2],u.aabb.max[2],y),y&&d){d=!1;const R=n.meshes[n.lightMeshIndex];R.featureArray=y,R.featureArray._trim()}}u.featureArray._trim(),a++}}function Hm(t,e){return t.x-e.x||t.y-e.y}function xT(t,e){return Hm(t.min,e.min)===0&&Hm(t.max,e.max)===0}function vT(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function bT(t,e,n){const a=1/xt,u=1/(1<<n.canonical.z),d=(e.x*a+n.canonical.x)*u+n.wrap,p=(e.y*a+n.canonical.y)*u;return{min:new Se((t.x*a+n.canonical.x)*u+n.wrap,(t.y*a+n.canonical.y)*u),max:new Se(d,p)}}function Q3(t,e,n){const a=1<<n.canonical.z,u=((e.x-n.wrap)*a-n.canonical.x)*xt,d=(e.y*a-n.canonical.y)*xt;return{min:new Se(((t.x-n.wrap)*a-n.canonical.x)*xt,(t.y*a-n.canonical.y)*xt),max:new Se(u,d)}}function wT(t,e,n,a,u,d,p){const y=t.indices,b=t.vertices,T=[];for(let E=a;E<a+u;E+=3){const I=e[n[E+0]+d],C=e[n[E+1]+d],D=e[n[E+2]+d],R=Math.min(I.x,C.x,D.x),B=Math.max(I.x,C.x,D.x),V=Math.min(I.y,C.y,D.y),G=Math.max(I.y,C.y,D.y);T.length=0,t.grid.query(new Se(R,V),new Se(B,G),T);for(let $=0;$<T.length;$++){const te=T[$];if(Jy(b[y[3*te+0]],b[y[3*te+1]],b[y[3*te+2]],I,C,D,p))return!0}}return!1}function TT(t,e,n,a){if(!t||!n)return!1;let u=t.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(n.vertices.length<t.vertices.length)return TT(n,a,t,e);const d=e.canonical,p=a.canonical,y=Math.pow(2,p.z-d.z);u=t.vertices.map(b=>new Se(b.x*d.x*xt*y-p.x*xt,b.y*d.y*xt*y-p.y*xt))}return wT(n,u,t.indices,0,t.indices.length,0,0)}Bt(yT,"Tiled3dModelBucket",{omit:["layers"]}),Bt(_T,"Tiled3dModelFeature");const $3=mm.types,eD=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],tD=["fill-extrusion-flood-light-ground-radius"],iD=Math.pow(2,13),nD=Math.pow(2,15)-1,MT=new Se(0,1),xl=2147483648;function Vd(t,e,n,a,u,d,p,y){t.emplaceBack((e<<1)+p,(n<<1)+d,(Math.floor(a*iD)<<1)+u,Math.round(y))}function Wm(t,e,n,a,u,d){t.emplaceBack(e.x,e.y,(n.x<<1)+a,(n.y<<1)+u,d)}function jd(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class ST{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class ET{constructor(){this.centroidXY=new Se(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Se(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Se(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Se(this.max.x-this.min.x,this.max.y-this.min.y)}}class AT{constructor(){this.acc=new Se(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,a){this.accCount++,this.acc._add(n);let u=!!this.borders;n.x<e.min.x?(e.min.x=n.x,u=!0):n.x>e.max.x&&(e.max.x=n.x,u=!0),n.y<e.min.y?(e.min.y=n.y,u=!0):n.y>e.max.y&&(e.max.y=n.y,u=!0),((n.x===0||n.x===xt)&&n.x===a.x)!=((n.y===0||n.y===xt)&&n.y===a.y)&&this.processBorderOverlap(n,a),u&&this.checkBorderIntersection(n,a)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,Mi(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>xt!=e.x>xt&&this.addBorderIntersection(1,Mi(n.y,e.y,(xt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Mi(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>xt!=e.y>xt&&this.addBorderIntersection(3,Mi(n.x,e.x,(xt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];n<a[0]&&(a[0]=n),n>a[1]&&(a[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,n.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,n.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new Se(0,0):new Se(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function IT(t,e){const n=t.add(e)._unit(),a=ft(t.x*n.x+t.y*n.y,-1,1);var u,d,p;return u=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(u)))/4*nD*((d=t).x*(p=e).y-d.y*p.x<0?-1:1)}const rD=[t=>t.x<0,t=>t.x>xt,t=>t.y<0,t=>t.y>xt];function sD(t,e,n,a){const u=[4];if(a===0)return u;n._mult(a);const d=t.sub(n),p=e.sub(n),y=[t,e,d,p];for(let b=0;b<4;b++)for(const T of y)if(rD[b](T)){u.push(b);break}return u}class kT{constructor(e){this.vertexArray=new Lr,this.indexArray=new tn,this.programConfigurations=new ol(e.layers,e.zoom,n=>tD.includes(n)),this._segments=new Tn,this.hiddenByLandmarkVertexArray=new hy,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Tn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,a,u=!1){const d=e.length;if(d>2){let p=Math.max(0,this._segments.get().length-1);const y=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[p].length);let b;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{const T=e[0],E=e[1];b=IT(T.sub(e[d-1])._perp()._unit(),E.sub(T)._perp()._unit())}for(let T=0;T<d;T++){const E=T===d-1?0:T+1,I=e[T],C=e[E],D=e[E===d-1?0:E+1],R=C.sub(I)._perp()._unit(),B=IT(R,D.sub(C)._perp()._unit()),V=b,G=B;if(C0(I,C,n)||u&&DT(I,n)&&DT(C,n)){b=B;continue}const $=y.vertexLength;Wm(this.vertexArray,I,C,1,1,V),Wm(this.vertexArray,I,C,1,0,V),Wm(this.vertexArray,I,C,0,1,G),Wm(this.vertexArray,I,C,0,0,G),y.vertexLength+=4;const te=sD(I,C,R,a);for(const se of te)this._segmentToGroundQuads[p].push({id:$,region:se}),this._segmentToRegionTriCounts[p][se]+=2,y.primitiveLength+=2;b=B}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),n=e.length;for(let a=0;a<n;a++)this._segmentToGroundQuads[a].sort((u,d)=>u.region-d.region);for(let a=0;a<n;a++){const u=this._segmentToGroundQuads[a],d=e[a],p=this._segmentToRegionTriCounts[a];p.reduce((b,T)=>b+T,0);let y=0;for(let b=0;b<=4;b++){const T=p[b];if(T!==0){let E=this.regionSegments[b];E||(E=this.regionSegments[b]=new Tn);const I={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+y,vertexLength:d.vertexLength,primitiveLength:T};E.get().push(I)}y+=T}for(let b=0;b<u.length;b++){const T=u[b].id;this.indexArray.emplaceBack(T,T+1,T+3),this.indexArray.emplaceBack(T,T+3,T+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,a,u,d,p){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,a,u,d,p)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,vP.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,a,u,d,p){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,a,u,d,p)}updateHiddenByLandmark(e){if(!this.hasData())return;const n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const a=e.flags&xl?1:0;for(let u=e.groundVertexArrayOffset;u<n;++u)this.hiddenByLandmarkVertexArray.emplace(u,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,wP.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const n=this.regionSegments[e];n&&n.destroy()}}}}class Ud{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new tn,this.footprintVertices=new hi,this.footprintSegments=[],this.layoutVertexArray=new Qi,this.centroidVertexArray=new e1,this.indexArray=new tn,this.programConfigurations=new ol(e.layers,e.zoom,n=>eD.includes(n)),this.segments=new Tn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new kT(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,n,a,u){this.features=[],this.hasPattern=r0("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=nm(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:d,id:p,index:y,sourceLayerIndex:b}of e){const T=this.layers[0]._featureFilter.needGeometry,E=ul(d,T);if(!this.layers[0]._featureFilter.filter(new _e(this.zoom),E,a))continue;const I={id:p,sourceLayerIndex:b,index:y,geometry:T?E.geometry:Go(d,a,u),properties:d.properties,type:d.type,patterns:{}},C=this.layoutVertexArray.length;this.hasPattern?this.features.push(s0("fill-extrusion",this.layers,I,this.zoom,n)):this.addFeature(I,I.geometry,y,a,{},n.availableImages,u,n.brightness),n.featureIndex.insert(d,I.geometry,y,b,this.index,C)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,a,u,d,p){for(const y of this.features){const{geometry:b}=y;this.addFeature(y,b,y.index,n,a,u,d,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,a,u,d){const p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;const y=p?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,y,a,u,d),this.groundEffect.update(e,n,y,a,u,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,MP),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,TP.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,bP.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,a,u,d,p,y,b){const T=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,E=[new Se(0,0),new Se(xt,xt)],I=y.projection,C=I.name==="globe",D=$3[e.type]==="Polygon",R=new AT;R.centroidDataIndex=this.centroidData.length;const B=new ET,V=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},u)<=0,G=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},u);B.height=G,B.vertexArrayOffset=this.layoutVertexArray.length,B.groundVertexArrayOffset=this.groundEffect.vertexArray.length,C&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new yn);const $=n0(n,500);for(let we=$.length-1;we>=0;we--){const Ie=$[we];(Ie.length===0||(te=Ie[0]).every(Le=>Le.x<=0)||te.every(Le=>Le.x>=xt)||te.every(Le=>Le.y<=0)||te.every(Le=>Le.y>=xt))&&$.splice(we,1)}var te;let se;if(C)se=OT($,E,u);else{se=[];for(const we of $)se.push({polygon:we,bounds:E})}const le=D?this.edgeRadius:0,he=le>0&&this.zoom<17,ye=(we,Ie)=>{if(we.length===0)return!1;const Le=we[we.length-1];return Ie.x===Le.x&&Ie.y===Le.y};for(const{polygon:we,bounds:Ie}of se){let Le=0,Pe=0;for(const rt of we)D&&!rt[0].equals(rt[rt.length-1])&&rt.push(rt[0]),Pe+=D?rt.length-1:rt.length;const Ge=this.segments.prepareSegment((D?5:4)*Pe,this.layoutVertexArray,this.indexArray);B.footprintSegIdx<0&&(B.footprintSegIdx=this.footprintSegments.length),B.polygonSegIdx<0&&(B.polygonSegIdx=this.polygonSegments.length);const ct={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ve=new ST;if(Ve.vertexOffset=this.footprintVertices.length,Ve.indexOffset=3*this.footprintIndices.length,Ve.ringIndices=[],D){const rt=[],Ne=[];Le=Ge.vertexLength;for(let Ot=0;Ot<we.length;Ot++){const lt=we[Ot];lt.length&&Ot!==0&&Ne.push(rt.length/2);const ei=[];let Nt,bt;Nt=lt[1].sub(lt[0])._perp()._unit(),Ve.ringIndices.push(lt.length-1);for(let ti=1;ti<lt.length;ti++){const Wt=lt[ti],Kt=lt[ti===lt.length-1?1:ti+1],dt=Wt.clone();if(le){bt=Kt.sub(Wt)._perp()._unit();const ri=Nt.add(bt)._unit(),Pi=le*Math.min(4,1/(Nt.x*ri.x+Nt.y*ri.y));dt.x+=Pi*ri.x,dt.y+=Pi*ri.y,dt.x=Math.round(dt.x),dt.y=Math.round(dt.y),Nt=bt}!V||le!==0&&!he||ye(ei,dt)||ei.push(dt),Vd(this.layoutVertexArray,dt.x,dt.y,0,0,1,1,0),Ge.vertexLength++,this.footprintVertices.emplaceBack(Wt.x,Wt.y),rt.push(Wt.x,Wt.y),C&&jd(this.layoutVertexExtArray,I.projectTilePoint(dt.x,dt.y,u),I.upVector(u,dt.x,dt.y))}V&&(le===0||he)&&(ei.length!==0&&ye(ei,ei[0])&&ei.pop(),this.groundEffect.addData(ei,Ie,T))}const wt=dm(rt,Ne);for(let Ot=0;Ot<wt.length;Ot+=3)this.footprintIndices.emplaceBack(Ve.vertexOffset+wt[Ot+0],Ve.vertexOffset+wt[Ot+1],Ve.vertexOffset+wt[Ot+2]),this.indexArray.emplaceBack(Le+wt[Ot],Le+wt[Ot+2],Le+wt[Ot+1]),Ge.primitiveLength++;Ve.indexCount+=wt.length,Ve.vertexCount+=this.footprintVertices.length-Ve.vertexOffset}for(let rt=0;rt<we.length;rt++){const Ne=we[rt];R.startRing(B,Ne[0]);let wt=Ne.length>4&&zT(Ne[Ne.length-2],Ne[0],Ne[1]),Ot=le?oD(Ne[Ne.length-2],Ne[0],Ne[1],le):0;const lt=[];let ei,Nt,bt;Nt=Ne[1].sub(Ne[0])._perp()._unit();let ti=!0;for(let Wt=1,Kt=0;Wt<Ne.length;Wt++){let dt=Ne[Wt-1],ri=Ne[Wt];const Pi=Ne[Wt===Ne.length-1?1:Wt+1];if(R.appendEdge(B,ri,dt),C0(ri,dt,Ie)){le&&(Nt=Pi.sub(ri)._perp()._unit(),ti=!ti);continue}const di=ri.sub(dt)._perp(),Ei=di.x/(Math.abs(di.x)+Math.abs(di.y)),ji=di.y>0?1:0,dn=dt.dist(ri);if(Kt+dn>32768&&(Kt=0),le){bt=Pi.sub(ri)._perp()._unit();let Ki=PT(dt,ri,Pi,CT(Nt,bt),le);isNaN(Ki)&&(Ki=0);const $i=ri.sub(dt)._unit();dt=dt.add($i.mult(Ot))._round(),ri=ri.add($i.mult(-Ki))._round(),Ot=Ki,Nt=bt,V&&this.zoom>=17&&(ye(lt,dt)||lt.push(dt),ye(lt,ri)||lt.push(ri))}const xi=Ge.vertexLength,vn=Ne.length>4&&zT(dt,ri,Pi);let fn=LT(Kt,wt,ti);if(Vd(this.layoutVertexArray,dt.x,dt.y,Ei,ji,0,0,fn),Vd(this.layoutVertexArray,dt.x,dt.y,Ei,ji,0,1,fn),Kt+=dn,fn=LT(Kt,vn,!ti),wt=vn,Vd(this.layoutVertexArray,ri.x,ri.y,Ei,ji,0,0,fn),Vd(this.layoutVertexArray,ri.x,ri.y,Ei,ji,0,1,fn),Ge.vertexLength+=4,this.indexArray.emplaceBack(xi+0,xi+1,xi+2),this.indexArray.emplaceBack(xi+1,xi+3,xi+2),Ge.primitiveLength+=2,le){const Ki=Le+(Wt===1?Ne.length-2:Wt-2),$i=Wt===1?Le:Ki+1;if(this.indexArray.emplaceBack(xi+1,Ki,xi+3),this.indexArray.emplaceBack(Ki,$i,xi+3),Ge.primitiveLength+=2,ei===void 0&&(ei=xi),!C0(Pi,Ne[Wt],Ie)){const Ui=Wt===Ne.length-1?ei:Ge.vertexLength;this.indexArray.emplaceBack(xi+2,xi+3,Ui),this.indexArray.emplaceBack(xi+3,Ui+1,Ui),this.indexArray.emplaceBack(xi+3,$i,Ui+1),Ge.primitiveLength+=3}ti=!ti}if(C){const Ki=this.layoutVertexExtArray,$i=I.projectTilePoint(dt.x,dt.y,u),Ui=I.projectTilePoint(ri.x,ri.y,u),Cn=I.upVector(u,dt.x,dt.y),bn=I.upVector(u,ri.x,ri.y);jd(Ki,$i,Cn),jd(Ki,$i,Cn),jd(Ki,Ui,bn),jd(Ki,Ui,bn)}}D&&(Le+=Ne.length-1),V&&le&&this.zoom>=17&&(lt.length!==0&&ye(lt,lt[0])&&lt.pop(),this.groundEffect.addData(lt,Ie,T,le>0))}this.footprintSegments.push(Ve),ct.triangleCount=this.indexArray.length-ct.triangleArrayOffset,this.polygonSegments.push(ct),++B.footprintSegLen,++B.polygonSegLen}if(B.vertexCount=this.layoutVertexArray.length-B.vertexArrayOffset,B.groundVertexCount=this.groundEffect.vertexArray.length-B.groundVertexArrayOffset,B.vertexCount!==0){if(B.centroidXY=R.borders?MT:this.encodeCentroid(R,B),this.centroidData.push(B),R.borders){this.featuresOnBorder.push(R);const we=this.featuresOnBorder.length-1;for(let Ie=0;Ie<R.borders.length;Ie++)R.borders[Ie][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ie].push(we)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,p,u,b),this.groundEffect.addPaintPropertiesData(e,a,d,p,u,b),this.maxHeight=Math.max(this.maxHeight,G)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,a)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){const e=[];for(let y=0;y<this.centroidData.length;y++){const b=this.centroidData[y],T=+(b.min.y+b.max.y>xt),E=2*T+(+(b.min.x+b.max.x>xt)^T);for(let I=0;I<b.polygonSegLen;I++){const C=b.polygonSegIdx+I;e.push({centroidIdx:y,subtile:E,polygonSegmentIdx:C,triangleSegmentIdx:this.polygonSegments[C].triangleSegIdx})}}const n=new tn;e.sort((y,b)=>y.triangleSegmentIdx===b.triangleSegmentIdx?y.subtile-b.subtile:y.triangleSegmentIdx-b.triangleSegmentIdx);let a=0,u=0,d=0;for(const y of e){if(y.triangleSegmentIdx!==a)break;d++}const p=e.length;for(;u!==e.length;){a=e[u].triangleSegmentIdx;let y=0,b=u,T=u;for(let E=b;E<d&&e[E].subtile===y;E++)T++;for(;b!==d;){const E=e[b];y=E.subtile;const I=this.centroidData[E.centroidIdx].min.clone(),C=this.centroidData[E.centroidIdx].max.clone(),D={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let R=b;R<T;R++){const B=e[R],V=this.polygonSegments[B.polygonSegmentIdx],G=this.centroidData[B.centroidIdx].min,$=this.centroidData[B.centroidIdx].max,te=this.indexArray.uint16;for(let se=V.triangleArrayOffset;se<V.triangleArrayOffset+V.triangleCount;se++)n.emplaceBack(te[3*se],te[3*se+1],te[3*se+2]);D.primitiveLength+=V.triangleCount,I.x=Math.min(I.x,G.x),I.y=Math.min(I.y,G.y),C.x=Math.max(C.x,$.x),C.y=Math.max(C.y,$.y)}D.primitiveLength>0&&this.triangleSubSegments.push({segment:D,min:I,max:C}),b=T;for(let R=b;R<d&&e[R].subtile===e[b].subtile;R++)T++}u=d;for(let E=u;E<p&&e[E].triangleSegmentIdx===e[u].triangleSegmentIdx;E++)d++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,a){let u=0,d=0;const p=1<<e.canonical.z;if(n){const B=n.getMinMaxForTile(e);B&&(u=B.min,d=B.max)}d+=this.maxHeight;const y=e.toUnwrapped();let b;const T=[y.canonical.x/p+y.wrap,y.canonical.y/p],E=[(y.canonical.x+1)/p+y.wrap,(y.canonical.y+1)/p],I=new Tn,C=(B,V,G)=>[B[0]*(1-G[0])+V[0]*G[0],B[1]*(1-G[1])+V[1]*G[1]],D=[],R=[];for(const B of this.triangleSubSegments){D[0]=B.min.x/xt,D[1]=B.min.y/xt,R[0]=B.max.x/xt,R[1]=B.max.y/xt;const V=C(T,E,D),G=C(T,E,R);if(new Hn([V[0],V[1],u],[G[0],G[1],d]).intersectsPrecise(a)===0){b&&(I.segments.push(b),b=void 0);continue}const $=B.segment;b&&b.vertexOffset!==$.vertexOffset&&(I.segments.push(b),b=void 0),b?(b.vertexLength+=$.vertexLength,b.primitiveLength+=$.primitiveLength):b={vertexOffset:$.vertexOffset,primitiveLength:$.primitiveLength,vertexLength:$.vertexLength,primitiveOffset:$.primitiveOffset,sortKey:void 0,vaos:{}}}return b&&I.segments.push(b),I}encodeCentroid(e,n){const a=e.centroid(),u=n.span(),d=Math.min(7,Math.round(u.x*this.tileToMeter/10)),p=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new Se(ft(a.x,1,xt-1)<<3|d,ft(a.y,1,xt-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new Se(0,0);const n=e.borders,a=Number.MAX_VALUE;if(n[0][0]!==a||n[1][0]!==a){const u=n[0][0]!==a?0:1;return new Se(6|(n[0][0]!==a?0:65528),((n[u][0]+n[u][1])/2|0)<<3|6)}{const u=n[2][0]!==a?2:3;return new Se(((n[u][0]+n[u][1])/2|0)<<3|6,6|(n[2][0]!==a?0:65528))}}showCentroid(e){const n=this.centroidData[e.centroidDataIndex];n.flags&=xl,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const n=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,u=e.flags&xl?MT:e.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==u.y||d!==u.x){for(let p=n;p<a;++p)this.centroidVertexArray.emplace(p,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const a=n.getReplacementRegionsForTile(e.toUnwrapped());if(function(d,p){if(d.length!==p.length)return!1;for(let y=0;y<d.length;y++)if(d[y].sourceId!==p[y].sourceId||!xT(d[y],p[y]))return!1;return!0}(this.activeReplacements,a))return;if(this.activeReplacements=a,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const d of this.centroidData)d.flags&=2147483647;const u=[];for(const d of this.activeReplacements){const p=Math.pow(2,d.footprintTileId.canonical.z-e.canonical.z);for(const y of this.centroidData)if(!(y.flags&xl||d.min.x>y.max.x||y.min.x>d.max.x||d.min.y>y.max.y||y.min.y>d.max.y))for(let b=0;b<y.footprintSegLen;b++){const T=this.footprintSegments[y.footprintSegIdx+b];if(u.length=0,aD(this.footprintVertices,T.vertexOffset,T.vertexCount,d.footprintTileId.canonical,e.canonical,u),wT(d.footprint,u,this.footprintIndices.uint16,T.indexOffset,T.indexCount,-T.vertexOffset,-p)){y.flags|=xl;break}}}for(const d of this.centroidData)this.writeCentroidToBuffer(d);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,a){let u=!1;for(let d=0;d<a.footprintSegLen;d++){const p=this.footprintSegments[a.footprintSegIdx+d];let y=0;for(const b of p.ringIndices){for(let T=y,E=b+y-1;T<b+y;E=T++){const I=this.footprintVertices.int16[2*(T+p.vertexOffset)+0],C=this.footprintVertices.int16[2*(T+p.vertexOffset)+1],D=this.footprintVertices.int16[2*(E+p.vertexOffset)+1];C>n!=D>n&&e<(this.footprintVertices.int16[2*(E+p.vertexOffset)+0]-I)*(n-C)/(D-C)+I&&(u=!u)}y=b}}return u}getHeightAtTileCoord(e,n){let a=Number.NEGATIVE_INFINITY,u=!0;const d=4*(e+xt)*xt+(n+xt);if(this.partLookup.hasOwnProperty(d)){const p=this.partLookup[d];return p?{height:p.height,hidden:!!(p.flags&xl)}:void 0}for(const p of this.centroidData)e>p.max.x||p.min.x>e||n>p.max.y||p.min.y>n||this.footprintContainsPoint(e,n,p)&&p&&p.height>a&&(a=p.height,this.partLookup[d]=p,u=!!(p.flags&xl));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:u};this.partLookup[d]=void 0}}function CT(t,e){const n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function oD(t,e,n,a){const u=e.sub(t)._perp()._unit(),d=n.sub(e)._perp()._unit();return PT(t,e,n,CT(u,d),a)}function PT(t,e,n,a,u){const d=Math.sqrt(1-a*a);return Math.min(t.dist(e)/3,e.dist(n)/3,u*d/a)}function C0(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function DT(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function zT(t,e,n){if(t.x<0||t.x>=xt||e.x<0||e.x>=xt||n.x<0||n.x>=xt)return!1;const a=n.sub(e),u=a.perp(),d=t.sub(e);return(a.x*d.x+a.y*d.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(d.x*d.x+d.y*d.y))>-.866&&u.x*d.x+u.y*d.y<0}function LT(t,e,n){const a=e?2|t:-3&t;return n?1|a:-2&a}function RT(){const t=Math.PI/32,e=Math.tan(t),n=Md;return n*Math.sqrt(1+2*e*e)-n}function OT(t,e,n){const a=1<<n.z,u=ds(n.x/a),d=ds((n.x+1)/a),p=wr(n.y/a),y=wr((n.y+1)/a);return function(b,T,E,I,C=0,D){const R=[];if(!b.length||!E||!I)return R;const B=(he,ye)=>{for(const we of he)R.push({polygon:we,bounds:ye})},V=Math.ceil(Math.log2(E)),G=Math.ceil(Math.log2(I)),$=V-G,te=[];for(let he=0;he<Math.abs($);he++)te.push($>0?0:1);for(let he=0;he<Math.min(V,G);he++)te.push(0),te.push(1);let se=b;if(se=gm(se,T[0].y-C,T[1].y+C,1),se=gm(se,T[0].x-C,T[1].x+C,0),!se.length)return R;const le=[];for(te.length?le.push({polygons:se,bounds:T,depth:0}):B(se,T);le.length;){const he=le.pop(),ye=he.depth,we=te[ye],Ie=he.bounds[0],Le=he.bounds[1],Pe=we===0?Ie.x:Ie.y,Ge=we===0?Le.x:Le.y,ct=D?D(we,Pe,Ge):.5*(Pe+Ge),Ve=gm(he.polygons,Pe-C,ct+C,we),rt=gm(he.polygons,ct-C,Ge+C,we);if(Ve.length){const Ne=[Ie,new Se(we===0?ct:Le.x,we===1?ct:Le.y)];te.length>ye+1?le.push({polygons:Ve,bounds:Ne,depth:ye+1}):B(Ve,Ne)}if(rt.length){const Ne=[new Se(we===0?ct:Ie.x,we===1?ct:Ie.y),Le];te.length>ye+1?le.push({polygons:rt,bounds:Ne,depth:ye+1}):B(rt,Ne)}}return R}(t,e,Math.ceil((d-u)/11.25),Math.ceil((p-y)/11.25),1,(b,T,E)=>{if(b===0)return .5*(T+E);{const I=wr((n.y+T/xt)/a);return(Uo(.5*(wr((n.y+E/xt)/a)+I))*a-n.y)*xt}})}function aD(t,e,n,a,u,d){const p=Math.pow(2,a.z-u.z);for(let y=0;y<n;y++){let b=t.int16[2*(y+e)+0],T=t.int16[2*(y+e)+1];b=(b+u.x*xt)*p-a.x*xt,T=(T+u.y*xt)*p-a.y*xt,d.push(new Se(b,T))}}Bt(Ud,"FillExtrusionBucket",{omit:["layers","features"]}),Bt(ET,"PartData"),Bt(ST,"FootprintSegment"),Bt(AT,"BorderCentroidData"),Bt(kT,"GroundEffect");const lD=new $e({visibility:new ue(De["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ue(De["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var cD={paint:new $e({"fill-extrusion-opacity":new ue(De["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ce(De["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ue(De["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ue(De["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ce(De["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ce(De["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ce(De["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ue(De["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ue(De["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ue(De["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ue(De["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ue(De["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ue(De["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ue(De["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ue(De["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Ce(De["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Ce(De["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ue(De["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ue(De["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ue(De["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ue(De["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new ue(De["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:lD};class Vu extends Se{constructor(e,n,a){super(e,n),this.z=a}}function Gd(t,e){return t.x*e.x+t.y*e.y}function BT(t,e){if(t.length===1){let n=0;const a=e[n++];let u;for(;!u||a.equals(u);)if(u=e[n++],!u)return 1/0;for(;n<e.length;n++){const d=e[n],p=t[0],y=u.sub(a),b=d.sub(a),T=p.sub(a),E=Gd(y,y),I=Gd(y,b),C=Gd(b,b),D=Gd(T,y),R=Gd(T,b),B=E*C-I*I,V=(C*D-I*R)/B,G=(E*R-I*D)/B,$=a.z*(1-V-G)+u.z*V+d.z*G;if(isFinite($))return $}return 1/0}{let n=1/0;for(const a of e)n=Math.min(n,a.z);return n}}function FT(t,e,n,a,u,d,p,y){const b=p*u.getElevationAt(t,e,!0,!0),T=d[0]!==0,E=T?d[1]===0?p*(d[0]/7-450):p*function(I,C,D){const R=Math.floor(C[0]/8),B=Math.floor(C[1]/8),V=10*(C[0]-8*R),G=10*(C[1]-8*B),$=I.getElevationAt(R,B,!0,!0),te=I.getMeterToDEM(D),se=Math.floor(.5*(V*te-1)),le=Math.floor(.5*(G*te-1)),he=I.tileCoordToPixel(R,B),ye=2*se+1,we=2*le+1,Ie=function(rt,Ne,wt,Ot,lt){return[rt.getElevationAtPixel(Ne,wt,!0),rt.getElevationAtPixel(Ne+lt,wt,!0),rt.getElevationAtPixel(Ne,wt+lt,!0),rt.getElevationAtPixel(Ne+Ot,wt+lt,!0)]}(I,he.x-se,he.y-le,ye,we),Le=Math.abs(Ie[0]-Ie[1]),Pe=Math.abs(Ie[2]-Ie[3]),Ge=Math.abs(Ie[0]-Ie[2])+Math.abs(Ie[1]-Ie[3]),ct=Math.min(.25,.5*te*(Le+Pe)/ye),Ve=Math.min(.25,.5*te*Ge/we);return $+Math.max(ct*V,Ve*G)}(u,d,y):b;return{base:b+(n===0)?-1:n,top:T?Math.max(E+a,b+n+2):b+a}}const uD=new $e({"line-cap":new Ce(De.layout_line["line-cap"]),"line-join":new Ce(De.layout_line["line-join"]),"line-miter-limit":new ue(De.layout_line["line-miter-limit"]),"line-round-limit":new ue(De.layout_line["line-round-limit"]),"line-sort-key":new Ce(De.layout_line["line-sort-key"]),visibility:new ue(De.layout_line.visibility)});var NT={paint:new $e({"line-opacity":new Ce(De.paint_line["line-opacity"]),"line-color":new Ce(De.paint_line["line-color"]),"line-translate":new ue(De.paint_line["line-translate"]),"line-translate-anchor":new ue(De.paint_line["line-translate-anchor"]),"line-width":new Ce(De.paint_line["line-width"]),"line-gap-width":new Ce(De.paint_line["line-gap-width"]),"line-offset":new Ce(De.paint_line["line-offset"]),"line-blur":new Ce(De.paint_line["line-blur"]),"line-dasharray":new Ce(De.paint_line["line-dasharray"]),"line-pattern":new Ce(De.paint_line["line-pattern"]),"line-gradient":new st(De.paint_line["line-gradient"]),"line-trim-offset":new ue(De.paint_line["line-trim-offset"]),"line-emissive-strength":new ue(De.paint_line["line-emissive-strength"]),"line-border-width":new Ce(De.paint_line["line-border-width"]),"line-border-color":new Ce(De.paint_line["line-border-color"])}),layout:uD};function VT(t,e){return 1/cT(t,1,e.tileZoom)}function jT(t,e,n,a){return t.translatePosMatrix(a||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const UT=t=>{const e=[];GT(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const n=t.paint.get("line-trim-offset");return n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER"),e};function GT(t){const e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}const HT=new class extends Ce{possiblyEvaluate(t,e){return e=new _e(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,a){return e=Qe({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,a)}}(NT.paint.properties["line-width"].specification);function WT(t,e){return e>0?e+2*t:t}HT.useIntegerZoom=!0;const hD=new $e({visibility:new ue(De.layout_background.visibility)});var dD={paint:new $e({"background-color":new ue(De.paint_background["background-color"]),"background-pattern":new ue(De.paint_background["background-pattern"]),"background-opacity":new ue(De.paint_background["background-opacity"]),"background-emissive-strength":new ue(De.paint_background["background-emissive-strength"])}),layout:hD};const fD=new $e({visibility:new ue(De.layout_raster.visibility)});var pD={paint:new $e({"raster-opacity":new ue(De.paint_raster["raster-opacity"]),"raster-color":new st(De.paint_raster["raster-color"]),"raster-color-mix":new ue(De.paint_raster["raster-color-mix"]),"raster-color-range":new ue(De.paint_raster["raster-color-range"]),"raster-hue-rotate":new ue(De.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ue(De.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ue(De.paint_raster["raster-brightness-max"]),"raster-saturation":new ue(De.paint_raster["raster-saturation"]),"raster-contrast":new ue(De.paint_raster["raster-contrast"]),"raster-resampling":new ue(De.paint_raster["raster-resampling"]),"raster-fade-duration":new ue(De.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ue(De.paint_raster["raster-emissive-strength"]),"raster-array-band":new ue(De.paint_raster["raster-array-band"]),"raster-elevation":new ue(De.paint_raster["raster-elevation"])}),layout:fD};function qm(t,e,n,a,u,d,p,y){const b=[t,e,1,n,a,1,u,d,1],T=[p,y,1],E=s.bx.adjoint([],b),[I,C,D]=s.v.transformMat3(T,T,E);return s.bx.multiply(b,b,[I,0,0,0,C,0,0,0,D])}function qT(t,e,n,a,u,d,p,y){const b=function(T,E,I,C,D,R,B,V){const G=qm(0,0,1,0,1,1,0,1),$=qm(T,E,I,C,D,R,B,V),te=s.bx.adjoint([],G);return s.bx.multiply($,$,te)}(t,e,n,a,u,d,p,y);return[b[2]/b[8]/xt,b[5]/b[8]/xt]}function Zm(t){return[t[0],Math.min(Math.max(t[1],-Fn),Fn)]}class ZT extends Bs{constructor(e,n,a,u){super(),this.id=e,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new vs("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Je(this.map._requestManager.transformRequest(this.url,zi.Image),(a,u)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new ta(a)):u&&(this.image=u instanceof HTMLImageElement?Cr.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Om(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new vs("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Om||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],a=e[0][1];for(const d of e)d[1]>a&&(a=d[1]),d[1]<n&&(n=d[1]);const u=(a+n)/2;if(u>Fn?this.onNorthPole=!0:u<-Fn&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const d=e.map(Er.fromLngLat);this.tileID=function(p){let y=1/0,b=1/0,T=-1/0,E=-1/0;for(const B of p)y=Math.min(y,B.x),b=Math.min(b,B.y),T=Math.max(T,B.x),E=Math.max(E,B.y);const I=Math.max(T-y,E-b),C=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),D=Math.pow(2,C);let R=Math.floor((y+T)/2*D);return R>1&&(R-=1),new lc(C,R,Math.floor((b+E)/2*D))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new vs("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const V in this.tiles){const G=this.tiles[V];G.state!=="loaded"&&(G.state="loaded",G.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const n=pl(new lc(0,0,0),this.map.transform.projection),a=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(V){const G=V[1].x-V[0].x,$=V[1].y-V[0].y,te=V[2].x-V[1].x,se=V[2].y-V[1].y,le=V[3].x-V[2].x,he=V[3].y-V[2].y,ye=V[0].x-V[3].x,we=V[0].y-V[3].y,Ie=G*se-te*$,Le=te*he-le*se,Pe=le*we-ye*he,Ge=ye*$-G*we;return Ie>0&&Le>0&&Pe>0&&Ge>0||Ie<0&&Le<0&&Pe<0&&Ge<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const u=pl(this.tileID,this.map.transform.projection),[d,p,y,b]=this.coordinates.map(V=>{const G=u.projection.project(V[0],V[1]);return Yw(u,G)._round()});this.perspectiveTransform=qT(d.x,d.y,p.x,p.y,y.x,y.y,b.x,b.y);const T=this._boundsArray=new Qi;T.emplaceBack(d.x,d.y,0,0),T.emplaceBack(p.x,p.y,xt,0),T.emplaceBack(b.x,b.y,0,xt),T.emplaceBack(y.x,y.y,xt,xt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(T,Fm.members),this.boundsSegments=Tn.simpleSegment(0,0,4,2);const E=[],I=function(V){return[Zm(V[0]),Zm(V[1]),Zm(V[2]),Zm(V[3])]}(this.coordinates),[C,D,R,B]=function(V){let G=V[0][0],$=G,te=V[0][1],se=te;for(let le=1;le<V.length;le++)V[le][0]<G?G=V[le][0]:V[le][0]>$&&($=V[le][0]),V[le][1]<te?te=V[le][1]:V[le][1]>se&&(se=V[le][1]);return[G,te,$-G,se-te]}(I);{const V=new Qi,[G,$,te,se]=function(Ne){let wt=Ne[0].x,Ot=wt,lt=Ne[0].y,ei=lt;for(let Nt=1;Nt<Ne.length;Nt++)Ne[Nt].x<wt?wt=Ne[Nt].x:Ne[Nt].x>Ot&&(Ot=Ne[Nt].x),Ne[Nt].y<lt?lt=Ne[Nt].y:Ne[Nt].y>ei&&(ei=Ne[Nt].y);return[wt,lt,Ot-wt,ei-lt]}(a),le=Ne=>[(Ne.x-G)/te,(Ne.y-$)/se],[he,ye,we,Ie]=a.map(le),Le=function(Ne,wt,Ot,lt,ei,Nt,bt,ti){const Wt=qm(0,0,1,0,1,1,0,1),Kt=qm(Ne,wt,Ot,lt,ei,Nt,bt,ti),dt=s.bx.adjoint([],Kt);return s.bx.multiply(Wt,Wt,dt)}(he[0],he[1],ye[0],ye[1],we[0],we[1],Ie[0],Ie[1]);this.elevatedGlobePerspectiveTransform=qT(he[0],he[1],ye[0],ye[1],we[0],we[1],Ie[0],Ie[1]);const Pe=(Ne,wt)=>{E.push(Ne.lng);const Ot=Math.round((Ne.lng-C)/R*xt),lt=Math.round((Ne.lat-D)/B*xt),ei=le(wt),Nt=s.v.transformMat3([],[ei[0],ei[1],1],Le),bt=Math.round(Nt[0]/Nt[2]*xt),ti=Math.round(Nt[1]/Nt[2]*xt);V.emplaceBack(Ot,lt,bt,ti)},Ge=a[3].x-a[0].x,ct=a[3].y-a[0].y,Ve=a[2].x-a[1].x,rt=a[2].y-a[1].y;for(let Ne=0;Ne<65;Ne++){const wt=Ne/64,Ot=[a[0].x+wt*Ge,a[0].y+wt*ct],lt=[a[1].x+wt*Ve,a[1].y+wt*rt],ei=lt[0]-Ot[0],Nt=lt[1]-Ot[1];for(let bt=0;bt<65;bt++){const ti=bt/64,Wt={x:Ot[0]+ei*ti,y:Ot[1]+Nt*ti,z:0};Pe(n.projection.unproject(Wt.x,Wt.y),Wt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(V,Fm.members)}{this.maxLongitudeTriangleSize=0;let V=[],G=new tn;const $=(te,se,le)=>{G.emplaceBack(te,se,le);const he=E[te],ye=E[se],we=E[le],Ie=Math.min(Math.min(he,ye),we),Le=Math.max(Math.max(he,ye),we)-Ie;Le>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Le),V.push(Ie+Le/2)};for(let te=0;te<64;te++)for(let se=0;se<64;se++){const le=65*te+se,he=le+1,ye=le+65,we=ye+1;$(le,ye,he),$(he,ye,we)}[V,G]=function(te,se){const le=Array.from({length:te.length},(we,Ie)=>Ie);le.sort((we,Ie)=>te[we]-te[Ie]);const he=[],ye=new tn;for(let we=0;we<le.length;we++){const Ie=le[we];he.push(te[Ie]);const Le=3*Ie,Pe=Le+1;ye.emplaceBack(se.uint16[Le],se.uint16[Pe],se.uint16[Pe+1])}return[he,ye]}(V,G),this.elevatedGlobeTrianglesCenterLongitudes=V,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(G)}this.elevatedGlobeSegments=Tn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,R/xt,0,B/xt,0,0,D,C,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const n=this.map.painter.context,a=n.gl;!this._dirty||this.texture instanceof Om||(this.texture?this.texture.update(this.image):(this.texture=new Ia(n,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;const a=this.elevatedGlobeTrianglesCenterLongitudes;let u=((E,I)=>E+360*Math.round((I-E)/360))(e+180,a[0]);const d=new Tn,p=(E,I)=>{d.segments.push({vertexOffset:0,primitiveOffset:E,vertexLength:n.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-u)<=y){const E=Vt(a,0,a.length,u+y);return E===a.length||p(E,Ke(a,E+1,a.length,u+360-y)-E),d}u<a[0]&&(u+=360);const b=Ke(a,0,a.length,u-y);if(b===a.length)return p(0,a.length),d;p(0,b-0);const T=Vt(a,b+1,a.length,u+y);return T!==a.length&&p(T,a.length-T),d}}class mD extends Lt{constructor(e,n){super(e,{},n),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const gD=new $e({visibility:new ue(De.layout_sky.visibility)});var _D={paint:new $e({"sky-type":new ue(De.paint_sky["sky-type"]),"sky-atmosphere-sun":new ue(De.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ue(De.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ue(De.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ue(De.paint_sky["sky-gradient-radius"]),"sky-gradient":new st(De.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ue(De.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ue(De.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ue(De.paint_sky["sky-opacity"])}),layout:gD};function P0(t,e,n){const a=[0,0,1],u=s.q.identity([]);return s.q.rotateY(u,u,n?-Ze(t)+Math.PI:Ze(t)),s.q.rotateX(u,u,-Ze(e)),s.v.transformQuat(a,a,u),s.v.normalize(a,a)}var yD={paint:new $e({})};const xD={circle:class extends Lt{constructor(t,e,n){super(t,KC,e,n)}createBucket(t){return new Xy(t)}queryRadius(t){const e=t;return Au("circle-radius",this,e)+Au("circle-stroke-width",this,e)+om(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,a,u,d,p,y){const b=Yb(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return Jb(t,a,d,p,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,T)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){const n=Kb(this);return{config:new sc(this,e),defines:n,overrideFog:!1}}},heatmap:class extends Lt{createBucket(t){return new $b(t)}constructor(t,e,n){super(t,iP,e,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=am({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Au("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,a,u,d,p,y){const b=this.paint.get("heatmap-radius").evaluate(e,n);return Jb(t,a,d,p,y,!0,!0,new Se(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new sc(this,e),overrideFog:!1}:{}}},hillshade:class extends Lt{constructor(t,e,n){super(t,rP,e,n)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends Lt{constructor(t,e,n){super(t,yP,e,n)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e){return{config:new sc(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new fm(t)}queryRadius(){return om(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,a,u,d){return!t.queryGeometry.isAboveHorizon&&Hb(Xb(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends Lt{constructor(t,e,n){super(t,cD,e,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new Ud(t)}queryRadius(){return om(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,a,u,d,p,y,b){const T=Yb(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),E=this.paint.get("fill-extrusion-height").evaluate(e,n),I=this.paint.get("fill-extrusion-base").evaluate(e,n),C=[0,0],D=y&&d.elevation,R=d.elevation?d.elevation.exaggeration():1,B=t.tile.getBucket(this);if(D&&B instanceof Ud){const se=B.centroidVertexArray,le=b+1;le<se.length&&(C[0]=se.geta_centroid_pos0(le),C[1]=se.geta_centroid_pos1(le))}if(C[0]===0&&C[1]===1)return!1;d.projection.name==="globe"&&(a=OT([a],[new Se(0,0),new Se(xt,xt)],t.tileID.canonical).map(se=>se.polygon).flat());const V=D?y:null,[G,$]=function(se,le,he,ye,we,Ie,Le,Pe,Ge,ct,Ve){return se.projection.name==="globe"?function(rt,Ne,wt,Ot,lt,ei,Nt,bt,ti,Wt,Kt){const dt=[],ri=[],Pi=rt.projection.upVectorScale(Kt,rt.center.lat,rt.worldSize).metersToTile,di=[0,0,0,1],Ei=[0,0,0,1],ji=(xi,vn,fn,Ki)=>{xi[0]=vn,xi[1]=fn,xi[2]=Ki,xi[3]=1},dn=RT();wt>0&&(wt+=dn),Ot+=dn;for(const xi of Ne){const vn=[],fn=[];for(const Ki of xi){const $i=Ki.x+lt.x,Ui=Ki.y+lt.y,Cn=rt.projection.projectTilePoint($i,Ui,Kt),bn=rt.projection.upVector(Kt,Ki.x,Ki.y);let Nn=wt,dr=Ot;if(Nt){const Zr=FT($i,Ui,wt,Ot,Nt,bt,ti,Wt);Nn+=Zr.base,dr+=Zr.top}wt!==0?ji(di,Cn.x+bn[0]*Pi*Nn,Cn.y+bn[1]*Pi*Nn,Cn.z+bn[2]*Pi*Nn):ji(di,Cn.x,Cn.y,Cn.z),ji(Ei,Cn.x+bn[0]*Pi*dr,Cn.y+bn[1]*Pi*dr,Cn.z+bn[2]*Pi*dr),s.v.transformMat4(di,di,ei),s.v.transformMat4(Ei,Ei,ei),vn.push(new Vu(di[0],di[1],di[2])),fn.push(new Vu(Ei[0],Ei[1],Ei[2]))}dt.push(vn),ri.push(fn)}return[dt,ri]}(se,le,he,ye,we,Ie,Le,Pe,Ge,ct,Ve):Le?function(rt,Ne,wt,Ot,lt,ei,Nt,bt,ti){const Wt=[],Kt=[],dt=[0,0,0,1];for(const ri of rt){const Pi=[],di=[];for(const Ei of ri){const ji=Ei.x+Ot.x,dn=Ei.y+Ot.y,xi=FT(ji,dn,Ne,wt,ei,Nt,bt,ti);dt[0]=ji,dt[1]=dn,dt[2]=xi.base,dt[3]=1,s.e.transformMat4(dt,dt,lt),dt[3]=Math.max(dt[3],1e-5);const vn=new Vu(dt[0]/dt[3],dt[1]/dt[3],dt[2]/dt[3]);dt[0]=ji,dt[1]=dn,dt[2]=xi.top,dt[3]=1,s.e.transformMat4(dt,dt,lt),dt[3]=Math.max(dt[3],1e-5);const fn=new Vu(dt[0]/dt[3],dt[1]/dt[3],dt[2]/dt[3]);Pi.push(vn),di.push(fn)}Wt.push(Pi),Kt.push(di)}return[Wt,Kt]}(le,he,ye,we,Ie,Le,Pe,Ge,ct):function(rt,Ne,wt,Ot,lt){const ei=[],Nt=[],bt=lt[8]*Ne,ti=lt[9]*Ne,Wt=lt[10]*Ne,Kt=lt[11]*Ne,dt=lt[8]*wt,ri=lt[9]*wt,Pi=lt[10]*wt,di=lt[11]*wt;for(const Ei of rt){const ji=[],dn=[];for(const xi of Ei){const vn=xi.x+Ot.x,fn=xi.y+Ot.y,Ki=lt[0]*vn+lt[4]*fn+lt[12],$i=lt[1]*vn+lt[5]*fn+lt[13],Ui=lt[2]*vn+lt[6]*fn+lt[14],Cn=lt[3]*vn+lt[7]*fn+lt[15],bn=Ki+bt,Nn=$i+ti,dr=Ui+Wt,Zr=Math.max(Cn+Kt,1e-5),Wn=Ki+dt,On=$i+ri,Or=Ui+Pi,Br=Math.max(Cn+di,1e-5);ji.push(new Vu(bn/Zr,Nn/Zr,dr/Zr)),dn.push(new Vu(Wn/Br,On/Br,Or/Br))}ei.push(ji),Nt.push(dn)}return[ei,Nt]}(le,he,ye,we,Ie)}(d,a,I,E,T,p,V,C,R,d.center.lat,t.tileID.canonical),te=t.queryGeometry;return function(se,le,he){let ye=1/0;Hb(he,le)&&(ye=BT(he,le[0]));for(let we=0;we<le.length;we++){const Ie=le[we],Le=se[we];for(let Pe=0;Pe<Ie.length-1;Pe++){const Ge=Ie[Pe],ct=[Ge,Ie[Pe+1],Le[Pe+1],Le[Pe],Ge];Gb(he,ct)&&(ye=Math.min(ye,BT(he,ct)))}}return ye!==1/0&&ye}(G,$,te.isPointQuery()?te.screenBounds:te.screenGeometry)}},line:class extends Lt{constructor(t,e,n){super(t,NT,e,n),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Gh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=HT.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Rm(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){const n=UT(this);return{config:new sc(this,e),defines:n,overrideFog:!1}}queryRadius(t){const e=t,n=WT(Au("line-width",this,e),Au("line-gap-width",this,e)),a=Au("line-offset",this,e);return n/2+Math.abs(a)+om(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,a,u,d){if(t.queryGeometry.isAboveHorizon)return!1;const p=Xb(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),y=t.pixelToTileUnitsFactor/2*WT(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),b=this.paint.get("line-offset").evaluate(e,n);return b&&(a=function(T,E){const I=[],C=new Se(0,0);for(let D=0;D<T.length;D++){const R=T[D],B=[];for(let V=0;V<R.length;V++){const G=R[V],$=R[V+1],te=V===0?C:G.sub(R[V-1])._unit()._perp(),se=V===R.length-1?C:$.sub(G)._unit()._perp(),le=te._add(se)._unit();le._mult(1/(le.x*se.x+le.y*se.y)),B.push(le._mult(E)._add(G))}I.push(B)}return I}(a,b*t.pixelToTileUnitsFactor)),function(T,E,I){for(let C=0;C<E.length;C++){const D=E[C];if(T.length>=3){for(let R=0;R<D.length;R++)if(hc(T,D[R]))return!0}if(qC(T,D,I))return!0}return!1}(p,a,y)}isTileClipped(){return!0}},symbol:km,background:class extends Lt{constructor(t,e,n){super(t,dD,e,n)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:class extends Lt{constructor(t,e,n){super(t,pD,e,n),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(t){return!(t&&t._source instanceof ZT)||!t._source.onNorthPole&&!t._source.onSouthPole&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-color"].value.expression,[e,n]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=am({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:e,end:n}],resolution:256}),this.colorRampTexture=null}},sky:class extends Lt{constructor(t,e,n){super(t,_D,e,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=am({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),u=!a,d=t.style.light,p=d.properties.get("position");return u&&d.properties.get("anchor")==="viewport"&&si("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?P0(p.azimuthal,90-p.polar,e):P0(a[0],90-a[1],e)}const n=this.paint.get("sky-gradient-center");return P0(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends Lt{constructor(t,e,n){super(t,yD,e)}},model:class extends Lt{constructor(t,e,n){super(t,Y3,e,n)}createBucket(t){return new pT(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Ql}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};class vD{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class bD{constructor(){this.tasks={},this.taskQueue=[],at(["process"],this),this.invoker=new vD(this.process),this.nextId=0}add(e,n){const a=this.nextId++,u=function({type:d,isSymbolTile:p,zoom:y}){return y=y||0,d==="message"?0:d!=="maybePrepare"||p?d!=="parseTile"||p?d==="parseTile"&&p?300-y:d==="maybePrepare"&&p?400-y:500:200-y:100-y}(n);if(u===0){Te();try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:n,priority:u,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){Te();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let u=0;u<this.taskQueue.length;u++){const d=this.tasks[this.taskQueue[u]];d.priority<n&&(n=d.priority,e=u)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class XT{constructor(e,n,a){this.target=e,this.parent=n,this.mapId=a,this.callbacks={},this.cancelCallbacks={},at(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new bD}send(e,n,a,u,d=!1,p){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=p,this.callbacks[y]=a);const b=new Set;return this.target.postMessage({id:y,type:e,hasCallback:!!a,targetMapId:u,mustQueue:d,sourceMapId:this.mapId,data:h(n,b)},b),{cancel:()=>{a&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){const n=e.data,a=n.id;if(a&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){const u=this.cancelCallbacks[a];delete this.cancelCallbacks[a],u&&u.cancel()}else if(n.mustQueue||Te()){const u=this.callbacks[a],d=this.scheduler.add(()=>this.processTask(a,n),u&&u.metadata||{type:"message"});d&&(this.cancelCallbacks[a]=d)}else this.processTask(a,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){const a=this.callbacks[e];delete this.callbacks[e],a&&(n.error?a(x(n.error)):a(null,x(n.data)))}else{const a=new Set,u=n.hasCallback?(p,y)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?h(p):null,data:h(y,a)},a)}:p=>{},d=x(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,d,u);else if(this.parent.getWorkerSource){const p=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,p[0],d.source,d.scope)[p[1]](d,u)}else u(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Hd{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=bi();const a=this.workerPool.acquire(this.id);for(let u=0;u<a.length;u++){const d=new Hd.Actor(a[u],n,this.id);d.name=`Worker ${u}`,this.actors.push(d)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,n,a){ai(this.actors,(u,d)=>{u.send(e,n,d)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}Hd.Actor=XT;class YT{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Sa({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const a=this.getKey(e,n);return this.positions[a]}trim(){const e=this.width,n=this.height=Hi(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,a){const u=[];let d=e.length%2==1?-e[e.length-1]*a:0,p=e[0]*a,y=!0;u.push({left:d,right:p,isDash:y,zeroLength:e[0]===0});let b=e[0];for(let T=1;T<e.length;T++){y=!y;const E=e[T];d=b*a,b+=E,p=b*a,u.push({left:d,right:p,isDash:y,zeroLength:E===0})}return u}addRoundDash(e,n,a){const u=n/2;for(let d=-a;d<=a;d++){const p=this.width*(this.nextRow+a+d);let y=0,b=e[y];for(let T=0;T<this.width;T++){T/b.right>1&&(b=e[++y]);const E=Math.abs(T-b.left),I=Math.abs(T-b.right),C=Math.min(E,I);let D;const R=d/a*(u+1);if(b.isDash){const B=u-Math.abs(R);D=Math.sqrt(C*C+B*B)}else D=u-Math.sqrt(C*C+R*R);this.image.data[p+T]=Math.max(0,Math.min(255,D+128))}}}addRegularDash(e,n){for(let b=e.length-1;b>=0;--b){const T=e[b],E=e[b+1];T.zeroLength?e.splice(b,1):E&&E.isDash===T.isDash&&(E.left=T.left,e.splice(b,1))}const a=e[0],u=e[e.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const d=this.width*this.nextRow;let p=0,y=e[p];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++p]);const T=Math.abs(b-y.left),E=Math.abs(b-y.right),I=Math.min(T,E);this.image.data[d+b]=Math.max(0,Math.min(255,(y.isDash?I:-I)+n+128))}}addDash(e,n){const a=this.getKey(e,n);if(this.positions[a])return this.positions[a];const u=n==="round",d=u?7:0,p=2*d+1;if(this.nextRow+p>this.height)return si("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let E=0;E<e.length;E++)e[E]<0&&(si("Negative value is found in line dasharray, replacing values with 0"),e[E]=0),y+=e[E];if(y!==0){const E=this.width/y,I=this.getDashRanges(e,this.width,E);u?this.addRoundDash(I,E,d):this.addRegularDash(I,n==="square"?.5*E:0)}const b=this.nextRow+d;this.nextRow+=p;const T={tl:[b,d],br:[y,0]};return this.positions[a]=T,T}}Bt(YT,"LineAtlas");const KT=1*uo;class JT{constructor(e){const n={},a=[];for(const y in e){const b=e[y],T=n[y]={};for(const E in b.glyphs){const I=b.glyphs[+E];if(!I||I.bitmap.width===0||I.bitmap.height===0)continue;const C=I.metrics.localGlyph?KT:1,D={x:0,y:0,w:I.bitmap.width+2*C,h:I.bitmap.height+2*C};a.push(D),T[E]=D}}const{w:u,h:d}=f0(a),p=new Sa({width:u||1,height:d||1});for(const y in e){const b=e[y];for(const T in b.glyphs){const E=b.glyphs[+T];if(!E||E.bitmap.width===0||E.bitmap.height===0)continue;const I=n[y][T],C=E.metrics.localGlyph?KT:1;Sa.copy(E.bitmap,p,{x:0,y:0},{x:I.x+C,y:I.y+C},E.bitmap)}}this.image=p,this.positions=n}}Bt(JT,"GlyphAtlas");class wD{constructor(e){this.tileID=new _r(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=pl(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster}parse(e,n,a,u,d){this.status="parsing",this.data=e,this.collisionBoxArray=new dy;const p=new uw(Object.keys(e.layers).sort()),y=new l0(this.tileID,this.promoteId);y.bucketLayerIDs=[];const b={},T=new YT(256,256),E={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:T,availableImages:a,brightness:this.brightness},I=n.familiesBySource[this.source];for(const $ in I){const te=e.layers[$];if(!te)continue;let se=!1,le=!1,he=!1;for(const Ie of I[$])Ie[0].type==="symbol"?se=!0:le=!0,Ie[0].is3D()&&Ie[0].type!=="model"&&(he=!0);if(this.extraShadowCaster&&!he||this.isSymbolTile===!0&&!se||this.isSymbolTile===!1&&!le)continue;te.version===1&&si(`Vector tile source "${this.source}" layer "${$}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ye=p.encode($),we=[];for(let Ie=0;Ie<te.length;Ie++){const Le=te.feature(Ie),Pe=y.getId(Le,$);we.push({feature:Le,id:Pe,index:Ie,sourceLayerIndex:ye})}for(const Ie of I[$]){const Le=Ie[0];(!this.extraShadowCaster||Le.is3D()&&Le.type!=="model")&&(this.isSymbolTile!==void 0&&Le.type==="symbol"!==this.isSymbolTile||Le.minzoom&&this.zoom<Math.floor(Le.minzoom)||Le.maxzoom&&this.zoom>=Le.maxzoom||Le.visibility!=="none"&&(D0(Ie,this.zoom,E.brightness,a),(b[Le.id]=Le.createBucket({index:y.bucketLayerIDs.length,layers:Ie,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ye,sourceID:this.source,projection:this.projection.spec})).populate(we,E,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(Ie.map(Pe=>Pe.id))))}}let C,D,R,B;T.trim();const V={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},G=()=>{if(C)return this.status="done",d(C);if(this.extraShadowCaster)this.status="done",d(null,{buckets:nt(b).filter($=>!$.isEmpty()),featureIndex:y,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:E.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(D&&R&&B){const $=new JT(D),te=new Vw(R,B);for(const se in b){const le=b[se];le instanceof Od?(D0(le.layers,this.zoom,E.brightness,a),y3(le,D,$.positions,R,te.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):le.hasPattern&&(le instanceof Rm||le instanceof fm||le instanceof Ud)&&(D0(le.layers,this.zoom,E.brightness,a),le.addFeatures(E,this.tileID.canonical,te.patternPositions,a,this.tileTransform,this.brightness))}this.status="done",d(null,{buckets:nt(b).filter(se=>!se.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:$.image,lineAtlas:T,imageAtlas:te,brightness:E.brightness})}};if(!this.extraShadowCaster){const $=$n(E.glyphDependencies,le=>Object.keys(le).map(Number));Object.keys($).length?u.send("getGlyphs",{uid:this.uid,stacks:$,scope:this.scope},(le,he)=>{C||(C=le,D=he,G())},void 0,!1,V):D={};const te=Object.keys(E.iconDependencies);te.length?u.send("getImages",{icons:te,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(le,he)=>{C||(C=le,R=he,G())},void 0,!1,V):R={};const se=Object.keys(E.patternDependencies);se.length?u.send("getImages",{icons:se,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(le,he)=>{C||(C=le,B=he,G())},void 0,!1,V):B={}}G()}}function D0(t,e,n,a){const u=new _e(e,{brightness:n});for(const d of t)d.recalculate(u,a)}class QT{constructor(e){this.entries={},this.scheduler=e}request(e,n,a,u){const d=this.entries[e]=this.entries[e]||{callbacks:[]};if(d.result){const[p,y]=d.result;return this.scheduler?this.scheduler.add(()=>{u(p,y)},n):u(p,y),()=>{}}return d.callbacks.push(u),d.cancel||(d.cancel=a((p,y)=>{d.result=[p,y];for(const b of d.callbacks)this.scheduler?this.scheduler.add(()=>{b(p,y)},n):b(p,y);setTimeout(()=>delete this.entries[e],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(p=>p!==u),d.callbacks.length||(d.cancel(),delete this.entries[e]))}}}function $T(t,e,n){const a=JSON.stringify(t.request);return t.data&&(this.deduped.entries[a]={result:[null,t.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},u=>{const d=sr(t.request,(p,y,b,T)=>{p?u(p):y&&u(null,{vectorTile:n?void 0:new o0(new xm(y)),rawData:y,cacheControl:b,expires:T})});return()=>{d.cancel(),u()}},e)}var Wd={workerUrl:"",workerClass:null,workerParams:void 0};function TD(){return Wd.workerClass!=null?new Wd.workerClass:new self.Worker(Wd.workerUrl,Wd.workerParams)}const z0="mapboxgl_preloaded_worker_pool";class qd{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<qd.workerCount;)this.workers.push(new TD);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[z0]}numActive(){return Object.keys(this.active).length}}let Zd;function L0(){return Zd||(Zd=new qd),Zd}qd.workerCount=2;let Xm,R0,fo,O0=null;function eM(){return Te()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:R0||z.DRACO_URL}const B0=5123,F0=5126,N0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[B0]:Uint16Array,5125:Uint32Array,[F0]:Float32Array},MD={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[B0]:"DT_UINT16",5125:"DT_UINT32",[F0]:"DT_FLOAT32"},V0={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function tM(t,e,n){const a=n.json.bufferViews.length,u=n.buffers.length;e.bufferView=a,n.json.bufferViews[a]={buffer:u,byteLength:t.byteLength},n.buffers[u]=t}const j0="KHR_draco_mesh_compression";function SD(t,e){const n=t.extensions&&t.extensions[j0];if(!n)return;const a=new fo.Decoder,u=sM(e,n.bufferView),d=new fo.Mesh;if(!a.DecodeArrayToMesh(u,u.byteLength,d))throw new Error("Failed to decode Draco mesh");const p=e.json.accessors[t.indices],y=N0[p.componentType],b=p.count*y.BYTES_PER_ELEMENT,T=fo._malloc(b);y===Uint16Array?a.GetTrianglesUInt16Array(d,b,T):a.GetTrianglesUInt32Array(d,b,T),tM(fo.memory.buffer.slice(T,T+b),p,e),fo._free(T);for(const E of Object.keys(n.attributes)){const I=a.GetAttributeByUniqueId(d,n.attributes[E]),C=e.json.accessors[t.attributes[E]],D=MD[C.componentType],R=C.count*V0[C.type]*N0[C.componentType].BYTES_PER_ELEMENT,B=fo._malloc(R);a.GetAttributeDataArrayForAllPoints(d,I,fo[D],R,B),tM(fo.memory.buffer.slice(B,B+R),C,e),fo._free(B)}a.destroy(),d.destroy(),delete t.extensions[j0]}const iM=1179937895,nM=new TextDecoder("utf8");function rM(t,e){return new URL(t,e).href}function ED(t,e,n,a){return fetch(rM(t.uri,a)).then(u=>u.arrayBuffer()).then(u=>{e.buffers[n]=u})}function sM(t,e){const n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function AD(t,e,n,a){if(t.uri){const u=rM(t.uri,a);return fetch(u).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{e.images[n]=d})}if(t.bufferView!==void 0){const u=sM(e,t.bufferView),d=new Blob([u],{type:t.mimeType});return createImageBitmap(d).then(p=>{e.images[n]=p})}}function oM(t,e=0,n){const a={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===iM){const T=new Uint32Array(t,e);let E=2;const I=(T[E++]>>2)-3,C=T[E++]>>2;if(E++,a.json=JSON.parse(nM.decode(T.subarray(E,E+C))),E+=C,E<I){const D=T[E++];E++;const R=e+(E<<2);a.buffers[0]=t.slice(R,R+D)}}else a.json=JSON.parse(nM.decode(new Uint8Array(t,e)));const{buffers:u,images:d,meshes:p,extensionsUsed:y}=a.json;let b=Promise.resolve();if(u){const T=[];for(let E=0;E<u.length;E++){const I=u[E];I.uri?T.push(ED(I,a,E,n)):a.buffers[E]||(a.buffers[E]=null)}b=Promise.all(T)}return b.then(()=>{const T=[],E=y&&y.includes(j0);if(E&&T.push(function(){if(!fo)return Xm||(Xm=function(I){let C,D=null;function R(){C=new Uint8Array(D.buffer)}function B(){throw new Error("Unexpected Draco error.")}const V={a:{a:B,d:function(G,$,te){return C.copyWithin(G,$,$+te)},c:function(G){const $=C.length,te=Math.max(G>>>0,Math.ceil(1.2*$)),se=Math.ceil((te-$)/65536);try{return D.grow(se),R(),!0}catch{return!1}},b:B}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(I,V):I.then(G=>G.arrayBuffer()).then(G=>WebAssembly.instantiate(G,V))).then(G=>{const{Rb:$,Qb:te,P:se,T:le,X:he,Ja:ye,La:we,Qa:Ie,Va:Le,Wa:Pe,eb:Ge,jb:ct,f:Ve,e:rt,yb:Ne,zb:wt,Ab:Ot,Bb:lt,Db:ei,Gb:Nt}=G.instance.exports;D=rt;const bt=(()=>{let ti=0,Wt=0,Kt=0,dt=0;return ri=>{Kt&&($(dt),$(ti),Wt+=Kt,Kt=ti=0),ti||(Wt+=128,ti=te(Wt));const Pi=ri.length+7&-8;let di=ti;Pi>=Wt&&(Kt=Pi,di=dt=te(Pi));for(let Ei=0;Ei<ri.length;Ei++)C[di+Ei]=ri[Ei];return di}})();return R(),Ve(),{memory:rt,_free:$,_malloc:te,Mesh:class{constructor(){this.ptr=se()}destroy(){le(this.ptr)}},Decoder:class{constructor(){this.ptr=ye()}destroy(){ct(this.ptr)}DecodeArrayToMesh(ti,Wt,Kt){const dt=bt(ti),ri=we(this.ptr,dt,Wt,Kt.ptr);return!!he(ri)}GetAttributeByUniqueId(ti,Wt){return{ptr:Ie(this.ptr,ti.ptr,Wt)}}GetTrianglesUInt16Array(ti,Wt,Kt){Le(this.ptr,ti.ptr,Wt,Kt)}GetTrianglesUInt32Array(ti,Wt,Kt){Pe(this.ptr,ti.ptr,Wt,Kt)}GetAttributeDataArrayForAllPoints(ti,Wt,Kt,dt,ri){Ge(this.ptr,ti.ptr,Wt.ptr,Kt,dt,ri)}},DT_INT8:Ne(),DT_UINT8:wt(),DT_INT16:Ot(),DT_UINT16:lt(),DT_UINT32:ei(),DT_FLOAT32:Nt()}})}(fetch(eM())),Xm.then(I=>{fo=I,Xm=void 0}))}()),d)for(let I=0;I<d.length;I++)T.push(AD(d[I],a,I,n));return(T.length?Promise.all(T):Promise.resolve()).then(()=>{if(E&&p)for(const{primitives:I}of p)for(const C of I)SD(C,a);return a})})}class aM{constructor(e,n,a){if(this.triangleCount=n.length/3,this.min=new Se(0,0),this.max=new Se(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0||a===0)return;const u=e.map(E=>E.x),d=e.map(E=>E.y);this.min=new Se(Math.min(...u),Math.min(...d)),this.max=new Se(Math.max(...u),Math.max(...d));const p=this.max.sub(this.min);p.x=Math.max(p.x,1),p.y=Math.max(p.y,1);const y=Math.max(p.x,p.y)/a;this.cellsX=Math.max(1,Math.ceil(p.x/y)),this.cellsY=Math.max(1,Math.ceil(p.y/y)),this.xScale=1/y,this.yScale=1/y;const b=[];for(let E=0;E<this.triangleCount;E++){const I=e[n[3*E+0]].sub(this.min),C=e[n[3*E+1]].sub(this.min),D=e[n[3*E+2]].sub(this.min),R=vl(Math.floor(Math.min(I.x,C.x,D.x)),this.xScale,this.cellsX),B=vl(Math.floor(Math.max(I.x,C.x,D.x)),this.xScale,this.cellsX),V=vl(Math.floor(Math.min(I.y,C.y,D.y)),this.yScale,this.cellsY),G=vl(Math.floor(Math.max(I.y,C.y,D.y)),this.yScale,this.cellsY),$=new Se(0,0),te=new Se(0,0),se=new Se(0,0),le=new Se(0,0);for(let he=V;he<=G;++he){$.y=te.y=he*y,se.y=le.y=(he+1)*y;for(let ye=R;ye<=B;++ye)$.x=se.x=ye*y,te.x=le.x=(ye+1)*y,(Jy(I,C,D,$,te,le)||Jy(I,C,D,$,le,se))&&b.push({cellIdx:he*this.cellsX+ye,triIdx:E})}}if(b.length===0)return;b.sort((E,I)=>E.cellIdx-I.cellIdx||E.triIdx-I.triIdx);let T=0;for(;T<b.length;){const E=b[T].cellIdx,I={start:this.payload.length,len:0};for(;T<b.length&&b[T].cellIdx===E;)++I.len,this.payload.push(b[T++].triIdx);this.cells[E]=I}}query(e,n,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let b=0;b<this.lookup.length;b++)this.lookup[b]=0;const u=vl(e.x-this.min.x,this.xScale,this.cellsX),d=vl(n.x-this.min.x,this.xScale,this.cellsX),p=vl(e.y-this.min.y,this.yScale,this.cellsY),y=vl(n.y-this.min.y,this.yScale,this.cellsY);for(let b=p;b<=y;b++)for(let T=u;T<=d;T++){const E=this.cells[b*this.cellsX+T];if(E)for(let I=0;I<E.len;I++){const C=this.payload[E.start+I],D=Math.floor(C/8),R=1<<C%8;if(!(this.lookup[D]&R)&&(this.lookup[D]|=R,a.push(C),a.length===this.triangleCount))return}}}}function vl(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}function _c(t,e){const n=t.json.bufferViews[e.bufferView];return new N0[e.componentType](t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*V0[e.type])}function ID(t,e,n){const a=t.indices,u=t.attributes,d={};d.indexArray=new tn;const p=e.json.accessors[a],y=p.count/3;d.indexArray.reserve(y);const b=_c(e,p);for(let C=0;C<y;C++)d.indexArray.emplaceBack(b[3*C],b[3*C+1],b[3*C+2]);d.indexArray._trim(),d.vertexArray=new nc;const T=e.json.accessors[u.POSITION];d.vertexArray.reserve(T.count);const E=_c(e,T);for(let C=0;C<T.count;C++)d.vertexArray.emplaceBack(E[3*C],E[3*C+1],E[3*C+2]);if(d.vertexArray._trim(),d.aabb=new Hn(T.min,T.max),d.centroid=function(C,D){const R=[0,0,0],B=C.length;if(B>0){for(let V=0;V<B;V++){const G=3*C[V];R[0]+=D[G],R[1]+=D[G+1],R[2]+=D[G+2]}R[0]/=B,R[1]/=B,R[2]/=B}return R}(b,E),u.COLOR_0!==void 0){const C=e.json.accessors[u.COLOR_0],D=V0[C.type];if(C.componentType===F0){d.colorArray=D===3?new nc:new Xi,d.colorArray.reserve(C.count);const R=_c(e,C);if(D===3)for(let B=0;B<C.count;B++)d.colorArray.emplaceBack(R[3*B],R[3*B+1],R[3*B+2]);else for(let B=0;B<C.count;B++)d.colorArray.emplaceBack(R[4*B],R[4*B+1],R[4*B+2],R[4*B+3]);d.colorArray._trim()}else if(C.componentType===B0&&D===4){d.colorArray=new Xi,d.colorArray.resize(C.count);const R=_c(e,C),B=1/65535,V=d.colorArray.float32;for(let G=0;G<4*R.length;++G)V[G]=R[G]*B}else si(`glTF color buffer parsing for accessor ${JSON.stringify(C)} is not supported`)}if(u.NORMAL!==void 0){d.normalArray=new nc;const C=e.json.accessors[u.NORMAL];d.normalArray.reserve(C.count);const D=_c(e,C);for(let R=0;R<C.count;R++)d.normalArray.emplaceBack(D[3*R],D[3*R+1],D[3*R+2]);d.normalArray._trim()}if(u.TEXCOORD_0!==void 0&&n.length>0){d.texcoordArray=new md;const C=e.json.accessors[u.TEXCOORD_0];d.texcoordArray.reserve(C.count);const D=_c(e,C);for(let R=0;R<C.count;R++)d.texcoordArray.emplaceBack(D[2*R],D[2*R+1]);d.texcoordArray._trim()}const I=t.material;return d.material=function(C,D){const{emissiveFactor:R=[0,0,0],alphaMode:B="OPAQUE",alphaCutoff:V=.5,normalTexture:G,occlusionTexture:$,emissiveTexture:te,doubleSided:se}=C,{baseColorFactor:le=[1,1,1,1],metallicFactor:he=1,roughnessFactor:ye=1,baseColorTexture:we,metallicRoughnessTexture:Ie}=C.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new _n(...le),metallicFactor:he,roughnessFactor:ye,baseColorTexture:we?D[we.index]:void 0,metallicRoughnessTexture:Ie?D[Ie.index]:void 0},doubleSided:se,emissiveFactor:R,alphaMode:B,alphaCutoff:V,normalTexture:G?D[G.index]:void 0,occlusionTexture:$?D[$.index]:void 0,emissionTexture:te?D[te.index]:void 0,defined:C.defined===void 0}}(I!==void 0?e.json.materials[I]:{defined:!1},n),u._FEATURE_RGBA4444!==void 0&&(d.featureData=new Uint32Array(_c(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer)),d}function lM(t,e,n){const{matrix:a,rotation:u,translation:d,scale:p,mesh:y,extras:b,children:T}=t,E={};if(E.matrix=a||s.m.fromRotationTranslationScale([],u||[0,0,0,1],d||[0,0,0],p||[1,1,1]),y!==void 0){E.meshes=n[y];const I=E.anchor=[0,0];for(const C of E.meshes){const{min:D,max:R}=C.aabb;I[0]+=D[0]+R[0],I[1]+=D[1]+R[1]}I[0]=Math.floor(I[0]/E.meshes.length/2),I[1]=Math.floor(I[1]/E.meshes.length/2)}if(b&&(b.id&&(E.id=b.id),b.lights&&(E.lights=function(I){if(!I.length)return[];const C=function(G){const $=atob(G),te=new Uint8Array($.length);for(let se=0;se<$.length;se++)te[se]=$.codePointAt(se);return te}(I),D=[],R=C.length/24,B=new Uint16Array(C.buffer),V=new Float32Array(C.buffer);for(let G=0;G<R;G++){const $=B[2*G*6]/30,te=B[2*G*6+1]/30,se=B[2*G*6+10]/100,le=V[6*G+1],he=V[6*G+2],ye=V[6*G+3],we=V[6*G+4],Ie=ye-le,Le=we-he,Pe=Math.hypot(Ie,Le);D.push({pos:[le+.5*Ie,he+.5*Le,te],normal:[Le/Pe,-Ie/Pe,0],width:Pe,height:$,depth:se,points:[le,he,ye,we]})}return D}(b.lights))),T){const I=[];for(const C of T)I.push(lM(e.json.nodes[C],e,n));E.children=I}return E}function kD(t){if(t.vertices.length===0||t.indices.length===0)return null;const[e,n]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let p=1;p<t.vertices.length;++p){const y=t.vertices[p];e.x=Math.min(e.x,y.x),e.y=Math.min(e.y,y.y),n.x=Math.max(n.x,y.x),n.y=Math.max(n.y,y.y)}const a=Math.ceil(Math.max(n.x-e.x,n.y-e.y)/256),u=Math.max(8,a),d=new aM(t.vertices,t.indices,u);return{vertices:t.vertices,indices:t.indices,grid:d,min:e,max:n}}function CD(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;const a=[];for(const p of n){if(!Array.isArray(p)||p.length!==2)continue;const y=p[0],b=p[1];typeof y=="number"&&typeof b=="number"&&a.push(new Se(y,b))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let u=0;for(let p=0;p<a.length;p++){const y=a[p],b=a[(p+1)%a.length],T=a[(p+2)%a.length];u+=(y.x-b.x)*(T.y-b.y)-(T.x-b.x)*(y.y-b.y)}u>0&&a.reverse();const d=dm(a.flatMap(p=>[p.x,p.y]),[]);return d.length===0?null:{vertices:a,indices:d}}function PD(t){const e=[],n=[];let a=0;for(const u of t){a=e.length;const d=u.vertexArray.float32,p=u.indexArray.uint16;for(let y=0;y<u.vertexArray.length;y++)e.push(new Se(d[3*y+0],d[3*y+1]));for(let y=0;y<3*u.indexArray.length;y++)n.push(p[y]+a)}if(n.length%3!=0)return null;for(let u=0;u<n.length;u+=3){const d=e[n[u+0]],p=e[n[u+1]],y=e[n[u+2]];(d.x-p.x)*(y.y-p.y)-(y.x-p.x)*(d.y-p.y)>0&&([n[u+1],n[u+2]]=[n[u+2],n[u+1]])}return{vertices:e,indices:n}}function cM(t){const e=function(b,T){const E=[],I=WebGL2RenderingContext;if(b.json.textures)for(const C of b.json.textures){const D={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};C.sampler!==void 0&&Object.assign(D,b.json.samplers[C.sampler]),E.push({image:T[C.source],sampler:D,uploaded:!1})}return E}(t,t.images),n=function(b,T){const E=[];for(const I of b.json.meshes){const C=[];for(const D of I.primitives)C.push(ID(D,b,T));E.push(C)}return E}(t,e),{scenes:a,scene:u,nodes:d}=t.json,p=a?a[u||0].nodes:d,y=[];for(const b of p)y.push(lM(d[b],t,n));return function(b,T,E){const I={},C=new Set;for(let D=0;D<b.length;D++){const R=E[T[D]];if(!R.extras)continue;const B=R.extras["mapbox:footprint:version"],V=R.extras["mapbox:footprint:id"];(B||V)&&C.add(D),B==="1.0.0"&&V&&(I[V]=D)}for(let D=0;D<b.length;D++){if(C.has(D))continue;const R=b[D],B=E[T[D]];if(!B.extras)continue;let V=null;R.id in I&&(V=PD(b[I[R.id]].meshes)),V||(V=CD(B)),V&&(R.footprint=kD(V))}if(C.size>0){const D=Array.from(C.values()).sort((R,B)=>R-B);for(let R=D.length-1;R>=0;R--)b.splice(D[R],1)}}(y,p,t.json.nodes),y}function DD(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,n=t.aabb.min[0]-1,a=t.aabb.min[1]-1,u=mc/(t.aabb.max[0]-n+2),d=mc/(t.aabb.max[1]-a+2);for(let p=0;p<e.length;p+=3){const y=e[p+2],b=(e[p+0]-n)*u|0,T=(e[p+1]-a)*d|0;y>t.heightmap[T*mc+b]&&(t.heightmap[T*mc+b]=y)}}function zD(t,e){const n={};n.indexArray=new tn,n.indexArray.reserve(4*t.length),n.vertexArray=new nc,n.vertexArray.reserve(10*t.length),n.colorArray=new Xi,n.vertexArray.reserve(10*t.length);let a=0;for(const p of t){const y=Math.min(10,Math.max(4,1.3*p.height))*e,b=[-p.normal[1],p.normal[0],0],T=Math.min(.29,.1*p.width/p.depth),E=p.width-2*p.depth*e*(T+.01),I=s.v.scaleAndAdd([],p.pos,b,E/2),C=s.v.scaleAndAdd([],p.pos,b,-E/2),D=[I[0],I[1],I[2]+p.height],R=[C[0],C[1],C[2]+p.height],B=s.v.scaleAndAdd([],p.normal,b,T);s.v.scale(B,B,y);const V=s.v.scaleAndAdd([],p.normal,b,-T);s.v.scale(V,V,y),s.v.add(B,I,B),s.v.add(V,C,V),I[2]+=.1,C[2]+=.1,n.vertexArray.emplaceBack(B[0],B[1],B[2]),n.vertexArray.emplaceBack(V[0],V[1],V[2]),n.vertexArray.emplaceBack(I[0],I[1],I[2]),n.vertexArray.emplaceBack(C[0],C[1],C[2]),n.vertexArray.emplaceBack(D[0],D[1],D[2]),n.vertexArray.emplaceBack(R[0],R[1],R[2]),n.vertexArray.emplaceBack(I[0],I[1],I[2]),n.vertexArray.emplaceBack(C[0],C[1],C[2]),n.vertexArray.emplaceBack(B[0],B[1],B[2]),n.vertexArray.emplaceBack(V[0],V[1],V[2]);const G=E/y/2;n.colorArray.emplaceBack(-G-T,-1,G,.8),n.colorArray.emplaceBack(G+T,-1,G,.8),n.colorArray.emplaceBack(-G,0,G,1.3),n.colorArray.emplaceBack(G,0,G,1.3),n.colorArray.emplaceBack(G+T,-.8,G,.7),n.colorArray.emplaceBack(G+T,-.8,G,.7),n.colorArray.emplaceBack(0,0,G,1.3),n.colorArray.emplaceBack(0,0,G,1.3),n.colorArray.emplaceBack(G+T,-1.2,G,.8),n.colorArray.emplaceBack(G+T,-1.2,G,.8),n.indexArray.emplaceBack(6+a,4+a,8+a),n.indexArray.emplaceBack(7+a,9+a,5+a),n.indexArray.emplaceBack(0+a,1+a,2+a),n.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}const u={defined:!0,emissiveFactor:[0,0,0]},d={};return d.baseColorFactor=_n.white,u.pbrMetallicRoughness=d,n.material=u,n.aabb=new Hn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}Bt(aM,"TriangleGridIndex");const uM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class U0{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,a]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=a>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const d=uM[15&a];if(!d)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new U0(y,p,d,e)}constructor(e,n=64,a=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=uM.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-y%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${a}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+y+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=n,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return G0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:p,nodeSize:y}=this,b=[0,d.length-1,0],T=[];for(;b.length;){const E=b.pop()||0,I=b.pop()||0,C=b.pop()||0;if(I-C<=y){for(let V=C;V<=I;V++){const G=p[2*V],$=p[2*V+1];G>=e&&G<=a&&$>=n&&$<=u&&T.push(d[V])}continue}const D=C+I>>1,R=p[2*D],B=p[2*D+1];R>=e&&R<=a&&B>=n&&B<=u&&T.push(d[D]),(E===0?e<=R:n<=B)&&(b.push(C),b.push(D-1),b.push(1-E)),(E===0?a>=R:u>=B)&&(b.push(D+1),b.push(I),b.push(1-E))}return T}within(e,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:d,nodeSize:p}=this,y=[0,u.length-1,0],b=[],T=a*a;for(;y.length;){const E=y.pop()||0,I=y.pop()||0,C=y.pop()||0;if(I-C<=p){for(let V=C;V<=I;V++)dM(d[2*V],d[2*V+1],e,n)<=T&&b.push(u[V]);continue}const D=C+I>>1,R=d[2*D],B=d[2*D+1];dM(R,B,e,n)<=T&&b.push(u[D]),(E===0?e-a<=R:n-a<=B)&&(y.push(C),y.push(D-1),y.push(1-E)),(E===0?e+a>=R:n+a>=B)&&(y.push(D+1),y.push(I),y.push(1-E))}return b}}function G0(t,e,n,a,u,d){if(u-a<=n)return;const p=a+u>>1;hM(t,e,p,a,u,d),G0(t,e,n,a,p-1,1-d),G0(t,e,n,p+1,u,1-d)}function hM(t,e,n,a,u,d){for(;u>a;){if(u-a>600){const T=u-a+1,E=n-a+1,I=Math.log(T),C=.5*Math.exp(2*I/3),D=.5*Math.sqrt(I*C*(T-C)/T)*(E-T/2<0?-1:1);hM(t,e,n,Math.max(a,Math.floor(n-E*C/T+D)),Math.min(u,Math.floor(n+(T-E)*C/T+D)),d)}const p=e[2*n+d];let y=a,b=u;for(Xd(t,e,a,n),e[2*u+d]>p&&Xd(t,e,a,u);y<b;){for(Xd(t,e,y,b),y++,b--;e[2*y+d]<p;)y++;for(;e[2*b+d]>p;)b--}e[2*a+d]===p?Xd(t,e,a,b):(b++,Xd(t,e,b,u)),b<=n&&(a=b+1),n<=b&&(u=b-1)}}function Xd(t,e,n,a){H0(t,n,a),H0(e,2*n,2*a),H0(e,2*n+1,2*a+1)}function H0(t,e,n){const a=t[e];t[e]=t[n],t[n]=a}function dM(t,e,n,a){const u=t-n,d=e-a;return u*u+d*d}s.$=45,s.A=Fn,s.B=function(t){const e=s.m.identity(new Float64Array(16));s.m.multiply(e,t.pixelMatrix,t.globeMatrix);const n=[0,Hs,0],a=[0,Ws,0];return s.v.transformMat4(n,n,e),s.v.transformMat4(a,a,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!Uy(t,new Yi(t.center.lat,90)),a[0]>0&&a[0]<=t.width&&a[1]>0&&a[1]<=t.height&&!Uy(t,new Yi(t.center.lat,-90))]},s.C=_n,s.D=al,s.E=jo,s.F=Ry,s.G=Ib,s.H=Uo,s.I=fc,s.J=xt,s.K=function(t,e){const{scale:n}=t.tileTransform,a=n*xt/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return s.h.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},s.L=Yi,s.M=Er,s.N=Nm,s.O=_r,s.P=Se,s.Q=sT,s.R=zy,s.S=function(t){const e=sT(t,!0);return s.h.invert([],[e[0],e[1],e[4],e[5]])},s.T=Ly,s.U=Mb,s.V=function(t){const{x:e,y:n}=t.point,{lng:a,lat:u}=t._center;return Rb(e,n,t.worldSize,a,u)},s.W=zs,s.X=si,s.Y=Tt,s.Z=Oy,s._=function(t){const e=Math.round((t+45+360)%360/90)%4;return Zt[e]},s.a=Zs,s.a$=Yp,s.a0=Hy,s.a1=function(t,e){return rs(Qe(t,{type:"json"}),e)},s.a2=zi,s.a3=Je,s.a4=Cr,s.a5=Ds,s.a6=Bs,s.a7=ta,s.a8=vs,s.a9=Ia,s.aA=hc,s.aB=jb,s.aC=Ps,s.aD=QT,s.aE=kt,s.aF=$T,s.aG=function(t){Yt++,Yt>Fi&&(t.getActor().send("enforceCacheSizeLimit",zt),Yt=0)},s.aH=Ln,s.aI=tp,s.aJ=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},s.aK=ZT,s.aL=function(t,e){const n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let a=0;a<t.length;a++){const u=document.createElement("source");xs(t[a])||(n.crossOrigin="Anonymous"),u.src=t[a],n.appendChild(u)}return{cancel:()=>{}}},s.aM=Ut,s.aN=Om,s.aO=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>oM(e,0,t))},s.aP=cM,s.aQ=class{constructor(t,e,n,a){this.id=t,this.position=e!=null?new Yi(e[0],e[1]):new Yi(0,0),this.orientation=n??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new Hn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(s.m.multiply(t.matrix,e,t.matrix),t.meshes)for(const n of t.meshes){const a=Hn.applyTransform(n.aabb,t.matrix);this.aabb.encapsulate(a)}if(t.children)for(const n of t.children)this._applyTransformations(n,t.matrix)}computeBoundsAndApplyParent(){const t=s.m.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}_positionModelOnTerrain(t,e){const n=t.elevation;if(!n)return 0;const a=Hn.projectAabbCorners(this.aabb,this.matrix),u=qr(1,this.position.lat)*t.worldSize,d=function(V,G){const $=[0,0,1],te=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const se of te){const le=V[se.corners[0]],he=V[se.corners[1]],ye=V[se.corners[2]],we=[he[0]-le[0],he[1]-le[1],G*(he[2]-le[2])],Ie=s.v.cross(we,we,[ye[0]-le[0],ye[1]-le[1],G*(ye[2]-le[2])]);s.v.normalize(Ie,Ie),se.dotProductWithUp=s.v.dot(Ie,$)}return te.sort((se,le)=>se.dotProductWithUp-le.dotProductWithUp),te[0].corners}(a,u),p=a[d[0]],y=a[d[1]],b=a[d[2]],T=a[d[3]],E=n.getAtPointOrZero(new Er(p[0]/t.worldSize,p[1]/t.worldSize),0),I=n.getAtPointOrZero(new Er(y[0]/t.worldSize,y[1]/t.worldSize),0),C=n.getAtPointOrZero(new Er(b[0]/t.worldSize,b[1]/t.worldSize),0),D=n.getAtPointOrZero(new Er(T[0]/t.worldSize,T[1]/t.worldSize),0),R=(E+D)/2,B=(I+C)/2;return R>B?I<C?Vm(e,y,T,p,I,D,E,u):Vm(e,b,p,T,C,E,D,u):E<D?Vm(e,p,y,b,E,I,C,u):Vm(e,T,b,y,D,C,I,u),Math.max(R,B)}computeModelMatrix(t,e,n,a,u,d,p=!1){const y=t.transform,b=y.zoom,T=y.project(this.position),E=uc(this.position.lat,b),I=1/E;s.m.identity(this.matrix),s.m.translate(this.matrix,this.matrix,[T.x+a[0]*I,T.y+a[1]*I,a[2]]);let C=1,D=1;const R=y.worldSize;if(p){if(y.projection.name==="mercator"){let $=0;y.elevation&&($=y.elevation.getAtPointOrZero(new Er(T.x/R,T.y/R),0));const te=s.e.transformMat4([],[T.x,T.y,$,1],y.projMatrix)[3]/y.cameraToCenterDistance;C=te,D=te*uc(y.center.lat,b)}else if(y.projection.name==="globe"){const $=hT(this.matrix,y),te=s.m.multiply([],y.projMatrix,$),se=[0,0,0,1];s.e.transformMat4(se,se,te);const le=se[3]/y.cameraToCenterDistance,he=Ma(b),ye=y.projection.pixelsPerMeter(this.position.lat,R)*uc(this.position.lat,b),we=y.projection.pixelsPerMeter(y.center.lat,R)*uc(y.center.lat,b);C=le/Mi(ye,Nb(y.center.lat),he),D=le*E/ye,C*=we,D*=we}}else C=I;s.m.scale(this.matrix,this.matrix,[C,C,D]);const B=[...this.matrix],V=this.orientation,G=[];if(uT(G,[V[0]+e[0],V[1]+e[1],V[2]+e[2]],n),s.m.multiply(this.matrix,B,G),u&&y.elevation){let $=0;const te=[];if(d&&y.elevation){$=this._positionModelOnTerrain(y,te);const se=s.m.fromQuat([],te),le=s.m.multiply([],se,G);s.m.multiply(this.matrix,B,le)}else $=y.elevation.getAtPointOrZero(new Er(T.x/R,T.y/R),0);$!==0&&(this.matrix[14]+=$)}}upload(t){if(!this.uploaded){for(const e of this.nodes)I0(e,t);for(const e of this.nodes)Um(e);this.uploaded=!0}}destroy(){for(const t of this.nodes)Gm(t)}},s.aR=at,s.aS=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.aT=Nw,s.aU=Gb,s.aV=Tr,s.aW=Ww,s.aX=_0,s.aY=d0,s.aZ=U0,s.a_=_d,s.aa=f0,s.ab=p0,s.ac=$e,s.ad=ue,s.ae=De,s.af=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return ce(t.expression.evaluate(e))}interpolate(t,e,n){return{x:Mi(t.x,e.x,n),y:Mi(t.y,e.y,n),z:Mi(t.z,e.z,n),azimuthal:Mi(t.azimuthal,e.azimuthal,n),polar:Mi(t.polar,e.polar,n)}}},s.ag=ze,s.ah=t=>Es(cd(t)),s.ai=Wp,s.aj=fd,s.ak=Qe,s.al=_e,s.am=Ql,s.an=yi,s.ao=Ma,s.ap=t=>Es(dd(t)),s.aq=ou,s.ar=qe,s.as=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,a]){const u=ce([1,n,a]);return{x:u.x,y:u.y,z:u.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:Mi(t.x,e.x,n),y:Mi(t.y,e.y,n),z:Mi(t.z,e.z,n)}}},s.at=function(t,e,n=0,a=!0){const u=new Se(n,n),d=t.sub(u),p=e.add(u),y=[d,new Se(p.x,d.y),p,new Se(d.x,p.y)];return a&&y.push(d.clone()),y},s.au=function(t,e){const n=[];for(let a=0;a<t.length;a++){const u=wi(a-1,-1,t.length-1),d=wi(a+1,-1,t.length-1),p=t[a],y=t[d],b=t[u].sub(p).unit(),T=y.sub(p).unit(),E=T.angleWithSep(b.x,b.y),I=b.add(T).unit().mult(-1*e/Math.sin(E/2));n.push(p.add(I))}return n},s.av=Yw,s.aw=Zb,s.ax=function(t,e,n=0){return s.v.fromValues(((e.x-n)*t.scale-t.x)*xt,(e.y*t.scale-t.y)*xt,Fb(e.z,e.y))},s.ay=cT,s.az=function(t){let e=1/0,n=1/0,a=-1/0,u=-1/0;for(const d of t)e=Math.min(e,d.x),n=Math.min(n,d.y),a=Math.max(a,d.x),u=Math.max(u,d.y);return{min:new Se(e,n),max:new Se(a,u)}},s.b=qr,s.b$=0,s.b0=rc,s.b1=a1,s.b2=Wr,s.b3=function(t,e,n){const a=Math.sqrt(t*t+e*e+n*n),u=a>0?Math.acos(n/a)*_t:0;let d=t!==0||e!==0?Math.atan2(-e,-t)*_t+90:0;return d<0&&(d+=360),[a,d,u]},s.b4=Nu,s.b5=ho,s.b6=M0,s.b7=my,s.b8=class extends _a{constructor(t){super(t),this.current=lC}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let a=0;a<9;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},s.b9=o1,s.bA=function(t,e){const n=[0,0,0],a=Td(Vo(e.canonical));return s.v.transformMat4(n,n,a),s.v.transformMat4(n,n,t),n},s.bB=t=>({u_camera_to_center_distance:new Wr(t),u_extrude_scale:new gy(t),u_device_pixel_ratio:new Wr(t),u_matrix:new _d(t),u_inv_rot_matrix:new _d(t),u_merc_center:new rc(t),u_tile_id:new my(t),u_zoom_transition:new Wr(t),u_up_dir:new my(t),u_emissive_strength:new Wr(t)}),s.bC=t=>({u_matrix:new _d(t),u_pixels_to_tile_units:new gy(t),u_device_pixel_ratio:new Wr(t),u_units_to_pixels:new rc(t),u_dash_image:new Yp(t),u_gradient_image:new Yp(t),u_image_height:new Wr(t),u_texsize:new rc(t),u_tile_units_to_pixels:new Wr(t),u_alpha_discard_threshold:new Wr(t),u_trim_offset:new rc(t),u_emissive_strength:new Wr(t)}),s.bD=t=>({u_matrix:new _d(t),u_texsize:new rc(t),u_pixels_to_tile_units:new gy(t),u_device_pixel_ratio:new Wr(t),u_image:new Yp(t),u_units_to_pixels:new rc(t),u_tile_units_to_pixels:new Wr(t),u_alpha_discard_threshold:new Wr(t)}),s.bE=ro,s.bF=t3,s.bG=i3,s.bH=Kb,s.bI=(t,e,n,a,u,d)=>{const p=t.transform,y=p.projection.name==="globe";let b;if(d.paint.get("circle-pitch-alignment")==="map")if(y){const E=Lb(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;b=Float32Array.from([E,0,0,E])}else b=p.calculatePixelsToTileUnitsMatrix(n);else b=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);const T={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(p.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Cr.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:JC,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(y){T.u_inv_rot_matrix=a,T.u_merc_center=u,T.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],T.u_zoom_transition=Ma(p.zoom);const E=u[0]*xt,I=u[1]*xt;T.u_up_dir=p.projection.upVector(new lc(0,0,0),E,I)}return T},s.bJ=UT,s.bK=(t,e,n,a,u)=>{const d=t.transform;return{u_matrix:jT(t,e,n,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:d.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_image:0,u_tile_units_to_pixels:VT(e,d),u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}},s.bL=(t,e,n,a,u,d,p)=>{const y=t.transform,b=y.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:jT(t,e,n,a),u_pixels_to_tile_units:b,u_device_pixel_ratio:d,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:GT(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:VT(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:p,u_emissive_strength:n.paint.get("line-emissive-strength")}},s.bM=Hi,s.bN=am,s.bO=RT,s.bP=RC,s.bQ=Ud,s.bR=xl,s.bS=450,s.bT=7,s.bU=Cb,s.bV=Vy,s.bW=Ht,s.bX=nc,s.bY=ic,s.bZ=1,s.b_=771,s.ba=ni,s.bb=function(t,e,n){const a=Ma(n.zoom),u=t.style.map._antialias,d=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return a===0&&!u&&!d},s.bc=function(t){const e=t.pixelsPerMeter,n=e/qr(1,t.center.lat),a=s.m.identity(new Float64Array(16));return s.m.translate(a,a,[t.point.x,t.point.y,0]),s.m.scale(a,a,[n,n,e]),Float32Array.from(a)},s.bd=bs,s.be=tm,s.bf=function(t){const e=Fn-5;t=ft(t,-e,e)/e*90;const n=Math.pow(Math.abs(Math.sin(Ze(t))),3);return Math.round(n*(By.length-1))},s.bg=function(t,e,n,a){const u=e.getNorth(),d=e.getSouth(),p=e.getWest(),y=e.getEast(),b=1<<t.z,T=y-p,E=u-d,I=T/Mu,C=-E/By[n],D=[0,I,0,C,0,0,u,p,0];if(t.z>0){const R=180/a;s.bx.multiply(D,D,[R/T+1,0,0,0,R/E+1,0,-.5*R/I,.5*R/C,1])}return D[2]=b,D[5]=t.x,D[8]=t.y,D},s.bh=Td,s.bi=Vo,s.bj=function(t,e,n){const a=s.m.identity(new Float64Array(16)),u=(e/(1<<t)-.5)*Math.PI*2;return s.m.rotateY(a,n.globeMatrix,u),Float32Array.from(a)},s.bk=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const n=e.getSource().maxzoom,a=1<<n,u=Math.floor(t.x),d=Math.floor((t.x-u)*a),p=Math.floor(t.y*a),y=this.findDEMTileFor(new _r(n,u,n,d,p));return!(!y||!y.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||t.y<0||t.y>1)return e;const u=a.getSource().maxzoom,d=1<<u,p=Math.floor(t.x),y=t.x-p,b=new _r(u,p,u,Math.floor(y*d),Math.floor(t.y*d)),T=this.findDEMTileFor(b);if(!T||!T.dem)return e;const E=T.dem,I=1<<T.tileID.canonical.z,C=(y*I-T.tileID.canonical.x)*E.dim,D=(t.y*I-T.tileID.canonical.y)*E.dim,R=Math.floor(C),B=Math.floor(D);return(n?this.exaggeration():1)*Mi(Mi(E.get(R,B),E.get(R,B+1),D-B),Mi(E.get(R+1,B),E.get(R+1,B+1),D-B),C-R)}getAtTileOffset(t,e,n){const a=1<<t.canonical.z;return this.getAtPointOrZero(new Er(t.wrap+(t.canonical.x+e/xt)/a,(t.canonical.y+n/xt)/a))}getAtTileOffsetFunc(t,e,n,a){return u=>{const d=this.getAtTileOffset(t,u.x,u.y),p=a.upVector(t.canonical,u.x,u.y),y=a.upVectorScale(t.canonical,e,n).metersToTile;return s.v.scale(p,p,d*y),p}}getForTilePoints(t,e,n,a){if(this.isUsingMockSource())return!1;const u=Du.create(this,t,a);return!!u&&(e.forEach(d=>{d[2]=this.exaggeration()*u.getElevationAt(d[0],d[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const n=e.dem.tree,a=e.tileID,u=1<<t.canonical.z-a.canonical.z;let d=t.canonical.x/u-a.canonical.x,p=t.canonical.y/u-a.canonical.y,y=0;for(let b=0;b<t.canonical.z-a.canonical.z&&!n.leaves[y];b++){d*=2,p*=2;const T=2*Math.floor(p)+Math.floor(d);y=n.childOffsets[y]+T,d%=1,p%=1}return{min:this.exaggeration()*n.minimums[y],max:this.exaggeration()*n.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,n=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const u of t){const d=this.getMinMaxForTile(u.tileID);d&&(n=Math.min(n,d.min),a=Math.max(a,d.max),e=!0)}return e?{min:n,max:a}:null}},s.bl=xd,s.bm=Tn,s.bn=em,s.bo=hi,s.bp=tn,s.bq=pc,s.br=Hd,s.bs=L0,s.bt=w0,s.bu=iw,s.bv=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},s.bw=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},s.by=Lb,s.bz=256,s.c=ft,s.c$=S,s.c0=ly,s.c1=function(t,e,n,a,u){return ft((t-e)/(n-e)*(u-a)+a,a,u)},s.c2=ql,s.c3=Hn,s.c4=uc,s.c5=hT,s.c6=[1,1,1],s.c7=Du,s.c8=jm,s.c9=Rr,s.cA=er,s.cB=t=>Es(hd(t)),s.cC=ne,s.cD=rs,s.cE=ui,s.cF=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.cG=Di,s.cH=Vb,s.cI=cc,s.cJ=function([t,e,n]){const a=Math.hypot(t,e,n),u=Math.atan2(t,n),d=.5*Math.PI-Math.acos(-e/a);return new Yi(Tt(u),Tt(d))},s.cK=ds,s.cL=Md,s.cM=z,s.cN=Uy,s.cO=Ob,s.cP=function(t){const e=[0,0,0],n=s.m.identity(new Float64Array(16));return s.m.multiply(n,t.pixelMatrix,t.globeMatrix),s.v.transformMat4(e,e,n),new Se(e[0],e[1])},s.cQ=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!function(n){if(tt==null){const a=n.navigator?n.navigator.userAgent:null;tt=!!n.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return tt}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.cR=bi,s.cS=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ve,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!ht(t))return t;const n=mt(t);return n.params.push(`sdk=js-${S}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!ht(t))return t;const n=mt(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeModelURL(t,e){if(!ht(t))return t;const n=mt(t);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,a){if(!ht(t))return t;const u=mt(t);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),n&&u.params.push(`language=${n}`),a&&u.params.push(`worldview=${a}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,a){const u=mt(t);return ht(t)?(u.path=`/styles/v1${u.path}/sprite${e}${n}`,this._makeAPIURL(u,this._customAccessToken||a)):(u.path+=`${e}${n}`,pi(u))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!ht(t))return t;const a=mt(t);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&a.authority!=="raster"&&n===512?"@2x":""}${F.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${z.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${z.TILE_URL_VERSION}${a.path}`);const u=this._customAccessToken||function(d){for(const p of d){const y=p.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(a.params)||z.ACCESS_TOKEN;return z.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,u)}canonicalizeTileURL(t,e){const n=mt(t);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let a="mapbox://";n.path.match(/^\/raster\/v1\//)?a+=`raster/${n.path.replace(`/${z.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${n.path.replace(`/${z.TILE_URL_VERSION}/`,"")}`;let u=n.params;return e&&(u=u.filter(d=>!d.match(/^access_token=/))),u.length&&(a+=`?${u.join("&")}`),a}canonicalizeTileset(t,e){const n=!!e&&ht(e),a=[];for(const u of t.tiles||[])gt(u)?a.push(this.canonicalizeTileURL(u,n)):a.push(u);return a}_makeAPIURL(t,e){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=mt(z.API_URL);if(t.protocol=a.protocol,t.authority=a.authority,t.protocol==="http"){const u=t.params.indexOf("secure");u>=0&&t.params.splice(u,1)}if(a.path!=="/"&&(t.path=`${a.path}${t.path}`),!z.REQUIRE_ACCESS_TOKEN)return pi(t);if(e=e||z.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(u=>u.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),pi(t)}},s.cT=function(t,e){e?Ur.add(t):Ur.delete(t)},s.cU=F,s.cV=ss,s.cW=xr,s.cX=ut,s.cY=yr,s.cZ=function(t){Ur.delete(t)},s.c_=ai,s.ca=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){const e=bT(new Se(0,0),new Se(xt,xt),t),n=[];for(const a of this._activeRegions){if(a.hiddenByOverlap||!vT(e,a))continue;const u=Q3(a.min,a.max,t);n.push({min:u.min,max:u.max,sourceId:this._sourceIds[a.priority],footprint:a.footprint,footprintTileId:a.tileId})}return n}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const n=[];for(const a of e.cache.getVisibleCoordinates()){const u=e.cache.getTile(a).buckets[e.layer];if(u)for(const d of u.getNodesInfo()){const p=d.node;p.footprint&&n.push({footprint:p.footprint,id:a.toUnwrapped()})}}return n}})))}_addSource(t){const e=t.getFootprints();if(e.length!==0){for(const n of e){if(!n.footprint)continue;const a=bT(n.footprint.min,n.footprint.max,n.id);this._activeRegions.push({min:a.min,max:a.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:n.id,footprint:n.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||Hm(e.min,n.min)||Hm(e.max,n.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,n=0;for(;!t&&e!==this._activeRegions.length;){const a=this._activeRegions[e],u=this._prevRegions[n];t=a.priority!==u.priority||!xT(a,u),++e,++n}}if(t){++this._updateTime;const e=n=>{const a=this._activeRegions;if(n>=a.length)return n;const u=a[n].priority;for(;n<a.length&&a[n].priority===u;)++n;return n};if(this._sourceIds.length>1){let n=0,a=e(n);for(;n!==a;){let u=n;const d=n;for(;u!==a;){const p=this._activeRegions[u];p.hiddenByOverlap=!1;for(let y=0;y<d;y++){const b=this._activeRegions[y];if(!b.hiddenByOverlap&&vT(p,b)&&(p.hiddenByOverlap=TT(p.footprint,p.tileId,b.footprint,b.tileId),p.hiddenByOverlap))break}++u}n=a,a=e(n)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},s.cb=Qi,s.cc=Fm,s.cd=pd,s.ce=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){const n=new hi,a=new tn,u=[],d=t+1+2,p=e[0]+1,y=e[0]+1+(1+e.length),b=(T,E,I)=>{let C=T===d-1?T-2:T===0?T:T-1;return C+=I?24575:0,[C,E]};for(let T=0;T<d;++T)n.emplaceBack(...b(T,0,!0));for(let T=0;T<p;++T)for(let E=0;E<d;++E)n.emplaceBack(...b(E,T,(E===0||E===d-1)&&!0));for(let T=0;T<e.length;++T){const E=e[T];for(let I=0;I<d;++I)n.emplaceBack(...b(I,E,!0))}for(let T=0;T<e.length;++T){const E=a.length,I=e[T]+1+2,C=new tn;for(let B=0;B<I-1;B++){const V=B===I-2,G=V?d*(y-e.length+T-B):d;for(let $=0;$<d-1;$++){const te=B*d+$;B===0||V||$===0||$===d-2?(C.emplaceBack(te+1,te,te+G),C.emplaceBack(te+G,te+G+1,te+1)):(a.emplaceBack(te+1,te,te+G),a.emplaceBack(te+G,te+G+1,te+1))}}const D=Tn.simpleSegment(0,E,n.length,a.length-E);for(let B=0;B<C.uint16.length;B+=3)a.emplaceBack(C.uint16[B],C.uint16[B+1],C.uint16[B+2]);const R=Tn.simpleSegment(0,E,n.length,a.length-E);u.push({withoutSkirts:D,withSkirts:R})}return{vertices:n,indices:a,segments:u}}_createGrid(t){const e=this._fillGridMeshWithLods(Mu,By);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,xd.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new tn;for(let p=0;p<=Mu;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const n=new ic,a=new ic,u=new ic,d=new ic;this._poleSegments=[];for(let p=0,y=0;p<Oy;p++){const b=360/(1<<p);n.emplaceBack(0,-Ps,0,.5,0),a.emplaceBack(0,-Ps,0,.5,1),u.emplaceBack(0,-Ps,0,.5,.5),d.emplaceBack(0,-Ps,0,.5,.5);for(let T=0;T<=Mu;T++){let E=T/Mu,I=0;const C=Mi(0,b,E),[D,R,B]=Su(NC,VC,C,Ps);n.emplaceBack(D,R,B,E,I),a.emplaceBack(D,R,B,E,1-I);const V=Ze(C);E=.5+.5*Math.sin(V),I=.5+.5*Math.cos(V),u.emplaceBack(D,R,B,E,I),d.emplaceBack(D,R,B,E,1-I)}this._poleSegments.push(Tn.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,$p,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(a,$p,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(u,$p,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(d,$p,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},s.cf=function(t){return Ur.has(t)},s.cg=nm,s.ch=ce,s.ci=function(t){return t({pluginStatus:X,pluginURL:oe}),ne.on("pluginStateChange",t),t},s.cj=Ru,s.ck=m0,s.cl=zn,s.cm=de,s.cn=ht,s.co=en,s.cp=function(t,e,n){return t.type==="custom"?new mD(t,e):new xD[t.type](t,e,n)},s.cq=function(t){const e=t.indexOf(Ft);return e>=0?t.slice(0,e):t},s.cr=t=>Es(Gp(t)),s.cs=t=>Es(jp(t)),s.ct=t=>Es(ud(t)),s.cu=function(t){return t.indexOf(Ft)>=0},s.cv=function(t){const e=t.indexOf(Ft);return e>=0?t.slice(e+1):""},s.cw=Kl,s.cx=function(t){const e=[],n=t.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},s.cy=t=>Es(Vp(t)),s.cz=t=>Es(ld(t)),s.d=Ze,s.d0=function(t,e){zt=t,Fi=e},s.d1=function(t,e,n=!1){if(X===q||X===Y||X===J)throw new Error("setRTLTextPlugin cannot be called multiple times.");oe=Cr.resolveURL(t),X=q,K=e,fe(),n||me()},s.d2=ae,s.d3=function(){L0().acquire(z0)},s.d4=function(){const t=Zd;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(z0),Zd=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.d5=qd,s.d6=function(t){const e=un();if(!e)return;const n=e.delete(Ct);t&&n.catch(t).then(()=>t())},s.d7=Wd,s.d8=eM,s.d9=function(t){R0=Cr.resolveURL(t),O0||(O0=new Hd(L0(),new Bs)),O0.broadcast("setDracoUrl",R0)},s.da=nt,s.db=vm,s.dc=pe,s.dd=mm,s.de=pm,s.df=ot,s.dg=hw,s.dh=class extends Bs{constructor(t,e,n,a,u,d){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=u||$T,this.loading={},this.loaded={},this.deduped=new QT(t.scheduler),this.isSpriteLoaded=a,this.scheduler=t.scheduler,this.brightness=d}loadTile(t,e){const n=t.uid,a=t&&t.request,u=a&&a.collectResourceTiming,d=this.loading[n]=new wD(t);d.abort=this.loadVectorData(t,(p,y)=>{const b=!this.loading[n];if(delete this.loading[n],b||p||!y)return d.status="done",b||(this.loaded[n]=d),e(p);const T=y.rawData,E={};y.expires&&(E.expires=y.expires),y.cacheControl&&(E.cacheControl=y.cacheControl),d.vectorTile=y.vectorTile||new o0(new xm(T));const I=()=>{d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,(C,D)=>{if(C||!D)return e(C);const R={};if(u){const B=gh(a);B.length>0&&(R.resourceTiming=JSON.parse(JSON.stringify(B)))}e(null,Qe({rawTileData:T.slice(0)},D,E,R))})};this.isSpriteLoaded?I():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(I,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):I()}),this.loaded=this.loaded||{},this.loaded[n]=d})}reloadTile(t,e){const n=this.loaded,a=t.uid,u=this;if(n&&n[a]){const d=n[a];d.showCollisionBoxes=t.showCollisionBoxes,d.projection=t.projection,d.brightness=t.brightness,d.tileTransform=pl(t.tileID.canonical,t.projection),d.extraShadowCaster=t.extraShadowCaster;const p=(y,b)=>{const T=d.reloadCallback;T&&(delete d.reloadCallback,d.parse(d.vectorTile,u.layerIndex,this.availableImages,u.actor,T)),e(y,b)};d.status==="parsing"?d.reloadCallback=p:d.status==="done"&&(d.vectorTile?d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,p):p())}else e(null,void 0)}abortTile(t,e){const n=t.uid,a=this.loading[n];a&&(a.abort&&a.abort(),delete this.loading[n]),e()}removeTile(t,e){const n=this.loaded,a=t.uid;n&&n[a]&&delete n[a],e()}},s.di=gh,s.dj=sr,s.dk=l0,s.dl=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==iM){const n=new Uint32Array(t,0,7),[,,a,u,d,p]=n;e=n.byteLength+u+d+p+d,(a!==t.byteLength||e>=t.byteLength)&&si("Invalid b3dm header information.")}return oM(t,e)},s.dm=function(t,e){const n=cM(t);for(const a of n){for(const u of a.meshes)DD(u);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(zD(a.lights,e)))}return n},s.dn=yT,s.dp=XT,s.dq=xe,s.dr=function(t){pn(),Ti&&Ti.then(e=>{e.keys().then(n=>{for(let a=0;a<n.length-t;a++)e.delete(n[a])})})},s.f=function(t,e){const{x:n,y:a}=t.point,u=Rb(n,a,t.worldSize/t._pixelsPerMercatorPixel,0,0);return s.m.multiply(u,u,Vy(Vo(e)))},s.g=Dt,s.i=zu,s.j=bm,s.k=zm,s.l=wr,s.n=Mi,s.o=eT,s.p=function(t,e){const n={};for(let a=0;a<e.length;a++){const u=e[a];u in t&&(n[u]=t[u])}return n},s.r=oT,s.s=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},s.t=lc,s.u=function(t,e,n,a,u){const d=5*e+2;t.float32[d+0]=n,t.float32[d+1]=a,t.float32[d+2]=u},s.w=wi,s.x=Db,s.y=function(t,e,n,a,u,d,p,y,b){if(b.name==="globe")return Db(t,e,new lc(n,a,u),!1);const T=pl({z:n,x:a,y:u},b);return new Hn([(d+T.x/T.scale)*e,e*(T.y/T.scale),p],[(d+T.x2/T.scale)*e,e*(T.y2/T.scale),y])},s.z=function(t,e,n){let a=0;for(let u=0;u<2;++u){const d=n?n[u]:0;t[u]>d&&(a+=(t[u]-d)*(t[u]-d)),e[u]<d&&(a+=(d-e[u])*(d-e[u]))}return a}}),_(["./shared"],function(s){function S(Re){if(typeof Re=="number"||typeof Re=="boolean"||typeof Re=="string"||Re==null)return JSON.stringify(Re);if(Array.isArray(Re)){let ce="[";for(const Te of Re)ce+=`${S(Te)},`;return`${ce}]`}let ee="{";for(const ce of Object.keys(Re).sort())ee+=`${ce}:${S(Re[ce])},`;return`${ee}}`}function P(Re){let ee="";for(const ce of s.aS)ee+=`/${S(Re[ce])}`;return ee}class z{constructor(ee){this.keyCache={},this._layers={},this._layerConfigs={},ee&&this.replace(ee)}replace(ee,ce){this._layerConfigs={},this._layers={},this.update(ee,[],ce)}update(ee,ce,Te){this._options=Te;for(const tt of ee)this._layerConfigs[tt.id]=tt,(this._layers[tt.id]=s.cp(tt,this.scope,this._options)).compileFilter(),this.keyCache[tt.id]&&delete this.keyCache[tt.id];for(const tt of ce)delete this.keyCache[tt],delete this._layerConfigs[tt],delete this._layers[tt];this.familiesBySource={};const it=function(tt,Et){const Dt={};for(let Vt=0;Vt<tt.length;Vt++){const Ct=Et&&Et[tt[Vt].id]||P(tt[Vt]);Et&&(Et[tt[Vt].id]=Ct);let zt=Dt[Ct];zt||(zt=Dt[Ct]=[]),zt.push(tt[Vt])}const Ke=[];for(const Vt in Dt)Ke.push(Dt[Vt]);return Ke}(s.da(this._layerConfigs),this.keyCache);for(const tt of it){const Et=tt.map(Fi=>this._layers[Fi.id]),Dt=Et[0];if(Dt.visibility==="none")continue;const Ke=Dt.source||"";let Vt=this.familiesBySource[Ke];Vt||(Vt=this.familiesBySource[Ke]={});const Ct=Dt.sourceLayer||"_geojsonTileLayer";let zt=Vt[Ct];zt||(zt=Vt[Ct]=[]),zt.push(Et)}}}class F{loadTile(ee,ce){const{uid:Te,encoding:it,rawImageData:tt,padding:Et}=ee,Dt=ImageBitmap&&tt instanceof ImageBitmap?this.getImageData(tt,Et):tt;ce(null,new s.db(Te,Dt,it,Et<1))}getImageData(ee,ce){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ee.width,ee.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ee.width,this.offscreenCanvas.height=ee.height,this.offscreenCanvasContext.drawImage(ee,0,0,ee.width,ee.height);const Te=this.offscreenCanvasContext.getImageData(-ce,-ce,ee.width+2*ce,ee.height+2*ce);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Te}}function U(Re,ee){if(Re.length!==0){Z(Re[0],ee);for(var ce=1;ce<Re.length;ce++)Z(Re[ce],!ee)}}function Z(Re,ee){for(var ce=0,Te=0,it=0,tt=Re.length,Et=tt-1;it<tt;Et=it++){var Dt=(Re[it][0]-Re[Et][0])*(Re[Et][1]+Re[it][1]),Ke=ce+Dt;Te+=Math.abs(ce)>=Math.abs(Dt)?ce-Ke+Dt:Dt-Ke+ce,ce=Ke}ce+Te>=0!=!!ee&&Re.reverse()}var W=s.dc(function Re(ee,ce){var Te,it=ee&&ee.type;if(it==="FeatureCollection")for(Te=0;Te<ee.features.length;Te++)Re(ee.features[Te],ce);else if(it==="GeometryCollection")for(Te=0;Te<ee.geometries.length;Te++)Re(ee.geometries[Te],ce);else if(it==="Feature")Re(ee.geometry,ce);else if(it==="Polygon")U(ee.coordinates,ce);else if(it==="MultiPolygon")for(Te=0;Te<ee.coordinates.length;Te++)U(ee.coordinates[Te],ce);return ee});const Q=s.dd.prototype.toGeoJSON;var re={exports:{}},ie=s.df,ve=s.de.VectorTileFeature,pe=ke;function ke(Re,ee){this.options=ee||{},this.features=Re,this.length=Re.length}function Me(Re,ee){this.id=typeof Re.id=="number"?Re.id:void 0,this.type=Re.type,this.rawGeometry=Re.type===1?[Re.geometry]:Re.geometry,this.properties=Re.tags,this.extent=ee||4096}ke.prototype.feature=function(Re){return new Me(this.features[Re],this.options.extent)},Me.prototype.loadGeometry=function(){var Re=this.rawGeometry;this.geometry=[];for(var ee=0;ee<Re.length;ee++){for(var ce=Re[ee],Te=[],it=0;it<ce.length;it++)Te.push(new ie(ce[it][0],ce[it][1]));this.geometry.push(Te)}return this.geometry},Me.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Re=this.geometry,ee=1/0,ce=-1/0,Te=1/0,it=-1/0,tt=0;tt<Re.length;tt++)for(var Et=Re[tt],Dt=0;Dt<Et.length;Dt++){var Ke=Et[Dt];ee=Math.min(ee,Ke.x),ce=Math.max(ce,Ke.x),Te=Math.min(Te,Ke.y),it=Math.max(it,Ke.y)}return[ee,Te,ce,it]},Me.prototype.toGeoJSON=ve.prototype.toGeoJSON;var Ye=s.dg,ot=pe;function Mt(Re){var ee=new Ye;return function(ce,Te){for(var it in ce.layers)Te.writeMessage(3,Se,ce.layers[it])}(Re,ee),ee.finish()}function Se(Re,ee){var ce;ee.writeVarintField(15,Re.version||1),ee.writeStringField(1,Re.name||""),ee.writeVarintField(5,Re.extent||4096);var Te={keys:[],values:[],keycache:{},valuecache:{}};for(ce=0;ce<Re.length;ce++)Te.feature=Re.feature(ce),ee.writeMessage(2,yt,Te);var it=Te.keys;for(ce=0;ce<it.length;ce++)ee.writeStringField(3,it[ce]);var tt=Te.values;for(ce=0;ce<tt.length;ce++)ee.writeMessage(4,ni,tt[ce])}function yt(Re,ee){var ce=Re.feature;ce.id!==void 0&&ee.writeVarintField(1,ce.id),ee.writeMessage(2,_t,Re),ee.writeVarintField(3,ce.type),ee.writeMessage(4,Zt,ce)}function _t(Re,ee){var ce=Re.feature,Te=Re.keys,it=Re.values,tt=Re.keycache,Et=Re.valuecache;for(var Dt in ce.properties){var Ke=ce.properties[Dt],Vt=tt[Dt];if(Ke!==null){Vt===void 0&&(Te.push(Dt),tt[Dt]=Vt=Te.length-1),ee.writeVarint(Vt);var Ct=typeof Ke;Ct!=="string"&&Ct!=="boolean"&&Ct!=="number"&&(Ke=JSON.stringify(Ke));var zt=Ct+":"+Ke,Fi=Et[zt];Fi===void 0&&(it.push(Ke),Et[zt]=Fi=it.length-1),ee.writeVarint(Fi)}}}function Ze(Re,ee){return(ee<<3)+(7&Re)}function Tt(Re){return Re<<1^Re>>31}function Zt(Re,ee){for(var ce=Re.loadGeometry(),Te=Re.type,it=0,tt=0,Et=ce.length,Dt=0;Dt<Et;Dt++){var Ke=ce[Dt],Vt=1;Te===1&&(Vt=Ke.length),ee.writeVarint(Ze(1,Vt));for(var Ct=Te===3?Ke.length-1:Ke.length,zt=0;zt<Ct;zt++){zt===1&&Te!==1&&ee.writeVarint(Ze(2,Ct-1));var Fi=Ke[zt].x-it,Ti=Ke[zt].y-tt;ee.writeVarint(Tt(Fi)),ee.writeVarint(Tt(Ti)),it+=Fi,tt+=Ti}Te===3&&ee.writeVarint(Ze(7,1))}}function ni(Re,ee){var ce=typeof Re;ce==="string"?ee.writeStringField(1,Re):ce==="boolean"?ee.writeBooleanField(7,Re):ce==="number"&&(Re%1!=0?ee.writeDoubleField(3,Re):Re<0?ee.writeSVarintField(6,Re):ee.writeVarintField(5,Re))}re.exports=Mt,re.exports.fromVectorTileJs=Mt,re.exports.fromGeojsonVt=function(Re,ee){ee=ee||{};var ce={};for(var Te in Re)ce[Te]=new ot(Re[Te].features,ee),ce[Te].name=Te,ce[Te].version=ee.version,ce[Te].extent=ee.extent;return Mt({layers:ce})},re.exports.GeoJSONWrapper=ot;var ui=s.dc(re.exports);const Di={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Re=>Re},ft=Math.fround||(yi=new Float32Array(1),Re=>(yi[0]=+Re,yi[0]));var yi;const wi=3,ai=5,nt=6;class Qe{constructor(ee){this.options=Object.assign(Object.create(Di),ee),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ee){const{log:ce,minZoom:Te,maxZoom:it}=this.options;ce&&console.time("total time");const tt=`prepare ${ee.length} points`;ce&&console.time(tt),this.points=ee;const Et=[];for(let Ke=0;Ke<ee.length;Ke++){const Vt=ee[Ke];if(!Vt.geometry)continue;const[Ct,zt]=Vt.geometry.coordinates,Fi=ft(rn(Ct)),Ti=ft(Hi(zt));Et.push(Fi,Ti,1/0,Ke,-1,1),this.options.reduce&&Et.push(0)}let Dt=this.trees[it+1]=this._createTree(Et);ce&&console.timeEnd(tt);for(let Ke=it;Ke>=Te;Ke--){const Vt=+Date.now();Dt=this.trees[Ke]=this._createTree(this._cluster(Dt,Ke)),ce&&console.log("z%d: %d clusters in %dms",Ke,Dt.numItems,+Date.now()-Vt)}return ce&&console.timeEnd("total time"),this}getClusters(ee,ce){let Te=((ee[0]+180)%360+360)%360-180;const it=Math.max(-90,Math.min(90,ee[1]));let tt=ee[2]===180?180:((ee[2]+180)%360+360)%360-180;const Et=Math.max(-90,Math.min(90,ee[3]));if(ee[2]-ee[0]>=360)Te=-180,tt=180;else if(Te>tt){const zt=this.getClusters([Te,it,180,Et],ce),Fi=this.getClusters([-180,it,tt,Et],ce);return zt.concat(Fi)}const Dt=this.trees[this._limitZoom(ce)],Ke=Dt.range(rn(Te),Hi(Et),rn(tt),Hi(it)),Vt=Dt.data,Ct=[];for(const zt of Ke){const Fi=this.stride*zt;Ct.push(Vt[Fi+ai]>1?Ii(Vt,Fi,this.clusterProps):this.points[Vt[Fi+wi]])}return Ct}getChildren(ee){const ce=this._getOriginId(ee),Te=this._getOriginZoom(ee),it="No cluster with the specified id.",tt=this.trees[Te];if(!tt)throw new Error(it);const Et=tt.data;if(ce*this.stride>=Et.length)throw new Error(it);const Dt=this.options.radius/(this.options.extent*Math.pow(2,Te-1)),Ke=tt.within(Et[ce*this.stride],Et[ce*this.stride+1],Dt),Vt=[];for(const Ct of Ke){const zt=Ct*this.stride;Et[zt+4]===ee&&Vt.push(Et[zt+ai]>1?Ii(Et,zt,this.clusterProps):this.points[Et[zt+wi]])}if(Vt.length===0)throw new Error(it);return Vt}getLeaves(ee,ce,Te){const it=[];return this._appendLeaves(it,ee,ce=ce||10,Te=Te||0,0),it}getTile(ee,ce,Te){const it=this.trees[this._limitZoom(ee)],tt=Math.pow(2,ee),{extent:Et,radius:Dt}=this.options,Ke=Dt/Et,Vt=(Te-Ke)/tt,Ct=(Te+1+Ke)/tt,zt={features:[]};return this._addTileFeatures(it.range((ce-Ke)/tt,Vt,(ce+1+Ke)/tt,Ct),it.data,ce,Te,tt,zt),ce===0&&this._addTileFeatures(it.range(1-Ke/tt,Vt,1,Ct),it.data,tt,Te,tt,zt),ce===tt-1&&this._addTileFeatures(it.range(0,Vt,Ke/tt,Ct),it.data,-1,Te,tt,zt),zt.features.length?zt:null}getClusterExpansionZoom(ee){let ce=this._getOriginZoom(ee)-1;for(;ce<=this.options.maxZoom;){const Te=this.getChildren(ee);if(ce++,Te.length!==1)break;ee=Te[0].properties.cluster_id}return ce}_appendLeaves(ee,ce,Te,it,tt){const Et=this.getChildren(ce);for(const Dt of Et){const Ke=Dt.properties;if(Ke&&Ke.cluster?tt+Ke.point_count<=it?tt+=Ke.point_count:tt=this._appendLeaves(ee,Ke.cluster_id,Te,it,tt):tt<it?tt++:ee.push(Dt),ee.length===Te)break}return tt}_createTree(ee){const ce=new s.aZ(ee.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Te=0;Te<ee.length;Te+=this.stride)ce.add(ee[Te],ee[Te+1]);return ce.finish(),ce.data=ee,ce}_addTileFeatures(ee,ce,Te,it,tt,Et){for(const Dt of ee){const Ke=Dt*this.stride,Vt=ce[Ke+ai]>1;let Ct,zt,Fi;if(Vt)Ct=bi(ce,Ke,this.clusterProps),zt=ce[Ke],Fi=ce[Ke+1];else{const un=this.points[ce[Ke+wi]];Ct=un.properties;const[pn,Be]=un.geometry.coordinates;zt=rn(pn),Fi=Hi(Be)}const Ti={type:1,geometry:[[Math.round(this.options.extent*(zt*tt-Te)),Math.round(this.options.extent*(Fi*tt-it))]],tags:Ct};let Dn;Dn=Vt||this.options.generateId?ce[Ke+wi]:this.points[ce[Ke+wi]].id,Dn!==void 0&&(Ti.id=Dn),Et.features.push(Ti)}}_limitZoom(ee){return Math.max(this.options.minZoom,Math.min(Math.floor(+ee),this.options.maxZoom+1))}_cluster(ee,ce){const{radius:Te,extent:it,reduce:tt,minPoints:Et}=this.options,Dt=Te/(it*Math.pow(2,ce)),Ke=ee.data,Vt=[],Ct=this.stride;for(let zt=0;zt<Ke.length;zt+=Ct){if(Ke[zt+2]<=ce)continue;Ke[zt+2]=ce;const Fi=Ke[zt],Ti=Ke[zt+1],Dn=ee.within(Ke[zt],Ke[zt+1],Dt),un=Ke[zt+ai];let pn=un;for(const Be of Dn){const Yt=Be*Ct;Ke[Yt+2]>ce&&(pn+=Ke[Yt+ai])}if(pn>un&&pn>=Et){let Be,Yt=Fi*un,zi=Ti*un,Ni=-1;const zn=((zt/Ct|0)<<5)+(ce+1)+this.points.length;for(const rs of Dn){const sr=rs*Ct;if(Ke[sr+2]<=ce)continue;Ke[sr+2]=ce;const xs=Ke[sr+ai];Yt+=Ke[sr]*xs,zi+=Ke[sr+1]*xs,Ke[sr+4]=zn,tt&&(Be||(Be=this._map(Ke,zt,!0),Ni=this.clusterProps.length,this.clusterProps.push(Be)),tt(Be,this._map(Ke,sr)))}Ke[zt+4]=zn,Vt.push(Yt/pn,zi/pn,1/0,zn,-1,pn),tt&&Vt.push(Ni)}else{for(let Be=0;Be<Ct;Be++)Vt.push(Ke[zt+Be]);if(pn>1)for(const Be of Dn){const Yt=Be*Ct;if(!(Ke[Yt+2]<=ce)){Ke[Yt+2]=ce;for(let zi=0;zi<Ct;zi++)Vt.push(Ke[Yt+zi])}}}}return Vt}_getOriginId(ee){return ee-this.points.length>>5}_getOriginZoom(ee){return(ee-this.points.length)%32}_map(ee,ce,Te){if(ee[ce+ai]>1){const Et=this.clusterProps[ee[ce+nt]];return Te?Object.assign({},Et):Et}const it=this.points[ee[ce+wi]].properties,tt=this.options.map(it);return Te&&tt===it?Object.assign({},tt):tt}}function Ii(Re,ee,ce){return{type:"Feature",id:Re[ee+wi],properties:bi(Re,ee,ce),geometry:{type:"Point",coordinates:[(Te=Re[ee],360*(Te-.5)),Pn(Re[ee+1])]}};var Te}function bi(Re,ee,ce){const Te=Re[ee+ai],it=Te>=1e4?`${Math.round(Te/1e3)}k`:Te>=1e3?Math.round(Te/100)/10+"k":Te,tt=Re[ee+nt],Et=tt===-1?{}:Object.assign({},ce[tt]);return Object.assign(Et,{cluster:!0,cluster_id:Re[ee+wi],point_count:Te,point_count_abbreviated:it})}function rn(Re){return Re/360+.5}function Hi(Re){const ee=Math.sin(Re*Math.PI/180),ce=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return ce<0?0:ce>1?1:ce}function Pn(Re){const ee=(180-360*Re)*Math.PI/180;return 360*Math.atan(Math.exp(ee))/Math.PI-90}var at={exports:{}};at.exports=function(){function Re(We,Je,ut,ht){for(var gt,At=ht,It=ut-Je>>1,vt=ut-Je,jt=We[Je],mt=We[Je+1],pi=We[ut],Zi=We[ut+1],Jt=Je+3;Jt<ut;Jt+=3){var Ji=ee(We[Jt],We[Jt+1],jt,mt,pi,Zi);if(Ji>At)gt=Jt,At=Ji;else if(Ji===At){var kn=Math.abs(Jt-It);kn<vt&&(gt=Jt,vt=kn)}}At>ht&&(gt-Je>3&&Re(We,Je,gt,ht),We[gt+2]=At,ut-gt>3&&Re(We,gt,ut,ht))}function ee(We,Je,ut,ht,gt,At){var It=gt-ut,vt=At-ht;if(It!==0||vt!==0){var jt=((We-ut)*It+(Je-ht)*vt)/(It*It+vt*vt);jt>1?(ut=gt,ht=At):jt>0&&(ut+=It*jt,ht+=vt*jt)}return(It=We-ut)*It+(vt=Je-ht)*vt}function ce(We,Je,ut,ht){var gt={id:We===void 0?null:We,type:Je,geometry:ut,tags:ht,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(At){var It=At.geometry,vt=At.type;if(vt==="Point"||vt==="MultiPoint"||vt==="LineString")Te(At,It);else if(vt==="Polygon"||vt==="MultiLineString")for(var jt=0;jt<It.length;jt++)Te(At,It[jt]);else if(vt==="MultiPolygon")for(jt=0;jt<It.length;jt++)for(var mt=0;mt<It[jt].length;mt++)Te(At,It[jt][mt])}(gt),gt}function Te(We,Je){for(var ut=0;ut<Je.length;ut+=3)We.minX=Math.min(We.minX,Je[ut]),We.minY=Math.min(We.minY,Je[ut+1]),We.maxX=Math.max(We.maxX,Je[ut]),We.maxY=Math.max(We.maxY,Je[ut+1])}function it(We,Je,ut,ht){if(Je.geometry){var gt=Je.geometry.coordinates,At=Je.geometry.type,It=Math.pow(ut.tolerance/((1<<ut.maxZoom)*ut.extent),2),vt=[],jt=Je.id;if(ut.promoteId?jt=Je.properties[ut.promoteId]:ut.generateId&&(jt=ht||0),At==="Point")tt(gt,vt);else if(At==="MultiPoint")for(var mt=0;mt<gt.length;mt++)tt(gt[mt],vt);else if(At==="LineString")Et(gt,vt,It,!1);else if(At==="MultiLineString"){if(ut.lineMetrics){for(mt=0;mt<gt.length;mt++)Et(gt[mt],vt=[],It,!1),We.push(ce(jt,"LineString",vt,Je.properties));return}Dt(gt,vt,It,!1)}else if(At==="Polygon")Dt(gt,vt,It,!0);else{if(At!=="MultiPolygon"){if(At==="GeometryCollection"){for(mt=0;mt<Je.geometry.geometries.length;mt++)it(We,{id:jt,geometry:Je.geometry.geometries[mt],properties:Je.properties},ut,ht);return}throw new Error("Input data is not a valid GeoJSON object.")}for(mt=0;mt<gt.length;mt++){var pi=[];Dt(gt[mt],pi,It,!0),vt.push(pi)}}We.push(ce(jt,At,vt,Je.properties))}}function tt(We,Je){Je.push(Ke(We[0])),Je.push(Vt(We[1])),Je.push(0)}function Et(We,Je,ut,ht){for(var gt,At,It=0,vt=0;vt<We.length;vt++){var jt=Ke(We[vt][0]),mt=Vt(We[vt][1]);Je.push(jt),Je.push(mt),Je.push(0),vt>0&&(It+=ht?(gt*mt-jt*At)/2:Math.sqrt(Math.pow(jt-gt,2)+Math.pow(mt-At,2))),gt=jt,At=mt}var pi=Je.length-3;Je[2]=1,Re(Je,0,pi,ut),Je[pi+2]=1,Je.size=Math.abs(It),Je.start=0,Je.end=Je.size}function Dt(We,Je,ut,ht){for(var gt=0;gt<We.length;gt++){var At=[];Et(We[gt],At,ut,ht),Je.push(At)}}function Ke(We){return We/360+.5}function Vt(We){var Je=Math.sin(We*Math.PI/180),ut=.5-.25*Math.log((1+Je)/(1-Je))/Math.PI;return ut<0?0:ut>1?1:ut}function Ct(We,Je,ut,ht,gt,At,It,vt){if(ht/=Je,At>=(ut/=Je)&&It<ht)return We;if(It<ut||At>=ht)return null;for(var jt=[],mt=0;mt<We.length;mt++){var pi=We[mt],Zi=pi.geometry,Jt=pi.type,Ji=gt===0?pi.minX:pi.minY,kn=gt===0?pi.maxX:pi.maxY;if(Ji>=ut&&kn<ht)jt.push(pi);else if(!(kn<ut||Ji>=ht)){var Ln=[];if(Jt==="Point"||Jt==="MultiPoint")zt(Zi,Ln,ut,ht,gt);else if(Jt==="LineString")Fi(Zi,Ln,ut,ht,gt,!1,vt.lineMetrics);else if(Jt==="MultiLineString")Dn(Zi,Ln,ut,ht,gt,!1);else if(Jt==="Polygon")Dn(Zi,Ln,ut,ht,gt,!0);else if(Jt==="MultiPolygon")for(var jn=0;jn<Zi.length;jn++){var yr=[];Dn(Zi[jn],yr,ut,ht,gt,!0),yr.length&&Ln.push(yr)}if(Ln.length){if(vt.lineMetrics&&Jt==="LineString"){for(jn=0;jn<Ln.length;jn++)jt.push(ce(pi.id,Jt,Ln[jn],pi.tags));continue}Jt!=="LineString"&&Jt!=="MultiLineString"||(Ln.length===1?(Jt="LineString",Ln=Ln[0]):Jt="MultiLineString"),Jt!=="Point"&&Jt!=="MultiPoint"||(Jt=Ln.length===3?"Point":"MultiPoint"),jt.push(ce(pi.id,Jt,Ln,pi.tags))}}}return jt.length?jt:null}function zt(We,Je,ut,ht,gt){for(var At=0;At<We.length;At+=3){var It=We[At+gt];It>=ut&&It<=ht&&(Je.push(We[At]),Je.push(We[At+1]),Je.push(We[At+2]))}}function Fi(We,Je,ut,ht,gt,At,It){for(var vt,jt,mt=Ti(We),pi=gt===0?pn:Be,Zi=We.start,Jt=0;Jt<We.length-3;Jt+=3){var Ji=We[Jt],kn=We[Jt+1],Ln=We[Jt+2],jn=We[Jt+3],yr=We[Jt+4],es=gt===0?Ji:kn,ss=gt===0?jn:yr,ts=!1;It&&(vt=Math.sqrt(Math.pow(Ji-jn,2)+Math.pow(kn-yr,2))),es<ut?ss>ut&&(jt=pi(mt,Ji,kn,jn,yr,ut),It&&(mt.start=Zi+vt*jt)):es>ht?ss<ht&&(jt=pi(mt,Ji,kn,jn,yr,ht),It&&(mt.start=Zi+vt*jt)):un(mt,Ji,kn,Ln),ss<ut&&es>=ut&&(jt=pi(mt,Ji,kn,jn,yr,ut),ts=!0),ss>ht&&es<=ht&&(jt=pi(mt,Ji,kn,jn,yr,ht),ts=!0),!At&&ts&&(It&&(mt.end=Zi+vt*jt),Je.push(mt),mt=Ti(We)),It&&(Zi+=vt)}var xr=We.length-3;Ji=We[xr],kn=We[xr+1],Ln=We[xr+2],(es=gt===0?Ji:kn)>=ut&&es<=ht&&un(mt,Ji,kn,Ln),xr=mt.length-3,At&&xr>=3&&(mt[xr]!==mt[0]||mt[xr+1]!==mt[1])&&un(mt,mt[0],mt[1],mt[2]),mt.length&&Je.push(mt)}function Ti(We){var Je=[];return Je.size=We.size,Je.start=We.start,Je.end=We.end,Je}function Dn(We,Je,ut,ht,gt,At){for(var It=0;It<We.length;It++)Fi(We[It],Je,ut,ht,gt,At,!1)}function un(We,Je,ut,ht){We.push(Je),We.push(ut),We.push(ht)}function pn(We,Je,ut,ht,gt,At){var It=(At-Je)/(ht-Je);return We.push(At),We.push(ut+(gt-ut)*It),We.push(1),It}function Be(We,Je,ut,ht,gt,At){var It=(At-ut)/(gt-ut);return We.push(Je+(ht-Je)*It),We.push(At),We.push(1),It}function Yt(We,Je){for(var ut=[],ht=0;ht<We.length;ht++){var gt,At=We[ht],It=At.type;if(It==="Point"||It==="MultiPoint"||It==="LineString")gt=zi(At.geometry,Je);else if(It==="MultiLineString"||It==="Polygon"){gt=[];for(var vt=0;vt<At.geometry.length;vt++)gt.push(zi(At.geometry[vt],Je))}else if(It==="MultiPolygon")for(gt=[],vt=0;vt<At.geometry.length;vt++){for(var jt=[],mt=0;mt<At.geometry[vt].length;mt++)jt.push(zi(At.geometry[vt][mt],Je));gt.push(jt)}ut.push(ce(At.id,It,gt,At.tags))}return ut}function zi(We,Je){var ut=[];ut.size=We.size,We.start!==void 0&&(ut.start=We.start,ut.end=We.end);for(var ht=0;ht<We.length;ht+=3)ut.push(We[ht]+Je,We[ht+1],We[ht+2]);return ut}function Ni(We,Je){if(We.transformed)return We;var ut,ht,gt,At=1<<We.z,It=We.x,vt=We.y;for(ut=0;ut<We.features.length;ut++){var jt=We.features[ut],mt=jt.geometry,pi=jt.type;if(jt.geometry=[],pi===1)for(ht=0;ht<mt.length;ht+=2)jt.geometry.push(zn(mt[ht],mt[ht+1],Je,At,It,vt));else for(ht=0;ht<mt.length;ht++){var Zi=[];for(gt=0;gt<mt[ht].length;gt+=2)Zi.push(zn(mt[ht][gt],mt[ht][gt+1],Je,At,It,vt));jt.geometry.push(Zi)}}return We.transformed=!0,We}function zn(We,Je,ut,ht,gt,At){return[Math.round(ut*(We*ht-gt)),Math.round(ut*(Je*ht-At))]}function rs(We,Je,ut,ht,gt){for(var At=Je===gt.maxZoom?0:gt.tolerance/((1<<Je)*gt.extent),It={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ut,y:ht,z:Je,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},vt=0;vt<We.length;vt++){It.numFeatures++,sr(It,We[vt],At,gt);var jt=We[vt].minX,mt=We[vt].minY,pi=We[vt].maxX,Zi=We[vt].maxY;jt<It.minX&&(It.minX=jt),mt<It.minY&&(It.minY=mt),pi>It.maxX&&(It.maxX=pi),Zi>It.maxY&&(It.maxY=Zi)}return It}function sr(We,Je,ut,ht){var gt=Je.geometry,At=Je.type,It=[];if(At==="Point"||At==="MultiPoint")for(var vt=0;vt<gt.length;vt+=3)It.push(gt[vt]),It.push(gt[vt+1]),We.numPoints++,We.numSimplified++;else if(At==="LineString")xs(It,gt,We,ut,!1,!1);else if(At==="MultiLineString"||At==="Polygon")for(vt=0;vt<gt.length;vt++)xs(It,gt[vt],We,ut,At==="Polygon",vt===0);else if(At==="MultiPolygon")for(var jt=0;jt<gt.length;jt++){var mt=gt[jt];for(vt=0;vt<mt.length;vt++)xs(It,mt[vt],We,ut,!0,vt===0)}if(It.length){var pi=Je.tags||null;if(At==="LineString"&&ht.lineMetrics){for(var Zi in pi={},Je.tags)pi[Zi]=Je.tags[Zi];pi.mapbox_clip_start=gt.start/gt.size,pi.mapbox_clip_end=gt.end/gt.size}var Jt={geometry:It,type:At==="Polygon"||At==="MultiPolygon"?3:At==="LineString"||At==="MultiLineString"?2:1,tags:pi};Je.id!==null&&(Jt.id=Je.id),We.features.push(Jt)}}function xs(We,Je,ut,ht,gt,At){var It=ht*ht;if(ht>0&&Je.size<(gt?It:ht))ut.numPoints+=Je.length/3;else{for(var vt=[],jt=0;jt<Je.length;jt+=3)(ht===0||Je[jt+2]>It)&&(ut.numSimplified++,vt.push(Je[jt]),vt.push(Je[jt+1])),ut.numPoints++;gt&&function(mt,pi){for(var Zi=0,Jt=0,Ji=mt.length,kn=Ji-2;Jt<Ji;kn=Jt,Jt+=2)Zi+=(mt[Jt]-mt[kn])*(mt[Jt+1]+mt[kn+1]);if(Zi>0===pi)for(Jt=0,Ji=mt.length;Jt<Ji/2;Jt+=2){var Ln=mt[Jt],jn=mt[Jt+1];mt[Jt]=mt[Ji-2-Jt],mt[Jt+1]=mt[Ji-1-Jt],mt[Ji-2-Jt]=Ln,mt[Ji-1-Jt]=jn}}(vt,At),We.push(vt)}}function To(We,Je){var ut=(Je=this.options=function(gt,At){for(var It in At)gt[It]=At[It];return gt}(Object.create(this.options),Je)).debug;if(ut&&console.time("preprocess data"),Je.maxZoom<0||Je.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Je.promoteId&&Je.generateId)throw new Error("promoteId and generateId cannot be used together.");var ht=function(gt,At){var It=[];if(gt.type==="FeatureCollection")for(var vt=0;vt<gt.features.length;vt++)it(It,gt.features[vt],At,vt);else it(It,gt.type==="Feature"?gt:{geometry:gt},At);return It}(We,Je);this.tiles={},this.tileCoords=[],ut&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Je.indexMaxZoom,Je.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ht=function(gt,At){var It=At.buffer/At.extent,vt=gt,jt=Ct(gt,1,-1-It,It,0,-1,2,At),mt=Ct(gt,1,1-It,2+It,0,-1,2,At);return(jt||mt)&&(vt=Ct(gt,1,-It,1+It,0,-1,2,At)||[],jt&&(vt=Yt(jt,1).concat(vt)),mt&&(vt=vt.concat(Yt(mt,-1)))),vt}(ht,Je)).length&&this.splitTile(ht,0,0,0),ut&&(ht.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function mr(We,Je,ut){return 32*((1<<We)*ut+Je)+We}return To.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},To.prototype.splitTile=function(We,Je,ut,ht,gt,At,It){for(var vt=[We,Je,ut,ht],jt=this.options,mt=jt.debug;vt.length;){ht=vt.pop(),ut=vt.pop(),Je=vt.pop(),We=vt.pop();var pi=1<<Je,Zi=mr(Je,ut,ht),Jt=this.tiles[Zi];if(!Jt&&(mt>1&&console.time("creation"),Jt=this.tiles[Zi]=rs(We,Je,ut,ht,jt),this.tileCoords.push({z:Je,x:ut,y:ht}),mt)){mt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Je,ut,ht,Jt.numFeatures,Jt.numPoints,Jt.numSimplified),console.timeEnd("creation"));var Ji="z"+Je;this.stats[Ji]=(this.stats[Ji]||0)+1,this.total++}if(Jt.source=We,gt){if(Je===jt.maxZoom||Je===gt)continue;var kn=1<<gt-Je;if(ut!==Math.floor(At/kn)||ht!==Math.floor(It/kn))continue}else if(Je===jt.indexMaxZoom||Jt.numPoints<=jt.indexMaxPoints)continue;if(Jt.source=null,We.length!==0){mt>1&&console.time("clipping");var Ln,jn,yr,es,ss,ts,xr=.5*jt.buffer/jt.extent,Ur=.5-xr,eo=.5+xr,qa=1+xr;Ln=jn=yr=es=null,ss=Ct(We,pi,ut-xr,ut+eo,0,Jt.minX,Jt.maxX,jt),ts=Ct(We,pi,ut+Ur,ut+qa,0,Jt.minX,Jt.maxX,jt),We=null,ss&&(Ln=Ct(ss,pi,ht-xr,ht+eo,1,Jt.minY,Jt.maxY,jt),jn=Ct(ss,pi,ht+Ur,ht+qa,1,Jt.minY,Jt.maxY,jt),ss=null),ts&&(yr=Ct(ts,pi,ht-xr,ht+eo,1,Jt.minY,Jt.maxY,jt),es=Ct(ts,pi,ht+Ur,ht+qa,1,Jt.minY,Jt.maxY,jt),ts=null),mt>1&&console.timeEnd("clipping"),vt.push(Ln||[],Je+1,2*ut,2*ht),vt.push(jn||[],Je+1,2*ut,2*ht+1),vt.push(yr||[],Je+1,2*ut+1,2*ht),vt.push(es||[],Je+1,2*ut+1,2*ht+1)}}},To.prototype.getTile=function(We,Je,ut){var ht=this.options,gt=ht.extent,At=ht.debug;if(We<0||We>24)return null;var It=1<<We,vt=mr(We,Je=(Je%It+It)%It,ut);if(this.tiles[vt])return Ni(this.tiles[vt],gt);At>1&&console.log("drilling down to z%d-%d-%d",We,Je,ut);for(var jt,mt=We,pi=Je,Zi=ut;!jt&&mt>0;)mt--,pi=Math.floor(pi/2),Zi=Math.floor(Zi/2),jt=this.tiles[mr(mt,pi,Zi)];return jt&&jt.source?(At>1&&console.log("found parent tile z%d-%d-%d",mt,pi,Zi),At>1&&console.time("drilling down"),this.splitTile(jt.source,mt,pi,Zi,We,Je,ut),At>1&&console.timeEnd("drilling down"),this.tiles[vt]?Ni(this.tiles[vt],gt):null):null},function(We,Je){return new To(We,Je)}}();var on=s.dc(at.exports);function $n(Re,ee){const ce=Re.tileID.canonical;if(!this._geoJSONIndex)return ee(null,null);const Te=this._geoJSONIndex.getTile(ce.z,ce.x,ce.y);if(!Te)return ee(null,null);const it=new class{constructor(Et){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.J,this.length=Et.length,this._features=Et}feature(Et){return new class{constructor(Dt){this._feature=Dt,this.extent=s.J,this.type=Dt.type,this.properties=Dt.tags,"id"in Dt&&!isNaN(Dt.id)&&(this.id=parseInt(Dt.id,10))}loadGeometry(){if(this._feature.type===1){const Dt=[];for(const Ke of this._feature.geometry)Dt.push([new s.P(Ke[0],Ke[1])]);return Dt}{const Dt=[];for(const Ke of this._feature.geometry){const Vt=[];for(const Ct of Ke)Vt.push(new s.P(Ct[0],Ct[1]));Dt.push(Vt)}return Dt}}toGeoJSON(Dt,Ke,Vt){return Q.call(this,Dt,Ke,Vt)}}(this._features[Et])}}(Te.features);let tt=ui(it);tt.byteOffset===0&&tt.byteLength===tt.buffer.byteLength||(tt=new Uint8Array(tt)),ee(null,{vectorTile:it,rawData:tt.buffer})}class er extends s.dh{constructor(ee,ce,Te,it,tt,Et){super(ee,ce,Te,it,$n,Et),tt&&(this.loadGeoJSON=tt)}loadData(ee,ce){const Te=ee&&ee.request,it=Te&&Te.collectResourceTiming;this.loadGeoJSON(ee,(tt,Et)=>{if(tt||!Et)return ce(tt);if(typeof Et!="object")return ce(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));{W(Et,!0);try{if(ee.filter){const Ke=s.cw(ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ke.result==="error")throw new Error(Ke.value.map(Ct=>`${Ct.key}: ${Ct.message}`).join(", "));Et={type:"FeatureCollection",features:Et.features.filter(Ct=>Ke.value.evaluate({zoom:0},Ct))}}this._geoJSONIndex=ee.cluster?new Qe(function({superclusterOptions:Ke,clusterProperties:Vt}){if(!Vt||!Ke)return Ke;const Ct={},zt={},Fi={accumulated:null,zoom:0},Ti={properties:null},Dn=Object.keys(Vt);for(const un of Dn){const[pn,Be]=Vt[un],Yt=s.cw(Be),zi=s.cw(typeof pn=="string"?[pn,["accumulated"],["get",un]]:pn);Ct[un]=Yt.value,zt[un]=zi.value}return Ke.map=un=>{Ti.properties=un;const pn={};for(const Be of Dn)pn[Be]=Ct[Be].evaluate(Fi,Ti);return pn},Ke.reduce=(un,pn)=>{Ti.properties=pn;for(const Be of Dn)Fi.accumulated=un[Be],un[Be]=zt[Be].evaluate(Fi,Ti)},Ke}(ee)).load(Et.features):on(Et,ee.geojsonVtOptions)}catch(Ke){return ce(Ke)}this.loaded={};const Dt={};if(it){const Ke=s.di(Te);Ke&&(Dt.resourceTiming={},Dt.resourceTiming[ee.source]=JSON.parse(JSON.stringify(Ke)))}ce(null,Dt)}})}reloadTile(ee,ce){const Te=this.loaded;return Te&&Te[ee.uid]?super.reloadTile(ee,ce):this.loadTile(ee,ce)}loadGeoJSON(ee,ce){if(ee.request)s.a1(ee.request,ce);else{if(typeof ee.data!="string")return ce(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));try{return ce(null,JSON.parse(ee.data))}catch{return ce(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ee,ce){try{ce(null,this._geoJSONIndex.getClusterExpansionZoom(ee.clusterId))}catch(Te){ce(Te)}}getClusterChildren(ee,ce){try{ce(null,this._geoJSONIndex.getChildren(ee.clusterId))}catch(Te){ce(Te)}}getClusterLeaves(ee,ce){try{ce(null,this._geoJSONIndex.getLeaves(ee.clusterId,ee.limit,ee.offset))}catch(Te){ce(Te)}}}class en{constructor(ee,ce){this.tileID=new s.O(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.tileZoom=ee.tileZoom,this.uid=ee.uid,this.zoom=ee.zoom,this.canonical=ee.tileID.canonical,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ee.projection,this.brightness=ce}parse(ee,ce,Te,it){this.status="parsing";const tt=new s.O(Te.tileID.overscaledZ,Te.tileID.wrap,Te.tileID.canonical.z,Te.tileID.canonical.x,Te.tileID.canonical.y),Et={},Dt=ce.familiesBySource[Te.source],Ke=new s.dk(tt,Te.promoteId);return Ke.bucketLayerIDs=[],s.dl(ee).then(Vt=>{if(!Vt)return it(new Error("Could not parse tile"));const Ct=s.dm(Vt,1/s.cg(Te.tileID.canonical)),zt=Vt.json.extensionsUsed&&Vt.json.extensionsUsed.includes("MAPBOX_mesh_features"),Fi=new s.al(this.zoom,{brightness:this.brightness});for(const Ti in Dt)for(const Dn of Dt[Ti]){const un=Dn[0],pn=Vt.json.extensionsUsed;un.recalculate(Fi,[]);const Be=new s.dn(Ct,tt,pn&&pn.includes("MAPBOX_mesh_features"),this.brightness);zt||(Be.needsUpload=!0),Et[un.fqid]=Be,Be.evaluate(un)}this.status="done",it(null,{buckets:Et,featureIndex:Ke})}).catch(Vt=>it(new Error(Vt.message)))}}class St{constructor(ee,ce,Te,it,tt,Et){this.actor=ee,this.layerIndex=ce,this.brightness=Et,this.loading={},this.loaded={}}loadTile(ee,ce){const Te=ee.uid,it=this.loading[Te]=new en(ee,this.brightness);s.dj(ee.request,(tt,Et)=>{const Dt=!this.loading[Te];return delete this.loading[Te],Dt||tt?(it.status="done",Dt||(this.loaded[Te]=it),ce(tt)):Et&&Et.byteLength!==0?void it.parse(Et,this.layerIndex,ee,(Ke,Vt)=>{it.status="done",this.loaded=this.loaded||{},this.loaded[Te]=it,Ke||!Vt?ce(Ke):ce(null,Vt)}):(it.status="done",this.loaded[Te]=it,ce())})}reloadTile(ee,ce){const Te=this.loaded,it=ee.uid;if(Te&&Te[it]){const tt=Te[it];tt.projection=ee.projection,tt.brightness=ee.brightness;const Et=(Dt,Ke)=>{tt.reloadCallback&&(delete tt.reloadCallback,this.loadTile(ee,ce)),ce(Dt,Ke)};tt.status==="parsing"?tt.reloadCallback=Et:tt.status==="done"&&this.loadTile(ee,ce)}}abortTile(ee,ce){const Te=ee.uid;this.loading[Te]&&delete this.loading[Te],ce()}removeTile(ee,ce){const Te=this.loaded,it=ee.uid;Te&&Te[it]&&delete Te[it],ce()}}class si{constructor(ee){this.self=ee,this.actor=new s.dp(ee,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.o({name:"mercator"}),this.workerSourceTypes={vector:s.dh,geojson:er,"batched-model":St},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ce,Te)=>{if(this.workerSourceTypes[ce])throw new Error(`Worker source with name "${ce}" already registered.`);this.workerSourceTypes[ce]=Te},this.self.registerRTLTextPlugin=ce=>{if(s.dq.isParsed())throw new Error("RTL text plugin already registered.");s.dq.applyArabicShaping=ce.applyArabicShaping,s.dq.processBidirectionalText=ce.processBidirectionalText,s.dq.processStyledBidirectionalText=ce.processStyledBidirectionalText}}clearCaches(ee,ce,Te){delete this.layerIndexes[ee],delete this.availableImages[ee],delete this.workerSources[ee],delete this.demWorkerSources[ee],Te()}checkIfReady(ee,ce,Te){Te()}setReferrer(ee,ce){this.referrer=ce}spriteLoaded(ee,{scope:ce,isLoaded:Te}){if(this.isSpriteLoaded[ee]||(this.isSpriteLoaded[ee]={}),this.isSpriteLoaded[ee][ce]=Te,this.workerSources[ee]&&this.workerSources[ee][ce])for(const it in this.workerSources[ee][ce]){const tt=this.workerSources[ee][ce][it];for(const Et in tt)tt[Et]instanceof s.dh&&(tt[Et].isSpriteLoaded=Te,tt[Et].fire(new s.a8("isSpriteLoaded")))}}setImages(ee,{scope:ce,images:Te},it){if(this.availableImages[ee]||(this.availableImages[ee]={}),this.availableImages[ee][ce]=Te,this.workerSources[ee]&&this.workerSources[ee][ce]){for(const tt in this.workerSources[ee][ce]){const Et=this.workerSources[ee][ce][tt];for(const Dt in Et)Et[Dt].availableImages=Te}it()}else it()}setProjection(ee,ce){this.projections[ee]=s.o(ce)}setBrightness(ee,ce,Te){this.brightness=ce,Te()}setLayers(ee,ce,Te){this.getLayerIndex(ee,ce.scope).replace(ce.layers,ce.options),Te()}updateLayers(ee,ce,Te){this.getLayerIndex(ee,ce.scope).update(ce.layers,ce.removedIds,ce.options),Te()}loadTile(ee,ce,Te){ce.projection=this.projections[ee]||this.defaultProjection,this.getWorkerSource(ee,ce.type,ce.source,ce.scope).loadTile(ce,Te)}loadDEMTile(ee,ce,Te){this.getDEMWorkerSource(ee,ce.source,ce.scope).loadTile(ce,Te)}reloadTile(ee,ce,Te){ce.projection=this.projections[ee]||this.defaultProjection,this.getWorkerSource(ee,ce.type,ce.source,ce.scope).reloadTile(ce,Te)}abortTile(ee,ce,Te){this.getWorkerSource(ee,ce.type,ce.source,ce.scope).abortTile(ce,Te)}removeTile(ee,ce,Te){this.getWorkerSource(ee,ce.type,ce.source,ce.scope).removeTile(ce,Te)}removeSource(ee,ce,Te){if(!(this.workerSources[ee]&&this.workerSources[ee][ce.scope]&&this.workerSources[ee][ce.scope][ce.type]&&this.workerSources[ee][ce.scope][ce.type][ce.source]))return;const it=this.workerSources[ee][ce.scope][ce.type][ce.source];delete this.workerSources[ee][ce.scope][ce.type][ce.source],it.removeSource!==void 0?it.removeSource(ce,Te):Te()}loadWorkerSource(ee,ce,Te){try{this.self.importScripts(ce.url),Te()}catch(it){Te(it.toString())}}syncRTLPluginState(ee,ce,Te){try{s.dq.setState(ce);const it=s.dq.getPluginURL();if(s.dq.isLoaded()&&!s.dq.isParsed()&&it!=null){this.self.importScripts(it);const tt=s.dq.isParsed();Te(tt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${it}`),tt)}}catch(it){Te(it.toString())}}setDracoUrl(ee,ce){this.dracoUrl=ce}getAvailableImages(ee,ce){this.availableImages[ee]||(this.availableImages[ee]={});let Te=this.availableImages[ee][ce];return Te||(Te=[]),Te}getLayerIndex(ee,ce){this.layerIndexes[ee]||(this.layerIndexes[ee]={});let Te=this.layerIndexes[ee][ce];return Te||(Te=this.layerIndexes[ee][ce]=new z,Te.scope=ce),Te}getWorkerSource(ee,ce,Te,it){if(this.workerSources[ee]||(this.workerSources[ee]={}),this.workerSources[ee][it]||(this.workerSources[ee][it]={}),this.workerSources[ee][it][ce]||(this.workerSources[ee][it][ce]={}),this.isSpriteLoaded[ee]||(this.isSpriteLoaded[ee]={}),!this.workerSources[ee][it][ce][Te]){const tt={send:(Et,Dt,Ke,Vt,Ct,zt)=>{this.actor.send(Et,Dt,Ke,ee,Ct,zt)},scheduler:this.actor.scheduler};this.workerSources[ee][it][ce][Te]=new this.workerSourceTypes[ce](tt,this.getLayerIndex(ee,it),this.getAvailableImages(ee,it),this.isSpriteLoaded[ee][it],void 0,this.brightness)}return this.workerSources[ee][it][ce][Te]}getDEMWorkerSource(ee,ce,Te){return this.demWorkerSources[ee]||(this.demWorkerSources[ee]={}),this.demWorkerSources[ee][Te]||(this.demWorkerSources[ee][Te]={}),this.demWorkerSources[ee][Te][ce]||(this.demWorkerSources[ee][Te][ce]=new F),this.demWorkerSources[ee][Te][ce]}enforceCacheSizeLimit(ee,ce){s.dr(ce)}getWorkerPerformanceMetrics(ee,ce,Te){Te(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new si(self)),si}),_(["./shared"],function(s){function S(g,l){if(Array.isArray(g)){if(!Array.isArray(l)||g.length!==l.length)return!1;for(let h=0;h<g.length;h++)if(!S(g[h],l[h]))return!1;return!0}if(typeof g=="object"&&g!==null&&l!==null){if(typeof l!="object"||Object.keys(g).length!==Object.keys(l).length)return!1;for(const h in g)if(!S(g[h],l[h]))return!1;return!0}return g===l}var P=z;function z(g){return!function(l){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,w,M=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(M);try{w=new Worker(A),x=!0}catch{x=!1}return w&&w.terminate(),URL.revokeObjectURL(A),x}()?function(){var x=document.createElement("canvas");x.width=x.height=1;var w=x.getContext("2d");if(!w)return!1;var M=w.getImageData(0,0,1,1);return M&&M.width===x.width}()?(F[h=l&&l.failIfMajorPerformanceCaveat]===void 0&&(F[h]=function(x){var w,M=function(A){var k=document.createElement("canvas"),L=Object.create(z.webGLContextAttributes);return L.failIfMajorPerformanceCaveat=A,k.getContext("webgl2",L)}(x);if(!M)return!1;try{w=M.createShader(M.VERTEX_SHADER)}catch{return!1}return!(!w||M.isContextLost())&&(M.shaderSource(w,"void main() {}"),M.compileShader(w),M.getShaderParameter(w,M.COMPILE_STATUS)===!0)}(h)),F[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var h}(g)}var F={};function U(g,l,h){const x=document.createElement(g);return l!=null&&(x.className=l),h&&h.appendChild(x),x}function Z(g,l,h){const x=document.createElementNS("http://www.w3.org/2000/svg",g);for(const w of Object.keys(l))x.setAttributeNS(null,w,String(l[w]));return h&&h.appendChild(x),x}z.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const W=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Q=W&&W.userSelect!==void 0?"userSelect":"WebkitUserSelect";let re;function ie(){W&&Q&&(re=W[Q],W[Q]="none")}function ve(){W&&Q&&(W[Q]=re)}function pe(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",pe,!0)}function ke(){window.addEventListener("click",pe,!0),window.setTimeout(()=>{window.removeEventListener("click",pe,!0)},0)}function Me(g,l){const h=g.getBoundingClientRect();return Mt(g,h,l)}function Ye(g,l){const h=g.getBoundingClientRect(),x=[];for(let w=0;w<l.length;w++)x.push(Mt(g,h,l[w]));return x}function ot(g){return window.InstallTrigger!==void 0&&g.button===2&&g.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function Mt(g,l,h){const x=g.offsetWidth===l.width?1:g.offsetWidth/l.width;return new s.P((h.clientX-l.left)*x,(h.clientY-l.top)*x)}class Se{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(l,h){this._updatedSourceCaches[l]=h,this.setDirty()}discardSourceCacheUpdate(l){delete this._updatedSourceCaches[l]}updateLayer(l){const h=l.scope;this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._updatedLayers[h].add(l.id),this.setDirty()}removeLayer(l){const h=l.scope;this._removedLayers[h]=this._removedLayers[h]||{},this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._removedLayers[h][l.id]=l,this._updatedLayers[h].delete(l.id),this._updatedPaintProps.delete(l.fqid),this.setDirty()}getRemovedLayer(l){return this._removedLayers[l.scope]?this._removedLayers[l.scope][l.id]:null}discardLayerRemoval(l){this._removedLayers[l.scope]&&delete this._removedLayers[l.scope][l.id]}getLayerUpdatesByScope(){const l={};for(const h in this._updatedLayers)l[h]=l[h]||{},l[h].updatedIds=Array.from(this._updatedLayers[h].values());for(const h in this._removedLayers)l[h]=l[h]||{},l[h].removedIds=Object.keys(this._removedLayers[h]);return l}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(l){this._updatedPaintProps.add(l.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(l){this._updatedImages.add(l),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const yt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class _t{constructor(l,h,x,w,M,A){this.length=h.length,this.attributes=x,this.itemSize=h.bytesPerElement,this.dynamicDraw=w,this.instanceCount=A,this.context=l;const k=l.gl;this.buffer=k.createBuffer(),l.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||M||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,h){for(let x=0;x<this.attributes.length;x++){const w=h.attributes[this.attributes[x].name];w!==void 0&&l.enableVertexAttribArray(w)}}setVertexAttribPointers(l,h,x){for(let w=0;w<this.attributes.length;w++){const M=this.attributes[w],A=h.attributes[M.name];A!==void 0&&l.vertexAttribPointer(A,M.components,l[yt[M.type]],!1,this.itemSize,M.offset+this.itemSize*(x||0))}}setVertexAttribDivisor(l,h,x){for(let w=0;w<this.attributes.length;w++){const M=h.attributes[this.attributes[w].name];M!==void 0&&this.instanceCount&&this.instanceCount>0&&l.vertexAttribDivisor(M,x)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ze{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Tt extends Ze{getDefault(){return s.C.transparent}set(l){const h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Zt extends Ze{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class ni extends Ze{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class ui extends Ze{getDefault(){return[!0,!0,!0,!0]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Di extends Ze{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class ft extends Ze{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class yi extends Ze{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const h=this.current;(l.func!==h.func||l.ref!==h.ref||l.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class wi extends Ze{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class ai extends Ze{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=l,this.dirty=!1}}class nt extends Ze{getDefault(){return[0,1]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class Qe extends Ze{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=l,this.dirty=!1}}class Ii extends Ze{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class bi extends Ze{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.BLEND):h.disable(h.BLEND),this.current=l,this.dirty=!1}}class rn extends Ze{getDefault(){const l=this.gl;return[l.ONE,l.ZERO,l.ONE,l.ZERO]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.blendFuncSeparate(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Hi extends Ze{getDefault(){return s.C.transparent}set(l){const h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Pn extends Ze{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(l,l),this.current=l,this.dirty=!1)}}class at extends Ze{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=l,this.dirty=!1}}class on extends Ze{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class $n extends Ze{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}let er=class extends Ze{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class en extends Ze{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class St extends Ze{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class si extends Ze{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Re extends Ze{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class ee extends Ze{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class ce extends Ze{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Te extends Ze{getDefault(){return null}set(l){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class it extends Ze{getDefault(){return null}set(l){this.gl&&(l!==this.current||this.dirty)&&(this.gl.bindVertexArray(l),this.current=l,this.dirty=!1)}}class tt extends Ze{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Et extends Ze{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Dt extends Ze{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Ke extends Ze{constructor(l,h){super(l),this.context=l,this.parent=h}getDefault(){return null}}class Vt extends Ke{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Ct extends Ke{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class zt extends Ke{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachment(),h.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Fi extends Ct{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ti{constructor(l,h,x,w,M){this.context=l,this.width=h,this.height=x;const A=this.framebuffer=l.gl.createFramebuffer();w&&(this.colorAttachment=new Vt(l,A)),M&&(this.depthAttachmentType=M,this.depthAttachment=M==="renderbuffer"?new Ct(l,A):new zt(l,A))}destroy(){const l=this.context.gl;if(this.colorAttachment){const h=this.colorAttachment.get();h&&l.deleteTexture(h)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const h=this.depthAttachment.get();h&&l.deleteRenderbuffer(h)}else{const h=this.depthAttachment.get();h&&l.deleteTexture(h)}l.deleteFramebuffer(this.framebuffer)}}class Dn{constructor(l,h){this.gl=l,this.clearColor=new Tt(this),this.clearDepth=new Zt(this),this.clearStencil=new ni(this),this.colorMask=new ui(this),this.depthMask=new Di(this),this.stencilMask=new ft(this),this.stencilFunc=new yi(this),this.stencilOp=new wi(this),this.stencilTest=new ai(this),this.depthRange=new nt(this),this.depthTest=new Qe(this),this.depthFunc=new Ii(this),this.blend=new bi(this),this.blendFunc=new rn(this),this.blendColor=new Hi(this),this.blendEquation=new Pn(this),this.cullFace=new at(this),this.cullFaceSide=new on(this),this.frontFace=new $n(this),this.program=new er(this),this.activeTexture=new en(this),this.viewport=new St(this),this.bindFramebuffer=new si(this),this.bindRenderbuffer=new Re(this),this.bindTexture=new ee(this),this.bindVertexBuffer=new ce(this),this.bindElementBuffer=new Te(this),this.bindVertexArrayOES=new it(this),this.pixelStoreUnpack=new tt(this),this.pixelStoreUnpackPremultiplyAlpha=new Et(this),this.pixelStoreUnpackFlipY=new Dt(this),this.options=h?{...h}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=l.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,h,x){return new s.I(this,l,h,x)}createVertexBuffer(l,h,x,w,M){return new _t(this,l,h,x,w,M)}createRenderbuffer(l,h,x){const w=this.gl,M=w.createRenderbuffer();return this.bindRenderbuffer.set(M),w.renderbufferStorage(w.RENDERBUFFER,l,h,x),this.bindRenderbuffer.set(null),M}createFramebuffer(l,h,x,w){return new Ti(this,l,h,x,w)}clear({color:l,depth:h,stencil:x,colorMask:w}){const M=this.gl;let A=0;l&&(A|=M.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set(w||[!0,!0,!0,!0])),h!==void 0&&(A|=M.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),x!==void 0&&(A|=M.STENCIL_BUFFER_BIT,this.clearStencil.set(x),this.stencilMask.set(255)),M.clear(A)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){S(l.blendFunction,s.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor),l.blendEquation?this.blendEquation.set(l.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(l.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class un{constructor(l=0,h=0,x=0,w=0){if(isNaN(l)||l<0||isNaN(h)||h<0||isNaN(x)||x<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=h,this.left=x,this.right=w}interpolate(l,h,x){return h.top!=null&&l.top!=null&&(this.top=s.n(l.top,h.top,x)),h.bottom!=null&&l.bottom!=null&&(this.bottom=s.n(l.bottom,h.bottom,x)),h.left!=null&&l.left!=null&&(this.left=s.n(l.left,h.left,x)),h.right!=null&&l.right!=null&&(this.right=s.n(l.right,h.right,x)),this}getCenter(l,h){const x=s.c((this.left+l-this.right)/2,0,l),w=s.c((this.top+h-this.bottom)/2,0,h);return new s.P(x,w)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new un(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function pn(g,l){const h=s.g(g,3);s.m.fromQuat(g,l),s.s(g,3,h)}function Be(g,l){const h=s.q.identity([]);return s.q.rotateZ(h,h,-l),s.q.rotateX(h,h,-g),h}function Yt(g,l){const h=[g[0],g[1],0],x=[l[0],l[1],0];if(s.v.length(h)>=1e-15){const A=s.v.normalize([],h);s.v.scale(x,A,s.v.dot(x,A)),l[0]=x[0],l[1]=x[1]}const w=s.v.cross([],l,g);if(s.v.len(w)<1e-15)return null;const M=Math.atan2(-w[1],w[0]);return Be(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),M)}class zi{constructor(l,h){this.position=l,this.orientation=h}get position(){return this._position}set position(l){if(l){const h=l instanceof s.M?l:new s.M(l[0],l[1],l[2]);this._renderWorldCopies&&(h.x=s.w(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(l,h){if(this.orientation=null,!this.position)return;const x=this.position,w=this._elevation?this._elevation.getAtPointOrZero(s.M.fromLngLat(l)):0,M=s.M.fromLngLat(l,w),A=[M.x-x.x,M.y-x.y,M.z-x.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Yt(A,h)}setPitchBearing(l,h){this.orientation=Be(s.d(l),s.d(-h))}}class Ni{constructor(l,h){this._transform=s.m.identity([]),this.orientation=h,this.position=l}get mercatorPosition(){const l=this.position;return new s.M(l[0],l[1],l[2])}get position(){const l=s.g(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var h;l&&s.s(this._transform,3,[(h=l)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||s.q.identity([]),l&&pn(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,h){this._orientation=Be(l,h),pn(this._transform,this._orientation)}forward(){const l=s.g(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=s.g(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=s.g(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,h){const x=new Float64Array(16);return s.m.invert(x,this.getWorldToCamera(l,h)),x}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(l,h,x){const w=this.position;s.v.scale(w,w,-l);const M=new Float64Array(16);return s.m.fromScaling(M,[x,x,x]),s.m.translate(M,M,w),M[10]*=h,M}getWorldToCamera(l,h){const x=new Float64Array(16),w=new Float64Array(4),M=this.position;return s.q.conjugate(w,this._orientation),s.v.scale(M,M,-l),s.m.fromQuat(x,w),s.m.translate(x,x,M),x[1]*=-1,x[5]*=-1,x[9]*=-1,x[13]*=-1,x[8]*=h,x[9]*=h,x[10]*=h,x[11]*=h,x}getCameraToClipPerspective(l,h,x,w){const M=new Float64Array(16);return s.m.perspective(M,l,h,x,w),M}getCameraToClipOrthographic(l,h,x,w,M,A){const k=new Float64Array(16);return s.m.ortho(k,l,h,x,w,M,A),k}getDistanceToElevation(l,h=!1){const x=l===0?0:s.b(l,h?s.l(this.position[1]):this.position[1]),w=this.forward();return(x-this.position[2])/w[2]}clone(){return new Ni([...this.position],[...this.orientation])}}const zn={unknown:0,flipRequired:1,flipNotRequired:2},rs=Math.tan(85*Math.PI/180);function sr(g,l,h,x,w,M,A){const k=s.m.create();if(h)if(M.name==="globe"){const L=s.f(w,l);s.m.multiply(k,k,L)}else{const L=s.h.invert([],A);k[0]=L[0],k[1]=L[1],k[4]=L[2],k[5]=L[3],x||s.m.rotateZ(k,k,w.angle)}else s.m.multiply(k,w.labelPlaneMatrix,g);return k}function xs(g,l,h,x,w,M,A){const k=sr(g,l,h,x,w,M,A);return M.name==="globe"&&h||(k[2]=k[6]=k[10]=k[14]=0),k}function To(g,l,h,x,w,M,A){if(h){if(M.name==="globe"){const k=sr(g,l,h,x,w,M,A);return s.m.invert(k,k),s.m.multiply(k,g,k),k}{const k=s.m.clone(g),L=s.m.identity([]);return L[0]=A[0],L[1]=A[1],L[4]=A[2],L[5]=A[3],s.m.multiply(k,k,L),x||s.m.rotateZ(k,k,-w.angle),k}}return w.glCoordMatrix}function mr(g,l,h,x){const w=[g,l,h,1];h?s.e.transformMat4(w,w,x):pi(w,w,x);const M=w[3];return w[0]/=M,w[1]/=M,w[2]/=M,w}function We(g,l){return Math.min(.5+g/l*.5,1.5)}function Je(g,l){const h=g[0]/g[3],x=g[1]/g[3];return h>=-l[0]&&h<=l[0]&&x>=-l[1]&&x<=l[1]}function ut(g,l,h,x,w,M,A,k,L,O){const N=h.transform,j=x?g.textSizeData:g.iconSizeData,H=s.i(j,h.transform.zoom),q=N.projection.name==="globe",Y=[256/h.width*2+1,256/h.height*2+1],J=x?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;J.clear();let K=null;q&&(K=x?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const X=g.lineVertexArray,oe=x?g.text.placedSymbolArray:g.icon.placedSymbolArray,de=h.transform.width/h.transform.height;let fe,ne=!1;for(let ae=0;ae<oe.length;ae++){const me=oe.get(ae),{numGlyphs:xe,writingMode:_e}=me;if(_e!==s.W.vertical||ne||fe===s.W.horizontal||(ne=!0),fe=_e,(me.hidden||_e===s.W.vertical)&&!ne){mt(xe,J);continue}ne=!1;const be=new s.P(me.tileAnchorX,me.tileAnchorY);let{x:Ue,y:ze,z:Fe}=N.projection.projectTilePoint(be.x,be.y,O.canonical);if(L){const[kt,Xt,Lt]=L(be);Ue+=kt,ze+=Xt,Fe+=Lt}const Ae=[Ue,ze,Fe,1];if(s.e.transformMat4(Ae,Ae,l),!Je(Ae,Y)){mt(xe,J);continue}const je=Ae[3],Oe=We(h.transform.getCameraToCenterDistance(N.projection),je),qe=s.j(j,H,me),ue=A?qe/Oe:qe*Oe,Ce=mr(Ue,ze,Fe,w);if(Ce[3]<=0){mt(xe,J);continue}let st={};const $e=A?null:L,Ft=At(me,ue,!1,k,l,w,M,g.glyphOffsetArray,X,J,K,Ce,be,st,de,$e,N.projection,O,A);ne=Ft.useVertical,$e&&Ft.needsFlipping&&(st={}),(Ft.notEnoughRoom||ne||Ft.needsFlipping&&At(me,ue,!0,k,l,w,M,g.glyphOffsetArray,X,J,K,Ce,be,st,de,$e,N.projection,O,A).notEnoughRoom)&&mt(xe,J)}x?(g.text.dynamicLayoutVertexBuffer.updateData(J),K&&g.text.globeExtVertexBuffer&&g.text.globeExtVertexBuffer.updateData(K)):(g.icon.dynamicLayoutVertexBuffer.updateData(J),K&&g.icon.globeExtVertexBuffer&&g.icon.globeExtVertexBuffer.updateData(K))}function ht(g,l,h,x,w,M,A,k,L,O,N,j,H,q,Y,J){const{lineStartIndex:K,glyphStartIndex:X,segment:oe}=k,de=X+k.numGlyphs,fe=K+k.lineLength,ne=l.getoffsetX(X),ae=l.getoffsetX(de-1),me=jt(g*ne,h,x,w,M,A,oe,K,fe,L,O,N,j,H,!0,q,Y,J);if(!me)return null;const xe=jt(g*ae,h,x,w,M,A,oe,K,fe,L,O,N,j,H,!0,q,Y,J);return xe?{first:me,last:xe}:null}function gt(g,l,h,x){return g===s.W.horizontal&&Math.abs(x)>Math.abs(h)?{useVertical:!0}:g===s.W.vertical?x>0?{needsFlipping:!0}:null:l!==zn.unknown&&function(w,M){return w===0||Math.abs(M/w)>rs}(h,x)?l===zn.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function At(g,l,h,x,w,M,A,k,L,O,N,j,H,q,Y,J,K,X,oe){const de=l/24,fe=g.lineOffsetX*de,ne=g.lineOffsetY*de,{lineStartIndex:ae,glyphStartIndex:me,numGlyphs:xe,segment:_e,writingMode:be,flipState:Ue}=g,ze=ae+g.lineLength,Fe=Ae=>{if(N){const[ue,Ce,st]=Ae.up,$e=O.length;s.u(N,$e+0,ue,Ce,st),s.u(N,$e+1,ue,Ce,st),s.u(N,$e+2,ue,Ce,st),s.u(N,$e+3,ue,Ce,st)}const[je,Oe,qe]=Ae.point;s.k(O,je,Oe,qe,Ae.angle)};if(xe>1){const Ae=ht(de,k,fe,ne,h,j,H,g,L,M,q,J,!1,K,X,oe);if(!Ae)return{notEnoughRoom:!0};if(x&&!h){let[je,Oe,qe]=Ae.first.point,[ue,Ce,st]=Ae.last.point;[je,Oe]=mr(je,Oe,qe,A),[ue,Ce]=mr(ue,Ce,st,A);const $e=gt(be,Ue,(ue-je)*Y,Ce-Oe);if(g.flipState=$e&&$e.needsFlipping?zn.flipRequired:zn.flipNotRequired,$e)return $e}Fe(Ae.first);for(let je=me+1;je<me+xe-1;je++){const Oe=jt(de*k.getoffsetX(je),fe,ne,h,j,H,_e,ae,ze,L,M,q,J,!1,!1,K,X,oe);if(!Oe)return O.length-=4*(je-me),{notEnoughRoom:!0};Fe(Oe)}Fe(Ae.last)}else{if(x&&!h){const je=mr(H.x,H.y,0,w),Oe=ae+_e+1,qe=new s.P(L.getx(Oe),L.gety(Oe)),ue=mr(qe.x,qe.y,0,w),Ce=ue[3]>0?ue:vt(H,qe,je,1,w,void 0,K,X.canonical),st=gt(be,Ue,(Ce[0]-je[0])*Y,Ce[1]-je[1]);if(g.flipState=st&&st.needsFlipping?zn.flipRequired:zn.flipNotRequired,st)return st}const Ae=jt(de*k.getoffsetX(me),fe,ne,h,j,H,_e,ae,ze,L,M,q,J,!1,!1,K,X,oe);if(!Ae)return{notEnoughRoom:!0};Fe(Ae)}return{}}function It(g,l,h,x,w){const{x:M,y:A,z:k}=x.projectTilePoint(g.x,g.y,l);if(!w)return mr(M,A,k,h);const[L,O,N]=w(g);return mr(M+L,A+O,k+N,h)}function vt(g,l,h,x,w,M,A,k){const L=It(g.sub(l)._unit()._add(g),k,w,A,M);return s.v.sub(L,h,L),s.v.normalize(L,L),s.v.scaleAndAdd(L,h,L,x)}function jt(g,l,h,x,w,M,A,k,L,O,N,j,H,q,Y,J,K,X){const oe=x?g-l:g+l;let de=oe>0?1:-1,fe=0;x&&(de*=-1,fe=Math.PI),de<0&&(fe+=Math.PI);let ne=k+A+(de>0?0:1)|0,ae=w,me=w,xe=0,_e=0;const be=Math.abs(oe),Ue=[],ze=[];let Fe=M,Ae=Fe;const je=()=>vt(Ae,Fe,me,be-xe+1,N,H,J,K.canonical);for(;xe+_e<=be;){if(ne+=de,ne<k||ne>=L)return null;if(me=ae,Ae=Fe,Ue.push(me),q&&ze.push(Ae),Fe=new s.P(O.getx(ne),O.gety(ne)),ae=j[ne],!ae){const Xt=It(Fe,K.canonical,N,J,H);ae=Xt[3]>0?j[ne]=Xt:je()}xe+=_e,_e=s.v.distance(me,ae)}Y&&H&&(j[ne]&&(ae=je(),_e=s.v.distance(me,ae)),j[ne]=ae);const Oe=(be-xe)/_e,qe=Fe.sub(Ae)._mult(Oe)._add(Ae),ue=s.v.sub([],ae,me),Ce=s.v.scaleAndAdd([],me,ue,Oe);let st=[0,0,1],$e=ue[0],Ft=ue[1];if(X&&(st=J.upVector(K.canonical,qe.x,qe.y),st[0]!==0||st[1]!==0||st[2]!==1)){const Xt=[st[2],0,-st[0]],Lt=s.v.cross([],st,Xt);s.v.normalize(Xt,Xt),s.v.normalize(Lt,Lt),$e=s.v.dot(ue,Xt),Ft=s.v.dot(ue,Lt)}if(h){const Xt=s.v.cross([],st,ue);s.v.normalize(Xt,Xt),s.v.scaleAndAdd(Ce,Ce,Xt,h*de)}const kt=fe+Math.atan2(Ft,$e);return Ue.push(Ce),q&&ze.push(qe),{point:Ce,angle:kt,path:Ue,tilePath:ze,up:st}}function mt(g,l){const h=l.length,x=h+4*g;l.resize(x),l.float32.fill(-1/0,4*h,4*x)}function pi(g,l,h){const x=l[0],w=l[1];return g[0]=h[0]*x+h[4]*w+h[12],g[1]=h[1]*x+h[5]*w+h[13],g[3]=h[3]*x+h[7]*w+h[15],g}const Zi=(g,l,h)=>(1-h)*g+h*l,Jt=g=>g*g*g*g*g;class Ji{constructor(l,h,x,w,M,A,k){this.tileSize=512,this._renderWorldCopies=M===void 0||M,this._minZoom=l||0,this._maxZoom=h||22,this._minPitch=x??0,this._maxPitch=w??60,this.setProjection(A),this.setMaxBounds(k),this.width=0,this.height=0,this._center=new s.L(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new un,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ni,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const l=new Ji(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(l,h=!1){const x=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||x)&&this._updateCameraOnTerrain(),(l||x)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return s.p(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=s.o(this.projectionOptions);const x=!S(h,this.getProjection());return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setOrthographicProjectionAtLowPitch(l){return this._orthographicProjectionAtLowPitch!==l&&(this._orthographicProjectionAtLowPitch=l,this._calcMatrices(),!0)}setMercatorFromTransition(){const l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.o({name:"mercator"});const h=l!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.b(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.w(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const h=-l*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=s.h.create(),s.h.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const h=s.c(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=s.d(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){const h=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}_updateCameraOnTerrain(){const l=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,h=this.elevation&&l===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||l===Number.NEGATIVE_INFINITY&&(!h||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const x=this._elevation;h||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&x.exaggeration()&&this._centerAltitudeValidForExaggeration!==x.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*x.exaggeration(),this._centerAltitudeValidForExaggeration=x.exaggeration()):(this._centerAltitude=l||0,this._centerAltitudeValidForExaggeration=x.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],x=this.horizonLineFromTop();let w=0,M=0;for(let A=0;A<h.length;A++){const k=new s.P(h[A][0]*this.width,x+h[A][1]*(this.height-x)),L=l.pointCoordinate(k);if(!L)continue;const O=1/Math.hypot(L[0]-this._camera.position[0],L[1]-this._camera.position[1]);w+=L[3]*O,M+=O}return M===0?NaN:w/M}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const l=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),x=this.pixelsPerMeter/this.worldSize*h,w=this._mercatorZfromZoom(l),M=this._mercatorZfromZoom(this._maxZoom),A=Math.max(w-x,M);this._setZoom(this._zoomFromMercatorZ(A))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let x;x=l.z<this._camera.position[2]?[h.x,h.y,h.z]:[l.x,l.y,l.z];const w=s.v.length(s.v.sub([],this._camera.position,x));return s.c(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let h=!1;if(l.orientation&&!s.q.exactEquals(l.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(l.orientation)),l.position){const x=[l.position.x,l.position.y,l.position.z];s.v.exactEquals(x,this._camera.position)||(this._setCameraPosition(x),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,h=new zi;return h.position=new s.M(l[0],l[1],l[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(l){if(!s.q.length(l))return!1;s.q.normalize(l,l);const h=s.v.transformQuat([],[0,0,-1],l),x=s.v.transformQuat([],[0,-1,0],l);if(x[2]<0)return!1;const w=Yt(h,x);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(l){const h=this.zoomScale(this.minZoom)*this.tileSize,x=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;l[2]=s.c(l[2],w/x,w/h),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,h,x){this._unmodified=!1,this._edgeInsets.interpolate(l,h,x),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const h=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(l){const h=[new s.U(0,l)];if(this.renderWorldCopies){const x=this.pointCoordinate(new s.P(0,0)),w=this.pointCoordinate(new s.P(this.width,0)),M=this.pointCoordinate(new s.P(this.width,this.height)),A=this.pointCoordinate(new s.P(0,this.height)),k=Math.floor(Math.min(x.x,w.x,M.x,A.x)),L=Math.floor(Math.max(x.x,w.x,M.x,A.x)),O=1;for(let N=k-O;N<=L+O;N++)N!==0&&h.push(new s.U(N,l))}return h}isLODDisabled(l){return(!l||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(l,h,x){let w=[];if(h[0]===0&&h[1]===0)return w;for(const A of l){const k=A.canonical,L=A.overscaledZ,O=A.wrap,N=1<<k.z,j=k.x+1<N,H=k.x>0,q=k.y+1<N,Y=k.y>0,J=A.wrap-(H?0:1),K=A.wrap+(j?0:1),X=H?k.x-1:N-1,oe=j?k.x+1:0;h[0]<0?(w.push(new s.O(L,K,k.z,oe,k.y)),h[1]<0&&q&&(w.push(new s.O(L,O,k.z,k.x,k.y+1)),w.push(new s.O(L,K,k.z,oe,k.y+1))),h[1]>0&&Y&&(w.push(new s.O(L,O,k.z,k.x,k.y-1)),w.push(new s.O(L,K,k.z,oe,k.y-1)))):h[0]>0?(w.push(new s.O(L,J,k.z,X,k.y)),h[1]<0&&q&&(w.push(new s.O(L,O,k.z,k.x,k.y+1)),w.push(new s.O(L,J,k.z,X,k.y+1))),h[1]>0&&Y&&(w.push(new s.O(L,O,k.z,k.x,k.y-1)),w.push(new s.O(L,J,k.z,X,k.y-1)))):h[1]<0&&q?w.push(new s.O(L,O,k.z,k.x,k.y+1)):Y&&w.push(new s.O(L,O,k.z,k.x,k.y-1))}if(w.length>1){w.sort((L,O)=>L.overscaledZ-O.overscaledZ||L.wrap-O.wrap||L.canonical.z-O.canonical.z||L.canonical.x-O.canonical.x||L.canonical.y-O.canonical.y);let A=0,k=0;for(;k<w.length;)w[k].equals(w[A])?++k:w[++A]=w[k++];w.length=A+1}const M=[];for(const A of w)w.some(k=>A.isChildOf(k))||M.push(A);return w=M.filter(A=>!l.some(k=>!!(A.overscaledZ<x&&k.isChildOf(A))||A.equals(k)||A.isChildOf(k))),w}coveringTiles(l){let h=this.coveringZoomLevel(l);const x=h,w=this.elevation&&this.elevation.exaggeration(),M=w&&!l.isTerrainDEM,A=this.projection.name==="mercator";if(l.minzoom!==void 0&&h<l.minzoom)return[];l.maxzoom!==void 0&&h>l.maxzoom&&(h=l.maxzoom);const k=this.locationCoordinate(this.center),L=this.center.lat,O=1<<h,N=[O*k.x,O*k.y,0],j=this.projection.name==="globe",H=!j,q=s.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,H),Y=j?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),J=O*s.b(1,this.center.lat),K=this._camera.position[2]/s.b(1,this.center.lat),X=[O*Y.x,O*Y.y,K*(H?1:J)],oe=j||w,de=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),fe=this.isLODDisabled(!0)?h:0;let ne;if(this._elevation&&l.isTerrainDEM)ne=1e4*this._elevation.exaggeration();else if(this._elevation){const ue=this._elevation.getMinMaxForVisibleTiles();ne=ue?ue.max:this._centerAltitude}else ne=this._centerAltitude;const ae=l.isTerrainDEM?-ne:this._elevation?this._elevation.getMinElevationBelowMSL():0,me=this.projection.isReprojectedInTileSpace?s.r(this):1,xe=ue=>{const st=new s.M(ue.x+25e-6,ue.y,ue.z),$e=new s.M(ue.x,ue.y+25e-6,ue.z),Ft=ue.toLngLat(),kt=st.toLngLat(),Xt=$e.toLngLat(),Lt=this.locationCoordinate(Ft),Qt=this.locationCoordinate(kt),$t=this.locationCoordinate(Xt),Gt=Math.hypot(Qt.x-Lt.x,Qt.y-Lt.y),Ht=Math.hypot($t.x-Lt.x,$t.y-Lt.y);return Math.sqrt(Gt*Ht)*me/25e-6},_e=ue=>{const Ce=ne,st=ae;return{aabb:s.y(this,O,0,0,0,ue,st,Ce,this.projection),zoom:0,x:0,y:0,minZ:st,maxZ:Ce,wrap:ue,fullyVisible:!1}},be=[];let Ue=[];const ze=h,Fe=l.reparseOverscaled?x:h,Ae=ue=>ue*ue,je=Ae((K-this._centerAltitude)*J),Oe=ue=>{if(!this._elevation||!ue.tileID||!A)return;const Ce=this._elevation.getMinMaxForTile(ue.tileID),st=ue.aabb;Ce?(st.min[2]=Ce.min,st.max[2]=Ce.max,st.center[2]=(st.min[2]+st.max[2])/2):(ue.shouldSplit=qe(ue),ue.shouldSplit||(st.min[2]=st.max[2]=st.center[2]=this._centerAltitude))},qe=ue=>{if(ue.zoom<fe)return!0;if(ue.zoom===ze)return!1;if(ue.shouldSplit!=null)return ue.shouldSplit;const Ce=ue.aabb.distanceX(X),st=ue.aabb.distanceY(X);let $e=je,Ft=1;if(j){$e=Ae(ue.aabb.distanceZ(X));const Lt=Math.pow(2,ue.zoom),Qt=s.l((ue.y+1)/Lt),$t=s.l(ue.y/Lt),Gt=Math.min(Math.max(L,Qt),$t),Ht=s.a0(Gt)/s.a0(L);if(Ft=Gt===L?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ht/this._mercatorScaleRatio),this.zoom<=s.Z&&ue.zoom===ze-1&&Ht>=.9)return!0}else if(M&&($e=Ae(ue.aabb.distanceZ(X)*J)),this.projection.isReprojectedInTileSpace&&x<=5){const Lt=Math.pow(2,ue.zoom),Qt=xe(new s.M((ue.x+.5)/Lt,(ue.y+.5)/Lt));Ft=Qt>.85?1:Qt}const kt=Ce*Ce+st*st+$e,Xt=Ae((1<<ze-ue.zoom)*de*Ft*((Lt,Qt)=>{if(Qt*Ae(.707)<Lt)return 1;const $t=Math.sqrt(Qt/Lt);return $t/(1.4144271570014144+(Math.pow(1.1,$t-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max($e,je),kt));return kt<Xt};if(this.renderWorldCopies)for(let ue=1;ue<=3;ue++)be.push(_e(-ue)),be.push(_e(ue));for(be.push(_e(0));be.length>0;){const ue=be.pop(),Ce=ue.x,st=ue.y;let $e=ue.fullyVisible;const Ft=()=>this.projection.name==="globe"&&(ue.y===0||ue.y===(1<<ue.zoom)-1);if(!$e){let kt=oe?ue.aabb.intersects(q):ue.aabb.intersectsFlat(q);if(kt===0&&Ft()){const Xt=new s.t(ue.zoom,Ce,st);kt=s.x(this,O,Xt,!0).intersects(q)}if(kt===0)continue;$e=kt===2}if(ue.zoom!==ze&&qe(ue))for(let kt=0;kt<4;kt++){const Xt=(Ce<<1)+kt%2,Lt=(st<<1)+(kt>>1),Qt={aabb:A?ue.aabb.quadrant(kt):s.y(this,O,ue.zoom+1,Xt,Lt,ue.wrap,ue.minZ,ue.maxZ,this.projection),zoom:ue.zoom+1,x:Xt,y:Lt,wrap:ue.wrap,fullyVisible:$e,tileID:void 0,shouldSplit:void 0,minZ:ue.minZ,maxZ:ue.maxZ};M&&!j&&(Qt.tileID=new s.O(ue.zoom+1===ze?Fe:ue.zoom+1,ue.wrap,ue.zoom+1,Xt,Lt),Oe(Qt)),be.push(Qt)}else{const kt=ue.zoom===ze?Fe:ue.zoom;if(l.minzoom&&l.minzoom>kt)continue;if(!$e){let $t=oe?ue.aabb.intersectsPrecise(q):ue.aabb.intersectsPreciseFlat(q);if($t===0&&Ft()){const Gt=new s.t(ue.zoom,Ce,st);$t=s.x(this,O,Gt,!0).intersectsPrecise(q)}if($t===0)continue}const Xt=N[0]-(.5+Ce+(ue.wrap<<ue.zoom))*(1<<h-ue.zoom),Lt=N[1]-.5-st,Qt=ue.tileID?ue.tileID:new s.O(kt,ue.wrap,ue.zoom,Ce,st);Ue.push({tileID:Qt,distanceSq:Xt*Xt+Lt*Lt})}}if(this.fogCullDistSq){const ue=this.fogCullDistSq,Ce=this.horizonLineFromTop();Ue=Ue.filter(st=>{const $e=[0,0,0,1],Ft=[s.J,s.J,0,1],kt=this.calculateFogTileMatrix(st.tileID.toUnwrapped());s.e.transformMat4($e,$e,kt),s.e.transformMat4(Ft,Ft,kt);const Xt=s.e.min([],$e,Ft),Lt=s.e.max([],$e,Ft),Qt=s.z(Xt,Lt);if(Qt===0)return!0;let $t=!1;const Gt=this._elevation;if(Gt&&Qt>ue&&Ce!==0){const Ht=this.calculateProjMatrix(st.tileID.toUnwrapped());let Ri;l.isTerrainDEM||(Ri=Gt.getMinMaxForTile(st.tileID)),Ri||(Ri={min:ae,max:ne});const hi=s._(this.rotation),hn=[hi[0]*s.J,hi[1]*s.J,Ri.max];s.v.transformMat4(hn,hn,Ht),$t=(1-hn[1])*this.height*.5<Ce}return Qt<ue||$t})}return Ue.sort((ue,Ce)=>ue.distanceSq-Ce.distanceSq).map(ue=>ue.tileID)}resize(l,h){this.width=l,this.height=h,this.pixelsToGLUnits=[2/l,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const h=s.c(l.lat,-s.A,s.A),x=this.projection.project(l.lng,h);return new s.P(x.x*this.worldSize,x.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.b(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,h){let x,w;const M=this.centerPoint;if(this.projection.name==="globe"){const k=this.worldSize;x=(h.x-M.x)/k,w=(h.y-M.y)/k}else{const k=this.pointCoordinate(h),L=this.pointCoordinate(M);x=k.x-L.x,w=k.y-L.y}const A=this.locationCoordinate(l);this.setLocation(new s.M(A.x-x,A.y-w))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,h){const x=h?s.b(h,l.lat):void 0,w=this.projection.project(l.lng,l.lat);return new s.M(w.x,w.y,x)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,h){const x=h??this._centerAltitude,w=[l.x,l.y,0,1],M=[l.x,l.y,1,1];s.e.transformMat4(w,w,this.pixelMatrixInverse),s.e.transformMat4(M,M,this.pixelMatrixInverse);const A=M[3];s.e.scale(w,w,1/w[3]),s.e.scale(M,M,1/A);const k=w[2],L=M[2];return{p0:w,p1:M,t:k===L?0:(x-k)/(L-k)}}screenPointToMercatorRay(l){const h=[l.x,l.y,0,1],x=[l.x,l.y,1,1];return s.e.transformMat4(h,h,this.pixelMatrixInverse),s.e.transformMat4(x,x,this.pixelMatrixInverse),s.e.scale(h,h,1/h[3]),s.e.scale(x,x,1/x[3]),h[2]=s.b(h[2],this._center.lat)*this.worldSize,x[2]=s.b(x[2],this._center.lat)*this.worldSize,s.e.scale(h,h,1/this.worldSize),s.e.scale(x,x,1/this.worldSize),new s.R([h[0],h[1],h[2]],s.v.normalize([],s.v.sub([],x,h)))}rayIntersectionCoordinate(l){const{p0:h,p1:x,t:w}=l,M=s.b(h[2],this._center.lat),A=s.b(x[2],this._center.lat);return new s.M(s.n(h[0],x[0],w)/this.worldSize,s.n(h[1],x[1],w)/this.worldSize,s.n(M,A,w))}pointCoordinate(l,h=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,h)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let h=this.projection.pointCoordinate3D(this,l.x,l.y);if(h)return new s.M(h[0],h[1],h[2]);let x=0,w=this.horizonLineFromTop();if(l.y>w)return this.pointCoordinate(l);const M=.02*w,A=l.clone();for(let k=0;k<10&&w-x>M;k++){A.y=s.n(x,w,.66);const L=this.projection.pointCoordinate3D(this,A.x,A.y);L?(w=A.y,h=L):x=A.y}return h?new s.M(h[0],h[1],h[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}isPointOnSurface(l){if(l.y<0||l.y>this.height||l.x<0||l.x>this.width)return!1;if(this.elevation||this.zoom>=s.G)return!this.isPointAboveHorizon(l);const h=this.pointCoordinate(l);return h.y>=0&&h.y<=1}_coordinatePoint(l,h){const x=h&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,w=[l.x*this.worldSize,l.y*this.worldSize,x+l.toAltitude(),1];return s.e.transformMat4(w,w,this.pixelMatrix),w[3]>0?new s.P(w[0]/w[3],w[1]/w[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:l,left:h}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,M=this.pointLocation3D(new s.P(h,l)),A=this.pointLocation3D(new s.P(w,l)),k=this.pointLocation3D(new s.P(w,x)),L=this.pointLocation3D(new s.P(h,x));let O=Math.min(M.lng,A.lng,k.lng,L.lng),N=Math.max(M.lng,A.lng,k.lng,L.lng),j=Math.min(M.lat,A.lat,k.lat,L.lat),H=Math.max(M.lat,A.lat,k.lat,L.lat);const q=Math.pow(2,-this.zoom)/16*270,Y=this.projection.name==="globe"?1:4,J=(K,X,oe,de,fe)=>{const ne=(K+oe)/2,ae=(X+de)/2,me=new s.P(ne,ae),{lng:xe,lat:_e}=this.pointLocation3D(me),be=Math.max(0,O-xe,j-_e,xe-N,_e-H);O=Math.min(O,xe),N=Math.max(N,xe),j=Math.min(j,_e),H=Math.max(H,_e),(fe<Y||be>q)&&(J(K,X,ne,ae,fe+1),J(ne,ae,oe,de,fe+1))};if(J(h,l,w,l,1),J(w,l,w,x,1),J(w,x,h,x,1),J(h,x,h,l,1),this.projection.name==="globe"){const[K,X]=s.B(this);K?(H=90,N=180,O=-180):X&&(j=-90,N=180,O=-180)}return new s.D(new s.L(O,j),new s.L(N,H))}_getBoundsRectangular(l,h){const{top:x,left:w}=this._edgeInsets,M=this.height-this._edgeInsets.bottom,A=this.width-this._edgeInsets.right,k=new s.P(w,x),L=new s.P(A,x),O=new s.P(A,M),N=new s.P(w,M);let j=this.pointCoordinate(k,l),H=this.pointCoordinate(L,l);const q=this.pointCoordinate(O,h),Y=this.pointCoordinate(N,h),J=(K,X)=>(X.y-K.y)/(X.x-K.x);return j.y>1&&H.y>=0?j=new s.M((1-Y.y)/J(Y,j)+Y.x,1):j.y<0&&H.y<=1&&(j=new s.M(-Y.y/J(Y,j)+Y.x,0)),H.y>1&&j.y>=0?H=new s.M((1-q.y)/J(q,H)+q.x,1):H.y<0&&j.y<=1&&(H=new s.M(-q.y/J(q,H)+q.x,0)),new s.D().extend(this.coordinateLocation(j)).extend(this.coordinateLocation(H)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(q))}_getBoundsRectangularTerrain(){const l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=l.visibleDemTiles.reduce((x,w)=>{if(w.dem){const M=w.dem.tree;x.min=Math.min(x.min,M.minimums[0]),x.max=Math.max(x.max,M.maximums[0])}return x},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*l.exaggeration(),h.max*l.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,x=this.height/2-h*(1-this._horizonShift);return l?Math.max(0,x):x}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-s.A,this.maxLat=s.A,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.E(this.minLng)*this.tileSize,this.worldMaxX=s.E(this.maxLng)*this.tileSize,this.worldMinY=s.H(this.maxLat)*this.tileSize,this.worldMaxY=s.H(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,h){return this.projection.createTileMatrix(this,h,l)}calculateDistanceTileData(l){const h=l.key,x=this._distanceTileDataCache;if(x[h])return x[h];const w=l.canonical,M=1/this.height,A=this.cameraWorldSize,k=A/this.zoomScale(w.z),L=(w.x+Math.pow(2,w.z)*l.wrap)*k,O=w.y*k,N=this.point;N.x*=A/this.worldSize,N.y*=A/this.worldSize;const j=this.angle,H=Math.sin(-j),q=-Math.cos(-j);return x[h]={bearing:[H,q],center:[(N.x-L)*M,(N.y-O)*M],scale:k/s.J*M},x[h]}calculateFogTileMatrix(l){const h=l.key,x=this._fogTileMatrixCache;if(x[h])return x[h];const w=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return s.m.multiply(w,this.worldToFogMatrix,w),x[h]=new Float32Array(w),x[h]}calculateProjMatrix(l,h=!1,x=!1){const w=l.key;let M;if(M=x?this._expandedProjMatrixCache:h?this._alignedProjMatrixCache:this._projMatrixCache,M[w])return M[w];const A=this.calculatePosMatrix(l,this.worldSize);let k;return k=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:x?this.expandedFarZProjMatrix:h?this.alignedProjMatrix:this.projMatrix,s.m.multiply(A,k,A),M[w]=new Float32Array(A),M[w]}calculatePixelsToTileUnitsMatrix(l){const h=l.tileID.key,x=this._pixelsToTileUnitsCache;if(x[h])return x[h];const w=s.K(l,this);return x[h]=w,x[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const l=1/this.worldSize,h=s.m.fromScaling([],[l,l,l]);return s.m.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const l=this._elevation;this._updateCameraState();const h=s.b(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(h),w=this._camera.forward(),M=s.b(1,this._center.lat);x[2]/=M,w[2]/=M,s.v.normalize(w,w);const A=l.raycast(x,w,l.exaggeration());if(A){const k=s.v.scaleAndAdd([],x,w,A),L=new s.M(k[0],k[1],s.b(k[2],s.l(k[1]))),O=(L.z+s.v.length([L.x-x[0],L.y-x[1],L.z-x[2]*M]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=L.toAltitude(),this._center=this.coordinateLocation(L),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;const h=this._elevation,x=s.b(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(x),M=h.getAtPointOrZero(new s.M(...w)),A=this.pixelsPerMeter/this.worldSize*M,k=this._minimumHeightOverTerrain(),L=w[2]-A;if(L<=k)if(L<0||l){const O=this.locationCoordinate(this._center,this._centerAltitude),N=[w[0],w[1],O.z-w[2]],j=s.v.length(N);N[2]-=(k-L)/this._pixelsPerMercatorPixel;const H=s.v.length(N);if(H===0)return;s.v.scale(N,N,j/H*this._pixelsPerMercatorPixel),this._camera.position=[w[0],w[1],O.z*this._pixelsPerMercatorPixel-N[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){const H=this.center;return H.lat=s.c(H.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(H.lng=s.c(H.lng,this.minLng,this.maxLng)),this.center=H,void(this._constraining=!1)}const h=this._unmodified,{x,y:w}=this.point;let M=0,A=x,k=w;const L=this.width/2,O=this.height/2,N=this.worldMinY*this.scale,j=this.worldMaxY*this.scale;if(w-O<N&&(k=N+O),w+O>j&&(k=j-O),j-N<this.height&&(M=Math.max(M,this.height/(j-N)),k=(j+N)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const H=this.worldMinX*this.scale,q=this.worldMaxX*this.scale,Y=this.worldSize/2-(H+q)/2;A=(x+Y+this.worldSize)%this.worldSize-Y,A-L<H&&(A=H+L),A+L>q&&(A=q-L),q-H<this.width&&(M=Math.max(M,this.width/(q-H)),A=(q+H)/2)}A===x&&k===w||(this.center=this.unproject(new s.P(A,k))),M&&(this.zoom+=this.scaleZoom(M)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,h=this.projection.name==="globe",x=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.b(1,this.center.lat)/s.b(1,s.$));const w=s.N(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,w),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const M=this.projection.zAxisUnit==="meters"?x:1,A=this._camera.getWorldToCamera(this.worldSize,M);let k;const L=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(L[8]=2*-l.x/this.width,L[9]=2*l.y/this.height,this.isOrthographic){let _e=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),be=_e*this.aspect,Ue=-be,ze=-_e;be-=l.x,Ue-=l.x,_e+=l.y,ze+=l.y,k=this._camera.getCameraToClipOrthographic(Ue,be,ze,_e,this._nearZ,this._farZ),((Fe,Ae,je,Oe)=>{for(let qe=0;qe<16;qe++)Fe[qe]=Zi(Ae[qe],je[qe],Oe)})(k,k,L,Jt(this.pitch>=15?1:this.pitch/15))}else k=L;const O=s.m.mul([],L,A);let N=s.m.mul([],k,A);if(this.projection.isReprojectedInTileSpace){const _e=this.locationCoordinate(this.center),be=s.m.identity([]);s.m.translate(be,be,[_e.x*this.worldSize,_e.y*this.worldSize,0]),s.m.multiply(be,be,s.Q(this)),s.m.translate(be,be,[-_e.x*this.worldSize,-_e.y*this.worldSize,0]),s.m.multiply(N,N,be),s.m.multiply(O,O,be),this.inverseAdjustmentMatrix=s.S(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.m.scale([],N,[this.worldSize,this.worldSize,this.worldSize/M,1]),this.projMatrix=N,this.invProjMatrix=s.m.invert(new Float64Array(16),this.projMatrix),h){const _e=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);_e[8]=2*-l.x/this.width,_e[9]=2*l.y/this.height,this.expandedFarZProjMatrix=s.m.mul([],_e,A)}else this.expandedFarZProjMatrix=this.projMatrix;const j=s.m.invert([],k);this.frustumCorners=s.T.fromInvProjectionMatrix(j,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!h);const H=new Float32Array(16);s.m.identity(H),s.m.scale(H,H,[1,-1,1]),s.m.rotateX(H,H,this._pitch),s.m.rotateZ(H,H,this.angle);const q=s.m.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.m.clone(q);const Y=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;q[8]=2*-l.x/this.width,q[9]=2*(l.y+Y)/this.height,this.skyboxMatrix=s.m.multiply(H,q,H);const J=this.point,K=J.x,X=J.y,oe=this.width%2/2,de=this.height%2/2,fe=Math.cos(this.angle),ne=Math.sin(this.angle),ae=K-Math.round(K)+fe*oe+ne*de,me=X-Math.round(X)+fe*de+ne*oe,xe=new Float64Array(N);if(s.m.translate(xe,xe,[ae>.5?ae-1:ae,me>.5?me-1:me,0]),this.alignedProjMatrix=xe,N=s.m.create(),s.m.scale(N,N,[this.width/2,-this.height/2,1]),s.m.translate(N,N,[1,-1,0]),this.labelPlaneMatrix=N,N=s.m.create(),s.m.scale(N,N,[1,-1,1]),s.m.translate(N,N,[-1,-1,0]),s.m.scale(N,N,[2/this.width,2/this.height,1]),this.glCoordMatrix=N,this.pixelMatrix=s.m.multiply(new Float64Array(16),this.labelPlaneMatrix,O),this._calcFogMatrices(),this._distanceTileDataCache={},N=s.m.invert(new Float64Array(16),this.pixelMatrix),!N)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=N,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.V(this);const _e=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.v.transformMat4(_e,_e,A),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=N;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,x=this._camera.position,w=1/this.height/this._pixelsPerMercatorPixel,M=[l,l,h];s.v.scale(M,M,w),s.v.scale(x,x,-1),s.v.multiply(x,x,M);const A=s.m.create();s.m.translate(A,A,x),s.m.scale(A,A,M),this.mercatorFogMatrix=A,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,h,w)}_computeCameraPosition(l){const h=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,x=this._camera.forward(),w=this.point,M=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-l/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-x[0]*M,w.y/this.worldSize-x[1]*M,l/this.worldSize*this._centerAltitude-x[2]*M]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),x=this._camera.position[2],w=l[2];let M=1;this.projection.wrap&&(this.center=this.center.wrap()),w>0&&(M=Math.min((h-x)/w,1)),this._camera.position=s.v.scaleAndAdd([],this._camera.position,l,M),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,h=this._camera.forward(),{pitch:x,bearing:w}=this._camera.getPitchBearing(),M=s.b(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,A=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.d(this._maxPitch)),k=Math.max((l[2]-M)/Math.cos(x),A),L=this._zoomFromMercatorZ(k);s.v.scaleAndAdd(l,l,h,k),this._pitch=s.c(x,s.d(this.minPitch),s.d(this.maxPitch)),this.angle=s.w(w,-Math.PI,Math.PI),this._setZoom(s.c(L,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.M(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){let h=0,x=s.G,w=0,M=1/0;for(;x-h>1e-6&&x>h;){const A=h+.5*(x-h),k=this.tileSize*Math.pow(2,A),L=this.getCameraToCenterDistance(this.projection,A,k),O=this.scaleZoom(L/(l*this.tileSize)),N=Math.abs(A-O);N<M&&(M=N,w=A),A<O?h=A:x=A}return w}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.X("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,h){const x=Math.min(l.x,h.x),w=Math.max(l.x,h.x),M=Math.min(l.y,h.y),A=Math.max(l.y,h.y);if(M<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const k=[new s.P(x,M),new s.P(w,A),new s.P(x,A),new s.P(w,M)],L=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(const N of k){const j=this.pointRayIntersection(N);if(j.t<0)return!0;const H=this.rayIntersectionCoordinate(j);if(H.x<L||H.y<0||H.x>O||H.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.Y(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(l,h){const x=s.v.length(s.v.sub([],this._camera.position,l)),w=this._zoomFromMercatorZ(x)+h;return x-this._mercatorZfromZoom(w)}getCameraPoint(){if(this.projection.name==="globe"){const l=function([h,x,w],M){const A=[h,x,w,1];s.e.transformMat4(A,A,M);const k=A[3]=Math.max(A[3],1e-6);return A[0]/=k,A[1]/=k,A[2]/=k,A}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(l[0],l[1])}{const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,l))}}getCameraToCenterDistance(l,h=this.zoom,x=this.worldSize){const w=s.N(l,h,this.width,this.height,1024),M=l.pixelSpaceConversion(this.center.lat,x,w);let A=.5/Math.tan(.5*this._fov)*this.height*M;return this.isOrthographic&&(A=Zi(1,A,Jt(this.pitch>=15?1:this.pitch/15))),A}getWorldToCameraMatrix(){const l=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.m.multiply(l,l,this.globeMatrix),l}getFrustum(l){return s.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,this.projection.zAxisUnit==="meters")}}function kn(g){const{userImage:l}=g;return!!(l&&l.render&&l.render())&&(g.data.replace(new Uint8Array(l.data.buffer)),!0)}class Ln extends s.a6{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(l){this.images[l]={},this.loaded[l]=!1,this.updatedImages[l]={},this.patterns[l]={},this.callbackDispatchedThisFrame[l]={},this.atlasImage[l]=new s.a5({width:1,height:1})}isLoaded(){for(const l in this.loaded)if(!this.loaded[l])return!1;return!0}setLoaded(l,h){if(this.loaded[h]!==l&&(this.loaded[h]=l,l)){for(const{ids:x,callback:w}of this.requestors)this._notify(x,h,w);this.requestors=[]}}hasImage(l,h){return!!this.getImage(l,h)}getImage(l,h){return this.images[h][l]}addImage(l,h,x){this._validate(l,x)&&(this.images[h][l]=x)}_validate(l,h){let x=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new s.a7(new Error(`Image "${l}" has invalid "stretchX" value`))),x=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new s.a7(new Error(`Image "${l}" has invalid "stretchY" value`))),x=!1),this._validateContent(h.content,h)||(this.fire(new s.a7(new Error(`Image "${l}" has invalid "content" value`))),x=!1),x}_validateStretch(l,h){if(!l)return!0;let x=0;for(const w of l){if(w[0]<x||w[1]<w[0]||h<w[1])return!1;x=w[1]}return!0}_validateContent(l,h){return!(l&&(l.length!==4||l[0]<0||h.data.width<l[0]||l[1]<0||h.data.height<l[1]||l[2]<0||h.data.width<l[2]||l[3]<0||h.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,h,x){x.version=this.images[h][l].version+1,this.images[h][l]=x,this.updatedImages[h][l]=!0}removeImage(l,h){const x=this.images[h][l];delete this.images[h][l],delete this.patterns[h][l],x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()}listImages(l){return Object.keys(this.images[l])}getImages(l,h,x){let w=!0;const M=!!this.loaded[h];if(!M)for(const A of l)this.images[h][A]||(w=!1);M||w?this._notify(l,h,x):this.requestors.push({ids:l,scope:h,callback:x})}getUpdatedImages(l){return this.updatedImages[l]}_notify(l,h,x){const w={};for(const M of l){this.images[h][M]||this.fire(new s.a8("styleimagemissing",{id:M}));const A=this.images[h][M];A?w[M]={data:A.data.clone(),pixelRatio:A.pixelRatio,sdf:A.sdf,version:A.version,stretchX:A.stretchX,stretchY:A.stretchY,content:A.content,hasRenderCallback:!!(A.userImage&&A.userImage.render)}:s.X(`Image "${M}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}x(null,w)}getPixelSize(l){const{width:h,height:x}=this.atlasImage[l];return{width:h,height:x}}getPattern(l,h){const x=this.patterns[h][l],w=this.getImage(l,h);if(!w)return null;if(x&&x.position.version===w.version)return x.position;if(x)x.position.version=w.version;else{const M={w:w.data.width+2,h:w.data.height+2,x:0,y:0},A=new s.ab(M,w);this.patterns[h][l]={bin:M,position:A}}return this._updatePatternAtlas(h),this.patterns[h][l].position}bind(l,h){const x=l.gl;let w=this.atlasTexture[h];w?this.dirty&&(w.update(this.atlasImage[h]),this.dirty=!1):(w=new s.a9(l,this.atlasImage[h],x.RGBA),this.atlasTexture[h]=w),w.bind(x.LINEAR,x.CLAMP_TO_EDGE)}_updatePatternAtlas(l){const h=[];for(const A in this.patterns[l])h.push(this.patterns[l][A].bin);const{w:x,h:w}=s.aa(h),M=this.atlasImage[l];M.resize({width:x||1,height:w||1});for(const A in this.patterns[l]){const{bin:k}=this.patterns[l][A],L=k.x+1,O=k.y+1,N=this.images[l][A].data,j=N.width,H=N.height;s.a5.copy(N,M,{x:0,y:0},{x:L,y:O},{width:j,height:H}),s.a5.copy(N,M,{x:0,y:H-1},{x:L,y:O-1},{width:j,height:1}),s.a5.copy(N,M,{x:0,y:0},{x:L,y:O+H},{width:j,height:1}),s.a5.copy(N,M,{x:j-1,y:0},{x:L-1,y:O},{width:1,height:H}),s.a5.copy(N,M,{x:0,y:0},{x:L+j,y:O},{width:1,height:H})}this.dirty=!0}beginFrame(){for(const l in this.images)this.callbackDispatchedThisFrame[l]={}}dispatchRenderCallbacks(l,h){for(const x of l){if(this.callbackDispatchedThisFrame[h][x])continue;this.callbackDispatchedThisFrame[h][x]=!0;const w=this.images[h][x];kn(w)&&this.updateImage(x,h,w)}}}const jn=new s.ac({anchor:new s.ad(s.ae.light.anchor),position:new s.af(s.ae.light.position),color:new s.ad(s.ae.light.color),intensity:new s.ad(s.ae.light.intensity)});class yr extends s.a6{constructor(l,h="flat"){super(),this._transitionable=new s.ag(jn),this.setLight(l,h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,h,x={}){this._validate(s.ah,l,x)||(this._transitionable.setTransitionOrValue(l),this.id=h)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,h,x){return(!x||x.validate!==!1)&&s.ai(this,l.call(s.aj,s.ak({value:h,style:{glyphs:!0,sprite:!0},styleSpec:s.ae})))}}const es=new s.ac({source:new s.ad(s.ae.terrain.source),exaggeration:new s.ad(s.ae.terrain.exaggeration)});let ss=class extends s.a6{constructor(g,l,h,x){super(),this.scope=h,this._transitionable=new s.ag(es,h,x),this._transitionable.setTransitionOrValue(g,x),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(g,l){this._transitionable.setTransitionOrValue(g,l)}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}getExaggeration(g){return this._transitioning.possiblyEvaluate(new s.al(g)).get("exaggeration")}isZoomDependent(){const g=this._transitionable._values.exaggeration;return g!=null&&g.value!=null&&g.value.expression!=null&&g.value.expression instanceof s.am}};const ts=45,xr=65,Ur=.05;function eo(g,l,h,x){const w=s.an(ts,xr,h),[M,A]=qa(g,x);let k=1-Math.min(1,Math.exp((l-M)/(A-M)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*w*g.alpha}function qa(g,l){const h=.5/Math.tan(.5*l);return[g.range[0]+h,g.range[1]+h]}function gh(g,l,h,x,w){const M=s.v.transformMat4([],[l,h,x],w.mercatorFogMatrix);return eo(g,s.v.length(M),w.pitch,w._fov)}function Nc(g,l,h,x,w,M,A){const k=[[h,x,0],[w,x,0],[w,M,0],[h,M,0]];let L=Number.MAX_VALUE,O=-Number.MAX_VALUE;for(const N of k){const j=s.v.transformMat4([],N,l),H=s.v.length(j);L=Math.min(L,H),O=Math.max(O,H)}return[eo(g,L,A.pitch,A._fov),eo(g,O,A.pitch,A._fov)]}const Vc=new s.ac({range:new s.ad(s.ae.fog.range),color:new s.ad(s.ae.fog.color),"high-color":new s.ad(s.ae.fog["high-color"]),"space-color":new s.ad(s.ae.fog["space-color"]),"horizon-blend":new s.ad(s.ae.fog["horizon-blend"]),"star-intensity":new s.ad(s.ae.fog["star-intensity"]),"vertical-range":new s.ad(s.ae.fog["vertical-range"])});class _h extends s.a6{constructor(l,h){super(),this._transitionable=new s.ag(Vc),this.set(l),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){const l=this._transform,h=l.projection.name==="globe",x=s.ao(l.zoom),w=this.properties.get("range"),M=[.5,3];return{range:h?[s.n(M[0],w[0],x),s.n(M[1],w[1],x)]:w,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,h={}){if(this._validate(s.ap,l,h))return;const x=s.ak({},l);for(const w of Object.keys(s.ae.fog))x[w]===void 0&&(x[w]=s.ae.fog[w].default);this._transitionable.setTransitionOrValue(x)}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.an(ts,xr,l))*h.a}getOpacityAtLatLng(l,h){return this._transform.projection.supportsFog?function(x,w,M){const A=s.M.fromLngLat(w),k=M.elevation?M.elevation.getAtPointOrZero(A):0;return gh(x,A.x,A.y,k,M)}(this.state,l,h):0}getOpacityForTile(l){if(!this._transform.projection.supportsFog)return[1,1];const h=this._transform.calculateFogTileMatrix(l.toUnwrapped());return Nc(this.state,h,0,0,s.J,s.J,this._transform)}getOpacityForBounds(l,h,x,w,M){return this._transform.projection.supportsFog?Nc(this.state,l,h,x,w,M,this._transform):[1,1]}getFovAdjustedRange(l){return this._transform.projection.supportsFog?qa(this.state,l):[0,1]}isVisibleOnFrustum(l){if(!this._transform.projection.supportsFog)return!1;const h=[4,5,6,7];for(const x of h){const w=l.points[x];let M;if(w[2]>=0)M=w;else{const A=l.points[x-4];M=s.aq(A,w,A[2]/(A[2]-w[2]))}if(gh(this.state,M[0],M[1],0,this._transform)>=Ur)return!0}return!1}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,h,x){return(!x||x.validate!==!1)&&s.ai(this,l.call(s.aj,s.ak({value:h,style:{glyphs:!0,sprite:!0},styleSpec:s.ae})))}}class zl extends s.a6{constructor(l,h,x,w){super(),this.scope=x,this._options=l,this.properties=new s.ar(h),this._transitionable=new s.ag(h,x,new Map(w)),this._transitionable.setTransitionOrValue(l.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(l){this._transitionable.setTransitionOrValue(this._options.properties,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(l,h){this._options=l,this._transitionable.setTransitionOrValue(l.properties,h)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const $o=new s.ac({color:new s.ad(s.ae.properties_light_ambient.color),intensity:new s.ad(s.ae.properties_light_ambient.intensity)}),tp=new s.ac({direction:new s.as(s.ae.properties_light_directional.direction),color:new s.ad(s.ae.properties_light_directional.color),intensity:new s.ad(s.ae.properties_light_directional.intensity),"cast-shadows":new s.ad(s.ae.properties_light_directional["cast-shadows"]),"shadow-intensity":new s.ad(s.ae.properties_light_directional["shadow-intensity"])});class Cr{constructor(l,h,x,w){this.screenBounds=l,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=x,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,w)}static createFromScreenPoints(l,h){let x,w;if(l instanceof s.P||typeof l[0]=="number"){const M=s.P.convert(l);x=[M],w=h.isPointAboveHorizon(M)}else{const M=s.P.convert(l[0]),A=s.P.convert(l[1]);x=[M,A],w=s.at(M,A).every(k=>h.isPointAboveHorizon(k))}return new Cr(x,h.getCameraPoint(),w,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(l){return s.at(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const h=this.screenBounds[0],x=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],w=s.at(h,x,0,!1);return this.cameraPoint.y>x.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<x.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=x.x?w[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(w[3]=this.cameraPoint)),s.au(w,l)}bufferedCameraGeometryGlobe(l){const h=this.screenBounds[0],x=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],w=s.at(h,x,l),M=this.cameraPoint.clone();switch(3*((M.y>h.y)+(M.y>x.y))+((M.x>h.x)+(M.x>x.x))){case 0:w[0]=M,w[4]=M.clone();break;case 1:w.splice(1,0,M);break;case 2:w[1]=M;break;case 3:w.splice(4,0,M);break;case 5:w.splice(2,0,M);break;case 6:w[3]=M;break;case 7:w.splice(3,0,M);break;case 8:w[2]=M}return w}containsTile(l,h,x,w=0){const M=l.queryPadding/h._pixelsPerMercatorPixel+1,A=x?this._bufferedCameraMercator(M,h):this._bufferedScreenMercator(M,h);let k=l.tileID.wrap+(A.unwrapped?w:0);const L=A.polygon.map(K=>s.av(l.tileTransform,K,k));if(!s.aw(L,0,0,s.J,s.J))return;k=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?w:0);const O=this.screenGeometryMercator.polygon.map(K=>s.ax(l.tileTransform,K,k)),N=O.map(K=>new s.P(K[0],K[1])),j=h.getFreeCameraOptions().position||new s.M(0,0,0),H=s.ax(l.tileTransform,j,k),q=O.map(K=>{const X=s.v.sub(K,K,H);return s.v.normalize(X,X),new s.R(H,X)}),Y=s.ay(l,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:N,tilespaceRays:q,bufferedTilespaceGeometry:L,bufferedTilespaceBounds:(J=s.az(L),J.min.x=s.c(J.min.x,0,s.J),J.min.y=s.c(J.min.y,0,s.J),J.max.x=s.c(J.max.x,0,s.J),J.max.y=s.c(J.max.y,0,s.J),J),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:Y};var J}_bufferedScreenMercator(l,h){const x=vs(l);if(this._screenRaycastCache[x])return this._screenRaycastCache[x];{let w;return w=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(l),h):{polygon:this.bufferedScreenGeometry(l).map(M=>h.pointCoordinate3D(M)),unwrapped:!0},this._screenRaycastCache[x]=w,w}}_bufferedCameraMercator(l,h){const x=vs(l);if(this._cameraRaycastCache[x])return this._cameraRaycastCache[x];{let w;return w=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),h):{polygon:this.bufferedCameraGeometry(l).map(M=>h.pointCoordinate3D(M)),unwrapped:!0},this._cameraRaycastCache[x]=w,w}}_projectAndResample(l,h){const x=function(M,A){const k=s.m.multiply([],A.pixelMatrix,A.globeMatrix),L=[0,-s.aC,0,1],O=[0,s.aC,0,1],N=[0,0,0,1];s.e.transformMat4(L,L,k),s.e.transformMat4(O,O,k),s.e.transformMat4(N,N,k);const j=new s.P(L[0]/L[3],L[1]/L[3]),H=new s.P(O[0]/O[3],O[1]/O[3]),q=s.aA(M,j)&&L[3]<N[3],Y=s.aA(M,H)&&O[3]<N[3];if(!q&&!Y)return null;const J=function(me,xe,_e){for(let be=1;be<me.length;be++){const Ue=ea(xe.pointCoordinate3D(me[be-1]).x),ze=ea(xe.pointCoordinate3D(me[be]).x);if(_e<0){if(Ue<ze)return{idx:be,t:-Ue/(ze-1-Ue)}}else if(ze<Ue)return{idx:be,t:(1-Ue)/(ze+1-Ue)}}return null}(M,A,q?-1:1);if(!J)return null;const{idx:K,t:X}=J;let oe=K>1?jc(M.slice(0,K),A):[],de=K<M.length?jc(M.slice(K),A):[];oe=oe.map(me=>new s.P(ea(me.x),me.y)),de=de.map(me=>new s.P(ea(me.x),me.y));const fe=[...oe];fe.length===0&&fe.push(de[de.length-1]);const ne=s.n(fe[fe.length-1].y,(de.length===0?oe[0]:de[0]).y,X);let ae;return ae=q?[new s.P(0,ne),new s.P(0,0),new s.P(1,0),new s.P(1,ne)]:[new s.P(1,ne),new s.P(1,1),new s.P(0,1),new s.P(0,ne)],fe.push(...ae),de.length===0?fe.push(oe[0]):fe.push(...de),{polygon:fe.map(me=>new s.M(me.x,me.y)),unwrapped:!1}}(l,h);if(x)return x;const w=function(M,A){let k=!1,L=-1/0,O=0;for(let j=0;j<M.length-1;j++)M[j].x>L&&(L=M[j].x,O=j);for(let j=0;j<M.length-1;j++){const H=(O+j)%(M.length-1),q=M[H],Y=M[H+1];Math.abs(q.x-Y.x)>.5&&(q.x<Y.x?(q.x+=1,H===0&&(M[M.length-1].x+=1)):(Y.x+=1,H+1===M.length-1&&(M[0].x+=1)),k=!0)}const N=s.E(A.center.lng);return k&&N<Math.abs(N-1)&&M.forEach(j=>{j.x-=1}),{polygon:M,unwrapped:k}}(jc(l,h).map(M=>new s.P(ea(M.x),M.y)),h);return{polygon:w.polygon.map(M=>new s.M(M.x,M.y)),unwrapped:w.unwrapped}}}function jc(g,l){return s.aB(g,h=>{const x=l.pointCoordinate3D(h);h.x=x.x,h.y=x.y},1/256)}function ea(g){return g<0?1+g%1:g%1}function vs(g){return 100*g|0}function ta(g,l,h,x,w){const M=function(A,k){if(A)return w(A);if(k){g.url&&k.tiles&&g.tiles&&delete g.tiles;const L=s.p(s.ak(k,g),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(L.vectorLayers=k.vector_layers,L.vectorLayerIds=L.vectorLayers.map(O=>O.id)),L.tiles=l.canonicalizeTileset(L,g.url),w(null,L)}};return g.url?s.a1(l.transformRequest(l.normalizeSourceURL(g.url,null,h,x),s.a2.Source),M):s.a4.frame(()=>M(null,g))}class Bs{constructor(l,h,x){this.bounds=s.D.convert(this.validateBounds(l)),this.minzoom=h||0,this.maxzoom=x||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const h=Math.pow(2,l.z),x=Math.floor(s.E(this.bounds.getWest())*h),w=Math.floor(s.H(this.bounds.getNorth())*h),M=Math.ceil(s.E(this.bounds.getEast())*h),A=Math.ceil(s.H(this.bounds.getSouth())*h);return l.x>=x&&l.x<M&&l.y>=w&&l.y<A}}class De extends s.a6{constructor(l,h,x,w){if(super(),this.id=l,this.dispatcher=x,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.ak(this,s.p(h,["url","scheme","tileSize","promoteId"])),this._options=s.ak({type:"vector"},h),this._collectResourceTiming=!!h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w),this._tileWorkers={},this._deduped=new s.aD}load(l){this._loaded=!1,this.fire(new s.a8("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,x=this.map._worldview;this._tileJSONRequest=ta(this._options,this.map._requestManager,h,x,(w,M)=>{this._tileJSONRequest=null,this._loaded=!0,w?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),x&&x.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${x}`),this.fire(new s.a7(w))):M&&(s.ak(this,M),M.bounds&&(this.tileBounds=new Bs(M.bounds,this.minzoom,this.maxzoom)),s.aH(M.tiles,this.map._requestManager._customAccessToken),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))),l&&l(w)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=s.aE(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.ak({},this._options)}loadTile(l,h){const x=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(x,s.a2.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.a4.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:l.isExtraShadowCaster};if(w.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired")l.state==="loading"?l.reloadCallback=h:l.request=l.actor.send("reloadTile",w,M.bind(this));else if(l.actor=this._tileWorkers[x]=this._tileWorkers[x]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",w,M.bind(this),void 0,!0);else{const A=s.aF.call({deduped:this._deduped},w,(k,L)=>{k||!L?M.call(this,k):(w.data={cacheControl:L.cacheControl,expires:L.expires,rawData:L.rawData.slice(0)},l.actor&&l.actor.send("loadTile",w,M.bind(this),void 0,!0))},!0);l.request={cancel:A}}function M(A,k){return delete l.request,l.aborted?h(null):A&&A.status!==404?h(A):(k&&k.resourceTiming&&(l.resourceTiming=k.resourceTiming),this.map._refreshExpiredTiles&&k&&l.setExpiryData(k),l.loadVectorData(k,this.map.painter),s.aG(this.dispatcher),h(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(l){l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ut extends s.a6{constructor(l,h,x,w){super(),this.id=l,this.dispatcher=x,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.ak({type:"raster"},h),s.ak(this,s.p(h,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new s.a8("dataloading",{dataType:"source"})),this._tileJSONRequest=ta(this._options,this.map._requestManager,null,null,(h,x)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new s.a7(h)):x&&(s.ak(this,x),x.bounds&&(this.tileBounds=new Bs(x.bounds,this.minzoom,this.maxzoom)),s.aH(x.tiles),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))),l&&l(h)})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=s.aE(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.ak({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,h){const x=s.a4.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),x,this.tileSize);l.request=s.a3(this.map._requestManager.transformRequest(w,s.a2.Tile),(M,A,k,L)=>(delete l.request,l.aborted?(l.state="unloaded",h(null)):M?(l.state="errored",h(M)):A?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:k,expires:L}),l.setTexture(A,this.map.painter),l.state="loaded",s.aG(this.dispatcher),void h(null)):h(null)))}abortTile(l,h){l.request&&(l.request.cancel(),delete l.request),h()}unloadTile(l,h){l.texture&&l.texture instanceof s.a9?(l.destroy(!0),l.texture&&l.texture instanceof s.a9&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const Fs={vector:De,raster:Ut,"raster-dem":class extends Ut{constructor(g,l,h,x){super(g,l,h,x),this.type="raster-dem",this.maxzoom=22,this._options=s.ak({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(g,l){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function x(w,M){w&&(g.state="errored",l(w)),M&&(g.dem=M,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",l(null))}g.request=s.a3(this.map._requestManager.transformRequest(h,s.a2.Tile),(function(w,M,A,k){if(delete g.request,g.aborted)g.state="unloaded",l(null);else if(w)g.state="errored",l(w);else if(M){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:A,expires:k});const L=ImageBitmap&&M instanceof ImageBitmap&&s.aI(),O=1-(M.width-s.aJ(M.width))/2;O<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const N=L?M:s.a4.getImageData(M,O),j={uid:g.uid,coord:g.tileID,source:this.id,scope:this.scope,rawImageData:N,encoding:this.encoding,padding:O};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",j,x.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(g){const l=g.canonical,h=Math.pow(2,l.z),x=(l.x-1+h)%h,w=l.x===0?g.wrap-1:g.wrap,M=(l.x+1+h)%h,A=l.x+1===h?g.wrap+1:g.wrap,k={};return k[new s.O(g.overscaledZ,w,l.z,x,l.y).key]={backfilled:!1},k[new s.O(g.overscaledZ,A,l.z,M,l.y).key]={backfilled:!1},l.y>0&&(k[new s.O(g.overscaledZ,w,l.z,x,l.y-1).key]={backfilled:!1},k[new s.O(g.overscaledZ,g.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},k[new s.O(g.overscaledZ,A,l.z,M,l.y-1).key]={backfilled:!1}),l.y+1<h&&(k[new s.O(g.overscaledZ,w,l.z,x,l.y+1).key]={backfilled:!1},k[new s.O(g.overscaledZ,g.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},k[new s.O(g.overscaledZ,A,l.z,M,l.y+1).key]={backfilled:!1}),k}},geojson:class extends s.a6{constructor(g,l,h,x){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(x),this._data=l.data,this._options=s.ak({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const w=s.J/this.tileSize;this.workerOptions=s.ak({source:this.id,scope:this.scope,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*w,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*w,extent:s.J,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:s.J,radius:(l.clusterRadius!==void 0?l.clusterRadius:50)*w,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}getClusterExpansionZoom(g,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id,scope:this.scope},l),this}getClusterChildren(g,l){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id,scope:this.scope},l),this}getClusterLeaves(g,l,h,x){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:g,limit:l,offset:h},x),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.a8("dataloading",{dataType:"source"})),this._loaded=!1;const g=s.ak({},this.workerOptions);g.scope=this.scope;const l=this._data;typeof l=="string"?(g.request=this.map._requestManager.transformRequest(s.a4.resolveURL(l),s.a2.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,g,(h,x)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new s.a7(h));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(w.resourceTiming=x.resourceTiming[this.id]),this.fire(new s.a8("data",w)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,l){const h=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const x={type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:s.a4.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};g.request=this.actor.send(h,x,(w,M)=>(delete g.request,g.destroy(),g.aborted?l(null):w?l(w):(g.loadVectorData(M,this.map.painter,h==="reloadTile"),l(null))),void 0,h==="loadTile")}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id,scope:this.scope}),g.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.ak({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aK{constructor(g,l,h,x){super(g,l,h,x),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const l of g.urls)this.urls.push(this.map._requestManager.transformRequest(l,s.a2.Source).url);s.aL(this.urls,(l,h)=>{this._loaded=!0,l?this.fire(new s.a7(l)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const l=this.video.seekable;g<l.start(0)||g>l.end(0)?this.fire(new s.a7(new s.aM(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,l=g.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new s.a9(g,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aK,model:class extends s.a6{constructor(g,l,h,x){super(),this.id=g,this.type="model",this.models=[],this._loaded=!1,this._options=l}load(){const g=[];for(const l in this._options.models){const h=this._options.models[l],x=s.aO(this.map._requestManager.transformRequest(h.uri,s.a2.Model).url).then(w=>{if(!w)return;const M=s.aP(w),A=new s.aQ(l,h.position,h.orientation,M);A.computeBoundsAndApplyParent(),this.models.push(A)}).catch(w=>{this.fire(new s.a7(new Error(`Could not load model ${l} from ${h.uri}: ${w.message}`)))});g.push(x)}return Promise.allSettled(g).then(()=>{this._loaded=!0,this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(l=>{this.fire(new s.a7(new Error(`Could not load models: ${l.message}`)))})}onAdd(g){this.map=g,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(g,l){}serialize(){return{type:"model"}}},"batched-model":class extends s.a6{constructor(g,l,h,x){super(),this.type="batched-model",this.id=g,this.tileSize=512,this._options=l,this.tiles=this._options.tiles,this.maxzoom=l.maxzoom||19,this.minzoom=l.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=h,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(x)}onAdd(g){this.map=g,this.load()}load(g){this._loaded=!1,this.fire(new s.a8("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map._worldview;this._tileJSONRequest=ta(this._options,this.map._requestManager,l,h,(x,w)=>{this._tileJSONRequest=null,this._loaded=!0,x?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new s.a7(x))):w&&(s.ak(this,w),w.bounds&&(this.tileBounds=new Bs(w.bounds,this.minzoom,this.maxzoom)),s.aH(w.tiles,this.map._requestManager._customAccessToken),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))),g&&g(x)})}hasTransition(){return!1}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loaded(){return this._loaded}loadTile(g,l){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(h,s.a2.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:g.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(g.actor&&g.state!=="expired")if(g.state==="loading")g.reloadCallback=l;else{if(g.buckets){const M=Object.values(g.buckets);for(const A of M)A.dirty=!0;return void(g.state="loaded")}g.request=g.actor.send("reloadTile",x,w.bind(this))}else g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",x,w.bind(this),void 0,!0);function w(M,A){return g.aborted?l(null):M&&M.status!==404?l(M):(A&&(A.resourceTiming&&(g.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&g.setExpiryData(A),g.buckets={...g.buckets,...A.buckets}),g.state="loaded",void l(null))}}serialize(){return s.ak({},this._options)}},canvas:class extends s.aK{constructor(g,l,h,x){super(g,l,h,x),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(w=>!Array.isArray(w)||w.length!==2||w.some(M=>typeof M!="number"))||this.fire(new s.a7(new s.aM(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.a7(new s.aM(`sources.${g}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new s.a7(new s.aM(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new s.a7(new s.aM(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.a7(new s.aM(`sources.${g}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.a7(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const l=this.map.painter.context;this.texture?!g&&!this._playing||this.texture instanceof s.aN||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.a9(l,this.canvas,l.gl.RGBA,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends s.a6{constructor(g,l,h,x){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=l,this.setEventedParent(x),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.a7(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.a7(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Bs(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),s.ak(this,s.p(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.p(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this._map=g,this._loaded=!1,this.fire(new s.a8("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:l,y:h,z:x}=g.canonical;return this._implementation.hasTile({x:l,y:h,z:x})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,l){const{x:h,y:x,z:w}=g.tileID.canonical,M=new AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:h,y:x,z:w},{signal:M.signal})).then((function(A){return delete g.request,g.aborted?(g.state="unloaded",l(null)):A===void 0?(g.state="errored",l(null)):A===null?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",l(null)):function(k){return k instanceof ImageData||k instanceof HTMLCanvasElement||k instanceof ImageBitmap||k instanceof HTMLImageElement}(A)?(this.loadTileData(g,A),g.state="loaded",void l(null)):(g.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(A=>{A.code!==20&&(g.state="errored",l(A))}),g.request.cancel=()=>M.abort()}loadTileData(g,l){g.setTexture(l,this._map.painter)}unloadTile(g,l){if(g.texture&&g.texture instanceof s.a9?(g.destroy(!0),g.texture&&g.texture instanceof s.a9&&this._map.painter.saveTileTexture(g.texture)):g.destroy(),this._implementation.unloadTile){const{x:h,y:x,z:w}=g.tileID.canonical;this._implementation.unloadTile({x:h,y:x,z:w})}l()}abortTile(g,l){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),l()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){const g=s.aE(this.id,this.scope);this._map.style.clearSource(g)}_update(){this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))}}},bs=function(g,l,h,x){const w=new Fs[l.type](g,l,h,x);if(w.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${w.id}`);return s.aR(["load","abort","unload","serialize","prepare"],w),w};function Un(g,l){const h=s.m.identity([]);return s.m.scale(h,h,[.5*g.width,.5*-g.height,1]),s.m.translate(h,h,[1,-1,0]),s.m.multiply(h,h,g.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(h)}function to(g,l,h,x,w,M,A,k=!1){const L=g.tilesIn(x,A,k);L.sort(ws);const O=[];for(const j of L)O.push({wrappedTileID:j.tile.tileID.wrapped().key,queryResults:j.tile.queryRenderedFeatures(l,h,g._state,j,w,M,Un(g.transform,j.tile.tileID),k)});const N=function(j){const H={},q={};for(const Y of j){const J=Y.queryResults,K=Y.wrappedTileID,X=q[K]=q[K]||{};for(const oe in J){const de=J[oe],fe=X[oe]=X[oe]||{},ne=H[oe]=H[oe]||[];for(const ae of de)fe[ae.featureIndex]||(fe[ae.featureIndex]=!0,ne.push(ae))}}return H}(O);for(const j in N)N[j].forEach(H=>{const q=H.feature,Y=q.layer;Y&&Y.type!=="background"&&Y.type!=="sky"&&Y.type!=="slot"&&(q.source=Y.source,Y["source-layer"]&&(q.sourceLayer=Y["source-layer"]),q.state=q.id!==void 0?g.getFeatureState(Y["source-layer"],q.id):{})});return N}function D_(g,l){const h=g.getRenderableIds().map(M=>g.getTileByID(M)),x=[],w={};for(let M=0;M<h.length;M++){const A=h[M],k=A.tileID.canonical.key;w[k]||(w[k]=!0,A.querySourceFeatures(x,l))}return x}function ws(g,l){const h=g.tileID,x=l.tileID;return h.overscaledZ-x.overscaledZ||h.canonical.y-x.canonical.y||h.wrap-x.wrap||h.canonical.x-x.canonical.x}class yh{constructor(l){this.style=l}processLayersChanged(){this.layers=[];for(const l in this.style._mergedLayers){const h=this.style._mergedLayers[l];if(h.type==="fill-extrusion")this.layers.push(h);else if(h.type==="model"){const x=this.style.getLayerSource(h);x&&x.type==="batched-model"&&this.layers.push(h)}}}updateZOffset(l,h){this.currentBuildingBuckets=[];for(let w=0;w<this.layers.length;++w){const M=this.layers[w],A=this.style.getLayerSourceCache(M);let k=1;M.type==="fill-extrusion"&&(k=M.paint.get("fill-extrusion-opacity")>0?M.paint.get("fill-extrusion-vertical-scale"):0);let L=A?A.getTile(h):null;if(!L&&A&&h.canonical.z>A.getSource().minzoom){let O=h.scaledTo(Math.min(A.getSource().maxzoom,h.overscaledZ-1));for(;O.overscaledZ>=A.getSource().minzoom&&(L=A.getTile(O),!L&&O.overscaledZ!==0);)O=O.scaledTo(O.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:L?L.getBucket(M):null,tileID:L?L.tileID:h,verticalScale:k})}l.hasAnyZOffset=!1;let x=!1;for(let w=0;w<l.symbolInstances.length;w++){const M=l.symbolInstances.get(w),A=M.zOffset,k=this._getHeightAtTileOffset(h,M.tileAnchorX,M.tileAnchorY);M.zOffset=k!==-1?k:A,x||A===M.zOffset||(x=!0),l.hasAnyZOffset||M.zOffset===0||(l.hasAnyZOffset=!0)}x&&(l.zOffsetBuffersNeedUpload=!0,l.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(l,h,x,w){let M=h,A=x;if(l.canonical.z!==w.canonical.z){const k=w.canonical,L=1/(1<<l.canonical.z-k.z);M=(h+l.canonical.x*s.J)*L-k.x*s.J|0,A=(x+l.canonical.y*s.J)*L-k.y*s.J|0}return{tileX:M,tileY:A}}_getHeightAtTileOffset(l,h,x){let w,M;for(let A=0;A<this.layers.length;++A){if(this.layers[A].type!=="fill-extrusion")continue;const{bucket:k,tileID:L,verticalScale:O}=this.currentBuildingBuckets[A];if(!k)continue;const{tileX:N,tileY:j}=this._mapCoordToOverlappingTile(l,h,x,L),H=k.getHeightAtTileCoord(N,j);H&&H.height!==void 0&&(H.hidden?w=H.height:M=Math.max(H.height*O,M||0))}if(M!==void 0)return M;for(let A=0;A<this.layers.length;++A){if(this.layers[A].type!=="model")continue;const{bucket:k,tileID:L}=this.currentBuildingBuckets[A];if(!k)continue;const{tileX:O,tileY:N}=this._mapCoordToOverlappingTile(l,h,x,L),j=k.getHeightAtTileCoord(O,N);if(j&&!j.hidden)return j.height===void 0&&w!==void 0?Math.min(j.maxHeight,w)*j.verticalScale:(j.height||0)*j.verticalScale}return-1}}function z_(g,l){const h={};for(const x in g)x!=="ref"&&(h[x]=g[x]);return s.aS.forEach(x=>{x in l&&(h[x]=l[x])}),h}function ia(g){g=g.slice();const l=Object.create(null);for(let h=0;h<g.length;h++)l[g[h].id]=g[h];for(let h=0;h<g.length;h++)"ref"in g[h]&&(g[h]=z_(g[h],l[g[h].ref]));return g}const et={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function Li(g,l,h){h.push({command:et.addSource,args:[g,l[g]]})}function Oi(g,l,h){l.push({command:et.removeSource,args:[g]}),h[g]=!0}function os(g,l,h,x){Oi(g,h,x),Li(g,l,h)}function Za(g,l,h){let x;for(x in g[h])if(g[h].hasOwnProperty(x)&&x!=="data"&&!S(g[h][x],l[h][x]))return!1;for(x in l[h])if(l[h].hasOwnProperty(x)&&x!=="data"&&!S(g[h][x],l[h][x]))return!1;return!0}function ki(g,l,h,x,w,M){let A;for(A in l=l||{},g=g||{})g.hasOwnProperty(A)&&(S(g[A],l[A])||h.push({command:M,args:[x,A,l[A],w]}));for(A in l)l.hasOwnProperty(A)&&!g.hasOwnProperty(A)&&(S(g[A],l[A])||h.push({command:M,args:[x,A,l[A],w]}))}function na(g){return g.id}function Mo(g,l){return g[l.id]=l,g}class Ll{constructor(l,h){this.reset(l,h)}reset(l,h){this.points=l||[],this._distances=[0];for(let x=1;x<this.points.length;x++)this._distances[x]=this._distances[x-1]+this.points[x].dist(this.points[x-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=s.c(l,0,1);let h=1,x=this._distances[h];const w=l*this.paddedLength+this.padding;for(;x<w&&h<this._distances.length;)x=this._distances[++h];const M=h-1,A=this._distances[M],k=x-A,L=k>0?(w-A)/k:0;return this.points[M].mult(1-L).add(this.points[h].mult(L))}}class Pr{constructor(l,h,x){const w=this.boxCells=[],M=this.circleCells=[];this.xCellCount=Math.ceil(l/x),this.yCellCount=Math.ceil(h/x);for(let A=0;A<this.xCellCount*this.yCellCount;A++)w.push([]),M.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=h,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,h,x,w,M){this._forEachCell(h,x,w,M,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(h),this.bboxes.push(x),this.bboxes.push(w),this.bboxes.push(M)}insertCircle(l,h,x,w){this._forEachCell(h-w,x-w,h+w,x+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(h),this.circles.push(x),this.circles.push(w)}_insertBoxCell(l,h,x,w,M,A){this.boxCells[M].push(A)}_insertCircleCell(l,h,x,w,M,A){this.circleCells[M].push(A)}_query(l,h,x,w,M,A){if(x<0||l>this.width||w<0||h>this.height)return!M&&[];const k=[];if(l<=0&&h<=0&&this.width<=x&&this.height<=w){if(M)return!0;for(let L=0;L<this.boxKeys.length;L++)k.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(let L=0;L<this.circleKeys.length;L++){const O=this.circles[3*L],N=this.circles[3*L+1],j=this.circles[3*L+2];k.push({key:this.circleKeys[L],x1:O-j,y1:N-j,x2:O+j,y2:N+j})}return A?k.filter(A):k}return this._forEachCell(l,h,x,w,this._queryCell,k,{hitTest:M,seenUids:{box:{},circle:{}}},A),M?k.length>0:k}_queryCircle(l,h,x,w,M){const A=l-x,k=l+x,L=h-x,O=h+x;if(k<0||A>this.width||O<0||L>this.height)return!w&&[];const N=[];return this._forEachCell(A,L,k,O,this._queryCellCircle,N,{hitTest:w,circle:{x:l,y:h,radius:x},seenUids:{box:{},circle:{}}},M),w?N.length>0:N}query(l,h,x,w,M){return this._query(l,h,x,w,!1,M)}hitTest(l,h,x,w,M){return this._query(l,h,x,w,!0,M)}hitTestCircle(l,h,x,w){return this._queryCircle(l,h,x,!0,w)}_queryCell(l,h,x,w,M,A,k,L){const O=k.seenUids,N=this.boxCells[M];if(N!==null){const H=this.bboxes;for(const q of N)if(!O.box[q]){O.box[q]=!0;const Y=4*q;if(l<=H[Y+2]&&h<=H[Y+3]&&x>=H[Y+0]&&w>=H[Y+1]&&(!L||L(this.boxKeys[q]))){if(k.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[q],x1:H[Y],y1:H[Y+1],x2:H[Y+2],y2:H[Y+3]})}}}const j=this.circleCells[M];if(j!==null){const H=this.circles;for(const q of j)if(!O.circle[q]){O.circle[q]=!0;const Y=3*q;if(this._circleAndRectCollide(H[Y],H[Y+1],H[Y+2],l,h,x,w)&&(!L||L(this.circleKeys[q]))){if(k.hitTest)return A.push(!0),!0;{const J=H[Y],K=H[Y+1],X=H[Y+2];A.push({key:this.circleKeys[q],x1:J-X,y1:K-X,x2:J+X,y2:K+X})}}}}}_queryCellCircle(l,h,x,w,M,A,k,L){const O=k.circle,N=k.seenUids,j=this.boxCells[M];if(j!==null){const q=this.bboxes;for(const Y of j)if(!N.box[Y]){N.box[Y]=!0;const J=4*Y;if(this._circleAndRectCollide(O.x,O.y,O.radius,q[J+0],q[J+1],q[J+2],q[J+3])&&(!L||L(this.boxKeys[Y])))return A.push(!0),!0}}const H=this.circleCells[M];if(H!==null){const q=this.circles;for(const Y of H)if(!N.circle[Y]){N.circle[Y]=!0;const J=3*Y;if(this._circlesCollide(q[J],q[J+1],q[J+2],O.x,O.y,O.radius)&&(!L||L(this.circleKeys[Y])))return A.push(!0),!0}}}_forEachCell(l,h,x,w,M,A,k,L){const O=this._convertToXCellCoord(l),N=this._convertToYCellCoord(h),j=this._convertToXCellCoord(x),H=this._convertToYCellCoord(w);for(let q=O;q<=j;q++)for(let Y=N;Y<=H;Y++)if(M.call(this,l,h,x,w,this.xCellCount*Y+q,A,k,L))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,h,x,w,M,A){const k=w-l,L=M-h,O=x+A;return O*O>k*k+L*L}_circleAndRectCollide(l,h,x,w,M,A,k){const L=(A-w)/2,O=Math.abs(l-(w+L));if(O>L+x)return!1;const N=(k-M)/2,j=Math.abs(h-(M+N));if(j>N+x)return!1;if(O<=L||j<=N)return!0;const H=O-L,q=j-N;return H*H+q*q<=x*x}}const an=100;class L_{constructor(l,h,x=new Pr(l.width+200,l.height+200,25),w=new Pr(l.width+200,l.height+200,25)){this.transform=l,this.grid=x,this.ignoredGrid=w,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+an,this.screenBottomBoundary=l.height+an,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=h}placeCollisionBox(l,h,x,w,M,A,k,L){let O=x.projectedAnchorX,N=x.projectedAnchorY,j=x.projectedAnchorZ;const H=x.elevation,q=x.tileID,Y=l.getProjection();if(H&&q){const[ae,me,xe]=Y.upVector(q.canonical,x.tileAnchorX,x.tileAnchorY),_e=Y.upVectorScale(q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=ae*H*_e,N+=me*H*_e,j+=xe*H*_e}const J=this.projectAndGetPerspectiveRatio(k,O,N,j,x.tileID,Y.name==="globe"||!!H||this.transform.pitch>0,Y),K=A*J.perspectiveRatio,X=(x.x1*h+w.x-x.padding)*K+J.point.x,oe=(x.y1*h+w.y-x.padding)*K+J.point.y,de=(x.x2*h+w.x+x.padding)*K+J.point.x,fe=(x.y2*h+w.y+x.padding)*K+J.point.y,ne=J.perspectiveRatio<=.55||J.occluded;return!this.isInsideGrid(X,oe,de,fe)||!M&&this.grid.hitTest(X,oe,de,fe,L)||ne?{box:[],offscreen:!1,occluded:J.occluded}:{box:[X,oe,de,fe],offscreen:this.isOffscreen(X,oe,de,fe),occluded:!1}}placeCollisionCircles(l,h,x,w,M,A,k,L,O,N,j,H,q,Y,J){const K=[],X=this.transform.elevation,oe=l.getProjection(),de=X?X.getAtTileOffsetFunc(J,this.transform.center.lat,this.transform.worldSize,oe):null,fe=new s.P(x.tileAnchorX,x.tileAnchorY);let{x:ne,y:ae,z:me}=oe.projectTilePoint(fe.x,fe.y,J.canonical);if(de){const[qe,ue,Ce]=de(fe);ne+=qe,ae+=ue,me+=Ce}const xe=oe.name==="globe",_e=this.projectAndGetPerspectiveRatio(k,ne,ae,me,J,xe||!!X||this.transform.pitch>0,oe),{perspectiveRatio:be}=_e,Ue=(j?A/be:A*be)/s.aV,ze=mr(ne,ae,me,L),Fe=_e.signedDistanceFromCamera>0?ht(Ue,M,x.lineOffsetX*Ue,x.lineOffsetY*Ue,!1,ze,fe,x,w,L,{},X&&!j?de:null,j&&!!X,oe,J,j):null;let Ae=!1,je=!1,Oe=!0;if(Fe&&!_e.occluded){const qe=.5*q*be+Y,ue=new s.P(-100,-100),Ce=new s.P(this.screenRightBoundary,this.screenBottomBoundary),st=new Ll,{first:$e,last:Ft}=Fe,kt=$e.path.length;let Xt=[];for(let $t=kt-1;$t>=1;$t--)Xt.push($e.path[$t]);for(let $t=1;$t<Ft.path.length;$t++)Xt.push(Ft.path[$t]);const Lt=2.5*qe;O&&(Xt=Xt.map(([$t,Gt,Ht],Ri)=>(de&&!xe&&(Ht=de(Ri<kt-1?$e.tilePath[kt-1-Ri]:Ft.tilePath[Ri-kt+2])[2]),mr($t,Gt,Ht,O))),Xt.some($t=>$t[3]<=0)&&(Xt=[]));let Qt=[];if(Xt.length>0){let $t=1/0,Gt=-1/0,Ht=1/0,Ri=-1/0;for(const hi of Xt)$t=Math.min($t,hi[0]),Ht=Math.min(Ht,hi[1]),Gt=Math.max(Gt,hi[0]),Ri=Math.max(Ri,hi[1]);Gt>=ue.x&&$t<=Ce.x&&Ri>=ue.y&&Ht<=Ce.y&&(Qt=[Xt.map(hi=>new s.P(hi[0],hi[1]))],($t<ue.x||Gt>Ce.x||Ht<ue.y||Ri>Ce.y)&&(Qt=s.aT(Qt,ue.x,ue.y,Ce.x,Ce.y)))}for(const $t of Qt){st.reset($t,.25*qe);let Gt=0;Gt=st.length<=.5*qe?1:Math.ceil(st.paddedLength/Lt)+1;for(let Ht=0;Ht<Gt;Ht++){const Ri=Ht/Math.max(Gt-1,1),hi=st.lerp(Ri),hn=hi.x+an,Qi=hi.y+an;K.push(hn,Qi,qe,0);const Lr=hn-qe,us=Qi-qe,Xi=hn+qe,Bi=Qi+qe;if(Oe=Oe&&this.isOffscreen(Lr,us,Xi,Bi),je=je||this.isInsideGrid(Lr,us,Xi,Bi),!h&&this.grid.hitTestCircle(hn,Qi,qe,H)&&(Ae=!0,!N))return{circles:[],offscreen:!1,collisionDetected:Ae,occluded:!1}}}}return{circles:!N&&Ae||!je?[]:K,offscreen:Oe,collisionDetected:Ae,occluded:_e.occluded}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let x=1/0,w=1/0,M=-1/0,A=-1/0;for(const N of l){const j=new s.P(N.x+an,N.y+an);x=Math.min(x,j.x),w=Math.min(w,j.y),M=Math.max(M,j.x),A=Math.max(A,j.y),h.push(j)}const k=this.grid.query(x,w,M,A).concat(this.ignoredGrid.query(x,w,M,A)),L={},O={};for(const N of k){const j=N.key;if(L[j.bucketInstanceId]===void 0&&(L[j.bucketInstanceId]={}),L[j.bucketInstanceId][j.featureIndex])continue;const H=[new s.P(N.x1,N.y1),new s.P(N.x2,N.y1),new s.P(N.x2,N.y2),new s.P(N.x1,N.y2)];s.aU(h,H)&&(L[j.bucketInstanceId][j.featureIndex]=!0,O[j.bucketInstanceId]===void 0&&(O[j.bucketInstanceId]=[]),O[j.bucketInstanceId].push(j.featureIndex))}return O}insertCollisionBox(l,h,x,w,M){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:x,featureIndex:w,collisionGroupID:M},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,h,x,w,M){const A=h?this.ignoredGrid:this.grid,k={bucketInstanceId:x,featureIndex:w,collisionGroupID:M};for(let L=0;L<l.length;L+=4)A.insertCircle(k,l[L],l[L+1],l[L+2])}projectAndGetPerspectiveRatio(l,h,x,w,M,A,k){const L=[h,x,w,1];let O=!1;w||this.transform.pitch>0?(s.e.transformMat4(L,L,l),this.fogState&&M&&k.name!=="globe"&&(O=function(H,q,Y,J,K,X){const oe=X.calculateFogTileMatrix(K),de=[q,Y,J];return s.v.transformMat4(de,de,oe),eo(H,s.v.length(de),X.pitch,X._fov)}(this.fogState,h,x,w,M.toUnwrapped(),this.transform)>.9)):pi(L,L,l);const N=L[3];return{point:new s.P((L[0]/N+1)/2*this.transform.width+an,(-L[1]/N+1)/2*this.transform.height+an),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(k)/N*.5,1.5),signedDistanceFromCamera:N,occluded:A&&L[2]>N||O}}isOffscreen(l,h,x,w){return x<an||l>=this.screenRightBoundary||w<an||h>this.screenBottomBoundary}isInsideGrid(l,h,x,w){return x>=0&&l<this.gridRightBoundary&&w>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const l=s.m.identity([]);return s.m.translate(l,l,[-100,-100,0]),l}}function ra(g,l,h){const x=l.createTileMatrix(g,g.worldSize,h.toUnwrapped());return s.m.multiply(new Float32Array(16),g.projMatrix,x)}function xh(g,l,h){if(l.projection.name===h.projection.name)return g.projMatrix;const x=h.clone();return x.setProjection(l.projection),ra(x,l.getProjection(),g)}function sa(g,l,h){return l.name===h.projection.name?g.projMatrix:ra(h,l,g)}class Uc{constructor(l,h,x,w){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?h:-h))):w&&x?1:0,this.placed=x}isHidden(){return this.opacity===0&&!this.placed}}class Xa{constructor(l,h,x,w,M,A=!1){this.text=new Uc(l?l.text:null,h,x,M),this.icon=new Uc(l?l.icon:null,h,w,M),this.clipped=A}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ya{constructor(l,h,x,w=!1){this.text=l,this.icon=h,this.skipFade=x,this.clipped=w}}class vh{constructor(){this.invProjMatrix=s.m.create(),this.viewportMatrix=s.m.create(),this.circles=[]}}class Gc{constructor(l,h,x,w,M){this.bucketInstanceId=l,this.featureIndex=h,this.sourceLayerIndex=x,this.bucketIndex=w,this.tileID=M}}class bh{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const h=++this.maxGroupID;this.collisionGroups[l]={ID:h,predicate:x=>x.collisionGroupID===h}}return this.collisionGroups[l]}}function Dr(g,l,h,x,w){const{horizontalAlign:M,verticalAlign:A}=s.aY(g),k=-(M-.5)*l,L=-(A-.5)*h,O=s.aW(g,x);return new s.P(k+O[0]*w,L+O[1]*w)}function _n(g,l,h,x,w){const M=new s.P(g,l);return h&&M._rotate(x?w:-w),M}class wh{constructor(l,h,x,w,M,A){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new L_(this.transform,M),this.buildingIndex=A,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new bh(x),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,h,x,w){const M=x.getBucket(h),A=x.latestFeatureIndex;if(!M||!A||h.fqid!==M.layerIds[0])return;const k=M.layers[0].layout,L=x.collisionBoxArray,O=Math.pow(2,this.transform.zoom-x.tileID.overscaledZ),N=x.tileSize/s.J,j=x.tileID.toUnwrapped();this.transform.setProjection(M.projection);const H=(q=x.tileID,Y=M.getProjection(),J=this.transform,Y.name===this.projection?J.calculateProjMatrix(q.toUnwrapped()):ra(J,Y,q));var q,Y,J;const K=k.get("text-pitch-alignment")==="map",X=k.get("text-rotation-alignment")==="map";h.compileFilter();const oe=h.dynamicFilter(),de=h.dynamicFilterNeedsFeature(),fe=this.transform.calculatePixelsToTileUnitsMatrix(x),ne=xs(H,x.tileID.canonical,K,X,this.transform,M.getProjection(),fe);let ae=null;if(K){const _e=To(H,x.tileID.canonical,K,X,this.transform,M.getProjection(),fe);ae=s.m.multiply([],this.transform.labelPlaneMatrix,_e)}let me=null;oe&&x.latestFeatureIndex&&(me={unwrappedTileID:j,dynamicFilter:oe,dynamicFilterNeedsFeature:de,featureIndex:x.latestFeatureIndex}),this.retainedQueryData[M.bucketInstanceId]=new Gc(M.bucketInstanceId,A,M.sourceLayerIndex,M.index,x.tileID);const xe={bucket:M,layout:k,posMatrix:H,textLabelPlaneMatrix:ne,labelToScreenMatrix:ae,clippingData:me,scale:O,textPixelRatio:N,holdingForFade:x.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:s.i(M.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.i(M.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(M.sourceID)};if(w)for(const _e of M.sortKeyRanges){const{sortKey:be,symbolInstanceStart:Ue,symbolInstanceEnd:ze}=_e;l.push({sortKey:be,symbolInstanceStart:Ue,symbolInstanceEnd:ze,parameters:xe})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:M.symbolInstances.length,parameters:xe})}attemptAnchorPlacement(l,h,x,w,M,A,k,L,O,N,j,H,q,Y,J,K,X,oe){const{textOffset0:de,textOffset1:fe,crossTileID:ne}=H,ae=[de,fe],me=Dr(l,x,w,ae,M),xe=this.collisionIndex.placeCollisionBox(Y,M,h,_n(me.x,me.y,A,k,this.transform.angle),j,L,O,N.predicate);if(K){const _e=Y.getSymbolInstanceIconSize(oe,this.transform.zoom,H.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Y,_e,K,_n(me.x,me.y,A,k,this.transform.angle),j,L,O,N.predicate).box.length===0)return}if(xe.box.length>0){let _e;return this.prevPlacement&&this.prevPlacement.variableOffsets[ne]&&this.prevPlacement.placements[ne]&&this.prevPlacement.placements[ne].text&&(_e=this.prevPlacement.variableOffsets[ne].anchor),this.variableOffsets[ne]={textOffset:ae,width:x,height:w,anchor:l,textScale:M,prevAnchor:_e},this.markUsedJustification(Y,l,H,J),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,J,H),this.placedOrientations[ne]=J),{shift:me,placedGlyphBoxes:xe}}}placeLayerBucketPart(l,h,x,w){const{bucket:M,layout:A,posMatrix:k,textLabelPlaneMatrix:L,labelToScreenMatrix:O,clippingData:N,textPixelRatio:j,holdingForFade:H,collisionBoxArray:q,partiallyEvaluatedTextSize:Y,partiallyEvaluatedIconSize:J,collisionGroup:K}=l.parameters,X=A.get("text-optional"),oe=A.get("icon-optional"),de=A.get("text-allow-overlap"),fe=A.get("icon-allow-overlap"),ne=A.get("text-rotation-alignment")==="map",ae=A.get("text-pitch-alignment")==="map",me=A.get("symbol-z-order")==="viewport-y",xe=A.get("symbol-z-elevate");this.transform.setProjection(M.projection);let _e=de&&(fe||!M.hasIconData()||oe),be=fe&&(de||!M.hasTextData()||X);!M.collisionArrays&&q&&M.deserializeCollisionBoxes(q),x&&w&&M.updateCollisionDebugBuffers(this.transform.zoom,q);const Ue=(ze,Fe,Ae)=>{const{crossTileID:je,numVerticalGlyphVertices:Oe}=ze;if(N){const Xi={zoom:this.transform.zoom,pitch:this.transform.pitch};let Bi=null;if(N.dynamicFilterNeedsFeature){const Vi=this.retainedQueryData[M.bucketInstanceId];Bi=N.featureIndex.loadFeature({featureIndex:ze.featureIndex,bucketIndex:Vi.bucketIndex,sourceLayerIndex:Vi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,N.dynamicFilter)(Xi,Bi,this.retainedQueryData[M.bucketInstanceId].tileID.canonical,new s.P(ze.tileAnchorX,ze.tileAnchorY),this.transform.calculateDistanceTileData(N.unwrappedTileID)))return this.placements[je]=new Ya(!1,!1,!1,!0),void h.add(je)}if(h.has(je))return;if(H)return void(this.placements[je]=new Ya(!1,!1,!1));let qe=!1,ue=!1,Ce=!0,st=!1,$e=!1,Ft=null,kt={box:null,offscreen:null,occluded:null},Xt={box:null,offscreen:null,occluded:null},Lt=null,Qt=null,$t=null,Gt=0,Ht=0,Ri=0;Ae.textFeatureIndex?Gt=Ae.textFeatureIndex:ze.useRuntimeCollisionCircles&&(Gt=ze.featureIndex),Ae.verticalTextFeatureIndex&&(Ht=Ae.verticalTextFeatureIndex);const hi=Xi=>{Xi.tileID=this.retainedQueryData[M.bucketInstanceId].tileID;const Bi=this.transform.elevation;Xi.elevation=ze.zOffset+(Bi?Bi.getAtTileOffset(Xi.tileID,Xi.tileAnchorX,Xi.tileAnchorY):0)},hn=Ae.textBox;if(hn){hi(hn);const Xi=Vi=>{let yn=s.W.horizontal;if(M.allowVerticalPlacement&&!Vi&&this.prevPlacement){const cr=this.prevPlacement.placedOrientations[je];cr&&(this.placedOrientations[je]=cr,yn=cr,this.markUsedOrientation(M,yn,ze))}return yn},Bi=(Vi,yn)=>{if(M.allowVerticalPlacement&&Oe>0&&Ae.verticalTextBox){for(const cr of M.writingModes)if(cr===s.W.vertical?(kt=yn(),Xt=kt):kt=Vi(),kt&&kt.box&&kt.box.length)break}else kt=Vi()};if(A.get("text-variable-anchor")){let Vi=A.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[je]){const mn=this.prevPlacement.variableOffsets[je];Vi.indexOf(mn.anchor)>0&&(Vi=Vi.filter(vr=>vr!==mn.anchor),Vi.unshift(mn.anchor))}const yn=(mn,vr,Rr)=>{const br=M.getSymbolInstanceTextSize(Y,ze,this.transform.zoom,Fe),hs=(mn.x2-mn.x1)*br+2*mn.padding,ro=(mn.y2-mn.y1)*br+2*mn.padding,As=ze.hasIconTextFit&&!fe?vr:null;As&&hi(As);let tn={box:[],offscreen:!1,occluded:!1};const Is=de?2*Vi.length:Vi.length;for(let Us=0;Us<Is;++Us){const so=this.attemptAnchorPlacement(Vi[Us%Vi.length],mn,hs,ro,br,ne,ae,j,k,K,Us>=Vi.length,ze,Fe,M,Rr,As,Y,J);if(so&&(tn=so.placedGlyphBoxes,tn&&tn.box&&tn.box.length)){qe=!0,Ft=so.shift;break}}return tn};Bi(()=>yn(hn,Ae.iconBox,s.W.horizontal),()=>{const mn=Ae.verticalTextBox;return mn&&hi(mn),M.allowVerticalPlacement&&!(kt&&kt.box&&kt.box.length)&&Oe>0&&mn?yn(mn,Ae.verticalIconBox,s.W.vertical):{box:null,offscreen:null,occluded:null}}),kt&&(qe=kt.box,Ce=kt.offscreen,st=kt.occluded);const cr=Xi(!(!kt||!kt.box));if(!qe&&this.prevPlacement){const mn=this.prevPlacement.variableOffsets[je];mn&&(this.variableOffsets[je]=mn,this.markUsedJustification(M,mn.anchor,ze,cr))}}else{const Vi=(yn,cr)=>{const mn=M.getSymbolInstanceTextSize(Y,ze,this.transform.zoom,Fe),vr=this.collisionIndex.placeCollisionBox(M,mn,yn,new s.P(0,0),de,j,k,K.predicate);return vr&&vr.box&&vr.box.length&&(this.markUsedOrientation(M,cr,ze),this.placedOrientations[je]=cr),vr};Bi(()=>Vi(hn,s.W.horizontal),()=>{const yn=Ae.verticalTextBox;return M.allowVerticalPlacement&&Oe>0&&yn?(hi(yn),Vi(yn,s.W.vertical)):{box:null,offscreen:null,occluded:null}}),Xi(!!(kt&&kt.box&&kt.box.length))}}if(Lt=kt,qe=Lt&&Lt.box&&Lt.box.length>0,Ce=Lt&&Lt.offscreen,st=Lt&&Lt.occluded,ze.useRuntimeCollisionCircles){const Xi=M.text.placedSymbolArray.get(ze.centerJustifiedTextSymbolIndex>=0?ze.centerJustifiedTextSymbolIndex:ze.verticalPlacedTextSymbolIndex),Bi=s.j(M.textSizeData,Y,Xi),Vi=A.get("text-padding");Qt=this.collisionIndex.placeCollisionCircles(M,de,Xi,M.lineVertexArray,M.glyphOffsetArray,Bi,k,L,O,x,ae,K.predicate,ze.collisionCircleDiameter*Bi/s.aV,Vi,this.retainedQueryData[M.bucketInstanceId].tileID),qe=de||Qt.circles.length>0&&!Qt.collisionDetected,Ce=Ce&&Qt.offscreen,st=Qt.occluded}if(Ae.iconFeatureIndex&&(Ri=Ae.iconFeatureIndex),Ae.iconBox){const Xi=Bi=>{hi(Bi);const Vi=ze.hasIconTextFit&&Ft?_n(Ft.x,Ft.y,ne,ae,this.transform.angle):new s.P(0,0),yn=M.getSymbolInstanceIconSize(J,this.transform.zoom,ze.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(M,yn,Bi,Vi,fe,j,k,K.predicate)};Xt&&Xt.box&&Xt.box.length&&Ae.verticalIconBox?($t=Xi(Ae.verticalIconBox),ue=$t.box.length>0):($t=Xi(Ae.iconBox),ue=$t.box.length>0),Ce=Ce&&$t.offscreen,$e=$t.occluded}const Qi=X||ze.numHorizontalGlyphVertices===0&&Oe===0,Lr=oe||ze.numIconVertices===0;if(Qi||Lr?Lr?Qi||(ue=ue&&qe):qe=ue&&qe:ue=qe=ue&&qe,qe&&Lt&&Lt.box&&this.collisionIndex.insertCollisionBox(Lt.box,A.get("text-ignore-placement"),M.bucketInstanceId,Xt&&Xt.box&&Ht?Ht:Gt,K.ID),ue&&$t&&this.collisionIndex.insertCollisionBox($t.box,A.get("icon-ignore-placement"),M.bucketInstanceId,Ri,K.ID),Qt&&(qe&&this.collisionIndex.insertCollisionCircles(Qt.circles,A.get("text-ignore-placement"),M.bucketInstanceId,Gt,K.ID),x)){const Xi=M.bucketInstanceId;let Bi=this.collisionCircleArrays[Xi];Bi===void 0&&(Bi=this.collisionCircleArrays[Xi]=new vh);for(let Vi=0;Vi<Qt.circles.length;Vi+=4)Bi.circles.push(Qt.circles[Vi+0]),Bi.circles.push(Qt.circles[Vi+1]),Bi.circles.push(Qt.circles[Vi+2]),Bi.circles.push(Qt.collisionDetected?1:0)}const us=M.projection.name!=="globe";_e=_e&&(us||!st),be=be&&(us||!$e),this.placements[je]=new Ya(qe||_e,ue||be,Ce||M.justReloaded),h.add(je)};if(xe&&this.buildingIndex&&(this.buildingIndex.updateZOffset(M,this.retainedQueryData[M.bucketInstanceId].tileID),M.updateZOffset()),me){const ze=M.getSortedSymbolIndexes(this.transform.angle);for(let Fe=ze.length-1;Fe>=0;--Fe){const Ae=ze[Fe];Ue(M.symbolInstances.get(Ae),Ae,M.collisionArrays[Ae])}M.hasAnyZOffset&&s.X(`${M.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(M.hasAnyZOffset){const ze=M.getSortedIndexesByZOffset();for(let Fe=0;Fe<ze.length;++Fe){const Ae=ze[Fe];Ue(M.symbolInstances.get(Ae),Ae,M.collisionArrays[Ae])}}else for(let ze=l.symbolInstanceStart;ze<l.symbolInstanceEnd;ze++)Ue(M.symbolInstances.get(ze),ze,M.collisionArrays[ze]);if(x&&M.bucketInstanceId in this.collisionCircleArrays){const ze=this.collisionCircleArrays[M.bucketInstanceId];s.m.invert(ze.invProjMatrix,k),ze.viewportMatrix=this.collisionIndex.getViewportMatrix()}M.justReloaded=!1}markUsedJustification(l,h,x,w){const{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:L,crossTileID:O}=x,N=s.aX(h),j=w===s.W.vertical?L:N==="left"?M:N==="center"?A:N==="right"?k:-1;M>=0&&(l.text.placedSymbolArray.get(M).crossTileID=j>=0&&M!==j?0:O),A>=0&&(l.text.placedSymbolArray.get(A).crossTileID=j>=0&&A!==j?0:O),k>=0&&(l.text.placedSymbolArray.get(k).crossTileID=j>=0&&k!==j?0:O),L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=j>=0&&L!==j?0:O)}markUsedOrientation(l,h,x){const w=h===s.W.horizontal||h===s.W.horizontalOnly?h:0,M=h===s.W.vertical?h:0,{leftJustifiedTextSymbolIndex:A,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:L,verticalPlacedTextSymbolIndex:O}=x,N=l.text.placedSymbolArray;A>=0&&(N.get(A).placedOrientation=w),k>=0&&(N.get(k).placedOrientation=w),L>=0&&(N.get(L).placedOrientation=w),O>=0&&(N.get(O).placedOrientation=M)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let x=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const w=h?h.symbolFadeChange(l):1,M=h?h.opacities:{},A=h?h.variableOffsets:{},k=h?h.placedOrientations:{};for(const L in this.placements){const O=this.placements[L],N=M[L];N?(this.opacities[L]=new Xa(N,w,O.text,O.icon,null,O.clipped),x=x||O.text!==N.text.placed||O.icon!==N.icon.placed):(this.opacities[L]=new Xa(null,w,O.text,O.icon,O.skipFade,O.clipped),x=x||O.text||O.icon)}for(const L in M){const O=M[L];if(!this.opacities[L]){const N=new Xa(O,w,!1,!1);N.isHidden()||(this.opacities[L]=N,x=x||O.text.placed||O.icon.placed)}}for(const L in A)this.variableOffsets[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.variableOffsets[L]=A[L]);for(const L in k)this.placedOrientations[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.placedOrientations[L]=k[L]);x?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:l)}updateLayerOpacities(l,h){const x=new Set;for(const w of h){const M=w.getBucket(l);M&&w.latestFeatureIndex&&l.fqid===M.layerIds[0]&&(this.updateBucketOpacities(M,x,w.collisionBoxArray),M.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(M,w.tileID),M.updateZOffset()))}}updateBucketOpacities(l,h,x){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const w=l.layers[0].layout,M=!!l.layers[0].dynamicFilter(),A=new Xa(null,0,!1,!1,!0),k=w.get("text-allow-overlap"),L=w.get("icon-allow-overlap"),O=w.get("text-variable-anchor"),N=w.get("text-rotation-alignment")==="map",j=w.get("text-pitch-alignment")==="map",H=new Xa(null,0,k&&(L||!l.hasIconData()||w.get("icon-optional")),L&&(k||!l.hasTextData()||w.get("text-optional")),!0);!l.collisionArrays&&x&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(x);const q=(J,K,X)=>{for(let oe=0;oe<K/4;oe++)J.opacityVertexArray.emplaceBack(X)};let Y=0;for(let J=0;J<l.symbolInstances.length;J++){const K=l.symbolInstances.get(J),{numHorizontalGlyphVertices:X,numVerticalGlyphVertices:oe,crossTileID:de,numIconVertices:fe}=K,ne=h.has(de);let ae=this.opacities[de];ne?ae=A:ae||(ae=H,this.opacities[de]=ae),h.add(de);const me=X>0||oe>0,xe=fe>0,_e=this.placedOrientations[de],be=_e===s.W.vertical,Ue=_e===s.W.horizontal||_e===s.W.horizontalOnly;if(!me&&!xe||ae.isHidden()||Y++,me){const ze=Ja(ae.text);q(l.text,X,be?Gn:ze),q(l.text,oe,Ue?Gn:ze);const Fe=ae.text.isHidden(),{leftJustifiedTextSymbolIndex:Ae,centerJustifiedTextSymbolIndex:je,rightJustifiedTextSymbolIndex:Oe,verticalPlacedTextSymbolIndex:qe}=K,ue=l.text.placedSymbolArray,Ce=Fe||be?1:0;Ae>=0&&(ue.get(Ae).hidden=Ce),je>=0&&(ue.get(je).hidden=Ce),Oe>=0&&(ue.get(Oe).hidden=Ce),qe>=0&&(ue.get(qe).hidden=Fe||Ue?1:0);const st=this.variableOffsets[de];st&&this.markUsedJustification(l,st.anchor,K,_e);const $e=this.placedOrientations[de];$e&&(this.markUsedJustification(l,"left",K,$e),this.markUsedOrientation(l,$e,K))}if(xe){const ze=Ja(ae.icon),{placedIconSymbolIndex:Fe,verticalPlacedIconSymbolIndex:Ae}=K,je=l.icon.placedSymbolArray,Oe=ae.icon.isHidden()?1:0;Fe>=0&&(q(l.icon,fe,be?Gn:ze),je.get(Fe).hidden=Oe),Ae>=0&&(q(l.icon,K.numVerticalIconVertices,Ue?Gn:ze),je.get(Ae).hidden=Oe)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const ze=l.collisionArrays[J];if(ze){let Fe=new s.P(0,0),Ae=!0;if(ze.textBox||ze.verticalTextBox){if(O){const Oe=this.variableOffsets[de];Oe?(Fe=Dr(Oe.anchor,Oe.width,Oe.height,Oe.textOffset,Oe.textScale),N&&Fe._rotate(j?this.transform.angle:-this.transform.angle)):Ae=!1}M&&(Ae=!ae.clipped),ze.textBox&&oa(l.textCollisionBox.collisionVertexArray,ae.text.placed,!Ae||be,Fe.x,Fe.y),ze.verticalTextBox&&oa(l.textCollisionBox.collisionVertexArray,ae.text.placed,!Ae||Ue,Fe.x,Fe.y)}const je=Ae&&!!(!Ue&&ze.verticalIconBox);ze.iconBox&&oa(l.iconCollisionBox.collisionVertexArray,ae.icon.placed,je,K.hasIconTextFit?Fe.x:0,K.hasIconTextFit?Fe.y:0),ze.verticalIconBox&&oa(l.iconCollisionBox.collisionVertexArray,ae.icon.placed,!je,K.hasIconTextFit?Fe.x:0,K.hasIconTextFit?Fe.y:0)}}}if(l.fullyClipped=Y===0,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const J=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=J.invProjMatrix,l.placementViewportMatrix=J.viewportMatrix,l.collisionCircleArray=J.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,h){const x=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*x>l}setStale(){this.stale=!0}}function oa(g,l,h,x,w){g.emplaceBack(l?1:0,h?1:0,x||0,w||0),g.emplaceBack(l?1:0,h?1:0,x||0,w||0),g.emplaceBack(l?1:0,h?1:0,x||0,w||0),g.emplaceBack(l?1:0,h?1:0,x||0,w||0)}const zr=Math.pow(2,25),as=Math.pow(2,24),ip=Math.pow(2,17),Ka=Math.pow(2,16),tr=Math.pow(2,9),Rl=Math.pow(2,8),Th=Math.pow(2,1);function Ja(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const l=g.placed?1:0,h=Math.floor(127*g.opacity);return h*zr+l*as+h*ip+l*Ka+h*tr+l*Rl+h*Th+l}const Gn=0;class Mh{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(l,h,x,w,M){const A=this._bucketParts;for(;this._currentTileIndex<l.length;)if(h.getBucketParts(A,w,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,M())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((k,L)=>k.sortKey-L.sortKey));this._currentPartIndex<A.length;){const k=A[this._currentPartIndex];if(h.placeLayerBucketPart(k,this._seenCrossTileIDs,x,k.symbolInstanceStart===0),this._currentPartIndex++,M())return!0}return!1}}class Sh{constructor(l,h,x,w,M,A,k,L,O){this.placement=new wh(l,M,A,k,L,O),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=x,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(l,h,x,w){const M=s.a4.now(),A=()=>{const k=s.a4.now()-M;return!this._forceFullPlacement&&k>2};for(;this._currentPlacementIndex>=0;){const k=h[l[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(k.type==="symbol"&&(!k.minzoom||k.minzoom<=L)&&(!k.maxzoom||k.maxzoom>L)){const O=k,N=O.layout.get("symbol-z-elevate"),j=this._inProgressLayer=this._inProgressLayer||new Mh(O),H=s.aE(k.source,k.scope);if(j.continuePlacement(N?w[H]:x[H],this.placement,this._showCollisionBoxes,k,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const Ts=512/s.J/2;class Ol{constructor(l,h,x){this.tileID=l,this.bucketInstanceId=x,this.index=new s.aZ(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const w=l.canonical.x*s.J,M=l.canonical.y*s.J;for(let A=0;A<h.length;A++){const{key:k,crossTileID:L,tileAnchorX:O,tileAnchorY:N}=h.get(A),j=Math.floor((w+O)*Ts),H=Math.floor((M+N)*Ts);this.index.add(j,H),this.keys.push(k),this.crossTileIDs.push(L)}this.index.finish()}findMatches(l,h,x){const w=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),M=Ts/Math.pow(2,h.canonical.z-this.tileID.canonical.z),A=h.canonical.x*s.J,k=h.canonical.y*s.J;for(let L=0;L<l.length;L++){const O=l.get(L);if(O.crossTileID)continue;const{key:N,tileAnchorX:j,tileAnchorY:H}=O,q=Math.floor((A+j)*M),Y=Math.floor((k+H)*M),J=this.index.range(q-w,Y-w,q+w,Y+w);for(const K of J){const X=this.crossTileIDs[K];if(this.keys[K]===N&&!x.has(X)){x.add(X),O.crossTileID=X;break}}}}}class Bl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Wi{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const h=Math.round((l-this.lng)/360);if(h!==0)for(const x in this.indexes){const w=this.indexes[x],M={};for(const A in w){const k=w[A];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+h),M[k.tileID.key]=k}this.indexes[x]=M}this.lng=l}addBucket(l,h,x){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let M=0;M<h.symbolInstances.length;M++)h.symbolInstances.get(M).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]=new Set);const w=this.usedCrossTileIDs[l.overscaledZ];for(const M in this.indexes){const A=this.indexes[M];if(Number(M)>l.overscaledZ)for(const k in A){const L=A[k];L.tileID.isChildOf(l)&&L.findMatches(h.symbolInstances,l,w)}else{const k=A[l.scaledTo(Number(M)).key];k&&k.findMatches(h.symbolInstances,l,w)}}for(let M=0;M<h.symbolInstances.length;M++){const A=h.symbolInstances.get(M);A.crossTileID||(A.crossTileID=x.generate(),w.add(A.crossTileID))}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Ol(l,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(l,h){for(const x of h.crossTileIDs)this.usedCrossTileIDs[l].delete(x)}removeStaleBuckets(l){let h=!1;for(const x in this.indexes){const w=this.indexes[x];for(const M in w)l[w[M].bucketInstanceId]||(this.removeBucketCrossTileIDs(x,w[M]),delete w[M],h=!0)}return h}}class R_{constructor(){this.layerIndexes={},this.crossTileIDs=new Bl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,h,x,w){let M=this.layerIndexes[l.fqid];M===void 0&&(M=this.layerIndexes[l.fqid]=new Wi);let A=!1;const k={};w.name!=="globe"&&M.handleWrapJump(x);for(const L of h){const O=L.getBucket(l);O&&l.fqid===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),M.addBucket(L.tileID,O,this.crossTileIDs)&&(A=!0),k[O.bucketInstanceId]=!0)}return M.removeStaleBuckets(k)&&(A=!0),A}pruneUnusedLayers(l){const h={};l.forEach(x=>{h[x]=!0});for(const x in this.layerIndexes)h[x]||delete this.layerIndexes[x]}}var Hc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,So=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,np=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Eh="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Eo=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,rp=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ms=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Fl=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);vec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return (texCoord.xxyy+vec2(1.5,0.5).xyxy)/texResolution.xxyy;}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image0,c.yz),texture(u_image0,c.xz),texture(u_image0,c.yw),texture(u_image0,c.xw)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image1,c.yz),texture(u_image1,c.xz),texture(u_image1,c.yw),texture(u_image1,c.xw)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texture(u_image0,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texture(u_image1,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Ah=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,sp=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Wc=[];io(Hc,Wc),io(np,Wc),io(So,Wc);const Ao={"_prelude_fog.vertex.glsl":rp,"_prelude_terrain.vertex.glsl":Eo,"_prelude_shadow.vertex.glsl":Ah,"_prelude_fog.fragment.glsl":Ms,"_prelude_shadow.fragment.glsl":sp,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Fl},Io={};Ai("",Eo),Ai(Ms,rp),Ai(sp,Ah),Ai(Fl,"");const op=Ai(So,np),aa=Hc;var Ih={background:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ai("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ai(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ai(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ai("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ai("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ai("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ai(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ai(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ai(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;HANDLE_WIREFRAME_DEBUG;
#endif
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ai(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),symbolIcon:Ai(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:Ai(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Ai(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Ai("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ai(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Eh),skyboxGradient:Ai(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Eh),skyboxCapture:Ai(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ai(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ai(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ai(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function io(g,l){const h=g.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let x of h)if(x=x.trim(),x[0]==="#"&&x.includes("if")&&!x.includes("endif")){x=x.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const w=x.split(" ");for(const M of w)l.includes(M)||l.push(M)}}function Ai(g,l){const h=/#include\s+"([^"]+)"/g,x=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let w=l.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);w&&(w=w.map(O=>{const N=O.split(" ");return N[N.length-1]}),w=[...new Set(w)]);const M={},A=[],k=[];if(g=g.replace(h,(O,N)=>(k.push(N),"")),(l=l.replace(h,(O,N)=>(A.push(N),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let L=[...Wc];io(g,L),io(l,L);for(const O of[...A,...k])Ao[O]||console.error(`Undefined include: ${O}`),Io[O]||(Io[O]=[],io(Ao[O],Io[O])),L=[...L,...Io[O]];return{fragmentSource:g=g.replace(x,(O,N,j,H,q)=>(M[q]=!0,N==="define"?`
#ifndef HAS_UNIFORM_u_${q}
in ${j} ${H} ${q};
#else
uniform ${j} ${H} u_${q};
#endif
`:N==="initialize"?`
#ifdef HAS_UNIFORM_u_${q}
    ${j} ${H} ${q} = u_${q};
#endif
`:N==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${j} ${H} ${q};
#endif
`:N==="initialize-attribute"?"":void 0)),vertexSource:l=l.replace(x,(O,N,j,H,q)=>{const Y=H==="float"?"vec2":H,J=q.match(/color/)?"color":Y;return N==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${q}
in ${j} ${H} a_${q};
#endif
`:M[q]?N==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${j} ${Y} a_${q};
out ${j} ${H} ${q};
#else
uniform ${j} ${H} u_${q};
#endif
`:N==="initialize"?J==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${j} ${H} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${J}(a_${q}, u_${q}_t);
#else
    ${j} ${H} ${q} = u_${q};
#endif
`:N==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${j} ${H} a_${q};
    out ${j} ${H} ${q};
#endif
`:N==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${q} = a_${q};
#endif
`:void 0:N==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${j} ${Y} a_${q};
#else
uniform ${j} ${H} u_${q};
#endif
`:N==="define-instanced"?J==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${q}0;
in vec4 a_${q}1;
in vec4 a_${q}2;
in vec4 a_${q}3;
#else
uniform ${j} ${H} u_${q};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${j} ${Y} a_${q};
#else
uniform ${j} ${H} u_${q};
#endif
`:N==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${j} ${H} ${q} = a_${q};
#endif
`:J==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${j} ${H} ${q} = a_${q};
#else
    ${j} ${H} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${j} ${H} ${q} = unpack_mix_${J}(a_${q}, u_${q}_t);
#else
    ${j} ${H} ${q} = u_${q};
#endif
`}),staticAttributes:w,usedDefines:L,vertexIncludes:A,fragmentIncludes:k}}class O_{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,h,x,w,M,A,k,L){this.context=l;let O=this.boundPaintVertexBuffers.length!==w.length;for(let j=0;!O&&j<w.length;j++)this.boundPaintVertexBuffers[j]!==w[j]&&(O=!0);let N=this.boundDynamicVertexBuffers.length!==k.length;for(let j=0;!N&&j<k.length;j++)this.boundDynamicVertexBuffers[j]!==k[j]&&(N=!0);if(!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==x||O||N||this.boundIndexBuffer!==M||this.boundVertexOffset!==A)this.freshBind(h,x,w,M,A,k,L);else{l.bindVertexArrayOES.set(this.vao);for(const j of k)j&&(j.bind(),L&&j.instanceCount&&j.setVertexAttribDivisor(l.gl,h,L));M&&M.dynamicDraw&&M.bind()}}freshBind(l,h,x,w,M,A,k){const L=l.numAttributes,O=this.context,N=O.gl;this.vao&&this.destroy(),this.vao=O.gl.createVertexArray(),O.bindVertexArrayOES.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=x,this.boundIndexBuffer=w,this.boundVertexOffset=M,this.boundDynamicVertexBuffers=A,h.enableAttributes(N,l),h.bind(),h.setVertexAttribPointers(N,l,M);for(const j of x)j.enableAttributes(N,l),j.bind(),j.setVertexAttribPointers(N,l,M);for(const j of A)j&&(j.enableAttributes(N,l),j.bind(),j.setVertexAttribPointers(N,l,M),k&&j.instanceCount&&j.setVertexAttribDivisor(N,l,k));w&&w.bind(),O.currentNumAttributes=L}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function B_(g,l){const h=Math.pow(2,l.canonical.z),x=l.canonical.y;return[new s.M(0,x/h).toLngLat().lat,new s.M(0,(x+1)/h).toLngLat().lat]}function F_(g,l,h,x,w,M,A){const k=g.context,L=k.gl,O=h.hillshadeFBO;if(!O)return;g.prepareDrawTile();const N=g.isTileAffectedByFog(l),j=g.getOrCreateProgram("hillshade",{overrideFog:N});k.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,O.colorAttachment.get());const H=((K,X,oe,de)=>{const fe=oe.paint.get("hillshade-shadow-color"),ne=oe.paint.get("hillshade-highlight-color"),ae=oe.paint.get("hillshade-accent-color"),me=oe.paint.get("hillshade-emissive-strength");let xe=s.d(oe.paint.get("hillshade-illumination-direction"));if(oe.paint.get("hillshade-illumination-anchor")==="viewport")xe-=K.transform.angle;else if(K.style&&K.style.enable3dLights()&&K.style.directionalLight){const be=K.style.directionalLight.properties.get("direction"),Ue=s.b3(be.x,be.y,be.z);xe=s.d(Ue[1])}const _e=!K.options.moving;return{u_matrix:de||K.transform.calculateProjMatrix(X.tileID.toUnwrapped(),_e),u_image:0,u_latrange:B_(0,X.tileID),u_light:[oe.paint.get("hillshade-exaggeration"),xe],u_shadow:fe,u_highlight:ne,u_emissive_strength:me,u_accent:ae}})(g,h,x,g.terrain?l.projMatrix:null);g.uploadCommonUniforms(k,j,l.toUnwrapped());const{tileBoundsBuffer:q,tileBoundsIndexBuffer:Y,tileBoundsSegments:J}=g.getTileBoundsBuffers(h);j.draw(g,L.TRIANGLES,w,M,A,s.b5.disabled,H,x.id,q,Y,J)}function kh(g,l,h){if(!l.needsDEMTextureUpload)return;const x=g.context,w=x.gl;x.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||g.getTileTexture(h.stride);const M=h.getPixels();l.demTexture?l.demTexture.update(M,{premultiply:!1}):l.demTexture=new s.a9(x,M,w.R32F,{premultiply:!1}),l.needsDEMTextureUpload=!1}function N_(g,l,h){const x=g.context,w=x.gl;if(!l.dem)return;const M=l.dem;if(x.activeTexture.set(w.TEXTURE1),kh(g,l,M),!l.demTexture)return;l.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);const A=M.dim;x.activeTexture.set(w.TEXTURE0);let k=l.hillshadeFBO;if(!k){const H=new s.a9(x,{width:A,height:A,data:null},w.RGBA);H.bind(w.LINEAR,w.CLAMP_TO_EDGE),k=l.hillshadeFBO=x.createFramebuffer(A,A,!0,"renderbuffer"),k.colorAttachment.set(H.texture)}x.bindFramebuffer.set(k.framebuffer),x.viewport.set([0,0,A,A]);const{tileBoundsBuffer:L,tileBoundsIndexBuffer:O,tileBoundsSegments:N}=g.getMercatorTileBoundsBuffers(),j=[];g.linearFloatFilteringSupported()&&j.push("TERRAIN_DEM_FLOAT_FORMAT"),g.getOrCreateProgram("hillshadePrepare",{defines:j}).draw(g,w.TRIANGLES,s.b4.disabled,s.b6.disabled,s.a.unblended,s.b5.disabled,((H,q)=>{const Y=q.stride,J=s.m.create();return s.m.ortho(J,0,s.J,-s.J,0,0,1),s.m.translate(J,J,[0,-s.J,0]),{u_matrix:J,u_image:1,u_dimension:[Y,Y],u_zoom:H.overscaledZ}})(l.tileID,M),h.id,L,O,N),l.needsHillshadePrepare=!1}const qc=g=>({u_matrix:new s.a_(g),u_image0:new s.a$(g),u_skirt_height:new s.b2(g),u_ground_shadow_factor:new s.b7(g)}),Ch=(g,l,h)=>({u_matrix:g,u_image0:0,u_skirt_height:l,u_ground_shadow_factor:h}),Ph=(g,l,h,x,w,M,A,k,L,O,N,j,H,q,Y)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(x),u_merc_matrix:h,u_zoom_transition:w,u_merc_center:M,u_image0:0,u_frustum_tl:A,u_frustum_tr:k,u_frustum_br:L,u_frustum_bl:O,u_globe_pos:N,u_globe_radius:j,u_viewport:H,u_grid_matrix:Y?Float32Array.from(Y):new Float32Array(9),u_skirt_height:q}),la=(g,l)=>{if(l>0&&g.terrain&&s.X("Cutoff is currently disabled on terrain"),l<=0||g.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const h=g.transform,x=Math.max(Math.abs(h._zoom-(g.minCutoffZoom-1)),1),w=h.isLODDisabled(!1)?s.an(60,45,h.pitch):s.an(30,15,h.pitch),M=h._farZ-h._nearZ,A=l*h.height,k=((1-(L=w))*h.cameraToCenterDistance+L*(h._farZ+A))*x;var L;return{shouldRenderCutoff:w<1,uniformValues:{u_cutoff_params:[h._nearZ,h._farZ,(k-h._nearZ)/M,(k-A-h._nearZ)/M]}}};function Dh(g,l){return g!=null&&l!=null&&!(!g.hasData()||!l.hasData())&&g.demTexture!=null&&l.demTexture!=null&&g.tileID.key!==l.tileID.key}const Ns=new class{constructor(){this.operations={}}newMorphing(g,l,h,x,w){if(g in this.operations){const M=this.operations[g];M.to.tileID.key!==h.tileID.key&&(M.queued=h)}else this.operations[g]={startTime:x,phase:0,duration:w,from:l,to:h,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const l=this.operations[g];return{from:l.from,to:l.to,phase:l.phase}}update(g){for(const l in this.operations){const h=this.operations[l];for(h.phase=(g-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,g)){delete this.operations[l];break}}}_nextOp(g,l){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=l,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},Zc={0:null,1:"TERRAIN_VERTEX_MORPHING"};function zh(g,l,h){if(l===0)return 0;const x=l<1&&h===514?.25/l:1;return 6*Math.pow(1.5,22-g)*Math.max(l,1)*x}function Lh(g,l){const h=1<<g.z;return!l&&(g.x===0||g.x===h-1)||g.y===0||g.y===h-1}const Xc=g=>({u_matrix:g});function Yc(g,l,h,x,w){if(w>0){const M=s.a4.now(),A=(M-g.timeAdded)/w,k=l?(M-l.timeAdded)/w:-1,L=h.getSource(),O=x.coveringZoomLevel({tileSize:L.tileSize,roundZoom:L.roundZoom}),N=!l||Math.abs(l.tileID.overscaledZ-O)>Math.abs(g.tileID.overscaledZ-O),j=N&&g.refreshedUponExpiration?1:s.c(N?A:1-k,0,1);return g.refreshedUponExpiration&&A>=1&&(g.refreshedUponExpiration=!1),l?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}class xt extends s.bq{constructor(l){const h={type:"raster-dem",maxzoom:l.transform.maxZoom},x=new s.br(s.bs(),null),w=bs("mock-dem",h,x,l.style);super("mock-dem",w,!1),w.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,h){l.state="loaded",h(null)}}class ap extends s.bq{constructor(l){const h=bs("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new s.br(s.bs(),null),l.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,h,x){if(l.freezeTileCoverage)return;this.transform=l;const w=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((M,A)=>{if(M[A.key]="",!this._tiles[A.key]){const k=new s.bt(A,this._source.tileSize*A.overscaleFactor(),l.tileZoom);k.state="loaded",this._tiles[A.key]=k}return M},{});for(const M in this._tiles)M in w||(this.freeFBO(M),this._tiles[M].unloadVectorData(),delete this._tiles[M])}freeFBO(l){const h=this.proxyCachedFBO[l];if(h!==void 0){const x=Object.values(h);this.renderCachePool.push(...x),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Kc extends s.O{constructor(l,h,x){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=h,this.projMatrix=x}}class Rh extends s.bk{constructor(l,h){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},l.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[x,w,M]=function(L){const O=new s.bo,N=new s.bp,j=131;O.reserve(17161),N.reserve(33800);const H=s.J/128,q=s.J+H/2,Y=q+H;for(let K=-H;K<Y;K+=H)for(let X=-H;X<Y;X+=H){const oe=X<0||X>q||K<0||K>q?24575:0,de=s.c(Math.round(X),0,s.J),fe=s.c(Math.round(K),0,s.J);O.emplaceBack(de+oe,fe)}const J=(K,X)=>{const oe=X*j+K;N.emplaceBack(oe+1,oe,oe+j),N.emplaceBack(oe+j,oe+j+1,oe+1)};for(let K=1;K<129;K++)for(let X=1;X<129;X++)J(X,K);return[0,129].forEach(K=>{for(let X=0;X<130;X++)J(X,K),J(K,X)}),[O,N,32768]}(),A=l.context;this.gridBuffer=A.createVertexBuffer(x,s.bl.members),this.gridIndexBuffer=A.createIndexBuffer(w),this.gridSegments=s.bm.simpleSegment(0,0,x.length,w.length),this.gridNoSkirtSegments=s.bm.simpleSegment(0,0,x.length,M),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ap(h.map),this.orthoMatrix=s.m.create(),s.m.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.J,0,s.J,0,1);const k=A.gl;this._overlapStencilMode=new s.b6({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new xt(h.map),this._pendingGroundEffectLayers=[]}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),this._style=l,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(l,h,x){if(l&&l.terrain){this._style!==l&&(this.style=l,this._evaluationZoom=void 0);const w=l.terrain.properties,M=l.terrain.drapeRenderMode===0,A=l.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.a4.now();const k=l.terrain&&l.terrain.scope,L=w.get("source"),O=M?this._mockSourceCache:l.getSourceCache(L,k);if(!O)return void s.X(`Couldn't find terrain source "${L}".`);if(this.sourceCache=O,this._exaggeration=A?this.calculateExaggeration(h):w.get("exaggeration"),!h.projection.requiresDraping&&A&&this._exaggeration===0)return void this._disable();this.enabled=!0;const N=()=>{this.sourceCache.used&&s.X(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const j=this.getScaledDemTileSize();this.sourceCache.update(h,j,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,N(),this._initializing=!0),N(),h.updateElevation(!0,x),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0,this._previousZoom=h.zoom}else this._disable()}calculateExaggeration(l){const h=this._previousCameraAltitude,x=l.getFreeCameraOptions().position.z/l.pixelsPerMeter*l.worldSize;this._previousCameraAltitude=x;const w=h!=null?x-h:Number.MAX_VALUE;if(Math.abs(w)<2)return this._exaggeration;const M=l.zoom,A=this._style.terrain;if(!this._previousUpdateTimestamp)return A.getExaggeration(M);let k=M-this._previousZoom;const L=this._previousUpdateTimestamp;let O=M;this._evaluationZoom!=null&&(O=this._evaluationZoom,Math.abs(M-O)>.5&&(k=.5*(M-O+k)),k*w<0&&(O+=k)),this._evaluationZoom=O;const N=A.getExaggeration(O),j=N===A.getExaggeration(Math.max(0,O-.1));if(j&&Math.abs(N-this._exaggeration)<.01)return N;let H=Math.min(.1,.00375*(this._updateTimestamp-L));return(j||N<.1||Math.abs(k)<1e-4)&&(H=Math.min(.2,4*H)),s.n(this._exaggeration,N,H)}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(l){l.coord&&l.dataType==="source"?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):l.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._mergedSourceCaches)this._style._mergedSourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,x=this.painter.transform;this._initializing&&(this._initializing=x._centerAltitude===0&&this.getAtPointOrZero(s.M.fromLngLat(x.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=h.getIds().map(L=>{const O=h.getTileByID(L).tileID;return O.projMatrix=x.calculateProjMatrix(O.toUnwrapped()),O});(function(L,O){const N=O.transform.pointCoordinate(O.transform.getCameraPoint()),j=new s.P(N.x,N.y);L.sort((H,q)=>{if(q.overscaledZ-H.overscaledZ)return q.overscaledZ-H.overscaledZ;const Y=new s.P(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),J=new s.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),K=j.mult(1<<H.canonical.z);return K.x-=.5,K.y-=.5,K.distSqr(Y)-K.distSqr(J)})})(w,this.painter);const M=this.proxyToSource||{};this.proxyToSource={},w.forEach(L=>{this.proxyToSource[L.key]={}}),this.terrainTileForTile={};const A=this._style._mergedSourceCaches;for(const L in A){const O=A[L];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,l[L],M),O.usedForTerrain))continue;const N=l[L];O.getSource().reparseOverscaled&&this._assignTerrainTiles(N)}this.proxiedCoords[h.id]=w.map(L=>new Kc(L,L.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(M),this.renderingToTexture=!1;const k={};this._visibleDemTiles=[];for(const L of this.proxyCoords){const O=this.terrainTileForTile[L.key];if(!O)continue;const N=O.tileID.key;N in k||(this._visibleDemTiles.push(O),k[N]=N)}}_assignTerrainTiles(l){this._initializing||l.forEach(h=>{if(this.terrainTileForTile[h.key])return;const x=this._findTileCoveringTileID(h,this.sourceCache);x&&(this.terrainTileForTile[h.key]=x)})}_prepareDEMTextures(){const l=this.painter.context,h=l.gl;for(const x in this.terrainTileForTile){const w=this.terrainTileForTile[x],M=w.dem;!M||w.demTexture&&!w.needsDEMTextureUpload||(l.activeTexture.set(h.TEXTURE1),kh(this.painter,w,M))}}_prepareDemTileUniforms(l,h,x,w){if(!h||h.demTexture==null)return!1;const M=l.tileID.canonical,A=Math.pow(2,h.tileID.canonical.z-M.z),k=w||"";return x[`u_dem_tl${k}`]=[M.x*A%1,M.y*A%1],x[`u_dem_scale${k}`]=A,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const l=this.painter.context,h=l.gl;if(!this._emptyDepthBufferTexture){const x=new s.a5({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.a9(l,x,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let l=0;const h=this._visibleDemTiles.reduce((x,w)=>{if(!w.dem)return x;const M=w.dem.tree.minimums[0];return M>0&&l++,x+M},0);return l?h/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,h=l.gl;l.activeTexture.set(h.TEXTURE2);const x=this._getLoadedAreaMinimum(),[w,M]=(()=>{const k=new s.bu({width:1,height:1},new Float32Array([x]));return[h.R32F,k]})();this._emptyDEMTextureDirty=!1;let A=this._emptyDEMTexture;return A?A.update(M,{premultiply:!1}):A=this._emptyDEMTexture=new s.a9(l,M,w,{premultiply:!1}),A}setupElevationDraw(l,h,x){const w=this.painter.context,M=w.gl,A={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};A.u_exaggeration=this.exaggeration();let k=null,L=null,O=1;if(x&&x.morphing&&this._useVertexMorphing){const H=x.morphing.srcDemTile,q=x.morphing.dstDemTile;O=x.morphing.phase,H&&q&&(this._prepareDemTileUniforms(l,H,A,"_prev")&&(L=H),this._prepareDemTileUniforms(l,q,A)&&(k=q))}const N=H=>H&&H.demTexture&&this.painter.linearFloatFilteringSupported()?M.LINEAR:M.NEAREST,j=H=>{A.u_dem_size=H.size[0]===1?1:H.size[0]-2};if(L&&k)w.activeTexture.set(M.TEXTURE2),k.demTexture.bind(N(k),M.CLAMP_TO_EDGE),w.activeTexture.set(M.TEXTURE4),L.demTexture.bind(N(L),M.CLAMP_TO_EDGE),k.demTexture&&j(k.demTexture),A.u_dem_lerp=O;else{k=this.terrainTileForTile[l.tileID.key],w.activeTexture.set(M.TEXTURE2);const H=this._prepareDemTileUniforms(l,k,A)?k.demTexture:this.emptyDEMTexture;H.bind(N(k),M.CLAMP_TO_EDGE),j(H)}if(w.activeTexture.set(M.TEXTURE3),x&&x.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),this._depthFBO&&(A.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),A.u_depth_size_inv=[1,1]),x&&x.useMeterToDem&&k){const H=(1<<k.tileID.canonical.z)*s.b(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;A.u_meter_to_dem=H}if(x&&x.labelPlaneMatrixInv&&(A.u_label_plane_matrix_inv=x.labelPlaneMatrixInv),h.setTerrainUniformValues(w,A),this.painter.transform.projection.name==="globe"){const H=this.globeUniformValues(this.painter.transform,l.tileID.canonical,x&&x.useDenormalizedUpVectorScale);h.setGlobeUniformValues(w,H)}}globeUniformValues(l,h,x){const w=l.projection;return{u_tile_tl_up:w.upVector(h,0,0),u_tile_tr_up:w.upVector(h,s.J,0),u_tile_br_up:w.upVector(h,s.J,s.J),u_tile_bl_up:w.upVector(h,0,s.J),u_tile_up_scale:x?s.bn(1):w.upVectorScale(h,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){const h=this.painter,x=this.painter.context;l.length!==0&&(x.bindFramebuffer.set(null),x.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(w,M,A,k,L){if(w.transform.projection.name==="globe")(function(O,N,j,H,q){const Y=O.context,J=Y.gl;let K,X;const oe=O.transform,de=s.bb(O,Y,oe),fe=(Fe,Ae)=>{if(X===Ae)return;const je=[Zc[Ae],"PROJECTION_GLOBE_VIEW"];de&&je.push("CUSTOM_ANTIALIASING");const Oe=O.isTileAffectedByFog(Fe);K=O.getOrCreateProgram("globeRaster",{defines:je,overrideFog:Oe}),X=Ae},ne=O.colorModeForRenderPass(),ae=new s.b4(J.LEQUAL,s.b4.ReadWrite,O.depthRangeFor3D);Ns.update(q);const me=s.bc(oe),xe=[s.E(oe.center.lng),s.H(oe.center.lat)],_e=O.globeSharedBuffers,be=[oe.width*s.a4.devicePixelRatio,oe.height*s.a4.devicePixelRatio],Ue=Float32Array.from(oe.globeMatrix),ze={useDenormalizedUpVectorScale:!0};{const Fe=O.transform,Ae=zh(Fe.zoom,N.exaggeration(),N.sourceCache._source.tileSize);X=-1;const je=J.TRIANGLES;for(const Oe of H){const qe=j.getTile(Oe),ue=s.b6.disabled,Ce=N.prevTerrainTileForTile[Oe.key],st=N.terrainTileForTile[Oe.key];Dh(Ce,st)&&Ns.newMorphing(Oe.key,Ce,st,q,250),Y.activeTexture.set(J.TEXTURE0),qe.texture&&qe.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const $e=Ns.getMorphValuesForProxy(Oe.key),Ft=$e?1:0;$e&&s.bd(ze,{morphing:{srcDemTile:$e.from,dstDemTile:$e.to,phase:s.ba($e.phase)}});const kt=s.be(Oe.canonical),Xt=s.bf(kt.getCenter().lat),Lt=s.bg(Oe.canonical,kt,Xt,Fe.worldSize/Fe._pixelsPerMercatorPixel),Qt=s.bh(s.bi(Oe.canonical)),$t=Ph(Fe.expandedFarZProjMatrix,Ue,me,Qt,s.ao(Fe.zoom),xe,Fe.frustumCorners.TL,Fe.frustumCorners.TR,Fe.frustumCorners.BR,Fe.frustumCorners.BL,Fe.globeCenterInViewSpace,Fe.globeRadius,be,Ae,Lt);if(fe(Oe,Ft),K&&(N.setupElevationDraw(qe,K,ze),O.uploadCommonUniforms(Y,K,Oe.toUnwrapped()),_e)){const[Gt,Ht,Ri]=_e.getGridBuffers(Xt,Ae!==0);K.draw(O,je,ae,ue,ne,s.b5.backCCW,$t,"globe_raster",Gt,Ht,Ri)}}}if(_e&&(O.renderDefaultNorthPole||O.renderDefaultSouthPole)){const Fe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];de&&Fe.push("CUSTOM_ANTIALIASING"),K=O.getOrCreateProgram("globeRaster",{defines:Fe});for(const Ae of H){const{x:je,y:Oe,z:qe}=Ae.canonical,ue=Oe===0,Ce=Oe===(1<<qe)-1,[st,$e,Ft,kt]=_e.getPoleBuffers(qe,!1);if(kt&&(ue||Ce)){const Xt=j.getTile(Ae);Y.activeTexture.set(J.TEXTURE0),Xt.texture&&Xt.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);let Lt=s.bj(qe,je,oe);const Qt=s.bh(s.bi(Ae.canonical)),$t=(Gt,Ht)=>Gt.draw(O,J.TRIANGLES,ae,s.b6.disabled,ne,s.b5.disabled,Ph(oe.expandedFarZProjMatrix,Lt,Lt,Qt,0,xe,oe.frustumCorners.TL,oe.frustumCorners.TR,oe.frustumCorners.BR,oe.frustumCorners.BL,oe.globeCenterInViewSpace,oe.globeRadius,be,0),"globe_pole_raster",Ht,Ft,kt);N.setupElevationDraw(Xt,K,ze),O.uploadCommonUniforms(Y,K,Ae.toUnwrapped()),ue&&O.renderDefaultNorthPole&&$t(K,st),Ce&&O.renderDefaultSouthPole&&(Lt=s.m.scale(s.m.create(),Lt,[1,-1,1]),$t(K,$e))}}}})(w,M,A,k,L);else{const O=w.context,N=O.gl;let j,H;const q=w.shadowRenderer,Y=la(w,w.longestCutoffRange),J=ne=>{if(H===ne)return;const ae=[];ae.push(Zc[ne]),Y.shouldRenderCutoff&&ae.push("RENDER_CUTOFF"),j=w.getOrCreateProgram("terrainRaster",{defines:ae}),H=ne},K=w.colorModeForRenderPass(),X=new s.b4(N.LEQUAL,s.b4.ReadWrite,w.depthRangeFor3D);Ns.update(L);const oe=w.transform,de=zh(oe.zoom,M.exaggeration(),M.sourceCache._source.tileSize);let fe=[0,0,0];if(q){const ne=w.style.directionalLight,ae=w.style.ambientLight;ne&&ae&&(fe=cu(ne,ae))}{H=-1;const ne=N.TRIANGLES,[ae,me]=[M.gridIndexBuffer,M.gridSegments];for(const xe of k){const _e=A.getTile(xe),be=s.b6.disabled,Ue=M.prevTerrainTileForTile[xe.key],ze=M.terrainTileForTile[xe.key];Dh(Ue,ze)&&Ns.newMorphing(xe.key,Ue,ze,L,250),O.activeTexture.set(N.TEXTURE0),_e.texture&&_e.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const Fe=Ns.getMorphValuesForProxy(xe.key),Ae=Fe?1:0;let je;Fe&&(je={morphing:{srcDemTile:Fe.from,dstDemTile:Fe.to,phase:s.ba(Fe.phase)}});const Oe=Ch(xe.projMatrix,Lh(xe.canonical,oe.renderWorldCopies)?de/10:de,fe);if(J(Ae),!j)continue;M.setupElevationDraw(_e,j,je);const qe=xe.toUnwrapped();q&&q.setupShadows(qe,j),w.uploadCommonUniforms(O,j,qe,null,Y),j.draw(w,ne,X,be,K,s.b5.backCCW,Oe,"terrain_raster",M.gridBuffer,ae,me)}}}}(h,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(this._drapedRenderBatches.length===0)return l+1;this.renderingToTexture=!0;const h=this.painter,x=this.painter.context,w=this.proxySourceCache,M=this.proxiedCoords[w.id],A=this._drapedRenderBatches.shift(),k=h.style.order,L=[];let O=0;for(const N of M){const j=w.getTileByID(N.proxyTileKey),H=w.proxyCachedFBO[N.key]?w.proxyCachedFBO[N.key][l]:void 0,q=H!==void 0?w.renderCache[H]:this.pool[O++],Y=H!==void 0;if(j.texture=q.tex,Y&&!q.dirty){L.push(j.tileID);continue}let J;x.bindFramebuffer.set(q.fb.framebuffer),this.renderedToTile=!1,q.dirty&&(x.clear({color:s.C.transparent,stencil:0}),q.dirty=!1);for(let K=A.start;K<=A.end;++K){const X=h.style._mergedLayers[k[K]];if(X.isHidden(h.transform.zoom))continue;const oe=h.style.getLayerSourceCache(X),de=oe?this.proxyToSource[N.key][oe.id]:[N];if(!de)continue;const fe=de;x.viewport.set([0,0,q.fb.width,q.fb.height]),J!==(oe?oe.id:null)&&(this._setupStencil(q,de,X,oe),J=oe?oe.id:null),h.renderLayer(h,oe,X,fe)}if(this._drapedRenderBatches.length===0)for(const K of this._pendingGroundEffectLayers){const X=h.style._mergedLayers[k[K]];if(X.isHidden(h.transform.zoom))continue;const oe=h.style.getLayerSourceCache(X),de=oe?this.proxyToSource[N.key][oe.id]:[N];if(!de)continue;const fe=de;x.viewport.set([0,0,q.fb.width,q.fb.height]),J!==(oe?oe.id:null)&&(this._setupStencil(q,de,X,oe),J=oe?oe.id:null),h.renderLayer(h,oe,X,fe)}this.renderedToTile?(q.dirty=!0,L.push(j.tileID)):Y||--O,O===5&&(O=0,this.renderToBackBuffer(L))}return this.renderToBackBuffer(L),this.renderingToTexture=!1,x.bindFramebuffer.set(null),x.viewport.set([0,0,h.width,h.height]),A.end+1}postRender(){}isLayerOrderingCorrect(l){const h=l.order.length;let x=-1,w=h;for(let M=0;M<h;++M)this._style.isLayerDraped(l._mergedLayers[l.order[M]])?x=Math.max(x,M):w=Math.min(w,M);return w>x}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{l=Math.min(l,h.dem.tree.minimums[0])}),l===0?l:(l-30)*this._exaggeration}raycast(l,h,x){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(M=>M.dem).map(M=>{const A=M.tileID,k=1<<A.overscaledZ,{x:L,y:O}=A.canonical,N=L/k,j=(L+1)/k,H=O/k,q=(O+1)/k;return{minx:N,miny:H,maxx:j,maxy:q,t:M.dem.tree.raycastRoot(N,H,j,q,l,h,x),tile:M}});w.sort((M,A)=>(M.t!==null?M.t:Number.MAX_VALUE)-(A.t!==null?A.t:Number.MAX_VALUE));for(const M of w){if(M.t==null)return null;const A=M.tile.dem.tree.raycast(M.minx,M.miny,M.maxx,M.maxy,l,h,x);if(A!=null)return A}return null}_createFBO(){const l=this.painter.context,h=l.gl,x=this.drapeBufferSize;l.activeTexture.set(h.TEXTURE0);const w=new s.a9(l,{width:x[0],height:x[1],data:null},h.RGBA);w.bind(h.LINEAR,h.CLAMP_TO_EDGE);const M=l.createFramebuffer(x[0],x[1],!0,null);return M.colorAttachment.set(w.texture),M.depthAttachment=new Fi(l,M.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,x[0],x[1]),this._stencilRef=0,M.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):M.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:M,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const l in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const h=this._style._mergedLayers[l],x=h.isHidden(this.painter.transform.zoom);return h.type==="custom"?!x&&h.shouldRedrape():!x&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let l=!1;for(const x of this._style.getSources())if(x instanceof De){l=!0;break}if(!l)return;const h={};for(let x=0;x<this._style.order.length;++x){const w=this._style._mergedLayers[this._style.order[x]],M=this._style.getLayerSourceCache(w);if(M&&!h[M.id]&&!w.isHidden(this.painter.transform.zoom)&&w.type==="line"&&w.widthExpression()instanceof s.am){h[M.id]=!0;for(const A of this.proxyCoords){const k=this.proxyToSource[A.key][M.id];if(k)for(const L of k)this._clearRenderCacheForTile(M.id,L)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(const x in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[x]._source instanceof Ut){l=!0;break}if(!l)return;const h={};for(let x=0;x<this._style.order.length;++x){const w=this._style._mergedLayers[this._style.order[x]],M=this._style.getLayerSourceCache(w);if(!M||h[M.id]||w.isHidden(this.painter.transform.zoom)||w.type!=="raster")continue;const A=w.paint.get("raster-fade-duration");for(const k of this.proxyCoords){const L=this.proxyToSource[k.key][M.id];if(L)for(const O of L){const N=Yc(M.getTile(O),M.findLoadedParent(O,0),M,this.painter.transform,A);(N.opacity!==1||N.mix!==0)&&this._clearRenderCacheForTile(M.id,O)}}}}_setupDrapedRenderBatches(){const l=this._style.order,h=l.length;if(h===0)return;const x=[];this._pendingGroundEffectLayers=[];let w,M=0,A=this._style._mergedLayers[l[M]];for(;!this._style.isLayerDraped(A)&&A.isHidden(this.painter.transform.zoom)&&++M<h;)A=this._style._mergedLayers[l[M]];for(;M<h;++M){const k=this._style._mergedLayers[l[M]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?w===void 0&&(w=M):(k.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(M),w!==void 0&&(x.push({start:w,end:M-1}),w=void 0)))}if(w!==void 0&&x.push({start:w,end:M-1}),x.length!==0){const k=x[x.length-1];this._pendingGroundEffectLayers.every(L=>L>k.end)||s.X("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=x}_setupRenderCache(l){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const A=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let k=0;k<A.length;++k){const L=Object.values(A[k]);h.renderCachePool.push(...L)}}return}this._clearRasterLayersFromRenderCache();const x=this.proxyCoords,w=this._tilesDirty;for(let A=x.length-1;A>=0;A--){const k=x[A];if(h.getTileByID(k.key),h.proxyCachedFBO[k.key]!==void 0){const L=l[k.key],O=this.proxyToSource[k.key];let N=0;for(const j in O){const H=O[j],q=L[j];if(!q||q.length!==H.length||H.some((Y,J)=>Y!==q[J]||w[j]&&w[j].hasOwnProperty(Y.key))){N=-1;break}++N}for(const j in h.proxyCachedFBO[k.key])h.renderCache[h.proxyCachedFBO[k.key][j]].dirty=N<0||N!==Object.values(L).length}}const M=[...this._drapedRenderBatches];M.sort((A,k)=>k.end-k.start-(A.end-A.start));for(const A of M)for(const k of x){if(h.proxyCachedFBO[k.key])continue;let L=h.renderCachePool.pop();L===void 0&&h.renderCache.length<50&&(L=h.renderCache.length,h.renderCache.push(this._createFBO())),L!==void 0&&(h.proxyCachedFBO[k.key]={},h.proxyCachedFBO[k.key][A.start]=L,h.renderCache[L].dirty=!0)}this._tilesDirty={}}_setupStencil(l,h,x,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const M=this.painter.context,A=M.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let k;if(x.isTileClipped())k=h.length,this._overlapStencilMode.test={func:A.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:A.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(M.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,x.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):s.b6.disabled}_renderTileClippingMasks(l,h){const x=this.painter,w=this.painter.context,M=w.gl;x._tileClippingMaskIDs={},w.setColorMode(s.a.disabled),w.setDepthMode(s.b4.disabled);const A=x.getOrCreateProgram("clippingMask");for(const k of l){const L=x._tileClippingMaskIDs[k.key]=--h;A.draw(x,M.TRIANGLES,s.b4.disabled,new s.b6({func:M.ALWAYS,mask:0},L,255,M.KEEP,M.KEEP,M.REPLACE),s.a.disabled,s.b5.disabled,Xc(k.projMatrix),"$clipping",x.tileExtentBuffer,x.quadTriangleIndexBuffer,x.tileExtentSegments)}}pointCoordinate(l){const h=this.painter.transform;if(l.x<0||l.x>h.width||l.y<0||l.y>h.height)return null;const x=[l.x,l.y,1,1];s.e.transformMat4(x,x,h.pixelMatrixInverse),s.e.scale(x,x,1/x[3]),x[0]/=h.worldSize,x[1]/=h.worldSize;const w=h._camera.position,M=s.b(1,h.center.lat),A=[w[0],w[1],w[2]/M,0],k=s.v.subtract([],x.slice(0,3),A);s.v.normalize(k,k);const L=this.raycast(A,k,this._exaggeration);return L!==null&&L?(s.v.scaleAndAdd(A,A,k,L),A[3]=A[2],A[2]*=M,A):null}drawDepth(){const l=this.painter,h=l.context,x=this.proxySourceCache,w=Math.ceil(l.width),M=Math.ceil(l.height);if(!this._depthFBO||this._depthFBO.width===w&&this._depthFBO.height===M||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const A=h.gl,k=h.createFramebuffer(w,M,!0,"renderbuffer");h.activeTexture.set(A.TEXTURE0);const L=new s.a9(h,{width:w,height:M,data:null},A.RGBA);L.bind(A.NEAREST,A.CLAMP_TO_EDGE),k.colorAttachment.set(L.texture);const O=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,w,M);k.depthAttachment.set(O),this._depthFBO=k,this._depthTexture=L}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,w,M]),function(A,k,L,O){if(A.transform.projection.name==="globe")return;const N=A.context,j=N.gl;N.clear({depth:1});const H=A.getOrCreateProgram("terrainDepth"),q=new s.b4(j.LESS,s.b4.ReadWrite,A.depthRangeFor3D);for(const Y of O){const J=L.getTile(Y),K=Ch(Y.projMatrix,0,[0,0,0]);k.setupElevationDraw(J,H),H.draw(A,j.TRIANGLES,q,s.b6.disabled,s.a.unblended,s.b5.backCCW,K,"terrain_depth",k.gridBuffer,k.gridIndexBuffer,k.gridNoSkirtSegments)}}(l,this,x,this.proxyCoords)}_setupProxiedCoordsForOrtho(l,h,x){if(l.getSource()instanceof s.aK)return this._setupProxiedCoordsForImageSource(l,h,x);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const w=this.proxiedCoords[l.id]=[],M=this.proxyCoords;for(let L=0;L<M.length;L++){const O=M[L],N=this._findTileCoveringTileID(O,l);if(N){const j=this._createProxiedId(O,N,x[O.key]&&x[O.key][l.id]);w.push(j),this.proxyToSource[O.key][l.id]=[j]}}let A=!1;const k=new Set;for(let L=0;L<h.length;L++){const O=l.getTile(h[L]);if(!O||!O.hasData())continue;const N=this._findTileCoveringTileID(O.tileID,this.proxySourceCache);if(N&&N.tileID.canonical.z!==O.tileID.canonical.z){const j=this.proxyToSource[N.tileID.key][l.id],H=this._createProxiedId(N.tileID,O,x[N.tileID.key]&&x[N.tileID.key][l.id]);j?j.splice(j.length-1,0,H):this.proxyToSource[N.tileID.key][l.id]=[H];const q=this.proxyToSource[N.tileID.key][l.id];k.has(q)||k.add(q),w.push(H),A=!0}}if(this._sourceTilesOverlap[l.id]=A,A&&this._debugParams.sortTilesHiZFirst)for(const L of k)L.sort((O,N)=>N.overscaledZ-O.overscaledZ)}_setupProxiedCoordsForImageSource(l,h,x){if(!l.getSource().loaded())return;const w=this.proxiedCoords[l.id]=[],M=this.proxyCoords,A=l.getSource(),k=A.tileID;if(!k)return;const L=new s.P(k.x,k.y)._div(1<<k.z),O=A.coordinates.map(s.M.fromLngLat).reduce((j,H)=>(j.min.x=Math.min(j.min.x,H.x-L.x),j.min.y=Math.min(j.min.y,H.y-L.y),j.max.x=Math.max(j.max.x,H.x-L.x),j.max.y=Math.max(j.max.y,H.y-L.y),j),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),N=(j,H)=>{const q=j.wrap+j.canonical.x/(1<<j.canonical.z),Y=j.canonical.y/(1<<j.canonical.z),J=s.J/(1<<j.canonical.z),K=H.wrap+H.canonical.x/(1<<H.canonical.z),X=H.canonical.y/(1<<H.canonical.z);return q+J<K+O.min.x||q>K+O.max.x||Y+J<X+O.min.y||Y>X+O.max.y};for(let j=0;j<M.length;j++){const H=M[j];for(let q=0;q<h.length;q++){const Y=l.getTile(h[q]);if(!Y||!Y.hasData()||N(H,Y.tileID))continue;const J=this._createProxiedId(H,Y,x[H.key]&&x[H.key][l.id]),K=this.proxyToSource[H.key][l.id];K?K.push(J):this.proxyToSource[H.key][l.id]=[J],w.push(J)}}}_createProxiedId(l,h,x){let w=this.orthoMatrix;if(x){const M=x.find(A=>A.key===h.tileID.key);if(M)return M}if(h.tileID.key!==l.key){const M=l.canonical.z-h.tileID.canonical.z;let A,k,L;w=s.m.create();const O=h.tileID.wrap-l.wrap<<l.overscaledZ;M>0?(A=s.J>>M,k=A*((h.tileID.canonical.x<<M)-l.canonical.x+O),L=A*((h.tileID.canonical.y<<M)-l.canonical.y)):(A=s.J<<-M,k=s.J*(h.tileID.canonical.x-(l.canonical.x+O<<-M)),L=s.J*(h.tileID.canonical.y-(l.canonical.y<<-M))),s.m.ortho(w,0,A,0,A,0,1),s.m.translate(w,w,[k,L,0])}return new Kc(h.tileID,l.key,w)}_findTileCoveringTileID(l,h){let x=h.getTile(l);if(x&&x.hasData())return x;const w=this._findCoveringTileCache[h.id],M=w[l.key];if(x=M?h.getTileByID(M):null,x&&x.hasData()||M===null)return x;let A=x?x.tileID:l,k=A.overscaledZ;const L=h.getSource().minzoom,O=[];if(!M){const j=h.getSource().maxzoom;if(l.canonical.z>=j){const H=l.canonical.z-j;h.getSource().reparseOverscaled?(k=Math.max(l.canonical.z+2,h.transform.tileZoom),A=new s.O(k,l.wrap,j,l.canonical.x>>H,l.canonical.y>>H)):H!==0&&(k=j,A=new s.O(k,l.wrap,j,l.canonical.x>>H,l.canonical.y>>H))}A.key!==l.key&&(O.push(A.key),x=h.getTile(A))}const N=j=>{O.forEach(H=>{w[H]=j}),O.length=0};for(k-=1;k>=L&&(!x||!x.hasData());k--){x&&N(x.tileID.key);const j=A.calculateScaledKey(k);if(x=h.getTileByID(j),x&&x.hasData())break;const H=w[j];if(H===null)break;H===void 0?O.push(j):x=h.getTileByID(H)}return N(x?x.tileID.key:null),x&&x.hasData()?x:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,h){let x=this._tilesDirty[l];x||(x=this._tilesDirty[l]={}),x[h.key]=!0}}function lp(g,l,h){const x=function(k,L,O){const N=s.v.dot(L,k),j=s.v.dot(O,[.2126,.7152,.0722]),H=(Y,J,K)=>(1-K)*Y+K*J,q=H(1-.3*Math.min(j,1),1,Math.min(N+1,1));return H(.92,1,Math.asin(s.c(L[2],-1,1))/Math.PI+.5)*q}(g,[0,0,1],l),w=[0,0,0];s.v.scale(w,h.slice(0,3),x);const M=[0,0,0];s.v.scale(M,l.slice(0,3),g[2]);const A=[0,0,0];return s.v.add(A,w,M),s.bw(A)}const Jc=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],no=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Qc{static cacheKey(l,h,x,w){let M=`${h}${w?w.cacheKey:""}`;for(const A of x)l.usedDefines.includes(A)&&(M+=`/${A}`);return M}constructor(l,h,x,w,M,A){const k=l.gl;this.program=k.createProgram(),this.configuration=w,this.name=h,this.fixedDefines=[...A];const L=w?w.getBinderAttributes():[],O=(x.staticAttributes||[]).concat(L);let N=w?w.defines():[];N=N.concat(A.map(K=>`#define ${K}`));const j=`#version 300 es
`;let H=j+N.concat("precision mediump float;",aa,op.fragmentSource).join(`
`);for(const K of x.fragmentIncludes)H+=`
${Ao[K]}`;H+=`
${x.fragmentSource}`;let q=j+N.concat("precision highp float;",aa,op.vertexSource).join(`
`);for(const K of x.vertexIncludes)q+=`
${Ao[K]}`;q+=`
${x.vertexSource}`;const Y=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(Y,H),k.compileShader(Y),k.attachShader(this.program,Y);const J=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(J,q),k.compileShader(J),k.attachShader(this.program,J),this.attributes={},this.numAttributes=O.length;for(let K=0;K<this.numAttributes;K++)if(O[K]){const X=O[K].startsWith("a_")?O[K]:`a_${O[K]}`;k.bindAttribLocation(this.program,K,X),this.attributes[X]=K}k.linkProgram(this.program),k.deleteShader(J),k.deleteShader(Y),this.fixedUniforms=M(l),this.binderUniforms=w?w.getUniforms(l):[],A.includes("TERRAIN")&&(this.terrainUniforms=(K=>({u_dem:new s.a$(K),u_dem_prev:new s.a$(K),u_dem_tl:new s.b0(K),u_dem_scale:new s.b2(K),u_dem_tl_prev:new s.b0(K),u_dem_scale_prev:new s.b2(K),u_dem_size:new s.b2(K),u_dem_lerp:new s.b2(K),u_exaggeration:new s.b2(K),u_depth:new s.a$(K),u_depth_size_inv:new s.b0(K),u_meter_to_dem:new s.b2(K),u_label_plane_matrix_inv:new s.a_(K)}))(l)),A.includes("GLOBE")&&(this.globeUniforms=(K=>({u_tile_tl_up:new s.b7(K),u_tile_tr_up:new s.b7(K),u_tile_br_up:new s.b7(K),u_tile_bl_up:new s.b7(K),u_tile_up_scale:new s.b2(K)}))(l)),A.includes("FOG")&&(this.fogUniforms=(K=>({u_fog_matrix:new s.a_(K),u_fog_range:new s.b0(K),u_fog_color:new s.b9(K),u_fog_horizon_blend:new s.b2(K),u_fog_vertical_limit:new s.b0(K),u_fog_temporal_offset:new s.b2(K),u_frustum_tl:new s.b7(K),u_frustum_tr:new s.b7(K),u_frustum_br:new s.b7(K),u_frustum_bl:new s.b7(K),u_globe_pos:new s.b7(K),u_globe_radius:new s.b2(K),u_globe_transition:new s.b2(K),u_is_globe:new s.a$(K),u_viewport:new s.b0(K)}))(l)),A.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(K=>({u_cutoff_params:new s.b9(K)}))(l)),A.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(K=>({u_lighting_ambient_color:new s.b7(K),u_lighting_directional_dir:new s.b7(K),u_lighting_directional_color:new s.b7(K),u_ground_radiance:new s.b7(K)}))(l)),A.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(K=>({u_light_matrix_0:new s.a_(K),u_light_matrix_1:new s.a_(K),u_fade_range:new s.b0(K),u_shadow_normal_offset:new s.b7(K),u_shadow_intensity:new s.b2(K),u_shadow_texel_size:new s.b2(K),u_shadow_map_resolution:new s.b2(K),u_shadow_direction:new s.b7(K),u_shadow_bias:new s.b7(K),u_shadowmap_0:new s.a$(K),u_shadowmap_1:new s.a$(K)}))(l))}}setTerrainUniformValues(l,h){if(!this.terrainUniforms)return;const x=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const w in h)x[w]&&x[w].set(this.program,w,h[w])}}setGlobeUniformValues(l,h){if(!this.globeUniforms)return;const x=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const w in h)x[w]&&x[w].set(this.program,w,h[w])}}setFogUniformValues(l,h){if(!this.fogUniforms)return;const x=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const w in h)x[w].set(this.program,w,h[w])}}setCutoffUniformValues(l,h){if(!this.cutoffUniforms)return;const x=this.cutoffUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const w in h)x[w].set(this.program,w,h[w])}}setLightsUniformValues(l,h){if(!this.lightsUniforms)return;const x=this.lightsUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const w in h)x[w].set(this.program,w,h[w])}}setShadowUniformValues(l,h){if(this.failedToCreate||!this.shadowUniforms)return;const x=this.shadowUniforms;l.program.set(this.program);for(const w in h)x[w].set(this.program,w,h[w])}_drawDebugWireframe(l,h,x,w,M,A,k,L,O,N){const j=l.options.wireframe;if(j.terrain===!1&&j.layers2D===!1&&j.layers3D===!1)return;const H=l.context;if(!(!(!j.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!j.layers2D||l._terrain&&l._terrain.renderingToTexture||!Jc.includes(this.name))||!(!j.layers3D||!no.includes(this.name))))return;const q=H.gl,Y=l.wireframeDebugCache.getLinesFromTrianglesBuffer(l.frameCounter,M,H);if(!Y)return;const J=[...this.fixedDefines];J.push("DEBUG_WIREFRAME");const K=l.getOrCreateProgram(this.name,{config:this.configuration,defines:J});H.program.set(K.program);const X=(fe,ne,ae)=>{if(ne[fe]&&ae[fe])for(const me in ne[fe])ae[fe][me]&&ae[fe][me].set(ae.program,me,ne[fe][me].current)};O&&O.setUniforms(K.program,H,K.binderUniforms,k,{zoom:L}),X("fixedUniforms",this,K),X("terrainUniforms",this,K),X("globeUniforms",this,K),X("fogUniforms",this,K),X("lightsUniforms",this,K),X("shadowUniforms",this,K),Y.bind(),H.setColorMode(new s.a([q.ONE,q.ONE_MINUS_SRC_ALPHA,q.ZERO,q.ONE],s.C.transparent,[!0,!0,!0,!1])),H.setDepthMode(new s.b4(h.func===q.LESS?q.LEQUAL:h.func,s.b4.ReadOnly,h.range)),H.setStencilMode(s.b6.disabled);const oe=3*A.primitiveLength*2,de=3*A.primitiveOffset*2*2;N&&N>1?q.drawElementsInstanced(q.LINES,oe,q.UNSIGNED_SHORT,de,N):q.drawElements(q.LINES,oe,q.UNSIGNED_SHORT,de),M.bind(),H.program.set(this.program),H.setDepthMode(h),H.setStencilMode(x),H.setColorMode(w)}draw(l,h,x,w,M,A,k,L,O,N,j,H,q,Y,J,K){const X=l.context,oe=X.gl;if(this.failedToCreate)return;X.program.set(this.program),X.setDepthMode(x),X.setStencilMode(w),X.setColorMode(M),X.setCullFace(A);for(const ne of Object.keys(this.fixedUniforms))this.fixedUniforms[ne].set(this.program,ne,k[ne]);Y&&Y.setUniforms(this.program,X,this.binderUniforms,H,{zoom:q});const de={[oe.LINES]:2,[oe.TRIANGLES]:3,[oe.LINE_STRIP]:1}[h],fe=K&&K>0?1:void 0;for(const ne of j.get()){const ae=ne.vaos||(ne.vaos={});(ae[L]||(ae[L]=new O_)).bind(X,this,O,Y?Y.getPaintVertexBuffers():[],N,ne.vertexOffset,J||[],fe),K&&K>1?oe.drawElementsInstanced(h,ne.primitiveLength*de,oe.UNSIGNED_SHORT,ne.primitiveOffset*de*2,K):oe.drawElements(h,ne.primitiveLength*de,oe.UNSIGNED_SHORT,ne.primitiveOffset*de*2),h===oe.TRIANGLES&&this._drawDebugWireframe(l,x,w,M,N,ne,H,q,Y,K)}}}function ko(g,l){const h=Math.pow(2,l.tileID.overscaledZ),x=l.tileSize*Math.pow(2,g.transform.tileZoom)/h,w=x*(l.tileID.canonical.x+l.tileID.wrap*h),M=x*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture?l.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ay(l,1,g.transform.tileZoom),u_pixel_coord_upper:[w>>16,M>>16],u_pixel_coord_lower:[65535&w,65535&M]}}const $c=s.m.create(),ca=(g,l,h,x,w,M,A,k,L,O,N,j,H,q,Y,J)=>{const K=l.style.light,X=K.properties.get("position"),oe=[X.x,X.y,X.z],de=s.bx.create();K.properties.get("anchor")==="viewport"&&(s.bx.fromRotation(de,-l.transform.angle),s.v.transformMat3(oe,oe,de));const fe=K.properties.get("color"),ne=l.transform,ae={u_matrix:g,u_lightpos:oe,u_lightintensity:K.properties.get("intensity"),u_lightcolor:[fe.r,fe.g,fe.b],u_vertical_gradient:+h,u_opacity:x,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:$c,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:w,u_edge_radius:M,u_flood_light_color:j,u_vertical_scale:H,u_flood_light_intensity:q,u_ground_shadow_factor:Y,u_emissive_strength:J};return ne.projection.name==="globe"&&(ae.u_tile_id=[A.canonical.x,A.canonical.y,1<<A.canonical.z],ae.u_zoom_transition=L,ae.u_inv_rot_matrix=N,ae.u_merc_center=O,ae.u_up_dir=ne.projection.upVector(new s.t(0,0,0),O[0]*s.J,O[1]*s.J),ae.u_height_lift=k),ae},Oh=(g,l,h)=>({u_matrix:g,u_edge_radius:l,u_vertical_scale:h}),V_=(g,l,h,x,w,M,A,k,L,O,N,j,H,q)=>{const Y=ca(g,l,h,x,w,M,A,L,O,N,j,H,q,1,[0,0,0],0),J={u_height_factor:-Math.pow(2,A.overscaledZ)/k.tileSize/8};return s.ak(Y,ko(l,k),J)},Bh=(g,l)=>({u_matrix:g,u_emissive_strength:l}),Fh=(g,l,h,x)=>s.ak(Bh(g,l),ko(h,x)),Nh=(g,l,h)=>({u_matrix:g,u_world:h,u_emissive_strength:l}),j_=(g,l,h,x,w)=>s.ak(Fh(g,l,h,x),{u_world:w}),U_=(g,l,h,x)=>{const w=s.J/h.tileSize;return{u_matrix:g,u_camera_to_center_distance:l.getCameraToCenterDistance(x),u_extrude_scale:[l.pixelsToGLUnits[0]/w,l.pixelsToGLUnits[1]/w]}},cp=(g,l,h=1)=>({u_matrix:g,u_color:l,u_overlay:0,u_overlay_scale:h}),G_=s.m.create(),up=(g,l,h,x,w,M,A)=>{const k=g.transform,L=k.projection.name==="globe",O=L?s.by(k.zoom,l.canonical)*k._pixelsPerMercatorPixel:s.ay(h,1,M),N={u_matrix:l.projMatrix,u_extrude_scale:O,u_intensity:A,u_inv_rot_matrix:G_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(L){N.u_inv_rot_matrix=x,N.u_merc_center=w,N.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],N.u_zoom_transition=s.ao(k.zoom);const j=w[0]*s.J,H=w[1]*s.J;N.u_up_dir=k.projection.upVector(new s.t(0,0,0),j,H)}return N},hp=(g,l,h,x,w,M,A,k,L,O,N,j,H,q,Y,J,K,X,oe,de,fe)=>{return{u_matrix:g,u_normalize_matrix:l,u_globe_matrix:h,u_merc_matrix:x,u_grid_matrix:w,u_tl_parent:M,u_scale_parent:O,u_fade_t:N.mix,u_opacity:N.opacity*j.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:j.paint.get("raster-brightness-min"),u_brightness_high:j.paint.get("raster-brightness-max"),u_saturation_factor:(ae=j.paint.get("raster-saturation"),ae>0?1-1/(1.001-ae):-ae),u_contrast_factor:(ne=j.paint.get("raster-contrast"),ne>0?1/(1-ne):1+ne),u_spin_weights:eu(j.paint.get("raster-hue-rotate")),u_perspective_transform:H,u_raster_elevation:q,u_zoom_transition:A,u_merc_center:k,u_cutoff_params:L,u_colorization_mix:H_(J,X),u_colorization_offset:dp(K,X),u_color_ramp:Y,u_texture_offset:[de/(oe+2*de),oe/(oe+2*de)],u_texture_res:[oe+2*de,oe+2*de],u_emissive_strength:fe};var ne,ae};function eu(g){g*=Math.PI/180;const l=Math.sin(g),h=Math.cos(g);return[(2*h+1)/3,(-Math.sqrt(3)*l-h+1)/3,(Math.sqrt(3)*l-h+1)/3]}function H_([g,l,h,x],[w,M]){if(w===M)return[0,0,0,0];const A=(s.bz+3)/(s.bz+1)/(M-w);return[g*A,l*A,h*A,x*A]}function dp(g,[l,h]){return l===h?0:((g-l)/(h-l)*(s.bz+3)-1)/(s.bz+1)}const tu=s.m.create(),Nl=(g,l,h,x,w,M,A,k,L,O,N,j,H,q,Y,J,K,X)=>{const oe=w.transform,de={u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:oe.getCameraToCenterDistance(J),u_rotate_symbol:+h,u_aspect_ratio:oe.width/oe.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:M,u_label_plane_matrix:A,u_coord_matrix:k,u_is_text:+L,u_pitch_with_map:+x,u_texsize:O,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:tu,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:tu,u_up_vector:[0,-1,0],u_icon_transition:X||0,u_icon_saturation:K};return J.name==="globe"&&(de.u_tile_id=[N.canonical.x,N.canonical.y,1<<N.canonical.z],de.u_zoom_transition=j,de.u_inv_rot_matrix=q,de.u_merc_center=H,de.u_camera_forward=oe._camera.forward(),de.u_ecef_origin=s.bA(oe.globeMatrix,N.toUnwrapped()),de.u_tile_matrix=Float32Array.from(oe.globeMatrix),de.u_up_vector=Y),de},iu=(g,l,h,x,w,M,A,k,L,O,N,j,H,q,Y,J,K)=>s.ak(Nl(g,l,h,x,w,M,A,k,L,O,j,H,q,Y,J,K,1),{u_gamma_scale:x?w.transform.getCameraToCenterDistance(K)*Math.cos(w.terrain?0:w.transform._pitch):1,u_device_pixel_ratio:s.a4.devicePixelRatio,u_is_halo:+N,undefined:void 0}),Vl=(g,l,h,x,w,M,A,k,L,O,N,j,H,q,Y,J)=>s.ak(iu(g,l,h,x,w,M,A,k,!0,L,!0,N,j,H,q,Y,J),{u_texsize_icon:O,u_texture_icon:1}),Vh=(g,l,h,x)=>({u_matrix:g,u_emissive_strength:l,u_opacity:h,u_color:x}),Qa=(g,l,h,x,w,M,A)=>s.ak(function(k,L,O,N){const j=O.imageManager.getPattern(k.toString(),L),{width:H,height:q}=O.imageManager.getPixelSize(L),Y=Math.pow(2,N.tileID.overscaledZ),J=N.tileSize*Math.pow(2,O.transform.tileZoom)/Y,K=J*(N.tileID.canonical.x+N.tileID.wrap*Y),X=J*N.tileID.canonical.y;return{u_image:0,u_pattern_tl:j.tl,u_pattern_br:j.br,u_texsize:[H,q],u_pattern_size:j.displaySize,u_tile_units_to_pixels:1/s.ay(N,1,O.transform.tileZoom),u_pixel_coord_upper:[K>>16,X>>16],u_pixel_coord_lower:[65535&K,65535&X]}}(w,M,x,A),{u_matrix:g,u_emissive_strength:l,u_opacity:h}),gr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},jl=(g,l,h,x,w,M,A,k,L,O,N,j,H=[0,0,0])=>{const q=x.style.light,Y=q.properties.get("position"),J=[-Y.x,-Y.y,Y.z],K=s.bx.create();q.properties.get("anchor")==="viewport"&&(s.bx.fromRotation(K,-x.transform.angle),s.v.transformMat3(J,J,K));const X=O.alphaMode==="MASK",oe=q.properties.get("color"),de=j.paint.get("model-ambient-occlusion-intensity"),fe=j.paint.get("model-color").constantOr(s.C.white),ne=j.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:g,u_lighting_matrix:l,u_normal_matrix:h,u_lightpos:J,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[oe.r,oe.g,oe.b],u_camera_pos:H,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+X,u_alphaCutoff:O.alphaCutoff,u_baseColorFactor:[M.r,M.g,M.b,M.a],u_emissiveFactor:[A[0],A[1],A[2],1],u_metallicFactor:k,u_roughnessFactor:L,u_baseColorTexture:gr.BaseColor,u_metallicRoughnessTexture:gr.MetallicRoughness,u_normalTexture:gr.Normal,u_occlusionTexture:gr.Occlusion,u_emissionTexture:gr.Emission,u_color_mix:[fe.r,fe.g,fe.b,ne],u_aoIntensity:de,u_emissive_strength:N}},ua=new Float32Array(16),nu=(g,l=ua,h=ua)=>({u_matrix:g,u_instance:l,u_node_matrix:h}),fp={fillExtrusion:g=>({u_matrix:new s.a_(g),u_lightpos:new s.b7(g),u_lightintensity:new s.b2(g),u_lightcolor:new s.b7(g),u_vertical_gradient:new s.b2(g),u_opacity:new s.b2(g),u_edge_radius:new s.b2(g),u_ao:new s.b0(g),u_tile_id:new s.b7(g),u_zoom_transition:new s.b2(g),u_inv_rot_matrix:new s.a_(g),u_merc_center:new s.b0(g),u_up_dir:new s.b7(g),u_height_lift:new s.b2(g),u_flood_light_color:new s.b7(g),u_vertical_scale:new s.b2(g),u_flood_light_intensity:new s.b2(g),u_ground_shadow_factor:new s.b7(g),u_emissive_strength:new s.b2(g)}),fillExtrusionDepth:g=>({u_matrix:new s.a_(g),u_edge_radius:new s.b2(g),u_vertical_scale:new s.b2(g)}),fillExtrusionPattern:g=>({u_matrix:new s.a_(g),u_lightpos:new s.b7(g),u_lightintensity:new s.b2(g),u_lightcolor:new s.b7(g),u_vertical_gradient:new s.b2(g),u_height_factor:new s.b2(g),u_edge_radius:new s.b2(g),u_ao:new s.b0(g),u_tile_id:new s.b7(g),u_zoom_transition:new s.b2(g),u_inv_rot_matrix:new s.a_(g),u_merc_center:new s.b0(g),u_up_dir:new s.b7(g),u_height_lift:new s.b2(g),u_image:new s.a$(g),u_texsize:new s.b0(g),u_pixel_coord_upper:new s.b0(g),u_pixel_coord_lower:new s.b0(g),u_tile_units_to_pixels:new s.b2(g),u_opacity:new s.b2(g)}),fillExtrusionGroundEffect:g=>({u_matrix:new s.a_(g),u_opacity:new s.b2(g),u_ao_pass:new s.b2(g),u_meter_to_tile:new s.b2(g),u_ao:new s.b0(g),u_flood_light_intensity:new s.b2(g),u_flood_light_color:new s.b7(g),u_attenuation:new s.b2(g),u_edge_radius:new s.b2(g),u_fb:new s.a$(g),u_fb_size:new s.b2(g)}),fill:g=>({u_matrix:new s.a_(g),u_emissive_strength:new s.b2(g)}),fillPattern:g=>({u_matrix:new s.a_(g),u_emissive_strength:new s.b2(g),u_image:new s.a$(g),u_texsize:new s.b0(g),u_pixel_coord_upper:new s.b0(g),u_pixel_coord_lower:new s.b0(g),u_tile_units_to_pixels:new s.b2(g)}),fillOutline:g=>({u_matrix:new s.a_(g),u_emissive_strength:new s.b2(g),u_world:new s.b0(g)}),fillOutlinePattern:g=>({u_matrix:new s.a_(g),u_emissive_strength:new s.b2(g),u_world:new s.b0(g),u_image:new s.a$(g),u_texsize:new s.b0(g),u_pixel_coord_upper:new s.b0(g),u_pixel_coord_lower:new s.b0(g),u_tile_units_to_pixels:new s.b2(g)}),circle:s.bB,collisionBox:g=>({u_matrix:new s.a_(g),u_camera_to_center_distance:new s.b2(g),u_extrude_scale:new s.b0(g)}),collisionCircle:g=>({u_matrix:new s.a_(g),u_inv_matrix:new s.a_(g),u_camera_to_center_distance:new s.b2(g),u_viewport_size:new s.b0(g)}),debug:g=>({u_color:new s.b1(g),u_matrix:new s.a_(g),u_overlay:new s.a$(g),u_overlay_scale:new s.b2(g)}),clippingMask:g=>({u_matrix:new s.a_(g)}),heatmap:g=>({u_extrude_scale:new s.b2(g),u_intensity:new s.b2(g),u_matrix:new s.a_(g),u_inv_rot_matrix:new s.a_(g),u_merc_center:new s.b0(g),u_tile_id:new s.b7(g),u_zoom_transition:new s.b2(g),u_up_dir:new s.b7(g)}),heatmapTexture:g=>({u_image:new s.a$(g),u_color_ramp:new s.a$(g),u_opacity:new s.b2(g)}),hillshade:g=>({u_matrix:new s.a_(g),u_image:new s.a$(g),u_latrange:new s.b0(g),u_light:new s.b0(g),u_shadow:new s.b1(g),u_highlight:new s.b1(g),u_emissive_strength:new s.b2(g),u_accent:new s.b1(g)}),hillshadePrepare:g=>({u_matrix:new s.a_(g),u_image:new s.a$(g),u_dimension:new s.b0(g),u_zoom:new s.b2(g)}),line:s.bC,linePattern:s.bD,raster:g=>({u_matrix:new s.a_(g),u_normalize_matrix:new s.a_(g),u_globe_matrix:new s.a_(g),u_merc_matrix:new s.a_(g),u_grid_matrix:new s.b8(g),u_tl_parent:new s.b0(g),u_scale_parent:new s.b2(g),u_fade_t:new s.b2(g),u_opacity:new s.b2(g),u_image0:new s.a$(g),u_image1:new s.a$(g),u_brightness_low:new s.b2(g),u_brightness_high:new s.b2(g),u_saturation_factor:new s.b2(g),u_contrast_factor:new s.b2(g),u_spin_weights:new s.b7(g),u_perspective_transform:new s.b0(g),u_raster_elevation:new s.b2(g),u_zoom_transition:new s.b2(g),u_merc_center:new s.b0(g),u_cutoff_params:new s.b9(g),u_colorization_mix:new s.b9(g),u_colorization_offset:new s.b2(g),u_color_ramp:new s.a$(g),u_texture_offset:new s.b0(g),u_texture_res:new s.b0(g),u_emissive_strength:new s.b2(g)}),symbolIcon:g=>({u_is_size_zoom_constant:new s.a$(g),u_is_size_feature_constant:new s.a$(g),u_size_t:new s.b2(g),u_size:new s.b2(g),u_camera_to_center_distance:new s.b2(g),u_rotate_symbol:new s.a$(g),u_aspect_ratio:new s.b2(g),u_fade_change:new s.b2(g),u_matrix:new s.a_(g),u_label_plane_matrix:new s.a_(g),u_coord_matrix:new s.a_(g),u_is_text:new s.a$(g),u_pitch_with_map:new s.a$(g),u_texsize:new s.b0(g),u_tile_id:new s.b7(g),u_zoom_transition:new s.b2(g),u_inv_rot_matrix:new s.a_(g),u_merc_center:new s.b0(g),u_camera_forward:new s.b7(g),u_tile_matrix:new s.a_(g),u_up_vector:new s.b7(g),u_ecef_origin:new s.b7(g),u_texture:new s.a$(g),u_icon_transition:new s.b2(g),u_icon_saturation:new s.b2(g)}),symbolSDF:g=>({u_is_size_zoom_constant:new s.a$(g),u_is_size_feature_constant:new s.a$(g),u_size_t:new s.b2(g),u_size:new s.b2(g),u_camera_to_center_distance:new s.b2(g),u_rotate_symbol:new s.a$(g),u_aspect_ratio:new s.b2(g),u_fade_change:new s.b2(g),u_matrix:new s.a_(g),u_label_plane_matrix:new s.a_(g),u_coord_matrix:new s.a_(g),u_is_text:new s.a$(g),u_pitch_with_map:new s.a$(g),u_texsize:new s.b0(g),u_texture:new s.a$(g),u_gamma_scale:new s.b2(g),u_device_pixel_ratio:new s.b2(g),u_tile_id:new s.b7(g),u_zoom_transition:new s.b2(g),u_inv_rot_matrix:new s.a_(g),u_merc_center:new s.b0(g),u_camera_forward:new s.b7(g),u_tile_matrix:new s.a_(g),u_up_vector:new s.b7(g),u_ecef_origin:new s.b7(g),u_is_halo:new s.a$(g)}),symbolTextAndIcon:g=>({u_is_size_zoom_constant:new s.a$(g),u_is_size_feature_constant:new s.a$(g),u_size_t:new s.b2(g),u_size:new s.b2(g),u_camera_to_center_distance:new s.b2(g),u_rotate_symbol:new s.a$(g),u_aspect_ratio:new s.b2(g),u_fade_change:new s.b2(g),u_matrix:new s.a_(g),u_label_plane_matrix:new s.a_(g),u_coord_matrix:new s.a_(g),u_is_text:new s.a$(g),u_pitch_with_map:new s.a$(g),u_texsize:new s.b0(g),u_texsize_icon:new s.b0(g),u_texture:new s.a$(g),u_texture_icon:new s.a$(g),u_gamma_scale:new s.b2(g),u_device_pixel_ratio:new s.b2(g),u_is_halo:new s.a$(g)}),background:g=>({u_matrix:new s.a_(g),u_emissive_strength:new s.b2(g),u_opacity:new s.b2(g),u_color:new s.b1(g)}),backgroundPattern:g=>({u_matrix:new s.a_(g),u_emissive_strength:new s.b2(g),u_opacity:new s.b2(g),u_image:new s.a$(g),u_pattern_tl:new s.b0(g),u_pattern_br:new s.b0(g),u_texsize:new s.b0(g),u_pattern_size:new s.b0(g),u_pixel_coord_upper:new s.b0(g),u_pixel_coord_lower:new s.b0(g),u_tile_units_to_pixels:new s.b2(g)}),terrainRaster:qc,terrainDepth:qc,skybox:g=>({u_matrix:new s.a_(g),u_sun_direction:new s.b7(g),u_cubemap:new s.a$(g),u_opacity:new s.b2(g),u_temporal_offset:new s.b2(g)}),skyboxGradient:g=>({u_matrix:new s.a_(g),u_color_ramp:new s.a$(g),u_center_direction:new s.b7(g),u_radius:new s.b2(g),u_opacity:new s.b2(g),u_temporal_offset:new s.b2(g)}),skyboxCapture:g=>({u_matrix_3f:new s.b8(g),u_sun_direction:new s.b7(g),u_sun_intensity:new s.b2(g),u_color_tint_r:new s.b9(g),u_color_tint_m:new s.b9(g),u_luminance:new s.b2(g)}),globeRaster:g=>({u_proj_matrix:new s.a_(g),u_globe_matrix:new s.a_(g),u_normalize_matrix:new s.a_(g),u_merc_matrix:new s.a_(g),u_zoom_transition:new s.b2(g),u_merc_center:new s.b0(g),u_image0:new s.a$(g),u_grid_matrix:new s.b8(g),u_skirt_height:new s.b2(g),u_frustum_tl:new s.b7(g),u_frustum_tr:new s.b7(g),u_frustum_br:new s.b7(g),u_frustum_bl:new s.b7(g),u_globe_pos:new s.b7(g),u_globe_radius:new s.b2(g),u_viewport:new s.b0(g)}),globeAtmosphere:g=>({u_frustum_tl:new s.b7(g),u_frustum_tr:new s.b7(g),u_frustum_br:new s.b7(g),u_frustum_bl:new s.b7(g),u_horizon:new s.b2(g),u_transition:new s.b2(g),u_fadeout_range:new s.b2(g),u_color:new s.b9(g),u_high_color:new s.b9(g),u_space_color:new s.b9(g),u_temporal_offset:new s.b2(g),u_horizon_angle:new s.b2(g)}),model:g=>({u_matrix:new s.a_(g),u_lighting_matrix:new s.a_(g),u_normal_matrix:new s.a_(g),u_lightpos:new s.b7(g),u_lightintensity:new s.b2(g),u_lightcolor:new s.b7(g),u_camera_pos:new s.b7(g),u_opacity:new s.b2(g),u_baseColorFactor:new s.b9(g),u_emissiveFactor:new s.b9(g),u_metallicFactor:new s.b2(g),u_roughnessFactor:new s.b2(g),u_baseTextureIsAlpha:new s.a$(g),u_alphaMask:new s.a$(g),u_alphaCutoff:new s.b2(g),u_baseColorTexture:new s.a$(g),u_metallicRoughnessTexture:new s.a$(g),u_normalTexture:new s.a$(g),u_occlusionTexture:new s.a$(g),u_emissionTexture:new s.a$(g),u_color_mix:new s.b9(g),u_aoIntensity:new s.b2(g),u_emissive_strength:new s.b2(g)}),modelDepth:g=>({u_matrix:new s.a_(g),u_instance:new s.a_(g),u_node_matrix:new s.a_(g)}),groundShadow:g=>({u_matrix:new s.a_(g),u_ground_shadow_factor:new s.b7(g)}),stars:g=>({u_matrix:new s.a_(g),u_up:new s.b7(g),u_right:new s.b7(g),u_intensity_multiplier:new s.b2(g)})};let $a;function jh(g,l,h,x,w,M,A){const k=g.context,L=k.gl,O=g.transform,N=g.getOrCreateProgram("collisionBox"),j=[];let H=0,q=0;for(let fe=0;fe<x.length;fe++){const ne=x[fe],ae=l.getTile(ne),me=ae.getBucket(h);if(!me)continue;const xe=xh(ne,me,O);let _e=xe;w[0]===0&&w[1]===0||(_e=g.translatePosMatrix(xe,ae,w,M));const be=A?me.textCollisionBox:me.iconCollisionBox,Ue=me.collisionCircleArray;if(Ue.length>0){const ze=s.m.create(),Fe=_e;s.m.mul(ze,me.placementInvProjMatrix,O.glCoordMatrix),s.m.mul(ze,ze,me.placementViewportMatrix),j.push({circleArray:Ue,circleOffset:q,transform:Fe,invTransform:ze,projection:me.getProjection()}),H+=Ue.length/4,q=H}be&&(g.terrain&&g.terrain.setupElevationDraw(ae,N),N.draw(g,L.LINES,s.b4.disabled,s.b6.disabled,g.colorModeForRenderPass(),s.b5.disabled,U_(_e,O,ae,me.getProjection()),h.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,null,O.zoom,null,[be.collisionVertexBuffer,be.collisionVertexBufferExt]))}if(!A||!j.length)return;const Y=g.getOrCreateProgram("collisionCircle"),J=new s.bE;J.resize(4*H),J._trim();let K=0;for(const fe of j)for(let ne=0;ne<fe.circleArray.length/4;ne++){const ae=4*ne,me=fe.circleArray[ae+0],xe=fe.circleArray[ae+1],_e=fe.circleArray[ae+2],be=fe.circleArray[ae+3];J.emplace(K++,me,xe,_e,be,0),J.emplace(K++,me,xe,_e,be,1),J.emplace(K++,me,xe,_e,be,2),J.emplace(K++,me,xe,_e,be,3)}(!$a||$a.length<2*H)&&($a=function(fe){const ne=2*fe,ae=new s.bp;ae.resize(ne),ae._trim();for(let me=0;me<ne;me++){const xe=6*me;ae.uint16[xe+0]=4*me+0,ae.uint16[xe+1]=4*me+1,ae.uint16[xe+2]=4*me+2,ae.uint16[xe+3]=4*me+2,ae.uint16[xe+4]=4*me+3,ae.uint16[xe+5]=4*me+0}return ae}(H));const X=k.createIndexBuffer($a,!0),oe=k.createVertexBuffer(J,s.bF.members,!0);for(const fe of j){const ne={u_matrix:fe.transform,u_inv_matrix:fe.invTransform,u_camera_to_center_distance:(de=O).getCameraToCenterDistance(fe.projection),u_viewport_size:[de.width,de.height]};Y.draw(g,L.TRIANGLES,s.b4.disabled,s.b6.disabled,g.colorModeForRenderPass(),s.b5.disabled,ne,h.id,oe,X,s.bm.simpleSegment(0,2*fe.circleOffset,fe.circleArray.length,fe.circleArray.length/2),null,O.zoom)}var de;oe.destroy(),X.destroy()}const ru=s.m.create();function su({width:g,height:l,anchor:h,textOffset:x,textScale:w},M){const{horizontalAlign:A,verticalAlign:k}=s.aY(h),L=-(A-.5)*g,O=-(k-.5)*l,N=s.aW(h,x);return new s.P((L/w+N[0])*M,(O/w+N[1])*M)}function Uh(g,l,h,x,w,M,A,k,L,O,N){const j=g.text.placedSymbolArray,H=g.text.dynamicLayoutVertexArray,q=g.icon.dynamicLayoutVertexArray,Y={},J=g.getProjection(),K=sa(k,J,M),X=M.elevation,oe=J.upVectorScale(k.canonical,M.center.lat,M.worldSize).metersToTile;H.clear();for(let de=0;de<j.length;de++){const fe=j.get(de),{tileAnchorX:ne,tileAnchorY:ae,numGlyphs:me}=fe,xe=fe.hidden||!fe.crossTileID||g.allowVerticalPlacement&&!fe.placedOrientation?null:x[fe.crossTileID];if(xe){let _e=0,be=0,Ue=0;if(X){const st=X?X.getAtTileOffset(k,ne,ae):0,[$e,Ft,kt]=J.upVector(k.canonical,ne,ae);_e=st*$e*oe,be=st*Ft*oe,Ue=st*kt*oe}let[ze,Fe,Ae,je]=mr(fe.projectedAnchorX+_e,fe.projectedAnchorY+be,fe.projectedAnchorZ+Ue,h?K:A);const Oe=We(M.getCameraToCenterDistance(J),je);let qe=w.evaluateSizeForFeature(g.textSizeData,O,fe)*Oe/s.aV;h&&(qe*=g.tilePixelRatio/L);const ue=su(xe,qe);h?({x:ze,y:Fe,z:Ae}=J.projectTilePoint(ne+ue.x,ae+ue.y,k.canonical),[ze,Fe,Ae]=mr(ze+_e,Fe+be,Ae+Ue,A)):(l&&ue._rotate(-M.angle),ze+=ue.x,Fe+=ue.y,Ae=0);const Ce=g.allowVerticalPlacement&&fe.placedOrientation===s.W.vertical?Math.PI/2:0;for(let st=0;st<me;st++)s.k(H,ze,Fe,Ae,Ce);N&&fe.associatedIconIndex>=0&&(Y[fe.associatedIconIndex]={x:ze,y:Fe,z:Ae,angle:Ce})}else mt(me,H)}if(N){q.clear();const de=g.icon.placedSymbolArray;for(let fe=0;fe<de.length;fe++){const ne=de.get(fe),{numGlyphs:ae}=ne,me=Y[fe];if(ne.hidden||!me)mt(ae,q);else{const{x:xe,y:_e,z:be,angle:Ue}=me;for(let ze=0;ze<ae;ze++)s.k(q,xe,_e,be,Ue)}}g.icon.dynamicLayoutVertexBuffer.updateData(q)}g.text.dynamicLayoutVertexBuffer.updateData(H)}function Gh(g,l,h){return h.iconsInText&&l?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function Mi(g,l,h,x,w,M,A,k,L,O,N,j,H){const q=g.context,Y=q.gl,J=g.transform,K=k==="map",X=L==="map",oe=K&&h.layout.get("symbol-placement")!=="point",de=K&&!X&&!oe,fe=h.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ne=!1;const ae=g.depthModeForSublayer(0,s.b4.ReadOnly),me=[s.E(J.center.lng),s.H(J.center.lat)],xe=h.layout.get("text-variable-anchor"),_e=J.projection.name==="globe",be=[],Ue=[0,-1,0];let ze=Ue;!_e&&!J.mercatorFromTransition||K||(ze=function(Fe){const Ae=Fe._camera.getWorldToCamera(Fe.worldSize,1),je=s.m.multiply([],Ae,Fe.globeMatrix);s.m.invert(je,je);const Oe=[0,0,0],qe=[0,1,0,0];return s.e.transformMat4(qe,qe,je),Oe[0]=qe[0],Oe[1]=qe[1],Oe[2]=qe[2],s.v.normalize(Oe,Oe),Oe}(J));for(const Fe of x){const Ae=l.getTile(Fe),je=Ae.getBucket(h);if(!je||je.projection.name==="mercator"&&_e)continue;const Oe=w?je.text:je.icon;if(!Oe||je.fullyClipped||!Oe.segments.get().length)continue;const qe=Oe.programConfigurations.get(h.id),ue=w||je.sdfIcons,Ce=w?je.textSizeData:je.iconSizeData,st=X||J.pitch!==0,$e=s.i(Ce,J.zoom);let Ft,kt,Xt,Lt,Qt=[0,0],$t=null;if(w)kt=Ae.glyphAtlasTexture?Ae.glyphAtlasTexture:null,Xt=Y.LINEAR,Ft=Ae.glyphAtlasTexture?Ae.glyphAtlasTexture.size:[0,0],je.iconsInText&&(Qt=Ae.imageAtlasTexture?Ae.imageAtlasTexture.size:[0,0],$t=Ae.imageAtlasTexture?Ae.imageAtlasTexture:null,Lt=st||g.options.rotating||g.options.zooming||Ce.kind==="composite"||Ce.kind==="camera"?Y.LINEAR:Y.NEAREST);else{const tn=h.layout.get("icon-size").constantOr(0)!==1||je.iconsNeedLinear;kt=Ae.imageAtlasTexture?Ae.imageAtlasTexture:null,Xt=ue||g.options.rotating||g.options.zooming||tn||st?Y.LINEAR:Y.NEAREST,Ft=Ae.imageAtlasTexture?Ae.imageAtlasTexture.size:[0,0]}const Gt=je.projection.name==="globe",Ht=Gt?ze:Ue,Ri=Gt?s.ao(J.zoom):0,hi=sa(Fe,je.getProjection(),J),hn=J.calculatePixelsToTileUnitsMatrix(Ae),Qi=sr(hi,Ae.tileID.canonical,X,K,J,je.getProjection(),hn),Lr=g.terrain&&X&&oe?s.m.invert(s.m.create(),Qi):ru,us=To(hi,Ae.tileID.canonical,X,K,J,je.getProjection(),hn),Xi=xe&&je.hasTextData(),Bi=je.hasIconTextFit()&&Xi&&je.hasIconData();if(oe){const tn=J.elevation,Is=tn?tn.getAtTileOffsetFunc(Fe,J.center.lat,J.worldSize,je.getProjection()):null,Us=xs(hi,Ae.tileID.canonical,X,K,J,je.getProjection(),hn);ut(je,hi,g,w,Us,us,X,O,Is,Fe)}const Vi=oe||w&&xe||Bi,yn=g.translatePosMatrix(hi,Ae,M,A),cr=Vi?ru:Qi,mn=g.translatePosMatrix(us,Ae,M,A,!0),vr=je.getProjection().createInversionMatrix(J,Fe.canonical),Rr=h.paint.get("icon-image-cross-fade").constantOr(0),br=[];g.terrainRenderModeElevated()&&X&&br.push("PITCH_WITH_MAP_TERRAIN"),Gt&&(br.push("PROJECTION_GLOBE_VIEW"),Vi&&br.push("PROJECTED_POS_ON_VIEWPORT")),Rr>0&&br.push("ICON_TRANSITION"),Oe.zOffsetVertexBuffer&&br.push("Z_OFFSET");const hs=ue&&h.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ro;ue?ro=je.iconsInText?Vl(Ce.kind,$e,de,X,g,yn,cr,mn,Ft,Qt,Fe,Ri,me,vr,Ht,je.getProjection()):iu(Ce.kind,$e,de,X,g,yn,cr,mn,w,Ft,!0,Fe,Ri,me,vr,Ht,je.getProjection()):(N<1&&br.push("SATURATION"),ro=Nl(Ce.kind,$e,de,X,g,yn,cr,mn,w,Ft,Fe,Ri,me,vr,Ht,je.getProjection(),N,Rr));const As={program:g.getOrCreateProgram(Gh(ue,w,je),{config:qe,defines:br}),buffers:Oe,uniformValues:ro,atlasTexture:kt,atlasTextureIcon:$t,atlasInterpolation:Xt,atlasInterpolationIcon:Lt,isSDF:ue,hasHalo:hs,tile:Ae,labelPlaneMatrixInv:Lr};if(fe&&je.canOverlap){ne=!0;const tn=Oe.segments.get();for(const Is of tn)be.push({segments:new s.bm([Is]),sortKey:Is.sortKey,state:As})}else be.push({segments:Oe.segments,sortKey:0,state:As})}ne&&be.sort((Fe,Ae)=>Fe.sortKey-Ae.sortKey);for(const Fe of be){const Ae=Fe.state;if(g.terrain&&g.terrain.setupElevationDraw(Ae.tile,Ae.program,{useDepthForOcclusion:J.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ae.labelPlaneMatrixInv}),q.activeTexture.set(Y.TEXTURE0),Ae.atlasTexture&&Ae.atlasTexture.bind(Ae.atlasInterpolation,Y.CLAMP_TO_EDGE,!0),Ae.atlasTextureIcon&&(q.activeTexture.set(Y.TEXTURE1),Ae.atlasTextureIcon&&Ae.atlasTextureIcon.bind(Ae.atlasInterpolationIcon,Y.CLAMP_TO_EDGE,!0)),g.uploadCommonLightUniforms(g.context,Ae.program),Ae.hasHalo){const je=Ae.uniformValues;je.u_is_halo=1,ou(Ae.buffers,Fe.segments,h,g,Ae.program,ae,j,H,je,2),je.u_is_halo=0}else{if(Ae.isSDF){const je=Ae.uniformValues;Ae.hasHalo&&(je.u_is_halo=1,ou(Ae.buffers,Fe.segments,h,g,Ae.program,ae,j,H,je,1)),je.u_is_halo=0}ou(Ae.buffers,Fe.segments,h,g,Ae.program,ae,j,H,Ae.uniformValues,1)}}}function ou(g,l,h,x,w,M,A,k,L,O){const N=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.iconTransitioningVertexBuffer,g.globeExtVertexBuffer,g.zOffsetVertexBuffer];w.draw(x,x.context.gl.TRIANGLES,M,A,k,s.b5.disabled,L,h.id,g.layoutVertexBuffer,g.indexBuffer,l,h.paint,x.transform.zoom,g.programConfigurations.get(h.id),N,O)}function Ul(g,l,h,x,w,M,A){const k=g.context.gl,L=h.paint.get("fill-pattern"),O=L&&L.constantOr(1);let N,j,H,q,Y;A?(j=O&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=k.LINES):(j=O?"fillPattern":"fill",N=k.TRIANGLES);for(const J of x){const K=l.getTile(J);if(O&&!K.patternsLoaded())continue;const X=K.getBucket(h);if(!X)continue;g.prepareDrawTile();const oe=X.programConfigurations.get(h.id),de=g.isTileAffectedByFog(J),fe=g.getOrCreateProgram(j,{config:oe,overrideFog:de});O&&(g.context.activeTexture.set(k.TEXTURE0),K.imageAtlasTexture&&K.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),oe.updatePaintBuffers());const ne=L.constantOr(null);if(ne&&K.imageAtlas){const xe=K.imageAtlas.patternPositions[ne.toString()];xe&&oe.setConstantPatternPositions(xe)}const ae=g.translatePosMatrix(J.projMatrix,K,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor")),me=h.paint.get("fill-emissive-strength");if(A){q=X.indexBuffer2,Y=X.segments2;const xe=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];H=j==="fillOutlinePattern"&&O?j_(ae,me,g,K,xe):Nh(ae,me,xe)}else q=X.indexBuffer,Y=X.segments,H=O?Fh(ae,me,g,K):Bh(ae,me);g.uploadCommonUniforms(g.context,fe,J.toUnwrapped()),fe.draw(g,N,w,g.stencilModeForClipping(J),M,s.b5.disabled,H,h.id,X.layoutVertexBuffer,q,Y,h.paint,g.transform.zoom,oe,void 0)}}function Gl(g,l,h,x,w,M,A,k){h.resetLayerRenderingStats();const L=g.context,O=L.gl,N=g.transform,j=h.paint.get("fill-extrusion-pattern"),H=j.constantOr(1),q=h.paint.get("fill-extrusion-opacity"),Y=g.style.enable3dLights(),J=h.paint.get(Y&&!H?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),K=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),J],X=h.layout.get("fill-extrusion-edge-radius"),oe=X>0&&!h.paint.get("fill-extrusion-rounded-roof"),de=oe?0:X,fe=N.projection.name==="globe"?s.bO():0,ne=N.projection.name==="globe",ae=ne?s.ao(N.zoom):0,me=[s.E(N.center.lng),s.H(N.center.lat)],xe=h.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),_e=h.paint.get("fill-extrusion-flood-light-intensity"),be=h.paint.get("fill-extrusion-vertical-scale"),Ue=la(g,h.paint.get("fill-extrusion-cutoff-fade-range")),ze=h.paint.get("fill-extrusion-emissive-strength"),Fe=[];let Ae;ne&&Fe.push("PROJECTION_GLOBE_VIEW"),K[0]>0&&Fe.push("FAUX_AO"),oe&&Fe.push("ZERO_ROOF_RADIUS"),k&&Fe.push("HAS_CENTROID"),_e>0&&Fe.push("FLOOD_LIGHT"),Ue.shouldRenderCutoff&&Fe.push("RENDER_CUTOFF");const je=g.renderPass==="shadow",Oe=g.shadowRenderer,qe=je&&!!Oe;g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0);let ue=[0,0,0];if(Oe){const $e=g.style.directionalLight,Ft=g.style.ambientLight;$e&&Ft&&(ue=cu($e,Ft)),Ae=Fe.concat(["SHADOWS_SINGLE_CASCADE"])}const Ce=qe?"fillExtrusionDepth":H?"fillExtrusionPattern":"fillExtrusion",st=h.getLayerRenderingStats();for(const $e of x){const Ft=l.getTile($e),kt=Ft.getBucket(h);if(!kt||kt.projection.name!==N.projection.name)continue;let Xt=!1;Oe&&(Xt=Oe.getMaxCascadeForTile($e.toUnwrapped())===0);const Lt=g.isTileAffectedByFog($e),Qt=kt.programConfigurations.get(h.id),$t=g.getOrCreateProgram(Ce,{config:Qt,defines:Xt?Ae:Fe,overrideFog:Lt});if(g.terrain&&g.terrain.setupElevationDraw(Ft,$t,{useMeterToDem:!0}),!kt.centroidVertexBuffer){const Qi=$t.attributes.a_centroid_pos;Qi!==void 0&&O.vertexAttrib2f(Qi,0,0)}!je&&Oe&&Oe.setupShadows(Ft.tileID.toUnwrapped(),$t,"vector-tile",Ft.tileID.overscaledZ),H&&(g.context.activeTexture.set(O.TEXTURE0),Ft.imageAtlasTexture&&Ft.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Qt.updatePaintBuffers());const Gt=j.constantOr(null);if(Gt&&Ft.imageAtlas){const Qi=Ft.imageAtlas.patternPositions[Gt.toString()];Qi&&Qt.setConstantPatternPositions(Qi)}const Ht=h.paint.get("fill-extrusion-vertical-gradient");let Ri;if(je&&Oe){if(q_(Ft.tileID,kt,g))continue;const Qi=Oe.calculateShadowPassMatrixFromTile(Ft.tileID.toUnwrapped());Ri=Oh(Qi,de,be)}else{const Qi=g.translatePosMatrix($e.expandedProjMatrix,Ft,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Lr=N.projection.createInversionMatrix(N,$e.canonical);Ri=H?V_(Qi,g,Ht,q,K,de,$e,Ft,fe,ae,me,Lr,xe,be):ca(Qi,g,Ht,q,K,de,$e,fe,ae,me,Lr,xe,be,_e,ue,ze)}g.uploadCommonUniforms(L,$t,$e.toUnwrapped(),null,Ue);let hi=kt.segments;if(N.projection.name==="mercator"&&!je&&(hi=kt.getVisibleSegments(Ft.tileID,g.terrain,g.transform.getFrustum(0)),!hi.get().length))continue;if(st)if(je)for(const Qi of hi.get())st.numRenderedVerticesInShadowPass+=Qi.primitiveLength;else for(const Qi of hi.get())st.numRenderedVerticesInTransparentPass+=Qi.primitiveLength;const hn=[];(g.terrain||k)&&hn.push(kt.centroidVertexBuffer),ne&&hn.push(kt.layoutVertexExtBuffer),$t.draw(g,L.gl.TRIANGLES,w,M,A,s.b5.backCCW,Ri,h.id,kt.layoutVertexBuffer,kt.indexBuffer,hi,h.paint,g.transform.zoom,Qt,hn)}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1)}function ha(g,l,h,x,w,M,A,k,L,O,N,j,H,q,Y,J,K,X,oe){const de=g.context,fe=de.gl,ne=g.transform,ae=g.transform.zoom,me=[],xe=la(g,h.paint.get("fill-extrusion-cutoff-fade-range"));O==="clear"?(me.push("CLEAR_SUBPASS"),oe&&(me.push("CLEAR_FROM_TEXTURE"),de.activeTexture.set(fe.TEXTURE0),oe.bind(fe.LINEAR,fe.CLAMP_TO_EDGE))):O==="sdf"&&me.push("SDF_SUBPASS"),K&&me.push("HAS_CENTROID"),xe.shouldRenderCutoff&&me.push("RENDER_CUTOFF");const _e=h.layout.get("fill-extrusion-edge-radius"),be=(Ue,ze,Fe,Ae,je)=>{const Oe=ze.programConfigurations.get(h.id),qe=g.isTileAffectedByFog(Ue),ue=g.getOrCreateProgram("fillExtrusionGroundEffect",{config:Oe,defines:me,overrideFog:qe}),Ce=(($e,Ft,kt,Xt,Lt,Qt,$t,Gt,Ht,Ri,hi)=>({u_matrix:Ft,u_opacity:kt,u_ao_pass:Xt?1:0,u_meter_to_tile:Lt,u_ao:Qt,u_flood_light_intensity:$t,u_flood_light_color:Gt,u_attenuation:Ht,u_edge_radius:Ri,u_fb:0,u_fb_size:hi}))(0,Ae,N,L,je,[j,H*je],q,Y,J,ae>=17?0:_e*je,oe?oe.size[0]:0),st=[];K&&st.push(ze.hiddenByLandmarkVertexBuffer),g.uploadCommonUniforms(de,ue,Ue.toUnwrapped(),null,xe),ue.draw(g,de.gl.TRIANGLES,w,M,A,k,Ce,h.id,ze.vertexBuffer,ze.indexBuffer,Fe,h.paint,ae,Oe,st)};for(const Ue of x){const ze=l.getTile(Ue),Fe=ze.getBucket(h);if(!Fe||Fe.projection.name!==ne.projection.name||!Fe.groundEffect||Fe.groundEffect&&!Fe.groundEffect.hasData())continue;const Ae=Fe.groundEffect,je=1/Fe.tileToMeter;{const Oe=g.translatePosMatrix(Ue.projMatrix,ze,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),qe=Ae.getDefaultSegment();be(Ue,Ae,qe,Oe,je)}if(X)for(let Oe=0;Oe<4;Oe++){const qe=s.bP[Oe](Ue),ue=l.getTile(qe);if(!ue)continue;const Ce=ue.getBucket(h);if(!Ce||Ce.projection.name!==ne.projection.name||!Ce.groundEffect||Ce.groundEffect&&!Ce.groundEffect.hasData())continue;const st=Ce.groundEffect;let $e,Ft;Oe===0?($e=[-s.J,0,0],Ft=1):Oe===1?($e=[s.J,0,0],Ft=0):Oe===2?($e=[0,-s.J,0],Ft=3):($e=[0,s.J,0],Ft=2);const kt=st.regionSegments[Ft];if(!kt)continue;const Xt=new Float32Array(16);s.m.translate(Xt,Ue.projMatrix,$e),be(Ue,st,kt,g.translatePosMatrix(Xt,ze,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),je)}}}function pp(g,l,h,x,w,M,A){x.centroidVertexArray.length===0&&x.createCentroidsBuffer();const k=M?M.findDEMTileFor(h):null;if(!(k&&k.dem||A))return;const L=X=>new s.P(Math.ceil((X+s.bS)*s.bT),0),O=X=>{const oe=l.getSource().minzoom,de=ne=>{const ae=l.getTileByID(ne);if(ae&&ae.hasData())return ae.getBucket(w)},fe=[0,-1,1];for(const ne of fe){if(X.overscaledZ+ne<oe)continue;const ae=de(X.calculateScaledKey(X.overscaledZ+ne));if(ae)return ae}},N=[0,0,0],j=(X,oe)=>(N[0]=Math.min(X.min.y,oe.min.y),N[1]=Math.max(X.max.y,oe.max.y),N[2]=s.J-oe.min.x>X.max.x?oe.min.x-s.J:X.max.x,N),H=(X,oe)=>(N[0]=Math.min(X.min.x,oe.min.x),N[1]=Math.max(X.max.x,oe.max.x),N[2]=s.J-oe.min.y>X.max.y?oe.min.y-s.J:X.max.y,N),q=[(X,oe)=>j(X,oe),(X,oe)=>j(oe,X),(X,oe)=>H(X,oe),(X,oe)=>H(oe,X)],Y=(X,oe,de,fe,ne,ae,me)=>{if(!M)return 0;const xe=[[ae?de:X,ae?X:de,0],[ae?de:oe,ae?oe:de,0]],_e=me<0?s.J+me:me,be=[ae?_e:(X+oe)/2,ae?(X+oe)/2:_e,0];return de===0&&me<0||de!==0&&me>0?M.getForTilePoints(ne,[be],!0,fe):xe.push(be),M.getForTilePoints(h,xe,!0,k),Math.max(xe[0][2],xe[1][2],be[2])/M.exaggeration()};for(let X=0;X<4;X++){const oe=x.borderFeatureIndices[X];if(oe.length===0)continue;const de=s.bP[X](h),fe=O(de);if(!(fe&&fe instanceof s.bQ)||x.borderDoneWithNeighborZ[X]===fe.canonical.z)continue;fe.centroidVertexArray.length===0&&fe.createCentroidsBuffer();const ne=M?M.findDEMTileFor(de):null;if(!(ne&&ne.dem||A))continue;const ae=(X<2?1:5)-X,me=fe.borderDoneWithNeighborZ[ae]!==x.canonical.z,xe=fe.borderFeatureIndices[ae];let _e=0;if(x.canonical.z!==fe.canonical.z){for(const be of oe)x.showCentroid(x.featuresOnBorder[be]);if(me)for(const be of xe)fe.showCentroid(fe.featuresOnBorder[be]);x.borderDoneWithNeighborZ[X]=fe.canonical.z,fe.borderDoneWithNeighborZ[ae]=x.canonical.z}for(const be of oe){const Ue=x.featuresOnBorder[be],ze=x.centroidData[Ue.centroidDataIndex],Fe=Ue.borders[X];let Ae;for(;_e<xe.length;){Ae=fe.featuresOnBorder[xe[_e]];const je=Ae.borders[ae];if(je[1]>Fe[0]+3||je[0]>Fe[0]-3)break;fe.showCentroid(Ae),_e++}if(Ae&&_e<xe.length){const je=_e;let Oe=0;for(;!(Ae.borders[ae][0]>Fe[1]-3)&&(Oe++,++_e!==xe.length);)Ae=fe.featuresOnBorder[xe[_e]];if(Ae=fe.featuresOnBorder[xe[je]],Oe>1){const Ce=Ae.borders[ae];Math.abs(Fe[0]-Ce[0])<3&&Math.abs(Fe[1]-Ce[1])<3&&(Oe=1,_e=je+1)}else if(Oe===0){x.showCentroid(Ue);continue}const qe=fe.centroidData[Ae.centroidDataIndex];A&&Oe===1&&(((J=ze).flags|(K=qe).flags)&s.bR?(J.flags|=s.bR,K.flags|=s.bR):(J.flags&=~s.bR,K.flags&=~s.bR));const ue=Ue.intersectsCount()>1||Ae.intersectsCount()>1;if(Oe>1)_e=je,ze.centroidXY=qe.centroidXY=new s.P(0,0);else if(ne&&ne.dem&&!ue){const Ce=q[X](ze,qe),st=X%2?s.J-1:0,$e=Y(Ce[0],Math.min(s.J-1,Ce[1]),st,ne,de,X<2,Ce[2]);ze.centroidXY=qe.centroidXY=L($e)}else ue?ze.centroidXY=qe.centroidXY=new s.P(0,0):(ze.centroidXY=x.encodeBorderCentroid(Ue),qe.centroidXY=fe.encodeBorderCentroid(Ae));x.writeCentroidToBuffer(ze),fe.writeCentroidToBuffer(qe)}else x.showCentroid(Ue)}x.borderDoneWithNeighborZ[X]=fe.canonical.z,fe.borderDoneWithNeighborZ[ae]=x.canonical.z}var J,K;(x.needsCentroidUpdate||!x.centroidVertexBuffer&&x.centroidVertexArray.length!==0)&&x.uploadCentroid(g)}const el=[1,0,0],mp=[0,1,0],W_=[0,0,1];function q_(g,l,h){const x=h.transform,w=h.shadowRenderer;if(!w)return!0;const M=g.toUnwrapped(),A=x.tileSize*w._cascades[h.currentShadowCascade].scale;let k=l.maxHeight;if(x.elevation){const J=x.elevation.getMinMaxForTile(g);J&&(k+=J.max)}const L=[...w.shadowDirection];L[2]=-L[2];const O=w.computeSimplifiedTileShadowVolume(M,k,A,L);if(!O)return!1;const N=[el,mp,W_,L,[L[0],0,L[2]],[0,L[1],L[2]]],j=x.projection.name==="globe",H=x.scaleZoom(A),q=s.F.fromInvProjectionMatrix(x.invProjMatrix,x.worldSize,H,!j),Y=w.getCurrentCascadeFrustum();return q.intersectsPrecise(O.vertices,O.planes,N)===0||Y.intersectsPrecise(O.vertices,O.planes,N)===0}function Z_(g){const l=g._nearZ,h=g.projection.farthestPixelDistance(g),x=h-l,w=.2*g.height,M=l+w;return[l,h,(M-w-l)/x,(M-l)/x]}const Hh=new s.C(1,0,0,1),Wh=new s.C(0,1,0,1),qh=new s.C(0,0,1,1),Zh=new s.C(1,0,1,1),gp=new s.C(0,1,1,1);function da(g,l,h,x,w,M){const A=g.context,k=g.transform,L=A.gl,O=k.projection.name==="globe",N=O?["PROJECTION_GLOBE_VIEW"]:[];let j=s.m.clone(h.projMatrix);if(O&&s.ao(k.zoom)>0){const Ae=s.bU(h.canonical,k),je=s.bV(Ae);j=s.m.multiply(new Float32Array(16),k.globeMatrix,je),s.m.multiply(j,k.projMatrix,j)}const H=s.m.create();H[12]+=2*w/(s.a4.devicePixelRatio*k.width),H[13]+=2*M/(s.a4.devicePixelRatio*k.height),s.m.multiply(j,H,j);const q=g.getOrCreateProgram("debug",{defines:N}),Y=l.getTileByID(h.key);g.terrain&&g.terrain.setupElevationDraw(Y,q);const J=s.b4.disabled,K=s.b6.disabled,X=g.colorModeForRenderPass(),oe="$debug";A.activeTexture.set(L.TEXTURE0),g.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),O?Y._makeGlobeTileDebugBuffers(g.context,k):Y._makeDebugTileBoundsBuffers(g.context,k.projection);const de=Y._tileDebugBuffer||g.debugBuffer,fe=Y._tileDebugIndexBuffer||g.debugIndexBuffer,ne=Y._tileDebugSegments||g.debugSegments;q.draw(g,L.LINE_STRIP,J,K,X,s.b5.disabled,cp(j,x),oe,de,fe,ne,null,null,null,[Y._globeTileDebugBorderBuffer]);const ae=Y.latestRawTileData,me=Math.floor((ae&&ae.byteLength||0)/1024),xe=l.getTile(h).tileSize,_e=512/Math.min(xe,512)*(h.overscaledZ/k.zoom)*.5;let be=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(be+=` => ${h.overscaledZ}`),be+=` ${me}kb`,function(Ae,je){Ae.initDebugOverlayCanvas();const Oe=Ae.debugOverlayCanvas,qe=Ae.context.gl,ue=Ae.debugOverlayCanvas.getContext("2d");ue.clearRect(0,0,Oe.width,Oe.height),ue.shadowColor="white",ue.shadowBlur=2,ue.lineWidth=1.5,ue.strokeStyle="white",ue.textBaseline="top",ue.font="bold 36px Open Sans, sans-serif",ue.fillText(je,5,5),ue.strokeText(je,5,5),Ae.debugOverlayTexture.update(Oe),Ae.debugOverlayTexture.bind(qe.LINEAR,qe.CLAMP_TO_EDGE)}(g,be);const Ue=Y._tileDebugTextBuffer||g.debugBuffer,ze=Y._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,Fe=Y._tileDebugTextSegments||g.debugSegments;q.draw(g,L.TRIANGLES,J,K,s.a.alphaBlended,s.b5.disabled,cp(j,s.C.transparent,_e),oe,Ue,ze,Fe,null,null,null,[Y._globeTileDebugTextBuffer])}function _p(g,l,h,x){Co(g,0,l+h/2,g.transform.width,h,x)}function tl(g,l,h,x){Co(g,l-h/2,0,h,g.transform.height,x)}function Co(g,l,h,x,w,M){const A=g.context,k=A.gl;k.enable(k.SCISSOR_TEST),k.scissor(l*s.a4.devicePixelRatio,h*s.a4.devicePixelRatio,x*s.a4.devicePixelRatio,w*s.a4.devicePixelRatio),A.clear({color:M}),k.disable(k.SCISSOR_TEST)}const yp=s.bW([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:au}=yp;function Vs(g,l,h,x){g.emplaceBack(l,h,x)}class Ss{constructor(l){this.vertexArray=new s.bX,this.indices=new s.bp,Vs(this.vertexArray,-1,-1,1),Vs(this.vertexArray,1,-1,1),Vs(this.vertexArray,-1,1,1),Vs(this.vertexArray,1,1,1),Vs(this.vertexArray,-1,-1,-1),Vs(this.vertexArray,1,-1,-1),Vs(this.vertexArray,-1,1,-1),Vs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,au),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=s.bm.simpleSegment(0,0,36,12)}}function Po(g,l,h,x,w,M){const A=g.context.gl,k=l.paint.get("sky-atmosphere-color"),L=l.paint.get("sky-atmosphere-halo-color"),O=l.paint.get("sky-atmosphere-sun-intensity"),N=((j,H,q,Y,J)=>({u_matrix_3f:j,u_sun_direction:H,u_sun_intensity:q,u_color_tint_r:[Y.r,Y.g,Y.b,Y.a],u_color_tint_m:[J.r,J.g,J.b,J.a],u_luminance:5e-5}))(s.bx.fromMat4(s.bx.create(),x),w,O,k,L);A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_CUBE_MAP_POSITIVE_X+M,l.skyboxTexture,0),h.draw(g,A.TRIANGLES,s.b4.disabled,s.b6.disabled,s.a.unblended,s.b5.frontCW,N,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const xp=s.bW([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Xh{constructor(l){const h=new s.bY;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const x=new s.bp;x.emplaceBack(0,1,2),x.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(h,xp.members),this.indexBuffer=l.createIndexBuffer(x),this.segments=s.bm.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const vp=s.bW([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Yh{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15}}class X_{constructor(l){this.colorModeAlphaBlendedWriteRGB=new s.a([s.bZ,s.b_,s.bZ,s.b_],s.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new s.a([s.bZ,s.b$,s.bZ,s.b$],s.C.transparent,[!1,!1,!1,!0]),this.params=new Yh,this.allocatedStarsCount=0,l.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1}),l.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01})}update(l){const h=l.context;if(!this.atmosphereBuffer||this.allocatedStarsCount!==this.params.starsCount){this.atmosphereBuffer=new Xh(h),this.allocatedStarsCount=this.params.starsCount;const x=100,w=200,M=function(N){const j=s.c2(30),H=[];for(let q=0;q<N;++q){const Y=2*Math.PI*j(),J=Math.acos(1-2*j())-.5*Math.PI;H.push(s.v.fromValues(Math.cos(J)*Math.cos(Y),Math.cos(J)*Math.sin(Y),Math.sin(J)))}return H}(this.allocatedStarsCount),A=s.c2(300),k=new s.c0,L=new s.bp;let O=0;for(let N=0;N<M.length;++N){const j=s.v.scale([],M[N],200),H=Math.max(0,1+.01*x*(1*A()-.5)),q=Math.max(0,1+.01*w*(1*A()-.5));k.emplaceBack(j[0],j[1],j[2],-1,-1,H,q),k.emplaceBack(j[0],j[1],j[2],1,-1,H,q),k.emplaceBack(j[0],j[1],j[2],1,1,H,q),k.emplaceBack(j[0],j[1],j[2],-1,1,H,q),L.emplaceBack(O+0,O+1,O+2),L.emplaceBack(O+0,O+2,O+3),O+=4}this.starsVx=h.createVertexBuffer(k,vp.members),this.starsIdx=h.createIndexBuffer(L),this.starsSegments=s.bm.simpleSegment(0,0,k.length,L.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(l,h){const x=l.context,w=x.gl,M=l.transform,A=new s.b4(w.LEQUAL,s.b4.ReadOnly,[0,1]),k=s.ao(M.zoom),L=h.properties.get("color").toArray01(),O=h.properties.get("high-color").toArray01(),N=h.properties.get("space-color").toArray01PremultipliedAlpha(),j=5e-4,H=s.c1(h.properties.get("horizon-blend"),0,1,j,.25),q=s.bb(l,x,M)&&H===j?M.worldSize/(2*Math.PI*1.025)-1:M.globeRadius,Y=l.frameCounter/1e3%1,J=s.v.length(M.globeCenterInViewSpace),K=Math.sqrt(Math.pow(J,2)-Math.pow(q,2)),X=Math.acos(K/J),oe=de=>{const fe=M.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];de&&fe.push("ALPHA_PASS");const ne=l.getOrCreateProgram("globeAtmosphere",{defines:fe}),ae=((xe,_e,be,Ue,ze,Fe,Ae,je,Oe,qe,ue,Ce)=>({u_frustum_tl:xe,u_frustum_tr:_e,u_frustum_br:be,u_frustum_bl:Ue,u_horizon:ze,u_transition:Fe,u_fadeout_range:Ae,u_color:je,u_high_color:Oe,u_space_color:qe,u_temporal_offset:ue,u_horizon_angle:Ce}))(M.frustumCorners.TL,M.frustumCorners.TR,M.frustumCorners.BR,M.frustumCorners.BL,M.frustumCorners.horizon,k,H,L,O,N,Y,X);l.uploadCommonUniforms(x,ne);const me=this.atmosphereBuffer;me&&ne.draw(l,w.TRIANGLES,A,s.b6.disabled,de?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,s.b5.backCW,ae,de?"atmosphere_glow_alpha":"atmosphere_glow",me.vertexBuffer,me.indexBuffer,me.segments)};oe(!1),oe(!0)}drawStars(l,h){const x=s.c(h.properties.get("star-intensity"),0,1);if(x===0)return;const w=l.context,M=w.gl,A=l.transform,k=l.getOrCreateProgram("stars"),L=s.q.identity([]);s.q.rotateX(L,L,-A._pitch),s.q.rotateZ(L,L,-A.angle),s.q.rotateX(L,L,s.d(A._center.lat)),s.q.rotateY(L,L,-s.d(A._center.lng));const O=s.m.fromQuat(new Float32Array(16),L),N=s.m.multiply([],A.starsProjMatrix,O),j=s.bx.fromMat4([],O),H=s.bx.invert([],j),q=[0,1,0];s.v.transformMat3(q,q,H),s.v.scale(q,q,this.params.sizeMultiplier);const Y=[1,0,0];s.v.transformMat3(Y,Y,H),s.v.scale(Y,Y,this.params.sizeMultiplier);const J=(K=q,X=Y,oe=x,{u_matrix:Float32Array.from(N),u_up:K,u_right:X,u_intensity_multiplier:oe});var K,X,oe;l.uploadCommonUniforms(w,k),this.starsVx&&this.starsIdx&&k.draw(l,M.TRIANGLES,s.b4.disabled,s.b6.disabled,this.colorModeAlphaBlendedWriteRGB,s.b5.disabled,J,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function lu(g,l){const h=[...g],x=l.cameraWorldSizeForFog/l.worldSize,w=s.m.identity([]);return s.m.scale(w,w,[x,x,1]),s.m.multiply(h,w,h),s.m.multiply(h,l.worldToFogMatrix,h),h}function Kh(g,l,h,x){const w=h.material,M=x.context,{baseColorTexture:A,metallicRoughnessTexture:k}=w.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:O,emissionTexture:N}=w;function j(H,q,Y){if(H&&(g.push(q),M.activeTexture.set(M.gl.TEXTURE0+Y),H.gfxTexture)){const{minFilter:J,magFilter:K,wrapS:X,wrapT:oe}=H.sampler;H.gfxTexture.bindExtraParam(J,K,X,oe)}}j(A,"HAS_TEXTURE_u_baseColorTexture",gr.BaseColor),j(k,"HAS_TEXTURE_u_metallicRoughnessTexture",gr.MetallicRoughness),j(L,"HAS_TEXTURE_u_normalTexture",gr.Normal),j(O,"HAS_TEXTURE_u_occlusionTexture",gr.Occlusion),j(N,"HAS_TEXTURE_u_emissionTexture",gr.Emission),h.texcoordBuffer&&(g.push("HAS_ATTRIBUTE_a_uv_2f"),l.push(h.texcoordBuffer)),h.colorBuffer&&(g.push(h.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),l.push(h.colorBuffer)),h.normalBuffer&&(g.push("HAS_ATTRIBUTE_a_normal_3f"),l.push(h.normalBuffer)),h.pbrBuffer&&(g.push("HAS_ATTRIBUTE_a_pbr"),g.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),l.push(h.pbrBuffer)),w.alphaMode!=="OPAQUE"&&w.alphaMode!=="MASK"||g.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||g.push("DIFFUSE_SHADED"),g.push("USE_STANDARD_DERIVATIVES")}function fa(g,l,h,x,w,M){const A=h.paint.get("model-opacity"),k=l.context,L=new s.b4(l.context.gl.LEQUAL,s.b4.ReadWrite,l.depthRangeFor3D),O=l.transform,N=g.mesh,j=N.material,H=j.pbrMetallicRoughness,q=l.style.fog;let Y;Y=l.transform.projection.zAxisUnit==="pixels"?[...g.nodeModelMatrix]:s.m.multiply([],x.zScaleMatrix,g.nodeModelMatrix),s.m.multiply(Y,x.negCameraPosMatrix,Y);const J=s.m.invert([],Y);s.m.transpose(J,J);const K=h.paint.get("model-emissive-strength").constantOr(0),X=jl(new Float32Array(g.worldViewProjection),new Float32Array(Y),new Float32Array(J),l,A,H.baseColorFactor,j.emissiveFactor,H.metallicFactor,H.roughnessFactor,j,K,h),oe={defines:[]},de=[];Kh(oe.defines,de,N,l);const fe=l.shadowRenderer;fe&&(fe.useNormalOffset=!1);let ne=null;if(q){const xe=lu(g.nodeModelMatrix,l.transform);if(ne=new Float32Array(xe),O.projection.name!=="globe"){const _e=N.aabb.min,be=N.aabb.max,[Ue,ze]=q.getOpacityForBounds(xe,_e[0],_e[1],be[0],be[1]);oe.overrideFog=Ue>=Ur||ze>=Ur}}const ae=la(l,h.paint.get("model-cutoff-fade-range"));ae.shouldRenderCutoff&&oe.defines.push("RENDER_CUTOFF");const me=l.getOrCreateProgram("model",oe);l.uploadCommonUniforms(k,me,null,ne,ae),l.renderPass!=="shadow"&&fe&&fe.setupShadowsFromMatrix(g.nodeModelMatrix,me),me.draw(l,k.gl.TRIANGLES,L,w,M,N.material.doubleSided?s.b5.disabled:s.b5.backCCW,X,h.id,N.vertexBuffer,N.indexBuffer,N.segments,h.paint,l.transform.zoom,void 0,de)}function bp(g,l,h,x,w,M,A){let k;k=g.projection.name==="globe"?s.c5(h,g):[...h],s.m.multiply(k,k,l.matrix);const L=s.m.multiply([],x,k);if(l.meshes)for(const O of l.meshes){if(O.material.alphaMode!=="BLEND"){A.push({mesh:O,depth:0,modelIndex:w,worldViewProjection:L,nodeModelMatrix:k});continue}const N=s.v.transformMat4([],O.centroid,L);N[2]>0&&M.push({mesh:O,depth:N[2],modelIndex:w,worldViewProjection:L,nodeModelMatrix:k})}if(l.children)for(const O of l.children)bp(g,O,h,x,w,M,A)}function Hl(g,l,h,x){const w=h.shadowRenderer;if(!w)return;const M=w.getShadowPassDepthMode(),A=w.getShadowPassColorMode(),k=w.calculateShadowPassMatrixFromMatrix(l),L=nu(k);h.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(h,h.context.gl.TRIANGLES,M,s.b6.disabled,A,s.b5.backCCW,L,x.id,g.vertexBuffer,g.indexBuffer,g.segments,x.paint,h.transform.zoom,void 0,void 0)}function Y_(g,l,h){const x=l.updateZoomBasedPaintProperties(),w=function(M,A,k){let L,O,N,j=M.terrain?M.terrain.exaggeration():0;if(M.terrain&&j>0){const H=M.terrain,q=H.findDEMTileFor(k);q&&q.dem?L=s.c7.create(H,k,q):j=0}if(j===0&&(A.terrainElevationMin=0,A.terrainElevationMax=0),j===A.validForExaggeration&&(j===0||L&&L._demTile&&L._demTile.tileID===A.validForDEMTile.id&&L._dem._timestamp===A.validForDEMTile.timestamp))return!1;for(const H in A.instancesPerModel){const q=A.instancesPerModel[H];for(let Y=0;Y<q.instancedDataArray.length;++Y){const J=(L?j*L.getElevationAt(0|q.instancedDataArray.float32[16*Y],0|q.instancedDataArray.float32[16*Y+1],!0,!0):0)+q.instancesEvaluatedElevation[Y];q.instancedDataArray.float32[16*Y+6]=J,O=O?Math.min(A.terrainElevationMin,J):J,N=N?Math.max(A.terrainElevationMax,J):J}}return A.terrainElevationMin=O||0,A.terrainElevationMax=N||0,A.validForExaggeration=j,A.validForDEMTile=L&&L._demTile?{id:L._demTile.tileID,timestamp:L._dem._timestamp}:{id:void 0,timestamp:0},!0}(g,l,h);(x||w)&&(l.uploaded=!1,l.upload(g.context))}const ls={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.c3([0,0,0],[s.J,s.J,0])};function K_(g,l){const h=1<<g.canonical.z,x=l.getFreeCameraOptions().position,w=l.elevation,M=g.canonical.x/h,A=(g.canonical.x+1)/h,k=g.canonical.y/h,L=(g.canonical.y+1)/h;let O=l._centerAltitude;if(w){const q=w.getMinMaxForTile(g);q&&q.max>O&&(O=q.max)}const N=s.c(x.x,M,A)-x.x,j=s.c(x.y,k,L)-x.y,H=s.b(O,l.center.lat)-x.z;return l._zoomFromMercatorZ(Math.sqrt(N*N+j*j+H*H))}function Wl(g,l,h,x,w,M,A){const k=g.context,L=g.renderPass==="shadow",O=g.shadowRenderer,N=L&&O?O.getShadowPassDepthMode():new s.b4(k.gl.LEQUAL,s.b4.ReadWrite,g.depthRangeFor3D),j=g.isTileAffectedByFog(M);if(h.meshes)for(const H of h.meshes){const q=["MODEL_POSITION_ON_GPU"],Y=[];let J,K,X;x.instancedDataArray.length>20&&q.push("INSTANCED_ARRAYS");const oe=la(g,l.paint.get("model-cutoff-fade-range"));if(oe.shouldRenderCutoff&&q.push("RENDER_CUTOFF"),L&&O)J=g.getOrCreateProgram("modelDepth",{defines:q}),K=nu(A.shadowTileMatrix,A.shadowTileMatrix,Float32Array.from(h.matrix)),X=O.getShadowPassColorMode();else{Kh(q,Y,H,g),J=g.getOrCreateProgram("model",{defines:q,overrideFog:j});const fe=H.material,ne=fe.pbrMetallicRoughness,ae=l.paint.get("model-opacity"),me=l.paint.get("model-emissive-strength").constantOr(0);K=jl(M.expandedProjMatrix,Float32Array.from(h.matrix),new Float32Array(16),g,ae,ne.baseColorFactor,fe.emissiveFactor,ne.metallicFactor,ne.roughnessFactor,fe,me,l,w),O&&(A.shadowUniformsInitialized?J.setShadowUniformValues(k,O.getShadowUniformValues()):(O.setupShadows(M.toUnwrapped(),J,"model-tile",M.overscaledZ),A.shadowUniformsInitialized=!0)),X=oe.shouldRenderCutoff||ae<1||fe.alphaMode!=="OPAQUE"?s.a.alphaBlended:s.a.unblended}g.uploadCommonUniforms(k,J,M.toUnwrapped(),null,oe);const de=H.material.doubleSided?s.b5.disabled:s.b5.backCCW;if(x.instancedDataArray.length>20)Y.push(x.instancedDataBuffer),J.draw(g,k.gl.TRIANGLES,N,s.b6.disabled,X,de,K,l.id,H.vertexBuffer,H.indexBuffer,H.segments,l.paint,g.transform.zoom,void 0,Y,x.instancedDataArray.length);else{const fe=L?"u_instance":"u_normal_matrix";for(let ne=0;ne<x.instancedDataArray.length;++ne)K[fe]=new Float32Array(x.instancedDataArray.arrayBuffer,64*ne,16),J.draw(g,k.gl.TRIANGLES,N,s.b6.disabled,X,de,K,l.id,H.vertexBuffer,H.indexBuffer,H.segments,l.paint,g.transform.zoom,void 0,Y)}}if(h.children)for(const H of h.children)Wl(g,l,H,x,w,M,A)}const J_=[1,-1,1];function wp(g,l,h,x){if(!h.modelManager)return!0;const w=h.modelManager;if(!h.shadowRenderer)return!0;const M=h.shadowRenderer,A=l.aabb;let k=!0,L=g.maxHeight;if(L===0){let N=0;for(const j in g.instancesPerModel){const H=w.getModel(j,x);H?N=Math.max(N,Math.max(Math.max(H.aabb.max[0],H.aabb.max[1]),H.aabb.max[2])):k=!1}L=g.maxScale*N*1.41+g.maxVerticalOffset,k&&(g.maxHeight=L)}A.max[2]=L,A.min[2]+=g.terrainElevationMin,A.max[2]+=g.terrainElevationMax,s.v.transformMat4(A.min,A.min,l.tileMatrix),s.v.transformMat4(A.max,A.max,l.tileMatrix);const O=A.intersects(M.getCurrentCascadeFrustum());return h.currentShadowCascade===0&&(g.isInsideFirstShadowMapFrustum=O===2),O===0}class Tp{}class il{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(l,h,x){{const j=this._storage.get(h.id);if(j)return j.lastUsedFrameIdx=l,j.buf}const w=x.gl,M=w.getBufferParameter(w.ELEMENT_ARRAY_BUFFER,w.BUFFER_SIZE),A=new ArrayBuffer(M),k=new Int16Array(A);w.getBufferSubData(w.ELEMENT_ARRAY_BUFFER,0,new Int16Array(A));const L=new s.c9;for(let j=0;j<M/2;j+=3){const H=k[j],q=k[j+1],Y=k[j+2];L.emplaceBack(H,q),L.emplaceBack(q,Y),L.emplaceBack(Y,H)}const O=x.bindVertexArrayOES.current,N=new Tp;return N.buf=new s.I(x,L),N.lastUsedFrameIdx=l,this._storage.set(h.id,N),x.bindVertexArrayOES.set(O),N.buf}update(l){for(const[h,x]of this._storage)l-x.lastUsedFrameIdx>30&&(x.buf.destroy(),this._storage.delete(h))}destroy(){for(const[l,h]of this._storage)h.buf.destroy(),this._storage.delete(l)}}class Mp{registerParameter(l,h,x,w,M){}registerButton(l,h,x){}}const Jh={symbol:function(g,l,h,x,w){if(g.renderPass!=="translucent")return;const M=s.b6.disabled,A=g.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(k,L,O,N,j,H,q){const Y=L.transform,J=j==="map",K=H==="map";for(const X of k){const oe=N.getTile(X),de=oe.getBucket(O);if(!de||!de.text||!de.text.segments.get().length)continue;const fe=s.i(de.textSizeData,Y.zoom),ne=sa(X,de.getProjection(),Y),ae=Y.calculatePixelsToTileUnitsMatrix(oe),me=sr(ne,oe.tileID.canonical,K,J,Y,de.getProjection(),ae),xe=de.hasIconTextFit()&&de.hasIconData();if(fe){const _e=Math.pow(2,Y.zoom-oe.tileID.overscaledZ);Uh(de,J,K,q,s.bG,Y,me,X,_e,fe,xe)}}}(x,g,h,l,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),w),h.paint.get("icon-opacity").constantOr(1)!==0&&Mi(g,l,h,x,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),h.paint.get("icon-color-saturation"),M,A),h.paint.get("text-opacity").constantOr(1)!==0&&Mi(g,l,h,x,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),h.paint.get("icon-color-saturation"),M,A),l.map.showCollisionBoxes&&(jh(g,l,h,x,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),jh(g,l,h,x,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(g,l,h,x){if(g.renderPass!=="translucent")return;const w=h.paint.get("circle-opacity"),M=h.paint.get("circle-stroke-width"),A=h.paint.get("circle-stroke-opacity"),k=h.layout.get("circle-sort-key").constantOr(1)!==void 0,L=h.paint.get("circle-emissive-strength");if(w.constantOr(1)===0&&(M.constantOr(1)===0||A.constantOr(1)===0))return;const O=g.context,N=O.gl,j=g.transform,H=g.depthModeForSublayer(0,s.b4.ReadOnly),q=s.b6.disabled,Y=g.colorModeForDrapableLayerRenderPass(L),J=j.projection.name==="globe",K=[s.E(j.center.lng),s.H(j.center.lat)],X=[];for(let de=0;de<x.length;de++){const fe=x[de],ne=l.getTile(fe),ae=ne.getBucket(h);if(!ae||ae.projection.name!==j.projection.name)continue;const me=ae.programConfigurations.get(h.id),xe=s.bH(h),_e=g.isTileAffectedByFog(fe);J&&xe.push("PROJECTION_GLOBE_VIEW");const be=g.getOrCreateProgram("circle",{config:me,defines:xe,overrideFog:_e}),Ue=ae.layoutVertexBuffer,ze=ae.globeExtVertexBuffer,Fe=ae.indexBuffer,Ae=j.projection.createInversionMatrix(j,fe.canonical),je={programConfiguration:me,program:be,layoutVertexBuffer:Ue,globeExtVertexBuffer:ze,indexBuffer:Fe,uniformValues:s.bI(g,fe,ne,Ae,K,h),tile:ne};if(k){const Oe=ae.segments.get();for(const qe of Oe)X.push({segments:new s.bm([qe]),sortKey:qe.sortKey,state:je})}else X.push({segments:ae.segments,sortKey:0,state:je})}k&&X.sort((de,fe)=>de.sortKey-fe.sortKey);const oe={useDepthForOcclusion:j.depthOcclusionForSymbolsAndCircles};for(const de of X){const{programConfiguration:fe,program:ne,layoutVertexBuffer:ae,globeExtVertexBuffer:me,indexBuffer:xe,uniformValues:_e,tile:be}=de.state,Ue=de.segments;g.terrain&&g.terrain.setupElevationDraw(be,ne,oe),g.uploadCommonUniforms(O,ne,be.tileID.toUnwrapped()),ne.draw(g,N.TRIANGLES,H,q,Y,s.b5.disabled,_e,h.id,ae,xe,Ue,h.paint,j.zoom,fe,[me])}},heatmap:function(g,l,h,x){if(h.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const w=g.context,M=w.gl,A=s.b6.disabled,k=new s.a([M.ONE,M.ONE,M.ONE,M.ONE],s.C.transparent,[!0,!0,!0,!0]);(function(q,Y,J,K){const X=q.gl,oe=Y.width*K,de=Y.height*K;q.activeTexture.set(X.TEXTURE1),q.viewport.set([0,0,oe,de]);let fe=J.heatmapFbo;if(!fe||fe&&(fe.width!==oe||fe.height!==de)){fe&&fe.destroy();const ne=X.createTexture();X.bindTexture(X.TEXTURE_2D,ne),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),fe=J.heatmapFbo=q.createFramebuffer(oe,de,!0,null),function(ae,me,xe,_e,be,Ue){const ze=ae.gl;ze.texImage2D(ze.TEXTURE_2D,0,ae.extRenderToTextureHalfFloat?ze.RGBA16F:ze.RGBA,be,Ue,0,ze.RGBA,ae.extRenderToTextureHalfFloat?ze.HALF_FLOAT:ze.UNSIGNED_BYTE,null),_e.colorAttachment.set(xe)}(q,0,ne,fe,oe,de)}else X.bindTexture(X.TEXTURE_2D,fe.colorAttachment.get()),q.bindFramebuffer.set(fe.framebuffer)})(w,g,h,g.transform.projection.name==="globe"?.5:.25),w.clear({color:s.C.transparent});const L=g.transform,O=L.projection.name==="globe",N=O?["PROJECTION_GLOBE_VIEW"]:[],j=O?s.b5.frontCCW:s.b5.disabled,H=[s.E(L.center.lng),s.H(L.center.lat)];for(let q=0;q<x.length;q++){const Y=x[q];if(l.hasRenderableParent(Y))continue;const J=l.getTile(Y),K=J.getBucket(h);if(!K||K.projection.name!==L.projection.name)continue;const X=g.isTileAffectedByFog(Y),oe=K.programConfigurations.get(h.id),de=g.getOrCreateProgram("heatmap",{config:oe,defines:N,overrideFog:X}),{zoom:fe}=g.transform;g.terrain&&g.terrain.setupElevationDraw(J,de),g.uploadCommonUniforms(w,de,Y.toUnwrapped());const ne=L.projection.createInversionMatrix(L,Y.canonical);de.draw(g,M.TRIANGLES,s.b4.disabled,A,k,j,up(g,Y,J,ne,H,fe,h.paint.get("heatmap-intensity")),h.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,h.paint,g.transform.zoom,oe,O?[K.globeExtVertexBuffer]:null)}w.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(w,M){const A=w.context,k=A.gl,L=M.heatmapFbo;if(!L)return;A.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,L.colorAttachment.get()),A.activeTexture.set(k.TEXTURE1);let O=M.colorRampTexture;O||(O=M.colorRampTexture=new s.a9(A,M.colorRamp,k.RGBA)),O.bind(k.LINEAR,k.CLAMP_TO_EDGE),w.getOrCreateProgram("heatmapTexture").draw(w,k.TRIANGLES,s.b4.disabled,s.b6.disabled,w.colorModeForRenderPass(),s.b5.disabled,((N,j,H,q)=>({u_image:0,u_color_ramp:1,u_opacity:j.paint.get("heatmap-opacity")}))(0,M),M.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,M.paint,w.transform.zoom)}(g,h))},line:function(g,l,h,x){if(g.renderPass!=="translucent")return;const w=h.paint.get("line-opacity"),M=h.paint.get("line-width");if(w.constantOr(1)===0||M.constantOr(1)===0)return;const A=h.paint.get("line-emissive-strength"),k=g.depthModeForSublayer(0,s.b4.ReadOnly),L=g.colorModeForDrapableLayerRenderPass(A),O=g.terrain&&g.terrain.renderingToTexture?1:s.a4.devicePixelRatio,N=h.paint.get("line-dasharray"),j=N.constantOr(1),H=h.layout.get("line-cap"),q=h.paint.get("line-pattern"),Y=q.constantOr(1),J=h.paint.get("line-pattern").constantOr(1),K=h.paint.get("line-opacity").constantOr(1)!==1;let X=!J&&K;const oe=h.paint.get("line-gradient"),de=Y?"linePattern":"line",fe=g.context,ne=fe.gl,ae=s.bJ(h);g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(X=!1);for(const me of x){const xe=l.getTile(me);if(Y&&!xe.patternsLoaded())continue;const _e=xe.getBucket(h);if(!_e)continue;g.prepareDrawTile();const be=_e.programConfigurations.get(h.id),Ue=g.isTileAffectedByFog(me),ze=g.getOrCreateProgram(de,{config:be,defines:ae,overrideFog:Ue}),Fe=q.constantOr(null);if(Fe&&xe.imageAtlas){const $e=xe.imageAtlas.patternPositions[Fe.toString()];$e&&be.setConstantPatternPositions($e)}const Ae=N.constantOr(null),je=H.constantOr(null);if(!Y&&Ae&&je&&xe.lineAtlas){const $e=xe.lineAtlas.getDash(Ae,je);$e&&be.setConstantPatternPositions($e)}let[Oe,qe]=h.paint.get("line-trim-offset");(je==="round"||je==="square")&&Oe!==qe&&(Oe===0&&(Oe-=1),qe===1&&(qe+=1));const ue=g.terrain?me.projMatrix:null,Ce=Y?s.bK(g,xe,h,ue,O):s.bL(g,xe,h,ue,_e.lineClipsArray.length,O,[Oe,qe]);if(oe){const $e=_e.gradients[h.id];let Ft=$e.texture;if(h.gradientVersion!==$e.version){let kt=256;if(h.stepInterpolant){const Xt=l.getSource().maxzoom,Lt=me.canonical.z===Xt?Math.ceil(1<<g.transform.maxZoom-me.canonical.z):1;kt=s.c(s.bM(_e.maxLineLength/s.J*1024*Lt),256,fe.maxTextureSize)}$e.gradient=s.bN({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:kt,image:$e.gradient||void 0,clips:_e.lineClipsArray}),$e.texture?$e.texture.update($e.gradient):$e.texture=new s.a9(fe,$e.gradient,ne.RGBA),$e.version=h.gradientVersion,Ft=$e.texture}fe.activeTexture.set(ne.TEXTURE1),Ft.bind(h.stepInterpolant?ne.NEAREST:ne.LINEAR,ne.CLAMP_TO_EDGE)}j&&(fe.activeTexture.set(ne.TEXTURE0),xe.lineAtlasTexture&&xe.lineAtlasTexture.bind(ne.LINEAR,ne.REPEAT),be.updatePaintBuffers()),Y&&(fe.activeTexture.set(ne.TEXTURE0),xe.imageAtlasTexture&&xe.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),be.updatePaintBuffers()),g.uploadCommonUniforms(fe,ze,me.toUnwrapped());const st=$e=>{ze.draw(g,ne.TRIANGLES,k,$e,L,s.b5.disabled,Ce,h.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,h.paint,g.transform.zoom,be,[_e.layoutVertexBuffer2])};if(X){const $e=g.stencilModeForClipping(me).ref;$e===0&&g.terrain&&fe.clear({stencil:0});const Ft={func:ne.EQUAL,mask:255};Ce.u_alpha_discard_threshold=.8,st(new s.b6(Ft,$e,255,ne.KEEP,ne.KEEP,ne.INVERT)),Ce.u_alpha_discard_threshold=0,st(new s.b6(Ft,$e,255,ne.KEEP,ne.KEEP,ne.KEEP))}else st(g.stencilModeForClipping(me))}X&&(g.resetStencilClippingMasks(),g.terrain&&fe.clear({stencil:0}))},fill:function(g,l,h,x){const w=h.paint.get("fill-color"),M=h.paint.get("fill-opacity");if(M.constantOr(1)===0)return;const A=h.paint.get("fill-emissive-strength"),k=g.colorModeForDrapableLayerRenderPass(A),L=h.paint.get("fill-pattern"),O=g.opaquePassEnabledForLayer()&&!L.constantOr(1)&&w.constantOr(s.C.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===O){const N=g.depthModeForSublayer(1,g.renderPass==="opaque"?s.b4.ReadWrite:s.b4.ReadOnly);Ul(g,l,h,x,N,k,!1)}if(g.renderPass==="translucent"&&h.paint.get("fill-antialias")){const N=g.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,s.b4.ReadOnly);Ul(g,l,h,x,N,k,!0)}},"fill-extrusion":function(g,l,h,x){const w=h.paint.get("fill-extrusion-opacity"),M=g.context,A=M.gl,k=g.terrain,L=k&&k.renderingToTexture;if(w===0)return;const O=g.conflationActive&&g.layerUsedInConflation(h,l.getSource());if(O&&function(N,j,H,q){for(const Y of q){const J=j.getTile(Y).getBucket(H);J&&(J.updateReplacement(Y,N.replacementSource),J.uploadCentroid(N.context))}}(g,l,h,x),k||O)for(const N of x){const j=l.getTile(N).getBucket(h);j&&pp(g.context,l,N,j,h,k,O)}if(g.renderPass==="shadow"&&g.shadowRenderer){const N=g.shadowRenderer;if(k&&w<.65&&h._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.am)return;const j=N.getShadowPassDepthMode(),H=N.getShadowPassColorMode();Gl(g,l,h,x,j,s.b6.disabled,H,O)}else if(g.renderPass==="translucent"){const N=!h.paint.get("fill-extrusion-pattern").constantOr(1),j=h.paint.get("fill-extrusion-color").constantOr(s.C.white);if(!L&&j.a!==0){const H=new s.b4(g.context.gl.LEQUAL,s.b4.ReadWrite,g.depthRangeFor3D);w===1&&N?Gl(g,l,h,x,H,s.b6.disabled,s.a.unblended,O):(Gl(g,l,h,x,H,s.b6.disabled,s.a.disabled,O),Gl(g,l,h,x,H,g.stencilModeFor3D(),g.colorModeForRenderPass(),O),g.resetStencilClippingMasks())}if(g.style.enable3dLights()&&N&&(!k&&g.transform.projection.name!=="globe"||L)){const H=h.paint.get("fill-extrusion-opacity"),q=h.paint.get("fill-extrusion-ambient-occlusion-intensity"),Y=h.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),J=h.paint.get("fill-extrusion-flood-light-intensity"),K=h.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),X=q>0&&Y>0,oe=J>0,de=(ne,ae,me)=>(1-me)*ne+me*ae,fe=ne=>{const ae=g.depthModeForSublayer(1,s.b4.ReadOnly,A.LEQUAL,!0),me=h.paint.get(ne?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),xe=de(.1,3,me),_e=g._showOverdrawInspector;if(!_e){const be=new s.b6({func:A.ALWAYS,mask:255},255,255,A.KEEP,A.KEEP,A.REPLACE),Ue=new s.a([A.ONE,A.ONE,A.ONE,A.ONE],s.C.transparent,[!1,!1,!1,!0],A.MIN);ha(g,l,h,x,ae,be,Ue,s.b5.disabled,ne,"sdf",H,q,Y,J,K,xe,O,!1)}{const be=_e?s.b6.disabled:new s.b6({func:A.EQUAL,mask:255},255,255,A.KEEP,A.DECR,A.DECR),Ue=_e?g.colorModeForRenderPass():new s.a([A.ONE_MINUS_DST_ALPHA,A.DST_ALPHA,A.ONE,A.ONE],s.C.transparent,[!0,!0,!0,!0]);ha(g,l,h,x,ae,be,Ue,s.b5.disabled,ne,"color",H,q,Y,J,K,xe,O,!1)}};if(L){const ne=(ae,me,xe)=>{const _e=g.depthModeForSublayer(1,s.b4.ReadOnly,A.LEQUAL,!1),be=h.paint.get(ae?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ue=de(.1,3,be);{const ze=new s.a([A.ONE,A.ONE,A.ONE,A.ONE],s.C.transparent,[!1,!1,!1,!0]);ha(g,l,h,x,_e,s.b6.disabled,ze,s.b5.disabled,ae,"clear",H,q,Y,J,K,Ue,O,me)}{const ze=new s.b6({func:A.ALWAYS,mask:255},255,255,A.KEEP,A.KEEP,A.REPLACE),Fe=new s.a([A.ONE,A.ONE,A.ONE,A.ONE],s.C.transparent,[!1,!1,!1,!0],A.MIN);ha(g,l,h,x,_e,ze,Fe,s.b5.disabled,ae,"sdf",H,q,Y,J,K,Ue,O,me)}{const ze=ae?A.ZERO:A.ONE_MINUS_DST_ALPHA,Fe=new s.b6({func:A.EQUAL,mask:255},255,255,A.KEEP,A.DECR,A.DECR),Ae=new s.a([ze,A.DST_ALPHA,A.ONE_MINUS_DST_ALPHA,A.ZERO],s.C.transparent,[!0,!0,!0,!0]);ha(g,l,h,x,_e,Fe,Ae,s.b5.disabled,ae,"color",H,q,Y,J,K,Ue,O,me)}{const ze=new s.a([A.ONE,A.ONE,A.ONE,ae?A.ZERO:A.ONE],s.C.transparent,[!1,!1,!1,!0],ae?A.FUNC_ADD:A.MAX);ha(g,l,h,x,_e,s.b6.disabled,ze,s.b5.disabled,ae,"clear",H,q,Y,J,K,Ue,O,me,xe)}};if(X||oe){let ae;if(g.prepareDrawTile(),k){const me=k.drapeBufferSize[0],xe=k.drapeBufferSize[1];ae=k.framebufferCopyTexture,ae&&(!ae||ae.size[0]===me&&ae.size[1]===xe)||(ae&&ae.destroy(),ae=k.framebufferCopyTexture=new s.a9(M,new s.a5({width:me,height:xe}),A.RGBA)),ae.bind(A.LINEAR,A.CLAMP_TO_EDGE),A.copyTexImage2D(A.TEXTURE_2D,0,A.RGBA,0,0,me,xe,0)}X&&ne(!0,!1,ae),oe&&ne(!1,!0,ae)}}else X&&fe(!0),oe&&fe(!1)}}},hillshade:function(g,l,h,x){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent"||g.style.disableElevatedTerrain)return;const w=g.context,M=g.terrain&&g.terrain.renderingToTexture,[A,k]=g.renderPass!=="translucent"||M?[{},x]:g.stencilConfigForOverlap(x);for(const L of k){const O=l.getTile(L);if(O.needsHillshadePrepare&&g.renderPass==="offscreen")N_(g,O,h);else if(g.renderPass==="translucent"){const N=g.depthModeForSublayer(0,s.b4.ReadOnly),j=h.paint.get("hillshade-emissive-strength"),H=g.colorModeForDrapableLayerRenderPass(j),q=M&&g.terrain?g.terrain.stencilModeForRTTOverlap(L):A[L.overscaledZ];F_(g,L,O,h,N,q,H)}}w.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,l,h,x,w,M){if(g.renderPass!=="translucent"||h.paint.get("raster-opacity")===0)return;const A=g.context,k=A.gl,L=l.getSource(),O=function(me,xe,_e){const be=me.paint.get("raster-color"),Ue=[],ze=me.paint.get("raster-resampling"),Fe=me.paint.get("raster-color-mix"),Ae=me.paint.get("raster-color-range"),je=[Fe[0],Fe[1],Fe[2],0],Oe=Fe[3],qe=ze==="nearest"?_e.NEAREST:_e.LINEAR;if(be&&Ue.push("RASTER_COLOR"),be){xe.activeTexture.set(_e.TEXTURE2);let ue=me.colorRampTexture;ue||(ue=me.colorRampTexture=new s.a9(xe,me.colorRamp,_e.RGBA)),ue.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}return{mix:je,range:Ae,offset:Oe,defines:Ue,resampling:qe}}(h,A,k),N=O.defines,j=g.transform.projection.name==="globe";let H=!1;if(L instanceof s.aK&&!x.length){if(!j)return;if(L.onNorthPole)H=!0,N.push("GLOBE_POLES");else{if(!L.onSouthPole)return;H=!0,N.push("GLOBE_POLES")}}const q=h.paint.get("raster-emissive-strength"),Y=g.colorModeForDrapableLayerRenderPass(q),J=g.terrain&&g.terrain.renderingToTexture,K=L instanceof s.aK&&h.paint.get("raster-elevation")!==0,X=!g.options.moving,oe=h.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;if(H){const me=l.getSource();if(!(me instanceof s.aK))return;const xe=me.texture;if(!xe)return;const _e=g.globeSharedBuffers;if(!_e)return;const be=new s.b4(k.LEQUAL,s.b4.ReadWrite,g.depthRangeFor3D),Ue=Float32Array.from(g.transform.expandedFarZProjMatrix);let ze=s.bj(0,0,g.transform);const Fe=Float32Array.from(s.bh(s.bi(new s.t(0,0,0)))),Ae={opacity:1,mix:0};g.terrain&&g.terrain.prepareDrawTile(),A.activeTexture.set(k.TEXTURE0),xe.bind(oe,k.CLAMP_TO_EDGE),A.activeTexture.set(k.TEXTURE1),xe.bind(oe,k.CLAMP_TO_EDGE),xe.useMipmap&&A.extTextureFilterAnisotropic&&g.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);const[je,Oe,qe,ue]=_e.getPoleBuffers(0,!0);let Ce;me.onNorthPole?(Ce=je,g.renderDefaultNorthPole=!1):(ze=s.m.scale(s.m.create(),ze,[1,-1,1]),Ce=Oe,g.renderDefaultSouthPole=!1);const st=((Ft,kt,Xt,Lt,Qt,$t,Gt,Ht,Ri,hi,hn,Qi)=>hp(Ft,kt,Xt,new Float32Array(16),new Float32Array(9),[0,0],0,[0,0],[0,0,0,0],1,Lt,Qt,[0,0],Gt,2,Ri,hi,hn,1,0,Qi))(Ue,Fe,ze,Ae,h,0,h.paint.get("raster-elevation"),0,O.mix,O.offset,O.range,q),$e=g.getOrCreateProgram("raster",{defines:O.defines});return g.uploadCommonUniforms(A,$e,null),void $e.draw(g,k.TRIANGLES,be,s.b6.disabled,Y,s.b5.disabled,st,h.id,Ce,qe,ue)}if(!x.length)return;const[de,fe]=L instanceof s.aK||J?[{},x]:g.stencilConfigForOverlap(x),ne=fe[fe.length-1].overscaledZ,ae=K&&j;ae&&O.defines.push("PROJECTION_GLOBE_VIEW"),K&&O.defines.push("RENDER_CUTOFF");for(const me of fe){const xe=me.toUnwrapped(),_e=l.getTile(me);if(J&&(!_e||!_e.hasData())||!_e.texture)continue;let be,Ue;J?(be=s.b4.disabled,Ue=me.projMatrix):K?(be=new s.b4(k.LEQUAL,s.b4.ReadWrite,g.depthRangeFor3D),Ue=j?Float32Array.from(g.transform.expandedFarZProjMatrix):g.transform.calculateProjMatrix(xe,X)):(be=g.depthModeForSublayer(me.overscaledZ-ne,h.paint.get("raster-opacity")===1?s.b4.ReadWrite:s.b4.ReadOnly,k.LESS),Ue=g.transform.calculateProjMatrix(xe,X));const ze=g.terrain&&J?g.terrain.stencilModeForRTTOverlap(me):de[me.overscaledZ],Fe=M?0:h.paint.get("raster-fade-duration");_e.registerFadeDuration(Fe);const Ae=l.findLoadedParent(me,0),je=Yc(_e,Ae,l,g.transform,Fe);let Oe,qe;g.terrain&&g.terrain.prepareDrawTile(),A.activeTexture.set(k.TEXTURE0),_e.texture&&_e.texture.bind(oe,k.CLAMP_TO_EDGE),A.activeTexture.set(k.TEXTURE1),Ae?(Ae.texture&&Ae.texture.bind(oe,k.CLAMP_TO_EDGE),Oe=Math.pow(2,Ae.tileID.overscaledZ-_e.tileID.overscaledZ),qe=[_e.tileID.canonical.x*Oe%1,_e.tileID.canonical.y*Oe%1]):_e.texture&&_e.texture.bind(oe,k.CLAMP_TO_EDGE),_e.texture&&_e.texture.useMipmap&&A.extTextureFilterAnisotropic&&g.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);const ue=g.transform;let Ce;const st=K?Z_(ue):[0,0,0,0];let $e,Ft,kt,Xt,Lt;ae&&L instanceof s.aK&&L.coordinates.length>3?($e=Float32Array.from(s.bh(s.bi(new s.t(0,0,0)))),Ft=Float32Array.from(ue.globeMatrix),kt=Float32Array.from(s.bc(ue)),Xt=[s.E(ue.center.lng),s.H(ue.center.lat)],Ce=L.elevatedGlobePerspectiveTransform,Lt=L.elevatedGlobeGridMatrix||new Float32Array(9)):(Ce=L instanceof s.aK?L.perspectiveTransform:[0,0],$e=new Float32Array(16),Ft=new Float32Array(9),kt=new Float32Array(16),Xt=[0,0],Lt=new Float32Array(9));const Qt=hp(Ue,$e,Ft,kt,Lt,qe||[0,0],s.ao(g.transform.zoom),Xt,st,Oe||1,je,h,Ce,K?h.paint.get("raster-elevation"):0,2,O.mix,O.offset,O.range,1,0,q),$t=g.isTileAffectedByFog(me),Gt=g.getOrCreateProgram("raster",{defines:O.defines,overrideFog:$t});if(g.uploadCommonUniforms(A,Gt,xe),L instanceof s.aK){const Ht=L.elevatedGlobeVertexBuffer,Ri=L.elevatedGlobeIndexBuffer;if(J||!j)L.boundsBuffer&&L.boundsSegments&&Gt.draw(g,k.TRIANGLES,be,s.b6.disabled,Y,s.b5.disabled,Qt,h.id,L.boundsBuffer,g.quadTriangleIndexBuffer,L.boundsSegments);else if(Ht&&Ri){const hi=ue.zoom<=s.Z?L.elevatedGlobeSegments:L.getSegmentsForLongitude(ue.center.lng);hi&&(Gt.draw(g,k.TRIANGLES,be,s.b6.disabled,Y,s.b5.backCW,Qt,h.id,Ht,Ri,hi),Gt.draw(g,k.TRIANGLES,be,s.b6.disabled,Y,s.b5.frontCW,Qt,h.id,Ht,Ri,hi))}}else{const{tileBoundsBuffer:Ht,tileBoundsIndexBuffer:Ri,tileBoundsSegments:hi}=g.getTileBoundsBuffers(_e);Gt.draw(g,k.TRIANGLES,be,ze,Y,s.b5.disabled,Qt,h.id,Ht,Ri,hi)}}g.resetStencilClippingMasks()},background:function(g,l,h,x){const w=h.paint.get("background-color"),M=h.paint.get("background-opacity"),A=h.paint.get("background-emissive-strength");if(M===0)return;const k=g.context,L=k.gl,O=g.transform,N=O.tileSize,j=h.paint.get("background-pattern");if(g.isPatternMissing(j,h.scope))return;const H=!j&&w.a===1&&M===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==H)return;const q=s.b6.disabled,Y=g.depthModeForSublayer(0,H==="opaque"?s.b4.ReadWrite:s.b4.ReadOnly),J=g.colorModeForDrapableLayerRenderPass(A),K=j?"backgroundPattern":"background";let X,oe=x;oe||(X=g.getBackgroundTiles(),oe=Object.values(X).map(de=>de.tileID)),j&&(k.activeTexture.set(L.TEXTURE0),g.imageManager.bind(g.context,h.scope));for(const de of oe){const fe=g.isTileAffectedByFog(de),ne=g.getOrCreateProgram(K,{overrideFog:fe}),ae=de.toUnwrapped(),me=x?de.projMatrix:g.transform.calculateProjMatrix(ae);g.prepareDrawTile();const xe=l?l.getTile(de):X?X[de.key]:new s.bt(de,N,O.zoom,g),_e=j?Qa(me,A,M,g,j,h.scope,{tileID:de,tileSize:N}):Vh(me,A,M,w);g.uploadCommonUniforms(k,ne,ae);const{tileBoundsBuffer:be,tileBoundsIndexBuffer:Ue,tileBoundsSegments:ze}=g.getTileBoundsBuffers(xe);ne.draw(g,L.TRIANGLES,Y,q,J,s.b5.disabled,_e,h.id,be,Ue,ze)}},sky:function(g,l,h){const x=g._atmosphere?s.ao(g.transform.zoom):1,w=h.paint.get("sky-opacity")*x;if(w===0)return;const M=g.context,A=h.paint.get("sky-type"),k=new s.b4(M.gl.LEQUAL,s.b4.ReadOnly,[0,1]),L=g.frameCounter/1e3%1;A==="atmosphere"?g.renderPass==="offscreen"?h.needsSkyboxCapture(g)&&(function(O,N,j,H){const q=O.context,Y=q.gl;let J=N.skyboxFbo;if(!J){J=N.skyboxFbo=q.createFramebuffer(32,32,!0,null),N.skyboxGeometry=new Ss(q),N.skyboxTexture=q.gl.createTexture(),Y.bindTexture(Y.TEXTURE_CUBE_MAP,N.skyboxTexture),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,Y.LINEAR);for(let de=0;de<6;++de)Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+de,0,Y.RGBA,32,32,0,Y.RGBA,Y.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(J.framebuffer),q.viewport.set([0,0,32,32]);const K=N.getCenter(O,!0),X=O.getOrCreateProgram("skyboxCapture"),oe=new Float64Array(16);s.m.identity(oe),s.m.rotateY(oe,oe,.5*-Math.PI),Po(O,N,X,oe,K,0),s.m.identity(oe),s.m.rotateY(oe,oe,.5*Math.PI),Po(O,N,X,oe,K,1),s.m.identity(oe),s.m.rotateX(oe,oe,.5*-Math.PI),Po(O,N,X,oe,K,2),s.m.identity(oe),s.m.rotateX(oe,oe,.5*Math.PI),Po(O,N,X,oe,K,3),s.m.identity(oe),Po(O,N,X,oe,K,4),s.m.identity(oe),s.m.rotateY(oe,oe,Math.PI),Po(O,N,X,oe,K,5),q.viewport.set([0,0,O.width,O.height])}(g,h),h.markSkyboxValid(g)):g.renderPass==="sky"&&function(O,N,j,H,q){const Y=O.context,J=Y.gl,K=O.transform,X=O.getOrCreateProgram("skybox");Y.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_CUBE_MAP,N.skyboxTexture);const oe=((de,fe,ne,ae,me)=>({u_matrix:de,u_sun_direction:fe,u_cubemap:0,u_opacity:ae,u_temporal_offset:me}))(K.skyboxMatrix,N.getCenter(O,!1),0,H,q);O.uploadCommonUniforms(Y,X),X.draw(O,J.TRIANGLES,j,s.b6.disabled,O.colorModeForRenderPass(),s.b5.backCW,oe,"skybox",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(g,h,k,w,L):A==="gradient"&&g.renderPass==="sky"&&function(O,N,j,H,q){const Y=O.context,J=Y.gl,K=O.transform,X=O.getOrCreateProgram("skyboxGradient");N.skyboxGeometry||(N.skyboxGeometry=new Ss(Y)),Y.activeTexture.set(J.TEXTURE0);let oe=N.colorRampTexture;oe||(oe=N.colorRampTexture=new s.a9(Y,N.colorRamp,J.RGBA)),oe.bind(J.LINEAR,J.CLAMP_TO_EDGE);const de=((fe,ne,ae,me,xe)=>({u_matrix:fe,u_color_ramp:0,u_center_direction:ne,u_radius:s.d(ae),u_opacity:me,u_temporal_offset:xe}))(K.skyboxMatrix,N.getCenter(O,!1),N.paint.get("sky-gradient-radius"),H,q);O.uploadCommonUniforms(Y,X),X.draw(O,J.TRIANGLES,j,s.b6.disabled,O.colorModeForRenderPass(),s.b5.backCW,de,"skyboxGradient",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(g,h,k,w,L)},debug:function(g,l,h,x,w){for(let M=0;M<h.length;M++)if(w){const L=new s.C(x.r*.8,x.g*.8,x.b*.8,1);da(g,l,h[M],x,-1,-1),da(g,l,h[M],x,-1,1),da(g,l,h[M],x,1,1),da(g,l,h[M],x,1,-1),da(g,l,h[M],L,0,0)}else da(g,l,h[M],x,0,0)},custom:function(g,l,h,x){const w=g.context,M=h.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||g.renderPass==="offscreen")&&h.isLayerDraped(l)){if(g.renderPass==="offscreen"){const A=M.prerender;if(A){if(g.setCustomLayerDefaults(),w.setColorMode(g.colorModeForRenderPass()),g.transform.projection.name==="globe"){const k=g.transform.pointMerc;A.call(M,w.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),s.ao(g.transform.zoom),[k.x,k.y],g.transform.pixelsPerMeterRatio)}else A.call(M,w.gl,g.transform.customLayerMatrix());w.setDirty(),g.setBaseState()}}else if(g.renderPass==="translucent"){if(g.terrain&&g.terrain.renderingToTexture){const k=M.renderToTile;if(k){const L=x[0].canonical,O=new s.M(L.x+x[0].wrap*(1<<L.z),L.y,L.z);w.setDepthMode(s.b4.disabled),w.setStencilMode(s.b6.disabled),w.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),k.call(M,w.gl,O),w.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),w.setColorMode(g.colorModeForRenderPass()),w.setStencilMode(s.b6.disabled);const A=M.renderingMode==="3d"?new s.b4(g.context.gl.LEQUAL,s.b4.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,s.b4.ReadOnly);if(w.setDepthMode(A),g.transform.projection.name==="globe"){const k=g.transform.pointMerc;M.render(w.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),s.ao(g.transform.zoom),[k.x,k.y],g.transform.pixelsPerMeterRatio)}else M.render(w.gl,g.transform.customLayerMatrix());w.setDirty(),g.setBaseState(),w.bindFramebuffer.set(null)}}else s.X("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(g,l,h,x){if(g.renderPass==="opaque")return;const w=h.paint.get("model-opacity");if(w===0)return;const M=h.paint.get("model-cast-shadows");if(g.renderPass==="shadow"&&(!M||g.terrain&&w<.65&&h._transitionablePaint._values["model-opacity"].value.expression instanceof s.am))return;const A=g.shadowRenderer,k=h.paint.get("model-receive-shadows");A&&(A.useNormalOffset=!0,k||(A.enabled=!1));const L=()=>{A&&(A.useNormalOffset=!0,k||(A.enabled=!0))},O=l.getSource();if(g.renderPass==="light-beam"&&O.type!=="batched-model")return;if(O.type==="vector"||O.type==="geojson")return function(X,oe,de,fe){const ne=X.transform;if(ne.projection.name!=="mercator")return void s.X(`Drawing 3D models for ${ne.projection.name} projection is not yet implemented`);const ae=ne.getFreeCameraOptions().position;if(!X.modelManager)return;const me=X.modelManager,xe=X.shadowRenderer;if(!de._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const _e=de._unevaluatedLayout._values["model-id"],be={...de.layout.get("model-id").parameters};for(const Ue of fe){const ze=oe.getTile(Ue).getBucket(de);if(!ze||ze.projection.name!==ne.projection.name)continue;const Fe=K_(Ue,ne);be.zoom=Fe;const Ae=_e.possiblyEvaluate(be);if(Y_(X,ze,Ue),ls.shadowUniformsInitialized=!1,ls.useSingleShadowCascade=!!xe&&xe.getMaxCascadeForTile(Ue.toUnwrapped())===0,X.renderPass==="shadow"&&xe){if(X.currentShadowCascade===1&&ze.isInsideFirstShadowMapFrustum)continue;const qe=ne.calculatePosMatrix(Ue.toUnwrapped(),ne.worldSize);if(ls.tileMatrix.set(qe),ls.shadowTileMatrix=Float32Array.from(xe.calculateShadowPassMatrixFromMatrix(qe)),ls.aabb.min.fill(0),ls.aabb.max[0]=ls.aabb.max[1]=s.J,ls.aabb.max[2]=0,wp(ze,ls,X,de.scope))continue}const je=1<<Ue.canonical.z,Oe=[((ae.x-Ue.wrap)*je-Ue.canonical.x)*s.J,(ae.y*je-Ue.canonical.y)*s.J,ae.z*je*s.J];for(let qe in ze.instancesPerModel){const ue=ze.instancesPerModel[qe];ue.features.length>0&&(qe=Ae.evaluate(ue.features[0].feature,{}));const Ce=me.getModel(qe,de.scope);if(Ce&&Ce.uploaded)for(const st of Ce.nodes)Wl(X,de,st,ue,Oe,Ue,ls)}}}(g,l,h,x),void L();if(!O.loaded())return;if(O.type==="batched-model")return function(X,oe,de,fe){const ne=X.context,ae=X.transform,me=X.style.fog,xe=X.shadowRenderer;if(ae.projection.name!=="mercator")return void s.X(`Drawing 3D landmark models for ${ae.projection.name} projection is not yet implemented`);const _e=X.transform.getFreeCameraOptions().position,be=s.v.scale([],[_e.x,_e.y,_e.z],X.transform.worldSize);s.v.negate(be,be);const Ue=s.m.identity([]),ze=s.c4(ae.center.lat,ae.zoom),Fe=s.m.fromScaling([],[1,1,1/ze]);s.m.translate(Ue,Ue,be);const Ae=de.paint.get("model-opacity"),je=new s.b4(ne.gl.LEQUAL,s.b4.ReadWrite,X.depthRangeFor3D),Oe=new s.b4(ne.gl.LEQUAL,s.b4.ReadOnly,X.depthRangeFor3D),qe=function(ue,Ce){for(const st of fe){const $e=oe.getTile(st).getBucket(de);if(!$e||!$e.uploaded)continue;let Ft=!1;xe&&(Ft=xe.getMaxCascadeForTile(st.toUnwrapped())===0);const kt=ae.calculatePosMatrix(st.toUnwrapped(),ae.worldSize),Xt=$e.modelTraits;for(const Lt of $e.getNodesInfo()){if(Lt.hiddenByReplacement||!Lt.node.meshes)continue;const Qt=Lt.node,$t=X.renderPass==="light-beam",Gt=[...kt],Ht=Lt.evaluatedScale;let Ri=0;X.terrain&&Qt.elevation&&(Ri=Qt.elevation*X.terrain.exaggeration()),s.m.translate(Gt,Gt,[(Qt.anchor?Qt.anchor[0]:0)*(Ht[0]-1),(Qt.anchor?Qt.anchor[1]:0)*(Ht[1]-1),Ri]),Ht!==s.c6&&s.m.scale(Gt,Gt,Ht),s.m.multiply(Gt,Gt,Qt.matrix);const hi=s.m.multiply([],Fe,Gt);s.m.multiply(hi,Ue,hi);const hn=s.m.invert([],hi);s.m.transpose(hn,hn),s.m.scale(hn,hn,J_);const Qi=s.m.multiply([],ae.expandedFarZProjMatrix,Gt),Lr=Xt&s.c8.HasMapboxMeshFeatures,us=Lr?0:Lt.evaluatedRMEA[0][2];for(let Xi=0;Xi<Qt.meshes.length;++Xi){const Bi=Qt.meshes[Xi],Vi=Xi===Qt.lightMeshIndex;if(Vi){if(!$t&&!X.terrain&&X.shadowRenderer){X.currentLayer<X.firstLightBeamLayer&&(X.firstLightBeamLayer=X.currentLayer);continue}}else if($t)continue;const yn={defines:[]},cr=[];Kh(yn.defines,cr,Bi,X),Lr||yn.defines.push("DIFFUSE_SHADED"),Ft&&yn.defines.push("SHADOWS_SINGLE_CASCADE");const mn=X.renderPass==="shadow";if(mn){Hl(Bi,Gt,X,de);continue}let vr=null;if(me){const As=lu(Gt,X.transform);if(vr=new Float32Array(As),ae.projection.name!=="globe"){const tn=Bi.aabb.min,Is=Bi.aabb.max,[Us,so]=me.getOpacityForBounds(As,tn[0],tn[1],Is[0],Is[1]);yn.overrideFog=Us>=Ur||so>=Ur}}const Rr=X.getOrCreateProgram("model",yn);!mn&&xe&&(xe.useNormalOffset=!!Bi.normalBuffer,xe.setupShadowsFromMatrix(Gt,Rr,xe.useNormalOffset)),X.uploadCommonUniforms(ne,Rr,st.toUnwrapped(),vr);const br=Bi.material,hs=br.pbrMetallicRoughness;hs.metallicFactor=.9,hs.roughnessFactor=.5;const ro=jl(new Float32Array(Qi),new Float32Array(hi),new Float32Array(hn),X,Ae,hs.baseColorFactor,br.emissiveFactor,hs.metallicFactor,hs.roughnessFactor,br,us,de);Rr.draw(X,ne.gl.TRIANGLES,Ce&&!Vi?je:Oe,s.b6.disabled,ue?Vi||Ae<1||Lt.hasTranslucentParts?s.a.alphaBlended:s.a.unblended:s.a.disabled,s.b5.backCCW,ro,de.id,Bi.vertexBuffer,Bi.indexBuffer,Bi.segments,de.paint,X.transform.zoom,void 0,cr)}}}};(function(ue,Ce,st,$e){const Ft=ue.terrain?ue.terrain.exaggeration():0,kt=ue.transform.zoom;for(const Xt of $e){const Lt=Ce.getTile(Xt).getBucket(st);Lt&&(ue.conflationActive&&Lt.updateReplacement(Xt,ue.replacementSource),Lt.evaluateScale(ue,st),ue.terrain&&Ft>0&&Lt.elevationUpdate(ue.terrain,Ft,Xt,st.source),Lt.needsReEvaluation(ue,kt,st)&&Lt.evaluate(st))}})(X,oe,de,fe),Ae===1?qe(!0,!0):(qe(!1,!0),qe(!0,!1))}(g,l,h,x),void L();const N=O.getModels(),j=[],H=g.transform.getFreeCameraOptions().position,q=s.v.scale([],[H.x,H.y,H.z],g.transform.worldSize);s.v.negate(q,q);const Y=[],J=[];let K=0;for(const X of N){const oe=h.paint.get("model-rotation").constantOr(null),de=h.paint.get("model-scale").constantOr(null),fe=h.paint.get("model-translation").constantOr(null);X.computeModelMatrix(g,oe,de,fe,!0,!0,!1);const ne=s.m.identity([]),ae=s.c4(X.position.lat,g.transform.zoom),me=s.m.fromScaling([],[1,1,1/ae]);s.m.translate(ne,ne,q),j.push({zScaleMatrix:me,negCameraPosMatrix:ne});for(const xe of X.nodes)bp(g.transform,xe,X.matrix,g.transform.expandedFarZProjMatrix,K,Y,J);K++}if(Y.sort((X,oe)=>oe.depth-X.depth),g.renderPass!=="shadow"){if(w===1)for(const X of J)fa(X,g,h,j[X.modelIndex],s.b6.disabled,g.colorModeForRenderPass());else{for(const X of J)fa(X,g,h,j[X.modelIndex],s.b6.disabled,s.a.disabled);for(const X of J)fa(X,g,h,j[X.modelIndex],g.stencilModeFor3D(),g.colorModeForRenderPass());g.resetStencilClippingMasks()}for(const X of Y)fa(X,g,h,j[X.modelIndex],s.b6.disabled,g.colorModeForRenderPass());L()}else{for(const X of J)Hl(X.mesh,X.nodeModelMatrix,g,h);for(const X of Y)Hl(X.mesh,X.nodeModelMatrix,g,h);L()}}},Sp={modelUpload:function(g,l,h){const x=l.getSource();if(!x.loaded())return;if(x.type==="vector"||x.type==="geojson")return void(g.modelManager&&g.modelManager.upload(g,h));if(x.type==="batched-model")return;const w=x.getModels();for(const M of w)M.upload(g.context)}};class Q_{constructor(l,h,x,w){this.context=new Dn(l,h),this.transform=x,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=w,this._debugParams={showTerrainProxyTiles:!1},w.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=s.bq.maxUnderzooming+s.bq.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.ca,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new $h(this),this._wireframeDebugCache=new il,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(l,h){const x=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(x||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Rh(this,l));const w=this._terrain;this.transform.elevation=x?w:null,w.update(l,this.transform,h),this.transform.elevation&&!w.enabled&&(this.transform.elevation=null)}_updateFog(l){const h=l.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[x,w]=h.getFovAdjustedRange(this.transform._fov);if(x>w)return void(this.transform.fogCullDistSq=null);const M=x+.78*(w-x);this.transform.fogCullDistSq=M*M}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(l,h){if(this.width=l*s.a4.devicePixelRatio,this.height=h*s.a4.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const x of this.style.order)this.style._mergedLayers[x].resize()}setup(){const l=this.context,h=new s.bo;h.emplaceBack(0,0),h.emplaceBack(s.J,0),h.emplaceBack(0,s.J),h.emplaceBack(s.J,s.J),this.tileExtentBuffer=l.createVertexBuffer(h,s.bl.members),this.tileExtentSegments=s.bm.simpleSegment(0,0,4,2);const x=new s.bo;x.emplaceBack(0,0),x.emplaceBack(s.J,0),x.emplaceBack(0,s.J),x.emplaceBack(s.J,s.J),this.debugBuffer=l.createVertexBuffer(x,s.bl.members),this.debugSegments=s.bm.simpleSegment(0,0,4,5);const w=new s.bo;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(w,s.bl.members),this.viewportSegments=s.bm.simpleSegment(0,0,4,2);const M=new s.cb;M.emplaceBack(0,0,0,0),M.emplaceBack(s.J,0,s.J,0),M.emplaceBack(0,s.J,0,s.J),M.emplaceBack(s.J,s.J,s.J,s.J),this.mercatorBoundsBuffer=l.createVertexBuffer(M,s.cc.members),this.mercatorBoundsSegments=s.bm.simpleSegment(0,0,4,2);const A=new s.bp;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(A);const k=new s.cd;for(const O of[0,1,3,2,0])k.emplaceBack(O);this.debugIndexBuffer=l.createIndexBuffer(k),this.emptyTexture=new s.a9(l,new s.a5({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA),this.identityMat=s.m.create();const L=this.context.gl;this.stencilClearMode=new s.b6({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,l.TRIANGLES,s.b4.disabled,this.stencilClearMode,s.a.disabled,s.b5.disabled,Xc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,h,x){if(!h||this.currentStencilSource===h.id||!l.isTileClipped()||!x||x.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(const L of x)if(this._tileClippingMaskIDs[L.key]===void 0){k=!0;break}if(!k)return}this.currentStencilSource=h.id;const w=this.context,M=w.gl;this.nextStencilID+x.length>256&&this.clearStencil(),w.setColorMode(s.a.disabled),w.setDepthMode(s.b4.disabled);const A=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const k of x){const L=h.getTile(k),O=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:N,tileBoundsIndexBuffer:j,tileBoundsSegments:H}=this.getTileBoundsBuffers(L);A.draw(this,M.TRIANGLES,s.b4.disabled,new s.b6({func:M.ALWAYS,mask:0},O,255,M.KEEP,M.KEEP,M.REPLACE),s.a.disabled,s.b5.disabled,Xc(k.projMatrix),"$clipping",N,j,H)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,h=this.context.gl;return new s.b6({func:h.NOTEQUAL,mask:255},l,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const h=this.context.gl;return new s.b6({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(l){const h=this.context.gl,x=l.sort((A,k)=>k.overscaledZ-A.overscaledZ),w=x[x.length-1].overscaledZ,M=x[0].overscaledZ-w+1;if(M>1){this.currentStencilSource=void 0,this.nextStencilID+M>256&&this.clearStencil();const A={};for(let k=0;k<M;k++)A[k+w]=new s.b6({func:h.GEQUAL,mask:255},k+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=M,[A,x]}return[{[w]:s.b6.disabled},x]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new s.a([l.CONSTANT_COLOR,l.ONE,l.CONSTANT_COLOR,l.ONE],new s.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.a.unblended:s.a.alphaBlended}colorModeForDrapableLayerRenderPass(l){const h=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new s.a([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.CONSTANT_ALPHA,h.ONE_MINUS_SRC_ALPHA],new s.C(0,0,0,l===void 0?0:l),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(l,h,x,w=!1){if(!this.opaquePassEnabledForLayer()&&!w)return s.b4.disabled;const M=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new s.b4(x||this.context.gl.LEQUAL,h,[M,M])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,h){this._wireframeDebugCache.update(this.frameCounter),this.style=l,this.options=h;const x=this.style._mergedLayers,w=this.style.order,M=w.map(ne=>x[ne]),A=this.style._mergedSourceCaches;this.imageManager=l.imageManager,this.modelManager=l.modelManager,this.symbolFadeChange=l.placement.symbolFadeChange(s.a4.now()),this.imageManager.beginFrame();let k=0,L=!1;for(const ne in A){const ae=A[ne];ae.used&&(ae.prepare(this.context),ae.getSource().usedInConflation&&++k)}const O={},N={},j={},H={},q={};for(const ne in A){const ae=A[ne];O[ne]=ae.getVisibleCoordinates(),N[ne]=O[ne].slice().reverse(),j[ne]=ae.getVisibleCoordinates(!0).reverse(),H[ne]=ae.getShadowCasterCoordinates(),q[ne]=ae.sortCoordinatesByDistance(O[ne])}const Y=ne=>{const ae=this.style.getLayerSourceCache(ne);return ae&&ae.used?ae.getSource():null};if(k){const ne=[];for(const ae of M)this.layerUsedInConflation(ae,Y(ae))&&ne.push(ae);if(ne&&ne.length>1){const ae=[];for(const me of ne){const xe=this.style.getLayerSourceCache(me);xe&&xe.used&&xe.getSource().usedInConflation&&ae.push({layer:me.fqid,cache:xe})}this.replacementSource.setSources(ae),L=!0}}L||this.replacementSource.clear(),this.conflationActive=L,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const ne of M){const ae=ne.cutoffRange();if(this.longestCutoffRange=Math.max(ae,this.longestCutoffRange),ae>0){const me=Y(ne);me&&(this.minCutoffZoom=Math.max(me.minzoom,this.minCutoffZoom)),ne.minzoom&&(this.minCutoffZoom=Math.max(ne.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let ne=0;ne<M.length;ne++)if(M[ne].is3D()){this.opaquePassCutoff=ne;break}const J=this.style&&this.style.fog;J?(this._fogVisible=J.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=J.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(j),this.opaquePassCutoff=0);const K=this._shadowRenderer;if(K){K.updateShadowParameters(this.transform,this.style.directionalLight);for(const ne in A)for(const ae of O[ne]){let me={min:0,max:0};this.terrain&&(me=this.terrain.getMinMaxForTile(ae)||me),K.addShadowReceiver(ae.toUnwrapped(),me.min,me.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.ce(this.context));for(const ne of M){if(ne.isHidden(this.transform.zoom))continue;const ae=l.getLayerSourceCache(ne);this.uploadLayer(this,ne,ae)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new X_(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!s.cf(this.context.gl))return;this.renderPass="offscreen";for(const ne of M){const ae=l.getLayerSourceCache(ne);if(!ne.hasOffscreenPass()||ne.isHidden(this.transform.zoom))continue;const me=ae?N[ae.id]:void 0;(ne.type==="custom"||ne.type==="raster"||ne.isSky()||me&&me.length)&&this.renderLayer(this,ae,ne,me)}this.depthRangeFor3D=[0,1-(M.length+2)*this.numSublayers*this.depthEpsilon];const X=this.terrain;X&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&X.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,H)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const oe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),de=(()=>{if(h.showOverdrawInspector)return s.C.black;if(this.style.fog&&this.transform.projection.supportsFog&&!oe){const ne=this.style.fog.properties.get("color").toArray01();return new s.C(...ne)}if(this.style.fog&&this.transform.projection.supportsFog&&oe){const ne=this.style.fog.properties.get("space-color").toArray01();return new s.C(...ne)}return s.C.transparent})();if(this.context.clear({color:de,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&oe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const ne=M[this.currentLayer],ae=l.getLayerSourceCache(ne);if(ne.isSky())continue;const me=ae?(ne.is3D()?q:N)[ae.id]:void 0;this._renderTileClippingMasks(ne,ae,me),this.renderLayer(this,ae,ne,me)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&oe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.ao(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const ne=M[this.currentLayer],ae=l.getLayerSourceCache(ne);ne.isSky()&&this.renderLayer(this,ae,ne,ae?N[ae.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let fe=0;for(K&&(fe=K.getShadowCastingLayerCount());this.currentLayer<w.length;){const ne=M[this.currentLayer],ae=l.getLayerSourceCache(ne);if(ne.isSky()){++this.currentLayer;continue}if(X&&this.style.isLayerDraped(ne)){if(ne.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=X.renderBatch(this.currentLayer);continue}let me;if(ae&&(me=(ne.type==="symbol"?j:ne.is3D()?q:N)[ae.id]),this._renderTileClippingMasks(ne,ae,ae?O[ae.id]:void 0),this.renderLayer(this,ae,ne,me),!X&&K&&fe>0&&ne.hasShadowPass()&&--fe==0&&(K.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const xe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=xe;this.currentLayer++){const _e=M[this.currentLayer];if(!_e.hasLightBeamPass())continue;const be=l.getLayerSourceCache(_e);this.renderLayer(this,be,_e,be?N[be.id]:void 0)}this.currentLayer=xe,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ne=null;M.forEach(ae=>{const me=l.getLayerSourceCache(ae);me&&!ae.isHidden(this.transform.zoom)&&me.getVisibleCoordinates().length&&(!ne||ne.getSource().maxzoom<me.getSource().maxzoom)&&(ne=me)}),ne&&this.options.showTileBoundaries&&Jh.debug(this,ne,ne.getVisibleCoordinates(),s.C.red,!1)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Jh.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.C(1,.8,.1,1),!0),this.options.showPadding&&function(ne){const ae=ne.transform.padding;_p(ne,ne.transform.height-(ae.top||0),3,Hh),_p(ne,ae.bottom||0,3,Wh),tl(ne,ae.left||0,3,qh),tl(ne,ne.transform.width-(ae.right||0),3,Zh);const me=ne.transform.centerPoint;(function(xe,_e,be,Ue){Co(xe,_e-1,be-10,2,20,Ue),Co(xe,_e-10,be-1,20,2,Ue)})(ne,me.x,ne.transform.height-me.y,gp)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),L||(this.conflationActive=!1)}uploadLayer(l,h,x){this.gpuTimingStart(h),(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes(h.type)||l.terrain&&h.type==="custom")&&Sp[`${h.type}Upload`]&&Sp[`${h.type}Upload`](l,x,h.scope),this.gpuTimingEnd()}renderLayer(l,h,x,w){x.isHidden(this.transform.zoom)||(x.type==="background"||x.type==="sky"||x.type==="custom"||x.type==="model"||x.type==="raster"||w&&w.length)&&(this.id=x.id,this.gpuTimingStart(x),(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes(x.type)||l.terrain&&x.type==="custom")&&Jh[x.type](l,h,x,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery,x=this.context.gl;let w=this.gpuTimers[l.id];w||(w=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:x.createQuery()}),w.calls++,x.beginQuery(h.TIME_ELAPSED_EXT,w.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const l=this.context.extTimerQuery,h=this.context.gl,x=h.createQuery();this.deferredRenderGpuTimeQueries.push(x),h.beginQuery(l.TIME_ELAPSED_EXT,x)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){const l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){const h={};for(const x in l){const w=l[x],M=this.context.extTimerQuery,A=M.getQueryParameter(w.query,this.context.gl.QUERY_RESULT)/1e6;M.deleteQueryEXT(w.query),h[x]=A}return h}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.extTimerQuery,x=this.context.gl;let w=0;for(const M of l)w+=h.getQueryParameter(M,x.QUERY_RESULT)/1e6,h.deleteQueryEXT(M);return w}translatePosMatrix(l,h,x,w,M){if(!x[0]&&!x[1])return l;const A=M?w==="map"?this.transform.angle:0:w==="viewport"?-this.transform.angle:0;if(A){const O=Math.sin(A),N=Math.cos(A);x=[x[0]*N-x[1]*O,x[0]*O+x[1]*N]}const k=[M?x[0]:s.ay(h,x[0],this.transform.zoom),M?x[1]:s.ay(h,x[1],this.transform.zoom),0],L=new Float32Array(16);return s.m.translate(L,l,k),L}saveTileTexture(l){const h=l.size[0],x=this._tileTextures[h];x?x.push(l):this._tileTextures[h]=[l]}getTileTexture(l){const h=this._tileTextures[l];return h&&h.length>0?h.pop():null}isPatternMissing(l,h){return l===null||l!==void 0&&!this.imageManager.getPattern(l.toString(),h)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(l,h,x){const w=x===void 0?this.terrain&&this.terrain.renderingToTexture:x,M=this.terrain&&this.terrain.exaggeration()===0,A=[];return this.style&&this.style.enable3dLights()&&(l==="globeRaster"||l==="terrainRaster"?(A.push("LIGHTING_3D_MODE"),A.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):w||A.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||A.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?A.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):A.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(A.push("TERRAIN"),this.linearFloatFilteringSupported()&&A.push("TERRAIN_DEM_FLOAT_FORMAT"),M&&A.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&A.push("GLOBE"),!this._fogVisible||w||h!==void 0&&!h||A.push("FOG","FOG_DITHERING"),w&&A.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&A.push("OVERDRAW_INSPECTOR"),A}getOrCreateProgram(l,h){this.cache=this.cache||{};const x=h&&h.defines||[],w=h&&h.config,M=this.currentGlobalDefines(l,h&&h.overrideFog,h&&h.overrideRtt).concat(x),A=Qc.cacheKey(Ih[l],l,M,w);return this.cache[A]||(this.cache[A]=new Qc(this.context,l,Ih[l],w,fp[l],M)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.a9(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(l,h){if(this.style.enable3dLights()){const x=this.style.directionalLight,w=this.style.ambientLight;if(x&&w){const M=((A,k)=>{const L=A.properties.get("direction"),O=A.properties.get("color").toArray01(),N=A.properties.get("intensity"),j=k.properties.get("color").toArray01(),H=k.properties.get("intensity"),q=[L.x,L.y,L.z],Y=s.bv(j,H),J=s.bv(O,N);return{u_lighting_ambient_color:Y,u_lighting_directional_dir:q,u_lighting_directional_color:J,u_ground_radiance:lp(q,J,Y)}})(x,w);h.setLightsUniformValues(l,M)}}}uploadCommonUniforms(l,h,x,w,M){if(this.uploadCommonLightUniforms(l,h),this.terrain&&this.terrain.renderingToTexture)return;const A=this.style.fog;if(A){const k=A.getOpacity(this.transform.pitch),L=((O,N,j,H,q,Y,J,K,X,oe,de,fe)=>{const ne=O.transform,ae=N.properties.get("color").toArray01();ae[3]=H;const me=O.frameCounter/1e3%1,[xe,_e]=N.properties.get("vertical-range");return{u_fog_matrix:j?ne.calculateFogTileMatrix(j):fe||O.identityMat,u_fog_range:N.getFovAdjustedRange(ne._fov),u_fog_color:ae,u_fog_horizon_blend:N.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(xe,_e),_e],u_fog_temporal_offset:me,u_frustum_tl:q,u_frustum_tr:Y,u_frustum_br:J,u_frustum_bl:K,u_globe_pos:X,u_globe_radius:oe,u_viewport:de,u_globe_transition:s.ao(ne.zoom),u_is_globe:+(ne.projection.name==="globe")}})(this,A,x,k,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.a4.devicePixelRatio,this.transform.height*s.a4.devicePixelRatio],w);h.setFogUniformValues(l,L)}M&&h.setCutoffUniformValues(l,M.uniformValues)}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){const l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){const l=this.context.gl,h=l.createTexture();return l.bindTexture(l.TEXTURE_2D,h),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&l.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const l=this._backgroundTiles,h=this._backgroundTiles={},x=this.transform.coveringTiles({tileSize:512});for(const w of x)h[w.key]=l[w.key]||new s.bt(w,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(l,h){return!(!l.is3D()||l.minzoom&&l.minzoom>this.transform.zoom||l.sourceLayer!=="building"&&(!h||h.type!=="batched-model"))}isTileAffectedByFog(l){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let h=this._cachedTileFogOpacities[l.key];return h||(this._cachedTileFogOpacities[l.key]=h=this.style.fog.getOpacityForTile(l)),h[0]>=Ur||h[1]>=Ur}}const Gr={cascadeCount:2,shadowMapResolution:2048};class $_{constructor(l,h){this.aabb=l,this.lastCascade=h}}class Qh{add(l,h){const x=this.receivers[l.key];x!==void 0?(x.aabb.min[0]=Math.min(x.aabb.min[0],h.min[0]),x.aabb.min[1]=Math.min(x.aabb.min[1],h.min[1]),x.aabb.min[2]=Math.min(x.aabb.min[2],h.min[2]),x.aabb.max[0]=Math.max(x.aabb.max[0],h.max[0]),x.aabb.max[1]=Math.max(x.aabb.max[1],h.max[1]),x.aabb.max[2]=Math.max(x.aabb.max[2],h.max[2])):this.receivers[l.key]=new $_(h,null)}clear(){this.receivers={}}get(l){return this.receivers[l.key]}computeRequiredCascades(l,h,x){const w=s.c3.fromPoints(l.points);let M=0;for(const A in this.receivers){const k=this.receivers[A];if(!k||!w.intersectsAabb(k.aabb))continue;k.aabb.min=w.closestPoint(k.aabb.min),k.aabb.max=w.closestPoint(k.aabb.max);const L=k.aabb.getCorners();for(let O=0;O<x.length;O++){let N=!0;for(const j of L){const H=[j[0]*h,j[1]*h,j[2]];if(s.v.transformMat4(H,H,x[O].matrix),H[0]<-1||H[0]>1||H[1]<-1||H[1]>1){N=!1;break}}if(k.lastCascade=O,M=Math.max(M,O),N)break}}return M+1}}class $h{constructor(l){this.painter=l,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Qh,this._depthMode=new s.b4(l.context.gl.LEQUAL,s.b4.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,l.tp.registerParameter(Gr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),l.tp.registerParameter(Gr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(const l of this._cascades)l.texture.destroy(),l.framebuffer.destroy();this._cascades=[]}updateShadowParameters(l,h){const x=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!h||!h.properties)return;const w=h.properties.get("shadow-intensity");if(!h.shadowsEnabled()||w<=0||(this._shadowLayerCount=x.style.order.reduce((Y,J)=>{const K=x.style._mergedLayers[J];return Y+(K.hasShadowPass()&&!K.isHidden(l.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const M=x.context,A=Gr.shadowMapResolution,k=Gr.shadowMapResolution;if(this._cascades.length===0||Gr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Y=0;Y<Gr.cascadeCount;++Y){const J=x._shadowMapDebug,K=M.gl,X=M.createFramebuffer(A,k,J,"texture"),oe=new s.a9(M,{width:A,height:k,data:null},K.DEPTH_COMPONENT);if(X.depthAttachment.set(oe.texture),J){const de=new s.a9(M,{width:A,height:k,data:null},K.RGBA);X.colorAttachment.set(de.texture)}this._cascades.push({framebuffer:X,texture:oe,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.F,scale:0})}}this.shadowDirection=ed(h);let L=0;if(l.elevation){const Y=l.elevation,J=[1e4,-1e4];Y.visibleDemTiles.filter(K=>K.dem).forEach(K=>{const X=K.dem.tree;J[0]=Math.min(J[0],X.minimums[0]),J[1]=Math.max(J[1],X.maximums[0])}),J[0]!==1e4&&(L=(J[1]-J[0])*Y.exaggeration())}const O=1.5*l.cameraToCenterDistance,N=3*O,j=new Float64Array(16);for(let Y=0;Y<this._cascades.length;++Y){const J=this._cascades[Y];let K=l.height/50,X=1;Gr.cascadeCount===1?X=N:Y===0?X=O:(K=O,X=N);const[oe,de]=Ep(l,this.shadowDirection,K,X,Gr.shadowMapResolution,L);J.scale=l.scale,J.matrix=oe,J.boundingSphereRadius=de,s.m.invert(j,J.matrix),J.frustum=s.F.fromInvProjectionMatrix(j,1,0,!0),J.far=X}const H=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[H].far,this._cascades[H].far],this._uniformValues.u_shadow_intensity=w,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Gr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Gr.shadowMapResolution,this._uniformValues.u_shadowmap_0=gr.ShadowMap0,this._uniformValues.u_shadowmap_1=gr.ShadowMap0+1,this._groundShadowTiles=x.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const q=x.transform.elevation;for(const Y of this._groundShadowTiles){let J={min:0,max:0};if(q){const K=q.getMinMaxForTile(Y);K&&(J=K)}this.addShadowReceiver(Y.toUnwrapped(),J.min,J.max)}}get enabled(){return this._enabled}set enabled(l){this._enabled=l}drawShadowPass(l,h){if(!this._enabled)return;const x=this.painter,w=x.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(x.transform.getFrustum(0),x.transform.worldSize,this._cascades),w.viewport.set([0,0,Gr.shadowMapResolution,Gr.shadowMapResolution]);for(let M=0;M<this._numCascadesToRender;++M){x.currentShadowCascade=M,w.bindFramebuffer.set(this._cascades[M].framebuffer.framebuffer),w.clear({color:s.C.white,depth:1});for(const A of l.order){const k=l._mergedLayers[A];if(!k.hasShadowPass()||k.isHidden(x.transform.zoom))continue;const L=l.getLayerSourceCache(k),O=L?h[L.id]:void 0;(k.type==="model"||O&&O.length)&&x.renderLayer(x,L,k,O)}}x.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const l=this.painter,h=l.style,x=l.context,w=h.directionalLight,M=h.ambientLight;if(!w||!M)return;const A=[],k=la(l,l.longestCutoffRange);k.shouldRenderCutoff&&A.push("RENDER_CUTOFF");const L=cu(w,M),O=new s.b4(x.gl.LEQUAL,s.b4.ReadOnly,l.depthRangeFor3D);for(const N of this._groundShadowTiles){const j=N.toUnwrapped(),H=l.isTileAffectedByFog(N),q=l.getOrCreateProgram("groundShadow",{defines:A,overrideFog:H});this.setupShadows(j,q),l.uploadCommonUniforms(x,q,j,null,k);const Y={u_matrix:l.transform.calculateProjMatrix(j),u_ground_shadow_factor:L};q.draw(l,x.gl.TRIANGLES,O,s.b6.disabled,s.a.multiply,s.b5.disabled,Y,"ground_shadow",l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments,{},l.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?s.a.unblended:s.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(l){const h=this.painter.transform,x=h.calculatePosMatrix(l,h.worldSize);return s.m.multiply(x,this._cascades[this.painter.currentShadowCascade].matrix,x),Float32Array.from(x)}calculateShadowPassMatrixFromMatrix(l){return s.m.multiply(l,this._cascades[this.painter.currentShadowCascade].matrix,l),Float32Array.from(l)}setupShadows(l,h,x,w=0){if(!this._enabled)return;const M=this.painter.transform,A=this.painter.context,k=A.gl,L=this._uniformValues,O=new Float64Array(16),N=M.calculatePosMatrix(l,M.worldSize);for(let j=0;j<this._cascades.length;j++)s.m.multiply(O,this._cascades[j].matrix,N),L[j===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(O),A.activeTexture.set(k.TEXTURE0+gr.ShadowMap0+j),this._cascades[j].texture.bind(k.NEAREST,k.CLAMP_TO_EDGE);if(this.useNormalOffset=!!x,this.useNormalOffset){const j=s.cg(l.canonical),H=2/M.tileSize*s.J/Gr.shadowMapResolution,q=H*this._cascades[0].boundingSphereRadius,Y=H*this._cascades[this._cascades.length-1].boundingSphereRadius,J=(x==="vector-tile"?1:3)/Math.pow(2,w-l.canonical.z-(1-M.zoom+Math.floor(M.zoom)));L.u_shadow_normal_offset=[j,q*J,Y*J],L.u_shadow_bias=[6e-5,.0012,.012]}else L.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(A,L)}setupShadowsFromMatrix(l,h,x=!1){if(!this._enabled)return;const w=this.painter.context,M=w.gl,A=this._uniformValues,k=new Float64Array(16);for(let L=0;L<Gr.cascadeCount;L++)s.m.multiply(k,this._cascades[L].matrix,l),A[L===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(k),w.activeTexture.set(M.TEXTURE0+gr.ShadowMap0+L),this._cascades[L].texture.bind(M.NEAREST,M.CLAMP_TO_EDGE);this.useNormalOffset=x,x?(A.u_shadow_normal_offset=[1,5,5],A.u_shadow_bias=[6e-5,.0012,.012]):A.u_shadow_bias=[36e-5,.0012,.012],h.setShadowUniformValues(w,A)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(l,h,x,w){if(w[2]>=0)return{};const M=function(L,O,N){const j=N/(1<<L.canonical.z);return new s.c3([L.canonical.x*j+L.wrap*N,L.canonical.y*j+L.wrap*N,0],[(L.canonical.x+1)*j+L.wrap*N,(L.canonical.y+1)*j+L.wrap*N,O])}(l,h,x).getCorners(),A=h/-w[2];w[0]<0?(s.v.add(M[0],M[0],[w[0]*A,0,0]),s.v.add(M[3],M[3],[w[0]*A,0,0])):w[0]>0&&(s.v.add(M[1],M[1],[w[0]*A,0,0]),s.v.add(M[2],M[2],[w[0]*A,0,0])),w[1]<0?(s.v.add(M[0],M[0],[0,w[1]*A,0]),s.v.add(M[1],M[1],[0,w[1]*A,0])):w[1]>0&&(s.v.add(M[2],M[2],[0,w[1]*A,0]),s.v.add(M[3],M[3],[0,w[1]*A,0]));const k={};return k.vertices=M,k.planes=[ql(M[1],M[0],M[4]),ql(M[2],M[1],M[5]),ql(M[3],M[2],M[6]),ql(M[0],M[3],M[7])],k}addShadowReceiver(l,h,x){this._receivers.add(l,s.c3.fromTileIdAndHeight(l,h,x))}getMaxCascadeForTile(l){const h=this._receivers.get(l);return h&&h.lastCascade?h.lastCascade:0}}function ql(g,l,h){const x=s.v.sub([],h,l),w=s.v.sub([],g,l),M=s.v.cross([],x,w),A=s.v.length(M);return A===0?[0,0,1,0]:(s.v.scale(M,M,1/A),[M[0],M[1],M[2],-s.v.dot(M,l)])}function ed(g){const l=g.properties.get("direction"),h=s.b3(l.x,l.y,l.z);h[2]=s.c(h[2],0,75);const x=s.ch([h[0],h[1],h[2]]);return s.v.fromValues(x.x,x.y,x.z)}function cu(g,l){const h=g.properties.get("color"),x=g.properties.get("intensity"),w=g.properties.get("direction"),M=[w.x,w.y,w.z],A=l.properties.get("color"),k=l.properties.get("intensity"),L=Math.max(s.v.dot([0,0,1],M),0),O=[0,0,0];s.v.scale(O,A.toArray01Linear().slice(0,3),k);const N=[0,0,0];return s.v.scale(N,h.toArray01Linear().slice(0,3),L*x),s.bw([O[0]>0?O[0]/(O[0]+N[0]):0,O[1]>0?O[1]/(O[1]+N[1]):0,O[2]>0?O[2]/(O[2]+N[2]):0])}function Ep(g,l,h,x,w,M){const A=g.zoom,k=g.scale,L=g.worldSize,O=1/L,N=g.aspect,j=Math.sqrt(1+N*N)*Math.tan(.5*g.fovX),H=j*j,q=x-h,Y=x+h;let J,K;H>q/Y?(J=x,K=x*j):(J=.5*Y*(1+H),K=.5*Math.sqrt(q*q+2*(x*x+h*h)*H+Y*Y*H*H));const X=g.projection.pixelsPerMeter(g.center.lat,L),oe=g._camera.getCameraToWorldMercator(),de=[0,0,-J*O];s.v.transformMat4(de,de,oe);let fe=K*O;const ne=g._edgeInsets;if(!(ne.left===0&&ne.top===0&&ne.right===0&&ne.bottom===0||ne.left===ne.right&&ne.top===ne.bottom)){const $e=g._camera.getWorldToCamera(g.worldSize,g.projection.zAxisUnit==="meters"?X:1),Ft=g._camera.getCameraToClipPerspective(g._fov,g.width/g.height,h,x);Ft[8]=2*-g.centerOffset.x/g.width,Ft[9]=2*g.centerOffset.y/g.height;const kt=new Float64Array(16);s.m.mul(kt,Ft,$e);const Xt=new Float64Array(16);s.m.invert(Xt,kt);const Lt=s.F.fromInvProjectionMatrix(Xt,L,A,!0);for(const Qt of Lt.points){const $t=((ae=Qt)[0]/=k,ae[1]/=k,ae[2]=s.b(ae[2],g._center.lat),ae);fe=Math.max(fe,s.v.len(s.v.subtract([],de,$t)))}}var ae;fe*=w/(w-1);const me=Math.acos(l[2]),xe=Math.atan2(-l[0],-l[1]),_e=new Ni;_e.position=de,_e.setPitchBearing(me,xe);const be=_e.getWorldToCamera(L,X),Ue=fe*L,ze=Math.min(g._mercatorZfromZoom(17)*L*-2,-2*Ue),Fe=_e.getCameraToClipOrthographic(-Ue,Ue,-Ue,Ue,ze,(Ue+M*X)/l[2]),Ae=new Float64Array(16);s.m.multiply(Ae,Fe,be);const je=s.v.fromValues(Math.floor(1e6*de[0])/1e6*L,Math.floor(1e6*de[1])/1e6*L,0),Oe=.5*w,qe=[0,0,0];s.v.transformMat4(qe,je,Ae),s.v.scale(qe,qe,Oe);const ue=[Math.floor(qe[0]),Math.floor(qe[1]),Math.floor(qe[2])],Ce=[0,0,0];s.v.sub(Ce,qe,ue),s.v.scale(Ce,Ce,-1/Oe);const st=new Float64Array(16);return s.m.identity(st),s.m.translate(st,st,Ce),s.m.multiply(Ae,st,Ae),[Ae,Ue]}class Ap extends s.a6{constructor(l){super(),this.requestManager=l,this.models={"":{}},this.numModelsLoading={}}loadModel(l,h){return s.aO(this.requestManager.transformRequest(h,s.a2.Model).url).then(x=>{if(!x)return;const w=s.aP(x),M=new s.aQ(l,void 0,void 0,w);return M.computeBoundsAndApplyParent(),M}).catch(x=>{this.fire(new s.a7(new Error(`Could not load model ${l} from ${h}: ${x.message}`)))})}load(l,h){this.models[h]||(this.models[h]={});const x=Object.keys(l);this.numModelsLoading[h]=(this.numModelsLoading[h]||0)+x.length;const w=[];for(const M of x)w.push(this.loadModel(M,l[M]));Promise.allSettled(w).then(M=>{for(let A=0;A<M.length;A++){const{status:k,value:L}=M[A];k==="fulfilled"&&L&&(this.models[h][x[A]]=L)}this.numModelsLoading[h]-=x.length,this.fire(new s.a8("data",{dataType:"style"}))}).catch(M=>{this.fire(new s.a7(new Error(`Could not load models: ${M.message}`)))})}isLoaded(){for(const l in this.numModelsLoading)if(this.numModelsLoading[l]>0)return!1;return!0}hasModel(l,h){return!!this.getModel(l,h)}getModel(l,h){return this.models[h]||(this.models[h]={}),this.models[h][l]}addModel(l,h,x){this.models[x]||(this.models[x]={}),this.hasModel(l,x)&&this.removeModel(l,x),this.load({[l]:this.requestManager.normalizeModelURL(h)},x)}addModels(l,h){const x={};for(const w in l)x[w]=this.requestManager.normalizeModelURL(l[w]);this.load(x,h)}removeModel(l,h){this.models[h]||(this.models[h]={});const x=this.models[h][l];delete this.models[h][l],x.destroy()}listModels(l){return this.models[l]||(this.models[l]={}),Object.keys(this.models[l])}upload(l,h){this.models[h]||(this.models[h]={});for(const x in this.models[h])this.models[h][x].upload(l.context)}}const pa=(g,l)=>s.ai(g,l&&l.filter(h=>h.identifier!=="source.canvas")),Ip=s.p(et,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),kp=s.p(et,["setCenter","setZoom","setBearing","setPitch"]),td={version:8,layers:[],sources:{}},Do={duration:300,delay:0},Zl=new Set(["fill","line","background","hillshade","raster"]);class cs extends s.a6{constructor(l,h={}){super(),this.map=l,this.scope=h.scope||"",this.fragments=[],this.importDepth=h.importDepth||0,this.importsCache=h.importsCache||new Map,this.resolvedImports=h.resolvedImports||new Set,this.transition=s.ak({},Do),this._buildingIndex=new yh(this),this.crossTileSymbolIndex=new R_,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=h.styleChanges||new Se,this.dispatcher=h.dispatcher?h.dispatcher:new s.br(s.bs(),this),h.imageManager?this.imageManager=h.imageManager:(this.imageManager=new Ln,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=h.glyphManager?h.glyphManager:new s.cj(l._requestManager,h.localFontFamily?s.ck.all:h.localIdeographFontFamily?s.ck.ideographs:s.ck.none,h.localFontFamily||h.localIdeographFontFamily),h.modelManager?this.modelManager=h.modelManager:(this.modelManager=new Ap(l._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=h.configOptions?h.configOptions:new Map,this._configDependentLayers=h.configDependentLayers?h.configDependentLayers:new Set,this._config=h.config,this.dispatcher.broadcast("setReferrer",s.cl());const x=this;this._rtlTextPluginCallback=cs.registerForPluginStateChange(w=>{x.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(M,A)=>{if(s.cm(M),A&&A.every(k=>k))for(const k in x._sourceCaches){const L=x._sourceCaches[k],O=L.getSource().type;O!=="vector"&&O!=="geojson"||L.reload()}})}),this.on("data",w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const M=this.getOwnSource(w.sourceId);if(M&&M.vectorLayerIds)for(const A in this._layers){const k=this._layers[A];k.source===M.id&&this._validateLayer(k)}})}loadURL(l,h={}){this.fire(new s.a8("dataloading",{dataType:"style"}));const x=typeof h.validate=="boolean"?h.validate:!s.cn(l);l=this.map._requestManager.normalizeStyleURL(l,h.accessToken),this.resolvedImports.add(l);const w=this.importsCache.get(l);if(w)return this._load(w,x);const M=this.map._requestManager.transformRequest(l,s.a2.Style);this._request=s.a1(M,(A,k)=>{if(this._request=null,A)this.fire(new s.a7(A));else if(k)return this.importsCache.set(l,k),this._load(k,x)})}loadJSON(l,h={}){this.fire(new s.a8("dataloading",{dataType:"style"})),this._request=s.a4.frame(()=>{this._request=null,this._load(l,h.validate!==!1)})}loadEmpty(){this.fire(new s.a8("dataloading",{dataType:"style"})),this._load(td,!1)}_loadImports(l,h){if(this.importDepth>=4)return s.X("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const w of l){const M=this._createFragmentStyle(w),A=new Promise(L=>{M.once("style.import.load",L),M.once("error",L)}).then(()=>this.mergeAll());if(x.push(A),this.resolvedImports.has(w.url)){M.loadEmpty();continue}const k=w.data||this.importsCache.get(w.url);k?M.loadJSON(k,{validate:h}):w.url?M.loadURL(w.url,{validate:h}):M.loadEmpty(),this.fragments.push({style:M,id:w.id,config:w.config})}return Promise.allSettled(x)}_createFragmentStyle(l){const h=this.scope?s.aE(l.id,this.scope):l.id,x=new cs(this.map,{scope:h,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:l.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const l=this.isRootStyle();this._shouldPrecompile=l,this.fire(new s.a8(l?"style.load":"style.import.load"))}_load(l,h){const x=l.schema;if(this.isRootStyle()&&(l.fragment||x&&l.fragment!==!1)){const A=s.ak({},td,{imports:[{id:"basemap",data:l,url:""}]});return void this._load(A,h)}if(this.setConfig(this._config,x),h&&pa(this,s.aj(l)))return;this._loaded=!0,this.stylesheet=s.co(l);for(const A in l.sources)this.addSource(A,l.sources[A],{validate:!1,isInitialLoad:!0});l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(l.glyphs,this.scope);const w=ia(this.stylesheet.layers);if(this._order=w.map(A=>A.id),this.stylesheet.light&&s.X("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const A=this.stylesheet.lights[0];this.light=new yr(A.properties,A.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new yr(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const A of w){const k=s.cp(A,this.scope,this.options);k.isConfigDependent&&this._configDependentLayers.add(k.fqid),k.setEventedParent(this,{layer:{id:k.id}}),this._layers[k.id]=k,this._serializedLayers[k.id]=k.serialize();const L=this.getOwnLayerSourceCache(k),O=!!this.directionalLight&&this.directionalLight.shadowsEnabled();L&&k.canCastShadows()&&O&&(L.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const M=this.stylesheet.terrain;M&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.a4.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?s.X("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(M,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.a8("data",{dataType:"style"})),l.imports?this._loadImports(l.imports,h).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let l,h,x,w,M,A,k,L;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(O=>{if(O.stylesheet){if(O.light!=null&&(l=O.light),O.stylesheet.lights)for(const N of O.stylesheet.lights)N.type==="ambient"&&O.ambientLight!=null&&(h=O.ambientLight),N.type==="directional"&&O.directionalLight!=null&&(x=O.directionalLight);w=this._prioritizeTerrain(w,O.terrain,O.stylesheet.terrain),O.stylesheet.fog&&O.fog!=null&&(M=O.fog),O.stylesheet.camera!=null&&(L=O.stylesheet.camera),O.stylesheet.projection!=null&&(A=O.stylesheet.projection),O.stylesheet.transition!=null&&(k=O.stylesheet.transition)}}),this.light=l,this.ambientLight=h,this.directionalLight=x,this.fog=M,w===null?delete this.terrain:this.terrain=w,this.camera=L||{"camera-projection":"perspective"},this.projection=A||{name:"mercator"},this.transition=s.ak({},Do,k),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(l){const h=x=>{for(const w of x.fragments)h(w.style);l(x)};h(this)}_prioritizeTerrain(l,h,x){const w=l&&l.drapeRenderMode===0;return x===null?h&&h.drapeRenderMode===0?h:w?l:null:h!=null&&(!l||w||h&&h.drapeRenderMode===1)?h:l}mergeTerrain(){let l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(h=>{l=this._prioritizeTerrain(l,h.terrain,h.stylesheet.terrain)}),l===null?delete this.terrain:this.terrain=l}mergeProjection(){let l;this.forEachFragmentStyle(h=>{h.stylesheet.projection!=null&&(l=h.stylesheet.projection)}),this.projection=l||{name:"mercator"}}mergeSources(){const l={},h={},x={};this.forEachFragmentStyle(w=>{for(const M in w._sourceCaches){const A=s.aE(M,w.scope);l[A]=w._sourceCaches[M]}for(const M in w._otherSourceCaches){const A=s.aE(M,w.scope);h[A]=w._otherSourceCaches[M]}for(const M in w._symbolSourceCaches){const A=s.aE(M,w.scope);x[A]=w._symbolSourceCaches[M]}}),this._mergedSourceCaches=l,this._mergedOtherSourceCaches=h,this._mergedSymbolSourceCaches=x}mergeLayers(){const l={},h=[],x={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(M=>{for(const A of M._order){const k=M._layers[A];if(k.type==="slot"){const L=s.cq(A);if(l[L])continue;l[L]=[]}k.slot&&l[k.slot]?l[k.slot].push(k):h.push(k)}}),this._mergedOrder=[];const w=(M=[])=>{for(const A of M)if(A.type==="slot"){const k=s.cq(A.id);l[k]&&w(l[k])}else{const k=s.aE(A.id,A.scope);this._mergedOrder.push(k),x[k]=A,A.is3D()&&(this._has3DLayers=!0),A.type==="circle"&&(this._hasCircleLayers=!0),A.type==="symbol"&&(this._hasSymbolLayers=!0)}};w(h),this._mergedLayers=x,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(l){return this.stylesheet.camera=s.ak({},this.stylesheet.camera,l),this.camera=this.stylesheet.camera,this}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(l){this._spriteRequest=function(h,x,w){let M,A,k;const L=s.a4.devicePixelRatio>1?"@2x":"";let O=s.a1(x.transformRequest(x.normalizeSpriteURL(h,L,".json"),s.a2.SpriteJSON),(H,q)=>{O=null,k||(k=H,M=q,j())}),N=s.a3(x.transformRequest(x.normalizeSpriteURL(h,L,".png"),s.a2.SpriteImage),(H,q)=>{N=null,k||(k=H,A=q,j())});function j(){if(k)w(k);else if(M&&A){const H=s.a4.getImageData(A),q={};for(const Y in M){const{width:J,height:K,x:X,y:oe,sdf:de,pixelRatio:fe,stretchX:ne,stretchY:ae,content:me}=M[Y],xe=new s.a5({width:J,height:K});s.a5.copy(H,xe,{x:X,y:oe},{x:0,y:0},{width:J,height:K}),q[Y]={data:xe,pixelRatio:fe,sdf:de,stretchX:ne,stretchY:ae,content:me}}w(null,q)}}return{cancel(){O&&(O.cancel(),O=null),N&&(N.cancel(),N=null)}}}(l,this.map._requestManager,(h,x)=>{if(this._spriteRequest=null,h)this.fire(new s.a7(h));else if(x)for(const w in x)this.imageManager.addImage(w,this.scope,x[w]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.a8("data",{dataType:"style"}))})}_validateLayer(l){const h=this.getOwnSource(l.source);if(!h)return;const x=l.sourceLayer;x&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(x)===-1)&&this.fire(new s.a7(new Error(`Source layer "${x}" does not exist on source "${h.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:l}of this.fragments)if(!l.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((l,h)=>{const x=this.fragments[h];return x&&x.style&&(l.data=x.style.serialize()),l})}_serializeSources(){const l={};for(const h in this._sourceCaches){const x=this._sourceCaches[h].getSource();l[x.id]||(l[x.id]=x.serialize())}return l}_serializeLayers(l){const h=[];for(const x of l){const w=this._layers[x];w&&w.type!=="custom"&&h.push(w.serialize())}return h}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(l){return!!this.terrain&&(typeof l.isLayerDraped=="function"?l.isLayerDraped(this.getLayerSourceCache(l)):Zl.has(l.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(l){const h=this.getOwnLayer(l);if(h)return h;this.fire(new s.a7(new Error(`The layer '${l}' does not exist in the map's style.`)))}_checkSource(l){const h=this.getOwnSource(l);if(h)return h;this.fire(new s.a7(new Error(`The source '${l}' does not exist in the map's style.`)))}update(l){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(l),this.directionalLight&&this.directionalLight.recalculate(l);const h=this.calculateLightsBrightness();l.brightness=h||0,h!==this._brightness&&(this._brightness=h,this.dispatcher.broadcast("setBrightness",h));const x=this._changes.isDirty();if(this._changes.isDirty()){const M=this._changes.getLayerUpdatesByScope();for(const A in M){const{updatedIds:k,removedIds:L}=M[A];(k||L)&&this._updateWorkerLayers(A,k,L)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(l),this.light&&this.light.updateTransitions(l),this.ambientLight&&this.ambientLight.updateTransitions(l),this.directionalLight&&this.directionalLight.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._changes.reset()}const w={};for(const M in this._mergedSourceCaches){const A=this._mergedSourceCaches[M];w[M]=A.used,A.used=!1}for(const M of this._mergedOrder){const A=this._mergedLayers[M];if(A.recalculate(l,this._availableImages),!A.isHidden(l.zoom)){const k=this.getLayerSourceCache(A);k&&(k.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let k=A.minzoom||0;k<(A.maxzoom||25.5);k++){const L=this.map.painter;if(L){const O=A.getProgramIds();if(!O)continue;for(const N of O){const j=A.getDefaultProgramParams(N,l.zoom);j&&(L.style=this,this.fog&&(L._fogVisible=!0,j.overrideFog=!0,L.getOrCreateProgram(N,j)),L._fogVisible=!1,j.overrideFog=!1,L.getOrCreateProgram(N,j),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(j.overrideRtt=!0,L.getOrCreateProgram(N,j)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const M in w){const A=this._mergedSourceCaches[M];w[M]!==A.used&&A.getSource().fire(new s.a8("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light&&this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),x&&this.fire(new s.a8("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=this._changes.getUpdatedImages();if(l.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],l);this._changes.resetUpdatedImages()}}_updateWorkerLayers(l,h,x){const w=this.getFragmentStyle(l);w&&this.dispatcher.broadcast("updateLayers",{layers:h?w._serializeLayers(h):[],scope:l,removedIds:x||[],options:w.options})}setState(l){if(this._checkLoaded(),pa(this,s.aj(l)))return!1;(l=s.co(l)).layers=ia(l.layers);const h=function(w,M){if(!w)return[{command:et.setStyle,args:[M]}];let A=[];try{if(!S(w.version,M.version))return[{command:et.setStyle,args:[M]}];S(w.center,M.center)||A.push({command:et.setCenter,args:[M.center]}),S(w.zoom,M.zoom)||A.push({command:et.setZoom,args:[M.zoom]}),S(w.bearing,M.bearing)||A.push({command:et.setBearing,args:[M.bearing]}),S(w.pitch,M.pitch)||A.push({command:et.setPitch,args:[M.pitch]}),S(w.sprite,M.sprite)||A.push({command:et.setSprite,args:[M.sprite]}),S(w.glyphs,M.glyphs)||A.push({command:et.setGlyphs,args:[M.glyphs]}),S(w.imports,M.imports)||function(j=[],H=[],q){H=H||[];const Y=(j=j||[]).map(na),J=H.map(na),K=j.reduce(Mo,{}),X=H.reduce(Mo,{}),oe=Y.slice();let de,fe,ne,ae;for(de=0,fe=0;de<Y.length;de++)ne=Y[de],X.hasOwnProperty(ne)?fe++:(q.push({command:et.removeImport,args:[ne]}),oe.splice(oe.indexOf(ne,fe),1));for(de=0,fe=0;de<J.length;de++)ne=J[J.length-1-de],oe[oe.length-1-de]!==ne&&(K.hasOwnProperty(ne)?(q.push({command:et.removeImport,args:[ne]}),oe.splice(oe.lastIndexOf(ne,oe.length-fe),1)):fe++,ae=oe[oe.length-de],q.push({command:et.addImport,args:[X[ne],ae]}),oe.splice(oe.length-de,0,ne));for(const me of H){const xe=K[me.id];if(!xe||S(xe,me))continue;S(xe.config,me.config)||q.push({command:et.setImportConfig,args:[me.id,me.config]}),S(xe.url,me.url)||q.push({command:et.setImportUrl,args:[me.id,me.url]});const _e=me.data;S(xe&&xe.data,_e)||q.push({command:et.setImportData,args:[me.id,_e]})}}(w.imports,M.imports,A),S(w.transition,M.transition)||A.push({command:et.setTransition,args:[M.transition]}),S(w.light,M.light)||A.push({command:et.setLight,args:[M.light]}),S(w.fog,M.fog)||A.push({command:et.setFog,args:[M.fog]}),S(w.projection,M.projection)||A.push({command:et.setProjection,args:[M.projection]}),S(w.lights,M.lights)||A.push({command:et.setLights,args:[M.lights]}),S(w.camera,M.camera)||A.push({command:et.setCamera,args:[M.camera]});const k={},L=[];(function(j,H,q,Y){let J;for(J in H=H||{},j=j||{})j.hasOwnProperty(J)&&(H.hasOwnProperty(J)||Oi(J,q,Y));for(J in H){if(!H.hasOwnProperty(J))continue;const K=H[J];j.hasOwnProperty(J)?S(j[J],K)||(j[J].type==="geojson"&&K.type==="geojson"&&Za(j,H,J)?q.push({command:et.setGeoJSONSourceData,args:[J,K.data]}):os(J,H,q,Y)):Li(J,H,q)}})(w.sources,M.sources,L,k);const O=[];w.layers&&w.layers.forEach(j=>{j.source&&k[j.source]?A.push({command:et.removeLayer,args:[j.id]}):O.push(j)});let N=w.terrain;N&&k[N.source]&&(A.push({command:et.setTerrain,args:[void 0]}),N=void 0),A=A.concat(L),S(N,M.terrain)||A.push({command:et.setTerrain,args:[M.terrain]}),function(j,H,q){H=H||[];const Y=(j=j||[]).map(na),J=H.map(na),K=j.reduce(Mo,{}),X=H.reduce(Mo,{}),oe=Y.slice(),de=Object.create(null);let fe,ne,ae,me,xe,_e,be;for(fe=0,ne=0;fe<Y.length;fe++)ae=Y[fe],X.hasOwnProperty(ae)?ne++:(q.push({command:et.removeLayer,args:[ae]}),oe.splice(oe.indexOf(ae,ne),1));for(fe=0,ne=0;fe<J.length;fe++)ae=J[J.length-1-fe],oe[oe.length-1-fe]!==ae&&(K.hasOwnProperty(ae)?(q.push({command:et.removeLayer,args:[ae]}),oe.splice(oe.lastIndexOf(ae,oe.length-ne),1)):ne++,_e=oe[oe.length-fe],q.push({command:et.addLayer,args:[X[ae],_e]}),oe.splice(oe.length-fe,0,ae),de[ae]=!0);for(fe=0;fe<J.length;fe++)if(ae=J[fe],me=K[ae],xe=X[ae],!de[ae]&&!S(me,xe))if(S(me.source,xe.source)&&S(me["source-layer"],xe["source-layer"])&&S(me.type,xe.type)){for(be in ki(me.layout,xe.layout,q,ae,null,et.setLayoutProperty),ki(me.paint,xe.paint,q,ae,null,et.setPaintProperty),S(me.slot,xe.slot)||q.push({command:et.setSlot,args:[ae,xe.slot]}),S(me.filter,xe.filter)||q.push({command:et.setFilter,args:[ae,xe.filter]}),S(me.minzoom,xe.minzoom)&&S(me.maxzoom,xe.maxzoom)||q.push({command:et.setLayerZoomRange,args:[ae,xe.minzoom,xe.maxzoom]}),me)me.hasOwnProperty(be)&&be!=="layout"&&be!=="paint"&&be!=="filter"&&be!=="metadata"&&be!=="minzoom"&&be!=="maxzoom"&&be!=="slot"&&(be.indexOf("paint.")===0?ki(me[be],xe[be],q,ae,be.slice(6),et.setPaintProperty):S(me[be],xe[be])||q.push({command:et.setLayerProperty,args:[ae,be,xe[be]]}));for(be in xe)xe.hasOwnProperty(be)&&!me.hasOwnProperty(be)&&be!=="layout"&&be!=="paint"&&be!=="filter"&&be!=="metadata"&&be!=="minzoom"&&be!=="maxzoom"&&be!=="slot"&&(be.indexOf("paint.")===0?ki(me[be],xe[be],q,ae,be.slice(6),et.setPaintProperty):S(me[be],xe[be])||q.push({command:et.setLayerProperty,args:[ae,be,xe[be]]}))}else q.push({command:et.removeLayer,args:[ae]}),_e=oe[oe.lastIndexOf(ae)+1],q.push({command:et.addLayer,args:[xe,_e]})}(O,M.layers,A)}catch(k){console.warn("Unable to compute style diff:",k),A=[{command:et.setStyle,args:[M]}]}return A}(this.serialize(),l).filter(w=>!(w.command in kp));if(h.length===0)return!1;const x=h.filter(w=>!(w.command in Ip));if(x.length>0)throw new Error(`Unimplemented: ${x.map(w=>w.command).join(", ")}.`);return h.forEach(w=>{this[w.command].apply(this,w.args)}),this.stylesheet=l,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(l,h){return this.getImage(l)?this.fire(new s.a7(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,this.scope,h),this._afterImageUpdated(l),this)}updateImage(l,h){this.imageManager.updateImage(l,this.scope,h)}getImage(l){return this.imageManager.getImage(l,this.scope)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l,this.scope),this._afterImageUpdated(l),this):this.fire(new s.a7(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(l),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new s.a8("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(l,h,x={}){return this._checkLoaded(),this._validate(s.cr,`models.${l}`,h,null,x)||(this.modelManager.addModel(l,h,this.scope),this._changes.setDirty()),this}hasModel(l){return this.modelManager.hasModel(l,this.scope)}removeModel(l){return this.hasModel(l)?(this.modelManager.removeModel(l,this.scope),this):this.fire(new s.a7(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(l,h,x={}){if(this._checkLoaded(),this.getOwnSource(l)!==void 0)throw new Error(`There is already a source with ID "${l}".`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(s.cs,`sources.${l}`,h,null,x))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const w=bs(l,h,this.dispatcher,this);w.scope=this.scope,w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(w.id),source:w.serialize(),sourceId:w.id}));const M=A=>{const k=(A?"symbol:":"other:")+w.id,L=s.aE(k,this.scope),O=this._sourceCaches[k]=new s.bq(L,w,A);(A?this._symbolSourceCaches:this._otherSourceCaches)[w.id]=O,O.onAdd(this.map)};M(!1),h.type!=="vector"&&h.type!=="geojson"||M(!0),w.onAdd&&w.onAdd(this.map),x.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(l){this._checkLoaded();const h=this.getOwnSource(l);if(!h)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===l)return this.fire(new s.a7(new Error(`Source "${l}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===l)return this.fire(new s.a7(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));const x=this.getOwnSourceCaches(l);for(const w of x){const M=s.cq(w.id);delete this._sourceCaches[M],this._changes.discardSourceCacheUpdate(w.id),w.fire(new s.a8("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles()}return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],this.mergeSources(),h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(l,h){this._checkLoaded(),this.getOwnSource(l).setData(h),this._changes.setDirty()}getOwnSource(l){const h=this.getOwnSourceCache(l);return h&&h.getSource()}getOwnSources(){const l=[];for(const h in this._otherSourceCaches){const x=this.getOwnSourceCache(h);x&&l.push(x.getSource())}return l}areTilesLoaded(){const l=this._mergedSourceCaches;for(const h in l){const x=l[h]._tiles;for(const w in x){const M=x[w];if(M.state!=="loaded"&&M.state!=="errored")return!1}}return!0}setLights(l){if(this._checkLoaded(),!l)return delete this.ambientLight,void delete this.directionalLight;const h=this._getTransitionParameters();for(const w of l){if(this._validate(s.ct,"lights",w))return;switch(w.type){case"ambient":if(this.ambientLight){const M=this.ambientLight;M.set(w),M.updateTransitions(h)}else this.ambientLight=new zl(w,$o,this.scope,this.options);break;case"directional":if(this.directionalLight){const M=this.directionalLight;M.set(w),M.updateTransitions(h)}else this.directionalLight=new zl(w,tp,this.scope,this.options)}}const x=new s.al(this.z||0,h);this.ambientLight&&this.ambientLight.recalculate(x),this.directionalLight&&this.directionalLight.recalculate(x),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const l=this.directionalLight,h=this.ambientLight;if(!l||!h)return;const x=j=>.2126*(j[0]<=.03928?j[0]/12.92:Math.pow((j[0]+.055)/1.055,2.4))+.7152*(j[1]<=.03928?j[1]/12.92:Math.pow((j[1]+.055)/1.055,2.4))+.0722*(j[2]<=.03928?j[2]/12.92:Math.pow((j[2]+.055)/1.055,2.4)),w=l.properties.get("color").toArray01(),M=l.properties.get("intensity"),A=l.properties.get("direction"),k=1-s.b3(A.x,A.y,A.z)[2]/90,L=x(w)*M*k,O=h.properties.get("color").toArray01(),N=h.properties.get("intensity");return(L+x(O)*N)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const l=[];return this.directionalLight&&l.push(this.directionalLight.get()),this.ambientLight&&l.push(this.ambientLight.get()),l}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(l){if(!l)return this;if(s.cu(l)){const h=s.cv(l),x=this.fragments.find(({id:M})=>M===h);if(!x)throw new Error(`Style import not found: ${l}`);const w=s.cq(l);return x.style.getFragmentStyle(w)}{const h=this.fragments.find(({id:x})=>x===l);if(!h)throw new Error(`Style import not found: ${l}`);return h.style}}getConfigProperty(l,h){const x=this.getFragmentStyle(l);if(!x)return null;const w=s.aE(h,x.scope),M=x.options.get(w),A=M?M.value||M.default:null;return A?A.serialize():null}setConfigProperty(l,h,x){const w=s.cw(x);if(w.result!=="success")return void pa(this,w.value);const M=w.value.expression,A=this.getFragmentStyle(l);if(!A)return;const k=s.aE(h,A.scope),L=A.options.get(k);L&&(this.options.set(k,{...L,value:M}),this.updateConfigDependencies())}setConfig(l,h){if(this._config=l,l||h)if(h)for(const x in h){let w,M;const A=s.cw(h[x].default);if(A.result==="success"&&(w=A.value.expression),l&&l[x]!==void 0){const H=s.cw(l[x]);H.result==="success"&&(M=H.value.expression)}const{minValue:k,maxValue:L,stepValue:O,type:N,values:j}=h[x];if(w){const H=s.aE(x,this.scope);this.options.set(H,{default:w,value:M,minValue:k,maxValue:L,stepValue:O,type:N,values:j})}else this.fire(new s.a7(new Error(`No schema defined for config option "${x}".`)))}else this.fire(new s.a7(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const l of this._configDependentLayers){const h=this.getLayer(l);h&&(h.possiblyEvaluateVisibility(),this._updateLayer(h))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this._changes.setDirty()}addLayer(l,h,x={}){this._checkLoaded();const w=l.id;if(this._layers[w])return void this.fire(new s.a7(new Error(`Layer with id "${w}" already exists on this map`)));let M;if(l.type==="custom"){if(pa(this,s.cx(l)))return;M=s.cp(l,this.scope,this.options)}else{if(typeof l.source=="object"&&(this.addSource(w,l.source),l=s.co(l),l=s.ak(l,{source:w})),this._validate(s.cy,`layers.${w}`,l,{arrayIndex:-1},x))return;M=s.cp(l,this.scope,this.options),this._validateLayer(M),M.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[M.id]=M.serialize()}M.isConfigDependent&&this._configDependentLayers.add(M.fqid);let A=this._order.length;if(h){const N=this._order.indexOf(h);if(N===-1)return void this.fire(new s.a7(new Error(`Layer with id "${h}" does not exist on this map.`)));M.slot===this._layers[h].slot?A=N:s.X(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(A,0,w),this._layerOrderChanged=!0,this._layers[w]=M;const k=this.getOwnLayerSourceCache(M),L=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&M.canCastShadows()&&L&&(k.castsShadows=!0);const O=this._changes.getRemovedLayer(M);if(O&&M.source&&k&&M.type!=="custom"){this._changes.discardLayerRemoval(M);const N=s.aE(M.source,M.scope);O.type!==M.type?this._changes.updateSourceCache(N,"clear"):(this._changes.updateSourceCache(N,"reload"),k.pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map),M.scope=this.scope,this.mergeLayers()}moveLayer(l,h){this._checkLoaded();const x=this._checkLayer(l);if(!x||l===h)return;const w=this._order.indexOf(l);this._order.splice(w,1);let M=this._order.length;if(h){const A=this._order.indexOf(h);if(A===-1)return void this.fire(new s.a7(new Error(`Layer with id "${h}" does not exist on this map.`)));x.slot===this._layers[h].slot?M=A:s.X(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(M,0,l),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(l){this._checkLoaded();const h=this._checkLayer(l);if(!h)return;h.setEventedParent(null);const x=this._order.indexOf(l);this._order.splice(x,1),delete this._layers[l],delete this._serializedLayers[l],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(h.fqid),this._changes.removeLayer(h);const w=this.getOwnLayerSourceCache(h);if(w&&w.castsShadows){let M=!1;for(const A in this._layers)if(this._layers[A].source===h.source&&this._layers[A].canCastShadows()){M=!0;break}w.castsShadows=M}h.onRemove&&h.onRemove(this.map),this.mergeLayers()}getOwnLayer(l){return this._layers[l]}hasLayer(l){return l in this._mergedLayers}hasLayerType(l){for(const h in this._layers)if(this._layers[h].type===l)return!0;return!1}setLayerZoomRange(l,h,x){this._checkLoaded();const w=this._checkLayer(l);w&&(w.minzoom===h&&w.maxzoom===x||(h!=null&&(w.minzoom=h),x!=null&&(w.maxzoom=x),this._updateLayer(w)))}setSlot(l,h){this._checkLoaded();const x=this._checkLayer(l);x&&x.slot!==h&&(x.slot=h,this._updateLayer(x))}setFilter(l,h,x={}){this._checkLoaded();const w=this._checkLayer(l);if(w&&!S(w.filter,h))return h==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(s.cz,`layers.${w.id}.filter`,h,{layerType:w.type},x)||(w.filter=s.co(h),this._updateLayer(w)))}getFilter(l){const h=this._checkLayer(l);if(h)return s.co(h.filter)}setLayoutProperty(l,h,x,w={}){this._checkLoaded();const M=this._checkLayer(l);M&&(S(M.getLayoutProperty(h),x)||(M.setLayoutProperty(h,x,w),M.isConfigDependent&&this._configDependentLayers.add(M.fqid),this._updateLayer(M)))}getLayoutProperty(l,h){const x=this._checkLayer(l);if(x)return x.getLayoutProperty(h)}setPaintProperty(l,h,x,w={}){this._checkLoaded();const M=this._checkLayer(l);if(!M||S(M.getPaintProperty(h),x))return;const A=M.setPaintProperty(h,x,w);M.isConfigDependent&&this._configDependentLayers.add(M.fqid),A&&this._updateLayer(M),this._changes.updatePaintProperties(M)}getPaintProperty(l,h){const x=this._checkLayer(l);if(x)return x.getPaintProperty(h)}setFeatureState(l,h){this._checkLoaded();const x=l.source,w=l.sourceLayer,M=this._checkSource(x);if(!M)return;const A=M.type;if(A==="geojson"&&w)return void this.fire(new s.a7(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(A==="vector"&&!w)return void this.fire(new s.a7(new Error("The sourceLayer parameter must be provided for vector source types.")));l.id===void 0&&this.fire(new s.a7(new Error("The feature id parameter must be provided.")));const k=this.getOwnSourceCaches(x);for(const L of k)L.setFeatureState(w,l.id,h)}removeFeatureState(l,h){this._checkLoaded();const x=l.source,w=this._checkSource(x);if(!w)return;const M=w.type,A=M==="vector"?l.sourceLayer:void 0;if(M==="vector"&&!A)return void this.fire(new s.a7(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof l.id!="string"&&typeof l.id!="number")return void this.fire(new s.a7(new Error("A feature id is required to remove its specific state property.")));const k=this.getOwnSourceCaches(x);for(const L of k)L.removeFeatureState(A,l.id,h)}getFeatureState(l){this._checkLoaded();const h=l.source,x=l.sourceLayer,w=this._checkSource(h);if(w){if(w.type!=="vector"||x)return l.id===void 0&&this.fire(new s.a7(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(h)[0].getFeatureState(x,l.id);this.fire(new s.a7(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(l){return this.stylesheet.transition=s.ak({},this.stylesheet.transition,l),this.transition=this.stylesheet.transition,this}getTransition(){return s.ak({},this.stylesheet.transition)}serialize(){this._checkLoaded();const l=this.getTerrain(),h=l&&this.terrain&&this.terrain.scope===this.scope?l:this.stylesheet.terrain;return s.cA({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:h,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},x=>x!==void 0)}_updateLayer(l){this._changes.updateLayer(l);const h=this.getLayerSourceCache(l),x=s.aE(l.source,l.scope),w=this._changes.getUpdatedSourceCaches();l.source&&!w[x]&&h&&h.getSource().type!=="raster"&&(this._changes.updateSourceCache(x,"reload"),h.pause()),l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const h=k=>this._mergedLayers[k].type==="fill-extrusion",x=this.order,w={},M=[];for(let k=x.length-1;k>=0;k--){const L=x[k];if(h(L)){w[L]=k;for(const O of l){const N=O[L];if(N)for(const j of N)M.push(j)}}}M.sort((k,L)=>L.intersectionZ-k.intersectionZ);const A=[];for(let k=x.length-1;k>=0;k--){const L=x[k];if(h(L))for(let O=M.length-1;O>=0;O--){const N=M[O].feature;if(w[N.layer.id]<k)break;A.push(N),M.pop()}else for(const O of l){const N=O[L];if(N)for(const j of N)A.push(j.feature)}}return A}queryRenderedFeatures(l,h,x){h&&h.filter&&this._validate(s.cz,"queryRenderedFeatures.filter",h.filter,null,h),h.scope=this.scope,h.availableImages=this._availableImages,h.serializedLayers=this._serializedLayers;const w={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new s.a7(new Error("parameters.layers must be an Array."))),[];for(const O of h.layers){const N=this._mergedLayers[O];if(!N)return this.fire(new s.a7(new Error(`The layer '${O}' does not exist in the map's style and cannot be queried for features.`))),[];w[N.source]=!0}}const M=[],A=h.serializedLayers||{},k=h&&h.layers?h.layers.some(O=>{const N=this.getLayer(O);return N&&N.is3D()}):this.has3DLayers(),L=Cr.createFromScreenPoints(l,x);for(const O in this._mergedSourceCaches){const N=this._mergedSourceCaches[O].getSource();if(!N||N.scope!==h.scope)continue;const j=this._mergedSourceCaches[O].getSource().id;h.layers&&!w[j]||M.push(to(this._mergedSourceCaches[O],this._mergedLayers,A,L,h,x,k,!!this.map._showQueryGeometry))}return this.placement&&M.push(function(O,N,j,H,q,Y,J){const K={},X=Y.queryRenderedSymbols(H),oe=[];for(const de of Object.keys(X).map(Number))oe.push(J[de]);oe.sort(ws);for(const de of oe){const fe=de.featureIndex.lookupSymbolFeatures(X[de.bucketInstanceId],N,de.bucketIndex,de.sourceLayerIndex,q.filter,q.layers,q.availableImages,O);for(const ne in fe){const ae=K[ne]=K[ne]||[],me=fe[ne];me.sort((xe,_e)=>{const be=de.featureSortOrder;if(be){const Ue=be.indexOf(xe.featureIndex);return be.indexOf(_e.featureIndex)-Ue}return _e.featureIndex-xe.featureIndex});for(const xe of me)ae.push(xe)}}for(const de in K)K[de].forEach(fe=>{const ne=fe.feature,ae=j(O[de]);if(!ae)return;const me=ae.getFeatureState(ne.layer["source-layer"],ne.id);ne.source=ne.layer.source,ne.layer["source-layer"]&&(ne.sourceLayer=ne.layer["source-layer"]),ne.state=me});return K}(this._mergedLayers,A,this.getLayerSourceCache.bind(this),L.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(M)}querySourceFeatures(l,h){h&&h.filter&&this._validate(s.cz,"querySourceFeatures.filter",h.filter,null,h);const x=this.getOwnSourceCaches(l);let w=[];for(const M of x)w=w.concat(D_(M,h));return w}addSourceType(l,h,x){return cs.getSourceType(l)?x(new Error(`A source type called "${l}" already exists.`)):(cs.setSourceType(l,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:h.workerSourceURL},x):x(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(l,h,x={}){this._checkLoaded();const w=this.light.getLight();let M=!1;for(const k in l)if(!S(l[k],w[k])){M=!0;break}if(!M)return;const A=this._getTransitionParameters();this.light.setLight(l,h,x),this.light.updateTransitions(A)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(l,h=1){if(this._checkLoaded(),!l)return delete this.terrain,l===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let x=l;const w=l.source==null;if(h===1){if(typeof x.source=="object"){const k="terrain-dem-src";this.addSource(k,x.source),x=s.co(x),x=s.ak(x,{source:k})}const M=s.ak({},x),A={};if(this.terrain&&w){M.source=this.terrain.get().source;const k=this.terrain?this.getFragmentStyle(this.terrain.scope):null;k&&(A.style=k.serialize())}if(this._validate(s.cB,"terrain",M,A))return}if(!this.terrain||this.terrain.scope!==this.scope&&!w||this.terrain&&h!==this.terrain.drapeRenderMode){if(!x)return;this._createTerrain(x,h),this.fire(new s.a8("data",{dataType:"style"}))}else{const M=this.terrain,A=M.get();for(const k of Object.keys(s.ae.terrain))!x.hasOwnProperty(k)&&s.ae.terrain[k].default&&(x[k]=s.ae.terrain[k].default);for(const k in l)if(!S(l[k],A[k])){M.set(l,this.options),this.stylesheet.terrain=l;const L=this._getTransitionParameters({duration:0});M.updateTransitions(L),this.fire(new s.a8("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const h=this.fog=new _h(l,this.map.transform);this.stylesheet.fog=h.get();const x=this._getTransitionParameters({duration:0});h.updateTransitions(x)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog;if(!S(h.get(),l)){h.set(l),this.stylesheet.fog=h.get();const x=this._getTransitionParameters({duration:0});h.updateTransitions(x)}}else this._createFog(l);this._markersNeedUpdate=!0}_getTransitionParameters(l){return{now:s.a4.now(),transition:s.ak(this.transition,l)}}updateDrapeFirstLayers(){if(!this.terrain)return;const l=[],h=[];for(const x in this._mergedLayers)this.isLayerDraped(this._mergedLayers[x])?l.push(x):h.push(x);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...h)}_createTerrain(l,h){const x=this.terrain=new ss(l,h,this.scope,this.options);h===1&&(this.stylesheet.terrain=l),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const w=this._getTransitionParameters({duration:0});x.updateTransitions(w)}_force3DLayerUpdate(){for(const l in this._layers){const h=this._layers[l];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const h=this._layers[l];h.type==="symbol"&&this._updateLayer(h)}}_validate(l,h,x,w,M={}){if(M&&M.validate===!1)return!1;const A=s.ak({},this.serialize());return pa(this,l.call(s.aj,s.ak({key:h,style:A,value:x,styleSpec:s.ae},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.cC.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._mergedLayers)this._mergedLayers[l].setEventedParent(null);for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles(),this._mergedSourceCaches[l].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(l){const h=this.getSourceCaches(l);for(const x of h)x.clearTiles()}clearSources(){for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles()}reloadSource(l){const h=this.getSourceCaches(l);for(const x of h)x.resume(),x.reload()}reloadSources(){for(const l of this.getSources())l.reload&&l.reload()}updateSources(l){let h;this.directionalLight&&(h=ed(this.directionalLight));for(const x in this._mergedSourceCaches)this._mergedSourceCaches[x].update(l,void 0,void 0,h)}_generateCollisionBoxes(){for(const l in this._sourceCaches){const h=this._sourceCaches[l];h.resume(),h.reload()}}_updatePlacement(l,h,x,w,M=!1){let A=!1,k=!1;const L={},O={};for(const N of this._mergedOrder){const j=this._mergedLayers[N];if(j.type!=="symbol")continue;const H=s.aE(j.source,j.scope);let q=L[H];if(!q){const J=this.getLayerSourceCache(j);if(!J)continue;const K=J.getRenderableIds(!0).map(X=>J.getTileByID(X));O[H]=K.slice(),q=L[H]=K.sort((X,oe)=>oe.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(oe.tileID)?-1:1))}const Y=this.crossTileSymbolIndex.addLayer(j,q,l.center.lng,l.projection);A=A||Y}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),M=M||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new s.a8("neworder")),(M||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.a4.now(),l.zoom))&&(this.pauseablePlacement=new Sh(l,this._mergedOrder,M,h,x,w,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,L,O),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.a4.now()),k=!0),A&&this.pauseablePlacement.placement.setStale()),k||A)for(const N of this._mergedOrder){const j=this._mergedLayers[N];j.type==="symbol"&&this.placement.updateLayerOpacities(j,L[s.aE(j.source,j.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.a4.now())}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}addImport(l){this._checkLoaded();const h=this.stylesheet.imports=this.stylesheet.imports||[];return h.findIndex(({id:x})=>x===l.id)!==-1?this.fire(new s.a7(new Error(`Import with id '${l.id}' already exists in the map's style.`))):(h.push(l),this._loadImports([l],!0),this)}setImportUrl(l,h){this._checkLoaded();const x=this.stylesheet.imports||[],w=this.getImportIndex(l);if(w===-1)return this;x[w].url=h;const M=this.fragments[w];return M.style=this._createFragmentStyle(x[w]),M.style.on("style.import.load",()=>this.mergeAll()),M.style.loadURL(h),this}setImportData(l,h){this._checkLoaded();const x=this.getImportIndex(l),w=this.stylesheet.imports||[];return x===-1?this:h?(this.fragments[x].style.setState(h),this._reloadImports(),this):(delete w[x].data,this.setImportUrl(l,w[x].url))}setImportConfig(l,h){this._checkLoaded();const x=this.getImportIndex(l),w=this.stylesheet.imports||[];if(x===-1)return this;h?w[x].config=h:delete w[x].config;const M=this.fragments[x],A=M.style.stylesheet&&M.style.stylesheet.schema;return M.config=h,M.style.setConfig(h,A),this.updateConfigDependencies(),this}removeImport(l){this._checkLoaded();const h=this.stylesheet.imports||[],x=this.getImportIndex(l);return x===-1||(h.splice(x,1),this.fragments[x].style._remove(),this.fragments.splice(x,1),this._reloadImports()),this}getImportIndex(l){const h=(this.stylesheet.imports||[]).findIndex(x=>x.id===l);return h===-1&&this.fire(new s.a7(new Error(`Import '${l}' does not exist in the map's style and cannot be updated.`))),h}getLayer(l){return this._mergedLayers[l]}getSources(){const l=[];for(const h in this._mergedOtherSourceCaches){const x=this._mergedOtherSourceCaches[h];x&&l.push(x.getSource())}return l}getSource(l,h){const x=this.getSourceCache(l,h);return x&&x.getSource()}getLayerSource(l){const h=this.getLayerSourceCache(l);return h&&h.getSource()}getSourceCache(l,h){const x=s.aE(l,h);return this._mergedOtherSourceCaches[x]}getLayerSourceCache(l){const h=s.aE(l.source,l.scope);return l.type==="symbol"?this._mergedSymbolSourceCaches[h]:this._mergedOtherSourceCaches[h]}getSourceCaches(l){const h=[];return this._mergedOtherSourceCaches[l]&&h.push(this._mergedOtherSourceCaches[l]),this._mergedSymbolSourceCaches[l]&&h.push(this._mergedSymbolSourceCaches[l]),h}updateSourceCaches(){const l=this._changes.getUpdatedSourceCaches();for(const h in l){const x=l[h];x==="reload"?this.reloadSource(h):x==="clear"&&this.clearSource(h)}}updateLayers(l){const h=this._changes.getUpdatedPaintProperties();for(const x of h){const w=this.getLayer(x);w&&w.updateTransitions(l)}}getImages(l,h,x){this.imageManager.getImages(h.icons,h.scope,x),this._updateTilesForChangedImages();const w=M=>{M&&M.setDependencies(h.tileID.key,h.type,h.icons)};w(this._otherSourceCaches[h.source]),w(this._symbolSourceCaches[h.source])}getGlyphs(l,h,x){this.glyphManager.getGlyphs(h.stacks,h.scope,x)}getResource(l,h,x){return s.cD(h,x)}getOwnSourceCache(l){return this._otherSourceCaches[l]}getOwnLayerSourceCache(l){return l.type==="symbol"?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}getOwnSourceCaches(l){const h=[];return this._otherSourceCaches[l]&&h.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&h.push(this._symbolSourceCaches[l]),h}_isSourceCacheLoaded(l){const h=this.getOwnSourceCaches(l);return h.length===0?(this.fire(new s.a7(new Error(`There is no source with ID '${l}'`))),!1):h.every(x=>x.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function zo(g,l){let h=!1,x=null;const w=()=>{x=null,h&&(g(),x=setTimeout(w,l),h=!1)};return()=>(h=!0,x||w(),x)}cs.getSourceType=function(g){return Fs[g]},cs.setSourceType=function(g,l){Fs[g]=l},cs.registerForPluginStateChange=s.ci;class Cp{constructor(l){this._hashName=l&&encodeURIComponent(l),s.aR(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=zo(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const l=this._map;if(!l)return"";const h=Lo(l);if(this._hashName){const x=this._hashName;let w=!1;const M=location.hash.slice(1).split("&").map(A=>{const k=A.split("=")[0];return k===x?(w=!0,`${k}=${h}`):A}).filter(A=>A);return w||M.push(`${x}=${h}`),`#${M.join("&")}`}return`#${h}`}_getCurrentHash(){const l=location.hash.replace("#","");if(this._hashName){let h;return l.split("&").map(x=>x.split("=")).forEach(x=>{x[0]===this._hashName&&(h=x)}),(h&&h[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._map;if(!l)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(x=>isNaN(x))){const x=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(h[3]||0):l.getBearing();return l.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:x,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Lo(g,l){const h=g.getCenter(),x=Math.round(100*g.getZoom())/100,w=Math.ceil((x*Math.LN2+Math.log(512/360/.5))/Math.LN10),M=Math.pow(10,w),A=Math.round(h.lng*M)/M,k=Math.round(h.lat*M)/M,L=g.getBearing(),O=g.getPitch();let N=l?`/${A}/${k}/${x}`:`${x}/${k}/${A}`;return(L||O)&&(N+="/"+Math.round(10*L)/10),O&&(N+=`/${Math.round(O)}`),N}const Xl={linearity:.3,easing:s.cE(0,0,.3,1)},id=s.ak({deceleration:2500,maxSpeed:1400},Xl),nd=s.ak({deceleration:20,maxSpeed:1400},Xl),uu=s.ak({deceleration:1e3,maxSpeed:360},Xl),ey=s.ak({deceleration:1e3,maxSpeed:90},Xl);class Pp{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.a4.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,h=s.a4.now();for(;l.length>0&&h-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:M}of this._inertiaBuffer)h.zoom+=M.zoomDelta||0,h.bearing+=M.bearingDelta||0,h.pitch+=M.pitchDelta||0,M.panDelta&&h.pan._add(M.panDelta),M.around&&(h.around=M.around),M.pinchAround&&(h.pinchAround=M.pinchAround);const x=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(h.pan.mag()){const M=hu(h.pan.mag(),x,s.ak({},id,l||{}));w.offset=h.pan.mult(M.amount/h.pan.mag()),w.center=this._map.transform.center,Ro(w,M)}if(h.zoom){const M=hu(h.zoom,x,nd);w.zoom=this._map.transform.zoom+M.amount,Ro(w,M)}if(h.bearing){const M=hu(h.bearing,x,uu);w.bearing=this._map.transform.bearing+s.c(M.amount,-179,179),Ro(w,M)}if(h.pitch){const M=hu(h.pitch,x,ey);w.pitch=this._map.transform.pitch+M.amount,Ro(w,M)}if(w.zoom||w.bearing){const M=h.pinchAround===void 0?h.around:h.pinchAround;w.around=M?this._map.unproject(M):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function Ro(g,l){(!g.duration||g.duration<l.duration)&&(g.duration=l.duration,g.easing=l.easing)}function hu(g,l,h){const{maxSpeed:x,linearity:w,deceleration:M}=h,A=s.c(g*w/(l/1e3),-x,x),k=Math.abs(A)/(M*w);return{easing:h.easing,duration:1e3*k,amount:A*(k/2)}}class is extends s.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,x,w={}){const M=Me(h.getCanvasContainer(),x),A=h.unproject(M);super(l,s.ak({point:M,lngLat:A,originalEvent:x},w)),this._defaultPrevented=!1,this.target=h}}class Yl extends s.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,x){const w=l==="touchend"?x.changedTouches:x.touches,M=Ye(h.getCanvasContainer(),w),A=M.map(L=>h.unproject(L)),k=M.reduce((L,O,N,j)=>L.add(O.div(j.length)),new s.P(0,0));super(l,{points:M,point:k,lngLats:A,lngLat:h.unproject(k),originalEvent:x}),this._defaultPrevented=!1}}class ty extends s.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,x){super(l,{originalEvent:x}),this._defaultPrevented=!1}}class rd{constructor(l,h){this._map=l,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new ty(l.type,this._map,l))}mousedown(l,h){return this._mousedownPos=h,this._firePreventable(new is(l.type,this._map,l))}mouseup(l){this._map.fire(new is(l.type,this._map,l))}preclick(l){const h=s.ak({},l);h.type="preclick",this._map.fire(new is(h.type,this._map,h))}click(l,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(l),this._map.fire(new is(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new is(l.type,this._map,l))}mouseover(l){this._map.fire(new is(l.type,this._map,l))}mouseout(l){this._map.fire(new is(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Yl(l.type,this._map,l))}touchmove(l){this._map.fire(new Yl(l.type,this._map,l))}touchend(l){this._map.fire(new Yl(l.type,this._map,l))}touchcancel(l){this._map.fire(new Yl(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class du{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new is(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new is("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new is(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Kl{constructor(l,h){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,h){this.isEnabled()&&l.shiftKey&&l.button===0&&(ie(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(l,h){if(!this._active)return;const x=h,w=this._startPos,M=this._lastPos;if(!w||!M||M.equals(x)||!this._box&&x.dist(w)<this._clickTolerance)return;this._lastPos=x,this._box||(this._box=U("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const A=Math.min(w.x,x.x),k=Math.max(w.x,x.x),L=Math.min(w.y,x.y),O=Math.max(w.y,x.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${A}px,${L}px)`,this._box.style.width=k-A+"px",this._box.style.height=O-L+"px")})}mouseupWindow(l,h){if(!this._active)return;const x=this._startPos,w=h;if(x&&l.button===0){if(this.reset(),ke(),x.x!==w.x||x.y!==w.y)return this._map.fire(new s.a8("boxzoomend",{originalEvent:l})),{cameraAnimation:M=>M.fitScreenCoordinates(x,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ve(),delete this._startPos,delete this._lastPos}_fireEvent(l,h){return this._map.fire(new s.a8(l,{originalEvent:h}))}}function Jl(g,l){const h={};for(let x=0;x<g.length;x++)h[g[x].identifier]=l[x];return h}class Ql{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,h,x){(this.centroid||x.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=l.timeStamp),x.length===this.numTouches&&(this.centroid=function(w){const M=new s.P(0,0);for(const A of w)M._add(A);return M.div(w.length)}(h),this.touches=Jl(x,h)))}touchmove(l,h,x){if(this.aborted||!this.centroid)return;const w=Jl(x,h);for(const M in this.touches){const A=w[M];(!A||A.dist(this.touches[M])>30)&&(this.aborted=!0)}}touchend(l,h,x){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),x.length===0){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class $l{constructor(l){this.singleTap=new Ql(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,h,x){this.singleTap.touchstart(l,h,x)}touchmove(l,h,x){this.singleTap.touchmove(l,h,x)}touchend(l,h,x){const w=this.singleTap.touchend(l,h,x);if(w){const M=l.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(w)<30;if(M&&A||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class fu{constructor(){this._zoomIn=new $l({numTouches:1,numTaps:2}),this._zoomOut=new $l({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,h,x){this._zoomIn.touchstart(l,h,x),this._zoomOut.touchstart(l,h,x)}touchmove(l,h,x){this._zoomIn.touchmove(l,h,x),this._zoomOut.touchmove(l,h,x)}touchend(l,h,x){const w=this._zoomIn.touchend(l,h,x),M=this._zoomOut.touchend(l,h,x);return w?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()+1,around:A.unproject(w)},{originalEvent:l})}):M?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()-1,around:A.unproject(M)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const pu={0:1,2:2};class Hr{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,h){return!1}_move(l,h){return{}}mousedown(l,h){if(this._lastPoint)return;const x=ot(l);this._correctButton(l,x)&&(this._lastPoint=h,this._eventButton=x)}mousemoveWindow(l,h){const x=this._lastPoint;if(x){if(l.preventDefault(),this._eventButton!=null&&function(w,M){const A=pu[M];return w.buttons===void 0||(w.buttons&A)!==A}(l,this._eventButton))this.reset();else if(this._moved||!(h.dist(x)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(x,h)}}mouseupWindow(l){this._lastPoint&&ot(l)===this._eventButton&&(this._moved&&ke(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dp extends Hr{mousedown(l,h){super.mousedown(l,h),this._lastPoint&&(this._active=!0)}_correctButton(l,h){return h===0&&!l.ctrlKey}_move(l,h){return{around:h,panDelta:h.sub(l)}}}class sd extends Hr{_correctButton(l,h){return h===0&&l.ctrlKey||h===2}_move(l,h){const x=.8*(h.x-l.x);if(x)return this._active=!0,{bearingDelta:x}}contextmenu(l){l.preventDefault()}}class od extends Hr{_correctButton(l,h){return h===0&&l.ctrlKey||h===2}_move(l,h){const x=-.5*(h.y-l.y);if(x)return this._active=!0,{pitchDelta:x}}contextmenu(l){l.preventDefault()}}class ma{constructor(l,h){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),s.aR(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(l,h,x){return this._calculateTransform(l,h,x)}touchmove(l,h,x){if(this._active&&!(x.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(x.length===1&&!s.cF())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,h,x)}}touchend(l,h,x){this._calculateTransform(l,h,x),this._active&&x.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,h,x){x.length>0&&(this._active=!0);const w=Jl(x,h),M=new s.P(0,0),A=new s.P(0,0);let k=0;for(const O in w){const N=w[O],j=this._touches[O];j&&(M._add(N),A._add(N.sub(j)),k++,w[O]=N)}if(this._touches=w,k<this._minTouches||!A.mag())return;const L=A.div(k);return this._sum._add(L),this._sum.mag()<this._clickTolerance?void 0:{around:M.div(k),panDelta:L}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=U("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class mu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,h,x){return{}}touchstart(l,h,x){this._firstTwoTouches||x.length<2||(this._firstTwoTouches=[x[0].identifier,x[1].identifier],this._start([h[0],h[1]]))}touchmove(l,h,x){const w=this._firstTwoTouches;if(!w)return;l.preventDefault();const[M,A]=w,k=ga(x,h,M),L=ga(x,h,A);if(!k||!L)return;const O=this._aroundCenter?null:k.add(L).div(2);return this._move([k,L],O,l)}touchend(l,h,x){if(!this._firstTwoTouches)return;const[w,M]=this._firstTwoTouches,A=ga(x,h,w),k=ga(x,h,M);A&&k||(this._active&&ke(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ga(g,l,h){for(let x=0;x<g.length;x++)if(g[x].identifier===h)return l[x]}function gu(g,l){return Math.log(g/l)/Math.LN2}class _u extends mu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,h){const x=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(gu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:gu(this._distance,x),pinchAround:h}}}function ad(g,l){return 180*g.angleWith(l)/Math.PI}class zp extends mu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,h){const x=this._vector;if(this._vector=l[0].sub(l[1]),x&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ad(this._vector,x),pinchAround:h}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const h=25/(Math.PI*this._minDiameter)*360,x=this._startVector;if(!x)return!1;const w=ad(l,x);return Math.abs(w)<h}}function Oo(g){return Math.abs(g.y)>Math.abs(g.x)}class iy extends mu{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,Oo(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,h,x){const w=this._lastPoints;if(!w)return;const M=l[0].sub(w[0]),A=l[1].sub(w[1]);return this._map._cooperativeGestures&&!s.cF()&&x.touches.length<3||(this._valid=this.gestureBeginsVertically(M,A,x.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(M.y+A.y)/2*-.5})}gestureBeginsVertically(l,h,x){if(this._valid!==void 0)return this._valid;const w=l.mag()>=2,M=h.mag()>=2;if(!w&&!M)return;if(!w||!M)return this._firstMove==null&&(this._firstMove=x),x-this._firstMove<100&&void 0;const A=l.y>0==h.y>0;return Oo(l)&&Oo(h)&&A}}const ny={panStep:100,bearingStep:15,pitchStep:10};class Lp{constructor(){const l=ny;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let h=0,x=0,w=0,M=0,A=0;switch(l.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:l.shiftKey?x=-1:(l.preventDefault(),M=-1);break;case 39:l.shiftKey?x=1:(l.preventDefault(),M=1);break;case 38:l.shiftKey?w=1:(l.preventDefault(),A=-1);break;case 40:l.shiftKey?w=-1:(l.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(x=0,w=0),{cameraAnimation:k=>{const L=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:yu,zoom:h?Math.round(L)+h*(l.shiftKey?2:1):L,bearing:k.getBearing()+x*this._bearingStep,pitch:k.getPitch()+w*this._pitchStep,offset:[-M*this._panStep,-A*this._panStep],center:k.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function yu(g){return g*(2-g)}const xu=4.000244140625;class Rp{constructor(l,h){this._map=l,this._el=l.getCanvasContainer(),this._handler=h,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.aR(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||s.cF()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const x=s.a4.now(),w=x-(this._lastWheelEventTime||0);this._lastWheelEventTime=x,h!==0&&h%xu==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(w*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),l.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=l,this._delta-=h,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=Me(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;this._type==="wheel"&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(this._delta!==0){const O=this._type==="wheel"&&Math.abs(this._delta)>xu?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&N!==0&&(N=1/N);const j=h(),H=Math.pow(2,j),q=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):H;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(q*N))),this._type==="wheel"&&(this._startZoom=j,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const x=typeof this._targetZoom=="number"?this._targetZoom:h(),w=this._startZoom,M=this._easing;let A,k=!1;if(this._type==="wheel"&&w&&M){const O=Math.min((s.a4.now()-this._lastWheelEventTime)/200,1),N=M(O);A=s.n(w,x,N),O<1?this._frameId||(this._frameId=!0):k=!0}else A=x,k=!0;this._active=!0,k&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let L=A-h();return L*this._lastDelta<0&&(L=0),{noInertia:!0,needsRenderFrame:!k,zoomDelta:L,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let h=s.cG;if(this._prevEase){const x=this._prevEase,w=(s.a4.now()-x.start)/x.duration,M=x.easing(w+.01)-x.easing(w),A=.27/Math.sqrt(M*M+1e-4)*.01,k=Math.sqrt(.0729-A*A);h=s.cE(A,k,.25,1)}return this._prevEase={start:s.a4.now(),duration:l,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=U("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Op{constructor(l,h){this._clickZoom=l,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class vu{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,h){return l.preventDefault(),{cameraAnimation:x=>{x.easeTo({duration:300,zoom:x.getZoom()+(l.shiftKey?-1:1),around:x.unproject(h)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ld{constructor(){this._tap=new $l({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,h,x){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?x.length>0&&(this._swipePoint=h[0],this._swipeTouch=x[0].identifier):this._tap.touchstart(l,h,x))}touchmove(l,h,x){if(this._tapTime){if(this._swipePoint){if(x[0].identifier!==this._swipeTouch)return;const w=h[0],M=w.y-this._swipePoint.y;return this._swipePoint=w,l.preventDefault(),this._active=!0,{zoomDelta:M/128}}}else this._tap.touchmove(l,h,x)}touchend(l,h,x){this._tapTime?this._swipePoint&&x.length===0&&this.reset():this._tap.touchend(l,h,x)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bp{constructor(l,h,x){this._el=l,this._mousePan=h,this._touchPan=x}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Fp{constructor(l,h,x){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=h,this._mousePitch=x}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Np{constructor(l,h,x,w){this._el=l,this._touchZoom=h,this._touchRotate=x,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ec=g=>g.zoom||g.drag||g.pitch||g.rotate;class Vp extends s.a8{}class nl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,h){const x=s.v.sub([],h,l);this.radius=s.v.length(x[2]<0?s.v.div([],x,this.constants):[x[0],x[1],0])}projectRay(l){s.v.div(l,l,this.constants),s.v.normalize(l,l),s.v.mul(l,l,this.constants);const h=s.v.scale([],l,this.radius);if(h[2]>0){const x=s.v.scale([],[0,0,1],s.v.dot(h,[0,0,1])),w=s.v.scale([],s.v.normalize([],[h[0],h[1],0]),this.radius),M=s.v.add([],h,s.v.scale([],s.v.sub([],s.v.add([],w,x),h),2));h[0]=M[0],h[1]=M[1]}return h}}function tc(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class jp{constructor(l,h){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pp(l),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new nl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),s.aR(["handleEvent","handleWindowEvent"],this);const x=this._el;this._listeners=[[x,"touchstart",{passive:!0}],[x,"touchmove",{passive:!1}],[x,"touchend",void 0],[x,"touchcancel",void 0],[x,"mousedown",void 0],[x,"mousemove",void 0],[x,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[x,"mouseover",void 0],[x,"mouseout",void 0],[x,"dblclick",void 0],[x,"click",void 0],[x,"keydown",{capture:!1}],[x,"keyup",void 0],[x,"wheel",{passive:!1}],[x,"contextmenu",void 0],[window,"blur",void 0]];for(const[w,M,A]of this._listeners){const k=w===document?this.handleWindowEvent:this.handleEvent;w.addEventListener(M,k,A)}}destroy(){for(const[l,h,x]of this._listeners){const w=l===document?this.handleWindowEvent:this.handleEvent;l.removeEventListener(h,w,x)}}_addDefaultHandlers(l){const h=this._map,x=h.getCanvasContainer();this._add("mapEvent",new rd(h,l));const w=h.boxZoom=new Kl(h,l);this._add("boxZoom",w);const M=new fu,A=new vu;h.doubleClickZoom=new Op(A,M),this._add("tapZoom",M),this._add("clickZoom",A);const k=new ld;this._add("tapDragZoom",k);const L=h.touchPitch=new iy(h);this._add("touchPitch",L);const O=new sd(l),N=new od(l);h.dragRotate=new Fp(l,O,N),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]);const j=new Dp(l),H=new ma(h,l);h.dragPan=new Bp(x,j,H),this._add("mousePan",j),this._add("touchPan",H,["touchZoom","touchRotate"]);const q=new zp,Y=new _u;h.touchZoomRotate=new Np(x,Y,q,k),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),this._add("blockableMapEvent",new du(h));const J=h.scrollZoom=new Rp(h,this);this._add("scrollZoom",J,["mousePan"]);const K=h.keyboard=new Lp;this._add("keyboard",K);for(const X of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[X]&&h[X].enable(l[X])}_add(l,h,x){this._handlers.push({handlerName:l,handler:h,allowed:x}),this._handlersById[l]=h}stop(l){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ec(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,h,x){for(const w in l)if(w!==x&&(!h||h.indexOf(w)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const h=[];for(const x of l)this._el.contains(x.target)&&h.push(x);return h}handleEvent(l,h){this._updatingCamera=!0;const x=l.type==="renderFrame",w=x?void 0:l,M={needsRenderFrame:!1},A={},k={},L=l.touches?this._getMapTouches(l.touches):void 0,O=L?Ye(this._el,L):x?void 0:Me(this._el,l);for(const{handlerName:H,handler:q,allowed:Y}of this._handlers){if(!q.isEnabled())continue;let J;this._blockedByActive(k,Y,H)?q.reset():q[h||l.type]&&(J=q[h||l.type](l,O,L),this.mergeHandlerResult(M,A,J,H,w),J&&J.needsRenderFrame&&this._triggerRenderFrame()),(J||q.isActive())&&(k[H]=q)}const N={};for(const H in this._previousActiveHandlers)k[H]||(N[H]=w);this._previousActiveHandlers=k,(Object.keys(N).length||tc(M))&&(this._changes.push([M,A,N]),this._triggerRenderFrame()),(Object.keys(k).length||tc(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=M;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))}mergeHandlerResult(l,h,x,w,M){if(!x)return;s.ak(l,x);const A={handlerName:w,originalEvent:x.originalEvent||M};x.zoomDelta!==void 0&&(h.zoom=A),x.panDelta!==void 0&&(h.drag=A),x.pitchDelta!==void 0&&(h.pitch=A),x.bearingDelta!==void 0&&(h.rotate=A)}_applyChanges(){const l={},h={},x={};for(const[w,M,A]of this._changes)w.panDelta&&(l.panDelta=(l.panDelta||new s.P(0,0))._add(w.panDelta)),w.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+w.pitchDelta),w.around!==void 0&&(l.around=w.around),w.aroundCoord!==void 0&&(l.aroundCoord=w.aroundCoord),w.pinchAround!==void 0&&(l.pinchAround=w.pinchAround),w.noInertia&&(l.noInertia=w.noInertia),s.ak(h,M),s.ak(x,A);this._updateMapTransform(l,h,x),this._changes=[]}_updateMapTransform(l,h,x){const w=this._map,M=w.transform,A=oe=>[oe.x,oe.y,oe.z];if((oe=>{const de=this._eventsInProgress.drag;return de&&!this._handlersById[de.handlerName].isActive()})()&&!tc(l)){const oe=M.zoom;M.cameraElevationReference="sea",this._originalZoom!=null&&M._orthographicProjectionAtLowPitch&&M.projection.name!=="globe"&&M.pitch===0?(M.cameraElevationReference="ground",M.zoom=this._originalZoom):(M.recenterOnTerrain(),M.cameraElevationReference="ground"),oe!==M.zoom&&this._map._update(!0)}if(M._isCameraConstrained&&w._stop(!0),!tc(l))return void this._fireEvents(h,x,!0);let{panDelta:k,zoomDelta:L,bearingDelta:O,pitchDelta:N,around:j,aroundCoord:H,pinchAround:q}=l;M._isCameraConstrained&&(L>0&&(L=0),M._isCameraConstrained=!1),q!==void 0&&(j=q),(L||(oe=>h[oe]&&!this._eventsInProgress[oe])("drag"))&&j&&(this._dragOrigin=A(M.pointCoordinate3D(j)),this._originalZoom=M.zoom,this._trackingEllipsoid.setup(M._camera.position,this._dragOrigin)),M.cameraElevationReference="sea",w._stop(!0),j=j||w.transform.centerPoint,O&&(M.bearing+=O),N&&(M.pitch+=N),M._updateCameraState();const Y=[0,0,0];if(k)if(M.projection.name==="mercator"){const oe=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(j).dir),de=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(j.sub(k)).dir);Y[0]=de[0]-oe[0],Y[1]=de[1]-oe[1]}else{const oe=M.pointCoordinate(j);if(M.projection.name==="globe"){k=k.rotate(-M.angle);const de=M._pixelsPerMercatorPixel/M.worldSize;Y[0]=-k.x*s.cH(s.l(oe.y))*de,Y[1]=-k.y*s.cH(M.center.lat)*de}else{const de=M.pointCoordinate(j.sub(k));oe&&de&&(Y[0]=de.x-oe.x,Y[1]=de.y-oe.y)}}const J=M.zoom,K=[0,0,0];if(L){const oe=A(H||M.pointCoordinate3D(j)),de={dir:s.v.normalize([],s.v.sub([],oe,M._camera.position))};if(de.dir[2]<0){const fe=M.zoomDeltaToMovement(oe,L);s.v.scale(K,de.dir,fe)}}const X=s.v.add(Y,Y,K);M._translateCameraConstrained(X),L&&Math.abs(M.zoom-J)>1e-4&&M.recenterOnTerrain(),M.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(h,x,!0)}_fireEvents(l,h,x){const w=ec(this._eventsInProgress),M=ec(l),A={};for(const N in l){const{originalEvent:j}=l[N];this._eventsInProgress[N]||(A[`${N}start`]=j),this._eventsInProgress[N]=l[N]}!w&&M&&this._fireEvent("movestart",M.originalEvent);for(const N in A)this._fireEvent(N,A[N]);M&&this._fireEvent("move",M.originalEvent);for(const N in l){const{originalEvent:j}=l[N];this._fireEvent(N,j)}const k={};let L;for(const N in this._eventsInProgress){const{handlerName:j,originalEvent:H}=this._eventsInProgress[N];this._handlersById[j].isActive()||(delete this._eventsInProgress[N],L=h[j]||H,k[`${N}end`]=L)}for(const N in k)this._fireEvent(N,k[N]);const O=ec(this._eventsInProgress);if(x&&(w||M)&&!O){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=H=>H!==0&&-this._bearingSnap<H&&H<this._bearingSnap;N?(j(N.bearing||this._map.getBearing())&&(N.bearing=0),this._map.easeTo(N,{originalEvent:L})):(this._map.fire(new s.a8("moveend",{originalEvent:L})),j(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,h){this._map.fire(new s.a8(l,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new Vp("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Up="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Gp extends s.a6{constructor(l,h){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,s.aR(["_renderFrameCallback"],this)}getCenter(){return new s.L(this.transform.center.lng,this.transform.center.lat)}setCenter(l,h){return this.jumpTo({center:l},h)}panBy(l,h,x){return l=s.P.convert(l).mult(-1),this.panTo(this.transform.center,s.ak({offset:l},h),x)}panTo(l,h,x){return this.easeTo(s.ak({center:l},h),x)}getZoom(){return this.transform.zoom}setZoom(l,h){return this.jumpTo({zoom:l},h),this}zoomTo(l,h,x){return this.easeTo(s.ak({zoom:l},h),x)}zoomIn(l,h){return this.zoomTo(this.getZoom()+1,l,h),this}zoomOut(l,h){return this.zoomTo(this.getZoom()-1,l,h),this}getBearing(){return this.transform.bearing}setBearing(l,h){return this.jumpTo({bearing:l},h),this}getPadding(){return this.transform.padding}setPadding(l,h){return this.jumpTo({padding:l},h),this}rotateTo(l,h,x){return this.easeTo(s.ak({bearing:l},h),x)}resetNorth(l,h){return this.rotateTo(0,s.ak({duration:1e3},l),h),this}resetNorthPitch(l,h){return this.easeTo(s.ak({bearing:0,pitch:0,duration:1e3},l),h),this}snapToNorth(l,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,h):this}getPitch(){return this.transform.pitch}setPitch(l,h){return this.jumpTo({pitch:l},h),this}cameraForBounds(l,h){l=s.D.convert(l);const x=h&&h.bearing||0,w=h&&h.pitch||0,M=l.getNorthWest(),A=l.getSouthEast();return this._cameraForBounds(this.transform,M,A,x,w,h)}_extendCameraOptions(l){const h={top:0,bottom:0,right:0,left:0};if(typeof(l=s.ak({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=="number"){const x=l.padding;l.padding={top:x,bottom:x,right:x,left:x}}return l.padding=s.ak(h,l.padding),l}_minimumAABBFrustumDistance(l,h){const x=h.max[0]-h.min[0],w=h.max[1]-h.min[1];return x/w>l.aspect?x/(2*Math.tan(.5*l.fovX)*l.aspect):w/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,h,x,w,M,A){const k=l.clone(),L=this._extendCameraOptions(A);k.bearing=w,k.pitch=M;const O=s.L.convert(h),N=s.L.convert(x),j=.5*(O.lat+N.lat),H=.5*(O.lng+N.lng),q=s.cI(j,H),Y=s.v.normalize([],q),J=s.v.normalize([],s.v.cross([],Y,[0,1,0])),K=s.v.cross([],J,Y),X=[J[0],J[1],J[2],0,K[0],K[1],K[2],0,Y[0],Y[1],Y[2],0,0,0,0,1],oe=[q,s.cI(O.lat,O.lng),s.cI(N.lat,O.lng),s.cI(N.lat,N.lng),s.cI(O.lat,N.lng),s.cI(j,O.lng),s.cI(j,N.lng),s.cI(O.lat,H),s.cI(N.lat,H)];let de=s.c3.fromPoints(oe.map(Ce=>[s.v.dot(J,Ce),s.v.dot(K,Ce),s.v.dot(Y,Ce)]));const fe=s.v.transformMat4([],de.center,X);s.v.squaredLength(fe)===0&&s.v.set(fe,0,0,1),s.v.normalize(fe,fe),s.v.scale(fe,fe,s.aC),k.center=s.cJ(fe);const ne=k.getWorldToCameraMatrix(),ae=s.m.invert(new Float64Array(16),ne);de=s.c3.applyTransform(de,s.m.multiply([],ne,X)),s.v.transformMat4(fe,fe,ne);const me=.5*(de.max[2]-de.min[2]),xe=this._minimumAABBFrustumDistance(k,de),_e=s.v.scale([],[0,0,1],me),be=s.v.add(_e,fe,_e),Ue=xe+(k.pitch===0?0:s.v.distance(fe,be)),ze=k.globeCenterInViewSpace,Fe=s.v.sub([],fe,[ze[0],ze[1],ze[2]]);s.v.normalize(Fe,Fe),s.v.scale(Fe,Fe,Ue);const Ae=s.v.add([],fe,Fe);s.v.transformMat4(Ae,Ae,ae);const je=s.cL/s.aC,Oe=s.v.length(Ae),qe=s.b(Math.max(Oe*je-s.cL,Number.EPSILON),0),ue=Math.min(k.zoomFromMercatorZAdjusted(qe),L.maxZoom);return ue>.5*(s.Z+s.G)?(k.setProjection({name:"mercator"}),k.zoom=ue,this._cameraForBounds(k,h,x,w,M,A)):{center:k.center,zoom:ue,bearing:w,pitch:M}}queryTerrainElevation(l,h){const x=this.transform.elevation;return x?(h=s.ak({},{exaggerated:!0},h),x.getAtPoint(s.M.fromLngLat(l),null,h.exaggerated)):null}_cameraForBounds(l,h,x,w,M,A){if(l.projection.name==="globe")return this._cameraForBoundsOnGlobe(l,h,x,w,M,A);const k=l.clone(),L=this._extendCameraOptions(A),O=k.padding;k.bearing=w,k.pitch=M;const N=s.L.convert(h),j=s.L.convert(x),H=new s.L(N.lng,j.lat),q=new s.L(j.lng,N.lat),Y=k.project(N),J=k.project(j),K=this.queryTerrainElevation(N),X=this.queryTerrainElevation(j),oe=this.queryTerrainElevation(H),de=this.queryTerrainElevation(q),fe=[[Y.x,Y.y,Math.min(K||0,X||0,oe||0,de||0)],[J.x,J.y,Math.max(K||0,X||0,oe||0,de||0)]];let ne=s.c3.fromPoints(fe);const ae=k.getWorldToCameraMatrix(),me=s.m.invert(new Float64Array(16),ae);ne=s.c3.applyTransform(ne,ae);const xe=s.v.sub([],ne.max,ne.min),_e=O.left||0,be=O.right||0,Ue=O.bottom||0,ze=O.top||0,{left:Fe,right:Ae,top:je,bottom:Oe}=L.padding,qe=.5*(_e+be),ue=.5*(ze+Ue),Ce=Math.min(k.scaleZoom(k.scale*Math.min((k.width-(_e+be+Fe+Ae))/xe[0],(k.height-(Ue+ze+Oe+je))/xe[1])),L.maxZoom),st=k.scale/k.zoomScale(Ce);ne=new s.c3([ne.min[0]-(Fe+qe)*st,ne.min[1]-(Oe+ue)*st,ne.min[2]],[ne.max[0]+(Ae+qe)*st,ne.max[1]+(je+ue)*st,ne.max[2]]);const $e=.5*xe[2],Ft=this._minimumAABBFrustumDistance(k,ne),kt=[0,0,1,0];s.e.transformMat4(kt,kt,ae),s.e.normalize(kt,kt);const Xt=s.v.scale([],kt,Ft+$e),Lt=s.v.add([],ne.center,Xt),Qt=(typeof L.offset.x=="number"&&typeof L.offset.y=="number"?new s.P(L.offset.x,L.offset.y):s.P.convert(L.offset)).rotate(-s.d(w));ne.center[0]-=Qt.x*st,ne.center[1]+=Qt.y*st,s.v.transformMat4(ne.center,ne.center,me),s.v.transformMat4(Lt,Lt,me);const $t=[ne.center[0],ne.center[1],Lt[2]*k.pixelsPerMeter];s.v.scale($t,$t,1/k.worldSize);const Gt=s.cK($t[0]),Ht=s.l($t[1]),Ri=Math.min(k._zoomFromMercatorZ($t[2]),L.maxZoom),hi=new s.L(Gt,Ht);return k.mercatorFromTransition&&Ri<.5*(s.Z+s.G)?(k.setProjection({name:"globe"}),k.zoom=Ri,this._cameraForBounds(k,h,x,w,M,A)):{center:hi,zoom:Ri,bearing:w,pitch:M}}fitBounds(l,h,x){const w=this.cameraForBounds(l,h);return this._fitInternal(w,h,x)}fitScreenCoordinates(l,h,x,w,M){const A=s.P.convert(l),k=s.P.convert(h),L=new s.P(Math.min(A.x,k.x),Math.min(A.y,k.y)),O=new s.P(Math.max(A.x,k.x),Math.max(A.y,k.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(A,k))return this;const N=this.transform.pointLocation3D(L),j=this.transform.pointLocation3D(O),H=this.transform.pointLocation3D(new s.P(L.x,O.y)),q=this.transform.pointLocation3D(new s.P(O.x,L.y)),Y=[Math.min(N.lng,j.lng,H.lng,q.lng),Math.min(N.lat,j.lat,H.lat,q.lat)],J=[Math.max(N.lng,j.lng,H.lng,q.lng),Math.max(N.lat,j.lat,H.lat,q.lat)],K=w&&w.pitch?w.pitch:this.getPitch(),X=this._cameraForBounds(this.transform,Y,J,x,K,w);return this._fitInternal(X,w,M)}_fitInternal(l,h,x){return l?(delete(h=s.ak(l,h)).padding,h.linear?this.easeTo(h,x):this.flyTo(h,x)):this}jumpTo(l,h){this.stop();const x=l.preloadOnly?this.transform.clone():this.transform;let w=!1,M=!1,A=!1;return"zoom"in l&&x.zoom!==+l.zoom&&(w=!0,x.zoom=+l.zoom),l.center!==void 0&&(x.center=s.L.convert(l.center)),"bearing"in l&&x.bearing!==+l.bearing&&(M=!0,x.bearing=+l.bearing),"pitch"in l&&x.pitch!==+l.pitch&&(A=!0,x.pitch=+l.pitch),l.padding==null||x.isPaddingEqual(l.padding)||(x.padding=l.padding),l.preloadOnly?(this._preloadTiles(x),this):(this.fire(new s.a8("movestart",h)).fire(new s.a8("move",h)),w&&this.fire(new s.a8("zoomstart",h)).fire(new s.a8("zoom",h)).fire(new s.a8("zoomend",h)),M&&this.fire(new s.a8("rotatestart",h)).fire(new s.a8("rotate",h)).fire(new s.a8("rotateend",h)),A&&this.fire(new s.a8("pitchstart",h)).fire(new s.a8("pitch",h)).fire(new s.a8("pitchend",h)),this.fire(new s.a8("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.X(Up),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,h){const x=this.transform;if(!x.projection.supportsFreeCamera)return s.X(Up),this;this.stop();const w=x.zoom,M=x.pitch,A=x.bearing;x.setFreeCameraOptions(l);const k=w!==x.zoom,L=M!==x.pitch,O=A!==x.bearing;return this.fire(new s.a8("movestart",h)).fire(new s.a8("move",h)),k&&this.fire(new s.a8("zoomstart",h)).fire(new s.a8("zoom",h)).fire(new s.a8("zoomend",h)),O&&this.fire(new s.a8("rotatestart",h)).fire(new s.a8("rotate",h)).fire(new s.a8("rotateend",h)),L&&this.fire(new s.a8("pitchstart",h)).fire(new s.a8("pitch",h)).fire(new s.a8("pitchend",h)),this.fire(new s.a8("moveend",h)),this}easeTo(l,h){this._stop(!1,l.easeId),((l=s.ak({offset:[0,0],duration:500,easing:s.cG},l)).animate===!1||this._prefersReducedMotion(l))&&(l.duration=0);const x=this.transform,w=this.getZoom(),M=this.getBearing(),A=this.getPitch(),k=this.getPadding(),L="zoom"in l?+l.zoom:w,O="bearing"in l?this._normalizeBearing(l.bearing,M):M,N="pitch"in l?+l.pitch:A,j="padding"in l?l.padding:x.padding,H=s.P.convert(l.offset);let q,Y,J;if(x.projection.name==="globe"){const _e=s.M.fromLngLat(x.center),be=H.rotate(-x.angle);_e.x+=be.x/x.worldSize,_e.y+=be.y/x.worldSize;const Ue=_e.toLngLat(),ze=s.L.convert(l.center||Ue);this._normalizeCenter(ze),q=x.centerPoint.add(be),Y=new s.P(_e.x,_e.y).mult(x.worldSize),J=new s.P(s.E(ze.lng),s.H(ze.lat)).mult(x.worldSize).sub(Y)}else{q=x.centerPoint.add(H);const _e=x.pointLocation(q),be=s.L.convert(l.center||_e);this._normalizeCenter(be),Y=x.project(_e),J=x.project(be).sub(Y)}const K=x.zoomScale(L-w);let X,oe;l.around&&(X=s.L.convert(l.around),oe=x.locationPoint(X));const de=this._zooming||L!==w,fe=this._rotating||M!==O,ne=this._pitching||N!==A,ae=!x.isPaddingEqual(j),me=_e=>be=>{if(de&&(_e.zoom=s.n(w,L,be)),fe&&(_e.bearing=s.n(M,O,be)),ne&&(_e.pitch=s.n(A,N,be)),ae&&(_e.interpolatePadding(k,j,be),q=_e.centerPoint.add(H)),X)_e.setLocationAtPoint(X,oe);else{const Ue=_e.zoomScale(_e.zoom-w),ze=L>w?Math.min(2,K):Math.max(.5,K),Fe=Math.pow(ze,1-be),Ae=_e.unproject(Y.add(J.mult(be*Fe)).mult(Ue));_e.setLocationAtPoint(_e.renderWorldCopies?Ae.wrap():Ae,q)}return l.preloadOnly||this._fireMoveEvents(h),_e};if(l.preloadOnly){const _e=this._emulate(me,l.duration,x);return this._preloadTiles(_e),this}const xe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=de,this._rotating=fe,this._pitching=ne,this._easeId=l.easeId,this._prepareEase(h,l.noMoveStart,xe),this._ease(me(x),_e=>{x.cameraElevationReference==="sea"&&x.recenterOnTerrain(),this._afterEase(h,_e)},l),this}_prepareEase(l,h,x={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),h||x.moving||this.fire(new s.a8("movestart",l)),this._zooming&&!x.zooming&&this.fire(new s.a8("zoomstart",l)),this._rotating&&!x.rotating&&this.fire(new s.a8("rotatestart",l)),this._pitching&&!x.pitching&&this.fire(new s.a8("pitchstart",l))}_fireMoveEvents(l){this.fire(new s.a8("move",l)),this._zooming&&this.fire(new s.a8("zoom",l)),this._rotating&&this.fire(new s.a8("rotate",l)),this._pitching&&this.fire(new s.a8("pitch",l))}_afterEase(l,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const x=this._zooming,w=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,x&&this.fire(new s.a8("zoomend",l)),w&&this.fire(new s.a8("rotateend",l)),M&&this.fire(new s.a8("pitchend",l)),this.fire(new s.a8("moveend",l))}flyTo(l,h){if(this._prefersReducedMotion(l)){const Oe=s.p(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Oe,h)}this.stop(),l=s.ak({offset:[0,0],speed:1.2,curve:1.42,easing:s.cG},l);const x=this.transform,w=this.getZoom(),M=this.getBearing(),A=this.getPitch(),k="zoom"in l?s.c(+l.zoom,x.minZoom,x.maxZoom):w,L="bearing"in l?this._normalizeBearing(l.bearing,M):M,O="pitch"in l?+l.pitch:A,N=x.zoomScale(k-w),j=s.P.convert(l.offset),H=x.centerPoint.add(j),q=x.pointLocation(H);let Y=l.center;if(Y&&l.padding){const Oe=this._cameraForBounds(this.transform,Y,Y,L,O,l);Oe&&(Y=Oe.center)}Y=s.L.convert(Y||q),this._normalizeCenter(Y);const J=x.project(q),K=x.project(Y).sub(J);let X=l.curve;const oe=Math.max(x.width,x.height),de=oe/N,fe=K.mag();if("minZoom"in l){const Oe=s.c(Math.min(l.minZoom,w,k),x.minZoom,x.maxZoom),qe=oe/x.zoomScale(Oe-w);X=Math.sqrt(qe/fe*2)}const ne=X*X;function ae(Oe){const qe=(de*de-oe*oe+(Oe?-1:1)*ne*ne*fe*fe)/(2*(Oe?de:oe)*ne*fe);return Math.log(Math.sqrt(qe*qe+1)-qe)}function me(Oe){return(Math.exp(Oe)-Math.exp(-Oe))/2}function xe(Oe){return(Math.exp(Oe)+Math.exp(-Oe))/2}const _e=ae(0);let be=function(Oe){return xe(_e)/xe(_e+X*Oe)},Ue=function(Oe){return oe*((xe(_e)*(me(qe=_e+X*Oe)/xe(qe))-me(_e))/ne)/fe;var qe},ze=(ae(1)-_e)/X;if(Math.abs(fe)<1e-6||!isFinite(ze)){if(Math.abs(oe-de)<1e-6)return this.easeTo(l,h);const Oe=de<oe?-1:1;ze=Math.abs(Math.log(de/oe))/X,Ue=function(){return 0},be=function(qe){return Math.exp(Oe*X*qe)}}l.duration="duration"in l?+l.duration:1e3*ze/("screenSpeed"in l?+l.screenSpeed/X:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const Fe=M!==L,Ae=O!==A,je=Oe=>qe=>{const ue=qe*ze,Ce=1/be(ue);Oe.zoom=qe===1?k:w+Oe.scaleZoom(Ce),Fe&&(Oe.bearing=s.n(M,L,qe)),Ae&&(Oe.pitch=s.n(A,O,qe));const st=qe===1?Y:Oe.unproject(J.add(K.mult(Ue(ue))).mult(Ce));return Oe.setLocationAtPoint(Oe.renderWorldCopies?st.wrap():st,H),Oe._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(h),Oe};if(l.preloadOnly){const Oe=this._emulate(je,l.duration,x);return this._preloadTiles(Oe),this}return this._zooming=!0,this._rotating=Fe,this._pitching=Ae,this._prepareEase(h,!1),this._ease(je(x),()=>this._afterEase(h),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const x=this._onEaseEnd;this._onEaseEnd=void 0,x.call(this,h)}if(!l){const x=this.handlers;x&&x.stop(!1)}return this}_ease(l,h,x){x.animate===!1||x.duration===0?(l(1),h()):(this._easeStart=s.a4.now(),this._easeOptions=x,this._onEaseFrame=l,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((s.a4.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,h){l=s.w(l,-180,180);const x=Math.abs(l-h);return Math.abs(l-360-h)<x&&(l-=360),Math.abs(l+360-h)<x&&(l+=360),l}_normalizeCenter(l){const h=this.transform;if(h.maxBounds||h.projection.name!=="globe"&&!h.renderWorldCopies)return;const x=l.lng-h.center.lng;l.lng+=x>180?-360:x<-180?360:0}_prefersReducedMotion(l){return this._respectPrefersReducedMotion&&s.a4.prefersReducedMotion&&!(l&&l.essential)}_emulate(l,h,x){const w=Math.ceil(15*h/1e3),M=[],A=l(x.clone());for(let k=0;k<=w;k++){const L=A(k/w);M.push(L.clone())}return M}}class cd{constructor(l={}){this.options=l,s.aR(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const h=this.options&&this.options.compact;return this._map=l,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=U("button","mapboxgl-ctrl-attrib-button",this._container),U("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=U("div","mapboxgl-ctrl-attrib-inner",this._container),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(l,h){const x=this._map._getUIString(`AttributionControl.${h}`);l.removeAttribute("title"),l.firstElementChild&&l.firstElementChild.setAttribute("title",x)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.cM.ACCESS_TOKEN}];if(l){const x=h.reduce((w,M,A)=>(M.value&&(w+=`${M.key}=${M.value}${A<h.length-1?"&":""}`),w),"?");l.href=`${s.cM.FEEDBACK_URL}/${x}#${Lo(this._map,!0)}`,l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}}_updateData(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const h=this._map.style._mergedSourceCaches;for(const w in h){const M=h[w];if(M.used){const A=M.getSource();A.attribution&&l.indexOf(A.attribution)<0&&l.push(A.attribution)}}l.sort((w,M)=>w.length-M.length),l=l.filter((w,M)=>{for(let A=M+1;A<l.length;A++)if(l[A].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const x=l.join(" | ");x!==this._attribHTML&&(this._attribHTML=x,l.length?(this._innerContainer.innerHTML=x,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ud{constructor(){s.aR(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=U("div","mapboxgl-ctrl");const h=U("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(Object.entries(l).length===0)return!0;for(const h in l){const x=l[h].getSource();if(x.hasOwnProperty("mapbox_logo")&&!x.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const h=l[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class hd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const h=++this._id;return this._queue.push({callback:l,id:h,cancelled:!1}),h}remove(l){const h=this._currentlyRunning,x=h?this._queue.concat(h):this._queue;for(const w of x)if(w.id===l)return void(w.cancelled=!0)}run(l=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const x of h)if(!x.cancelled&&(x.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function dd(g,l,h){if(g=new s.L(g.lng,g.lat),l){const x=new s.L(g.lng-360,g.lat),w=new s.L(g.lng+360,g.lat),M=360*Math.ceil(Math.abs(g.lng-h.center.lng)/360),A=h.locationPoint(g).distSqr(l),k=l.x<0||l.y<0||l.x>h.width||l.y>h.height;h.locationPoint(x).distSqr(l)<A&&(k||Math.abs(x.lng-h.center.lng)<M)?g=x:h.locationPoint(w).distSqr(l)<A&&(k||Math.abs(w.lng-h.center.lng)<M)&&(g=w)}for(;Math.abs(g.lng-h.center.lng)>180;){const x=h.locationPoint(g);if(x.x>=0&&x.y>=0&&x.x<=h.width&&x.y<=h.height)break;g.lng>h.center.lng?g.lng-=360:g.lng+=360}return g}const bu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ir extends s.a6{constructor(l,h){if(super(),(l instanceof HTMLElement||h)&&(l=s.ak({element:l},h)),s.aR(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=s.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=U("div");const M=41,A=27,k=Z("svg",{display:"block",height:M*this._scale+"px",width:A*this._scale+"px",viewBox:`0 0 ${A} ${M}`},this._element),L=Z("radialGradient",{id:"shadowGradient"},Z("defs",{},k));Z("stop",{offset:"10%","stop-opacity":.4},L),Z("stop",{offset:"100%","stop-opacity":.05},L),Z("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},k),Z("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},k),Z("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},k),Z("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},k),this._offset=s.P.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",M=>{M.preventDefault()}),this._element.addEventListener("mousedown",M=>{M.preventDefault()});const x=this._element.classList;for(const M in bu)x.remove(`mapboxgl-marker-anchor-${M}`);x.add(`mapboxgl-marker-anchor-${this._anchor}`);const w=l&&l.className?l.className.trim().split(/\s+/):[];x.add(...w),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){const l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=s.L.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(38.1-13.5+w)],"bottom-right":[-w,-1*(38.1-13.5+w)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const h=l.code,x=l.charCode||l.keyCode;h!=="Space"&&h!=="Enter"&&x!==32&&x!==13||this.togglePopup()}_onMapClick(l){const h=l.originalEvent.target,x=this._element;this._popup&&(h===x||x.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const l=this._map,h=this._pos;if(!l||!h)return!1;const x=l.unproject(h),w=l.getFreeCameraOptions();if(!w.position)return!1;const M=w.position.toLngLat();return M.distanceTo(x)<.9*M.distanceTo(this._lngLat)}_evaluateOpacity(){const l=this._map;if(!l)return;const h=this._pos;if(!h||h.x<0||h.x>l.transform.width||h.y<0||h.y>l.transform.height)return void this._clearFadeTimer();const x=l.unproject(h);let w;l._showingGlobe()&&s.cN(l.transform,this._lngLat)?w=0:(w=1-l._queryFogOpacity(x),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(w*=this._occludedOpacity)),this._element.style.opacity=`${w}`,this._element.style.pointerEvents=w>0?"auto":"none",this._popup&&this._popup._setOpacity(w),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const l=this._pos;if(!l||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${l.x}px,${l.y}px)
            ${bu[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){const l=this._pos,h=this._map,x=this.getPitchAlignment();if(!h||!l||x!=="map")return"";if(!h._showingGlobe()){const L=h.getPitch();return L?`rotateX(${L}deg)`:""}const w=s.Y(s.cO(h.transform,this._lngLat)),M=l.sub(s.cP(h.transform)),A=Math.abs(M.x)+Math.abs(M.y);if(A===0)return"";const k=w/A;return`rotateX(${-M.y*k}deg) rotateY(${M.x*k}deg)`}_calculateZTransform(){const l=this._pos,h=this._map;if(!h||!l)return"";let x=0;const w=this.getRotationAlignment();if(w==="map")if(h._showingGlobe()){const M=h.project(new s.L(this._lngLat.lng,this._lngLat.lat+.001)),A=h.project(new s.L(this._lngLat.lng,this._lngLat.lat-.001)).sub(M);x=s.Y(Math.atan2(A.y,A.x))-90}else x=-h.getBearing();else if(w==="horizon"){const M=s.an(4,6,h.getZoom()),A=s.cP(h.transform);A.y+=M*h.transform.height;const k=l.sub(A),L=s.Y(Math.atan2(k.y,k.x));x=(L>90?L-270:L+90)*(1-M)}return x+=this._rotation,x?`rotateZ(${x}deg)`:""}_update(l){cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=dd(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),l===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=s.P.convert(l),this._update(),this}addClassName(l){return this._element.classList.add(l),this}removeClassName(l){return this._element.classList.remove(l),this}toggleClassName(l){return this._element.classList.toggle(l)}_onMove(l){const h=this._map;if(!h)return;const x=this._pointerdownPos,w=this._positionDelta;if(x&&w){if(!this._isDragging){const M=this._clickTolerance||h._clickTolerance;if(l.point.dist(x)<M)return;this._isDragging=!0}this._pos=l.point.sub(w),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.a8("dragstart"))),this.fire(new s.a8("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.a8("dragend")),this._state="inactive"}_addDragHandler(l){const h=this._map,x=this._pos;h&&x&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(x),this._pointerdownPos=l.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;const h=this._map;return h&&(l?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ry={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Hp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function fd(g=new s.P(0,0),l="bottom"){if(typeof g=="number"){const h=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(l){case"top":return new s.P(0,g);case"top-left":return new s.P(h,h);case"top-right":return new s.P(-h,h);case"bottom":return new s.P(0,-g);case"bottom-left":return new s.P(h,-h);case"bottom-right":return new s.P(-h,-h);case"left":return new s.P(g,0);case"right":return new s.P(-g,0)}return new s.P(0,0)}return g instanceof s.P||Array.isArray(g)?s.P.convert(g):s.P.convert(g[l]||[0,0])}class sy{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const h=s.ba((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,h,x){this._start=this.getValue(h),this._end=l,this._startTime=h,this._endTime=h+x}}const oy={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Es={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class Wp{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.continuousRedraw=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}const ay={showCompass:!0,showZoom:!0,visualizePitch:!1};class Bo{constructor(l,h,x=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new sd({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,x&&(this.mousePitch=new od({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),s.aR(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(l,h){this.mouseRotate.mousedown(l,h),this.mousePitch&&this.mousePitch.mousedown(l,h),ie()}move(l,h){const x=this.map,w=this.mouseRotate.mousemoveWindow(l,h),M=w&&w.bearingDelta;if(M&&x.setBearing(x.getBearing()+M),this.mousePitch){const A=this.mousePitch.mousemoveWindow(l,h),k=A&&A.pitchDelta;k&&x.setPitch(x.getPitch()+k)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ve(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(s.ak({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),Me(this.element,l)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,Me(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ye(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){l.targetTouches.length!==1?this.reset():(this._lastPos=Ye(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const js={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},rl={maxWidth:100,unit:"metric"},wu={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:s.c$,supported:P,setRTLTextPlugin:s.d1,getRTLTextPluginStatus:s.d2,Map:class extends Gp{constructor(g){const l=g;if((g=s.ak({},Es,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&s.cQ(window)&&(g.antialias=!1,s.X("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ji(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._repaint=!1,this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new hd,this._domRenderTaskQueue=new hd,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.cR(),this._locale=s.ak({},oy,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new sy(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.cS(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,this._contextCreateOptions=g.contextCreateOptions?{...g.contextCreateOptions}:{},typeof g.container=="string"){const h=document.getElementById(g.container);if(!h)throw new Error(`Container '${g.container.toString()}' not found.`);this._container=h}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&s.X("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),s.aR(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new Wp,this._tp=g.devtools?new Mp(this):new Mp,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,h=>{this.repaint=h}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new jp(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,(g.style||!g.testMode)&&this.setStyle(g.style||s.cM.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),g.hash&&(this._hash=new Cp(typeof g.hash=="string"&&g.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){l.center==null&&l.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch});const h=g.bounds;h&&(this.resize(),this.fitBounds(h,s.ak({},g.fitBoundsOptions,{duration:0})))}this.resize(),g.attributionControl&&this.addControl(new cd({customAttribution:g.customAttribution})),this._logoControl=new ud,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new s.a8(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new s.a8(`${h.dataType}dataloading`,h))})}_getMapId(){return this._mapId}addControl(g,l){if(l===void 0&&(l=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new s.a7(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=g.onAdd(this);this._controls.push(g);const x=this._controlPositions[l];return l.indexOf("bottom")!==-1?x.insertBefore(h,x.firstChild):x.appendChild(h),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new s.a7(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(g);return l>-1&&this._controls.splice(l,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new s.a8("movestart",g)).fire(new s.a8("move",g)),this.fire(new s.a8("resize",g)),l&&this.fire(new s.a8("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(s.D.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new s.a8("zoomstart")).fire(new s.a8("zoom")).fire(new s.a8("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new s.a8("zoomstart")).fire(new s.a8("zoom")).fire(new s.a8("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new s.a8("pitchstart")).fire(new s.a8("pitch")).fire(new s.a8("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new s.a8("pitchstart")).fire(new s.a8("pitch")).fire(new s.a8("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return g==="auto"?navigator.language:Array.isArray(g)?g.length===0?void 0:g.map(l=>l==="auto"?navigator.language:l):g}setLanguage(g){const l=this._parseLanguage(g);if(!this.style||l===this._language)return this;this._language=l,this.style.reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(g){return this._lazyInitEmptyStyle(),g?typeof g=="string"&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const g=this.transform,l=g.projection.name;let h;l==="globe"&&g.zoom>=s.G?(g.setMercatorFromTransition(),h=!0):l==="mercator"&&g.zoom<s.G&&(g.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,l){return this._updateProjection(g||l||{name:"mercator"})}_updateProjection(g){let l;return l=g.name==="globe"&&this.transform.zoom>=s.G?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),l&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(g){return this.transform.locationPoint3D(s.L.convert(g))}unproject(g){return this.transform.pointLocation3D(s.P.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,l,h){if(g==="mouseenter"||g==="mouseover"){let x=!1;const w=A=>{const k=l.filter(O=>this.getLayer(O)),L=k.length?this.queryRenderedFeatures(A.point,{layers:k}):[];L.length?x||(x=!0,h.call(this,new is(g,this,A.originalEvent,{features:L}))):x=!1},M=()=>{x=!1};return{layers:new Set(l),listener:h,delegates:{mousemove:w,mouseout:M}}}if(g==="mouseleave"||g==="mouseout"){let x=!1;const w=A=>{const k=l.filter(L=>this.getLayer(L));(k.length?this.queryRenderedFeatures(A.point,{layers:k}):[]).length?x=!0:x&&(x=!1,h.call(this,new is(g,this,A.originalEvent)))},M=A=>{x&&(x=!1,h.call(this,new is(g,this,A.originalEvent)))};return{layers:new Set(l),listener:h,delegates:{mousemove:w,mouseout:M}}}{const x=w=>{const M=l.filter(k=>this.getLayer(k)),A=M.length?this.queryRenderedFeatures(w.point,{layers:M}):[];A.length&&(w.features=A,h.call(this,w),delete w.features)};return{layers:new Set(l),listener:h,delegates:{[g]:x}}}}on(g,l,h){if(h===void 0)return super.on(g,l);if(Array.isArray(l)||(l=[l]),l){for(const w of l)if(!this._isValidId(w))return this}const x=this._createDelegatedListener(g,l,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(x);for(const w in x.delegates)this.on(w,x.delegates[w]);return this}once(g,l,h){if(h===void 0)return super.once(g,l);if(Array.isArray(l)||(l=[l]),l){for(const w of l)if(!this._isValidId(w))return this}const x=this._createDelegatedListener(g,l,h);for(const w in x.delegates)this.once(w,x.delegates[w]);return this}off(g,l,h){if(h===void 0)return super.off(g,l);l=new Set(Array.isArray(l)?l:[l]);for(const M of l)if(!this._isValidId(M))return this;const x=(M,A)=>{if(M.size!==A.size)return!1;for(const k of M)if(!A.has(k))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[g]:void 0;return w&&(M=>{for(let A=0;A<M.length;A++){const k=M[A];if(k.listener===h&&x(k.layers,l)){for(const L in k.delegates)this.off(L,k.delegates[L]);return M.splice(A,1),this}}})(w),this}queryRenderedFeatures(g,l){if(!this.style)return[];if(l!==void 0||g===void 0||g instanceof s.P||Array.isArray(g)||(l=g,g=void 0),g=g||[[0,0],[this.transform.width,this.transform.height]],(l=l||{}).layers&&Array.isArray(l.layers)){for(const h of l.layers)if(!this._isValidId(h))return[]}return this.style.queryRenderedFeatures(g,l,this.transform)}querySourceFeatures(g,l){return this._isValidId(g)?this.style.querySourceFeatures(g,l):[]}isPointOnSurface(g){const{name:l}=this.transform.projection;return l!=="globe"&&l!=="mercator"&&s.X(`${l} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(g))}setStyle(g,l){return(l=s.ak({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&l.localFontFamily===this._localFontFamily&&this.style&&g?(this._diffStyle(g,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(g,l))}_getUIString(g){const l=this._locale[g];if(l==null)throw new Error(`Missing UI string '${g}'`);return l}_updateStyle(g,l){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g&&(this.style=new cs(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new cs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,l){if(typeof g=="string"){const h=this._requestManager.normalizeStyleURL(g),x=this._requestManager.transformRequest(h,s.a2.Style);s.a1(x,(w,M)=>{w?this.fire(new s.a7(w)):M&&this._updateDiff(M,l)})}else typeof g=="object"&&this._updateDiff(g,l)}_updateDiff(g,l){try{this.style.setState(g)&&this._update(!0)}catch(h){s.X(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(g,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.X("There is no style added to the map."),!1)}_isValidId(g){return g==null?(this.fire(new s.a7(new Error("IDs can't be empty."))),!1):!s.cu(g)||(this.fire(new s.a7(new Error(`IDs can't contain special symbols: "${g}".`))),!1)}addSource(g,l){return this._isValidId(g)?(this._lazyInitEmptyStyle(),this.style.addSource(g,l),this._update(!0)):this}isSourceLoaded(g){return!!this._isValidId(g)&&!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(g,l,h){this._lazyInitEmptyStyle(),this.style.addSourceType(g,l,h)}removeSource(g){return this._isValidId(g)?(this.style.removeSource(g),this._updateTerrain(),this._update(!0)):this}getSource(g){return this._isValidId(g)?this.style.getOwnSource(g):null}addImage(g,l,{pixelRatio:h=1,sdf:x=!1,stretchX:w,stretchY:M,content:A}={}){if(this._lazyInitEmptyStyle(),l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap){const{width:k,height:L,data:O}=s.a4.getImageData(l);this.style.addImage(g,{data:new s.a5({width:k,height:L},O),pixelRatio:h,stretchX:w,stretchY:M,content:A,sdf:x,version:0})}else if(l.width===void 0||l.height===void 0)this.fire(new s.a7(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:k,height:L}=l,O=l;this.style.addImage(g,{data:new s.a5({width:k,height:L},new Uint8Array(O.data)),pixelRatio:h,stretchX:w,stretchY:M,content:A,sdf:x,version:0,userImage:O}),O.onAdd&&O.onAdd(this,g)}}updateImage(g,l){this._lazyInitEmptyStyle();const h=this.style.getImage(g);if(!h)return void this.fire(new s.a7(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap?s.a4.getImageData(l):l,{width:w,height:M}=x,A=x.data;if(w===void 0||M===void 0)return void this.fire(new s.a7(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(w!==h.data.width||M!==h.data.height)return void this.fire(new s.a7(new Error(`The width and height of the updated image (${w}, ${M})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`)));const k=!(l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap);h.data.replace(A,k),this.style.updateImage(g,h)}hasImage(g){return g?!!this.style&&!!this.style.getImage(g):(this.fire(new s.a7(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,l){s.a3(this._requestManager.transformRequest(g,s.a2.Image),(h,x)=>{l(h,x instanceof HTMLImageElement?s.a4.getImageData(x):x)})}listImages(){return this.style.listImages()}addModel(g,l){this._lazyInitEmptyStyle(),this.style.addModel(g,l)}hasModel(g){return g?this.style.hasModel(g):(this.fire(new s.a7(new Error("Missing required model id"))),!1)}removeModel(g){this.style.removeModel(g)}listModels(){return this.style.listModels()}addLayer(g,l){return this._isValidId(g.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(g,l),this._update(!0)):this}moveLayer(g,l){return this._isValidId(g)?(this.style.moveLayer(g,l),this._update(!0)):this}removeLayer(g){return this._isValidId(g)?(this.style.removeLayer(g),this._update(!0)):this}getLayer(g){return this._isValidId(g)?this.style.getOwnLayer(g):null}setLayerZoomRange(g,l,h){return this._isValidId(g)?(this.style.setLayerZoomRange(g,l,h),this._update(!0)):this}setFilter(g,l,h={}){return this._isValidId(g)?(this.style.setFilter(g,l,h),this._update(!0)):this}getFilter(g){return this._isValidId(g)?this.style.getFilter(g):null}setPaintProperty(g,l,h,x={}){return this._isValidId(g)?(this.style.setPaintProperty(g,l,h,x),this._update(!0)):this}getPaintProperty(g,l){return this._isValidId(g)?this.style.getPaintProperty(g,l):null}setLayoutProperty(g,l,h,x={}){return this._isValidId(g)?(this.style.setLayoutProperty(g,l,h,x),this._update(!0)):this}getLayoutProperty(g,l){return this._isValidId(g)?this.style.getLayoutProperty(g,l):null}getConfigProperty(g,l){return this.style.getConfigProperty(g,l)}setConfigProperty(g,l,h){return this.style.setConfigProperty(g,l,h),this._update(!0)}setLights(g){if(this._lazyInitEmptyStyle(),g&&g.length===1&&g[0].type==="flat"){const l=g[0];l.properties?this.style.setFlatLight(l.properties,l.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(g),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const g=this.style.getLights()||[];return g.length===0&&g.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),g}setLight(g,l={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:g}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(g){return this.style.setCamera(g),this._triggerCameraUpdate(g)}_triggerCameraUpdate(g){return this._update(this.transform.setOrthographicProjectionAtLowPitch(g["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.L.convert(g),this.transform):0}setFeatureState(g,l){return this._isValidId(g.source)?(this.style.setFeatureState(g,l),this._update()):this}removeFeatureState(g,l){return this._isValidId(g.source)?(this.style.removeFeatureState(g,l),this._update()):this}getFeatureState(g){return this._isValidId(g.source)?this.style.getFeatureState(g):null}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let h,x,w,M=this._container;for(;M&&(!x||!w);){const A=window.getComputedStyle(M).transform;A&&A!=="none"&&(h=A.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(x=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(w=h[3])),M=M.parentElement}this._containerWidth=x?Math.abs(g/x):g,this._containerHeight=w?Math.abs(l/w):l}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.X("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=U("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=U("div","mapboxgl-canvas-container",g);this._canvas=U("canvas","mapboxgl-canvas",l),this._interactive&&(l.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=U("div","mapboxgl-control-container",g),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{x[w]=U("div",`mapboxgl-ctrl-${w}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,l){const h=s.a4.devicePixelRatio||1;this._canvas.width=h*Math.ceil(g),this._canvas.height=h*Math.ceil(l),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${l}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const l=this._markers.indexOf(g);l!==-1&&this._markers.splice(l,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const l=this._popups.indexOf(g);l!==-1&&this._popups.splice(l,1)}_setupPainter(){const g=s.ak({},P.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._canvas.getContext("webgl2",g);l?(s.cT(l,!0),this.painter=new Q_(l,this._contextCreateOptions,this.transform,this._tp),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.cU.testSupport(l)):this.fire(new s.a7(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.a8("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new s.a8("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let l;this.fire(new s.a8("renderstart"));const h=this.painter.context.extTimerQuery,x=s.a4.now(),w=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(l=w.createQuery(),w.beginQuery(h.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const M=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,O=this.transform.pitch,N=s.a4.now(),j=new s.al(L,{now:N,fadeDuration:M,pitch:O,transition:this.style.transition});this.style.update(j)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let A=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),A=this._updateAverageElevation(x),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):A=this._updateAverageElevation(x),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,M,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:M,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.a8("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.a8("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){const L=s.a4.now()-x;w.endQuery(h.TIME_ELAPSED_EXT),setTimeout(()=>{const O=w.getQueryParameter(l,w.QUERY_RESULT)/1e6;w.deleteQuery(l),this.fire(new s.a8("gpu-timing-frame",{cpuTime:L,gpuTime:O}))},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const O=this.painter.queryGpuTimers(L);this.fire(new s.a8("gpu-timing-layer",{layerTimes:O}))},50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const O=this.painter.queryGpuTimeDeferredRender(L);this.fire(new s.a8("gpu-timing-deferred-render",{gpuTime:O}))},50)}const k=this._sourcesDirty||this._styleDirty||this._placementDirty||A;if(k||this._repaint)this.triggerRepaint();else{const L=!this.isMoving()&&this.loaded();if(L&&(A=this._updateAverageElevation(x,!0)),A)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new s.a8("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const O=this._calculateSpeedIndex();this.fire(new s.a8("speedindexcompleted",{speedIndex:O})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,this._performanceMetricsCollection&&s.cV(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const l of this._markers)g&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(const l of this._popups)!g||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(g,l=!1){const h=w=>(this.transform.averageElevation=w,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);const x=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(x||(l||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const w=this.transform.averageElevation;let M=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(M)?M=0:this._averageElevationLastSampledAt=g;const A=Math.abs(w-M);if(A>1){if(this._isInitialLoad||x)return this._averageElevation.jumpTo(M),h(M);this._averageElevation.easeTo(M,g,300)}else if(A>1e-4)return this._averageElevation.jumpTo(M),h(M)}return!!this._averageElevation.isEasing(g)&&h(this._averageElevation.getValue(g))}_authenticate(){s.cW(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===s.cX||g.status===401)){const l=this.painter.context.gl;s.cT(l,!1),this._logoControl instanceof ud&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.a7(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.cY(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const h=this.painter.context.gl,x=h.createFramebuffer();function w(M){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,M,0);const A=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,A),A}return h.bindFramebuffer(h.FRAMEBUFFER,x),this._canvasPixelComparison(w(g),l.canvasCopies.map(w),l.timeStamps)}_canvasPixelComparison(g,l,h){let x=h[1]-h[0];const w=g.length/4;for(let M=0;M<l.length;M++){const A=l[M];let k=0;for(let L=0;L<A.length;L+=4)A[L]===g[L]&&A[L+1]===g[L+1]&&A[L+2]===g[L+2]&&A[L+3]===g[L+3]&&(k+=1);x+=(h[M+2]-h[M+1])*(1-k/w)}return x}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.cZ(this.painter.context.gl),this._removed=!0,this.fire(new s.a8("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=s.a4.frame(l=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(l)}))}_preloadTiles(g){const l=this.style?Object.values(this.style._sourceCaches):[];return s.c_(l,(h,x)=>h._preloadTiles(g,x),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(g){this._showLayers2DWireframe!==g&&(this._showLayers2DWireframe=g,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(g){this._showLayers3DWireframe!==g&&(this._showLayers3DWireframe=g,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,g&&this._update())}_setCacheLimits(g,l){s.d0(g,l)}get version(){return s.c$}},NavigationControl:class{constructor(g){this.options=s.ak({},ay,g),this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(s.aR(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),U("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),U("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aR(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:l}):h.resetNorth({},{originalEvent:l}))}),this._compassIcon=U("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const l=g.getZoom(),h=l===g.getMaxZoom(),x=l===g.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=x,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",x.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Bo(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,l){const h=U("button",g,this._container);return h.type="button",h.addEventListener("click",l),h}_setButtonTitle(g,l){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${l}`);g.setAttribute("aria-label",h),g.firstElementChild&&g.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends s.a6{constructor(g){super();const l=navigator.geolocation;this.options=s.ak({geolocation:l},js,g),s.aR(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=zo(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const l=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,g(h)};this._supportsGeolocation!==void 0?g(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(h=>l(h.state!=="denied")).catch(()=>l()):l()}_isOutOfMapMaxBounds(g){const l=this._map.getMaxBounds(),h=g.coords;return!!l&&(h.longitude<l.getWest()||h.longitude>l.getEast()||h.latitude<l.getSouth()||h.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new s.a8("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.a8("geolocate",g)),this._finish()}}_updateCamera(g){const l=new s.L(g.coords.longitude,g.coords.latitude),h=g.coords.accuracy,x=this._map.getBearing(),w=s.ak({bearing:x},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(h),w,{geolocateSource:!0})}_updateMarker(g){if(g){const l=new s.L(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,l=s.b(1,g._center.lat)*g.worldSize,h=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.a8("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=U("button","mapboxgl-ctrl-geolocate",this._container),U("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",g===!1){s.X("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U("div","mapboxgl-user-location"),this._dotElement.appendChild(U("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(U("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ir({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=U("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ir({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.a8("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:g.absolute===!0&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.X("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.a8("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.a8("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.a8("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(l=>{l==="granted"&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:cd,ScaleControl:class{constructor(g){this.options=s.ak({},rl,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aR(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,l=this._map,h=l._containerHeight/2,x=l._containerWidth/2-g/2,w=l.unproject([x,h]),M=l.unproject([x+g,h]),A=w.distanceTo(M);if(this.options.unit==="imperial"){const k=3.2808*A;k>5280?this._setScale(g,k/5280,"mile"):this._setScale(g,k,"foot")}else this.options.unit==="nautical"?this._setScale(g,A/1852,"nautical-mile"):A>=1e3?this._setScale(g,A/1e3,"kilometer"):this._setScale(g,A,"meter")}_setScale(g,l,h){this._map._requestDomTask(()=>{const x=function(M){const A=Math.pow(10,`${Math.floor(M)}`.length-1);let k=M/A;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(L){const O=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*O)/O}(k),A*k}(l),w=x/l;this._container.innerHTML=this._isNumberFormatSupported&&h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(x):`${x}&nbsp;${wu[h]}`,this._container.style.width=g*w+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g){this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:s.X("Full screen control 'container' must be a DOM element.")),s.aR(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.X("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=U("button","mapboxgl-ctrl-fullscreen",this._controlContainer);U("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.a6{constructor(g){super(),this.options=s.ak(Object.create(ry),g),s.aR(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new s.a8("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new s.a8("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=s.L.convert(g),this._pos=null,this._trackPointer=!1,this._update();const l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const l=document.createDocumentFragment(),h=document.createElement("body");let x;for(h.innerHTML=g;x=h.firstChild,x;)l.appendChild(x);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=U("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(g),this.options.closeButton){const h=this._closeButton=U("button","mapboxgl-popup-close-button",l);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let l;return this._classList.delete(g)?l=!1:(this._classList.add(g),l=!0),this._updateClassList(),l}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const l=this._map,h=this._container,x=this._pos;if(!l||!h||!x)return"bottom";const w=h.offsetWidth,M=h.offsetHeight,A=x.x<w/2,k=x.x>l.transform.width-w/2;if(x.y+g<M)return A?"top-left":k?"top-right":"top";if(x.y>l.transform.height-M){if(A)return"bottom-left";if(k)return"bottom-right"}return A?"left":k?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),g.className=l.join(" ")}_update(g){const l=this._map,h=this._content;if(!l||!this._lngLat&&!this._trackPointer||!h)return;let x=this._container;if(x||(x=this._container=U("div","mapboxgl-popup",l.getContainer()),this._tip=U("div","mapboxgl-popup-tip",x),x.appendChild(h)),this.options.maxWidth&&x.style.maxWidth!==this.options.maxWidth&&(x.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=dd(this._lngLat,this._pos,l.transform)),!this._trackPointer||g){const w=this._pos=this._trackPointer&&g?g:l.project(this._lngLat),M=fd(this.options.offset),A=this._anchor=this._getAnchor(M.y),k=fd(this.options.offset,A),L=w.add(k).round();l._requestDomTask(()=>{this._container&&A&&(this._container.style.transform=`${bu[A]} translate(${L.x}px,${L.y}px)`)})}if(!this._marker&&l._showingGlobe()){const w=s.cN(l.transform,this._lngLat)?0:1;this._setOpacity(w)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(Hp);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:ir,Style:cs,LngLat:s.L,LngLatBounds:s.D,Point:s.P,MercatorCoordinate:s.M,FreeCameraOptions:zi,Evented:s.a6,config:s.cM,prewarm:s.d3,clearPrewarmedResources:s.d4,get accessToken(){return s.cM.ACCESS_TOKEN},set accessToken(g){s.cM.ACCESS_TOKEN=g},get baseApiUrl(){return s.cM.API_URL},set baseApiUrl(g){s.cM.API_URL=g},get workerCount(){return s.d5.workerCount},set workerCount(g){s.d5.workerCount=g},get maxParallelImageRequests(){return s.cM.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){s.cM.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){s.d6(g)},get workerUrl(){return s.d7.workerUrl},set workerUrl(g){s.d7.workerUrl=g},get workerClass(){return s.d7.workerClass},set workerClass(g){s.d7.workerClass=g},get workerParams(){return s.d7.workerParams},set workerParams(g){s.d7.workerParams=g},get dracoUrl(){return s.d8()},set dracoUrl(g){s.d9(g)},setNow:s.a4.setNow,restoreNow:s.a4.restoreNow}});var v=m;return v})})(yI);var oL=yI.exports;const mj=sL(oL);/*!
 * @kurkle/color v0.3.2
 * https://github.com/kurkle/color#readme
 * (c) 2023 Jukka Kurkela
 * Released under the MIT License
 */function Kf(r){return r+.5|0}const Sl=(r,i,o)=>Math.max(Math.min(r,o),i);function uf(r){return Sl(Kf(r*2.55),0,255)}function kl(r){return Sl(Kf(r*255),0,255)}function Ba(r){return Sl(Kf(r/2.55)/100,0,1)}function BM(r){return Sl(Kf(r*100),0,100)}const Xs={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Cx=[..."0123456789ABCDEF"],aL=r=>Cx[r&15],lL=r=>Cx[(r&240)>>4]+Cx[r&15],Qm=r=>(r&240)>>4===(r&15),cL=r=>Qm(r.r)&&Qm(r.g)&&Qm(r.b)&&Qm(r.a);function uL(r){var i=r.length,o;return r[0]==="#"&&(i===4||i===5?o={r:255&Xs[r[1]]*17,g:255&Xs[r[2]]*17,b:255&Xs[r[3]]*17,a:i===5?Xs[r[4]]*17:255}:(i===7||i===9)&&(o={r:Xs[r[1]]<<4|Xs[r[2]],g:Xs[r[3]]<<4|Xs[r[4]],b:Xs[r[5]]<<4|Xs[r[6]],a:i===9?Xs[r[7]]<<4|Xs[r[8]]:255})),o}const hL=(r,i)=>r<255?i(r):"";function dL(r){var i=cL(r)?aL:lL;return r?"#"+i(r.r)+i(r.g)+i(r.b)+hL(r.a,i):void 0}const fL=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function vI(r,i,o){const c=i*Math.min(o,1-o),f=(m,_=(m+r/30)%12)=>o-c*Math.max(Math.min(_-3,9-_,1),-1);return[f(0),f(8),f(4)]}function pL(r,i,o){const c=(f,m=(f+r/60)%6)=>o-o*i*Math.max(Math.min(m,4-m,1),0);return[c(5),c(3),c(1)]}function mL(r,i,o){const c=vI(r,1,.5);let f;for(i+o>1&&(f=1/(i+o),i*=f,o*=f),f=0;f<3;f++)c[f]*=1-i-o,c[f]+=i;return c}function gL(r,i,o,c,f){return r===f?(i-o)/c+(i<o?6:0):i===f?(o-r)/c+2:(r-i)/c+4}function yv(r){const o=r.r/255,c=r.g/255,f=r.b/255,m=Math.max(o,c,f),_=Math.min(o,c,f),v=(m+_)/2;let s,S,P;return m!==_&&(P=m-_,S=v>.5?P/(2-m-_):P/(m+_),s=gL(o,c,f,P,m),s=s*60+.5),[s|0,S||0,v]}function xv(r,i,o,c){return(Array.isArray(i)?r(i[0],i[1],i[2]):r(i,o,c)).map(kl)}function vv(r,i,o){return xv(vI,r,i,o)}function _L(r,i,o){return xv(mL,r,i,o)}function yL(r,i,o){return xv(pL,r,i,o)}function bI(r){return(r%360+360)%360}function xL(r){const i=fL.exec(r);let o=255,c;if(!i)return;i[5]!==c&&(o=i[6]?uf(+i[5]):kl(+i[5]));const f=bI(+i[2]),m=+i[3]/100,_=+i[4]/100;return i[1]==="hwb"?c=_L(f,m,_):i[1]==="hsv"?c=yL(f,m,_):c=vv(f,m,_),{r:c[0],g:c[1],b:c[2],a:o}}function vL(r,i){var o=yv(r);o[0]=bI(o[0]+i),o=vv(o),r.r=o[0],r.g=o[1],r.b=o[2]}function bL(r){if(!r)return;const i=yv(r),o=i[0],c=BM(i[1]),f=BM(i[2]);return r.a<255?`hsla(${o}, ${c}%, ${f}%, ${Ba(r.a)})`:`hsl(${o}, ${c}%, ${f}%)`}const FM={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},NM={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function wL(){const r={},i=Object.keys(NM),o=Object.keys(FM);let c,f,m,_,v;for(c=0;c<i.length;c++){for(_=v=i[c],f=0;f<o.length;f++)m=o[f],v=v.replace(m,FM[m]);m=parseInt(NM[_],16),r[v]=[m>>16&255,m>>8&255,m&255]}return r}let $m;function TL(r){$m||($m=wL(),$m.transparent=[0,0,0,0]);const i=$m[r.toLowerCase()];return i&&{r:i[0],g:i[1],b:i[2],a:i.length===4?i[3]:255}}const ML=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function SL(r){const i=ML.exec(r);let o=255,c,f,m;if(i){if(i[7]!==c){const _=+i[7];o=i[8]?uf(_):Sl(_*255,0,255)}return c=+i[1],f=+i[3],m=+i[5],c=255&(i[2]?uf(c):Sl(c,0,255)),f=255&(i[4]?uf(f):Sl(f,0,255)),m=255&(i[6]?uf(m):Sl(m,0,255)),{r:c,g:f,b:m,a:o}}}function EL(r){return r&&(r.a<255?`rgba(${r.r}, ${r.g}, ${r.b}, ${Ba(r.a)})`:`rgb(${r.r}, ${r.g}, ${r.b})`)}const ix=r=>r<=.0031308?r*12.92:Math.pow(r,1/2.4)*1.055-.055,qu=r=>r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4);function AL(r,i,o){const c=qu(Ba(r.r)),f=qu(Ba(r.g)),m=qu(Ba(r.b));return{r:kl(ix(c+o*(qu(Ba(i.r))-c))),g:kl(ix(f+o*(qu(Ba(i.g))-f))),b:kl(ix(m+o*(qu(Ba(i.b))-m))),a:r.a+o*(i.a-r.a)}}function eg(r,i,o){if(r){let c=yv(r);c[i]=Math.max(0,Math.min(c[i]+c[i]*o,i===0?360:1)),c=vv(c),r.r=c[0],r.g=c[1],r.b=c[2]}}function wI(r,i){return r&&Object.assign(i||{},r)}function VM(r){var i={r:0,g:0,b:0,a:255};return Array.isArray(r)?r.length>=3&&(i={r:r[0],g:r[1],b:r[2],a:255},r.length>3&&(i.a=kl(r[3]))):(i=wI(r,{r:0,g:0,b:0,a:1}),i.a=kl(i.a)),i}function IL(r){return r.charAt(0)==="r"?SL(r):xL(r)}let TI=class Px{constructor(i){if(i instanceof Px)return i;const o=typeof i;let c;o==="object"?c=VM(i):o==="string"&&(c=uL(i)||TL(i)||IL(i)),this._rgb=c,this._valid=!!c}get valid(){return this._valid}get rgb(){var i=wI(this._rgb);return i&&(i.a=Ba(i.a)),i}set rgb(i){this._rgb=VM(i)}rgbString(){return this._valid?EL(this._rgb):void 0}hexString(){return this._valid?dL(this._rgb):void 0}hslString(){return this._valid?bL(this._rgb):void 0}mix(i,o){if(i){const c=this.rgb,f=i.rgb;let m;const _=o===m?.5:o,v=2*_-1,s=c.a-f.a,S=((v*s===-1?v:(v+s)/(1+v*s))+1)/2;m=1-S,c.r=255&S*c.r+m*f.r+.5,c.g=255&S*c.g+m*f.g+.5,c.b=255&S*c.b+m*f.b+.5,c.a=_*c.a+(1-_)*f.a,this.rgb=c}return this}interpolate(i,o){return i&&(this._rgb=AL(this._rgb,i._rgb,o)),this}clone(){return new Px(this.rgb)}alpha(i){return this._rgb.a=kl(i),this}clearer(i){const o=this._rgb;return o.a*=1-i,this}greyscale(){const i=this._rgb,o=Kf(i.r*.3+i.g*.59+i.b*.11);return i.r=i.g=i.b=o,this}opaquer(i){const o=this._rgb;return o.a*=1+i,this}negate(){const i=this._rgb;return i.r=255-i.r,i.g=255-i.g,i.b=255-i.b,this}lighten(i){return eg(this._rgb,2,i),this}darken(i){return eg(this._rgb,2,-i),this}saturate(i){return eg(this._rgb,1,i),this}desaturate(i){return eg(this._rgb,1,-i),this}rotate(i){return vL(this._rgb,i),this}};/*!
 * Chart.js v4.4.2
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */function Pa(){}const kL=(()=>{let r=0;return()=>r++})();function gn(r){return r===null||typeof r>"u"}function Zn(r){if(Array.isArray&&Array.isArray(r))return!0;const i=Object.prototype.toString.call(r);return i.slice(0,7)==="[object"&&i.slice(-6)==="Array]"}function sn(r){return r!==null&&Object.prototype.toString.call(r)==="[object Object]"}function or(r){return(typeof r=="number"||r instanceof Number)&&isFinite(+r)}function Ls(r,i){return or(r)?r:i}function Gi(r,i){return typeof r>"u"?i:r}const CL=(r,i)=>typeof r=="string"&&r.endsWith("%")?parseFloat(r)/100:+r/i,MI=(r,i)=>typeof r=="string"&&r.endsWith("%")?parseFloat(r)/100*i:+r;function Vn(r,i,o){if(r&&typeof r.call=="function")return r.apply(o,i)}function An(r,i,o,c){let f,m,_;if(Zn(r))if(m=r.length,c)for(f=m-1;f>=0;f--)i.call(o,r[f],f);else for(f=0;f<m;f++)i.call(o,r[f],f);else if(sn(r))for(_=Object.keys(r),m=_.length,f=0;f<m;f++)i.call(o,r[_[f]],_[f])}function Zg(r,i){let o,c,f,m;if(!r||!i||r.length!==i.length)return!1;for(o=0,c=r.length;o<c;++o)if(f=r[o],m=i[o],f.datasetIndex!==m.datasetIndex||f.index!==m.index)return!1;return!0}function Xg(r){if(Zn(r))return r.map(Xg);if(sn(r)){const i=Object.create(null),o=Object.keys(r),c=o.length;let f=0;for(;f<c;++f)i[o[f]]=Xg(r[o[f]]);return i}return r}function SI(r){return["__proto__","prototype","constructor"].indexOf(r)===-1}function PL(r,i,o,c){if(!SI(r))return;const f=i[r],m=o[r];sn(f)&&sn(m)?Pf(f,m,c):i[r]=Xg(m)}function Pf(r,i,o){const c=Zn(i)?i:[i],f=c.length;if(!sn(r))return r;o=o||{};const m=o.merger||PL;let _;for(let v=0;v<f;++v){if(_=c[v],!sn(_))continue;const s=Object.keys(_);for(let S=0,P=s.length;S<P;++S)m(s[S],r,_,o)}return r}function wf(r,i){return Pf(r,i,{merger:DL})}function DL(r,i,o){if(!SI(r))return;const c=i[r],f=o[r];sn(c)&&sn(f)?wf(c,f):Object.prototype.hasOwnProperty.call(i,r)||(i[r]=Xg(f))}const jM={"":r=>r,x:r=>r.x,y:r=>r.y};function zL(r){const i=r.split("."),o=[];let c="";for(const f of i)c+=f,c.endsWith("\\")?c=c.slice(0,-1)+".":(o.push(c),c="");return o}function LL(r){const i=zL(r);return o=>{for(const c of i){if(c==="")break;o=o&&o[c]}return o}}function Cl(r,i){return(jM[i]||(jM[i]=LL(i)))(r)}function bv(r){return r.charAt(0).toUpperCase()+r.slice(1)}const Df=r=>typeof r<"u",Pl=r=>typeof r=="function",UM=(r,i)=>{if(r.size!==i.size)return!1;for(const o of r)if(!i.has(o))return!1;return!0};function RL(r){return r.type==="mouseup"||r.type==="click"||r.type==="contextmenu"}const Yn=Math.PI,Xn=2*Yn,OL=Xn+Yn,Yg=Number.POSITIVE_INFINITY,BL=Yn/180,fr=Yn/2,vc=Yn/4,GM=Yn*2/3,El=Math.log10,Ko=Math.sign;function Tf(r,i,o){return Math.abs(r-i)<o}function HM(r){const i=Math.round(r);r=Tf(r,i,r/1e3)?i:r;const o=Math.pow(10,Math.floor(El(r))),c=r/o;return(c<=1?1:c<=2?2:c<=5?5:10)*o}function FL(r){const i=[],o=Math.sqrt(r);let c;for(c=1;c<o;c++)r%c===0&&(i.push(c),i.push(r/c));return o===(o|0)&&i.push(o),i.sort((f,m)=>f-m).pop(),i}function ah(r){return!isNaN(parseFloat(r))&&isFinite(r)}function NL(r,i){const o=Math.round(r);return o-i<=r&&o+i>=r}function EI(r,i,o){let c,f,m;for(c=0,f=r.length;c<f;c++)m=r[c][o],isNaN(m)||(i.min=Math.min(i.min,m),i.max=Math.max(i.max,m))}function yo(r){return r*(Yn/180)}function wv(r){return r*(180/Yn)}function WM(r){if(!or(r))return;let i=1,o=0;for(;Math.round(r*i)/i!==r;)i*=10,o++;return o}function AI(r,i){const o=i.x-r.x,c=i.y-r.y,f=Math.sqrt(o*o+c*c);let m=Math.atan2(c,o);return m<-.5*Yn&&(m+=Xn),{angle:m,distance:f}}function Dx(r,i){return Math.sqrt(Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2))}function VL(r,i){return(r-i+OL)%Xn-Yn}function Rs(r){return(r%Xn+Xn)%Xn}function zf(r,i,o,c){const f=Rs(r),m=Rs(i),_=Rs(o),v=Rs(m-f),s=Rs(_-f),S=Rs(f-m),P=Rs(f-_);return f===m||f===_||c&&m===_||v>s&&S<P}function Ir(r,i,o){return Math.max(i,Math.min(o,r))}function jL(r){return Ir(r,-32768,32767)}function Va(r,i,o,c=1e-6){return r>=Math.min(i,o)-c&&r<=Math.max(i,o)+c}function Tv(r,i,o){o=o||(_=>r[_]<i);let c=r.length-1,f=0,m;for(;c-f>1;)m=f+c>>1,o(m)?f=m:c=m;return{lo:f,hi:c}}const ja=(r,i,o,c)=>Tv(r,o,c?f=>{const m=r[f][i];return m<o||m===o&&r[f+1][i]===o}:f=>r[f][i]<o),UL=(r,i,o)=>Tv(r,o,c=>r[c][i]>=o);function GL(r,i,o){let c=0,f=r.length;for(;c<f&&r[c]<i;)c++;for(;f>c&&r[f-1]>o;)f--;return c>0||f<r.length?r.slice(c,f):r}const II=["push","pop","shift","splice","unshift"];function HL(r,i){if(r._chartjs){r._chartjs.listeners.push(i);return}Object.defineProperty(r,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[i]}}),II.forEach(o=>{const c="_onData"+bv(o),f=r[o];Object.defineProperty(r,o,{configurable:!0,enumerable:!1,value(...m){const _=f.apply(this,m);return r._chartjs.listeners.forEach(v=>{typeof v[c]=="function"&&v[c](...m)}),_}})})}function qM(r,i){const o=r._chartjs;if(!o)return;const c=o.listeners,f=c.indexOf(i);f!==-1&&c.splice(f,1),!(c.length>0)&&(II.forEach(m=>{delete r[m]}),delete r._chartjs)}function kI(r){const i=new Set(r);return i.size===r.length?r:Array.from(i)}const CI=function(){return typeof window>"u"?function(r){return r()}:window.requestAnimationFrame}();function PI(r,i){let o=[],c=!1;return function(...f){o=f,c||(c=!0,CI.call(window,()=>{c=!1,r.apply(i,o)}))}}function WL(r,i){let o;return function(...c){return i?(clearTimeout(o),o=setTimeout(r,i,c)):r.apply(this,c),i}}const Mv=r=>r==="start"?"left":r==="end"?"right":"center",Yr=(r,i,o)=>r==="start"?i:r==="end"?o:(i+o)/2,qL=(r,i,o,c)=>r===(c?"left":"right")?o:r==="center"?(i+o)/2:i;function DI(r,i,o){const c=i.length;let f=0,m=c;if(r._sorted){const{iScale:_,_parsed:v}=r,s=_.axis,{min:S,max:P,minDefined:z,maxDefined:F}=_.getUserBounds();z&&(f=Ir(Math.min(ja(v,s,S).lo,o?c:ja(i,s,_.getPixelForValue(S)).lo),0,c-1)),F?m=Ir(Math.max(ja(v,_.axis,P,!0).hi+1,o?0:ja(i,s,_.getPixelForValue(P),!0).hi+1),f,c)-f:m=c-f}return{start:f,count:m}}function zI(r){const{xScale:i,yScale:o,_scaleRanges:c}=r,f={xmin:i.min,xmax:i.max,ymin:o.min,ymax:o.max};if(!c)return r._scaleRanges=f,!0;const m=c.xmin!==i.min||c.xmax!==i.max||c.ymin!==o.min||c.ymax!==o.max;return Object.assign(c,f),m}const tg=r=>r===0||r===1,ZM=(r,i,o)=>-(Math.pow(2,10*(r-=1))*Math.sin((r-i)*Xn/o)),XM=(r,i,o)=>Math.pow(2,-10*r)*Math.sin((r-i)*Xn/o)+1,Mf={linear:r=>r,easeInQuad:r=>r*r,easeOutQuad:r=>-r*(r-2),easeInOutQuad:r=>(r/=.5)<1?.5*r*r:-.5*(--r*(r-2)-1),easeInCubic:r=>r*r*r,easeOutCubic:r=>(r-=1)*r*r+1,easeInOutCubic:r=>(r/=.5)<1?.5*r*r*r:.5*((r-=2)*r*r+2),easeInQuart:r=>r*r*r*r,easeOutQuart:r=>-((r-=1)*r*r*r-1),easeInOutQuart:r=>(r/=.5)<1?.5*r*r*r*r:-.5*((r-=2)*r*r*r-2),easeInQuint:r=>r*r*r*r*r,easeOutQuint:r=>(r-=1)*r*r*r*r+1,easeInOutQuint:r=>(r/=.5)<1?.5*r*r*r*r*r:.5*((r-=2)*r*r*r*r+2),easeInSine:r=>-Math.cos(r*fr)+1,easeOutSine:r=>Math.sin(r*fr),easeInOutSine:r=>-.5*(Math.cos(Yn*r)-1),easeInExpo:r=>r===0?0:Math.pow(2,10*(r-1)),easeOutExpo:r=>r===1?1:-Math.pow(2,-10*r)+1,easeInOutExpo:r=>tg(r)?r:r<.5?.5*Math.pow(2,10*(r*2-1)):.5*(-Math.pow(2,-10*(r*2-1))+2),easeInCirc:r=>r>=1?r:-(Math.sqrt(1-r*r)-1),easeOutCirc:r=>Math.sqrt(1-(r-=1)*r),easeInOutCirc:r=>(r/=.5)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1),easeInElastic:r=>tg(r)?r:ZM(r,.075,.3),easeOutElastic:r=>tg(r)?r:XM(r,.075,.3),easeInOutElastic(r){return tg(r)?r:r<.5?.5*ZM(r*2,.1125,.45):.5+.5*XM(r*2-1,.1125,.45)},easeInBack(r){return r*r*((1.70158+1)*r-1.70158)},easeOutBack(r){return(r-=1)*r*((1.70158+1)*r+1.70158)+1},easeInOutBack(r){let i=1.70158;return(r/=.5)<1?.5*(r*r*(((i*=1.525)+1)*r-i)):.5*((r-=2)*r*(((i*=1.525)+1)*r+i)+2)},easeInBounce:r=>1-Mf.easeOutBounce(1-r),easeOutBounce(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375},easeInOutBounce:r=>r<.5?Mf.easeInBounce(r*2)*.5:Mf.easeOutBounce(r*2-1)*.5+.5};function Sv(r){if(r&&typeof r=="object"){const i=r.toString();return i==="[object CanvasPattern]"||i==="[object CanvasGradient]"}return!1}function YM(r){return Sv(r)?r:new TI(r)}function nx(r){return Sv(r)?r:new TI(r).saturate(.5).darken(.1).hexString()}const ZL=["x","y","borderWidth","radius","tension"],XL=["color","borderColor","backgroundColor"];function YL(r){r.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),r.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:i=>i!=="onProgress"&&i!=="onComplete"&&i!=="fn"}),r.set("animations",{colors:{type:"color",properties:XL},numbers:{type:"number",properties:ZL}}),r.describe("animations",{_fallback:"animation"}),r.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:i=>i|0}}}})}function KL(r){r.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const KM=new Map;function JL(r,i){i=i||{};const o=r+JSON.stringify(i);let c=KM.get(o);return c||(c=new Intl.NumberFormat(r,i),KM.set(o,c)),c}function Jf(r,i,o){return JL(i,o).format(r)}const LI={values(r){return Zn(r)?r:""+r},numeric(r,i,o){if(r===0)return"0";const c=this.chart.options.locale;let f,m=r;if(o.length>1){const S=Math.max(Math.abs(o[0].value),Math.abs(o[o.length-1].value));(S<1e-4||S>1e15)&&(f="scientific"),m=QL(r,o)}const _=El(Math.abs(m)),v=isNaN(_)?1:Math.max(Math.min(-1*Math.floor(_),20),0),s={notation:f,minimumFractionDigits:v,maximumFractionDigits:v};return Object.assign(s,this.options.ticks.format),Jf(r,c,s)},logarithmic(r,i,o){if(r===0)return"0";const c=o[i].significand||r/Math.pow(10,Math.floor(El(r)));return[1,2,3,5,10,15].includes(c)||i>.8*o.length?LI.numeric.call(this,r,i,o):""}};function QL(r,i){let o=i.length>3?i[2].value-i[1].value:i[1].value-i[0].value;return Math.abs(o)>=1&&r!==Math.floor(r)&&(o=r-Math.floor(r)),o}var M_={formatters:LI};function $L(r){r.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(i,o)=>o.lineWidth,tickColor:(i,o)=>o.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:M_.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),r.route("scale.ticks","color","","color"),r.route("scale.grid","color","","borderColor"),r.route("scale.border","color","","borderColor"),r.route("scale.title","color","","color"),r.describe("scale",{_fallback:!1,_scriptable:i=>!i.startsWith("before")&&!i.startsWith("after")&&i!=="callback"&&i!=="parser",_indexable:i=>i!=="borderDash"&&i!=="tickBorderDash"&&i!=="dash"}),r.describe("scales",{_fallback:"scale"}),r.describe("scale.ticks",{_scriptable:i=>i!=="backdropPadding"&&i!=="callback",_indexable:i=>i!=="backdropPadding"})}const Lc=Object.create(null),zx=Object.create(null);function Sf(r,i){if(!i)return r;const o=i.split(".");for(let c=0,f=o.length;c<f;++c){const m=o[c];r=r[m]||(r[m]=Object.create(null))}return r}function rx(r,i,o){return typeof i=="string"?Pf(Sf(r,i),o):Pf(Sf(r,""),i)}class eR{constructor(i,o){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=c=>c.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(c,f)=>nx(f.backgroundColor),this.hoverBorderColor=(c,f)=>nx(f.borderColor),this.hoverColor=(c,f)=>nx(f.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(i),this.apply(o)}set(i,o){return rx(this,i,o)}get(i){return Sf(this,i)}describe(i,o){return rx(zx,i,o)}override(i,o){return rx(Lc,i,o)}route(i,o,c,f){const m=Sf(this,i),_=Sf(this,c),v="_"+o;Object.defineProperties(m,{[v]:{value:m[o],writable:!0},[o]:{enumerable:!0,get(){const s=this[v],S=_[f];return sn(s)?Object.assign({},S,s):Gi(s,S)},set(s){this[v]=s}}})}apply(i){i.forEach(o=>o(this))}}var ar=new eR({_scriptable:r=>!r.startsWith("on"),_indexable:r=>r!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[YL,KL,$L]);function tR(r){return!r||gn(r.size)||gn(r.family)?null:(r.style?r.style+" ":"")+(r.weight?r.weight+" ":"")+r.size+"px "+r.family}function Kg(r,i,o,c,f){let m=i[f];return m||(m=i[f]=r.measureText(f).width,o.push(f)),m>c&&(c=m),c}function iR(r,i,o,c){c=c||{};let f=c.data=c.data||{},m=c.garbageCollect=c.garbageCollect||[];c.font!==i&&(f=c.data={},m=c.garbageCollect=[],c.font=i),r.save(),r.font=i;let _=0;const v=o.length;let s,S,P,z,F;for(s=0;s<v;s++)if(z=o[s],z!=null&&!Zn(z))_=Kg(r,f,m,_,z);else if(Zn(z))for(S=0,P=z.length;S<P;S++)F=z[S],F!=null&&!Zn(F)&&(_=Kg(r,f,m,_,F));r.restore();const U=m.length/2;if(U>o.length){for(s=0;s<U;s++)delete f[m[s]];m.splice(0,U)}return _}function bc(r,i,o){const c=r.currentDevicePixelRatio,f=o!==0?Math.max(o/2,.5):0;return Math.round((i-f)*c)/c+f}function JM(r,i){i=i||r.getContext("2d"),i.save(),i.resetTransform(),i.clearRect(0,0,r.width,r.height),i.restore()}function Lx(r,i,o,c){RI(r,i,o,c,null)}function RI(r,i,o,c,f){let m,_,v,s,S,P,z,F;const U=i.pointStyle,Z=i.rotation,W=i.radius;let Q=(Z||0)*BL;if(U&&typeof U=="object"&&(m=U.toString(),m==="[object HTMLImageElement]"||m==="[object HTMLCanvasElement]")){r.save(),r.translate(o,c),r.rotate(Q),r.drawImage(U,-U.width/2,-U.height/2,U.width,U.height),r.restore();return}if(!(isNaN(W)||W<=0)){switch(r.beginPath(),U){default:f?r.ellipse(o,c,f/2,W,0,0,Xn):r.arc(o,c,W,0,Xn),r.closePath();break;case"triangle":P=f?f/2:W,r.moveTo(o+Math.sin(Q)*P,c-Math.cos(Q)*W),Q+=GM,r.lineTo(o+Math.sin(Q)*P,c-Math.cos(Q)*W),Q+=GM,r.lineTo(o+Math.sin(Q)*P,c-Math.cos(Q)*W),r.closePath();break;case"rectRounded":S=W*.516,s=W-S,_=Math.cos(Q+vc)*s,z=Math.cos(Q+vc)*(f?f/2-S:s),v=Math.sin(Q+vc)*s,F=Math.sin(Q+vc)*(f?f/2-S:s),r.arc(o-z,c-v,S,Q-Yn,Q-fr),r.arc(o+F,c-_,S,Q-fr,Q),r.arc(o+z,c+v,S,Q,Q+fr),r.arc(o-F,c+_,S,Q+fr,Q+Yn),r.closePath();break;case"rect":if(!Z){s=Math.SQRT1_2*W,P=f?f/2:s,r.rect(o-P,c-s,2*P,2*s);break}Q+=vc;case"rectRot":z=Math.cos(Q)*(f?f/2:W),_=Math.cos(Q)*W,v=Math.sin(Q)*W,F=Math.sin(Q)*(f?f/2:W),r.moveTo(o-z,c-v),r.lineTo(o+F,c-_),r.lineTo(o+z,c+v),r.lineTo(o-F,c+_),r.closePath();break;case"crossRot":Q+=vc;case"cross":z=Math.cos(Q)*(f?f/2:W),_=Math.cos(Q)*W,v=Math.sin(Q)*W,F=Math.sin(Q)*(f?f/2:W),r.moveTo(o-z,c-v),r.lineTo(o+z,c+v),r.moveTo(o+F,c-_),r.lineTo(o-F,c+_);break;case"star":z=Math.cos(Q)*(f?f/2:W),_=Math.cos(Q)*W,v=Math.sin(Q)*W,F=Math.sin(Q)*(f?f/2:W),r.moveTo(o-z,c-v),r.lineTo(o+z,c+v),r.moveTo(o+F,c-_),r.lineTo(o-F,c+_),Q+=vc,z=Math.cos(Q)*(f?f/2:W),_=Math.cos(Q)*W,v=Math.sin(Q)*W,F=Math.sin(Q)*(f?f/2:W),r.moveTo(o-z,c-v),r.lineTo(o+z,c+v),r.moveTo(o+F,c-_),r.lineTo(o-F,c+_);break;case"line":_=f?f/2:Math.cos(Q)*W,v=Math.sin(Q)*W,r.moveTo(o-_,c-v),r.lineTo(o+_,c+v);break;case"dash":r.moveTo(o,c),r.lineTo(o+Math.cos(Q)*(f?f/2:W),c+Math.sin(Q)*W);break;case!1:r.closePath();break}r.fill(),i.borderWidth>0&&r.stroke()}}function Ua(r,i,o){return o=o||.5,!i||r&&r.x>i.left-o&&r.x<i.right+o&&r.y>i.top-o&&r.y<i.bottom+o}function S_(r,i){r.save(),r.beginPath(),r.rect(i.left,i.top,i.right-i.left,i.bottom-i.top),r.clip()}function E_(r){r.restore()}function nR(r,i,o,c,f){if(!i)return r.lineTo(o.x,o.y);if(f==="middle"){const m=(i.x+o.x)/2;r.lineTo(m,i.y),r.lineTo(m,o.y)}else f==="after"!=!!c?r.lineTo(i.x,o.y):r.lineTo(o.x,i.y);r.lineTo(o.x,o.y)}function rR(r,i,o,c){if(!i)return r.lineTo(o.x,o.y);r.bezierCurveTo(c?i.cp1x:i.cp2x,c?i.cp1y:i.cp2y,c?o.cp2x:o.cp1x,c?o.cp2y:o.cp1y,o.x,o.y)}function sR(r,i){i.translation&&r.translate(i.translation[0],i.translation[1]),gn(i.rotation)||r.rotate(i.rotation),i.color&&(r.fillStyle=i.color),i.textAlign&&(r.textAlign=i.textAlign),i.textBaseline&&(r.textBaseline=i.textBaseline)}function oR(r,i,o,c,f){if(f.strikethrough||f.underline){const m=r.measureText(c),_=i-m.actualBoundingBoxLeft,v=i+m.actualBoundingBoxRight,s=o-m.actualBoundingBoxAscent,S=o+m.actualBoundingBoxDescent,P=f.strikethrough?(s+S)/2:S;r.strokeStyle=r.fillStyle,r.beginPath(),r.lineWidth=f.decorationWidth||2,r.moveTo(_,P),r.lineTo(v,P),r.stroke()}}function aR(r,i){const o=r.fillStyle;r.fillStyle=i.color,r.fillRect(i.left,i.top,i.width,i.height),r.fillStyle=o}function Rc(r,i,o,c,f,m={}){const _=Zn(i)?i:[i],v=m.strokeWidth>0&&m.strokeColor!=="";let s,S;for(r.save(),r.font=f.string,sR(r,m),s=0;s<_.length;++s)S=_[s],m.backdrop&&aR(r,m.backdrop),v&&(m.strokeColor&&(r.strokeStyle=m.strokeColor),gn(m.strokeWidth)||(r.lineWidth=m.strokeWidth),r.strokeText(S,o,c,m.maxWidth)),r.fillText(S,o,c,m.maxWidth),oR(r,o,c,S,m),c+=Number(f.lineHeight);r.restore()}function Lf(r,i){const{x:o,y:c,w:f,h:m,radius:_}=i;r.arc(o+_.topLeft,c+_.topLeft,_.topLeft,1.5*Yn,Yn,!0),r.lineTo(o,c+m-_.bottomLeft),r.arc(o+_.bottomLeft,c+m-_.bottomLeft,_.bottomLeft,Yn,fr,!0),r.lineTo(o+f-_.bottomRight,c+m),r.arc(o+f-_.bottomRight,c+m-_.bottomRight,_.bottomRight,fr,0,!0),r.lineTo(o+f,c+_.topRight),r.arc(o+f-_.topRight,c+_.topRight,_.topRight,0,-fr,!0),r.lineTo(o+_.topLeft,c)}const lR=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,cR=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function uR(r,i){const o=(""+r).match(lR);if(!o||o[1]==="normal")return i*1.2;switch(r=+o[2],o[3]){case"px":return r;case"%":r/=100;break}return i*r}const hR=r=>+r||0;function Ev(r,i){const o={},c=sn(i),f=c?Object.keys(i):i,m=sn(r)?c?_=>Gi(r[_],r[i[_]]):_=>r[_]:()=>r;for(const _ of f)o[_]=hR(m(_));return o}function OI(r){return Ev(r,{top:"y",right:"x",bottom:"y",left:"x"})}function Cc(r){return Ev(r,["topLeft","topRight","bottomLeft","bottomRight"])}function $r(r){const i=OI(r);return i.width=i.left+i.right,i.height=i.top+i.bottom,i}function Mr(r,i){r=r||{},i=i||ar.font;let o=Gi(r.size,i.size);typeof o=="string"&&(o=parseInt(o,10));let c=Gi(r.style,i.style);c&&!(""+c).match(cR)&&(console.warn('Invalid font style specified: "'+c+'"'),c=void 0);const f={family:Gi(r.family,i.family),lineHeight:uR(Gi(r.lineHeight,i.lineHeight),o),size:o,style:c,weight:Gi(r.weight,i.weight),string:""};return f.string=tR(f),f}function hf(r,i,o,c){let f=!0,m,_,v;for(m=0,_=r.length;m<_;++m)if(v=r[m],v!==void 0&&(i!==void 0&&typeof v=="function"&&(v=v(i),f=!1),o!==void 0&&Zn(v)&&(v=v[o%v.length],f=!1),v!==void 0))return c&&!f&&(c.cacheable=!1),v}function dR(r,i,o){const{min:c,max:f}=r,m=MI(i,(f-c)/2),_=(v,s)=>o&&v===0?0:v+s;return{min:_(c,-Math.abs(m)),max:_(f,m)}}function Dl(r,i){return Object.assign(Object.create(r),i)}function Av(r,i=[""],o,c,f=()=>r[0]){const m=o||r;typeof c>"u"&&(c=VI("_fallback",r));const _={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:r,_rootScopes:m,_fallback:c,_getTarget:f,override:v=>Av([v,...r],i,m,c)};return new Proxy(_,{deleteProperty(v,s){return delete v[s],delete v._keys,delete r[0][s],!0},get(v,s){return FI(v,s,()=>vR(s,i,r,v))},getOwnPropertyDescriptor(v,s){return Reflect.getOwnPropertyDescriptor(v._scopes[0],s)},getPrototypeOf(){return Reflect.getPrototypeOf(r[0])},has(v,s){return $M(v).includes(s)},ownKeys(v){return $M(v)},set(v,s,S){const P=v._storage||(v._storage=f());return v[s]=P[s]=S,delete v._keys,!0}})}function lh(r,i,o,c){const f={_cacheable:!1,_proxy:r,_context:i,_subProxy:o,_stack:new Set,_descriptors:BI(r,c),setContext:m=>lh(r,m,o,c),override:m=>lh(r.override(m),i,o,c)};return new Proxy(f,{deleteProperty(m,_){return delete m[_],delete r[_],!0},get(m,_,v){return FI(m,_,()=>pR(m,_,v))},getOwnPropertyDescriptor(m,_){return m._descriptors.allKeys?Reflect.has(r,_)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(r,_)},getPrototypeOf(){return Reflect.getPrototypeOf(r)},has(m,_){return Reflect.has(r,_)},ownKeys(){return Reflect.ownKeys(r)},set(m,_,v){return r[_]=v,delete m[_],!0}})}function BI(r,i={scriptable:!0,indexable:!0}){const{_scriptable:o=i.scriptable,_indexable:c=i.indexable,_allKeys:f=i.allKeys}=r;return{allKeys:f,scriptable:o,indexable:c,isScriptable:Pl(o)?o:()=>o,isIndexable:Pl(c)?c:()=>c}}const fR=(r,i)=>r?r+bv(i):i,Iv=(r,i)=>sn(i)&&r!=="adapters"&&(Object.getPrototypeOf(i)===null||i.constructor===Object);function FI(r,i,o){if(Object.prototype.hasOwnProperty.call(r,i))return r[i];const c=o();return r[i]=c,c}function pR(r,i,o){const{_proxy:c,_context:f,_subProxy:m,_descriptors:_}=r;let v=c[i];return Pl(v)&&_.isScriptable(i)&&(v=mR(i,v,r,o)),Zn(v)&&v.length&&(v=gR(i,v,r,_.isIndexable)),Iv(i,v)&&(v=lh(v,f,m&&m[i],_)),v}function mR(r,i,o,c){const{_proxy:f,_context:m,_subProxy:_,_stack:v}=o;if(v.has(r))throw new Error("Recursion detected: "+Array.from(v).join("->")+"->"+r);v.add(r);let s=i(m,_||c);return v.delete(r),Iv(r,s)&&(s=kv(f._scopes,f,r,s)),s}function gR(r,i,o,c){const{_proxy:f,_context:m,_subProxy:_,_descriptors:v}=o;if(typeof m.index<"u"&&c(r))return i[m.index%i.length];if(sn(i[0])){const s=i,S=f._scopes.filter(P=>P!==s);i=[];for(const P of s){const z=kv(S,f,r,P);i.push(lh(z,m,_&&_[r],v))}}return i}function NI(r,i,o){return Pl(r)?r(i,o):r}const _R=(r,i)=>r===!0?i:typeof r=="string"?Cl(i,r):void 0;function yR(r,i,o,c,f){for(const m of i){const _=_R(o,m);if(_){r.add(_);const v=NI(_._fallback,o,f);if(typeof v<"u"&&v!==o&&v!==c)return v}else if(_===!1&&typeof c<"u"&&o!==c)return null}return!1}function kv(r,i,o,c){const f=i._rootScopes,m=NI(i._fallback,o,c),_=[...r,...f],v=new Set;v.add(c);let s=QM(v,_,o,m||o,c);return s===null||typeof m<"u"&&m!==o&&(s=QM(v,_,m,s,c),s===null)?!1:Av(Array.from(v),[""],f,m,()=>xR(i,o,c))}function QM(r,i,o,c,f){for(;o;)o=yR(r,i,o,c,f);return o}function xR(r,i,o){const c=r._getTarget();i in c||(c[i]={});const f=c[i];return Zn(f)&&sn(o)?o:f||{}}function vR(r,i,o,c){let f;for(const m of i)if(f=VI(fR(m,r),o),typeof f<"u")return Iv(r,f)?kv(o,c,r,f):f}function VI(r,i){for(const o of i){if(!o)continue;const c=o[r];if(typeof c<"u")return c}}function $M(r){let i=r._keys;return i||(i=r._keys=bR(r._scopes)),i}function bR(r){const i=new Set;for(const o of r)for(const c of Object.keys(o).filter(f=>!f.startsWith("_")))i.add(c);return Array.from(i)}function jI(r,i,o,c){const{iScale:f}=r,{key:m="r"}=this._parsing,_=new Array(c);let v,s,S,P;for(v=0,s=c;v<s;++v)S=v+o,P=i[S],_[v]={r:f.parse(Cl(P,m),S)};return _}const wR=Number.EPSILON||1e-14,ch=(r,i)=>i<r.length&&!r[i].skip&&r[i],UI=r=>r==="x"?"y":"x";function TR(r,i,o,c){const f=r.skip?i:r,m=i,_=o.skip?i:o,v=Dx(m,f),s=Dx(_,m);let S=v/(v+s),P=s/(v+s);S=isNaN(S)?0:S,P=isNaN(P)?0:P;const z=c*S,F=c*P;return{previous:{x:m.x-z*(_.x-f.x),y:m.y-z*(_.y-f.y)},next:{x:m.x+F*(_.x-f.x),y:m.y+F*(_.y-f.y)}}}function MR(r,i,o){const c=r.length;let f,m,_,v,s,S=ch(r,0);for(let P=0;P<c-1;++P)if(s=S,S=ch(r,P+1),!(!s||!S)){if(Tf(i[P],0,wR)){o[P]=o[P+1]=0;continue}f=o[P]/i[P],m=o[P+1]/i[P],v=Math.pow(f,2)+Math.pow(m,2),!(v<=9)&&(_=3/Math.sqrt(v),o[P]=f*_*i[P],o[P+1]=m*_*i[P])}}function SR(r,i,o="x"){const c=UI(o),f=r.length;let m,_,v,s=ch(r,0);for(let S=0;S<f;++S){if(_=v,v=s,s=ch(r,S+1),!v)continue;const P=v[o],z=v[c];_&&(m=(P-_[o])/3,v[`cp1${o}`]=P-m,v[`cp1${c}`]=z-m*i[S]),s&&(m=(s[o]-P)/3,v[`cp2${o}`]=P+m,v[`cp2${c}`]=z+m*i[S])}}function ER(r,i="x"){const o=UI(i),c=r.length,f=Array(c).fill(0),m=Array(c);let _,v,s,S=ch(r,0);for(_=0;_<c;++_)if(v=s,s=S,S=ch(r,_+1),!!s){if(S){const P=S[i]-s[i];f[_]=P!==0?(S[o]-s[o])/P:0}m[_]=v?S?Ko(f[_-1])!==Ko(f[_])?0:(f[_-1]+f[_])/2:f[_-1]:f[_]}MR(r,f,m),SR(r,m,i)}function ig(r,i,o){return Math.max(Math.min(r,o),i)}function AR(r,i){let o,c,f,m,_,v=Ua(r[0],i);for(o=0,c=r.length;o<c;++o)_=m,m=v,v=o<c-1&&Ua(r[o+1],i),m&&(f=r[o],_&&(f.cp1x=ig(f.cp1x,i.left,i.right),f.cp1y=ig(f.cp1y,i.top,i.bottom)),v&&(f.cp2x=ig(f.cp2x,i.left,i.right),f.cp2y=ig(f.cp2y,i.top,i.bottom)))}function IR(r,i,o,c,f){let m,_,v,s;if(i.spanGaps&&(r=r.filter(S=>!S.skip)),i.cubicInterpolationMode==="monotone")ER(r,f);else{let S=c?r[r.length-1]:r[0];for(m=0,_=r.length;m<_;++m)v=r[m],s=TR(S,v,r[Math.min(m+1,_-(c?0:1))%_],i.tension),v.cp1x=s.previous.x,v.cp1y=s.previous.y,v.cp2x=s.next.x,v.cp2y=s.next.y,S=v}i.capBezierPoints&&AR(r,o)}function Cv(){return typeof window<"u"&&typeof document<"u"}function Pv(r){let i=r.parentNode;return i&&i.toString()==="[object ShadowRoot]"&&(i=i.host),i}function Jg(r,i,o){let c;return typeof r=="string"?(c=parseInt(r,10),r.indexOf("%")!==-1&&(c=c/100*i.parentNode[o])):c=r,c}const A_=r=>r.ownerDocument.defaultView.getComputedStyle(r,null);function kR(r,i){return A_(r).getPropertyValue(i)}const CR=["top","right","bottom","left"];function Pc(r,i,o){const c={};o=o?"-"+o:"";for(let f=0;f<4;f++){const m=CR[f];c[m]=parseFloat(r[i+"-"+m+o])||0}return c.width=c.left+c.right,c.height=c.top+c.bottom,c}const PR=(r,i,o)=>(r>0||i>0)&&(!o||!o.shadowRoot);function DR(r,i){const o=r.touches,c=o&&o.length?o[0]:r,{offsetX:f,offsetY:m}=c;let _=!1,v,s;if(PR(f,m,r.target))v=f,s=m;else{const S=i.getBoundingClientRect();v=c.clientX-S.left,s=c.clientY-S.top,_=!0}return{x:v,y:s,box:_}}function Mc(r,i){if("native"in r)return r;const{canvas:o,currentDevicePixelRatio:c}=i,f=A_(o),m=f.boxSizing==="border-box",_=Pc(f,"padding"),v=Pc(f,"border","width"),{x:s,y:S,box:P}=DR(r,o),z=_.left+(P&&v.left),F=_.top+(P&&v.top);let{width:U,height:Z}=i;return m&&(U-=_.width+v.width,Z-=_.height+v.height),{x:Math.round((s-z)/U*o.width/c),y:Math.round((S-F)/Z*o.height/c)}}function zR(r,i,o){let c,f;if(i===void 0||o===void 0){const m=Pv(r);if(!m)i=r.clientWidth,o=r.clientHeight;else{const _=m.getBoundingClientRect(),v=A_(m),s=Pc(v,"border","width"),S=Pc(v,"padding");i=_.width-S.width-s.width,o=_.height-S.height-s.height,c=Jg(v.maxWidth,m,"clientWidth"),f=Jg(v.maxHeight,m,"clientHeight")}}return{width:i,height:o,maxWidth:c||Yg,maxHeight:f||Yg}}const ng=r=>Math.round(r*10)/10;function LR(r,i,o,c){const f=A_(r),m=Pc(f,"margin"),_=Jg(f.maxWidth,r,"clientWidth")||Yg,v=Jg(f.maxHeight,r,"clientHeight")||Yg,s=zR(r,i,o);let{width:S,height:P}=s;if(f.boxSizing==="content-box"){const F=Pc(f,"border","width"),U=Pc(f,"padding");S-=U.width+F.width,P-=U.height+F.height}return S=Math.max(0,S-m.width),P=Math.max(0,c?S/c:P-m.height),S=ng(Math.min(S,_,s.maxWidth)),P=ng(Math.min(P,v,s.maxHeight)),S&&!P&&(P=ng(S/2)),(i!==void 0||o!==void 0)&&c&&s.height&&P>s.height&&(P=s.height,S=ng(Math.floor(P*c))),{width:S,height:P}}function eS(r,i,o){const c=i||1,f=Math.floor(r.height*c),m=Math.floor(r.width*c);r.height=Math.floor(r.height),r.width=Math.floor(r.width);const _=r.canvas;return _.style&&(o||!_.style.height&&!_.style.width)&&(_.style.height=`${r.height}px`,_.style.width=`${r.width}px`),r.currentDevicePixelRatio!==c||_.height!==f||_.width!==m?(r.currentDevicePixelRatio=c,_.height=f,_.width=m,r.ctx.setTransform(c,0,0,c,0,0),!0):!1}const RR=function(){let r=!1;try{const i={get passive(){return r=!0,!1}};Cv()&&(window.addEventListener("test",null,i),window.removeEventListener("test",null,i))}catch{}return r}();function tS(r,i){const o=kR(r,i),c=o&&o.match(/^(\d+)(\.\d+)?px$/);return c?+c[1]:void 0}function Sc(r,i,o,c){return{x:r.x+o*(i.x-r.x),y:r.y+o*(i.y-r.y)}}function OR(r,i,o,c){return{x:r.x+o*(i.x-r.x),y:c==="middle"?o<.5?r.y:i.y:c==="after"?o<1?r.y:i.y:o>0?i.y:r.y}}function BR(r,i,o,c){const f={x:r.cp2x,y:r.cp2y},m={x:i.cp1x,y:i.cp1y},_=Sc(r,f,o),v=Sc(f,m,o),s=Sc(m,i,o),S=Sc(_,v,o),P=Sc(v,s,o);return Sc(S,P,o)}const FR=function(r,i){return{x(o){return r+r+i-o},setWidth(o){i=o},textAlign(o){return o==="center"?o:o==="right"?"left":"right"},xPlus(o,c){return o-c},leftForLtr(o,c){return o-c}}},NR=function(){return{x(r){return r},setWidth(r){},textAlign(r){return r},xPlus(r,i){return r+i},leftForLtr(r,i){return r}}};function th(r,i,o){return r?FR(i,o):NR()}function GI(r,i){let o,c;(i==="ltr"||i==="rtl")&&(o=r.canvas.style,c=[o.getPropertyValue("direction"),o.getPropertyPriority("direction")],o.setProperty("direction",i,"important"),r.prevTextDirection=c)}function HI(r,i){i!==void 0&&(delete r.prevTextDirection,r.canvas.style.setProperty("direction",i[0],i[1]))}function WI(r){return r==="angle"?{between:zf,compare:VL,normalize:Rs}:{between:Va,compare:(i,o)=>i-o,normalize:i=>i}}function iS({start:r,end:i,count:o,loop:c,style:f}){return{start:r%o,end:i%o,loop:c&&(i-r+1)%o===0,style:f}}function VR(r,i,o){const{property:c,start:f,end:m}=o,{between:_,normalize:v}=WI(c),s=i.length;let{start:S,end:P,loop:z}=r,F,U;if(z){for(S+=s,P+=s,F=0,U=s;F<U&&_(v(i[S%s][c]),f,m);++F)S--,P--;S%=s,P%=s}return P<S&&(P+=s),{start:S,end:P,loop:z,style:r.style}}function qI(r,i,o){if(!o)return[r];const{property:c,start:f,end:m}=o,_=i.length,{compare:v,between:s,normalize:S}=WI(c),{start:P,end:z,loop:F,style:U}=VR(r,i,o),Z=[];let W=!1,Q=null,re,ie,ve;const pe=()=>s(f,ve,re)&&v(f,ve)!==0,ke=()=>v(m,re)===0||s(m,ve,re),Me=()=>W||pe(),Ye=()=>!W||ke();for(let ot=P,Mt=P;ot<=z;++ot)ie=i[ot%_],!ie.skip&&(re=S(ie[c]),re!==ve&&(W=s(re,f,m),Q===null&&Me()&&(Q=v(re,f)===0?ot:Mt),Q!==null&&Ye()&&(Z.push(iS({start:Q,end:ot,loop:F,count:_,style:U})),Q=null),Mt=ot,ve=re));return Q!==null&&Z.push(iS({start:Q,end:z,loop:F,count:_,style:U})),Z}function ZI(r,i){const o=[],c=r.segments;for(let f=0;f<c.length;f++){const m=qI(c[f],r.points,i);m.length&&o.push(...m)}return o}function jR(r,i,o,c){let f=0,m=i-1;if(o&&!c)for(;f<i&&!r[f].skip;)f++;for(;f<i&&r[f].skip;)f++;for(f%=i,o&&(m+=f);m>f&&r[m%i].skip;)m--;return m%=i,{start:f,end:m}}function UR(r,i,o,c){const f=r.length,m=[];let _=i,v=r[i],s;for(s=i+1;s<=o;++s){const S=r[s%f];S.skip||S.stop?v.skip||(c=!1,m.push({start:i%f,end:(s-1)%f,loop:c}),i=_=S.stop?s:null):(_=s,v.skip&&(i=s)),v=S}return _!==null&&m.push({start:i%f,end:_%f,loop:c}),m}function GR(r,i){const o=r.points,c=r.options.spanGaps,f=o.length;if(!f)return[];const m=!!r._loop,{start:_,end:v}=jR(o,f,m,c);if(c===!0)return nS(r,[{start:_,end:v,loop:m}],o,i);const s=v<_?v+f:v,S=!!r._fullLoop&&_===0&&v===f-1;return nS(r,UR(o,_,s,S),o,i)}function nS(r,i,o,c){return!c||!c.setContext||!o?i:HR(r,i,o,c)}function HR(r,i,o,c){const f=r._chart.getContext(),m=rS(r.options),{_datasetIndex:_,options:{spanGaps:v}}=r,s=o.length,S=[];let P=m,z=i[0].start,F=z;function U(Z,W,Q,re){const ie=v?-1:1;if(Z!==W){for(Z+=s;o[Z%s].skip;)Z-=ie;for(;o[W%s].skip;)W+=ie;Z%s!==W%s&&(S.push({start:Z%s,end:W%s,loop:Q,style:re}),P=re,z=W%s)}}for(const Z of i){z=v?z:Z.start;let W=o[z%s],Q;for(F=z+1;F<=Z.end;F++){const re=o[F%s];Q=rS(c.setContext(Dl(f,{type:"segment",p0:W,p1:re,p0DataIndex:(F-1)%s,p1DataIndex:F%s,datasetIndex:_}))),WR(Q,P)&&U(z,F-1,Z.loop,P),W=re,P=Q}z<F-1&&U(z,F-1,Z.loop,P)}return S}function rS(r){return{backgroundColor:r.backgroundColor,borderCapStyle:r.borderCapStyle,borderDash:r.borderDash,borderDashOffset:r.borderDashOffset,borderJoinStyle:r.borderJoinStyle,borderWidth:r.borderWidth,borderColor:r.borderColor}}function WR(r,i){if(!i)return!1;const o=[],c=function(f,m){return Sv(m)?(o.includes(m)||o.push(m),o.indexOf(m)):m};return JSON.stringify(r,c)!==JSON.stringify(i,c)}/*!
 * Chart.js v4.4.2
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */class qR{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(i,o,c,f){const m=o.listeners[f],_=o.duration;m.forEach(v=>v({chart:i,initial:o.initial,numSteps:_,currentStep:Math.min(c-o.start,_)}))}_refresh(){this._request||(this._running=!0,this._request=CI.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(i=Date.now()){let o=0;this._charts.forEach((c,f)=>{if(!c.running||!c.items.length)return;const m=c.items;let _=m.length-1,v=!1,s;for(;_>=0;--_)s=m[_],s._active?(s._total>c.duration&&(c.duration=s._total),s.tick(i),v=!0):(m[_]=m[m.length-1],m.pop());v&&(f.draw(),this._notify(f,c,i,"progress")),m.length||(c.running=!1,this._notify(f,c,i,"complete"),c.initial=!1),o+=m.length}),this._lastDate=i,o===0&&(this._running=!1)}_getAnims(i){const o=this._charts;let c=o.get(i);return c||(c={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},o.set(i,c)),c}listen(i,o,c){this._getAnims(i).listeners[o].push(c)}add(i,o){!o||!o.length||this._getAnims(i).items.push(...o)}has(i){return this._getAnims(i).items.length>0}start(i){const o=this._charts.get(i);o&&(o.running=!0,o.start=Date.now(),o.duration=o.items.reduce((c,f)=>Math.max(c,f._duration),0),this._refresh())}running(i){if(!this._running)return!1;const o=this._charts.get(i);return!(!o||!o.running||!o.items.length)}stop(i){const o=this._charts.get(i);if(!o||!o.items.length)return;const c=o.items;let f=c.length-1;for(;f>=0;--f)c[f].cancel();o.items=[],this._notify(i,o,Date.now(),"complete")}remove(i){return this._charts.delete(i)}}var La=new qR;const sS="transparent",ZR={boolean(r,i,o){return o>.5?i:r},color(r,i,o){const c=YM(r||sS),f=c.valid&&YM(i||sS);return f&&f.valid?f.mix(c,o).hexString():i},number(r,i,o){return r+(i-r)*o}};class XR{constructor(i,o,c,f){const m=o[c];f=hf([i.to,f,m,i.from]);const _=hf([i.from,m,f]);this._active=!0,this._fn=i.fn||ZR[i.type||typeof _],this._easing=Mf[i.easing]||Mf.linear,this._start=Math.floor(Date.now()+(i.delay||0)),this._duration=this._total=Math.floor(i.duration),this._loop=!!i.loop,this._target=o,this._prop=c,this._from=_,this._to=f,this._promises=void 0}active(){return this._active}update(i,o,c){if(this._active){this._notify(!1);const f=this._target[this._prop],m=c-this._start,_=this._duration-m;this._start=c,this._duration=Math.floor(Math.max(_,i.duration)),this._total+=m,this._loop=!!i.loop,this._to=hf([i.to,o,f,i.from]),this._from=hf([i.from,f,o])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(i){const o=i-this._start,c=this._duration,f=this._prop,m=this._from,_=this._loop,v=this._to;let s;if(this._active=m!==v&&(_||o<c),!this._active){this._target[f]=v,this._notify(!0);return}if(o<0){this._target[f]=m;return}s=o/c%2,s=_&&s>1?2-s:s,s=this._easing(Math.min(1,Math.max(0,s))),this._target[f]=this._fn(m,v,s)}wait(){const i=this._promises||(this._promises=[]);return new Promise((o,c)=>{i.push({res:o,rej:c})})}_notify(i){const o=i?"res":"rej",c=this._promises||[];for(let f=0;f<c.length;f++)c[f][o]()}}class XI{constructor(i,o){this._chart=i,this._properties=new Map,this.configure(o)}configure(i){if(!sn(i))return;const o=Object.keys(ar.animation),c=this._properties;Object.getOwnPropertyNames(i).forEach(f=>{const m=i[f];if(!sn(m))return;const _={};for(const v of o)_[v]=m[v];(Zn(m.properties)&&m.properties||[f]).forEach(v=>{(v===f||!c.has(v))&&c.set(v,_)})})}_animateOptions(i,o){const c=o.options,f=KR(i,c);if(!f)return[];const m=this._createAnimations(f,c);return c.$shared&&YR(i.options.$animations,c).then(()=>{i.options=c},()=>{}),m}_createAnimations(i,o){const c=this._properties,f=[],m=i.$animations||(i.$animations={}),_=Object.keys(o),v=Date.now();let s;for(s=_.length-1;s>=0;--s){const S=_[s];if(S.charAt(0)==="$")continue;if(S==="options"){f.push(...this._animateOptions(i,o));continue}const P=o[S];let z=m[S];const F=c.get(S);if(z)if(F&&z.active()){z.update(F,P,v);continue}else z.cancel();if(!F||!F.duration){i[S]=P;continue}m[S]=z=new XR(F,i,S,P),f.push(z)}return f}update(i,o){if(this._properties.size===0){Object.assign(i,o);return}const c=this._createAnimations(i,o);if(c.length)return La.add(this._chart,c),!0}}function YR(r,i){const o=[],c=Object.keys(i);for(let f=0;f<c.length;f++){const m=r[c[f]];m&&m.active()&&o.push(m.wait())}return Promise.all(o)}function KR(r,i){if(!i)return;let o=r.options;if(!o){r.options=i;return}return o.$shared&&(r.options=o=Object.assign({},o,{$shared:!1,$animations:{}})),o}function oS(r,i){const o=r&&r.options||{},c=o.reverse,f=o.min===void 0?i:0,m=o.max===void 0?i:0;return{start:c?m:f,end:c?f:m}}function JR(r,i,o){if(o===!1)return!1;const c=oS(r,o),f=oS(i,o);return{top:f.end,right:c.end,bottom:f.start,left:c.start}}function QR(r){let i,o,c,f;return sn(r)?(i=r.top,o=r.right,c=r.bottom,f=r.left):i=o=c=f=r,{top:i,right:o,bottom:c,left:f,disabled:r===!1}}function YI(r,i){const o=[],c=r._getSortedDatasetMetas(i);let f,m;for(f=0,m=c.length;f<m;++f)o.push(c[f].index);return o}function aS(r,i,o,c={}){const f=r.keys,m=c.mode==="single";let _,v,s,S;if(i!==null){for(_=0,v=f.length;_<v;++_){if(s=+f[_],s===o){if(c.all)continue;break}S=r.values[s],or(S)&&(m||i===0||Ko(i)===Ko(S))&&(i+=S)}return i}}function $R(r){const i=Object.keys(r),o=new Array(i.length);let c,f,m;for(c=0,f=i.length;c<f;++c)m=i[c],o[c]={x:m,y:r[m]};return o}function lS(r,i){const o=r&&r.options.stacked;return o||o===void 0&&i.stack!==void 0}function e4(r,i,o){return`${r.id}.${i.id}.${o.stack||o.type}`}function t4(r){const{min:i,max:o,minDefined:c,maxDefined:f}=r.getUserBounds();return{min:c?i:Number.NEGATIVE_INFINITY,max:f?o:Number.POSITIVE_INFINITY}}function i4(r,i,o){const c=r[i]||(r[i]={});return c[o]||(c[o]={})}function cS(r,i,o,c){for(const f of i.getMatchingVisibleMetas(c).reverse()){const m=r[f.index];if(o&&m>0||!o&&m<0)return f.index}return null}function uS(r,i){const{chart:o,_cachedMeta:c}=r,f=o._stacks||(o._stacks={}),{iScale:m,vScale:_,index:v}=c,s=m.axis,S=_.axis,P=e4(m,_,c),z=i.length;let F;for(let U=0;U<z;++U){const Z=i[U],{[s]:W,[S]:Q}=Z,re=Z._stacks||(Z._stacks={});F=re[S]=i4(f,P,W),F[v]=Q,F._top=cS(F,_,!0,c.type),F._bottom=cS(F,_,!1,c.type);const ie=F._visualValues||(F._visualValues={});ie[v]=Q}}function sx(r,i){const o=r.scales;return Object.keys(o).filter(c=>o[c].axis===i).shift()}function n4(r,i){return Dl(r,{active:!1,dataset:void 0,datasetIndex:i,index:i,mode:"default",type:"dataset"})}function r4(r,i,o){return Dl(r,{active:!1,dataIndex:i,parsed:void 0,raw:void 0,element:o,index:i,mode:"default",type:"data"})}function $d(r,i){const o=r.controller.index,c=r.vScale&&r.vScale.axis;if(c){i=i||r._parsed;for(const f of i){const m=f._stacks;if(!m||m[c]===void 0||m[c][o]===void 0)return;delete m[c][o],m[c]._visualValues!==void 0&&m[c]._visualValues[o]!==void 0&&delete m[c]._visualValues[o]}}}const ox=r=>r==="reset"||r==="none",hS=(r,i)=>i?r:Object.assign({},r),s4=(r,i,o)=>r&&!i.hidden&&i._stacked&&{keys:YI(o,!0),values:null};class vo{constructor(i,o){this.chart=i,this._ctx=i.ctx,this.index=o,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const i=this._cachedMeta;this.configure(),this.linkScales(),i._stacked=lS(i.vScale,i),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(i){this.index!==i&&$d(this._cachedMeta),this.index=i}linkScales(){const i=this.chart,o=this._cachedMeta,c=this.getDataset(),f=(z,F,U,Z)=>z==="x"?F:z==="r"?Z:U,m=o.xAxisID=Gi(c.xAxisID,sx(i,"x")),_=o.yAxisID=Gi(c.yAxisID,sx(i,"y")),v=o.rAxisID=Gi(c.rAxisID,sx(i,"r")),s=o.indexAxis,S=o.iAxisID=f(s,m,_,v),P=o.vAxisID=f(s,_,m,v);o.xScale=this.getScaleForId(m),o.yScale=this.getScaleForId(_),o.rScale=this.getScaleForId(v),o.iScale=this.getScaleForId(S),o.vScale=this.getScaleForId(P)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(i){return this.chart.scales[i]}_getOtherScale(i){const o=this._cachedMeta;return i===o.iScale?o.vScale:o.iScale}reset(){this._update("reset")}_destroy(){const i=this._cachedMeta;this._data&&qM(this._data,this),i._stacked&&$d(i)}_dataCheck(){const i=this.getDataset(),o=i.data||(i.data=[]),c=this._data;if(sn(o))this._data=$R(o);else if(c!==o){if(c){qM(c,this);const f=this._cachedMeta;$d(f),f._parsed=[]}o&&Object.isExtensible(o)&&HL(o,this),this._syncList=[],this._data=o}}addElements(){const i=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(i.dataset=new this.datasetElementType)}buildOrUpdateElements(i){const o=this._cachedMeta,c=this.getDataset();let f=!1;this._dataCheck();const m=o._stacked;o._stacked=lS(o.vScale,o),o.stack!==c.stack&&(f=!0,$d(o),o.stack=c.stack),this._resyncElements(i),(f||m!==o._stacked)&&uS(this,o._parsed)}configure(){const i=this.chart.config,o=i.datasetScopeKeys(this._type),c=i.getOptionScopes(this.getDataset(),o,!0);this.options=i.createResolver(c,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(i,o){const{_cachedMeta:c,_data:f}=this,{iScale:m,_stacked:_}=c,v=m.axis;let s=i===0&&o===f.length?!0:c._sorted,S=i>0&&c._parsed[i-1],P,z,F;if(this._parsing===!1)c._parsed=f,c._sorted=!0,F=f;else{Zn(f[i])?F=this.parseArrayData(c,f,i,o):sn(f[i])?F=this.parseObjectData(c,f,i,o):F=this.parsePrimitiveData(c,f,i,o);const U=()=>z[v]===null||S&&z[v]<S[v];for(P=0;P<o;++P)c._parsed[P+i]=z=F[P],s&&(U()&&(s=!1),S=z);c._sorted=s}_&&uS(this,F)}parsePrimitiveData(i,o,c,f){const{iScale:m,vScale:_}=i,v=m.axis,s=_.axis,S=m.getLabels(),P=m===_,z=new Array(f);let F,U,Z;for(F=0,U=f;F<U;++F)Z=F+c,z[F]={[v]:P||m.parse(S[Z],Z),[s]:_.parse(o[Z],Z)};return z}parseArrayData(i,o,c,f){const{xScale:m,yScale:_}=i,v=new Array(f);let s,S,P,z;for(s=0,S=f;s<S;++s)P=s+c,z=o[P],v[s]={x:m.parse(z[0],P),y:_.parse(z[1],P)};return v}parseObjectData(i,o,c,f){const{xScale:m,yScale:_}=i,{xAxisKey:v="x",yAxisKey:s="y"}=this._parsing,S=new Array(f);let P,z,F,U;for(P=0,z=f;P<z;++P)F=P+c,U=o[F],S[P]={x:m.parse(Cl(U,v),F),y:_.parse(Cl(U,s),F)};return S}getParsed(i){return this._cachedMeta._parsed[i]}getDataElement(i){return this._cachedMeta.data[i]}applyStack(i,o,c){const f=this.chart,m=this._cachedMeta,_=o[i.axis],v={keys:YI(f,!0),values:o._stacks[i.axis]._visualValues};return aS(v,_,m.index,{mode:c})}updateRangeFromParsed(i,o,c,f){const m=c[o.axis];let _=m===null?NaN:m;const v=f&&c._stacks[o.axis];f&&v&&(f.values=v,_=aS(f,m,this._cachedMeta.index)),i.min=Math.min(i.min,_),i.max=Math.max(i.max,_)}getMinMax(i,o){const c=this._cachedMeta,f=c._parsed,m=c._sorted&&i===c.iScale,_=f.length,v=this._getOtherScale(i),s=s4(o,c,this.chart),S={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:P,max:z}=t4(v);let F,U;function Z(){U=f[F];const W=U[v.axis];return!or(U[i.axis])||P>W||z<W}for(F=0;F<_&&!(!Z()&&(this.updateRangeFromParsed(S,i,U,s),m));++F);if(m){for(F=_-1;F>=0;--F)if(!Z()){this.updateRangeFromParsed(S,i,U,s);break}}return S}getAllParsedValues(i){const o=this._cachedMeta._parsed,c=[];let f,m,_;for(f=0,m=o.length;f<m;++f)_=o[f][i.axis],or(_)&&c.push(_);return c}getMaxOverflow(){return!1}getLabelAndValue(i){const o=this._cachedMeta,c=o.iScale,f=o.vScale,m=this.getParsed(i);return{label:c?""+c.getLabelForValue(m[c.axis]):"",value:f?""+f.getLabelForValue(m[f.axis]):""}}_update(i){const o=this._cachedMeta;this.update(i||"default"),o._clip=QR(Gi(this.options.clip,JR(o.xScale,o.yScale,this.getMaxOverflow())))}update(i){}draw(){const i=this._ctx,o=this.chart,c=this._cachedMeta,f=c.data||[],m=o.chartArea,_=[],v=this._drawStart||0,s=this._drawCount||f.length-v,S=this.options.drawActiveElementsOnTop;let P;for(c.dataset&&c.dataset.draw(i,m,v,s),P=v;P<v+s;++P){const z=f[P];z.hidden||(z.active&&S?_.push(z):z.draw(i,m))}for(P=0;P<_.length;++P)_[P].draw(i,m)}getStyle(i,o){const c=o?"active":"default";return i===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(c):this.resolveDataElementOptions(i||0,c)}getContext(i,o,c){const f=this.getDataset();let m;if(i>=0&&i<this._cachedMeta.data.length){const _=this._cachedMeta.data[i];m=_.$context||(_.$context=r4(this.getContext(),i,_)),m.parsed=this.getParsed(i),m.raw=f.data[i],m.index=m.dataIndex=i}else m=this.$context||(this.$context=n4(this.chart.getContext(),this.index)),m.dataset=f,m.index=m.datasetIndex=this.index;return m.active=!!o,m.mode=c,m}resolveDatasetElementOptions(i){return this._resolveElementOptions(this.datasetElementType.id,i)}resolveDataElementOptions(i,o){return this._resolveElementOptions(this.dataElementType.id,o,i)}_resolveElementOptions(i,o="default",c){const f=o==="active",m=this._cachedDataOpts,_=i+"-"+o,v=m[_],s=this.enableOptionSharing&&Df(c);if(v)return hS(v,s);const S=this.chart.config,P=S.datasetElementScopeKeys(this._type,i),z=f?[`${i}Hover`,"hover",i,""]:[i,""],F=S.getOptionScopes(this.getDataset(),P),U=Object.keys(ar.elements[i]),Z=()=>this.getContext(c,f,o),W=S.resolveNamedOptions(F,U,Z,z);return W.$shared&&(W.$shared=s,m[_]=Object.freeze(hS(W,s))),W}_resolveAnimations(i,o,c){const f=this.chart,m=this._cachedDataOpts,_=`animation-${o}`,v=m[_];if(v)return v;let s;if(f.options.animation!==!1){const P=this.chart.config,z=P.datasetAnimationScopeKeys(this._type,o),F=P.getOptionScopes(this.getDataset(),z);s=P.createResolver(F,this.getContext(i,c,o))}const S=new XI(f,s&&s.animations);return s&&s._cacheable&&(m[_]=Object.freeze(S)),S}getSharedOptions(i){if(i.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},i))}includeOptions(i,o){return!o||ox(i)||this.chart._animationsDisabled}_getSharedOptions(i,o){const c=this.resolveDataElementOptions(i,o),f=this._sharedOptions,m=this.getSharedOptions(c),_=this.includeOptions(o,m)||m!==f;return this.updateSharedOptions(m,o,c),{sharedOptions:m,includeOptions:_}}updateElement(i,o,c,f){ox(f)?Object.assign(i,c):this._resolveAnimations(o,f).update(i,c)}updateSharedOptions(i,o,c){i&&!ox(o)&&this._resolveAnimations(void 0,o).update(i,c)}_setStyle(i,o,c,f){i.active=f;const m=this.getStyle(o,f);this._resolveAnimations(o,c,f).update(i,{options:!f&&this.getSharedOptions(m)||m})}removeHoverStyle(i,o,c){this._setStyle(i,c,"active",!1)}setHoverStyle(i,o,c){this._setStyle(i,c,"active",!0)}_removeDatasetHoverStyle(){const i=this._cachedMeta.dataset;i&&this._setStyle(i,void 0,"active",!1)}_setDatasetHoverStyle(){const i=this._cachedMeta.dataset;i&&this._setStyle(i,void 0,"active",!0)}_resyncElements(i){const o=this._data,c=this._cachedMeta.data;for(const[v,s,S]of this._syncList)this[v](s,S);this._syncList=[];const f=c.length,m=o.length,_=Math.min(m,f);_&&this.parse(0,_),m>f?this._insertElements(f,m-f,i):m<f&&this._removeElements(m,f-m)}_insertElements(i,o,c=!0){const f=this._cachedMeta,m=f.data,_=i+o;let v;const s=S=>{for(S.length+=o,v=S.length-1;v>=_;v--)S[v]=S[v-o]};for(s(m),v=i;v<_;++v)m[v]=new this.dataElementType;this._parsing&&s(f._parsed),this.parse(i,o),c&&this.updateElements(m,i,o,"reset")}updateElements(i,o,c,f){}_removeElements(i,o){const c=this._cachedMeta;if(this._parsing){const f=c._parsed.splice(i,o);c._stacked&&$d(c,f)}c.data.splice(i,o)}_sync(i){if(this._parsing)this._syncList.push(i);else{const[o,c,f]=i;this[o](c,f)}this.chart._dataChanges.push([this.index,...i])}_onDataPush(){const i=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-i,i])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(i,o){o&&this._sync(["_removeElements",i,o]);const c=arguments.length-2;c&&this._sync(["_insertElements",i,c])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}qt(vo,"defaults",{}),qt(vo,"datasetElementType",null),qt(vo,"dataElementType",null);function o4(r,i){if(!r._cache.$bar){const o=r.getMatchingVisibleMetas(i);let c=[];for(let f=0,m=o.length;f<m;f++)c=c.concat(o[f].controller.getAllParsedValues(r));r._cache.$bar=kI(c.sort((f,m)=>f-m))}return r._cache.$bar}function a4(r){const i=r.iScale,o=o4(i,r.type);let c=i._length,f,m,_,v;const s=()=>{_===32767||_===-32768||(Df(v)&&(c=Math.min(c,Math.abs(_-v)||c)),v=_)};for(f=0,m=o.length;f<m;++f)_=i.getPixelForValue(o[f]),s();for(v=void 0,f=0,m=i.ticks.length;f<m;++f)_=i.getPixelForTick(f),s();return c}function l4(r,i,o,c){const f=o.barThickness;let m,_;return gn(f)?(m=i.min*o.categoryPercentage,_=o.barPercentage):(m=f*c,_=1),{chunk:m/c,ratio:_,start:i.pixels[r]-m/2}}function c4(r,i,o,c){const f=i.pixels,m=f[r];let _=r>0?f[r-1]:null,v=r<f.length-1?f[r+1]:null;const s=o.categoryPercentage;_===null&&(_=m-(v===null?i.end-i.start:v-m)),v===null&&(v=m+m-_);const S=m-(m-Math.min(_,v))/2*s;return{chunk:Math.abs(v-_)/2*s/c,ratio:o.barPercentage,start:S}}function u4(r,i,o,c){const f=o.parse(r[0],c),m=o.parse(r[1],c),_=Math.min(f,m),v=Math.max(f,m);let s=_,S=v;Math.abs(_)>Math.abs(v)&&(s=v,S=_),i[o.axis]=S,i._custom={barStart:s,barEnd:S,start:f,end:m,min:_,max:v}}function KI(r,i,o,c){return Zn(r)?u4(r,i,o,c):i[o.axis]=o.parse(r,c),i}function dS(r,i,o,c){const f=r.iScale,m=r.vScale,_=f.getLabels(),v=f===m,s=[];let S,P,z,F;for(S=o,P=o+c;S<P;++S)F=i[S],z={},z[f.axis]=v||f.parse(_[S],S),s.push(KI(F,z,m,S));return s}function ax(r){return r&&r.barStart!==void 0&&r.barEnd!==void 0}function h4(r,i,o){return r!==0?Ko(r):(i.isHorizontal()?1:-1)*(i.min>=o?1:-1)}function d4(r){let i,o,c,f,m;return r.horizontal?(i=r.base>r.x,o="left",c="right"):(i=r.base<r.y,o="bottom",c="top"),i?(f="end",m="start"):(f="start",m="end"),{start:o,end:c,reverse:i,top:f,bottom:m}}function f4(r,i,o,c){let f=i.borderSkipped;const m={};if(!f){r.borderSkipped=m;return}if(f===!0){r.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:_,end:v,reverse:s,top:S,bottom:P}=d4(r);f==="middle"&&o&&(r.enableBorderRadius=!0,(o._top||0)===c?f=S:(o._bottom||0)===c?f=P:(m[fS(P,_,v,s)]=!0,f=S)),m[fS(f,_,v,s)]=!0,r.borderSkipped=m}function fS(r,i,o,c){return c?(r=p4(r,i,o),r=pS(r,o,i)):r=pS(r,i,o),r}function p4(r,i,o){return r===i?o:r===o?i:r}function pS(r,i,o){return r==="start"?i:r==="end"?o:r}function m4(r,{inflateAmount:i},o){r.inflateAmount=i==="auto"?o===1?.33:0:i}class vg extends vo{parsePrimitiveData(i,o,c,f){return dS(i,o,c,f)}parseArrayData(i,o,c,f){return dS(i,o,c,f)}parseObjectData(i,o,c,f){const{iScale:m,vScale:_}=i,{xAxisKey:v="x",yAxisKey:s="y"}=this._parsing,S=m.axis==="x"?v:s,P=_.axis==="x"?v:s,z=[];let F,U,Z,W;for(F=c,U=c+f;F<U;++F)W=o[F],Z={},Z[m.axis]=m.parse(Cl(W,S),F),z.push(KI(Cl(W,P),Z,_,F));return z}updateRangeFromParsed(i,o,c,f){super.updateRangeFromParsed(i,o,c,f);const m=c._custom;m&&o===this._cachedMeta.vScale&&(i.min=Math.min(i.min,m.min),i.max=Math.max(i.max,m.max))}getMaxOverflow(){return 0}getLabelAndValue(i){const o=this._cachedMeta,{iScale:c,vScale:f}=o,m=this.getParsed(i),_=m._custom,v=ax(_)?"["+_.start+", "+_.end+"]":""+f.getLabelForValue(m[f.axis]);return{label:""+c.getLabelForValue(m[c.axis]),value:v}}initialize(){this.enableOptionSharing=!0,super.initialize();const i=this._cachedMeta;i.stack=this.getDataset().stack}update(i){const o=this._cachedMeta;this.updateElements(o.data,0,o.data.length,i)}updateElements(i,o,c,f){const m=f==="reset",{index:_,_cachedMeta:{vScale:v}}=this,s=v.getBasePixel(),S=v.isHorizontal(),P=this._getRuler(),{sharedOptions:z,includeOptions:F}=this._getSharedOptions(o,f);for(let U=o;U<o+c;U++){const Z=this.getParsed(U),W=m||gn(Z[v.axis])?{base:s,head:s}:this._calculateBarValuePixels(U),Q=this._calculateBarIndexPixels(U,P),re=(Z._stacks||{})[v.axis],ie={horizontal:S,base:W.base,enableBorderRadius:!re||ax(Z._custom)||_===re._top||_===re._bottom,x:S?W.head:Q.center,y:S?Q.center:W.head,height:S?Q.size:Math.abs(W.size),width:S?Math.abs(W.size):Q.size};F&&(ie.options=z||this.resolveDataElementOptions(U,i[U].active?"active":f));const ve=ie.options||i[U].options;f4(ie,ve,re,_),m4(ie,ve,P.ratio),this.updateElement(i[U],U,ie,f)}}_getStacks(i,o){const{iScale:c}=this._cachedMeta,f=c.getMatchingVisibleMetas(this._type).filter(s=>s.controller.options.grouped),m=c.options.stacked,_=[],v=s=>{const S=s.controller.getParsed(o),P=S&&S[s.vScale.axis];if(gn(P)||isNaN(P))return!0};for(const s of f)if(!(o!==void 0&&v(s))&&((m===!1||_.indexOf(s.stack)===-1||m===void 0&&s.stack===void 0)&&_.push(s.stack),s.index===i))break;return _.length||_.push(void 0),_}_getStackCount(i){return this._getStacks(void 0,i).length}_getStackIndex(i,o,c){const f=this._getStacks(i,c),m=o!==void 0?f.indexOf(o):-1;return m===-1?f.length-1:m}_getRuler(){const i=this.options,o=this._cachedMeta,c=o.iScale,f=[];let m,_;for(m=0,_=o.data.length;m<_;++m)f.push(c.getPixelForValue(this.getParsed(m)[c.axis],m));const v=i.barThickness;return{min:v||a4(o),pixels:f,start:c._startPixel,end:c._endPixel,stackCount:this._getStackCount(),scale:c,grouped:i.grouped,ratio:v?1:i.categoryPercentage*i.barPercentage}}_calculateBarValuePixels(i){const{_cachedMeta:{vScale:o,_stacked:c,index:f},options:{base:m,minBarLength:_}}=this,v=m||0,s=this.getParsed(i),S=s._custom,P=ax(S);let z=s[o.axis],F=0,U=c?this.applyStack(o,s,c):z,Z,W;U!==z&&(F=U-z,U=z),P&&(z=S.barStart,U=S.barEnd-S.barStart,z!==0&&Ko(z)!==Ko(S.barEnd)&&(F=0),F+=z);const Q=!gn(m)&&!P?m:F;let re=o.getPixelForValue(Q);if(this.chart.getDataVisibility(i)?Z=o.getPixelForValue(F+U):Z=re,W=Z-re,Math.abs(W)<_){W=h4(W,o,v)*_,z===v&&(re-=W/2);const ie=o.getPixelForDecimal(0),ve=o.getPixelForDecimal(1),pe=Math.min(ie,ve),ke=Math.max(ie,ve);re=Math.max(Math.min(re,ke),pe),Z=re+W,c&&!P&&(s._stacks[o.axis]._visualValues[f]=o.getValueForPixel(Z)-o.getValueForPixel(re))}if(re===o.getPixelForValue(v)){const ie=Ko(W)*o.getLineWidthForValue(v)/2;re+=ie,W-=ie}return{size:W,base:re,head:Z,center:Z+W/2}}_calculateBarIndexPixels(i,o){const c=o.scale,f=this.options,m=f.skipNull,_=Gi(f.maxBarThickness,1/0);let v,s;if(o.grouped){const S=m?this._getStackCount(i):o.stackCount,P=f.barThickness==="flex"?c4(i,o,f,S):l4(i,o,f,S),z=this._getStackIndex(this.index,this._cachedMeta.stack,m?i:void 0);v=P.start+P.chunk*z+P.chunk/2,s=Math.min(_,P.chunk*P.ratio)}else v=c.getPixelForValue(this.getParsed(i)[c.axis],i),s=Math.min(_,o.min*o.ratio);return{base:v-s/2,head:v+s/2,center:v,size:s}}draw(){const i=this._cachedMeta,o=i.vScale,c=i.data,f=c.length;let m=0;for(;m<f;++m)this.getParsed(m)[o.axis]!==null&&c[m].draw(this._ctx)}}qt(vg,"id","bar"),qt(vg,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),qt(vg,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class bg extends vo{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(i,o,c,f){const m=super.parsePrimitiveData(i,o,c,f);for(let _=0;_<m.length;_++)m[_]._custom=this.resolveDataElementOptions(_+c).radius;return m}parseArrayData(i,o,c,f){const m=super.parseArrayData(i,o,c,f);for(let _=0;_<m.length;_++){const v=o[c+_];m[_]._custom=Gi(v[2],this.resolveDataElementOptions(_+c).radius)}return m}parseObjectData(i,o,c,f){const m=super.parseObjectData(i,o,c,f);for(let _=0;_<m.length;_++){const v=o[c+_];m[_]._custom=Gi(v&&v.r&&+v.r,this.resolveDataElementOptions(_+c).radius)}return m}getMaxOverflow(){const i=this._cachedMeta.data;let o=0;for(let c=i.length-1;c>=0;--c)o=Math.max(o,i[c].size(this.resolveDataElementOptions(c))/2);return o>0&&o}getLabelAndValue(i){const o=this._cachedMeta,c=this.chart.data.labels||[],{xScale:f,yScale:m}=o,_=this.getParsed(i),v=f.getLabelForValue(_.x),s=m.getLabelForValue(_.y),S=_._custom;return{label:c[i]||"",value:"("+v+", "+s+(S?", "+S:"")+")"}}update(i){const o=this._cachedMeta.data;this.updateElements(o,0,o.length,i)}updateElements(i,o,c,f){const m=f==="reset",{iScale:_,vScale:v}=this._cachedMeta,{sharedOptions:s,includeOptions:S}=this._getSharedOptions(o,f),P=_.axis,z=v.axis;for(let F=o;F<o+c;F++){const U=i[F],Z=!m&&this.getParsed(F),W={},Q=W[P]=m?_.getPixelForDecimal(.5):_.getPixelForValue(Z[P]),re=W[z]=m?v.getBasePixel():v.getPixelForValue(Z[z]);W.skip=isNaN(Q)||isNaN(re),S&&(W.options=s||this.resolveDataElementOptions(F,U.active?"active":f),m&&(W.options.radius=0)),this.updateElement(U,F,W,f)}}resolveDataElementOptions(i,o){const c=this.getParsed(i);let f=super.resolveDataElementOptions(i,o);f.$shared&&(f=Object.assign({},f,{$shared:!1}));const m=f.radius;return o!=="active"&&(f.radius=0),f.radius+=Gi(c&&c._custom,m),f}}qt(bg,"id","bubble"),qt(bg,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),qt(bg,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function g4(r,i,o){let c=1,f=1,m=0,_=0;if(i<Xn){const v=r,s=v+i,S=Math.cos(v),P=Math.sin(v),z=Math.cos(s),F=Math.sin(s),U=(ve,pe,ke)=>zf(ve,v,s,!0)?1:Math.max(pe,pe*o,ke,ke*o),Z=(ve,pe,ke)=>zf(ve,v,s,!0)?-1:Math.min(pe,pe*o,ke,ke*o),W=U(0,S,z),Q=U(fr,P,F),re=Z(Yn,S,z),ie=Z(Yn+fr,P,F);c=(W-re)/2,f=(Q-ie)/2,m=-(W+re)/2,_=-(Q+ie)/2}return{ratioX:c,ratioY:f,offsetX:m,offsetY:_}}class Ec extends vo{constructor(i,o){super(i,o),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(i,o){const c=this.getDataset().data,f=this._cachedMeta;if(this._parsing===!1)f._parsed=c;else{let m=s=>+c[s];if(sn(c[i])){const{key:s="value"}=this._parsing;m=S=>+Cl(c[S],s)}let _,v;for(_=i,v=i+o;_<v;++_)f._parsed[_]=m(_)}}_getRotation(){return yo(this.options.rotation-90)}_getCircumference(){return yo(this.options.circumference)}_getRotationExtents(){let i=Xn,o=-Xn;for(let c=0;c<this.chart.data.datasets.length;++c)if(this.chart.isDatasetVisible(c)&&this.chart.getDatasetMeta(c).type===this._type){const f=this.chart.getDatasetMeta(c).controller,m=f._getRotation(),_=f._getCircumference();i=Math.min(i,m),o=Math.max(o,m+_)}return{rotation:i,circumference:o-i}}update(i){const o=this.chart,{chartArea:c}=o,f=this._cachedMeta,m=f.data,_=this.getMaxBorderWidth()+this.getMaxOffset(m)+this.options.spacing,v=Math.max((Math.min(c.width,c.height)-_)/2,0),s=Math.min(CL(this.options.cutout,v),1),S=this._getRingWeight(this.index),{circumference:P,rotation:z}=this._getRotationExtents(),{ratioX:F,ratioY:U,offsetX:Z,offsetY:W}=g4(z,P,s),Q=(c.width-_)/F,re=(c.height-_)/U,ie=Math.max(Math.min(Q,re)/2,0),ve=MI(this.options.radius,ie),pe=Math.max(ve*s,0),ke=(ve-pe)/this._getVisibleDatasetWeightTotal();this.offsetX=Z*ve,this.offsetY=W*ve,f.total=this.calculateTotal(),this.outerRadius=ve-ke*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-ke*S,0),this.updateElements(m,0,m.length,i)}_circumference(i,o){const c=this.options,f=this._cachedMeta,m=this._getCircumference();return o&&c.animation.animateRotate||!this.chart.getDataVisibility(i)||f._parsed[i]===null||f.data[i].hidden?0:this.calculateCircumference(f._parsed[i]*m/Xn)}updateElements(i,o,c,f){const m=f==="reset",_=this.chart,v=_.chartArea,S=_.options.animation,P=(v.left+v.right)/2,z=(v.top+v.bottom)/2,F=m&&S.animateScale,U=F?0:this.innerRadius,Z=F?0:this.outerRadius,{sharedOptions:W,includeOptions:Q}=this._getSharedOptions(o,f);let re=this._getRotation(),ie;for(ie=0;ie<o;++ie)re+=this._circumference(ie,m);for(ie=o;ie<o+c;++ie){const ve=this._circumference(ie,m),pe=i[ie],ke={x:P+this.offsetX,y:z+this.offsetY,startAngle:re,endAngle:re+ve,circumference:ve,outerRadius:Z,innerRadius:U};Q&&(ke.options=W||this.resolveDataElementOptions(ie,pe.active?"active":f)),re+=ve,this.updateElement(pe,ie,ke,f)}}calculateTotal(){const i=this._cachedMeta,o=i.data;let c=0,f;for(f=0;f<o.length;f++){const m=i._parsed[f];m!==null&&!isNaN(m)&&this.chart.getDataVisibility(f)&&!o[f].hidden&&(c+=Math.abs(m))}return c}calculateCircumference(i){const o=this._cachedMeta.total;return o>0&&!isNaN(i)?Xn*(Math.abs(i)/o):0}getLabelAndValue(i){const o=this._cachedMeta,c=this.chart,f=c.data.labels||[],m=Jf(o._parsed[i],c.options.locale);return{label:f[i]||"",value:m}}getMaxBorderWidth(i){let o=0;const c=this.chart;let f,m,_,v,s;if(!i){for(f=0,m=c.data.datasets.length;f<m;++f)if(c.isDatasetVisible(f)){_=c.getDatasetMeta(f),i=_.data,v=_.controller;break}}if(!i)return 0;for(f=0,m=i.length;f<m;++f)s=v.resolveDataElementOptions(f),s.borderAlign!=="inner"&&(o=Math.max(o,s.borderWidth||0,s.hoverBorderWidth||0));return o}getMaxOffset(i){let o=0;for(let c=0,f=i.length;c<f;++c){const m=this.resolveDataElementOptions(c);o=Math.max(o,m.offset||0,m.hoverOffset||0)}return o}_getRingWeightOffset(i){let o=0;for(let c=0;c<i;++c)this.chart.isDatasetVisible(c)&&(o+=this._getRingWeight(c));return o}_getRingWeight(i){return Math.max(Gi(this.chart.data.datasets[i].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}qt(Ec,"id","doughnut"),qt(Ec,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),qt(Ec,"descriptors",{_scriptable:i=>i!=="spacing",_indexable:i=>i!=="spacing"&&!i.startsWith("borderDash")&&!i.startsWith("hoverBorderDash")}),qt(Ec,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(i){const o=i.data;if(o.labels.length&&o.datasets.length){const{labels:{pointStyle:c,color:f}}=i.legend.options;return o.labels.map((m,_)=>{const s=i.getDatasetMeta(0).controller.getStyle(_);return{text:m,fillStyle:s.backgroundColor,strokeStyle:s.borderColor,fontColor:f,lineWidth:s.borderWidth,pointStyle:c,hidden:!i.getDataVisibility(_),index:_}})}return[]}},onClick(i,o,c){c.chart.toggleDataVisibility(o.index),c.chart.update()}}}});class wg extends vo{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(i){const o=this._cachedMeta,{dataset:c,data:f=[],_dataset:m}=o,_=this.chart._animationsDisabled;let{start:v,count:s}=DI(o,f,_);this._drawStart=v,this._drawCount=s,zI(o)&&(v=0,s=f.length),c._chart=this.chart,c._datasetIndex=this.index,c._decimated=!!m._decimated,c.points=f;const S=this.resolveDatasetElementOptions(i);this.options.showLine||(S.borderWidth=0),S.segment=this.options.segment,this.updateElement(c,void 0,{animated:!_,options:S},i),this.updateElements(f,v,s,i)}updateElements(i,o,c,f){const m=f==="reset",{iScale:_,vScale:v,_stacked:s,_dataset:S}=this._cachedMeta,{sharedOptions:P,includeOptions:z}=this._getSharedOptions(o,f),F=_.axis,U=v.axis,{spanGaps:Z,segment:W}=this.options,Q=ah(Z)?Z:Number.POSITIVE_INFINITY,re=this.chart._animationsDisabled||m||f==="none",ie=o+c,ve=i.length;let pe=o>0&&this.getParsed(o-1);for(let ke=0;ke<ve;++ke){const Me=i[ke],Ye=re?Me:{};if(ke<o||ke>=ie){Ye.skip=!0;continue}const ot=this.getParsed(ke),Mt=gn(ot[U]),Se=Ye[F]=_.getPixelForValue(ot[F],ke),yt=Ye[U]=m||Mt?v.getBasePixel():v.getPixelForValue(s?this.applyStack(v,ot,s):ot[U],ke);Ye.skip=isNaN(Se)||isNaN(yt)||Mt,Ye.stop=ke>0&&Math.abs(ot[F]-pe[F])>Q,W&&(Ye.parsed=ot,Ye.raw=S.data[ke]),z&&(Ye.options=P||this.resolveDataElementOptions(ke,Me.active?"active":f)),re||this.updateElement(Me,ke,Ye,f),pe=ot}}getMaxOverflow(){const i=this._cachedMeta,o=i.dataset,c=o.options&&o.options.borderWidth||0,f=i.data||[];if(!f.length)return c;const m=f[0].size(this.resolveDataElementOptions(0)),_=f[f.length-1].size(this.resolveDataElementOptions(f.length-1));return Math.max(c,m,_)/2}draw(){const i=this._cachedMeta;i.dataset.updateControlPoints(this.chart.chartArea,i.iScale.axis),super.draw()}}qt(wg,"id","line"),qt(wg,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),qt(wg,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class Ef extends vo{constructor(i,o){super(i,o),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(i){const o=this._cachedMeta,c=this.chart,f=c.data.labels||[],m=Jf(o._parsed[i].r,c.options.locale);return{label:f[i]||"",value:m}}parseObjectData(i,o,c,f){return jI.bind(this)(i,o,c,f)}update(i){const o=this._cachedMeta.data;this._updateRadius(),this.updateElements(o,0,o.length,i)}getMinMax(){const i=this._cachedMeta,o={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return i.data.forEach((c,f)=>{const m=this.getParsed(f).r;!isNaN(m)&&this.chart.getDataVisibility(f)&&(m<o.min&&(o.min=m),m>o.max&&(o.max=m))}),o}_updateRadius(){const i=this.chart,o=i.chartArea,c=i.options,f=Math.min(o.right-o.left,o.bottom-o.top),m=Math.max(f/2,0),_=Math.max(c.cutoutPercentage?m/100*c.cutoutPercentage:1,0),v=(m-_)/i.getVisibleDatasetCount();this.outerRadius=m-v*this.index,this.innerRadius=this.outerRadius-v}updateElements(i,o,c,f){const m=f==="reset",_=this.chart,s=_.options.animation,S=this._cachedMeta.rScale,P=S.xCenter,z=S.yCenter,F=S.getIndexAngle(0)-.5*Yn;let U=F,Z;const W=360/this.countVisibleElements();for(Z=0;Z<o;++Z)U+=this._computeAngle(Z,f,W);for(Z=o;Z<o+c;Z++){const Q=i[Z];let re=U,ie=U+this._computeAngle(Z,f,W),ve=_.getDataVisibility(Z)?S.getDistanceFromCenterForValue(this.getParsed(Z).r):0;U=ie,m&&(s.animateScale&&(ve=0),s.animateRotate&&(re=ie=F));const pe={x:P,y:z,innerRadius:0,outerRadius:ve,startAngle:re,endAngle:ie,options:this.resolveDataElementOptions(Z,Q.active?"active":f)};this.updateElement(Q,Z,pe,f)}}countVisibleElements(){const i=this._cachedMeta;let o=0;return i.data.forEach((c,f)=>{!isNaN(this.getParsed(f).r)&&this.chart.getDataVisibility(f)&&o++}),o}_computeAngle(i,o,c){return this.chart.getDataVisibility(i)?yo(this.resolveDataElementOptions(i,o).angle||c):0}}qt(Ef,"id","polarArea"),qt(Ef,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),qt(Ef,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(i){const o=i.data;if(o.labels.length&&o.datasets.length){const{labels:{pointStyle:c,color:f}}=i.legend.options;return o.labels.map((m,_)=>{const s=i.getDatasetMeta(0).controller.getStyle(_);return{text:m,fillStyle:s.backgroundColor,strokeStyle:s.borderColor,fontColor:f,lineWidth:s.borderWidth,pointStyle:c,hidden:!i.getDataVisibility(_),index:_}})}return[]}},onClick(i,o,c){c.chart.toggleDataVisibility(o.index),c.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class Rx extends Ec{}qt(Rx,"id","pie"),qt(Rx,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class Tg extends vo{getLabelAndValue(i){const o=this._cachedMeta.vScale,c=this.getParsed(i);return{label:o.getLabels()[i],value:""+o.getLabelForValue(c[o.axis])}}parseObjectData(i,o,c,f){return jI.bind(this)(i,o,c,f)}update(i){const o=this._cachedMeta,c=o.dataset,f=o.data||[],m=o.iScale.getLabels();if(c.points=f,i!=="resize"){const _=this.resolveDatasetElementOptions(i);this.options.showLine||(_.borderWidth=0);const v={_loop:!0,_fullLoop:m.length===f.length,options:_};this.updateElement(c,void 0,v,i)}this.updateElements(f,0,f.length,i)}updateElements(i,o,c,f){const m=this._cachedMeta.rScale,_=f==="reset";for(let v=o;v<o+c;v++){const s=i[v],S=this.resolveDataElementOptions(v,s.active?"active":f),P=m.getPointPositionForValue(v,this.getParsed(v).r),z=_?m.xCenter:P.x,F=_?m.yCenter:P.y,U={x:z,y:F,angle:P.angle,skip:isNaN(z)||isNaN(F),options:S};this.updateElement(s,v,U,f)}}}qt(Tg,"id","radar"),qt(Tg,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),qt(Tg,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class Mg extends vo{getLabelAndValue(i){const o=this._cachedMeta,c=this.chart.data.labels||[],{xScale:f,yScale:m}=o,_=this.getParsed(i),v=f.getLabelForValue(_.x),s=m.getLabelForValue(_.y);return{label:c[i]||"",value:"("+v+", "+s+")"}}update(i){const o=this._cachedMeta,{data:c=[]}=o,f=this.chart._animationsDisabled;let{start:m,count:_}=DI(o,c,f);if(this._drawStart=m,this._drawCount=_,zI(o)&&(m=0,_=c.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:v,_dataset:s}=o;v._chart=this.chart,v._datasetIndex=this.index,v._decimated=!!s._decimated,v.points=c;const S=this.resolveDatasetElementOptions(i);S.segment=this.options.segment,this.updateElement(v,void 0,{animated:!f,options:S},i)}else this.datasetElementType&&(delete o.dataset,this.datasetElementType=!1);this.updateElements(c,m,_,i)}addElements(){const{showLine:i}=this.options;!this.datasetElementType&&i&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(i,o,c,f){const m=f==="reset",{iScale:_,vScale:v,_stacked:s,_dataset:S}=this._cachedMeta,P=this.resolveDataElementOptions(o,f),z=this.getSharedOptions(P),F=this.includeOptions(f,z),U=_.axis,Z=v.axis,{spanGaps:W,segment:Q}=this.options,re=ah(W)?W:Number.POSITIVE_INFINITY,ie=this.chart._animationsDisabled||m||f==="none";let ve=o>0&&this.getParsed(o-1);for(let pe=o;pe<o+c;++pe){const ke=i[pe],Me=this.getParsed(pe),Ye=ie?ke:{},ot=gn(Me[Z]),Mt=Ye[U]=_.getPixelForValue(Me[U],pe),Se=Ye[Z]=m||ot?v.getBasePixel():v.getPixelForValue(s?this.applyStack(v,Me,s):Me[Z],pe);Ye.skip=isNaN(Mt)||isNaN(Se)||ot,Ye.stop=pe>0&&Math.abs(Me[U]-ve[U])>re,Q&&(Ye.parsed=Me,Ye.raw=S.data[pe]),F&&(Ye.options=z||this.resolveDataElementOptions(pe,ke.active?"active":f)),ie||this.updateElement(ke,pe,Ye,f),ve=Me}this.updateSharedOptions(z,f,P)}getMaxOverflow(){const i=this._cachedMeta,o=i.data||[];if(!this.options.showLine){let v=0;for(let s=o.length-1;s>=0;--s)v=Math.max(v,o[s].size(this.resolveDataElementOptions(s))/2);return v>0&&v}const c=i.dataset,f=c.options&&c.options.borderWidth||0;if(!o.length)return f;const m=o[0].size(this.resolveDataElementOptions(0)),_=o[o.length-1].size(this.resolveDataElementOptions(o.length-1));return Math.max(f,m,_)/2}}qt(Mg,"id","scatter"),qt(Mg,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),qt(Mg,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var _4=Object.freeze({__proto__:null,BarController:vg,BubbleController:bg,DoughnutController:Ec,LineController:wg,PieController:Rx,PolarAreaController:Ef,RadarController:Tg,ScatterController:Mg});function wc(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Dv{constructor(i){qt(this,"options");this.options=i||{}}static override(i){Object.assign(Dv.prototype,i)}init(){}formats(){return wc()}parse(){return wc()}format(){return wc()}add(){return wc()}diff(){return wc()}startOf(){return wc()}endOf(){return wc()}}var y4={_date:Dv};function x4(r,i,o,c){const{controller:f,data:m,_sorted:_}=r,v=f._cachedMeta.iScale;if(v&&i===v.axis&&i!=="r"&&_&&m.length){const s=v._reversePixels?UL:ja;if(c){if(f._sharedOptions){const S=m[0],P=typeof S.getRange=="function"&&S.getRange(i);if(P){const z=s(m,i,o-P),F=s(m,i,o+P);return{lo:z.lo,hi:F.hi}}}}else return s(m,i,o)}return{lo:0,hi:m.length-1}}function Qf(r,i,o,c,f){const m=r.getSortedVisibleDatasetMetas(),_=o[i];for(let v=0,s=m.length;v<s;++v){const{index:S,data:P}=m[v],{lo:z,hi:F}=x4(m[v],i,_,f);for(let U=z;U<=F;++U){const Z=P[U];Z.skip||c(Z,S,U)}}}function v4(r){const i=r.indexOf("x")!==-1,o=r.indexOf("y")!==-1;return function(c,f){const m=i?Math.abs(c.x-f.x):0,_=o?Math.abs(c.y-f.y):0;return Math.sqrt(Math.pow(m,2)+Math.pow(_,2))}}function lx(r,i,o,c,f){const m=[];return!f&&!r.isPointInArea(i)||Qf(r,o,i,function(v,s,S){!f&&!Ua(v,r.chartArea,0)||v.inRange(i.x,i.y,c)&&m.push({element:v,datasetIndex:s,index:S})},!0),m}function b4(r,i,o,c){let f=[];function m(_,v,s){const{startAngle:S,endAngle:P}=_.getProps(["startAngle","endAngle"],c),{angle:z}=AI(_,{x:i.x,y:i.y});zf(z,S,P)&&f.push({element:_,datasetIndex:v,index:s})}return Qf(r,o,i,m),f}function w4(r,i,o,c,f,m){let _=[];const v=v4(o);let s=Number.POSITIVE_INFINITY;function S(P,z,F){const U=P.inRange(i.x,i.y,f);if(c&&!U)return;const Z=P.getCenterPoint(f);if(!(!!m||r.isPointInArea(Z))&&!U)return;const Q=v(i,Z);Q<s?(_=[{element:P,datasetIndex:z,index:F}],s=Q):Q===s&&_.push({element:P,datasetIndex:z,index:F})}return Qf(r,o,i,S),_}function cx(r,i,o,c,f,m){return!m&&!r.isPointInArea(i)?[]:o==="r"&&!c?b4(r,i,o,f):w4(r,i,o,c,f,m)}function mS(r,i,o,c,f){const m=[],_=o==="x"?"inXRange":"inYRange";let v=!1;return Qf(r,o,i,(s,S,P)=>{s[_](i[o],f)&&(m.push({element:s,datasetIndex:S,index:P}),v=v||s.inRange(i.x,i.y,f))}),c&&!v?[]:m}var T4={evaluateInteractionItems:Qf,modes:{index(r,i,o,c){const f=Mc(i,r),m=o.axis||"x",_=o.includeInvisible||!1,v=o.intersect?lx(r,f,m,c,_):cx(r,f,m,!1,c,_),s=[];return v.length?(r.getSortedVisibleDatasetMetas().forEach(S=>{const P=v[0].index,z=S.data[P];z&&!z.skip&&s.push({element:z,datasetIndex:S.index,index:P})}),s):[]},dataset(r,i,o,c){const f=Mc(i,r),m=o.axis||"xy",_=o.includeInvisible||!1;let v=o.intersect?lx(r,f,m,c,_):cx(r,f,m,!1,c,_);if(v.length>0){const s=v[0].datasetIndex,S=r.getDatasetMeta(s).data;v=[];for(let P=0;P<S.length;++P)v.push({element:S[P],datasetIndex:s,index:P})}return v},point(r,i,o,c){const f=Mc(i,r),m=o.axis||"xy",_=o.includeInvisible||!1;return lx(r,f,m,c,_)},nearest(r,i,o,c){const f=Mc(i,r),m=o.axis||"xy",_=o.includeInvisible||!1;return cx(r,f,m,o.intersect,c,_)},x(r,i,o,c){const f=Mc(i,r);return mS(r,f,"x",o.intersect,c)},y(r,i,o,c){const f=Mc(i,r);return mS(r,f,"y",o.intersect,c)}}};const JI=["left","top","right","bottom"];function ef(r,i){return r.filter(o=>o.pos===i)}function gS(r,i){return r.filter(o=>JI.indexOf(o.pos)===-1&&o.box.axis===i)}function tf(r,i){return r.sort((o,c)=>{const f=i?c:o,m=i?o:c;return f.weight===m.weight?f.index-m.index:f.weight-m.weight})}function M4(r){const i=[];let o,c,f,m,_,v;for(o=0,c=(r||[]).length;o<c;++o)f=r[o],{position:m,options:{stack:_,stackWeight:v=1}}=f,i.push({index:o,box:f,pos:m,horizontal:f.isHorizontal(),weight:f.weight,stack:_&&m+_,stackWeight:v});return i}function S4(r){const i={};for(const o of r){const{stack:c,pos:f,stackWeight:m}=o;if(!c||!JI.includes(f))continue;const _=i[c]||(i[c]={count:0,placed:0,weight:0,size:0});_.count++,_.weight+=m}return i}function E4(r,i){const o=S4(r),{vBoxMaxWidth:c,hBoxMaxHeight:f}=i;let m,_,v;for(m=0,_=r.length;m<_;++m){v=r[m];const{fullSize:s}=v.box,S=o[v.stack],P=S&&v.stackWeight/S.weight;v.horizontal?(v.width=P?P*c:s&&i.availableWidth,v.height=f):(v.width=c,v.height=P?P*f:s&&i.availableHeight)}return o}function A4(r){const i=M4(r),o=tf(i.filter(S=>S.box.fullSize),!0),c=tf(ef(i,"left"),!0),f=tf(ef(i,"right")),m=tf(ef(i,"top"),!0),_=tf(ef(i,"bottom")),v=gS(i,"x"),s=gS(i,"y");return{fullSize:o,leftAndTop:c.concat(m),rightAndBottom:f.concat(s).concat(_).concat(v),chartArea:ef(i,"chartArea"),vertical:c.concat(f).concat(s),horizontal:m.concat(_).concat(v)}}function _S(r,i,o,c){return Math.max(r[o],i[o])+Math.max(r[c],i[c])}function QI(r,i){r.top=Math.max(r.top,i.top),r.left=Math.max(r.left,i.left),r.bottom=Math.max(r.bottom,i.bottom),r.right=Math.max(r.right,i.right)}function I4(r,i,o,c){const{pos:f,box:m}=o,_=r.maxPadding;if(!sn(f)){o.size&&(r[f]-=o.size);const z=c[o.stack]||{size:0,count:1};z.size=Math.max(z.size,o.horizontal?m.height:m.width),o.size=z.size/z.count,r[f]+=o.size}m.getPadding&&QI(_,m.getPadding());const v=Math.max(0,i.outerWidth-_S(_,r,"left","right")),s=Math.max(0,i.outerHeight-_S(_,r,"top","bottom")),S=v!==r.w,P=s!==r.h;return r.w=v,r.h=s,o.horizontal?{same:S,other:P}:{same:P,other:S}}function k4(r){const i=r.maxPadding;function o(c){const f=Math.max(i[c]-r[c],0);return r[c]+=f,f}r.y+=o("top"),r.x+=o("left"),o("right"),o("bottom")}function C4(r,i){const o=i.maxPadding;function c(f){const m={left:0,top:0,right:0,bottom:0};return f.forEach(_=>{m[_]=Math.max(i[_],o[_])}),m}return c(r?["left","right"]:["top","bottom"])}function df(r,i,o,c){const f=[];let m,_,v,s,S,P;for(m=0,_=r.length,S=0;m<_;++m){v=r[m],s=v.box,s.update(v.width||i.w,v.height||i.h,C4(v.horizontal,i));const{same:z,other:F}=I4(i,o,v,c);S|=z&&f.length,P=P||F,s.fullSize||f.push(v)}return S&&df(f,i,o,c)||P}function rg(r,i,o,c,f){r.top=o,r.left=i,r.right=i+c,r.bottom=o+f,r.width=c,r.height=f}function yS(r,i,o,c){const f=o.padding;let{x:m,y:_}=i;for(const v of r){const s=v.box,S=c[v.stack]||{count:1,placed:0,weight:1},P=v.stackWeight/S.weight||1;if(v.horizontal){const z=i.w*P,F=S.size||s.height;Df(S.start)&&(_=S.start),s.fullSize?rg(s,f.left,_,o.outerWidth-f.right-f.left,F):rg(s,i.left+S.placed,_,z,F),S.start=_,S.placed+=z,_=s.bottom}else{const z=i.h*P,F=S.size||s.width;Df(S.start)&&(m=S.start),s.fullSize?rg(s,m,f.top,F,o.outerHeight-f.bottom-f.top):rg(s,m,i.top+S.placed,F,z),S.start=m,S.placed+=z,m=s.right}}i.x=m,i.y=_}var Jr={addBox(r,i){r.boxes||(r.boxes=[]),i.fullSize=i.fullSize||!1,i.position=i.position||"top",i.weight=i.weight||0,i._layers=i._layers||function(){return[{z:0,draw(o){i.draw(o)}}]},r.boxes.push(i)},removeBox(r,i){const o=r.boxes?r.boxes.indexOf(i):-1;o!==-1&&r.boxes.splice(o,1)},configure(r,i,o){i.fullSize=o.fullSize,i.position=o.position,i.weight=o.weight},update(r,i,o,c){if(!r)return;const f=$r(r.options.layout.padding),m=Math.max(i-f.width,0),_=Math.max(o-f.height,0),v=A4(r.boxes),s=v.vertical,S=v.horizontal;An(r.boxes,W=>{typeof W.beforeLayout=="function"&&W.beforeLayout()});const P=s.reduce((W,Q)=>Q.box.options&&Q.box.options.display===!1?W:W+1,0)||1,z=Object.freeze({outerWidth:i,outerHeight:o,padding:f,availableWidth:m,availableHeight:_,vBoxMaxWidth:m/2/P,hBoxMaxHeight:_/2}),F=Object.assign({},f);QI(F,$r(c));const U=Object.assign({maxPadding:F,w:m,h:_,x:f.left,y:f.top},f),Z=E4(s.concat(S),z);df(v.fullSize,U,z,Z),df(s,U,z,Z),df(S,U,z,Z)&&df(s,U,z,Z),k4(U),yS(v.leftAndTop,U,z,Z),U.x+=U.w,U.y+=U.h,yS(v.rightAndBottom,U,z,Z),r.chartArea={left:U.left,top:U.top,right:U.left+U.w,bottom:U.top+U.h,height:U.h,width:U.w},An(v.chartArea,W=>{const Q=W.box;Object.assign(Q,r.chartArea),Q.update(U.w,U.h,{left:0,top:0,right:0,bottom:0})})}};class $I{acquireContext(i,o){}releaseContext(i){return!1}addEventListener(i,o,c){}removeEventListener(i,o,c){}getDevicePixelRatio(){return 1}getMaximumSize(i,o,c,f){return o=Math.max(0,o||i.width),c=c||i.height,{width:o,height:Math.max(0,f?Math.floor(o/f):c)}}isAttached(i){return!0}updateConfig(i){}}class P4 extends $I{acquireContext(i){return i&&i.getContext&&i.getContext("2d")||null}updateConfig(i){i.options.animation=!1}}const Sg="$chartjs",D4={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},xS=r=>r===null||r==="";function z4(r,i){const o=r.style,c=r.getAttribute("height"),f=r.getAttribute("width");if(r[Sg]={initial:{height:c,width:f,style:{display:o.display,height:o.height,width:o.width}}},o.display=o.display||"block",o.boxSizing=o.boxSizing||"border-box",xS(f)){const m=tS(r,"width");m!==void 0&&(r.width=m)}if(xS(c))if(r.style.height==="")r.height=r.width/(i||2);else{const m=tS(r,"height");m!==void 0&&(r.height=m)}return r}const ek=RR?{passive:!0}:!1;function L4(r,i,o){r&&r.addEventListener(i,o,ek)}function R4(r,i,o){r&&r.canvas&&r.canvas.removeEventListener(i,o,ek)}function O4(r,i){const o=D4[r.type]||r.type,{x:c,y:f}=Mc(r,i);return{type:o,chart:i,native:r,x:c!==void 0?c:null,y:f!==void 0?f:null}}function Qg(r,i){for(const o of r)if(o===i||o.contains(i))return!0}function B4(r,i,o){const c=r.canvas,f=new MutationObserver(m=>{let _=!1;for(const v of m)_=_||Qg(v.addedNodes,c),_=_&&!Qg(v.removedNodes,c);_&&o()});return f.observe(document,{childList:!0,subtree:!0}),f}function F4(r,i,o){const c=r.canvas,f=new MutationObserver(m=>{let _=!1;for(const v of m)_=_||Qg(v.removedNodes,c),_=_&&!Qg(v.addedNodes,c);_&&o()});return f.observe(document,{childList:!0,subtree:!0}),f}const Rf=new Map;let vS=0;function tk(){const r=window.devicePixelRatio;r!==vS&&(vS=r,Rf.forEach((i,o)=>{o.currentDevicePixelRatio!==r&&i()}))}function N4(r,i){Rf.size||window.addEventListener("resize",tk),Rf.set(r,i)}function V4(r){Rf.delete(r),Rf.size||window.removeEventListener("resize",tk)}function j4(r,i,o){const c=r.canvas,f=c&&Pv(c);if(!f)return;const m=PI((v,s)=>{const S=f.clientWidth;o(v,s),S<f.clientWidth&&o()},window),_=new ResizeObserver(v=>{const s=v[0],S=s.contentRect.width,P=s.contentRect.height;S===0&&P===0||m(S,P)});return _.observe(f),N4(r,m),_}function ux(r,i,o){o&&o.disconnect(),i==="resize"&&V4(r)}function U4(r,i,o){const c=r.canvas,f=PI(m=>{r.ctx!==null&&o(O4(m,r))},r);return L4(c,i,f),f}class G4 extends $I{acquireContext(i,o){const c=i&&i.getContext&&i.getContext("2d");return c&&c.canvas===i?(z4(i,o),c):null}releaseContext(i){const o=i.canvas;if(!o[Sg])return!1;const c=o[Sg].initial;["height","width"].forEach(m=>{const _=c[m];gn(_)?o.removeAttribute(m):o.setAttribute(m,_)});const f=c.style||{};return Object.keys(f).forEach(m=>{o.style[m]=f[m]}),o.width=o.width,delete o[Sg],!0}addEventListener(i,o,c){this.removeEventListener(i,o);const f=i.$proxies||(i.$proxies={}),_={attach:B4,detach:F4,resize:j4}[o]||U4;f[o]=_(i,o,c)}removeEventListener(i,o){const c=i.$proxies||(i.$proxies={}),f=c[o];if(!f)return;({attach:ux,detach:ux,resize:ux}[o]||R4)(i,o,f),c[o]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(i,o,c,f){return LR(i,o,c,f)}isAttached(i){const o=Pv(i);return!!(o&&o.isConnected)}}function H4(r){return!Cv()||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas?P4:G4}class bo{constructor(){qt(this,"x");qt(this,"y");qt(this,"active",!1);qt(this,"options");qt(this,"$animations")}tooltipPosition(i){const{x:o,y:c}=this.getProps(["x","y"],i);return{x:o,y:c}}hasValue(){return ah(this.x)&&ah(this.y)}getProps(i,o){const c=this.$animations;if(!o||!c)return this;const f={};return i.forEach(m=>{f[m]=c[m]&&c[m].active()?c[m]._to:this[m]}),f}}qt(bo,"defaults",{}),qt(bo,"defaultRoutes");function W4(r,i){const o=r.options.ticks,c=q4(r),f=Math.min(o.maxTicksLimit||c,c),m=o.major.enabled?X4(i):[],_=m.length,v=m[0],s=m[_-1],S=[];if(_>f)return Y4(i,S,m,_/f),S;const P=Z4(m,i,f);if(_>0){let z,F;const U=_>1?Math.round((s-v)/(_-1)):null;for(sg(i,S,P,gn(U)?0:v-U,v),z=0,F=_-1;z<F;z++)sg(i,S,P,m[z],m[z+1]);return sg(i,S,P,s,gn(U)?i.length:s+U),S}return sg(i,S,P),S}function q4(r){const i=r.options.offset,o=r._tickSize(),c=r._length/o+(i?0:1),f=r._maxLength/o;return Math.floor(Math.min(c,f))}function Z4(r,i,o){const c=K4(r),f=i.length/o;if(!c)return Math.max(f,1);const m=FL(c);for(let _=0,v=m.length-1;_<v;_++){const s=m[_];if(s>f)return s}return Math.max(f,1)}function X4(r){const i=[];let o,c;for(o=0,c=r.length;o<c;o++)r[o].major&&i.push(o);return i}function Y4(r,i,o,c){let f=0,m=o[0],_;for(c=Math.ceil(c),_=0;_<r.length;_++)_===m&&(i.push(r[_]),f++,m=o[f*c])}function sg(r,i,o,c,f){const m=Gi(c,0),_=Math.min(Gi(f,r.length),r.length);let v=0,s,S,P;for(o=Math.ceil(o),f&&(s=f-c,o=s/Math.floor(s/o)),P=m;P<0;)v++,P=Math.round(m+v*o);for(S=Math.max(m,0);S<_;S++)S===P&&(i.push(r[S]),v++,P=Math.round(m+v*o))}function K4(r){const i=r.length;let o,c;if(i<2)return!1;for(c=r[0],o=1;o<i;++o)if(r[o]-r[o-1]!==c)return!1;return c}const J4=r=>r==="left"?"right":r==="right"?"left":r,bS=(r,i,o)=>i==="top"||i==="left"?r[i]+o:r[i]-o,wS=(r,i)=>Math.min(i||r,r);function TS(r,i){const o=[],c=r.length/i,f=r.length;let m=0;for(;m<f;m+=c)o.push(r[Math.floor(m)]);return o}function Q4(r,i,o){const c=r.ticks.length,f=Math.min(i,c-1),m=r._startPixel,_=r._endPixel,v=1e-6;let s=r.getPixelForTick(f),S;if(!(o&&(c===1?S=Math.max(s-m,_-s):i===0?S=(r.getPixelForTick(1)-s)/2:S=(s-r.getPixelForTick(f-1))/2,s+=f<i?S:-S,s<m-v||s>_+v)))return s}function $4(r,i){An(r,o=>{const c=o.gc,f=c.length/2;let m;if(f>i){for(m=0;m<f;++m)delete o.data[c[m]];c.splice(0,f)}})}function nf(r){return r.drawTicks?r.tickLength:0}function MS(r,i){if(!r.display)return 0;const o=Mr(r.font,i),c=$r(r.padding);return(Zn(r.text)?r.text.length:1)*o.lineHeight+c.height}function e5(r,i){return Dl(r,{scale:i,type:"scale"})}function t5(r,i,o){return Dl(r,{tick:o,index:i,type:"tick"})}function i5(r,i,o){let c=Mv(r);return(o&&i!=="right"||!o&&i==="right")&&(c=J4(c)),c}function n5(r,i,o,c){const{top:f,left:m,bottom:_,right:v,chart:s}=r,{chartArea:S,scales:P}=s;let z=0,F,U,Z;const W=_-f,Q=v-m;if(r.isHorizontal()){if(U=Yr(c,m,v),sn(o)){const re=Object.keys(o)[0],ie=o[re];Z=P[re].getPixelForValue(ie)+W-i}else o==="center"?Z=(S.bottom+S.top)/2+W-i:Z=bS(r,o,i);F=v-m}else{if(sn(o)){const re=Object.keys(o)[0],ie=o[re];U=P[re].getPixelForValue(ie)-Q+i}else o==="center"?U=(S.left+S.right)/2-Q+i:U=bS(r,o,i);Z=Yr(c,_,f),z=o==="left"?-fr:fr}return{titleX:U,titleY:Z,maxWidth:F,rotation:z}}class Fc extends bo{constructor(i){super(),this.id=i.id,this.type=i.type,this.options=void 0,this.ctx=i.ctx,this.chart=i.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(i){this.options=i.setContext(this.getContext()),this.axis=i.axis,this._userMin=this.parse(i.min),this._userMax=this.parse(i.max),this._suggestedMin=this.parse(i.suggestedMin),this._suggestedMax=this.parse(i.suggestedMax)}parse(i,o){return i}getUserBounds(){let{_userMin:i,_userMax:o,_suggestedMin:c,_suggestedMax:f}=this;return i=Ls(i,Number.POSITIVE_INFINITY),o=Ls(o,Number.NEGATIVE_INFINITY),c=Ls(c,Number.POSITIVE_INFINITY),f=Ls(f,Number.NEGATIVE_INFINITY),{min:Ls(i,c),max:Ls(o,f),minDefined:or(i),maxDefined:or(o)}}getMinMax(i){let{min:o,max:c,minDefined:f,maxDefined:m}=this.getUserBounds(),_;if(f&&m)return{min:o,max:c};const v=this.getMatchingVisibleMetas();for(let s=0,S=v.length;s<S;++s)_=v[s].controller.getMinMax(this,i),f||(o=Math.min(o,_.min)),m||(c=Math.max(c,_.max));return o=m&&o>c?c:o,c=f&&o>c?o:c,{min:Ls(o,Ls(c,o)),max:Ls(c,Ls(o,c))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const i=this.chart.data;return this.options.labels||(this.isHorizontal()?i.xLabels:i.yLabels)||i.labels||[]}getLabelItems(i=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(i))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Vn(this.options.beforeUpdate,[this])}update(i,o,c){const{beginAtZero:f,grace:m,ticks:_}=this.options,v=_.sampleSize;this.beforeUpdate(),this.maxWidth=i,this.maxHeight=o,this._margins=c=Object.assign({left:0,right:0,top:0,bottom:0},c),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+c.left+c.right:this.height+c.top+c.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=dR(this,m,f),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const s=v<this.ticks.length;this._convertTicksToLabels(s?TS(this.ticks,v):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),_.display&&(_.autoSkip||_.source==="auto")&&(this.ticks=W4(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),s&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let i=this.options.reverse,o,c;this.isHorizontal()?(o=this.left,c=this.right):(o=this.top,c=this.bottom,i=!i),this._startPixel=o,this._endPixel=c,this._reversePixels=i,this._length=c-o,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Vn(this.options.afterUpdate,[this])}beforeSetDimensions(){Vn(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Vn(this.options.afterSetDimensions,[this])}_callHooks(i){this.chart.notifyPlugins(i,this.getContext()),Vn(this.options[i],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Vn(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(i){const o=this.options.ticks;let c,f,m;for(c=0,f=i.length;c<f;c++)m=i[c],m.label=Vn(o.callback,[m.value,c,i],this)}afterTickToLabelConversion(){Vn(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Vn(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const i=this.options,o=i.ticks,c=wS(this.ticks.length,i.ticks.maxTicksLimit),f=o.minRotation||0,m=o.maxRotation;let _=f,v,s,S;if(!this._isVisible()||!o.display||f>=m||c<=1||!this.isHorizontal()){this.labelRotation=f;return}const P=this._getLabelSizes(),z=P.widest.width,F=P.highest.height,U=Ir(this.chart.width-z,0,this.maxWidth);v=i.offset?this.maxWidth/c:U/(c-1),z+6>v&&(v=U/(c-(i.offset?.5:1)),s=this.maxHeight-nf(i.grid)-o.padding-MS(i.title,this.chart.options.font),S=Math.sqrt(z*z+F*F),_=wv(Math.min(Math.asin(Ir((P.highest.height+6)/v,-1,1)),Math.asin(Ir(s/S,-1,1))-Math.asin(Ir(F/S,-1,1)))),_=Math.max(f,Math.min(m,_))),this.labelRotation=_}afterCalculateLabelRotation(){Vn(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Vn(this.options.beforeFit,[this])}fit(){const i={width:0,height:0},{chart:o,options:{ticks:c,title:f,grid:m}}=this,_=this._isVisible(),v=this.isHorizontal();if(_){const s=MS(f,o.options.font);if(v?(i.width=this.maxWidth,i.height=nf(m)+s):(i.height=this.maxHeight,i.width=nf(m)+s),c.display&&this.ticks.length){const{first:S,last:P,widest:z,highest:F}=this._getLabelSizes(),U=c.padding*2,Z=yo(this.labelRotation),W=Math.cos(Z),Q=Math.sin(Z);if(v){const re=c.mirror?0:Q*z.width+W*F.height;i.height=Math.min(this.maxHeight,i.height+re+U)}else{const re=c.mirror?0:W*z.width+Q*F.height;i.width=Math.min(this.maxWidth,i.width+re+U)}this._calculatePadding(S,P,Q,W)}}this._handleMargins(),v?(this.width=this._length=o.width-this._margins.left-this._margins.right,this.height=i.height):(this.width=i.width,this.height=this._length=o.height-this._margins.top-this._margins.bottom)}_calculatePadding(i,o,c,f){const{ticks:{align:m,padding:_},position:v}=this.options,s=this.labelRotation!==0,S=v!=="top"&&this.axis==="x";if(this.isHorizontal()){const P=this.getPixelForTick(0)-this.left,z=this.right-this.getPixelForTick(this.ticks.length-1);let F=0,U=0;s?S?(F=f*i.width,U=c*o.height):(F=c*i.height,U=f*o.width):m==="start"?U=o.width:m==="end"?F=i.width:m!=="inner"&&(F=i.width/2,U=o.width/2),this.paddingLeft=Math.max((F-P+_)*this.width/(this.width-P),0),this.paddingRight=Math.max((U-z+_)*this.width/(this.width-z),0)}else{let P=o.height/2,z=i.height/2;m==="start"?(P=0,z=i.height):m==="end"&&(P=o.height,z=0),this.paddingTop=P+_,this.paddingBottom=z+_}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Vn(this.options.afterFit,[this])}isHorizontal(){const{axis:i,position:o}=this.options;return o==="top"||o==="bottom"||i==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(i){this.beforeTickToLabelConversion(),this.generateTickLabels(i);let o,c;for(o=0,c=i.length;o<c;o++)gn(i[o].label)&&(i.splice(o,1),c--,o--);this.afterTickToLabelConversion()}_getLabelSizes(){let i=this._labelSizes;if(!i){const o=this.options.ticks.sampleSize;let c=this.ticks;o<c.length&&(c=TS(c,o)),this._labelSizes=i=this._computeLabelSizes(c,c.length,this.options.ticks.maxTicksLimit)}return i}_computeLabelSizes(i,o,c){const{ctx:f,_longestTextCache:m}=this,_=[],v=[],s=Math.floor(o/wS(o,c));let S=0,P=0,z,F,U,Z,W,Q,re,ie,ve,pe,ke;for(z=0;z<o;z+=s){if(Z=i[z].label,W=this._resolveTickFontOptions(z),f.font=Q=W.string,re=m[Q]=m[Q]||{data:{},gc:[]},ie=W.lineHeight,ve=pe=0,!gn(Z)&&!Zn(Z))ve=Kg(f,re.data,re.gc,ve,Z),pe=ie;else if(Zn(Z))for(F=0,U=Z.length;F<U;++F)ke=Z[F],!gn(ke)&&!Zn(ke)&&(ve=Kg(f,re.data,re.gc,ve,ke),pe+=ie);_.push(ve),v.push(pe),S=Math.max(ve,S),P=Math.max(pe,P)}$4(m,o);const Me=_.indexOf(S),Ye=v.indexOf(P),ot=Mt=>({width:_[Mt]||0,height:v[Mt]||0});return{first:ot(0),last:ot(o-1),widest:ot(Me),highest:ot(Ye),widths:_,heights:v}}getLabelForValue(i){return i}getPixelForValue(i,o){return NaN}getValueForPixel(i){}getPixelForTick(i){const o=this.ticks;return i<0||i>o.length-1?null:this.getPixelForValue(o[i].value)}getPixelForDecimal(i){this._reversePixels&&(i=1-i);const o=this._startPixel+i*this._length;return jL(this._alignToPixels?bc(this.chart,o,0):o)}getDecimalForPixel(i){const o=(i-this._startPixel)/this._length;return this._reversePixels?1-o:o}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:i,max:o}=this;return i<0&&o<0?o:i>0&&o>0?i:0}getContext(i){const o=this.ticks||[];if(i>=0&&i<o.length){const c=o[i];return c.$context||(c.$context=t5(this.getContext(),i,c))}return this.$context||(this.$context=e5(this.chart.getContext(),this))}_tickSize(){const i=this.options.ticks,o=yo(this.labelRotation),c=Math.abs(Math.cos(o)),f=Math.abs(Math.sin(o)),m=this._getLabelSizes(),_=i.autoSkipPadding||0,v=m?m.widest.width+_:0,s=m?m.highest.height+_:0;return this.isHorizontal()?s*c>v*f?v/c:s/f:s*f<v*c?s/c:v/f}_isVisible(){const i=this.options.display;return i!=="auto"?!!i:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(i){const o=this.axis,c=this.chart,f=this.options,{grid:m,position:_,border:v}=f,s=m.offset,S=this.isHorizontal(),z=this.ticks.length+(s?1:0),F=nf(m),U=[],Z=v.setContext(this.getContext()),W=Z.display?Z.width:0,Q=W/2,re=function(ni){return bc(c,ni,W)};let ie,ve,pe,ke,Me,Ye,ot,Mt,Se,yt,_t,Ze;if(_==="top")ie=re(this.bottom),Ye=this.bottom-F,Mt=ie-Q,yt=re(i.top)+Q,Ze=i.bottom;else if(_==="bottom")ie=re(this.top),yt=i.top,Ze=re(i.bottom)-Q,Ye=ie+Q,Mt=this.top+F;else if(_==="left")ie=re(this.right),Me=this.right-F,ot=ie-Q,Se=re(i.left)+Q,_t=i.right;else if(_==="right")ie=re(this.left),Se=i.left,_t=re(i.right)-Q,Me=ie+Q,ot=this.left+F;else if(o==="x"){if(_==="center")ie=re((i.top+i.bottom)/2+.5);else if(sn(_)){const ni=Object.keys(_)[0],ui=_[ni];ie=re(this.chart.scales[ni].getPixelForValue(ui))}yt=i.top,Ze=i.bottom,Ye=ie+Q,Mt=Ye+F}else if(o==="y"){if(_==="center")ie=re((i.left+i.right)/2);else if(sn(_)){const ni=Object.keys(_)[0],ui=_[ni];ie=re(this.chart.scales[ni].getPixelForValue(ui))}Me=ie-Q,ot=Me-F,Se=i.left,_t=i.right}const Tt=Gi(f.ticks.maxTicksLimit,z),Zt=Math.max(1,Math.ceil(z/Tt));for(ve=0;ve<z;ve+=Zt){const ni=this.getContext(ve),ui=m.setContext(ni),Di=v.setContext(ni),ft=ui.lineWidth,yi=ui.color,wi=Di.dash||[],ai=Di.dashOffset,nt=ui.tickWidth,Qe=ui.tickColor,Ii=ui.tickBorderDash||[],bi=ui.tickBorderDashOffset;pe=Q4(this,ve,s),pe!==void 0&&(ke=bc(c,pe,ft),S?Me=ot=Se=_t=ke:Ye=Mt=yt=Ze=ke,U.push({tx1:Me,ty1:Ye,tx2:ot,ty2:Mt,x1:Se,y1:yt,x2:_t,y2:Ze,width:ft,color:yi,borderDash:wi,borderDashOffset:ai,tickWidth:nt,tickColor:Qe,tickBorderDash:Ii,tickBorderDashOffset:bi}))}return this._ticksLength=z,this._borderValue=ie,U}_computeLabelItems(i){const o=this.axis,c=this.options,{position:f,ticks:m}=c,_=this.isHorizontal(),v=this.ticks,{align:s,crossAlign:S,padding:P,mirror:z}=m,F=nf(c.grid),U=F+P,Z=z?-P:U,W=-yo(this.labelRotation),Q=[];let re,ie,ve,pe,ke,Me,Ye,ot,Mt,Se,yt,_t,Ze="middle";if(f==="top")Me=this.bottom-Z,Ye=this._getXAxisLabelAlignment();else if(f==="bottom")Me=this.top+Z,Ye=this._getXAxisLabelAlignment();else if(f==="left"){const Zt=this._getYAxisLabelAlignment(F);Ye=Zt.textAlign,ke=Zt.x}else if(f==="right"){const Zt=this._getYAxisLabelAlignment(F);Ye=Zt.textAlign,ke=Zt.x}else if(o==="x"){if(f==="center")Me=(i.top+i.bottom)/2+U;else if(sn(f)){const Zt=Object.keys(f)[0],ni=f[Zt];Me=this.chart.scales[Zt].getPixelForValue(ni)+U}Ye=this._getXAxisLabelAlignment()}else if(o==="y"){if(f==="center")ke=(i.left+i.right)/2-U;else if(sn(f)){const Zt=Object.keys(f)[0],ni=f[Zt];ke=this.chart.scales[Zt].getPixelForValue(ni)}Ye=this._getYAxisLabelAlignment(F).textAlign}o==="y"&&(s==="start"?Ze="top":s==="end"&&(Ze="bottom"));const Tt=this._getLabelSizes();for(re=0,ie=v.length;re<ie;++re){ve=v[re],pe=ve.label;const Zt=m.setContext(this.getContext(re));ot=this.getPixelForTick(re)+m.labelOffset,Mt=this._resolveTickFontOptions(re),Se=Mt.lineHeight,yt=Zn(pe)?pe.length:1;const ni=yt/2,ui=Zt.color,Di=Zt.textStrokeColor,ft=Zt.textStrokeWidth;let yi=Ye;_?(ke=ot,Ye==="inner"&&(re===ie-1?yi=this.options.reverse?"left":"right":re===0?yi=this.options.reverse?"right":"left":yi="center"),f==="top"?S==="near"||W!==0?_t=-yt*Se+Se/2:S==="center"?_t=-Tt.highest.height/2-ni*Se+Se:_t=-Tt.highest.height+Se/2:S==="near"||W!==0?_t=Se/2:S==="center"?_t=Tt.highest.height/2-ni*Se:_t=Tt.highest.height-yt*Se,z&&(_t*=-1),W!==0&&!Zt.showLabelBackdrop&&(ke+=Se/2*Math.sin(W))):(Me=ot,_t=(1-yt)*Se/2);let wi;if(Zt.showLabelBackdrop){const ai=$r(Zt.backdropPadding),nt=Tt.heights[re],Qe=Tt.widths[re];let Ii=_t-ai.top,bi=0-ai.left;switch(Ze){case"middle":Ii-=nt/2;break;case"bottom":Ii-=nt;break}switch(Ye){case"center":bi-=Qe/2;break;case"right":bi-=Qe;break;case"inner":re===ie-1?bi-=Qe:re>0&&(bi-=Qe/2);break}wi={left:bi,top:Ii,width:Qe+ai.width,height:nt+ai.height,color:Zt.backdropColor}}Q.push({label:pe,font:Mt,textOffset:_t,options:{rotation:W,color:ui,strokeColor:Di,strokeWidth:ft,textAlign:yi,textBaseline:Ze,translation:[ke,Me],backdrop:wi}})}return Q}_getXAxisLabelAlignment(){const{position:i,ticks:o}=this.options;if(-yo(this.labelRotation))return i==="top"?"left":"right";let f="center";return o.align==="start"?f="left":o.align==="end"?f="right":o.align==="inner"&&(f="inner"),f}_getYAxisLabelAlignment(i){const{position:o,ticks:{crossAlign:c,mirror:f,padding:m}}=this.options,_=this._getLabelSizes(),v=i+m,s=_.widest.width;let S,P;return o==="left"?f?(P=this.right+m,c==="near"?S="left":c==="center"?(S="center",P+=s/2):(S="right",P+=s)):(P=this.right-v,c==="near"?S="right":c==="center"?(S="center",P-=s/2):(S="left",P=this.left)):o==="right"?f?(P=this.left+m,c==="near"?S="right":c==="center"?(S="center",P-=s/2):(S="left",P-=s)):(P=this.left+v,c==="near"?S="left":c==="center"?(S="center",P+=s/2):(S="right",P=this.right)):S="right",{textAlign:S,x:P}}_computeLabelArea(){if(this.options.ticks.mirror)return;const i=this.chart,o=this.options.position;if(o==="left"||o==="right")return{top:0,left:this.left,bottom:i.height,right:this.right};if(o==="top"||o==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:i.width}}drawBackground(){const{ctx:i,options:{backgroundColor:o},left:c,top:f,width:m,height:_}=this;o&&(i.save(),i.fillStyle=o,i.fillRect(c,f,m,_),i.restore())}getLineWidthForValue(i){const o=this.options.grid;if(!this._isVisible()||!o.display)return 0;const f=this.ticks.findIndex(m=>m.value===i);return f>=0?o.setContext(this.getContext(f)).lineWidth:0}drawGrid(i){const o=this.options.grid,c=this.ctx,f=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(i));let m,_;const v=(s,S,P)=>{!P.width||!P.color||(c.save(),c.lineWidth=P.width,c.strokeStyle=P.color,c.setLineDash(P.borderDash||[]),c.lineDashOffset=P.borderDashOffset,c.beginPath(),c.moveTo(s.x,s.y),c.lineTo(S.x,S.y),c.stroke(),c.restore())};if(o.display)for(m=0,_=f.length;m<_;++m){const s=f[m];o.drawOnChartArea&&v({x:s.x1,y:s.y1},{x:s.x2,y:s.y2},s),o.drawTicks&&v({x:s.tx1,y:s.ty1},{x:s.tx2,y:s.ty2},{color:s.tickColor,width:s.tickWidth,borderDash:s.tickBorderDash,borderDashOffset:s.tickBorderDashOffset})}}drawBorder(){const{chart:i,ctx:o,options:{border:c,grid:f}}=this,m=c.setContext(this.getContext()),_=c.display?m.width:0;if(!_)return;const v=f.setContext(this.getContext(0)).lineWidth,s=this._borderValue;let S,P,z,F;this.isHorizontal()?(S=bc(i,this.left,_)-_/2,P=bc(i,this.right,v)+v/2,z=F=s):(z=bc(i,this.top,_)-_/2,F=bc(i,this.bottom,v)+v/2,S=P=s),o.save(),o.lineWidth=m.width,o.strokeStyle=m.color,o.beginPath(),o.moveTo(S,z),o.lineTo(P,F),o.stroke(),o.restore()}drawLabels(i){if(!this.options.ticks.display)return;const c=this.ctx,f=this._computeLabelArea();f&&S_(c,f);const m=this.getLabelItems(i);for(const _ of m){const v=_.options,s=_.font,S=_.label,P=_.textOffset;Rc(c,S,0,P,s,v)}f&&E_(c)}drawTitle(){const{ctx:i,options:{position:o,title:c,reverse:f}}=this;if(!c.display)return;const m=Mr(c.font),_=$r(c.padding),v=c.align;let s=m.lineHeight/2;o==="bottom"||o==="center"||sn(o)?(s+=_.bottom,Zn(c.text)&&(s+=m.lineHeight*(c.text.length-1))):s+=_.top;const{titleX:S,titleY:P,maxWidth:z,rotation:F}=n5(this,s,o,v);Rc(i,c.text,0,0,m,{color:c.color,maxWidth:z,rotation:F,textAlign:i5(v,o,f),textBaseline:"middle",translation:[S,P]})}draw(i){this._isVisible()&&(this.drawBackground(),this.drawGrid(i),this.drawBorder(),this.drawTitle(),this.drawLabels(i))}_layers(){const i=this.options,o=i.ticks&&i.ticks.z||0,c=Gi(i.grid&&i.grid.z,-1),f=Gi(i.border&&i.border.z,0);return!this._isVisible()||this.draw!==Fc.prototype.draw?[{z:o,draw:m=>{this.draw(m)}}]:[{z:c,draw:m=>{this.drawBackground(),this.drawGrid(m),this.drawTitle()}},{z:f,draw:()=>{this.drawBorder()}},{z:o,draw:m=>{this.drawLabels(m)}}]}getMatchingVisibleMetas(i){const o=this.chart.getSortedVisibleDatasetMetas(),c=this.axis+"AxisID",f=[];let m,_;for(m=0,_=o.length;m<_;++m){const v=o[m];v[c]===this.id&&(!i||v.type===i)&&f.push(v)}return f}_resolveTickFontOptions(i){const o=this.options.ticks.setContext(this.getContext(i));return Mr(o.font)}_maxDigits(){const i=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/i}}class og{constructor(i,o,c){this.type=i,this.scope=o,this.override=c,this.items=Object.create(null)}isForType(i){return Object.prototype.isPrototypeOf.call(this.type.prototype,i.prototype)}register(i){const o=Object.getPrototypeOf(i);let c;o5(o)&&(c=this.register(o));const f=this.items,m=i.id,_=this.scope+"."+m;if(!m)throw new Error("class does not have id: "+i);return m in f||(f[m]=i,r5(i,_,c),this.override&&ar.override(i.id,i.overrides)),_}get(i){return this.items[i]}unregister(i){const o=this.items,c=i.id,f=this.scope;c in o&&delete o[c],f&&c in ar[f]&&(delete ar[f][c],this.override&&delete Lc[c])}}function r5(r,i,o){const c=Pf(Object.create(null),[o?ar.get(o):{},ar.get(i),r.defaults]);ar.set(i,c),r.defaultRoutes&&s5(i,r.defaultRoutes),r.descriptors&&ar.describe(i,r.descriptors)}function s5(r,i){Object.keys(i).forEach(o=>{const c=o.split("."),f=c.pop(),m=[r].concat(c).join("."),_=i[o].split("."),v=_.pop(),s=_.join(".");ar.route(m,f,s,v)})}function o5(r){return"id"in r&&"defaults"in r}class a5{constructor(){this.controllers=new og(vo,"datasets",!0),this.elements=new og(bo,"elements"),this.plugins=new og(Object,"plugins"),this.scales=new og(Fc,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...i){this._each("register",i)}remove(...i){this._each("unregister",i)}addControllers(...i){this._each("register",i,this.controllers)}addElements(...i){this._each("register",i,this.elements)}addPlugins(...i){this._each("register",i,this.plugins)}addScales(...i){this._each("register",i,this.scales)}getController(i){return this._get(i,this.controllers,"controller")}getElement(i){return this._get(i,this.elements,"element")}getPlugin(i){return this._get(i,this.plugins,"plugin")}getScale(i){return this._get(i,this.scales,"scale")}removeControllers(...i){this._each("unregister",i,this.controllers)}removeElements(...i){this._each("unregister",i,this.elements)}removePlugins(...i){this._each("unregister",i,this.plugins)}removeScales(...i){this._each("unregister",i,this.scales)}_each(i,o,c){[...o].forEach(f=>{const m=c||this._getRegistryForType(f);c||m.isForType(f)||m===this.plugins&&f.id?this._exec(i,m,f):An(f,_=>{const v=c||this._getRegistryForType(_);this._exec(i,v,_)})})}_exec(i,o,c){const f=bv(i);Vn(c["before"+f],[],c),o[i](c),Vn(c["after"+f],[],c)}_getRegistryForType(i){for(let o=0;o<this._typedRegistries.length;o++){const c=this._typedRegistries[o];if(c.isForType(i))return c}return this.plugins}_get(i,o,c){const f=o.get(i);if(f===void 0)throw new Error('"'+i+'" is not a registered '+c+".");return f}}var Xo=new a5;class l5{constructor(){this._init=[]}notify(i,o,c,f){o==="beforeInit"&&(this._init=this._createDescriptors(i,!0),this._notify(this._init,i,"install"));const m=f?this._descriptors(i).filter(f):this._descriptors(i),_=this._notify(m,i,o,c);return o==="afterDestroy"&&(this._notify(m,i,"stop"),this._notify(this._init,i,"uninstall")),_}_notify(i,o,c,f){f=f||{};for(const m of i){const _=m.plugin,v=_[c],s=[o,f,m.options];if(Vn(v,s,_)===!1&&f.cancelable)return!1}return!0}invalidate(){gn(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(i){if(this._cache)return this._cache;const o=this._cache=this._createDescriptors(i);return this._notifyStateChanges(i),o}_createDescriptors(i,o){const c=i&&i.config,f=Gi(c.options&&c.options.plugins,{}),m=c5(c);return f===!1&&!o?[]:h5(i,m,f,o)}_notifyStateChanges(i){const o=this._oldCache||[],c=this._cache,f=(m,_)=>m.filter(v=>!_.some(s=>v.plugin.id===s.plugin.id));this._notify(f(o,c),i,"stop"),this._notify(f(c,o),i,"start")}}function c5(r){const i={},o=[],c=Object.keys(Xo.plugins.items);for(let m=0;m<c.length;m++)o.push(Xo.getPlugin(c[m]));const f=r.plugins||[];for(let m=0;m<f.length;m++){const _=f[m];o.indexOf(_)===-1&&(o.push(_),i[_.id]=!0)}return{plugins:o,localIds:i}}function u5(r,i){return!i&&r===!1?null:r===!0?{}:r}function h5(r,{plugins:i,localIds:o},c,f){const m=[],_=r.getContext();for(const v of i){const s=v.id,S=u5(c[s],f);S!==null&&m.push({plugin:v,options:d5(r.config,{plugin:v,local:o[s]},S,_)})}return m}function d5(r,{plugin:i,local:o},c,f){const m=r.pluginScopeKeys(i),_=r.getOptionScopes(c,m);return o&&i.defaults&&_.push(i.defaults),r.createResolver(_,f,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Ox(r,i){const o=ar.datasets[r]||{};return((i.datasets||{})[r]||{}).indexAxis||i.indexAxis||o.indexAxis||"x"}function f5(r,i){let o=r;return r==="_index_"?o=i:r==="_value_"&&(o=i==="x"?"y":"x"),o}function p5(r,i){return r===i?"_index_":"_value_"}function SS(r){if(r==="x"||r==="y"||r==="r")return r}function m5(r){if(r==="top"||r==="bottom")return"x";if(r==="left"||r==="right")return"y"}function Bx(r,...i){if(SS(r))return r;for(const o of i){const c=o.axis||m5(o.position)||r.length>1&&SS(r[0].toLowerCase());if(c)return c}throw new Error(`Cannot determine type of '${r}' axis. Please provide 'axis' or 'position' option.`)}function ES(r,i,o){if(o[i+"AxisID"]===r)return{axis:i}}function g5(r,i){if(i.data&&i.data.datasets){const o=i.data.datasets.filter(c=>c.xAxisID===r||c.yAxisID===r);if(o.length)return ES(r,"x",o[0])||ES(r,"y",o[0])}return{}}function _5(r,i){const o=Lc[r.type]||{scales:{}},c=i.scales||{},f=Ox(r.type,i),m=Object.create(null);return Object.keys(c).forEach(_=>{const v=c[_];if(!sn(v))return console.error(`Invalid scale configuration for scale: ${_}`);if(v._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${_}`);const s=Bx(_,v,g5(_,r),ar.scales[v.type]),S=p5(s,f),P=o.scales||{};m[_]=wf(Object.create(null),[{axis:s},v,P[s],P[S]])}),r.data.datasets.forEach(_=>{const v=_.type||r.type,s=_.indexAxis||Ox(v,i),P=(Lc[v]||{}).scales||{};Object.keys(P).forEach(z=>{const F=f5(z,s),U=_[F+"AxisID"]||F;m[U]=m[U]||Object.create(null),wf(m[U],[{axis:F},c[U],P[z]])})}),Object.keys(m).forEach(_=>{const v=m[_];wf(v,[ar.scales[v.type],ar.scale])}),m}function ik(r){const i=r.options||(r.options={});i.plugins=Gi(i.plugins,{}),i.scales=_5(r,i)}function nk(r){return r=r||{},r.datasets=r.datasets||[],r.labels=r.labels||[],r}function y5(r){return r=r||{},r.data=nk(r.data),ik(r),r}const AS=new Map,rk=new Set;function ag(r,i){let o=AS.get(r);return o||(o=i(),AS.set(r,o),rk.add(o)),o}const rf=(r,i,o)=>{const c=Cl(i,o);c!==void 0&&r.add(c)};class x5{constructor(i){this._config=y5(i),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(i){this._config.type=i}get data(){return this._config.data}set data(i){this._config.data=nk(i)}get options(){return this._config.options}set options(i){this._config.options=i}get plugins(){return this._config.plugins}update(){const i=this._config;this.clearCache(),ik(i)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(i){return ag(i,()=>[[`datasets.${i}`,""]])}datasetAnimationScopeKeys(i,o){return ag(`${i}.transition.${o}`,()=>[[`datasets.${i}.transitions.${o}`,`transitions.${o}`],[`datasets.${i}`,""]])}datasetElementScopeKeys(i,o){return ag(`${i}-${o}`,()=>[[`datasets.${i}.elements.${o}`,`datasets.${i}`,`elements.${o}`,""]])}pluginScopeKeys(i){const o=i.id,c=this.type;return ag(`${c}-plugin-${o}`,()=>[[`plugins.${o}`,...i.additionalOptionScopes||[]]])}_cachedScopes(i,o){const c=this._scopeCache;let f=c.get(i);return(!f||o)&&(f=new Map,c.set(i,f)),f}getOptionScopes(i,o,c){const{options:f,type:m}=this,_=this._cachedScopes(i,c),v=_.get(o);if(v)return v;const s=new Set;o.forEach(P=>{i&&(s.add(i),P.forEach(z=>rf(s,i,z))),P.forEach(z=>rf(s,f,z)),P.forEach(z=>rf(s,Lc[m]||{},z)),P.forEach(z=>rf(s,ar,z)),P.forEach(z=>rf(s,zx,z))});const S=Array.from(s);return S.length===0&&S.push(Object.create(null)),rk.has(o)&&_.set(o,S),S}chartOptionScopes(){const{options:i,type:o}=this;return[i,Lc[o]||{},ar.datasets[o]||{},{type:o},ar,zx]}resolveNamedOptions(i,o,c,f=[""]){const m={$shared:!0},{resolver:_,subPrefixes:v}=IS(this._resolverCache,i,f);let s=_;if(b5(_,o)){m.$shared=!1,c=Pl(c)?c():c;const S=this.createResolver(i,c,v);s=lh(_,c,S)}for(const S of o)m[S]=s[S];return m}createResolver(i,o,c=[""],f){const{resolver:m}=IS(this._resolverCache,i,c);return sn(o)?lh(m,o,void 0,f):m}}function IS(r,i,o){let c=r.get(i);c||(c=new Map,r.set(i,c));const f=o.join();let m=c.get(f);return m||(m={resolver:Av(i,o),subPrefixes:o.filter(v=>!v.toLowerCase().includes("hover"))},c.set(f,m)),m}const v5=r=>sn(r)&&Object.getOwnPropertyNames(r).some(i=>Pl(r[i]));function b5(r,i){const{isScriptable:o,isIndexable:c}=BI(r);for(const f of i){const m=o(f),_=c(f),v=(_||m)&&r[f];if(m&&(Pl(v)||v5(v))||_&&Zn(v))return!0}return!1}var w5="4.4.2";const T5=["top","bottom","left","right","chartArea"];function kS(r,i){return r==="top"||r==="bottom"||T5.indexOf(r)===-1&&i==="x"}function CS(r,i){return function(o,c){return o[r]===c[r]?o[i]-c[i]:o[r]-c[r]}}function PS(r){const i=r.chart,o=i.options.animation;i.notifyPlugins("afterRender"),Vn(o&&o.onComplete,[r],i)}function M5(r){const i=r.chart,o=i.options.animation;Vn(o&&o.onProgress,[r],i)}function sk(r){return Cv()&&typeof r=="string"?r=document.getElementById(r):r&&r.length&&(r=r[0]),r&&r.canvas&&(r=r.canvas),r}const Eg={},DS=r=>{const i=sk(r);return Object.values(Eg).filter(o=>o.canvas===i).pop()};function S5(r,i,o){const c=Object.keys(r);for(const f of c){const m=+f;if(m>=i){const _=r[f];delete r[f],(o>0||m>i)&&(r[m+o]=_)}}}function E5(r,i,o,c){return!o||r.type==="mouseout"?null:c?i:r}function lg(r,i,o){return r.options.clip?r[o]:i[o]}function A5(r,i){const{xScale:o,yScale:c}=r;return o&&c?{left:lg(o,i,"left"),right:lg(o,i,"right"),top:lg(c,i,"top"),bottom:lg(c,i,"bottom")}:i}class Ml{static register(...i){Xo.add(...i),zS()}static unregister(...i){Xo.remove(...i),zS()}constructor(i,o){const c=this.config=new x5(o),f=sk(i),m=DS(f);if(m)throw new Error("Canvas is already in use. Chart with ID '"+m.id+"' must be destroyed before the canvas with ID '"+m.canvas.id+"' can be reused.");const _=c.createResolver(c.chartOptionScopes(),this.getContext());this.platform=new(c.platform||H4(f)),this.platform.updateConfig(c);const v=this.platform.acquireContext(f,_.aspectRatio),s=v&&v.canvas,S=s&&s.height,P=s&&s.width;if(this.id=kL(),this.ctx=v,this.canvas=s,this.width=P,this.height=S,this._options=_,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new l5,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=WL(z=>this.update(z),_.resizeDelay||0),this._dataChanges=[],Eg[this.id]=this,!v||!s){console.error("Failed to create chart: can't acquire context from the given item");return}La.listen(this,"complete",PS),La.listen(this,"progress",M5),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:i,maintainAspectRatio:o},width:c,height:f,_aspectRatio:m}=this;return gn(i)?o&&m?m:f?c/f:null:i}get data(){return this.config.data}set data(i){this.config.data=i}get options(){return this._options}set options(i){this.config.options=i}get registry(){return Xo}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():eS(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return JM(this.canvas,this.ctx),this}stop(){return La.stop(this),this}resize(i,o){La.running(this)?this._resizeBeforeDraw={width:i,height:o}:this._resize(i,o)}_resize(i,o){const c=this.options,f=this.canvas,m=c.maintainAspectRatio&&this.aspectRatio,_=this.platform.getMaximumSize(f,i,o,m),v=c.devicePixelRatio||this.platform.getDevicePixelRatio(),s=this.width?"resize":"attach";this.width=_.width,this.height=_.height,this._aspectRatio=this.aspectRatio,eS(this,v,!0)&&(this.notifyPlugins("resize",{size:_}),Vn(c.onResize,[this,_],this),this.attached&&this._doResize(s)&&this.render())}ensureScalesHaveIDs(){const o=this.options.scales||{};An(o,(c,f)=>{c.id=f})}buildOrUpdateScales(){const i=this.options,o=i.scales,c=this.scales,f=Object.keys(c).reduce((_,v)=>(_[v]=!1,_),{});let m=[];o&&(m=m.concat(Object.keys(o).map(_=>{const v=o[_],s=Bx(_,v),S=s==="r",P=s==="x";return{options:v,dposition:S?"chartArea":P?"bottom":"left",dtype:S?"radialLinear":P?"category":"linear"}}))),An(m,_=>{const v=_.options,s=v.id,S=Bx(s,v),P=Gi(v.type,_.dtype);(v.position===void 0||kS(v.position,S)!==kS(_.dposition))&&(v.position=_.dposition),f[s]=!0;let z=null;if(s in c&&c[s].type===P)z=c[s];else{const F=Xo.getScale(P);z=new F({id:s,type:P,ctx:this.ctx,chart:this}),c[z.id]=z}z.init(v,i)}),An(f,(_,v)=>{_||delete c[v]}),An(c,_=>{Jr.configure(this,_,_.options),Jr.addBox(this,_)})}_updateMetasets(){const i=this._metasets,o=this.data.datasets.length,c=i.length;if(i.sort((f,m)=>f.index-m.index),c>o){for(let f=o;f<c;++f)this._destroyDatasetMeta(f);i.splice(o,c-o)}this._sortedMetasets=i.slice(0).sort(CS("order","index"))}_removeUnreferencedMetasets(){const{_metasets:i,data:{datasets:o}}=this;i.length>o.length&&delete this._stacks,i.forEach((c,f)=>{o.filter(m=>m===c._dataset).length===0&&this._destroyDatasetMeta(f)})}buildOrUpdateControllers(){const i=[],o=this.data.datasets;let c,f;for(this._removeUnreferencedMetasets(),c=0,f=o.length;c<f;c++){const m=o[c];let _=this.getDatasetMeta(c);const v=m.type||this.config.type;if(_.type&&_.type!==v&&(this._destroyDatasetMeta(c),_=this.getDatasetMeta(c)),_.type=v,_.indexAxis=m.indexAxis||Ox(v,this.options),_.order=m.order||0,_.index=c,_.label=""+m.label,_.visible=this.isDatasetVisible(c),_.controller)_.controller.updateIndex(c),_.controller.linkScales();else{const s=Xo.getController(v),{datasetElementType:S,dataElementType:P}=ar.datasets[v];Object.assign(s,{dataElementType:Xo.getElement(P),datasetElementType:S&&Xo.getElement(S)}),_.controller=new s(this,c),i.push(_.controller)}}return this._updateMetasets(),i}_resetElements(){An(this.data.datasets,(i,o)=>{this.getDatasetMeta(o).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(i){const o=this.config;o.update();const c=this._options=o.createResolver(o.chartOptionScopes(),this.getContext()),f=this._animationsDisabled=!c.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:i,cancelable:!0})===!1)return;const m=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let _=0;for(let S=0,P=this.data.datasets.length;S<P;S++){const{controller:z}=this.getDatasetMeta(S),F=!f&&m.indexOf(z)===-1;z.buildOrUpdateElements(F),_=Math.max(+z.getMaxOverflow(),_)}_=this._minPadding=c.layout.autoPadding?_:0,this._updateLayout(_),f||An(m,S=>{S.reset()}),this._updateDatasets(i),this.notifyPlugins("afterUpdate",{mode:i}),this._layers.sort(CS("z","_idx"));const{_active:v,_lastEvent:s}=this;s?this._eventHandler(s,!0):v.length&&this._updateHoverStyles(v,v,!0),this.render()}_updateScales(){An(this.scales,i=>{Jr.removeBox(this,i)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const i=this.options,o=new Set(Object.keys(this._listeners)),c=new Set(i.events);(!UM(o,c)||!!this._responsiveListeners!==i.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:i}=this,o=this._getUniformDataChanges()||[];for(const{method:c,start:f,count:m}of o){const _=c==="_removeElements"?-m:m;S5(i,f,_)}}_getUniformDataChanges(){const i=this._dataChanges;if(!i||!i.length)return;this._dataChanges=[];const o=this.data.datasets.length,c=m=>new Set(i.filter(_=>_[0]===m).map((_,v)=>v+","+_.splice(1).join(","))),f=c(0);for(let m=1;m<o;m++)if(!UM(f,c(m)))return;return Array.from(f).map(m=>m.split(",")).map(m=>({method:m[1],start:+m[2],count:+m[3]}))}_updateLayout(i){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Jr.update(this,this.width,this.height,i);const o=this.chartArea,c=o.width<=0||o.height<=0;this._layers=[],An(this.boxes,f=>{c&&f.position==="chartArea"||(f.configure&&f.configure(),this._layers.push(...f._layers()))},this),this._layers.forEach((f,m)=>{f._idx=m}),this.notifyPlugins("afterLayout")}_updateDatasets(i){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:i,cancelable:!0})!==!1){for(let o=0,c=this.data.datasets.length;o<c;++o)this.getDatasetMeta(o).controller.configure();for(let o=0,c=this.data.datasets.length;o<c;++o)this._updateDataset(o,Pl(i)?i({datasetIndex:o}):i);this.notifyPlugins("afterDatasetsUpdate",{mode:i})}}_updateDataset(i,o){const c=this.getDatasetMeta(i),f={meta:c,index:i,mode:o,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",f)!==!1&&(c.controller._update(o),f.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",f))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(La.has(this)?this.attached&&!La.running(this)&&La.start(this):(this.draw(),PS({chart:this})))}draw(){let i;if(this._resizeBeforeDraw){const{width:c,height:f}=this._resizeBeforeDraw;this._resize(c,f),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const o=this._layers;for(i=0;i<o.length&&o[i].z<=0;++i)o[i].draw(this.chartArea);for(this._drawDatasets();i<o.length;++i)o[i].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(i){const o=this._sortedMetasets,c=[];let f,m;for(f=0,m=o.length;f<m;++f){const _=o[f];(!i||_.visible)&&c.push(_)}return c}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const i=this.getSortedVisibleDatasetMetas();for(let o=i.length-1;o>=0;--o)this._drawDataset(i[o]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(i){const o=this.ctx,c=i._clip,f=!c.disabled,m=A5(i,this.chartArea),_={meta:i,index:i.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",_)!==!1&&(f&&S_(o,{left:c.left===!1?0:m.left-c.left,right:c.right===!1?this.width:m.right+c.right,top:c.top===!1?0:m.top-c.top,bottom:c.bottom===!1?this.height:m.bottom+c.bottom}),i.controller.draw(),f&&E_(o),_.cancelable=!1,this.notifyPlugins("afterDatasetDraw",_))}isPointInArea(i){return Ua(i,this.chartArea,this._minPadding)}getElementsAtEventForMode(i,o,c,f){const m=T4.modes[o];return typeof m=="function"?m(this,i,c,f):[]}getDatasetMeta(i){const o=this.data.datasets[i],c=this._metasets;let f=c.filter(m=>m&&m._dataset===o).pop();return f||(f={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:o&&o.order||0,index:i,_dataset:o,_parsed:[],_sorted:!1},c.push(f)),f}getContext(){return this.$context||(this.$context=Dl(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(i){const o=this.data.datasets[i];if(!o)return!1;const c=this.getDatasetMeta(i);return typeof c.hidden=="boolean"?!c.hidden:!o.hidden}setDatasetVisibility(i,o){const c=this.getDatasetMeta(i);c.hidden=!o}toggleDataVisibility(i){this._hiddenIndices[i]=!this._hiddenIndices[i]}getDataVisibility(i){return!this._hiddenIndices[i]}_updateVisibility(i,o,c){const f=c?"show":"hide",m=this.getDatasetMeta(i),_=m.controller._resolveAnimations(void 0,f);Df(o)?(m.data[o].hidden=!c,this.update()):(this.setDatasetVisibility(i,c),_.update(m,{visible:c}),this.update(v=>v.datasetIndex===i?f:void 0))}hide(i,o){this._updateVisibility(i,o,!1)}show(i,o){this._updateVisibility(i,o,!0)}_destroyDatasetMeta(i){const o=this._metasets[i];o&&o.controller&&o.controller._destroy(),delete this._metasets[i]}_stop(){let i,o;for(this.stop(),La.remove(this),i=0,o=this.data.datasets.length;i<o;++i)this._destroyDatasetMeta(i)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:i,ctx:o}=this;this._stop(),this.config.clearCache(),i&&(this.unbindEvents(),JM(i,o),this.platform.releaseContext(o),this.canvas=null,this.ctx=null),delete Eg[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...i){return this.canvas.toDataURL(...i)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const i=this._listeners,o=this.platform,c=(m,_)=>{o.addEventListener(this,m,_),i[m]=_},f=(m,_,v)=>{m.offsetX=_,m.offsetY=v,this._eventHandler(m)};An(this.options.events,m=>c(m,f))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const i=this._responsiveListeners,o=this.platform,c=(s,S)=>{o.addEventListener(this,s,S),i[s]=S},f=(s,S)=>{i[s]&&(o.removeEventListener(this,s,S),delete i[s])},m=(s,S)=>{this.canvas&&this.resize(s,S)};let _;const v=()=>{f("attach",v),this.attached=!0,this.resize(),c("resize",m),c("detach",_)};_=()=>{this.attached=!1,f("resize",m),this._stop(),this._resize(0,0),c("attach",v)},o.isAttached(this.canvas)?v():_()}unbindEvents(){An(this._listeners,(i,o)=>{this.platform.removeEventListener(this,o,i)}),this._listeners={},An(this._responsiveListeners,(i,o)=>{this.platform.removeEventListener(this,o,i)}),this._responsiveListeners=void 0}updateHoverStyle(i,o,c){const f=c?"set":"remove";let m,_,v,s;for(o==="dataset"&&(m=this.getDatasetMeta(i[0].datasetIndex),m.controller["_"+f+"DatasetHoverStyle"]()),v=0,s=i.length;v<s;++v){_=i[v];const S=_&&this.getDatasetMeta(_.datasetIndex).controller;S&&S[f+"HoverStyle"](_.element,_.datasetIndex,_.index)}}getActiveElements(){return this._active||[]}setActiveElements(i){const o=this._active||[],c=i.map(({datasetIndex:m,index:_})=>{const v=this.getDatasetMeta(m);if(!v)throw new Error("No dataset found at index "+m);return{datasetIndex:m,element:v.data[_],index:_}});!Zg(c,o)&&(this._active=c,this._lastEvent=null,this._updateHoverStyles(c,o))}notifyPlugins(i,o,c){return this._plugins.notify(this,i,o,c)}isPluginEnabled(i){return this._plugins._cache.filter(o=>o.plugin.id===i).length===1}_updateHoverStyles(i,o,c){const f=this.options.hover,m=(s,S)=>s.filter(P=>!S.some(z=>P.datasetIndex===z.datasetIndex&&P.index===z.index)),_=m(o,i),v=c?i:m(i,o);_.length&&this.updateHoverStyle(_,f.mode,!1),v.length&&f.mode&&this.updateHoverStyle(v,f.mode,!0)}_eventHandler(i,o){const c={event:i,replay:o,cancelable:!0,inChartArea:this.isPointInArea(i)},f=_=>(_.options.events||this.options.events).includes(i.native.type);if(this.notifyPlugins("beforeEvent",c,f)===!1)return;const m=this._handleEvent(i,o,c.inChartArea);return c.cancelable=!1,this.notifyPlugins("afterEvent",c,f),(m||c.changed)&&this.render(),this}_handleEvent(i,o,c){const{_active:f=[],options:m}=this,_=o,v=this._getActiveElements(i,f,c,_),s=RL(i),S=E5(i,this._lastEvent,c,s);c&&(this._lastEvent=null,Vn(m.onHover,[i,v,this],this),s&&Vn(m.onClick,[i,v,this],this));const P=!Zg(v,f);return(P||o)&&(this._active=v,this._updateHoverStyles(v,f,o)),this._lastEvent=S,P}_getActiveElements(i,o,c,f){if(i.type==="mouseout")return[];if(!c)return o;const m=this.options.hover;return this.getElementsAtEventForMode(i,m.mode,m,f)}}qt(Ml,"defaults",ar),qt(Ml,"instances",Eg),qt(Ml,"overrides",Lc),qt(Ml,"registry",Xo),qt(Ml,"version",w5),qt(Ml,"getChart",DS);function zS(){return An(Ml.instances,r=>r._plugins.invalidate())}function I5(r,i,o){const{startAngle:c,pixelMargin:f,x:m,y:_,outerRadius:v,innerRadius:s}=i;let S=f/v;r.beginPath(),r.arc(m,_,v,c-S,o+S),s>f?(S=f/s,r.arc(m,_,s,o+S,c-S,!0)):r.arc(m,_,f,o+fr,c-fr),r.closePath(),r.clip()}function k5(r){return Ev(r,["outerStart","outerEnd","innerStart","innerEnd"])}function C5(r,i,o,c){const f=k5(r.options.borderRadius),m=(o-i)/2,_=Math.min(m,c*i/2),v=s=>{const S=(o-Math.min(m,s))*c/2;return Ir(s,0,Math.min(m,S))};return{outerStart:v(f.outerStart),outerEnd:v(f.outerEnd),innerStart:Ir(f.innerStart,0,_),innerEnd:Ir(f.innerEnd,0,_)}}function Zu(r,i,o,c){return{x:o+r*Math.cos(i),y:c+r*Math.sin(i)}}function $g(r,i,o,c,f,m){const{x:_,y:v,startAngle:s,pixelMargin:S,innerRadius:P}=i,z=Math.max(i.outerRadius+c+o-S,0),F=P>0?P+c+o+S:0;let U=0;const Z=f-s;if(c){const Zt=P>0?P-c:0,ni=z>0?z-c:0,ui=(Zt+ni)/2,Di=ui!==0?Z*ui/(ui+c):Z;U=(Z-Di)/2}const W=Math.max(.001,Z*z-o/Yn)/z,Q=(Z-W)/2,re=s+Q+U,ie=f-Q-U,{outerStart:ve,outerEnd:pe,innerStart:ke,innerEnd:Me}=C5(i,F,z,ie-re),Ye=z-ve,ot=z-pe,Mt=re+ve/Ye,Se=ie-pe/ot,yt=F+ke,_t=F+Me,Ze=re+ke/yt,Tt=ie-Me/_t;if(r.beginPath(),m){const Zt=(Mt+Se)/2;if(r.arc(_,v,z,Mt,Zt),r.arc(_,v,z,Zt,Se),pe>0){const ft=Zu(ot,Se,_,v);r.arc(ft.x,ft.y,pe,Se,ie+fr)}const ni=Zu(_t,ie,_,v);if(r.lineTo(ni.x,ni.y),Me>0){const ft=Zu(_t,Tt,_,v);r.arc(ft.x,ft.y,Me,ie+fr,Tt+Math.PI)}const ui=(ie-Me/F+(re+ke/F))/2;if(r.arc(_,v,F,ie-Me/F,ui,!0),r.arc(_,v,F,ui,re+ke/F,!0),ke>0){const ft=Zu(yt,Ze,_,v);r.arc(ft.x,ft.y,ke,Ze+Math.PI,re-fr)}const Di=Zu(Ye,re,_,v);if(r.lineTo(Di.x,Di.y),ve>0){const ft=Zu(Ye,Mt,_,v);r.arc(ft.x,ft.y,ve,re-fr,Mt)}}else{r.moveTo(_,v);const Zt=Math.cos(Mt)*z+_,ni=Math.sin(Mt)*z+v;r.lineTo(Zt,ni);const ui=Math.cos(Se)*z+_,Di=Math.sin(Se)*z+v;r.lineTo(ui,Di)}r.closePath()}function P5(r,i,o,c,f){const{fullCircles:m,startAngle:_,circumference:v}=i;let s=i.endAngle;if(m){$g(r,i,o,c,s,f);for(let S=0;S<m;++S)r.fill();isNaN(v)||(s=_+(v%Xn||Xn))}return $g(r,i,o,c,s,f),r.fill(),s}function D5(r,i,o,c,f){const{fullCircles:m,startAngle:_,circumference:v,options:s}=i,{borderWidth:S,borderJoinStyle:P,borderDash:z,borderDashOffset:F}=s,U=s.borderAlign==="inner";if(!S)return;r.setLineDash(z||[]),r.lineDashOffset=F,U?(r.lineWidth=S*2,r.lineJoin=P||"round"):(r.lineWidth=S,r.lineJoin=P||"bevel");let Z=i.endAngle;if(m){$g(r,i,o,c,Z,f);for(let W=0;W<m;++W)r.stroke();isNaN(v)||(Z=_+(v%Xn||Xn))}U&&I5(r,i,Z),m||($g(r,i,o,c,Z,f),r.stroke())}class ff extends bo{constructor(o){super();qt(this,"circumference");qt(this,"endAngle");qt(this,"fullCircles");qt(this,"innerRadius");qt(this,"outerRadius");qt(this,"pixelMargin");qt(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,o&&Object.assign(this,o)}inRange(o,c,f){const m=this.getProps(["x","y"],f),{angle:_,distance:v}=AI(m,{x:o,y:c}),{startAngle:s,endAngle:S,innerRadius:P,outerRadius:z,circumference:F}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],f),U=(this.options.spacing+this.options.borderWidth)/2,W=Gi(F,S-s)>=Xn||zf(_,s,S),Q=Va(v,P+U,z+U);return W&&Q}getCenterPoint(o){const{x:c,y:f,startAngle:m,endAngle:_,innerRadius:v,outerRadius:s}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],o),{offset:S,spacing:P}=this.options,z=(m+_)/2,F=(v+s+P+S)/2;return{x:c+Math.cos(z)*F,y:f+Math.sin(z)*F}}tooltipPosition(o){return this.getCenterPoint(o)}draw(o){const{options:c,circumference:f}=this,m=(c.offset||0)/4,_=(c.spacing||0)/2,v=c.circular;if(this.pixelMargin=c.borderAlign==="inner"?.33:0,this.fullCircles=f>Xn?Math.floor(f/Xn):0,f===0||this.innerRadius<0||this.outerRadius<0)return;o.save();const s=(this.startAngle+this.endAngle)/2;o.translate(Math.cos(s)*m,Math.sin(s)*m);const S=1-Math.sin(Math.min(Yn,f||0)),P=m*S;o.fillStyle=c.backgroundColor,o.strokeStyle=c.borderColor,P5(o,this,P,_,v),D5(o,this,P,_,v),o.restore()}}qt(ff,"id","arc"),qt(ff,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),qt(ff,"defaultRoutes",{backgroundColor:"backgroundColor"}),qt(ff,"descriptors",{_scriptable:!0,_indexable:o=>o!=="borderDash"});function ok(r,i,o=i){r.lineCap=Gi(o.borderCapStyle,i.borderCapStyle),r.setLineDash(Gi(o.borderDash,i.borderDash)),r.lineDashOffset=Gi(o.borderDashOffset,i.borderDashOffset),r.lineJoin=Gi(o.borderJoinStyle,i.borderJoinStyle),r.lineWidth=Gi(o.borderWidth,i.borderWidth),r.strokeStyle=Gi(o.borderColor,i.borderColor)}function z5(r,i,o){r.lineTo(o.x,o.y)}function L5(r){return r.stepped?nR:r.tension||r.cubicInterpolationMode==="monotone"?rR:z5}function ak(r,i,o={}){const c=r.length,{start:f=0,end:m=c-1}=o,{start:_,end:v}=i,s=Math.max(f,_),S=Math.min(m,v),P=f<_&&m<_||f>v&&m>v;return{count:c,start:s,loop:i.loop,ilen:S<s&&!P?c+S-s:S-s}}function R5(r,i,o,c){const{points:f,options:m}=i,{count:_,start:v,loop:s,ilen:S}=ak(f,o,c),P=L5(m);let{move:z=!0,reverse:F}=c||{},U,Z,W;for(U=0;U<=S;++U)Z=f[(v+(F?S-U:U))%_],!Z.skip&&(z?(r.moveTo(Z.x,Z.y),z=!1):P(r,W,Z,F,m.stepped),W=Z);return s&&(Z=f[(v+(F?S:0))%_],P(r,W,Z,F,m.stepped)),!!s}function O5(r,i,o,c){const f=i.points,{count:m,start:_,ilen:v}=ak(f,o,c),{move:s=!0,reverse:S}=c||{};let P=0,z=0,F,U,Z,W,Q,re;const ie=pe=>(_+(S?v-pe:pe))%m,ve=()=>{W!==Q&&(r.lineTo(P,Q),r.lineTo(P,W),r.lineTo(P,re))};for(s&&(U=f[ie(0)],r.moveTo(U.x,U.y)),F=0;F<=v;++F){if(U=f[ie(F)],U.skip)continue;const pe=U.x,ke=U.y,Me=pe|0;Me===Z?(ke<W?W=ke:ke>Q&&(Q=ke),P=(z*P+pe)/++z):(ve(),r.lineTo(pe,ke),Z=Me,z=0,W=Q=ke),re=ke}ve()}function Fx(r){const i=r.options,o=i.borderDash&&i.borderDash.length;return!r._decimated&&!r._loop&&!i.tension&&i.cubicInterpolationMode!=="monotone"&&!i.stepped&&!o?O5:R5}function B5(r){return r.stepped?OR:r.tension||r.cubicInterpolationMode==="monotone"?BR:Sc}function F5(r,i,o,c){let f=i._path;f||(f=i._path=new Path2D,i.path(f,o,c)&&f.closePath()),ok(r,i.options),r.stroke(f)}function N5(r,i,o,c){const{segments:f,options:m}=i,_=Fx(i);for(const v of f)ok(r,m,v.style),r.beginPath(),_(r,i,v,{start:o,end:o+c-1})&&r.closePath(),r.stroke()}const V5=typeof Path2D=="function";function j5(r,i,o,c){V5&&!i.options.segment?F5(r,i,o,c):N5(r,i,o,c)}class Al extends bo{constructor(i){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,i&&Object.assign(this,i)}updateControlPoints(i,o){const c=this.options;if((c.tension||c.cubicInterpolationMode==="monotone")&&!c.stepped&&!this._pointsUpdated){const f=c.spanGaps?this._loop:this._fullLoop;IR(this._points,c,i,f,o),this._pointsUpdated=!0}}set points(i){this._points=i,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=GR(this,this.options.segment))}first(){const i=this.segments,o=this.points;return i.length&&o[i[0].start]}last(){const i=this.segments,o=this.points,c=i.length;return c&&o[i[c-1].end]}interpolate(i,o){const c=this.options,f=i[o],m=this.points,_=ZI(this,{property:o,start:f,end:f});if(!_.length)return;const v=[],s=B5(c);let S,P;for(S=0,P=_.length;S<P;++S){const{start:z,end:F}=_[S],U=m[z],Z=m[F];if(U===Z){v.push(U);continue}const W=Math.abs((f-U[o])/(Z[o]-U[o])),Q=s(U,Z,W,c.stepped);Q[o]=i[o],v.push(Q)}return v.length===1?v[0]:v}pathSegment(i,o,c){return Fx(this)(i,this,o,c)}path(i,o,c){const f=this.segments,m=Fx(this);let _=this._loop;o=o||0,c=c||this.points.length-o;for(const v of f)_&=m(i,this,v,{start:o,end:o+c-1});return!!_}draw(i,o,c,f){const m=this.options||{};(this.points||[]).length&&m.borderWidth&&(i.save(),j5(i,this,c,f),i.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}qt(Al,"id","line"),qt(Al,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),qt(Al,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),qt(Al,"descriptors",{_scriptable:!0,_indexable:i=>i!=="borderDash"&&i!=="fill"});function LS(r,i,o,c){const f=r.options,{[o]:m}=r.getProps([o],c);return Math.abs(i-m)<f.radius+f.hitRadius}class Ag extends bo{constructor(o){super();qt(this,"parsed");qt(this,"skip");qt(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,o&&Object.assign(this,o)}inRange(o,c,f){const m=this.options,{x:_,y:v}=this.getProps(["x","y"],f);return Math.pow(o-_,2)+Math.pow(c-v,2)<Math.pow(m.hitRadius+m.radius,2)}inXRange(o,c){return LS(this,o,"x",c)}inYRange(o,c){return LS(this,o,"y",c)}getCenterPoint(o){const{x:c,y:f}=this.getProps(["x","y"],o);return{x:c,y:f}}size(o){o=o||this.options||{};let c=o.radius||0;c=Math.max(c,c&&o.hoverRadius||0);const f=c&&o.borderWidth||0;return(c+f)*2}draw(o,c){const f=this.options;this.skip||f.radius<.1||!Ua(this,c,this.size(f)/2)||(o.strokeStyle=f.borderColor,o.lineWidth=f.borderWidth,o.fillStyle=f.backgroundColor,Lx(o,f,this.x,this.y))}getRange(){const o=this.options||{};return o.radius+o.hitRadius}}qt(Ag,"id","point"),qt(Ag,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),qt(Ag,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function lk(r,i){const{x:o,y:c,base:f,width:m,height:_}=r.getProps(["x","y","base","width","height"],i);let v,s,S,P,z;return r.horizontal?(z=_/2,v=Math.min(o,f),s=Math.max(o,f),S=c-z,P=c+z):(z=m/2,v=o-z,s=o+z,S=Math.min(c,f),P=Math.max(c,f)),{left:v,top:S,right:s,bottom:P}}function Il(r,i,o,c){return r?0:Ir(i,o,c)}function U5(r,i,o){const c=r.options.borderWidth,f=r.borderSkipped,m=OI(c);return{t:Il(f.top,m.top,0,o),r:Il(f.right,m.right,0,i),b:Il(f.bottom,m.bottom,0,o),l:Il(f.left,m.left,0,i)}}function G5(r,i,o){const{enableBorderRadius:c}=r.getProps(["enableBorderRadius"]),f=r.options.borderRadius,m=Cc(f),_=Math.min(i,o),v=r.borderSkipped,s=c||sn(f);return{topLeft:Il(!s||v.top||v.left,m.topLeft,0,_),topRight:Il(!s||v.top||v.right,m.topRight,0,_),bottomLeft:Il(!s||v.bottom||v.left,m.bottomLeft,0,_),bottomRight:Il(!s||v.bottom||v.right,m.bottomRight,0,_)}}function H5(r){const i=lk(r),o=i.right-i.left,c=i.bottom-i.top,f=U5(r,o/2,c/2),m=G5(r,o/2,c/2);return{outer:{x:i.left,y:i.top,w:o,h:c,radius:m},inner:{x:i.left+f.l,y:i.top+f.t,w:o-f.l-f.r,h:c-f.t-f.b,radius:{topLeft:Math.max(0,m.topLeft-Math.max(f.t,f.l)),topRight:Math.max(0,m.topRight-Math.max(f.t,f.r)),bottomLeft:Math.max(0,m.bottomLeft-Math.max(f.b,f.l)),bottomRight:Math.max(0,m.bottomRight-Math.max(f.b,f.r))}}}}function hx(r,i,o,c){const f=i===null,m=o===null,v=r&&!(f&&m)&&lk(r,c);return v&&(f||Va(i,v.left,v.right))&&(m||Va(o,v.top,v.bottom))}function W5(r){return r.topLeft||r.topRight||r.bottomLeft||r.bottomRight}function q5(r,i){r.rect(i.x,i.y,i.w,i.h)}function dx(r,i,o={}){const c=r.x!==o.x?-i:0,f=r.y!==o.y?-i:0,m=(r.x+r.w!==o.x+o.w?i:0)-c,_=(r.y+r.h!==o.y+o.h?i:0)-f;return{x:r.x+c,y:r.y+f,w:r.w+m,h:r.h+_,radius:r.radius}}class Ig extends bo{constructor(i){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,i&&Object.assign(this,i)}draw(i){const{inflateAmount:o,options:{borderColor:c,backgroundColor:f}}=this,{inner:m,outer:_}=H5(this),v=W5(_.radius)?Lf:q5;i.save(),(_.w!==m.w||_.h!==m.h)&&(i.beginPath(),v(i,dx(_,o,m)),i.clip(),v(i,dx(m,-o,_)),i.fillStyle=c,i.fill("evenodd")),i.beginPath(),v(i,dx(m,o)),i.fillStyle=f,i.fill(),i.restore()}inRange(i,o,c){return hx(this,i,o,c)}inXRange(i,o){return hx(this,i,null,o)}inYRange(i,o){return hx(this,null,i,o)}getCenterPoint(i){const{x:o,y:c,base:f,horizontal:m}=this.getProps(["x","y","base","horizontal"],i);return{x:m?(o+f)/2:o,y:m?c:(c+f)/2}}getRange(i){return i==="x"?this.width/2:this.height/2}}qt(Ig,"id","bar"),qt(Ig,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),qt(Ig,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var Z5=Object.freeze({__proto__:null,ArcElement:ff,BarElement:Ig,LineElement:Al,PointElement:Ag});const Nx=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],RS=Nx.map(r=>r.replace("rgb(","rgba(").replace(")",", 0.5)"));function ck(r){return Nx[r%Nx.length]}function uk(r){return RS[r%RS.length]}function X5(r,i){return r.borderColor=ck(i),r.backgroundColor=uk(i),++i}function Y5(r,i){return r.backgroundColor=r.data.map(()=>ck(i++)),i}function K5(r,i){return r.backgroundColor=r.data.map(()=>uk(i++)),i}function J5(r){let i=0;return(o,c)=>{const f=r.getDatasetMeta(c).controller;f instanceof Ec?i=Y5(o,i):f instanceof Ef?i=K5(o,i):f&&(i=X5(o,i))}}function OS(r){let i;for(i in r)if(r[i].borderColor||r[i].backgroundColor)return!0;return!1}function Q5(r){return r&&(r.borderColor||r.backgroundColor)}var $5={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(r,i,o){if(!o.enabled)return;const{data:{datasets:c},options:f}=r.config,{elements:m}=f;if(!o.forceOverride&&(OS(c)||Q5(f)||m&&OS(m)))return;const _=J5(r);c.forEach(_)}};function eO(r,i,o,c,f){const m=f.samples||c;if(m>=o)return r.slice(i,i+o);const _=[],v=(o-2)/(m-2);let s=0;const S=i+o-1;let P=i,z,F,U,Z,W;for(_[s++]=r[P],z=0;z<m-2;z++){let Q=0,re=0,ie;const ve=Math.floor((z+1)*v)+1+i,pe=Math.min(Math.floor((z+2)*v)+1,o)+i,ke=pe-ve;for(ie=ve;ie<pe;ie++)Q+=r[ie].x,re+=r[ie].y;Q/=ke,re/=ke;const Me=Math.floor(z*v)+1+i,Ye=Math.min(Math.floor((z+1)*v)+1,o)+i,{x:ot,y:Mt}=r[P];for(U=Z=-1,ie=Me;ie<Ye;ie++)Z=.5*Math.abs((ot-Q)*(r[ie].y-Mt)-(ot-r[ie].x)*(re-Mt)),Z>U&&(U=Z,F=r[ie],W=ie);_[s++]=F,P=W}return _[s++]=r[S],_}function tO(r,i,o,c){let f=0,m=0,_,v,s,S,P,z,F,U,Z,W;const Q=[],re=i+o-1,ie=r[i].x,pe=r[re].x-ie;for(_=i;_<i+o;++_){v=r[_],s=(v.x-ie)/pe*c,S=v.y;const ke=s|0;if(ke===P)S<Z?(Z=S,z=_):S>W&&(W=S,F=_),f=(m*f+v.x)/++m;else{const Me=_-1;if(!gn(z)&&!gn(F)){const Ye=Math.min(z,F),ot=Math.max(z,F);Ye!==U&&Ye!==Me&&Q.push({...r[Ye],x:f}),ot!==U&&ot!==Me&&Q.push({...r[ot],x:f})}_>0&&Me!==U&&Q.push(r[Me]),Q.push(v),P=ke,m=0,Z=W=S,z=F=U=_}}return Q}function hk(r){if(r._decimated){const i=r._data;delete r._decimated,delete r._data,Object.defineProperty(r,"data",{configurable:!0,enumerable:!0,writable:!0,value:i})}}function BS(r){r.data.datasets.forEach(i=>{hk(i)})}function iO(r,i){const o=i.length;let c=0,f;const{iScale:m}=r,{min:_,max:v,minDefined:s,maxDefined:S}=m.getUserBounds();return s&&(c=Ir(ja(i,m.axis,_).lo,0,o-1)),S?f=Ir(ja(i,m.axis,v).hi+1,c,o)-c:f=o-c,{start:c,count:f}}var nO={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(r,i,o)=>{if(!o.enabled){BS(r);return}const c=r.width;r.data.datasets.forEach((f,m)=>{const{_data:_,indexAxis:v}=f,s=r.getDatasetMeta(m),S=_||f.data;if(hf([v,r.options.indexAxis])==="y"||!s.controller.supportsDecimation)return;const P=r.scales[s.xAxisID];if(P.type!=="linear"&&P.type!=="time"||r.options.parsing)return;let{start:z,count:F}=iO(s,S);const U=o.threshold||4*c;if(F<=U){hk(f);return}gn(_)&&(f._data=S,delete f.data,Object.defineProperty(f,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(W){this._data=W}}));let Z;switch(o.algorithm){case"lttb":Z=eO(S,z,F,c,o);break;case"min-max":Z=tO(S,z,F,c);break;default:throw new Error(`Unsupported decimation algorithm '${o.algorithm}'`)}f._decimated=Z})},destroy(r){BS(r)}};function rO(r,i,o){const c=r.segments,f=r.points,m=i.points,_=[];for(const v of c){let{start:s,end:S}=v;S=zv(s,S,f);const P=Vx(o,f[s],f[S],v.loop);if(!i.segments){_.push({source:v,target:P,start:f[s],end:f[S]});continue}const z=ZI(i,P);for(const F of z){const U=Vx(o,m[F.start],m[F.end],F.loop),Z=qI(v,f,U);for(const W of Z)_.push({source:W,target:F,start:{[o]:FS(P,U,"start",Math.max)},end:{[o]:FS(P,U,"end",Math.min)}})}}return _}function Vx(r,i,o,c){if(c)return;let f=i[r],m=o[r];return r==="angle"&&(f=Rs(f),m=Rs(m)),{property:r,start:f,end:m}}function sO(r,i){const{x:o=null,y:c=null}=r||{},f=i.points,m=[];return i.segments.forEach(({start:_,end:v})=>{v=zv(_,v,f);const s=f[_],S=f[v];c!==null?(m.push({x:s.x,y:c}),m.push({x:S.x,y:c})):o!==null&&(m.push({x:o,y:s.y}),m.push({x:o,y:S.y}))}),m}function zv(r,i,o){for(;i>r;i--){const c=o[i];if(!isNaN(c.x)&&!isNaN(c.y))break}return i}function FS(r,i,o,c){return r&&i?c(r[o],i[o]):r?r[o]:i?i[o]:0}function dk(r,i){let o=[],c=!1;return Zn(r)?(c=!0,o=r):o=sO(r,i),o.length?new Al({points:o,options:{tension:0},_loop:c,_fullLoop:c}):null}function NS(r){return r&&r.fill!==!1}function oO(r,i,o){let f=r[i].fill;const m=[i];let _;if(!o)return f;for(;f!==!1&&m.indexOf(f)===-1;){if(!or(f))return f;if(_=r[f],!_)return!1;if(_.visible)return f;m.push(f),f=_.fill}return!1}function aO(r,i,o){const c=hO(r);if(sn(c))return isNaN(c.value)?!1:c;let f=parseFloat(c);return or(f)&&Math.floor(f)===f?lO(c[0],i,f,o):["origin","start","end","stack","shape"].indexOf(c)>=0&&c}function lO(r,i,o,c){return(r==="-"||r==="+")&&(o=i+o),o===i||o<0||o>=c?!1:o}function cO(r,i){let o=null;return r==="start"?o=i.bottom:r==="end"?o=i.top:sn(r)?o=i.getPixelForValue(r.value):i.getBasePixel&&(o=i.getBasePixel()),o}function uO(r,i,o){let c;return r==="start"?c=o:r==="end"?c=i.options.reverse?i.min:i.max:sn(r)?c=r.value:c=i.getBaseValue(),c}function hO(r){const i=r.options,o=i.fill;let c=Gi(o&&o.target,o);return c===void 0&&(c=!!i.backgroundColor),c===!1||c===null?!1:c===!0?"origin":c}function dO(r){const{scale:i,index:o,line:c}=r,f=[],m=c.segments,_=c.points,v=fO(i,o);v.push(dk({x:null,y:i.bottom},c));for(let s=0;s<m.length;s++){const S=m[s];for(let P=S.start;P<=S.end;P++)pO(f,_[P],v)}return new Al({points:f,options:{}})}function fO(r,i){const o=[],c=r.getMatchingVisibleMetas("line");for(let f=0;f<c.length;f++){const m=c[f];if(m.index===i)break;m.hidden||o.unshift(m.dataset)}return o}function pO(r,i,o){const c=[];for(let f=0;f<o.length;f++){const m=o[f],{first:_,last:v,point:s}=mO(m,i,"x");if(!(!s||_&&v)){if(_)c.unshift(s);else if(r.push(s),!v)break}}r.push(...c)}function mO(r,i,o){const c=r.interpolate(i,o);if(!c)return{};const f=c[o],m=r.segments,_=r.points;let v=!1,s=!1;for(let S=0;S<m.length;S++){const P=m[S],z=_[P.start][o],F=_[P.end][o];if(Va(f,z,F)){v=f===z,s=f===F;break}}return{first:v,last:s,point:c}}class fk{constructor(i){this.x=i.x,this.y=i.y,this.radius=i.radius}pathSegment(i,o,c){const{x:f,y:m,radius:_}=this;return o=o||{start:0,end:Xn},i.arc(f,m,_,o.end,o.start,!0),!c.bounds}interpolate(i){const{x:o,y:c,radius:f}=this,m=i.angle;return{x:o+Math.cos(m)*f,y:c+Math.sin(m)*f,angle:m}}}function gO(r){const{chart:i,fill:o,line:c}=r;if(or(o))return _O(i,o);if(o==="stack")return dO(r);if(o==="shape")return!0;const f=yO(r);return f instanceof fk?f:dk(f,c)}function _O(r,i){const o=r.getDatasetMeta(i);return o&&r.isDatasetVisible(i)?o.dataset:null}function yO(r){return(r.scale||{}).getPointPositionForValue?vO(r):xO(r)}function xO(r){const{scale:i={},fill:o}=r,c=cO(o,i);if(or(c)){const f=i.isHorizontal();return{x:f?c:null,y:f?null:c}}return null}function vO(r){const{scale:i,fill:o}=r,c=i.options,f=i.getLabels().length,m=c.reverse?i.max:i.min,_=uO(o,i,m),v=[];if(c.grid.circular){const s=i.getPointPositionForValue(0,m);return new fk({x:s.x,y:s.y,radius:i.getDistanceFromCenterForValue(_)})}for(let s=0;s<f;++s)v.push(i.getPointPositionForValue(s,_));return v}function fx(r,i,o){const c=gO(i),{line:f,scale:m,axis:_}=i,v=f.options,s=v.fill,S=v.backgroundColor,{above:P=S,below:z=S}=s||{};c&&f.points.length&&(S_(r,o),bO(r,{line:f,target:c,above:P,below:z,area:o,scale:m,axis:_}),E_(r))}function bO(r,i){const{line:o,target:c,above:f,below:m,area:_,scale:v}=i,s=o._loop?"angle":i.axis;r.save(),s==="x"&&m!==f&&(VS(r,c,_.top),jS(r,{line:o,target:c,color:f,scale:v,property:s}),r.restore(),r.save(),VS(r,c,_.bottom)),jS(r,{line:o,target:c,color:m,scale:v,property:s}),r.restore()}function VS(r,i,o){const{segments:c,points:f}=i;let m=!0,_=!1;r.beginPath();for(const v of c){const{start:s,end:S}=v,P=f[s],z=f[zv(s,S,f)];m?(r.moveTo(P.x,P.y),m=!1):(r.lineTo(P.x,o),r.lineTo(P.x,P.y)),_=!!i.pathSegment(r,v,{move:_}),_?r.closePath():r.lineTo(z.x,o)}r.lineTo(i.first().x,o),r.closePath(),r.clip()}function jS(r,i){const{line:o,target:c,property:f,color:m,scale:_}=i,v=rO(o,c,f);for(const{source:s,target:S,start:P,end:z}of v){const{style:{backgroundColor:F=m}={}}=s,U=c!==!0;r.save(),r.fillStyle=F,wO(r,_,U&&Vx(f,P,z)),r.beginPath();const Z=!!o.pathSegment(r,s);let W;if(U){Z?r.closePath():US(r,c,z,f);const Q=!!c.pathSegment(r,S,{move:Z,reverse:!0});W=Z&&Q,W||US(r,c,P,f)}r.closePath(),r.fill(W?"evenodd":"nonzero"),r.restore()}}function wO(r,i,o){const{top:c,bottom:f}=i.chart.chartArea,{property:m,start:_,end:v}=o||{};m==="x"&&(r.beginPath(),r.rect(_,c,v-_,f-c),r.clip())}function US(r,i,o,c){const f=i.interpolate(o,c);f&&r.lineTo(f.x,f.y)}var TO={id:"filler",afterDatasetsUpdate(r,i,o){const c=(r.data.datasets||[]).length,f=[];let m,_,v,s;for(_=0;_<c;++_)m=r.getDatasetMeta(_),v=m.dataset,s=null,v&&v.options&&v instanceof Al&&(s={visible:r.isDatasetVisible(_),index:_,fill:aO(v,_,c),chart:r,axis:m.controller.options.indexAxis,scale:m.vScale,line:v}),m.$filler=s,f.push(s);for(_=0;_<c;++_)s=f[_],!(!s||s.fill===!1)&&(s.fill=oO(f,_,o.propagate))},beforeDraw(r,i,o){const c=o.drawTime==="beforeDraw",f=r.getSortedVisibleDatasetMetas(),m=r.chartArea;for(let _=f.length-1;_>=0;--_){const v=f[_].$filler;v&&(v.line.updateControlPoints(m,v.axis),c&&v.fill&&fx(r.ctx,v,m))}},beforeDatasetsDraw(r,i,o){if(o.drawTime!=="beforeDatasetsDraw")return;const c=r.getSortedVisibleDatasetMetas();for(let f=c.length-1;f>=0;--f){const m=c[f].$filler;NS(m)&&fx(r.ctx,m,r.chartArea)}},beforeDatasetDraw(r,i,o){const c=i.meta.$filler;!NS(c)||o.drawTime!=="beforeDatasetDraw"||fx(r.ctx,c,r.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const GS=(r,i)=>{let{boxHeight:o=i,boxWidth:c=i}=r;return r.usePointStyle&&(o=Math.min(o,i),c=r.pointStyleWidth||Math.min(c,i)),{boxWidth:c,boxHeight:o,itemHeight:Math.max(i,o)}},MO=(r,i)=>r!==null&&i!==null&&r.datasetIndex===i.datasetIndex&&r.index===i.index;class HS extends bo{constructor(i){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=i.chart,this.options=i.options,this.ctx=i.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(i,o,c){this.maxWidth=i,this.maxHeight=o,this._margins=c,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const i=this.options.labels||{};let o=Vn(i.generateLabels,[this.chart],this)||[];i.filter&&(o=o.filter(c=>i.filter(c,this.chart.data))),i.sort&&(o=o.sort((c,f)=>i.sort(c,f,this.chart.data))),this.options.reverse&&o.reverse(),this.legendItems=o}fit(){const{options:i,ctx:o}=this;if(!i.display){this.width=this.height=0;return}const c=i.labels,f=Mr(c.font),m=f.size,_=this._computeTitleHeight(),{boxWidth:v,itemHeight:s}=GS(c,m);let S,P;o.font=f.string,this.isHorizontal()?(S=this.maxWidth,P=this._fitRows(_,m,v,s)+10):(P=this.maxHeight,S=this._fitCols(_,f,v,s)+10),this.width=Math.min(S,i.maxWidth||this.maxWidth),this.height=Math.min(P,i.maxHeight||this.maxHeight)}_fitRows(i,o,c,f){const{ctx:m,maxWidth:_,options:{labels:{padding:v}}}=this,s=this.legendHitBoxes=[],S=this.lineWidths=[0],P=f+v;let z=i;m.textAlign="left",m.textBaseline="middle";let F=-1,U=-P;return this.legendItems.forEach((Z,W)=>{const Q=c+o/2+m.measureText(Z.text).width;(W===0||S[S.length-1]+Q+2*v>_)&&(z+=P,S[S.length-(W>0?0:1)]=0,U+=P,F++),s[W]={left:0,top:U,row:F,width:Q,height:f},S[S.length-1]+=Q+v}),z}_fitCols(i,o,c,f){const{ctx:m,maxHeight:_,options:{labels:{padding:v}}}=this,s=this.legendHitBoxes=[],S=this.columnSizes=[],P=_-i;let z=v,F=0,U=0,Z=0,W=0;return this.legendItems.forEach((Q,re)=>{const{itemWidth:ie,itemHeight:ve}=SO(c,o,m,Q,f);re>0&&U+ve+2*v>P&&(z+=F+v,S.push({width:F,height:U}),Z+=F+v,W++,F=U=0),s[re]={left:Z,top:U,col:W,width:ie,height:ve},F=Math.max(F,ie),U+=ve+v}),z+=F,S.push({width:F,height:U}),z}adjustHitBoxes(){if(!this.options.display)return;const i=this._computeTitleHeight(),{legendHitBoxes:o,options:{align:c,labels:{padding:f},rtl:m}}=this,_=th(m,this.left,this.width);if(this.isHorizontal()){let v=0,s=Yr(c,this.left+f,this.right-this.lineWidths[v]);for(const S of o)v!==S.row&&(v=S.row,s=Yr(c,this.left+f,this.right-this.lineWidths[v])),S.top+=this.top+i+f,S.left=_.leftForLtr(_.x(s),S.width),s+=S.width+f}else{let v=0,s=Yr(c,this.top+i+f,this.bottom-this.columnSizes[v].height);for(const S of o)S.col!==v&&(v=S.col,s=Yr(c,this.top+i+f,this.bottom-this.columnSizes[v].height)),S.top=s,S.left+=this.left+f,S.left=_.leftForLtr(_.x(S.left),S.width),s+=S.height+f}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const i=this.ctx;S_(i,this),this._draw(),E_(i)}}_draw(){const{options:i,columnSizes:o,lineWidths:c,ctx:f}=this,{align:m,labels:_}=i,v=ar.color,s=th(i.rtl,this.left,this.width),S=Mr(_.font),{padding:P}=_,z=S.size,F=z/2;let U;this.drawTitle(),f.textAlign=s.textAlign("left"),f.textBaseline="middle",f.lineWidth=.5,f.font=S.string;const{boxWidth:Z,boxHeight:W,itemHeight:Q}=GS(_,z),re=function(Me,Ye,ot){if(isNaN(Z)||Z<=0||isNaN(W)||W<0)return;f.save();const Mt=Gi(ot.lineWidth,1);if(f.fillStyle=Gi(ot.fillStyle,v),f.lineCap=Gi(ot.lineCap,"butt"),f.lineDashOffset=Gi(ot.lineDashOffset,0),f.lineJoin=Gi(ot.lineJoin,"miter"),f.lineWidth=Mt,f.strokeStyle=Gi(ot.strokeStyle,v),f.setLineDash(Gi(ot.lineDash,[])),_.usePointStyle){const Se={radius:W*Math.SQRT2/2,pointStyle:ot.pointStyle,rotation:ot.rotation,borderWidth:Mt},yt=s.xPlus(Me,Z/2),_t=Ye+F;RI(f,Se,yt,_t,_.pointStyleWidth&&Z)}else{const Se=Ye+Math.max((z-W)/2,0),yt=s.leftForLtr(Me,Z),_t=Cc(ot.borderRadius);f.beginPath(),Object.values(_t).some(Ze=>Ze!==0)?Lf(f,{x:yt,y:Se,w:Z,h:W,radius:_t}):f.rect(yt,Se,Z,W),f.fill(),Mt!==0&&f.stroke()}f.restore()},ie=function(Me,Ye,ot){Rc(f,ot.text,Me,Ye+Q/2,S,{strikethrough:ot.hidden,textAlign:s.textAlign(ot.textAlign)})},ve=this.isHorizontal(),pe=this._computeTitleHeight();ve?U={x:Yr(m,this.left+P,this.right-c[0]),y:this.top+P+pe,line:0}:U={x:this.left+P,y:Yr(m,this.top+pe+P,this.bottom-o[0].height),line:0},GI(this.ctx,i.textDirection);const ke=Q+P;this.legendItems.forEach((Me,Ye)=>{f.strokeStyle=Me.fontColor,f.fillStyle=Me.fontColor;const ot=f.measureText(Me.text).width,Mt=s.textAlign(Me.textAlign||(Me.textAlign=_.textAlign)),Se=Z+F+ot;let yt=U.x,_t=U.y;s.setWidth(this.width),ve?Ye>0&&yt+Se+P>this.right&&(_t=U.y+=ke,U.line++,yt=U.x=Yr(m,this.left+P,this.right-c[U.line])):Ye>0&&_t+ke>this.bottom&&(yt=U.x=yt+o[U.line].width+P,U.line++,_t=U.y=Yr(m,this.top+pe+P,this.bottom-o[U.line].height));const Ze=s.x(yt);if(re(Ze,_t,Me),yt=qL(Mt,yt+Z+F,ve?yt+Se:this.right,i.rtl),ie(s.x(yt),_t,Me),ve)U.x+=Se+P;else if(typeof Me.text!="string"){const Tt=S.lineHeight;U.y+=pk(Me,Tt)+P}else U.y+=ke}),HI(this.ctx,i.textDirection)}drawTitle(){const i=this.options,o=i.title,c=Mr(o.font),f=$r(o.padding);if(!o.display)return;const m=th(i.rtl,this.left,this.width),_=this.ctx,v=o.position,s=c.size/2,S=f.top+s;let P,z=this.left,F=this.width;if(this.isHorizontal())F=Math.max(...this.lineWidths),P=this.top+S,z=Yr(i.align,z,this.right-F);else{const Z=this.columnSizes.reduce((W,Q)=>Math.max(W,Q.height),0);P=S+Yr(i.align,this.top,this.bottom-Z-i.labels.padding-this._computeTitleHeight())}const U=Yr(v,z,z+F);_.textAlign=m.textAlign(Mv(v)),_.textBaseline="middle",_.strokeStyle=o.color,_.fillStyle=o.color,_.font=c.string,Rc(_,o.text,U,P,c)}_computeTitleHeight(){const i=this.options.title,o=Mr(i.font),c=$r(i.padding);return i.display?o.lineHeight+c.height:0}_getLegendItemAt(i,o){let c,f,m;if(Va(i,this.left,this.right)&&Va(o,this.top,this.bottom)){for(m=this.legendHitBoxes,c=0;c<m.length;++c)if(f=m[c],Va(i,f.left,f.left+f.width)&&Va(o,f.top,f.top+f.height))return this.legendItems[c]}return null}handleEvent(i){const o=this.options;if(!IO(i.type,o))return;const c=this._getLegendItemAt(i.x,i.y);if(i.type==="mousemove"||i.type==="mouseout"){const f=this._hoveredItem,m=MO(f,c);f&&!m&&Vn(o.onLeave,[i,f,this],this),this._hoveredItem=c,c&&!m&&Vn(o.onHover,[i,c,this],this)}else c&&Vn(o.onClick,[i,c,this],this)}}function SO(r,i,o,c,f){const m=EO(c,r,i,o),_=AO(f,c,i.lineHeight);return{itemWidth:m,itemHeight:_}}function EO(r,i,o,c){let f=r.text;return f&&typeof f!="string"&&(f=f.reduce((m,_)=>m.length>_.length?m:_)),i+o.size/2+c.measureText(f).width}function AO(r,i,o){let c=r;return typeof i.text!="string"&&(c=pk(i,o)),c}function pk(r,i){const o=r.text?r.text.length:0;return i*o}function IO(r,i){return!!((r==="mousemove"||r==="mouseout")&&(i.onHover||i.onLeave)||i.onClick&&(r==="click"||r==="mouseup"))}var kO={id:"legend",_element:HS,start(r,i,o){const c=r.legend=new HS({ctx:r.ctx,options:o,chart:r});Jr.configure(r,c,o),Jr.addBox(r,c)},stop(r){Jr.removeBox(r,r.legend),delete r.legend},beforeUpdate(r,i,o){const c=r.legend;Jr.configure(r,c,o),c.options=o},afterUpdate(r){const i=r.legend;i.buildLabels(),i.adjustHitBoxes()},afterEvent(r,i){i.replay||r.legend.handleEvent(i.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(r,i,o){const c=i.datasetIndex,f=o.chart;f.isDatasetVisible(c)?(f.hide(c),i.hidden=!0):(f.show(c),i.hidden=!1)},onHover:null,onLeave:null,labels:{color:r=>r.chart.options.color,boxWidth:40,padding:10,generateLabels(r){const i=r.data.datasets,{labels:{usePointStyle:o,pointStyle:c,textAlign:f,color:m,useBorderRadius:_,borderRadius:v}}=r.legend.options;return r._getSortedDatasetMetas().map(s=>{const S=s.controller.getStyle(o?0:void 0),P=$r(S.borderWidth);return{text:i[s.index].label,fillStyle:S.backgroundColor,fontColor:m,hidden:!s.visible,lineCap:S.borderCapStyle,lineDash:S.borderDash,lineDashOffset:S.borderDashOffset,lineJoin:S.borderJoinStyle,lineWidth:(P.width+P.height)/4,strokeStyle:S.borderColor,pointStyle:c||S.pointStyle,rotation:S.rotation,textAlign:f||S.textAlign,borderRadius:_&&(v||S.borderRadius),datasetIndex:s.index}},this)}},title:{color:r=>r.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:r=>!r.startsWith("on"),labels:{_scriptable:r=>!["generateLabels","filter","sort"].includes(r)}}};class Lv extends bo{constructor(i){super(),this.chart=i.chart,this.options=i.options,this.ctx=i.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(i,o){const c=this.options;if(this.left=0,this.top=0,!c.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=i,this.height=this.bottom=o;const f=Zn(c.text)?c.text.length:1;this._padding=$r(c.padding);const m=f*Mr(c.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=m:this.width=m}isHorizontal(){const i=this.options.position;return i==="top"||i==="bottom"}_drawArgs(i){const{top:o,left:c,bottom:f,right:m,options:_}=this,v=_.align;let s=0,S,P,z;return this.isHorizontal()?(P=Yr(v,c,m),z=o+i,S=m-c):(_.position==="left"?(P=c+i,z=Yr(v,f,o),s=Yn*-.5):(P=m-i,z=Yr(v,o,f),s=Yn*.5),S=f-o),{titleX:P,titleY:z,maxWidth:S,rotation:s}}draw(){const i=this.ctx,o=this.options;if(!o.display)return;const c=Mr(o.font),m=c.lineHeight/2+this._padding.top,{titleX:_,titleY:v,maxWidth:s,rotation:S}=this._drawArgs(m);Rc(i,o.text,0,0,c,{color:o.color,maxWidth:s,rotation:S,textAlign:Mv(o.align),textBaseline:"middle",translation:[_,v]})}}function CO(r,i){const o=new Lv({ctx:r.ctx,options:i,chart:r});Jr.configure(r,o,i),Jr.addBox(r,o),r.titleBlock=o}var PO={id:"title",_element:Lv,start(r,i,o){CO(r,o)},stop(r){const i=r.titleBlock;Jr.removeBox(r,i),delete r.titleBlock},beforeUpdate(r,i,o){const c=r.titleBlock;Jr.configure(r,c,o),c.options=o},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const cg=new WeakMap;var DO={id:"subtitle",start(r,i,o){const c=new Lv({ctx:r.ctx,options:o,chart:r});Jr.configure(r,c,o),Jr.addBox(r,c),cg.set(r,c)},stop(r){Jr.removeBox(r,cg.get(r)),cg.delete(r)},beforeUpdate(r,i,o){const c=cg.get(r);Jr.configure(r,c,o),c.options=o},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const pf={average(r){if(!r.length)return!1;let i,o,c=new Set,f=0,m=0;for(i=0,o=r.length;i<o;++i){const v=r[i].element;if(v&&v.hasValue()){const s=v.tooltipPosition();c.add(s.x),f+=s.y,++m}}return{x:[...c].reduce((v,s)=>v+s)/c.size,y:f/m}},nearest(r,i){if(!r.length)return!1;let o=i.x,c=i.y,f=Number.POSITIVE_INFINITY,m,_,v;for(m=0,_=r.length;m<_;++m){const s=r[m].element;if(s&&s.hasValue()){const S=s.getCenterPoint(),P=Dx(i,S);P<f&&(f=P,v=s)}}if(v){const s=v.tooltipPosition();o=s.x,c=s.y}return{x:o,y:c}}};function Zo(r,i){return i&&(Zn(i)?Array.prototype.push.apply(r,i):r.push(i)),r}function Ra(r){return(typeof r=="string"||r instanceof String)&&r.indexOf(`
`)>-1?r.split(`
`):r}function zO(r,i){const{element:o,datasetIndex:c,index:f}=i,m=r.getDatasetMeta(c).controller,{label:_,value:v}=m.getLabelAndValue(f);return{chart:r,label:_,parsed:m.getParsed(f),raw:r.data.datasets[c].data[f],formattedValue:v,dataset:m.getDataset(),dataIndex:f,datasetIndex:c,element:o}}function WS(r,i){const o=r.chart.ctx,{body:c,footer:f,title:m}=r,{boxWidth:_,boxHeight:v}=i,s=Mr(i.bodyFont),S=Mr(i.titleFont),P=Mr(i.footerFont),z=m.length,F=f.length,U=c.length,Z=$r(i.padding);let W=Z.height,Q=0,re=c.reduce((pe,ke)=>pe+ke.before.length+ke.lines.length+ke.after.length,0);if(re+=r.beforeBody.length+r.afterBody.length,z&&(W+=z*S.lineHeight+(z-1)*i.titleSpacing+i.titleMarginBottom),re){const pe=i.displayColors?Math.max(v,s.lineHeight):s.lineHeight;W+=U*pe+(re-U)*s.lineHeight+(re-1)*i.bodySpacing}F&&(W+=i.footerMarginTop+F*P.lineHeight+(F-1)*i.footerSpacing);let ie=0;const ve=function(pe){Q=Math.max(Q,o.measureText(pe).width+ie)};return o.save(),o.font=S.string,An(r.title,ve),o.font=s.string,An(r.beforeBody.concat(r.afterBody),ve),ie=i.displayColors?_+2+i.boxPadding:0,An(c,pe=>{An(pe.before,ve),An(pe.lines,ve),An(pe.after,ve)}),ie=0,o.font=P.string,An(r.footer,ve),o.restore(),Q+=Z.width,{width:Q,height:W}}function LO(r,i){const{y:o,height:c}=i;return o<c/2?"top":o>r.height-c/2?"bottom":"center"}function RO(r,i,o,c){const{x:f,width:m}=c,_=o.caretSize+o.caretPadding;if(r==="left"&&f+m+_>i.width||r==="right"&&f-m-_<0)return!0}function OO(r,i,o,c){const{x:f,width:m}=o,{width:_,chartArea:{left:v,right:s}}=r;let S="center";return c==="center"?S=f<=(v+s)/2?"left":"right":f<=m/2?S="left":f>=_-m/2&&(S="right"),RO(S,r,i,o)&&(S="center"),S}function qS(r,i,o){const c=o.yAlign||i.yAlign||LO(r,o);return{xAlign:o.xAlign||i.xAlign||OO(r,i,o,c),yAlign:c}}function BO(r,i){let{x:o,width:c}=r;return i==="right"?o-=c:i==="center"&&(o-=c/2),o}function FO(r,i,o){let{y:c,height:f}=r;return i==="top"?c+=o:i==="bottom"?c-=f+o:c-=f/2,c}function ZS(r,i,o,c){const{caretSize:f,caretPadding:m,cornerRadius:_}=r,{xAlign:v,yAlign:s}=o,S=f+m,{topLeft:P,topRight:z,bottomLeft:F,bottomRight:U}=Cc(_);let Z=BO(i,v);const W=FO(i,s,S);return s==="center"?v==="left"?Z+=S:v==="right"&&(Z-=S):v==="left"?Z-=Math.max(P,F)+f:v==="right"&&(Z+=Math.max(z,U)+f),{x:Ir(Z,0,c.width-i.width),y:Ir(W,0,c.height-i.height)}}function ug(r,i,o){const c=$r(o.padding);return i==="center"?r.x+r.width/2:i==="right"?r.x+r.width-c.right:r.x+c.left}function XS(r){return Zo([],Ra(r))}function NO(r,i,o){return Dl(r,{tooltip:i,tooltipItems:o,type:"tooltip"})}function YS(r,i){const o=i&&i.dataset&&i.dataset.tooltip&&i.dataset.tooltip.callbacks;return o?r.override(o):r}const mk={beforeTitle:Pa,title(r){if(r.length>0){const i=r[0],o=i.chart.data.labels,c=o?o.length:0;if(this&&this.options&&this.options.mode==="dataset")return i.dataset.label||"";if(i.label)return i.label;if(c>0&&i.dataIndex<c)return o[i.dataIndex]}return""},afterTitle:Pa,beforeBody:Pa,beforeLabel:Pa,label(r){if(this&&this.options&&this.options.mode==="dataset")return r.label+": "+r.formattedValue||r.formattedValue;let i=r.dataset.label||"";i&&(i+=": ");const o=r.formattedValue;return gn(o)||(i+=o),i},labelColor(r){const o=r.chart.getDatasetMeta(r.datasetIndex).controller.getStyle(r.dataIndex);return{borderColor:o.borderColor,backgroundColor:o.backgroundColor,borderWidth:o.borderWidth,borderDash:o.borderDash,borderDashOffset:o.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(r){const o=r.chart.getDatasetMeta(r.datasetIndex).controller.getStyle(r.dataIndex);return{pointStyle:o.pointStyle,rotation:o.rotation}},afterLabel:Pa,afterBody:Pa,beforeFooter:Pa,footer:Pa,afterFooter:Pa};function gs(r,i,o,c){const f=r[i].call(o,c);return typeof f>"u"?mk[i].call(o,c):f}class jx extends bo{constructor(i){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=i.chart,this.options=i.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(i){this.options=i,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const i=this._cachedAnimations;if(i)return i;const o=this.chart,c=this.options.setContext(this.getContext()),f=c.enabled&&o.options.animation&&c.animations,m=new XI(this.chart,f);return f._cacheable&&(this._cachedAnimations=Object.freeze(m)),m}getContext(){return this.$context||(this.$context=NO(this.chart.getContext(),this,this._tooltipItems))}getTitle(i,o){const{callbacks:c}=o,f=gs(c,"beforeTitle",this,i),m=gs(c,"title",this,i),_=gs(c,"afterTitle",this,i);let v=[];return v=Zo(v,Ra(f)),v=Zo(v,Ra(m)),v=Zo(v,Ra(_)),v}getBeforeBody(i,o){return XS(gs(o.callbacks,"beforeBody",this,i))}getBody(i,o){const{callbacks:c}=o,f=[];return An(i,m=>{const _={before:[],lines:[],after:[]},v=YS(c,m);Zo(_.before,Ra(gs(v,"beforeLabel",this,m))),Zo(_.lines,gs(v,"label",this,m)),Zo(_.after,Ra(gs(v,"afterLabel",this,m))),f.push(_)}),f}getAfterBody(i,o){return XS(gs(o.callbacks,"afterBody",this,i))}getFooter(i,o){const{callbacks:c}=o,f=gs(c,"beforeFooter",this,i),m=gs(c,"footer",this,i),_=gs(c,"afterFooter",this,i);let v=[];return v=Zo(v,Ra(f)),v=Zo(v,Ra(m)),v=Zo(v,Ra(_)),v}_createItems(i){const o=this._active,c=this.chart.data,f=[],m=[],_=[];let v=[],s,S;for(s=0,S=o.length;s<S;++s)v.push(zO(this.chart,o[s]));return i.filter&&(v=v.filter((P,z,F)=>i.filter(P,z,F,c))),i.itemSort&&(v=v.sort((P,z)=>i.itemSort(P,z,c))),An(v,P=>{const z=YS(i.callbacks,P);f.push(gs(z,"labelColor",this,P)),m.push(gs(z,"labelPointStyle",this,P)),_.push(gs(z,"labelTextColor",this,P))}),this.labelColors=f,this.labelPointStyles=m,this.labelTextColors=_,this.dataPoints=v,v}update(i,o){const c=this.options.setContext(this.getContext()),f=this._active;let m,_=[];if(!f.length)this.opacity!==0&&(m={opacity:0});else{const v=pf[c.position].call(this,f,this._eventPosition);_=this._createItems(c),this.title=this.getTitle(_,c),this.beforeBody=this.getBeforeBody(_,c),this.body=this.getBody(_,c),this.afterBody=this.getAfterBody(_,c),this.footer=this.getFooter(_,c);const s=this._size=WS(this,c),S=Object.assign({},v,s),P=qS(this.chart,c,S),z=ZS(c,S,P,this.chart);this.xAlign=P.xAlign,this.yAlign=P.yAlign,m={opacity:1,x:z.x,y:z.y,width:s.width,height:s.height,caretX:v.x,caretY:v.y}}this._tooltipItems=_,this.$context=void 0,m&&this._resolveAnimations().update(this,m),i&&c.external&&c.external.call(this,{chart:this.chart,tooltip:this,replay:o})}drawCaret(i,o,c,f){const m=this.getCaretPosition(i,c,f);o.lineTo(m.x1,m.y1),o.lineTo(m.x2,m.y2),o.lineTo(m.x3,m.y3)}getCaretPosition(i,o,c){const{xAlign:f,yAlign:m}=this,{caretSize:_,cornerRadius:v}=c,{topLeft:s,topRight:S,bottomLeft:P,bottomRight:z}=Cc(v),{x:F,y:U}=i,{width:Z,height:W}=o;let Q,re,ie,ve,pe,ke;return m==="center"?(pe=U+W/2,f==="left"?(Q=F,re=Q-_,ve=pe+_,ke=pe-_):(Q=F+Z,re=Q+_,ve=pe-_,ke=pe+_),ie=Q):(f==="left"?re=F+Math.max(s,P)+_:f==="right"?re=F+Z-Math.max(S,z)-_:re=this.caretX,m==="top"?(ve=U,pe=ve-_,Q=re-_,ie=re+_):(ve=U+W,pe=ve+_,Q=re+_,ie=re-_),ke=ve),{x1:Q,x2:re,x3:ie,y1:ve,y2:pe,y3:ke}}drawTitle(i,o,c){const f=this.title,m=f.length;let _,v,s;if(m){const S=th(c.rtl,this.x,this.width);for(i.x=ug(this,c.titleAlign,c),o.textAlign=S.textAlign(c.titleAlign),o.textBaseline="middle",_=Mr(c.titleFont),v=c.titleSpacing,o.fillStyle=c.titleColor,o.font=_.string,s=0;s<m;++s)o.fillText(f[s],S.x(i.x),i.y+_.lineHeight/2),i.y+=_.lineHeight+v,s+1===m&&(i.y+=c.titleMarginBottom-v)}}_drawColorBox(i,o,c,f,m){const _=this.labelColors[c],v=this.labelPointStyles[c],{boxHeight:s,boxWidth:S}=m,P=Mr(m.bodyFont),z=ug(this,"left",m),F=f.x(z),U=s<P.lineHeight?(P.lineHeight-s)/2:0,Z=o.y+U;if(m.usePointStyle){const W={radius:Math.min(S,s)/2,pointStyle:v.pointStyle,rotation:v.rotation,borderWidth:1},Q=f.leftForLtr(F,S)+S/2,re=Z+s/2;i.strokeStyle=m.multiKeyBackground,i.fillStyle=m.multiKeyBackground,Lx(i,W,Q,re),i.strokeStyle=_.borderColor,i.fillStyle=_.backgroundColor,Lx(i,W,Q,re)}else{i.lineWidth=sn(_.borderWidth)?Math.max(...Object.values(_.borderWidth)):_.borderWidth||1,i.strokeStyle=_.borderColor,i.setLineDash(_.borderDash||[]),i.lineDashOffset=_.borderDashOffset||0;const W=f.leftForLtr(F,S),Q=f.leftForLtr(f.xPlus(F,1),S-2),re=Cc(_.borderRadius);Object.values(re).some(ie=>ie!==0)?(i.beginPath(),i.fillStyle=m.multiKeyBackground,Lf(i,{x:W,y:Z,w:S,h:s,radius:re}),i.fill(),i.stroke(),i.fillStyle=_.backgroundColor,i.beginPath(),Lf(i,{x:Q,y:Z+1,w:S-2,h:s-2,radius:re}),i.fill()):(i.fillStyle=m.multiKeyBackground,i.fillRect(W,Z,S,s),i.strokeRect(W,Z,S,s),i.fillStyle=_.backgroundColor,i.fillRect(Q,Z+1,S-2,s-2))}i.fillStyle=this.labelTextColors[c]}drawBody(i,o,c){const{body:f}=this,{bodySpacing:m,bodyAlign:_,displayColors:v,boxHeight:s,boxWidth:S,boxPadding:P}=c,z=Mr(c.bodyFont);let F=z.lineHeight,U=0;const Z=th(c.rtl,this.x,this.width),W=function(ot){o.fillText(ot,Z.x(i.x+U),i.y+F/2),i.y+=F+m},Q=Z.textAlign(_);let re,ie,ve,pe,ke,Me,Ye;for(o.textAlign=_,o.textBaseline="middle",o.font=z.string,i.x=ug(this,Q,c),o.fillStyle=c.bodyColor,An(this.beforeBody,W),U=v&&Q!=="right"?_==="center"?S/2+P:S+2+P:0,pe=0,Me=f.length;pe<Me;++pe){for(re=f[pe],ie=this.labelTextColors[pe],o.fillStyle=ie,An(re.before,W),ve=re.lines,v&&ve.length&&(this._drawColorBox(o,i,pe,Z,c),F=Math.max(z.lineHeight,s)),ke=0,Ye=ve.length;ke<Ye;++ke)W(ve[ke]),F=z.lineHeight;An(re.after,W)}U=0,F=z.lineHeight,An(this.afterBody,W),i.y-=m}drawFooter(i,o,c){const f=this.footer,m=f.length;let _,v;if(m){const s=th(c.rtl,this.x,this.width);for(i.x=ug(this,c.footerAlign,c),i.y+=c.footerMarginTop,o.textAlign=s.textAlign(c.footerAlign),o.textBaseline="middle",_=Mr(c.footerFont),o.fillStyle=c.footerColor,o.font=_.string,v=0;v<m;++v)o.fillText(f[v],s.x(i.x),i.y+_.lineHeight/2),i.y+=_.lineHeight+c.footerSpacing}}drawBackground(i,o,c,f){const{xAlign:m,yAlign:_}=this,{x:v,y:s}=i,{width:S,height:P}=c,{topLeft:z,topRight:F,bottomLeft:U,bottomRight:Z}=Cc(f.cornerRadius);o.fillStyle=f.backgroundColor,o.strokeStyle=f.borderColor,o.lineWidth=f.borderWidth,o.beginPath(),o.moveTo(v+z,s),_==="top"&&this.drawCaret(i,o,c,f),o.lineTo(v+S-F,s),o.quadraticCurveTo(v+S,s,v+S,s+F),_==="center"&&m==="right"&&this.drawCaret(i,o,c,f),o.lineTo(v+S,s+P-Z),o.quadraticCurveTo(v+S,s+P,v+S-Z,s+P),_==="bottom"&&this.drawCaret(i,o,c,f),o.lineTo(v+U,s+P),o.quadraticCurveTo(v,s+P,v,s+P-U),_==="center"&&m==="left"&&this.drawCaret(i,o,c,f),o.lineTo(v,s+z),o.quadraticCurveTo(v,s,v+z,s),o.closePath(),o.fill(),f.borderWidth>0&&o.stroke()}_updateAnimationTarget(i){const o=this.chart,c=this.$animations,f=c&&c.x,m=c&&c.y;if(f||m){const _=pf[i.position].call(this,this._active,this._eventPosition);if(!_)return;const v=this._size=WS(this,i),s=Object.assign({},_,this._size),S=qS(o,i,s),P=ZS(i,s,S,o);(f._to!==P.x||m._to!==P.y)&&(this.xAlign=S.xAlign,this.yAlign=S.yAlign,this.width=v.width,this.height=v.height,this.caretX=_.x,this.caretY=_.y,this._resolveAnimations().update(this,P))}}_willRender(){return!!this.opacity}draw(i){const o=this.options.setContext(this.getContext());let c=this.opacity;if(!c)return;this._updateAnimationTarget(o);const f={width:this.width,height:this.height},m={x:this.x,y:this.y};c=Math.abs(c)<.001?0:c;const _=$r(o.padding),v=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;o.enabled&&v&&(i.save(),i.globalAlpha=c,this.drawBackground(m,i,f,o),GI(i,o.textDirection),m.y+=_.top,this.drawTitle(m,i,o),this.drawBody(m,i,o),this.drawFooter(m,i,o),HI(i,o.textDirection),i.restore())}getActiveElements(){return this._active||[]}setActiveElements(i,o){const c=this._active,f=i.map(({datasetIndex:v,index:s})=>{const S=this.chart.getDatasetMeta(v);if(!S)throw new Error("Cannot find a dataset at index "+v);return{datasetIndex:v,element:S.data[s],index:s}}),m=!Zg(c,f),_=this._positionChanged(f,o);(m||_)&&(this._active=f,this._eventPosition=o,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(i,o,c=!0){if(o&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const f=this.options,m=this._active||[],_=this._getActiveElements(i,m,o,c),v=this._positionChanged(_,i),s=o||!Zg(_,m)||v;return s&&(this._active=_,(f.enabled||f.external)&&(this._eventPosition={x:i.x,y:i.y},this.update(!0,o))),s}_getActiveElements(i,o,c,f){const m=this.options;if(i.type==="mouseout")return[];if(!f)return o.filter(v=>this.chart.data.datasets[v.datasetIndex]&&this.chart.getDatasetMeta(v.datasetIndex).controller.getParsed(v.index)!==void 0);const _=this.chart.getElementsAtEventForMode(i,m.mode,m,c);return m.reverse&&_.reverse(),_}_positionChanged(i,o){const{caretX:c,caretY:f,options:m}=this,_=pf[m.position].call(this,i,o);return _!==!1&&(c!==_.x||f!==_.y)}}qt(jx,"positioners",pf);var VO={id:"tooltip",_element:jx,positioners:pf,afterInit(r,i,o){o&&(r.tooltip=new jx({chart:r,options:o}))},beforeUpdate(r,i,o){r.tooltip&&r.tooltip.initialize(o)},reset(r,i,o){r.tooltip&&r.tooltip.initialize(o)},afterDraw(r){const i=r.tooltip;if(i&&i._willRender()){const o={tooltip:i};if(r.notifyPlugins("beforeTooltipDraw",{...o,cancelable:!0})===!1)return;i.draw(r.ctx),r.notifyPlugins("afterTooltipDraw",o)}},afterEvent(r,i){if(r.tooltip){const o=i.replay;r.tooltip.handleEvent(i.event,o,i.inChartArea)&&(i.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(r,i)=>i.bodyFont.size,boxWidth:(r,i)=>i.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:mk},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:r=>r!=="filter"&&r!=="itemSort"&&r!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},jO=Object.freeze({__proto__:null,Colors:$5,Decimation:nO,Filler:TO,Legend:kO,SubTitle:DO,Title:PO,Tooltip:VO});const UO=(r,i,o,c)=>(typeof i=="string"?(o=r.push(i)-1,c.unshift({index:o,label:i})):isNaN(i)&&(o=null),o);function GO(r,i,o,c){const f=r.indexOf(i);if(f===-1)return UO(r,i,o,c);const m=r.lastIndexOf(i);return f!==m?o:f}const HO=(r,i)=>r===null?null:Ir(Math.round(r),0,i);function KS(r){const i=this.getLabels();return r>=0&&r<i.length?i[r]:r}class Ux extends Fc{constructor(i){super(i),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(i){const o=this._addedLabels;if(o.length){const c=this.getLabels();for(const{index:f,label:m}of o)c[f]===m&&c.splice(f,1);this._addedLabels=[]}super.init(i)}parse(i,o){if(gn(i))return null;const c=this.getLabels();return o=isFinite(o)&&c[o]===i?o:GO(c,i,Gi(o,i),this._addedLabels),HO(o,c.length-1)}determineDataLimits(){const{minDefined:i,maxDefined:o}=this.getUserBounds();let{min:c,max:f}=this.getMinMax(!0);this.options.bounds==="ticks"&&(i||(c=0),o||(f=this.getLabels().length-1)),this.min=c,this.max=f}buildTicks(){const i=this.min,o=this.max,c=this.options.offset,f=[];let m=this.getLabels();m=i===0&&o===m.length-1?m:m.slice(i,o+1),this._valueRange=Math.max(m.length-(c?0:1),1),this._startValue=this.min-(c?.5:0);for(let _=i;_<=o;_++)f.push({value:_});return f}getLabelForValue(i){return KS.call(this,i)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(i){return typeof i!="number"&&(i=this.parse(i)),i===null?NaN:this.getPixelForDecimal((i-this._startValue)/this._valueRange)}getPixelForTick(i){const o=this.ticks;return i<0||i>o.length-1?null:this.getPixelForValue(o[i].value)}getValueForPixel(i){return Math.round(this._startValue+this.getDecimalForPixel(i)*this._valueRange)}getBasePixel(){return this.bottom}}qt(Ux,"id","category"),qt(Ux,"defaults",{ticks:{callback:KS}});function WO(r,i){const o=[],{bounds:f,step:m,min:_,max:v,precision:s,count:S,maxTicks:P,maxDigits:z,includeBounds:F}=r,U=m||1,Z=P-1,{min:W,max:Q}=i,re=!gn(_),ie=!gn(v),ve=!gn(S),pe=(Q-W)/(z+1);let ke=HM((Q-W)/Z/U)*U,Me,Ye,ot,Mt;if(ke<1e-14&&!re&&!ie)return[{value:W},{value:Q}];Mt=Math.ceil(Q/ke)-Math.floor(W/ke),Mt>Z&&(ke=HM(Mt*ke/Z/U)*U),gn(s)||(Me=Math.pow(10,s),ke=Math.ceil(ke*Me)/Me),f==="ticks"?(Ye=Math.floor(W/ke)*ke,ot=Math.ceil(Q/ke)*ke):(Ye=W,ot=Q),re&&ie&&m&&NL((v-_)/m,ke/1e3)?(Mt=Math.round(Math.min((v-_)/ke,P)),ke=(v-_)/Mt,Ye=_,ot=v):ve?(Ye=re?_:Ye,ot=ie?v:ot,Mt=S-1,ke=(ot-Ye)/Mt):(Mt=(ot-Ye)/ke,Tf(Mt,Math.round(Mt),ke/1e3)?Mt=Math.round(Mt):Mt=Math.ceil(Mt));const Se=Math.max(WM(ke),WM(Ye));Me=Math.pow(10,gn(s)?Se:s),Ye=Math.round(Ye*Me)/Me,ot=Math.round(ot*Me)/Me;let yt=0;for(re&&(F&&Ye!==_?(o.push({value:_}),Ye<_&&yt++,Tf(Math.round((Ye+yt*ke)*Me)/Me,_,JS(_,pe,r))&&yt++):Ye<_&&yt++);yt<Mt;++yt){const _t=Math.round((Ye+yt*ke)*Me)/Me;if(ie&&_t>v)break;o.push({value:_t})}return ie&&F&&ot!==v?o.length&&Tf(o[o.length-1].value,v,JS(v,pe,r))?o[o.length-1].value=v:o.push({value:v}):(!ie||ot===v)&&o.push({value:ot}),o}function JS(r,i,{horizontal:o,minRotation:c}){const f=yo(c),m=(o?Math.sin(f):Math.cos(f))||.001,_=.75*i*(""+r).length;return Math.min(i/m,_)}class e_ extends Fc{constructor(i){super(i),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(i,o){return gn(i)||(typeof i=="number"||i instanceof Number)&&!isFinite(+i)?null:+i}handleTickRangeOptions(){const{beginAtZero:i}=this.options,{minDefined:o,maxDefined:c}=this.getUserBounds();let{min:f,max:m}=this;const _=s=>f=o?f:s,v=s=>m=c?m:s;if(i){const s=Ko(f),S=Ko(m);s<0&&S<0?v(0):s>0&&S>0&&_(0)}if(f===m){let s=m===0?1:Math.abs(m*.05);v(m+s),i||_(f-s)}this.min=f,this.max=m}getTickLimit(){const i=this.options.ticks;let{maxTicksLimit:o,stepSize:c}=i,f;return c?(f=Math.ceil(this.max/c)-Math.floor(this.min/c)+1,f>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${c} would result generating up to ${f} ticks. Limiting to 1000.`),f=1e3)):(f=this.computeTickLimit(),o=o||11),o&&(f=Math.min(o,f)),f}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const i=this.options,o=i.ticks;let c=this.getTickLimit();c=Math.max(2,c);const f={maxTicks:c,bounds:i.bounds,min:i.min,max:i.max,precision:o.precision,step:o.stepSize,count:o.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:o.minRotation||0,includeBounds:o.includeBounds!==!1},m=this._range||this,_=WO(f,m);return i.bounds==="ticks"&&EI(_,this,"value"),i.reverse?(_.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),_}configure(){const i=this.ticks;let o=this.min,c=this.max;if(super.configure(),this.options.offset&&i.length){const f=(c-o)/Math.max(i.length-1,1)/2;o-=f,c+=f}this._startValue=o,this._endValue=c,this._valueRange=c-o}getLabelForValue(i){return Jf(i,this.chart.options.locale,this.options.ticks.format)}}class Gx extends e_{determineDataLimits(){const{min:i,max:o}=this.getMinMax(!0);this.min=or(i)?i:0,this.max=or(o)?o:1,this.handleTickRangeOptions()}computeTickLimit(){const i=this.isHorizontal(),o=i?this.width:this.height,c=yo(this.options.ticks.minRotation),f=(i?Math.sin(c):Math.cos(c))||.001,m=this._resolveTickFontOptions(0);return Math.ceil(o/Math.min(40,m.lineHeight/f))}getPixelForValue(i){return i===null?NaN:this.getPixelForDecimal((i-this._startValue)/this._valueRange)}getValueForPixel(i){return this._startValue+this.getDecimalForPixel(i)*this._valueRange}}qt(Gx,"id","linear"),qt(Gx,"defaults",{ticks:{callback:M_.formatters.numeric}});const Of=r=>Math.floor(El(r)),Tc=(r,i)=>Math.pow(10,Of(r)+i);function QS(r){return r/Math.pow(10,Of(r))===1}function $S(r,i,o){const c=Math.pow(10,o),f=Math.floor(r/c);return Math.ceil(i/c)-f}function qO(r,i){const o=i-r;let c=Of(o);for(;$S(r,i,c)>10;)c++;for(;$S(r,i,c)<10;)c--;return Math.min(c,Of(r))}function ZO(r,{min:i,max:o}){i=Ls(r.min,i);const c=[],f=Of(i);let m=qO(i,o),_=m<0?Math.pow(10,Math.abs(m)):1;const v=Math.pow(10,m),s=f>m?Math.pow(10,f):0,S=Math.round((i-s)*_)/_,P=Math.floor((i-s)/v/10)*v*10;let z=Math.floor((S-P)/Math.pow(10,m)),F=Ls(r.min,Math.round((s+P+z*Math.pow(10,m))*_)/_);for(;F<o;)c.push({value:F,major:QS(F),significand:z}),z>=10?z=z<15?15:20:z++,z>=20&&(m++,z=2,_=m>=0?1:_),F=Math.round((s+P+z*Math.pow(10,m))*_)/_;const U=Ls(r.max,F);return c.push({value:U,major:QS(U),significand:z}),c}class Hx extends Fc{constructor(i){super(i),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(i,o){const c=e_.prototype.parse.apply(this,[i,o]);if(c===0){this._zero=!0;return}return or(c)&&c>0?c:null}determineDataLimits(){const{min:i,max:o}=this.getMinMax(!0);this.min=or(i)?Math.max(0,i):null,this.max=or(o)?Math.max(0,o):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!or(this._userMin)&&(this.min=i===Tc(this.min,0)?Tc(this.min,-1):Tc(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:i,maxDefined:o}=this.getUserBounds();let c=this.min,f=this.max;const m=v=>c=i?c:v,_=v=>f=o?f:v;c===f&&(c<=0?(m(1),_(10)):(m(Tc(c,-1)),_(Tc(f,1)))),c<=0&&m(Tc(f,-1)),f<=0&&_(Tc(c,1)),this.min=c,this.max=f}buildTicks(){const i=this.options,o={min:this._userMin,max:this._userMax},c=ZO(o,this);return i.bounds==="ticks"&&EI(c,this,"value"),i.reverse?(c.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),c}getLabelForValue(i){return i===void 0?"0":Jf(i,this.chart.options.locale,this.options.ticks.format)}configure(){const i=this.min;super.configure(),this._startValue=El(i),this._valueRange=El(this.max)-El(i)}getPixelForValue(i){return(i===void 0||i===0)&&(i=this.min),i===null||isNaN(i)?NaN:this.getPixelForDecimal(i===this.min?0:(El(i)-this._startValue)/this._valueRange)}getValueForPixel(i){const o=this.getDecimalForPixel(i);return Math.pow(10,this._startValue+o*this._valueRange)}}qt(Hx,"id","logarithmic"),qt(Hx,"defaults",{ticks:{callback:M_.formatters.logarithmic,major:{enabled:!0}}});function Wx(r){const i=r.ticks;if(i.display&&r.display){const o=$r(i.backdropPadding);return Gi(i.font&&i.font.size,ar.font.size)+o.height}return 0}function XO(r,i,o){return o=Zn(o)?o:[o],{w:iR(r,i.string,o),h:o.length*i.lineHeight}}function eE(r,i,o,c,f){return r===c||r===f?{start:i-o/2,end:i+o/2}:r<c||r>f?{start:i-o,end:i}:{start:i,end:i+o}}function YO(r){const i={l:r.left+r._padding.left,r:r.right-r._padding.right,t:r.top+r._padding.top,b:r.bottom-r._padding.bottom},o=Object.assign({},i),c=[],f=[],m=r._pointLabels.length,_=r.options.pointLabels,v=_.centerPointLabels?Yn/m:0;for(let s=0;s<m;s++){const S=_.setContext(r.getPointLabelContext(s));f[s]=S.padding;const P=r.getPointPosition(s,r.drawingArea+f[s],v),z=Mr(S.font),F=XO(r.ctx,z,r._pointLabels[s]);c[s]=F;const U=Rs(r.getIndexAngle(s)+v),Z=Math.round(wv(U)),W=eE(Z,P.x,F.w,0,180),Q=eE(Z,P.y,F.h,90,270);KO(o,i,U,W,Q)}r.setCenterPoint(i.l-o.l,o.r-i.r,i.t-o.t,o.b-i.b),r._pointLabelItems=$O(r,c,f)}function KO(r,i,o,c,f){const m=Math.abs(Math.sin(o)),_=Math.abs(Math.cos(o));let v=0,s=0;c.start<i.l?(v=(i.l-c.start)/m,r.l=Math.min(r.l,i.l-v)):c.end>i.r&&(v=(c.end-i.r)/m,r.r=Math.max(r.r,i.r+v)),f.start<i.t?(s=(i.t-f.start)/_,r.t=Math.min(r.t,i.t-s)):f.end>i.b&&(s=(f.end-i.b)/_,r.b=Math.max(r.b,i.b+s))}function JO(r,i,o){const c=r.drawingArea,{extra:f,additionalAngle:m,padding:_,size:v}=o,s=r.getPointPosition(i,c+f+_,m),S=Math.round(wv(Rs(s.angle+fr))),P=iB(s.y,v.h,S),z=eB(S),F=tB(s.x,v.w,z);return{visible:!0,x:s.x,y:P,textAlign:z,left:F,top:P,right:F+v.w,bottom:P+v.h}}function QO(r,i){if(!i)return!0;const{left:o,top:c,right:f,bottom:m}=r;return!(Ua({x:o,y:c},i)||Ua({x:o,y:m},i)||Ua({x:f,y:c},i)||Ua({x:f,y:m},i))}function $O(r,i,o){const c=[],f=r._pointLabels.length,m=r.options,{centerPointLabels:_,display:v}=m.pointLabels,s={extra:Wx(m)/2,additionalAngle:_?Yn/f:0};let S;for(let P=0;P<f;P++){s.padding=o[P],s.size=i[P];const z=JO(r,P,s);c.push(z),v==="auto"&&(z.visible=QO(z,S),z.visible&&(S=z))}return c}function eB(r){return r===0||r===180?"center":r<180?"left":"right"}function tB(r,i,o){return o==="right"?r-=i:o==="center"&&(r-=i/2),r}function iB(r,i,o){return o===90||o===270?r-=i/2:(o>270||o<90)&&(r-=i),r}function nB(r,i,o){const{left:c,top:f,right:m,bottom:_}=o,{backdropColor:v}=i;if(!gn(v)){const s=Cc(i.borderRadius),S=$r(i.backdropPadding);r.fillStyle=v;const P=c-S.left,z=f-S.top,F=m-c+S.width,U=_-f+S.height;Object.values(s).some(Z=>Z!==0)?(r.beginPath(),Lf(r,{x:P,y:z,w:F,h:U,radius:s}),r.fill()):r.fillRect(P,z,F,U)}}function rB(r,i){const{ctx:o,options:{pointLabels:c}}=r;for(let f=i-1;f>=0;f--){const m=r._pointLabelItems[f];if(!m.visible)continue;const _=c.setContext(r.getPointLabelContext(f));nB(o,_,m);const v=Mr(_.font),{x:s,y:S,textAlign:P}=m;Rc(o,r._pointLabels[f],s,S+v.lineHeight/2,v,{color:_.color,textAlign:P,textBaseline:"middle"})}}function gk(r,i,o,c){const{ctx:f}=r;if(o)f.arc(r.xCenter,r.yCenter,i,0,Xn);else{let m=r.getPointPosition(0,i);f.moveTo(m.x,m.y);for(let _=1;_<c;_++)m=r.getPointPosition(_,i),f.lineTo(m.x,m.y)}}function sB(r,i,o,c,f){const m=r.ctx,_=i.circular,{color:v,lineWidth:s}=i;!_&&!c||!v||!s||o<0||(m.save(),m.strokeStyle=v,m.lineWidth=s,m.setLineDash(f.dash),m.lineDashOffset=f.dashOffset,m.beginPath(),gk(r,o,_,c),m.closePath(),m.stroke(),m.restore())}function oB(r,i,o){return Dl(r,{label:o,index:i,type:"pointLabel"})}class mf extends e_{constructor(i){super(i),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const i=this._padding=$r(Wx(this.options)/2),o=this.width=this.maxWidth-i.width,c=this.height=this.maxHeight-i.height;this.xCenter=Math.floor(this.left+o/2+i.left),this.yCenter=Math.floor(this.top+c/2+i.top),this.drawingArea=Math.floor(Math.min(o,c)/2)}determineDataLimits(){const{min:i,max:o}=this.getMinMax(!1);this.min=or(i)&&!isNaN(i)?i:0,this.max=or(o)&&!isNaN(o)?o:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Wx(this.options))}generateTickLabels(i){e_.prototype.generateTickLabels.call(this,i),this._pointLabels=this.getLabels().map((o,c)=>{const f=Vn(this.options.pointLabels.callback,[o,c],this);return f||f===0?f:""}).filter((o,c)=>this.chart.getDataVisibility(c))}fit(){const i=this.options;i.display&&i.pointLabels.display?YO(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(i,o,c,f){this.xCenter+=Math.floor((i-o)/2),this.yCenter+=Math.floor((c-f)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(i,o,c,f))}getIndexAngle(i){const o=Xn/(this._pointLabels.length||1),c=this.options.startAngle||0;return Rs(i*o+yo(c))}getDistanceFromCenterForValue(i){if(gn(i))return NaN;const o=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-i)*o:(i-this.min)*o}getValueForDistanceFromCenter(i){if(gn(i))return NaN;const o=i/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-o:this.min+o}getPointLabelContext(i){const o=this._pointLabels||[];if(i>=0&&i<o.length){const c=o[i];return oB(this.getContext(),i,c)}}getPointPosition(i,o,c=0){const f=this.getIndexAngle(i)-fr+c;return{x:Math.cos(f)*o+this.xCenter,y:Math.sin(f)*o+this.yCenter,angle:f}}getPointPositionForValue(i,o){return this.getPointPosition(i,this.getDistanceFromCenterForValue(o))}getBasePosition(i){return this.getPointPositionForValue(i||0,this.getBaseValue())}getPointLabelPosition(i){const{left:o,top:c,right:f,bottom:m}=this._pointLabelItems[i];return{left:o,top:c,right:f,bottom:m}}drawBackground(){const{backgroundColor:i,grid:{circular:o}}=this.options;if(i){const c=this.ctx;c.save(),c.beginPath(),gk(this,this.getDistanceFromCenterForValue(this._endValue),o,this._pointLabels.length),c.closePath(),c.fillStyle=i,c.fill(),c.restore()}}drawGrid(){const i=this.ctx,o=this.options,{angleLines:c,grid:f,border:m}=o,_=this._pointLabels.length;let v,s,S;if(o.pointLabels.display&&rB(this,_),f.display&&this.ticks.forEach((P,z)=>{if(z!==0||z===0&&this.min<0){s=this.getDistanceFromCenterForValue(P.value);const F=this.getContext(z),U=f.setContext(F),Z=m.setContext(F);sB(this,U,s,_,Z)}}),c.display){for(i.save(),v=_-1;v>=0;v--){const P=c.setContext(this.getPointLabelContext(v)),{color:z,lineWidth:F}=P;!F||!z||(i.lineWidth=F,i.strokeStyle=z,i.setLineDash(P.borderDash),i.lineDashOffset=P.borderDashOffset,s=this.getDistanceFromCenterForValue(o.ticks.reverse?this.min:this.max),S=this.getPointPosition(v,s),i.beginPath(),i.moveTo(this.xCenter,this.yCenter),i.lineTo(S.x,S.y),i.stroke())}i.restore()}}drawBorder(){}drawLabels(){const i=this.ctx,o=this.options,c=o.ticks;if(!c.display)return;const f=this.getIndexAngle(0);let m,_;i.save(),i.translate(this.xCenter,this.yCenter),i.rotate(f),i.textAlign="center",i.textBaseline="middle",this.ticks.forEach((v,s)=>{if(s===0&&this.min>=0&&!o.reverse)return;const S=c.setContext(this.getContext(s)),P=Mr(S.font);if(m=this.getDistanceFromCenterForValue(this.ticks[s].value),S.showLabelBackdrop){i.font=P.string,_=i.measureText(v.label).width,i.fillStyle=S.backdropColor;const z=$r(S.backdropPadding);i.fillRect(-_/2-z.left,-m-P.size/2-z.top,_+z.width,P.size+z.height)}Rc(i,v.label,0,-m,P,{color:S.color,strokeColor:S.textStrokeColor,strokeWidth:S.textStrokeWidth})}),i.restore()}drawTitle(){}}qt(mf,"id","radialLinear"),qt(mf,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:M_.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(i){return i},padding:5,centerPointLabels:!1}}),qt(mf,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),qt(mf,"descriptors",{angleLines:{_fallback:"grid"}});const I_={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},_s=Object.keys(I_);function tE(r,i){return r-i}function iE(r,i){if(gn(i))return null;const o=r._adapter,{parser:c,round:f,isoWeekday:m}=r._parseOpts;let _=i;return typeof c=="function"&&(_=c(_)),or(_)||(_=typeof c=="string"?o.parse(_,c):o.parse(_)),_===null?null:(f&&(_=f==="week"&&(ah(m)||m===!0)?o.startOf(_,"isoWeek",m):o.startOf(_,f)),+_)}function nE(r,i,o,c){const f=_s.length;for(let m=_s.indexOf(r);m<f-1;++m){const _=I_[_s[m]],v=_.steps?_.steps:Number.MAX_SAFE_INTEGER;if(_.common&&Math.ceil((o-i)/(v*_.size))<=c)return _s[m]}return _s[f-1]}function aB(r,i,o,c,f){for(let m=_s.length-1;m>=_s.indexOf(o);m--){const _=_s[m];if(I_[_].common&&r._adapter.diff(f,c,_)>=i-1)return _}return _s[o?_s.indexOf(o):0]}function lB(r){for(let i=_s.indexOf(r)+1,o=_s.length;i<o;++i)if(I_[_s[i]].common)return _s[i]}function rE(r,i,o){if(!o)r[i]=!0;else if(o.length){const{lo:c,hi:f}=Tv(o,i),m=o[c]>=i?o[c]:o[f];r[m]=!0}}function cB(r,i,o,c){const f=r._adapter,m=+f.startOf(i[0].value,c),_=i[i.length-1].value;let v,s;for(v=m;v<=_;v=+f.add(v,1,c))s=o[v],s>=0&&(i[s].major=!0);return i}function sE(r,i,o){const c=[],f={},m=i.length;let _,v;for(_=0;_<m;++_)v=i[_],f[v]=_,c.push({value:v,major:!1});return m===0||!o?c:cB(r,c,f,o)}class Bf extends Fc{constructor(i){super(i),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(i,o={}){const c=i.time||(i.time={}),f=this._adapter=new y4._date(i.adapters.date);f.init(o),wf(c.displayFormats,f.formats()),this._parseOpts={parser:c.parser,round:c.round,isoWeekday:c.isoWeekday},super.init(i),this._normalized=o.normalized}parse(i,o){return i===void 0?null:iE(this,i)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const i=this.options,o=this._adapter,c=i.time.unit||"day";let{min:f,max:m,minDefined:_,maxDefined:v}=this.getUserBounds();function s(S){!_&&!isNaN(S.min)&&(f=Math.min(f,S.min)),!v&&!isNaN(S.max)&&(m=Math.max(m,S.max))}(!_||!v)&&(s(this._getLabelBounds()),(i.bounds!=="ticks"||i.ticks.source!=="labels")&&s(this.getMinMax(!1))),f=or(f)&&!isNaN(f)?f:+o.startOf(Date.now(),c),m=or(m)&&!isNaN(m)?m:+o.endOf(Date.now(),c)+1,this.min=Math.min(f,m-1),this.max=Math.max(f+1,m)}_getLabelBounds(){const i=this.getLabelTimestamps();let o=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;return i.length&&(o=i[0],c=i[i.length-1]),{min:o,max:c}}buildTicks(){const i=this.options,o=i.time,c=i.ticks,f=c.source==="labels"?this.getLabelTimestamps():this._generate();i.bounds==="ticks"&&f.length&&(this.min=this._userMin||f[0],this.max=this._userMax||f[f.length-1]);const m=this.min,_=this.max,v=GL(f,m,_);return this._unit=o.unit||(c.autoSkip?nE(o.minUnit,this.min,this.max,this._getLabelCapacity(m)):aB(this,v.length,o.minUnit,this.min,this.max)),this._majorUnit=!c.major.enabled||this._unit==="year"?void 0:lB(this._unit),this.initOffsets(f),i.reverse&&v.reverse(),sE(this,v,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(i=>+i.value))}initOffsets(i=[]){let o=0,c=0,f,m;this.options.offset&&i.length&&(f=this.getDecimalForValue(i[0]),i.length===1?o=1-f:o=(this.getDecimalForValue(i[1])-f)/2,m=this.getDecimalForValue(i[i.length-1]),i.length===1?c=m:c=(m-this.getDecimalForValue(i[i.length-2]))/2);const _=i.length<3?.5:.25;o=Ir(o,0,_),c=Ir(c,0,_),this._offsets={start:o,end:c,factor:1/(o+1+c)}}_generate(){const i=this._adapter,o=this.min,c=this.max,f=this.options,m=f.time,_=m.unit||nE(m.minUnit,o,c,this._getLabelCapacity(o)),v=Gi(f.ticks.stepSize,1),s=_==="week"?m.isoWeekday:!1,S=ah(s)||s===!0,P={};let z=o,F,U;if(S&&(z=+i.startOf(z,"isoWeek",s)),z=+i.startOf(z,S?"day":_),i.diff(c,o,_)>1e5*v)throw new Error(o+" and "+c+" are too far apart with stepSize of "+v+" "+_);const Z=f.ticks.source==="data"&&this.getDataTimestamps();for(F=z,U=0;F<c;F=+i.add(F,v,_),U++)rE(P,F,Z);return(F===c||f.bounds==="ticks"||U===1)&&rE(P,F,Z),Object.keys(P).sort(tE).map(W=>+W)}getLabelForValue(i){const o=this._adapter,c=this.options.time;return c.tooltipFormat?o.format(i,c.tooltipFormat):o.format(i,c.displayFormats.datetime)}format(i,o){const f=this.options.time.displayFormats,m=this._unit,_=o||f[m];return this._adapter.format(i,_)}_tickFormatFunction(i,o,c,f){const m=this.options,_=m.ticks.callback;if(_)return Vn(_,[i,o,c],this);const v=m.time.displayFormats,s=this._unit,S=this._majorUnit,P=s&&v[s],z=S&&v[S],F=c[o],U=S&&z&&F&&F.major;return this._adapter.format(i,f||(U?z:P))}generateTickLabels(i){let o,c,f;for(o=0,c=i.length;o<c;++o)f=i[o],f.label=this._tickFormatFunction(f.value,o,i)}getDecimalForValue(i){return i===null?NaN:(i-this.min)/(this.max-this.min)}getPixelForValue(i){const o=this._offsets,c=this.getDecimalForValue(i);return this.getPixelForDecimal((o.start+c)*o.factor)}getValueForPixel(i){const o=this._offsets,c=this.getDecimalForPixel(i)/o.factor-o.end;return this.min+c*(this.max-this.min)}_getLabelSize(i){const o=this.options.ticks,c=this.ctx.measureText(i).width,f=yo(this.isHorizontal()?o.maxRotation:o.minRotation),m=Math.cos(f),_=Math.sin(f),v=this._resolveTickFontOptions(0).size;return{w:c*m+v*_,h:c*_+v*m}}_getLabelCapacity(i){const o=this.options.time,c=o.displayFormats,f=c[o.unit]||c.millisecond,m=this._tickFormatFunction(i,0,sE(this,[i],this._majorUnit),f),_=this._getLabelSize(m),v=Math.floor(this.isHorizontal()?this.width/_.w:this.height/_.h)-1;return v>0?v:1}getDataTimestamps(){let i=this._cache.data||[],o,c;if(i.length)return i;const f=this.getMatchingVisibleMetas();if(this._normalized&&f.length)return this._cache.data=f[0].controller.getAllParsedValues(this);for(o=0,c=f.length;o<c;++o)i=i.concat(f[o].controller.getAllParsedValues(this));return this._cache.data=this.normalize(i)}getLabelTimestamps(){const i=this._cache.labels||[];let o,c;if(i.length)return i;const f=this.getLabels();for(o=0,c=f.length;o<c;++o)i.push(iE(this,f[o]));return this._cache.labels=this._normalized?i:this.normalize(i)}normalize(i){return kI(i.sort(tE))}}qt(Bf,"id","time"),qt(Bf,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function hg(r,i,o){let c=0,f=r.length-1,m,_,v,s;o?(i>=r[c].pos&&i<=r[f].pos&&({lo:c,hi:f}=ja(r,"pos",i)),{pos:m,time:v}=r[c],{pos:_,time:s}=r[f]):(i>=r[c].time&&i<=r[f].time&&({lo:c,hi:f}=ja(r,"time",i)),{time:m,pos:v}=r[c],{time:_,pos:s}=r[f]);const S=_-m;return S?v+(s-v)*(i-m)/S:v}class qx extends Bf{constructor(i){super(i),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const i=this._getTimestampsForTable(),o=this._table=this.buildLookupTable(i);this._minPos=hg(o,this.min),this._tableRange=hg(o,this.max)-this._minPos,super.initOffsets(i)}buildLookupTable(i){const{min:o,max:c}=this,f=[],m=[];let _,v,s,S,P;for(_=0,v=i.length;_<v;++_)S=i[_],S>=o&&S<=c&&f.push(S);if(f.length<2)return[{time:o,pos:0},{time:c,pos:1}];for(_=0,v=f.length;_<v;++_)P=f[_+1],s=f[_-1],S=f[_],Math.round((P+s)/2)!==S&&m.push({time:S,pos:_/(v-1)});return m}_generate(){const i=this.min,o=this.max;let c=super.getDataTimestamps();return(!c.includes(i)||!c.length)&&c.splice(0,0,i),(!c.includes(o)||c.length===1)&&c.push(o),c.sort((f,m)=>f-m)}_getTimestampsForTable(){let i=this._cache.all||[];if(i.length)return i;const o=this.getDataTimestamps(),c=this.getLabelTimestamps();return o.length&&c.length?i=this.normalize(o.concat(c)):i=o.length?o:c,i=this._cache.all=i,i}getDecimalForValue(i){return(hg(this._table,i)-this._minPos)/this._tableRange}getValueForPixel(i){const o=this._offsets,c=this.getDecimalForPixel(i)/o.factor-o.end;return hg(this._table,c*this._tableRange+this._minPos,!0)}}qt(qx,"id","timeseries"),qt(qx,"defaults",Bf.defaults);var uB=Object.freeze({__proto__:null,CategoryScale:Ux,LinearScale:Gx,LogarithmicScale:Hx,RadialLinearScale:mf,TimeScale:Bf,TimeSeriesScale:qx});const hB=[_4,Z5,jO,uB];Ml.register(...hB);function oE(r){return Object.prototype.toString.call(r)==="[object Date]"}function Zx(r,i,o,c){if(typeof o=="number"||oE(o)){const f=c-o,m=(o-i)/(r.dt||1/60),_=r.opts.stiffness*f,v=r.opts.damping*m,s=(_-v)*r.inv_mass,S=(m+s)*r.dt;return Math.abs(S)<r.opts.precision&&Math.abs(f)<r.opts.precision?c:(r.settled=!1,oE(o)?new Date(o.getTime()+S):o+S)}else{if(Array.isArray(o))return o.map((f,m)=>Zx(r,i[m],o[m],c[m]));if(typeof o=="object"){const f={};for(const m in o)f[m]=Zx(r,i[m],o[m],c[m]);return f}else throw new Error(`Cannot spring ${typeof o} values`)}}function dB(r,i={}){const o=Xf(r),{stiffness:c=.15,damping:f=.8,precision:m=.01}=i;let _,v,s,S=r,P=r,z=1,F=0,U=!1;function Z(Q,re={}){P=Q;const ie=s={};return r==null||re.hard||W.stiffness>=1&&W.damping>=1?(U=!0,_=Mx(),S=Q,o.set(r=P),Promise.resolve()):(re.soft&&(F=1/((re.soft===!0?.5:+re.soft)*60),z=0),v||(_=Mx(),U=!1,v=BA(ve=>{if(U)return U=!1,v=null,!1;z=Math.min(z+F,1);const pe={inv_mass:z,opts:W,settled:!0,dt:(ve-_)*60/1e3},ke=Zx(pe,S,r,P);return _=ve,S=r,o.set(r=ke),pe.settled&&(v=null),!pe.settled})),new Promise(ve=>{v.promise.then(()=>{ie===s&&ve()})}))}const W={set:Z,update:(Q,re)=>Z(Q(P,r),re),subscribe:o.subscribe,stiffness:c,damping:f,precision:m};return W}function _k(r){return r<.5?4*r*r*r:.5*Math.pow(2*r-2,3)+1}function yk(r){const i=r-1;return i*i*i+1}function gj(r){const i=Math.cos(r*Math.PI*.5);return Math.abs(i)<1e-14?1:1-i}function aE(r,i,o){const c=r.slice();return c[37]=i[o],c[39]=o,c}function lE(r){let i,o,c,f,m=(r[6]==="label"||r[7]==="label")&&cE(r);return{c(){i=ci("span"),m&&m.c(),this.h()},l(_){i=_i(_,"SPAN",{class:!0,style:!0});var v=Xe(i);m&&m.l(v),v.forEach(Ee),this.h()},h(){ge(i,"class","pip first"),ge(i,"style",o=r[14]+": 0%;"),fi(i,"selected",r[18](r[0])),fi(i,"in-range",r[17](r[0]))},m(_,v){oi(_,i,v),m&&m.m(i,null),c||(f=[pt(i,"pointerdown",r[30]),pt(i,"pointerup",r[31])],c=!0)},p(_,v){_[6]==="label"||_[7]==="label"?m?m.p(_,v):(m=cE(_),m.c(),m.m(i,null)):m&&(m.d(1),m=null),v[0]&16384&&o!==(o=_[14]+": 0%;")&&ge(i,"style",o),v[0]&262145&&fi(i,"selected",_[18](_[0])),v[0]&131073&&fi(i,"in-range",_[17](_[0]))},d(_){_&&Ee(i),m&&m.d(),c=!1,Qn(f)}}}function cE(r){let i,o,c,f=r[12](r[16](r[0]),0,0)+"",m,_=r[10]&&uE(r),v=r[11]&&hE(r);return{c(){i=ci("span"),_&&_.c(),o=Sn(),c=new kc(!1),m=Sn(),v&&v.c(),this.h()},l(s){i=_i(s,"SPAN",{class:!0});var S=Xe(i);_&&_.l(S),o=Sn(),c=m_(S,!1),m=Sn(),v&&v.l(S),S.forEach(Ee),this.h()},h(){c.a=m,ge(i,"class","pipVal")},m(s,S){oi(s,i,S),_&&_.m(i,null),He(i,o),c.m(f,i),He(i,m),v&&v.m(i,null)},p(s,S){s[10]?_?_.p(s,S):(_=uE(s),_.c(),_.m(i,o)):_&&(_.d(1),_=null),S[0]&69633&&f!==(f=s[12](s[16](s[0]),0,0)+"")&&c.p(f),s[11]?v?v.p(s,S):(v=hE(s),v.c(),v.m(i,null)):v&&(v.d(1),v=null)},d(s){s&&Ee(i),_&&_.d(),v&&v.d()}}}function uE(r){let i,o;return{c(){i=ci("span"),o=In(r[10]),this.h()},l(c){i=_i(c,"SPAN",{class:!0});var f=Xe(i);o=Bn(f,r[10]),f.forEach(Ee),this.h()},h(){ge(i,"class","pipVal-prefix")},m(c,f){oi(c,i,f),He(i,o)},p(c,f){f[0]&1024&&Sr(o,c[10])},d(c){c&&Ee(i)}}}function hE(r){let i,o;return{c(){i=ci("span"),o=In(r[11]),this.h()},l(c){i=_i(c,"SPAN",{class:!0});var f=Xe(i);o=Bn(f,r[11]),f.forEach(Ee),this.h()},h(){ge(i,"class","pipVal-suffix")},m(c,f){oi(c,i,f),He(i,o)},p(c,f){f[0]&2048&&Sr(o,c[11])},d(c){c&&Ee(i)}}}function dE(r){let i,o=Ar(Array(r[20]+1)),c=[];for(let f=0;f<o.length;f+=1)c[f]=_E(aE(r,o,f));return{c(){for(let f=0;f<c.length;f+=1)c[f].c();i=Sn()},l(f){for(let m=0;m<c.length;m+=1)c[m].l(f);i=Sn()},m(f,m){for(let _=0;_<c.length;_+=1)c[_]&&c[_].m(f,m);oi(f,i,m)},p(f,m){if(m[0]&8314435){o=Ar(Array(f[20]+1));let _;for(_=0;_<o.length;_+=1){const v=aE(f,o,_);c[_]?c[_].p(v,m):(c[_]=_E(v),c[_].c(),c[_].m(i.parentNode,i))}for(;_<c.length;_+=1)c[_].d(1);c.length=o.length}},d(f){f&&Ee(i),Oa(c,f)}}}function fE(r){let i,o,c,f,m,_=(r[6]==="label"||r[9]==="label")&&pE(r);function v(...s){return r[33](r[39],...s)}return{c(){i=ci("span"),_&&_.c(),o=Kn(),this.h()},l(s){i=_i(s,"SPAN",{class:!0,style:!0});var S=Xe(i);_&&_.l(S),o=Jn(S),S.forEach(Ee),this.h()},h(){ge(i,"class","pip"),ge(i,"style",c=r[14]+": "+r[15](r[19](r[39]))+"%;"),fi(i,"selected",r[18](r[19](r[39]))),fi(i,"in-range",r[17](r[19](r[39])))},m(s,S){oi(s,i,S),_&&_.m(i,null),He(i,o),f||(m=[pt(i,"pointerdown",r[32]),pt(i,"pointerup",v)],f=!0)},p(s,S){r=s,r[6]==="label"||r[9]==="label"?_?_.p(r,S):(_=pE(r),_.c(),_.m(i,o)):_&&(_.d(1),_=null),S[0]&573440&&c!==(c=r[14]+": "+r[15](r[19](r[39]))+"%;")&&ge(i,"style",c),S[0]&786432&&fi(i,"selected",r[18](r[19](r[39]))),S[0]&655360&&fi(i,"in-range",r[17](r[19](r[39])))},d(s){s&&Ee(i),_&&_.d(),f=!1,Qn(m)}}}function pE(r){let i,o,c,f=r[12](r[19](r[39]),r[39],r[15](r[19](r[39])))+"",m,_=r[10]&&mE(r),v=r[11]&&gE(r);return{c(){i=ci("span"),_&&_.c(),o=Sn(),c=new kc(!1),m=Sn(),v&&v.c(),this.h()},l(s){i=_i(s,"SPAN",{class:!0});var S=Xe(i);_&&_.l(S),o=Sn(),c=m_(S,!1),m=Sn(),v&&v.l(S),S.forEach(Ee),this.h()},h(){c.a=m,ge(i,"class","pipVal")},m(s,S){oi(s,i,S),_&&_.m(i,null),He(i,o),c.m(f,i),He(i,m),v&&v.m(i,null)},p(s,S){s[10]?_?_.p(s,S):(_=mE(s),_.c(),_.m(i,o)):_&&(_.d(1),_=null),S[0]&561152&&f!==(f=s[12](s[19](s[39]),s[39],s[15](s[19](s[39])))+"")&&c.p(f),s[11]?v?v.p(s,S):(v=gE(s),v.c(),v.m(i,null)):v&&(v.d(1),v=null)},d(s){s&&Ee(i),_&&_.d(),v&&v.d()}}}function mE(r){let i,o;return{c(){i=ci("span"),o=In(r[10]),this.h()},l(c){i=_i(c,"SPAN",{class:!0});var f=Xe(i);o=Bn(f,r[10]),f.forEach(Ee),this.h()},h(){ge(i,"class","pipVal-prefix")},m(c,f){oi(c,i,f),He(i,o)},p(c,f){f[0]&1024&&Sr(o,c[10])},d(c){c&&Ee(i)}}}function gE(r){let i,o;return{c(){i=ci("span"),o=In(r[11]),this.h()},l(c){i=_i(c,"SPAN",{class:!0});var f=Xe(i);o=Bn(f,r[11]),f.forEach(Ee),this.h()},h(){ge(i,"class","pipVal-suffix")},m(c,f){oi(c,i,f),He(i,o)},p(c,f){f[0]&2048&&Sr(o,c[11])},d(c){c&&Ee(i)}}}function _E(r){let i=r[19](r[39])!==r[0]&&r[19](r[39])!==r[1],o,c=i&&fE(r);return{c(){c&&c.c(),o=Sn()},l(f){c&&c.l(f),o=Sn()},m(f,m){c&&c.m(f,m),oi(f,o,m)},p(f,m){m[0]&524291&&(i=f[19](f[39])!==f[0]&&f[19](f[39])!==f[1]),i?c?c.p(f,m):(c=fE(f),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null)},d(f){f&&Ee(o),c&&c.d(f)}}}function yE(r){let i,o,c,f,m=(r[6]==="label"||r[8]==="label")&&xE(r);return{c(){i=ci("span"),m&&m.c(),this.h()},l(_){i=_i(_,"SPAN",{class:!0,style:!0});var v=Xe(i);m&&m.l(v),v.forEach(Ee),this.h()},h(){ge(i,"class","pip last"),ge(i,"style",o=r[14]+": 100%;"),fi(i,"selected",r[18](r[1])),fi(i,"in-range",r[17](r[1]))},m(_,v){oi(_,i,v),m&&m.m(i,null),c||(f=[pt(i,"pointerdown",r[34]),pt(i,"pointerup",r[35])],c=!0)},p(_,v){_[6]==="label"||_[8]==="label"?m?m.p(_,v):(m=xE(_),m.c(),m.m(i,null)):m&&(m.d(1),m=null),v[0]&16384&&o!==(o=_[14]+": 100%;")&&ge(i,"style",o),v[0]&262146&&fi(i,"selected",_[18](_[1])),v[0]&131074&&fi(i,"in-range",_[17](_[1]))},d(_){_&&Ee(i),m&&m.d(),c=!1,Qn(f)}}}function xE(r){let i,o,c,f=r[12](r[16](r[1]),r[20],100)+"",m,_=r[10]&&vE(r),v=r[11]&&bE(r);return{c(){i=ci("span"),_&&_.c(),o=Sn(),c=new kc(!1),m=Sn(),v&&v.c(),this.h()},l(s){i=_i(s,"SPAN",{class:!0});var S=Xe(i);_&&_.l(S),o=Sn(),c=m_(S,!1),m=Sn(),v&&v.l(S),S.forEach(Ee),this.h()},h(){c.a=m,ge(i,"class","pipVal")},m(s,S){oi(s,i,S),_&&_.m(i,null),He(i,o),c.m(f,i),He(i,m),v&&v.m(i,null)},p(s,S){s[10]?_?_.p(s,S):(_=vE(s),_.c(),_.m(i,o)):_&&(_.d(1),_=null),S[0]&1118210&&f!==(f=s[12](s[16](s[1]),s[20],100)+"")&&c.p(f),s[11]?v?v.p(s,S):(v=bE(s),v.c(),v.m(i,null)):v&&(v.d(1),v=null)},d(s){s&&Ee(i),_&&_.d(),v&&v.d()}}}function vE(r){let i,o;return{c(){i=ci("span"),o=In(r[10]),this.h()},l(c){i=_i(c,"SPAN",{class:!0});var f=Xe(i);o=Bn(f,r[10]),f.forEach(Ee),this.h()},h(){ge(i,"class","pipVal-prefix")},m(c,f){oi(c,i,f),He(i,o)},p(c,f){f[0]&1024&&Sr(o,c[10])},d(c){c&&Ee(i)}}}function bE(r){let i,o;return{c(){i=ci("span"),o=In(r[11]),this.h()},l(c){i=_i(c,"SPAN",{class:!0});var f=Xe(i);o=Bn(f,r[11]),f.forEach(Ee),this.h()},h(){ge(i,"class","pipVal-suffix")},m(c,f){oi(c,i,f),He(i,o)},p(c,f){f[0]&2048&&Sr(o,c[11])},d(c){c&&Ee(i)}}}function fB(r){let i,o,c,f=(r[6]&&r[7]!==!1||r[7])&&lE(r),m=(r[6]&&r[9]!==!1||r[9])&&dE(r),_=(r[6]&&r[8]!==!1||r[8])&&yE(r);return{c(){i=ci("div"),f&&f.c(),o=Kn(),m&&m.c(),c=Kn(),_&&_.c(),this.h()},l(v){i=_i(v,"DIV",{class:!0});var s=Xe(i);f&&f.l(s),o=Jn(s),m&&m.l(s),c=Jn(s),_&&_.l(s),s.forEach(Ee),this.h()},h(){ge(i,"class","rangePips"),fi(i,"disabled",r[5]),fi(i,"hoverable",r[4]),fi(i,"vertical",r[2]),fi(i,"reversed",r[3]),fi(i,"focus",r[13])},m(v,s){oi(v,i,s),f&&f.m(i,null),He(i,o),m&&m.m(i,null),He(i,c),_&&_.m(i,null)},p(v,s){v[6]&&v[7]!==!1||v[7]?f?f.p(v,s):(f=lE(v),f.c(),f.m(i,o)):f&&(f.d(1),f=null),v[6]&&v[9]!==!1||v[9]?m?m.p(v,s):(m=dE(v),m.c(),m.m(i,c)):m&&(m.d(1),m=null),v[6]&&v[8]!==!1||v[8]?_?_.p(v,s):(_=yE(v),_.c(),_.m(i,null)):_&&(_.d(1),_=null),s[0]&32&&fi(i,"disabled",v[5]),s[0]&16&&fi(i,"hoverable",v[4]),s[0]&4&&fi(i,"vertical",v[2]),s[0]&8&&fi(i,"reversed",v[3]),s[0]&8192&&fi(i,"focus",v[13])},i:ln,o:ln,d(v){v&&Ee(i),f&&f.d(),m&&m.d(),_&&_.d()}}}function pB(r,i,o){let c,f,m,_,v,{range:s=!1}=i,{min:S=0}=i,{max:P=100}=i,{step:z=1}=i,{values:F=[(P+S)/2]}=i,{vertical:U=!1}=i,{reversed:Z=!1}=i,{hoverable:W=!0}=i,{disabled:Q=!1}=i,{pipstep:re=void 0}=i,{all:ie=!0}=i,{first:ve=void 0}=i,{last:pe=void 0}=i,{rest:ke=void 0}=i,{prefix:Me=""}=i,{suffix:Ye=""}=i,{formatter:ot=(Qe,Ii,bi)=>Qe}=i,{focus:Mt=void 0}=i,{orientationStart:Se=void 0}=i,{percentOf:yt=void 0}=i,{moveHandle:_t=void 0}=i,{fixFloat:Ze=void 0}=i,{normalisedClient:Tt=void 0}=i,Zt;function ni(Qe){Qe=Tt(Qe),Zt={x:Qe.clientX,y:Qe.clientY}}function ui(Qe,Ii){if(Ii=Tt(Ii),!Q){const bi=Math.sqrt(Math.pow(Zt.x-Ii.clientX,2)+Math.pow(Zt.y-Ii.clientY,2));Zt&&bi<=5&&_t(void 0,Qe)}}const Di=Qe=>{ni(Qe)},ft=Qe=>{ui(S,Qe)},yi=Qe=>{ni(Qe)},wi=(Qe,Ii)=>{ui(m(Qe),Ii)},ai=Qe=>{ni(Qe)},nt=Qe=>{ui(P,Qe)};return r.$$set=Qe=>{"range"in Qe&&o(23,s=Qe.range),"min"in Qe&&o(0,S=Qe.min),"max"in Qe&&o(1,P=Qe.max),"step"in Qe&&o(24,z=Qe.step),"values"in Qe&&o(25,F=Qe.values),"vertical"in Qe&&o(2,U=Qe.vertical),"reversed"in Qe&&o(3,Z=Qe.reversed),"hoverable"in Qe&&o(4,W=Qe.hoverable),"disabled"in Qe&&o(5,Q=Qe.disabled),"pipstep"in Qe&&o(26,re=Qe.pipstep),"all"in Qe&&o(6,ie=Qe.all),"first"in Qe&&o(7,ve=Qe.first),"last"in Qe&&o(8,pe=Qe.last),"rest"in Qe&&o(9,ke=Qe.rest),"prefix"in Qe&&o(10,Me=Qe.prefix),"suffix"in Qe&&o(11,Ye=Qe.suffix),"formatter"in Qe&&o(12,ot=Qe.formatter),"focus"in Qe&&o(13,Mt=Qe.focus),"orientationStart"in Qe&&o(14,Se=Qe.orientationStart),"percentOf"in Qe&&o(15,yt=Qe.percentOf),"moveHandle"in Qe&&o(27,_t=Qe.moveHandle),"fixFloat"in Qe&&o(16,Ze=Qe.fixFloat),"normalisedClient"in Qe&&o(28,Tt=Qe.normalisedClient)},r.$$.update=()=>{r.$$.dirty[0]&83886087&&o(29,c=re||((P-S)/z>=(U?50:100)?(P-S)/(U?10:20):1)),r.$$.dirty[0]&553648131&&o(20,f=parseInt((P-S)/(z*c),10)),r.$$.dirty[0]&553713665&&o(19,m=function(Qe){return Ze(S+Qe*z*c)}),r.$$.dirty[0]&33619968&&o(18,_=function(Qe){return F.some(Ii=>Ze(Ii)===Ze(Qe))}),r.$$.dirty[0]&41943040&&o(17,v=function(Qe){if(s==="min")return F[0]>Qe;if(s==="max")return F[0]<Qe;if(s)return F[0]<Qe&&F[1]>Qe})},[S,P,U,Z,W,Q,ie,ve,pe,ke,Me,Ye,ot,Mt,Se,yt,Ze,v,_,m,f,ni,ui,s,z,F,re,_t,Tt,c,Di,ft,yi,wi,ai,nt]}class mB extends jr{constructor(i){super(),Vr(this,i,pB,fB,kr,{range:23,min:0,max:1,step:24,values:25,vertical:2,reversed:3,hoverable:4,disabled:5,pipstep:26,all:6,first:7,last:8,rest:9,prefix:10,suffix:11,formatter:12,focus:13,orientationStart:14,percentOf:15,moveHandle:27,fixFloat:16,normalisedClient:28},null,[-1,-1])}}function wE(r,i,o){const c=r.slice();return c[65]=i[o],c[67]=o,c}function TE(r){let i,o,c,f=r[21](r[65],r[67],r[24](r[65]))+"",m,_=r[18]&&ME(r),v=r[19]&&SE(r);return{c(){i=ci("span"),_&&_.c(),o=Sn(),c=new kc(!1),m=Sn(),v&&v.c(),this.h()},l(s){i=_i(s,"SPAN",{class:!0});var S=Xe(i);_&&_.l(S),o=Sn(),c=m_(S,!1),m=Sn(),v&&v.l(S),S.forEach(Ee),this.h()},h(){c.a=m,ge(i,"class","rangeFloat")},m(s,S){oi(s,i,S),_&&_.m(i,null),He(i,o),c.m(f,i),He(i,m),v&&v.m(i,null)},p(s,S){s[18]?_?_.p(s,S):(_=ME(s),_.c(),_.m(i,o)):_&&(_.d(1),_=null),S[0]&18874369&&f!==(f=s[21](s[65],s[67],s[24](s[65]))+"")&&c.p(f),s[19]?v?v.p(s,S):(v=SE(s),v.c(),v.m(i,null)):v&&(v.d(1),v=null)},d(s){s&&Ee(i),_&&_.d(),v&&v.d()}}}function ME(r){let i,o;return{c(){i=ci("span"),o=In(r[18]),this.h()},l(c){i=_i(c,"SPAN",{class:!0});var f=Xe(i);o=Bn(f,r[18]),f.forEach(Ee),this.h()},h(){ge(i,"class","rangeFloat-prefix")},m(c,f){oi(c,i,f),He(i,o)},p(c,f){f[0]&262144&&Sr(o,c[18])},d(c){c&&Ee(i)}}}function SE(r){let i,o;return{c(){i=ci("span"),o=In(r[19]),this.h()},l(c){i=_i(c,"SPAN",{class:!0});var f=Xe(i);o=Bn(f,r[19]),f.forEach(Ee),this.h()},h(){ge(i,"class","rangeFloat-suffix")},m(c,f){oi(c,i,f),He(i,o)},p(c,f){f[0]&524288&&Sr(o,c[19])},d(c){c&&Ee(i)}}}function EE(r){let i,o,c,f,m,_,v,s,S,P,z,F,U,Z=r[7]&&TE(r);return{c(){i=ci("span"),o=ci("span"),c=Kn(),Z&&Z.c(),this.h()},l(W){i=_i(W,"SPAN",{role:!0,class:!0,"data-handle":!0,style:!0,"aria-label":!0,"aria-valuemin":!0,"aria-valuemax":!0,"aria-valuenow":!0,"aria-valuetext":!0,"aria-orientation":!0,"aria-disabled":!0,disabled:!0,tabindex:!0});var Q=Xe(i);o=_i(Q,"SPAN",{class:!0}),Xe(o).forEach(Ee),c=Jn(Q),Z&&Z.l(Q),Q.forEach(Ee),this.h()},h(){ge(o,"class","rangeNub"),ge(i,"role","slider"),ge(i,"class","rangeHandle"),ge(i,"data-handle",r[67]),ge(i,"style",f=r[29]+": "+r[30][r[67]]+"%; z-index: "+(r[27]===r[67]?3:2)+";"),ge(i,"aria-label",m=r[22][r[67]]),ge(i,"aria-valuemin",_=r[2]===!0&&r[67]===1?r[0][0]:r[3]),ge(i,"aria-valuemax",v=r[2]===!0&&r[67]===0?r[0][1]:r[4]),ge(i,"aria-valuenow",s=r[65]),ge(i,"aria-valuetext",S=""+(r[18]+CE(r[21](r[65],r[67],r[24](r[65])))+r[19])),ge(i,"aria-orientation",P=r[6]?"vertical":"horizontal"),ge(i,"aria-disabled",r[10]),ge(i,"disabled",r[10]),ge(i,"tabindex",z=r[10]?-1:0),fi(i,"active",r[25]&&r[27]===r[67]),fi(i,"press",r[26]&&r[27]===r[67])},m(W,Q){oi(W,i,Q),He(i,o),He(i,c),Z&&Z.m(i,null),F||(U=[pt(i,"blur",r[35]),pt(i,"focus",r[36]),pt(i,"keydown",r[37])],F=!0)},p(W,Q){W[7]?Z?Z.p(W,Q):(Z=TE(W),Z.c(),Z.m(i,null)):Z&&(Z.d(1),Z=null),Q[0]&1744830464&&f!==(f=W[29]+": "+W[30][W[67]]+"%; z-index: "+(W[27]===W[67]?3:2)+";")&&ge(i,"style",f),Q[0]&4194304&&m!==(m=W[22][W[67]])&&ge(i,"aria-label",m),Q[0]&13&&_!==(_=W[2]===!0&&W[67]===1?W[0][0]:W[3])&&ge(i,"aria-valuemin",_),Q[0]&21&&v!==(v=W[2]===!0&&W[67]===0?W[0][1]:W[4])&&ge(i,"aria-valuemax",v),Q[0]&1&&s!==(s=W[65])&&ge(i,"aria-valuenow",s),Q[0]&19660801&&S!==(S=""+(W[18]+CE(W[21](W[65],W[67],W[24](W[65])))+W[19]))&&ge(i,"aria-valuetext",S),Q[0]&64&&P!==(P=W[6]?"vertical":"horizontal")&&ge(i,"aria-orientation",P),Q[0]&1024&&ge(i,"aria-disabled",W[10]),Q[0]&1024&&ge(i,"disabled",W[10]),Q[0]&1024&&z!==(z=W[10]?-1:0)&&ge(i,"tabindex",z),Q[0]&167772160&&fi(i,"active",W[25]&&W[27]===W[67]),Q[0]&201326592&&fi(i,"press",W[26]&&W[27]===W[67])},d(W){W&&Ee(i),Z&&Z.d(),F=!1,Qn(U)}}}function AE(r){let i,o;return{c(){i=ci("span"),this.h()},l(c){i=_i(c,"SPAN",{class:!0,style:!0}),Xe(i).forEach(Ee),this.h()},h(){ge(i,"class","rangeBar"),ge(i,"style",o=r[29]+": "+r[33](r[30])+"%; "+r[28]+": "+r[34](r[30])+"%;")},m(c,f){oi(c,i,f)},p(c,f){f[0]&1879048192&&o!==(o=c[29]+": "+c[33](c[30])+"%; "+c[28]+": "+c[34](c[30])+"%;")&&ge(i,"style",o)},d(c){c&&Ee(i)}}}function IE(r){let i,o;return i=new mB({props:{values:r[0],min:r[3],max:r[4],step:r[5],range:r[2],vertical:r[6],reversed:r[8],orientationStart:r[29],hoverable:r[9],disabled:r[10],all:r[13],first:r[14],last:r[15],rest:r[16],pipstep:r[12],prefix:r[18],suffix:r[19],formatter:r[20],focus:r[25],percentOf:r[24],moveHandle:r[32],fixFloat:r[31],normalisedClient:kg}}),{c(){y_(i.$$.fragment)},l(c){x_(i.$$.fragment,c)},m(c,f){qf(i,c,f),o=!0},p(c,f){const m={};f[0]&1&&(m.values=c[0]),f[0]&8&&(m.min=c[3]),f[0]&16&&(m.max=c[4]),f[0]&32&&(m.step=c[5]),f[0]&4&&(m.range=c[2]),f[0]&64&&(m.vertical=c[6]),f[0]&256&&(m.reversed=c[8]),f[0]&536870912&&(m.orientationStart=c[29]),f[0]&512&&(m.hoverable=c[9]),f[0]&1024&&(m.disabled=c[10]),f[0]&8192&&(m.all=c[13]),f[0]&16384&&(m.first=c[14]),f[0]&32768&&(m.last=c[15]),f[0]&65536&&(m.rest=c[16]),f[0]&4096&&(m.pipstep=c[12]),f[0]&262144&&(m.prefix=c[18]),f[0]&524288&&(m.suffix=c[19]),f[0]&1048576&&(m.formatter=c[20]),f[0]&33554432&&(m.focus=c[25]),f[0]&16777216&&(m.percentOf=c[24]),i.$set(m)},i(c){o||(pr(i.$$.fragment,c),o=!0)},o(c){Nr(i.$$.fragment,c),o=!1},d(c){Zf(i,c)}}}function gB(r){let i,o,c,f,m,_,v=Ar(r[0]),s=[];for(let z=0;z<v.length;z+=1)s[z]=EE(wE(r,v,z));let S=r[2]&&AE(r),P=r[11]&&IE(r);return{c(){i=ci("div");for(let z=0;z<s.length;z+=1)s[z].c();o=Kn(),S&&S.c(),c=Kn(),P&&P.c(),this.h()},l(z){i=_i(z,"DIV",{id:!0,role:!0,class:!0});var F=Xe(i);for(let U=0;U<s.length;U+=1)s[U].l(F);o=Jn(F),S&&S.l(F),c=Jn(F),P&&P.l(F),F.forEach(Ee),this.h()},h(){ge(i,"id",r[17]),ge(i,"role","none"),ge(i,"class","rangeSlider"),fi(i,"range",r[2]),fi(i,"disabled",r[10]),fi(i,"hoverable",r[9]),fi(i,"vertical",r[6]),fi(i,"reversed",r[8]),fi(i,"focus",r[25]),fi(i,"min",r[2]==="min"),fi(i,"max",r[2]==="max"),fi(i,"pips",r[11]),fi(i,"pip-labels",r[13]==="label"||r[14]==="label"||r[15]==="label"||r[16]==="label")},m(z,F){oi(z,i,F);for(let U=0;U<s.length;U+=1)s[U]&&s[U].m(i,null);He(i,o),S&&S.m(i,null),He(i,c),P&&P.m(i,null),r[51](i),f=!0,m||(_=[pt(window,"mousedown",r[40]),pt(window,"touchstart",r[40]),pt(window,"mousemove",r[41]),pt(window,"touchmove",r[41]),pt(window,"mouseup",r[42]),pt(window,"touchend",r[43]),pt(window,"keydown",r[44]),pt(i,"mousedown",r[38]),pt(i,"mouseup",r[39]),pt(i,"touchstart",TM(r[38])),pt(i,"touchend",TM(r[39]))],m=!0)},p(z,F){if(F[0]&1869350109|F[1]&112){v=Ar(z[0]);let U;for(U=0;U<v.length;U+=1){const Z=wE(z,v,U);s[U]?s[U].p(Z,F):(s[U]=EE(Z),s[U].c(),s[U].m(i,o))}for(;U<s.length;U+=1)s[U].d(1);s.length=v.length}z[2]?S?S.p(z,F):(S=AE(z),S.c(),S.m(i,c)):S&&(S.d(1),S=null),z[11]?P?(P.p(z,F),F[0]&2048&&pr(P,1)):(P=IE(z),P.c(),pr(P,1),P.m(i,null)):P&&(g_(),Nr(P,1,1,()=>{P=null}),__()),(!f||F[0]&131072)&&ge(i,"id",z[17]),(!f||F[0]&4)&&fi(i,"range",z[2]),(!f||F[0]&1024)&&fi(i,"disabled",z[10]),(!f||F[0]&512)&&fi(i,"hoverable",z[9]),(!f||F[0]&64)&&fi(i,"vertical",z[6]),(!f||F[0]&256)&&fi(i,"reversed",z[8]),(!f||F[0]&33554432)&&fi(i,"focus",z[25]),(!f||F[0]&4)&&fi(i,"min",z[2]==="min"),(!f||F[0]&4)&&fi(i,"max",z[2]==="max"),(!f||F[0]&2048)&&fi(i,"pips",z[11]),(!f||F[0]&122880)&&fi(i,"pip-labels",z[13]==="label"||z[14]==="label"||z[15]==="label"||z[16]==="label")},i(z){f||(pr(P),f=!0)},o(z){Nr(P),f=!1},d(z){z&&Ee(i),Oa(s,z),S&&S.d(),P&&P.d(),r[51](null),m=!1,Qn(_)}}}function kE(r){if(!r)return-1;for(var i=0;r=r.previousElementSibling;)i++;return i}function kg(r){return r.type.includes("touch")?r.touches[0]||r.changedTouches[0]:r}function CE(r){return`${r}`.replace(/<[^>]*>/g,"")}function _B(r,i,o){let c,f,m,_,v,s,S=ln,P=()=>(S(),S=zA(at,Be=>o(30,s=Be)),at);r.$$.on_destroy.push(()=>S());let{slider:z=void 0}=i,{range:F=!1}=i,{pushy:U=!1}=i,{min:Z=0}=i,{max:W=100}=i,{step:Q=1}=i,{values:re=[(W+Z)/2]}=i,{vertical:ie=!1}=i,{float:ve=!1}=i,{reversed:pe=!1}=i,{hoverable:ke=!0}=i,{disabled:Me=!1}=i,{pips:Ye=!1}=i,{pipstep:ot=void 0}=i,{all:Mt=void 0}=i,{first:Se=void 0}=i,{last:yt=void 0}=i,{rest:_t=void 0}=i,{id:Ze=void 0}=i,{prefix:Tt=""}=i,{suffix:Zt=""}=i,{formatter:ni=(Be,Yt,zi)=>Be}=i,{handleFormatter:ui=ni}=i,{ariaLabels:Di=[]}=i,{precision:ft=2}=i,{springValues:yi={stiffness:.15,damping:.4}}=i;const wi=av();let ai=0,nt=!1,Qe=!1,Ii=!1,bi=!1,rn=re.length-1,Hi,Pn,at;const on=Be=>parseFloat((+Be).toFixed(ft));function $n(Be){const Yt=z.querySelectorAll(".handle"),zi=Array.prototype.includes.call(Yt,Be),Ni=Array.prototype.some.call(Yt,zn=>zn.contains(Be));return zi||Ni}function er(Be){return F==="min"||F==="max"?Be.slice(0,1):F?Be.slice(0,2):Be}function en(){return z.getBoundingClientRect()}function St(Be){const Yt=en();let zi=0,Ni=0,zn=0;ie?(zi=Be.clientY-Yt.top,Ni=zi/Yt.height*100,Ni=pe?Ni:100-Ni):(zi=Be.clientX-Yt.left,Ni=zi/Yt.width*100,Ni=pe?100-Ni:Ni),zn=(W-Z)/100*Ni+Z;let rs;return F===!0&&re[0]===re[1]?zn>re[1]?1:0:(rs=re.indexOf([...re].sort((sr,xs)=>Math.abs(zn-sr)-Math.abs(zn-xs))[0]),rs)}function si(Be){const Yt=en();let zi=0,Ni=0,zn=0;ie?(zi=Be.clientY-Yt.top,Ni=zi/Yt.height*100,Ni=pe?Ni:100-Ni):(zi=Be.clientX-Yt.left,Ni=zi/Yt.width*100,Ni=pe?100-Ni:Ni),zn=(W-Z)/100*Ni+Z,Re(rn,zn)}function Re(Be,Yt){return Yt=m(Yt),typeof Be>"u"&&(Be=rn),F&&(Be===0&&Yt>re[1]?U?o(0,re[1]=Yt,re):Yt=re[1]:Be===1&&Yt<re[0]&&(U?o(0,re[0]=Yt,re):Yt=re[0])),re[Be]!==Yt&&o(0,re[Be]=Yt,re),Pn!==Yt&&(un(),Pn=Yt),Yt}function ee(Be){return F==="min"?0:Be[0]}function ce(Be){return F==="max"?0:F==="min"?100-Be[0]:100-Be[1]}function Te(Be){bi&&(o(25,nt=!1),Qe=!1,o(26,Ii=!1))}function it(Be){Me||(o(27,rn=kE(Be.target)),o(25,nt=!0))}function tt(Be){if(!Me){const Yt=kE(Be.target);let zi=Be.ctrlKey||Be.metaKey||Be.shiftKey?Q*10:Q,Ni=!1;switch(Be.key){case"PageDown":zi*=10;case"ArrowRight":case"ArrowUp":Re(Yt,re[Yt]+zi),Ni=!0;break;case"PageUp":zi*=10;case"ArrowLeft":case"ArrowDown":Re(Yt,re[Yt]-zi),Ni=!0;break;case"Home":Re(Yt,Z),Ni=!0;break;case"End":Re(Yt,W),Ni=!0;break}Ni&&(Be.preventDefault(),Be.stopPropagation())}}function Et(Be){if(!Me){const Yt=Be.target,zi=kg(Be);o(25,nt=!0),Qe=!0,o(26,Ii=!0),o(27,rn=St(zi)),Hi=Pn=m(re[rn]),Ti(),Be.type==="touchstart"&&!Yt.matches(".pipVal")&&si(zi)}}function Dt(Be){Be.type==="touchend"&&Dn(),o(26,Ii=!1)}function Ke(Be){bi=!1,nt&&Be.target!==z&&!z.contains(Be.target)&&o(25,nt=!1)}function Vt(Be){Me||Qe&&si(kg(Be))}function Ct(Be){if(!Me){const Yt=Be.target;Qe&&((Yt===z||z.contains(Yt))&&(o(25,nt=!0),!$n(Yt)&&!Yt.matches(".pipVal")&&si(kg(Be))),Dn())}Qe=!1,o(26,Ii=!1)}function zt(Be){Qe=!1,o(26,Ii=!1)}function Fi(Be){Me||(Be.target===z||z.contains(Be.target))&&(bi=!0)}function Ti(){!Me&&wi("start",{activeHandle:rn,value:Hi,values:re.map(Be=>m(Be))})}function Dn(){!Me&&wi("stop",{activeHandle:rn,startValue:Hi,value:re[rn],values:re.map(Be=>m(Be))})}function un(){!Me&&wi("change",{activeHandle:rn,startValue:Hi,previousValue:typeof Pn>"u"?Hi:Pn,value:re[rn],values:re.map(Be=>m(Be))})}function pn(Be){_o[Be?"unshift":"push"](()=>{z=Be,o(1,z)})}return r.$$set=Be=>{"slider"in Be&&o(1,z=Be.slider),"range"in Be&&o(2,F=Be.range),"pushy"in Be&&o(45,U=Be.pushy),"min"in Be&&o(3,Z=Be.min),"max"in Be&&o(4,W=Be.max),"step"in Be&&o(5,Q=Be.step),"values"in Be&&o(0,re=Be.values),"vertical"in Be&&o(6,ie=Be.vertical),"float"in Be&&o(7,ve=Be.float),"reversed"in Be&&o(8,pe=Be.reversed),"hoverable"in Be&&o(9,ke=Be.hoverable),"disabled"in Be&&o(10,Me=Be.disabled),"pips"in Be&&o(11,Ye=Be.pips),"pipstep"in Be&&o(12,ot=Be.pipstep),"all"in Be&&o(13,Mt=Be.all),"first"in Be&&o(14,Se=Be.first),"last"in Be&&o(15,yt=Be.last),"rest"in Be&&o(16,_t=Be.rest),"id"in Be&&o(17,Ze=Be.id),"prefix"in Be&&o(18,Tt=Be.prefix),"suffix"in Be&&o(19,Zt=Be.suffix),"formatter"in Be&&o(20,ni=Be.formatter),"handleFormatter"in Be&&o(21,ui=Be.handleFormatter),"ariaLabels"in Be&&o(22,Di=Be.ariaLabels),"precision"in Be&&o(46,ft=Be.precision),"springValues"in Be&&o(47,yi=Be.springValues)},r.$$.update=()=>{if(r.$$.dirty[0]&24&&o(50,f=function(Be){return Be<=Z?Z:Be>=W?W:Be}),r.$$.dirty[0]&56|r.$$.dirty[1]&524288&&o(49,m=function(Be){if(Be<=Z)return on(Z);if(Be>=W)return on(W);Be=on(Be);let Yt=(Be-Z)%Q,zi=Be-Yt;return Math.abs(Yt)*2>=Q&&(zi+=Yt>0?Q:-Q),zi=f(zi),on(zi)}),r.$$.dirty[0]&24&&o(24,c=function(Be){let Yt=(Be-Z)/(W-Z)*100;return isNaN(Yt)||Yt<=0?0:Yt>=100?100:on(Yt)}),r.$$.dirty[0]&29360153|r.$$.dirty[1]&458752){Array.isArray(re)||(o(0,re=[(W+Z)/2]),console.error("'values' prop should be an Array (https://github.com/simeydotme/svelte-range-slider-pips#slider-props)"));const Be=er(re.map(Yt=>m(Yt)));(re.length!==Be.length||!re.every((Yt,zi)=>on(Yt)===Be[zi]))&&o(0,re=Be),ai!==re.length?P(o(23,at=dB(re.map(Yt=>c(Yt)),yi))):at.set(re.map(Yt=>c(Yt))),o(48,ai=re.length),re.length>1&&!Array.isArray(Di)&&console.warn("'ariaLabels' prop should be an Array (https://github.com/simeydotme/svelte-range-slider-pips#slider-props)")}r.$$.dirty[0]&320&&o(29,_=ie?pe?"top":"bottom":pe?"right":"left"),r.$$.dirty[0]&320&&o(28,v=ie?pe?"bottom":"top":pe?"left":"right")},[re,z,F,Z,W,Q,ie,ve,pe,ke,Me,Ye,ot,Mt,Se,yt,_t,Ze,Tt,Zt,ni,ui,Di,at,c,nt,Ii,rn,v,_,s,on,Re,ee,ce,Te,it,tt,Et,Dt,Ke,Vt,Ct,zt,Fi,U,ft,yi,ai,m,f,pn]}class _j extends jr{constructor(i){super(),Vr(this,i,_B,gB,kr,{slider:1,range:2,pushy:45,min:3,max:4,step:5,values:0,vertical:6,float:7,reversed:8,hoverable:9,disabled:10,pips:11,pipstep:12,all:13,first:14,last:15,rest:16,id:17,prefix:18,suffix:19,formatter:20,handleFormatter:21,ariaLabels:22,precision:46,springValues:47},null,[-1,-1,-1])}}function PE(r){let i,o,c=("00"+r[0].getHours()).slice(-2)+"",f,m,_,v=("00"+r[0].getMinutes()).slice(-2)+"",s,S,P,z,F=r[1]!=="minute"&&DE(r);return{c(){i=ci("div"),o=ci("span"),f=In(c),m=In(`:
		`),_=ci("span"),s=In(v),S=Kn(),F&&F.c(),this.h()},l(U){i=_i(U,"DIV",{class:!0,role:!0});var Z=Xe(i);o=_i(Z,"SPAN",{role:!0,"aria-label":!0,tabindex:!0,contenteditable:!0,inputmode:!0,class:!0});var W=Xe(o);f=Bn(W,c),W.forEach(Ee),m=Bn(Z,`:
		`),_=_i(Z,"SPAN",{role:!0,"aria-label":!0,tabindex:!0,contenteditable:!0,inputmode:!0,class:!0});var Q=Xe(_);s=Bn(Q,v),Q.forEach(Ee),S=Jn(Z),F&&F.l(Z),Z.forEach(Ee),this.h()},h(){ge(o,"role","spinbutton"),ge(o,"aria-label","Hours"),ge(o,"tabindex","0"),ge(o,"contenteditable",""),ge(o,"inputmode","numeric"),ge(o,"class","svelte-132npca"),ge(_,"role","spinbutton"),ge(_,"aria-label","Minutes"),ge(_,"tabindex","0"),ge(_,"contenteditable",""),ge(_,"inputmode","numeric"),ge(_,"class","svelte-132npca"),ge(i,"class","time-picker svelte-132npca"),ge(i,"role","none")},m(U,Z){oi(U,i,Z),He(i,o),He(o,f),r[6](o),He(i,m),He(i,_),He(_,s),r[7](_),He(i,S),F&&F.m(i,null),P||(z=[pt(o,"keydown",r[3]),pt(o,"input",r[4]),pt(o,"focus",t_),pt(_,"keydown",r[3]),pt(_,"input",r[4]),pt(_,"focus",t_),pt(i,"mousedown",r[10])],P=!0)},p(U,Z){Z&1&&c!==(c=("00"+U[0].getHours()).slice(-2)+"")&&Rg(f,c),Z&1&&v!==(v=("00"+U[0].getMinutes()).slice(-2)+"")&&Rg(s,v),U[1]!=="minute"?F?F.p(U,Z):(F=DE(U),F.c(),F.m(i,null)):F&&(F.d(1),F=null)},d(U){U&&Ee(i),r[6](null),r[7](null),F&&F.d(),P=!1,Qn(z)}}}function DE(r){let i,o,c=("00"+r[0].getSeconds()).slice(-2)+"",f,m,_,v,s,S=r[1]!=="second"&&zE(r);return{c(){i=In(":"),o=ci("span"),f=In(c),m=Kn(),S&&S.c(),_=Sn(),this.h()},l(P){i=Bn(P,":"),o=_i(P,"SPAN",{role:!0,"aria-label":!0,tabindex:!0,contenteditable:!0,inputmode:!0,class:!0});var z=Xe(o);f=Bn(z,c),z.forEach(Ee),m=Jn(P),S&&S.l(P),_=Sn(),this.h()},h(){ge(o,"role","spinbutton"),ge(o,"aria-label","Seconds"),ge(o,"tabindex","0"),ge(o,"contenteditable",""),ge(o,"inputmode","numeric"),ge(o,"class","svelte-132npca")},m(P,z){oi(P,i,z),oi(P,o,z),He(o,f),r[8](o),oi(P,m,z),S&&S.m(P,z),oi(P,_,z),v||(s=[pt(o,"keydown",r[3]),pt(o,"input",r[4]),pt(o,"focus",t_)],v=!0)},p(P,z){z&1&&c!==(c=("00"+P[0].getSeconds()).slice(-2)+"")&&Rg(f,c),P[1]!=="second"?S?S.p(P,z):(S=zE(P),S.c(),S.m(_.parentNode,_)):S&&(S.d(1),S=null)},d(P){P&&(Ee(i),Ee(o),Ee(m),Ee(_)),r[8](null),S&&S.d(P),v=!1,Qn(s)}}}function zE(r){let i,o,c=("000"+r[0].getMilliseconds()).slice(-3)+"",f,m,_;return{c(){i=In("."),o=ci("span"),f=In(c),this.h()},l(v){i=Bn(v,"."),o=_i(v,"SPAN",{role:!0,"aria-label":!0,tabindex:!0,contenteditable:!0,inputmode:!0,class:!0});var s=Xe(o);f=Bn(s,c),s.forEach(Ee),this.h()},h(){ge(o,"role","spinbutton"),ge(o,"aria-label","Milliseconds"),ge(o,"tabindex","0"),ge(o,"contenteditable",""),ge(o,"inputmode","numeric"),ge(o,"class","svelte-132npca")},m(v,s){oi(v,i,s),oi(v,o,s),He(o,f),r[9](o),m||(_=[pt(o,"keydown",r[3]),pt(o,"input",r[4]),pt(o,"focus",t_)],m=!0)},p(v,s){s&1&&c!==(c=("000"+v[0].getMilliseconds()).slice(-3)+"")&&Rg(f,c)},d(v){v&&(Ee(i),Ee(o)),r[9](null),m=!1,Qn(_)}}}function yB(r){let i,o=r[1]&&PE(r);return{c(){o&&o.c(),i=Sn()},l(c){o&&o.l(c),i=Sn()},m(c,f){o&&o.m(c,f),oi(c,i,f)},p(c,[f]){c[1]?o?o.p(c,f):(o=PE(c),o.c(),o.m(i.parentNode,i)):o&&(o.d(1),o=null)},i:ln,o:ln,d(c){c&&Ee(i),o&&o.d(c)}}}function Cg(r){const i=window.getSelection(),o=document.createRange();o.selectNodeContents(r),i==null||i.removeAllRanges(),i==null||i.addRange(o)}function xB(r,i,o){return o&&r<0?i:o&&r>i?0:Math.max(0,Math.min(i,r))}function px(r){const i=r.getAttribute("aria-label");if(i==="Hours")return{label:i,len:2,max:23};if(i==="Minutes")return{label:i,len:2,max:59};if(i==="Seconds")return{label:i,len:2,max:59};if(i==="Milliseconds")return{label:i,len:3,max:999};throw new Error("Invalid label "+i)}function mx(r,i){return parseInt(r.replace(/[^\d]/g,"").slice(-i))}function t_(r){Cg(r.currentTarget)}function vB(r,i,o){let{browseDate:c}=i,{timePrecision:f}=i,{setTime:m}=i,_=[];function v(re){if(re.key==="ArrowUp"||re.key==="ArrowDown"){const ie=s(re.currentTarget),ve=re.key==="ArrowUp"?1:-1;P(re.currentTarget,ie+ve,!0),re.preventDefault(),Cg(re.currentTarget)}else if(re.key==="ArrowLeft"||re.key==="ArrowRight"||":;-,.".includes(re.key)){const ie=_.indexOf(re.currentTarget),ve=re.key==="ArrowLeft"?-1:1,pe=_[ie+ve];re.preventDefault(),pe&&(pe.focus(),Cg(pe))}}function s(re){const ie=px(re).label;return ie==="Hours"?c.getHours():ie==="Minutes"?c.getMinutes():ie==="Seconds"?c.getSeconds():c.getMilliseconds()}function S(re){const ie=("00"+re.getHours()).slice(-2),ve=("00"+re.getMinutes()).slice(-2),pe=("00"+re.getSeconds()).slice(-2),ke=("000"+re.getMilliseconds()).slice(-3);_[0]&&_[0].innerText!==ie&&o(2,_[0].innerText=ie,_),_[1]&&_[1].innerText!==ve&&o(2,_[1].innerText=ve,_),_[2]&&_[2].innerText!==pe&&o(2,_[2].innerText=pe,_),_[3]&&_[3].innerText!==ke&&o(2,_[3].innerText=ke,_)}function P(re,ie,ve=!1){const pe=px(re);ie=xB(ie,pe.max,ve),pe.label==="Hours"?c.setHours(ie):pe.label==="Minutes"?c.setMinutes(ie):pe.label==="Seconds"?c.setSeconds(ie):pe.label==="Milliseconds"&&c.setMilliseconds(ie),o(0,c=m(c)),S(c)}function z(re){const ie=re,ve=px(ie.currentTarget);let pe;if(ie.inputType==="insertText"){const ke="000"+s(ie.currentTarget);pe=mx(ke+ie.currentTarget.innerText,ve.len),pe>ve.max&&ie.data&&(pe=mx(ie.data,ve.len))}else pe=mx("000"+ie.currentTarget.innerText,ve.len);P(ie.currentTarget,pe),Cg(ie.currentTarget)}function F(re){_o[re?"unshift":"push"](()=>{_[0]=re,o(2,_)})}function U(re){_o[re?"unshift":"push"](()=>{_[1]=re,o(2,_)})}function Z(re){_o[re?"unshift":"push"](()=>{_[2]=re,o(2,_)})}function W(re){_o[re?"unshift":"push"](()=>{_[3]=re,o(2,_)})}const Q=re=>{re.target instanceof HTMLElement&&re.target.tagName==="SPAN"&&(re.target.focus(),re.preventDefault())};return r.$$set=re=>{"browseDate"in re&&o(0,c=re.browseDate),"timePrecision"in re&&o(1,f=re.timePrecision),"setTime"in re&&o(5,m=re.setTime)},r.$$.update=()=>{r.$$.dirty&1&&S(c)},[c,f,_,v,z,m,F,U,Z,W,Q]}class bB extends jr{constructor(i){super(),Vr(this,i,vB,yB,kr,{browseDate:0,timePrecision:1,setTime:5})}}function wB(r){return r%4===0&&r%100!==0||r%400===0}function Ff(r,i){return[31,wB(r)?29:28,31,30,31,30,31,31,30,31,30,31][i]}function LE(r,i){let o="";if(r)for(const c of i)typeof c=="string"?o+=c:o+=c.toString(r);return o}function gx(r,i){const o=Ff(r,i),c=[];for(let f=0;f<o;f++)c.push({year:r,month:i,number:f+1});return c}function TB(r,i){const o=r.getFullYear(),c=r.getMonth(),f=new Date(o,c,1).getDay();let m=[];const _=(f-i+7)%7;if(_>0){let P=c-1,z=o;P===-1&&(P=11,z=o-1),m=gx(z,P).slice(-_)}m=m.concat(gx(o,c));let v=c+1,s=o;v===12&&(v=0,s=o+1);const S=42-m.length;return m=m.concat(gx(s,v).slice(0,S)),m}function MB(){return{weekdays:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekStartsOn:1}}function SB(r={}){const i=MB();return typeof r.weekStartsOn=="number"&&(i.weekStartsOn=r.weekStartsOn),r.months&&(i.months=r.months),r.weekdays&&(i.weekdays=r.weekdays),i}function RE(r,i,o){const c=r.slice();return c[36]=i[o],c[38]=o,c}function OE(r,i,o){const c=r.slice();return c[39]=i[o],c}function BE(r,i,o){const c=r.slice();return c[36]=i[o],c[43]=o,c}function FE(r,i,o){const c=r.slice();return c[44]=i[o],c}function NE(r,i,o){const c=r.slice();return c[44]=i[o],c}function VE(r,i,o){const c=r.slice();return c[49]=i[o],c[43]=o,c}function jE(r,i,o){const c=r.slice();return c[49]=i[o],c[43]=o,c}function UE(r){let i,o=r[49]+"",c,f;return{c(){i=ci("option"),c=In(o),this.h()},l(m){i=_i(m,"OPTION",{});var _=Xe(i);c=Bn(_,o),_.forEach(Ee),this.h()},h(){i.disabled=f=new Date(r[9],r[43],Ff(r[9],r[43]),23,59,59,999)<r[2]||new Date(r[9],r[43])>r[3],i.__value=r[43],rh(i,i.__value)},m(m,_){oi(m,i,_),He(i,c)},p(m,_){_[0]&32&&o!==(o=m[49]+"")&&Sr(c,o),_[0]&588&&f!==(f=new Date(m[9],m[43],Ff(m[9],m[43]),23,59,59,999)<m[2]||new Date(m[9],m[43])>m[3])&&(i.disabled=f)},d(m){m&&Ee(i)}}}function GE(r){let i,o=r[49]+"",c,f;return{c(){i=ci("option"),c=In(o),this.h()},l(m){i=_i(m,"OPTION",{});var _=Xe(i);c=Bn(_,o),_.forEach(Ee),this.h()},h(){i.__value=r[43],rh(i,i.__value),i.selected=f=r[43]===r[8]},m(m,_){oi(m,i,_),He(i,c)},p(m,_){_[0]&32&&o!==(o=m[49]+"")&&Sr(c,o),_[0]&256&&f!==(f=m[43]===m[8])&&(i.selected=f)},d(m){m&&Ee(i)}}}function HE(r){let i,o=r[44]+"",c,f;return{c(){i=ci("option"),c=In(o),this.h()},l(m){i=_i(m,"OPTION",{});var _=Xe(i);c=Bn(_,o),_.forEach(Ee),this.h()},h(){i.__value=f=r[44],rh(i,i.__value)},m(m,_){oi(m,i,_),He(i,c)},p(m,_){_[0]&64&&o!==(o=m[44]+"")&&Sr(c,o),_[0]&64&&f!==(f=m[44])&&(i.__value=f,rh(i,i.__value))},d(m){m&&Ee(i)}}}function WE(r){let i,o=r[44]+"",c,f,m;return{c(){i=ci("option"),c=In(o),this.h()},l(_){i=_i(_,"OPTION",{});var v=Xe(i);c=Bn(v,o),v.forEach(Ee),this.h()},h(){i.__value=f=r[44],rh(i,i.__value),i.selected=m=r[44]===r[4].getFullYear()},m(_,v){oi(_,i,v),He(i,c)},p(_,v){v[0]&64&&o!==(o=_[44]+"")&&Sr(c,o),v[0]&64&&f!==(f=_[44])&&(i.__value=f,rh(i,i.__value)),v[0]&80&&m!==(m=_[44]===_[4].getFullYear())&&(i.selected=m)},d(_){_&&Ee(i)}}}function EB(r){let i,o=r[5].weekdays[r[5].weekStartsOn+r[43]-7]+"",c;return{c(){i=ci("div"),c=In(o),this.h()},l(f){i=_i(f,"DIV",{class:!0});var m=Xe(i);c=Bn(m,o),m.forEach(Ee),this.h()},h(){ge(i,"class","header-cell svelte-go79cf")},m(f,m){oi(f,i,m),He(i,c)},p(f,m){m[0]&32&&o!==(o=f[5].weekdays[f[5].weekStartsOn+f[43]-7]+"")&&Sr(c,o)},d(f){f&&Ee(i)}}}function AB(r){let i,o=r[5].weekdays[r[5].weekStartsOn+r[43]]+"",c;return{c(){i=ci("div"),c=In(o),this.h()},l(f){i=_i(f,"DIV",{class:!0});var m=Xe(i);c=Bn(m,o),m.forEach(Ee),this.h()},h(){ge(i,"class","header-cell svelte-go79cf")},m(f,m){oi(f,i,m),He(i,c)},p(f,m){m[0]&32&&o!==(o=f[5].weekdays[f[5].weekStartsOn+f[43]]+"")&&Sr(c,o)},d(f){f&&Ee(i)}}}function qE(r){let i;function o(m,_){return m[43]+m[5].weekStartsOn<7?AB:EB}let c=o(r),f=c(r);return{c(){f.c(),i=Sn()},l(m){f.l(m),i=Sn()},m(m,_){f.m(m,_),oi(m,i,_)},p(m,_){c===(c=o(m))&&f?f.p(m,_):(f.d(1),f=c(m),f&&(f.c(),f.m(i.parentNode,i)))},d(m){m&&Ee(i),f.d(m)}}}function ZE(r){let i,o,c=r[39].number+"",f,m,_;function v(){return r[27](r[39])}return{c(){i=ci("div"),o=ci("span"),f=In(c),this.h()},l(s){i=_i(s,"DIV",{class:!0});var S=Xe(i);o=_i(S,"SPAN",{class:!0});var P=Xe(o);f=Bn(P,c),P.forEach(Ee),S.forEach(Ee),this.h()},h(){ge(o,"class","svelte-go79cf"),ge(i,"class","cell svelte-go79cf"),fi(i,"disabled",!Xx(r[39],r[2],r[3])),fi(i,"selected",r[0]&&r[39].year===r[0].getFullYear()&&r[39].month===r[0].getMonth()&&r[39].number===r[0].getDate()),fi(i,"today",r[39].year===r[11].getFullYear()&&r[39].month===r[11].getMonth()&&r[39].number===r[11].getDate()),fi(i,"other-month",r[39].month!==r[8])},m(s,S){oi(s,i,S),He(i,o),He(o,f),m||(_=pt(i,"click",v),m=!0)},p(s,S){r=s,S[0]&128&&c!==(c=r[39].number+"")&&Sr(f,c),S[0]&140&&fi(i,"disabled",!Xx(r[39],r[2],r[3])),S[0]&129&&fi(i,"selected",r[0]&&r[39].year===r[0].getFullYear()&&r[39].month===r[0].getMonth()&&r[39].number===r[0].getDate()),S[0]&2176&&fi(i,"today",r[39].year===r[11].getFullYear()&&r[39].month===r[11].getMonth()&&r[39].number===r[11].getDate()),S[0]&384&&fi(i,"other-month",r[39].month!==r[8])},d(s){s&&Ee(i),m=!1,_()}}}function XE(r){let i,o=Ar(r[7].slice(r[38]*7,r[38]*7+7)),c=[];for(let f=0;f<o.length;f+=1)c[f]=ZE(OE(r,o,f));return{c(){i=ci("div");for(let f=0;f<c.length;f+=1)c[f].c();this.h()},l(f){i=_i(f,"DIV",{class:!0});var m=Xe(i);for(let _=0;_<c.length;_+=1)c[_].l(m);m.forEach(Ee),this.h()},h(){ge(i,"class","week svelte-go79cf")},m(f,m){oi(f,i,m);for(let _=0;_<c.length;_+=1)c[_]&&c[_].m(i,null)},p(f,m){if(m[0]&18829){o=Ar(f[7].slice(f[38]*7,f[38]*7+7));let _;for(_=0;_<o.length;_+=1){const v=OE(f,o,_);c[_]?c[_].p(v,m):(c[_]=ZE(v),c[_].c(),c[_].m(i,null))}for(;_<c.length;_+=1)c[_].d(1);c.length=o.length}},d(f){f&&Ee(i),Oa(c,f)}}}function IB(r){let i,o,c,f,m='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="svelte-go79cf"><path d="M5 3l3.057-3 11.943 12-11.943 12-3.057-3 9-9z" transform="rotate(180, 12, 12)"></path></svg>',_,v,s,S,P,z,F,U,Z,W,Q,re,ie,ve,pe,ke,Me,Ye,ot='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="svelte-go79cf"><path d="M5 3l3.057-3 11.943 12-11.943 12-3.057-3 9-9z"></path></svg>',Mt,Se,yt,_t,Ze,Tt,Zt,ni,ui,Di,ft=Ar(r[5].months),yi=[];for(let St=0;St<ft.length;St+=1)yi[St]=UE(jE(r,ft,St));let wi=Ar(r[5].months),ai=[];for(let St=0;St<wi.length;St+=1)ai[St]=GE(VE(r,wi,St));let nt=Ar(r[6]),Qe=[];for(let St=0;St<nt.length;St+=1)Qe[St]=HE(NE(r,nt,St));let Ii=Ar(r[6]),bi=[];for(let St=0;St<Ii.length;St+=1)bi[St]=WE(FE(r,Ii,St));let rn=Ar(Array(7)),Hi=[];for(let St=0;St<rn.length;St+=1)Hi[St]=qE(BE(r,rn,St));let Pn=Ar(Array(6)),at=[];for(let St=0;St<Pn.length;St+=1)at[St]=XE(RE(r,Pn,St));function on(St){r[28](St)}let $n={timePrecision:r[1],setTime:r[10]};r[4]!==void 0&&($n.browseDate=r[4]),Ze=new bB({props:$n}),_o.push(()=>ZA(Ze,"browseDate",on));const er=r[21].default,en=Uf(er,r,r[20],null);return{c(){i=ci("div"),o=ci("div"),c=ci("div"),f=ci("button"),f.innerHTML=m,_=Kn(),v=ci("div"),s=ci("select");for(let St=0;St<yi.length;St+=1)yi[St].c();S=Kn(),P=ci("select");for(let St=0;St<ai.length;St+=1)ai[St].c();z=Kn(),F=Pt("svg"),U=Pt("path"),Z=Kn(),W=ci("div"),Q=ci("select");for(let St=0;St<Qe.length;St+=1)Qe[St].c();re=Kn(),ie=ci("select");for(let St=0;St<bi.length;St+=1)bi[St].c();ve=Kn(),pe=Pt("svg"),ke=Pt("path"),Me=Kn(),Ye=ci("button"),Ye.innerHTML=ot,Mt=Kn(),Se=ci("div");for(let St=0;St<Hi.length;St+=1)Hi[St].c();yt=Kn();for(let St=0;St<at.length;St+=1)at[St].c();_t=Kn(),y_(Ze.$$.fragment),Zt=Kn(),en&&en.c(),this.h()},l(St){i=_i(St,"DIV",{class:!0,tabindex:!0});var si=Xe(i);o=_i(si,"DIV",{class:!0,tabindex:!0});var Re=Xe(o);c=_i(Re,"DIV",{class:!0});var ee=Xe(c);f=_i(ee,"BUTTON",{type:!0,class:!0,tabindex:!0,"data-svelte-h":!0}),MM(f)!=="svelte-t4cock"&&(f.innerHTML=m),_=Jn(ee),v=_i(ee,"DIV",{class:!0});var ce=Xe(v);s=_i(ce,"SELECT",{class:!0});var Te=Xe(s);for(let zt=0;zt<yi.length;zt+=1)yi[zt].l(Te);Te.forEach(Ee),S=Jn(ce),P=_i(ce,"SELECT",{class:!0,tabindex:!0});var it=Xe(P);for(let zt=0;zt<ai.length;zt+=1)ai[zt].l(it);it.forEach(Ee),z=Jn(ce),F=Rt(ce,"svg",{xmlns:!0,width:!0,height:!0,viewBox:!0,class:!0});var tt=Xe(F);U=Rt(tt,"path",{d:!0,transform:!0}),Xe(U).forEach(Ee),tt.forEach(Ee),ce.forEach(Ee),Z=Jn(ee),W=_i(ee,"DIV",{class:!0});var Et=Xe(W);Q=_i(Et,"SELECT",{class:!0});var Dt=Xe(Q);for(let zt=0;zt<Qe.length;zt+=1)Qe[zt].l(Dt);Dt.forEach(Ee),re=Jn(Et),ie=_i(Et,"SELECT",{class:!0,tabindex:!0});var Ke=Xe(ie);for(let zt=0;zt<bi.length;zt+=1)bi[zt].l(Ke);Ke.forEach(Ee),ve=Jn(Et),pe=Rt(Et,"svg",{xmlns:!0,width:!0,height:!0,viewBox:!0,class:!0});var Vt=Xe(pe);ke=Rt(Vt,"path",{d:!0,transform:!0}),Xe(ke).forEach(Ee),Vt.forEach(Ee),Et.forEach(Ee),Me=Jn(ee),Ye=_i(ee,"BUTTON",{type:!0,class:!0,tabindex:!0,"data-svelte-h":!0}),MM(Ye)!=="svelte-1a006lp"&&(Ye.innerHTML=ot),ee.forEach(Ee),Mt=Jn(Re),Se=_i(Re,"DIV",{class:!0});var Ct=Xe(Se);for(let zt=0;zt<Hi.length;zt+=1)Hi[zt].l(Ct);Ct.forEach(Ee),yt=Jn(Re);for(let zt=0;zt<at.length;zt+=1)at[zt].l(Re);_t=Jn(Re),x_(Ze.$$.fragment,Re),Zt=Jn(Re),en&&en.l(Re),Re.forEach(Ee),si.forEach(Ee),this.h()},h(){ge(f,"type","button"),ge(f,"class","page-button svelte-go79cf"),ge(f,"tabindex","-1"),ge(s,"class","svelte-go79cf"),ge(P,"class","dummy-select svelte-go79cf"),ge(P,"tabindex","-1"),ge(U,"d","M6 0l12 12-12 12z"),ge(U,"transform","rotate(90, 12, 12)"),ge(F,"xmlns","http://www.w3.org/2000/svg"),ge(F,"width","24"),ge(F,"height","24"),ge(F,"viewBox","0 0 24 24"),ge(F,"class","svelte-go79cf"),ge(v,"class","dropdown month svelte-go79cf"),ge(Q,"class","svelte-go79cf"),ge(ie,"class","dummy-select svelte-go79cf"),ge(ie,"tabindex","-1"),ge(ke,"d","M6 0l12 12-12 12z"),ge(ke,"transform","rotate(90, 12, 12)"),ge(pe,"xmlns","http://www.w3.org/2000/svg"),ge(pe,"width","24"),ge(pe,"height","24"),ge(pe,"viewBox","0 0 24 24"),ge(pe,"class","svelte-go79cf"),ge(W,"class","dropdown year svelte-go79cf"),ge(Ye,"type","button"),ge(Ye,"class","page-button svelte-go79cf"),ge(Ye,"tabindex","-1"),ge(c,"class","top svelte-go79cf"),ge(Se,"class","header svelte-go79cf"),ge(o,"class","tab-container svelte-go79cf"),ge(o,"tabindex","-1"),ge(i,"class","date-time-picker svelte-go79cf"),ge(i,"tabindex","0")},m(St,si){oi(St,i,si),He(i,o),He(o,c),He(c,f),He(c,_),He(c,v),He(v,s);for(let Re=0;Re<yi.length;Re+=1)yi[Re]&&yi[Re].m(s,null);Jm(s,r[8]),He(v,S),He(v,P);for(let Re=0;Re<ai.length;Re+=1)ai[Re]&&ai[Re].m(P,null);He(v,z),He(v,F),He(F,U),He(c,Z),He(c,W),He(W,Q);for(let Re=0;Re<Qe.length;Re+=1)Qe[Re]&&Qe[Re].m(Q,null);Jm(Q,r[9]),He(W,re),He(W,ie);for(let Re=0;Re<bi.length;Re+=1)bi[Re]&&bi[Re].m(ie,null);He(W,ve),He(W,pe),He(pe,ke),He(c,Me),He(c,Ye),He(o,Mt),He(o,Se);for(let Re=0;Re<Hi.length;Re+=1)Hi[Re]&&Hi[Re].m(Se,null);He(o,yt);for(let Re=0;Re<at.length;Re+=1)at[Re]&&at[Re].m(o,null);He(o,_t),qf(Ze,o,null),He(o,Zt),en&&en.m(o,null),ni=!0,ui||(Di=[pt(f,"click",r[23]),pt(s,"keydown",r[16]),pt(s,"input",r[24]),pt(Q,"input",r[25]),pt(Q,"keydown",r[15]),pt(Ye,"click",r[26]),pt(i,"focusout",r[22]),pt(i,"keydown",r[17])],ui=!0)},p(St,si){if(si[0]&556){ft=Ar(St[5].months);let ee;for(ee=0;ee<ft.length;ee+=1){const ce=jE(St,ft,ee);yi[ee]?yi[ee].p(ce,si):(yi[ee]=UE(ce),yi[ee].c(),yi[ee].m(s,null))}for(;ee<yi.length;ee+=1)yi[ee].d(1);yi.length=ft.length}if((!ni||si[0]&256)&&Jm(s,St[8]),si[0]&288){wi=Ar(St[5].months);let ee;for(ee=0;ee<wi.length;ee+=1){const ce=VE(St,wi,ee);ai[ee]?ai[ee].p(ce,si):(ai[ee]=GE(ce),ai[ee].c(),ai[ee].m(P,null))}for(;ee<ai.length;ee+=1)ai[ee].d(1);ai.length=wi.length}if(si[0]&64){nt=Ar(St[6]);let ee;for(ee=0;ee<nt.length;ee+=1){const ce=NE(St,nt,ee);Qe[ee]?Qe[ee].p(ce,si):(Qe[ee]=HE(ce),Qe[ee].c(),Qe[ee].m(Q,null))}for(;ee<Qe.length;ee+=1)Qe[ee].d(1);Qe.length=nt.length}if((!ni||si[0]&576)&&Jm(Q,St[9]),si[0]&80){Ii=Ar(St[6]);let ee;for(ee=0;ee<Ii.length;ee+=1){const ce=FE(St,Ii,ee);bi[ee]?bi[ee].p(ce,si):(bi[ee]=WE(ce),bi[ee].c(),bi[ee].m(ie,null))}for(;ee<bi.length;ee+=1)bi[ee].d(1);bi.length=Ii.length}if(si[0]&32){rn=Ar(Array(7));let ee;for(ee=0;ee<rn.length;ee+=1){const ce=BE(St,rn,ee);Hi[ee]?Hi[ee].p(ce,si):(Hi[ee]=qE(ce),Hi[ee].c(),Hi[ee].m(Se,null))}for(;ee<Hi.length;ee+=1)Hi[ee].d(1);Hi.length=rn.length}if(si[0]&18829){Pn=Ar(Array(6));let ee;for(ee=0;ee<Pn.length;ee+=1){const ce=RE(St,Pn,ee);at[ee]?at[ee].p(ce,si):(at[ee]=XE(ce),at[ee].c(),at[ee].m(o,_t))}for(;ee<at.length;ee+=1)at[ee].d(1);at.length=Pn.length}const Re={};si[0]&2&&(Re.timePrecision=St[1]),!Tt&&si[0]&16&&(Tt=!0,Re.browseDate=St[4],WA(()=>Tt=!1)),Ze.$set(Re),en&&en.p&&(!ni||si[0]&1048576)&&Hf(en,er,St,St[20],ni?Gf(er,St[20],si,null):Wf(St[20]),null)},i(St){ni||(pr(Ze.$$.fragment,St),pr(en,St),ni=!0)},o(St){Nr(Ze.$$.fragment,St),Nr(en,St),ni=!1},d(St){St&&Ee(i),Oa(yi,St),Oa(ai,St),Oa(Qe,St),Oa(bi,St),Oa(Hi,St),Oa(at,St),Zf(Ze),en&&en.d(St),ui=!1,Qn(Di)}}}function Yo(r){return new Date(r.getTime())}function i_(r,i,o){return r>o?Yo(o):r<i?Yo(i):Yo(r)}function _x(r,i,o){const c=i_(r,i,o);return c.getTime()!==r.getTime()&&(r=new Date(c.getFullYear(),c.getMonth(),c.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()),r=i_(r,i,o)),r}function YE(r,i){let o=[];for(let c=r.getFullYear();c<=i.getFullYear();c++)o.push(c);return o}function Xx(r,i,o){const c=new Date(r.year,r.month,r.number),f=new Date(i.getFullYear(),i.getMonth(),i.getDate()),m=new Date(o.getFullYear(),o.getMonth(),o.getDate());return c>=f&&c<=m}function kB(r,i,o){let c,f,m,_,{$$slots:v={},$$scope:s}=i;const S=av();let{value:P=null}=i;function z(nt){nt.getTime()!==(P==null?void 0:P.getTime())&&(o(4,pe=i_(nt,ie,ve)),o(0,P=Yo(pe)))}function F(nt){nt.getTime()!==(P==null?void 0:P.getTime())&&(o(4,pe=_x(nt,ie,ve)),o(0,P=Yo(pe)))}function U(nt){o(4,pe=_x(nt,ie,ve)),!ot&&P&&z(pe)}function Z(nt){return o(4,pe=i_(nt,ie,ve)),P&&z(pe),pe}const W=new Date,Q=new Date;let{timePrecision:re=null}=i,{min:ie=new Date(Q.getFullYear()-20,0,1)}=i,{max:ve=new Date(Q.getFullYear(),11,31,23,59,59,999)}=i,pe=Yo(P||_x(Q,ie,ve));function ke(nt){pe.getTime()!==(nt==null?void 0:nt.getTime())&&o(4,pe=nt?Yo(nt):pe)}let Me=YE(ie,ve),{locale:Ye={}}=i,{browseWithoutSelecting:ot=!1}=i;function Mt(nt){pe.setFullYear(nt),U(pe)}function Se(nt){let Qe=pe.getFullYear();nt===12?(nt=0,Qe++):nt===-1&&(nt=11,Qe--);const Ii=Ff(Qe,nt),bi=Math.min(pe.getDate(),Ii);U(new Date(Qe,nt,bi,pe.getHours(),pe.getMinutes(),pe.getSeconds(),pe.getMilliseconds()))}function yt(nt){Xx(nt,ie,ve)&&(pe.setFullYear(0),pe.setMonth(0),pe.setDate(1),pe.setFullYear(nt.year),pe.setMonth(nt.month),pe.setDate(nt.number),F(pe),S("select",Yo(pe)))}function _t(nt){if(nt.shiftKey&&nt.key==="ArrowUp")Mt(pe.getFullYear()-1);else if(nt.shiftKey&&nt.key==="ArrowDown")Mt(pe.getFullYear()+1);else if(nt.shiftKey&&nt.key==="ArrowLeft")Se(pe.getMonth()-1);else if(nt.shiftKey&&nt.key==="ArrowRight")Se(pe.getMonth()+1);else return!1;return nt.preventDefault(),!0}function Ze(nt){if(nt.shiftKey||nt.altKey){_t(nt);return}else if(nt.key==="ArrowUp")Mt(pe.getFullYear()-1);else if(nt.key==="ArrowDown")Mt(pe.getFullYear()+1);else if(nt.key==="ArrowLeft")Se(pe.getMonth()-1);else if(nt.key==="ArrowRight")Se(pe.getMonth()+1);else{_t(nt);return}nt.preventDefault()}function Tt(nt){if(nt.shiftKey||nt.altKey){_t(nt);return}else if(nt.key==="ArrowUp"||nt.key==="ArrowLeft")Se(pe.getMonth()-1);else if(nt.key==="ArrowDown"||nt.key==="ArrowRight")Se(pe.getMonth()+1);else{_t(nt);return}nt.preventDefault()}function Zt(nt){var Ii,bi;let Qe=nt.shiftKey||nt.altKey;if(!(((Ii=nt.target)==null?void 0:Ii.tagName)==="SELECT"||((bi=nt.target)==null?void 0:bi.tagName)==="SPAN")){if(Qe){_t(nt);return}else if(nt.key==="ArrowUp")pe.setDate(pe.getDate()-7),F(pe);else if(nt.key==="ArrowDown")pe.setDate(pe.getDate()+7),F(pe);else if(nt.key==="ArrowLeft")pe.setDate(pe.getDate()-1),F(pe);else if(nt.key==="ArrowRight")pe.setDate(pe.getDate()+1),F(pe);else if(nt.key==="Enter")z(pe),S("select",Yo(pe));else return;nt.preventDefault()}}function ni(nt){ii.call(this,r,nt)}const ui=()=>Se(pe.getMonth()-1),Di=nt=>Se(parseInt(nt.currentTarget.value)),ft=nt=>Mt(parseInt(nt.currentTarget.value)),yi=()=>Se(pe.getMonth()+1),wi=nt=>yt(nt);function ai(nt){pe=nt,o(4,pe)}return r.$$set=nt=>{"value"in nt&&o(0,P=nt.value),"timePrecision"in nt&&o(1,re=nt.timePrecision),"min"in nt&&o(2,ie=nt.min),"max"in nt&&o(3,ve=nt.max),"locale"in nt&&o(18,Ye=nt.locale),"browseWithoutSelecting"in nt&&o(19,ot=nt.browseWithoutSelecting),"$$scope"in nt&&o(20,s=nt.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&13&&(P&&P>ve?z(ve):P&&P<ie&&z(ie)),r.$$.dirty[0]&1&&ke(P),r.$$.dirty[0]&12&&o(6,Me=YE(ie,ve)),r.$$.dirty[0]&262144&&o(5,c=SB(Ye)),r.$$.dirty[0]&16&&o(9,f=pe.getFullYear()),r.$$.dirty[0]&16&&o(8,m=pe.getMonth()),r.$$.dirty[0]&48&&o(7,_=TB(pe,c.weekStartsOn))},[P,re,ie,ve,pe,c,Me,_,m,f,Z,W,Mt,Se,yt,Ze,Tt,Zt,Ye,ot,s,v,ni,ui,Di,ft,yi,wi,ai]}class CB extends jr{constructor(i){super(),Vr(this,i,kB,IB,kr,{value:0,timePrecision:1,min:2,max:3,locale:18,browseWithoutSelecting:19},null,[-1,-1])}}function PB(r,{delay:i=0,duration:o=400,easing:c=_k,amount:f=5,opacity:m=0}={}){const _=getComputedStyle(r),v=+_.opacity,s=_.filter==="none"?"":_.filter,S=v*(1-m),[P,z]=Tx(f);return{delay:i,duration:o,easing:c,css:(F,U)=>`opacity: ${v-S*U}; filter: ${s} blur(${U*P}${z});`}}function DB(r,{delay:i=0,duration:o=400,easing:c=PA}={}){const f=+getComputedStyle(r).opacity;return{delay:i,duration:o,easing:c,css:m=>`opacity: ${m*f}`}}function xk(r,{delay:i=0,duration:o=400,easing:c=yk,x:f=0,y:m=0,opacity:_=0}={}){const v=getComputedStyle(r),s=+v.opacity,S=v.transform==="none"?"":v.transform,P=s*(1-_),[z,F]=Tx(f),[U,Z]=Tx(m);return{delay:i,duration:o,easing:c,css:(W,Q)=>`
			transform: ${S} translate(${(1-W)*z}${F}, ${(1-W)*U}${Z});
			opacity: ${s-P*Q}`}}function zB(r,{delay:i=0,duration:o=400,easing:c=yk,axis:f="y"}={}){const m=getComputedStyle(r),_=+m.opacity,v=f==="y"?"height":"width",s=parseFloat(m[v]),S=f==="y"?["top","bottom"]:["left","right"],P=S.map(re=>`${re[0].toUpperCase()}${re.slice(1)}`),z=parseFloat(m[`padding${P[0]}`]),F=parseFloat(m[`padding${P[1]}`]),U=parseFloat(m[`margin${P[0]}`]),Z=parseFloat(m[`margin${P[1]}`]),W=parseFloat(m[`border${P[0]}Width`]),Q=parseFloat(m[`border${P[1]}Width`]);return{delay:i,duration:o,easing:c,css:re=>`overflow: hidden;opacity: ${Math.min(re*20,1)*_};${v}: ${re*s}px;padding-${S[0]}: ${re*z}px;padding-${S[1]}: ${re*F}px;margin-${S[0]}: ${re*U}px;margin-${S[1]}: ${re*Z}px;border-${S[0]}-width: ${re*W}px;border-${S[1]}-width: ${re*Q}px;`}}function KE(r,i,o){let c="",f=!0;o=o||new Date(2020,0,1,0,0,0,0);let m=o.getFullYear(),_=o.getMonth(),v=o.getDate(),s=o.getHours(),S=o.getMinutes(),P=o.getSeconds();const z=o.getMilliseconds();function F(Q){for(let re=0;re<Q.length;re++)if(r.startsWith(Q[re]))r=r.slice(1);else{f=!1,r.length===0&&(c=Q.slice(re));return}}function U(Q,re,ie){const ve=r.match(Q);if(ve!=null&&ve[0]){r=r.slice(ve[0].length);const pe=parseInt(ve[0]);return pe>ie||pe<re?(f=!1,null):pe}else return f=!1,null}function Z(Q){if(typeof Q=="string")F(Q);else if(Q.id==="yy"){const re=U(/^[0-9]{2}/,0,99);re!==null&&(m=2e3+re)}else if(Q.id==="yyyy"){const re=U(/^[0-9]{4}/,0,9999);re!==null&&(m=re)}else if(Q.id==="MM"){const re=U(/^[0-9]{2}/,1,12);re!==null&&(_=re-1)}else if(Q.id==="dd"){const re=U(/^[0-9]{2}/,1,31);re!==null&&(v=re)}else if(Q.id==="HH"){const re=U(/^[0-9]{2}/,0,23);re!==null&&(s=re)}else if(Q.id==="mm"){const re=U(/^[0-9]{2}/,0,59);re!==null&&(S=re)}else if(Q.id==="ss"){const re=U(/^[0-9]{2}/,0,59);re!==null&&(P=re)}}for(const Q of i)if(Z(Q),!f)break;const W=Ff(m,_);return v>W&&(f=!1),{date:f?new Date(m,_,v,s,S,P,z):null,missingPunctuation:c}}function sf(r){return("0"+r.toString()).slice(-2)}const LB=[{id:"yyyy",toString:r=>r.getFullYear().toString()},{id:"yy",toString:r=>r.getFullYear().toString().slice(-2)},{id:"MM",toString:r=>sf(r.getMonth()+1)},{id:"dd",toString:r=>sf(r.getDate())},{id:"HH",toString:r=>sf(r.getHours())},{id:"mm",toString:r=>sf(r.getMinutes())},{id:"ss",toString:r=>sf(r.getSeconds())}];function RB(r){for(const i of LB)if(r.startsWith(i.id))return i}function JE(r){const i=[];for(;r.length>0;){const o=RB(r);o?(i.push(o),r=r.slice(o.id.length)):typeof i[i.length-1]=="string"?(i[i.length-1]+=r[0],r=r.slice(1)):(i.push(r[0]),r=r.slice(1))}return i}function QE(r){let i,o,c,f,m=`${r[18]}px`,_;function v(S){r[34](S)}let s={min:r[3],max:r[4],locale:r[10],browseWithoutSelecting:r[11],timePrecision:r[12],$$slots:{default:[OB]},$$scope:{ctx:r}};return r[14]!==void 0&&(s.value=r[14]),o=new CB({props:s}),_o.push(()=>ZA(o,"value",v)),o.$on("focusout",r[21]),o.$on("select",r[23]),{c(){i=ci("div"),y_(o.$$.fragment),this.h()},l(S){i=_i(S,"DIV",{class:!0});var P=Xe(i);x_(o.$$.fragment,P),P.forEach(Ee),this.h()},h(){ge(i,"class","picker svelte-1vabmef"),fi(i,"visible",r[2]),fi(i,"above",r[17]),EM(i,"--picker-left-position",m)},m(S,P){oi(S,i,P),qf(o,i,null),r[35](i),_=!0},p(S,P){const z={};P[0]&8&&(z.min=S[3]),P[0]&16&&(z.max=S[4]),P[0]&1024&&(z.locale=S[10]),P[0]&2048&&(z.browseWithoutSelecting=S[11]),P[0]&4096&&(z.timePrecision=S[12]),P[1]&32&&(z.$$scope={dirty:P,ctx:S}),!c&&P[0]&16384&&(c=!0,z.value=S[14],WA(()=>c=!1)),o.$set(z),(!_||P[0]&4)&&fi(i,"visible",S[2]),(!_||P[0]&131072)&&fi(i,"above",S[17]),P[0]&262144&&m!==(m=`${S[18]}px`)&&EM(i,"--picker-left-position",m)},i(S){_||(pr(o.$$.fragment,S),S&&sh(()=>{_&&(f||(f=Fg(i,r[24],{},!0)),f.run(1))}),_=!0)},o(S){Nr(o.$$.fragment,S),S&&(f||(f=Fg(i,r[24],{},!1)),f.run(0)),_=!1},d(S){S&&Ee(i),Zf(o),r[35](null),S&&f&&f.end()}}}function OB(r){let i;const o=r[29].default,c=Uf(o,r,r[36],null);return{c(){c&&c.c()},l(f){c&&c.l(f)},m(f,m){c&&c.m(f,m),i=!0},p(f,m){c&&c.p&&(!i||m[1]&32)&&Hf(c,o,f,f[36],i?Gf(o,f[36],m,null):Wf(f[36]),null)},i(f){i||(pr(c,f),i=!0)},o(f){Nr(c,f),i=!1},d(f){c&&c.d(f)}}}function BB(r){let i,o,c,f,m,_,v,s=r[2]&&!r[7]&&QE(r);return{c(){i=ci("div"),o=ci("input"),c=Kn(),s&&s.c(),this.h()},l(S){i=_i(S,"DIV",{class:!0});var P=Xe(i);o=_i(P,"INPUT",{type:!0,id:!0,placeholder:!0,class:!0}),c=Jn(P),s&&s.l(P),P.forEach(Ee),this.h()},h(){ge(o,"type","text"),o.value=r[0],ge(o,"id",r[5]),ge(o,"placeholder",r[6]),o.disabled=r[7],o.required=r[8],ge(o,"class","svelte-1vabmef"),fi(o,"invalid",!r[1]),ge(i,"class",f="date-time-field "+r[9]+" svelte-1vabmef")},m(S,P){oi(S,i,P),He(i,o),r[30](o),He(i,c),s&&s.m(i,null),m=!0,_||(v=[pt(o,"focus",r[31]),pt(o,"mousedown",r[32]),pt(o,"input",r[33]),pt(i,"focusout",r[21]),pt(i,"keydown",r[22])],_=!0)},p(S,P){(!m||P[0]&1&&o.value!==S[0])&&(o.value=S[0]),(!m||P[0]&32)&&ge(o,"id",S[5]),(!m||P[0]&64)&&ge(o,"placeholder",S[6]),(!m||P[0]&128)&&(o.disabled=S[7]),(!m||P[0]&256)&&(o.required=S[8]),(!m||P[0]&2)&&fi(o,"invalid",!S[1]),S[2]&&!S[7]?s?(s.p(S,P),P[0]&132&&pr(s,1)):(s=QE(S),s.c(),pr(s,1),s.m(i,null)):s&&(g_(),Nr(s,1,1,()=>{s=null}),__()),(!m||P[0]&512&&f!==(f="date-time-field "+S[9]+" svelte-1vabmef"))&&ge(i,"class",f)},i(S){m||(pr(s),m=!0)},o(S){Nr(s),m=!1},d(S){S&&Ee(i),r[30](null),s&&s.d(),_=!1,Qn(v)}}}function FB(r,i,o){let c,f,{$$slots:m={},$$scope:_}=i;const v=av(),s=new Date,S=Xf(null);wx(r,S,at=>o(37,f=at));const P={subscribe:S.subscribe,set:at=>{at==null?(S.set(null),o(25,z=at)):at.getTime()!==(f==null?void 0:f.getTime())&&(S.set(at),o(25,z=at))}};wx(r,P,at=>o(14,c=at));let{value:z=null}=i,{min:F=new Date(s.getFullYear()-20,0,1)}=i,{max:U=new Date(s.getFullYear(),11,31,23,59,59,999)}=i,{id:Z=null}=i,{placeholder:W="2020-12-31 23:00:00"}=i,{valid:Q=!0}=i,{disabled:re=!1}=i,{required:ie=!1}=i,{class:ve=""}=i,{format:pe="yyyy-MM-dd HH:mm:ss"}=i,ke=JE(pe),{locale:Me={}}=i;function Ye(at,on){o(0,ot=LE(at,on))}let{text:ot=LE(c,ke)}=i;function Mt(at,on){if(at.length){const $n=KE(at,on,c);$n.date!==null?(o(1,Q=!0),P.set($n.date)):o(1,Q=!1)}else o(1,Q=!0),z&&(o(25,z=null),P.set(null))}let{visible:Se=!1}=i,{closeOnSelection:yt=!1}=i,{browseWithoutSelecting:_t=!1}=i,{timePrecision:Ze=null}=i;function Tt(at){(at==null?void 0:at.currentTarget)instanceof HTMLElement&&at.relatedTarget&&at.relatedTarget instanceof Node&&at.currentTarget.contains(at.relatedTarget)||o(2,Se=!1)}function Zt(at){at.key==="Escape"&&Se?(o(2,Se=!1),at.preventDefault(),at.stopPropagation()):at.key==="Enter"&&(o(2,Se=!Se),at.preventDefault())}function ni(at){v("select",at.detail),yt&&o(2,Se=!1)}let{dynamicPositioning:ui=!1}=i,Di,ft,yi=!1,wi=null;function ai(){if(o(17,yi=!1),o(18,wi=null),Se&&ft&&ui){const at=Di.getBoundingClientRect(),on=ft.offsetWidth-at.width,$n=at.bottom+ft.offsetHeight+5,er=at.left+ft.offsetWidth+5;if($n>window.innerHeight&&o(17,yi=!0),er>window.innerWidth&&(o(18,wi=-on),at.left<on+5)){const St=window.innerWidth/2-ft.offsetWidth/2;o(18,wi=St-at.left)}}}function nt(at){return ai(),xk(at,{duration:200,easing:_k,y:yi?5:-5})}function Qe(at){_o[at?"unshift":"push"](()=>{Di=at,o(15,Di)})}const Ii=()=>o(2,Se=!0),bi=()=>o(2,Se=!0),rn=at=>{if(at instanceof InputEvent&&at.inputType==="insertText"&&typeof at.data=="string"&&at.currentTarget.value===ot+at.data){let on=KE(ot,ke,c);if(on.missingPunctuation!==""&&!on.missingPunctuation.startsWith(at.data)){o(0,ot=ot+on.missingPunctuation+at.data);return}}o(0,ot=at.currentTarget.value)};function Hi(at){c=at,P.set(c)}function Pn(at){_o[at?"unshift":"push"](()=>{ft=at,o(16,ft)})}return r.$$set=at=>{"value"in at&&o(25,z=at.value),"min"in at&&o(3,F=at.min),"max"in at&&o(4,U=at.max),"id"in at&&o(5,Z=at.id),"placeholder"in at&&o(6,W=at.placeholder),"valid"in at&&o(1,Q=at.valid),"disabled"in at&&o(7,re=at.disabled),"required"in at&&o(8,ie=at.required),"class"in at&&o(9,ve=at.class),"format"in at&&o(26,pe=at.format),"locale"in at&&o(10,Me=at.locale),"text"in at&&o(0,ot=at.text),"visible"in at&&o(2,Se=at.visible),"closeOnSelection"in at&&o(27,yt=at.closeOnSelection),"browseWithoutSelecting"in at&&o(11,_t=at.browseWithoutSelecting),"timePrecision"in at&&o(12,Ze=at.timePrecision),"dynamicPositioning"in at&&o(28,ui=at.dynamicPositioning),"$$scope"in at&&o(36,_=at.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&33554432&&P.set(z),r.$$.dirty[0]&67108864&&o(13,ke=JE(pe)),r.$$.dirty[0]&24576&&Ye(c,ke),r.$$.dirty[0]&8193&&Mt(ot,ke)},[ot,Q,Se,F,U,Z,W,re,ie,ve,Me,_t,Ze,ke,c,Di,ft,yi,wi,S,P,Tt,Zt,ni,nt,z,pe,yt,ui,m,Qe,Ii,bi,rn,Hi,Pn,_]}class yj extends jr{constructor(i){super(),Vr(this,i,FB,BB,kr,{value:25,min:3,max:4,id:5,placeholder:6,valid:1,disabled:7,required:8,class:9,format:26,locale:10,text:0,visible:2,closeOnSelection:27,browseWithoutSelecting:11,timePrecision:12,dynamicPositioning:28},null,[-1,-1])}}const Rv="-";function NB(r){const i=jB(r),{conflictingClassGroups:o,conflictingClassGroupModifiers:c}=r;function f(_){const v=_.split(Rv);return v[0]===""&&v.length!==1&&v.shift(),vk(v,i)||VB(_)}function m(_,v){const s=o[_]||[];return v&&c[_]?[...s,...c[_]]:s}return{getClassGroupId:f,getConflictingClassGroupIds:m}}function vk(r,i){var _;if(r.length===0)return i.classGroupId;const o=r[0],c=i.nextPart.get(o),f=c?vk(r.slice(1),c):void 0;if(f)return f;if(i.validators.length===0)return;const m=r.join(Rv);return(_=i.validators.find(({validator:v})=>v(m)))==null?void 0:_.classGroupId}const $E=/^\[(.+)\]$/;function VB(r){if($E.test(r)){const i=$E.exec(r)[1],o=i==null?void 0:i.substring(0,i.indexOf(":"));if(o)return"arbitrary.."+o}}function jB(r){const{theme:i,prefix:o}=r,c={nextPart:new Map,validators:[]};return GB(Object.entries(r.classGroups),o).forEach(([m,_])=>{Yx(_,c,m,i)}),c}function Yx(r,i,o,c){r.forEach(f=>{if(typeof f=="string"){const m=f===""?i:eA(i,f);m.classGroupId=o;return}if(typeof f=="function"){if(UB(f)){Yx(f(c),i,o,c);return}i.validators.push({validator:f,classGroupId:o});return}Object.entries(f).forEach(([m,_])=>{Yx(_,eA(i,m),o,c)})})}function eA(r,i){let o=r;return i.split(Rv).forEach(c=>{o.nextPart.has(c)||o.nextPart.set(c,{nextPart:new Map,validators:[]}),o=o.nextPart.get(c)}),o}function UB(r){return r.isThemeGetter}function GB(r,i){return i?r.map(([o,c])=>{const f=c.map(m=>typeof m=="string"?i+m:typeof m=="object"?Object.fromEntries(Object.entries(m).map(([_,v])=>[i+_,v])):m);return[o,f]}):r}function HB(r){if(r<1)return{get:()=>{},set:()=>{}};let i=0,o=new Map,c=new Map;function f(m,_){o.set(m,_),i++,i>r&&(i=0,c=o,o=new Map)}return{get(m){let _=o.get(m);if(_!==void 0)return _;if((_=c.get(m))!==void 0)return f(m,_),_},set(m,_){o.has(m)?o.set(m,_):f(m,_)}}}const bk="!";function WB(r){const i=r.separator,o=i.length===1,c=i[0],f=i.length;return function(_){const v=[];let s=0,S=0,P;for(let W=0;W<_.length;W++){let Q=_[W];if(s===0){if(Q===c&&(o||_.slice(W,W+f)===i)){v.push(_.slice(S,W)),S=W+f;continue}if(Q==="/"){P=W;continue}}Q==="["?s++:Q==="]"&&s--}const z=v.length===0?_:_.substring(S),F=z.startsWith(bk),U=F?z.substring(1):z,Z=P&&P>S?P-S:void 0;return{modifiers:v,hasImportantModifier:F,baseClassName:U,maybePostfixModifierPosition:Z}}}function qB(r){if(r.length<=1)return r;const i=[];let o=[];return r.forEach(c=>{c[0]==="["?(i.push(...o.sort(),c),o=[]):o.push(c)}),i.push(...o.sort()),i}function ZB(r){return{cache:HB(r.cacheSize),splitModifiers:WB(r),...NB(r)}}const XB=/\s+/;function YB(r,i){const{splitModifiers:o,getClassGroupId:c,getConflictingClassGroupIds:f}=i,m=new Set;return r.trim().split(XB).map(_=>{const{modifiers:v,hasImportantModifier:s,baseClassName:S,maybePostfixModifierPosition:P}=o(_);let z=c(P?S.substring(0,P):S),F=!!P;if(!z){if(!P)return{isTailwindClass:!1,originalClassName:_};if(z=c(S),!z)return{isTailwindClass:!1,originalClassName:_};F=!1}const U=qB(v).join(":");return{isTailwindClass:!0,modifierId:s?U+bk:U,classGroupId:z,originalClassName:_,hasPostfixModifier:F}}).reverse().filter(_=>{if(!_.isTailwindClass)return!0;const{modifierId:v,classGroupId:s,hasPostfixModifier:S}=_,P=v+s;return m.has(P)?!1:(m.add(P),f(s,S).forEach(z=>m.add(v+z)),!0)}).reverse().map(_=>_.originalClassName).join(" ")}function KB(){let r=0,i,o,c="";for(;r<arguments.length;)(i=arguments[r++])&&(o=wk(i))&&(c&&(c+=" "),c+=o);return c}function wk(r){if(typeof r=="string")return r;let i,o="";for(let c=0;c<r.length;c++)r[c]&&(i=wk(r[c]))&&(o&&(o+=" "),o+=i);return o}function JB(r,...i){let o,c,f,m=_;function _(s){const S=i.reduce((P,z)=>z(P),r());return o=ZB(S),c=o.cache.get,f=o.cache.set,m=v,v(s)}function v(s){const S=c(s);if(S)return S;const P=YB(s,o);return f(s,P),P}return function(){return m(KB.apply(null,arguments))}}function qn(r){const i=o=>o[r]||[];return i.isThemeGetter=!0,i}const Tk=/^\[(?:([a-z-]+):)?(.+)\]$/i,QB=/^\d+\/\d+$/,$B=new Set(["px","full","screen"]),eF=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,tF=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,iF=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,nF=/^-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,rF=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/;function Da(r){return Ac(r)||$B.has(r)||QB.test(r)}function wl(r){return mh(r,"length",dF)}function Ac(r){return!!r&&!Number.isNaN(Number(r))}function dg(r){return mh(r,"number",Ac)}function of(r){return!!r&&Number.isInteger(Number(r))}function sF(r){return r.endsWith("%")&&Ac(r.slice(0,-1))}function qi(r){return Tk.test(r)}function Tl(r){return eF.test(r)}const oF=new Set(["length","size","percentage"]);function aF(r){return mh(r,oF,Mk)}function lF(r){return mh(r,"position",Mk)}const cF=new Set(["image","url"]);function uF(r){return mh(r,cF,pF)}function hF(r){return mh(r,"",fF)}function af(){return!0}function mh(r,i,o){const c=Tk.exec(r);return c?c[1]?typeof i=="string"?c[1]===i:i.has(c[1]):o(c[2]):!1}function dF(r){return tF.test(r)&&!iF.test(r)}function Mk(){return!1}function fF(r){return nF.test(r)}function pF(r){return rF.test(r)}function mF(){const r=qn("colors"),i=qn("spacing"),o=qn("blur"),c=qn("brightness"),f=qn("borderColor"),m=qn("borderRadius"),_=qn("borderSpacing"),v=qn("borderWidth"),s=qn("contrast"),S=qn("grayscale"),P=qn("hueRotate"),z=qn("invert"),F=qn("gap"),U=qn("gradientColorStops"),Z=qn("gradientColorStopPositions"),W=qn("inset"),Q=qn("margin"),re=qn("opacity"),ie=qn("padding"),ve=qn("saturate"),pe=qn("scale"),ke=qn("sepia"),Me=qn("skew"),Ye=qn("space"),ot=qn("translate"),Mt=()=>["auto","contain","none"],Se=()=>["auto","hidden","clip","visible","scroll"],yt=()=>["auto",qi,i],_t=()=>[qi,i],Ze=()=>["",Da,wl],Tt=()=>["auto",Ac,qi],Zt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],ni=()=>["solid","dashed","dotted","double","none"],ui=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter"],Di=()=>["start","end","center","between","around","evenly","stretch"],ft=()=>["","0",qi],yi=()=>["auto","avoid","all","avoid-page","page","left","right","column"],wi=()=>[Ac,dg],ai=()=>[Ac,qi];return{cacheSize:500,separator:":",theme:{colors:[af],spacing:[Da,wl],blur:["none","",Tl,qi],brightness:wi(),borderColor:[r],borderRadius:["none","","full",Tl,qi],borderSpacing:_t(),borderWidth:Ze(),contrast:wi(),grayscale:ft(),hueRotate:ai(),invert:ft(),gap:_t(),gradientColorStops:[r],gradientColorStopPositions:[sF,wl],inset:yt(),margin:yt(),opacity:wi(),padding:_t(),saturate:wi(),scale:wi(),sepia:ft(),skew:ai(),space:_t(),translate:_t()},classGroups:{aspect:[{aspect:["auto","square","video",qi]}],container:["container"],columns:[{columns:[Tl]}],"break-after":[{"break-after":yi()}],"break-before":[{"break-before":yi()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Zt(),qi]}],overflow:[{overflow:Se()}],"overflow-x":[{"overflow-x":Se()}],"overflow-y":[{"overflow-y":Se()}],overscroll:[{overscroll:Mt()}],"overscroll-x":[{"overscroll-x":Mt()}],"overscroll-y":[{"overscroll-y":Mt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[W]}],"inset-x":[{"inset-x":[W]}],"inset-y":[{"inset-y":[W]}],start:[{start:[W]}],end:[{end:[W]}],top:[{top:[W]}],right:[{right:[W]}],bottom:[{bottom:[W]}],left:[{left:[W]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",of,qi]}],basis:[{basis:yt()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",qi]}],grow:[{grow:ft()}],shrink:[{shrink:ft()}],order:[{order:["first","last","none",of,qi]}],"grid-cols":[{"grid-cols":[af]}],"col-start-end":[{col:["auto",{span:["full",of,qi]},qi]}],"col-start":[{"col-start":Tt()}],"col-end":[{"col-end":Tt()}],"grid-rows":[{"grid-rows":[af]}],"row-start-end":[{row:["auto",{span:[of,qi]},qi]}],"row-start":[{"row-start":Tt()}],"row-end":[{"row-end":Tt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",qi]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",qi]}],gap:[{gap:[F]}],"gap-x":[{"gap-x":[F]}],"gap-y":[{"gap-y":[F]}],"justify-content":[{justify:["normal",...Di()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Di(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Di(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[ie]}],px:[{px:[ie]}],py:[{py:[ie]}],ps:[{ps:[ie]}],pe:[{pe:[ie]}],pt:[{pt:[ie]}],pr:[{pr:[ie]}],pb:[{pb:[ie]}],pl:[{pl:[ie]}],m:[{m:[Q]}],mx:[{mx:[Q]}],my:[{my:[Q]}],ms:[{ms:[Q]}],me:[{me:[Q]}],mt:[{mt:[Q]}],mr:[{mr:[Q]}],mb:[{mb:[Q]}],ml:[{ml:[Q]}],"space-x":[{"space-x":[Ye]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Ye]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",qi,i]}],"min-w":[{"min-w":[qi,i,"min","max","fit"]}],"max-w":[{"max-w":[qi,i,"none","full","min","max","fit","prose",{screen:[Tl]},Tl]}],h:[{h:[qi,i,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[qi,i,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[qi,i,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[qi,i,"auto","min","max","fit"]}],"font-size":[{text:["base",Tl,wl]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",dg]}],"font-family":[{font:[af]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",qi]}],"line-clamp":[{"line-clamp":["none",Ac,dg]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Da,qi]}],"list-image":[{"list-image":["none",qi]}],"list-style-type":[{list:["none","disc","decimal",qi]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[r]}],"placeholder-opacity":[{"placeholder-opacity":[re]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[r]}],"text-opacity":[{"text-opacity":[re]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...ni(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Da,wl]}],"underline-offset":[{"underline-offset":["auto",Da,qi]}],"text-decoration-color":[{decoration:[r]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:_t()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",qi]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",qi]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[re]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Zt(),lF]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",aF]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},uF]}],"bg-color":[{bg:[r]}],"gradient-from-pos":[{from:[Z]}],"gradient-via-pos":[{via:[Z]}],"gradient-to-pos":[{to:[Z]}],"gradient-from":[{from:[U]}],"gradient-via":[{via:[U]}],"gradient-to":[{to:[U]}],rounded:[{rounded:[m]}],"rounded-s":[{"rounded-s":[m]}],"rounded-e":[{"rounded-e":[m]}],"rounded-t":[{"rounded-t":[m]}],"rounded-r":[{"rounded-r":[m]}],"rounded-b":[{"rounded-b":[m]}],"rounded-l":[{"rounded-l":[m]}],"rounded-ss":[{"rounded-ss":[m]}],"rounded-se":[{"rounded-se":[m]}],"rounded-ee":[{"rounded-ee":[m]}],"rounded-es":[{"rounded-es":[m]}],"rounded-tl":[{"rounded-tl":[m]}],"rounded-tr":[{"rounded-tr":[m]}],"rounded-br":[{"rounded-br":[m]}],"rounded-bl":[{"rounded-bl":[m]}],"border-w":[{border:[v]}],"border-w-x":[{"border-x":[v]}],"border-w-y":[{"border-y":[v]}],"border-w-s":[{"border-s":[v]}],"border-w-e":[{"border-e":[v]}],"border-w-t":[{"border-t":[v]}],"border-w-r":[{"border-r":[v]}],"border-w-b":[{"border-b":[v]}],"border-w-l":[{"border-l":[v]}],"border-opacity":[{"border-opacity":[re]}],"border-style":[{border:[...ni(),"hidden"]}],"divide-x":[{"divide-x":[v]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[v]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[re]}],"divide-style":[{divide:ni()}],"border-color":[{border:[f]}],"border-color-x":[{"border-x":[f]}],"border-color-y":[{"border-y":[f]}],"border-color-t":[{"border-t":[f]}],"border-color-r":[{"border-r":[f]}],"border-color-b":[{"border-b":[f]}],"border-color-l":[{"border-l":[f]}],"divide-color":[{divide:[f]}],"outline-style":[{outline:["",...ni()]}],"outline-offset":[{"outline-offset":[Da,qi]}],"outline-w":[{outline:[Da,wl]}],"outline-color":[{outline:[r]}],"ring-w":[{ring:Ze()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[r]}],"ring-opacity":[{"ring-opacity":[re]}],"ring-offset-w":[{"ring-offset":[Da,wl]}],"ring-offset-color":[{"ring-offset":[r]}],shadow:[{shadow:["","inner","none",Tl,hF]}],"shadow-color":[{shadow:[af]}],opacity:[{opacity:[re]}],"mix-blend":[{"mix-blend":ui()}],"bg-blend":[{"bg-blend":ui()}],filter:[{filter:["","none"]}],blur:[{blur:[o]}],brightness:[{brightness:[c]}],contrast:[{contrast:[s]}],"drop-shadow":[{"drop-shadow":["","none",Tl,qi]}],grayscale:[{grayscale:[S]}],"hue-rotate":[{"hue-rotate":[P]}],invert:[{invert:[z]}],saturate:[{saturate:[ve]}],sepia:[{sepia:[ke]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[o]}],"backdrop-brightness":[{"backdrop-brightness":[c]}],"backdrop-contrast":[{"backdrop-contrast":[s]}],"backdrop-grayscale":[{"backdrop-grayscale":[S]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[P]}],"backdrop-invert":[{"backdrop-invert":[z]}],"backdrop-opacity":[{"backdrop-opacity":[re]}],"backdrop-saturate":[{"backdrop-saturate":[ve]}],"backdrop-sepia":[{"backdrop-sepia":[ke]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[_]}],"border-spacing-x":[{"border-spacing-x":[_]}],"border-spacing-y":[{"border-spacing-y":[_]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",qi]}],duration:[{duration:ai()}],ease:[{ease:["linear","in","out","in-out",qi]}],delay:[{delay:ai()}],animate:[{animate:["none","spin","ping","pulse","bounce",qi]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[pe]}],"scale-x":[{"scale-x":[pe]}],"scale-y":[{"scale-y":[pe]}],rotate:[{rotate:[of,qi]}],"translate-x":[{"translate-x":[ot]}],"translate-y":[{"translate-y":[ot]}],"skew-x":[{"skew-x":[Me]}],"skew-y":[{"skew-y":[Me]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",qi]}],accent:[{accent:["auto",r]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",qi]}],"caret-color":[{caret:[r]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":_t()}],"scroll-mx":[{"scroll-mx":_t()}],"scroll-my":[{"scroll-my":_t()}],"scroll-ms":[{"scroll-ms":_t()}],"scroll-me":[{"scroll-me":_t()}],"scroll-mt":[{"scroll-mt":_t()}],"scroll-mr":[{"scroll-mr":_t()}],"scroll-mb":[{"scroll-mb":_t()}],"scroll-ml":[{"scroll-ml":_t()}],"scroll-p":[{"scroll-p":_t()}],"scroll-px":[{"scroll-px":_t()}],"scroll-py":[{"scroll-py":_t()}],"scroll-ps":[{"scroll-ps":_t()}],"scroll-pe":[{"scroll-pe":_t()}],"scroll-pt":[{"scroll-pt":_t()}],"scroll-pr":[{"scroll-pr":_t()}],"scroll-pb":[{"scroll-pb":_t()}],"scroll-pl":[{"scroll-pl":_t()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",qi]}],fill:[{fill:[r,"none"]}],"stroke-w":[{stroke:[Da,wl,dg]}],stroke:[{stroke:[r,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}}const Qs=JB(mF);function gF(r){let i,o,c,f,m,_=[{xmlns:"http://www.w3.org/2000/svg"},{fill:"none"},r[7],{class:c=Qs("shrink-0",r[6][r[0]],r[8].class)},{role:r[1]},{"aria-label":r[5]},{viewBox:"0 0 24 24"}],v={};for(let s=0;s<_.length;s+=1)v=cn(v,_[s]);return{c(){i=Pt("svg"),o=Pt("path"),this.h()},l(s){i=Rt(s,"svg",{xmlns:!0,fill:!0,class:!0,role:!0,"aria-label":!0,viewBox:!0});var S=Xe(i);o=Rt(S,"path",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),Xe(o).forEach(Ee),S.forEach(Ee),this.h()},h(){ge(o,"stroke","currentColor"),ge(o,"stroke-linecap",r[2]),ge(o,"stroke-linejoin",r[3]),ge(o,"stroke-width",r[4]),ge(o,"d","M16 16.9V7a1 1 0 0 0-1.6-.8l-6 5a1 1 0 0 0 0 1.5l6 4.9a1 1 0 0 0 1.6-.8Z"),Qr(i,v)},m(s,S){oi(s,i,S),He(i,o),f||(m=[pt(i,"click",r[9]),pt(i,"keydown",r[10]),pt(i,"keyup",r[11]),pt(i,"focus",r[12]),pt(i,"blur",r[13]),pt(i,"mouseenter",r[14]),pt(i,"mouseleave",r[15]),pt(i,"mouseover",r[16]),pt(i,"mouseout",r[17])],f=!0)},p(s,[S]){S&4&&ge(o,"stroke-linecap",s[2]),S&8&&ge(o,"stroke-linejoin",s[3]),S&16&&ge(o,"stroke-width",s[4]),Qr(i,v=$s(_,[{xmlns:"http://www.w3.org/2000/svg"},{fill:"none"},S&128&&s[7],S&257&&c!==(c=Qs("shrink-0",s[6][s[0]],s[8].class))&&{class:c},S&2&&{role:s[1]},S&32&&{"aria-label":s[5]},{viewBox:"0 0 24 24"}]))},i:ln,o:ln,d(s){s&&Ee(i),f=!1,Qn(m)}}}function _F(r,i,o){const c=["size","role","strokeLinecap","strokeLinejoin","strokeWidth","ariaLabel"];let f=lr(i,c);const m=Wa("iconCtx")??{},_={xs:"w-3 h-3",sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6",xl:"w-8 h-8"};let{size:v=m.size||"md"}=i,{role:s=m.role||"img"}=i,{strokeLinecap:S=m.strokeLinecap||"round"}=i,{strokeLinejoin:P=m.strokeLinejoin||"round"}=i,{strokeWidth:z=m.strokeWidth||"2"}=i,{ariaLabel:F="caret left outline"}=i;function U(Me){ii.call(this,r,Me)}function Z(Me){ii.call(this,r,Me)}function W(Me){ii.call(this,r,Me)}function Q(Me){ii.call(this,r,Me)}function re(Me){ii.call(this,r,Me)}function ie(Me){ii.call(this,r,Me)}function ve(Me){ii.call(this,r,Me)}function pe(Me){ii.call(this,r,Me)}function ke(Me){ii.call(this,r,Me)}return r.$$set=Me=>{o(8,i=cn(cn({},i),Fr(Me))),o(7,f=lr(i,c)),"size"in Me&&o(0,v=Me.size),"role"in Me&&o(1,s=Me.role),"strokeLinecap"in Me&&o(2,S=Me.strokeLinecap),"strokeLinejoin"in Me&&o(3,P=Me.strokeLinejoin),"strokeWidth"in Me&&o(4,z=Me.strokeWidth),"ariaLabel"in Me&&o(5,F=Me.ariaLabel)},i=Fr(i),[v,s,S,P,z,F,_,f,i,U,Z,W,Q,re,ie,ve,pe,ke]}class xj extends jr{constructor(i){super(),Vr(this,i,_F,gF,kr,{size:0,role:1,strokeLinecap:2,strokeLinejoin:3,strokeWidth:4,ariaLabel:5})}}function yF(r){let i,o,c,f,m,_=[{xmlns:"http://www.w3.org/2000/svg"},{fill:"none"},r[7],{class:c=Qs("shrink-0",r[6][r[0]],r[8].class)},{role:r[1]},{"aria-label":r[5]},{viewBox:"0 0 24 24"}],v={};for(let s=0;s<_.length;s+=1)v=cn(v,_[s]);return{c(){i=Pt("svg"),o=Pt("path"),this.h()},l(s){i=Rt(s,"svg",{xmlns:!0,fill:!0,class:!0,role:!0,"aria-label":!0,viewBox:!0});var S=Xe(i);o=Rt(S,"path",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),Xe(o).forEach(Ee),S.forEach(Ee),this.h()},h(){ge(o,"stroke","currentColor"),ge(o,"stroke-linecap",r[2]),ge(o,"stroke-linejoin",r[3]),ge(o,"stroke-width",r[4]),ge(o,"d","M8 16.9V7a1 1 0 0 1 1.6-.8l6 5a1 1 0 0 1 0 1.5l-6 4.9a1 1 0 0 1-1.6-.8Z"),Qr(i,v)},m(s,S){oi(s,i,S),He(i,o),f||(m=[pt(i,"click",r[9]),pt(i,"keydown",r[10]),pt(i,"keyup",r[11]),pt(i,"focus",r[12]),pt(i,"blur",r[13]),pt(i,"mouseenter",r[14]),pt(i,"mouseleave",r[15]),pt(i,"mouseover",r[16]),pt(i,"mouseout",r[17])],f=!0)},p(s,[S]){S&4&&ge(o,"stroke-linecap",s[2]),S&8&&ge(o,"stroke-linejoin",s[3]),S&16&&ge(o,"stroke-width",s[4]),Qr(i,v=$s(_,[{xmlns:"http://www.w3.org/2000/svg"},{fill:"none"},S&128&&s[7],S&257&&c!==(c=Qs("shrink-0",s[6][s[0]],s[8].class))&&{class:c},S&2&&{role:s[1]},S&32&&{"aria-label":s[5]},{viewBox:"0 0 24 24"}]))},i:ln,o:ln,d(s){s&&Ee(i),f=!1,Qn(m)}}}function xF(r,i,o){const c=["size","role","strokeLinecap","strokeLinejoin","strokeWidth","ariaLabel"];let f=lr(i,c);const m=Wa("iconCtx")??{},_={xs:"w-3 h-3",sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6",xl:"w-8 h-8"};let{size:v=m.size||"md"}=i,{role:s=m.role||"img"}=i,{strokeLinecap:S=m.strokeLinecap||"round"}=i,{strokeLinejoin:P=m.strokeLinejoin||"round"}=i,{strokeWidth:z=m.strokeWidth||"2"}=i,{ariaLabel:F="caret right outline"}=i;function U(Me){ii.call(this,r,Me)}function Z(Me){ii.call(this,r,Me)}function W(Me){ii.call(this,r,Me)}function Q(Me){ii.call(this,r,Me)}function re(Me){ii.call(this,r,Me)}function ie(Me){ii.call(this,r,Me)}function ve(Me){ii.call(this,r,Me)}function pe(Me){ii.call(this,r,Me)}function ke(Me){ii.call(this,r,Me)}return r.$$set=Me=>{o(8,i=cn(cn({},i),Fr(Me))),o(7,f=lr(i,c)),"size"in Me&&o(0,v=Me.size),"role"in Me&&o(1,s=Me.role),"strokeLinecap"in Me&&o(2,S=Me.strokeLinecap),"strokeLinejoin"in Me&&o(3,P=Me.strokeLinejoin),"strokeWidth"in Me&&o(4,z=Me.strokeWidth),"ariaLabel"in Me&&o(5,F=Me.ariaLabel)},i=Fr(i),[v,s,S,P,z,F,_,f,i,U,Z,W,Q,re,ie,ve,pe,ke]}class vj extends jr{constructor(i){super(),Vr(this,i,xF,yF,kr,{size:0,role:1,strokeLinecap:2,strokeLinejoin:3,strokeWidth:4,ariaLabel:5})}}function vF(r){let i,o,c,f,m,_=[{xmlns:"http://www.w3.org/2000/svg"},{fill:"none"},r[4],{class:c=Qs("shrink-0",r[3][r[0]],r[5].class)},{role:r[1]},{"aria-label":r[2]},{viewBox:"0 0 24 24"}],v={};for(let s=0;s<_.length;s+=1)v=cn(v,_[s]);return{c(){i=Pt("svg"),o=Pt("path"),this.h()},l(s){i=Rt(s,"svg",{xmlns:!0,fill:!0,class:!0,role:!0,"aria-label":!0,viewBox:!0});var S=Xe(i);o=Rt(S,"path",{fill:!0,"fill-rule":!0,d:!0,"clip-rule":!0}),Xe(o).forEach(Ee),S.forEach(Ee),this.h()},h(){ge(o,"fill","currentColor"),ge(o,"fill-rule","evenodd"),ge(o,"d","M2 12a10 10 0 1 1 20 0 10 10 0 0 1-20 0Zm9.4-5.5a1 1 0 1 0 0 2 1 1 0 1 0 0-2ZM10 10a1 1 0 1 0 0 2h1v3h-1a1 1 0 1 0 0 2h4a1 1 0 1 0 0-2h-1v-4c0-.6-.4-1-1-1h-2Z"),ge(o,"clip-rule","evenodd"),Qr(i,v)},m(s,S){oi(s,i,S),He(i,o),f||(m=[pt(i,"click",r[6]),pt(i,"keydown",r[7]),pt(i,"keyup",r[8]),pt(i,"focus",r[9]),pt(i,"blur",r[10]),pt(i,"mouseenter",r[11]),pt(i,"mouseleave",r[12]),pt(i,"mouseover",r[13]),pt(i,"mouseout",r[14])],f=!0)},p(s,[S]){Qr(i,v=$s(_,[{xmlns:"http://www.w3.org/2000/svg"},{fill:"none"},S&16&&s[4],S&33&&c!==(c=Qs("shrink-0",s[3][s[0]],s[5].class))&&{class:c},S&2&&{role:s[1]},S&4&&{"aria-label":s[2]},{viewBox:"0 0 24 24"}]))},i:ln,o:ln,d(s){s&&Ee(i),f=!1,Qn(m)}}}function bF(r,i,o){const c=["size","role","ariaLabel"];let f=lr(i,c);const m=Wa("iconCtx")??{},_={xs:"w-3 h-3",sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6",xl:"w-8 h-8"};let{size:v=m.size||"md"}=i,{role:s=m.role||"img"}=i,{ariaLabel:S="info circle solid"}=i;function P(ve){ii.call(this,r,ve)}function z(ve){ii.call(this,r,ve)}function F(ve){ii.call(this,r,ve)}function U(ve){ii.call(this,r,ve)}function Z(ve){ii.call(this,r,ve)}function W(ve){ii.call(this,r,ve)}function Q(ve){ii.call(this,r,ve)}function re(ve){ii.call(this,r,ve)}function ie(ve){ii.call(this,r,ve)}return r.$$set=ve=>{o(5,i=cn(cn({},i),Fr(ve))),o(4,f=lr(i,c)),"size"in ve&&o(0,v=ve.size),"role"in ve&&o(1,s=ve.role),"ariaLabel"in ve&&o(2,S=ve.ariaLabel)},i=Fr(i),[v,s,S,_,f,i,P,z,F,U,Z,W,Q,re,ie]}class bj extends jr{constructor(i){super(),Vr(this,i,bF,vF,kr,{size:0,role:1,ariaLabel:2})}}function Pg(r,i){return r==null||i==null?NaN:r<i?-1:r>i?1:r>=i?0:NaN}function wF(r,i){return r==null||i==null?NaN:i<r?-1:i>r?1:i>=r?0:NaN}function Sk(r){let i,o,c;r.length!==2?(i=Pg,o=(v,s)=>Pg(r(v),s),c=(v,s)=>r(v)-s):(i=r===Pg||r===wF?r:TF,o=r,c=r);function f(v,s,S=0,P=v.length){if(S<P){if(i(s,s)!==0)return P;do{const z=S+P>>>1;o(v[z],s)<0?S=z+1:P=z}while(S<P)}return S}function m(v,s,S=0,P=v.length){if(S<P){if(i(s,s)!==0)return P;do{const z=S+P>>>1;o(v[z],s)<=0?S=z+1:P=z}while(S<P)}return S}function _(v,s,S=0,P=v.length){const z=f(v,s,S,P-1);return z>S&&c(v[z-1],s)>-c(v[z],s)?z-1:z}return{left:f,center:_,right:m}}function TF(){return 0}function MF(r){return r===null?NaN:+r}const SF=Sk(Pg),EF=SF.right;Sk(MF).center;const AF=Math.sqrt(50),IF=Math.sqrt(10),kF=Math.sqrt(2);function n_(r,i,o){const c=(i-r)/Math.max(0,o),f=Math.floor(Math.log10(c)),m=c/Math.pow(10,f),_=m>=AF?10:m>=IF?5:m>=kF?2:1;let v,s,S;return f<0?(S=Math.pow(10,-f)/_,v=Math.round(r*S),s=Math.round(i*S),v/S<r&&++v,s/S>i&&--s,S=-S):(S=Math.pow(10,f)*_,v=Math.round(r/S),s=Math.round(i/S),v*S<r&&++v,s*S>i&&--s),s<v&&.5<=o&&o<2?n_(r,i,o*2):[v,s,S]}function CF(r,i,o){if(i=+i,r=+r,o=+o,!(o>0))return[];if(r===i)return[r];const c=i<r,[f,m,_]=c?n_(i,r,o):n_(r,i,o);if(!(m>=f))return[];const v=m-f+1,s=new Array(v);if(c)if(_<0)for(let S=0;S<v;++S)s[S]=(m-S)/-_;else for(let S=0;S<v;++S)s[S]=(m-S)*_;else if(_<0)for(let S=0;S<v;++S)s[S]=(f+S)/-_;else for(let S=0;S<v;++S)s[S]=(f+S)*_;return s}function Kx(r,i,o){return i=+i,r=+r,o=+o,n_(r,i,o)[2]}function PF(r,i,o){i=+i,r=+r,o=+o;const c=i<r,f=c?Kx(i,r,o):Kx(r,i,o);return(c?-1:1)*(f<0?1/-f:f)}function DF(r){return r}var yx=1,xx=2,Jx=3,fg=4,tA=1e-6;function zF(r){return"translate("+r+",0)"}function LF(r){return"translate(0,"+r+")"}function RF(r){return i=>+r(i)}function OF(r,i){return i=Math.max(0,r.bandwidth()-i*2)/2,r.round()&&(i=Math.round(i)),o=>+r(o)+i}function BF(){return!this.__axis}function FF(r,i){var o=[],c=null,f=null,m=6,_=6,v=3,s=typeof window<"u"&&window.devicePixelRatio>1?0:.5,S=r===yx||r===fg?-1:1,P=r===fg||r===xx?"x":"y",z=r===yx||r===Jx?zF:LF;function F(U){var Z=c??(i.ticks?i.ticks.apply(i,o):i.domain()),W=f??(i.tickFormat?i.tickFormat.apply(i,o):DF),Q=Math.max(m,0)+v,re=i.range(),ie=+re[0]+s,ve=+re[re.length-1]+s,pe=(i.bandwidth?OF:RF)(i.copy(),s),ke=U.selection?U.selection():U,Me=ke.selectAll(".domain").data([null]),Ye=ke.selectAll(".tick").data(Z,i).order(),ot=Ye.exit(),Mt=Ye.enter().append("g").attr("class","tick"),Se=Ye.select("line"),yt=Ye.select("text");Me=Me.merge(Me.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),Ye=Ye.merge(Mt),Se=Se.merge(Mt.append("line").attr("stroke","currentColor").attr(P+"2",S*m)),yt=yt.merge(Mt.append("text").attr("fill","currentColor").attr(P,S*Q).attr("dy",r===yx?"0em":r===Jx?"0.71em":"0.32em")),U!==ke&&(Me=Me.transition(U),Ye=Ye.transition(U),Se=Se.transition(U),yt=yt.transition(U),ot=ot.transition(U).attr("opacity",tA).attr("transform",function(_t){return isFinite(_t=pe(_t))?z(_t+s):this.getAttribute("transform")}),Mt.attr("opacity",tA).attr("transform",function(_t){var Ze=this.parentNode.__axis;return z((Ze&&isFinite(Ze=Ze(_t))?Ze:pe(_t))+s)})),ot.remove(),Me.attr("d",r===fg||r===xx?_?"M"+S*_+","+ie+"H"+s+"V"+ve+"H"+S*_:"M"+s+","+ie+"V"+ve:_?"M"+ie+","+S*_+"V"+s+"H"+ve+"V"+S*_:"M"+ie+","+s+"H"+ve),Ye.attr("opacity",1).attr("transform",function(_t){return z(pe(_t)+s)}),Se.attr(P+"2",S*m),yt.attr(P,S*Q).text(W),ke.filter(BF).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",r===xx?"start":r===fg?"end":"middle"),ke.each(function(){this.__axis=pe})}return F.scale=function(U){return arguments.length?(i=U,F):i},F.ticks=function(){return o=Array.from(arguments),F},F.tickArguments=function(U){return arguments.length?(o=U==null?[]:Array.from(U),F):o.slice()},F.tickValues=function(U){return arguments.length?(c=U==null?null:Array.from(U),F):c&&c.slice()},F.tickFormat=function(U){return arguments.length?(f=U,F):f},F.tickSize=function(U){return arguments.length?(m=_=+U,F):m},F.tickSizeInner=function(U){return arguments.length?(m=+U,F):m},F.tickSizeOuter=function(U){return arguments.length?(_=+U,F):_},F.tickPadding=function(U){return arguments.length?(v=+U,F):v},F.offset=function(U){return arguments.length?(s=+U,F):s},F}function wj(r){return FF(Jx,r)}var NF={value:()=>{}};function Ek(){for(var r=0,i=arguments.length,o={},c;r<i;++r){if(!(c=arguments[r]+"")||c in o||/[\s.]/.test(c))throw new Error("illegal type: "+c);o[c]=[]}return new Dg(o)}function Dg(r){this._=r}function VF(r,i){return r.trim().split(/^|\s+/).map(function(o){var c="",f=o.indexOf(".");if(f>=0&&(c=o.slice(f+1),o=o.slice(0,f)),o&&!i.hasOwnProperty(o))throw new Error("unknown type: "+o);return{type:o,name:c}})}Dg.prototype=Ek.prototype={constructor:Dg,on:function(r,i){var o=this._,c=VF(r+"",o),f,m=-1,_=c.length;if(arguments.length<2){for(;++m<_;)if((f=(r=c[m]).type)&&(f=jF(o[f],r.name)))return f;return}if(i!=null&&typeof i!="function")throw new Error("invalid callback: "+i);for(;++m<_;)if(f=(r=c[m]).type)o[f]=iA(o[f],r.name,i);else if(i==null)for(f in o)o[f]=iA(o[f],r.name,null);return this},copy:function(){var r={},i=this._;for(var o in i)r[o]=i[o].slice();return new Dg(r)},call:function(r,i){if((f=arguments.length-2)>0)for(var o=new Array(f),c=0,f,m;c<f;++c)o[c]=arguments[c+2];if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(m=this._[r],c=0,f=m.length;c<f;++c)m[c].value.apply(i,o)},apply:function(r,i,o){if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(var c=this._[r],f=0,m=c.length;f<m;++f)c[f].value.apply(i,o)}};function jF(r,i){for(var o=0,c=r.length,f;o<c;++o)if((f=r[o]).name===i)return f.value}function iA(r,i,o){for(var c=0,f=r.length;c<f;++c)if(r[c].name===i){r[c]=NF,r=r.slice(0,c).concat(r.slice(c+1));break}return o!=null&&r.push({name:i,value:o}),r}var Qx="http://www.w3.org/1999/xhtml";const nA={svg:"http://www.w3.org/2000/svg",xhtml:Qx,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function k_(r){var i=r+="",o=i.indexOf(":");return o>=0&&(i=r.slice(0,o))!=="xmlns"&&(r=r.slice(o+1)),nA.hasOwnProperty(i)?{space:nA[i],local:r}:r}function UF(r){return function(){var i=this.ownerDocument,o=this.namespaceURI;return o===Qx&&i.documentElement.namespaceURI===Qx?i.createElement(r):i.createElementNS(o,r)}}function GF(r){return function(){return this.ownerDocument.createElementNS(r.space,r.local)}}function Ak(r){var i=k_(r);return(i.local?GF:UF)(i)}function HF(){}function Ov(r){return r==null?HF:function(){return this.querySelector(r)}}function WF(r){typeof r!="function"&&(r=Ov(r));for(var i=this._groups,o=i.length,c=new Array(o),f=0;f<o;++f)for(var m=i[f],_=m.length,v=c[f]=new Array(_),s,S,P=0;P<_;++P)(s=m[P])&&(S=r.call(s,s.__data__,P,m))&&("__data__"in s&&(S.__data__=s.__data__),v[P]=S);return new Os(c,this._parents)}function qF(r){return r==null?[]:Array.isArray(r)?r:Array.from(r)}function ZF(){return[]}function Ik(r){return r==null?ZF:function(){return this.querySelectorAll(r)}}function XF(r){return function(){return qF(r.apply(this,arguments))}}function YF(r){typeof r=="function"?r=XF(r):r=Ik(r);for(var i=this._groups,o=i.length,c=[],f=[],m=0;m<o;++m)for(var _=i[m],v=_.length,s,S=0;S<v;++S)(s=_[S])&&(c.push(r.call(s,s.__data__,S,_)),f.push(s));return new Os(c,f)}function kk(r){return function(){return this.matches(r)}}function Ck(r){return function(i){return i.matches(r)}}var KF=Array.prototype.find;function JF(r){return function(){return KF.call(this.children,r)}}function QF(){return this.firstElementChild}function $F(r){return this.select(r==null?QF:JF(typeof r=="function"?r:Ck(r)))}var e6=Array.prototype.filter;function t6(){return Array.from(this.children)}function i6(r){return function(){return e6.call(this.children,r)}}function n6(r){return this.selectAll(r==null?t6:i6(typeof r=="function"?r:Ck(r)))}function r6(r){typeof r!="function"&&(r=kk(r));for(var i=this._groups,o=i.length,c=new Array(o),f=0;f<o;++f)for(var m=i[f],_=m.length,v=c[f]=[],s,S=0;S<_;++S)(s=m[S])&&r.call(s,s.__data__,S,m)&&v.push(s);return new Os(c,this._parents)}function Pk(r){return new Array(r.length)}function s6(){return new Os(this._enter||this._groups.map(Pk),this._parents)}function r_(r,i){this.ownerDocument=r.ownerDocument,this.namespaceURI=r.namespaceURI,this._next=null,this._parent=r,this.__data__=i}r_.prototype={constructor:r_,appendChild:function(r){return this._parent.insertBefore(r,this._next)},insertBefore:function(r,i){return this._parent.insertBefore(r,i)},querySelector:function(r){return this._parent.querySelector(r)},querySelectorAll:function(r){return this._parent.querySelectorAll(r)}};function o6(r){return function(){return r}}function a6(r,i,o,c,f,m){for(var _=0,v,s=i.length,S=m.length;_<S;++_)(v=i[_])?(v.__data__=m[_],c[_]=v):o[_]=new r_(r,m[_]);for(;_<s;++_)(v=i[_])&&(f[_]=v)}function l6(r,i,o,c,f,m,_){var v,s,S=new Map,P=i.length,z=m.length,F=new Array(P),U;for(v=0;v<P;++v)(s=i[v])&&(F[v]=U=_.call(s,s.__data__,v,i)+"",S.has(U)?f[v]=s:S.set(U,s));for(v=0;v<z;++v)U=_.call(r,m[v],v,m)+"",(s=S.get(U))?(c[v]=s,s.__data__=m[v],S.delete(U)):o[v]=new r_(r,m[v]);for(v=0;v<P;++v)(s=i[v])&&S.get(F[v])===s&&(f[v]=s)}function c6(r){return r.__data__}function u6(r,i){if(!arguments.length)return Array.from(this,c6);var o=i?l6:a6,c=this._parents,f=this._groups;typeof r!="function"&&(r=o6(r));for(var m=f.length,_=new Array(m),v=new Array(m),s=new Array(m),S=0;S<m;++S){var P=c[S],z=f[S],F=z.length,U=h6(r.call(P,P&&P.__data__,S,c)),Z=U.length,W=v[S]=new Array(Z),Q=_[S]=new Array(Z),re=s[S]=new Array(F);o(P,z,W,Q,re,U,i);for(var ie=0,ve=0,pe,ke;ie<Z;++ie)if(pe=W[ie]){for(ie>=ve&&(ve=ie+1);!(ke=Q[ve])&&++ve<Z;);pe._next=ke||null}}return _=new Os(_,c),_._enter=v,_._exit=s,_}function h6(r){return typeof r=="object"&&"length"in r?r:Array.from(r)}function d6(){return new Os(this._exit||this._groups.map(Pk),this._parents)}function f6(r,i,o){var c=this.enter(),f=this,m=this.exit();return typeof r=="function"?(c=r(c),c&&(c=c.selection())):c=c.append(r+""),i!=null&&(f=i(f),f&&(f=f.selection())),o==null?m.remove():o(m),c&&f?c.merge(f).order():f}function p6(r){for(var i=r.selection?r.selection():r,o=this._groups,c=i._groups,f=o.length,m=c.length,_=Math.min(f,m),v=new Array(f),s=0;s<_;++s)for(var S=o[s],P=c[s],z=S.length,F=v[s]=new Array(z),U,Z=0;Z<z;++Z)(U=S[Z]||P[Z])&&(F[Z]=U);for(;s<f;++s)v[s]=o[s];return new Os(v,this._parents)}function m6(){for(var r=this._groups,i=-1,o=r.length;++i<o;)for(var c=r[i],f=c.length-1,m=c[f],_;--f>=0;)(_=c[f])&&(m&&_.compareDocumentPosition(m)^4&&m.parentNode.insertBefore(_,m),m=_);return this}function g6(r){r||(r=_6);function i(z,F){return z&&F?r(z.__data__,F.__data__):!z-!F}for(var o=this._groups,c=o.length,f=new Array(c),m=0;m<c;++m){for(var _=o[m],v=_.length,s=f[m]=new Array(v),S,P=0;P<v;++P)(S=_[P])&&(s[P]=S);s.sort(i)}return new Os(f,this._parents).order()}function _6(r,i){return r<i?-1:r>i?1:r>=i?0:NaN}function y6(){var r=arguments[0];return arguments[0]=this,r.apply(null,arguments),this}function x6(){return Array.from(this)}function v6(){for(var r=this._groups,i=0,o=r.length;i<o;++i)for(var c=r[i],f=0,m=c.length;f<m;++f){var _=c[f];if(_)return _}return null}function b6(){let r=0;for(const i of this)++r;return r}function w6(){return!this.node()}function T6(r){for(var i=this._groups,o=0,c=i.length;o<c;++o)for(var f=i[o],m=0,_=f.length,v;m<_;++m)(v=f[m])&&r.call(v,v.__data__,m,f);return this}function M6(r){return function(){this.removeAttribute(r)}}function S6(r){return function(){this.removeAttributeNS(r.space,r.local)}}function E6(r,i){return function(){this.setAttribute(r,i)}}function A6(r,i){return function(){this.setAttributeNS(r.space,r.local,i)}}function I6(r,i){return function(){var o=i.apply(this,arguments);o==null?this.removeAttribute(r):this.setAttribute(r,o)}}function k6(r,i){return function(){var o=i.apply(this,arguments);o==null?this.removeAttributeNS(r.space,r.local):this.setAttributeNS(r.space,r.local,o)}}function C6(r,i){var o=k_(r);if(arguments.length<2){var c=this.node();return o.local?c.getAttributeNS(o.space,o.local):c.getAttribute(o)}return this.each((i==null?o.local?S6:M6:typeof i=="function"?o.local?k6:I6:o.local?A6:E6)(o,i))}function Dk(r){return r.ownerDocument&&r.ownerDocument.defaultView||r.document&&r||r.defaultView}function P6(r){return function(){this.style.removeProperty(r)}}function D6(r,i,o){return function(){this.style.setProperty(r,i,o)}}function z6(r,i,o){return function(){var c=i.apply(this,arguments);c==null?this.style.removeProperty(r):this.style.setProperty(r,c,o)}}function L6(r,i,o){return arguments.length>1?this.each((i==null?P6:typeof i=="function"?z6:D6)(r,i,o??"")):uh(this.node(),r)}function uh(r,i){return r.style.getPropertyValue(i)||Dk(r).getComputedStyle(r,null).getPropertyValue(i)}function R6(r){return function(){delete this[r]}}function O6(r,i){return function(){this[r]=i}}function B6(r,i){return function(){var o=i.apply(this,arguments);o==null?delete this[r]:this[r]=o}}function F6(r,i){return arguments.length>1?this.each((i==null?R6:typeof i=="function"?B6:O6)(r,i)):this.node()[r]}function zk(r){return r.trim().split(/^|\s+/)}function Bv(r){return r.classList||new Lk(r)}function Lk(r){this._node=r,this._names=zk(r.getAttribute("class")||"")}Lk.prototype={add:function(r){var i=this._names.indexOf(r);i<0&&(this._names.push(r),this._node.setAttribute("class",this._names.join(" ")))},remove:function(r){var i=this._names.indexOf(r);i>=0&&(this._names.splice(i,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(r){return this._names.indexOf(r)>=0}};function Rk(r,i){for(var o=Bv(r),c=-1,f=i.length;++c<f;)o.add(i[c])}function Ok(r,i){for(var o=Bv(r),c=-1,f=i.length;++c<f;)o.remove(i[c])}function N6(r){return function(){Rk(this,r)}}function V6(r){return function(){Ok(this,r)}}function j6(r,i){return function(){(i.apply(this,arguments)?Rk:Ok)(this,r)}}function U6(r,i){var o=zk(r+"");if(arguments.length<2){for(var c=Bv(this.node()),f=-1,m=o.length;++f<m;)if(!c.contains(o[f]))return!1;return!0}return this.each((typeof i=="function"?j6:i?N6:V6)(o,i))}function G6(){this.textContent=""}function H6(r){return function(){this.textContent=r}}function W6(r){return function(){var i=r.apply(this,arguments);this.textContent=i??""}}function q6(r){return arguments.length?this.each(r==null?G6:(typeof r=="function"?W6:H6)(r)):this.node().textContent}function Z6(){this.innerHTML=""}function X6(r){return function(){this.innerHTML=r}}function Y6(r){return function(){var i=r.apply(this,arguments);this.innerHTML=i??""}}function K6(r){return arguments.length?this.each(r==null?Z6:(typeof r=="function"?Y6:X6)(r)):this.node().innerHTML}function J6(){this.nextSibling&&this.parentNode.appendChild(this)}function Q6(){return this.each(J6)}function $6(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function eN(){return this.each($6)}function tN(r){var i=typeof r=="function"?r:Ak(r);return this.select(function(){return this.appendChild(i.apply(this,arguments))})}function iN(){return null}function nN(r,i){var o=typeof r=="function"?r:Ak(r),c=i==null?iN:typeof i=="function"?i:Ov(i);return this.select(function(){return this.insertBefore(o.apply(this,arguments),c.apply(this,arguments)||null)})}function rN(){var r=this.parentNode;r&&r.removeChild(this)}function sN(){return this.each(rN)}function oN(){var r=this.cloneNode(!1),i=this.parentNode;return i?i.insertBefore(r,this.nextSibling):r}function aN(){var r=this.cloneNode(!0),i=this.parentNode;return i?i.insertBefore(r,this.nextSibling):r}function lN(r){return this.select(r?aN:oN)}function cN(r){return arguments.length?this.property("__data__",r):this.node().__data__}function uN(r){return function(i){r.call(this,i,this.__data__)}}function hN(r){return r.trim().split(/^|\s+/).map(function(i){var o="",c=i.indexOf(".");return c>=0&&(o=i.slice(c+1),i=i.slice(0,c)),{type:i,name:o}})}function dN(r){return function(){var i=this.__on;if(i){for(var o=0,c=-1,f=i.length,m;o<f;++o)m=i[o],(!r.type||m.type===r.type)&&m.name===r.name?this.removeEventListener(m.type,m.listener,m.options):i[++c]=m;++c?i.length=c:delete this.__on}}}function fN(r,i,o){return function(){var c=this.__on,f,m=uN(i);if(c){for(var _=0,v=c.length;_<v;++_)if((f=c[_]).type===r.type&&f.name===r.name){this.removeEventListener(f.type,f.listener,f.options),this.addEventListener(f.type,f.listener=m,f.options=o),f.value=i;return}}this.addEventListener(r.type,m,o),f={type:r.type,name:r.name,value:i,listener:m,options:o},c?c.push(f):this.__on=[f]}}function pN(r,i,o){var c=hN(r+""),f,m=c.length,_;if(arguments.length<2){var v=this.node().__on;if(v){for(var s=0,S=v.length,P;s<S;++s)for(f=0,P=v[s];f<m;++f)if((_=c[f]).type===P.type&&_.name===P.name)return P.value}return}for(v=i?fN:dN,f=0;f<m;++f)this.each(v(c[f],i,o));return this}function Bk(r,i,o){var c=Dk(r),f=c.CustomEvent;typeof f=="function"?f=new f(i,o):(f=c.document.createEvent("Event"),o?(f.initEvent(i,o.bubbles,o.cancelable),f.detail=o.detail):f.initEvent(i,!1,!1)),r.dispatchEvent(f)}function mN(r,i){return function(){return Bk(this,r,i)}}function gN(r,i){return function(){return Bk(this,r,i.apply(this,arguments))}}function _N(r,i){return this.each((typeof i=="function"?gN:mN)(r,i))}function*yN(){for(var r=this._groups,i=0,o=r.length;i<o;++i)for(var c=r[i],f=0,m=c.length,_;f<m;++f)(_=c[f])&&(yield _)}var Fk=[null];function Os(r,i){this._groups=r,this._parents=i}function $f(){return new Os([[document.documentElement]],Fk)}function xN(){return this}Os.prototype=$f.prototype={constructor:Os,select:WF,selectAll:YF,selectChild:$F,selectChildren:n6,filter:r6,data:u6,enter:s6,exit:d6,join:f6,merge:p6,selection:xN,order:m6,sort:g6,call:y6,nodes:x6,node:v6,size:b6,empty:w6,each:T6,attr:C6,style:L6,property:F6,classed:U6,text:q6,html:K6,raise:Q6,lower:eN,append:tN,insert:nN,remove:sN,clone:lN,datum:cN,on:pN,dispatch:_N,[Symbol.iterator]:yN};function Tj(r){return typeof r=="string"?new Os([[document.querySelector(r)]],[document.documentElement]):new Os([[r]],Fk)}function Fv(r,i,o){r.prototype=i.prototype=o,o.constructor=r}function Nk(r,i){var o=Object.create(r.prototype);for(var c in i)o[c]=i[c];return o}function ep(){}var Nf=.7,s_=1/Nf,ih="\\s*([+-]?\\d+)\\s*",Vf="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Jo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",vN=/^#([0-9a-f]{3,8})$/,bN=new RegExp(`^rgb\\(${ih},${ih},${ih}\\)$`),wN=new RegExp(`^rgb\\(${Jo},${Jo},${Jo}\\)$`),TN=new RegExp(`^rgba\\(${ih},${ih},${ih},${Vf}\\)$`),MN=new RegExp(`^rgba\\(${Jo},${Jo},${Jo},${Vf}\\)$`),SN=new RegExp(`^hsl\\(${Vf},${Jo},${Jo}\\)$`),EN=new RegExp(`^hsla\\(${Vf},${Jo},${Jo},${Vf}\\)$`),rA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Fv(ep,Oc,{copy(r){return Object.assign(new this.constructor,this,r)},displayable(){return this.rgb().displayable()},hex:sA,formatHex:sA,formatHex8:AN,formatHsl:IN,formatRgb:oA,toString:oA});function sA(){return this.rgb().formatHex()}function AN(){return this.rgb().formatHex8()}function IN(){return Vk(this).formatHsl()}function oA(){return this.rgb().formatRgb()}function Oc(r){var i,o;return r=(r+"").trim().toLowerCase(),(i=vN.exec(r))?(o=i[1].length,i=parseInt(i[1],16),o===6?aA(i):o===3?new ys(i>>8&15|i>>4&240,i>>4&15|i&240,(i&15)<<4|i&15,1):o===8?pg(i>>24&255,i>>16&255,i>>8&255,(i&255)/255):o===4?pg(i>>12&15|i>>8&240,i>>8&15|i>>4&240,i>>4&15|i&240,((i&15)<<4|i&15)/255):null):(i=bN.exec(r))?new ys(i[1],i[2],i[3],1):(i=wN.exec(r))?new ys(i[1]*255/100,i[2]*255/100,i[3]*255/100,1):(i=TN.exec(r))?pg(i[1],i[2],i[3],i[4]):(i=MN.exec(r))?pg(i[1]*255/100,i[2]*255/100,i[3]*255/100,i[4]):(i=SN.exec(r))?uA(i[1],i[2]/100,i[3]/100,1):(i=EN.exec(r))?uA(i[1],i[2]/100,i[3]/100,i[4]):rA.hasOwnProperty(r)?aA(rA[r]):r==="transparent"?new ys(NaN,NaN,NaN,0):null}function aA(r){return new ys(r>>16&255,r>>8&255,r&255,1)}function pg(r,i,o,c){return c<=0&&(r=i=o=NaN),new ys(r,i,o,c)}function kN(r){return r instanceof ep||(r=Oc(r)),r?(r=r.rgb(),new ys(r.r,r.g,r.b,r.opacity)):new ys}function $x(r,i,o,c){return arguments.length===1?kN(r):new ys(r,i,o,c??1)}function ys(r,i,o,c){this.r=+r,this.g=+i,this.b=+o,this.opacity=+c}Fv(ys,$x,Nk(ep,{brighter(r){return r=r==null?s_:Math.pow(s_,r),new ys(this.r*r,this.g*r,this.b*r,this.opacity)},darker(r){return r=r==null?Nf:Math.pow(Nf,r),new ys(this.r*r,this.g*r,this.b*r,this.opacity)},rgb(){return this},clamp(){return new ys(Dc(this.r),Dc(this.g),Dc(this.b),o_(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:lA,formatHex:lA,formatHex8:CN,formatRgb:cA,toString:cA}));function lA(){return`#${Ic(this.r)}${Ic(this.g)}${Ic(this.b)}`}function CN(){return`#${Ic(this.r)}${Ic(this.g)}${Ic(this.b)}${Ic((isNaN(this.opacity)?1:this.opacity)*255)}`}function cA(){const r=o_(this.opacity);return`${r===1?"rgb(":"rgba("}${Dc(this.r)}, ${Dc(this.g)}, ${Dc(this.b)}${r===1?")":`, ${r})`}`}function o_(r){return isNaN(r)?1:Math.max(0,Math.min(1,r))}function Dc(r){return Math.max(0,Math.min(255,Math.round(r)||0))}function Ic(r){return r=Dc(r),(r<16?"0":"")+r.toString(16)}function uA(r,i,o,c){return c<=0?r=i=o=NaN:o<=0||o>=1?r=i=NaN:i<=0&&(r=NaN),new go(r,i,o,c)}function Vk(r){if(r instanceof go)return new go(r.h,r.s,r.l,r.opacity);if(r instanceof ep||(r=Oc(r)),!r)return new go;if(r instanceof go)return r;r=r.rgb();var i=r.r/255,o=r.g/255,c=r.b/255,f=Math.min(i,o,c),m=Math.max(i,o,c),_=NaN,v=m-f,s=(m+f)/2;return v?(i===m?_=(o-c)/v+(o<c)*6:o===m?_=(c-i)/v+2:_=(i-o)/v+4,v/=s<.5?m+f:2-m-f,_*=60):v=s>0&&s<1?0:_,new go(_,v,s,r.opacity)}function PN(r,i,o,c){return arguments.length===1?Vk(r):new go(r,i,o,c??1)}function go(r,i,o,c){this.h=+r,this.s=+i,this.l=+o,this.opacity=+c}Fv(go,PN,Nk(ep,{brighter(r){return r=r==null?s_:Math.pow(s_,r),new go(this.h,this.s,this.l*r,this.opacity)},darker(r){return r=r==null?Nf:Math.pow(Nf,r),new go(this.h,this.s,this.l*r,this.opacity)},rgb(){var r=this.h%360+(this.h<0)*360,i=isNaN(r)||isNaN(this.s)?0:this.s,o=this.l,c=o+(o<.5?o:1-o)*i,f=2*o-c;return new ys(vx(r>=240?r-240:r+120,f,c),vx(r,f,c),vx(r<120?r+240:r-120,f,c),this.opacity)},clamp(){return new go(hA(this.h),mg(this.s),mg(this.l),o_(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const r=o_(this.opacity);return`${r===1?"hsl(":"hsla("}${hA(this.h)}, ${mg(this.s)*100}%, ${mg(this.l)*100}%${r===1?")":`, ${r})`}`}}));function hA(r){return r=(r||0)%360,r<0?r+360:r}function mg(r){return Math.max(0,Math.min(1,r||0))}function vx(r,i,o){return(r<60?i+(o-i)*r/60:r<180?o:r<240?i+(o-i)*(240-r)/60:i)*255}const Nv=r=>()=>r;function DN(r,i){return function(o){return r+o*i}}function zN(r,i,o){return r=Math.pow(r,o),i=Math.pow(i,o)-r,o=1/o,function(c){return Math.pow(r+c*i,o)}}function LN(r){return(r=+r)==1?jk:function(i,o){return o-i?zN(i,o,r):Nv(isNaN(i)?o:i)}}function jk(r,i){var o=i-r;return o?DN(r,o):Nv(isNaN(r)?i:r)}const a_=function r(i){var o=LN(i);function c(f,m){var _=o((f=$x(f)).r,(m=$x(m)).r),v=o(f.g,m.g),s=o(f.b,m.b),S=jk(f.opacity,m.opacity);return function(P){return f.r=_(P),f.g=v(P),f.b=s(P),f.opacity=S(P),f+""}}return c.gamma=r,c}(1);function RN(r,i){i||(i=[]);var o=r?Math.min(i.length,r.length):0,c=i.slice(),f;return function(m){for(f=0;f<o;++f)c[f]=r[f]*(1-m)+i[f]*m;return c}}function ON(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function BN(r,i){var o=i?i.length:0,c=r?Math.min(o,r.length):0,f=new Array(c),m=new Array(o),_;for(_=0;_<c;++_)f[_]=Vv(r[_],i[_]);for(;_<o;++_)m[_]=i[_];return function(v){for(_=0;_<c;++_)m[_]=f[_](v);return m}}function FN(r,i){var o=new Date;return r=+r,i=+i,function(c){return o.setTime(r*(1-c)+i*c),o}}function mo(r,i){return r=+r,i=+i,function(o){return r*(1-o)+i*o}}function NN(r,i){var o={},c={},f;(r===null||typeof r!="object")&&(r={}),(i===null||typeof i!="object")&&(i={});for(f in i)f in r?o[f]=Vv(r[f],i[f]):c[f]=i[f];return function(m){for(f in o)c[f]=o[f](m);return c}}var ev=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,bx=new RegExp(ev.source,"g");function VN(r){return function(){return r}}function jN(r){return function(i){return r(i)+""}}function Uk(r,i){var o=ev.lastIndex=bx.lastIndex=0,c,f,m,_=-1,v=[],s=[];for(r=r+"",i=i+"";(c=ev.exec(r))&&(f=bx.exec(i));)(m=f.index)>o&&(m=i.slice(o,m),v[_]?v[_]+=m:v[++_]=m),(c=c[0])===(f=f[0])?v[_]?v[_]+=f:v[++_]=f:(v[++_]=null,s.push({i:_,x:mo(c,f)})),o=bx.lastIndex;return o<i.length&&(m=i.slice(o),v[_]?v[_]+=m:v[++_]=m),v.length<2?s[0]?jN(s[0].x):VN(i):(i=s.length,function(S){for(var P=0,z;P<i;++P)v[(z=s[P]).i]=z.x(S);return v.join("")})}function Vv(r,i){var o=typeof i,c;return i==null||o==="boolean"?Nv(i):(o==="number"?mo:o==="string"?(c=Oc(i))?(i=c,a_):Uk:i instanceof Oc?a_:i instanceof Date?FN:ON(i)?RN:Array.isArray(i)?BN:typeof i.valueOf!="function"&&typeof i.toString!="function"||isNaN(i)?NN:mo)(r,i)}function UN(r,i){return r=+r,i=+i,function(o){return Math.round(r*(1-o)+i*o)}}var dA=180/Math.PI,tv={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Gk(r,i,o,c,f,m){var _,v,s;return(_=Math.sqrt(r*r+i*i))&&(r/=_,i/=_),(s=r*o+i*c)&&(o-=r*s,c-=i*s),(v=Math.sqrt(o*o+c*c))&&(o/=v,c/=v,s/=v),r*c<i*o&&(r=-r,i=-i,s=-s,_=-_),{translateX:f,translateY:m,rotate:Math.atan2(i,r)*dA,skewX:Math.atan(s)*dA,scaleX:_,scaleY:v}}var gg;function GN(r){const i=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(r+"");return i.isIdentity?tv:Gk(i.a,i.b,i.c,i.d,i.e,i.f)}function HN(r){return r==null||(gg||(gg=document.createElementNS("http://www.w3.org/2000/svg","g")),gg.setAttribute("transform",r),!(r=gg.transform.baseVal.consolidate()))?tv:(r=r.matrix,Gk(r.a,r.b,r.c,r.d,r.e,r.f))}function Hk(r,i,o,c){function f(S){return S.length?S.pop()+" ":""}function m(S,P,z,F,U,Z){if(S!==z||P!==F){var W=U.push("translate(",null,i,null,o);Z.push({i:W-4,x:mo(S,z)},{i:W-2,x:mo(P,F)})}else(z||F)&&U.push("translate("+z+i+F+o)}function _(S,P,z,F){S!==P?(S-P>180?P+=360:P-S>180&&(S+=360),F.push({i:z.push(f(z)+"rotate(",null,c)-2,x:mo(S,P)})):P&&z.push(f(z)+"rotate("+P+c)}function v(S,P,z,F){S!==P?F.push({i:z.push(f(z)+"skewX(",null,c)-2,x:mo(S,P)}):P&&z.push(f(z)+"skewX("+P+c)}function s(S,P,z,F,U,Z){if(S!==z||P!==F){var W=U.push(f(U)+"scale(",null,",",null,")");Z.push({i:W-4,x:mo(S,z)},{i:W-2,x:mo(P,F)})}else(z!==1||F!==1)&&U.push(f(U)+"scale("+z+","+F+")")}return function(S,P){var z=[],F=[];return S=r(S),P=r(P),m(S.translateX,S.translateY,P.translateX,P.translateY,z,F),_(S.rotate,P.rotate,z,F),v(S.skewX,P.skewX,z,F),s(S.scaleX,S.scaleY,P.scaleX,P.scaleY,z,F),S=P=null,function(U){for(var Z=-1,W=F.length,Q;++Z<W;)z[(Q=F[Z]).i]=Q.x(U);return z.join("")}}}var WN=Hk(GN,"px, ","px)","deg)"),qN=Hk(HN,", ",")",")"),hh=0,gf=0,lf=0,Wk=1e3,l_,_f,c_=0,Bc=0,C_=0,jf=typeof performance=="object"&&performance.now?performance:Date,qk=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(r){setTimeout(r,17)};function jv(){return Bc||(qk(ZN),Bc=jf.now()+C_)}function ZN(){Bc=0}function u_(){this._call=this._time=this._next=null}u_.prototype=Zk.prototype={constructor:u_,restart:function(r,i,o){if(typeof r!="function")throw new TypeError("callback is not a function");o=(o==null?jv():+o)+(i==null?0:+i),!this._next&&_f!==this&&(_f?_f._next=this:l_=this,_f=this),this._call=r,this._time=o,iv()},stop:function(){this._call&&(this._call=null,this._time=1/0,iv())}};function Zk(r,i,o){var c=new u_;return c.restart(r,i,o),c}function XN(){jv(),++hh;for(var r=l_,i;r;)(i=Bc-r._time)>=0&&r._call.call(void 0,i),r=r._next;--hh}function fA(){Bc=(c_=jf.now())+C_,hh=gf=0;try{XN()}finally{hh=0,KN(),Bc=0}}function YN(){var r=jf.now(),i=r-c_;i>Wk&&(C_-=i,c_=r)}function KN(){for(var r,i=l_,o,c=1/0;i;)i._call?(c>i._time&&(c=i._time),r=i,i=i._next):(o=i._next,i._next=null,i=r?r._next=o:l_=o);_f=r,iv(c)}function iv(r){if(!hh){gf&&(gf=clearTimeout(gf));var i=r-Bc;i>24?(r<1/0&&(gf=setTimeout(fA,r-jf.now()-C_)),lf&&(lf=clearInterval(lf))):(lf||(c_=jf.now(),lf=setInterval(YN,Wk)),hh=1,qk(fA))}}function pA(r,i,o){var c=new u_;return i=i==null?0:+i,c.restart(f=>{c.stop(),r(f+i)},i,o),c}var JN=Ek("start","end","cancel","interrupt"),QN=[],Xk=0,mA=1,nv=2,zg=3,gA=4,rv=5,Lg=6;function P_(r,i,o,c,f,m){var _=r.__transition;if(!_)r.__transition={};else if(o in _)return;$N(r,o,{name:i,index:c,group:f,on:JN,tween:QN,time:m.time,delay:m.delay,duration:m.duration,ease:m.ease,timer:null,state:Xk})}function Uv(r,i){var o=wo(r,i);if(o.state>Xk)throw new Error("too late; already scheduled");return o}function Qo(r,i){var o=wo(r,i);if(o.state>zg)throw new Error("too late; already running");return o}function wo(r,i){var o=r.__transition;if(!o||!(o=o[i]))throw new Error("transition not found");return o}function $N(r,i,o){var c=r.__transition,f;c[i]=o,o.timer=Zk(m,0,o.time);function m(S){o.state=mA,o.timer.restart(_,o.delay,o.time),o.delay<=S&&_(S-o.delay)}function _(S){var P,z,F,U;if(o.state!==mA)return s();for(P in c)if(U=c[P],U.name===o.name){if(U.state===zg)return pA(_);U.state===gA?(U.state=Lg,U.timer.stop(),U.on.call("interrupt",r,r.__data__,U.index,U.group),delete c[P]):+P<i&&(U.state=Lg,U.timer.stop(),U.on.call("cancel",r,r.__data__,U.index,U.group),delete c[P])}if(pA(function(){o.state===zg&&(o.state=gA,o.timer.restart(v,o.delay,o.time),v(S))}),o.state=nv,o.on.call("start",r,r.__data__,o.index,o.group),o.state===nv){for(o.state=zg,f=new Array(F=o.tween.length),P=0,z=-1;P<F;++P)(U=o.tween[P].value.call(r,r.__data__,o.index,o.group))&&(f[++z]=U);f.length=z+1}}function v(S){for(var P=S<o.duration?o.ease.call(null,S/o.duration):(o.timer.restart(s),o.state=rv,1),z=-1,F=f.length;++z<F;)f[z].call(r,P);o.state===rv&&(o.on.call("end",r,r.__data__,o.index,o.group),s())}function s(){o.state=Lg,o.timer.stop(),delete c[i];for(var S in c)return;delete r.__transition}}function e8(r,i){var o=r.__transition,c,f,m=!0,_;if(o){i=i==null?null:i+"";for(_ in o){if((c=o[_]).name!==i){m=!1;continue}f=c.state>nv&&c.state<rv,c.state=Lg,c.timer.stop(),c.on.call(f?"interrupt":"cancel",r,r.__data__,c.index,c.group),delete o[_]}m&&delete r.__transition}}function t8(r){return this.each(function(){e8(this,r)})}function i8(r,i){var o,c;return function(){var f=Qo(this,r),m=f.tween;if(m!==o){c=o=m;for(var _=0,v=c.length;_<v;++_)if(c[_].name===i){c=c.slice(),c.splice(_,1);break}}f.tween=c}}function n8(r,i,o){var c,f;if(typeof o!="function")throw new Error;return function(){var m=Qo(this,r),_=m.tween;if(_!==c){f=(c=_).slice();for(var v={name:i,value:o},s=0,S=f.length;s<S;++s)if(f[s].name===i){f[s]=v;break}s===S&&f.push(v)}m.tween=f}}function r8(r,i){var o=this._id;if(r+="",arguments.length<2){for(var c=wo(this.node(),o).tween,f=0,m=c.length,_;f<m;++f)if((_=c[f]).name===r)return _.value;return null}return this.each((i==null?i8:n8)(o,r,i))}function Gv(r,i,o){var c=r._id;return r.each(function(){var f=Qo(this,c);(f.value||(f.value={}))[i]=o.apply(this,arguments)}),function(f){return wo(f,c).value[i]}}function Yk(r,i){var o;return(typeof i=="number"?mo:i instanceof Oc?a_:(o=Oc(i))?(i=o,a_):Uk)(r,i)}function s8(r){return function(){this.removeAttribute(r)}}function o8(r){return function(){this.removeAttributeNS(r.space,r.local)}}function a8(r,i,o){var c,f=o+"",m;return function(){var _=this.getAttribute(r);return _===f?null:_===c?m:m=i(c=_,o)}}function l8(r,i,o){var c,f=o+"",m;return function(){var _=this.getAttributeNS(r.space,r.local);return _===f?null:_===c?m:m=i(c=_,o)}}function c8(r,i,o){var c,f,m;return function(){var _,v=o(this),s;return v==null?void this.removeAttribute(r):(_=this.getAttribute(r),s=v+"",_===s?null:_===c&&s===f?m:(f=s,m=i(c=_,v)))}}function u8(r,i,o){var c,f,m;return function(){var _,v=o(this),s;return v==null?void this.removeAttributeNS(r.space,r.local):(_=this.getAttributeNS(r.space,r.local),s=v+"",_===s?null:_===c&&s===f?m:(f=s,m=i(c=_,v)))}}function h8(r,i){var o=k_(r),c=o==="transform"?qN:Yk;return this.attrTween(r,typeof i=="function"?(o.local?u8:c8)(o,c,Gv(this,"attr."+r,i)):i==null?(o.local?o8:s8)(o):(o.local?l8:a8)(o,c,i))}function d8(r,i){return function(o){this.setAttribute(r,i.call(this,o))}}function f8(r,i){return function(o){this.setAttributeNS(r.space,r.local,i.call(this,o))}}function p8(r,i){var o,c;function f(){var m=i.apply(this,arguments);return m!==c&&(o=(c=m)&&f8(r,m)),o}return f._value=i,f}function m8(r,i){var o,c;function f(){var m=i.apply(this,arguments);return m!==c&&(o=(c=m)&&d8(r,m)),o}return f._value=i,f}function g8(r,i){var o="attr."+r;if(arguments.length<2)return(o=this.tween(o))&&o._value;if(i==null)return this.tween(o,null);if(typeof i!="function")throw new Error;var c=k_(r);return this.tween(o,(c.local?p8:m8)(c,i))}function _8(r,i){return function(){Uv(this,r).delay=+i.apply(this,arguments)}}function y8(r,i){return i=+i,function(){Uv(this,r).delay=i}}function x8(r){var i=this._id;return arguments.length?this.each((typeof r=="function"?_8:y8)(i,r)):wo(this.node(),i).delay}function v8(r,i){return function(){Qo(this,r).duration=+i.apply(this,arguments)}}function b8(r,i){return i=+i,function(){Qo(this,r).duration=i}}function w8(r){var i=this._id;return arguments.length?this.each((typeof r=="function"?v8:b8)(i,r)):wo(this.node(),i).duration}function T8(r,i){if(typeof i!="function")throw new Error;return function(){Qo(this,r).ease=i}}function M8(r){var i=this._id;return arguments.length?this.each(T8(i,r)):wo(this.node(),i).ease}function S8(r,i){return function(){var o=i.apply(this,arguments);if(typeof o!="function")throw new Error;Qo(this,r).ease=o}}function E8(r){if(typeof r!="function")throw new Error;return this.each(S8(this._id,r))}function A8(r){typeof r!="function"&&(r=kk(r));for(var i=this._groups,o=i.length,c=new Array(o),f=0;f<o;++f)for(var m=i[f],_=m.length,v=c[f]=[],s,S=0;S<_;++S)(s=m[S])&&r.call(s,s.__data__,S,m)&&v.push(s);return new Ha(c,this._parents,this._name,this._id)}function I8(r){if(r._id!==this._id)throw new Error;for(var i=this._groups,o=r._groups,c=i.length,f=o.length,m=Math.min(c,f),_=new Array(c),v=0;v<m;++v)for(var s=i[v],S=o[v],P=s.length,z=_[v]=new Array(P),F,U=0;U<P;++U)(F=s[U]||S[U])&&(z[U]=F);for(;v<c;++v)_[v]=i[v];return new Ha(_,this._parents,this._name,this._id)}function k8(r){return(r+"").trim().split(/^|\s+/).every(function(i){var o=i.indexOf(".");return o>=0&&(i=i.slice(0,o)),!i||i==="start"})}function C8(r,i,o){var c,f,m=k8(i)?Uv:Qo;return function(){var _=m(this,r),v=_.on;v!==c&&(f=(c=v).copy()).on(i,o),_.on=f}}function P8(r,i){var o=this._id;return arguments.length<2?wo(this.node(),o).on.on(r):this.each(C8(o,r,i))}function D8(r){return function(){var i=this.parentNode;for(var o in this.__transition)if(+o!==r)return;i&&i.removeChild(this)}}function z8(){return this.on("end.remove",D8(this._id))}function L8(r){var i=this._name,o=this._id;typeof r!="function"&&(r=Ov(r));for(var c=this._groups,f=c.length,m=new Array(f),_=0;_<f;++_)for(var v=c[_],s=v.length,S=m[_]=new Array(s),P,z,F=0;F<s;++F)(P=v[F])&&(z=r.call(P,P.__data__,F,v))&&("__data__"in P&&(z.__data__=P.__data__),S[F]=z,P_(S[F],i,o,F,S,wo(P,o)));return new Ha(m,this._parents,i,o)}function R8(r){var i=this._name,o=this._id;typeof r!="function"&&(r=Ik(r));for(var c=this._groups,f=c.length,m=[],_=[],v=0;v<f;++v)for(var s=c[v],S=s.length,P,z=0;z<S;++z)if(P=s[z]){for(var F=r.call(P,P.__data__,z,s),U,Z=wo(P,o),W=0,Q=F.length;W<Q;++W)(U=F[W])&&P_(U,i,o,W,F,Z);m.push(F),_.push(P)}return new Ha(m,_,i,o)}var O8=$f.prototype.constructor;function B8(){return new O8(this._groups,this._parents)}function F8(r,i){var o,c,f;return function(){var m=uh(this,r),_=(this.style.removeProperty(r),uh(this,r));return m===_?null:m===o&&_===c?f:f=i(o=m,c=_)}}function Kk(r){return function(){this.style.removeProperty(r)}}function N8(r,i,o){var c,f=o+"",m;return function(){var _=uh(this,r);return _===f?null:_===c?m:m=i(c=_,o)}}function V8(r,i,o){var c,f,m;return function(){var _=uh(this,r),v=o(this),s=v+"";return v==null&&(s=v=(this.style.removeProperty(r),uh(this,r))),_===s?null:_===c&&s===f?m:(f=s,m=i(c=_,v))}}function j8(r,i){var o,c,f,m="style."+i,_="end."+m,v;return function(){var s=Qo(this,r),S=s.on,P=s.value[m]==null?v||(v=Kk(i)):void 0;(S!==o||f!==P)&&(c=(o=S).copy()).on(_,f=P),s.on=c}}function U8(r,i,o){var c=(r+="")=="transform"?WN:Yk;return i==null?this.styleTween(r,F8(r,c)).on("end.style."+r,Kk(r)):typeof i=="function"?this.styleTween(r,V8(r,c,Gv(this,"style."+r,i))).each(j8(this._id,r)):this.styleTween(r,N8(r,c,i),o).on("end.style."+r,null)}function G8(r,i,o){return function(c){this.style.setProperty(r,i.call(this,c),o)}}function H8(r,i,o){var c,f;function m(){var _=i.apply(this,arguments);return _!==f&&(c=(f=_)&&G8(r,_,o)),c}return m._value=i,m}function W8(r,i,o){var c="style."+(r+="");if(arguments.length<2)return(c=this.tween(c))&&c._value;if(i==null)return this.tween(c,null);if(typeof i!="function")throw new Error;return this.tween(c,H8(r,i,o??""))}function q8(r){return function(){this.textContent=r}}function Z8(r){return function(){var i=r(this);this.textContent=i??""}}function X8(r){return this.tween("text",typeof r=="function"?Z8(Gv(this,"text",r)):q8(r==null?"":r+""))}function Y8(r){return function(i){this.textContent=r.call(this,i)}}function K8(r){var i,o;function c(){var f=r.apply(this,arguments);return f!==o&&(i=(o=f)&&Y8(f)),i}return c._value=r,c}function J8(r){var i="text";if(arguments.length<1)return(i=this.tween(i))&&i._value;if(r==null)return this.tween(i,null);if(typeof r!="function")throw new Error;return this.tween(i,K8(r))}function Q8(){for(var r=this._name,i=this._id,o=Jk(),c=this._groups,f=c.length,m=0;m<f;++m)for(var _=c[m],v=_.length,s,S=0;S<v;++S)if(s=_[S]){var P=wo(s,i);P_(s,r,o,S,_,{time:P.time+P.delay+P.duration,delay:0,duration:P.duration,ease:P.ease})}return new Ha(c,this._parents,r,o)}function $8(){var r,i,o=this,c=o._id,f=o.size();return new Promise(function(m,_){var v={value:_},s={value:function(){--f===0&&m()}};o.each(function(){var S=Qo(this,c),P=S.on;P!==r&&(i=(r=P).copy(),i._.cancel.push(v),i._.interrupt.push(v),i._.end.push(s)),S.on=i}),f===0&&m()})}var eV=0;function Ha(r,i,o,c){this._groups=r,this._parents=i,this._name=o,this._id=c}function Jk(){return++eV}var za=$f.prototype;Ha.prototype={constructor:Ha,select:L8,selectAll:R8,selectChild:za.selectChild,selectChildren:za.selectChildren,filter:A8,merge:I8,selection:B8,transition:Q8,call:za.call,nodes:za.nodes,node:za.node,size:za.size,empty:za.empty,each:za.each,on:P8,attr:h8,attrTween:g8,style:U8,styleTween:W8,text:X8,textTween:J8,remove:z8,tween:r8,delay:x8,duration:w8,ease:M8,easeVarying:E8,end:$8,[Symbol.iterator]:za[Symbol.iterator]};function tV(r){return((r*=2)<=1?r*r*r:(r-=2)*r*r+2)/2}var iV={time:null,delay:0,duration:250,ease:tV};function nV(r,i){for(var o;!(o=r.__transition)||!(o=o[i]);)if(!(r=r.parentNode))throw new Error(`transition ${i} not found`);return o}function rV(r){var i,o;r instanceof Ha?(i=r._id,r=r._name):(i=Jk(),(o=iV).time=jv(),r=r==null?null:r+"");for(var c=this._groups,f=c.length,m=0;m<f;++m)for(var _=c[m],v=_.length,s,S=0;S<v;++S)(s=_[S])&&P_(s,r,i,S,_,o||nV(s,i));return new Ha(c,this._parents,r,i)}$f.prototype.interrupt=t8;$f.prototype.transition=rV;function sV(r){return Math.abs(r=Math.round(r))>=1e21?r.toLocaleString("en").replace(/,/g,""):r.toString(10)}function h_(r,i){if((o=(r=i?r.toExponential(i-1):r.toExponential()).indexOf("e"))<0)return null;var o,c=r.slice(0,o);return[c.length>1?c[0]+c.slice(2):c,+r.slice(o+1)]}function dh(r){return r=h_(Math.abs(r)),r?r[1]:NaN}function oV(r,i){return function(o,c){for(var f=o.length,m=[],_=0,v=r[0],s=0;f>0&&v>0&&(s+v+1>c&&(v=Math.max(1,c-s)),m.push(o.substring(f-=v,f+v)),!((s+=v+1)>c));)v=r[_=(_+1)%r.length];return m.reverse().join(i)}}function aV(r){return function(i){return i.replace(/[0-9]/g,function(o){return r[+o]})}}var lV=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function d_(r){if(!(i=lV.exec(r)))throw new Error("invalid format: "+r);var i;return new Hv({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}d_.prototype=Hv.prototype;function Hv(r){this.fill=r.fill===void 0?" ":r.fill+"",this.align=r.align===void 0?">":r.align+"",this.sign=r.sign===void 0?"-":r.sign+"",this.symbol=r.symbol===void 0?"":r.symbol+"",this.zero=!!r.zero,this.width=r.width===void 0?void 0:+r.width,this.comma=!!r.comma,this.precision=r.precision===void 0?void 0:+r.precision,this.trim=!!r.trim,this.type=r.type===void 0?"":r.type+""}Hv.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function cV(r){e:for(var i=r.length,o=1,c=-1,f;o<i;++o)switch(r[o]){case".":c=f=o;break;case"0":c===0&&(c=o),f=o;break;default:if(!+r[o])break e;c>0&&(c=0);break}return c>0?r.slice(0,c)+r.slice(f+1):r}var Qk;function uV(r,i){var o=h_(r,i);if(!o)return r+"";var c=o[0],f=o[1],m=f-(Qk=Math.max(-8,Math.min(8,Math.floor(f/3)))*3)+1,_=c.length;return m===_?c:m>_?c+new Array(m-_+1).join("0"):m>0?c.slice(0,m)+"."+c.slice(m):"0."+new Array(1-m).join("0")+h_(r,Math.max(0,i+m-1))[0]}function _A(r,i){var o=h_(r,i);if(!o)return r+"";var c=o[0],f=o[1];return f<0?"0."+new Array(-f).join("0")+c:c.length>f+1?c.slice(0,f+1)+"."+c.slice(f+1):c+new Array(f-c.length+2).join("0")}const yA={"%":(r,i)=>(r*100).toFixed(i),b:r=>Math.round(r).toString(2),c:r=>r+"",d:sV,e:(r,i)=>r.toExponential(i),f:(r,i)=>r.toFixed(i),g:(r,i)=>r.toPrecision(i),o:r=>Math.round(r).toString(8),p:(r,i)=>_A(r*100,i),r:_A,s:uV,X:r=>Math.round(r).toString(16).toUpperCase(),x:r=>Math.round(r).toString(16)};function xA(r){return r}var vA=Array.prototype.map,bA=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function hV(r){var i=r.grouping===void 0||r.thousands===void 0?xA:oV(vA.call(r.grouping,Number),r.thousands+""),o=r.currency===void 0?"":r.currency[0]+"",c=r.currency===void 0?"":r.currency[1]+"",f=r.decimal===void 0?".":r.decimal+"",m=r.numerals===void 0?xA:aV(vA.call(r.numerals,String)),_=r.percent===void 0?"%":r.percent+"",v=r.minus===void 0?"":r.minus+"",s=r.nan===void 0?"NaN":r.nan+"";function S(z){z=d_(z);var F=z.fill,U=z.align,Z=z.sign,W=z.symbol,Q=z.zero,re=z.width,ie=z.comma,ve=z.precision,pe=z.trim,ke=z.type;ke==="n"?(ie=!0,ke="g"):yA[ke]||(ve===void 0&&(ve=12),pe=!0,ke="g"),(Q||F==="0"&&U==="=")&&(Q=!0,F="0",U="=");var Me=W==="$"?o:W==="#"&&/[boxX]/.test(ke)?"0"+ke.toLowerCase():"",Ye=W==="$"?c:/[%p]/.test(ke)?_:"",ot=yA[ke],Mt=/[defgprs%]/.test(ke);ve=ve===void 0?6:/[gprs]/.test(ke)?Math.max(1,Math.min(21,ve)):Math.max(0,Math.min(20,ve));function Se(yt){var _t=Me,Ze=Ye,Tt,Zt,ni;if(ke==="c")Ze=ot(yt)+Ze,yt="";else{yt=+yt;var ui=yt<0||1/yt<0;if(yt=isNaN(yt)?s:ot(Math.abs(yt),ve),pe&&(yt=cV(yt)),ui&&+yt==0&&Z!=="+"&&(ui=!1),_t=(ui?Z==="("?Z:v:Z==="-"||Z==="("?"":Z)+_t,Ze=(ke==="s"?bA[8+Qk/3]:"")+Ze+(ui&&Z==="("?")":""),Mt){for(Tt=-1,Zt=yt.length;++Tt<Zt;)if(ni=yt.charCodeAt(Tt),48>ni||ni>57){Ze=(ni===46?f+yt.slice(Tt+1):yt.slice(Tt))+Ze,yt=yt.slice(0,Tt);break}}}ie&&!Q&&(yt=i(yt,1/0));var Di=_t.length+yt.length+Ze.length,ft=Di<re?new Array(re-Di+1).join(F):"";switch(ie&&Q&&(yt=i(ft+yt,ft.length?re-Ze.length:1/0),ft=""),U){case"<":yt=_t+yt+Ze+ft;break;case"=":yt=_t+ft+yt+Ze;break;case"^":yt=ft.slice(0,Di=ft.length>>1)+_t+yt+Ze+ft.slice(Di);break;default:yt=ft+_t+yt+Ze;break}return m(yt)}return Se.toString=function(){return z+""},Se}function P(z,F){var U=S((z=d_(z),z.type="f",z)),Z=Math.max(-8,Math.min(8,Math.floor(dh(F)/3)))*3,W=Math.pow(10,-Z),Q=bA[8+Z/3];return function(re){return U(W*re)+Q}}return{format:S,formatPrefix:P}}var _g,$k,eC;dV({thousands:",",grouping:[3],currency:["$",""]});function dV(r){return _g=hV(r),$k=_g.format,eC=_g.formatPrefix,_g}function fV(r){return Math.max(0,-dh(Math.abs(r)))}function pV(r,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(dh(i)/3)))*3-dh(Math.abs(r)))}function mV(r,i){return r=Math.abs(r),i=Math.abs(i)-r,Math.max(0,dh(i)-dh(r))+1}function gV(r,i){switch(arguments.length){case 0:break;case 1:this.range(r);break;default:this.range(i).domain(r);break}return this}function _V(r){return function(){return r}}function yV(r){return+r}var wA=[0,1];function Ku(r){return r}function sv(r,i){return(i-=r=+r)?function(o){return(o-r)/i}:_V(isNaN(i)?NaN:.5)}function xV(r,i){var o;return r>i&&(o=r,r=i,i=o),function(c){return Math.max(r,Math.min(i,c))}}function vV(r,i,o){var c=r[0],f=r[1],m=i[0],_=i[1];return f<c?(c=sv(f,c),m=o(_,m)):(c=sv(c,f),m=o(m,_)),function(v){return m(c(v))}}function bV(r,i,o){var c=Math.min(r.length,i.length)-1,f=new Array(c),m=new Array(c),_=-1;for(r[c]<r[0]&&(r=r.slice().reverse(),i=i.slice().reverse());++_<c;)f[_]=sv(r[_],r[_+1]),m[_]=o(i[_],i[_+1]);return function(v){var s=EF(r,v,1,c)-1;return m[s](f[s](v))}}function wV(r,i){return i.domain(r.domain()).range(r.range()).interpolate(r.interpolate()).clamp(r.clamp()).unknown(r.unknown())}function TV(){var r=wA,i=wA,o=Vv,c,f,m,_=Ku,v,s,S;function P(){var F=Math.min(r.length,i.length);return _!==Ku&&(_=xV(r[0],r[F-1])),v=F>2?bV:vV,s=S=null,z}function z(F){return F==null||isNaN(F=+F)?m:(s||(s=v(r.map(c),i,o)))(c(_(F)))}return z.invert=function(F){return _(f((S||(S=v(i,r.map(c),mo)))(F)))},z.domain=function(F){return arguments.length?(r=Array.from(F,yV),P()):r.slice()},z.range=function(F){return arguments.length?(i=Array.from(F),P()):i.slice()},z.rangeRound=function(F){return i=Array.from(F),o=UN,P()},z.clamp=function(F){return arguments.length?(_=F?!0:Ku,P()):_!==Ku},z.interpolate=function(F){return arguments.length?(o=F,P()):o},z.unknown=function(F){return arguments.length?(m=F,z):m},function(F,U){return c=F,f=U,P()}}function MV(){return TV()(Ku,Ku)}function SV(r,i,o,c){var f=PF(r,i,o),m;switch(c=d_(c??",f"),c.type){case"s":{var _=Math.max(Math.abs(r),Math.abs(i));return c.precision==null&&!isNaN(m=pV(f,_))&&(c.precision=m),eC(c,_)}case"":case"e":case"g":case"p":case"r":{c.precision==null&&!isNaN(m=mV(f,Math.max(Math.abs(r),Math.abs(i))))&&(c.precision=m-(c.type==="e"));break}case"f":case"%":{c.precision==null&&!isNaN(m=fV(f))&&(c.precision=m-(c.type==="%")*2);break}}return $k(c)}function EV(r){var i=r.domain;return r.ticks=function(o){var c=i();return CF(c[0],c[c.length-1],o??10)},r.tickFormat=function(o,c){var f=i();return SV(f[0],f[f.length-1],o??10,c)},r.nice=function(o){o==null&&(o=10);var c=i(),f=0,m=c.length-1,_=c[f],v=c[m],s,S,P=10;for(v<_&&(S=_,_=v,v=S,S=f,f=m,m=S);P-- >0;){if(S=Kx(_,v,o),S===s)return c[f]=_,c[m]=v,i(c);if(S>0)_=Math.floor(_/S)*S,v=Math.ceil(v/S)*S;else if(S<0)_=Math.ceil(_*S)/S,v=Math.floor(v*S)/S;else break;s=S}return r},r}function AV(){var r=MV();return r.copy=function(){return wV(r,AV())},gV.apply(r,arguments),EV(r)}function yf(r,i,o){this.k=r,this.x=i,this.y=o}yf.prototype={constructor:yf,scale:function(r){return r===1?this:new yf(this.k*r,this.x,this.y)},translate:function(r,i){return r===0&i===0?this:new yf(this.k,this.x+this.k*r,this.y+this.k*i)},apply:function(r){return[r[0]*this.k+this.x,r[1]*this.k+this.y]},applyX:function(r){return r*this.k+this.x},applyY:function(r){return r*this.k+this.y},invert:function(r){return[(r[0]-this.x)/this.k,(r[1]-this.y)/this.k]},invertX:function(r){return(r-this.x)/this.k},invertY:function(r){return(r-this.y)/this.k},rescaleX:function(r){return r.copy().domain(r.range().map(this.invertX,this).map(r.invert,r))},rescaleY:function(r){return r.copy().domain(r.range().map(this.invertY,this).map(r.invert,r))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};yf.prototype;const IV=r=>({svgSize:r&4}),TA=r=>({svgSize:r[5][r[2]]}),kV=r=>({svgSize:r&4}),MA=r=>({svgSize:r[5][r[2]]});function CV(r){let i,o,c,f,m,_,v=r[0]&&SA(r);const s=r[9].default,S=Uf(s,r,r[8],TA);let P=[{type:"button"},r[6],{class:r[4]},{"aria-label":c=r[1]??r[0]}],z={};for(let F=0;F<P.length;F+=1)z=cn(z,P[F]);return{c(){i=ci("button"),v&&v.c(),o=Kn(),S&&S.c(),this.h()},l(F){i=_i(F,"BUTTON",{type:!0,class:!0,"aria-label":!0});var U=Xe(i);v&&v.l(U),o=Jn(U),S&&S.l(U),U.forEach(Ee),this.h()},h(){nh(i,z)},m(F,U){oi(F,i,U),v&&v.m(i,null),He(i,o),S&&S.m(i,null),i.autofocus&&i.focus(),f=!0,m||(_=pt(i,"click",r[10]),m=!0)},p(F,U){F[0]?v?v.p(F,U):(v=SA(F),v.c(),v.m(i,o)):v&&(v.d(1),v=null),S&&S.p&&(!f||U&260)&&Hf(S,s,F,F[8],f?Gf(s,F[8],U,IV):Wf(F[8]),TA),nh(i,z=$s(P,[{type:"button"},U&64&&F[6],(!f||U&16)&&{class:F[4]},(!f||U&3&&c!==(c=F[1]??F[0]))&&{"aria-label":c}]))},i(F){f||(pr(S,F),f=!0)},o(F){Nr(S,F),f=!1},d(F){F&&Ee(i),v&&v.d(),S&&S.d(F),m=!1,_()}}}function PV(r){let i,o,c,f,m=r[0]&&EA(r);const _=r[9].default,v=Uf(_,r,r[8],MA);let s=[{href:r[3]},r[6],{class:r[4]},{"aria-label":c=r[1]??r[0]}],S={};for(let P=0;P<s.length;P+=1)S=cn(S,s[P]);return{c(){i=ci("a"),m&&m.c(),o=Kn(),v&&v.c(),this.h()},l(P){i=_i(P,"A",{href:!0,class:!0,"aria-label":!0});var z=Xe(i);m&&m.l(z),o=Jn(z),v&&v.l(z),z.forEach(Ee),this.h()},h(){nh(i,S)},m(P,z){oi(P,i,z),m&&m.m(i,null),He(i,o),v&&v.m(i,null),f=!0},p(P,z){P[0]?m?m.p(P,z):(m=EA(P),m.c(),m.m(i,o)):m&&(m.d(1),m=null),v&&v.p&&(!f||z&260)&&Hf(v,_,P,P[8],f?Gf(_,P[8],z,kV):Wf(P[8]),MA),nh(i,S=$s(s,[(!f||z&8)&&{href:P[3]},z&64&&P[6],(!f||z&16)&&{class:P[4]},(!f||z&3&&c!==(c=P[1]??P[0]))&&{"aria-label":c}]))},i(P){f||(pr(v,P),f=!0)},o(P){Nr(v,P),f=!1},d(P){P&&Ee(i),m&&m.d(),v&&v.d(P)}}}function SA(r){let i,o;return{c(){i=ci("span"),o=In(r[0]),this.h()},l(c){i=_i(c,"SPAN",{class:!0});var f=Xe(i);o=Bn(f,r[0]),f.forEach(Ee),this.h()},h(){ge(i,"class","sr-only")},m(c,f){oi(c,i,f),He(i,o)},p(c,f){f&1&&Sr(o,c[0])},d(c){c&&Ee(i)}}}function EA(r){let i,o;return{c(){i=ci("span"),o=In(r[0]),this.h()},l(c){i=_i(c,"SPAN",{class:!0});var f=Xe(i);o=Bn(f,r[0]),f.forEach(Ee),this.h()},h(){ge(i,"class","sr-only")},m(c,f){oi(c,i,f),He(i,o)},p(c,f){f&1&&Sr(o,c[0])},d(c){c&&Ee(i)}}}function DV(r){let i,o,c,f;const m=[PV,CV],_=[];function v(s,S){return s[3]?0:1}return i=v(r),o=_[i]=m[i](r),{c(){o.c(),c=Sn()},l(s){o.l(s),c=Sn()},m(s,S){_[i].m(s,S),oi(s,c,S),f=!0},p(s,[S]){let P=i;i=v(s),i===P?_[i].p(s,S):(g_(),Nr(_[P],1,1,()=>{_[P]=null}),__(),o=_[i],o?o.p(s,S):(o=_[i]=m[i](s),o.c()),pr(o,1),o.m(c.parentNode,c))},i(s){f||(pr(o),f=!0)},o(s){Nr(o),f=!1},d(s){s&&Ee(c),_[i].d(s)}}}function zV(r,i,o){const c=["color","name","ariaLabel","size","href"];let f=lr(i,c),{$$slots:m={},$$scope:_}=i;const v=Wa("background");let{color:s="default"}=i,{name:S=void 0}=i,{ariaLabel:P=void 0}=i,{size:z="md"}=i,{href:F=void 0}=i;const U={dark:"text-gray-500 hover:text-gray-900 hover:bg-gray-200 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-600",gray:"text-gray-500 focus:ring-gray-400 hover:bg-gray-200 dark:hover:bg-gray-800 dark:hover:text-gray-300",red:"text-red-500 focus:ring-red-400 hover:bg-red-200 dark:hover:bg-red-800 dark:hover:text-red-300",yellow:"text-yellow-500 focus:ring-yellow-400 hover:bg-yellow-200 dark:hover:bg-yellow-800 dark:hover:text-yellow-300",green:"text-green-500 focus:ring-green-400 hover:bg-green-200 dark:hover:bg-green-800 dark:hover:text-green-300",indigo:"text-indigo-500 focus:ring-indigo-400 hover:bg-indigo-200 dark:hover:bg-indigo-800 dark:hover:text-indigo-300",purple:"text-purple-500 focus:ring-purple-400 hover:bg-purple-200 dark:hover:bg-purple-800 dark:hover:text-purple-300",pink:"text-pink-500 focus:ring-pink-400 hover:bg-pink-200 dark:hover:bg-pink-800 dark:hover:text-pink-300",blue:"text-blue-500 focus:ring-blue-400 hover:bg-blue-200 dark:hover:bg-blue-800 dark:hover:text-blue-300",primary:"text-primary-500 focus:ring-primary-400 hover:bg-primary-200 dark:hover:bg-primary-800 dark:hover:text-primary-300",default:"focus:ring-gray-400"},Z={xs:"m-0.5 rounded-sm focus:ring-1 p-0.5",sm:"m-0.5 rounded focus:ring-1 p-0.5",md:"m-0.5 rounded-lg focus:ring-2 p-1.5",lg:"m-0.5 rounded-lg focus:ring-2 p-2.5"};let W;const Q={xs:"w-3 h-3",sm:"w-3.5 h-3.5",md:"w-5 h-5",lg:"w-5 h-5"};function re(ie){ii.call(this,r,ie)}return r.$$set=ie=>{o(14,i=cn(cn({},i),Fr(ie))),o(6,f=lr(i,c)),"color"in ie&&o(7,s=ie.color),"name"in ie&&o(0,S=ie.name),"ariaLabel"in ie&&o(1,P=ie.ariaLabel),"size"in ie&&o(2,z=ie.size),"href"in ie&&o(3,F=ie.href),"$$scope"in ie&&o(8,_=ie.$$scope)},r.$$.update=()=>{o(4,W=Qs("focus:outline-none whitespace-normal",Z[z],U[s],s==="default"&&(v?"hover:bg-gray-100 dark:hover:bg-gray-600":"hover:bg-gray-100 dark:hover:bg-gray-700"),i.class))},i=Fr(i),[S,P,z,F,W,Q,f,s,_,m,re]}class LV extends jr{constructor(i){super(),Vr(this,i,zV,DV,kr,{color:7,name:0,ariaLabel:1,size:2,href:3})}}function RV(r){let i,o,c;return{c(){i=Pt("svg"),o=Pt("path"),this.h()},l(f){i=Rt(f,"svg",{class:!0,fill:!0,viewBox:!0,xmlns:!0});var m=Xe(i);o=Rt(m,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),Xe(o).forEach(Ee),m.forEach(Ee),this.h()},h(){ge(o,"fill-rule","evenodd"),ge(o,"d","M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"),ge(o,"clip-rule","evenodd"),ge(i,"class",c=r[4]),ge(i,"fill","currentColor"),ge(i,"viewBox","0 0 20 20"),ge(i,"xmlns","http://www.w3.org/2000/svg")},m(f,m){oi(f,i,m),He(i,o)},p(f,m){m&16&&c!==(c=f[4])&&ge(i,"class",c)},d(f){f&&Ee(i)}}}function OV(r){let i,o;const c=[{name:r[0]},r[1],{class:Qs("ms-auto",r[2].class)}];let f={$$slots:{default:[RV,({svgSize:m})=>({4:m}),({svgSize:m})=>m?16:0]},$$scope:{ctx:r}};for(let m=0;m<c.length;m+=1)f=cn(f,c[m]);return i=new LV({props:f}),i.$on("click",r[3]),{c(){y_(i.$$.fragment)},l(m){x_(i.$$.fragment,m)},m(m,_){qf(i,m,_),o=!0},p(m,[_]){const v=_&7?$s(c,[_&1&&{name:m[0]},_&2&&rz(m[1]),_&4&&{class:Qs("ms-auto",m[2].class)}]):{};_&48&&(v.$$scope={dirty:_,ctx:m}),i.$set(v)},i(m){o||(pr(i.$$.fragment,m),o=!0)},o(m){Nr(i.$$.fragment,m),o=!1},d(m){Zf(i,m)}}}function BV(r,i,o){const c=["name"];let f=lr(i,c),{name:m="Close"}=i;function _(v){ii.call(this,r,v)}return r.$$set=v=>{o(2,i=cn(cn({},i),Fr(v))),o(1,f=lr(i,c)),"name"in v&&o(0,m=v.name)},i=Fr(i),[m,f,i,_]}class Mj extends jr{constructor(i){super(),Vr(this,i,BV,OV,kr,{name:0})}}const FV=(r,i)=>{const o=c=>{c!=null&&c.target&&r&&!r.contains(c.target)&&!c.defaultPrevented&&i()};return document.addEventListener("click",o,!0),{destroy(){document.removeEventListener("click",o,!0)}}},NV=r=>({hidden:r&1}),AA=r=>({hidden:r[0]});function IA(r){let i,o,c,f,m,_,v;function s(W,Q){if(W[4]&&W[1])return jV;if(W[4]&&!W[1])return VV}let S=s(r),P=S&&S(r);const z=r[25].default,F=Uf(z,r,r[24],AA);let U=[{id:r[6]},r[15],{class:c=Qs(r[7],r[3],r[2],r[10][r[5]],r[16].class)},{tabindex:"-1"},{"aria-controls":r[6]},{"aria-labelledby":r[6]}],Z={};for(let W=0;W<U.length;W+=1)Z=cn(Z,U[W]);return{c(){P&&P.c(),i=Kn(),o=ci("div"),F&&F.c(),this.h()},l(W){P&&P.l(W),i=Jn(W),o=_i(W,"DIV",{id:!0,class:!0,tabindex:!0,"aria-controls":!0,"aria-labelledby":!0});var Q=Xe(o);F&&F.l(Q),Q.forEach(Ee),this.h()},h(){nh(o,Z)},m(W,Q){P&&P.m(W,Q),oi(W,i,Q),oi(W,o,Q),F&&F.m(o,null),m=!0,_||(v=FD(r[14].call(null,o,r[12])),_=!0)},p(W,Q){r=W,S===(S=s(r))&&P?P.p(r,Q):(P&&P.d(1),P=S&&S(r),P&&(P.c(),P.m(i.parentNode,i))),F&&F.p&&(!m||Q&16777217)&&Hf(F,z,r,r[24],m?Gf(z,r[24],Q,NV):Wf(r[24]),AA),nh(o,Z=$s(U,[(!m||Q&64)&&{id:r[6]},Q&32768&&r[15],(!m||Q&65708&&c!==(c=Qs(r[7],r[3],r[2],r[10][r[5]],r[16].class)))&&{class:c},{tabindex:"-1"},(!m||Q&64)&&{"aria-controls":r[6]},(!m||Q&64)&&{"aria-labelledby":r[6]}]))},i(W){m||(pr(F,W),W&&sh(()=>{m&&(f||(f=Fg(o,r[9],r[8],!0)),f.run(1))}),m=!0)},o(W){Nr(F,W),W&&(f||(f=Fg(o,r[9],r[8],!1)),f.run(0)),m=!1},d(W){W&&(Ee(i),Ee(o)),P&&P.d(W),F&&F.d(W),W&&f&&f.end(),_=!1,v()}}}function VV(r){let i;return{c(){i=ci("div"),this.h()},l(o){i=_i(o,"DIV",{role:!0,class:!0}),Xe(i).forEach(Ee),this.h()},h(){ge(i,"role","presentation"),ge(i,"class",r[13])},m(o,c){oi(o,i,c)},p:ln,d(o){o&&Ee(i)}}}function jV(r){let i,o,c;return{c(){i=ci("div"),this.h()},l(f){i=_i(f,"DIV",{role:!0,class:!0}),Xe(i).forEach(Ee),this.h()},h(){ge(i,"role","presentation"),ge(i,"class",r[13])},m(f,m){oi(f,i,m),o||(c=pt(i,"click",r[26]),o=!0)},p:ln,d(f){f&&Ee(i),o=!1,c()}}}function UV(r){let i,o,c=!r[0]&&IA(r);return{c(){c&&c.c(),i=Sn()},l(f){c&&c.l(f),i=Sn()},m(f,m){c&&c.m(f,m),oi(f,i,m),o=!0},p(f,[m]){f[0]?c&&(g_(),Nr(c,1,1,()=>{c=null}),__()):c?(c.p(f,m),m&1&&pr(c,1)):(c=IA(f),c.c(),pr(c,1),c.m(i.parentNode,i))},i(f){o||(pr(c),o=!0)},o(f){Nr(c),o=!1},d(f){f&&Ee(i),c&&c.d(f)}}}function GV(r,i,o){const c=["activateClickOutside","hidden","position","leftOffset","rightOffset","topOffset","bottomOffset","width","backdrop","bgColor","bgOpacity","placement","id","divClass","transitionParams","transitionType"];let f=lr(i,c),{$$slots:m={},$$scope:_}=i,{activateClickOutside:v=!0}=i,{hidden:s=!0}=i,{position:S="fixed"}=i,{leftOffset:P="inset-y-0 start-0"}=i,{rightOffset:z="inset-y-0 end-0"}=i,{topOffset:F="inset-x-0 top-0"}=i,{bottomOffset:U="inset-x-0 bottom-0"}=i,{width:Z="w-80"}=i,{backdrop:W=!0}=i,{bgColor:Q="bg-gray-900"}=i,{bgOpacity:re="bg-opacity-75"}=i,{placement:ie="left"}=i,{id:ve="drawer-example"}=i,{divClass:pe="overflow-y-auto z-50 p-4 bg-white dark:bg-gray-800"}=i,{transitionParams:ke={}}=i,{transitionType:Me="fly"}=i;function Ye(Tt,Zt){switch(Me){case"slide":return zB(Tt,Zt);case"blur":return PB(Tt,Zt);case"fade":return DB(Tt,Zt);default:return xk(Tt,Zt)}}const ot={left:P,right:z,top:F,bottom:U},Mt=()=>{o(0,s=!s)},Se=()=>v&&!s&&Mt();let yt=Qs("fixed top-0 start-0 z-50 w-full h-full",W&&Q,W&&re);function _t(Tt,Zt){return v?FV(Tt,Zt):void 0}const Ze=()=>!s&&Mt();return r.$$set=Tt=>{o(16,i=cn(cn({},i),Fr(Tt))),o(15,f=lr(i,c)),"activateClickOutside"in Tt&&o(1,v=Tt.activateClickOutside),"hidden"in Tt&&o(0,s=Tt.hidden),"position"in Tt&&o(2,S=Tt.position),"leftOffset"in Tt&&o(17,P=Tt.leftOffset),"rightOffset"in Tt&&o(18,z=Tt.rightOffset),"topOffset"in Tt&&o(19,F=Tt.topOffset),"bottomOffset"in Tt&&o(20,U=Tt.bottomOffset),"width"in Tt&&o(3,Z=Tt.width),"backdrop"in Tt&&o(4,W=Tt.backdrop),"bgColor"in Tt&&o(21,Q=Tt.bgColor),"bgOpacity"in Tt&&o(22,re=Tt.bgOpacity),"placement"in Tt&&o(5,ie=Tt.placement),"id"in Tt&&o(6,ve=Tt.id),"divClass"in Tt&&o(7,pe=Tt.divClass),"transitionParams"in Tt&&o(8,ke=Tt.transitionParams),"transitionType"in Tt&&o(23,Me=Tt.transitionType),"$$scope"in Tt&&o(24,_=Tt.$$scope)},i=Fr(i),[s,v,S,Z,W,ie,ve,pe,ke,Ye,ot,Mt,Se,yt,_t,f,i,P,z,F,U,Q,re,Me,_,m,Ze]}class Sj extends jr{constructor(i){super(),Vr(this,i,GV,UV,kr,{activateClickOutside:1,hidden:0,position:2,leftOffset:17,rightOffset:18,topOffset:19,bottomOffset:20,width:3,backdrop:4,bgColor:21,bgOpacity:22,placement:5,id:6,divClass:7,transitionParams:8,transitionType:23})}}function HV(r){let i,o,c,f,m,_,v,s,S,P,z,F,U,Z,W,Q,re,ie,ve,pe,ke,Me,Ye,ot,Mt,Se,yt,_t,Ze,Tt,Zt,ni,ui,Di,ft,yi,wi,ai,nt,Qe,Ii,bi,rn,Hi,Pn,at,on,$n,er,en,St,si,Re,ee,ce,Te,it,tt,Et=[{xmlns:"http://www.w3.org/2000/svg"},{"xmlns:xlink":"http://www.w3.org/1999/xlink"},{id:"flag-icons-kh"},{width:r[0]},{height:r[0]},r[3],{role:r[1]},{"aria-label":r[2]},{viewBox:"0 0 640 480"}],Dt={};for(let Ke=0;Ke<Et.length;Ke+=1)Dt=cn(Dt,Et[Ke]);return{c(){i=Pt("svg"),o=Pt("path"),c=Pt("path"),f=Pt("g"),m=Pt("g"),_=Pt("path"),v=Pt("path"),s=Pt("path"),S=Pt("path"),P=Pt("path"),z=Pt("path"),F=Pt("path"),U=Pt("path"),Z=Pt("path"),W=Pt("path"),Q=Pt("path"),re=Pt("path"),ie=Pt("path"),ve=Pt("path"),pe=Pt("g"),ke=Pt("path"),Me=Pt("path"),Ye=Pt("path"),ot=Pt("path"),Mt=Pt("path"),Se=Pt("path"),yt=Pt("path"),_t=Pt("path"),Ze=Pt("path"),Tt=Pt("path"),Zt=Pt("g"),ni=Pt("path"),ui=Pt("path"),Di=Pt("path"),ft=Pt("path"),yi=Pt("path"),wi=Pt("path"),ai=Pt("path"),nt=Pt("path"),Qe=Pt("path"),Ii=Pt("path"),bi=Pt("path"),rn=Pt("path"),Hi=Pt("path"),Pn=Pt("path"),at=Pt("path"),on=Pt("path"),$n=Pt("path"),er=Pt("use"),en=Pt("path"),St=Pt("path"),si=Pt("path"),Re=Pt("path"),ee=Pt("path"),ce=Pt("path"),Te=Pt("path"),this.h()},l(Ke){i=Rt(Ke,"svg",{xmlns:!0,"xmlns:xlink":!0,id:!0,width:!0,height:!0,role:!0,"aria-label":!0,viewBox:!0});var Vt=Xe(i);o=Rt(Vt,"path",{fill:!0,d:!0}),Xe(o).forEach(Ee),c=Rt(Vt,"path",{fill:!0,d:!0}),Xe(c).forEach(Ee),f=Rt(Vt,"g",{fill:!0,stroke:!0,transform:!0});var Ct=Xe(f);m=Rt(Ct,"g",{"stroke-linejoin":!0});var zt=Xe(m);_=Rt(zt,"path",{d:!0}),Xe(_).forEach(Ee),v=Rt(zt,"path",{d:!0}),Xe(v).forEach(Ee),s=Rt(zt,"path",{"stroke-width":!0,d:!0}),Xe(s).forEach(Ee),S=Rt(zt,"path",{d:!0}),Xe(S).forEach(Ee),P=Rt(zt,"path",{"stroke-linejoin":!0,d:!0}),Xe(P).forEach(Ee),zt.forEach(Ee),z=Rt(Ct,"path",{d:!0}),Xe(z).forEach(Ee),F=Rt(Ct,"path",{"stroke-linejoin":!0,d:!0}),Xe(F).forEach(Ee),U=Rt(Ct,"path",{d:!0}),Xe(U).forEach(Ee),Z=Rt(Ct,"path",{d:!0}),Xe(Z).forEach(Ee),W=Rt(Ct,"path",{d:!0}),Xe(W).forEach(Ee),Q=Rt(Ct,"path",{d:!0}),Xe(Q).forEach(Ee),re=Rt(Ct,"path",{"stroke-linejoin":!0,d:!0}),Xe(re).forEach(Ee),ie=Rt(Ct,"path",{d:!0}),Xe(ie).forEach(Ee),ve=Rt(Ct,"path",{d:!0}),Xe(ve).forEach(Ee),pe=Rt(Ct,"g",{fill:!0,"stroke-width":!0});var Fi=Xe(pe);ke=Rt(Fi,"path",{d:!0}),Xe(ke).forEach(Ee),Me=Rt(Fi,"path",{"stroke-width":!0,d:!0}),Xe(Me).forEach(Ee),Fi.forEach(Ee),Ye=Rt(Ct,"path",{d:!0}),Xe(Ye).forEach(Ee),ot=Rt(Ct,"path",{d:!0}),Xe(ot).forEach(Ee),Mt=Rt(Ct,"path",{d:!0}),Xe(Mt).forEach(Ee),Se=Rt(Ct,"path",{"stroke-linejoin":!0,d:!0}),Xe(Se).forEach(Ee),yt=Rt(Ct,"path",{"stroke-linejoin":!0,d:!0}),Xe(yt).forEach(Ee),_t=Rt(Ct,"path",{"stroke-linejoin":!0,d:!0}),Xe(_t).forEach(Ee),Ze=Rt(Ct,"path",{"stroke-linejoin":!0,d:!0}),Xe(Ze).forEach(Ee),Tt=Rt(Ct,"path",{d:!0}),Xe(Tt).forEach(Ee),Zt=Rt(Ct,"g",{id:!0});var Ti=Xe(Zt);ni=Rt(Ti,"path",{d:!0}),Xe(ni).forEach(Ee),ui=Rt(Ti,"path",{d:!0}),Xe(ui).forEach(Ee),Di=Rt(Ti,"path",{d:!0}),Xe(Di).forEach(Ee),ft=Rt(Ti,"path",{d:!0}),Xe(ft).forEach(Ee),yi=Rt(Ti,"path",{d:!0}),Xe(yi).forEach(Ee),wi=Rt(Ti,"path",{d:!0}),Xe(wi).forEach(Ee),ai=Rt(Ti,"path",{"stroke-linejoin":!0,d:!0}),Xe(ai).forEach(Ee),nt=Rt(Ti,"path",{d:!0}),Xe(nt).forEach(Ee),Qe=Rt(Ti,"path",{d:!0}),Xe(Qe).forEach(Ee),Ii=Rt(Ti,"path",{d:!0}),Xe(Ii).forEach(Ee),bi=Rt(Ti,"path",{d:!0}),Xe(bi).forEach(Ee),rn=Rt(Ti,"path",{d:!0}),Xe(rn).forEach(Ee),Hi=Rt(Ti,"path",{d:!0}),Xe(Hi).forEach(Ee),Pn=Rt(Ti,"path",{d:!0}),Xe(Pn).forEach(Ee),at=Rt(Ti,"path",{d:!0}),Xe(at).forEach(Ee),on=Rt(Ti,"path",{d:!0}),Xe(on).forEach(Ee),$n=Rt(Ti,"path",{d:!0}),Xe($n).forEach(Ee),Ti.forEach(Ee),er=Rt(Ct,"use",{"xlink:href":!0,width:!0,height:!0,transform:!0}),Xe(er).forEach(Ee),en=Rt(Ct,"path",{d:!0}),Xe(en).forEach(Ee),St=Rt(Ct,"path",{d:!0}),Xe(St).forEach(Ee),si=Rt(Ct,"path",{d:!0}),Xe(si).forEach(Ee),Re=Rt(Ct,"path",{d:!0}),Xe(Re).forEach(Ee),ee=Rt(Ct,"path",{d:!0}),Xe(ee).forEach(Ee),ce=Rt(Ct,"path",{d:!0}),Xe(ce).forEach(Ee),Te=Rt(Ct,"path",{fill:!0,d:!0}),Xe(Te).forEach(Ee),Ct.forEach(Ee),Vt.forEach(Ee),this.h()},h(){ge(o,"fill","#032ea1"),ge(o,"d","M0 0h640v480H0z"),ge(c,"fill","#e00025"),ge(c,"d","M0 120h640v240H0z"),ge(_,"d","M139 623.5h113.8v43.8H139z"),ge(v,"d","M247 647.6h3.5v16.5H247zm-108-8.1h113.8v5H139zm0-7h113.8v4.6H139z"),ge(s,"stroke-width",".9"),ge(s,"d","M139 625.7h113.8v4.3H139z"),ge(S,"d","M169 647.6h3.6v16.5H169zm49 0h3.6v16.5H218zm-78 0h3.5v16.5H140zm7 0h3.5v16.5H147zm7.5 0h3.5v16.5h-3.5zm7.5 0h3.5v16.5H162zm62.8 0h3.6v16.5h-3.6zm7.5 0h3.6v16.5h-3.6zm7.5 0h3.6v16.5h-3.6z"),ge(P,"stroke-linejoin","miter"),ge(P,"d","M94.5 669.5a9.3 9.3 0 0 0 4.4-5.3H292a9.3 9.3 0 0 0 4.4 5.3z"),ge(m,"stroke-linejoin","bevel"),ge(z,"d","M193 556.8s-.1-4.1 2.3-4.2c2.3 0 2.2 4.2 2.2 4.2zm-12.5 54.5v-5.5c0-2.8-2.8-3-2.8-5 0 0-.4-3 .4-4.4 1.1 4 3 3.3 3 1.6 0-1.4-1-2.8-3.3-6.3-.8-1.1-.3-4.6.7-5.9.4 3 .9 4.5 2.2 4.5.8 0 1.4-.5 1.4-2 0-2-1.3-3-2-4.8a5 5 0 0 1 1.1-5.3c.5 3 .4 4.2 1.7 4.2 2.7-.9 0-4.8-.6-5.8-.6-1.1 1-3.4 1-3.4.8 2.7 1 2.9 2 2.6 1.2-.3 1-2-.4-3.4-.9-1-.8-2.3.2-3.3 1 1.9 2.2 1.8 2.3.6l-.8-4.4H204l-.9 4.3c-.2 1.2 1.4 1.5 2.4-.5 1 1 1.1 2.4.2 3.3-1.4 1.4-1.6 3.1-.4 3.4 1 .3 1.2 0 2-2.6 0 0 1.5 1.5 1 3.4-.6 1-3.3 5-.6 5.8 1.3 0 1.2-1.2 1.7-4.2a5 5 0 0 1 1 5.3c-.6 1.8-2 2.8-2 4.8 0 1.5.7 2 1.5 2 1.3 0 1.8-1.4 2.2-4.5 1 1.3 1.5 4.8.7 6-2.3 3.4-3.4 4.8-3.4 6.2 0 1.7 2 2.4 3-1.6.9 1.4.5 4.4.5 4.4 0 2-2.7 2.2-2.8 5v5.5zm7.2-46-.4-3.1h15.9l-.4 3.1zm1-3.2-.2-2.5H202l-.3 2.5zm2.3-2.6-.3-2.6h9l-.1 2.6zm33 110c-2-.7-5-2.9-5-5v-24.3l2.6-3.4H169l2.5 3.4v24.3c0 2.1-2 4.3-4 5z"),ge(F,"stroke-linejoin","bevel"),ge(F,"d","M178.2 647.6h3.6v16.5h-3.6zm30.4 0h3.6v16.5h-3.6z"),ge(U,"d","M168 609.2v27.6h54v-27.6a4.2 4.2 0 0 0-2.6 2.8v11.8h-48.7V612s-.6-2-2.8-2.8z"),ge(Z,"d","M214.6 669.5c-1.8-.7-5.6-2.9-5.6-5v-27.2c.4-1.5 2.4-2.4 3.7-3.4H177c1.7 1 3.6 1.7 4.3 3.4v27.2c0 2.1-3 4.3-4.8 5z"),ge(W,"d","M219.4 634.2v-19.6h-4.9v-1.9h-38.8v2h-5v19.5zM207 669.5c-1.8-.7-4.3-2.9-4.3-5v-23.2l1.4-2.1h-17.7l1.5 2v23.3c0 2.1-2.6 4.3-4.3 5z"),ge(Q,"d","M190.7 639.2h9v30.3h-9z"),ge(re,"stroke-linejoin","bevel"),ge(re,"d","M204.4 632.5c0-2 5.8-2.1 8.8-3.8h-36c3 1.7 8.7 1.8 8.7 3.8l1.2 3.9 15 .6z"),ge(ie,"d","M211.4 611.3c0-4.9.2-6.7 1.7-6.7V620c-3.7 1.4-6.3 6-6.3 6h-23.2s-2.6-4.6-6.3-6v-15.5c1.8 0 1.8 2 1.8 6.7zm1.7-2c0-5.6 4.9-6.2 4.9-6.2v5c-1.9-.1-2.8 1.6-2.8 4 0 2.5 1.5 2.5 1.5 2.5v14.2h-3.6z"),ge(ve,"d","M177.3 609.3c0-5.6-4.9-6.2-4.9-6.2v5c1.9-.1 2.8 1.6 2.8 4 0 2.5-1.5 2.5-1.5 2.5v14.2h3.6z"),ge(ke,"d","M186.8 570.6H204m-19.2 5.4h21m-23 6.5h24.9m-27 7.9h29.5m-30.2 9h30.4"),ge(Me,"stroke-width","1"),ge(Me,"d","M170.8 629h48.6m-33.2 0h18v6.6h-18z"),ge(pe,"fill","none"),ge(pe,"stroke-width",".8"),ge(Ye,"d","M184 614.2c3 3.6 2.6 9.7 2.6 13.3H204c0-3.6-.4-9.7 2.6-13.3zm9.7-41-2.4-1.3v-3.5c1 .3 2 .4 2.2 2 .3-2.3 1-2.1 1.9-3 1 .9 1.5.7 1.9 3 0-1.6 1.2-1.7 2.1-2v3.5l-2.3 1.2z"),ge(ot,"d","m193.5 578.9-4-2.8V573c1.5.3 3 .5 3.2 2.2.4-2.5 1.3-3.7 2.7-4.7 1.3 1 2.2 2.2 2.7 4.7.1-1.7 1.7-1.9 3-2.2v3.2l-3.9 2.7z"),ge(Mt,"d","m193.2 587.8-4.5-4v-4.7c1.6.4 3.4.6 3.6 3.1.5-3.5 1.5-5.4 3-6.8 1.6 1.4 2.6 3.3 3.2 6.8.2-2.5 2-2.7 3.6-3.1v4.7l-4.6 4zm8.4 5.3-4 5.7h-4.7l-4.1-5.7zm-15.2 9.5c2 1.1 2.8 3.4 3 7.6H201c.2-4.2 1-6.5 3-7.6z"),ge(Se,"stroke-linejoin","bevel"),ge(Se,"d","M204.2 593v-5.6a5.2 5.2 0 0 0-3.8 3.3c0-2-2.5-6.3-5.2-8.5-2.7 2.4-5.3 6.4-5.2 8.4-.5-1.5-1.8-2.7-3.8-3.2v5.7z"),ge(yt,"stroke-linejoin","bevel"),ge(yt,"d","M205 602.6V597c-2.1.6-3.5 1.7-4.1 3.3 0-2-2.7-6.3-5.7-8.5-3 2.5-5.8 6.4-5.7 8.5-.5-1.5-2-2.7-4.1-3.3v5.7z"),ge(_t,"stroke-linejoin","bevel"),ge(_t,"d","M207.4 614.3v-6.6a9.6 9.6 0 0 0-5.1 3.8c0-3.5-4-9-7.1-10.7-3.2 1.8-7.1 7.4-7.1 10.7a9.7 9.7 0 0 0-5.2-3.8v6.6z"),ge(Ze,"stroke-linejoin","bevel"),ge(Ze,"d","M206 629v-6.8c-2.4.9-3 3.1-3.8 4.7.3-6.9-3.8-14.2-7-16.1-3.2 1.9-7.4 9.4-7 16-.8-1.4-1.5-3.7-3.8-4.6v6.7z"),ge(Tt,"d","M204.4 639.2v-6.8c-2.5.6-2.6 1.5-3.4 3 .3-4.1-2.6-8.8-5.8-10.6-3.2 1.8-6 6.5-5.8 10.6-.8-1.5-.9-2.4-3.4-3v6.8z"),ge(ni,"d","M99 664.2v-20.4c-.7-2.6-3-5-4.6-5.4v-18l3.7 2 4.3 18.9v23z"),ge(ui,"d","M99 664.3v-20.5c-.7-2.6-3-5-4.6-5.4v-19.2c2.5 0 3.7 3.2 3.7 3.2l4.3 18.9v22.9z"),ge(Di,"d","M96.3 669.5c1.7-.7 4.2-2.9 4.2-5v-25.6l-1.2-2H143l-1.7 2v25.6a6 6 0 0 0 3.4 5z"),ge(ft,"d","M135.8 669.5c-1.7-.7-4.2-2.9-4.2-5v-24.3l3.6-3.4h-29.6l3.6 3.4v24.3c0 2.1-2.5 4.3-4.2 5z"),ge(yi,"d","M131.7 669.5c-1.7-.7-4.3-2.9-4.3-5v-22l2.4-3.3H111l2.4 3.3v22c0 2.1-2.5 4.3-4.3 5z"),ge(wi,"d","M116 639.2h8.9v30.4h-9z"),ge(ai,"stroke-linejoin","bevel"),ge(ai,"d","M103.7 647.6h3.6v16.5h-3.6zm30.8 0h3.5v16.5h-3.6zm-33.9-27.8h4.4v17h-4.4zm0-3.2h4.3v3.2h-4.3zm35.6 6.9h6.1v13h-6.1z"),ge(nt,"d","M104.9 636.6v-29c1.2 0 1.4 4.3 4.2 4.3 1.5 0 1.4-1.8.5-3.2-.7-1.3-1.6-3-.4-6.3.9 2.5 3.1 3.3 2.7 1.8-.7-2.7-2.8-3.2-1.2-7.3.5 3.4 2.7 3.3 2.2 1.3-.6-2.3-1.9-3.3-.3-6.5.9 3.7 2 3.5 2 1.2 0-3.4 0-7 4.2-8.3 0 0 .3-3 1.9-3 1.5 0 1.8 3 1.8 3 4.3 1.3 4.2 5 4.2 8.3 0 2.3 1.1 2.5 2-1.2 1.6 3.2.3 4.2-.3 6.5-.5 2 1.7 2.1 2.2-1.3 1.6 4.1-.5 4.6-1.2 7.3-.4 1.5 1.8.7 2.7-1.8 1.2 3.3.3 5-.4 6.3-.8 1.4-1 3.2.5 3.2 2.8 0 3-4.2 4.2-4.2v28.9zM98 614.7v22.1h2.5v-22.1c-.9-.5-1.7-.5-2.5 0z"),ge(Qe,"d","M98.2 629c3.1 1.6 6.2 3.5 7 7.8h-7zm43.2-6.6v14.4h2v-14.4c-.6-.3-1.5-.4-2 0z"),ge(Ii,"d","M143.4 629c-3.1 1.5-6.2 3.3-7 7.7h7zm-20.6-33.7 1.8-1.5v-2c-.6 0-1 .3-1.5 1a5 5 0 0 0-2.5-3 5 5 0 0 0-2.6 2.9c-.5-.7-.8-.8-1.5-1v2l1.8 1.6z"),ge(bi,"d","m123.8 600.2.8-1.9v-2.5c-.6 0-1 .3-1.5 1a5 5 0 0 0-2.5-3 5 5 0 0 0-2.6 2.9c-.5-.7-.8-.8-1.5-.9v2.5l.8 1.9z"),ge(rn,"d","m124 606.8 2.6-3.3v-3.2c-1 0-1.5.5-2.2 1.6-.7-2.3-2-2.7-3.8-3.8-1.9 1-3.2 1.5-3.8 3.7-.8-1.1-1.3-1.4-2.3-1.5v3.2l2.7 3.3z"),ge(Hi,"d","M124.7 613.3s3.2-2.7 3.3-4.2v-3.5c-1.2.1-2.3.4-3.2 1.9-.8-2.9-2-3.7-4.2-5-2.3 1.3-3.5 2.1-4.2 5-1-1.5-2-1.8-3.3-2v3.6a15 15 0 0 0 3.3 4.2z"),ge(Pn,"d","M126 625.3s4.4-4.7 4.5-6.6v-5.4c-1.6.2-3.2 1.3-4.4 3.6-1-4.5-2.6-7.6-5.5-9.8-3 2.2-4.6 5.3-5.6 9.8-1.2-2.3-2.7-3.4-4.3-3.6v5.4c.3 1.9 4.4 6.6 4.4 6.6z"),ge(at,"d","M126 632.4s3.7-3.7 4.5-5.3v-5.4c-1.6.2-3.2 1.3-4.4 3.5a14 14 0 0 0-5.5-9.2c-3 2.2-4.6 4.7-5.6 9.2-1.2-2.2-2.7-3.3-4.3-3.5v5.4c1 1.6 4.4 5.3 4.4 5.3z"),ge(on,"d","M127.5 636.6c-1-4.7-2-8.2-7.1-11.7-5.2 3.5-6.1 7-7.2 11.7z"),ge($n,"d","M130.2 639.2v-6.8c-2.4 1-4.5 2.3-5.3 3.8-.8-3.8-2.5-5.4-4.6-7.7-2.1 2.3-3.5 4-4.4 7.7-.8-1.5-2.9-2.9-5.2-3.8v6.8z"),ge(Zt,"id","kh-a"),cf(er,"xlink:href","#kh-a"),ge(er,"width","100%"),ge(er,"height","100%"),ge(er,"transform","matrix(-1 0 0 1 390.7 0)"),ge(en,"d","M72.7 694.3H318v12.5H72.7zm-6.5 12.5h258.3v12.5H66.2zm19.4-31.3H305v8.1H85.6z"),ge(St,"d","M79.2 683.6h232.4v10.6H79.2zm10.2-14.3h212v6.2h-212z"),ge(si,"d","M112.4 669.3h16v50h-16z"),ge(Re,"d","M116 669.3h8.9v50h-9zm71 0h16v50h-16z"),ge(ee,"d","M190.7 669.3h9v50h-9zm71.5 0h16v50h-16z"),ge(ce,"d","M265.7 669.3h9v50h-9z"),ge(Te,"fill","none"),ge(Te,"d","M99 664.2h193M115.8 713h9.2m-9.2-6.3h9.2m-9.2-6.2h9.2m-9.2-6.3h9.2m-9.2-6.2h9.2m-9.2-6.3h9.2m-9.2-6.2h9.2m65.8 37.5h8.6m-8.6-6.3h8.6m-8.6-6.2h8.6m-8.6-6.3h8.6m-8.6-6.2h8.6m-8.6-6.3h8.6m-8.6-6.2h8.6m66.2 37.5h9.2m-9.2-6.3h9.2m-9.2-6.2h9.2m-9.2-6.3h9.2m-9.2-6.2h9.2m-9.2-6.3h9.2m-9.2-6.2h9.2"),ge(f,"fill","#fff"),ge(f,"stroke","#000"),ge(f,"transform","matrix(1.2 0 0 1.2 85.6 -522)"),Qr(i,Dt)},m(Ke,Vt){oi(Ke,i,Vt),He(i,o),He(i,c),He(i,f),He(f,m),He(m,_),He(m,v),He(m,s),He(m,S),He(m,P),He(f,z),He(f,F),He(f,U),He(f,Z),He(f,W),He(f,Q),He(f,re),He(f,ie),He(f,ve),He(f,pe),He(pe,ke),He(pe,Me),He(f,Ye),He(f,ot),He(f,Mt),He(f,Se),He(f,yt),He(f,_t),He(f,Ze),He(f,Tt),He(f,Zt),He(Zt,ni),He(Zt,ui),He(Zt,Di),He(Zt,ft),He(Zt,yi),He(Zt,wi),He(Zt,ai),He(Zt,nt),He(Zt,Qe),He(Zt,Ii),He(Zt,bi),He(Zt,rn),He(Zt,Hi),He(Zt,Pn),He(Zt,at),He(Zt,on),He(Zt,$n),He(f,er),He(f,en),He(f,St),He(f,si),He(f,Re),He(f,ee),He(f,ce),He(f,Te),it||(tt=[pt(i,"click",r[4]),pt(i,"keydown",r[5]),pt(i,"keyup",r[6]),pt(i,"focus",r[7]),pt(i,"blur",r[8]),pt(i,"mouseenter",r[9]),pt(i,"mouseleave",r[10]),pt(i,"mouseover",r[11]),pt(i,"mouseout",r[12])],it=!0)},p(Ke,[Vt]){Qr(i,Dt=$s(Et,[{xmlns:"http://www.w3.org/2000/svg"},{"xmlns:xlink":"http://www.w3.org/1999/xlink"},{id:"flag-icons-kh"},Vt&1&&{width:Ke[0]},Vt&1&&{height:Ke[0]},Vt&8&&Ke[3],Vt&2&&{role:Ke[1]},Vt&4&&{"aria-label":Ke[2]},{viewBox:"0 0 640 480"}]))},i:ln,o:ln,d(Ke){Ke&&Ee(i),it=!1,Qn(tt)}}}function WV(r,i,o){const c=["size","role","ariaLabel"];let f=lr(i,c);const m=Wa("iconCtx")??{};let{size:_=m.size||"24"}=i,{role:v=m.role||"img"}=i,{ariaLabel:s="flag of kh"}=i;function S(ie){ii.call(this,r,ie)}function P(ie){ii.call(this,r,ie)}function z(ie){ii.call(this,r,ie)}function F(ie){ii.call(this,r,ie)}function U(ie){ii.call(this,r,ie)}function Z(ie){ii.call(this,r,ie)}function W(ie){ii.call(this,r,ie)}function Q(ie){ii.call(this,r,ie)}function re(ie){ii.call(this,r,ie)}return r.$$set=ie=>{i=cn(cn({},i),Fr(ie)),o(3,f=lr(i,c)),"size"in ie&&o(0,_=ie.size),"role"in ie&&o(1,v=ie.role),"ariaLabel"in ie&&o(2,s=ie.ariaLabel)},[_,v,s,f,S,P,z,F,U,Z,W,Q,re]}class Ej extends jr{constructor(i){super(),Vr(this,i,WV,HV,kr,{size:0,role:1,ariaLabel:2})}}function qV(r){let i,o,c,f,m,_,v,s,S,P,z=[{xmlns:"http://www.w3.org/2000/svg"},{id:"flag-icons-la"},{width:r[0]},{height:r[0]},r[3],{role:r[1]},{"aria-label":r[2]},{viewBox:"0 0 640 480"}],F={};for(let U=0;U<z.length;U+=1)F=cn(F,z[U]);return{c(){i=Pt("svg"),o=Pt("defs"),c=Pt("clipPath"),f=Pt("path"),m=Pt("g"),_=Pt("path"),v=Pt("path"),s=Pt("path"),this.h()},l(U){i=Rt(U,"svg",{xmlns:!0,id:!0,width:!0,height:!0,role:!0,"aria-label":!0,viewBox:!0});var Z=Xe(i);o=Rt(Z,"defs",{});var W=Xe(o);c=Rt(W,"clipPath",{id:!0});var Q=Xe(c);f=Rt(Q,"path",{"fill-opacity":!0,d:!0}),Xe(f).forEach(Ee),Q.forEach(Ee),W.forEach(Ee),m=Rt(Z,"g",{"fill-rule":!0,"clip-path":!0});var re=Xe(m);_=Rt(re,"path",{fill:!0,d:!0}),Xe(_).forEach(Ee),v=Rt(re,"path",{fill:!0,d:!0}),Xe(v).forEach(Ee),s=Rt(re,"path",{fill:!0,d:!0}),Xe(s).forEach(Ee),re.forEach(Ee),Z.forEach(Ee),this.h()},h(){ge(f,"fill-opacity",".7"),ge(f,"d","M0 0h640v480H0z"),ge(c,"id","la-a"),ge(_,"fill","#ce1126"),ge(_,"d","M-40 0h720v480H-40z"),ge(v,"fill","#002868"),ge(v,"d","M-40 119.3h720v241.4H-40z"),ge(s,"fill","#fff"),ge(s,"d","M423.4 240a103.4 103.4 0 1 1-206.8 0 103.4 103.4 0 1 1 206.8 0z"),ge(m,"fill-rule","evenodd"),ge(m,"clip-path","url(#la-a)"),Qr(i,F)},m(U,Z){oi(U,i,Z),He(i,o),He(o,c),He(c,f),He(i,m),He(m,_),He(m,v),He(m,s),S||(P=[pt(i,"click",r[4]),pt(i,"keydown",r[5]),pt(i,"keyup",r[6]),pt(i,"focus",r[7]),pt(i,"blur",r[8]),pt(i,"mouseenter",r[9]),pt(i,"mouseleave",r[10]),pt(i,"mouseover",r[11]),pt(i,"mouseout",r[12])],S=!0)},p(U,[Z]){Qr(i,F=$s(z,[{xmlns:"http://www.w3.org/2000/svg"},{id:"flag-icons-la"},Z&1&&{width:U[0]},Z&1&&{height:U[0]},Z&8&&U[3],Z&2&&{role:U[1]},Z&4&&{"aria-label":U[2]},{viewBox:"0 0 640 480"}]))},i:ln,o:ln,d(U){U&&Ee(i),S=!1,Qn(P)}}}function ZV(r,i,o){const c=["size","role","ariaLabel"];let f=lr(i,c);const m=Wa("iconCtx")??{};let{size:_=m.size||"24"}=i,{role:v=m.role||"img"}=i,{ariaLabel:s="flag of la"}=i;function S(ie){ii.call(this,r,ie)}function P(ie){ii.call(this,r,ie)}function z(ie){ii.call(this,r,ie)}function F(ie){ii.call(this,r,ie)}function U(ie){ii.call(this,r,ie)}function Z(ie){ii.call(this,r,ie)}function W(ie){ii.call(this,r,ie)}function Q(ie){ii.call(this,r,ie)}function re(ie){ii.call(this,r,ie)}return r.$$set=ie=>{i=cn(cn({},i),Fr(ie)),o(3,f=lr(i,c)),"size"in ie&&o(0,_=ie.size),"role"in ie&&o(1,v=ie.role),"ariaLabel"in ie&&o(2,s=ie.ariaLabel)},[_,v,s,f,S,P,z,F,U,Z,W,Q,re]}class Aj extends jr{constructor(i){super(),Vr(this,i,ZV,qV,kr,{size:0,role:1,ariaLabel:2})}}function XV(r){let i,o,c,f,m,_,v,s,S,P,z,F,U=[{xmlns:"http://www.w3.org/2000/svg"},{"xmlns:xlink":"http://www.w3.org/1999/xlink"},{id:"flag-icons-mm"},{width:r[0]},{height:r[0]},r[3],{role:r[1]},{"aria-label":r[2]},{viewBox:"0 0 640 480"}],Z={};for(let W=0;W<U.length;W+=1)Z=cn(Z,U[W]);return{c(){i=Pt("svg"),o=Pt("path"),c=Pt("path"),f=Pt("path"),m=Pt("g"),_=Pt("path"),v=Pt("use"),s=Pt("use"),S=Pt("use"),P=Pt("use"),this.h()},l(W){i=Rt(W,"svg",{xmlns:!0,"xmlns:xlink":!0,id:!0,width:!0,height:!0,role:!0,"aria-label":!0,viewBox:!0});var Q=Xe(i);o=Rt(Q,"path",{fill:!0,d:!0}),Xe(o).forEach(Ee),c=Rt(Q,"path",{fill:!0,d:!0}),Xe(c).forEach(Ee),f=Rt(Q,"path",{fill:!0,d:!0}),Xe(f).forEach(Ee),m=Rt(Q,"g",{transform:!0});var re=Xe(m);_=Rt(re,"path",{id:!0,fill:!0,d:!0}),Xe(_).forEach(Ee),v=Rt(re,"use",{"xlink:href":!0,width:!0,height:!0,transform:!0}),Xe(v).forEach(Ee),s=Rt(re,"use",{"xlink:href":!0,width:!0,height:!0,transform:!0}),Xe(s).forEach(Ee),S=Rt(re,"use",{"xlink:href":!0,width:!0,height:!0,transform:!0}),Xe(S).forEach(Ee),P=Rt(re,"use",{"xlink:href":!0,width:!0,height:!0,transform:!0}),Xe(P).forEach(Ee),re.forEach(Ee),Q.forEach(Ee),this.h()},h(){ge(o,"fill","#fecb00"),ge(o,"d","M0 0h640v480H0z"),ge(c,"fill","#34b233"),ge(c,"d","M0 160h640v320H0z"),ge(f,"fill","#ea2839"),ge(f,"d","M0 320h640v160H0z"),ge(_,"id","mm-a"),ge(_,"fill","#fff"),ge(_,"d","m0-1 .3 1h-.6z"),cf(v,"xlink:href","#mm-a"),ge(v,"width","100%"),ge(v,"height","100%"),ge(v,"transform","rotate(-144)"),cf(s,"xlink:href","#mm-a"),ge(s,"width","100%"),ge(s,"height","100%"),ge(s,"transform","rotate(-72)"),cf(S,"xlink:href","#mm-a"),ge(S,"width","100%"),ge(S,"height","100%"),ge(S,"transform","rotate(72)"),cf(P,"xlink:href","#mm-a"),ge(P,"width","100%"),ge(P,"height","100%"),ge(P,"transform","rotate(144)"),ge(m,"transform","translate(320 256.9) scale(176.87999)"),Qr(i,Z)},m(W,Q){oi(W,i,Q),He(i,o),He(i,c),He(i,f),He(i,m),He(m,_),He(m,v),He(m,s),He(m,S),He(m,P),z||(F=[pt(i,"click",r[4]),pt(i,"keydown",r[5]),pt(i,"keyup",r[6]),pt(i,"focus",r[7]),pt(i,"blur",r[8]),pt(i,"mouseenter",r[9]),pt(i,"mouseleave",r[10]),pt(i,"mouseover",r[11]),pt(i,"mouseout",r[12])],z=!0)},p(W,[Q]){Qr(i,Z=$s(U,[{xmlns:"http://www.w3.org/2000/svg"},{"xmlns:xlink":"http://www.w3.org/1999/xlink"},{id:"flag-icons-mm"},Q&1&&{width:W[0]},Q&1&&{height:W[0]},Q&8&&W[3],Q&2&&{role:W[1]},Q&4&&{"aria-label":W[2]},{viewBox:"0 0 640 480"}]))},i:ln,o:ln,d(W){W&&Ee(i),z=!1,Qn(F)}}}function YV(r,i,o){const c=["size","role","ariaLabel"];let f=lr(i,c);const m=Wa("iconCtx")??{};let{size:_=m.size||"24"}=i,{role:v=m.role||"img"}=i,{ariaLabel:s="flag of mm"}=i;function S(ie){ii.call(this,r,ie)}function P(ie){ii.call(this,r,ie)}function z(ie){ii.call(this,r,ie)}function F(ie){ii.call(this,r,ie)}function U(ie){ii.call(this,r,ie)}function Z(ie){ii.call(this,r,ie)}function W(ie){ii.call(this,r,ie)}function Q(ie){ii.call(this,r,ie)}function re(ie){ii.call(this,r,ie)}return r.$$set=ie=>{i=cn(cn({},i),Fr(ie)),o(3,f=lr(i,c)),"size"in ie&&o(0,_=ie.size),"role"in ie&&o(1,v=ie.role),"ariaLabel"in ie&&o(2,s=ie.ariaLabel)},[_,v,s,f,S,P,z,F,U,Z,W,Q,re]}class Ij extends jr{constructor(i){super(),Vr(this,i,YV,XV,kr,{size:0,role:1,ariaLabel:2})}}function KV(r){let i,o,c,f,m,_,v,s=[{xmlns:"http://www.w3.org/2000/svg"},{id:"flag-icons-th"},{width:r[0]},{height:r[0]},r[3],{role:r[1]},{"aria-label":r[2]},{viewBox:"0 0 640 480"}],S={};for(let P=0;P<s.length;P+=1)S=cn(S,s[P]);return{c(){i=Pt("svg"),o=Pt("g"),c=Pt("path"),f=Pt("path"),m=Pt("path"),this.h()},l(P){i=Rt(P,"svg",{xmlns:!0,id:!0,width:!0,height:!0,role:!0,"aria-label":!0,viewBox:!0});var z=Xe(i);o=Rt(z,"g",{"fill-rule":!0});var F=Xe(o);c=Rt(F,"path",{fill:!0,d:!0}),Xe(c).forEach(Ee),f=Rt(F,"path",{fill:!0,d:!0}),Xe(f).forEach(Ee),m=Rt(F,"path",{fill:!0,d:!0}),Xe(m).forEach(Ee),F.forEach(Ee),z.forEach(Ee),this.h()},h(){ge(c,"fill","#f4f5f8"),ge(c,"d","M0 0h640v480H0z"),ge(f,"fill","#2d2a4a"),ge(f,"d","M0 162.5h640v160H0z"),ge(m,"fill","#a51931"),ge(m,"d","M0 0h640v82.5H0zm0 400h640v80H0z"),ge(o,"fill-rule","evenodd"),Qr(i,S)},m(P,z){oi(P,i,z),He(i,o),He(o,c),He(o,f),He(o,m),_||(v=[pt(i,"click",r[4]),pt(i,"keydown",r[5]),pt(i,"keyup",r[6]),pt(i,"focus",r[7]),pt(i,"blur",r[8]),pt(i,"mouseenter",r[9]),pt(i,"mouseleave",r[10]),pt(i,"mouseover",r[11]),pt(i,"mouseout",r[12])],_=!0)},p(P,[z]){Qr(i,S=$s(s,[{xmlns:"http://www.w3.org/2000/svg"},{id:"flag-icons-th"},z&1&&{width:P[0]},z&1&&{height:P[0]},z&8&&P[3],z&2&&{role:P[1]},z&4&&{"aria-label":P[2]},{viewBox:"0 0 640 480"}]))},i:ln,o:ln,d(P){P&&Ee(i),_=!1,Qn(v)}}}function JV(r,i,o){const c=["size","role","ariaLabel"];let f=lr(i,c);const m=Wa("iconCtx")??{};let{size:_=m.size||"24"}=i,{role:v=m.role||"img"}=i,{ariaLabel:s="flag of th"}=i;function S(ie){ii.call(this,r,ie)}function P(ie){ii.call(this,r,ie)}function z(ie){ii.call(this,r,ie)}function F(ie){ii.call(this,r,ie)}function U(ie){ii.call(this,r,ie)}function Z(ie){ii.call(this,r,ie)}function W(ie){ii.call(this,r,ie)}function Q(ie){ii.call(this,r,ie)}function re(ie){ii.call(this,r,ie)}return r.$$set=ie=>{i=cn(cn({},i),Fr(ie)),o(3,f=lr(i,c)),"size"in ie&&o(0,_=ie.size),"role"in ie&&o(1,v=ie.role),"ariaLabel"in ie&&o(2,s=ie.ariaLabel)},[_,v,s,f,S,P,z,F,U,Z,W,Q,re]}class kj extends jr{constructor(i){super(),Vr(this,i,JV,KV,kr,{size:0,role:1,ariaLabel:2})}}function QV(r){let i,o,c,f,m,_,v,s,S,P=[{xmlns:"http://www.w3.org/2000/svg"},{id:"flag-icons-vn"},{width:r[0]},{height:r[0]},r[3],{role:r[1]},{"aria-label":r[2]},{viewBox:"0 0 640 480"}],z={};for(let F=0;F<P.length;F+=1)z=cn(z,P[F]);return{c(){i=Pt("svg"),o=Pt("defs"),c=Pt("clipPath"),f=Pt("path"),m=Pt("g"),_=Pt("path"),v=Pt("path"),this.h()},l(F){i=Rt(F,"svg",{xmlns:!0,id:!0,width:!0,height:!0,role:!0,"aria-label":!0,viewBox:!0});var U=Xe(i);o=Rt(U,"defs",{});var Z=Xe(o);c=Rt(Z,"clipPath",{id:!0});var W=Xe(c);f=Rt(W,"path",{"fill-opacity":!0,d:!0}),Xe(f).forEach(Ee),W.forEach(Ee),Z.forEach(Ee),m=Rt(U,"g",{"fill-rule":!0,"clip-path":!0,transform:!0});var Q=Xe(m);_=Rt(Q,"path",{fill:!0,d:!0}),Xe(_).forEach(Ee),v=Rt(Q,"path",{fill:!0,d:!0}),Xe(v).forEach(Ee),Q.forEach(Ee),U.forEach(Ee),this.h()},h(){ge(f,"fill-opacity",".7"),ge(f,"d","M-85.3 0h682.6v512H-85.3z"),ge(c,"id","vn-a"),ge(_,"fill","#da251d"),ge(_,"d","M-128 0h768v512h-768z"),ge(v,"fill","#ff0"),ge(v,"d","M349.6 381 260 314.3l-89 67.3L204 272l-89-67.7 110.1-1 34.2-109.4L294 203l110.1.1-88.5 68.4 33.9 109.6z"),ge(m,"fill-rule","evenodd"),ge(m,"clip-path","url(#vn-a)"),ge(m,"transform","translate(80) scale(.9375)"),Qr(i,z)},m(F,U){oi(F,i,U),He(i,o),He(o,c),He(c,f),He(i,m),He(m,_),He(m,v),s||(S=[pt(i,"click",r[4]),pt(i,"keydown",r[5]),pt(i,"keyup",r[6]),pt(i,"focus",r[7]),pt(i,"blur",r[8]),pt(i,"mouseenter",r[9]),pt(i,"mouseleave",r[10]),pt(i,"mouseover",r[11]),pt(i,"mouseout",r[12])],s=!0)},p(F,[U]){Qr(i,z=$s(P,[{xmlns:"http://www.w3.org/2000/svg"},{id:"flag-icons-vn"},U&1&&{width:F[0]},U&1&&{height:F[0]},U&8&&F[3],U&2&&{role:F[1]},U&4&&{"aria-label":F[2]},{viewBox:"0 0 640 480"}]))},i:ln,o:ln,d(F){F&&Ee(i),s=!1,Qn(S)}}}function $V(r,i,o){const c=["size","role","ariaLabel"];let f=lr(i,c);const m=Wa("iconCtx")??{};let{size:_=m.size||"24"}=i,{role:v=m.role||"img"}=i,{ariaLabel:s="flag of vn"}=i;function S(ie){ii.call(this,r,ie)}function P(ie){ii.call(this,r,ie)}function z(ie){ii.call(this,r,ie)}function F(ie){ii.call(this,r,ie)}function U(ie){ii.call(this,r,ie)}function Z(ie){ii.call(this,r,ie)}function W(ie){ii.call(this,r,ie)}function Q(ie){ii.call(this,r,ie)}function re(ie){ii.call(this,r,ie)}return r.$$set=ie=>{i=cn(cn({},i),Fr(ie)),o(3,f=lr(i,c)),"size"in ie&&o(0,_=ie.size),"role"in ie&&o(1,v=ie.role),"ariaLabel"in ie&&o(2,s=ie.ariaLabel)},[_,v,s,f,S,P,z,F,U,Z,W,Q,re]}class Cj extends jr{constructor(i){super(),Vr(this,i,$V,QV,kr,{size:0,role:1,ariaLabel:2})}}export{cj as $,Zf as A,$D as B,Uf as C,MM as D,fj as E,He as F,pt as G,Hf as H,Wf as I,Gf as J,Xf as K,ln as L,wx as M,uj as N,mj as O,ij as P,yj as Q,ZA as R,jr as S,_j as T,xj as U,vj as V,WA as W,nj as X,rj as Y,Qn as Z,dj as _,Kn as a,ii as a0,AV as a1,Tj as a2,wj as a3,Ar as a4,sh as a5,Jm as a6,Oa as a7,rh as a8,sj as a9,tj as aa,Sj as ab,Mj as ac,kj as ad,Aj as ae,Cj as af,Ej as ag,Ij as ah,gj as ai,bj as aj,Ml as ak,hj as al,oi as b,Jn as c,__ as d,Sn as e,pr as f,Ee as g,lj as h,Vr as i,ci as j,_i as k,Xe as l,ge as m,EM as n,aj as o,In as p,Bn as q,Sr as r,kr as s,Nr as t,g_ as u,_o as v,oj as w,y_ as x,x_ as y,qf as z};
