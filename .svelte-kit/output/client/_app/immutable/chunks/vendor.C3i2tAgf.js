var KR=Object.defineProperty;var QR=(n,i,o)=>i in n?KR(n,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[i]=o;var ui=(n,i,o)=>(QR(n,typeof i!="symbol"?i+"":i,o),o);function Rn(){}const oP=n=>n;function zn(n,i){for(const o in i)n[o]=i[o];return n}function sP(n){return n()}function gE(){return Object.create(null)}function Br(n){n.forEach(sP)}function Dy(n){return typeof n=="function"}function Ao(n,i){return n!=n?i==i:n!==i||n&&typeof n=="object"||typeof n=="function"}let i_;function KW(n,i){return n===i?!0:(i_||(i_=document.createElement("a")),i_.href=i,n===i_.href)}function $R(n){return Object.keys(n).length===0}function aP(n,...i){if(n==null){for(const c of i)c(void 0);return Rn}const o=n.subscribe(...i);return o.unsubscribe?()=>o.unsubscribe():o}function Wx(n,i,o){n.$$.on_destroy.push(aP(i,o))}function cm(n,i,o,c){if(n){const h=lP(n,i,o,c);return n[0](h)}}function lP(n,i,o,c){return n[1]&&c?zn(o.ctx.slice(),n[1](c(i))):o.ctx}function um(n,i,o,c){if(n[2]&&c){const h=n[2](c(o));if(i.dirty===void 0)return h;if(typeof h=="object"){const p=[],g=Math.max(i.dirty.length,h.length);for(let x=0;x<g;x+=1)p[x]=i.dirty[x]|h[x];return p}return i.dirty|h}return i.dirty}function hm(n,i,o,c,h,p){if(h){const g=lP(i,o,c,p);n.p(g,h)}}function fm(n){if(n.ctx.length>32){const i=[],o=n.ctx.length/32;for(let c=0;c<o;c++)i[c]=-1;return i}return-1}function zo(n){const i={};for(const o in n)o[0]!=="$"&&(i[o]=n[o]);return i}function qr(n,i){const o={};i=new Set(i);for(const c in n)!i.has(c)&&c[0]!=="$"&&(o[c]=n[c]);return o}function QW(n,i,o){return n.set(o),i}function ez(n){return n&&Dy(n.destroy)?n.destroy:Rn}function qx(n){const i=typeof n=="string"&&n.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return i?[parseFloat(i[1]),i[2]||"px"]:[n,"px"]}const cP=typeof window<"u";let Zx=cP?()=>window.performance.now():()=>Date.now(),U1=cP?n=>requestAnimationFrame(n):Rn;const Lf=new Set;function uP(n){Lf.forEach(i=>{i.c(n)||(Lf.delete(i),i.f())}),Lf.size!==0&&U1(uP)}function hP(n){let i;return Lf.size===0&&U1(uP),{promise:new Promise(o=>{Lf.add(i={c:n,f:o})}),abort(){Lf.delete(i)}}}let Ly=!1;function tz(){Ly=!0}function iz(){Ly=!1}function nz(n,i,o,c){for(;n<i;){const h=n+(i-n>>1);o(h)<=c?n=h+1:i=h}return n}function rz(n){if(n.hydrate_init)return;n.hydrate_init=!0;let i=n.childNodes;if(n.nodeName==="HEAD"){const s=[];for(let M=0;M<i.length;M++){const C=i[M];C.claim_order!==void 0&&s.push(C)}i=s}const o=new Int32Array(i.length+1),c=new Int32Array(i.length);o[0]=-1;let h=0;for(let s=0;s<i.length;s++){const M=i[s].claim_order,C=(h>0&&i[o[h]].claim_order<=M?h+1:nz(1,h,F=>i[o[F]].claim_order,M))-1;c[s]=o[C]+1;const D=C+1;o[D]=s,h=Math.max(D,h)}const p=[],g=[];let x=i.length-1;for(let s=o[h]+1;s!=0;s=c[s-1]){for(p.push(i[s-1]);x>=s;x--)g.push(i[x]);x--}for(;x>=0;x--)g.push(i[x]);p.reverse(),g.sort((s,M)=>s.claim_order-M.claim_order);for(let s=0,M=0;s<g.length;s++){for(;M<p.length&&g[s].claim_order>=p[M].claim_order;)M++;const C=M<p.length?p[M]:null;n.insertBefore(g[s],C)}}function oz(n,i){n.appendChild(i)}function fP(n){if(!n)return document;const i=n.getRootNode?n.getRootNode():n.ownerDocument;return i&&i.host?i:n.ownerDocument}function sz(n){const i=Di("style");return i.textContent="/* empty */",az(fP(n),i),i.sheet}function az(n,i){return oz(n.head||n,i),i.sheet}function it(n,i){if(Ly){for(rz(n),(n.actual_end_child===void 0||n.actual_end_child!==null&&n.actual_end_child.parentNode!==n)&&(n.actual_end_child=n.firstChild);n.actual_end_child!==null&&n.actual_end_child.claim_order===void 0;)n.actual_end_child=n.actual_end_child.nextSibling;i!==n.actual_end_child?(i.claim_order!==void 0||i.parentNode!==n)&&n.insertBefore(i,n.actual_end_child):n.actual_end_child=i.nextSibling}else(i.parentNode!==n||i.nextSibling!==null)&&n.appendChild(i)}function lz(n,i,o){n.insertBefore(i,o||null)}function Ai(n,i,o){Ly&&!o?it(n,i):(i.parentNode!==n||i.nextSibling!=o)&&n.insertBefore(i,o||null)}function De(n){n.parentNode&&n.parentNode.removeChild(n)}function gc(n,i){for(let o=0;o<n.length;o+=1)n[o]&&n[o].d(i)}function Di(n){return document.createElement(n)}function Xt(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function fr(n){return document.createTextNode(n)}function zr(){return fr(" ")}function ar(){return fr("")}function Pt(n,i,o,c){return n.addEventListener(i,o,c),()=>n.removeEventListener(i,o,c)}function _E(n){return function(i){return i.preventDefault(),n.call(this,i)}}function $W(n){return function(i){return i.stopPropagation(),n.call(this,i)}}function eq(n){return function(i){i.target===this&&n.call(this,i)}}function xe(n,i,o){o==null?n.removeAttribute(i):n.getAttribute(i)!==o&&n.setAttribute(i,o)}const cz=["width","height"];function Vf(n,i){const o=Object.getOwnPropertyDescriptors(n.__proto__);for(const c in i)i[c]==null?n.removeAttribute(c):c==="style"?n.style.cssText=i[c]:c==="__value"?n.value=n[c]=i[c]:o[c]&&o[c].set&&cz.indexOf(c)===-1?n[c]=i[c]:xe(n,c,i[c])}function is(n,i){for(const o in i)xe(n,o,i[o])}function Ep(n,i,o){n.setAttributeNS("http://www.w3.org/1999/xlink",i,o)}function yE(n){return n.dataset.svelteH}function ot(n){return Array.from(n.childNodes)}function dP(n){n.claim_info===void 0&&(n.claim_info={last_index:0,total_claimed:0})}function pP(n,i,o,c,h=!1){dP(n);const p=(()=>{for(let g=n.claim_info.last_index;g<n.length;g++){const x=n[g];if(i(x)){const s=o(x);return s===void 0?n.splice(g,1):n[g]=s,h||(n.claim_info.last_index=g),x}}for(let g=n.claim_info.last_index-1;g>=0;g--){const x=n[g];if(i(x)){const s=o(x);return s===void 0?n.splice(g,1):n[g]=s,h?s===void 0&&n.claim_info.last_index--:n.claim_info.last_index=g,x}}return c()})();return p.claim_order=n.claim_info.total_claimed,n.claim_info.total_claimed+=1,p}function mP(n,i,o,c){return pP(n,h=>h.nodeName===i,h=>{const p=[];for(let g=0;g<h.attributes.length;g++){const x=h.attributes[g];o[x.name]||p.push(x.name)}p.forEach(g=>h.removeAttribute(g))},()=>c(i))}function Vi(n,i,o){return mP(n,i,o,Di)}function Kt(n,i,o){return mP(n,i,o,Xt)}function vr(n,i){return pP(n,o=>o.nodeType===3,o=>{const c=""+i;if(o.data.startsWith(c)){if(o.data.length!==c.length)return o.splitText(c.length)}else o.data=c},()=>fr(i),!0)}function Fr(n){return vr(n," ")}function vE(n,i,o){for(let c=o;c<n.length;c+=1){const h=n[c];if(h.nodeType===8&&h.textContent.trim()===i)return c}return-1}function Oy(n,i){const o=vE(n,"HTML_TAG_START",0),c=vE(n,"HTML_TAG_END",o+1);if(o===-1||c===-1)return new Sh(i);dP(n);const h=n.splice(o,c-o+1);De(h[0]),De(h[h.length-1]);const p=h.slice(1,h.length-1);if(p.length===0)return new Sh(i);for(const g of p)g.claim_order=n.claim_info.total_claimed,n.claim_info.total_claimed+=1;return new Sh(i,p)}function go(n,i){i=""+i,n.data!==i&&(n.data=i)}function Y_(n,i){i=""+i,n.wholeText!==i&&(n.data=i)}function Uf(n,i){n.value=i??""}function xE(n,i,o,c){o==null?n.style.removeProperty(i):n.style.setProperty(i,o,c?"important":"")}function n_(n,i,o){for(let c=0;c<n.options.length;c+=1){const h=n.options[c];if(h.__value===i){h.selected=!0;return}}(!o||i!==void 0)&&(n.selectedIndex=-1)}function tq(n){const i=n.querySelector(":checked");return i&&i.__value}function Ri(n,i,o){n.classList.toggle(i,!!o)}function gP(n,i,{bubbles:o=!1,cancelable:c=!1}={}){return new CustomEvent(n,{detail:i,bubbles:o,cancelable:c})}class uz{constructor(i=!1){ui(this,"is_svg",!1);ui(this,"e");ui(this,"n");ui(this,"t");ui(this,"a");this.is_svg=i,this.e=this.n=null}c(i){this.h(i)}m(i,o,c=null){this.e||(this.is_svg?this.e=Xt(o.nodeName):this.e=Di(o.nodeType===11?"TEMPLATE":o.nodeName),this.t=o.tagName!=="TEMPLATE"?o:o.content,this.c(i)),this.i(c)}h(i){this.e.innerHTML=i,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(i){for(let o=0;o<this.n.length;o+=1)lz(this.t,this.n[o],i)}p(i){this.d(),this.h(i),this.i(this.a)}d(){this.n.forEach(De)}}class Sh extends uz{constructor(o=!1,c){super(o);ui(this,"l");this.e=this.n=null,this.l=c}c(o){this.l?this.n=this.l:super.c(o)}i(o){for(let c=0;c<this.n.length;c+=1)Ai(this.t,this.n[c],o)}}function iq(n,i){return new n(i)}const J_=new Map;let K_=0;function hz(n){let i=5381,o=n.length;for(;o--;)i=(i<<5)-i^n.charCodeAt(o);return i>>>0}function fz(n,i){const o={stylesheet:sz(i),rules:{}};return J_.set(n,o),o}function bE(n,i,o,c,h,p,g,x=0){const s=16.666/c;let M=`{
`;for(let J=0;J<=1;J+=s){const $=i+(o-i)*p(J);M+=J*100+`%{${g($,1-$)}}
`}const C=M+`100% {${g(o,1-o)}}
}`,D=`__svelte_${hz(C)}_${x}`,F=fP(n),{stylesheet:V,rules:X}=J_.get(F)||fz(F,n);X[D]||(X[D]=!0,V.insertRule(`@keyframes ${D} ${C}`,V.cssRules.length));const W=n.style.animation||"";return n.style.animation=`${W?`${W}, `:""}${D} ${c}ms linear ${h}ms 1 both`,K_+=1,D}function dz(n,i){const o=(n.style.animation||"").split(", "),c=o.filter(i?p=>p.indexOf(i)<0:p=>p.indexOf("__svelte")===-1),h=o.length-c.length;h&&(n.style.animation=c.join(", "),K_-=h,K_||pz())}function pz(){U1(()=>{K_||(J_.forEach(n=>{const{ownerNode:i}=n.stylesheet;i&&De(i)}),J_.clear())})}let Zp;function zp(n){Zp=n}function ed(){if(!Zp)throw new Error("Function called outside component initialization");return Zp}function nq(n){ed().$$.on_mount.push(n)}function rq(n){ed().$$.after_update.push(n)}function oq(n){ed().$$.on_destroy.push(n)}function j1(){const n=ed();return(i,o,{cancelable:c=!1}={})=>{const h=n.$$.callbacks[i];if(h){const p=gP(i,o,{cancelable:c});return h.slice().forEach(g=>{g.call(n,p)}),!p.defaultPrevented}return!0}}function sq(n,i){return ed().$$.context.set(n,i),i}function Ec(n){return ed().$$.context.get(n)}function bi(n,i){const o=n.$$.callbacks[i.type];o&&o.slice().forEach(c=>c.call(this,i))}const Cf=[],Za=[];let Of=[];const Xx=[],_P=Promise.resolve();let Yx=!1;function yP(){Yx||(Yx=!0,_P.then(xP))}function mz(){return yP(),_P}function jf(n){Of.push(n)}function vP(n){Xx.push(n)}const ox=new Set;let wf=0;function xP(){if(wf!==0)return;const n=Zp;do{try{for(;wf<Cf.length;){const i=Cf[wf];wf++,zp(i),gz(i.$$)}}catch(i){throw Cf.length=0,wf=0,i}for(zp(null),Cf.length=0,wf=0;Za.length;)Za.pop()();for(let i=0;i<Of.length;i+=1){const o=Of[i];ox.has(o)||(ox.add(o),o())}Of.length=0}while(Cf.length);for(;Xx.length;)Xx.pop()();Yx=!1,ox.clear(),zp(n)}function gz(n){if(n.fragment!==null){n.update(),Br(n.before_update);const i=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,i),n.after_update.forEach(jf)}}function _z(n){const i=[],o=[];Of.forEach(c=>n.indexOf(c)===-1?i.push(c):o.push(c)),o.forEach(c=>c()),Of=i}let dp;function yz(){return dp||(dp=Promise.resolve(),dp.then(()=>{dp=null})),dp}function sx(n,i,o){n.dispatchEvent(gP(`${i?"intro":"outro"}${o}`))}const A_=new Set;let vc;function Ry(){vc={r:0,c:[],p:vc}}function zy(){vc.r||Br(vc.c),vc=vc.p}function no(n,i){n&&n.i&&(A_.delete(n),n.i(i))}function Fo(n,i,o,c){if(n&&n.o){if(A_.has(n))return;A_.add(n),vc.c.push(()=>{A_.delete(n),c&&(o&&n.d(1),c())}),n.o(i)}else c&&c()}const vz={duration:0};function Q_(n,i,o,c){let p=i(n,o,{direction:"both"}),g=c?0:1,x=null,s=null,M=null,C;function D(){M&&dz(n,M)}function F(X,W){const J=X.b-g;return W*=Math.abs(J),{a:g,b:X.b,d:J,duration:W,start:X.start,end:X.start+W,group:X.group}}function V(X){const{delay:W=0,duration:J=300,easing:$=oP,tick:ne=Rn,css:ye}=p||vz,pe={start:Zx()+W,b:X};X||(pe.group=vc,vc.r+=1),"inert"in n&&(X?C!==void 0&&(n.inert=C):(C=n.inert,n.inert=!0)),x||s?s=pe:(ye&&(D(),M=bE(n,g,X,J,W,$,ye)),X&&ne(0,1),x=F(pe,J),jf(()=>sx(n,X,"start")),hP(ke=>{if(s&&ke>s.start&&(x=F(s,J),s=null,sx(n,x.b,"start"),ye&&(D(),M=bE(n,g,x.b,x.duration,0,$,p.css))),x){if(ke>=x.end)ne(g=x.b,1-g),sx(n,x.b,"end"),s||(x.b?D():--x.group.r||Br(x.group.c)),x=null;else if(ke>=x.start){const Ae=ke-x.start;g=x.a+x.d*$(Ae/x.duration),ne(g,1-g)}}return!!(x||s)}))}return{run(X){Dy(p)?yz().then(()=>{p=p({direction:X?"in":"out"}),V(X)}):V(X)},end(){D(),x=s=null}}}function So(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function ba(n,i){const o={},c={},h={$$scope:1};let p=n.length;for(;p--;){const g=n[p],x=i[p];if(x){for(const s in g)s in x||(c[s]=1);for(const s in x)h[s]||(o[s]=x[s],h[s]=1);n[p]=x}else for(const s in g)h[s]=1}for(const g in c)g in o||(o[g]=void 0);return o}function xz(n){return typeof n=="object"&&n!==null?n:{}}function bP(n,i,o){const c=n.$$.props[i];c!==void 0&&(n.$$.bound[c]=o,o(n.$$.ctx[c]))}function Fy(n){n&&n.c()}function By(n,i){n&&n.l(i)}function dm(n,i,o){const{fragment:c,after_update:h}=n.$$;c&&c.m(i,o),jf(()=>{const p=n.$$.on_mount.map(sP).filter(Dy);n.$$.on_destroy?n.$$.on_destroy.push(...p):Br(p),n.$$.on_mount=[]}),h.forEach(jf)}function pm(n,i){const o=n.$$;o.fragment!==null&&(_z(o.after_update),Br(o.on_destroy),o.fragment&&o.fragment.d(i),o.on_destroy=o.fragment=null,o.ctx=[])}function bz(n,i){n.$$.dirty[0]===-1&&(Cf.push(n),yP(),n.$$.dirty.fill(0)),n.$$.dirty[i/31|0]|=1<<i%31}function Bo(n,i,o,c,h,p,g=null,x=[-1]){const s=Zp;zp(n);const M=n.$$={fragment:null,ctx:[],props:p,update:Rn,not_equal:h,bound:gE(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(s?s.$$.context:[])),callbacks:gE(),dirty:x,skip_bound:!1,root:i.target||s.$$.root};g&&g(M.root);let C=!1;if(M.ctx=o?o(n,i.props||{},(D,F,...V)=>{const X=V.length?V[0]:F;return M.ctx&&h(M.ctx[D],M.ctx[D]=X)&&(!M.skip_bound&&M.bound[D]&&M.bound[D](X),C&&bz(n,D)),F}):[],M.update(),C=!0,Br(M.before_update),M.fragment=c?c(M.ctx):!1,i.target){if(i.hydrate){tz();const D=ot(i.target);M.fragment&&M.fragment.l(D),D.forEach(De)}else M.fragment&&M.fragment.c();i.intro&&no(n.$$.fragment),dm(n,i.target,i.anchor),iz(),xP()}zp(s)}class No{constructor(){ui(this,"$$");ui(this,"$$set")}$destroy(){pm(this,1),this.$destroy=Rn}$on(i,o){if(!Dy(o))return Rn;const c=this.$$.callbacks[i]||(this.$$.callbacks[i]=[]);return c.push(o),()=>{const h=c.indexOf(o);h!==-1&&c.splice(h,1)}}$set(i){this.$$set&&!$R(i)&&(this.$$.skip_bound=!0,this.$$set(i),this.$$.skip_bound=!1)}}const wz="4";new URL("sveltekit-internal://");function Tz(n,i){return n==="/"||i==="ignore"?n:i==="never"?n.endsWith("/")?n.slice(0,-1):n:i==="always"&&!n.endsWith("/")?n+"/":n}function Sz(n){return n.split("%25").map(decodeURI).join("%25")}function Mz(n){for(const i in n)n[i]=decodeURIComponent(n[i]);return n}function ax({href:n}){return n.split("#")[0]}const Ez=["href","pathname","search","toString","toJSON"];function Az(n,i,o){const c=new URL(n);Object.defineProperty(c,"searchParams",{value:new Proxy(c.searchParams,{get(h,p){if(p==="get"||p==="getAll"||p==="has")return x=>(o(x),h[p](x));i();const g=Reflect.get(h,p);return typeof g=="function"?g.bind(h):g}}),enumerable:!0,configurable:!0});for(const h of Ez)Object.defineProperty(c,h,{get(){return i(),n[h]},enumerable:!0,configurable:!0});return c}const Iz="/__data.json",Cz=".html__data.json";function Pz(n){return n.endsWith(".html")?n.replace(/\.html$/,Cz):n.replace(/\/$/,"")+Iz}function kz(...n){let i=5381;for(const o of n)if(typeof o=="string"){let c=o.length;for(;c;)i=i*33^o.charCodeAt(--c)}else if(ArrayBuffer.isView(o)){const c=new Uint8Array(o.buffer,o.byteOffset,o.byteLength);let h=c.length;for(;h;)i=i*33^c[--h]}else throw new TypeError("value must be a string or TypedArray");return(i>>>0).toString(36)}function Dz(n){const i=atob(n),o=new Uint8Array(i.length);for(let c=0;c<i.length;c++)o[c]=i.charCodeAt(c);return o.buffer}const wP=window.fetch;window.fetch=(n,i)=>((n instanceof Request?n.method:(i==null?void 0:i.method)||"GET")!=="GET"&&Fp.delete(G1(n)),wP(n,i));const Fp=new Map;function Lz(n,i){const o=G1(n,i),c=document.querySelector(o);if(c!=null&&c.textContent){let{body:h,...p}=JSON.parse(c.textContent);const g=c.getAttribute("data-ttl");return g&&Fp.set(o,{body:h,init:p,ttl:1e3*Number(g)}),c.getAttribute("data-b64")!==null&&(h=Dz(h)),Promise.resolve(new Response(h,p))}return window.fetch(n,i)}function Oz(n,i,o){if(Fp.size>0){const c=G1(n,o),h=Fp.get(c);if(h){if(performance.now()<h.ttl&&["default","force-cache","only-if-cached",void 0].includes(o==null?void 0:o.cache))return new Response(h.body,h.init);Fp.delete(c)}}return window.fetch(i,o)}function G1(n,i){let c=`script[data-sveltekit-fetched][data-url=${JSON.stringify(n instanceof Request?n.url:n)}]`;if(i!=null&&i.headers||i!=null&&i.body){const h=[];i.headers&&h.push([...new Headers(i.headers)].join(",")),i.body&&(typeof i.body=="string"||ArrayBuffer.isView(i.body))&&h.push(i.body),c+=`[data-hash="${kz(...h)}"]`}return c}const Rz=/^(\[)?(\.\.\.)?(\w+)(?:=(\w+))?(\])?$/;function zz(n){const i=[];return{pattern:n==="/"?/^\/$/:new RegExp(`^${Bz(n).map(c=>{const h=/^\[\.\.\.(\w+)(?:=(\w+))?\]$/.exec(c);if(h)return i.push({name:h[1],matcher:h[2],optional:!1,rest:!0,chained:!0}),"(?:/(.*))?";const p=/^\[\[(\w+)(?:=(\w+))?\]\]$/.exec(c);if(p)return i.push({name:p[1],matcher:p[2],optional:!0,rest:!1,chained:!0}),"(?:/([^/]+))?";if(!c)return;const g=c.split(/\[(.+?)\](?!\])/);return"/"+g.map((s,M)=>{if(M%2){if(s.startsWith("x+"))return lx(String.fromCharCode(parseInt(s.slice(2),16)));if(s.startsWith("u+"))return lx(String.fromCharCode(...s.slice(2).split("-").map(W=>parseInt(W,16))));const C=Rz.exec(s),[,D,F,V,X]=C;return i.push({name:V,matcher:X,optional:!!D,rest:!!F,chained:F?M===1&&g[0]==="":!1}),F?"(.*?)":D?"([^/]*)?":"([^/]+?)"}return lx(s)}).join("")}).join("")}/?$`),params:i}}function Fz(n){return!/^\([^)]+\)$/.test(n)}function Bz(n){return n.slice(1).split("/").filter(Fz)}function Nz(n,i,o){const c={},h=n.slice(1),p=h.filter(x=>x!==void 0);let g=0;for(let x=0;x<i.length;x+=1){const s=i[x];let M=h[x-g];if(s.chained&&s.rest&&g&&(M=h.slice(x-g,x+1).filter(C=>C).join("/"),g=0),M===void 0){s.rest&&(c[s.name]="");continue}if(!s.matcher||o[s.matcher](M)){c[s.name]=M;const C=i[x+1],D=h[x+1];C&&!C.rest&&C.optional&&D&&s.chained&&(g=0),!C&&!D&&Object.keys(c).length===p.length&&(g=0);continue}if(s.optional&&s.chained){g++;continue}return}if(!g)return c}function lx(n){return n.normalize().replace(/[[\]]/g,"\\$&").replace(/%/g,"%25").replace(/\//g,"%2[Ff]").replace(/\?/g,"%3[Ff]").replace(/#/g,"%23").replace(/[.*+?^${}()|\\]/g,"\\$&")}function Vz({nodes:n,server_loads:i,dictionary:o,matchers:c}){const h=new Set(i);return Object.entries(o).map(([x,[s,M,C]])=>{const{pattern:D,params:F}=zz(x),V={id:x,exec:X=>{const W=D.exec(X);if(W)return Nz(W,F,c)},errors:[1,...C||[]].map(X=>n[X]),layouts:[0,...M||[]].map(g),leaf:p(s)};return V.errors.length=V.layouts.length=Math.max(V.errors.length,V.layouts.length),V});function p(x){const s=x<0;return s&&(x=~x),[s,n[x]]}function g(x){return x===void 0?x:[h.has(x),n[x]]}}function TP(n,i=JSON.parse){try{return i(sessionStorage[n])}catch{}}function wE(n,i,o=JSON.stringify){const c=o(i);try{sessionStorage[n]=c}catch{}}const Tf=[];function mm(n,i=Rn){let o;const c=new Set;function h(x){if(Ao(n,x)&&(n=x,o)){const s=!Tf.length;for(const M of c)M[1](),Tf.push(M,n);if(s){for(let M=0;M<Tf.length;M+=2)Tf[M][0](Tf[M+1]);Tf.length=0}}}function p(x){h(x(n))}function g(x,s=Rn){const M=[x,s];return c.add(M),c.size===1&&(o=i(h,p)||Rn),x(n),()=>{c.delete(M),c.size===0&&o&&(o(),o=null)}}return{set:h,update:p,subscribe:g}}var nP;const Ya=((nP=globalThis.__sveltekit_15ad6dz)==null?void 0:nP.base)??"";var rP;const Uz=((rP=globalThis.__sveltekit_15ad6dz)==null?void 0:rP.assets)??Ya,jz="1710354558971",SP="sveltekit:snapshot",MP="sveltekit:scroll",EP="sveltekit:states",Gz="sveltekit:pageurl",Rf="sveltekit:history",Xp="sveltekit:navigation",$_={tap:1,hover:2,viewport:3,eager:4,off:-1,false:-1},gm=location.origin;function AP(n){if(n instanceof URL)return n;let i=document.baseURI;if(!i){const o=document.getElementsByTagName("base");i=o.length?o[0].href:document.URL}return new URL(n,i)}function H1(){return{x:pageXOffset,y:pageYOffset}}function Sf(n,i){return n.getAttribute(`data-sveltekit-${i}`)}const TE={...$_,"":$_.hover};function IP(n){let i=n.assignedSlot??n.parentNode;return(i==null?void 0:i.nodeType)===11&&(i=i.host),i}function CP(n,i){for(;n&&n!==i;){if(n.nodeName.toUpperCase()==="A"&&n.hasAttribute("href"))return n;n=IP(n)}}function Jx(n,i){let o;try{o=new URL(n instanceof SVGAElement?n.href.baseVal:n.href,document.baseURI)}catch{}const c=n instanceof SVGAElement?n.target.baseVal:n.target,h=!o||!!c||Ny(o,i)||(n.getAttribute("rel")||"").split(/\s+/).includes("external"),p=(o==null?void 0:o.origin)===gm&&n.hasAttribute("download");return{url:o,external:h,target:c,download:p}}function ey(n){let i=null,o=null,c=null,h=null,p=null,g=null,x=n;for(;x&&x!==document.documentElement;)c===null&&(c=Sf(x,"preload-code")),h===null&&(h=Sf(x,"preload-data")),i===null&&(i=Sf(x,"keepfocus")),o===null&&(o=Sf(x,"noscroll")),p===null&&(p=Sf(x,"reload")),g===null&&(g=Sf(x,"replacestate")),x=IP(x);function s(M){switch(M){case"":case"true":return!0;case"off":case"false":return!1;default:return}}return{preload_code:TE[c??"off"],preload_data:TE[h??"off"],keepfocus:s(i),noscroll:s(o),reload:s(p),replace_state:s(g)}}function SE(n){const i=mm(n);let o=!0;function c(){o=!0,i.update(g=>g)}function h(g){o=!1,i.set(g)}function p(g){let x;return i.subscribe(s=>{(x===void 0||o&&s!==x)&&g(x=s)})}return{notify:c,set:h,subscribe:p}}function Hz(){const{set:n,subscribe:i}=mm(!1);let o;async function c(){clearTimeout(o);try{const h=await fetch(`${Uz}/_app/version.json`,{headers:{pragma:"no-cache","cache-control":"no-cache"}});if(!h.ok)return!1;const g=(await h.json()).version!==jz;return g&&(n(!0),clearTimeout(o)),g}catch{return!1}}return{subscribe:i,check:c}}function Ny(n,i){return n.origin!==gm||!n.pathname.startsWith(i)}const Wz=-1,qz=-2,Zz=-3,Xz=-4,Yz=-5,Jz=-6;function Kz(n,i){if(typeof n=="number")return h(n,!0);if(!Array.isArray(n)||n.length===0)throw new Error("Invalid input");const o=n,c=Array(o.length);function h(p,g=!1){if(p===Wz)return;if(p===Zz)return NaN;if(p===Xz)return 1/0;if(p===Yz)return-1/0;if(p===Jz)return-0;if(g)throw new Error("Invalid input");if(p in c)return c[p];const x=o[p];if(!x||typeof x!="object")c[p]=x;else if(Array.isArray(x))if(typeof x[0]=="string"){const s=x[0],M=i==null?void 0:i[s];if(M)return c[p]=M(h(x[1]));switch(s){case"Date":c[p]=new Date(x[1]);break;case"Set":const C=new Set;c[p]=C;for(let V=1;V<x.length;V+=1)C.add(h(x[V]));break;case"Map":const D=new Map;c[p]=D;for(let V=1;V<x.length;V+=2)D.set(h(x[V]),h(x[V+1]));break;case"RegExp":c[p]=new RegExp(x[1],x[2]);break;case"Object":c[p]=Object(x[1]);break;case"BigInt":c[p]=BigInt(x[1]);break;case"null":const F=Object.create(null);c[p]=F;for(let V=1;V<x.length;V+=2)F[x[V]]=h(x[V+1]);break;default:throw new Error(`Unknown type ${s}`)}}else{const s=new Array(x.length);c[p]=s;for(let M=0;M<x.length;M+=1){const C=x[M];C!==qz&&(s[M]=h(C))}}else{const s={};c[p]=s;for(const M in x){const C=x[M];s[M]=h(C)}}return c[p]}return h(0)}const PP=new Set(["load","prerender","csr","ssr","trailingSlash","config"]);[...PP];const Qz=new Set([...PP]);[...Qz];function $z(n){return n.filter(i=>i!=null)}class Vy{constructor(i,o){this.status=i,typeof o=="string"?this.body={message:o}:o?this.body=o:this.body={message:`Error: ${i}`}}toString(){return JSON.stringify(this.body)}}class kP{constructor(i,o){this.status=i,this.location=o}}class W1 extends Error{constructor(i,o,c){super(c),this.status=i,this.text=o}}const e4="x-sveltekit-invalidated",t4="x-sveltekit-trailing-slash";function ty(n){return n instanceof Vy||n instanceof W1?n.status:500}function i4(n){return n instanceof W1?n.text:"Internal Error"}const Ph=TP(MP)??{},Yp=TP(SP)??{},Tc={url:SE({}),page:SE({}),navigating:mm(null),updated:Hz()};function q1(n){Ph[n]=H1()}function n4(n,i){let o=n+1;for(;Ph[o];)delete Ph[o],o+=1;for(o=i+1;Yp[o];)delete Yp[o],o+=1}function Gf(n){return location.href=n.href,new Promise(()=>{})}function ME(){}let Uy,Kx,iy,yc,Qx,td;const DP=[],ny=[];let ga=null;const LP=[],r4=[];let kf=[],Ur={branch:[],error:null,url:null},Z1=!1,ry=!1,EE=!0,Jp=!1,pp=!1,OP=!1,X1=!1,Y1,es,ya,_a,oy;const Bp=new Set;async function aq(n,i,o){var h,p;document.URL!==location.href&&(location.href=location.href),td=n,Uy=Vz(n),yc=document.documentElement,Qx=i,Kx=n.nodes[0],iy=n.nodes[1],Kx(),iy(),es=(h=history.state)==null?void 0:h[Rf],ya=(p=history.state)==null?void 0:p[Xp],es||(es=ya=Date.now(),history.replaceState({...history.state,[Rf]:es,[Xp]:ya},""));const c=Ph[es];c&&(history.scrollRestoration="manual",scrollTo(c.x,c.y)),o?await f4(Qx,o):u4(location.href,{replaceState:!0}),h4()}function o4(){DP.length=0,X1=!1}function RP(n){ny.some(i=>i==null?void 0:i.snapshot)&&(Yp[n]=ny.map(i=>{var o;return(o=i==null?void 0:i.snapshot)==null?void 0:o.capture()}))}function zP(n){var i;(i=Yp[n])==null||i.forEach((o,c)=>{var h,p;(p=(h=ny[c])==null?void 0:h.snapshot)==null||p.restore(o)})}function AE(){q1(es),wE(MP,Ph),RP(ya),wE(SP,Yp)}async function FP(n,i,o,c){return I_({type:"goto",url:AP(n),keepfocus:i.keepFocus,noscroll:i.noScroll,replace_state:i.replaceState,state:i.state,redirect_count:o,nav_token:c,accept:()=>{i.invalidateAll&&(X1=!0)}})}async function s4(n){if(n.id!==(ga==null?void 0:ga.id)){const i={};Bp.add(i),ga={id:n.id,token:i,promise:NP({...n,preload:i}).then(o=>(Bp.delete(i),o.type==="loaded"&&o.state.error&&(ga=null),o))}}return ga.promise}async function cx(n){const i=Uy.find(o=>o.exec(VP(n)));i&&await Promise.all([...i.layouts,i.leaf].map(o=>o==null?void 0:o[1]()))}function BP(n,i){var h;Ur=n.state;const o=document.querySelector("style[data-sveltekit]");o&&o.remove(),_a=n.props.page,Y1=new td.root({target:i,props:{...n.props,stores:Tc,components:ny},hydrate:!0}),zP(ya);const c={from:null,to:{params:Ur.params,route:{id:((h=Ur.route)==null?void 0:h.id)??null},url:new URL(location.href)},willUnload:!1,type:"enter",complete:Promise.resolve()};kf.forEach(p=>p(c)),ry=!0}async function sy({url:n,params:i,branch:o,status:c,error:h,route:p,form:g}){let x="never";if(Ya&&(n.pathname===Ya||n.pathname===Ya+"/"))x="always";else for(const V of o)(V==null?void 0:V.slash)!==void 0&&(x=V.slash);n.pathname=Tz(n.pathname,x),n.search=n.search;const s={type:"loaded",state:{url:n,params:i,branch:o,error:h,route:p},props:{constructors:$z(o).map(V=>V.node.component),page:_a}};g!==void 0&&(s.props.form=g);let M={},C=!_a,D=0;for(let V=0;V<Math.max(o.length,Ur.branch.length);V+=1){const X=o[V],W=Ur.branch[V];(X==null?void 0:X.data)!==(W==null?void 0:W.data)&&(C=!0),X&&(M={...M,...X.data},C&&(s.props[`data_${D}`]=M),D+=1)}return(!Ur.url||n.href!==Ur.url.href||Ur.error!==h||g!==void 0&&g!==_a.form||C)&&(s.props.page={error:h,params:i,route:{id:(p==null?void 0:p.id)??null},state:{},status:c,url:new URL(n),form:g??null,data:C?M:_a.data}),s}async function J1({loader:n,parent:i,url:o,params:c,route:h,server_data_node:p}){var C,D,F;let g=null,x=!0;const s={dependencies:new Set,params:new Set,parent:!1,route:!1,url:!1,search_params:new Set},M=await n();if((C=M.universal)!=null&&C.load){let V=function(...W){for(const J of W){const{href:$}=new URL(J,o);s.dependencies.add($)}};const X={route:new Proxy(h,{get:(W,J)=>(x&&(s.route=!0),W[J])}),params:new Proxy(c,{get:(W,J)=>(x&&s.params.add(J),W[J])}),data:(p==null?void 0:p.data)??null,url:Az(o,()=>{x&&(s.url=!0)},W=>{x&&s.search_params.add(W)}),async fetch(W,J){let $;W instanceof Request?($=W.url,J={body:W.method==="GET"||W.method==="HEAD"?void 0:await W.blob(),cache:W.cache,credentials:W.credentials,headers:W.headers,integrity:W.integrity,keepalive:W.keepalive,method:W.method,mode:W.mode,redirect:W.redirect,referrer:W.referrer,referrerPolicy:W.referrerPolicy,signal:W.signal,...J}):$=W;const ne=new URL($,o);return x&&V(ne.href),ne.origin===o.origin&&($=ne.href.slice(o.origin.length)),ry?Oz($,ne.href,J):Lz($,J)},setHeaders:()=>{},depends:V,parent(){return x&&(s.parent=!0),i()},untrack(W){x=!1;try{return W()}finally{x=!0}}};g=await M.universal.load.call(null,X)??null}return{node:M,loader:n,server:p,universal:(D=M.universal)!=null&&D.load?{type:"data",data:g,uses:s}:null,data:g??(p==null?void 0:p.data)??null,slash:((F=M.universal)==null?void 0:F.trailingSlash)??(p==null?void 0:p.slash)}}function IE(n,i,o,c,h,p){if(X1)return!0;if(!h)return!1;if(h.parent&&n||h.route&&i||h.url&&o)return!0;for(const g of h.search_params)if(c.has(g))return!0;for(const g of h.params)if(p[g]!==Ur.params[g])return!0;for(const g of h.dependencies)if(DP.some(x=>x(new URL(g))))return!0;return!1}function K1(n,i){return(n==null?void 0:n.type)==="data"?n:(n==null?void 0:n.type)==="skip"?i??null:null}function a4(n,i){if(!n)return new Set(i.searchParams.keys());const o=new Set([...n.searchParams.keys(),...i.searchParams.keys()]);for(const c of o){const h=n.searchParams.getAll(c),p=i.searchParams.getAll(c);h.every(g=>p.includes(g))&&p.every(g=>h.includes(g))&&o.delete(c)}return o}function CE({error:n,url:i,route:o,params:c}){return{type:"loaded",state:{error:n,url:i,route:o,params:c,branch:[]},props:{page:_a,constructors:[]}}}async function NP({id:n,invalidating:i,url:o,params:c,route:h,preload:p}){if((ga==null?void 0:ga.id)===n)return Bp.delete(ga.token),ga.promise;const{errors:g,layouts:x,leaf:s}=h,M=[...x,s];g.forEach(pe=>pe==null?void 0:pe().catch(()=>{})),M.forEach(pe=>pe==null?void 0:pe[1]().catch(()=>{}));let C=null;const D=Ur.url?n!==Ur.url.pathname+Ur.url.search:!1,F=Ur.route?h.id!==Ur.route.id:!1,V=a4(Ur.url,o);let X=!1;const W=M.map((pe,ke)=>{var pt;const Ae=Ur.branch[ke],tt=!!(pe!=null&&pe[0])&&((Ae==null?void 0:Ae.loader)!==pe[1]||IE(X,F,D,V,(pt=Ae.server)==null?void 0:pt.uses,c));return tt&&(X=!0),tt});if(W.some(Boolean)){try{C=await GP(o,W)}catch(pe){const ke=await zf(pe,{url:o,params:c,route:{id:n}});return Bp.has(p)?CE({error:ke,url:o,params:c,route:h}):jy({status:ty(pe),error:ke,url:o,route:h})}if(C.type==="redirect")return C}const J=C==null?void 0:C.nodes;let $=!1;const ne=M.map(async(pe,ke)=>{var kt;if(!pe)return;const Ae=Ur.branch[ke],tt=J==null?void 0:J[ke];if((!tt||tt.type==="skip")&&pe[1]===(Ae==null?void 0:Ae.loader)&&!IE($,F,D,V,(kt=Ae.universal)==null?void 0:kt.uses,c))return Ae;if($=!0,(tt==null?void 0:tt.type)==="error")throw tt;return J1({loader:pe[1],url:o,params:c,route:h,parent:async()=>{var Et;const Ie={};for(let mt=0;mt<ke;mt+=1)Object.assign(Ie,(Et=await ne[mt])==null?void 0:Et.data);return Ie},server_data_node:K1(tt===void 0&&pe[0]?{type:"skip"}:tt??null,pe[0]?Ae==null?void 0:Ae.server:void 0)})});for(const pe of ne)pe.catch(()=>{});const ye=[];for(let pe=0;pe<M.length;pe+=1)if(M[pe])try{ye.push(await ne[pe])}catch(ke){if(ke instanceof kP)return{type:"redirect",location:ke.location};if(Bp.has(p))return CE({error:await zf(ke,{params:c,url:o,route:{id:h.id}}),url:o,params:c,route:h});let Ae=ty(ke),tt;if(J!=null&&J.includes(ke))Ae=ke.status??Ae,tt=ke.error;else if(ke instanceof Vy)tt=ke.body;else{if(await Tc.updated.check())return await Gf(o);tt=await zf(ke,{params:c,url:o,route:{id:h.id}})}const pt=await l4(pe,ye,g);return pt?await sy({url:o,params:c,branch:ye.slice(0,pt.idx).concat(pt.node),status:Ae,error:tt,route:h}):await jP(o,{id:h.id},tt,Ae)}else ye.push(void 0);return await sy({url:o,params:c,branch:ye,status:200,error:null,route:h,form:i?void 0:null})}async function l4(n,i,o){for(;n--;)if(o[n]){let c=n;for(;!i[c];)c-=1;try{return{idx:c+1,node:{node:await o[n](),loader:o[n],data:{},server:null,universal:null}}}catch{continue}}}async function jy({status:n,error:i,url:o,route:c}){const h={};let p=null;if(td.server_loads[0]===0)try{const M=await GP(o,[!0]);if(M.type!=="data"||M.nodes[0]&&M.nodes[0].type!=="data")throw 0;p=M.nodes[0]??null}catch{(o.origin!==gm||o.pathname!==location.pathname||Z1)&&await Gf(o)}const x=await J1({loader:Kx,url:o,params:h,route:c,parent:()=>Promise.resolve({}),server_data_node:K1(p)}),s={node:await iy(),loader:iy,universal:null,server:null,data:null};return await sy({url:o,params:h,branch:[x,s],status:n,error:i,route:null})}function Q1(n,i){if(!n||Ny(n,Ya))return;let o;try{o=td.hooks.reroute({url:new URL(n)})??n.pathname}catch{return}const c=VP(o);for(const h of Uy){const p=h.exec(c);if(p)return{id:n.pathname+n.search,invalidating:i,route:h,params:Mz(p),url:n}}}function VP(n){return Sz(n.slice(Ya.length)||"/")}function UP({url:n,type:i,intent:o,delta:c}){let h=!1;const p=WP(Ur,o,n,i);c!==void 0&&(p.navigation.delta=c);const g={...p.navigation,cancel:()=>{h=!0,p.reject(new Error("navigation cancelled"))}};return Jp||LP.forEach(x=>x(g)),h?null:p}async function I_({type:n,url:i,popped:o,keepfocus:c,noscroll:h,replace_state:p,state:g={},redirect_count:x=0,nav_token:s={},accept:M=ME,block:C=ME}){const D=Q1(i,!1),F=UP({url:i,type:n,delta:o==null?void 0:o.delta,intent:D});if(!F){C();return}const V=es,X=ya;M(),Jp=!0,ry&&Tc.navigating.set(F.navigation),oy=s;let W=D&&await NP(D);if(!W){if(Ny(i,Ya))return await Gf(i);W=await jP(i,{id:null},await zf(new W1(404,"Not Found",`Not found: ${i.pathname}`),{url:i,params:{},route:{id:null}}),404)}if(i=(D==null?void 0:D.url)||i,oy!==s)return F.reject(new Error("navigation aborted")),!1;if(W.type==="redirect")if(x>=20)W=await jy({status:500,error:await zf(new Error("Redirect loop"),{url:i,params:{},route:{id:null}}),url:i,route:{id:null}});else return FP(new URL(W.location,i).href,{},x+1,s),!1;else W.props.page.status>=400&&await Tc.updated.check()&&await Gf(i);if(o4(),q1(V),RP(X),W.props.page.url.pathname!==i.pathname&&(i.pathname=W.props.page.url.pathname),g=o?o.state:g,!o){const ye=p?0:1,pe={[Rf]:es+=ye,[Xp]:ya+=ye,[EP]:g};(p?history.replaceState:history.pushState).call(history,pe,"",i),p||n4(es,ya)}if(ga=null,W.props.page.state=g,ry){Ur=W.state,W.props.page&&(W.props.page.url=i);const ye=(await Promise.all(r4.map(pe=>pe(F.navigation)))).filter(pe=>typeof pe=="function");if(ye.length>0){let pe=function(){kf=kf.filter(ke=>!ye.includes(ke))};ye.push(pe),kf.push(...ye)}Y1.$set(W.props),OP=!0}else BP(W,Qx);const{activeElement:J}=document;await mz();const $=o?o.scroll:h?H1():null;if(EE){const ye=i.hash&&document.getElementById(decodeURIComponent(i.hash.slice(1)));$?scrollTo($.x,$.y):ye?ye.scrollIntoView():scrollTo(0,0)}const ne=document.activeElement!==J&&document.activeElement!==document.body;!c&&!ne&&d4(),EE=!0,W.props.page&&(_a=W.props.page),Jp=!1,n==="popstate"&&zP(ya),F.fulfil(void 0),kf.forEach(ye=>ye(F.navigation)),Tc.navigating.set(null)}async function jP(n,i,o,c){return n.origin===gm&&n.pathname===location.pathname&&!Z1?await jy({status:c,error:o,url:n,route:i}):await Gf(n)}function c4(){let n;yc.addEventListener("mousemove",p=>{const g=p.target;clearTimeout(n),n=setTimeout(()=>{c(g,2)},20)});function i(p){c(p.composedPath()[0],1)}yc.addEventListener("mousedown",i),yc.addEventListener("touchstart",i,{passive:!0});const o=new IntersectionObserver(p=>{for(const g of p)g.isIntersecting&&(cx(g.target.href),o.unobserve(g.target))},{threshold:0});function c(p,g){const x=CP(p,yc);if(!x)return;const{url:s,external:M,download:C}=Jx(x,Ya);if(M||C)return;const D=ey(x);if(!D.reload)if(g<=D.preload_data){const F=Q1(s,!1);F&&s4(F)}else g<=D.preload_code&&cx(s.pathname)}function h(){o.disconnect();for(const p of yc.querySelectorAll("a")){const{url:g,external:x,download:s}=Jx(p,Ya);if(x||s)continue;const M=ey(p);M.reload||(M.preload_code===$_.viewport&&o.observe(p),M.preload_code===$_.eager&&cx(g.pathname))}}kf.push(h),h()}function zf(n,i){if(n instanceof Vy)return n.body;const o=ty(n),c=i4(n);return td.hooks.handleError({error:n,event:i,status:o,message:c})??{message:c}}function u4(n,i={}){return n=AP(n),n.origin!==gm?Promise.reject(new Error("goto: invalid URL")):FP(n,i,0)}function h4(){var i;history.scrollRestoration="manual",addEventListener("beforeunload",o=>{let c=!1;if(AE(),!Jp){const h=WP(Ur,void 0,null,"leave"),p={...h.navigation,cancel:()=>{c=!0,h.reject(new Error("navigation cancelled"))}};LP.forEach(g=>g(p))}c?(o.preventDefault(),o.returnValue=""):history.scrollRestoration="auto"}),addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&AE()}),(i=navigator.connection)!=null&&i.saveData||c4(),yc.addEventListener("click",o=>{var F;if(o.button||o.which!==1||o.metaKey||o.ctrlKey||o.shiftKey||o.altKey||o.defaultPrevented)return;const c=CP(o.composedPath()[0],yc);if(!c)return;const{url:h,external:p,target:g,download:x}=Jx(c,Ya);if(!h)return;if(g==="_parent"||g==="_top"){if(window.parent!==window)return}else if(g&&g!=="_self")return;const s=ey(c);if(!(c instanceof SVGAElement)&&h.protocol!==location.protocol&&!(h.protocol==="https:"||h.protocol==="http:")||x)return;if(p||s.reload){UP({url:h,type:"link"})?Jp=!0:o.preventDefault();return}const[C,D]=h.href.split("#");if(D!==void 0&&C===ax(location)){const[,V]=Ur.url.href.split("#");if(V===D){o.preventDefault(),D===""||D==="top"&&c.ownerDocument.getElementById("top")===null?window.scrollTo({top:0}):(F=c.ownerDocument.getElementById(D))==null||F.scrollIntoView();return}if(pp=!0,q1(es),n(h),!s.replace_state)return;pp=!1}o.preventDefault(),I_({type:"link",url:h,keepfocus:s.keepfocus,noscroll:s.noscroll,replace_state:s.replace_state??h.href===location.href})}),yc.addEventListener("submit",o=>{if(o.defaultPrevented)return;const c=HTMLFormElement.prototype.cloneNode.call(o.target),h=o.submitter;if(((h==null?void 0:h.formMethod)||c.method)!=="get")return;const g=new URL((h==null?void 0:h.hasAttribute("formaction"))&&(h==null?void 0:h.formAction)||c.action);if(Ny(g,Ya))return;const x=o.target,s=ey(x);if(s.reload)return;o.preventDefault(),o.stopPropagation();const M=new FormData(x),C=h==null?void 0:h.getAttribute("name");C&&M.append(C,(h==null?void 0:h.getAttribute("value"))??""),g.search=new URLSearchParams(M).toString(),I_({type:"form",url:g,keepfocus:s.keepfocus,noscroll:s.noscroll,replace_state:s.replace_state??g.href===location.href})}),addEventListener("popstate",async o=>{var c;if((c=o.state)!=null&&c[Rf]){const h=o.state[Rf];if(oy={},h===es)return;const p=Ph[h],g=o.state[EP]??{},x=new URL(o.state[Gz]??location.href),s=o.state[Xp],M=ax(location)===ax(Ur.url);if(s===ya&&(OP||M)){n(x),Ph[es]=H1(),p&&scrollTo(p.x,p.y),g!==_a.state&&(_a={..._a,state:g},Y1.$set({page:_a})),es=h;return}const D=h-es;await I_({type:"popstate",url:x,popped:{state:g,scroll:p,delta:D},accept:()=>{es=h,ya=s},block:()=>{history.go(-D)},nav_token:oy})}else if(!pp){const h=new URL(location.href);n(h)}}),addEventListener("hashchange",()=>{pp&&(pp=!1,history.replaceState({...history.state,[Rf]:++es,[Xp]:ya},"",location.href))});for(const o of document.querySelectorAll("link"))o.rel==="icon"&&(o.href=o.href);addEventListener("pageshow",o=>{o.persisted&&Tc.navigating.set(null)});function n(o){Ur.url=o,Tc.page.set({..._a,url:o}),Tc.page.notify()}}async function f4(n,{status:i=200,error:o,node_ids:c,params:h,route:p,data:g,form:x}){Z1=!0;const s=new URL(location.href);({params:h={},route:p={id:null}}=Q1(s,!1)||{});let M;try{const C=c.map(async(V,X)=>{const W=g[X];return W!=null&&W.uses&&(W.uses=HP(W.uses)),J1({loader:td.nodes[V],url:s,params:h,route:p,parent:async()=>{const J={};for(let $=0;$<X;$+=1)Object.assign(J,(await C[$]).data);return J},server_data_node:K1(W)})}),D=await Promise.all(C),F=Uy.find(({id:V})=>V===p.id);if(F){const V=F.layouts;for(let X=0;X<V.length;X++)V[X]||D.splice(X,0,void 0)}M=await sy({url:s,params:h,branch:D,status:i,error:o,form:x,route:F??null})}catch(C){if(C instanceof kP){await Gf(new URL(C.location,location.href));return}M=await jy({status:ty(C),error:await zf(C,{url:s,params:h,route:p}),url:s,route:p})}M.props.page&&(M.props.page.state={}),BP(M,n)}async function GP(n,i){var h;const o=new URL(n);o.pathname=Pz(n.pathname),n.pathname.endsWith("/")&&o.searchParams.append(t4,"1"),o.searchParams.append(e4,i.map(p=>p?"1":"0").join(""));const c=await wP(o.href);if(!c.ok){let p;throw(h=c.headers.get("content-type"))!=null&&h.includes("application/json")?p=await c.json():c.status===404?p="Not Found":c.status===500&&(p="Internal Error"),new Vy(c.status,p)}return new Promise(async p=>{var D;const g=new Map,x=c.body.getReader(),s=new TextDecoder;function M(F){return Kz(F,{Promise:V=>new Promise((X,W)=>{g.set(V,{fulfil:X,reject:W})})})}let C="";for(;;){const{done:F,value:V}=await x.read();if(F&&!C)break;for(C+=!V&&C?`
`:s.decode(V,{stream:!0});;){const X=C.indexOf(`
`);if(X===-1)break;const W=JSON.parse(C.slice(0,X));if(C=C.slice(X+1),W.type==="redirect")return p(W);if(W.type==="data")(D=W.nodes)==null||D.forEach(J=>{(J==null?void 0:J.type)==="data"&&(J.uses=HP(J.uses),J.data=M(J.data))}),p(W);else if(W.type==="chunk"){const{id:J,data:$,error:ne}=W,ye=g.get(J);g.delete(J),ne?ye.reject(M(ne)):ye.fulfil(M($))}}}})}function HP(n){return{dependencies:new Set((n==null?void 0:n.dependencies)??[]),params:new Set((n==null?void 0:n.params)??[]),parent:!!(n!=null&&n.parent),route:!!(n!=null&&n.route),url:!!(n!=null&&n.url),search_params:new Set((n==null?void 0:n.search_params)??[])}}function d4(){const n=document.querySelector("[autofocus]");if(n)n.focus();else{const i=document.body,o=i.getAttribute("tabindex");i.tabIndex=-1,i.focus({preventScroll:!0,focusVisible:!1}),o!==null?i.setAttribute("tabindex",o):i.removeAttribute("tabindex");const c=getSelection();if(c&&c.type!=="None"){const h=[];for(let p=0;p<c.rangeCount;p+=1)h.push(c.getRangeAt(p));setTimeout(()=>{if(c.rangeCount===h.length){for(let p=0;p<c.rangeCount;p+=1){const g=h[p],x=c.getRangeAt(p);if(g.commonAncestorContainer!==x.commonAncestorContainer||g.startContainer!==x.startContainer||g.endContainer!==x.endContainer||g.startOffset!==x.startOffset||g.endOffset!==x.endOffset)return}c.removeAllRanges()}})}}}function WP(n,i,o,c){var s,M;let h,p;const g=new Promise((C,D)=>{h=C,p=D});return g.catch(()=>{}),{navigation:{from:{params:n.params,route:{id:((s=n.route)==null?void 0:s.id)??null},url:n.url},to:o&&{params:(i==null?void 0:i.params)??null,route:{id:((M=i==null?void 0:i.route)==null?void 0:M.id)??null},url:o},willUnload:!i,type:c,complete:g},fulfil:h,reject:p}}const p4="modulepreload",m4=function(n,i){return new URL(n,i).href},PE={},lq=function(i,o,c){let h=Promise.resolve();if(o&&o.length>0){const p=document.getElementsByTagName("link");h=Promise.all(o.map(g=>{if(g=m4(g,c),g in PE)return;PE[g]=!0;const x=g.endsWith(".css"),s=x?'[rel="stylesheet"]':"";if(!!c)for(let D=p.length-1;D>=0;D--){const F=p[D];if(F.href===g&&(!x||F.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${g}"]${s}`))return;const C=document.createElement("link");if(C.rel=x?"stylesheet":p4,x||(C.as="script",C.crossOrigin=""),C.href=g,document.head.appendChild(C),x)return new Promise((D,F)=>{C.addEventListener("load",D),C.addEventListener("error",()=>F(new Error(`Unable to preload CSS for ${g}`)))})}))}return h.then(()=>i()).catch(p=>{const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=p,window.dispatchEvent(g),!g.defaultPrevented)throw p})};typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(wz);const g4=()=>{const n=Tc;return{page:{subscribe:n.page.subscribe},navigating:{subscribe:n.navigating.subscribe},updated:n.updated}},_4={subscribe(n){return g4().page.subscribe(n)}};function y4(n){var s;let i,o=n[0].status+"",c,h,p,g=((s=n[0].error)==null?void 0:s.message)+"",x;return{c(){i=Di("h1"),c=fr(o),h=zr(),p=Di("p"),x=fr(g)},l(M){i=Vi(M,"H1",{});var C=ot(i);c=vr(C,o),C.forEach(De),h=Fr(M),p=Vi(M,"P",{});var D=ot(p);x=vr(D,g),D.forEach(De)},m(M,C){Ai(M,i,C),it(i,c),Ai(M,h,C),Ai(M,p,C),it(p,x)},p(M,[C]){var D;C&1&&o!==(o=M[0].status+"")&&go(c,o),C&1&&g!==(g=((D=M[0].error)==null?void 0:D.message)+"")&&go(x,g)},i:Rn,o:Rn,d(M){M&&(De(i),De(h),De(p))}}}function v4(n,i,o){let c;return Wx(n,_4,h=>o(0,c=h)),[c]}let cq=class extends No{constructor(i){super(),Bo(this,i,v4,y4,Ao,{})}};var vh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qP(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function x4(n){if(n.__esModule)return n;var i=n.default;if(typeof i=="function"){var o=function c(){return this instanceof c?Reflect.construct(i,arguments,this.constructor):i.apply(this,arguments)};o.prototype=i.prototype}else o={};return Object.defineProperty(o,"__esModule",{value:!0}),Object.keys(n).forEach(function(c){var h=Object.getOwnPropertyDescriptor(n,c);Object.defineProperty(o,c,h.get?h:{enumerable:!0,get:function(){return n[c]}})}),o}var ZP={exports:{}};(function(n,i){var o={};(function(c,h){n.exports=h()})(vh,function(){var c,h,p;function g(s,M){if(!c)c=M;else if(!h)h=M;else{var C="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+c+")(sharedChunk); ("+h+")(sharedChunk); self.onerror = null;",D={};c(D),p=M(D),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(p.workerUrl=window.URL.createObjectURL(new Blob([C],{type:"text/javascript"})))}}g(["exports"],function(s){var M="3.2.0";let C;const D={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(C==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{C=o.API_URL_REGEX!=null?new RegExp(o.API_URL_REGEX):t}catch{C=t}}return C},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!D.API_URL)return null;try{const t=new URL(D.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},F={supported:!1,testSupport:function(t){!W&&X&&(J?ne(t):V=t)}};let V,X,W=!1,J=!1;const $=typeof self<"u"?self:{};function ne(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,X),t.isContextLost())return;F.supported=!0}catch{}t.deleteTexture(e),W=!0}$.document&&(X=$.document.createElement("img"),X.onload=function(){V&&ne(V),V=null,J=!0},X.onerror=function(){W=!0,V=null},X.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ye="01";function pe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ke=Ae;function Ae(t,e,r,a){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=r,this.p2y=a}Ae.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var r=t,a=0;a<8;a++){var u=this.sampleCurveX(r)-t;if(Math.abs(u)<e)return r;var d=this.sampleCurveDerivativeX(r);if(Math.abs(d)<1e-6)break;r-=u/d}var m=0,y=1;for(r=t,a=0;a<20&&(u=this.sampleCurveX(r),!(Math.abs(u-t)<e));a++)t>u?m=r:y=r,r=.5*(y-m)+m;return r},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var tt=pe(ke),pt=kt;function kt(t,e){this.x=t,this.y=e}kt.prototype={clone:function(){return new kt(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround:function(t,e){var r=Math.cos(t),a=Math.sin(t),u=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},kt.convert=function(t){return t instanceof kt?t:Array.isArray(t)?new kt(t[0],t[1]):t};var Ie=pe(pt);const Et=Math.PI/180,mt=180/Math.PI;function Xe(t){return t*Et}function Tt(t){return t*mt}const Yt=[[0,0],[1,0],[1,1],[0,1]];function mi(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)}function Ti(t,e,r,a){const u=new tt(t,e,r,a);return function(d){return u.solve(d)}}const Zi=Ti(.25,.1,.25,1);function wt(t,e,r){return Math.min(r,Math.max(e,t))}function Ii(t,e,r){return(r=wt((r-t)/(e-t),0,1))*r*(3-2*r)}function Ui(t,e,r){const a=r-e,u=((t-e)%a+a)%a+e;return u===e?r:u}function Mi(t,e,r){if(!t.length)return r(null,[]);let a=t.length;const u=new Array(t.length);let d=null;t.forEach((m,y)=>{e(m,(b,T)=>{b&&(d=b),u[y]=T,--a==0&&r(d,u)})})}function st(t){const e=[];for(const r in t)e.push(t[r]);return e}function rt(t,...e){for(const r of e)for(const a in r)t[a]=r[a];return t}let zi=1;function Si(){return zi++}function bn(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function nn(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function hn(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Ze(t,e){t.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function wn(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Sr(t,e,r){const a={};for(const u in t)a[u]=e.call(r||this,t[u],u,t);return a}function Mr(t,e,r){const a={};for(const u in t)e.call(r||this,t[u],u,t)&&(a[u]=t[u]);return a}function cn(t){return Array.isArray(t)?t.map(cn):typeof t=="object"&&t?Sr(t,cn):t}const Bt={};function si(t){Bt[t]||(typeof console<"u"&&console.warn(t),Bt[t]=!0)}function je(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function re(t){let e=0;for(let r,a,u=0,d=t.length,m=d-1;u<d;m=u++)r=t[u],a=t[m],e+=(a.x-r.x)*(r.y+a.y);return e}function fe([t,e,r]){const a=Xe(e+90),u=Xe(r);return{x:t*Math.cos(a)*Math.sin(u),y:t*Math.sin(a)*Math.sin(u),z:t*Math.cos(u),azimuthal:e,polar:r}}function Ee(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function dt(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,u,d)=>{const m=u||d;return e[a]=!m||m.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let ft=null;function Ut(t){try{const e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Wt(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function at(t,e,r,a){for(;e<r;){const u=e+r>>1;t[u]<a?e=u+1:r=u}return e}function Zt(t,e,r,a){for(;e<r;){const u=e+r>>1;t[u]<=a?e=u+1:r=u}return e}const Gt="mapbox-tiles";let qt=500,rn=50,Bi,qn;function _n(){try{return caches}catch{}}function Tn(){const t=_n();t&&!Bi&&(Bi=t.open(Gt))}function We(t){const e=t.indexOf("?");if(e<0)return t;const r=function(u){const d=u.indexOf("?");return d>0?u.slice(d+1).split("&"):[]}(t),a=r.filter(u=>{const d=u.split("=");return d[0]==="language"||d[0]==="worldview"});return a.length?`${t.slice(0,e)}?${a.join("&")}`:t.slice(0,e)}let pi=1/0;const Wi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Wi);class an extends Error{constructor(e,r,a){r===401&&Ct(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Xn=Ee()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Zr=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(Xn())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,u){const d=new AbortController,m=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Xn(),referrerPolicy:a.referrerPolicy,signal:d.signal});let y=!1,b=!1;const T=(E=m.url).indexOf("sku=")>0&&Ct(E);var E;a.type==="json"&&m.headers.set("Accept","application/json");const I=(O,z,N)=>{if(b)return;if(O&&O.message!=="SecurityError"&&si(O.toString()),z&&N)return k(z);const j=Date.now();fetch(m).then(q=>{if(q.ok){const ie=T?q.clone():null;return k(q,ie,j)}return u(new an(q.statusText,q.status,a.url))}).catch(q=>{q.name!=="AbortError"&&u(new Error(`${q.message} ${a.url}`))})},k=(O,z,N)=>{(a.type==="arrayBuffer"?O.arrayBuffer():a.type==="json"?O.json():O.text()).then(j=>{b||(z&&N&&function(q,ie,oe){if(Tn(),!Bi)return;const ae={status:ie.status,statusText:ie.statusText,headers:new Headers};ie.headers.forEach((Te,Pe)=>ae.headers.set(Pe,Te));const he=dt(ie.headers.get("Cache-Control")||"");if(he["no-store"])return;he["max-age"]&&ae.headers.set("Expires",new Date(oe+1e3*he["max-age"]).toUTCString());const me=ae.headers.get("Expires");me&&(new Date(me).getTime()-oe<42e4||function(Te,Pe){if(qn===void 0)try{new Response(new ReadableStream),qn=!0}catch{qn=!1}qn?Pe(Te.body):Te.blob().then(Pe)}(ie,Te=>{const Pe=new Response(Te,ae);Tn(),Bi&&Bi.then(Re=>Re.put(We(q.url),Pe)).catch(Re=>si(Re.message))}))}(m,z,N),y=!0,u(null,j,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(j=>{b||u(new Error(j.message))})};return T?function(O,z){if(Tn(),!Bi)return z(null);const N=We(O.url);Bi.then(j=>{j.match(N).then(q=>{const ie=function(oe){if(!oe)return!1;const ae=new Date(oe.headers.get("Expires")||0),he=dt(oe.headers.get("Cache-Control")||"");return ae>Date.now()&&!he["no-cache"]}(q);j.delete(N),ie&&j.put(N,q.clone()),z(null,q,ie)}).catch(z)}).catch(z)}(m,I):I(null,null),{cancel:()=>{b=!0,y||d.abort()}}}(t,e);if(Ee()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return function(a,u){const d=new XMLHttpRequest;d.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const m in a.headers)d.setRequestHeader(m,a.headers[m]);return a.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=a.credentials==="include",d.onerror=()=>{u(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let m=d.response;if(a.type==="json")try{m=JSON.parse(d.response)}catch(y){return u(y)}u(null,m,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else u(new an(d.statusText,d.status,a.url))},d.send(a.body),{cancel:()=>d.abort()}}(t,e)},Er=function(t,e){return Zr(rt(t,{type:"arrayBuffer"}),e)};function yo(t){const e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}const jr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ar,Qe;Ar=[],Qe=0;const lt=function(t,e){if(F.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Qe>=D.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ar.push(d),d}Qe++;let r=!1;const a=()=>{if(!r)for(r=!0,Qe--;Ar.length&&Qe<D.MAX_PARALLEL_IMAGE_REQUESTS;){const d=Ar.shift(),{requestParameters:m,callback:y,cancelled:b}=d;b||(d.cancel=lt(m,y).cancel)}},u=Er(t,(d,m,y,b)=>{a(),d?e(d):m&&(self.createImageBitmap?function(T,E){const I=new Blob([new Uint8Array(T)],{type:"image/png"});createImageBitmap(I).then(k=>{E(null,k)}).catch(k=>{E(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(T,E)=>e(T,E,y,b)):function(T,E){const I=new Image;I.onload=()=>{E(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=jr})},I.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const k=new Blob([new Uint8Array(T)],{type:"image/png"});I.src=T.byteLength?URL.createObjectURL(k):jr}(m,(T,E)=>e(T,E,y,b)))});return{cancel:()=>{u.cancel(),a()}}},xt="NO_ACCESS_TOKEN";function St(t){return t.indexOf("mapbox:")===0}function Ct(t){return D.API_URL_REGEX.test(t)}function zt(t){return D.API_CDN_URL_REGEX.test(t)}function jt(t){return D.API_STYLE_REGEX.test(t)&&!Dt(t)}function Dt(t){return D.API_SPRITE_REGEX.test(t)}const ni=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function yt(t){const e=t.match(ni);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Pi(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const un="mapbox.eventData";function fi(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class on{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=fi(D.ACCESS_TOKEN);let a="";return a=r&&r.u?btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(u,d)=>String.fromCharCode(+("0x"+d)))):D.ACCESS_TOKEN||"",e?`${un}.${e}:${a}`:`${un}:${a}`}fetchEventData(){const e=Ut("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{const u=localStorage.getItem(r);u&&(this.eventData=JSON.parse(u));const d=localStorage.getItem(a);d&&(this.anonId=d)}catch{si("Unable to read from LocalStorage")}}saveEventData(){const e=Ut("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid"),u=this.anonId;if(e&&u)try{localStorage.setItem(a,u),Object.keys(this.eventData).length>=1&&localStorage.setItem(r,JSON.stringify(this.eventData))}catch{si("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,a,u){if(!D.EVENTS_URL)return;const d=yt(D.EVENTS_URL);d.params.push(`access_token=${u||D.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(e).toISOString()},y=r?rt(m,r):m,b={url:Pi(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=function(T,E){return Zr(rt(T,{method:"POST"}),E)}(b,T=>{this.pendingRequest=null,a(T),this.saveEventData(),this.processRequests(u)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const Yn=new class extends on{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){D.EVENTS_URL&&D.ACCESS_TOKEN&&Array.isArray(t)&&t.some(r=>St(r)||Ct(r))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=fi(D.ACCESS_TOKEN),r=e?e.u:D.ACCESS_TOKEN;let a=r!==this.eventData.tokenU;hn(this.anonId)||(this.anonId=bn(),a=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const d=new Date(this.eventData.lastSuccess),m=new Date(u),y=(u-this.eventData.lastSuccess)/864e5;a=a||y>=1||y<-1||d.getDate()!==m.getDate()}else a=!0;a?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:M,skuId:ye,"enabled.telemetry":!1,userId:this.anonId},d=>{d||(this.eventData.lastSuccess=u,this.eventData.tokenU=r)},t):this.processRequests()}},Zn=Yn.postTurnstileEvent.bind(Yn),tr=new class extends on{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,r,a){this.skuToken=e,this.errorCb=a,D.EVENTS_URL&&(r||D.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(xt)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),hn(this.anonId)||(this.anonId=bn()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:M,skuId:ye,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t))}},Xr=tr.postMapLoadEvent.bind(tr),Io=new class extends on{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){D.EVENTS_URL&&(t||D.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:r}=this.queue.shift(),a=function(u){const d=performance.getEntriesByType("resource"),m=performance.getEntriesByType("mark"),y=function(O){const z={};if(O){for(const N in O)if(N!=="other")for(const j of O[N]){const q=`${N}ResolveRangeMin`,ie=`${N}ResolveRangeMax`,oe=`${N}RequestCount`,ae=`${N}RequestCachedCount`;z[q]=Math.min(z[q]||1/0,j.startTime),z[ie]=Math.max(z[ie]||-1/0,j.responseEnd);const he=me=>{z[me]===void 0&&(z[me]=0),++z[me]};j.transferSize!==void 0&&j.transferSize===0&&he(ae),he(oe)}}return z}(function(O,z){const N={};if(O)for(const j of O){const q=z(j);N[q]===void 0&&(N[q]=[]),N[q].push(j)}return N}(d,$a)),b=window.devicePixelRatio,T=navigator.connection||navigator.mozConnection||navigator.webkitConnection,E=T?T.effectiveType:void 0,I={counters:[],metadata:[],attributes:[]},k=(O,z,N)=>{N!=null&&O.push({name:z,value:N.toString()})};for(const O in y)k(I.counters,O,y[O]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(k(I.counters,"interactionRangeMin",u.interactionRange[0]),k(I.counters,"interactionRangeMax",u.interactionRange[1])),m)for(const O of Object.keys(ys)){const z=ys[O],N=m.find(j=>j.name===z);N&&k(I.counters,z,N.startTime)}return k(I.counters,"visibilityHidden",u.visibilityHidden),k(I.attributes,"style",function(O){if(O)for(const z of O){const N=z.name.split("?")[0];if(jt(N)){const j=N.split("/").slice(-2);if(j.length===2)return`mapbox://styles/${j[0]}/${j[1]}`}}}(d)),k(I.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),k(I.attributes,"fogEnabled",u.fogEnabled?"true":"false"),k(I.attributes,"projection",u.projection),k(I.attributes,"zoom",u.zoom),k(I.metadata,"devicePixelRatio",b),k(I.metadata,"connectionEffectiveType",E),k(I.metadata,"navigatorUserAgent",navigator.userAgent),k(I.metadata,"screenWidth",window.screen.width),k(I.metadata,"screenHeight",window.screen.height),k(I.metadata,"windowWidth",window.innerWidth),k(I.metadata,"windowHeight",window.innerHeight),k(I.metadata,"mapWidth",u.width/b),k(I.metadata,"mapHeight",u.height/b),k(I.metadata,"webglRenderer",u.renderer),k(I.metadata,"webglVendor",u.vendor),k(I.metadata,"sdkVersion",M),k(I.metadata,"sdkIdentifier","mapbox-gl-js"),I}(r);for(const u of a.metadata);for(const u of a.counters);for(const u of a.attributes);this.postEvent(e,a,()=>{},t)}},ir=Io.postPerformanceEvent.bind(Io),Co=new class extends on{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,r,a){if(!D.API_URL||!D.SESSION_PATH)return;const u=yt(D.API_URL+D.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${a||D.ACCESS_TOKEN||""}`);const d={url:Pi(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(m,y){return Zr(rt(m,{method:"GET"}),y)}(d,m=>{this.pendingRequest=null,r(m),this.saveEventData(),this.processRequests(a)})}getSessionAPI(t,e,r,a){this.skuToken=e,this.errorCb=a,D.SESSION_PATH&&D.API_URL&&(r||D.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(xt)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t)}},Yr=Co.getSessionAPI.bind(Co),vo=new Set,ys={create:"create",load:"load",fullLoad:"fullLoad"};function $a(t){const e=t.name.split("?")[0];return zt(e)&&e.includes("mapbox-gl.js")?"javascript":zt(e)&&e.includes("mapbox-gl.css")?"css":function(r){return D.API_FONTS_REGEX.test(r)}(e)?"fontRange":Dt(e)?"sprite":jt(e)?"style":function(r){return D.API_TILEJSON_REGEX.test(r)}(e)?"tilejson":"other"}function kl(t){const e=t?t.url.toString():void 0;return e?performance.getEntriesByName(e):[]}let Ac,wa,Dl,Ta,lr;function yu(){return Ac==null&&(Ac=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ac}const ro={now:()=>Ta!==void 0?Ta:performance.now(),setNow(t){Ta=t},restoreNow(){Ta=void 0},frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:r,height:a}=t;lr||(lr=document.createElement("canvas"));const u=lr.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(r>lr.width||a>lr.height)&&(lr.width=r,lr.height=a),u.clearRect(-e,-e,r+2*e,a+2*e),u.drawImage(t,0,0,r,a),u.getImageData(-e,-e,r+2*e,a+2*e)},resolveURL:t=>(wa||(wa=document.createElement("a")),wa.href=t,wa.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Dl==null&&(Dl=window.matchMedia("(prefers-reduced-motion: reduce)")),Dl.matches)},hasCanvasFingerprintNoise(){if(!yu())return!1;const t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let r=0;for(let u=0;u<t.width;++u)e.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,e.fillRect(u,0,1,1);const a=e.getImageData(0,0,t.width,t.height);r=0;for(let u=0;u<a.data.length;++u)if(u%4!=3&&r++!==a.data[u])return!0;return!1}};function os(t,e,r){r[t]&&r[t].indexOf(e)!==-1||(r[t]=r[t]||[],r[t].push(e))}function oo(t,e,r){if(r&&r[t]){const a=r[t].indexOf(e);a!==-1&&r[t].splice(a,1)}}class xo{constructor(e,r={}){rt(this,r),this.type=e}}class Po extends xo{constructor(e,r={}){super("error",rt({error:e},r))}}class so{on(e,r){return this._listeners=this._listeners||{},os(e,r,this._listeners),this}off(e,r){return oo(e,r,this._listeners),oo(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},os(e,r,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,r){typeof e=="string"&&(e=new xo(e,r||{}));const a=e.type;if(this.listens(a)){e.target=this;const u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const y of u)y.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const y of d)oo(a,y,this._oneTimeListeners),y.call(this,e);const m=this._eventedParent;m&&(rt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof Po&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var Be=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class ri{constructor(e,r,a,u){this.message=(e?`${e}: `:"")+a,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}class vs extends ri{}function ss(t,...e){for(const r of e)for(const a in r)t[a]=r[a];return t}function dr(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function as(t){if(Array.isArray(t))return t.map(as);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const r in t)e[r]=as(t[r]);return e}return dr(t)}class zh extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}var Vo=zh;class vu{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[a,u]of r)this.bindings[a]=u}concat(e){return new vu(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var sd=vu;const Sa={kind:"null"},ct={kind:"number"},L={kind:"string"},G={kind:"boolean"},le={kind:"color"},we={kind:"object"},Se={kind:"value"},Oe={kind:"collator"},Ve={kind:"formatted"},Ft={kind:"resolvedImage"};function Nt(t,e){return{kind:"array",itemType:t,N:e}}function Lt(t){if(t.kind==="array"){const e=Lt(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const di=[Sa,ct,L,G,le,Ve,we,Nt(Se),Ft];function Qt(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Qt(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const r of di)if(!Qt(r,e))return null}}return`Expected ${Lt(t)} but found ${Lt(e)} instead.`}function Xi(t,e){return e.some(r=>r.kind===t.kind)}function Gn(t,e){return e.some(r=>r==="null"?t===null:r==="array"?Array.isArray(t):r==="object"?t&&!Array.isArray(t)&&typeof t=="object":r===typeof t)}var Ki,cr={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function At(t){return(t=Math.round(t))<0?0:t>255?255:t}function wi(t){return At(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Cn(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Or(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{Ki={}.parseCSSColor=function(t){var e,r=t.replace(/ /g,"").toLowerCase();if(r in cr)return cr[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=r.indexOf("("),u=r.indexOf(")");if(a!==-1&&u+1===r.length){var d=r.substr(0,a),m=r.substr(a+1,u-(a+1)).split(","),y=1;switch(d){case"rgba":if(m.length!==4)return null;y=Cn(m.pop());case"rgb":return m.length!==3?null:[wi(m[0]),wi(m[1]),wi(m[2]),y];case"hsla":if(m.length!==4)return null;y=Cn(m.pop());case"hsl":if(m.length!==3)return null;var b=(parseFloat(m[0])%360+360)%360/360,T=Cn(m[1]),E=Cn(m[2]),I=E<=.5?E*(T+1):E+T-E*T,k=2*E-I;return[At(255*Or(k,I,b+1/3)),At(255*Or(k,I,b)),At(255*Or(k,I,b-1/3)),y];default:return null}}return null}}catch{}class Sn{constructor(e,r,a,u=1){this.r=e,this.g=r,this.b=a,this.a=u}static parse(e){if(!e)return;if(e instanceof Sn)return e;if(typeof e!="string")return;const r=Ki(e);return r?new Sn(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,a,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(a)},${u})`}toArray(){const{r:e,g:r,b:a,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*r/u,255*a/u,u]}toArray01(){const{r:e,g:r,b:a,a:u}=this;return u===0?[0,0,0,0]:[e/u,r/u,a/u,u]}toArray01Scaled(e){const{r,g:a,b:u,a:d}=this;return d===0?[0,0,0]:[r/d*e,a/d*e,u/d*e]}toArray01PremultipliedAlpha(){const{r:e,g:r,b:a,a:u}=this;return[e,r,a,u]}toArray01Linear(){const{r:e,g:r,b:a,a:u}=this;return u===0?[0,0,0,0]:[Math.pow(e/u,2.2),Math.pow(r/u,2.2),Math.pow(a/u,2.2),u]}}Sn.black=new Sn(0,0,0,1),Sn.white=new Sn(1,1,1,1),Sn.transparent=new Sn(0,0,0,0),Sn.red=new Sn(1,0,0,1),Sn.blue=new Sn(0,0,1,1);var Ln=Sn;class xu{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class On{constructor(e,r,a,u,d){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=a,this.fontStack=u,this.textColor=d}}class ao{constructor(e){this.sections=e}static fromString(e){return new ao([new On(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof ao?e:ao.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.namePrimary]);continue}e.push(r.text);const a={};r.fontStack&&(a["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(a["font-scale"]=r.scale),r.textColor&&(a["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(a)}return e}}class Uo{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,r){return e?new Uo({namePrimary:e,nameSecondary:r,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function xs(t,e,r,a){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[t,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[t,e,r,a]:[t,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ma(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Ln||t instanceof xu||t instanceof ao||t instanceof Uo)return!0;if(Array.isArray(t)){for(const e of t)if(!Ma(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!Ma(t[e]))return!1;return!0}return!1}function xr(t){if(t===null)return Sa;if(typeof t=="string")return L;if(typeof t=="boolean")return G;if(typeof t=="number")return ct;if(t instanceof Ln)return le;if(t instanceof xu)return Oe;if(t instanceof ao)return Ve;if(t instanceof Uo)return Ft;if(Array.isArray(t)){const e=t.length;let r;for(const a of t){const u=xr(a);if(r){if(r===u)continue;r=Se;break}r=u}return Nt(r||Se,e)}return we}function el(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Ln||t instanceof ao||t instanceof Uo?t.toString():JSON.stringify(t)}class Ll{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ma(e[1]))return r.error("invalid value");const a=e[1];let u=xr(a);const d=r.expectedType;return u.kind!=="array"||u.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(u=d),new Ll(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ln?["rgba"].concat(this.value.toArray()):this.value instanceof ao?this.value.serialize():this.value}}var Ea=Ll,pr=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const bu={string:L,number:ct,boolean:G,object:we};class wu{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,u=1;const d=e[0];if(d==="array"){let y,b;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in bu)||T==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);y=bu[T],u++}else y=Se;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=e[2],u++}a=Nt(y,b)}else a=bu[d];const m=[];for(;u<e.length;u++){const y=r.parse(e[u],u,Se);if(!y)return null;m.push(y)}return new wu(a,m)}evaluate(e){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(e);if(!Qt(this.type,xr(a)))return a;if(r===this.args.length-1)throw new pr(`Expected value to be of type ${Lt(this.type)}, but found ${Lt(xr(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){r.push(a.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&r.push(u)}}return r.concat(this.args.map(a=>a.serialize()))}}var ls=wu;class tl{constructor(e){this.type=Ve,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const u=[];let d=!1;for(let m=1;m<=e.length-1;++m){const y=e[m];if(d&&typeof y=="object"&&!Array.isArray(y)){d=!1;let b=null;if(y["font-scale"]&&(b=r.parse(y["font-scale"],1,ct),!b))return null;let T=null;if(y["text-font"]&&(T=r.parse(y["text-font"],1,Nt(L)),!T))return null;let E=null;if(y["text-color"]&&(E=r.parse(y["text-color"],1,le),!E))return null;const I=u[u.length-1];I.scale=b,I.font=T,I.textColor=E}else{const b=r.parse(e[m],1,Se);if(!b)return null;const T=b.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,u.push({content:b,scale:null,font:null,textColor:null})}}return new tl(u)}evaluate(e){return new ao(this.sections.map(r=>{const a=r.content.evaluate(e);return xr(a)===Ft?new On("",a,null,null,null):new On(el(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const a={};r.scale&&(a["font-scale"]=r.scale.serialize()),r.font&&(a["text-font"]=r.font.serialize()),r.textColor&&(a["text-color"]=r.textColor.serialize()),e.push(a)}return e}}class il{constructor(e,r){this.type=Ft,this.inputPrimary=e,this.inputSecondary=r}static parse(e,r){if(e.length<2)return r.error("Expected two or more arguments.");const a=r.parse(e[1],1,L);if(!a)return r.error("No image name provided.");if(e.length===2)return new il(a);const u=r.parse(e[2],1,L);return u?new il(a,u):r.error("Secondary image variant is not a string.")}evaluate(e){const r=Uo.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(r.namePrimary)>-1,r.nameSecondary&&r.available&&e.availableImages&&(r.available=e.availableImages.indexOf(r.nameSecondary)>-1)),r}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function ln(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}const ad={"to-boolean":G,"to-color":le,"to-number":ct,"to-string":L};class Ic{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[0],u=[];let d=Sa;if(a==="to-array"){if(!Array.isArray(e[1]))return null;const m=e[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);d=Nt(r.expectedType.itemType,m)}else{if(!(m>0&&Ma(e[1][0])))return null;d=Nt(xr(e[1][0]),m)}for(let y=0;y<m;y++){const b=e[1][y];let T;if(ln(b)==="array")T=r.parse(b,void 0,d.itemType);else{const E=ln(b);if(E!==d.itemType.kind)return r.error(`Expected ${d.itemType.kind} but found ${E}.`);T=r.registry.literal.parse(["literal",b===void 0?null:b],r)}if(!T)return null;u.push(T)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");d=ad[a];for(let m=1;m<e.length;m++){const y=r.parse(e[m],m,Se);if(!y)return null;u.push(y)}}return new Ic(d,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,a;for(const u of this.args){if(r=u.evaluate(e),a=null,r instanceof Ln)return r;if(typeof r=="string"){const d=e.parseColor(r);if(d)return d}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:xs(r[0],r[1],r[2],r[3]),!a))return new Ln(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new pr(a||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const a of this.args){if(r=a.evaluate(e),r===null)return 0;const u=Number(r);if(!isNaN(u))return u}throw new pr(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?ao.fromString(el(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Uo.fromString(el(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(r=>r.evaluate(e)):el(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new tl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new il(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}var cs=Ic;const Cc=["Unknown","Point","LineString","Polygon"];var Pc=class{constructor(t,e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=e}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Cc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:r,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*e-t[0])+this.featureDistanceData.bearing[1]*(a*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Ln.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class Jr{constructor(e,r,a,u,d){this.name=e,this.type=r,this._evaluate=a,this.args=u,this._overloadIndex=d}evaluate(e){if(!this._evaluate){const r=Jr.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const a=e[0],u=Jr.definitions[a];if(!u)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=[];let b=null,T=-1;for(const[E,I]of m){if(Array.isArray(E)&&E.length!==e.length-1)continue;y.push(E),T++,b=new Go(r.registry,r.path,null,r.scope,void 0,r._scope,r.options);const k=[];let O=!1;for(let z=1;z<e.length;z++){const N=e[z],j=Array.isArray(E)?E[z-1]:E.type,q=b.parse(N,1+k.length,j);if(!q){O=!0;break}k.push(q)}if(!O)if(Array.isArray(E)&&E.length!==k.length)b.error(`Expected ${E.length} arguments, but found ${k.length} instead.`);else{for(let z=0;z<k.length;z++){const N=Array.isArray(E)?E[z]:E.type,j=k[z];b.concat(z+1).checkSubtype(N,j.type)}if(b.errors.length===0)return new Jr(a,d,I,k,T)}}if(y.length===1)r.errors.push(...b.errors);else{const E=(y.length?y:m.map(([k])=>k)).map(Tu).join(" | "),I=[];for(let k=1;k<e.length;k++){const O=r.parse(e[k],1+I.length);if(!O)return null;I.push(Lt(O.type))}r.error(`Expected arguments of type ${E}, but found (${I.join(", ")}) instead.`)}return null}static register(e,r){Jr.definitions=r;for(const a in r)e[a]=Jr}}function Tu(t){return Array.isArray(t)?`(${t.map(Lt).join(", ")})`:`(${Lt(t.type)}...)`}var jo=Jr;class Ol{constructor(e,r,a){this.type=Oe,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const u=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,G);if(!u)return null;const d=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,G);if(!d)return null;let m=null;return a.locale&&(m=r.parse(a.locale,1,L),!m)?null:new Ol(u,d,m)}evaluate(e){return new xu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var kc={exports:{}};kc.exports=function(){function t(a,u,d,m,y){for(;m>d;){if(m-d>600){var b=m-d+1,T=u-d+1,E=Math.log(b),I=.5*Math.exp(2*E/3),k=.5*Math.sqrt(E*I*(b-I)/b)*(T-b/2<0?-1:1);t(a,u,Math.max(d,Math.floor(u-T*I/b+k)),Math.min(m,Math.floor(u+(b-T)*I/b+k)),y)}var O=a[u],z=d,N=m;for(e(a,d,u),y(a[m],O)>0&&e(a,d,m);z<N;){for(e(a,z,N),z++,N--;y(a[z],O)<0;)z++;for(;y(a[N],O)>0;)N--}y(a[d],O)===0?e(a,d,N):e(a,++N,m),N<=u&&(d=N+1),u<=N&&(m=N-1)}}function e(a,u,d){var m=a[u];a[u]=a[d],a[d]=m}function r(a,u){return a<u?-1:a>u?1:0}return function(a,u,d,m,y){t(a,u,d||0,m||a.length-1,y||r)}}();var Rl=pe(kc.exports);function zl(t){let e=0;for(let r,a,u=0,d=t.length,m=d-1;u<d;m=u++)r=t[u],a=t[m],e+=(a.x-r.x)*(r.y+a.y);return e}function zs(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function ta(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function ia(t,e,r){const a=t[0]-e[0],u=t[1]-e[1],d=t[0]-r[0],m=t[1]-r[1];return a*m-d*u==0&&a*d<=0&&u*m<=0}function na(t,e,r=!1){let a=!1;for(let y=0,b=e.length;y<b;y++){const T=e[y];for(let E=0,I=T.length,k=I-1;E<I;k=E++){const O=T[k],z=T[E];if(ia(t,O,z))return r;(d=O)[1]>(u=t)[1]!=(m=z)[1]>u[1]&&u[0]<(m[0]-d[0])*(u[1]-d[1])/(m[1]-d[1])+d[0]&&(a=!a)}}var u,d,m;return a}function Su(t,e,r,a){const u=a[0]-r[0],d=a[1]-r[1],m=(t[0]-r[0])*d-u*(t[1]-r[1]),y=(e[0]-r[0])*d-u*(e[1]-r[1]);return m>0&&y<0||m<0&&y>0}function Fs(t,e,r,a){return(u=[a[0]-r[0],a[1]-r[1]])[0]*(d=[e[0]-t[0],e[1]-t[1]])[1]-u[1]*d[0]!=0&&!(!Su(t,e,r,a)||!Su(r,a,t,e));var u,d}const Yi=8192;function Fl(t,e){const r=(180+t[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(r*u*Yi),Math.round(a*u*Yi)]}function Mu(t,e){for(let r=0;r<e.length;r++)if(na(t,e[r]))return!0;return!1}function Eu(t,e,r){for(const a of r)for(let u=0,d=a.length,m=d-1;u<d;m=u++)if(Fs(t,e,a[m],a[u]))return!0;return!1}function Bl(t,e){for(let r=0;r<t.length;++r)if(!na(t[r],e))return!1;for(let r=0;r<t.length-1;++r)if(Eu(t[r],t[r+1],e))return!1;return!0}function Nl(t,e){for(let r=0;r<e.length;r++)if(Bl(t,e[r]))return!0;return!1}function Dc(t,e,r){const a=[];for(let u=0;u<t.length;u++){const d=[];for(let m=0;m<t[u].length;m++){const y=Fl(t[u][m],r);zs(e,y),d.push(y)}a.push(d)}return a}function Au(t,e,r){const a=[];for(let u=0;u<t.length;u++){const d=Dc(t[u],e,r);a.push(d)}return a}function Iu(t,e,r,a){if(t[0]<r[0]||t[0]>r[2]){const u=.5*a;let d=t[0]-r[0]>u?-a:r[0]-t[0]>u?a:0;d===0&&(d=t[0]-r[2]>u?-a:r[2]-t[0]>u?a:0),t[0]+=d}zs(e,t)}function Aa(t,e,r,a){const u=Math.pow(2,a.z)*Yi,d=[a.x*Yi,a.y*Yi],m=[];if(!t)return m;for(const y of t)for(const b of y){const T=[b.x+d[0],b.y+d[1]];Iu(T,e,r,u),m.push(T)}return m}function Cu(t,e,r,a){const u=Math.pow(2,a.z)*Yi,d=[a.x*Yi,a.y*Yi],m=[];if(!t)return m;for(const b of t){const T=[];for(const E of b){const I=[E.x+d[0],E.y+d[1]];zs(e,I),T.push(I)}m.push(T)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of m)for(const T of b)Iu(T,e,r,u)}var y;return m}class us{constructor(e,r){this.type=G,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ma(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let u=0;u<a.features.length;++u){const d=a.features[u].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new us(a,a.features[u].geometry)}else if(a.type==="Feature"){const u=a.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new us(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new us(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){const u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(!m)return!1;if(a.type==="Polygon"){const y=Dc(a.coordinates,d,m),b=Aa(r.geometry(),u,d,m);if(!ta(u,d))return!1;for(const T of b)if(!na(T,y))return!1}if(a.type==="MultiPolygon"){const y=Au(a.coordinates,d,m),b=Aa(r.geometry(),u,d,m);if(!ta(u,d))return!1;for(const T of b)if(!Mu(T,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){const u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(!m)return!1;if(a.type==="Polygon"){const y=Dc(a.coordinates,d,m),b=Cu(r.geometry(),u,d,m);if(!ta(u,d))return!1;for(const T of b)if(!Bl(T,y))return!1}if(a.type==="MultiPolygon"){const y=Au(a.coordinates,d,m),b=Cu(r.geometry(),u,d,m);if(!ta(u,d))return!1;for(const T of b)if(!Nl(T,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var nl=us,Bs={exports:{}};Bs.exports=function(){var t={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,r=e*(2-e),a=Math.PI/180,u=function(T,E){if(T===void 0)throw new Error("No latitude given.");if(E&&!t[E])throw new Error("Unknown unit "+E+". Use one of: "+Object.keys(t).join(", "));var I=6378.137*a*(E?t[E]:1),k=Math.cos(T*a),O=1/(1-r*(1-k*k)),z=Math.sqrt(O);this.kx=I*z*k,this.ky=I*z*O*(1-r)},d={units:{configurable:!0}};function m(T,E){return T[0]===E[0]&&T[1]===E[1]}function y(T,E,I){var k=b(E[0]-T[0]);return[T[0]+k*I,T[1]+(E[1]-T[1])*I]}function b(T){for(;T<-180;)T+=360;for(;T>180;)T-=360;return T}return u.fromTile=function(T,E,I){var k=Math.PI*(1-2*(T+.5)/Math.pow(2,E)),O=Math.atan(.5*(Math.exp(k)-Math.exp(-k)))/a;return new u(O,I)},d.units.get=function(){return t},u.prototype.distance=function(T,E){var I=b(T[0]-E[0])*this.kx,k=(T[1]-E[1])*this.ky;return Math.sqrt(I*I+k*k)},u.prototype.bearing=function(T,E){var I=b(E[0]-T[0])*this.kx;return Math.atan2(I,(E[1]-T[1])*this.ky)/a},u.prototype.destination=function(T,E,I){var k=I*a;return this.offset(T,Math.sin(k)*E,Math.cos(k)*E)},u.prototype.offset=function(T,E,I){return[T[0]+E/this.kx,T[1]+I/this.ky]},u.prototype.lineDistance=function(T){for(var E=0,I=0;I<T.length-1;I++)E+=this.distance(T[I],T[I+1]);return E},u.prototype.area=function(T){for(var E=0,I=0;I<T.length;I++)for(var k=T[I],O=0,z=k.length,N=z-1;O<z;N=O++)E+=b(k[O][0]-k[N][0])*(k[O][1]+k[N][1])*(I?-1:1);return Math.abs(E)/2*this.kx*this.ky},u.prototype.along=function(T,E){var I=0;if(E<=0)return T[0];for(var k=0;k<T.length-1;k++){var O=T[k],z=T[k+1],N=this.distance(O,z);if((I+=N)>E)return y(O,z,(E-(I-N))/N)}return T[T.length-1]},u.prototype.pointToSegmentDistance=function(T,E,I){var k=E[0],O=E[1],z=b(I[0]-k)*this.kx,N=(I[1]-O)*this.ky,j=0;return z===0&&N===0||((j=(b(T[0]-k)*this.kx*z+(T[1]-O)*this.ky*N)/(z*z+N*N))>1?(k=I[0],O=I[1]):j>0&&(k+=z/this.kx*j,O+=N/this.ky*j)),z=b(T[0]-k)*this.kx,N=(T[1]-O)*this.ky,Math.sqrt(z*z+N*N)},u.prototype.pointOnLine=function(T,E){for(var I,k,O,z,N=1/0,j=0;j<T.length-1;j++){var q=T[j][0],ie=T[j][1],oe=b(T[j+1][0]-q)*this.kx,ae=(T[j+1][1]-ie)*this.ky,he=0;oe===0&&ae===0||((he=(b(E[0]-q)*this.kx*oe+(E[1]-ie)*this.ky*ae)/(oe*oe+ae*ae))>1?(q=T[j+1][0],ie=T[j+1][1]):he>0&&(q+=oe/this.kx*he,ie+=ae/this.ky*he));var me=(oe=b(E[0]-q)*this.kx)*oe+(ae=(E[1]-ie)*this.ky)*ae;me<N&&(N=me,I=q,k=ie,O=j,z=he)}return{point:[I,k],index:O,t:Math.max(0,Math.min(1,z))}},u.prototype.lineSlice=function(T,E,I){var k=this.pointOnLine(I,T),O=this.pointOnLine(I,E);if(k.index>O.index||k.index===O.index&&k.t>O.t){var z=k;k=O,O=z}var N=[k.point],j=k.index+1,q=O.index;!m(I[j],N[0])&&j<=q&&N.push(I[j]);for(var ie=j+1;ie<=q;ie++)N.push(I[ie]);return m(I[q],O.point)||N.push(O.point),N},u.prototype.lineSliceAlong=function(T,E,I){for(var k=0,O=[],z=0;z<I.length-1;z++){var N=I[z],j=I[z+1],q=this.distance(N,j);if((k+=q)>T&&O.length===0&&O.push(y(N,j,(T-(k-q))/q)),k>=E)return O.push(y(N,j,(E-(k-q))/q)),O;k>T&&O.push(j)}return O},u.prototype.bufferPoint=function(T,E){var I=E/this.ky,k=E/this.kx;return[T[0]-k,T[1]-I,T[0]+k,T[1]+I]},u.prototype.bufferBBox=function(T,E){var I=E/this.ky,k=E/this.kx;return[T[0]-k,T[1]-I,T[2]+k,T[3]+I]},u.prototype.insideBBox=function(T,E){return b(T[0]-E[0])>=0&&b(T[0]-E[2])<=0&&T[1]>=E[1]&&T[1]<=E[3]},Object.defineProperties(u,d),u}();var hs=pe(Bs.exports),bs={exports:{}};bs.exports=function(){var t=function(r,a){if(r===void 0&&(r=[]),a===void 0&&(a=e),this.data=r,this.length=this.data.length,this.compare=a,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function e(r,a){return r<a?-1:r>a?1:0}return t.prototype.push=function(r){this.data.push(r),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(this.length!==0){var r=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),r}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(r){for(var a=this.data,u=this.compare,d=a[r];r>0;){var m=r-1>>1,y=a[m];if(u(d,y)>=0)break;a[r]=y,r=m}a[r]=d},t.prototype._down=function(r){for(var a=this.data,u=this.compare,d=this.length>>1,m=a[r];r<d;){var y=1+(r<<1),b=a[y],T=y+1;if(T<this.length&&u(a[T],b)<0&&(y=T,b=a[T]),u(b,m)>=0)break;a[r]=b,r=y}a[r]=m},t}();var Ia=pe(bs.exports),Mt=8192;function Fh(t,e){return e.dist-t.dist}const Ca=100,Pa=50;function Pu(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function Vl(t){return t[1]-t[0]+1}function Ns(t,e){const r=t[1]>=t[0]&&t[1]<e;return r||console.warn("Distance Expression: Index is out of range"),r}function Lc(t,e){if(t[0]>t[1])return[null,null];const r=Vl(t);if(e){if(r===2)return[t,null];const a=Math.floor(r/2);return[[t[0],t[0]+a],[t[0]+a,t[1]]]}{if(r===1)return[t,null];const a=Math.floor(r/2)-1;return[[t[0],t[0]+a],[t[0]+a+1,t[1]]]}}function Vs(t,e){const r=[1/0,1/0,-1/0,-1/0];if(!Ns(e,t.length))return r;for(let a=e[0];a<=e[1];++a)zs(r,t[a]);return r}function Ul(t){const e=[1/0,1/0,-1/0,-1/0];for(let r=0;r<t.length;++r)for(let a=0;a<t[r].length;++a)zs(e,t[r][a]);return e}function ws(t,e,r){if(Pu(t)||Pu(e))return NaN;let a=0,u=0;return t[2]<e[0]&&(a=e[0]-t[2]),t[0]>e[2]&&(a=t[0]-e[2]),t[1]>e[3]&&(u=t[1]-e[3]),t[3]<e[1]&&(u=e[1]-t[3]),r.distance([0,0],[a,u])}function ra(t,e){const r=Math.pow(2,e.z);return[(u=(t.x/Mt+e.x)/r,360*u-180),(a=(t.y/Mt+e.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,u}function ld(t,e){const r=[];for(let a=0;a<t.length;++a)r.push(ra(t[a],e));return r}function Ts(t,e,r){const a=r.pointOnLine(e,t).point;return r.distance(t,a)}function ku(t,e,r,a,u){const d=r.slice(a[0],a[1]+1);let m=1/0;for(let y=e[0];y<=e[1];++y)if((m=Math.min(m,Ts(t[y],d,u)))===0)return 0;return m}function Us(t,e,r,a,u){const d=Math.min(u.pointToSegmentDistance(t,r,a),u.pointToSegmentDistance(e,r,a)),m=Math.min(u.pointToSegmentDistance(r,t,e),u.pointToSegmentDistance(a,t,e));return Math.min(d,m)}function Bh(t,e,r,a,u){if(!Ns(e,t.length)||!Ns(a,r.length))return NaN;let d=1/0;for(let m=e[0];m<e[1];++m)for(let y=a[0];y<a[1];++y){if(Fs(t[m],t[m+1],r[y],r[y+1]))return 0;d=Math.min(d,Us(t[m],t[m+1],r[y],r[y+1],u))}return d}function cd(t,e,r,a,u){if(!Ns(e,t.length)||!Ns(a,r.length))return NaN;let d=1/0;for(let m=e[0];m<=e[1];++m)for(let y=a[0];y<=a[1];++y)if((d=Math.min(d,u.distance(t[m],r[y])))===0)return d;return d}function jl(t,e,r){if(na(t,e,!0))return 0;let a=1/0;for(const u of e){const d=u.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[d-1]&&(a=Math.min(a,r.pointToSegmentDistance(t,u[d-1],u[0])))===0||(a=Math.min(a,Ts(t,u,r)))===0)return a}return a}function Du(t,e,r,a){if(!Ns(e,t.length))return NaN;for(let d=e[0];d<=e[1];++d)if(na(t[d],r,!0))return 0;let u=1/0;for(let d=e[0];d<e[1];++d)for(const m of r)for(let y=0,b=m.length,T=b-1;y<b;T=y++){if(Fs(t[d],t[d+1],m[T],m[y]))return 0;u=Math.min(u,Us(t[d],t[d+1],m[T],m[y],a))}return u}function Lu(t,e){for(const r of t)for(let a=0;a<=r.length-1;++a)if(na(r[a],e,!0))return!0;return!1}function Ou(t,e,r,a=1/0){const u=Ul(t),d=Ul(e);if(a!==1/0&&ws(u,d,r)>=a)return a;if(ta(u,d)){if(Lu(t,e))return 0}else if(Lu(e,t))return 0;let m=a;for(const y of t)for(let b=0,T=y.length,E=T-1;b<T;E=b++)for(const I of e)for(let k=0,O=I.length,z=O-1;k<O;z=k++){if(Fs(y[E],y[b],I[z],I[k]))return 0;m=Math.min(m,Us(y[E],y[b],I[z],I[k],r))}return m}function Gl(t,e,r,a,u,d,m){if(d===null||m===null)return;const y=ws(Vs(a,d),Vs(u,m),r);y<e&&t.push({dist:y,range1:d,range2:m})}function Hl(t,e,r,a,u=1/0){let d=Math.min(a.distance(t[0],r[0][0]),u);if(d===0)return d;const m=new Ia([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Fh),y=e?Pa:Ca,b=Ul(r);for(;m.length;){const T=m.pop();if(T.dist>=d)continue;const E=T.range1;if(Vl(E)<=y){if(!Ns(E,t.length))return NaN;if(e){const I=Du(t,E,r,a);if((d=Math.min(d,I))===0)return d}else for(let I=E[0];I<=E[1];++I){const k=jl(t[I],r,a);if((d=Math.min(d,k))===0)return d}}else{const I=Lc(E,e);if(I[0]!==null){const k=ws(Vs(t,I[0]),b,a);k<d&&m.push({dist:k,range1:I[0],range2:[0,0]})}if(I[1]!==null){const k=ws(Vs(t,I[1]),b,a);k<d&&m.push({dist:k,range1:I[1],range2:[0,0]})}}}return d}function Ru(t,e,r,a,u,d=1/0){let m=Math.min(d,u.distance(t[0],r[0]));if(m===0)return m;const y=new Ia([{dist:0,range1:[0,t.length-1],range2:[0,r.length-1]}],Fh),b=e?Pa:Ca,T=a?Pa:Ca;for(;y.length;){const E=y.pop();if(E.dist>=m)continue;const I=E.range1,k=E.range2;if(Vl(I)<=b&&Vl(k)<=T){if(!Ns(I,t.length)||!Ns(k,r.length))return NaN;if(e&&a?m=Math.min(m,Bh(t,I,r,k,u)):e||a?e&&!a?m=Math.min(m,ku(r,k,t,I,u)):!e&&a&&(m=Math.min(m,ku(t,I,r,k,u))):m=Math.min(m,cd(t,I,r,k,u)),m===0)return m}else{const O=Lc(I,e),z=Lc(k,a);Gl(y,m,u,t,r,O[0],z[0]),Gl(y,m,u,t,r,O[0],z[1]),Gl(y,m,u,t,r,O[1],z[0]),Gl(y,m,u,t,r,O[1],z[1])}}return m}function Oc(t,e,r,a,u=1/0){let d=u;const m=Vs(t,[0,t.length-1]);for(const y of r)if(!(d!==1/0&&ws(m,Vs(y,[0,y.length-1]),a)>=d)&&(d=Math.min(d,Ru(t,e,y,!0,a,d)),d===0))return d;return d}function Ue(t,e,r,a,u=1/0){let d=u;const m=Vs(t,[0,t.length-1]);for(const y of r){if(d!==1/0&&ws(m,Ul(y),a)>=d)continue;const b=Hl(t,e,y,a,d);if(isNaN(b))return b;if((d=Math.min(d,b))===0)return d}return d}function ht(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class ai{constructor(e,r){this.type=ct,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Ma(e[1])){const a=e[1];if(a.type==="FeatureCollection"){for(let u=0;u<a.features.length;++u)if(ht(a.features[u].geometry.type))return new ai(a,a.features[u].geometry)}else if(a.type==="Feature"){if(ht(a.geometry.type))return new ai(a,a.geometry)}else if(ht(a.type))return new ai(a,a)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const r=e.geometry(),a=e.canonicalID();if(r!=null&&a!=null){if(e.geometryType()==="Point")return function(u,d,m){const y=[];for(const T of u)for(const E of T)y.push(ra(E,d));const b=new hs(y[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?Ru(y,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",b):m.type==="MultiLineString"?Oc(y,!1,m.coordinates,b):m.type==="Polygon"||m.type==="MultiPolygon"?Ue(y,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,b):null}(r,a,this.geometries);if(e.geometryType()==="LineString")return function(u,d,m){const y=[];for(const T of u){const E=[];for(const I of T)E.push(ra(I,d));y.push(E)}const b=new hs(y[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Oc(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",y,b);if(m.type==="MultiLineString"){let T=1/0;for(let E=0;E<m.coordinates.length;E++){const I=Oc(m.coordinates[E],!0,y,b,T);if(isNaN(I))return I;if((T=Math.min(T,I))===0)return T}return T}if(m.type==="Polygon"||m.type==="MultiPolygon"){let T=1/0;for(let E=0;E<y.length;E++){const I=Ue(y[E],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,b,T);if(isNaN(I))return I;if((T=Math.min(T,I))===0)return T}return T}return null}(r,a,this.geometries);if(e.geometryType()==="Polygon")return function(u,d,m){const y=[];for(const T of function(E,I){const k=E.length;if(k<=1)return[E];const O=[];let z,N;for(let j=0;j<k;j++){const q=zl(E[j]);q!==0&&(E[j].area=Math.abs(q),N===void 0&&(N=q<0),N===q<0?(z&&O.push(z),z=[E[j]]):z.push(E[j]))}return z&&O.push(z),O}(u)){const E=[];for(let I=0;I<T.length;++I)E.push(ld(T[I],d));y.push(E)}const b=new hs(y[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Ue(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",y,b);if(m.type==="MultiLineString"){let T=1/0;for(let E=0;E<m.coordinates.length;E++){const I=Ue(m.coordinates[E],!0,y,b,T);if(isNaN(I))return I;if((T=Math.min(T,I))===0)return T}return T}return m.type==="Polygon"||m.type==="MultiPolygon"?function(T,E,I){let k=1/0;for(const O of T)for(const z of E){const N=Ou(O,z,I,k);if(isNaN(N))return N;if((k=Math.min(k,N))===0)return k}return k}(m.type==="Polygon"?[m.coordinates]:m.coordinates,y,b):null}(r,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var Ci=ai;function Fn(t){if(t instanceof jo&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof nl||t instanceof Ci)return!1;let e=!0;return t.eachChild(r=>{e&&!Fn(r)&&(e=!1)}),e}function ji(t){if(t instanceof jo&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(r=>{e&&!ji(r)&&(e=!1)}),e}function nr(t){if(t instanceof jo&&t.name==="config")return!1;let e=!0;return t.eachChild(r=>{e&&!nr(r)&&(e=!1)}),e}function rr(t,e){if(t instanceof jo&&e.indexOf(t.name)>=0)return!1;let r=!0;return t.eachChild(a=>{r&&!rr(a,e)&&(r=!1)}),r}class bo{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=e[1];return r.scope.has(a)?new bo(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Rr=bo;class mr{constructor(e,r=[],a,u=new sd,d=[],m,y){this.registry=e,this.path=r,this.key=r.map(b=>`[${b}]`).join(""),this.scope=u,this.errors=d,this.expectedType=a,this._scope=m,this.options=y}parse(e,r,a,u,d={}){return r||a?this.concat(r,a,u)._parse(e,d):this._parse(e,d)}_parse(e,r){function a(u,d,m){return m==="assert"?new ls(d,[u]):m==="coerce"?new cs(d,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let d=u.parse(e,this);if(!d)return null;if(this.expectedType){const m=this.expectedType,y=d.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||y.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(m,y))return null}else d=a(d,m,r.typeAnnotation||"coerce");else d=a(d,m,r.typeAnnotation||"assert")}if(!(d instanceof Ea)&&d.type.kind!=="resolvedImage"&&Ho(d)){const m=new Pc(this._scope,this.options);try{d=new Ea(d.type,d.evaluate(m))}catch(y){return this.error(y.message),null}}return d}return cs.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a){const u=typeof e=="number"?this.path.concat(e):this.path,d=a?this.scope.concat(a):this.scope;return new mr(this.registry,u,r||null,d,this.errors,this._scope,this.options)}error(e,...r){const a=`${this.key}${r.map(u=>`[${u}]`).join("")}`;this.errors.push(new Vo(a,e))}checkSubtype(e,r){const a=Qt(e,r);return a&&this.error(a),a}}var Go=mr;function Ho(t){if(t instanceof Rr)return Ho(t.boundExpression);if(t instanceof jo&&t.name==="error"||t instanceof jo&&t.name==="config"||t instanceof Ol||t instanceof nl||t instanceof Ci)return!1;const e=t instanceof cs||t instanceof ls;let r=!0;return t.eachChild(a=>{r=e?r&&Ho(a):r&&a instanceof Ea}),!!r&&Fn(t)&&rr(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function Gr(t,e){const r=t.length-1;let a,u,d=0,m=r,y=0;for(;d<=m;)if(y=Math.floor((d+m)/2),a=t[y],u=t[y+1],a<=e){if(y===r||e<u)return y;d=y+1}else{if(!(a>e))throw new pr("Input is not a number.");m=y-1}return 0}class fs{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[u,d]of a)this.labels.push(u),this.outputs.push(d)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(e[1],1,ct);if(!a)return null;const u=[];let d=null;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);for(let m=1;m<e.length;m+=2){const y=m===1?-1/0:e[m],b=e[m+1],T=m,E=m+1;if(typeof y!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(u.length&&u[u.length-1][0]>=y)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const I=r.parse(b,E,d);if(!I)return null;d=d||I.type,u.push([y,I])}return new fs(d,a,u)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return a[0].evaluate(e);const d=r.length;return u>=r[d-1]?a[d-1].evaluate(e):a[Gr(r,u)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}var oa=fs;function Gi(t,e,r){return t*(1-r)+e*r}function js(t,e,r){return t.map((a,u)=>Gi(a,e[u],r))}var Gs=Object.freeze({__proto__:null,array:js,color:function(t,e,r){return new Ln(Gi(t.r,e.r,r),Gi(t.g,e.g,r),Gi(t.b,e.b,r),Gi(t.a,e.a,r))},number:Gi});const rl=.95047,ka=1.08883,Nh=4/29,Pn=6/29,Bn=3*Pn*Pn,Rc=Pn*Pn*Pn,sa=Math.PI/180,zu=180/Math.PI;function wo(t){return t>Rc?Math.pow(t,1/3):t/Bn+Nh}function ds(t){return t>Pn?t*t*t:Bn*(t-Nh)}function Ss(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Da(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Wl(t){const e=Da(t.r),r=Da(t.g),a=Da(t.b),u=wo((.4124564*e+.3575761*r+.1804375*a)/rl),d=wo((.2126729*e+.7151522*r+.072175*a)/1);return{l:116*d-16,a:500*(u-d),b:200*(d-wo((.0193339*e+.119192*r+.9503041*a)/ka)),alpha:t.a}}function Wo(t){let e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,a=isNaN(t.b)?e:e-t.b/200;return e=1*ds(e),r=rl*ds(r),a=ka*ds(a),new Ln(Ss(3.2404542*r-1.5371385*e-.4985314*a),Ss(-.969266*r+1.8760108*e+.041556*a),Ss(.0556434*r-.2040259*e+1.0572252*a),t.alpha)}function aa(t,e,r){const a=e-t;return t+r*(a>180||a<-180?a-360*Math.round(a/360):a)}const La={forward:Wl,reverse:Wo,interpolate:function(t,e,r){return{l:Gi(t.l,e.l,r),a:Gi(t.a,e.a,r),b:Gi(t.b,e.b,r),alpha:Gi(t.alpha,e.alpha,r)}}},ps={forward:function(t){const{l:e,a:r,b:a}=Wl(t),u=Math.atan2(a,r)*zu;return{h:u<0?u+360:u,c:Math.sqrt(r*r+a*a),l:e,alpha:t.a}},reverse:function(t){const e=t.h*sa,r=t.c;return Wo({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:aa(t.h,e.h,r),c:Gi(t.c,e.c,r),l:Gi(t.l,e.l,r),alpha:Gi(t.alpha,e.alpha,r)}}};var zc=Object.freeze({__proto__:null,hcl:ps,lab:La});class Oa{constructor(e,r,a,u,d){this.type=e,this.operator=r,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(const[m,y]of d)this.labels.push(m),this.outputs.push(y)}static interpolationFactor(e,r,a,u){let d=0;if(e.name==="exponential")d=ko(r,e.base,a,u);else if(e.name==="linear")d=ko(r,1,a,u);else if(e.name==="cubic-bezier"){const m=e.controlPoints;d=new tt(m[0],m[1],m[2],m[3]).solve(ko(r,1,a,u))}return d}static parse(e,r){let[a,u,d,...m]=e;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const T=u[1];if(typeof T!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:T}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const T=u.slice(1);if(T.length!==4||T.some(E=>typeof E!="number"||E<0||E>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(d=r.parse(d,2,ct),!d)return null;const y=[];let b=null;a==="interpolate-hcl"||a==="interpolate-lab"?b=le:r.expectedType&&r.expectedType.kind!=="value"&&(b=r.expectedType);for(let T=0;T<m.length;T+=2){const E=m[T],I=m[T+1],k=T+3,O=T+4;if(typeof E!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(y.length&&y[y.length-1][0]>=E)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const z=r.parse(I,O,b);if(!z)return null;b=b||z.type,y.push([E,z])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new Oa(b,a,u,d,y):r.error(`Type ${Lt(b)} is not interpolatable.`)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return a[0].evaluate(e);const d=r.length;if(u>=r[d-1])return a[d-1].evaluate(e);const m=Gr(r,u),y=Oa.interpolationFactor(this.interpolation,u,r[m],r[m+1]),b=a[m].evaluate(e),T=a[m+1].evaluate(e);return this.operator==="interpolate"?Gs[this.type.kind.toLowerCase()](b,T,y):this.operator==="interpolate-hcl"?ps.reverse(ps.interpolate(ps.forward(b),ps.forward(T),y)):La.reverse(La.interpolate(La.forward(b),La.forward(T),y))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)r.push(this.labels[a],this.outputs[a].serialize());return r}}function ko(t,e,r,a){const u=a-r,d=t-r;return u===0?0:e===1?d/u:(Math.pow(e,d)-1)/(Math.pow(e,u)-1)}var qo=Oa;class ms{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let a=null;const u=r.expectedType;u&&u.kind!=="value"&&(a=u);const d=[];for(const y of e.slice(1)){const b=r.parse(y,1+d.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,d.push(b)}const m=u&&d.some(y=>Qt(u,y.type));return new ms(m?Se:a,d)}evaluate(e){let r,a=null,u=0;for(const d of this.args){if(u++,a=d.evaluate(e),a&&a instanceof Uo&&!a.available&&(r||(r=a),a=null,u===this.args.length))return r;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var ql=ms;class ud{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let d=1;d<e.length-1;d+=2){const m=e[d];if(typeof m!="string")return r.error(`Expected string, but found ${typeof m} instead.`,d);if(/[^a-zA-Z0-9_]/.test(m))return r.error("Variable names must contain only alphanumeric characters or '_'.",d);const y=r.parse(e[d+1],d+1);if(!y)return null;a.push([m,y])}const u=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return u?new ud(a,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,a]of this.bindings)e.push(r,a.serialize());return e.push(this.result.serialize()),e}}var Em=ud;class hd{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,ct),u=r.parse(e[2],2,Nt(r.expectedType||Se));return a&&u?new hd(u.type.itemType,a,u):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new pr(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new pr(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new pr(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var i0=hd;class Vh{constructor(e,r){this.type=G,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Se),u=r.parse(e[2],2,Se);return a&&u?Xi(a.type,[G,L,ct,Sa,Se])?new Vh(a,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Lt(a.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!Gn(r,["boolean","string","number","null"]))throw new pr(`Expected first argument to be of type boolean, string, number or null, but found ${Lt(xr(r))} instead.`);if(!Gn(a,["string","array"]))throw new pr(`Expected second argument to be of type array or string, but found ${Lt(xr(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var fd=Vh;class Zl{constructor(e,r,a){this.type=ct,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Se),u=r.parse(e[2],2,Se);if(!a||!u)return null;if(!Xi(a.type,[G,L,ct,Sa,Se]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Lt(a.type)} instead`);if(e.length===4){const d=r.parse(e[3],3,ct);return d?new Zl(a,u,d):null}return new Zl(a,u)}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Gn(r,["boolean","string","number","null"]))throw new pr(`Expected first argument to be of type boolean, string, number or null, but found ${Lt(xr(r))} instead.`);if(!Gn(a,["string","array"]))throw new pr(`Expected second argument to be of type array or string, but found ${Lt(xr(a))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return a.indexOf(r,u)}return a.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Am=Zl;class Fu{constructor(e,r,a,u,d,m){this.inputType=e,this.type=r,this.input=a,this.cases=u,this.outputs=d,this.otherwise=m}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const d={},m=[];for(let T=2;T<e.length-1;T+=2){let E=e[T];const I=e[T+1];Array.isArray(E)||(E=[E]);const k=r.concat(T);if(E.length===0)return k.error("Expected at least one branch label.");for(const z of E){if(typeof z!="number"&&typeof z!="string")return k.error("Branch labels must be numbers or strings.");if(typeof z=="number"&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof z=="number"&&Math.floor(z)!==z)return k.error("Numeric branch labels must be integer values.");if(a){if(k.checkSubtype(a,xr(z)))return null}else a=xr(z);if(d[String(z)]!==void 0)return k.error("Branch labels must be unique.");d[String(z)]=m.length}const O=r.parse(I,T,u);if(!O)return null;u=u||O.type,m.push(O)}const y=r.parse(e[1],1,Se);if(!y)return null;const b=r.parse(e[e.length-1],e.length-1,u);return b?y.type.kind!=="value"&&r.concat(1).checkSubtype(a,y.type)?null:new Fu(a,u,y,d,m,b):null}evaluate(e){const r=this.input.evaluate(e);return(xr(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),a=[],u={};for(const m of r){const y=u[this.cases[m]];y===void 0?(u[this.cases[m]]=a.length,a.push([this.cases[m],[m]])):a[y][1].push(m)}const d=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,y]of a)e.push(y.length===1?d(y[0]):y.map(d)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}var n0=Fu;class Ms{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const u=[];for(let m=1;m<e.length-1;m+=2){const y=r.parse(e[m],m,G);if(!y)return null;const b=r.parse(e[m+1],m+1,a);if(!b)return null;u.push([y,b]),a=a||b.type}const d=r.parse(e[e.length-1],e.length-1,a);return d?new Ms(a,u,d):null}evaluate(e){for(const[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var r0=Ms;class Bu{constructor(e,r,a,u){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=u}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Se),u=r.parse(e[2],2,ct);if(!a||!u)return null;if(!Xi(a.type,[Nt(Se),L,Se]))return r.error(`Expected first argument to be of type array or string, but found ${Lt(a.type)} instead`);if(e.length===4){const d=r.parse(e[3],3,ct);return d?new Bu(a.type,a,u,d):null}return new Bu(a.type,a,u)}evaluate(e){const r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Gn(r,["string","array"]))throw new pr(`Expected first argument to be of type array or string, but found ${Lt(xr(r))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return r.slice(a,u)}return r.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var o0=Bu;function Im(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Cm(t,e,r,a){return a.compare(e,r)===0}function Fc(t,e,r){const a=t!=="=="&&t!=="!=";return class XP{constructor(d,m,y){this.type=G,this.lhs=d,this.rhs=m,this.collator=y,this.hasUntypedArgument=d.type.kind==="value"||m.type.kind==="value"}static parse(d,m){if(d.length!==3&&d.length!==4)return m.error("Expected two or three arguments.");const y=d[0];let b=m.parse(d[1],1,Se);if(!b)return null;if(!Im(y,b.type))return m.concat(1).error(`"${y}" comparisons are not supported for type '${Lt(b.type)}'.`);let T=m.parse(d[2],2,Se);if(!T)return null;if(!Im(y,T.type))return m.concat(2).error(`"${y}" comparisons are not supported for type '${Lt(T.type)}'.`);if(b.type.kind!==T.type.kind&&b.type.kind!=="value"&&T.type.kind!=="value")return m.error(`Cannot compare types '${Lt(b.type)}' and '${Lt(T.type)}'.`);a&&(b.type.kind==="value"&&T.type.kind!=="value"?b=new ls(T.type,[b]):b.type.kind!=="value"&&T.type.kind==="value"&&(T=new ls(b.type,[T])));let E=null;if(d.length===4){if(b.type.kind!=="string"&&T.type.kind!=="string"&&b.type.kind!=="value"&&T.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(E=m.parse(d[3],3,Oe),!E)return null}return new XP(b,T,E)}evaluate(d){const m=this.lhs.evaluate(d),y=this.rhs.evaluate(d);if(a&&this.hasUntypedArgument){const b=xr(m),T=xr(y);if(b.kind!==T.kind||b.kind!=="string"&&b.kind!=="number")throw new pr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${b.kind}, ${T.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=xr(m),T=xr(y);if(b.kind!=="string"||T.kind!=="string")return e(d,m,y)}return this.collator?r(d,m,y,this.collator.evaluate(d)):e(d,m,y)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[t];return this.eachChild(m=>{d.push(m.serialize())}),d}}}const Pm=Fc("==",function(t,e,r){return e===r},Cm),dd=Fc("!=",function(t,e,r){return e!==r},function(t,e,r,a){return!Cm(0,e,r,a)}),km=Fc("<",function(t,e,r){return e<r},function(t,e,r,a){return a.compare(e,r)<0}),s0=Fc(">",function(t,e,r){return e>r},function(t,e,r,a){return a.compare(e,r)>0}),Zo=Fc("<=",function(t,e,r){return e<=r},function(t,e,r,a){return a.compare(e,r)<=0}),a0=Fc(">=",function(t,e,r){return e>=r},function(t,e,r,a){return a.compare(e,r)>=0});class pd{constructor(e,r,a,u,d,m){this.type=L,this.number=e,this.locale=r,this.currency=a,this.unit=u,this.minFractionDigits=d,this.maxFractionDigits=m}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const a=r.parse(e[1],1,ct);if(!a)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let d=null;if(u.locale&&(d=r.parse(u.locale,1,L),!d))return null;let m=null;if(u.currency&&(m=r.parse(u.currency,1,L),!m))return null;let y=null;if(u.unit&&(y=r.parse(u.unit,1,L),!y))return null;let b=null;if(u["min-fraction-digits"]&&(b=r.parse(u["min-fraction-digits"],1,ct),!b))return null;let T=null;return u["max-fraction-digits"]&&(T=r.parse(u["max-fraction-digits"],1,ct),!T)?null:new pd(a,d,m,y,b,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class md{constructor(e){this.type=ct,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Lt(a.type)} instead.`):new md(a):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new pr(`Expected value to be of type string or array, but found ${Lt(xr(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}function Nu(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const gd={"==":Pm,"!=":dd,">":s0,"<":km,">=":a0,"<=":Zo,array:ls,at:i0,boolean:ls,case:r0,coalesce:ql,collator:Ol,format:tl,image:il,in:fd,"index-of":Am,interpolate:qo,"interpolate-hcl":qo,"interpolate-lab":qo,length:md,let:Em,literal:Ea,match:n0,number:ls,"number-format":pd,object:ls,slice:o0,step:oa,string:ls,"to-boolean":cs,"to-color":cs,"to-number":cs,"to-string":cs,var:Rr,within:nl,distance:Ci};function Uh(t,[e,r,a,u]){e=e.evaluate(t),r=r.evaluate(t),a=a.evaluate(t);const d=u?u.evaluate(t):1,m=xs(e,r,a,d);if(m)throw new pr(m);return new Ln(e/255*d,r/255*d,a/255*d,d)}function Dm(t,[e,r,a,u]){e=e.evaluate(t),r=r.evaluate(t),a=a.evaluate(t);const d=u?u.evaluate(t):1,m=function(T,E,I,k){return typeof T=="number"&&T>=0&&T<=360?typeof E=="number"&&E>=0&&E<=100&&typeof I=="number"&&I>=0&&I<=100?k===void 0||typeof k=="number"&&k>=0&&k<=1?null:`Invalid hsla value [${[T,E,I,k].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof k=="number"?[T,E,I,k]:[T,E,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof k=="number"?[T,E,I,k]:[T,E,I]).join(", ")}]: 'h' must be between 0 and 360.`}(e,r,a,d);if(m)throw new pr(m);const y=`hsla(${e}, ${r}%, ${a}%, ${d})`,b=Ln.parse(y);if(!b)throw new pr(`Failed to parse HSLA color: ${y}`);return b}function Lm(t,e){return t in e}function Xl(t,e){const r=e[t];return r===void 0?null:r}function Om(t,e){switch(t){case"string":return String(e);case"number":return+e;case"boolean":return!!e;case"color":return Ln.parse(e)}return e}function Rm(t,e,r,a){return a!==void 0&&(t=a*Math.round(t/a)),e!==void 0&&t<e&&(t=e),r!==void 0&&t>r&&(t=r),t}function _d(t,e,r){e=[e,r,t.scope].filter(Boolean).join("");const a=t.getConfig(e);if(!a)return null;const{type:u,value:d,values:m,minValue:y,maxValue:b,stepValue:T}=a,E=a.default.evaluate(t);let I=E;if(d){const k=t.scope;t.scope=(k||"").split("").slice(1).join(""),I=d.evaluate(t),t.scope=k}return u&&(I=Om(u,I)),d!==void 0&&I!==void 0&&m&&!m.includes(I)&&(I=E,u&&(I=Om(u,I))),I===void 0||y===void 0&&b===void 0&&T===void 0||(typeof I=="number"?I=Rm(I,y,b,T):Array.isArray(I)&&(I=I.map(k=>typeof k=="number"?Rm(k,y,b,T):k))),I}function ol(t){return{type:t}}jo.register(gd,{error:[{kind:"error"},[L],(t,[e])=>{throw new pr(e.evaluate(t))}],typeof:[L,[Se],(t,[e])=>Lt(xr(e.evaluate(t)))],"to-rgba":[Nt(ct,4),[le],(t,[e])=>e.evaluate(t).toArray()],rgb:[le,[ct,ct,ct],Uh],rgba:[le,[ct,ct,ct,ct],Uh],hsl:[le,[ct,ct,ct],Dm],hsla:[le,[ct,ct,ct,ct],Dm],has:{type:G,overloads:[[[L],(t,[e])=>Lm(e.evaluate(t),t.properties())],[[L,we],(t,[e,r])=>Lm(e.evaluate(t),r.evaluate(t))]]},get:{type:Se,overloads:[[[L],(t,[e])=>Xl(e.evaluate(t),t.properties())],[[L,we],(t,[e,r])=>Xl(e.evaluate(t),r.evaluate(t))]]},config:{type:Se,overloads:[[[L],(t,[e])=>_d(t,e.evaluate(t))],[[L,L],(t,[e,r])=>_d(t,e.evaluate(t),r.evaluate(t))]]},"feature-state":[Se,[L],(t,[e])=>Xl(e.evaluate(t),t.featureState||{})],properties:[we,[],t=>t.properties()],"geometry-type":[L,[],t=>t.geometryType()],id:[Se,[],t=>t.id()],zoom:[ct,[],t=>t.globals.zoom],pitch:[ct,[],t=>t.globals.pitch||0],"distance-from-center":[ct,[],t=>t.distanceFromCenter()],"measure-light":[ct,[L],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[ct,[],t=>t.globals.heatmapDensity||0],"line-progress":[ct,[],t=>t.globals.lineProgress||0],"raster-value":[ct,[],t=>t.globals.rasterValue||0],"sky-radial-progress":[ct,[],t=>t.globals.skyRadialProgress||0],accumulated:[Se,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[ct,ol(ct),(t,e)=>{let r=0;for(const a of e)r+=a.evaluate(t);return r}],"*":[ct,ol(ct),(t,e)=>{let r=1;for(const a of e)r*=a.evaluate(t);return r}],"-":{type:ct,overloads:[[[ct,ct],(t,[e,r])=>e.evaluate(t)-r.evaluate(t)],[[ct],(t,[e])=>-e.evaluate(t)]]},"/":[ct,[ct,ct],(t,[e,r])=>e.evaluate(t)/r.evaluate(t)],"%":[ct,[ct,ct],(t,[e,r])=>e.evaluate(t)%r.evaluate(t)],ln2:[ct,[],()=>Math.LN2],pi:[ct,[],()=>Math.PI],e:[ct,[],()=>Math.E],"^":[ct,[ct,ct],(t,[e,r])=>Math.pow(e.evaluate(t),r.evaluate(t))],sqrt:[ct,[ct],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[ct,[ct],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[ct,[ct],(t,[e])=>Math.log(e.evaluate(t))],log2:[ct,[ct],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[ct,[ct],(t,[e])=>Math.sin(e.evaluate(t))],cos:[ct,[ct],(t,[e])=>Math.cos(e.evaluate(t))],tan:[ct,[ct],(t,[e])=>Math.tan(e.evaluate(t))],asin:[ct,[ct],(t,[e])=>Math.asin(e.evaluate(t))],acos:[ct,[ct],(t,[e])=>Math.acos(e.evaluate(t))],atan:[ct,[ct],(t,[e])=>Math.atan(e.evaluate(t))],min:[ct,ol(ct),(t,e)=>Math.min(...e.map(r=>r.evaluate(t)))],max:[ct,ol(ct),(t,e)=>Math.max(...e.map(r=>r.evaluate(t)))],abs:[ct,[ct],(t,[e])=>Math.abs(e.evaluate(t))],round:[ct,[ct],(t,[e])=>{const r=e.evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[ct,[ct],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[ct,[ct],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[G,[L,Se],(t,[e,r])=>t.properties()[e.value]===r.value],"filter-id-==":[G,[Se],(t,[e])=>t.id()===e.value],"filter-type-==":[G,[L],(t,[e])=>t.geometryType()===e.value],"filter-<":[G,[L,Se],(t,[e,r])=>{const a=t.properties()[e.value],u=r.value;return typeof a==typeof u&&a<u}],"filter-id-<":[G,[Se],(t,[e])=>{const r=t.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[G,[L,Se],(t,[e,r])=>{const a=t.properties()[e.value],u=r.value;return typeof a==typeof u&&a>u}],"filter-id->":[G,[Se],(t,[e])=>{const r=t.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[G,[L,Se],(t,[e,r])=>{const a=t.properties()[e.value],u=r.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[G,[Se],(t,[e])=>{const r=t.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[G,[L,Se],(t,[e,r])=>{const a=t.properties()[e.value],u=r.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[G,[Se],(t,[e])=>{const r=t.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[G,[Se],(t,[e])=>e.value in t.properties()],"filter-has-id":[G,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[G,[Nt(L)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[G,[Nt(Se)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[G,[L,Nt(Se)],(t,[e,r])=>r.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[G,[L,Nt(Se)],(t,[e,r])=>function(a,u,d,m){for(;d<=m;){const y=d+m>>1;if(u[y]===a)return!0;u[y]>a?m=y-1:d=y+1}return!1}(t.properties()[e.value],r.value,0,r.value.length-1)],all:{type:G,overloads:[[[G,G],(t,[e,r])=>e.evaluate(t)&&r.evaluate(t)],[ol(G),(t,e)=>{for(const r of e)if(!r.evaluate(t))return!1;return!0}]]},any:{type:G,overloads:[[[G,G],(t,[e,r])=>e.evaluate(t)||r.evaluate(t)],[ol(G),(t,e)=>{for(const r of e)if(r.evaluate(t))return!0;return!1}]]},"!":[G,[G],(t,[e])=>!e.evaluate(t)],"is-supported-script":[G,[L],(t,[e])=>{const r=t.globals&&t.globals.isSupportedScript;return!r||r(e.evaluate(t))}],upcase:[L,[L],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[L,[L],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[L,ol(Se),(t,e)=>e.map(r=>el(r.evaluate(t))).join("")],"resolved-locale":[L,[Oe],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[ct,[ct,ct,Se],(t,e)=>{const[r,a,u]=e.map(m=>m.evaluate(t));if(r>a||r===a)return r;let d;if(typeof u=="string")d=function(m){let y=0;if(m.length===0)return y;for(let b=0;b<m.length;b++)y=(y<<5)-y+m.charCodeAt(b),y&=y;return y}(u);else{if(typeof u!="number")throw new pr(`Invalid seed input: ${u}`);d=u}return r+Nu(d)()*(a-r)}]});var Vu=gd;function Es(t){return{result:"success",value:t}}function sl(t){return{result:"error",value:t}}function zm(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function al(t){return t["property-type"]==="data-driven"}function Uu(t){return zm(t.expression,"measure-light")}function yd(t){return zm(t.expression,"zoom")}function vd(t){return!!t.expression&&t.expression.interpolated}function jh(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function l0(t){return t}function Fm(t,e){const r=e.type==="color",a=t.stops&&typeof t.stops[0][0]=="object",u=a||!(a||t.property!==void 0),d=t.type||(vd(e)?"exponential":"interval");if(r&&((t=ss({},t)).stops&&(t.stops=t.stops.map(T=>[T[0],Ln.parse(T[1])])),t.default=Ln.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!zc[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let m,y,b;if(d==="exponential")m=ju;else if(d==="interval")m=gs;else if(d==="categorical"){m=Gh,y=Object.create(null);for(const T of t.stops)y[T[0]]=T[1];b=typeof t.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);m=c0}if(a){const T={},E=[];for(let O=0;O<t.stops.length;O++){const z=t.stops[O],N=z[0].zoom;T[N]===void 0&&(T[N]={zoom:N,type:t.type,property:t.property,default:t.default,stops:[]},E.push(N)),T[N].stops.push([z[0].value,z[1]])}const I=[];for(const O of E)I.push([T[O].zoom,Fm(T[O],e)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:qo.interpolationFactor.bind(void 0,k),zoomStops:I.map(O=>O[0]),evaluate:({zoom:O},z)=>ju({stops:I,base:t.base},e,O).evaluate(O,z)}}if(u){const T=d==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:qo.interpolationFactor.bind(void 0,T),zoomStops:t.stops.map(E=>E[0]),evaluate:({zoom:E})=>m(t,e,E,y,b)}}return{kind:"source",evaluate(T,E){const I=E&&E.properties?E.properties[t.property]:void 0;return I===void 0?ll(t.default,e.default):m(t,e,I,y,b)}}}function ll(t,e,r){return t!==void 0?t:e!==void 0?e:r!==void 0?r:void 0}function Gh(t,e,r,a,u){return ll(typeof r===u?a[r]:void 0,t.default,e.default)}function gs(t,e,r){if(ln(r)!=="number")return ll(t.default,e.default);const a=t.stops.length;if(a===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[a-1][0])return t.stops[a-1][1];const u=Gr(t.stops.map(d=>d[0]),r);return t.stops[u][1]}function ju(t,e,r){const a=t.base!==void 0?t.base:1;if(ln(r)!=="number")return ll(t.default,e.default);const u=t.stops.length;if(u===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[u-1][0])return t.stops[u-1][1];const d=Gr(t.stops.map(E=>E[0]),r),m=function(E,I,k,O){const z=O-k,N=E-k;return z===0?0:I===1?N/z:(Math.pow(I,N)-1)/(Math.pow(I,z)-1)}(r,a,t.stops[d][0],t.stops[d+1][0]),y=t.stops[d][1],b=t.stops[d+1][1];let T=Gs[e.type]||l0;if(t.colorSpace&&t.colorSpace!=="rgb"){const E=zc[t.colorSpace];T=(I,k)=>E.reverse(E.interpolate(E.forward(I),E.forward(k),m))}return typeof y.evaluate=="function"?{evaluate(...E){const I=y.evaluate.apply(void 0,E),k=b.evaluate.apply(void 0,E);if(I!==void 0&&k!==void 0)return T(I,k,m)}}:T(y,b,m)}function c0(t,e,r){return e.type==="color"?r=Ln.parse(r):e.type==="formatted"?r=ao.fromString(r.toString()):e.type==="resolvedImage"?r=Uo.fromString(r.toString()):ln(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),ll(r,t.default,e.default)}class xd{constructor(e,r,a,u){this.expression=e,this._warningHistory={},this._evaluator=new Pc(a,u),this._defaultValue=r?function(d){return d.type==="color"&&(jh(d.default)||Array.isArray(d.default))?new Ln(0,0,0,0):d.type==="color"?Ln.parse(d.default)||null:d.default===void 0?null:d.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,a,u,d,m,y,b){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=u||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,u,d,m,y,b){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new pr(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Hh(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Vu}function Gu(t,e,r,a){const u=new Go(Vu,[],e?function(m){const y={color:le,string:L,number:ct,enum:L,boolean:G,formatted:Ve,resolvedImage:Ft};return m.type==="array"?Nt(y[m.value]||Se,m.length):y[m.type]}(e):void 0,void 0,void 0,r,a),d=u.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?Es(new xd(d,e,r,a)):sl(u.errors)}class Hu{constructor(e,r,a){this.kind=e,this._styleExpression=r,this.isLightConstant=a,this.isStateDependent=e!=="constant"&&!ji(r.expression),this.isConfigDependent=!nr(r.expression)}evaluateWithoutErrorHandling(e,r,a,u,d,m){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,u,d,m)}evaluate(e,r,a,u,d,m){return this._styleExpression.evaluate(e,r,a,u,d,m)}}class Wu{constructor(e,r,a,u,d){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!ji(r.expression),this.isLightConstant=d,this.isConfigDependent=!nr(r.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,r,a,u,d,m){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,u,d,m)}evaluate(e,r,a,u,d,m){return this._styleExpression.evaluate(e,r,a,u,d,m)}interpolationFactor(e,r,a){return this.interpolationType?qo.interpolationFactor(this.interpolationType,e,r,a):0}}function qu(t,e,r,a){if((t=Gu(t,e,r,a)).result==="error")return t;const u=t.value.expression,d=Fn(u);if(!d&&!al(e))return sl([new Vo("","data expressions not supported")]);const m=rr(u,["zoom","pitch","distance-from-center"]);if(!m&&!yd(e))return sl([new Vo("","zoom expressions not supported")]);const y=rr(u,["measure-light"]);if(!y&&!Uu(e))return sl([new Vo("","measure-light expression not supported")]);const b=e.expression&&e.expression.relaxZoomRestriction,T=qh(u);return T||m||b?T instanceof Vo?sl([T]):T instanceof qo&&!vd(e)?sl([new Vo("",'"interpolate" expressions cannot be used with this property')]):Es(T?new Wu(d?"camera":"composite",t.value,T.labels,T instanceof qo?T.interpolation:void 0,y):new Hu(d?"constant":"source",t.value,y)):sl([new Vo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Wh{constructor(e,r){this._parameters=e,this._specification=r,ss(this,Fm(this._parameters,this._specification))}static deserialize(e){return new Wh(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function qh(t){let e=null;if(t instanceof Em)e=qh(t.result);else if(t instanceof ql){for(const r of t.args)if(e=qh(r),e)break}else(t instanceof oa||t instanceof qo)&&t.input instanceof jo&&t.input.name==="zoom"&&(e=t);return e instanceof Vo||t.eachChild(r=>{const a=qh(r);a instanceof Vo?e=a:e&&a&&e!==a&&(e=new Vo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Xo(t){const e=t.key,r=t.value,a=t.valueSpec||{},u=t.objectElementValidators||{},d=t.style,m=t.styleSpec;let y=[];const b=ln(r);if(b!=="object")return[new ri(e,r,`object expected, ${b} found`)];for(const T in r){const E=T.split(".")[0];let I;u[E]?I=u[E]:a[E]?I=Nr:u["*"]?I=u["*"]:a["*"]&&(I=Nr),I?y=y.concat(I({key:(e&&`${e}.`)+T,value:r[T],valueSpec:a[E]||a["*"],style:d,styleSpec:m,object:r,objectKey:T},r)):y.push(new vs(e,r[T],`unknown property "${T}"`))}for(const T in a)u[T]||a[T].required&&a[T].default===void 0&&r[T]===void 0&&y.push(new ri(e,r,`missing required property "${T}"`));return y}function Bm(t){const e=t.value,r=t.valueSpec,a=t.style,u=t.styleSpec,d=t.key,m=t.arrayElementValidator||Nr;if(ln(e)!=="array")return[new ri(d,e,`array expected, ${ln(e)} found`)];if(r.length&&e.length!==r.length)return[new ri(d,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new ri(d,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let y={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};u.$version<7&&(y.function=r.function),ln(r.value)==="object"&&(y=r.value);let b=[];for(let T=0;T<e.length;T++)b=b.concat(m({array:e,arrayIndex:T,value:e[T],valueSpec:y,style:a,styleSpec:u,key:`${d}[${T}]`},!0));return b}function bd(t){const e=t.key,r=t.value,a=t.valueSpec;let u=ln(r);if(u==="number"&&r!=r&&(u="NaN"),u!=="number")return[new ri(e,r,`number expected, ${u} found`)];if("minimum"in a){let d=a.minimum;if(ln(a.minimum)==="array"&&(d=a.minimum[t.arrayIndex]),r<d)return[new ri(e,r,`${r} is less than the minimum value ${d}`)]}if("maximum"in a){let d=a.maximum;if(ln(a.maximum)==="array"&&(d=a.maximum[t.arrayIndex]),r>d)return[new ri(e,r,`${r} is greater than the maximum value ${d}`)]}return[]}function wd(t){const e=t.valueSpec,r=dr(t.value.type);let a,u,d,m={};const y=r!=="categorical"&&t.value.property===void 0,b=!y,T=ln(t.value.stops)==="array"&&ln(t.value.stops[0])==="array"&&ln(t.value.stops[0][0])==="object",E=Xo({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(O){if(r==="identity")return[new ri(O.key,O.value,'identity function may not have a "stops" property')];let z=[];const N=O.value;return z=z.concat(Bm({key:O.key,value:N,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:I})),ln(N)==="array"&&N.length===0&&z.push(new ri(O.key,N,"array must have at least one stop")),z},default:function(O){return Nr({key:O.key,value:O.value,valueSpec:e,style:O.style,styleSpec:O.styleSpec})}}});return r==="identity"&&y&&E.push(new ri(t.key,t.value,'missing required property "property"')),r==="identity"||t.value.stops||E.push(new ri(t.key,t.value,'missing required property "stops"')),r==="exponential"&&t.valueSpec.expression&&!vd(t.valueSpec)&&E.push(new ri(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(b&&!al(t.valueSpec)?E.push(new ri(t.key,t.value,"property functions not supported")):y&&!yd(t.valueSpec)&&E.push(new ri(t.key,t.value,"zoom functions not supported"))),r!=="categorical"&&!T||t.value.property!==void 0||E.push(new ri(t.key,t.value,'"property" property is required')),E;function I(O){let z=[];const N=O.value,j=O.key;if(ln(N)!=="array")return[new ri(j,N,`array expected, ${ln(N)} found`)];if(N.length!==2)return[new ri(j,N,`array length 2 expected, length ${N.length} found`)];if(T){if(ln(N[0])!=="object")return[new ri(j,N,`object expected, ${ln(N[0])} found`)];if(N[0].zoom===void 0)return[new ri(j,N,"object stop key must have zoom")];if(N[0].value===void 0)return[new ri(j,N,"object stop key must have value")];const q=dr(N[0].zoom);if(typeof q!="number")return[new ri(j,N[0].zoom,"stop zoom values must be numbers")];if(d&&d>q)return[new ri(j,N[0].zoom,"stop zoom values must appear in ascending order")];q!==d&&(d=q,u=void 0,m={}),z=z.concat(Xo({key:`${j}[0]`,value:N[0],valueSpec:{zoom:{}},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:bd,value:k}}))}else z=z.concat(k({key:`${j}[0]`,value:N[0],valueSpec:{},style:O.style,styleSpec:O.styleSpec},N));return Hh(as(N[1]))?z.concat([new ri(`${j}[1]`,N[1],"expressions are not allowed in function stops.")]):z.concat(Nr({key:`${j}[1]`,value:N[1],valueSpec:e,style:O.style,styleSpec:O.styleSpec}))}function k(O,z){const N=ln(O.value),j=dr(O.value),q=O.value!==null?O.value:z;if(a){if(N!==a)return[new ri(O.key,q,`${N} stop domain type must match previous stop domain type ${a}`)]}else a=N;if(N!=="number"&&N!=="string"&&N!=="boolean"&&typeof j!="number"&&typeof j!="string"&&typeof j!="boolean")return[new ri(O.key,q,"stop domain value must be a number, string, or boolean")];if(N!=="number"&&r!=="categorical"){let ie=`number expected, ${N} found`;return al(e)&&r===void 0&&(ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ri(O.key,q,ie)]}return r!=="categorical"||N!=="number"||typeof j=="number"&&isFinite(j)&&Math.floor(j)===j?r!=="categorical"&&N==="number"&&typeof j=="number"&&typeof u=="number"&&u!==void 0&&j<u?[new ri(O.key,q,"stop domain values must appear in ascending order")]:(u=j,r==="categorical"&&j in m?[new ri(O.key,q,"stop domain values must be unique")]:(m[j]=!0,[])):[new ri(O.key,q,`integer expected, found ${String(j)}`)]}}function Yl(t){const e=(t.expressionContext==="property"?qu:Gu)(as(t.value),t.valueSpec);if(e.result==="error")return e.value.map(a=>new ri(`${t.key}${a.key}`,t.value,a.message));const r=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!r.outputDefined())return[new ri(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!ji(r))return[new ri(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return Zh(r,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!rr(r,["zoom","feature-state"]))return[new ri(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Fn(r))return[new ri(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Zh(t,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const u of e.valueSpec.expression.parameters)r.delete(u);if(r.size===0)return[];const a=[];return t instanceof jo&&r.has(t.name)?[new ri(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(u=>{a.push(...Zh(u,e))}),a)}function Jl(t){const e=t.key,r=t.value,a=t.valueSpec,u=[];return Array.isArray(a.values)?a.values.indexOf(dr(r))===-1&&u.push(new ri(e,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(dr(r))===-1&&u.push(new ri(e,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),u}function Xh(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Xh(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Yh(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Xh(t)||(t=Jh(t));const r=t;let a=!0;try{a=function(T){if(!cl(T))return T;let E=as(T);return Nm(E),E=Td(E),E}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const u=Be[`filter_${e}`],d=Gu(a,u);let m=null;if(d.result==="error")throw new Error(d.value.map(T=>`${T.key}: ${T.message}`).join(", "));m=(T,E,I)=>d.value.evaluate(T,E,{},I);let y=null,b=null;if(a!==r){const T=Gu(r,u);if(T.result==="error")throw new Error(T.value.map(E=>`${E.key}: ${E.message}`).join(", "));y=(E,I,k,O,z)=>T.value.evaluate(E,I,{},k,void 0,void 0,O,z),b=!Fn(T.value.expression)}return{filter:m,dynamicFilter:y||void 0,needGeometry:Vm(a),needFeature:!!b}}function Td(t){if(!Array.isArray(t))return t;const e=function(r){if(u0.has(r[0])){for(let a=1;a<r.length;a++)if(cl(r[a]))return!0}return r}(t);return e===!0?e:e.map(r=>Td(r))}function Nm(t){let e=!1;const r=[];if(t[0]==="case"){for(let a=1;a<t.length-1;a+=2)e=e||cl(t[a]),r.push(t[a+1]);r.push(t[t.length-1])}else if(t[0]==="match"){e=e||cl(t[1]);for(let a=2;a<t.length-1;a+=2)r.push(t[a+1]);r.push(t[t.length-1])}else if(t[0]==="step"){e=e||cl(t[1]);for(let a=1;a<t.length-1;a+=2)r.push(t[a+1])}e&&(t.length=0,t.push("any",...r));for(let a=1;a<t.length;a++)Nm(t[a])}function cl(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<t.length;r++)if(cl(t[r]))return!0;return!1}const u0=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function h0(t,e){return t<e?-1:t>e?1:0}function Vm(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(Vm(t[e]))return!0;return!1}function Jh(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?Kh(t[1],t[2],"=="):e==="!="?Qh(Kh(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Kh(t[1],t[2],e):e==="any"?(r=t.slice(1),["any"].concat(r.map(Jh))):e==="all"?["all"].concat(t.slice(1).map(Jh)):e==="none"?["all"].concat(t.slice(1).map(Jh).map(Qh)):e==="in"?Um(t[1],t.slice(2)):e==="!in"?Qh(Um(t[1],t.slice(2))):e==="has"?jm(t[1]):e!=="!has"||Qh(jm(t[1]));var r}function Kh(t,e,r){switch(t){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,t,e]}}function Um(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",t,["literal",e.sort(h0)]]:["filter-in-small",t,["literal",e]]}}function jm(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Qh(t){return["!",t]}function Sd(t){return Xh(as(t.value))?Yl(ss({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):Gm(t)}function Gm(t){const e=t.value,r=t.key;if(ln(e)!=="array")return[new ri(r,e,`array expected, ${ln(e)} found`)];const a=t.styleSpec;let u,d=[];if(e.length<1)return[new ri(r,e,"filter array must have at least 1 element")];switch(d=d.concat(Jl({key:`${r}[0]`,value:e[0],valueSpec:a.filter_operator,style:t.style,styleSpec:t.styleSpec})),dr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&dr(e[1])==="$type"&&d.push(new ri(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new ri(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=ln(e[1]),u!=="string"&&d.push(new ri(`${r}[1]`,e[1],`string expected, ${u} found`)));for(let m=2;m<e.length;m++)u=ln(e[m]),dr(e[1])==="$type"?d=d.concat(Jl({key:`${r}[${m}]`,value:e[m],valueSpec:a.geometry_type,style:t.style,styleSpec:t.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&d.push(new ri(`${r}[${m}]`,e[m],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)d=d.concat(Gm({key:`${r}[${m}]`,value:e[m],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":u=ln(e[1]),e.length!==2?d.push(new ri(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&d.push(new ri(`${r}[1]`,e[1],`string expected, ${u} found`))}return d}function Hm(t,e){const r=t.key,a=t.style,u=t.layer,d=t.styleSpec,m=t.value,y=t.objectKey,b=d[`${e}_${t.layerType}`];if(!b)return[];const T=y.match(/^(.*)-transition$/);if(e==="paint"&&T&&b[T[1]]&&b[T[1]].transition)return Nr({key:r,value:m,valueSpec:d.transition,style:a,styleSpec:d});const E=t.valueSpec||b[y];if(!E)return[new vs(r,m,`unknown property "${y}"`)];let I;if(ln(m)==="string"&&al(E)&&!E.tokens&&(I=/^{([^}]+)}$/.exec(m))){const O=`\`{ "type": "identity", "property": ${I?JSON.stringify(I[1]):'"_"'} }\``;return[new ri(r,m,`"${y}" does not support interpolation syntax
Use an identity property function instead: ${O}.`)]}const k=[];if(t.layerType==="symbol")y!=="text-field"||!a||a.glyphs||a.imports||k.push(new ri(r,m,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&jh(as(m))&&dr(m.type)==="identity"&&k.push(new ri(r,m,'"text-font" does not support identity functions'));else if(t.layerType==="model"&&e==="paint"&&u&&u.layout&&u.layout.hasOwnProperty("model-id")&&al(E)&&(Uu(E)||yd(E))){const O=qu(as(m),E),z=O.value.expression||O.value._styleExpression.expression;z&&!rr(z,["measure-light"])&&(y==="model-emissive-strength"&&Fn(z)&&ji(z)||k.push(new ri(r,m,`${y} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return k.concat(Nr({key:t.key,value:m,valueSpec:E,style:a,styleSpec:d,expressionContext:"property",propertyType:e,propertyKey:y}))}function Wm(t){return Hm(t,"paint")}function Zu(t){return Hm(t,"layout")}function qm(t){let e=[];const r=t.value,a=t.key,u=t.style,d=t.styleSpec;r.type||r.ref||e.push(new ri(a,r,'either "type" or "ref" is required'));let m=dr(r.type);const y=dr(r.ref);if(r.id){const b=dr(r.id);for(let T=0;T<t.arrayIndex;T++){const E=u.layers[T];dr(E.id)===b&&e.push(new ri(a,r.id,`duplicate layer id "${r.id}", previously used at line ${E.id.__line__}`))}}if("ref"in r){let b;["type","source","source-layer","filter","layout"].forEach(T=>{T in r&&e.push(new ri(a,r[T],`"${T}" is prohibited for ref layers`))}),u.layers.forEach(T=>{dr(T.id)===y&&(b=T)}),b?b.ref?e.push(new ri(a,r.ref,"ref cannot reference another ref layer")):m=dr(b.type):typeof y=="string"&&e.push(new ri(a,r.ref,`ref layer "${y}" not found`))}else if(m!=="background"&&m!=="sky"&&m!=="slot")if(r.source){const b=u.sources&&u.sources[r.source],T=b&&dr(b.type);b?T==="vector"&&m==="raster"?e.push(new ri(a,r.source,`layer "${r.id}" requires a raster source`)):T==="raster"&&m!=="raster"?e.push(new ri(a,r.source,`layer "${r.id}" requires a vector source`)):T!=="vector"||r["source-layer"]?T==="raster-dem"&&m!=="hillshade"?e.push(new ri(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||T==="geojson"&&b.lineMetrics||e.push(new ri(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ri(a,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new ri(a,r.source,`source "${r.source}" not found`))}else e.push(new ri(a,r,'missing required property "source"'));return e=e.concat(Xo({key:a,value:r,valueSpec:d.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Nr({key:`${a}.type`,value:r.type,valueSpec:d.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"}),filter:b=>Sd(ss({layerType:m},b)),layout:b=>Xo({layer:r,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":T=>Zu(ss({layerType:m},T))}}),paint:b=>Xo({layer:r,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":T=>Wm(ss({layerType:m,layer:r},T))}})}})),e}function Bc(t){const e=t.value,r=t.key,a=ln(e);return a!=="string"?[new ri(r,e,`string expected, ${a} found`)]:[]}const Xu={promoteId:function({key:t,value:e}){if(ln(e)==="string")return Bc({key:t,value:e});{const r=[];for(const a in e)r.push(...Bc({key:`${t}.${a}`,value:e[a]}));return r}}};function Zm(t){const e=t.value,r=t.key,a=t.styleSpec,u=t.style;if(!e.type)return[new ri(r,e,'"type" is required')];const d=dr(e.type);let m=[];switch(["vector","raster","raster-dem"].includes(d)&&(e.url||e.tiles||m.push(new vs(r,e,'Either "url" or "tiles" is required.'))),d){case"vector":case"raster":case"raster-dem":return m=m.concat(Xo({key:r,value:e,valueSpec:a[`source_${d.replace("-","_")}`],style:t.style,styleSpec:a,objectElementValidators:Xu})),m;case"geojson":if(m=Xo({key:r,value:e,valueSpec:a.source_geojson,style:u,styleSpec:a,objectElementValidators:Xu}),e.cluster)for(const y in e.clusterProperties){const[b,T]=e.clusterProperties[y],E=typeof b=="string"?[b,["accumulated"],["get",y]]:b;m.push(...Yl({key:`${r}.${y}.map`,value:T,expressionContext:"cluster-map"})),m.push(...Yl({key:`${r}.${y}.reduce`,value:E,expressionContext:"cluster-reduce"}))}return m;case"video":return Xo({key:r,value:e,valueSpec:a.source_video,style:u,styleSpec:a});case"image":return Xo({key:r,value:e,valueSpec:a.source_image,style:u,styleSpec:a});case"canvas":return[new ri(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Jl({key:`${r}.type`,value:e.type,valueSpec:{values:Xm(a)},style:u,styleSpec:a})}}function Xm(t){return t.source.reduce((e,r)=>{const a=t[r];return a.type.type==="enum"&&(e=e.concat(Object.keys(a.type.values))),e},[])}function Ym(t){const e=t.value;let r=[];if(!e)return r;const a=ln(e);return a!=="string"?(r=r.concat([new ri(t.key,e,`string expected, "${a}" found`)]),r):(function(u){const d=u.indexOf("://")===-1;try{return new URL(u,d?"http://example.com":void 0),!0}catch{return!1}}(e)||(r=r.concat([new ri(t.key,e,`invalid url "${e}"`)])),r)}function Md(t){const e=t.value,r=t.styleSpec,a=r.light,u=t.style;let d=[];const m=ln(e);if(e===void 0)return d;if(m!=="object")return d=d.concat([new ri("light",e,`object expected, ${m} found`)]),d;for(const y in e){const b=y.match(/^(.*)-transition$/);d=d.concat(b&&a[b[1]]&&a[b[1]].transition?Nr({key:y,value:e[y],valueSpec:r.transition,style:u,styleSpec:r}):a[y]?Nr({key:y,value:e[y],valueSpec:a[y],style:u,styleSpec:r}):[new ri(y,e[y],`unknown property "${y}"`)])}return d}function Ed(t){const e=t.value;let r=[];if(!e)return r;const a=ln(e);if(a!=="object")return r=r.concat([new ri("light-3d",e,`object expected, ${a} found`)]),r;const u=t.styleSpec,d=u["light-3d"],m=t.key,y=t.style,b=t.style.lights;for(const I of["type","id"])if(!(I in e))return r=r.concat([new ri("light-3d",e,`missing property ${I} on light`)]),r;if(e.type&&b)for(let I=0;I<t.arrayIndex;I++){const k=dr(e.type),O=b[I];dr(O.type)===k&&r.push(new ri(m,e.id,`duplicate light type "${e.type}", previously defined at line ${O.id.__line__}`))}const T=`properties_light_${e.type}`;if(!(T in u))return r=r.concat([new ri("light-3d",e,`Invalid light type ${e.type}`)]),r;const E=u[T];for(const I in e)if(I==="properties"){const k=e[I],O=ln(k);if(O!=="object")return r=r.concat([new ri("properties",k,`object expected, ${O} found`)]),r;for(const z in k)r=r.concat(E[z]?Nr({key:z,value:k[z],valueSpec:E[z],style:y,styleSpec:u}):[new vs(t.key,k[z],`unknown property "${z}"`)])}else{const k=I.match(/^(.*)-transition$/);r=r.concat(k&&d[k[1]]&&d[k[1]].transition?Nr({key:I,value:e[I],valueSpec:u.transition,style:y,styleSpec:u}):d[I]?Nr({key:I,value:e[I],valueSpec:d[I],style:y,styleSpec:u}):[new vs(I,e[I],`unknown property "${I}"`)])}return r}function Ad(t){const e=t.value,r=t.key,a=t.style,u=t.styleSpec,d=u.terrain;let m=[];const y=ln(e);if(e===void 0||y==="null")return m;if(y!=="object")return m=m.concat([new ri("terrain",e,`object expected, ${y} found`)]),m;for(const b in e){const T=b.match(/^(.*)-transition$/);m=m.concat(T&&d[T[1]]&&d[T[1]].transition?Nr({key:b,value:e[b],valueSpec:u.transition,style:a,styleSpec:u}):d[b]?Nr({key:b,value:e[b],valueSpec:d[b],style:a,styleSpec:u}):[new vs(b,e[b],`unknown property "${b}"`)])}if(e.source){const b=a.sources&&a.sources[e.source],T=b&&dr(b.type);b?T!=="raster-dem"&&m.push(new ri(r,e.source,`terrain cannot be used with a source of type ${String(T)}, it only be used with a "raster-dem" source type`)):m.push(new ri(r,e.source,`source "${e.source}" not found`))}else m.push(new ri(r,e,'terrain is missing required property "source"'));return m}function Id(t){const e=t.value,r=t.style,a=t.styleSpec,u=a.fog;let d=[];const m=ln(e);if(e===void 0)return d;if(m!=="object")return d=d.concat([new ri("fog",e,`object expected, ${m} found`)]),d;for(const y in e){const b=y.match(/^(.*)-transition$/);d=d.concat(b&&u[b[1]]&&u[b[1]].transition?Nr({key:y,value:e[y],valueSpec:a.transition,style:r,styleSpec:a}):u[y]?Nr({key:y,value:e[y],valueSpec:u[y],style:r,styleSpec:a}):[new vs(y,e[y],`unknown property "${y}"`)])}return d}const $h={"*":()=>[],array:Bm,boolean:function(t){const e=t.value,r=t.key,a=ln(e);return a!=="boolean"?[new ri(r,e,`boolean expected, ${a} found`)]:[]},number:bd,color:function(t){const e=t.key,r=t.value,a=ln(r);return a!=="string"?[new ri(e,r,`color expected, ${a} found`)]:Ki(r)===null?[new ri(e,r,`color expected, "${r}" found`)]:[]},enum:Jl,filter:Sd,function:wd,layer:qm,object:Xo,source:Zm,model:Ym,light:Md,"light-3d":Ed,terrain:Ad,fog:Id,string:Bc,formatted:function(t){return Bc(t).length===0?[]:Yl(t)},resolvedImage:function(t){return Bc(t).length===0?[]:Yl(t)},projection:function(t){const e=t.value,r=t.styleSpec,a=r.projection,u=t.style;let d=[];const m=ln(e);if(m==="object")for(const y in e)d=d.concat(Nr({key:y,value:e[y],valueSpec:a[y],style:u,styleSpec:r}));else m!=="string"&&(d=d.concat([new ri("projection",e,`object or string expected, ${m} found`)]));return d},import:function(t){const{value:e,styleSpec:r}=t,{data:a,...u}=e;Object.defineProperty(u,"__line__",{value:e.__line__,enumerable:!1});let d=Xo(ss({},t,{value:u,valueSpec:r.import}));return dr(u.id)===""&&d.push(new ri(`${t.key}.id`,u,"import id can't be an empty string")),a&&(d=d.concat(Jm(a,r,{key:`${t.key}.data`}))),d}};function Nr(t,e=!1){const r=t.value,a=t.valueSpec,u=t.styleSpec;if(a.expression&&jh(dr(r)))return wd(t);if(a.expression&&Hh(as(r)))return Yl(t);if(a.type&&$h[a.type]){const d=$h[a.type](t);return e===!0&&d.length>0&&ln(t.value)==="array"?Yl(t):d}return Xo(ss({},t,{valueSpec:a.type?u[a.type]:a}))}function f0(t){const e=t.value,r=t.key,a=Bc(t);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new ri(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new ri(r,e,'"glyphs" url must include a "{range}" token'))),a}function Jm(t,e=Be,r={}){return Nr({key:r.key||"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:f0,"*":()=>[]}})}function Cd(t,e=Be){return Hs(Jm(t,e))}const d0=t=>Hs(Wm(t)),p0=t=>Hs(Zu(t));function Hs(t){return t.slice().sort((e,r)=>e.line&&r.line?e.line-r.line:0)}function Km(t,e){let r=!1;if(e&&e.length)for(const a of e)a instanceof vs?si(a.message):(t.fire(new Po(new Error(a.message))),r=!0);return r}var m0=la,ul=3;function la(t,e,r){var a=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var u=new Int32Array(this.arrayBuffer);t=u[0],this.d=(e=u[1])+2*(r=u[2]);for(var d=0;d<this.d*this.d;d++){var m=u[ul+d],y=u[ul+d+1];a.push(m===y?null:u.subarray(m,y))}var b=u[ul+a.length+1];this.keys=u.subarray(u[ul+a.length],b),this.bboxes=u.subarray(b),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var T=0;T<this.d*this.d;T++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var E=r/e*t;this.min=-E,this.max=t+E}la.prototype.insert=function(t,e,r,a,u){this._forEachCell(e,r,a,u,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(u)},la.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},la.prototype._insertCell=function(t,e,r,a,u,d){this.cells[u].push(d)},la.prototype.query=function(t,e,r,a,u){var d=this.min,m=this.max;if(t<=d&&e<=d&&m<=r&&m<=a&&!u)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(t,e,r,a,this._queryCell,y,{},u),y},la.prototype._queryCell=function(t,e,r,a,u,d,m,y){var b=this.cells[u];if(b!==null)for(var T=this.keys,E=this.bboxes,I=0;I<b.length;I++){var k=b[I];if(m[k]===void 0){var O=4*k;(y?y(E[O+0],E[O+1],E[O+2],E[O+3]):t<=E[O+2]&&e<=E[O+3]&&r>=E[O+0]&&a>=E[O+1])?(m[k]=!0,d.push(T[k])):m[k]=!1}}},la.prototype._forEachCell=function(t,e,r,a,u,d,m,y){for(var b=this._convertToCellCoord(t),T=this._convertToCellCoord(e),E=this._convertToCellCoord(r),I=this._convertToCellCoord(a),k=b;k<=E;k++)for(var O=T;O<=I;O++){var z=this.d*O+k;if((!y||y(this._convertFromCellCoord(k),this._convertFromCellCoord(O),this._convertFromCellCoord(k+1),this._convertFromCellCoord(O+1)))&&u.call(this,t,e,r,a,z,d,m,y))return}},la.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},la.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},la.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=ul+this.cells.length+1+1,r=0,a=0;a<this.cells.length;a++)r+=this.cells[a].length;var u=new Int32Array(e+r+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var d=e,m=0;m<t.length;m++){var y=t[m];u[ul+m]=d,u.set(y,d),d+=y.length}return u[ul+t.length]=d,u.set(this.keys,d),u[ul+t.length+1]=d+=this.keys.length,u.set(this.bboxes,d),d+=this.bboxes.length,u.buffer};var Nc=pe(m0);const ef={};function ei(t,e,r={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),ef[e]={klass:t,omit:r.omit||[]}}ei(Object,"Object"),Nc.serialize=function(t,e){const r=t.toArrayBuffer();return e&&e.add(r),{buffer:r}},Nc.deserialize=function(t){return new Nc(t.buffer)},Object.defineProperty(Nc,"name",{value:"Grid"}),ei(Nc,"Grid"),ei(Ln,"Color"),ei(Error,"Error"),ei(ao,"Formatted"),ei(On,"FormattedSection"),ei(an,"AJAXError"),ei(Uo,"ResolvedImage"),ei(Wh,"StylePropertyFunction"),ei(xd,"StyleExpression",{omit:["_evaluator"]}),ei(Wu,"ZoomDependentExpression"),ei(Hu,"ZoomConstantExpression"),ei(jo,"CompoundExpression",{omit:["_evaluate"]});for(const t in Vu)ef[Vu[t]._classRegistryKey]||ei(Vu[t],`Expression${t}`);function _(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function l(t){return self.ImageBitmap&&t instanceof ImageBitmap}function f(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(_(t)||l(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const r=t;return e&&e.add(r.buffer),r}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const r=[];for(const a of t)r.push(f(a,e));return r}if(t instanceof Map){const r={$name:"Map"};for(const[a,u]of t.entries())r[a]=f(u);return r}if(typeof t=="object"){const r=t.constructor,a=r._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);const u=r.serialize?r.serialize(t,e):{};if(!r.serialize){for(const d in t)t.hasOwnProperty(d)&&(ef[a].omit.indexOf(d)>=0||(u[d]=f(t[d],e)));t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(u.$name=a),u}throw new Error("can't serialize object of type "+typeof t)}function v(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||_(t)||l(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(v);if(typeof t=="object"){const e=t.$name||"Object";if(e==="Map"){const u=new Map;for(const d of Object.keys(t))d!=="$name"&&u.set(d,v(t[d]));return u}const{klass:r}=ef[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(t);const a=Object.create(r.prototype);for(const u of Object.keys(t))u!=="$name"&&(a[u]=v(t[u]));return a}throw new Error("can't deserialize object of type "+typeof t)}const w={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function S(t){for(const e of t)if(R(e.charCodeAt(0)))return!0;return!1}function A(t){for(const e of t)if(!P(e.charCodeAt(0)))return!1;return!0}function P(t){return!(w.Arabic(t)||w["Arabic Supplement"](t)||w["Arabic Extended-A"](t)||w["Arabic Presentation Forms-A"](t)||w["Arabic Presentation Forms-B"](t))}function R(t){return!(t!==746&&t!==747&&(t<4352||!(w["Bopomofo Extended"](t)||w.Bopomofo(t)||w["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||w["CJK Compatibility Ideographs"](t)||w["CJK Compatibility"](t)||w["CJK Radicals Supplement"](t)||w["CJK Strokes"](t)||!(!w["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||w["CJK Unified Ideographs Extension A"](t)||w["CJK Unified Ideographs"](t)||w["Enclosed CJK Letters and Months"](t)||w["Hangul Compatibility Jamo"](t)||w["Hangul Jamo Extended-A"](t)||w["Hangul Jamo Extended-B"](t)||w["Hangul Jamo"](t)||w["Hangul Syllables"](t)||w.Hiragana(t)||w["Ideographic Description Characters"](t)||w.Kanbun(t)||w["Kangxi Radicals"](t)||w["Katakana Phonetic Extensions"](t)||w.Katakana(t)&&t!==12540||!(!w["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!w["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||w["Unified Canadian Aboriginal Syllabics"](t)||w["Unified Canadian Aboriginal Syllabics Extended"](t)||w["Vertical Forms"](t)||w["Yijing Hexagram Symbols"](t)||w["Yi Syllables"](t)||w["Yi Radicals"](t))))}function B(t){return!(R(t)||function(e){return!!(w["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||w["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||w["Letterlike Symbols"](e)||w["Number Forms"](e)||w["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||w["Control Pictures"](e)&&e!==9251||w["Optical Character Recognition"](e)||w["Enclosed Alphanumerics"](e)||w["Geometric Shapes"](e)||w["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||w["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||w["CJK Symbols and Punctuation"](e)||w.Katakana(e)||w["Private Use Area"](e)||w["CJK Compatibility Forms"](e)||w["Small Form Variants"](e)||w["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function U(t){return t>=1424&&t<=2303||w["Arabic Presentation Forms-A"](t)||w["Arabic Presentation Forms-B"](t)}function H(t,e){return!(!e&&U(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||w.Khmer(t))}function Z(t){for(const e of t)if(U(e.charCodeAt(0)))return!0;return!1}const Y="deferred",Q="loading",te="loaded";let ee=null,K="unavailable",ce=null;const ge=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(K="error"),ee&&ee(t)};function _e(){se.fire(new xo("pluginStateChange",{pluginStatus:K,pluginURL:ce}))}const se=new so,ue=function(){return K},ve=function(){if(K!==Y||!ce)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");K=Q,_e(),ce&&Er({url:ce},t=>{t?ge(t):(K=te,_e())})},Me={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>K===te||Me.applyArabicShaping!=null,isLoading:()=>K===Q,setState(t){K=t.pluginStatus,ce=t.pluginURL},isParsed:()=>Me.applyArabicShaping!=null&&Me.processBidirectionalText!=null&&Me.processStyledBidirectionalText!=null,getPluginURL:()=>ce};class be{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(r,a){for(const u of r)if(!H(u.charCodeAt(0),a))return!1;return!0}(e,Me.isLoaded())}}class Ce{constructor(e,r,a,u){this.property=e,this.value=r,this.expression=function(d,m,y,b){if(jh(d))return new Wh(d,m);if(Hh(d)||Array.isArray(d)&&d.length>0){const T=qu(d,m,y,b);if(T.result==="error")throw new Error(T.value.map(E=>`${E.key}: ${E.message}`).join(", "));return T.value}{let T=d;return typeof d=="string"&&m.type==="color"&&(T=Ln.parse(d)),{kind:"constant",isConfigDependent:!1,evaluate:()=>T}}}(r===void 0?e.specification.default:r,e.specification,a,u)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class $e{constructor(e,r,a){this.property=e,this.value=new Ce(e,void 0,r,a)}transitioned(e,r){return new qe(this.property,this.value,r,rt({},e.transition,this.transition),e.now)}untransitioned(){return new qe(this.property,this.value,null,{},0)}}class Ne{constructor(e,r,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=r,this._options=a,this.isConfigDependent=!1}getValue(e){return cn(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new $e(this._values[e].property,this._scope,this._options)),this._values[e].value=new Ce(this._values[e].property,r===null?void 0:cn(r),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,r){r&&(this._options=r);const a=this._properties.properties;if(e)for(const u in e){const d=e[u];if(wn(u,"-transition")){const m=u.slice(0,-11);a[m]&&this.setTransition(m,d)}else a[u]&&this.setValue(u,d)}}getTransition(e){return cn(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new $e(this._values[e].property)),this._values[e].transition=cn(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a);const u=this.getTransition(r);u!==void 0&&(e[`${r}-transition`]=u)}return e}transitioned(e,r){const a=new Le(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(e,r._values[u]);return a}untransitioned(){const e=new Le(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class qe{constructor(e,r,a,u,d){const m=u.delay||0,y=u.duration||0;d=d||0,this.property=e,this.value=r,this.begin=d+m,this.end=this.begin+y,e.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){const u=e.now||0,d=this.value.possiblyEvaluate(e,r,a),m=this.prior;if(m){if(u>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(u<this.begin)return m.possiblyEvaluate(e,r,a);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,r,a),d,mi(y))}}return d}}class Le{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){const u=new nt(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,r,a);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ke{constructor(e,r,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=r,this._options=a,this.isConfigDependent=!1}getValue(e){return cn(this._values[e].value)}setValue(e,r){this._values[e]=new Ce(this._values[e].property,r===null?void 0:cn(r),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){const u=new nt(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,r,a);return u}}class He{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,u){return this.property.evaluate(this.value,this.parameters,e,r,a,u)}}class nt{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class de{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,a){const u=Gs[this.specification.type];return u?u(e,r,a):e}}class ze{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,u){return new He(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,u)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new He(this,{kind:"constant",value:void 0},e.parameters);const u=Gs[this.specification.type];return u?new He(this,{kind:"constant",value:u(e.value.value,r.value.value,a)},e.parameters):e}evaluate(e,r,a,u,d,m){return e.kind==="constant"?e.value:e.evaluate(r,a,u,d,m)}}class _t{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,u){return!!e.expression.evaluate(r,null,{},a,u)}interpolate(){return!1}}class ut{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new be(0,{});for(const a in e){const u=e[a];u.specification.overridable&&this.overridableProperties.push(a);const d=this.defaultPropertyValues[a]=new Ce(u,void 0),m=this.defaultTransitionablePropertyValues[a]=new $e(u);this.defaultTransitioningPropertyValues[a]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=d.possiblyEvaluate(r)}}}ei(ze,"DataDrivenProperty"),ei(de,"DataConstantProperty"),ei(_t,"ColorRampProperty");const ti="";function Ht(t,e){return e?`${t}${ti}${e}`:t}const hi="-transition";class Jt extends so{constructor(e,r,a,u){if(super(),this.id=e.id,this.fqid=Ht(this.id,a),this.type=e.type,this.scope=a,this.options=u,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),r.layout&&(this._unevaluatedLayout=new Ke(r.layout,this.scope,u),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),r.paint)){this._transitionablePaint=new Ne(r.paint,this.scope,u);for(const d in e.paint)this.setPaintProperty(d,e.paint[d],{validate:!1});for(const d in e.layout)this.setLayoutProperty(d,e.layout[d],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new nt(r.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,a={}){if(r!=null&&this._validate(p0,`layers.${this.id}.layout.${e}`,e,r,a))return;if(this.type==="custom"&&e==="visibility")return void(this.visibility=r);const u=this._unevaluatedLayout;u._properties.properties[e]&&(u.setValue(e,r),this.isConfigDependent=this.isConfigDependent||u.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return wn(e,hi)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,a={}){if(r!=null&&this._validate(d0,`layers.${this.id}.paint.${e}`,e,r,a))return!1;const u=this._transitionablePaint,d=u._properties.properties;if(wn(e,hi)){const k=e.slice(0,-11);return d[k]&&u.setTransition(k,r||void 0),!1}if(!d[e])return!1;const m=u._values[e],y=m.value.isDataDriven(),b=m.value;u.setValue(e,r),this.isConfigDependent=this.isConfigDependent||u.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const T=u._values[e].value,E=T.isDataDriven(),I=wn(e,"pattern")||e==="line-dasharray";return E||y||I||this._handleOverridablePaintPropertyUpdate(e,b,T)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,r){return null}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){return Mr({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,r)=>!(e===void 0||r==="layout"&&!Object.keys(e).length||r==="paint"&&!Object.keys(e).length))}_validate(e,r,a,u,d={}){return(!d||d.validate!==!1)&&Km(this,e.call(Cd,{key:r,layerType:this.type,objectKey:a,value:u,styleSpec:Be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof He&&al(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Yh(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(){this._stats&&(this._stats.numRenderedVerticesInShadowPass=0,this._stats.numRenderedVerticesInTransparentPass=0)}}const _i={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class yi{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class oi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function li(t,e=1){let r=0,a=0;return{members:t.map(u=>{const d=_i[u.type].BYTES_PER_ELEMENT,m=r=tn(r,Math.max(e,d)),y=u.components||1;return a=Math.max(a,d),r+=d*y,{name:u.name,type:u.type,components:y,offset:m}}),size:tn(r,Math.max(a,e)),alignment:e}}function tn(t,e){return Math.ceil(t/e)*e}class Li extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.int16[u+0]=r,this.int16[u+1]=a,e}}Li.prototype.bytesPerElement=4,ei(Li,"StructArrayLayout2i4");class Nn extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const d=3*e;return this.int16[d+0]=r,this.int16[d+1]=a,this.int16[d+2]=u,e}}Nn.prototype.bytesPerElement=6,ei(Nn,"StructArrayLayout3i6");class Mn extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a,u)}emplace(e,r,a,u,d){const m=4*e;return this.int16[m+0]=r,this.int16[m+1]=a,this.int16[m+2]=u,this.int16[m+3]=d,e}}Mn.prototype.bytesPerElement=8,ei(Mn,"StructArrayLayout4i8");class Do extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,a,u,d)}emplace(e,r,a,u,d,m){const y=5*e;return this.int16[y+0]=r,this.int16[y+1]=a,this.int16[y+2]=u,this.int16[y+3]=d,this.int16[y+4]=m,e}}Do.prototype.bytesPerElement=10,ei(Do,"StructArrayLayout5i10");class As extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,u,d,m,y)}emplace(e,r,a,u,d,m,y,b){const T=6*e,E=12*e,I=3*e;return this.int16[T+0]=r,this.int16[T+1]=a,this.uint8[E+4]=u,this.uint8[E+5]=d,this.uint8[E+6]=m,this.uint8[E+7]=y,this.float32[I+2]=b,e}}As.prototype.bytesPerElement=12,ei(As,"StructArrayLayout2i4ub1f12");class yn extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a,u)}emplace(e,r,a,u,d){const m=4*e;return this.float32[m+0]=r,this.float32[m+1]=a,this.float32[m+2]=u,this.float32[m+3]=d,e}}yn.prototype.bytesPerElement=16,ei(yn,"StructArrayLayout4f16");class sn extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,a,u,d)}emplace(e,r,a,u,d,m){const y=6*e,b=3*e;return this.uint16[y+0]=r,this.uint16[y+1]=a,this.uint16[y+2]=u,this.uint16[y+3]=d,this.float32[b+2]=m,e}}sn.prototype.bytesPerElement=12,ei(sn,"StructArrayLayout4ui1f12");class fn extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a,u)}emplace(e,r,a,u,d){const m=4*e;return this.uint16[m+0]=r,this.uint16[m+1]=a,this.uint16[m+2]=u,this.uint16[m+3]=d,e}}fn.prototype.bytesPerElement=8,ei(fn,"StructArrayLayout4ui8");class Jn extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,u,d,m)}emplace(e,r,a,u,d,m,y){const b=6*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=u,this.int16[b+3]=d,this.int16[b+4]=m,this.int16[b+5]=y,e}}Jn.prototype.bytesPerElement=12,ei(Jn,"StructArrayLayout6i12");class Kr extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d,m,y,b,T,E,I,k){const O=this.length;return this.resize(O+1),this.emplace(O,e,r,a,u,d,m,y,b,T,E,I,k)}emplace(e,r,a,u,d,m,y,b,T,E,I,k,O){const z=12*e;return this.int16[z+0]=r,this.int16[z+1]=a,this.int16[z+2]=u,this.int16[z+3]=d,this.uint16[z+4]=m,this.uint16[z+5]=y,this.uint16[z+6]=b,this.uint16[z+7]=T,this.int16[z+8]=E,this.int16[z+9]=I,this.int16[z+10]=k,this.int16[z+11]=O,e}}Kr.prototype.bytesPerElement=24,ei(Kr,"StructArrayLayout4i4ui4i24");class Hn extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,u,d,m)}emplace(e,r,a,u,d,m,y){const b=10*e,T=5*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=u,this.float32[T+2]=d,this.float32[T+3]=m,this.float32[T+4]=y,e}}Hn.prototype.bytesPerElement=20,ei(Hn,"StructArrayLayout3i3f20");class co extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}co.prototype.bytesPerElement=4,ei(co,"StructArrayLayout1ul4");class Lo extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.uint16[u+0]=r,this.uint16[u+1]=a,e}}Lo.prototype.bytesPerElement=4,ei(Lo,"StructArrayLayout2ui4");class uo extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d,m,y,b,T,E,I,k,O){const z=this.length;return this.resize(z+1),this.emplace(z,e,r,a,u,d,m,y,b,T,E,I,k,O)}emplace(e,r,a,u,d,m,y,b,T,E,I,k,O,z){const N=20*e,j=10*e;return this.int16[N+0]=r,this.int16[N+1]=a,this.int16[N+2]=u,this.int16[N+3]=d,this.int16[N+4]=m,this.float32[j+3]=y,this.float32[j+4]=b,this.float32[j+5]=T,this.float32[j+6]=E,this.int16[N+14]=I,this.uint32[j+8]=k,this.uint16[N+18]=O,this.uint16[N+19]=z,e}}uo.prototype.bytesPerElement=40,ei(uo,"StructArrayLayout5i4f1i1ul2ui40");class Is extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,u,d,m,y)}emplace(e,r,a,u,d,m,y,b){const T=8*e;return this.int16[T+0]=r,this.int16[T+1]=a,this.int16[T+2]=u,this.int16[T+4]=d,this.int16[T+5]=m,this.int16[T+6]=y,this.int16[T+7]=b,e}}Is.prototype.bytesPerElement=16,ei(Is,"StructArrayLayout3i2i2i16");class Ra extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,a,u,d)}emplace(e,r,a,u,d,m){const y=4*e,b=8*e;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=u,this.int16[b+6]=d,this.int16[b+7]=m,e}}Ra.prototype.bytesPerElement=16,ei(Ra,"StructArrayLayout2f1f2i16");class Ws extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a,u)}emplace(e,r,a,u,d){const m=12*e,y=3*e;return this.uint8[m+0]=r,this.uint8[m+1]=a,this.float32[y+1]=u,this.float32[y+2]=d,e}}Ws.prototype.bytesPerElement=12,ei(Ws,"StructArrayLayout2ub2f12");class An extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const d=3*e;return this.uint16[d+0]=r,this.uint16[d+1]=a,this.uint16[d+2]=u,e}}An.prototype.bytesPerElement=6,ei(An,"StructArrayLayout3ui6");class qs extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d,m,y,b,T,E,I,k,O,z,N,j,q,ie,oe,ae,he){const me=this.length;return this.resize(me+1),this.emplace(me,e,r,a,u,d,m,y,b,T,E,I,k,O,z,N,j,q,ie,oe,ae,he)}emplace(e,r,a,u,d,m,y,b,T,E,I,k,O,z,N,j,q,ie,oe,ae,he,me){const Te=30*e,Pe=15*e,Re=60*e;return this.int16[Te+0]=r,this.int16[Te+1]=a,this.int16[Te+2]=u,this.float32[Pe+2]=d,this.float32[Pe+3]=m,this.uint16[Te+8]=y,this.uint16[Te+9]=b,this.uint32[Pe+5]=T,this.uint32[Pe+6]=E,this.uint32[Pe+7]=I,this.uint16[Te+16]=k,this.uint16[Te+17]=O,this.uint16[Te+18]=z,this.float32[Pe+10]=N,this.float32[Pe+11]=j,this.uint8[Re+48]=q,this.uint8[Re+49]=ie,this.uint8[Re+50]=oe,this.uint32[Pe+13]=ae,this.int16[Te+28]=he,this.uint8[Re+58]=me,e}}qs.prototype.bytesPerElement=60,ei(qs,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ca extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d,m,y,b,T,E,I,k,O,z,N,j,q,ie,oe,ae,he,me,Te,Pe,Re,Ge,Fe,et,bt,Je,gt,Ye){const Vt=this.length;return this.resize(Vt+1),this.emplace(Vt,e,r,a,u,d,m,y,b,T,E,I,k,O,z,N,j,q,ie,oe,ae,he,me,Te,Pe,Re,Ge,Fe,et,bt,Je,gt,Ye)}emplace(e,r,a,u,d,m,y,b,T,E,I,k,O,z,N,j,q,ie,oe,ae,he,me,Te,Pe,Re,Ge,Fe,et,bt,Je,gt,Ye,Vt){const $t=20*e,vt=40*e,vi=80*e;return this.float32[$t+0]=r,this.float32[$t+1]=a,this.int16[vt+4]=u,this.int16[vt+5]=d,this.int16[vt+6]=m,this.int16[vt+7]=y,this.int16[vt+8]=b,this.int16[vt+9]=T,this.int16[vt+10]=E,this.int16[vt+11]=I,this.int16[vt+12]=k,this.uint16[vt+13]=O,this.uint16[vt+14]=z,this.uint16[vt+15]=N,this.uint16[vt+16]=j,this.uint16[vt+17]=q,this.uint16[vt+18]=ie,this.uint16[vt+19]=oe,this.uint16[vt+20]=ae,this.uint16[vt+21]=he,this.uint16[vt+22]=me,this.uint16[vt+23]=Te,this.uint16[vt+24]=Pe,this.uint16[vt+25]=Re,this.uint16[vt+26]=Ge,this.uint16[vt+27]=Fe,this.uint32[$t+14]=et,this.float32[$t+15]=bt,this.float32[$t+16]=Je,this.float32[$t+17]=gt,this.float32[$t+18]=Ye,this.uint8[vi+76]=Vt,e}}ca.prototype.bytesPerElement=80,ei(ca,"StructArrayLayout2f9i15ui1ul4f1ub80");class za extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}za.prototype.bytesPerElement=4,ei(za,"StructArrayLayout1f4");class Yu extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,a,u,d)}emplace(e,r,a,u,d,m){const y=5*e;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=u,this.float32[y+3]=d,this.float32[y+4]=m,e}}Yu.prototype.bytesPerElement=20,ei(Yu,"StructArrayLayout5f20");class g0 extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,u,d,m,y)}emplace(e,r,a,u,d,m,y,b){const T=7*e;return this.float32[T+0]=r,this.float32[T+1]=a,this.float32[T+2]=u,this.float32[T+3]=d,this.float32[T+4]=m,this.float32[T+5]=y,this.float32[T+6]=b,e}}g0.prototype.bytesPerElement=28,ei(g0,"StructArrayLayout7f28");class _0 extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a,u)}emplace(e,r,a,u,d){const m=6*e;return this.uint32[3*e+0]=r,this.uint16[m+2]=a,this.uint16[m+3]=u,this.uint16[m+4]=d,e}}_0.prototype.bytesPerElement=12,ei(_0,"StructArrayLayout1ul3ui12");class Pd extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Pd.prototype.bytesPerElement=2,ei(Pd,"StructArrayLayout1ui2");class Ju extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const d=3*e;return this.float32[d+0]=r,this.float32[d+1]=a,this.float32[d+2]=u,e}}Ju.prototype.bytesPerElement=12,ei(Ju,"StructArrayLayout3f12");class kd extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.float32[u+0]=r,this.float32[u+1]=a,e}}kd.prototype.bytesPerElement=8,ei(kd,"StructArrayLayout2f8");class y0 extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d,m,y,b,T,E,I,k,O,z,N,j){const q=this.length;return this.resize(q+1),this.emplace(q,e,r,a,u,d,m,y,b,T,E,I,k,O,z,N,j)}emplace(e,r,a,u,d,m,y,b,T,E,I,k,O,z,N,j,q){const ie=16*e;return this.float32[ie+0]=r,this.float32[ie+1]=a,this.float32[ie+2]=u,this.float32[ie+3]=d,this.float32[ie+4]=m,this.float32[ie+5]=y,this.float32[ie+6]=b,this.float32[ie+7]=T,this.float32[ie+8]=E,this.float32[ie+9]=I,this.float32[ie+10]=k,this.float32[ie+11]=O,this.float32[ie+12]=z,this.float32[ie+13]=N,this.float32[ie+14]=j,this.float32[ie+15]=q,e}}y0.prototype.bytesPerElement=64,ei(y0,"StructArrayLayout16f64");class Qm extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,u,d,m,y)}emplace(e,r,a,u,d,m,y,b){const T=10*e,E=5*e;return this.uint16[T+0]=r,this.uint16[T+1]=a,this.uint16[T+2]=u,this.uint16[T+3]=d,this.float32[E+2]=m,this.float32[E+3]=y,this.float32[E+4]=b,e}}Qm.prototype.bytesPerElement=20,ei(Qm,"StructArrayLayout4ui3f20");class v0 extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint8[1*e+0]=r,e}}v0.prototype.bytesPerElement=1,ei(v0,"StructArrayLayout1ub1");class Nb extends yi{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Nb.prototype.size=40;class x0 extends uo{get(e){return new Nb(this,e)}}ei(x0,"CollisionBoxArray");class Vb extends yi{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Vb.prototype.size=60;class Ub extends qs{get(e){return new Vb(this,e)}}ei(Ub,"PlacedSymbolArray");class jb extends yi{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}jb.prototype.size=80;class Gb extends ca{get(e){return new jb(this,e)}}ei(Gb,"SymbolInstanceArray");class Hb extends za{getoffsetX(e){return this.float32[1*e+0]}}ei(Hb,"GlyphOffsetArray");class Wb extends Li{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ei(Wb,"SymbolLineVertexArray");class qb extends yi{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}qb.prototype.size=12;class Zb extends _0{get(e){return new qb(this,e)}}ei(Zb,"FeatureIndexArray");class Xb extends Lo{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ei(Xb,"FillExtrusionCentroidArray");const _D=li([{name:"a_pos",components:2,type:"Int16"}],4),yD=li([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class or{constructor(e=[]){this.segments=e}_prepareSegment(e,r,a,u){let d=this.segments[this.segments.length-1];return e>or.MAX_VERTEX_ARRAY_LENGTH&&si(`Max vertices per segment is ${or.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>or.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==u)&&(d={vertexOffset:r,primitiveOffset:a,vertexLength:0,primitiveLength:0},u!==void 0&&(d.sortKey=u),this.segments.push(d)),d}prepareSegment(e,r,a,u){return this._prepareSegment(e,r.length,a.length,u)}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,u){return new or([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}function Yb(t,e){return 256*(t=wt(Math.floor(t),0,255))+wt(Math.floor(e),0,255)}or.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ei(or,"SegmentVector");const vD=li([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),xD=li([{name:"a_dash",components:4,type:"Uint16"}]);var $m={exports:{}},Jb={exports:{}};(function(t){t.exports=function(e,r){var a,u,d,m,y,b,T,E;for(u=e.length-(a=3&e.length),d=r,y=3432918353,b=461845907,E=0;E<u;)T=255&e.charCodeAt(E)|(255&e.charCodeAt(++E))<<8|(255&e.charCodeAt(++E))<<16|(255&e.charCodeAt(++E))<<24,++E,d=27492+(65535&(m=5*(65535&(d=(d^=T=(65535&(T=(T=(65535&T)*y+(((T>>>16)*y&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(T=0,a){case 3:T^=(255&e.charCodeAt(E+2))<<16;case 2:T^=(255&e.charCodeAt(E+1))<<8;case 1:d^=T=(65535&(T=(T=(65535&(T^=255&e.charCodeAt(E)))*y+(((T>>>16)*y&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295}return d^=e.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}})(Jb);var bD=Jb.exports,Kb={exports:{}};(function(t){t.exports=function(e,r){for(var a,u=e.length,d=r^u,m=0;u>=4;)a=1540483477*(65535&(a=255&e.charCodeAt(m)|(255&e.charCodeAt(++m))<<8|(255&e.charCodeAt(++m))<<16|(255&e.charCodeAt(++m))<<24))+((1540483477*(a>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),u-=4,++m;switch(u){case 3:d^=(255&e.charCodeAt(m+2))<<16;case 2:d^=(255&e.charCodeAt(m+1))<<8;case 1:d=1540483477*(65535&(d^=255&e.charCodeAt(m)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0}})(Kb);var Qb=bD,wD=Kb.exports;$m.exports=Qb,$m.exports.murmur3=Qb,$m.exports.murmur2=wD;var b0=pe($m.exports);class Dd{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,r,a,u){this.ids.push($b(e)),this.positions.push(r,a,u)}eachPosition(e,r){const a=$b(e);let u=0,d=this.ids.length-1;for(;u<d;){const m=u+d>>1;this.ids[m]>=a?d=m:u=m+1}for(;this.ids[u]===a;)r(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,r){const a=new Float64Array(e.ids),u=new Uint32Array(e.positions);return w0(a,u,0,a.length-1),r&&(r.add(a.buffer),r.add(u.buffer)),{ids:a,positions:u}}static deserialize(e){const r=new Dd;let a;r.ids=e.ids,r.positions=e.positions;for(const u of r.ids)u!==a&&r.uniqueIds.push(u),a=u;return r.indexed=!0,r}}function $b(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:b0(String(t))}function w0(t,e,r,a){for(;r<a;){const u=t[r+a>>1];let d=r-1,m=a+1;for(;;){do d++;while(t[d]<u);do m--;while(t[m]>u);if(d>=m)break;eg(t,d,m),eg(e,3*d,3*m),eg(e,3*d+1,3*m+1),eg(e,3*d+2,3*m+2)}m-r<a-m?(w0(t,e,r,m),r=m+1):(w0(t,e,m+1,a),a=m)}}function eg(t,e,r){const a=t[e];t[e]=t[r],t[r]=a}ei(Dd,"FeaturePositionMap");class Kl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}}class tg extends Kl{constructor(e){super(e),this.current=0}set(e,r,a){this.fetchUniformLocation(e,r)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class Yo extends Kl{constructor(e){super(e),this.current=0}set(e,r,a){this.fetchUniformLocation(e,r)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Ku extends Kl{constructor(e){super(e),this.current=[0,0]}set(e,r,a){this.fetchUniformLocation(e,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class T0 extends Kl{constructor(e){super(e),this.current=[0,0,0]}set(e,r,a){this.fetchUniformLocation(e,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class ew extends Kl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,a){this.fetchUniformLocation(e,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class tw extends Kl{constructor(e){super(e),this.current=Ln.transparent}set(e,r,a){this.fetchUniformLocation(e,r)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const TD=new Float32Array(16);class Ld extends Kl{constructor(e){super(e),this.current=TD}set(e,r,a){if(this.fetchUniformLocation(e,r)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let u=1;u<16;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}const SD=new Float32Array(9),MD=new Float32Array(4);class S0 extends Kl{constructor(e){super(e),this.current=MD}set(e,r,a){if(this.fetchUniformLocation(e,r)){for(let u=0;u<4;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function M0(t){return[Yb(255*t.r,255*t.g),Yb(255*t.b,255*t.a)]}class Od{constructor(e,r,a){this.value=e,this.uniformNames=r.map(u=>`u_${u}`),this.type=a}setUniform(e,r,a,u,d){r.set(e,d,u.constantOr(this.value))}getBinding(e,r){return this.type==="color"?new tw(e):new Yo(e)}}class tf{constructor(e,r){this.uniformNames=r.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,a,u,d){const m=d==="u_pattern"||d==="u_dash"?this.pattern:d==="u_pixel_ratio"?this.pixelRatio:null;m&&r.set(e,d,m)}getBinding(e,r){return r==="u_pattern"||r==="u_dash"?new ew(e):new Yo(e)}}class Ql{constructor(e,r,a,u){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(d=>({name:`a_${d}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,r,a,u,d,m,y){const b=this.paintVertexArray.length,T=this.expression.evaluate(new be(0,{brightness:m}),r,{},d,u,y);this.paintVertexArray.resize(e),this._setPaintValue(b,e,T)}updatePaintArray(e,r,a,u,d,m,y){const b=this.expression.evaluate({zoom:0,brightness:y},a,u,void 0,d);this._setPaintValue(e,r,b)}_setPaintValue(e,r,a){if(this.type==="color"){const u=M0(a);for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,u[0],u[1])}else{for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fa{constructor(e,r,a,u,d,m){this.expression=e,this.uniformNames=r.map(y=>`u_${y}_t`),this.type=a,this.useIntegerZoom=u,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=r.map(y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,r,a,u,d,m,y){const b=this.expression.evaluate(new be(this.zoom,{brightness:m}),r,{},d,u,y),T=this.expression.evaluate(new be(this.zoom+1,{brightness:m}),r,{},d,u,y),E=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(E,e,b,T)}updatePaintArray(e,r,a,u,d,m,y){const b=this.expression.evaluate({zoom:this.zoom,brightness:y},a,u,void 0,d),T=this.expression.evaluate({zoom:this.zoom+1,brightness:y},a,u,void 0,d);this._setPaintValue(e,r,b,T)}_setPaintValue(e,r,a,u){if(this.type==="color"){const d=M0(a),m=M0(u);for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,d[0],d[1],m[0],m[1])}else{for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,a,u,d){const m=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,y=wt(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);r.set(e,d,y)}getBinding(e,r){return new Yo(e)}}class Vc{constructor(e,r,a,u,d){this.expression=e,this.layerId=d,this.paintVertexAttributes=(a==="array"?xD:vD).members;for(let m=0;m<r.length;++m);this.paintVertexArray=new u}populatePaintArray(e,r,a){const u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(e,r,a,u,d,m,y){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],m)}_setPaintValues(e,r,a,u){if(!u||!a)return;const d=u[a];if(!d)return;const{tl:m,br:y,pixelRatio:b}=d;for(let T=e;T<r;T++)this.paintVertexArray.emplace(T,m[0],m[1],y[0],y[1],b)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Qu{constructor(e,r,a=()=>!0){this.binders={},this._buffers=[];const u=[];for(const d in e.paint._values){const m=e.paint.get(d);if(!a(d)||!(m instanceof He&&al(m.property.specification)))continue;const y=AD(d,e.type),b=m.value,T=m.property.specification.type,E=!!m.property.useIntegerZoom,I=d==="line-dasharray"||d.endsWith("pattern"),k=d==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(b.kind!=="constant"||k)if(b.kind==="source"||k||I){const O=iw(d,T,"source");this.binders[d]=I?new Vc(b,y,T,O,e.id):new Ql(b,y,T,O),u.push(`/a_${d}`)}else{const O=iw(d,T,"composite");this.binders[d]=new Fa(b,y,T,E,r,O),u.push(`/z_${d}`)}else this.binders[d]=I?new tf(b.value,y):new Od(b.value,y,T),u.push(`/u_${d}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Ql||r instanceof Fa?r.maxValue:0}populatePaintArrays(e,r,a,u,d,m,y){for(const b in this.binders){const T=this.binders[b];(T instanceof Ql||T instanceof Fa||T instanceof Vc)&&T.populatePaintArray(e,r,a,u,d,m,y)}}setConstantPatternPositions(e){for(const r in this.binders){const a=this.binders[r];a instanceof tf&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,r,a,u,d,m,y,b){let T=!1;const E=Object.keys(e),I=E.length!==0,k=I?E:r.uniqueIds;for(const O in this.binders){const z=this.binders[O];if((z instanceof Ql||z instanceof Fa||z instanceof Vc)&&(z.expression.isStateDependent===!0||z.expression.isLightConstant===!1)){const N=d.paint.get(O);z.expression=N.value;for(const j of k){const q=e[j.toString()];r.eachPosition(j,(ie,oe,ae)=>{const he=u.feature(ie);z.updatePaintArray(oe,ae,he,q,m,y,b)})}if(!I)for(const j of a.uniqueIds){const q=e[j.toString()];a.eachPosition(j,(ie,oe,ae)=>{const he=u.feature(ie);z.updatePaintArray(oe,ae,he,q,m,y,b)})}T=!0}}return T}defines(){const e=[];for(const r in this.binders){const a=this.binders[r];(a instanceof Od||a instanceof tf)&&e.push(...a.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof Ql||a instanceof Fa||a instanceof Vc)for(let u=0;u<a.paintVertexAttributes.length;u++)e.push(a.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof Od||a instanceof tf||a instanceof Fa)for(const u of a.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof Od||u instanceof tf||u instanceof Fa)for(const d of u.uniformNames)r.push({name:d,property:a,binding:u.getBinding(e,d)})}return r}setUniforms(e,r,a,u,d){for(const{name:m,property:y,binding:b}of a)this.binders[y].setUniform(e,b,d,u.get(y),m)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof Ql||r instanceof Fa||r instanceof Vc)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const r in this.binders){const a=this.binders[r];(a instanceof Ql||a instanceof Fa||a instanceof Vc)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Ql||r instanceof Fa||r instanceof Vc)&&r.destroy()}}}class Uc{constructor(e,r,a=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Qu(u,r,a);this.needsUpload=!1,this._featureMap=new Dd,this._featureMapWithoutIds=new Dd,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,r,a,u,d,m,y,b){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(e,r,u,d,m,y,b);r.id!==void 0?this._featureMap.add(r.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,u,d,m){for(const y of a)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,r,y,u,d,m||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const ED={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function AD(t,e){return ED[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const ID={"line-pattern":{source:sn,composite:sn},"fill-pattern":{source:sn,composite:sn},"fill-extrusion-pattern":{source:sn,composite:sn},"line-dasharray":{source:fn,composite:fn}},CD={color:{source:kd,composite:yn},number:{source:za,composite:kd}};function iw(t,e,r){const a=ID[t];return a&&a[r]||CD[e][r]}ei(Od,"ConstantBinder"),ei(tf,"PatternConstantBinder"),ei(Ql,"SourceExpressionBinder"),ei(Vc,"PatternCompositeBinder"),ei(Fa,"CompositeExpressionBinder"),ei(Qu,"ProgramConfiguration",{omit:["_buffers"]}),ei(Uc,"ProgramConfigurationSet");class jc{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof vn?new vn(e.lng,e.lat):vn.convert(e),this}setSouthWest(e){return this._sw=e instanceof vn?new vn(e.lng,e.lat):vn.convert(e),this}extend(e){const r=this._sw,a=this._ne;let u,d;if(e instanceof vn)u=e,d=e;else{if(!(e instanceof jc))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(jc.convert(e)):this.extend(vn.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(vn.convert(e)):this;if(u=e._sw,d=e._ne,!u||!d)return this}return r||a?(r.lng=Math.min(u.lng,r.lng),r.lat=Math.min(u.lat,r.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new vn(u.lng,u.lat),this._ne=new vn(d.lng,d.lat)),this}getCenter(){return new vn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new vn(this.getWest(),this.getNorth())}getSouthEast(){return new vn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:a}=vn.convert(e);let u=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u}static convert(e){return!e||e instanceof jc?e:new jc(e)}}var Qr={},$r={};Object.defineProperty($r,"__esModule",{value:!0}),$r.setMatrixArrayType=function(t){$r.ARRAY_TYPE=rw=t},$r.toRadian=function(t){return t*kD},$r.equals=function(t,e){return Math.abs(t-e)<=nw*Math.max(1,Math.abs(t),Math.abs(e))},$r.RANDOM=$r.ARRAY_TYPE=$r.EPSILON=void 0;var nw=1e-6;$r.EPSILON=nw;var rw=typeof Float32Array<"u"?Float32Array:Array;$r.ARRAY_TYPE=rw;var PD=Math.random;$r.RANDOM=PD;var kD=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var sr={};function E0(t){return E0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E0(t)}Object.defineProperty(sr,"__esModule",{value:!0}),sr.create=function(){var t=new Gc.ARRAY_TYPE(4);return Gc.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},sr.clone=function(t){var e=new Gc.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},sr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},sr.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},sr.fromValues=function(t,e,r,a){var u=new Gc.ARRAY_TYPE(4);return u[0]=t,u[1]=e,u[2]=r,u[3]=a,u},sr.set=function(t,e,r,a,u){return t[0]=e,t[1]=r,t[2]=a,t[3]=u,t},sr.transpose=function(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},sr.invert=function(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],m=r*d-u*a;return m?(t[0]=d*(m=1/m),t[1]=-a*m,t[2]=-u*m,t[3]=r*m,t):null},sr.adjoint=function(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t},sr.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},sr.multiply=sw,sr.rotate=function(t,e,r){var a=e[0],u=e[1],d=e[2],m=e[3],y=Math.sin(r),b=Math.cos(r);return t[0]=a*b+d*y,t[1]=u*b+m*y,t[2]=a*-y+d*b,t[3]=u*-y+m*b,t},sr.scale=function(t,e,r){var a=e[1],u=e[2],d=e[3],m=r[0],y=r[1];return t[0]=e[0]*m,t[1]=a*m,t[2]=u*y,t[3]=d*y,t},sr.fromRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=r,t[2]=-r,t[3]=a,t},sr.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},sr.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},sr.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},sr.LDU=function(t,e,r,a){return t[2]=a[2]/a[0],r[0]=a[0],r[1]=a[1],r[3]=a[3]-t[2]*r[1],[t,e,r]},sr.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},sr.subtract=aw,sr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},sr.equals=function(t,e){var r=t[0],a=t[1],u=t[2],d=t[3],m=e[0],y=e[1],b=e[2],T=e[3];return Math.abs(r-m)<=Gc.EPSILON*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(a-y)<=Gc.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(u-b)<=Gc.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(d-T)<=Gc.EPSILON*Math.max(1,Math.abs(d),Math.abs(T))},sr.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},sr.multiplyScalarAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t},sr.sub=sr.mul=void 0;var Gc=function(t,e){if(t&&t.__esModule)return t;if(t===null||E0(t)!=="object"&&typeof t!="function")return{default:t};var r=ow(void 0);if(r&&r.has(t))return r.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var m=u?Object.getOwnPropertyDescriptor(t,d):null;m&&(m.get||m.set)?Object.defineProperty(a,d,m):a[d]=t[d]}return a.default=t,r&&r.set(t,a),a}($r);function ow(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(ow=function(a){return a?r:e})(t)}function sw(t,e,r){var a=e[0],u=e[1],d=e[2],m=e[3],y=r[0],b=r[1],T=r[2],E=r[3];return t[0]=a*y+d*b,t[1]=u*y+m*b,t[2]=a*T+d*E,t[3]=u*T+m*E,t}function aw(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}sr.mul=sw,sr.sub=aw;var ur={};function A0(t){return A0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A0(t)}Object.defineProperty(ur,"__esModule",{value:!0}),ur.create=function(){var t=new hl.ARRAY_TYPE(6);return hl.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},ur.clone=function(t){var e=new hl.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},ur.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},ur.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},ur.fromValues=function(t,e,r,a,u,d){var m=new hl.ARRAY_TYPE(6);return m[0]=t,m[1]=e,m[2]=r,m[3]=a,m[4]=u,m[5]=d,m},ur.set=function(t,e,r,a,u,d,m){return t[0]=e,t[1]=r,t[2]=a,t[3]=u,t[4]=d,t[5]=m,t},ur.invert=function(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],m=e[4],y=e[5],b=r*d-a*u;return b?(t[0]=d*(b=1/b),t[1]=-a*b,t[2]=-u*b,t[3]=r*b,t[4]=(u*y-d*m)*b,t[5]=(a*m-r*y)*b,t):null},ur.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},ur.multiply=cw,ur.rotate=function(t,e,r){var a=e[0],u=e[1],d=e[2],m=e[3],y=e[4],b=e[5],T=Math.sin(r),E=Math.cos(r);return t[0]=a*E+d*T,t[1]=u*E+m*T,t[2]=a*-T+d*E,t[3]=u*-T+m*E,t[4]=y,t[5]=b,t},ur.scale=function(t,e,r){var a=e[1],u=e[2],d=e[3],m=e[4],y=e[5],b=r[0],T=r[1];return t[0]=e[0]*b,t[1]=a*b,t[2]=u*T,t[3]=d*T,t[4]=m,t[5]=y,t},ur.translate=function(t,e,r){var a=e[0],u=e[1],d=e[2],m=e[3],y=e[4],b=e[5],T=r[0],E=r[1];return t[0]=a,t[1]=u,t[2]=d,t[3]=m,t[4]=a*T+d*E+y,t[5]=u*T+m*E+b,t},ur.fromRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=r,t[2]=-r,t[3]=a,t[4]=0,t[5]=0,t},ur.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},ur.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},ur.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},ur.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},ur.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t},ur.subtract=uw,ur.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t},ur.multiplyScalarAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t[4]=e[4]+r[4]*a,t[5]=e[5]+r[5]*a,t},ur.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},ur.equals=function(t,e){var r=t[0],a=t[1],u=t[2],d=t[3],m=t[4],y=t[5],b=e[0],T=e[1],E=e[2],I=e[3],k=e[4],O=e[5];return Math.abs(r-b)<=hl.EPSILON*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(a-T)<=hl.EPSILON*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(u-E)<=hl.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(d-I)<=hl.EPSILON*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(m-k)<=hl.EPSILON*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(y-O)<=hl.EPSILON*Math.max(1,Math.abs(y),Math.abs(O))},ur.sub=ur.mul=void 0;var hl=function(t,e){if(t&&t.__esModule)return t;if(t===null||A0(t)!=="object"&&typeof t!="function")return{default:t};var r=lw(void 0);if(r&&r.has(t))return r.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var m=u?Object.getOwnPropertyDescriptor(t,d):null;m&&(m.get||m.set)?Object.defineProperty(a,d,m):a[d]=t[d]}return a.default=t,r&&r.set(t,a),a}($r);function lw(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(lw=function(a){return a?r:e})(t)}function cw(t,e,r){var a=e[0],u=e[1],d=e[2],m=e[3],y=e[4],b=e[5],T=r[0],E=r[1],I=r[2],k=r[3],O=r[4],z=r[5];return t[0]=a*T+d*E,t[1]=u*T+m*E,t[2]=a*I+d*k,t[3]=u*I+m*k,t[4]=a*O+d*z+y,t[5]=u*O+m*z+b,t}function uw(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}ur.mul=cw,ur.sub=uw;var In={};function I0(t){return I0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I0(t)}Object.defineProperty(In,"__esModule",{value:!0}),In.create=function(){var t=new Zs.ARRAY_TYPE(9);return Zs.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},In.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},In.clone=function(t){var e=new Zs.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},In.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},In.fromValues=function(t,e,r,a,u,d,m,y,b){var T=new Zs.ARRAY_TYPE(9);return T[0]=t,T[1]=e,T[2]=r,T[3]=a,T[4]=u,T[5]=d,T[6]=m,T[7]=y,T[8]=b,T},In.set=function(t,e,r,a,u,d,m,y,b,T){return t[0]=e,t[1]=r,t[2]=a,t[3]=u,t[4]=d,t[5]=m,t[6]=y,t[7]=b,t[8]=T,t},In.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},In.transpose=function(t,e){if(t===e){var r=e[1],a=e[2],u=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=a,t[7]=u}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},In.invert=function(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],m=e[4],y=e[5],b=e[6],T=e[7],E=e[8],I=E*m-y*T,k=-E*d+y*b,O=T*d-m*b,z=r*I+a*k+u*O;return z?(t[0]=I*(z=1/z),t[1]=(-E*a+u*T)*z,t[2]=(y*a-u*m)*z,t[3]=k*z,t[4]=(E*r-u*b)*z,t[5]=(-y*r+u*d)*z,t[6]=O*z,t[7]=(-T*r+a*b)*z,t[8]=(m*r-a*d)*z,t):null},In.adjoint=function(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],m=e[4],y=e[5],b=e[6],T=e[7],E=e[8];return t[0]=m*E-y*T,t[1]=u*T-a*E,t[2]=a*y-u*m,t[3]=y*b-d*E,t[4]=r*E-u*b,t[5]=u*d-r*y,t[6]=d*T-m*b,t[7]=a*b-r*T,t[8]=r*m-a*d,t},In.determinant=function(t){var e=t[3],r=t[4],a=t[5],u=t[6],d=t[7],m=t[8];return t[0]*(m*r-a*d)+t[1]*(-m*e+a*u)+t[2]*(d*e-r*u)},In.multiply=fw,In.translate=function(t,e,r){var a=e[0],u=e[1],d=e[2],m=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=e[8],k=r[0],O=r[1];return t[0]=a,t[1]=u,t[2]=d,t[3]=m,t[4]=y,t[5]=b,t[6]=k*a+O*m+T,t[7]=k*u+O*y+E,t[8]=k*d+O*b+I,t},In.rotate=function(t,e,r){var a=e[0],u=e[1],d=e[2],m=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=e[8],k=Math.sin(r),O=Math.cos(r);return t[0]=O*a+k*m,t[1]=O*u+k*y,t[2]=O*d+k*b,t[3]=O*m-k*a,t[4]=O*y-k*u,t[5]=O*b-k*d,t[6]=T,t[7]=E,t[8]=I,t},In.scale=function(t,e,r){var a=r[0],u=r[1];return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=u*e[3],t[4]=u*e[4],t[5]=u*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},In.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},In.fromRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=r,t[2]=0,t[3]=-r,t[4]=a,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},In.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},In.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},In.fromQuat=function(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],m=r+r,y=a+a,b=u+u,T=r*m,E=a*m,I=a*y,k=u*m,O=u*y,z=u*b,N=d*m,j=d*y,q=d*b;return t[0]=1-I-z,t[3]=E-q,t[6]=k+j,t[1]=E+q,t[4]=1-T-z,t[7]=O-N,t[2]=k-j,t[5]=O+N,t[8]=1-T-I,t},In.normalFromMat4=function(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],m=e[4],y=e[5],b=e[6],T=e[7],E=e[8],I=e[9],k=e[10],O=e[11],z=e[12],N=e[13],j=e[14],q=e[15],ie=r*y-a*m,oe=r*b-u*m,ae=r*T-d*m,he=a*b-u*y,me=a*T-d*y,Te=u*T-d*b,Pe=E*N-I*z,Re=E*j-k*z,Ge=E*q-O*z,Fe=I*j-k*N,et=I*q-O*N,bt=k*q-O*j,Je=ie*bt-oe*et+ae*Fe+he*Ge-me*Re+Te*Pe;return Je?(t[0]=(y*bt-b*et+T*Fe)*(Je=1/Je),t[1]=(b*Ge-m*bt-T*Re)*Je,t[2]=(m*et-y*Ge+T*Pe)*Je,t[3]=(u*et-a*bt-d*Fe)*Je,t[4]=(r*bt-u*Ge+d*Re)*Je,t[5]=(a*Ge-r*et-d*Pe)*Je,t[6]=(N*Te-j*me+q*he)*Je,t[7]=(j*ae-z*Te-q*oe)*Je,t[8]=(z*me-N*ae+q*ie)*Je,t):null},In.projection=function(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},In.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},In.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},In.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},In.subtract=dw,In.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},In.multiplyScalarAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t[4]=e[4]+r[4]*a,t[5]=e[5]+r[5]*a,t[6]=e[6]+r[6]*a,t[7]=e[7]+r[7]*a,t[8]=e[8]+r[8]*a,t},In.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},In.equals=function(t,e){var r=t[0],a=t[1],u=t[2],d=t[3],m=t[4],y=t[5],b=t[6],T=t[7],E=t[8],I=e[0],k=e[1],O=e[2],z=e[3],N=e[4],j=e[5],q=e[6],ie=e[7],oe=e[8];return Math.abs(r-I)<=Zs.EPSILON*Math.max(1,Math.abs(r),Math.abs(I))&&Math.abs(a-k)<=Zs.EPSILON*Math.max(1,Math.abs(a),Math.abs(k))&&Math.abs(u-O)<=Zs.EPSILON*Math.max(1,Math.abs(u),Math.abs(O))&&Math.abs(d-z)<=Zs.EPSILON*Math.max(1,Math.abs(d),Math.abs(z))&&Math.abs(m-N)<=Zs.EPSILON*Math.max(1,Math.abs(m),Math.abs(N))&&Math.abs(y-j)<=Zs.EPSILON*Math.max(1,Math.abs(y),Math.abs(j))&&Math.abs(b-q)<=Zs.EPSILON*Math.max(1,Math.abs(b),Math.abs(q))&&Math.abs(T-ie)<=Zs.EPSILON*Math.max(1,Math.abs(T),Math.abs(ie))&&Math.abs(E-oe)<=Zs.EPSILON*Math.max(1,Math.abs(E),Math.abs(oe))},In.sub=In.mul=void 0;var Zs=function(t,e){if(t&&t.__esModule)return t;if(t===null||I0(t)!=="object"&&typeof t!="function")return{default:t};var r=hw(void 0);if(r&&r.has(t))return r.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var m=u?Object.getOwnPropertyDescriptor(t,d):null;m&&(m.get||m.set)?Object.defineProperty(a,d,m):a[d]=t[d]}return a.default=t,r&&r.set(t,a),a}($r);function hw(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(hw=function(a){return a?r:e})(t)}function fw(t,e,r){var a=e[0],u=e[1],d=e[2],m=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=e[8],k=r[0],O=r[1],z=r[2],N=r[3],j=r[4],q=r[5],ie=r[6],oe=r[7],ae=r[8];return t[0]=k*a+O*m+z*T,t[1]=k*u+O*y+z*E,t[2]=k*d+O*b+z*I,t[3]=N*a+j*m+q*T,t[4]=N*u+j*y+q*E,t[5]=N*d+j*b+q*I,t[6]=ie*a+oe*m+ae*T,t[7]=ie*u+oe*y+ae*E,t[8]=ie*d+oe*b+ae*I,t}function dw(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}In.mul=fw,In.sub=dw;var Ni={};function C0(t){return C0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C0(t)}Object.defineProperty(Ni,"__esModule",{value:!0}),Ni.create=function(){var t=new _r.ARRAY_TYPE(16);return _r.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Ni.clone=function(t){var e=new _r.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Ni.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Ni.fromValues=function(t,e,r,a,u,d,m,y,b,T,E,I,k,O,z,N){var j=new _r.ARRAY_TYPE(16);return j[0]=t,j[1]=e,j[2]=r,j[3]=a,j[4]=u,j[5]=d,j[6]=m,j[7]=y,j[8]=b,j[9]=T,j[10]=E,j[11]=I,j[12]=k,j[13]=O,j[14]=z,j[15]=N,j},Ni.set=function(t,e,r,a,u,d,m,y,b,T,E,I,k,O,z,N,j){return t[0]=e,t[1]=r,t[2]=a,t[3]=u,t[4]=d,t[5]=m,t[6]=y,t[7]=b,t[8]=T,t[9]=E,t[10]=I,t[11]=k,t[12]=O,t[13]=z,t[14]=N,t[15]=j,t},Ni.identity=mw,Ni.transpose=function(t,e){if(t===e){var r=e[1],a=e[2],u=e[3],d=e[6],m=e[7],y=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=a,t[9]=d,t[11]=e[14],t[12]=u,t[13]=m,t[14]=y}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Ni.invert=function(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],m=e[4],y=e[5],b=e[6],T=e[7],E=e[8],I=e[9],k=e[10],O=e[11],z=e[12],N=e[13],j=e[14],q=e[15],ie=r*y-a*m,oe=r*b-u*m,ae=r*T-d*m,he=a*b-u*y,me=a*T-d*y,Te=u*T-d*b,Pe=E*N-I*z,Re=E*j-k*z,Ge=E*q-O*z,Fe=I*j-k*N,et=I*q-O*N,bt=k*q-O*j,Je=ie*bt-oe*et+ae*Fe+he*Ge-me*Re+Te*Pe;return Je?(t[0]=(y*bt-b*et+T*Fe)*(Je=1/Je),t[1]=(u*et-a*bt-d*Fe)*Je,t[2]=(N*Te-j*me+q*he)*Je,t[3]=(k*me-I*Te-O*he)*Je,t[4]=(b*Ge-m*bt-T*Re)*Je,t[5]=(r*bt-u*Ge+d*Re)*Je,t[6]=(j*ae-z*Te-q*oe)*Je,t[7]=(E*Te-k*ae+O*oe)*Je,t[8]=(m*et-y*Ge+T*Pe)*Je,t[9]=(a*Ge-r*et-d*Pe)*Je,t[10]=(z*me-N*ae+q*ie)*Je,t[11]=(I*ae-E*me-O*ie)*Je,t[12]=(y*Re-m*Fe-b*Pe)*Je,t[13]=(r*Fe-a*Re+u*Pe)*Je,t[14]=(N*oe-z*he-j*ie)*Je,t[15]=(E*he-I*oe+k*ie)*Je,t):null},Ni.adjoint=function(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],m=e[4],y=e[5],b=e[6],T=e[7],E=e[8],I=e[9],k=e[10],O=e[11],z=e[12],N=e[13],j=e[14],q=e[15];return t[0]=y*(k*q-O*j)-I*(b*q-T*j)+N*(b*O-T*k),t[1]=-(a*(k*q-O*j)-I*(u*q-d*j)+N*(u*O-d*k)),t[2]=a*(b*q-T*j)-y*(u*q-d*j)+N*(u*T-d*b),t[3]=-(a*(b*O-T*k)-y*(u*O-d*k)+I*(u*T-d*b)),t[4]=-(m*(k*q-O*j)-E*(b*q-T*j)+z*(b*O-T*k)),t[5]=r*(k*q-O*j)-E*(u*q-d*j)+z*(u*O-d*k),t[6]=-(r*(b*q-T*j)-m*(u*q-d*j)+z*(u*T-d*b)),t[7]=r*(b*O-T*k)-m*(u*O-d*k)+E*(u*T-d*b),t[8]=m*(I*q-O*N)-E*(y*q-T*N)+z*(y*O-T*I),t[9]=-(r*(I*q-O*N)-E*(a*q-d*N)+z*(a*O-d*I)),t[10]=r*(y*q-T*N)-m*(a*q-d*N)+z*(a*T-d*y),t[11]=-(r*(y*O-T*I)-m*(a*O-d*I)+E*(a*T-d*y)),t[12]=-(m*(I*j-k*N)-E*(y*j-b*N)+z*(y*k-b*I)),t[13]=r*(I*j-k*N)-E*(a*j-u*N)+z*(a*k-u*I),t[14]=-(r*(y*j-b*N)-m*(a*j-u*N)+z*(a*b-u*y)),t[15]=r*(y*k-b*I)-m*(a*k-u*I)+E*(a*b-u*y),t},Ni.determinant=function(t){var e=t[0],r=t[1],a=t[2],u=t[3],d=t[4],m=t[5],y=t[6],b=t[7],T=t[8],E=t[9],I=t[10],k=t[11],O=t[12],z=t[13],N=t[14],j=t[15];return(e*m-r*d)*(I*j-k*N)-(e*y-a*d)*(E*j-k*z)+(e*b-u*d)*(E*N-I*z)+(r*y-a*m)*(T*j-k*O)-(r*b-u*m)*(T*N-I*O)+(a*b-u*y)*(T*z-E*O)},Ni.multiply=gw,Ni.translate=function(t,e,r){var a,u,d,m,y,b,T,E,I,k,O,z,N=r[0],j=r[1],q=r[2];return e===t?(t[12]=e[0]*N+e[4]*j+e[8]*q+e[12],t[13]=e[1]*N+e[5]*j+e[9]*q+e[13],t[14]=e[2]*N+e[6]*j+e[10]*q+e[14],t[15]=e[3]*N+e[7]*j+e[11]*q+e[15]):(u=e[1],d=e[2],m=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=e[8],k=e[9],O=e[10],z=e[11],t[0]=a=e[0],t[1]=u,t[2]=d,t[3]=m,t[4]=y,t[5]=b,t[6]=T,t[7]=E,t[8]=I,t[9]=k,t[10]=O,t[11]=z,t[12]=a*N+y*j+I*q+e[12],t[13]=u*N+b*j+k*q+e[13],t[14]=d*N+T*j+O*q+e[14],t[15]=m*N+E*j+z*q+e[15]),t},Ni.scale=function(t,e,r){var a=r[0],u=r[1],d=r[2];return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*u,t[5]=e[5]*u,t[6]=e[6]*u,t[7]=e[7]*u,t[8]=e[8]*d,t[9]=e[9]*d,t[10]=e[10]*d,t[11]=e[11]*d,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Ni.rotate=function(t,e,r,a){var u,d,m,y,b,T,E,I,k,O,z,N,j,q,ie,oe,ae,he,me,Te,Pe,Re,Ge,Fe,et=a[0],bt=a[1],Je=a[2],gt=Math.hypot(et,bt,Je);return gt<_r.EPSILON?null:(et*=gt=1/gt,bt*=gt,Je*=gt,u=Math.sin(r),d=Math.cos(r),b=e[1],T=e[2],E=e[3],k=e[5],O=e[6],z=e[7],j=e[9],q=e[10],ie=e[11],me=et*bt*(m=1-d)-Je*u,Te=bt*bt*m+d,Pe=Je*bt*m+et*u,Re=et*Je*m+bt*u,Ge=bt*Je*m-et*u,Fe=Je*Je*m+d,t[0]=(y=e[0])*(oe=et*et*m+d)+(I=e[4])*(ae=bt*et*m+Je*u)+(N=e[8])*(he=Je*et*m-bt*u),t[1]=b*oe+k*ae+j*he,t[2]=T*oe+O*ae+q*he,t[3]=E*oe+z*ae+ie*he,t[4]=y*me+I*Te+N*Pe,t[5]=b*me+k*Te+j*Pe,t[6]=T*me+O*Te+q*Pe,t[7]=E*me+z*Te+ie*Pe,t[8]=y*Re+I*Ge+N*Fe,t[9]=b*Re+k*Ge+j*Fe,t[10]=T*Re+O*Ge+q*Fe,t[11]=E*Re+z*Ge+ie*Fe,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Ni.rotateX=function(t,e,r){var a=Math.sin(r),u=Math.cos(r),d=e[4],m=e[5],y=e[6],b=e[7],T=e[8],E=e[9],I=e[10],k=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=d*u+T*a,t[5]=m*u+E*a,t[6]=y*u+I*a,t[7]=b*u+k*a,t[8]=T*u-d*a,t[9]=E*u-m*a,t[10]=I*u-y*a,t[11]=k*u-b*a,t},Ni.rotateY=function(t,e,r){var a=Math.sin(r),u=Math.cos(r),d=e[0],m=e[1],y=e[2],b=e[3],T=e[8],E=e[9],I=e[10],k=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*u-T*a,t[1]=m*u-E*a,t[2]=y*u-I*a,t[3]=b*u-k*a,t[8]=d*a+T*u,t[9]=m*a+E*u,t[10]=y*a+I*u,t[11]=b*a+k*u,t},Ni.rotateZ=function(t,e,r){var a=Math.sin(r),u=Math.cos(r),d=e[0],m=e[1],y=e[2],b=e[3],T=e[4],E=e[5],I=e[6],k=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*u+T*a,t[1]=m*u+E*a,t[2]=y*u+I*a,t[3]=b*u+k*a,t[4]=T*u-d*a,t[5]=E*u-m*a,t[6]=I*u-y*a,t[7]=k*u-b*a,t},Ni.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Ni.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ni.fromRotation=function(t,e,r){var a,u,d,m=r[0],y=r[1],b=r[2],T=Math.hypot(m,y,b);return T<_r.EPSILON?null:(m*=T=1/T,y*=T,b*=T,a=Math.sin(e),u=Math.cos(e),t[0]=m*m*(d=1-u)+u,t[1]=y*m*d+b*a,t[2]=b*m*d-y*a,t[3]=0,t[4]=m*y*d-b*a,t[5]=y*y*d+u,t[6]=b*y*d+m*a,t[7]=0,t[8]=m*b*d+y*a,t[9]=y*b*d-m*a,t[10]=b*b*d+u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Ni.fromXRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ni.fromYRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ni.fromZRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ni.fromRotationTranslation=_w,Ni.fromQuat2=function(t,e){var r=new _r.ARRAY_TYPE(3),a=-e[0],u=-e[1],d=-e[2],m=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=a*a+u*u+d*d+m*m;return I>0?(r[0]=2*(y*m+E*a+b*d-T*u)/I,r[1]=2*(b*m+E*u+T*a-y*d)/I,r[2]=2*(T*m+E*d+y*u-b*a)/I):(r[0]=2*(y*m+E*a+b*d-T*u),r[1]=2*(b*m+E*u+T*a-y*d),r[2]=2*(T*m+E*d+y*u-b*a)),_w(t,e,r),t},Ni.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Ni.getScaling=yw,Ni.getRotation=function(t,e){var r=new _r.ARRAY_TYPE(3);yw(r,e);var a=1/r[0],u=1/r[1],d=1/r[2],m=e[0]*a,y=e[1]*u,b=e[2]*d,T=e[4]*a,E=e[5]*u,I=e[6]*d,k=e[8]*a,O=e[9]*u,z=e[10]*d,N=m+E+z,j=0;return N>0?(j=2*Math.sqrt(N+1),t[3]=.25*j,t[0]=(I-O)/j,t[1]=(k-b)/j,t[2]=(y-T)/j):m>E&&m>z?(j=2*Math.sqrt(1+m-E-z),t[3]=(I-O)/j,t[0]=.25*j,t[1]=(y+T)/j,t[2]=(k+b)/j):E>z?(j=2*Math.sqrt(1+E-m-z),t[3]=(k-b)/j,t[0]=(y+T)/j,t[1]=.25*j,t[2]=(I+O)/j):(j=2*Math.sqrt(1+z-m-E),t[3]=(y-T)/j,t[0]=(k+b)/j,t[1]=(I+O)/j,t[2]=.25*j),t},Ni.fromRotationTranslationScale=function(t,e,r,a){var u=e[0],d=e[1],m=e[2],y=e[3],b=u+u,T=d+d,E=m+m,I=u*b,k=u*T,O=u*E,z=d*T,N=d*E,j=m*E,q=y*b,ie=y*T,oe=y*E,ae=a[0],he=a[1],me=a[2];return t[0]=(1-(z+j))*ae,t[1]=(k+oe)*ae,t[2]=(O-ie)*ae,t[3]=0,t[4]=(k-oe)*he,t[5]=(1-(I+j))*he,t[6]=(N+q)*he,t[7]=0,t[8]=(O+ie)*me,t[9]=(N-q)*me,t[10]=(1-(I+z))*me,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},Ni.fromRotationTranslationScaleOrigin=function(t,e,r,a,u){var d=e[0],m=e[1],y=e[2],b=e[3],T=d+d,E=m+m,I=y+y,k=d*T,O=d*E,z=d*I,N=m*E,j=m*I,q=y*I,ie=b*T,oe=b*E,ae=b*I,he=a[0],me=a[1],Te=a[2],Pe=u[0],Re=u[1],Ge=u[2],Fe=(1-(N+q))*he,et=(O+ae)*he,bt=(z-oe)*he,Je=(O-ae)*me,gt=(1-(k+q))*me,Ye=(j+ie)*me,Vt=(z+oe)*Te,$t=(j-ie)*Te,vt=(1-(k+N))*Te;return t[0]=Fe,t[1]=et,t[2]=bt,t[3]=0,t[4]=Je,t[5]=gt,t[6]=Ye,t[7]=0,t[8]=Vt,t[9]=$t,t[10]=vt,t[11]=0,t[12]=r[0]+Pe-(Fe*Pe+Je*Re+Vt*Ge),t[13]=r[1]+Re-(et*Pe+gt*Re+$t*Ge),t[14]=r[2]+Ge-(bt*Pe+Ye*Re+vt*Ge),t[15]=1,t},Ni.fromQuat=function(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],m=r+r,y=a+a,b=u+u,T=r*m,E=a*m,I=a*y,k=u*m,O=u*y,z=u*b,N=d*m,j=d*y,q=d*b;return t[0]=1-I-z,t[1]=E+q,t[2]=k-j,t[3]=0,t[4]=E-q,t[5]=1-T-z,t[6]=O+N,t[7]=0,t[8]=k+j,t[9]=O-N,t[10]=1-T-I,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ni.frustum=function(t,e,r,a,u,d,m){var y=1/(r-e),b=1/(u-a),T=1/(d-m);return t[0]=2*d*y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*d*b,t[6]=0,t[7]=0,t[8]=(r+e)*y,t[9]=(u+a)*b,t[10]=(m+d)*T,t[11]=-1,t[12]=0,t[13]=0,t[14]=m*d*2*T,t[15]=0,t},Ni.perspectiveNO=vw,Ni.perspectiveZO=function(t,e,r,a,u){var d,m=1/Math.tan(e/2);return t[0]=m/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=m,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,u!=null&&u!==1/0?(t[10]=u*(d=1/(a-u)),t[14]=u*a*d):(t[10]=-1,t[14]=-a),t},Ni.perspectiveFromFieldOfView=function(t,e,r,a){var u=Math.tan(e.upDegrees*Math.PI/180),d=Math.tan(e.downDegrees*Math.PI/180),m=Math.tan(e.leftDegrees*Math.PI/180),y=Math.tan(e.rightDegrees*Math.PI/180),b=2/(m+y),T=2/(u+d);return t[0]=b,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=T,t[6]=0,t[7]=0,t[8]=-(m-y)*b*.5,t[9]=(u-d)*T*.5,t[10]=a/(r-a),t[11]=-1,t[12]=0,t[13]=0,t[14]=a*r/(r-a),t[15]=0,t},Ni.orthoNO=xw,Ni.orthoZO=function(t,e,r,a,u,d,m){var y=1/(e-r),b=1/(a-u),T=1/(d-m);return t[0]=-2*y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*b,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=T,t[11]=0,t[12]=(e+r)*y,t[13]=(u+a)*b,t[14]=d*T,t[15]=1,t},Ni.lookAt=function(t,e,r,a){var u,d,m,y,b,T,E,I,k,O,z=e[0],N=e[1],j=e[2],q=a[0],ie=a[1],oe=a[2],ae=r[0],he=r[1],me=r[2];return Math.abs(z-ae)<_r.EPSILON&&Math.abs(N-he)<_r.EPSILON&&Math.abs(j-me)<_r.EPSILON?mw(t):(E=z-ae,I=N-he,k=j-me,u=ie*(k*=O=1/Math.hypot(E,I,k))-oe*(I*=O),d=oe*(E*=O)-q*k,m=q*I-ie*E,(O=Math.hypot(u,d,m))?(u*=O=1/O,d*=O,m*=O):(u=0,d=0,m=0),y=I*m-k*d,b=k*u-E*m,T=E*d-I*u,(O=Math.hypot(y,b,T))?(y*=O=1/O,b*=O,T*=O):(y=0,b=0,T=0),t[0]=u,t[1]=y,t[2]=E,t[3]=0,t[4]=d,t[5]=b,t[6]=I,t[7]=0,t[8]=m,t[9]=T,t[10]=k,t[11]=0,t[12]=-(u*z+d*N+m*j),t[13]=-(y*z+b*N+T*j),t[14]=-(E*z+I*N+k*j),t[15]=1,t)},Ni.targetTo=function(t,e,r,a){var u=e[0],d=e[1],m=e[2],y=a[0],b=a[1],T=a[2],E=u-r[0],I=d-r[1],k=m-r[2],O=E*E+I*I+k*k;O>0&&(E*=O=1/Math.sqrt(O),I*=O,k*=O);var z=b*k-T*I,N=T*E-y*k,j=y*I-b*E;return(O=z*z+N*N+j*j)>0&&(z*=O=1/Math.sqrt(O),N*=O,j*=O),t[0]=z,t[1]=N,t[2]=j,t[3]=0,t[4]=I*j-k*N,t[5]=k*z-E*j,t[6]=E*N-I*z,t[7]=0,t[8]=E,t[9]=I,t[10]=k,t[11]=0,t[12]=u,t[13]=d,t[14]=m,t[15]=1,t},Ni.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Ni.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Ni.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},Ni.subtract=bw,Ni.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},Ni.multiplyScalarAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t[4]=e[4]+r[4]*a,t[5]=e[5]+r[5]*a,t[6]=e[6]+r[6]*a,t[7]=e[7]+r[7]*a,t[8]=e[8]+r[8]*a,t[9]=e[9]+r[9]*a,t[10]=e[10]+r[10]*a,t[11]=e[11]+r[11]*a,t[12]=e[12]+r[12]*a,t[13]=e[13]+r[13]*a,t[14]=e[14]+r[14]*a,t[15]=e[15]+r[15]*a,t},Ni.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Ni.equals=function(t,e){var r=t[0],a=t[1],u=t[2],d=t[3],m=t[4],y=t[5],b=t[6],T=t[7],E=t[8],I=t[9],k=t[10],O=t[11],z=t[12],N=t[13],j=t[14],q=t[15],ie=e[0],oe=e[1],ae=e[2],he=e[3],me=e[4],Te=e[5],Pe=e[6],Re=e[7],Ge=e[8],Fe=e[9],et=e[10],bt=e[11],Je=e[12],gt=e[13],Ye=e[14],Vt=e[15];return Math.abs(r-ie)<=_r.EPSILON*Math.max(1,Math.abs(r),Math.abs(ie))&&Math.abs(a-oe)<=_r.EPSILON*Math.max(1,Math.abs(a),Math.abs(oe))&&Math.abs(u-ae)<=_r.EPSILON*Math.max(1,Math.abs(u),Math.abs(ae))&&Math.abs(d-he)<=_r.EPSILON*Math.max(1,Math.abs(d),Math.abs(he))&&Math.abs(m-me)<=_r.EPSILON*Math.max(1,Math.abs(m),Math.abs(me))&&Math.abs(y-Te)<=_r.EPSILON*Math.max(1,Math.abs(y),Math.abs(Te))&&Math.abs(b-Pe)<=_r.EPSILON*Math.max(1,Math.abs(b),Math.abs(Pe))&&Math.abs(T-Re)<=_r.EPSILON*Math.max(1,Math.abs(T),Math.abs(Re))&&Math.abs(E-Ge)<=_r.EPSILON*Math.max(1,Math.abs(E),Math.abs(Ge))&&Math.abs(I-Fe)<=_r.EPSILON*Math.max(1,Math.abs(I),Math.abs(Fe))&&Math.abs(k-et)<=_r.EPSILON*Math.max(1,Math.abs(k),Math.abs(et))&&Math.abs(O-bt)<=_r.EPSILON*Math.max(1,Math.abs(O),Math.abs(bt))&&Math.abs(z-Je)<=_r.EPSILON*Math.max(1,Math.abs(z),Math.abs(Je))&&Math.abs(N-gt)<=_r.EPSILON*Math.max(1,Math.abs(N),Math.abs(gt))&&Math.abs(j-Ye)<=_r.EPSILON*Math.max(1,Math.abs(j),Math.abs(Ye))&&Math.abs(q-Vt)<=_r.EPSILON*Math.max(1,Math.abs(q),Math.abs(Vt))},Ni.sub=Ni.mul=Ni.ortho=Ni.perspective=void 0;var _r=function(t,e){if(t&&t.__esModule)return t;if(t===null||C0(t)!=="object"&&typeof t!="function")return{default:t};var r=pw(void 0);if(r&&r.has(t))return r.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var m=u?Object.getOwnPropertyDescriptor(t,d):null;m&&(m.get||m.set)?Object.defineProperty(a,d,m):a[d]=t[d]}return a.default=t,r&&r.set(t,a),a}($r);function pw(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(pw=function(a){return a?r:e})(t)}function mw(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function gw(t,e,r){var a=e[0],u=e[1],d=e[2],m=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=e[8],k=e[9],O=e[10],z=e[11],N=e[12],j=e[13],q=e[14],ie=e[15],oe=r[0],ae=r[1],he=r[2],me=r[3];return t[0]=oe*a+ae*y+he*I+me*N,t[1]=oe*u+ae*b+he*k+me*j,t[2]=oe*d+ae*T+he*O+me*q,t[3]=oe*m+ae*E+he*z+me*ie,t[4]=(oe=r[4])*a+(ae=r[5])*y+(he=r[6])*I+(me=r[7])*N,t[5]=oe*u+ae*b+he*k+me*j,t[6]=oe*d+ae*T+he*O+me*q,t[7]=oe*m+ae*E+he*z+me*ie,t[8]=(oe=r[8])*a+(ae=r[9])*y+(he=r[10])*I+(me=r[11])*N,t[9]=oe*u+ae*b+he*k+me*j,t[10]=oe*d+ae*T+he*O+me*q,t[11]=oe*m+ae*E+he*z+me*ie,t[12]=(oe=r[12])*a+(ae=r[13])*y+(he=r[14])*I+(me=r[15])*N,t[13]=oe*u+ae*b+he*k+me*j,t[14]=oe*d+ae*T+he*O+me*q,t[15]=oe*m+ae*E+he*z+me*ie,t}function _w(t,e,r){var a=e[0],u=e[1],d=e[2],m=e[3],y=a+a,b=u+u,T=d+d,E=a*y,I=a*b,k=a*T,O=u*b,z=u*T,N=d*T,j=m*y,q=m*b,ie=m*T;return t[0]=1-(O+N),t[1]=I+ie,t[2]=k-q,t[3]=0,t[4]=I-ie,t[5]=1-(E+N),t[6]=z+j,t[7]=0,t[8]=k+q,t[9]=z-j,t[10]=1-(E+O),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function yw(t,e){var r=e[4],a=e[5],u=e[6],d=e[8],m=e[9],y=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(r,a,u),t[2]=Math.hypot(d,m,y),t}function vw(t,e,r,a,u){var d,m=1/Math.tan(e/2);return t[0]=m/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=m,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,u!=null&&u!==1/0?(t[10]=(u+a)*(d=1/(a-u)),t[14]=2*u*a*d):(t[10]=-1,t[14]=-2*a),t}function xw(t,e,r,a,u,d,m){var y=1/(e-r),b=1/(a-u),T=1/(d-m);return t[0]=-2*y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*b,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*T,t[11]=0,t[12]=(e+r)*y,t[13]=(u+a)*b,t[14]=(m+d)*T,t[15]=1,t}function bw(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}Ni.perspective=vw,Ni.ortho=xw,Ni.mul=gw,Ni.sub=bw;var ki={},Fi={};function P0(t){return P0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P0(t)}Object.defineProperty(Fi,"__esModule",{value:!0}),Fi.create=Tw,Fi.clone=function(t){var e=new $l.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Fi.length=Sw,Fi.fromValues=function(t,e,r){var a=new $l.ARRAY_TYPE(3);return a[0]=t,a[1]=e,a[2]=r,a},Fi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Fi.set=function(t,e,r,a){return t[0]=e,t[1]=r,t[2]=a,t},Fi.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},Fi.subtract=Mw,Fi.multiply=Ew,Fi.divide=Aw,Fi.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Fi.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Fi.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},Fi.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},Fi.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Fi.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},Fi.scaleAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t},Fi.distance=Iw,Fi.squaredDistance=Cw,Fi.squaredLength=Pw,Fi.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Fi.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Fi.normalize=function(t,e){var r=e[0],a=e[1],u=e[2],d=r*r+a*a+u*u;return d>0&&(d=1/Math.sqrt(d)),t[0]=e[0]*d,t[1]=e[1]*d,t[2]=e[2]*d,t},Fi.dot=kw,Fi.cross=function(t,e,r){var a=e[0],u=e[1],d=e[2],m=r[0],y=r[1],b=r[2];return t[0]=u*b-d*y,t[1]=d*m-a*b,t[2]=a*y-u*m,t},Fi.lerp=function(t,e,r,a){var u=e[0],d=e[1],m=e[2];return t[0]=u+a*(r[0]-u),t[1]=d+a*(r[1]-d),t[2]=m+a*(r[2]-m),t},Fi.hermite=function(t,e,r,a,u,d){var m=d*d,y=m*(2*d-3)+1,b=m*(d-2)+d,T=m*(d-1),E=m*(3-2*d);return t[0]=e[0]*y+r[0]*b+a[0]*T+u[0]*E,t[1]=e[1]*y+r[1]*b+a[1]*T+u[1]*E,t[2]=e[2]*y+r[2]*b+a[2]*T+u[2]*E,t},Fi.bezier=function(t,e,r,a,u,d){var m=1-d,y=m*m,b=d*d,T=y*m,E=3*d*y,I=3*b*m,k=b*d;return t[0]=e[0]*T+r[0]*E+a[0]*I+u[0]*k,t[1]=e[1]*T+r[1]*E+a[1]*I+u[1]*k,t[2]=e[2]*T+r[2]*E+a[2]*I+u[2]*k,t},Fi.random=function(t,e){e=e||1;var r=2*$l.RANDOM()*Math.PI,a=2*$l.RANDOM()-1,u=Math.sqrt(1-a*a)*e;return t[0]=Math.cos(r)*u,t[1]=Math.sin(r)*u,t[2]=a*e,t},Fi.transformMat4=function(t,e,r){var a=e[0],u=e[1],d=e[2],m=r[3]*a+r[7]*u+r[11]*d+r[15];return t[0]=(r[0]*a+r[4]*u+r[8]*d+r[12])/(m=m||1),t[1]=(r[1]*a+r[5]*u+r[9]*d+r[13])/m,t[2]=(r[2]*a+r[6]*u+r[10]*d+r[14])/m,t},Fi.transformMat3=function(t,e,r){var a=e[0],u=e[1],d=e[2];return t[0]=a*r[0]+u*r[3]+d*r[6],t[1]=a*r[1]+u*r[4]+d*r[7],t[2]=a*r[2]+u*r[5]+d*r[8],t},Fi.transformQuat=function(t,e,r){var a=r[0],u=r[1],d=r[2],m=e[0],y=e[1],b=e[2],T=u*b-d*y,E=d*m-a*b,I=a*y-u*m,k=u*I-d*E,O=d*T-a*I,z=a*E-u*T,N=2*r[3];return E*=N,I*=N,O*=2,z*=2,t[0]=m+(T*=N)+(k*=2),t[1]=y+E+O,t[2]=b+I+z,t},Fi.rotateX=function(t,e,r,a){var u=[],d=[];return u[0]=e[0]-r[0],u[1]=e[1]-r[1],u[2]=e[2]-r[2],d[0]=u[0],d[1]=u[1]*Math.cos(a)-u[2]*Math.sin(a),d[2]=u[1]*Math.sin(a)+u[2]*Math.cos(a),t[0]=d[0]+r[0],t[1]=d[1]+r[1],t[2]=d[2]+r[2],t},Fi.rotateY=function(t,e,r,a){var u=[],d=[];return u[0]=e[0]-r[0],u[1]=e[1]-r[1],u[2]=e[2]-r[2],d[0]=u[2]*Math.sin(a)+u[0]*Math.cos(a),d[1]=u[1],d[2]=u[2]*Math.cos(a)-u[0]*Math.sin(a),t[0]=d[0]+r[0],t[1]=d[1]+r[1],t[2]=d[2]+r[2],t},Fi.rotateZ=function(t,e,r,a){var u=[],d=[];return u[0]=e[0]-r[0],u[1]=e[1]-r[1],u[2]=e[2]-r[2],d[0]=u[0]*Math.cos(a)-u[1]*Math.sin(a),d[1]=u[0]*Math.sin(a)+u[1]*Math.cos(a),d[2]=u[2],t[0]=d[0]+r[0],t[1]=d[1]+r[1],t[2]=d[2]+r[2],t},Fi.angle=function(t,e){var r=t[0],a=t[1],u=t[2],d=e[0],m=e[1],y=e[2],b=Math.sqrt(r*r+a*a+u*u)*Math.sqrt(d*d+m*m+y*y),T=b&&kw(t,e)/b;return Math.acos(Math.min(Math.max(T,-1),1))},Fi.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Fi.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Fi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Fi.equals=function(t,e){var r=t[0],a=t[1],u=t[2],d=e[0],m=e[1],y=e[2];return Math.abs(r-d)<=$l.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(a-m)<=$l.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(u-y)<=$l.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))},Fi.forEach=Fi.sqrLen=Fi.len=Fi.sqrDist=Fi.dist=Fi.div=Fi.mul=Fi.sub=void 0;var $l=function(t,e){if(t&&t.__esModule)return t;if(t===null||P0(t)!=="object"&&typeof t!="function")return{default:t};var r=ww(void 0);if(r&&r.has(t))return r.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var m=u?Object.getOwnPropertyDescriptor(t,d):null;m&&(m.get||m.set)?Object.defineProperty(a,d,m):a[d]=t[d]}return a.default=t,r&&r.set(t,a),a}($r);function ww(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(ww=function(a){return a?r:e})(t)}function Tw(){var t=new $l.ARRAY_TYPE(3);return $l.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Sw(t){return Math.hypot(t[0],t[1],t[2])}function Mw(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function Ew(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function Aw(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function Iw(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function Cw(t,e){var r=e[0]-t[0],a=e[1]-t[1],u=e[2]-t[2];return r*r+a*a+u*u}function Pw(t){var e=t[0],r=t[1],a=t[2];return e*e+r*r+a*a}function kw(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Fi.sub=Mw,Fi.mul=Ew,Fi.div=Aw,Fi.dist=Iw,Fi.sqrDist=Cw,Fi.len=Sw,Fi.sqrLen=Pw;var ec,DD=(ec=Tw(),function(t,e,r,a,u,d){var m,y;for(e||(e=3),r||(r=0),y=a?Math.min(a*e+r,t.length):t.length,m=r;m<y;m+=e)ec[0]=t[m],ec[1]=t[m+1],ec[2]=t[m+2],u(ec,ec,d),t[m]=ec[0],t[m+1]=ec[1],t[m+2]=ec[2];return t});Fi.forEach=DD;var Ji={};function k0(t){return k0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k0(t)}Object.defineProperty(Ji,"__esModule",{value:!0}),Ji.create=Lw,Ji.clone=function(t){var e=new ua.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Ji.fromValues=function(t,e,r,a){var u=new ua.ARRAY_TYPE(4);return u[0]=t,u[1]=e,u[2]=r,u[3]=a,u},Ji.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Ji.set=function(t,e,r,a,u){return t[0]=e,t[1]=r,t[2]=a,t[3]=u,t},Ji.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},Ji.subtract=Ow,Ji.multiply=Rw,Ji.divide=zw,Ji.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Ji.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Ji.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},Ji.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},Ji.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Ji.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},Ji.scaleAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t},Ji.distance=Fw,Ji.squaredDistance=Bw,Ji.length=Nw,Ji.squaredLength=Vw,Ji.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Ji.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Ji.normalize=function(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],m=r*r+a*a+u*u+d*d;return m>0&&(m=1/Math.sqrt(m)),t[0]=r*m,t[1]=a*m,t[2]=u*m,t[3]=d*m,t},Ji.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Ji.cross=function(t,e,r,a){var u=r[0]*a[1]-r[1]*a[0],d=r[0]*a[2]-r[2]*a[0],m=r[0]*a[3]-r[3]*a[0],y=r[1]*a[2]-r[2]*a[1],b=r[1]*a[3]-r[3]*a[1],T=r[2]*a[3]-r[3]*a[2],E=e[0],I=e[1],k=e[2],O=e[3];return t[0]=I*T-k*b+O*y,t[1]=-E*T+k*m-O*d,t[2]=E*b-I*m+O*u,t[3]=-E*y+I*d-k*u,t},Ji.lerp=function(t,e,r,a){var u=e[0],d=e[1],m=e[2],y=e[3];return t[0]=u+a*(r[0]-u),t[1]=d+a*(r[1]-d),t[2]=m+a*(r[2]-m),t[3]=y+a*(r[3]-y),t},Ji.random=function(t,e){var r,a,u,d,m,y;e=e||1;do m=(r=2*ua.RANDOM()-1)*r+(a=2*ua.RANDOM()-1)*a;while(m>=1);do y=(u=2*ua.RANDOM()-1)*u+(d=2*ua.RANDOM()-1)*d;while(y>=1);var b=Math.sqrt((1-m)/y);return t[0]=e*r,t[1]=e*a,t[2]=e*u*b,t[3]=e*d*b,t},Ji.transformMat4=function(t,e,r){var a=e[0],u=e[1],d=e[2],m=e[3];return t[0]=r[0]*a+r[4]*u+r[8]*d+r[12]*m,t[1]=r[1]*a+r[5]*u+r[9]*d+r[13]*m,t[2]=r[2]*a+r[6]*u+r[10]*d+r[14]*m,t[3]=r[3]*a+r[7]*u+r[11]*d+r[15]*m,t},Ji.transformQuat=function(t,e,r){var a=e[0],u=e[1],d=e[2],m=r[0],y=r[1],b=r[2],T=r[3],E=T*a+y*d-b*u,I=T*u+b*a-m*d,k=T*d+m*u-y*a,O=-m*a-y*u-b*d;return t[0]=E*T+O*-m+I*-b-k*-y,t[1]=I*T+O*-y+k*-m-E*-b,t[2]=k*T+O*-b+E*-y-I*-m,t[3]=e[3],t},Ji.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Ji.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Ji.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Ji.equals=function(t,e){var r=t[0],a=t[1],u=t[2],d=t[3],m=e[0],y=e[1],b=e[2],T=e[3];return Math.abs(r-m)<=ua.EPSILON*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(a-y)<=ua.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(u-b)<=ua.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(d-T)<=ua.EPSILON*Math.max(1,Math.abs(d),Math.abs(T))},Ji.forEach=Ji.sqrLen=Ji.len=Ji.sqrDist=Ji.dist=Ji.div=Ji.mul=Ji.sub=void 0;var ua=function(t,e){if(t&&t.__esModule)return t;if(t===null||k0(t)!=="object"&&typeof t!="function")return{default:t};var r=Dw(void 0);if(r&&r.has(t))return r.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var m=u?Object.getOwnPropertyDescriptor(t,d):null;m&&(m.get||m.set)?Object.defineProperty(a,d,m):a[d]=t[d]}return a.default=t,r&&r.set(t,a),a}($r);function Dw(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Dw=function(a){return a?r:e})(t)}function Lw(){var t=new ua.ARRAY_TYPE(4);return ua.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Ow(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Rw(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function zw(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function Fw(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function Bw(t,e){var r=e[0]-t[0],a=e[1]-t[1],u=e[2]-t[2],d=e[3]-t[3];return r*r+a*a+u*u+d*d}function Nw(t){return Math.hypot(t[0],t[1],t[2],t[3])}function Vw(t){var e=t[0],r=t[1],a=t[2],u=t[3];return e*e+r*r+a*a+u*u}Ji.sub=Ow,Ji.mul=Rw,Ji.div=zw,Ji.dist=Fw,Ji.sqrDist=Bw,Ji.len=Nw,Ji.sqrLen=Vw;var LD=function(){var t=Lw();return function(e,r,a,u,d,m){var y,b;for(r||(r=4),a||(a=0),b=u?Math.min(u*r+a,e.length):e.length,y=a;y<b;y+=r)t[0]=e[y],t[1]=e[y+1],t[2]=e[y+2],t[3]=e[y+3],d(t,t,m),e[y]=t[0],e[y+1]=t[1],e[y+2]=t[2],e[y+3]=t[3];return e}}();function D0(t){return D0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D0(t)}Ji.forEach=LD,Object.defineProperty(ki,"__esModule",{value:!0}),ki.create=L0,ki.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},ki.setAxisAngle=jw,ki.getAxisAngle=function(t,e){var r=2*Math.acos(e[3]),a=Math.sin(r/2);return a>$u.EPSILON?(t[0]=e[0]/a,t[1]=e[1]/a,t[2]=e[2]/a):(t[0]=1,t[1]=0,t[2]=0),r},ki.getAngle=function(t,e){var r=Xw(t,e);return Math.acos(2*r*r-1)},ki.multiply=Gw,ki.rotateX=function(t,e,r){r*=.5;var a=e[0],u=e[1],d=e[2],m=e[3],y=Math.sin(r),b=Math.cos(r);return t[0]=a*b+m*y,t[1]=u*b+d*y,t[2]=d*b-u*y,t[3]=m*b-a*y,t},ki.rotateY=function(t,e,r){r*=.5;var a=e[0],u=e[1],d=e[2],m=e[3],y=Math.sin(r),b=Math.cos(r);return t[0]=a*b-d*y,t[1]=u*b+m*y,t[2]=d*b+a*y,t[3]=m*b-u*y,t},ki.rotateZ=function(t,e,r){r*=.5;var a=e[0],u=e[1],d=e[2],m=e[3],y=Math.sin(r),b=Math.cos(r);return t[0]=a*b+u*y,t[1]=u*b-a*y,t[2]=d*b+m*y,t[3]=m*b-d*y,t},ki.calculateW=function(t,e){var r=e[0],a=e[1],u=e[2];return t[0]=r,t[1]=a,t[2]=u,t[3]=Math.sqrt(Math.abs(1-r*r-a*a-u*u)),t},ki.exp=Hw,ki.ln=Ww,ki.pow=function(t,e,r){return Ww(t,e),Zw(t,t,r),Hw(t,t),t},ki.slerp=ng,ki.random=function(t){var e=$u.RANDOM(),r=$u.RANDOM(),a=$u.RANDOM(),u=Math.sqrt(1-e),d=Math.sqrt(e);return t[0]=u*Math.sin(2*Math.PI*r),t[1]=u*Math.cos(2*Math.PI*r),t[2]=d*Math.sin(2*Math.PI*a),t[3]=d*Math.cos(2*Math.PI*a),t},ki.invert=function(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],m=r*r+a*a+u*u+d*d,y=m?1/m:0;return t[0]=-r*y,t[1]=-a*y,t[2]=-u*y,t[3]=d*y,t},ki.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},ki.fromMat3=qw,ki.fromEuler=function(t,e,r,a){var u=.5*Math.PI/180;e*=u,r*=u,a*=u;var d=Math.sin(e),m=Math.cos(e),y=Math.sin(r),b=Math.cos(r),T=Math.sin(a),E=Math.cos(a);return t[0]=d*b*E-m*y*T,t[1]=m*y*E+d*b*T,t[2]=m*b*T-d*y*E,t[3]=m*b*E+d*y*T,t},ki.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},ki.setAxes=ki.sqlerp=ki.rotationTo=ki.equals=ki.exactEquals=ki.normalize=ki.sqrLen=ki.squaredLength=ki.len=ki.length=ki.lerp=ki.dot=ki.scale=ki.mul=ki.add=ki.set=ki.copy=ki.fromValues=ki.clone=void 0;var $u=ig($r),OD=ig(In),tc=ig(Fi),Xs=ig(Ji);function Uw(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Uw=function(a){return a?r:e})(t)}function ig(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||D0(t)!=="object"&&typeof t!="function")return{default:t};var r=Uw(e);if(r&&r.has(t))return r.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var m=u?Object.getOwnPropertyDescriptor(t,d):null;m&&(m.get||m.set)?Object.defineProperty(a,d,m):a[d]=t[d]}return a.default=t,r&&r.set(t,a),a}function L0(){var t=new $u.ARRAY_TYPE(4);return $u.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function jw(t,e,r){r*=.5;var a=Math.sin(r);return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=Math.cos(r),t}function Gw(t,e,r){var a=e[0],u=e[1],d=e[2],m=e[3],y=r[0],b=r[1],T=r[2],E=r[3];return t[0]=a*E+m*y+u*T-d*b,t[1]=u*E+m*b+d*y-a*T,t[2]=d*E+m*T+a*b-u*y,t[3]=m*E-a*y-u*b-d*T,t}function Hw(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],m=Math.sqrt(r*r+a*a+u*u),y=Math.exp(d),b=m>0?y*Math.sin(m)/m:0;return t[0]=r*b,t[1]=a*b,t[2]=u*b,t[3]=y*Math.cos(m),t}function Ww(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],m=Math.sqrt(r*r+a*a+u*u),y=m>0?Math.atan2(m,d)/m:0;return t[0]=r*y,t[1]=a*y,t[2]=u*y,t[3]=.5*Math.log(r*r+a*a+u*u+d*d),t}function ng(t,e,r,a){var u,d,m,y,b,T=e[0],E=e[1],I=e[2],k=e[3],O=r[0],z=r[1],N=r[2],j=r[3];return(d=T*O+E*z+I*N+k*j)<0&&(d=-d,O=-O,z=-z,N=-N,j=-j),1-d>$u.EPSILON?(u=Math.acos(d),m=Math.sin(u),y=Math.sin((1-a)*u)/m,b=Math.sin(a*u)/m):(y=1-a,b=a),t[0]=y*T+b*O,t[1]=y*E+b*z,t[2]=y*I+b*N,t[3]=y*k+b*j,t}function qw(t,e){var r,a=e[0]+e[4]+e[8];if(a>0)r=Math.sqrt(a+1),t[3]=.5*r,t[0]=(e[5]-e[7])*(r=.5/r),t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var u=0;e[4]>e[0]&&(u=1),e[8]>e[3*u+u]&&(u=2);var d=(u+1)%3,m=(u+2)%3;r=Math.sqrt(e[3*u+u]-e[3*d+d]-e[3*m+m]+1),t[u]=.5*r,t[3]=(e[3*d+m]-e[3*m+d])*(r=.5/r),t[d]=(e[3*d+u]+e[3*u+d])*r,t[m]=(e[3*m+u]+e[3*u+m])*r}return t}ki.clone=Xs.clone,ki.fromValues=Xs.fromValues,ki.copy=Xs.copy,ki.set=Xs.set,ki.add=Xs.add,ki.mul=Gw;var Zw=Xs.scale;ki.scale=Zw;var Xw=Xs.dot;ki.dot=Xw,ki.lerp=Xs.lerp;var Yw=Xs.length;ki.length=Yw,ki.len=Yw;var Jw=Xs.squaredLength;ki.squaredLength=Jw,ki.sqrLen=Jw;var O0=Xs.normalize;ki.normalize=O0,ki.exactEquals=Xs.exactEquals,ki.equals=Xs.equals;var Ba,Kw,Qw,RD=(Ba=tc.create(),Kw=tc.fromValues(1,0,0),Qw=tc.fromValues(0,1,0),function(t,e,r){var a=tc.dot(e,r);return a<-.999999?(tc.cross(Ba,Kw,e),tc.len(Ba)<1e-6&&tc.cross(Ba,Qw,e),tc.normalize(Ba,Ba),jw(t,Ba,Math.PI),t):a>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(tc.cross(Ba,e,r),t[0]=Ba[0],t[1]=Ba[1],t[2]=Ba[2],t[3]=1+a,O0(t,t))});ki.rotationTo=RD;var R0,z0,zD=(R0=L0(),z0=L0(),function(t,e,r,a,u,d){return ng(R0,e,u,d),ng(z0,r,a,d),ng(t,R0,z0,2*d*(1-d)),t});ki.sqlerp=zD;var Na,FD=(Na=OD.create(),function(t,e,r,a){return Na[0]=r[0],Na[3]=r[1],Na[6]=r[2],Na[1]=a[0],Na[4]=a[1],Na[7]=a[2],Na[2]=-e[0],Na[5]=-e[1],Na[8]=-e[2],O0(t,qw(t,Na))});ki.setAxes=FD;var $i={};function F0(t){return F0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},F0(t)}Object.defineProperty($i,"__esModule",{value:!0}),$i.create=function(){var t=new _s.ARRAY_TYPE(8);return _s.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},$i.clone=function(t){var e=new _s.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},$i.fromValues=function(t,e,r,a,u,d,m,y){var b=new _s.ARRAY_TYPE(8);return b[0]=t,b[1]=e,b[2]=r,b[3]=a,b[4]=u,b[5]=d,b[6]=m,b[7]=y,b},$i.fromRotationTranslationValues=function(t,e,r,a,u,d,m){var y=new _s.ARRAY_TYPE(8);y[0]=t,y[1]=e,y[2]=r,y[3]=a;var b=.5*u,T=.5*d,E=.5*m;return y[4]=b*a+T*r-E*e,y[5]=T*a+E*t-b*r,y[6]=E*a+b*e-T*t,y[7]=-b*t-T*e-E*r,y},$i.fromRotationTranslation=tT,$i.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},$i.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},$i.fromMat4=function(t,e){var r=ic.create();$w.getRotation(r,e);var a=new _s.ARRAY_TYPE(3);return $w.getTranslation(a,e),tT(t,r,a),t},$i.copy=iT,$i.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},$i.set=function(t,e,r,a,u,d,m,y,b){return t[0]=e,t[1]=r,t[2]=a,t[3]=u,t[4]=d,t[5]=m,t[6]=y,t[7]=b,t},$i.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},$i.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},$i.getTranslation=function(t,e){var r=e[4],a=e[5],u=e[6],d=e[7],m=-e[0],y=-e[1],b=-e[2],T=e[3];return t[0]=2*(r*T+d*m+a*b-u*y),t[1]=2*(a*T+d*y+u*m-r*b),t[2]=2*(u*T+d*b+r*y-a*m),t},$i.translate=function(t,e,r){var a=e[0],u=e[1],d=e[2],m=e[3],y=.5*r[0],b=.5*r[1],T=.5*r[2],E=e[4],I=e[5],k=e[6],O=e[7];return t[0]=a,t[1]=u,t[2]=d,t[3]=m,t[4]=m*y+u*T-d*b+E,t[5]=m*b+d*y-a*T+I,t[6]=m*T+a*b-u*y+k,t[7]=-a*y-u*b-d*T+O,t},$i.rotateX=function(t,e,r){var a=-e[0],u=-e[1],d=-e[2],m=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=y*m+E*a+b*d-T*u,k=b*m+E*u+T*a-y*d,O=T*m+E*d+y*u-b*a,z=E*m-y*a-b*u-T*d;return ic.rotateX(t,e,r),t[4]=I*(m=t[3])+z*(a=t[0])+k*(d=t[2])-O*(u=t[1]),t[5]=k*m+z*u+O*a-I*d,t[6]=O*m+z*d+I*u-k*a,t[7]=z*m-I*a-k*u-O*d,t},$i.rotateY=function(t,e,r){var a=-e[0],u=-e[1],d=-e[2],m=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=y*m+E*a+b*d-T*u,k=b*m+E*u+T*a-y*d,O=T*m+E*d+y*u-b*a,z=E*m-y*a-b*u-T*d;return ic.rotateY(t,e,r),t[4]=I*(m=t[3])+z*(a=t[0])+k*(d=t[2])-O*(u=t[1]),t[5]=k*m+z*u+O*a-I*d,t[6]=O*m+z*d+I*u-k*a,t[7]=z*m-I*a-k*u-O*d,t},$i.rotateZ=function(t,e,r){var a=-e[0],u=-e[1],d=-e[2],m=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=y*m+E*a+b*d-T*u,k=b*m+E*u+T*a-y*d,O=T*m+E*d+y*u-b*a,z=E*m-y*a-b*u-T*d;return ic.rotateZ(t,e,r),t[4]=I*(m=t[3])+z*(a=t[0])+k*(d=t[2])-O*(u=t[1]),t[5]=k*m+z*u+O*a-I*d,t[6]=O*m+z*d+I*u-k*a,t[7]=z*m-I*a-k*u-O*d,t},$i.rotateByQuatAppend=function(t,e,r){var a=r[0],u=r[1],d=r[2],m=r[3],y=e[0],b=e[1],T=e[2],E=e[3];return t[0]=y*m+E*a+b*d-T*u,t[1]=b*m+E*u+T*a-y*d,t[2]=T*m+E*d+y*u-b*a,t[3]=E*m-y*a-b*u-T*d,t[4]=(y=e[4])*m+(E=e[7])*a+(b=e[5])*d-(T=e[6])*u,t[5]=b*m+E*u+T*a-y*d,t[6]=T*m+E*d+y*u-b*a,t[7]=E*m-y*a-b*u-T*d,t},$i.rotateByQuatPrepend=function(t,e,r){var a=e[0],u=e[1],d=e[2],m=e[3],y=r[0],b=r[1],T=r[2],E=r[3];return t[0]=a*E+m*y+u*T-d*b,t[1]=u*E+m*b+d*y-a*T,t[2]=d*E+m*T+a*b-u*y,t[3]=m*E-a*y-u*b-d*T,t[4]=a*(E=r[7])+m*(y=r[4])+u*(T=r[6])-d*(b=r[5]),t[5]=u*E+m*b+d*y-a*T,t[6]=d*E+m*T+a*b-u*y,t[7]=m*E-a*y-u*b-d*T,t},$i.rotateAroundAxis=function(t,e,r,a){if(Math.abs(a)<_s.EPSILON)return iT(t,e);var u=Math.hypot(r[0],r[1],r[2]);a*=.5;var d=Math.sin(a),m=d*r[0]/u,y=d*r[1]/u,b=d*r[2]/u,T=Math.cos(a),E=e[0],I=e[1],k=e[2],O=e[3];t[0]=E*T+O*m+I*b-k*y,t[1]=I*T+O*y+k*m-E*b,t[2]=k*T+O*b+E*y-I*m,t[3]=O*T-E*m-I*y-k*b;var z=e[4],N=e[5],j=e[6],q=e[7];return t[4]=z*T+q*m+N*b-j*y,t[5]=N*T+q*y+j*m-z*b,t[6]=j*T+q*b+z*y-N*m,t[7]=q*T-z*m-N*y-j*b,t},$i.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t},$i.multiply=nT,$i.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t},$i.lerp=function(t,e,r,a){var u=1-a;return rT(e,r)<0&&(a=-a),t[0]=e[0]*u+r[0]*a,t[1]=e[1]*u+r[1]*a,t[2]=e[2]*u+r[2]*a,t[3]=e[3]*u+r[3]*a,t[4]=e[4]*u+r[4]*a,t[5]=e[5]*u+r[5]*a,t[6]=e[6]*u+r[6]*a,t[7]=e[7]*u+r[7]*a,t},$i.invert=function(t,e){var r=rg(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t},$i.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},$i.normalize=function(t,e){var r=rg(e);if(r>0){r=Math.sqrt(r);var a=e[0]/r,u=e[1]/r,d=e[2]/r,m=e[3]/r,y=e[4],b=e[5],T=e[6],E=e[7],I=a*y+u*b+d*T+m*E;t[0]=a,t[1]=u,t[2]=d,t[3]=m,t[4]=(y-a*I)/r,t[5]=(b-u*I)/r,t[6]=(T-d*I)/r,t[7]=(E-m*I)/r}return t},$i.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},$i.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},$i.equals=function(t,e){var r=t[0],a=t[1],u=t[2],d=t[3],m=t[4],y=t[5],b=t[6],T=t[7],E=e[0],I=e[1],k=e[2],O=e[3],z=e[4],N=e[5],j=e[6],q=e[7];return Math.abs(r-E)<=_s.EPSILON*Math.max(1,Math.abs(r),Math.abs(E))&&Math.abs(a-I)<=_s.EPSILON*Math.max(1,Math.abs(a),Math.abs(I))&&Math.abs(u-k)<=_s.EPSILON*Math.max(1,Math.abs(u),Math.abs(k))&&Math.abs(d-O)<=_s.EPSILON*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(m-z)<=_s.EPSILON*Math.max(1,Math.abs(m),Math.abs(z))&&Math.abs(y-N)<=_s.EPSILON*Math.max(1,Math.abs(y),Math.abs(N))&&Math.abs(b-j)<=_s.EPSILON*Math.max(1,Math.abs(b),Math.abs(j))&&Math.abs(T-q)<=_s.EPSILON*Math.max(1,Math.abs(T),Math.abs(q))},$i.sqrLen=$i.squaredLength=$i.len=$i.length=$i.dot=$i.mul=$i.setReal=$i.getReal=void 0;var _s=B0($r),ic=B0(ki),$w=B0(Ni);function eT(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(eT=function(a){return a?r:e})(t)}function B0(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||F0(t)!=="object"&&typeof t!="function")return{default:t};var r=eT(e);if(r&&r.has(t))return r.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var m=u?Object.getOwnPropertyDescriptor(t,d):null;m&&(m.get||m.set)?Object.defineProperty(a,d,m):a[d]=t[d]}return a.default=t,r&&r.set(t,a),a}function tT(t,e,r){var a=.5*r[0],u=.5*r[1],d=.5*r[2],m=e[0],y=e[1],b=e[2],T=e[3];return t[0]=m,t[1]=y,t[2]=b,t[3]=T,t[4]=a*T+u*b-d*y,t[5]=u*T+d*m-a*b,t[6]=d*T+a*y-u*m,t[7]=-a*m-u*y-d*b,t}function iT(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function nT(t,e,r){var a=e[0],u=e[1],d=e[2],m=e[3],y=r[4],b=r[5],T=r[6],E=r[7],I=e[4],k=e[5],O=e[6],z=e[7],N=r[0],j=r[1],q=r[2],ie=r[3];return t[0]=a*ie+m*N+u*q-d*j,t[1]=u*ie+m*j+d*N-a*q,t[2]=d*ie+m*q+a*j-u*N,t[3]=m*ie-a*N-u*j-d*q,t[4]=a*E+m*y+u*T-d*b+I*ie+z*N+k*q-O*j,t[5]=u*E+m*b+d*y-a*T+k*ie+z*j+O*N-I*q,t[6]=d*E+m*T+a*b-u*y+O*ie+z*q+I*j-k*N,t[7]=m*E-a*y-u*b-d*T+z*ie-I*N-k*j-O*q,t}$i.getReal=ic.copy,$i.setReal=ic.copy,$i.mul=nT;var rT=ic.dot;$i.dot=rT;var oT=ic.length;$i.length=oT,$i.len=oT;var rg=ic.squaredLength;$i.squaredLength=rg,$i.sqrLen=rg;var qi={};function N0(t){return N0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N0(t)}Object.defineProperty(qi,"__esModule",{value:!0}),qi.create=aT,qi.clone=function(t){var e=new eh.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},qi.fromValues=function(t,e){var r=new eh.ARRAY_TYPE(2);return r[0]=t,r[1]=e,r},qi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},qi.set=function(t,e,r){return t[0]=e,t[1]=r,t},qi.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},qi.subtract=lT,qi.multiply=cT,qi.divide=uT,qi.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},qi.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},qi.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},qi.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},qi.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},qi.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},qi.scaleAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t},qi.distance=hT,qi.squaredDistance=fT,qi.length=dT,qi.squaredLength=pT,qi.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},qi.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},qi.normalize=function(t,e){var r=e[0],a=e[1],u=r*r+a*a;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t},qi.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},qi.cross=function(t,e,r){var a=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=a,t},qi.lerp=function(t,e,r,a){var u=e[0],d=e[1];return t[0]=u+a*(r[0]-u),t[1]=d+a*(r[1]-d),t},qi.random=function(t,e){e=e||1;var r=2*eh.RANDOM()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},qi.transformMat2=function(t,e,r){var a=e[0],u=e[1];return t[0]=r[0]*a+r[2]*u,t[1]=r[1]*a+r[3]*u,t},qi.transformMat2d=function(t,e,r){var a=e[0],u=e[1];return t[0]=r[0]*a+r[2]*u+r[4],t[1]=r[1]*a+r[3]*u+r[5],t},qi.transformMat3=function(t,e,r){var a=e[0],u=e[1];return t[0]=r[0]*a+r[3]*u+r[6],t[1]=r[1]*a+r[4]*u+r[7],t},qi.transformMat4=function(t,e,r){var a=e[0],u=e[1];return t[0]=r[0]*a+r[4]*u+r[12],t[1]=r[1]*a+r[5]*u+r[13],t},qi.rotate=function(t,e,r,a){var u=e[0]-r[0],d=e[1]-r[1],m=Math.sin(a),y=Math.cos(a);return t[0]=u*y-d*m+r[0],t[1]=u*m+d*y+r[1],t},qi.angle=function(t,e){var r=t[0],a=t[1],u=e[0],d=e[1],m=Math.sqrt(r*r+a*a)*Math.sqrt(u*u+d*d);return Math.acos(Math.min(Math.max(m&&(r*u+a*d)/m,-1),1))},qi.zero=function(t){return t[0]=0,t[1]=0,t},qi.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},qi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},qi.equals=function(t,e){var r=t[0],a=t[1],u=e[0],d=e[1];return Math.abs(r-u)<=eh.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(a-d)<=eh.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))},qi.forEach=qi.sqrLen=qi.sqrDist=qi.dist=qi.div=qi.mul=qi.sub=qi.len=void 0;var eh=function(t,e){if(t&&t.__esModule)return t;if(t===null||N0(t)!=="object"&&typeof t!="function")return{default:t};var r=sT(void 0);if(r&&r.has(t))return r.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var m=u?Object.getOwnPropertyDescriptor(t,d):null;m&&(m.get||m.set)?Object.defineProperty(a,d,m):a[d]=t[d]}return a.default=t,r&&r.set(t,a),a}($r);function sT(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(sT=function(a){return a?r:e})(t)}function aT(){var t=new eh.ARRAY_TYPE(2);return eh.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function lT(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function cT(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function uT(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function hT(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function fT(t,e){var r=e[0]-t[0],a=e[1]-t[1];return r*r+a*a}function dT(t){return Math.hypot(t[0],t[1])}function pT(t){var e=t[0],r=t[1];return e*e+r*r}qi.len=dT,qi.sub=lT,qi.mul=cT,qi.div=uT,qi.dist=hT,qi.sqrDist=fT,qi.sqrLen=pT;var BD=function(){var t=aT();return function(e,r,a,u,d,m){var y,b;for(r||(r=2),a||(a=0),b=u?Math.min(u*r+a,e.length):e.length,y=a;y<b;y+=r)t[0]=e[y],t[1]=e[y+1],d(t,t,m),e[y]=t[0],e[y+1]=t[1];return e}}();function V0(t){return V0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V0(t)}qi.forEach=BD,Object.defineProperty(Qr,"__esModule",{value:!0}),s.e=Qr.vec4=s.v=Qr.vec3=Qr.vec2=Qr.quat2=s.q=Qr.quat=s.m=Qr.mat4=s.bx=Qr.mat3=Qr.mat2d=s.h=Qr.mat2=Qr.glMatrix=void 0;var ND=fl($r);Qr.glMatrix=ND;var VD=fl(sr);s.h=Qr.mat2=VD;var UD=fl(ur);Qr.mat2d=UD;var jD=fl(In);s.bx=Qr.mat3=jD;var GD=fl(Ni);s.m=Qr.mat4=GD;var HD=fl(ki);s.q=Qr.quat=HD;var WD=fl($i);Qr.quat2=WD;var qD=fl(qi);Qr.vec2=qD;var ZD=fl(Fi);s.v=Qr.vec3=ZD;var XD=fl(Ji);function mT(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(mT=function(a){return a?r:e})(t)}function fl(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||V0(t)!=="object"&&typeof t!="function")return{default:t};var r=mT(e);if(r&&r.has(t))return r.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var m=u?Object.getOwnPropertyDescriptor(t,d):null;m&&(m.get||m.set)?Object.defineProperty(a,d,m):a[d]=t[d]}return a.default=t,r&&r.set(t,a),a}s.e=Qr.vec4=XD;const YD=li([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:og}=YD,gT=li([{name:"a_pos_3",components:3,type:"Int16"}]);var Rd=li([{name:"a_pos",type:"Int16",components:2}]),_T={};(function(t,e){(function(r){function a(d,m,y){var b=u(256*d,256*(m=Math.pow(2,y)-m-1),y),T=u(256*(d+1),256*(m+1),y);return b[0]+","+b[1]+","+T[0]+","+T[1]}function u(d,m,y){var b=2*Math.PI*6378137/256/Math.pow(2,y);return[d*b-2*Math.PI*6378137/2,m*b-2*Math.PI*6378137/2]}r.getURL=function(d,m,y,b,T,E){return E=E||{},d+"?"+["bbox="+a(y,b,T),"format="+(E.format||"image/png"),"service="+(E.service||"WMS"),"version="+(E.version||"1.1.1"),"request="+(E.request||"GetMap"),"srs="+(E.srs||"EPSG:3857"),"width="+(E.width||256),"height="+(E.height||256),"layers="+m].join("&")},r.getTileBBox=a,r.getMercCoords=u,Object.defineProperty(r,"__esModule",{value:!0})})(e)})(0,_T);var JD=_T;class th{constructor(e,r,a){this.z=e,this.x=r,this.y=a,this.key=zd(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const a=JD.getTileBBox(this.x,this.y,this.z),u=function(d,m,y){let b,T="";for(let E=d;E>0;E--)b=1<<E-1,T+=(m&b?1:0)+(y&b?2:0);return T}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class yT{constructor(e,r){this.wrap=e,this.canonical=r,this.key=zd(e,r.z,r.z,r.x,r.y)}}class lo{constructor(e,r,a,u,d){this.overscaledZ=e,this.wrap=r,this.canonical=new th(a,+u,+d),this.key=r===0&&e===a?this.canonical.key:zd(r,e,a,u,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new lo(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new lo(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return zd(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return zd(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new lo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new lo(r,this.wrap,r,a,u),new lo(r,this.wrap,r,a+1,u),new lo(r,this.wrap,r,a,u+1),new lo(r,this.wrap,r,a+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new lo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new lo(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new yT(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function zd(t,e,r,a,u){const d=1<<Math.min(r,22);let m=d*(u%d)+a%d;return t&&r<22&&(m+=d*d*((t<0?-2*t-1:2*t)%(1<<2*(22-r)))),16*(32*m+r)+(e-r)}const KD=[t=>{let e=t.canonical.x-1,r=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,r--),new lo(t.overscaledZ,r,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,r=t.wrap;return e===1<<t.canonical.z&&(e=0,r++),new lo(t.overscaledZ,r,t.canonical.z,e,t.canonical.y)},t=>new lo(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new lo(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];ei(th,"CanonicalTileID"),ei(lo,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});class U0{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,a){const u=s.v.dot(r,this.dir);if(Math.abs(u)<1e-6)return!1;const d=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/u;return a[0]=this.pos[0]+this.dir[0]*d,a[1]=this.pos[1]+this.dir[1]*d,a[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,r,a){if(s.v.equals(this.pos,e)||r===0)return a[0]=a[1]=a[2]=0,!1;const[u,d,m]=this.dir,y=this.pos[0]-e[0],b=this.pos[1]-e[1],T=this.pos[2]-e[2],E=u*u+d*d+m*m,I=2*(y*u+b*d+T*m),k=I*I-4*E*(y*y+b*b+T*T-r*r);if(k<0){const O=Math.max(-I/2,0),z=y+u*O,N=b+d*O,j=T+m*O,q=Math.hypot(z,N,j);return a[0]=z*r/q,a[1]=N*r/q,a[2]=j*r/q,!1}{const O=(-I-Math.sqrt(k))/(2*E);if(O<0){const z=Math.hypot(y,b,T);return a[0]=y*r/z,a[1]=b*r/z,a[2]=T*r/z,!1}return a[0]=y+u*O,a[1]=b+d*O,a[2]=T+m*O,!0}}}class j0{constructor(e,r,a,u,d){this.TL=e,this.TR=r,this.BR=a,this.BL=u,this.horizon=d}static fromInvProjectionMatrix(e,r,a){const u=[-1,1,1],d=[1,1,1],m=[1,-1,1],y=[-1,-1,1],b=s.v.transformMat4(u,u,e),T=s.v.transformMat4(d,d,e),E=s.v.transformMat4(m,m,e),I=s.v.transformMat4(y,y,e);return new j0(b,T,E,I,r/a)}}function Fd(t,e,r){let a=1/0,u=-1/0;const d=[];for(const m of t){s.v.sub(d,m,e);const y=s.v.dot(d,r);a=Math.min(a,y),u=Math.max(u,y)}return[a,u]}function vT(t,e){let r=!0;for(let a=0;a<t.planes.length;a++){const u=t.planes[a];let d=0;for(let m=0;m<e.length;m++)d+=s.v.dot(u,e[m])+u[3]>=0;if(d===0)return 0;d!==e.length&&(r=!1)}return r?2:1}function xT(t,e){for(const r of t.projections){const a=Fd(e,t.points[0],r.axis);if(r.projection[1]<a[0]||r.projection[0]>a[1])return 0}return 1}function bT(t,e){let r=0;const a=[0,0,0,0];for(let u=0;u<t.length;u++)a[0]=t[u][0],a[1]=t[u][1],a[2]=t[u][2],a[3]=1,s.e.dot(a,e)>=0&&r++;return r}class G0{constructor(e,r){this.points=e||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=Ir.fromPoints(this.points),this.projections=[],this.frustumEdges=[s.v.sub([],this.points[2],this.points[3]),s.v.sub([],this.points[0],this.points[3]),s.v.sub([],this.points[4],this.points[0]),s.v.sub([],this.points[5],this.points[1]),s.v.sub([],this.points[6],this.points[2]),s.v.sub([],this.points[7],this.points[3])];for(const a of this.frustumEdges){const u=[0,-a[2],a[1]],d=[a[2],0,-a[0]];this.projections.push({axis:u,projection:Fd(this.points,this.points[0],u)}),this.projections.push({axis:d,projection:Fd(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(e,r,a,u){const d=Math.pow(2,a),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const E=s.e.transformMat4([],T,e),I=1/E[3]/r*d;return s.e.mul(E,E,[I,I,u?1/E[3]:I,I])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const E=s.v.sub([],m[T[0]],m[T[1]]),I=s.v.sub([],m[T[2]],m[T[1]]),k=s.v.normalize([],s.v.cross([],E,I)),O=-s.v.dot(k,m[T[1]]);return k.concat(O)}),b=[];for(let T=0;T<m.length;T++)b.push([m[T][0],m[T][1],m[T][2]]);return new G0(b,y)}intersectsPrecise(e,r,a){for(let u=0;u<r.length;u++)if(!bT(e,r[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!bT(e,this.planes[u]))return 0;for(const u of a)for(const d of this.frustumEdges){const m=s.v.cross([],u,d),y=s.v.length(m);if(y===0)continue;s.v.scale(m,m,1/y);const b=Fd(this.points,this.points[0],m),T=Fd(e,this.points[0],m);if(b[0]>T[1]||T[0]>b[1])return 0}return 1}}class Ir{static fromPoints(e){const r=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const u of e)s.v.min(r,r,u),s.v.max(a,a,u);return new Ir(r,a)}static fromTileIdAndHeight(e,r,a){const u=1<<e.canonical.z,d=e.canonical.x,m=e.canonical.y;return new Ir([d/u,m/u,r],[(d+1)/u,(m+1)/u,a])}static applyTransform(e,r){const a=e.getCorners();for(let u=0;u<a.length;++u)s.v.transformMat4(a[u],a[u],r);return Ir.fromPoints(a)}static projectAabbCorners(e,r){const a=e.getCorners();for(let u=0;u<a.length;++u)s.v.transformMat4(a[u],a[u],r);return a}constructor(e,r){this.min=e,this.max=r,this.center=s.v.scale([],s.v.add([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],a=s.v.clone(this.min),u=s.v.clone(this.max);for(let d=0;d<r.length;d++)a[d]=r[d]?this.min[d]:this.center[d],u[d]=r[d]?this.center[d]:this.max[d];return u[2]=this.max[2],new Ir(a,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?vT(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?vT(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,r){return r||this.intersects(e)?xT(e,this.getCorners()):0}intersectsPreciseFlat(e,r){return r||this.intersectsFlat(e)?xT(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let r=0;r<3;++r)if(this.min[r]>e.max[r]||e.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e.min[r]),this.max[r]=Math.max(this.max[r],e.max[r])}encapsulatePoint(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e[r]),this.max[r]=Math.max(this.max[r],e[r])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}ei(Ir,"Aabb");const H0=5,wT=6,Ys=Mt/Math.PI/2,QD=16383,nf=64,W0=[nf,32,16],ha=-Ys,fa=Ys,$D=[new Ir([ha,ha,ha],[fa,fa,fa]),new Ir([ha,ha,ha],[0,0,fa]),new Ir([0,ha,ha],[fa,0,fa]),new Ir([ha,0,ha],[0,fa,fa]),new Ir([0,0,ha],[fa,fa,fa])];function sg(t){return t*Ys/Vd}function TT(t,e,r,a=!0){const u=s.v.scale([],t._camera.position,t.worldSize),d=[e,r,1,1];s.e.transformMat4(d,d,t.pixelMatrixInverse),s.e.scale(d,d,1/d[3]);const m=s.v.sub([],d,u),y=s.v.normalize([],m),b=t.globeMatrix,T=[b[12],b[13],b[14]],E=s.v.sub([],T,u),I=s.v.length(E),k=s.v.normalize([],E),O=t.worldSize/(2*Math.PI),z=s.v.dot(k,y),N=Math.asin(O/I);if(N<Math.acos(z)){if(!a)return null;const Fe=[],et=[];s.v.scale(Fe,y,I/z),s.v.normalize(et,s.v.sub(et,Fe,E)),s.v.normalize(y,s.v.add(y,E,s.v.scale(y,et,Math.tan(N)*I)))}const j=[];new U0(u,y).closestPointOnSphere(T,O,j);const q=s.v.normalize([],Wt(b,0)),ie=s.v.normalize([],Wt(b,1)),oe=s.v.normalize([],Wt(b,2)),ae=s.v.dot(q,j),he=s.v.dot(ie,j),me=s.v.dot(oe,j),Te=Tt(Math.asin(-he/O));let Pe=Tt(Math.atan2(ae,me));Pe=t.center.lng+function(Fe,et){const bt=(et-Fe+180)%360-180;return bt<-180?bt+360:bt}(t.center.lng,Pe);const Re=pl(Pe),Ge=wt(ml(Te),0,1);return new To(Re,Ge)}class eL{constructor(e,r,a){this.a=s.v.sub([],e,a),this.b=s.v.sub([],r,a),this.center=a;const u=s.v.normalize([],this.a),d=s.v.normalize([],this.b);this.angle=Math.acos(s.v.dot(u,d))}}function q0(t,e){if(t.angle===0)return null;let r;return r=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),r<0||r>1?null:function(a,u,d,m){const y=Math.sin(d);return a*(Math.sin((1-m)*d)/y)+u*(Math.sin(m*d)/y)}(t.a[e],t.b[e],t.angle,wt(r,0,1))+t.center[e]}function dl(t){if(t.z<=1)return $D[t.z+2*t.y+t.x];const e=Z0(ag(t));return Ir.fromPoints(e)}function nc(t,e,r){return s.v.scale(t,t,1-r),s.v.scaleAndAdd(t,t,e,r)}function ST(t,e){const r=rc(e.zoom);if(r===0)return dl(t);const a=ag(t),u=Z0(a),d=pl(a.getWest())*e.worldSize,m=pl(a.getEast())*e.worldSize,y=ml(a.getNorth())*e.worldSize,b=ml(a.getSouth())*e.worldSize,T=[d,y,0],E=[m,y,0],I=[d,b,0],k=[m,b,0],O=s.m.invert([],e.globeMatrix);return s.v.transformMat4(T,T,O),s.v.transformMat4(E,E,O),s.v.transformMat4(I,I,O),s.v.transformMat4(k,k,O),u[0]=nc(u[0],I,r),u[1]=nc(u[1],k,r),u[2]=nc(u[2],E,r),u[3]=nc(u[3],T,r),Ir.fromPoints(u)}function MT(t,e,r){for(const a of t)s.v.transformMat4(a,a,e),s.v.scale(a,a,r)}function ET(t,e,r,a){const u=e/t.worldSize,d=t.globeMatrix;if(r.z<=1){const Re=dl(r).getCorners();return MT(Re,d,u),Ir.fromPoints(Re)}const m=ag(r,a),y=Z0(m);MT(y,d,u);const b=Number.MAX_VALUE,T=[-b,-b,-b],E=[b,b,b];if(m.contains(t.center)){for(const Fe of y)s.v.min(E,E,Fe),s.v.max(T,T,Fe);T[2]=0;const Re=t.point,Ge=[Re.x*u,Re.y*u,0];return s.v.min(E,E,Ge),s.v.max(T,T,Ge),new Ir(E,T)}const I=[d[12]*u,d[13]*u,d[14]*u],k=m.getCenter(),O=wt(t.center.lat,-br,br),z=wt(k.lat,-br,br),N=pl(t.center.lng),j=ml(O);let q=N-pl(k.lng);const ie=j-ml(z);q>.5?q-=1:q<-.5&&(q+=1);let oe=0;if(Math.abs(q)>Math.abs(ie))oe=q>=0?1:3;else{oe=ie>=0?0:2;const Re=[d[4]*u,d[5]*u,d[6]*u],Ge=-Math.sin(Xe(ie>=0?m.getSouth():m.getNorth()))*Ys;s.v.scaleAndAdd(I,I,Re,Ge)}const ae=y[oe],he=y[(oe+1)%4],me=new eL(ae,he,I),Te=[q0(me,0)||ae[0],q0(me,1)||ae[1],q0(me,2)||ae[2]],Pe=rc(t.zoom);if(Pe>0){const Re=function({x:Fe,y:et,z:bt},Je,gt,Ye,Vt){const $t=1/(1<<bt);let vt=Fe*$t,vi=vt+$t,ii=et*$t,Ot=ii+$t,xi=0;const ci=(vt+vi)/2-Ye;return ci>.5?xi=-1:ci<-.5&&(xi=1),vt=((vt+xi)*Je-(Ye*=Je))*gt+Ye,vi=((vi+xi)*Je-Ye)*gt+Ye,ii=(ii*Je-(Vt*=Je))*gt+Vt,Ot=(Ot*Je-Vt)*gt+Vt,[[vt,Ot,0],[vi,Ot,0],[vi,ii,0],[vt,ii,0]]}(r,e,t._pixelsPerMercatorPixel,N,j);for(let Fe=0;Fe<y.length;Fe++)nc(y[Fe],Re[Fe],Pe);const Ge=s.v.add([],Re[oe],Re[(oe+1)%4]);s.v.scale(Ge,Ge,.5),nc(Te,Ge,Pe)}for(const Re of y)s.v.min(E,E,Re),s.v.max(T,T,Re);return E[2]=Math.min(ae[2],he[2]),s.v.min(E,E,Te),s.v.max(T,T,Te),new Ir(E,T)}function ag({x:t,y:e,z:r},a=!1){const u=1/(1<<r),d=new vn(Cs(t*u),e===(1<<r)-1&&a?-90:ho((e+1)*u)),m=new vn(Cs((t+1)*u),e===0&&a?90:ho(e*u));return new jc(d,m)}function Z0(t){const e=Xe(t.getNorth()),r=Xe(t.getSouth()),a=Math.cos(e),u=Math.cos(r),d=Math.sin(e),m=Math.sin(r),y=t.getWest(),b=t.getEast();return[rf(u,m,y),rf(u,m,b),rf(a,d,b),rf(a,d,y)]}function rf(t,e,r,a=Ys){return r=Xe(r),[t*Math.sin(r)*a,-e*a,t*Math.cos(r)*a]}function ih(t,e,r){return rf(Math.cos(Xe(t)),Math.sin(Xe(t)),e,r)}function Bd(t,e,r,a){const u=1<<r.z,d=(t/Mt+r.x)/u;return ih(ho((e/Mt+r.y)/u),Cs(d),a)}function lg({min:t,max:e}){return QD/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const AT=new Float64Array(16);function Nd(t){const e=lg(t),r=s.m.fromScaling(AT,[e,e,e]);return s.m.translate(r,r,s.v.negate([],t.min))}function X0(t){const e=s.m.fromTranslation(AT,t.min),r=1/lg(t);return s.m.scale(e,e,[r,r,r])}function Y0(t){const e=Mt/(2*Math.PI);return t/(2*Math.PI)/e}function IT(t,e){return Mt/(512*Math.pow(2,t))*lg(dl(e))}function CT(t,e,r,a,u){const d=Y0(r),m=[t,e,-r/(2*Math.PI)],y=s.m.identity(new Float64Array(16));return s.m.translate(y,y,m),s.m.scale(y,y,[d,d,d]),s.m.rotateX(y,y,Xe(-u)),s.m.rotateY(y,y,Xe(-a)),y}function rc(t){return Ii(H0,wT,t)}function PT(t,e){const r=ih(e.lat,e.lng),a=function(d){const m=ih(d._center.lat,d._center.lng),y=s.v.fromValues(0,1,0);let b=s.v.cross([],y,m);const T=s.m.fromRotation([],-d.angle,m);b=s.v.transformMat4(b,b,T),s.m.fromRotation(T,-d._pitch,b);const E=s.v.normalize([],m);return s.v.scale(E,E,sg(d.cameraToCenterDistance/d.pixelsPerMeter)),s.v.transformMat4(E,E,T),s.v.add([],m,E)}(t),u=s.v.subtract([],a,r);return s.v.angle(u,r)}function J0(t,e){return PT(t,e)>Math.PI/2*1.01}const kT=Xe(85),tL=Math.cos(kT),iL=Math.sin(kT),Vd=63710088e-1,K0=2*Math.PI*Vd;class Hc{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Hc(Ui(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,a=this.lat*r,u=e.lat*r,d=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((e.lng-this.lng)*r);return Vd*Math.acos(Math.min(d,1))}toBounds(e=0){const r=360*e/40075017,a=r/Math.cos(Math.PI/180*this.lat);return new jc(new Hc(this.lng-a,this.lat-r),new Hc(this.lng+a,this.lat+r))}toEcef(e){const r=sg(e);return ih(this.lat,this.lng,Ys+r)}static convert(e){if(e instanceof Hc)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Hc(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Hc(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var vn=Hc;const nL=0,rL=25.5;function Q0(t){return K0*Math.cos(t*Math.PI/180)}function pl(t){return(180+t)/360}function ml(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Jo(t,e){return t/Q0(e)}function Cs(t){return 360*t-180}function ho(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function DT(t,e){return t*Q0(ho(e))}const br=85.051129;function LT(t){return Math.cos(Xe(wt(t,-br,br)))}function nh(t,e){const r=wt(e,nL,rL),a=Math.pow(2,r);return LT(t)*K0/(512*a)}function OT(t){return 1/Math.cos(t*Math.PI/180)}function cg(t,e=0){const r=Math.exp(Math.PI*(1-(t.y+e/Mt)/(1<<t.z)*2));return 80150034*r/(r*r+1)/Mt/(1<<t.z)}class To{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){const a=vn.convert(e);return new To(pl(a.lng),ml(a.lat),Jo(r,a.lat))}toLngLat(){return new vn(Cs(this.x),ho(this.y))}toAltitude(){return DT(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/K0*OT(ho(this.y))}}function $0(t,e,r,a,u,d,m,y,b){const T=(e+a)/2,E=(r+u)/2,I=new Ie(T,E);y(I),function(k,O,z,N,j,q){const ie=z-j,oe=N-q;return Math.abs((N-O)*ie-(z-k)*oe)/Math.hypot(ie,oe)}(I.x,I.y,d.x,d.y,m.x,m.y)>=b?($0(t,e,r,T,E,d,I,y,b),$0(t,T,E,a,u,I,m,y,b)):t.push(m)}function RT(t,e,r){let a=t[0],u=a.x,d=a.y;e(a);const m=[a];for(let y=1;y<t.length;y++){const b=t[y],{x:T,y:E}=b;e(b),$0(m,u,d,T,E,a,b,e,r),u=T,d=E,a=b}return m}function ev(t,e,r,a){if(a(e,r)){const u=e.add(r)._mult(.5);ev(t,e,u,a),ev(t,u,r,a)}else t.push(r)}function oL(t,e){let r=t[0];const a=[r];for(let u=1;u<t.length;u++){const d=t[u];ev(a,r,d,e),r=d}return a}const tv=Math.pow(2,14)-1,zT=-tv-1;function sL(t,e){const r=Math.round(t.x*e),a=Math.round(t.y*e);return t.x=wt(r,zT,tv),t.y=wt(a,zT,tv),(r<t.x||r>t.x+1||a<t.y||a>t.y+1)&&si("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function gl(t,e,r){const a=t.loadGeometry(),u=t.extent,d=Mt/u;if(e&&r&&r.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:y,x:b,y:T,projection:E}=r,I=k=>{const O=Cs((e.x+k.x/u)/m),z=ho((e.y+k.y/u)/m),N=E.project(O,z);k.x=(N.x*y-b)*u,k.y=(N.y*y-T)*u};for(let k=0;k<a.length;k++)if(t.type!==1)a[k]=RT(a[k],I,1);else{const O=[];for(const z of a[k])z.x<0||z.x>=u||z.y<0||z.y>=u||(I(z),O.push(z));a[k]=O}}for(const m of a)for(const y of m)sL(y,d);return a}function Wc(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?gl(t):[]}}function ug(t,e,r,a,u){t.emplaceBack(2*e+(a+1)/2,2*r+(u+1)/2)}function hg(t,e,r){t.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class iv{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Li,this.indexArray=new An,this.segments=new or,this.programConfigurations=new Uc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a,u){const d=this.layers[0],m=[];let y=null;d.type==="circle"&&(y=d.layout.get("circle-sort-key"));for(const{feature:T,id:E,index:I,sourceLayerIndex:k}of e){const O=this.layers[0]._featureFilter.needGeometry,z=Wc(T,O);if(!this.layers[0]._featureFilter.filter(new be(this.zoom),z,a))continue;const N=y?y.evaluate(z,{},a):void 0,j={id:E,properties:T.properties,type:T.type,sourceLayerIndex:k,index:I,geometry:O?z.geometry:gl(T,a,u),patterns:{},sortKey:N};m.push(j)}y&&m.sort((T,E)=>T.sortKey-E.sortKey);let b=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new Jn,b=u.projection);for(const T of m){const{geometry:E,index:I,sourceLayerIndex:k}=T,O=e[I].feature;this.addFeature(T,E,I,r.availableImages,a,b,r.brightness),r.featureIndex.insert(O,E,I,k,this.index)}}update(e,r,a,u,d){const m=Object.keys(e).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,m?this.stateDependentLayers:this.layers,a,u,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_D.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,yD.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,a,u,d,m,y){for(const b of r)for(const T of b){const E=T.x,I=T.y;if(E<0||E>=Mt||I<0||I>=Mt)continue;if(m){const z=m.projectTilePoint(E,I,d),N=m.upVector(d,E,I),j=this.globeExtVertexArray;hg(j,z,N),hg(j,z,N),hg(j,z,N),hg(j,z,N)}const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),O=k.vertexLength;ug(this.layoutVertexArray,E,I,-1,-1),ug(this.layoutVertexArray,E,I,1,-1),ug(this.layoutVertexArray,E,I,1,1),ug(this.layoutVertexArray,E,I,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+2,O+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},u,d,y)}}function FT(t,e){for(let r=0;r<t.length;r++)if(rh(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(rh(t,e[r]))return!0;return!!nv(t,e)}function aL(t,e,r){return!!rh(t,e)||!!rv(e,t,r)}function BT(t,e){if(t.length===1)return VT(e,t[0]);for(let r=0;r<e.length;r++){const a=e[r];for(let u=0;u<a.length;u++)if(rh(t,a[u]))return!0}for(let r=0;r<t.length;r++)if(VT(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(nv(t,e[r]))return!0;return!1}function lL(t,e,r){if(t.length>1){if(nv(t,e))return!0;for(let a=0;a<e.length;a++)if(rv(e[a],t,r))return!0}for(let a=0;a<t.length;a++)if(rv(t[a],e,r))return!0;return!1}function nv(t,e){if(t.length===0||e.length===0)return!1;for(let r=0;r<t.length-1;r++){const a=t[r],u=t[r+1];for(let d=0;d<e.length-1;d++)if(cL(a,u,e[d],e[d+1]))return!0}return!1}function cL(t,e,r,a){return je(t,r,a)!==je(e,r,a)&&je(t,e,r)!==je(t,e,a)}function rv(t,e,r){const a=r*r;if(e.length===1)return t.distSqr(e[0])<a;for(let u=1;u<e.length;u++)if(NT(t,e[u-1],e[u])<a)return!0;return!1}function NT(t,e,r){const a=e.distSqr(r);if(a===0)return t.distSqr(e);const u=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/a;return t.distSqr(u<0?e:u>1?r:r.sub(e)._mult(u)._add(e))}function VT(t,e){let r,a,u,d=!1;for(let m=0;m<t.length;m++){r=t[m];for(let y=0,b=r.length-1;y<r.length;b=y++)a=r[y],u=r[b],a.y>e.y!=u.y>e.y&&e.x<(u.x-a.x)*(e.y-a.y)/(u.y-a.y)+a.x&&(d=!d)}return d}function rh(t,e){let r=!1;for(let a=0,u=t.length-1;a<t.length;u=a++){const d=t[a],m=t[u];d.y>e.y!=m.y>e.y&&e.x<(m.x-d.x)*(e.y-d.y)/(m.y-d.y)+d.x&&(r=!r)}return r}function UT(t,e,r,a,u){for(const m of t)if(e<=m.x&&r<=m.y&&a>=m.x&&u>=m.y)return!0;const d=[new Ie(e,r),new Ie(e,u),new Ie(a,u),new Ie(a,r)];if(t.length>2){for(const m of d)if(rh(t,m))return!0}for(let m=0;m<t.length-1;m++)if(uL(t[m],t[m+1],d))return!0;return!1}function uL(t,e,r){const a=r[0],u=r[2];if(t.x<a.x&&e.x<a.x||t.x>u.x&&e.x>u.x||t.y<a.y&&e.y<a.y||t.y>u.y&&e.y>u.y)return!1;const d=je(t,e,r[0]);return d!==je(t,e,r[1])||d!==je(t,e,r[2])||d!==je(t,e,r[3])}function of(t,e,r,a,u,d){let m=e.y-t.y,y=t.x-e.x;if(d=d||0){const b=m*m+y*y;if(b===0)return!0;const T=Math.sqrt(b);m/=T,y/=T}return!((r.x-t.x)*m+(r.y-t.y)*y-d<0||(a.x-t.x)*m+(a.y-t.y)*y-d<0||(u.x-t.x)*m+(u.y-t.y)*y-d<0)}function ov(t,e,r,a,u,d,m){return!(of(t,e,a,u,d,m)||of(e,r,a,u,d,m)||of(r,t,a,u,d,m)||of(a,u,t,e,r,m)||of(u,d,t,e,r,m)||of(d,a,t,e,r,m))}function sf(t,e,r){const a=e.paint.get(t).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(t)}function fg(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function jT(t,e,r,a,u){if(!e[0]&&!e[1])return t;const d=Ie.convert(e)._mult(u);r==="viewport"&&d._rotate(-a);const m=[];for(let y=0;y<t.length;y++)m.push(t[y].sub(d));return m}function GT(t,e,r,a){const u=Ie.convert(t)._mult(a);return e==="viewport"&&u._rotate(-r),u}ei(iv,"CircleBucket",{omit:["layers"]});const hL=new ut({"circle-sort-key":new ze(Be.layout_circle["circle-sort-key"]),visibility:new de(Be.layout_circle.visibility)});var fL={paint:new ut({"circle-radius":new ze(Be.paint_circle["circle-radius"]),"circle-color":new ze(Be.paint_circle["circle-color"]),"circle-blur":new ze(Be.paint_circle["circle-blur"]),"circle-opacity":new ze(Be.paint_circle["circle-opacity"]),"circle-translate":new de(Be.paint_circle["circle-translate"]),"circle-translate-anchor":new de(Be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new de(Be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new de(Be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ze(Be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ze(Be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ze(Be.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new de(Be.paint_circle["circle-emissive-strength"])}),layout:hL};const dL=s.m.create(),HT=t=>{const e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function WT(t,e,r,a,u,d,m,y,b){if(d&&t.queryGeometry.isAboveHorizon)return!1;d&&(b*=t.pixelToTileUnitsFactor);const T=t.tileID.canonical,E=r.projection.upVectorScale(T,r.center.lat,r.worldSize).metersToTile;for(const I of e)for(const k of I){const O=k.add(y),z=u&&r.elevation?r.elevation.exaggeration()*u.getElevationAt(O.x,O.y,!0):0,N=r.projection.projectTilePoint(O.x,O.y,T);if(z>0){const oe=r.projection.upVector(T,O.x,O.y);N.x+=oe[0]*E*z,N.y+=oe[1]*E*z,N.z+=oe[2]*E*z}const j=d?O:pL(N.x,N.y,N.z,a),q=d?t.tilespaceRays.map(oe=>gL(oe,z)):t.queryGeometry.screenGeometry,ie=s.e.transformMat4([],[N.x,N.y,N.z,1],a);if(!m&&d?b*=ie[3]/r.cameraToCenterDistance:m&&!d&&(b*=r.cameraToCenterDistance/ie[3]),d){const oe=ho((k.y/Mt+T.y)/(1<<T.z));b/=r.projection.pixelsPerMeter(oe,1)/Jo(1,oe)}if(aL(q,j,b))return!0}return!1}function pL(t,e,r,a){const u=s.e.transformMat4([],[t,e,r,1],a);return new Ie(u[0]/u[3],u[1]/u[3])}const qT=s.v.fromValues(0,0,0),mL=s.v.fromValues(0,0,1);function gL(t,e){const r=s.v.create();return qT[2]=e,t.intersectsPlane(qT,mL,r),new Ie(r[0],r[1])}class ZT extends iv{}function XT(t,{width:e,height:r},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*r*a)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*r*a);return t.width=e,t.height=r,t.data=u,t}function YT(t,e,r){const{width:a,height:u}=e;a===t.width&&u===t.height||(sv(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,a),height:Math.min(t.height,u)},r),t.width=a,t.height=u,t.data=e.data)}function sv(t,e,r,a,u,d,m){if(u.width===0||u.height===0)return e;if(u.width>t.width||u.height>t.height||r.x>t.width-u.width||r.y>t.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||a.x>e.width-u.width||a.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const y=t.data,b=e.data,T=d===4&&m;for(let E=0;E<u.height;E++){const I=((r.y+E)*t.width+r.x)*d,k=((a.y+E)*e.width+a.x)*d;if(T)for(let O=0;O<u.width;O++){const z=I+O*d+3,N=k+O*d;b[N+0]=255,b[N+1]=255,b[N+2]=255,b[N+3]=y[z]}else for(let O=0;O<u.width*d;O++)b[k+O]=y[I+O]}return e}ei(ZT,"HeatmapBucket",{omit:["layers"]});class oc{constructor(e,r){XT(this,e,1,r)}resize(e){YT(this,new oc(e),1)}clone(){return new oc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,u,d){sv(e,r,a,u,d,1)}}class Js{constructor(e,r){XT(this,e,4,r)}resize(e){YT(this,new Js(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Js({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,u,d,m){sv(e,r,a,u,d,4,m)}}class JT{constructor(e,r){this.width=e.width,this.height=e.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}ei(oc,"AlphaImage"),ei(Js,"RGBAImage");const _L=new ut({visibility:new de(Be.layout_heatmap.visibility)});var yL={paint:new ut({"heatmap-radius":new ze(Be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ze(Be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new de(Be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _t(Be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new de(Be.paint_heatmap["heatmap-opacity"])}),layout:_L};function dg(t){const e={},r=t.resolution||256,a=t.clips?t.clips.length:1,u=t.image||new Js({width:r,height:a}),d=(m,y,b)=>{e[t.evaluationKey]=b;const T=t.expression.evaluate(e);T&&(u.data[m+y+0]=Math.floor(255*T.r/T.a),u.data[m+y+1]=Math.floor(255*T.g/T.a),u.data[m+y+2]=Math.floor(255*T.b/T.a),u.data[m+y+3]=Math.floor(255*T.a))};if(t.clips)for(let m=0,y=0;m<a;++m,y+=4*r)for(let b=0,T=0;b<r;b++,T+=4){const E=b/(r-1),{start:I,end:k}=t.clips[m];d(y,T,I*(1-E)+k*E)}else for(let m=0,y=0;m<r;m++,y+=4)d(0,y,m/(r-1));return u}const vL=new ut({visibility:new de(Be.layout_hillshade.visibility)});var xL={paint:new ut({"hillshade-illumination-direction":new de(Be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new de(Be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new de(Be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new de(Be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new de(Be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new de(Be.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new de(Be.paint_hillshade["hillshade-emissive-strength"])}),layout:vL};const bL=li([{name:"a_pos",components:2,type:"Int16"}],4),{members:wL}=bL;var av={exports:{}};function pg(t,e,r){r=r||2;var a,u,d,m,y,b,T,E=e&&e.length,I=E?e[0]*r:t.length,k=KT(t,0,I,r,!0),O=[];if(!k||k.next===k.prev)return O;if(E&&(k=function(N,j,q,ie){var oe,ae,he,me=[];for(oe=0,ae=j.length;oe<ae;oe++)(he=KT(N,j[oe]*ie,oe<ae-1?j[oe+1]*ie:N.length,ie,!1))===he.next&&(he.steiner=!0),me.push(PL(he));for(me.sort(AL),oe=0;oe<me.length;oe++)q=IL(me[oe],q);return q}(t,e,k,r)),t.length>80*r){a=d=t[0],u=m=t[1];for(var z=r;z<I;z+=r)(y=t[z])<a&&(a=y),(b=t[z+1])<u&&(u=b),y>d&&(d=y),b>m&&(m=b);T=(T=Math.max(d-a,m-u))!==0?32767/T:0}return Ud(k,O,r,a,u,T,0),O}function KT(t,e,r,a,u){var d,m;if(u===uv(t,e,r,a)>0)for(d=e;d<r;d+=a)m=eS(d,t[d],t[d+1],m);else for(d=r-a;d>=e;d-=a)m=eS(d,t[d],t[d+1],m);return m&&mg(m,m.next)&&(Gd(m),m=m.next),m}function oh(t,e){if(!t)return t;e||(e=t);var r,a=t;do if(r=!1,a.steiner||!mg(a,a.next)&&Vr(a.prev,a,a.next)!==0)a=a.next;else{if(Gd(a),(a=e=a.prev)===a.next)break;r=!0}while(r||a!==e);return e}function Ud(t,e,r,a,u,d,m){if(t){!m&&d&&function(E,I,k,O){var z=E;do z.z===0&&(z.z=lv(z.x,z.y,I,k,O)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==E);z.prevZ.nextZ=null,z.prevZ=null,function(N){var j,q,ie,oe,ae,he,me,Te,Pe=1;do{for(q=N,N=null,ae=null,he=0;q;){for(he++,ie=q,me=0,j=0;j<Pe&&(me++,ie=ie.nextZ);j++);for(Te=Pe;me>0||Te>0&&ie;)me!==0&&(Te===0||!ie||q.z<=ie.z)?(oe=q,q=q.nextZ,me--):(oe=ie,ie=ie.nextZ,Te--),ae?ae.nextZ=oe:N=oe,oe.prevZ=ae,ae=oe;q=ie}ae.nextZ=null,Pe*=2}while(he>1)}(z)}(t,a,u,d);for(var y,b,T=t;t.prev!==t.next;)if(y=t.prev,b=t.next,d?SL(t,a,u,d):TL(t))e.push(y.i/r|0),e.push(t.i/r|0),e.push(b.i/r|0),Gd(t),t=b.next,T=b.next;else if((t=b)===T){m?m===1?Ud(t=ML(oh(t),e,r),e,r,a,u,d,2):m===2&&EL(t,e,r,a,u,d):Ud(oh(t),e,r,a,u,d,1);break}}}function TL(t){var e=t.prev,r=t,a=t.next;if(Vr(e,r,a)>=0)return!1;for(var u=e.x,d=r.x,m=a.x,y=e.y,b=r.y,T=a.y,E=u<d?u<m?u:m:d<m?d:m,I=y<b?y<T?y:T:b<T?b:T,k=u>d?u>m?u:m:d>m?d:m,O=y>b?y>T?y:T:b>T?b:T,z=a.next;z!==e;){if(z.x>=E&&z.x<=k&&z.y>=I&&z.y<=O&&af(u,y,d,b,m,T,z.x,z.y)&&Vr(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function SL(t,e,r,a){var u=t.prev,d=t,m=t.next;if(Vr(u,d,m)>=0)return!1;for(var y=u.x,b=d.x,T=m.x,E=u.y,I=d.y,k=m.y,O=y<b?y<T?y:T:b<T?b:T,z=E<I?E<k?E:k:I<k?I:k,N=y>b?y>T?y:T:b>T?b:T,j=E>I?E>k?E:k:I>k?I:k,q=lv(O,z,e,r,a),ie=lv(N,j,e,r,a),oe=t.prevZ,ae=t.nextZ;oe&&oe.z>=q&&ae&&ae.z<=ie;){if(oe.x>=O&&oe.x<=N&&oe.y>=z&&oe.y<=j&&oe!==u&&oe!==m&&af(y,E,b,I,T,k,oe.x,oe.y)&&Vr(oe.prev,oe,oe.next)>=0||(oe=oe.prevZ,ae.x>=O&&ae.x<=N&&ae.y>=z&&ae.y<=j&&ae!==u&&ae!==m&&af(y,E,b,I,T,k,ae.x,ae.y)&&Vr(ae.prev,ae,ae.next)>=0))return!1;ae=ae.nextZ}for(;oe&&oe.z>=q;){if(oe.x>=O&&oe.x<=N&&oe.y>=z&&oe.y<=j&&oe!==u&&oe!==m&&af(y,E,b,I,T,k,oe.x,oe.y)&&Vr(oe.prev,oe,oe.next)>=0)return!1;oe=oe.prevZ}for(;ae&&ae.z<=ie;){if(ae.x>=O&&ae.x<=N&&ae.y>=z&&ae.y<=j&&ae!==u&&ae!==m&&af(y,E,b,I,T,k,ae.x,ae.y)&&Vr(ae.prev,ae,ae.next)>=0)return!1;ae=ae.nextZ}return!0}function ML(t,e,r){var a=t;do{var u=a.prev,d=a.next.next;!mg(u,d)&&QT(u,a,a.next,d)&&jd(u,d)&&jd(d,u)&&(e.push(u.i/r|0),e.push(a.i/r|0),e.push(d.i/r|0),Gd(a),Gd(a.next),a=t=d),a=a.next}while(a!==t);return oh(a)}function EL(t,e,r,a,u,d){var m=t;do{for(var y=m.next.next;y!==m.prev;){if(m.i!==y.i&&kL(m,y)){var b=$T(m,y);return m=oh(m,m.next),b=oh(b,b.next),Ud(m,e,r,a,u,d,0),void Ud(b,e,r,a,u,d,0)}y=y.next}m=m.next}while(m!==t)}function AL(t,e){return t.x-e.x}function IL(t,e){var r=function(u,d){var m,y=d,b=u.x,T=u.y,E=-1/0;do{if(T<=y.y&&T>=y.next.y&&y.next.y!==y.y){var I=y.x+(T-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(I<=b&&I>E&&(E=I,m=y.x<y.next.x?y:y.next,I===b))return m}y=y.next}while(y!==d);if(!m)return null;var k,O=m,z=m.x,N=m.y,j=1/0;y=m;do b>=y.x&&y.x>=z&&b!==y.x&&af(T<N?b:E,T,z,N,T<N?E:b,T,y.x,y.y)&&(k=Math.abs(T-y.y)/(b-y.x),jd(y,u)&&(k<j||k===j&&(y.x>m.x||y.x===m.x&&CL(m,y)))&&(m=y,j=k)),y=y.next;while(y!==O);return m}(t,e);if(!r)return e;var a=$T(r,t);return oh(a,a.next),oh(r,r.next)}function CL(t,e){return Vr(t.prev,t,e.prev)<0&&Vr(e.next,t,t.next)<0}function lv(t,e,r,a,u){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function PL(t){var e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function af(t,e,r,a,u,d,m,y){return(u-m)*(e-y)>=(t-m)*(d-y)&&(t-m)*(a-y)>=(r-m)*(e-y)&&(r-m)*(d-y)>=(u-m)*(a-y)}function kL(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(r,a){var u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==a.i&&u.next.i!==a.i&&QT(u,u.next,r,a))return!0;u=u.next}while(u!==r);return!1}(t,e)&&(jd(t,e)&&jd(e,t)&&function(r,a){var u=r,d=!1,m=(r.x+a.x)/2,y=(r.y+a.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&m<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(d=!d),u=u.next;while(u!==r);return d}(t,e)&&(Vr(t.prev,t,e.prev)||Vr(t,e.prev,e))||mg(t,e)&&Vr(t.prev,t,t.next)>0&&Vr(e.prev,e,e.next)>0)}function Vr(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function mg(t,e){return t.x===e.x&&t.y===e.y}function QT(t,e,r,a){var u=_g(Vr(t,e,r)),d=_g(Vr(t,e,a)),m=_g(Vr(r,a,t)),y=_g(Vr(r,a,e));return u!==d&&m!==y||!(u!==0||!gg(t,r,e))||!(d!==0||!gg(t,a,e))||!(m!==0||!gg(r,t,a))||!(y!==0||!gg(r,e,a))}function gg(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function _g(t){return t>0?1:t<0?-1:0}function jd(t,e){return Vr(t.prev,t,t.next)<0?Vr(t,e,t.next)>=0&&Vr(t,t.prev,e)>=0:Vr(t,e,t.prev)<0||Vr(t,t.next,e)<0}function $T(t,e){var r=new cv(t.i,t.x,t.y),a=new cv(e.i,e.x,e.y),u=t.next,d=e.prev;return t.next=e,e.prev=t,r.next=u,u.prev=r,a.next=r,r.prev=a,d.next=a,a.prev=d,a}function eS(t,e,r,a){var u=new cv(t,e,r);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function Gd(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function cv(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function uv(t,e,r,a){for(var u=0,d=e,m=r-a;d<r;d+=a)u+=(t[m]-t[d])*(t[d+1]+t[m+1]),m=d;return u}av.exports=pg,av.exports.default=pg,pg.deviation=function(t,e,r,a){var u=e&&e.length,d=Math.abs(uv(t,0,u?e[0]*r:t.length,r));if(u)for(var m=0,y=e.length;m<y;m++)d-=Math.abs(uv(t,e[m]*r,m<y-1?e[m+1]*r:t.length,r));var b=0;for(m=0;m<a.length;m+=3){var T=a[m]*r,E=a[m+1]*r,I=a[m+2]*r;b+=Math.abs((t[T]-t[I])*(t[E+1]-t[T+1])-(t[T]-t[E])*(t[I+1]-t[T+1]))}return d===0&&b===0?0:Math.abs((b-d)/d)},pg.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},a=0,u=0;u<t.length;u++){for(var d=0;d<t[u].length;d++)for(var m=0;m<e;m++)r.vertices.push(t[u][d][m]);u>0&&r.holes.push(a+=t[u-1].length)}return r};var yg=pe(av.exports);function hv(t,e){const r=t.length;if(r<=1)return[t];const a=[];let u,d;for(let m=0;m<r;m++){const y=re(t[m]);y!==0&&(t[m].area=Math.abs(y),d===void 0&&(d=y<0),d===y<0?(u&&a.push(u),u=[t[m]]):u.push(t[m]))}if(u&&a.push(u),e>1)for(let m=0;m<a.length;m++)a[m].length<=e||(Rl(a[m],e,1,a[m].length-1,DL),a[m]=a[m].slice(0,e));return a}function DL(t,e){return e.area-t.area}function fv(t,e,r){const a=r.patternDependencies;let u=!1;for(const d of e){const m=d.paint.get(`${t}-pattern`);m.isConstant()||(u=!0);const y=m.constantOr(null);y&&(u=!0,a[y]=!0)}return u}function dv(t,e,r,a,u){const d=u.patternDependencies;for(const m of e){const y=m.paint.get(`${t}-pattern`).value;if(y.kind!=="constant"){let b=y.evaluate({zoom:a},r,{},u.availableImages);b=b&&b.name?b.name:b,d[b]=!0,r.patterns[m.id]=b}}return r}class vg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Li,this.indexArray=new An,this.indexArray2=new Lo,this.programConfigurations=new Uc(e.layers,e.zoom),this.segments=new or,this.segments2=new or,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}populate(e,r,a,u){this.hasPattern=fv("fill",this.layers,r);const d=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:y,id:b,index:T,sourceLayerIndex:E}of e){const I=this.layers[0]._featureFilter.needGeometry,k=Wc(y,I);if(!this.layers[0]._featureFilter.filter(new be(this.zoom),k,a))continue;const O=d?d.evaluate(k,{},a,r.availableImages):void 0,z={id:b,properties:y.properties,type:y.type,sourceLayerIndex:E,index:T,geometry:I?k.geometry:gl(y,a,u),patterns:{},sortKey:O};m.push(z)}d&&m.sort((y,b)=>y.sortKey-b.sortKey);for(const y of m){const{geometry:b,index:T,sourceLayerIndex:E}=y;if(this.hasPattern){const I=dv("fill",this.layers,y,this.zoom,r);this.patternFeatures.push(I)}else this.addFeature(y,b,T,a,{},r.availableImages,r.brightness);r.featureIndex.insert(e[T].feature,b,T,E,this.index)}}update(e,r,a,u,d){const m=Object.keys(e).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,m?this.stateDependentLayers:this.layers,a,u,d)}addFeatures(e,r,a,u,d,m){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,r,a,u,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wL),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,a,u,d,m=[],y){for(const b of hv(r,500)){let T=0;for(const N of b)T+=N.length;const E=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),I=E.vertexLength,k=[],O=[];for(const N of b){if(N.length===0)continue;N!==b[0]&&O.push(k.length/2);const j=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),q=j.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(q+N.length-1,q),k.push(N[0].x),k.push(N[0].y);for(let ie=1;ie<N.length;ie++)this.layoutVertexArray.emplaceBack(N[ie].x,N[ie].y),this.indexArray2.emplaceBack(q+ie-1,q+ie),k.push(N[ie].x),k.push(N[ie].y);j.vertexLength+=N.length,j.primitiveLength+=N.length}const z=yg(k,O);for(let N=0;N<z.length;N+=3)this.indexArray.emplaceBack(I+z[N],I+z[N+1],I+z[N+2]);E.vertexLength+=T,E.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,m,u,y)}}ei(vg,"FillBucket",{omit:["layers","patternFeatures"]});const LL=new ut({"fill-sort-key":new ze(Be.layout_fill["fill-sort-key"]),visibility:new de(Be.layout_fill.visibility)});var OL={paint:new ut({"fill-antialias":new de(Be.paint_fill["fill-antialias"]),"fill-opacity":new ze(Be.paint_fill["fill-opacity"]),"fill-color":new ze(Be.paint_fill["fill-color"]),"fill-outline-color":new ze(Be.paint_fill["fill-outline-color"]),"fill-translate":new de(Be.paint_fill["fill-translate"]),"fill-translate-anchor":new de(Be.paint_fill["fill-translate-anchor"]),"fill-pattern":new ze(Be.paint_fill["fill-pattern"]),"fill-emissive-strength":new de(Be.paint_fill["fill-emissive-strength"])}),layout:LL};const RL=li([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),zL=li([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),FL=li([{name:"a_centroid_pos",components:2,type:"Uint16"}]),BL=li([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),NL=li([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:VL}=RL;var xg={},UL=pt,tS=lf;function lf(t,e,r,a,u){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=a,this._values=u,t.readFields(jL,this,e)}function jL(t,e,r){t==1?e.id=r.readVarint():t==2?function(a,u){for(var d=a.readVarint()+a.pos;a.pos<d;){var m=u._keys[a.readVarint()],y=u._values[a.readVarint()];u.properties[m]=y}}(r,e):t==3?e.type=r.readVarint():t==4&&(e._geometry=r.pos)}function GL(t){for(var e,r,a=0,u=0,d=t.length,m=d-1;u<d;m=u++)a+=((r=t[m]).x-(e=t[u]).x)*(e.y+r.y);return a}lf.types=["Unknown","Point","LineString","Polygon"],lf.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,a=1,u=0,d=0,m=0,y=[];t.pos<r;){if(u<=0){var b=t.readVarint();a=7&b,u=b>>3}if(u--,a===1||a===2)d+=t.readSVarint(),m+=t.readSVarint(),a===1&&(e&&y.push(e),e=[]),e.push(new UL(d,m));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&y.push(e),y},lf.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,a=0,u=0,d=0,m=1/0,y=-1/0,b=1/0,T=-1/0;t.pos<e;){if(a<=0){var E=t.readVarint();r=7&E,a=E>>3}if(a--,r===1||r===2)(u+=t.readSVarint())<m&&(m=u),u>y&&(y=u),(d+=t.readSVarint())<b&&(b=d),d>T&&(T=d);else if(r!==7)throw new Error("unknown command "+r)}return[m,b,y,T]},lf.prototype.toGeoJSON=function(t,e,r){var a,u,d=this.extent*Math.pow(2,r),m=this.extent*t,y=this.extent*e,b=this.loadGeometry(),T=lf.types[this.type];function E(O){for(var z=0;z<O.length;z++){var N=O[z];O[z]=[360*(N.x+m)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(N.y+y)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(a=0;a<b.length;a++)I[a]=b[a][0];E(b=I);break;case 2:for(a=0;a<b.length;a++)E(b[a]);break;case 3:for(b=function(O){var z=O.length;if(z<=1)return[O];for(var N,j,q=[],ie=0;ie<z;ie++){var oe=GL(O[ie]);oe!==0&&(j===void 0&&(j=oe<0),j===oe<0?(N&&q.push(N),N=[O[ie]]):N.push(O[ie]))}return N&&q.push(N),q}(b),a=0;a<b.length;a++)for(u=0;u<b[a].length;u++)E(b[a][u])}b.length===1?b=b[0]:T="Multi"+T;var k={type:"Feature",geometry:{type:T,coordinates:b},properties:this.properties};return"id"in this&&(k.id=this.id),k};var HL=tS,iS=nS;function nS(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(WL,this,e),this.length=this._features.length}function WL(t,e,r){t===15?e.version=r.readVarint():t===1?e.name=r.readString():t===5?e.extent=r.readVarint():t===2?e._features.push(r.pos):t===3?e._keys.push(r.readString()):t===4&&e._values.push(function(a){for(var u=null,d=a.readVarint()+a.pos;a.pos<d;){var m=a.readVarint()>>3;u=m===1?a.readString():m===2?a.readFloat():m===3?a.readDouble():m===4?a.readVarint64():m===5?a.readVarint():m===6?a.readSVarint():m===7?a.readBoolean():null}return u}(r))}nS.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new HL(this._pbf,e,this.extent,this._keys,this._values)};var qL=iS;function ZL(t,e,r){if(t===3){var a=new qL(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}var pv=xg.VectorTile=function(t,e){this.layers=t.readFields(ZL,{},e)},bg=xg.VectorTileFeature=tS;function wg(t,e,r,a){const u=[],d=a===0?(m,y,b,T,E,I)=>{m.push(new Ie(I,b+(I-y)/(T-y)*(E-b)))}:(m,y,b,T,E,I)=>{m.push(new Ie(y+(I-b)/(E-b)*(T-y),I))};for(const m of t){const y=[];for(const b of m){if(b.length<=2)continue;const T=[];for(let k=0;k<b.length-1;k++){const O=b[k].x,z=b[k].y,N=b[k+1].x,j=b[k+1].y,q=a===0?O:z,ie=a===0?N:j;q<e?ie>e&&d(T,O,z,N,j,e):q>r?ie<r&&d(T,O,z,N,j,r):T.push(b[k]),ie<e&&q>=e&&d(T,O,z,N,j,e),ie>r&&q<=r&&d(T,O,z,N,j,r)}let E=b[b.length-1];const I=a===0?E.x:E.y;I>=e&&I<=r&&T.push(E),T.length&&(E=T[T.length-1],T[0].x===E.x&&T[0].y===E.y||T.push(T[0]),y.push(T))}y.length&&u.push(y)}return u}xg.VectorTileLayer=iS;class rS{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var XL={read:function(t,e,r,a,u){var d,m,y=8*u-a-1,b=(1<<y)-1,T=b>>1,E=-7,I=r?u-1:0,k=r?-1:1,O=t[e+I];for(I+=k,d=O&(1<<-E)-1,O>>=-E,E+=y;E>0;d=256*d+t[e+I],I+=k,E-=8);for(m=d&(1<<-E)-1,d>>=-E,E+=a;E>0;m=256*m+t[e+I],I+=k,E-=8);if(d===0)d=1-T;else{if(d===b)return m?NaN:1/0*(O?-1:1);m+=Math.pow(2,a),d-=T}return(O?-1:1)*m*Math.pow(2,d-a)},write:function(t,e,r,a,u,d){var m,y,b,T=8*d-u-1,E=(1<<T)-1,I=E>>1,k=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=a?0:d-1,z=a?1:-1,N=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,m=E):(m=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-m))<1&&(m--,b*=2),(e+=m+I>=1?k/b:k*Math.pow(2,1-I))*b>=2&&(m++,b/=2),m+I>=E?(y=0,m=E):m+I>=1?(y=(e*b-1)*Math.pow(2,u),m+=I):(y=e*Math.pow(2,I-1)*Math.pow(2,u),m=0));u>=8;t[r+O]=255&y,O+=z,y/=256,u-=8);for(m=m<<u|y,T+=u;T>0;t[r+O]=255&m,O+=z,m/=256,T-=8);t[r+O-z]|=128*N}},oS=Kn,Tg=XL;function Kn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Kn.Varint=0,Kn.Fixed64=1,Kn.Bytes=2,Kn.Fixed32=5;var mv=4294967296,sS=1/mv,aS=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function sc(t){return t.type===Kn.Bytes?t.readVarint()+t.pos:t.pos+1}function cf(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function lS(t,e,r){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(var u=r.pos-1;u>=t;u--)r.buf[u+a]=r.buf[u]}function YL(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function JL(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function KL(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function QL(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function $L(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function eO(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function tO(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function iO(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function nO(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function Sg(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function uf(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function cS(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Kn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),u=a>>3,d=this.pos;this.type=7&a,t(u,e,this),this.pos===d&&this.skip(a)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Sg(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=cS(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Sg(this.buf,this.pos)+Sg(this.buf,this.pos+4)*mv;return this.pos+=8,t},readSFixed64:function(){var t=Sg(this.buf,this.pos)+cS(this.buf,this.pos+4)*mv;return this.pos+=8,t},readFloat:function(){var t=Tg.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Tg.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,a=this.buf;return e=127&(r=a[this.pos++]),r<128?e:(e|=(127&(r=a[this.pos++]))<<7,r<128?e:(e|=(127&(r=a[this.pos++]))<<14,r<128?e:(e|=(127&(r=a[this.pos++]))<<21,r<128?e:function(u,d,m){var y,b,T=m.buf;if(y=(112&(b=T[m.pos++]))>>4,b<128||(y|=(127&(b=T[m.pos++]))<<3,b<128)||(y|=(127&(b=T[m.pos++]))<<10,b<128)||(y|=(127&(b=T[m.pos++]))<<17,b<128)||(y|=(127&(b=T[m.pos++]))<<24,b<128)||(y|=(1&(b=T[m.pos++]))<<31,b<128))return cf(u,y,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=a[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&aS?function(r,a,u){return aS.decode(r.subarray(a,u))}(this.buf,e,t):function(r,a,u){for(var d="",m=a;m<u;){var y,b,T,E=r[m],I=null,k=E>239?4:E>223?3:E>191?2:1;if(m+k>u)break;k===1?E<128&&(I=E):k===2?(192&(y=r[m+1]))==128&&(I=(31&E)<<6|63&y)<=127&&(I=null):k===3?(b=r[m+2],(192&(y=r[m+1]))==128&&(192&b)==128&&((I=(15&E)<<12|(63&y)<<6|63&b)<=2047||I>=55296&&I<=57343)&&(I=null)):k===4&&(b=r[m+2],T=r[m+3],(192&(y=r[m+1]))==128&&(192&b)==128&&(192&T)==128&&((I=(15&E)<<18|(63&y)<<12|(63&b)<<6|63&T)<=65535||I>=1114112)&&(I=null)),I===null?(I=65533,k=1):I>65535&&(I-=65536,d+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),d+=String.fromCharCode(I),m+=k}return d}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Kn.Bytes)return t.push(this.readVarint(e));var r=sc(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Kn.Bytes)return t.push(this.readSVarint());var e=sc(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Kn.Bytes)return t.push(this.readBoolean());var e=sc(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Kn.Bytes)return t.push(this.readFloat());var e=sc(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Kn.Bytes)return t.push(this.readDouble());var e=sc(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Kn.Bytes)return t.push(this.readFixed32());var e=sc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Kn.Bytes)return t.push(this.readSFixed32());var e=sc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Kn.Bytes)return t.push(this.readFixed64());var e=sc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Kn.Bytes)return t.push(this.readSFixed64());var e=sc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Kn.Varint)for(;this.buf[this.pos++]>127;);else if(e===Kn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Kn.Fixed32)this.pos+=4;else{if(e!==Kn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),uf(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),uf(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),uf(this.buf,-1&t,this.pos),uf(this.buf,Math.floor(t*sS),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),uf(this.buf,-1&t,this.pos),uf(this.buf,Math.floor(t*sS),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,r){var a,u;if(e>=0?(a=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(d,m,y){y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,y.buf[y.pos]=127&(d>>>=7)}(a,0,r),function(d,m){var y=(7&d)<<4;m.buf[m.pos++]|=y|((d>>>=3)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d)))))}(u,r)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(a,u,d){for(var m,y,b=0;b<u.length;b++){if((m=u.charCodeAt(b))>55295&&m<57344){if(!y){m>56319||b+1===u.length?(a[d++]=239,a[d++]=191,a[d++]=189):y=m;continue}if(m<56320){a[d++]=239,a[d++]=191,a[d++]=189,y=m;continue}m=y-55296<<10|m-56320|65536,y=null}else y&&(a[d++]=239,a[d++]=191,a[d++]=189,y=null);m<128?a[d++]=m:(m<2048?a[d++]=m>>6|192:(m<65536?a[d++]=m>>12|224:(a[d++]=m>>18|240,a[d++]=m>>12&63|128),a[d++]=m>>6&63|128),a[d++]=63&m|128)}return d}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&lS(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),Tg.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Tg.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var a=this.pos-r;a>=128&&lS(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(t,e,r){this.writeTag(t,Kn.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,YL,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,JL,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,$L,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,KL,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,QL,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,eO,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,tO,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,iO,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,nO,e)},writeBytesField:function(t,e){this.writeTag(t,Kn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Kn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Kn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Kn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Kn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Kn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Kn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Kn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Kn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Kn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var Mg=pe(oS);const rO=["tile","layer","source","sourceLayer","state"];class uS{constructor(e,r,a,u,d){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=a,this._y=u,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const r of rO)this[r]!==void 0&&(e[r]=this[r]);return e}}class oO{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,a){const u=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},rt(this.stateChanges[e][u],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const d in this.state[e])d!==u&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const d in this.state[e][u])a[d]||(this.deletedStates[e][u][d]=null)}else for(const d in a)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][d]===null&&delete this.deletedStates[e][u][d]}removeFeatureState(e,r,a){if(this.deletedStates[e]===null)return;const u=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&r!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][a]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(a in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][a]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,r){const a=String(r),u=rt({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const d=this.deletedStates[e][r];if(d===null)return{};for(const m in d)delete u[m]}return u}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const a={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const d={};for(const m in this.stateChanges[u])this.state[u][m]||(this.state[u][m]={}),rt(this.state[u][m],this.stateChanges[u][m]),d[m]=this.state[u][m];a[u]=d}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const d={};if(this.deletedStates[u]===null)for(const m in this.state[u])d[m]={},this.state[u][m]={};else for(const m in this.deletedStates[u]){if(this.deletedStates[u][m]===null)this.state[u][m]={};else if(this.state[u][m])for(const y of Object.keys(this.deletedStates[u][m]))delete this.state[u][m][y];d[m]=this.state[u][m]}a[u]=a[u]||{},rt(a[u],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const u in e)e[u].setFeatureState(a,r)}}class hS{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const a=this.toIdx(e,r);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function fS(t,e,r,a){let u=0,d=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(a[m])<1e-15){if(r[m]<t[m]||r[m]>e[m])return null}else{const y=1/a[m];let b=(t[m]-r[m])*y,T=(e[m]-r[m])*y;if(b>T){const E=b;b=T,T=E}if(b>u&&(u=b),T<d&&(d=T),u>d)return null}return u}function dS(t,e,r,a,u,d,m,y,b,T,E){const I=a-t,k=u-e,O=d-r,z=m-t,N=y-e,j=b-r,q=E[1]*j-E[2]*N,ie=E[2]*z-E[0]*j,oe=E[0]*N-E[1]*z,ae=I*q+k*ie+O*oe;if(Math.abs(ae)<1e-15)return null;const he=1/ae,me=T[0]-t,Te=T[1]-e,Pe=T[2]-r,Re=(me*q+Te*ie+Pe*oe)*he;if(Re<0||Re>1)return null;const Ge=Te*O-Pe*k,Fe=Pe*I-me*O,et=me*k-Te*I,bt=(E[0]*Ge+E[1]*Fe+E[2]*et)*he;return bt<0||Re+bt>1?null:(z*Ge+N*Fe+j*et)*he}function pS(t,e,r){return(t-e)/(r-e)}function mS(t,e,r,a,u,d,m,y,b){const T=1<<r,E=d-a,I=m-u,k=(t+1)/T*E+a,O=(e+0)/T*I+u,z=(e+1)/T*I+u;y[0]=(t+0)/T*E+a,y[1]=O,b[0]=k,b[1]=z}class gS{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(d){const m=Math.ceil(Math.log2(d.dim/8)),y=[];let b=Math.ceil(Math.pow(2,m));const T=1/b,E=(O,z,N,j,q)=>{const ie=j?1:0,oe=(O+1)*N-ie,ae=z*N,he=(z+1)*N-ie;q[0]=O*N,q[1]=ae,q[2]=oe,q[3]=he};let I=new hS(b);const k=[];for(let O=0;O<b*b;O++){E(O%b,Math.floor(O/b),T,!1,k);const z=qc(k[0],k[1],d),N=qc(k[2],k[1],d),j=qc(k[2],k[3],d),q=qc(k[0],k[3],d);I.minimums.push(Math.min(z,N,j,q)),I.maximums.push(Math.max(z,N,j,q)),I.leaves.push(1)}for(y.push(I),b/=2;b>=1;b/=2){const O=y[y.length-1];I=new hS(b);for(let z=0;z<b*b;z++){E(z%b,Math.floor(z/b),2,!0,k);const N=O.getElevation(k[0],k[1]),j=O.getElevation(k[2],k[1]),q=O.getElevation(k[2],k[3]),ie=O.getElevation(k[0],k[3]),oe=O.isLeaf(k[0],k[1]),ae=O.isLeaf(k[2],k[1]),he=O.isLeaf(k[2],k[3]),me=O.isLeaf(k[0],k[3]),Te=Math.min(N.min,j.min,q.min,ie.min),Pe=Math.max(N.max,j.max,q.max,ie.max),Re=oe&&ae&&he&&me;I.maximums.push(Pe),I.minimums.push(Te),I.leaves.push(Pe-Te<=5&&Re?1:0)}y.push(I)}return y}(this.dem),a=r.length-1,u=r[a];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(r,0,0,a,0)}raycastRoot(e,r,a,u,d,m,y=1){return fS([e,r,-100],[a,u,this.maximums[0]*y],d,m)}raycast(e,r,a,u,d,m,y=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,r,a,u,d,m,y);if(b==null)return null;const T=[],E=[],I=[],k=[],O=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;O.length>0;){const{idx:z,t:N,nodex:j,nodey:q,depth:ie}=O.pop();if(this.leaves[z]){mS(j,q,ie,e,r,a,u,I,k);const ae=1<<ie,he=(j+0)/ae,me=(j+1)/ae,Te=(q+0)/ae,Pe=(q+1)/ae,Re=qc(he,Te,this.dem)*y,Ge=qc(me,Te,this.dem)*y,Fe=qc(me,Pe,this.dem)*y,et=qc(he,Pe,this.dem)*y,bt=dS(I[0],I[1],Re,k[0],I[1],Ge,k[0],k[1],Fe,d,m),Je=dS(k[0],k[1],Fe,I[0],k[1],et,I[0],I[1],Re,d,m),gt=Math.min(bt!==null?bt:Number.MAX_VALUE,Je!==null?Je:Number.MAX_VALUE);if(gt!==Number.MAX_VALUE)return gt;{const Ye=s.v.scaleAndAdd([],d,m,N);if(_S(Re,Ge,et,Fe,pS(Ye[0],I[0],k[0]),pS(Ye[1],I[1],k[1]))>=Ye[2])return N}continue}let oe=0;for(let ae=0;ae<this._siblingOffset.length;ae++){mS((j<<1)+this._siblingOffset[ae][0],(q<<1)+this._siblingOffset[ae][1],ie+1,e,r,a,u,I,k),I[2]=-100,k[2]=this.maximums[this.childOffsets[z]+ae]*y;const he=fS(I,k,d,m);if(he!=null){const me=he;T[ae]=me;let Te=!1;for(let Pe=0;Pe<oe&&!Te;Pe++)me>=T[E[Pe]]&&(E.splice(Pe,0,ae),Te=!0);Te||(E[oe]=ae),oe++}}for(let ae=0;ae<oe;ae++){const he=E[ae];O.push({idx:this.childOffsets[z]+he,t:T[he],nodex:(j<<1)+this._siblingOffset[he][0],nodey:(q<<1)+this._siblingOffset[he][1],depth:ie+1})}}return null}_addNode(e,r,a){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,a,u,d){if(e[u].isLeaf(r,a)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const m=u-1,y=e[m];let b=0,T=0;for(let E=0;E<this._siblingOffset.length;E++){const I=2*r+this._siblingOffset[E][0],k=2*a+this._siblingOffset[E][1],O=y.getElevation(I,k),z=y.isLeaf(I,k),N=this._addNode(O.min,O.max,z);z&&(b|=1<<E),T||(T=N)}for(let E=0;E<this._siblingOffset.length;E++)b&1<<E||this._construct(e,2*r+this._siblingOffset[E][0],2*a+this._siblingOffset[E][1],m,T+E)}}function _S(t,e,r,a,u,d){return Gi(Gi(t,r,d),Gi(e,a,d),u)}function qc(t,e,r){const a=r.dim,u=wt(t*a-.5,0,a-1),d=wt(e*a-.5,0,a-1),m=Math.floor(u),y=Math.floor(d),b=Math.min(m+1,a-1),T=Math.min(y+1,a-1);return _S(r.get(m,y),r.get(b,y),r.get(m,T),r.get(b,T),u-m,d-y)}const sO={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function aO(t,e,r){return(256*t*256+256*e+r)/10-1e4}function lO(t,e,r){return 256*t+e+r/256-32768}class Eg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,a,u=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return si(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const d=this.dim=r.height-2,m=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let b=0;b<d;b++)m[this._idx(-1,b)]=m[this._idx(0,b)],m[this._idx(d,b)]=m[this._idx(d-1,b)],m[this._idx(b,-1)]=m[this._idx(b,0)],m[this._idx(b,d)]=m[this._idx(b,d-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(d,-1)]=m[this._idx(d-1,0)],m[this._idx(-1,d)]=m[this._idx(0,d-1)],m[this._idx(d,d)]=m[this._idx(d-1,d-1)]}const y=a==="terrarium"?lO:aO;for(let b=0;b<m.length;++b){const T=4*b;this.floatView[b]=y(this.pixels[T],this.pixels[T+1],this.pixels[T+2])}this._timestamp=ro.now()}_buildQuadTree(){this._tree=new gS(this)}get(e,r,a=!1){a&&(e=wt(e,-1,this.dim),r=wt(r,-1,this.dim));const u=this._idx(e,r);return this.floatView[u]}set(e,r,a){const u=this._idx(e,r),d=this.floatView[u];return this.floatView[u]=a,a-d}static getUnpackVector(e){return sO[e]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const a=[0,0,0,0],u=Eg.getUnpackVector(r);let d=Math.floor((e+u[3])/u[2]);return a[2]=d%256,d=Math.floor(d/256),a[1]=d%256,d=Math.floor(d/256),a[0]=d,a}getPixels(){return new JT({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,d=r*this.dim+this.dim,m=a*this.dim,y=a*this.dim+this.dim;switch(r){case-1:u=d-1;break;case 1:d=u+1}switch(a){case-1:m=y-1;break;case 1:y=m+1}const b=-r*this.dim,T=-a*this.dim;for(let E=m;E<y;E++)for(let I=u;I<d;I++){const k=4*this._idx(I,E),O=4*this._idx(I+b,E+T);this.pixels[k+0]=e.pixels[O+0],this.pixels[k+1]=e.pixels[O+1],this.pixels[k+2]=e.pixels[O+2],this.pixels[k+3]=e.pixels[O+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ei(Eg,"DEMData"),ei(gS,"DemMinMaxQuadTree",{omit:["dem"]});class hf{constructor(e,r,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=a}static create(e,r,a){const u=a||e.findDEMTileFor(r);if(!u||!u.dem)return;const d=u.dem,m=u.tileID,y=1<<r.canonical.z-m.canonical.z;return new hf(u,d.dim/Mt/y,[(r.canonical.x/y-m.canonical.x)*d.dim,(r.canonical.y/y-m.canonical.y)*d.dim])}tileCoordToPixel(e,r){const a=r*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(a);return new Ie(u,d)}getElevationAt(e,r,a,u){const d=e*this._scale+this._offset[0],m=r*this._scale+this._offset[1],y=Math.floor(d),b=Math.floor(m),T=this._dem;return u=!!u,a?Gi(Gi(T.get(y,b,u),T.get(y,b+1,u),m-b),Gi(T.get(y+1,b,u),T.get(y+1,b+1,u),m-b),d-y):T.get(y,b,u)}getElevationAtPixel(e,r,a){return this._dem.get(e,r,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Jo(1,e)*this._dem.stride}}class gv{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Nc(Mt,16,0),this.featureIndexArray=new Zb,this.promoteId=r}insert(e,r,a,u,d,m=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,d,m);const b=this.grid;for(let T=0;T<r.length;T++){const E=r[T],I=[1/0,1/0,-1/0,-1/0];for(let k=0;k<E.length;k++){const O=E[k];I[0]=Math.min(I[0],O.x),I[1]=Math.min(I[1],O.y),I[2]=Math.max(I[2],O.x),I[3]=Math.max(I[3],O.y)}I[0]<Mt&&I[1]<Mt&&I[2]>=0&&I[3]>=0&&b.insert(y,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new pv(new Mg(this.rawTileData)).layers,this.sourceLayerCoder=new rS(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,a,u){this.loadVTLayers();const d=e.params||{},m=Yh(d.filter),y=e.tileResult,b=e.transform,T=y.bufferedTilespaceBounds,E=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(z,N,j,q)=>UT(y.bufferedTilespaceGeometry,z,N,j,q));E.sort(cO);let I=null;b.elevation&&E.length>0&&(I=hf.create(b.elevation,this.tileID));const k={};let O;for(let z=0;z<E.length;z++){const N=E[z];if(N===O)continue;O=N;const j=this.featureIndexArray.get(N);let q=null;this.loadMatchingFeature(k,j,m,d.layers,d.availableImages,r,a,u,(ie,oe,ae,he=0)=>(q||(q=gl(ie,this.tileID.canonical,e.tileTransform)),oe.queryIntersectsFeature(y,ie,ae,q,this.z,e.transform,e.pixelPosMatrix,I,he)))}return k}loadMatchingFeature(e,r,a,u,d,m,y,b,T){const{featureIndex:E,bucketIndex:I,sourceLayerIndex:k,layoutVertexArrayOffset:O}=r,z=this.bucketLayerIDs[I];if(u&&!function(ie,oe){for(let ae=0;ae<ie.length;ae++)if(oe.indexOf(ie[ae])>=0)return!0;return!1}(u,z))return;const N=this.sourceLayerCoder.decode(k),j=this.vtLayers[N].feature(E);if(a.needGeometry){const ie=Wc(j,!0);if(!a.filter(new be(this.tileID.overscaledZ),ie,this.tileID.canonical))return}else if(!a.filter(new be(this.tileID.overscaledZ),j))return;const q=this.getId(j,N);for(let ie=0;ie<z.length;ie++){const oe=z[ie];if(u&&u.indexOf(oe)<0)continue;const ae=m[oe];if(!ae)continue;let he={};q!==void 0&&b&&(he=b.getState(ae.sourceLayer||"_geojsonTileLayer",q));const me=rt({},y[oe]);me.paint=yS(me.paint,ae.paint,j,he,d),me.layout=yS(me.layout,ae.layout,j,he,d);const Te=!T||T(j,ae,he,O);if(!Te)continue;const Pe=new uS(j,this.z,this.x,this.y,q);Pe.layer=me;let Re=e[oe];Re===void 0&&(Re=e[oe]=[]),Re.push({featureIndex:E,feature:Pe,intersectionZ:Te})}}lookupSymbolFeatures(e,r,a,u,d,m,y,b){const T={};this.loadVTLayers();const E=Yh(d);for(const I of e)this.loadMatchingFeature(T,{bucketIndex:a,sourceLayerIndex:u,featureIndex:I,layoutVertexArrayOffset:0},E,m,y,b,r);return T}loadFeature(e){const{featureIndex:r,sourceLayerIndex:a}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(a),d=this.vtFeatures[u];if(d[r])return d[r];const m=this.vtLayers[u].feature(r);return d[r]=m,m}hasLayer(e){for(const r of this.bucketLayerIDs)for(const a of r)if(e===a)return!0;return!1}getId(e,r){let a=e.id;if(this.promoteId){const u=typeof this.promoteId=="string"?this.promoteId:this.promoteId[r];u!=null&&(a=e.properties[u]),typeof a=="boolean"&&(a=Number(a))}return a}}function yS(t,e,r,a,u){return Sr(t,(d,m)=>{const y=e instanceof nt?e.get(m):null;return y&&y.evaluate?y.evaluate(r,a,u):y})}function cO(t,e){return e-t}ei(gv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const uO=li([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),hO=li([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),fO=li([{name:"a_projected_pos",components:4,type:"Float32"}],4);li([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const dO=li([{name:"a_z_offset",components:1,type:"Float32"}],4),pO=li([{name:"a_texb",components:2,type:"Uint16"}]),mO=li([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),gO=li([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);li([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const vS=li([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),_O=li([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);li([{name:"triangle",components:3,type:"Uint16"}]),li([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),li([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),li([{type:"Float32",name:"offsetX"}]),li([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var fo=24;const Va=128;function _v(t,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new be(t+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:u}=r;let d=0;for(;d<a.length&&a[d]<=t;)d++;d=Math.max(0,d-1);let m=d;for(;m<a.length&&a[m]<t+1;)m++;m=Math.min(a.length-1,m);const y=a[d],b=a[m];return r.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:b,minSize:r.evaluate(new be(y)),maxSize:r.evaluate(new be(b)),interpolationType:u}}}function Ag(t,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:u}){return t.kind==="source"?a/Va:t.kind==="composite"?Gi(a/Va,u/Va,r):e}function ff(t,e){let r=0,a=0;if(t.kind==="constant")a=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:u,minZoom:d,maxZoom:m}=t,y=u?wt(qo.interpolationFactor(u,e,d,m),0,1):0;t.kind==="camera"?a=Gi(t.minSize,t.maxSize,y):r=y}return{uSizeT:r,uSize:a}}var yO=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Va,evaluateSizeForFeature:Ag,evaluateSizeForZoom:ff,getSizeData:_v});function vO(t,e,r){return t.sections.forEach(a=>{a.text=function(u,d,m){const y=d.layout.get("text-transform").evaluate(m,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),Me.applyArabicShaping&&(u=Me.applyArabicShaping(u)),u}(a.text,e,r)}),t}const Hd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function xO(t){return t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""}function bO(t){return t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""}const yv=3;function wO(t,e,r){e.glyphs=[],t===1&&r.readMessage(TO,e)}function TO(t,e,r){if(t===3){const{id:a,bitmap:u,width:d,height:m,left:y,top:b,advance:T}=r.readMessage(SO,{});e.glyphs.push({id:a,bitmap:new oc({width:d+2*yv,height:m+2*yv},u),metrics:{width:d,height:m,left:y,top:b,advance:T}})}else t===4?e.ascender=r.readSVarint():t===5&&(e.descender=r.readSVarint())}function SO(t,e,r){t===1?e.id=r.readVarint():t===2?e.bitmap=r.readBytes():t===3?e.width=r.readVarint():t===4?e.height=r.readVarint():t===5?e.left=r.readSVarint():t===6?e.top=r.readSVarint():t===7&&(e.advance=r.readVarint())}const xS=yv,Ks={horizontal:1,vertical:2,horizontalOnly:3},bS=-17;class Wd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const a=new Wd;return a.scale=e||1,a.fontStack=r,a}static forImage(e){const r=new Wd;return r.imageName=e,r}}class df{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const a=new df;for(let u=0;u<e.sections.length;u++){const d=e.sections[u];d.image?a.addImageSection(d):a.addTextSection(d,r)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(r,a){let u="";for(let d=0;d<r.length;d++){const m=r.charCodeAt(d+1)||null,y=r.charCodeAt(d-1)||null;u+=!a&&(m&&B(m)&&!Hd[r[d+1]]||y&&B(y)&&!Hd[r[d-1]])||!Hd[r[d]]?r[d]:Hd[r[d]]}return u}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&Ig[this.text.charCodeAt(a)];a++)e++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&Ig[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const a=new df;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Wd.forText(e.scale,e.fontStack||r));const a=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(a)}addImageSection(e){const r=e.image?e.image.namePrimary:"";if(r.length===0)return void si("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(Wd.forImage(r)),this.sectionIndex.push(this.sections.length-1)):si("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function vv(t,e,r,a,u,d,m,y,b,T,E,I,k,O,z){const N=df.fromFeature(t,u);I===Ks.vertical&&N.verticalizePunctuation(k);let j=[];const q=function(me,Te,Pe,Re,Ge,Fe){if(!me)return[];const et=[],bt=function(Vt,$t,vt,vi,ii,Ot){let xi=0;for(let ci=0;ci<Vt.length();ci++){const gi=Vt.getSection(ci);xi+=wS(Vt.getCodePoint(ci),gi,vi,ii,$t,Ot)}return xi/Math.max(1,Math.ceil(xi/vt))}(me,Te,Pe,Re,Ge,Fe),Je=me.text.indexOf("")>=0;let gt=0;for(let Vt=0;Vt<me.length();Vt++){const $t=me.getSection(Vt),vt=me.getCodePoint(Vt);if(Ig[vt]||(gt+=wS(vt,$t,Re,Ge,Te,Fe)),Vt<me.length()-1){const vi=!((Ye=vt)<11904||!(w["Bopomofo Extended"](Ye)||w.Bopomofo(Ye)||w["CJK Compatibility Forms"](Ye)||w["CJK Compatibility Ideographs"](Ye)||w["CJK Compatibility"](Ye)||w["CJK Radicals Supplement"](Ye)||w["CJK Strokes"](Ye)||w["CJK Symbols and Punctuation"](Ye)||w["CJK Unified Ideographs Extension A"](Ye)||w["CJK Unified Ideographs"](Ye)||w["Enclosed CJK Letters and Months"](Ye)||w["Halfwidth and Fullwidth Forms"](Ye)||w.Hiragana(Ye)||w["Ideographic Description Characters"](Ye)||w["Kangxi Radicals"](Ye)||w["Katakana Phonetic Extensions"](Ye)||w.Katakana(Ye)||w["Vertical Forms"](Ye)||w["Yi Radicals"](Ye)||w["Yi Syllables"](Ye)));(MO[vt]||vi||$t.imageName)&&et.push(SS(Vt+1,gt,bt,et,EO(vt,me.getCodePoint(Vt+1),vi&&Je),!1))}}var Ye;return MS(SS(me.length(),gt,bt,et,0,!0))}(N,T,d,e,a,O),{processBidirectionalText:ie,processStyledBidirectionalText:oe}=Me;if(ie&&N.sections.length===1){const me=ie(N.toString(),q);for(const Te of me){const Pe=new df;Pe.text=Te,Pe.sections=N.sections;for(let Re=0;Re<Te.length;Re++)Pe.sectionIndex.push(0);j.push(Pe)}}else if(oe){const me=oe(N.text,N.sectionIndex,q);for(const Te of me){const Pe=new df;Pe.text=Te[0],Pe.sectionIndex=Te[1],Pe.sections=N.sections,j.push(Pe)}}else j=function(me,Te){const Pe=[],Re=me.text;let Ge=0;for(const Fe of Te)Pe.push(me.substring(Ge,Fe)),Ge=Fe;return Ge<Re.length&&Pe.push(me.substring(Ge,Re.length)),Pe}(N,q);const ae=[],he={positionedLines:ae,text:N.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(me,Te,Pe,Re,Ge,Fe,et,bt,Je,gt,Ye,Vt){let $t=0,vt=0,vi=0;const ii=bt==="right"?1:bt==="left"?0:.5;let Ot=!1;for(const en of Ge){const Oi=en.getSections();for(const Qi of Oi){if(Qi.imageName)continue;const dn=Te[Qi.fontStack];if(dn&&(Ot=dn.ascender!==void 0&&dn.descender!==void 0,!Ot))break}if(!Ot)break}let xi=0;for(const en of Ge){en.trim();const Oi=en.getMaxScale(),Qi=(Oi-1)*fo,dn={positionedGlyphs:[],lineOffset:0};me.positionedLines[xi]=dn;const Vn=dn.positionedGlyphs;let Hi=0;if(!en.length()){vt+=Fe,++xi;continue}let Qn=0,Un=0;for(let En=0;En<en.length();En++){const pn=en.getSection(En),gr=en.getSectionIndex(En),$n=en.getCodePoint(En);let wr=pn.scale,eo=null,Ko=null,Cr=null,yr=fo,Oo=0;const Ro=!(Je===Ks.horizontal||!Ye&&!R($n)||Ye&&(Ig[$n]||(ci=$n,w.Arabic(ci)||w["Arabic Supplement"](ci)||w["Arabic Extended-A"](ci)||w["Arabic Presentation Forms-A"](ci)||w["Arabic Presentation Forms-B"](ci))));if(pn.imageName){const Qo=Re[pn.imageName];if(!Qo)continue;Cr=pn.imageName,me.iconsInText=me.iconsInText||!0,Ko=Qo.paddedRect;const er=Qo.displaySize;wr=wr*fo/Vt,eo={width:er[0],height:er[1],left:0,top:-xS,advance:Ro?er[1]:er[0],localGlyph:!1},Oo=Ot?-eo.height*wr:bS+Oi*fo-er[1]*wr,yr=eo.advance;const Ha=(Ro?er[0]:er[1])*wr-fo*Oi;Ha>0&&Ha>Hi&&(Hi=Ha)}else{const Qo=Pe[pn.fontStack];if(!Qo)continue;Qo[$n]&&(Ko=Qo[$n]);const er=Te[pn.fontStack];if(!er)continue;const Ha=er.glyphs[$n];if(!Ha)continue;if(eo=Ha.metrics,yr=$n!==8203?fo:0,Ot){const xf=er.ascender!==void 0?Math.abs(er.ascender):0,cc=er.descender!==void 0?Math.abs(er.descender):0,uc=(xf+cc)*wr;Qn<uc&&(Qn=uc,Un=(xf-cc)/2*wr),Oo=-xf*wr}else Oo=bS+(Oi-wr)*fo}Ro?(me.verticalizable=!0,Vn.push({glyph:$n,imageName:Cr,x:$t,y:vt+Oo,vertical:Ro,scale:wr,localGlyph:eo.localGlyph,fontStack:pn.fontStack,sectionIndex:gr,metrics:eo,rect:Ko}),$t+=yr*wr+gt):(Vn.push({glyph:$n,imageName:Cr,x:$t,y:vt+Oo,vertical:Ro,scale:wr,localGlyph:eo.localGlyph,fontStack:pn.fontStack,sectionIndex:gr,metrics:eo,rect:Ko}),$t+=eo.advance*wr+gt)}Vn.length!==0&&(vi=Math.max($t-gt,vi),Ot?ES(Vn,ii,Hi,Un,Fe*Oi/2):ES(Vn,ii,Hi,0,Fe/2)),$t=0;const xn=Fe*Oi+Hi;dn.lineOffset=Math.max(Hi,Qi),vt+=xn,++xi}var ci;const gi=vt,{horizontalAlign:It,verticalAlign:Ei}=xv(et);(function(en,Oi,Qi,dn,Vn,Hi){const Qn=(Oi-Qi)*Vn,Un=-Hi*dn;for(const xn of en)for(const En of xn.positionedGlyphs)En.x+=Qn,En.y+=Un})(me.positionedLines,ii,It,Ei,vi,gi),me.top+=-Ei*gi,me.bottom=me.top+gi,me.left+=-It*vi,me.right=me.left+vi,me.hasBaseline=Ot}(he,e,r,a,j,m,y,b,I,T,k,z),!function(me){for(const Te of me)if(Te.positionedGlyphs.length!==0)return!1;return!0}(ae)&&he}const Ig={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},MO={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function wS(t,e,r,a,u,d){if(e.imageName){const m=a[e.imageName];return m?m.displaySize[0]*e.scale*fo/d+u:0}{const m=r[e.fontStack],y=m&&m.glyphs[t];return y?y.metrics.advance*e.scale+u:0}}function TS(t,e,r,a){const u=Math.pow(t-e,2);return a?t<e?u/2:2*u:u+Math.abs(r)*r}function EO(t,e,r){let a=0;return t===10&&(a-=1e4),r&&(a+=150),t!==40&&t!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function SS(t,e,r,a,u,d){let m=null,y=TS(e,r,u,d);for(const b of a){const T=TS(e-b.x,r,u,d)+b.badness;T<=y&&(m=b,y=T)}return{index:t,x:e,priorBreak:m,badness:y}}function MS(t){return t?MS(t.priorBreak).concat(t.index):[]}function xv(t){let e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function ES(t,e,r,a,u){if(!(e||r||a||u))return;const d=t.length-1,m=t[d],y=(m.x+m.metrics.advance*m.scale)*e;for(let b=0;b<=d;b++)t[b].x-=y,t[b].y+=r+a+u}function AO(t,e,r,a){const{horizontalAlign:u,verticalAlign:d}=xv(a),m=r[0]-t.displaySize[0]*u,y=r[1]-t.displaySize[1]*d;return{imagePrimary:t,imageSecondary:e,top:y,bottom:y+t.displaySize[1],left:m,right:m+t.displaySize[0]}}function AS(t,e,r,a,u,d){const m=t.imagePrimary;let y;if(m.content){const j=m.content,q=m.pixelRatio||1;y=[j[0]/q,j[1]/q,m.displaySize[0]-j[2]/q,m.displaySize[1]-j[3]/q]}const b=e.left*d,T=e.right*d;let E,I,k,O;r==="width"||r==="both"?(O=u[0]+b-a[3],I=u[0]+T+a[1]):(O=u[0]+(b+T-m.displaySize[0])/2,I=O+m.displaySize[0]);const z=e.top*d,N=e.bottom*d;return r==="height"||r==="both"?(E=u[1]+z-a[0],k=u[1]+N+a[2]):(E=u[1]+(z+N-m.displaySize[1])/2,k=E+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:E,right:I,bottom:k,left:O,collisionPadding:y}}class ac extends Ie{constructor(e,r,a,u,d){super(e,r),this.angle=u,this.z=a,d!==void 0&&(this.segment=d)}clone(){return new ac(this.x,this.y,this.z,this.angle,this.segment)}}function IS(t,e,r,a,u){if(e.segment===void 0)return!0;let d=e,m=e.segment+1,y=0;for(;y>-r/2;){if(m--,m<0)return!1;y-=t[m].dist(d),d=t[m]}y+=t[m].dist(t[m+1]),m++;const b=[];let T=0;for(;y<r/2;){const E=t[m],I=t[m+1];if(!I)return!1;let k=t[m-1].angleTo(E)-E.angleTo(I);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:k}),T+=k;y-b[0].distance>a;)T-=b.shift().angleDelta;if(T>u)return!1;m++,y+=E.dist(I)}return!0}function CS(t){let e=0;for(let r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function PS(t,e,r){return t?.6*e*r:0}function kS(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function IO(t,e,r,a,u,d){const m=PS(r,u,d),y=kS(r,a)*d;let b=0;const T=CS(t)/2;for(let E=0;E<t.length-1;E++){const I=t[E],k=t[E+1],O=I.dist(k);if(b+O>T){const z=(T-b)/O,N=Gi(I.x,k.x,z),j=Gi(I.y,k.y,z),q=new ac(N,j,0,k.angleTo(I),E);return!m||IS(t,q,y,m,e)?q:void 0}b+=O}}function CO(t,e,r,a,u,d,m,y,b){const T=PS(a,d,m),E=kS(a,u),I=E*m,k=t[0].x===0||t[0].x===b||t[0].y===0||t[0].y===b;return e-I<e/4&&(e=I+e/4),DS(t,k?e/2*y%e:(E/2+2*d)*m*y%e,e,T,r,I,k,!1,b)}function DS(t,e,r,a,u,d,m,y,b){const T=d/2,E=CS(t);let I=0,k=e-r,O=[];for(let z=0;z<t.length-1;z++){const N=t[z],j=t[z+1],q=N.dist(j),ie=j.angleTo(N);for(;k+r<I+q;){k+=r;const oe=(k-I)/q,ae=Gi(N.x,j.x,oe),he=Gi(N.y,j.y,oe);if(ae>=0&&ae<b&&he>=0&&he<b&&k-T>=0&&k+T<=E){const me=new ac(ae,he,0,ie,z);a&&!IS(t,me,d,a,u)||O.push(me)}}I+=q}return y||O.length||m||(O=DS(t,I/2,r,a,u,d,m,!0,b)),O}function LS(t,e,r,a,u){const d=[];for(let m=0;m<t.length;m++){const y=t[m];let b;for(let T=0;T<y.length-1;T++){let E=y[T],I=y[T+1];E.x<e&&I.x<e||(E.x<e?E=new Ie(e,E.y+(e-E.x)/(I.x-E.x)*(I.y-E.y))._round():I.x<e&&(I=new Ie(e,E.y+(e-E.x)/(I.x-E.x)*(I.y-E.y))._round()),E.y<r&&I.y<r||(E.y<r?E=new Ie(E.x+(r-E.y)/(I.y-E.y)*(I.x-E.x),r)._round():I.y<r&&(I=new Ie(E.x+(r-E.y)/(I.y-E.y)*(I.x-E.x),r)._round()),E.x>=a&&I.x>=a||(E.x>=a?E=new Ie(a,E.y+(a-E.x)/(I.x-E.x)*(I.y-E.y))._round():I.x>=a&&(I=new Ie(a,E.y+(a-E.x)/(I.x-E.x)*(I.y-E.y))._round()),E.y>=u&&I.y>=u||(E.y>=u?E=new Ie(E.x+(u-E.y)/(I.y-E.y)*(I.x-E.x),u)._round():I.y>=u&&(I=new Ie(E.x+(u-E.y)/(I.y-E.y)*(I.x-E.x),u)._round()),b&&E.equals(b[b.length-1])||(b=[E],d.push(b)),b.push(I)))))}}return d}function bv(t){let e=0,r=0;for(const m of t)e+=m.w*m.h,r=Math.max(r,m.w);t.sort((m,y)=>y.h-m.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let u=0,d=0;for(const m of t)for(let y=a.length-1;y>=0;y--){const b=a[y];if(!(m.w>b.w||m.h>b.h)){if(m.x=b.x,m.y=b.y,d=Math.max(d,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===b.w&&m.h===b.h){const T=a.pop();y<a.length&&(a[y]=T)}else m.h===b.h?(b.x+=m.w,b.w-=m.w):m.w===b.w?(b.y+=m.h,b.h-=m.h):(a.push({x:b.x+m.w,y:b.y,w:b.w-m.w,h:m.h}),b.y+=m.h,b.h-=m.h);break}}return{w:u,h:d,fill:e/(u*d)||0}}ei(ac,"Anchor");const Ps=1;class wv{constructor(e,{pixelRatio:r,version:a,stretchX:u,stretchY:d,content:m}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=u,this.stretchY=d,this.content=m,this.version=a}get tl(){return[this.paddedRect.x+Ps,this.paddedRect.y+Ps]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ps,this.paddedRect.y+this.paddedRect.h-Ps]}get displaySize(){return[(this.paddedRect.w-2*Ps)/this.pixelRatio,(this.paddedRect.h-2*Ps)/this.pixelRatio]}}class OS{constructor(e,r){const a={},u={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,a,d),this.addImages(r,u,d);const{w:m,h:y}=bv(d),b=new Js({width:m||1,height:y||1});for(const T in e){const E=e[T],I=a[T].paddedRect;Js.copy(E.data,b,{x:0,y:0},{x:I.x+Ps,y:I.y+Ps},E.data,E.sdf)}for(const T in r){const E=r[T],I=u[T].paddedRect,k=I.x+Ps,O=I.y+Ps,z=E.data.width,N=E.data.height;Js.copy(E.data,b,{x:0,y:0},{x:k,y:O},E.data),Js.copy(E.data,b,{x:0,y:N-1},{x:k,y:O-1},{width:z,height:1}),Js.copy(E.data,b,{x:0,y:0},{x:k,y:O+N},{width:z,height:1}),Js.copy(E.data,b,{x:z-1,y:0},{x:k-1,y:O},{width:1,height:N}),Js.copy(E.data,b,{x:0,y:0},{x:k+z,y:O},{width:1,height:N})}this.image=b,this.iconPositions=a,this.patternPositions=u}addImages(e,r,a){for(const u in e){const d=e[u],m={x:0,y:0,w:d.data.width+2*Ps,h:d.data.height+2*Ps};a.push(m),r[u]=new wv(m,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,r,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(const u in e.getUpdatedImages(a))this.patchUpdatedImage(this.iconPositions[u],e.getImage(u,a),r),this.patchUpdatedImage(this.patternPositions[u],e.getImage(u,a),r)}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;const[u,d]=e.tl,m=!!Object.keys(this.patternPositions).length;a.update(r.data,{useMipmap:m},{x:u,y:d})}}ei(wv,"ImagePosition"),ei(OS,"ImageAtlas");const qd=1e20;function RS(t,e,r,a,u,d,m,y,b){for(let T=e;T<e+a;T++)zS(t,r*d+T,d,u,m,y,b);for(let T=r;T<r+u;T++)zS(t,T*d+e,1,a,m,y,b)}function zS(t,e,r,a,u,d,m){d[0]=0,m[0]=-qd,m[1]=qd,u[0]=t[e];for(let y=1,b=0,T=0;y<a;y++){u[y]=t[e+y*r];const E=y*y;do{const I=d[b];T=(u[y]-u[I]+E-I*I)/(y-I)/2}while(T<=m[b]&&--b>-1);b++,d[b]=y,m[b]=T,m[b+1]=qd}for(let y=0,b=0;y<a;y++){for(;m[b+1]<y;)b++;const T=d[b],E=y-T;t[e+y*r]=u[T]+E*E}}const Ua=2,Tv={none:0,ideographs:1,all:2};class pf{constructor(e,r,a){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,r){this.urls[r]=e}getGlyphs(e,r,a){const u=[],d=this.urls[r]||D.GLYPHS_URL;for(const m in e)for(const y of e[m])u.push({stack:m,id:y});Mi(u,({stack:m,id:y},b)=>{let T=this.entries[m];T||(T=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=T.glyphs[y];if(E!==void 0)return void b(null,{stack:m,id:y,glyph:E});if(E=this._tinySDF(T,m,y),E)return T.glyphs[y]=E,void b(null,{stack:m,id:y,glyph:E});const I=Math.floor(y/256);if(256*I>65535)return void b(new Error("glyphs > 65535 not supported"));if(T.ranges[I])return void b(null,{stack:m,id:y,glyph:E});let k=T.requests[I];k||(k=T.requests[I]=[],pf.loadGlyphRange(m,I,d,this.requestManager,(O,z)=>{if(z){T.ascender=z.ascender,T.descender=z.descender;for(const N in z.glyphs)this._doesCharSupportLocalGlyph(+N)||(T.glyphs[+N]=z.glyphs[+N]);T.ranges[I]=!0}for(const N of k)N(O,z);delete T.requests[I]})),k.push((O,z)=>{O?b(O):z&&b(null,{stack:m,id:y,glyph:z.glyphs[y]||null})})},(m,y)=>{if(m)a(m);else if(y){const b={};for(const{stack:T,id:E,glyph:I}of y)b[T]===void 0&&(b[T]={}),b[T].glyphs===void 0&&(b[T].glyphs={}),b[T].glyphs[E]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},b[T].ascender=this.entries[T].ascender,b[T].descender=this.entries[T].descender;a(null,b)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Tv.none&&(this.localGlyphMode===Tv.all?!!this.localFontFamily:!!this.localFontFamily&&(w["CJK Unified Ideographs"](e)||w["Hangul Syllables"](e)||w.Hiragana(e)||w.Katakana(e)||w["CJK Symbols and Punctuation"](e)||w["CJK Unified Ideographs Extension A"](e)||w["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,r,a){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let d=e.tinySDF;if(!d){let N="400";/bold/i.test(r)?N="900":/medium/i.test(r)?N="500":/light/i.test(r)&&(N="200"),d=e.tinySDF=new pf.TinySDF({fontFamily:u,fontWeight:N,fontSize:24*Ua,buffer:3*Ua,radius:8*Ua}),d.fontWeight=N}if(this.localGlyphs[d.fontWeight][a])return this.localGlyphs[d.fontWeight][a];const m=String.fromCodePoint(a),{data:y,width:b,height:T,glyphWidth:E,glyphHeight:I,glyphLeft:k,glyphTop:O,glyphAdvance:z}=d.draw(m);return this.localGlyphs[d.fontWeight][a]={id:a,bitmap:new oc({width:b,height:T},y),metrics:{width:E/Ua,height:I/Ua,left:k/Ua,top:O/Ua-27,advance:z/Ua,localGlyph:!0}}}}pf.loadGlyphRange=function(t,e,r,a,u){const d=256*e,m=d+255,y=a.transformRequest(a.normalizeGlyphsURL(r).replace("{fontstack}",t).replace("{range}",`${d}-${m}`),Wi.Glyphs);Er(y,(b,T)=>{if(b)u(b);else if(T){const E={},I=function(k){return new Mg(k).readFields(wO,{})}(T);for(const k of I.glyphs)E[k.id]=k;u(null,{glyphs:E,ascender:I.ascender,descender:I.descender})}})},pf.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:r=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:d="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=r;const y=this.size=t+4*e,b=this._createCanvas(y),T=this.ctx=b.getContext("2d",{willReadFrequently:!0});T.font=`${m} ${d} ${t}px ${u}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:d}=this.ctx.measureText(t),m=Math.ceil(r),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-u))),b=Math.min(this.size-this.buffer,m+Math.ceil(a)),T=y+2*this.buffer,E=b+2*this.buffer,I=Math.max(T*E,0),k=new Uint8ClampedArray(I),O={data:k,width:T,height:E,glyphWidth:y,glyphHeight:b,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(y===0||b===0)return O;const{ctx:z,buffer:N,gridInner:j,gridOuter:q}=this;z.clearRect(N,N,y,b),z.fillText(t,N,N+m);const ie=z.getImageData(N,N,y,b);q.fill(qd,0,I),j.fill(0,0,I);for(let oe=0;oe<b;oe++)for(let ae=0;ae<y;ae++){const he=ie.data[4*(oe*y+ae)+3]/255;if(he===0)continue;const me=(oe+N)*T+ae+N;if(he===1)q[me]=0,j[me]=qd;else{const Te=.5-he;q[me]=Te>0?Te*Te:0,j[me]=Te<0?Te*Te:0}}RS(q,0,0,T,E,T,this.f,this.v,this.z),RS(j,N,N,y,b,T,this.f,this.v,this.z);for(let oe=0;oe<I;oe++){const ae=Math.sqrt(q[oe])-Math.sqrt(j[oe]);k[oe]=Math.round(255-255*(ae/this.radius+this.cutoff))}return O}};const Zc=Ps;function FS(t,e,r,a){const u=[],d=t.imagePrimary,m=d.pixelRatio,y=d.paddedRect.w-2*Zc,b=d.paddedRect.h-2*Zc,T=t.right-t.left,E=t.bottom-t.top,I=d.stretchX||[[0,y]],k=d.stretchY||[[0,b]],O=(Fe,et)=>Fe+et[1]-et[0],z=I.reduce(O,0),N=k.reduce(O,0),j=y-z,q=b-N;let ie=0,oe=z,ae=0,he=N,me=0,Te=j,Pe=0,Re=q;if(d.content&&a){const Fe=d.content;ie=Cg(I,0,Fe[0]),ae=Cg(k,0,Fe[1]),oe=Cg(I,Fe[0],Fe[2]),he=Cg(k,Fe[1],Fe[3]),me=Fe[0]-ie,Pe=Fe[1]-ae,Te=Fe[2]-Fe[0]-oe,Re=Fe[3]-Fe[1]-he}const Ge=(Fe,et,bt,Je)=>{const gt=Pg(Fe.stretch-ie,oe,T,t.left),Ye=kg(Fe.fixed-me,Te,Fe.stretch,z),Vt=Pg(et.stretch-ae,he,E,t.top),$t=kg(et.fixed-Pe,Re,et.stretch,N),vt=Pg(bt.stretch-ie,oe,T,t.left),vi=kg(bt.fixed-me,Te,bt.stretch,z),ii=Pg(Je.stretch-ae,he,E,t.top),Ot=kg(Je.fixed-Pe,Re,Je.stretch,N),xi=new Ie(gt,Vt),ci=new Ie(vt,Vt),gi=new Ie(vt,ii),It=new Ie(gt,ii),Ei=new Ie(Ye/m,$t/m),en=new Ie(vi/m,Ot/m),Oi=e*Math.PI/180;if(Oi){const Un=Math.sin(Oi),xn=Math.cos(Oi),En=[xn,-Un,Un,xn];xi._matMult(En),ci._matMult(En),It._matMult(En),gi._matMult(En)}const Qi=Fe.stretch+Fe.fixed,dn=bt.stretch+bt.fixed,Vn=et.stretch+et.fixed,Hi=Je.stretch+Je.fixed,Qn=t.imageSecondary;return{tl:xi,tr:ci,bl:It,br:gi,texPrimary:{x:d.paddedRect.x+Zc+Qi,y:d.paddedRect.y+Zc+Vn,w:dn-Qi,h:Hi-Vn},texSecondary:Qn?{x:Qn.paddedRect.x+Zc+Qi,y:Qn.paddedRect.y+Zc+Vn,w:dn-Qi,h:Hi-Vn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ei,pixelOffsetBR:en,minFontScaleX:Te/m/T,minFontScaleY:Re/m/E,isSDF:r}};if(a&&(d.stretchX||d.stretchY)){const Fe=BS(I,j,z),et=BS(k,q,N);for(let bt=0;bt<Fe.length-1;bt++){const Je=Fe[bt],gt=Fe[bt+1];for(let Ye=0;Ye<et.length-1;Ye++)u.push(Ge(Je,et[Ye],gt,et[Ye+1]))}}else u.push(Ge({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:b+1}));return u}function Cg(t,e,r){let a=0;for(const u of t)a+=Math.max(e,Math.min(r,u[1]))-Math.max(e,Math.min(r,u[0]));return a}function BS(t,e,r){const a=[{fixed:-Zc,stretch:0}];for(const[u,d]of t){const m=a[a.length-1];a.push({fixed:u-m.stretch,stretch:m.stretch}),a.push({fixed:u-m.stretch,stretch:m.stretch+(d-u)})}return a.push({fixed:e+Zc,stretch:r}),a}function Pg(t,e,r,a){return t/e*r+a}function kg(t,e,r,a){return t-e*r/a}function PO(t,e,r,a){const u=e+t.positionedLines[a].lineOffset;return a===0?r+u/2:r+(u+(e+t.positionedLines[a-1].lineOffset))/2}function kO(t,e=1,r=!1){let a=1/0,u=1/0,d=-1/0,m=-1/0;const y=t[0];for(let O=0;O<y.length;O++){const z=y[O];(!O||z.x<a)&&(a=z.x),(!O||z.y<u)&&(u=z.y),(!O||z.x>d)&&(d=z.x),(!O||z.y>m)&&(m=z.y)}const b=Math.min(d-a,m-u);let T=b/2;const E=new Ia([],DO);if(b===0)return new Ie(a,u);for(let O=a;O<d;O+=b)for(let z=u;z<m;z+=b)E.push(new mf(O+T,z+T,T,t));let I=function(O){let z=0,N=0,j=0;const q=O[0];for(let ie=0,oe=q.length,ae=oe-1;ie<oe;ae=ie++){const he=q[ie],me=q[ae],Te=he.x*me.y-me.x*he.y;N+=(he.x+me.x)*Te,j+=(he.y+me.y)*Te,z+=3*Te}return new mf(N/z,j/z,0,O)}(t),k=E.length;for(;E.length;){const O=E.pop();(O.d>I.d||!I.d)&&(I=O,r&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,k)),O.max-I.d<=e||(T=O.h/2,E.push(new mf(O.p.x-T,O.p.y-T,T,t)),E.push(new mf(O.p.x+T,O.p.y-T,T,t)),E.push(new mf(O.p.x-T,O.p.y+T,T,t)),E.push(new mf(O.p.x+T,O.p.y+T,T,t)),k+=4)}return r&&(console.log(`num probes: ${k}`),console.log(`best distance: ${I.d}`)),I.p}function DO(t,e){return e.max-t.max}class mf{constructor(e,r,a,u){this.p=new Ie(e,r),this.h=a,this.d=function(d,m){let y=!1,b=1/0;for(let T=0;T<m.length;T++){const E=m[T];for(let I=0,k=E.length,O=k-1;I<k;O=I++){const z=E[I],N=E[O];z.y>d.y!=N.y>d.y&&d.x<(N.x-z.x)*(d.y-z.y)/(N.y-z.y)+z.x&&(y=!y),b=Math.min(b,NT(d,z,N))}}return(y?1:-1)*Math.sqrt(b)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const gf=7,Sv=Number.POSITIVE_INFINITY,LO=Math.sqrt(2);function NS(t,[e,r]){let a=0,u=0;if(r===Sv){e<0&&(e=0);const d=e/LO;switch(t){case"top-right":case"top-left":u=d-gf;break;case"bottom-right":case"bottom-left":u=-d+gf;break;case"bottom":u=-e+gf;break;case"top":u=e-gf}switch(t){case"top-right":case"bottom-right":a=-d;break;case"top-left":case"bottom-left":a=d;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),t){case"top-right":case"top-left":case"top":u=r-gf;break;case"bottom-right":case"bottom-left":case"bottom":u=-r+gf}switch(t){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,u]}function OO(t,e,r,a,u,d,m,y,b,T,E){t.createArrays(),t.tilePixelRatio=Mt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const I=t.layers[0].layout,k=t.layers[0]._unevaluatedLayout._values,O={};if(t.textSizeData.kind==="composite"){const{minZoom:q,maxZoom:ie}=t.textSizeData;O.compositeTextSizes=[k["text-size"].possiblyEvaluate(new be(q),y),k["text-size"].possiblyEvaluate(new be(ie),y)]}if(t.iconSizeData.kind==="composite"){const{minZoom:q,maxZoom:ie}=t.iconSizeData;O.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new be(q),y),k["icon-size"].possiblyEvaluate(new be(ie),y)]}O.layoutTextSize=k["text-size"].possiblyEvaluate(new be(b+1),y),O.layoutIconSize=k["icon-size"].possiblyEvaluate(new be(b+1),y),O.textMaxSize=k["text-size"].possiblyEvaluate(new be(18),y);const z=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",N=I.get("text-size");let j=!1;for(const q of t.features)if(q.icon&&q.icon.nameSecondary){j=!0;break}for(const q of t.features){const ie=I.get("text-font").evaluate(q,{},y).join(","),oe=N.evaluate(q,{},y),ae=O.layoutTextSize.evaluate(q,{},y),he=(O.layoutIconSize.evaluate(q,{},y),{horizontal:{},vertical:void 0}),me=q.text;let Te,Pe=[0,0];if(me){const Fe=me.toString(),et=I.get("text-letter-spacing").evaluate(q,{},y)*fo,bt=I.get("text-line-height").evaluate(q,{},y)*fo,Je=A(Fe)?et:0,gt=I.get("text-anchor").evaluate(q,{},y),Ye=I.get("text-variable-anchor");if(!Ye){const ii=I.get("text-radial-offset").evaluate(q,{},y);Pe=ii?NS(gt,[ii*fo,Sv]):I.get("text-offset").evaluate(q,{},y).map(Ot=>Ot*fo)}let Vt=z?"center":I.get("text-justify").evaluate(q,{},y);const $t=I.get("symbol-placement")==="point",vt=$t?I.get("text-max-width").evaluate(q,{},y)*fo:1/0,vi=ii=>{t.allowVerticalPlacement&&S(Fe)&&(he.vertical=vv(me,e,r,u,ie,vt,bt,gt,ii,Je,Pe,Ks.vertical,!0,ae,oe))};if(!z&&Ye){const ii=Vt==="auto"?Ye.map(xi=>Mv(xi)):[Vt];let Ot=!1;for(let xi=0;xi<ii.length;xi++){const ci=ii[xi];if(!he.horizontal[ci])if(Ot)he.horizontal[ci]=he.horizontal[0];else{const gi=vv(me,e,r,u,ie,vt,bt,"center",ci,Je,Pe,Ks.horizontal,!1,ae,oe);gi&&(he.horizontal[ci]=gi,Ot=gi.positionedLines.length===1)}}vi("left")}else{if(Vt==="auto"&&(Vt=Mv(gt)),$t||I.get("text-writing-mode").indexOf("horizontal")>=0||!S(Fe)){const ii=vv(me,e,r,u,ie,vt,bt,gt,Vt,Je,Pe,Ks.horizontal,!1,ae,oe);ii&&(he.horizontal[Vt]=ii)}vi($t?"left":Vt)}}let Re=!1;if(q.icon&&q.icon.namePrimary){const Fe=a[q.icon.namePrimary];Fe&&(Te=AO(u[q.icon.namePrimary],q.icon.nameSecondary?u[q.icon.nameSecondary]:void 0,I.get("icon-offset").evaluate(q,{},y),I.get("icon-anchor").evaluate(q,{},y)),Re=Fe.sdf,t.sdfIcons===void 0?t.sdfIcons=Fe.sdf:t.sdfIcons!==Fe.sdf&&si("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Fe.pixelRatio!==t.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Ge=US(he.horizontal)||he.vertical;t.iconsInText||(t.iconsInText=!!Ge&&Ge.iconsInText),(Ge||Te)&&RO(t,q,he,Te,a,O,ae,0,Pe,Re,m,y,T,E,j)}d&&t.generateCollisionDebugBuffers(b,t.collisionBoxArray)}function Mv(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function RO(t,e,r,a,u,d,m,y,b,T,E,I,k,O,z){let N=d.textMaxSize.evaluate(e,{},I);N===void 0&&(N=m);const j=t.layers[0].layout,q=j.get("icon-offset").evaluate(e,{},I),ie=US(r.horizontal)||r.vertical,oe=k.name==="globe",ae=fo,he=m/ae,me=t.tilePixelRatio*N/ae,Te=(gt=t.overscaling,t.zoom>18&&gt>2&&(gt>>=1),Math.max(Mt/(512*gt),1)*j.get("symbol-spacing")),Pe=j.get("text-padding")*t.tilePixelRatio,Re=j.get("icon-padding")*t.tilePixelRatio,Ge=Xe(j.get("text-max-angle")),Fe=j.get("text-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",et=j.get("icon-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",bt=j.get("symbol-placement"),Je=Te/2;var gt;const Ye=j.get("icon-text-fit").evaluate(e,{},I),Vt=j.get("icon-text-fit-padding").evaluate(e,{},I),$t=Ye!=="none";let vt;t.hasAnyIconTextFit===!1&&$t&&(t.hasAnyIconTextFit=!0),a&&$t&&(t.allowVerticalPlacement&&r.vertical&&(vt=AS(a,r.vertical,Ye,Vt,q,he)),ie&&(a=AS(a,ie,Ye,Vt,q,he)));const vi=(ii,Ot,xi)=>{if(Ot.x<0||Ot.x>=Mt||Ot.y<0||Ot.y>=Mt)return;let ci=null;if(oe){const{x:gi,y:It,z:Ei}=k.projectTilePoint(Ot.x,Ot.y,xi);ci={anchor:new ac(gi,It,Ei,0,void 0),up:k.upVector(xi,Ot.x,Ot.y)}}(function(gi,It,Ei,en,Oi,Qi,dn,Vn,Hi,Qn,Un,xn,En,pn,gr,$n,wr,eo,Ko,Cr,yr,Oo,Ro,Qo,er,Ha,xf){const cc=gi.addToLineVertexArray(It,en);let uc,hp,fp,t_,aE,lE,cE,uE=0,hE=0,fE=0,dE=0,$v=-1,ex=-1;const vl={};let pE=b0("");const hh=Ei?Ei.anchor:It,tx=Hi.layout.get("icon-text-fit").evaluate(yr,{},er)!=="none";let ix=0,nx=0;if(Hi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[ix,nx]=Hi.layout.get("text-offset").evaluate(yr,{},er).map(ks=>ks*fo):(ix=Hi.layout.get("text-radial-offset").evaluate(yr,{},er)*fo,nx=Sv),gi.allowVerticalPlacement&&Oi.vertical){const ks=Oi.vertical;if(gr)lE=Ev(ks),Vn&&(cE=Ev(Vn));else{const Ds=Hi.layout.get("text-rotate").evaluate(yr,{},er)+90;fp=Dg(Qn,hh,It,Un,xn,En,ks,pn,Ds,$n),Vn&&(t_=Dg(Qn,hh,It,Un,xn,En,Vn,eo,Ds))}}if(Qi){const ks=Hi.layout.get("icon-rotate").evaluate(yr,{},er),Ds=FS(Qi,ks,Ro,tx),bf=Vn?FS(Vn,ks,Ro,tx):void 0;hp=Dg(Qn,hh,It,Un,xn,En,Qi,eo,ks),uE=4*Ds.length;const mE=gi.iconSizeData;let fh=null;mE.kind==="source"?(fh=[Va*Hi.layout.get("icon-size").evaluate(yr,{},er)],fh[0]>Xc&&si(`${gi.layerIds[0]}: Value for "icon-size" is >= ${Zd}. Reduce your "icon-size".`)):mE.kind==="composite"&&(fh=[Va*Oo.compositeIconSizes[0].evaluate(yr,{},er),Va*Oo.compositeIconSizes[1].evaluate(yr,{},er)],(fh[0]>Xc||fh[1]>Xc)&&si(`${gi.layerIds[0]}: Value for "icon-size" is >= ${Zd}. Reduce your "icon-size".`)),gi.addSymbols(gi.icon,Ds,fh,Cr,Ko,yr,!1,Ei,It,cc.lineStartIndex,cc.lineLength,-1,Qo,er,Ha,xf),$v=gi.icon.placedSymbolArray.length-1,bf&&(hE=4*bf.length,gi.addSymbols(gi.icon,bf,fh,Cr,Ko,yr,Ks.vertical,Ei,It,cc.lineStartIndex,cc.lineLength,-1,Qo,er,Ha,xf),ex=gi.icon.placedSymbolArray.length-1)}for(const ks in Oi.horizontal){const Ds=Oi.horizontal[ks];uc||(pE=b0(Ds.text),gr?aE=Ev(Ds):uc=Dg(Qn,hh,It,Un,xn,En,Ds,pn,Hi.layout.get("text-rotate").evaluate(yr,{},er),$n));const bf=Ds.positionedLines.length===1;if(fE+=VS(gi,Ei,It,Ds,dn,Hi,gr,yr,$n,cc,Oi.vertical?Ks.horizontal:Ks.horizontalOnly,bf?Object.keys(Oi.horizontal):[ks],vl,$v,Oo,Qo,er,Ha),bf)break}Oi.vertical&&(dE+=VS(gi,Ei,It,Oi.vertical,dn,Hi,gr,yr,$n,cc,Ks.vertical,["vertical"],vl,ex,Oo,Qo,er,Ha));let iu=-1;const rx=(ks,Ds)=>ks?Math.max(ks,Ds):Ds;iu=rx(aE,iu),iu=rx(lE,iu),iu=rx(cE,iu);const JR=iu>-1?1:0;gi.glyphOffsetArray.length>=Qd.MAX_GLYPHS&&si("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),yr.sortKey!==void 0&&gi.addToSortKeyRanges(gi.symbolInstances.length,yr.sortKey),gi.symbolInstances.emplaceBack(It.x,It.y,hh.x,hh.y,hh.z,vl.right>=0?vl.right:-1,vl.center>=0?vl.center:-1,vl.left>=0?vl.left:-1,vl.vertical>=0?vl.vertical:-1,$v,ex,pE,uc!==void 0?uc:gi.collisionBoxArray.length,uc!==void 0?uc+1:gi.collisionBoxArray.length,fp!==void 0?fp:gi.collisionBoxArray.length,fp!==void 0?fp+1:gi.collisionBoxArray.length,hp!==void 0?hp:gi.collisionBoxArray.length,hp!==void 0?hp+1:gi.collisionBoxArray.length,t_||gi.collisionBoxArray.length,t_?t_+1:gi.collisionBoxArray.length,Un,fE,dE,uE,hE,JR,0,ix,nx,iu,0,tx?1:0)})(t,Ot,ci,ii,r,a,u,vt,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,Pe,Fe,b,0,Re,et,q,e,d,T,E,I,O,z)};if(bt==="line")for(const ii of LS(e.geometry,0,0,Mt,Mt)){const Ot=CO(ii,Te,Ge,r.vertical||ie,a,ae,me,t.overscaling,Mt);for(const xi of Ot)ie&&zO(t,ie.text,Je,xi)||vi(ii,xi,I)}else if(bt==="line-center"){for(const ii of e.geometry)if(ii.length>1){const Ot=IO(ii,Ge,r.vertical||ie,a,ae,me);Ot&&vi(ii,Ot,I)}}else if(e.type==="Polygon")for(const ii of hv(e.geometry,0)){const Ot=kO(ii,16);vi(ii[0],new ac(Ot.x,Ot.y,0,0,void 0),I)}else if(e.type==="LineString")for(const ii of e.geometry)vi(ii,new ac(ii[0].x,ii[0].y,0,0,void 0),I);else if(e.type==="Point")for(const ii of e.geometry)for(const Ot of ii)vi([Ot],new ac(Ot.x,Ot.y,0,0,void 0),I)}const Zd=255,Xc=Zd*Va;function VS(t,e,r,a,u,d,m,y,b,T,E,I,k,O,z,N,j,q){const ie=function(he,me,Te,Pe,Re,Ge,Fe,et){const bt=[];if(me.positionedLines.length===0)return bt;const Je=Pe.layout.get("text-rotate").evaluate(Ge,{})*Math.PI/180,gt=function(vi){const ii=vi[0],Ot=vi[1],xi=ii*Ot;return xi>0?[ii,-Ot]:xi<0?[-ii,Ot]:ii===0?[Ot,ii]:[Ot,-ii]}(Te);let Ye=Math.abs(me.top-me.bottom);for(const vi of me.positionedLines)Ye-=vi.lineOffset;const Vt=me.positionedLines.length,$t=Ye/Vt;let vt=me.top-Te[1];for(let vi=0;vi<Vt;++vi){const ii=me.positionedLines[vi];vt=PO(me,$t,vt,vi);for(const Ot of ii.positionedGlyphs){if(!Ot.rect)continue;const xi=Ot.rect||{};let ci=xS+1,gi=!0,It=1,Ei=0;if(Ot.imageName){const Cr=Fe[Ot.imageName];if(!Cr)continue;if(Cr.sdf){si("SDF images are not supported in formatted text and will be ignored.");continue}gi=!1,It=Cr.pixelRatio,ci=Ps/It}const en=(Re||et)&&Ot.vertical,Oi=Ot.metrics.advance*Ot.scale/2,Qi=Ot.metrics,dn=Ot.rect;if(dn===null)continue;et&&me.verticalizable&&(Ei=Ot.imageName?Oi-Ot.metrics.width*Ot.scale/2:0);const Vn=Re?[Ot.x+Oi,Ot.y]:[0,0];let Hi=[0,0],Qn=[0,0],Un=!1;Re||(en?(Qn=[Ot.x+Oi+gt[0],Ot.y+gt[1]-Ei],Un=!0):Hi=[Ot.x+Oi+Te[0],Ot.y+Te[1]-Ei]);const xn=dn.w*Ot.scale/(It*(Ot.localGlyph?Ua:1)),En=dn.h*Ot.scale/(It*(Ot.localGlyph?Ua:1));let pn,gr,$n,wr;if(en){const Cr=Ot.y-vt,yr=new Ie(-Oi,Oi-Cr),Oo=-Math.PI/2,Ro=new Ie(...Qn);pn=new Ie(-Oi+Hi[0],Hi[1]),pn._rotateAround(Oo,yr)._add(Ro),pn.x+=-Cr+Oi,pn.y-=(Qi.left-ci)*Ot.scale;const Qo=Ot.imageName?Qi.advance*Ot.scale:fo*Ot.scale,er=String.fromCodePoint(Ot.glyph);xO(er)?pn.x+=(1-ci)*Ot.scale:bO(er)?pn.x+=Qo-Qi.height*Ot.scale+(-ci-1)*Ot.scale:pn.x+=Ot.imageName||Qi.width+2*ci===dn.w&&Qi.height+2*ci===dn.h?(Qo-En)/2:(Qo-(Qi.height+2*ci)*Ot.scale)/2,gr=new Ie(pn.x,pn.y-xn),$n=new Ie(pn.x+En,pn.y),wr=new Ie(pn.x+En,pn.y-xn)}else{const Cr=(Qi.left-ci)*Ot.scale-Oi+Hi[0],yr=(-Qi.top-ci)*Ot.scale+Hi[1],Oo=Cr+xn,Ro=yr+En;pn=new Ie(Cr,yr),gr=new Ie(Oo,yr),$n=new Ie(Cr,Ro),wr=new Ie(Oo,Ro)}if(Je){let Cr;Cr=Re?new Ie(0,0):Un?new Ie(gt[0],gt[1]):new Ie(Te[0],Te[1]),pn._rotateAround(Je,Cr),gr._rotateAround(Je,Cr),$n._rotateAround(Je,Cr),wr._rotateAround(Je,Cr)}const eo=new Ie(0,0),Ko=new Ie(0,0);bt.push({tl:pn,tr:gr,bl:$n,br:wr,texPrimary:xi,texSecondary:void 0,writingMode:me.writingMode,glyphOffset:Vn,sectionIndex:Ot.sectionIndex,isSDF:gi,pixelOffsetTL:eo,pixelOffsetBR:Ko,minFontScaleX:0,minFontScaleY:0})}}return bt}(0,a,b,d,m,y,u,t.allowVerticalPlacement),oe=t.textSizeData;let ae=null;oe.kind==="source"?(ae=[Va*d.layout.get("text-size").evaluate(y,{},j)],ae[0]>Xc&&si(`${t.layerIds[0]}: Value for "text-size" is >= ${Zd}. Reduce your "text-size".`)):oe.kind==="composite"&&(ae=[Va*z.compositeTextSizes[0].evaluate(y,{},j),Va*z.compositeTextSizes[1].evaluate(y,{},j)],(ae[0]>Xc||ae[1]>Xc)&&si(`${t.layerIds[0]}: Value for "text-size" is >= ${Zd}. Reduce your "text-size".`)),t.addSymbols(t.text,ie,ae,b,m,y,E,e,r,T.lineStartIndex,T.lineLength,O,N,j,q,!1);for(const he of I)k[he]=t.text.placedSymbolArray.length-1;return 4*ie.length}function US(t){for(const e in t)return t[e];return null}function Dg(t,e,r,a,u,d,m,y,b,T){let E=m.top,I=m.bottom,k=m.left,O=m.right;const z=m.collisionPadding;if(z&&(k-=z[0],E-=z[1],O+=z[2],I+=z[3]),b){const N=new Ie(k,E),j=new Ie(O,E),q=new Ie(k,I),ie=new Ie(O,I),oe=Xe(b);let ae=new Ie(0,0);T&&(ae=new Ie(T[0],T[1])),N._rotateAround(oe,ae),j._rotateAround(oe,ae),q._rotateAround(oe,ae),ie._rotateAround(oe,ae),k=Math.min(N.x,j.x,q.x,ie.x),O=Math.max(N.x,j.x,q.x,ie.x),E=Math.min(N.y,j.y,q.y,ie.y),I=Math.max(N.y,j.y,q.y,ie.y)}return t.emplaceBack(e.x,e.y,e.z,r.x,r.y,k,E,O,I,y,a,u,d),t.length-1}function Ev(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function zO(t,e,r,a){const u=t.compareText;if(e in u){const d=u[e];for(let m=d.length-1;m>=0;m--)if(a.dist(d[m])<r)return!0}else u[e]=[];return u[e].push(a),!1}function jS(t,e){const r=t.fovAboveCenter,a=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,u=(t._camera.position[2]*t.worldSize-a)/Math.cos(t._pitch),d=Math.sin(r)*u/Math.sin(Math.max(Math.PI/2-t._pitch-r,.01)),m=Math.sin(t._pitch)*d+u;return Math.min(1.01*m,u*(1/t._horizonShift))}function Yc(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const r=Math.pow(2,-t.z),a=t.x*r,u=(t.x+1)*r,d=t.y*r,m=(t.y+1)*r,y=Cs(a),b=Cs(u),T=ho(d),E=ho(m),I=e.project(y,T),k=e.project(b,T),O=e.project(b,E),z=e.project(y,E);let N=Math.min(I.x,k.x,O.x,z.x),j=Math.min(I.y,k.y,O.y,z.y),q=Math.max(I.x,k.x,O.x,z.x),ie=Math.max(I.y,k.y,O.y,z.y);const oe=r/16;function ae(me,Te,Pe,Re,Ge,Fe){const et=(Pe+Ge)/2,bt=(Re+Fe)/2,Je=e.project(Cs(et),ho(bt)),gt=Math.max(0,N-Je.x,j-Je.y,Je.x-q,Je.y-ie);N=Math.min(N,Je.x),q=Math.max(q,Je.x),j=Math.min(j,Je.y),ie=Math.max(ie,Je.y),gt>oe&&(ae(me,Je,Pe,Re,et,bt),ae(Je,Te,et,bt,Ge,Fe))}ae(I,k,a,d,u,d),ae(k,O,u,d,u,m),ae(O,z,u,m,a,m),ae(z,I,a,m,a,d),N-=oe,j-=oe,q+=oe,ie+=oe;const he=1/Math.max(q-N,ie-j);return{scale:he,x:N*he,y:j*he,x2:q*he,y2:ie*he,projection:e}}function GS(t,{x:e,y:r},a=0){return new Ie(((e-a)*t.scale-t.x)*Mt,(r*t.scale-t.y)*Mt)}const FO=s.m.identity(new Float32Array(16));class Jc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new vn(0,0)}projectTilePoint(e,r,a){return{x:e,y:r,z:0}}locationPoint(e,r,a=!0){return e._coordinatePoint(e.locationCoordinate(r),a)}pixelsPerMeter(e,r){return Jo(1,e)*r}pixelSpaceConversion(e,r,a){return 1}farthestPixelDistance(e){return jS(e,e.pixelsPerMeter)}pointCoordinate(e,r,a,u){const d=e.horizonLineFromTop(!1),m=new Ie(r,Math.max(d,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,u))}pointCoordinate3D(e,r,a){const u=new Ie(r,a);if(e.elevation)return e.elevation.pointCoordinate(u);{const d=this.pointCoordinate(e,u.x,u.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,r){if(e.elevation)return!this.pointCoordinate3D(e,r.x,r.y);const a=e.horizonLineFromTop();return r.y<a}createInversionMatrix(e,r){return FO}createTileMatrix(e,r,a){let u,d,m;const y=a.canonical,b=s.m.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const T=Yc(y,this);u=1,d=T.x+a.wrap*T.scale,m=T.y,s.m.scale(b,b,[u/T.scale,u/T.scale,e.pixelsPerMeter/r])}else u=r/e.zoomScale(y.z),d=(y.x+Math.pow(2,y.z)*a.wrap)*u,m=y.y*u;return s.m.translate(b,b,[d,m,0]),s.m.scale(b,b,[u/Mt,u/Mt,1]),b}upVector(e,r,a){return[0,0,1]}upVectorScale(e,r,a){return{metersToTile:1}}}class BO extends Jc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,a]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(Xe(r));this.n=(u+Math.sin(Xe(a)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:a,c:u,r0:d}=this,m=Xe(e-this.center[0]),y=Xe(r),b=Math.sqrt(u-2*a*Math.sin(y))/a;return{x:b*Math.sin(m*a),y:b*Math.cos(m*a)-d,z:0}}unproject(e,r){const{n:a,c:u,r0:d}=this,m=d+r;let y=Math.atan2(e,Math.abs(m))*Math.sign(m);m*a<0&&(y-=Math.PI*Math.sign(e)*Math.sign(m));const b=Xe(this.center[0])*a;y=Ui(y,-Math.PI-b,Math.PI-b);const T=wt(Tt(y/a)+this.center[0],-180,180),E=Math.asin(wt((u-(e*e+m*m)*a*a)/(2*a),-1,1)),I=wt(Tt(E),-br,br);return new vn(T,I)}}const Xd=1.340264,Yd=-.081106,Jd=893e-6,Kd=.003796,Lg=Math.sqrt(3)/2;class NO extends Jc{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(Lg*Math.sin(r)),u=a*a,d=u*u*u;return{x:.5*(e*Math.cos(a)/(Lg*(Xd+3*Yd*u+d*(7*Jd+9*Kd*u)))/Math.PI+.5),y:1-.5*(a*(Xd+Yd*u+d*(Jd+Kd*u))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,u=a*a,d=u*u*u;for(let E,I,k,O=0;O<12&&(I=a*(Xd+Yd*u+d*(Jd+Kd*u))-r,k=Xd+3*Yd*u+d*(7*Jd+9*Kd*u),E=I/k,a=wt(a-E,-Math.PI/3,Math.PI/3),u=a*a,d=u*u*u,!(Math.abs(E)<1e-12));++O);const m=Lg*e*(Xd+3*Yd*u+d*(7*Jd+9*Kd*u))/Math.cos(a),y=Math.asin(Math.sin(a)/Lg),b=wt(180*m/Math.PI,-180,180),T=wt(180*y/Math.PI,-br,br);return new vn(b,T)}}class VO extends Jc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const a=360*(e-.5),u=wt(360*(.5-r),-br,br);return new vn(a,u)}}const _f=Math.PI/2;function Og(t){return Math.tan((_f+t)/2)}class UO extends Jc{constructor(e){super(e),this.center=e.center||[0,30];const[r,a]=this.parallels=e.parallels||[30,30];let u=Xe(r),d=Xe(a);this.southernCenter=u+d<0,this.southernCenter&&(u=-u,d=-d);const m=Math.cos(u),y=Og(u);this.n=u===d?Math.sin(u):Math.log(m/Math.cos(d))/Math.log(Og(d)/y),this.f=m*Math.pow(Og(u),this.n)/this.n}project(e,r){r=Xe(r),this.southernCenter&&(r=-r),e=Xe(e-this.center[0]);const a=1e-6,{n:u,f:d}=this;d>0?r<-_f+a&&(r=-_f+a):r>_f-a&&(r=_f-a);const m=d/Math.pow(Og(r),u);let y=m*Math.sin(u*e),b=d-m*Math.cos(u*e);return y=.5*(y/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:y,y:this.southernCenter?b:1-b,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:a,f:u}=this,d=u-r,m=Math.sign(d),y=Math.sign(a)*Math.sqrt(e*e+d*d);let b=Math.atan2(e,Math.abs(d))*m;d*a<0&&(b-=Math.PI*Math.sign(e)*m);const T=wt(Tt(b/a)+this.center[0],-180,180),E=wt(Tt(2*Math.atan(Math.pow(u/y,1/a))-_f),-br,br);return new vn(T,this.southernCenter?-E:E)}}class HS extends Jc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:pl(e),y:ml(r),z:0}}unproject(e,r){const a=Cs(e),u=ho(r);return new vn(a,u)}}const WS=Xe(br);class jO extends Jc{project(e,r){const a=(r=Xe(r))*r,u=a*a;return{x:.5*((e=Xe(e))*(.8707-.131979*a+u*(u*(.003971*a-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+a*(.015085+u*(.028874*a-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,u=25,d=0,m=a*a;do{m=a*a;const T=m*m;d=(a*(1.007226+m*(.015085+T*(.028874*m-.044475-.005916*T)))-r)/(1.007226+m*(.045255+T*(.259866*m-.311325-.005916*11*T))),a=wt(a-d,-WS,WS)}while(Math.abs(d)>1e-6&&--u>0);m=a*a;const y=wt(Tt(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),b=Tt(a);return new vn(y,b)}}const qS=Xe(br);class GO extends Jc{project(e,r){r=Xe(r),e=Xe(e);const a=Math.cos(r),u=2/Math.PI,d=Math.acos(a*Math.cos(e/2)),m=Math.sin(d)/d,y=.5*(e*u+2*a*Math.sin(e/2)/m)||0,b=.5*(r+Math.sin(r)/m)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,r){let a=e=(2*e-.5)*Math.PI,u=r=(2*(1-r)-1)*Math.PI,d=25;const m=1e-6;let y=0,b=0;do{const T=Math.cos(u),E=Math.sin(u),I=2*E*T,k=E*E,O=T*T,z=Math.cos(a/2),N=Math.sin(a/2),j=2*z*N,q=N*N,ie=1-O*z*z,oe=ie?1/ie:0,ae=ie?Math.acos(T*z)*Math.sqrt(1/ie):0,he=.5*(2*ae*T*N+2*a/Math.PI)-e,me=.5*(ae*E+u)-r,Te=.5*oe*(O*q+ae*T*z*k)+1/Math.PI,Pe=oe*(j*I/4-ae*E*N),Re=.125*oe*(I*N-ae*E*O*j),Ge=.5*oe*(k*z+ae*q*T)+.5,Fe=Pe*Re-Ge*Te;y=(me*Pe-he*Ge)/Fe,b=(he*Re-me*Te)/Fe,a=wt(a-y,-Math.PI,Math.PI),u=wt(u-b,-qS,qS)}while((Math.abs(y)>m||Math.abs(b)>m)&&--d>0);return new vn(Tt(a),Tt(u))}}class ZS extends Jc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Xe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:a,cosPhi:u}=this;return{x:Xe(e)*u*a+.5,y:-Math.sin(Xe(r))/u*a+.5,z:0}}unproject(e,r){const{scale:a,cosPhi:u}=this,d=-(r-.5)/a,m=wt(Tt((e-.5)/a)/u,-180,180),y=Math.asin(wt(d*u,-1,1)),b=wt(Tt(y),-br,br);return new vn(m,b)}}class HO extends HS{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,a){const u=Bd(e,r,a),d=Nd(dl(a));return s.v.transformMat4(u,u,d),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,r){const a=ih(r.lat,r.lng),u=s.v.normalize([],a),d=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude,m=Jo(1,0)*Mt*d;s.v.scaleAndAdd(a,a,u,m);const y=s.m.identity(new Float64Array(16));return s.m.multiply(y,e.pixelMatrix,e.globeMatrix),s.v.transformMat4(a,a,y),new Ie(a[0],a[1])}pixelsPerMeter(e,r){return Jo(1,0)*r}pixelSpaceConversion(e,r,a){const u=Jo(1,e)*r,d=Gi(Jo(1,45)*r,u,a);return this.pixelsPerMeter(e,r)/d}createTileMatrix(e,r,a){const u=X0(dl(a.canonical));return s.m.multiply(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,r){const{center:a}=e,u=Nd(dl(r));return s.m.rotateY(u,u,Xe(a.lng)),s.m.rotateX(u,u,Xe(a.lat)),s.m.scale(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,r,a,u){return TT(e,r,a,!0)||new To(0,0)}pointCoordinate3D(e,r,a){const u=this.pointCoordinate(e,r,a,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,r){return!TT(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(u,d){const m=u.cameraToCenterDistance,y=u._centerAltitude*d,b=u._camera,T=u._camera.forward(),E=s.v.add([],s.v.scale([],T,-m),[0,0,y]),I=u.worldSize/(2*Math.PI),k=[0,0,-I],O=u.width/u.height,z=Math.tan(u.fovAboveCenter),N=s.v.scale([],b.up(),z),j=s.v.scale([],b.right(),z*O),q=s.v.normalize([],s.v.add([],s.v.add([],T,N),j)),ie=[];let oe;if(new U0(E,q).closestPointOnSphere(k,I,ie)){const ae=s.v.add([],ie,k),he=s.v.sub([],ae,E);oe=Math.cos(u.fovAboveCenter)*s.v.length(he)}else{const ae=s.v.sub([],E,k),he=s.v.sub([],k,E);s.v.normalize(he,he);const me=s.v.length(ae)-I;oe=Math.sqrt(me*(me+2*I));const Te=Math.acos(oe/(I+me))-Math.acos(s.v.dot(T,he));oe*=Math.cos(Te)}return 1.01*oe}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=rc(e.zoom);if(a>0){const u=jS(e,Jo(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Gi(r,u+d*(1-Math.cos(m)),Math.pow(a,10))}return r}upVector(e,r,a){return Bd(r,a,e,1)}upVectorScale(e){return{metersToTile:sg(lg(dl(e)))}}}function XS(t){const e=t.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new HS(t);case"equirectangular":return new VO(t);case"naturalEarth":return new jO(t);case"equalEarth":return new NO(t);case"winkelTripel":return new GO(t);case"albers":return r?new ZS(t):new BO(t);case"lambertConformalConic":return r?new ZS(t):new UO(t);case"globe":return new HO(t)}throw new Error(`Invalid projection name: ${t.name}`)}const WO=new ut({"symbol-placement":new de(Be.layout_symbol["symbol-placement"]),"symbol-spacing":new de(Be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new de(Be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ze(Be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new de(Be.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new de(Be.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new de(Be.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new de(Be.layout_symbol["icon-ignore-placement"]),"icon-optional":new de(Be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new de(Be.layout_symbol["icon-rotation-alignment"]),"icon-size":new ze(Be.layout_symbol["icon-size"]),"icon-text-fit":new ze(Be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ze(Be.layout_symbol["icon-text-fit-padding"]),"icon-image":new ze(Be.layout_symbol["icon-image"]),"icon-rotate":new ze(Be.layout_symbol["icon-rotate"]),"icon-padding":new de(Be.layout_symbol["icon-padding"]),"icon-keep-upright":new de(Be.layout_symbol["icon-keep-upright"]),"icon-offset":new ze(Be.layout_symbol["icon-offset"]),"icon-anchor":new ze(Be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new de(Be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new de(Be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new de(Be.layout_symbol["text-rotation-alignment"]),"text-field":new ze(Be.layout_symbol["text-field"]),"text-font":new ze(Be.layout_symbol["text-font"]),"text-size":new ze(Be.layout_symbol["text-size"]),"text-max-width":new ze(Be.layout_symbol["text-max-width"]),"text-line-height":new ze(Be.layout_symbol["text-line-height"]),"text-letter-spacing":new ze(Be.layout_symbol["text-letter-spacing"]),"text-justify":new ze(Be.layout_symbol["text-justify"]),"text-radial-offset":new ze(Be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new de(Be.layout_symbol["text-variable-anchor"]),"text-anchor":new ze(Be.layout_symbol["text-anchor"]),"text-max-angle":new de(Be.layout_symbol["text-max-angle"]),"text-writing-mode":new de(Be.layout_symbol["text-writing-mode"]),"text-rotate":new ze(Be.layout_symbol["text-rotate"]),"text-padding":new de(Be.layout_symbol["text-padding"]),"text-keep-upright":new de(Be.layout_symbol["text-keep-upright"]),"text-transform":new ze(Be.layout_symbol["text-transform"]),"text-offset":new ze(Be.layout_symbol["text-offset"]),"text-allow-overlap":new de(Be.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new de(Be.layout_symbol["text-ignore-placement"]),"text-optional":new de(Be.layout_symbol["text-optional"]),visibility:new de(Be.layout_symbol.visibility)});var Av={paint:new ut({"icon-opacity":new ze(Be.paint_symbol["icon-opacity"]),"icon-emissive-strength":new ze(Be.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ze(Be.paint_symbol["text-emissive-strength"]),"icon-color":new ze(Be.paint_symbol["icon-color"]),"icon-halo-color":new ze(Be.paint_symbol["icon-halo-color"]),"icon-halo-width":new ze(Be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ze(Be.paint_symbol["icon-halo-blur"]),"icon-translate":new de(Be.paint_symbol["icon-translate"]),"icon-translate-anchor":new de(Be.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ze(Be.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ze(Be.paint_symbol["text-opacity"]),"text-color":new ze(Be.paint_symbol["text-color"],{runtimeType:le,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new ze(Be.paint_symbol["text-halo-color"]),"text-halo-width":new ze(Be.paint_symbol["text-halo-width"]),"text-halo-blur":new ze(Be.paint_symbol["text-halo-blur"]),"text-translate":new de(Be.paint_symbol["text-translate"]),"text-translate-anchor":new de(Be.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new de(Be.paint_symbol["icon-color-saturation"])}),layout:WO};class YS{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Sa,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ei(YS,"FormatSectionOverride",{omit:["defaultValue"]});class Rg extends Jt{constructor(e,r,a){super(e,Av,r,a)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const u=[];for(const d of a)u.indexOf(d)<0&&u.push(d);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,a,u){const d=this.layout.get(e).evaluate(r,{},a,u),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||Hh(m.value)||!d?d:function(y,b){return b.replace(/{([^{}]+)}/g,(T,E)=>E in y?String(y[E]):"")}(r.properties,d)}createBucket(e){return new Qd(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Av.paint.overridableProperties){if(!Rg.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),a=new YS(r),u=new xd(a,r.property.specification,this.scope,this.options);let d=null;d=r.value.kind==="constant"||r.value.kind==="source"?new Hu("source",u):new Wu("composite",u,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new He(r.property,d,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&Rg.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const a=e.get("text-field"),u=Av.paint.properties[r];let d=!1;const m=y=>{for(const b of y)if(u.overrides&&u.overrides.hasOverride(b))return void(d=!0)};if(a.value.kind==="constant"&&a.value.value instanceof ao)m(a.value.value.sections);else if(a.value.kind==="source"){const y=T=>{d||(T instanceof Ea&&xr(T.value)===Ve?m(T.value.sections):T instanceof tl?m(T.sections):T.eachChild(y))},b=a.value;b._styleExpression&&y(b._styleExpression.expression)}return d}getProgramIds(){const e=this.paint.get("icon-opacity").constantOr(1)!==0,r=this.paint.get("text-opacity").constantOr(1)!==0,a=[];return e&&a.push("symbolIcon"),r&&a.push("symbolSDF"),a}getDefaultProgramParams(e,r){return{config:new Qu(this,r),overrideFog:!1}}}const qO=bg.types,ZO=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function zg(t,e,r,a,u,d,m,y,b,T,E,I,k){const O=y?Math.min(Xc,Math.round(y[0])):0,z=y?Math.min(Xc,Math.round(y[1])):0;t.emplaceBack(e,r,Math.round(32*a),Math.round(32*u),d,m,(O<<1)+(b?1:0),z,16*T,16*E,256*I,256*k)}function Fg(t,e,r){t.emplaceBack(e,r)}function Bg(t,e,r,a,u,d,m){t.emplaceBack(e,r,a,u,d,m)}function Ng(t,e,r,a,u){t.emplaceBack(e,r,a,u),t.emplaceBack(e,r,a,u),t.emplaceBack(e,r,a,u),t.emplaceBack(e,r,a,u)}function XO(t){for(const e of t.sections)if(Z(e.text))return!0;return!1}class Iv{constructor(e){this.layoutVertexArray=new Kr,this.indexArray=new An,this.programConfigurations=e,this.segments=new or,this.dynamicLayoutVertexArray=new yn,this.opacityVertexArray=new co,this.placedSymbolArray=new Ub,this.iconTransitioningVertexArray=new Lo,this.globeExtVertexArray=new Hn,this.zOffsetVertexArray=new za}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,r,a,u,d){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,uO.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,fO.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ZO,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,pO.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,hO.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,dO.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}ei(Iv,"SymbolBuffers");class Cv{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new or,this.collisionVertexArray=new Ws,this.collisionVertexArrayExt=new yn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,mO.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,gO.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ei(Cv,"CollisionBuffers");class Vg{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=s.m.identity([]),this.placementViewportMatrix=s.m.identity([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=_v(this.zoom,r["text-size"]),this.iconSizeData=_v(this.zoom,r["icon-size"]);const a=this.layers[0].layout,u=a.get("symbol-sort-key"),d=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(m=>Ks[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=a.get("symbol-z-elevate")}createArrays(){this.text=new Iv(new Uc(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Iv(new Uc(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Hb,this.lineVertexArray=new Wb,this.symbolInstances=new Gb}calculateGlyphDependencies(e,r,a,u,d){for(let m=0;m<e.length;m++){const y=e.codePointAt(m);if(y===void 0)break;if(r[y]=!0,u&&d&&y<=65535){const b=Hd[e.charAt(m)];b&&(r[b.charCodeAt(0)]=!0)}}}populate(e,r,a,u){const d=this.layers[0],m=d.layout,y=this.projection.name==="globe",b=m.get("text-font"),T=m.get("text-field"),E=m.get("icon-image"),I=(T.value.kind!=="constant"||T.value.value instanceof ao&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),k=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,O=m.get("symbol-sort-key");if(this.features=[],!I&&!k)return;const z=r.iconDependencies,N=r.glyphDependencies,j=r.availableImages,q=new be(this.zoom);for(const{feature:ie,id:oe,index:ae,sourceLayerIndex:he}of e){const me=d._featureFilter.needGeometry,Te=Wc(ie,me);if(!d._featureFilter.filter(q,Te,a))continue;if(me||(Te.geometry=gl(ie,a,u)),y&&ie.type!==1&&a.z<=5){const Fe=Te.geometry,et=.98078528056,bt=(Je,gt)=>{const Ye=Bd(Je.x,Je.y,a,1),Vt=Bd(gt.x,gt.y,a,1);return s.v.dot(Ye,Vt)<et};for(let Je=0;Je<Fe.length;Je++)Fe[Je]=oL(Fe[Je],bt)}let Pe,Re;if(I){const Fe=d.getValueAndResolveTokens("text-field",Te,a,j),et=ao.factory(Fe);XO(et)&&(this.hasRTLText=!0),(!this.hasRTLText||ue()==="unavailable"||this.hasRTLText&&Me.isParsed())&&(Pe=vO(et,d,Te))}if(k){const Fe=d.getValueAndResolveTokens("icon-image",Te,a,j);Re=Fe instanceof Uo?Fe:Uo.fromString(Fe)}if(!Pe&&!Re)continue;const Ge=this.sortFeaturesByKey?O.evaluate(Te,{},a):void 0;if(this.features.push({id:oe,text:Pe,icon:Re,index:ae,sourceLayerIndex:he,geometry:Te.geometry,properties:ie.properties,type:qO[ie.type],sortKey:Ge}),Re&&(z[Re.namePrimary]=!0,Re.nameSecondary&&(z[Re.nameSecondary]=!0)),Pe){const Fe=b.evaluate(Te,{},a).join(","),et=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ks.vertical)>=0;for(const bt of Pe.sections)if(bt.image)z[bt.image.namePrimary]=!0;else{const Je=S(Pe.toString()),gt=bt.fontStack||Fe,Ye=N[gt]=N[gt]||{};this.calculateGlyphDependencies(bt.text,Ye,et,this.allowVerticalPlacement,Je)}}}m.get("symbol-placement")==="line"&&(this.features=function(ie){const oe={},ae={},he=[];let me=0;function Te(Fe){he.push(ie[Fe]),me++}function Pe(Fe,et,bt){const Je=ae[Fe];return delete ae[Fe],ae[et]=Je,he[Je].geometry[0].pop(),he[Je].geometry[0]=he[Je].geometry[0].concat(bt[0]),Je}function Re(Fe,et,bt){const Je=oe[et];return delete oe[et],oe[Fe]=Je,he[Je].geometry[0].shift(),he[Je].geometry[0]=bt[0].concat(he[Je].geometry[0]),Je}function Ge(Fe,et,bt){const Je=bt?et[0][et[0].length-1]:et[0][0];return`${Fe}:${Je.x}:${Je.y}`}for(let Fe=0;Fe<ie.length;Fe++){const et=ie[Fe],bt=et.geometry,Je=et.text?et.text.toString():null;if(!Je){Te(Fe);continue}const gt=Ge(Je,bt),Ye=Ge(Je,bt,!0);if(gt in ae&&Ye in oe&&ae[gt]!==oe[Ye]){const Vt=Re(gt,Ye,bt),$t=Pe(gt,Ye,he[Vt].geometry);delete oe[gt],delete ae[Ye],ae[Ge(Je,he[$t].geometry,!0)]=$t,he[Vt].geometry=null}else gt in ae?Pe(gt,Ye,bt):Ye in oe?Re(gt,Ye,bt):(Te(Fe),oe[gt]=me-1,ae[Ye]=me-1)}return he.filter(Fe=>Fe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ie,oe)=>ie.sortKey-oe.sortKey)}update(e,r,a,u,d){const m=Object.keys(e).length!==0;if(m&&!this.stateDependentLayers.length)return;const y=m?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,r,y,a,u,d),this.icon.programConfigurations.updatePaintArrays(e,r,y,a,u,d)}updateZOffset(){const e=(d,m,y)=>{a+=m,a>d.length&&d.resize(a);for(let b=-m;b<0;b++)d.emplace(b+a,y)},r=(d,m,y)=>{u+=m,u>d.length&&d.resize(u);for(let b=-m;b<0;b++)d.emplace(b+u,y)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,u=0;for(let d=0;d<this.symbolInstances.length;d++){const m=this.symbolInstances.get(d),{numHorizontalGlyphVertices:y,numVerticalGlyphVertices:b,numIconVertices:T}=m,E=m.zOffset,I=T>0;if((y>0||b>0)&&(e(this.text.zOffsetVertexArray,y,E),e(this.text.zOffsetVertexArray,b,E)),I){const{placedIconSymbolIndex:k,verticalPlacedIconSymbolIndex:O}=m;k>=0&&r(this.icon.zOffsetVertexArray,T,E),O>=0&&r(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,E)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=XS(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:d}of r)this.lineVertexArray.emplaceBack(u,d);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,u,d,m,y,b,T,E,I,k,O,z,N,j){const q=e.indexArray,ie=e.layoutVertexArray,oe=e.globeExtVertexArray,ae=e.segments.prepareSegment(4*r.length,ie,q,this.canOverlap?m.sortKey:void 0),he=this.glyphOffsetArray.length,me=ae.vertexLength,Te=this.allowVerticalPlacement&&y===Ks.vertical?Math.PI/2:0,Pe=m.text&&m.text.sections;for(let Ge=0;Ge<r.length;Ge++){const{tl:Fe,tr:et,bl:bt,br:Je,texPrimary:gt,texSecondary:Ye,pixelOffsetTL:Vt,pixelOffsetBR:$t,minFontScaleX:vt,minFontScaleY:vi,glyphOffset:ii,isSDF:Ot,sectionIndex:xi}=r[Ge],ci=ae.vertexLength,gi=ii[1];if(zg(ie,T.x,T.y,Fe.x,gi+Fe.y,gt.x,gt.y,a,Ot,Vt.x,Vt.y,vt,vi),zg(ie,T.x,T.y,et.x,gi+et.y,gt.x+gt.w,gt.y,a,Ot,$t.x,Vt.y,vt,vi),zg(ie,T.x,T.y,bt.x,gi+bt.y,gt.x,gt.y+gt.h,a,Ot,Vt.x,$t.y,vt,vi),zg(ie,T.x,T.y,Je.x,gi+Je.y,gt.x+gt.w,gt.y+gt.h,a,Ot,$t.x,$t.y,vt,vi),b){const{x:It,y:Ei,z:en}=b.anchor,[Oi,Qi,dn]=b.up;Bg(oe,It,Ei,en,Oi,Qi,dn),Bg(oe,It,Ei,en,Oi,Qi,dn),Bg(oe,It,Ei,en,Oi,Qi,dn),Bg(oe,It,Ei,en,Oi,Qi,dn),Ng(e.dynamicLayoutVertexArray,It,Ei,en,Te)}else Ng(e.dynamicLayoutVertexArray,T.x,T.y,T.z,Te);if(j){const It=Ye||gt;Fg(e.iconTransitioningVertexArray,It.x,It.y),Fg(e.iconTransitioningVertexArray,It.x+It.w,It.y),Fg(e.iconTransitioningVertexArray,It.x,It.y+It.h),Fg(e.iconTransitioningVertexArray,It.x+It.w,It.y+It.h)}q.emplaceBack(ci,ci+1,ci+2),q.emplaceBack(ci+1,ci+2,ci+3),ae.vertexLength+=4,ae.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ii[0]),Ge!==r.length-1&&xi===r[Ge+1].sectionIndex||e.programConfigurations.populatePaintArrays(ie.length,m,m.index,{},O,z,N,Pe&&Pe[xi])}const Re=b?b.anchor:T;e.placedSymbolArray.emplaceBack(Re.x,Re.y,Re.z,T.x,T.y,he,this.glyphOffsetArray.length-he,me,E,I,T.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],y,0,!1,0,k,0)}_commitLayoutVertex(e,r,a,u,d,m,y){e.emplaceBack(r,a,u,d,m,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,r,a,u,d,m,y){const b=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),T=b.vertexLength,E=y.tileAnchorX,I=y.tileAnchorY;for(let O=0;O<4;O++)a.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,r,e.padding,y.zOffset),this._commitLayoutVertex(a.layoutVertexArray,u,d,m,E,I,new Ie(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,d,m,E,I,new Ie(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,d,m,E,I,new Ie(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,u,d,m,E,I,new Ie(e.x1,e.y2)),b.vertexLength+=4;const k=a.indexArray;k.emplaceBack(T,T+1),k.emplaceBack(T+1,T+2),k.emplaceBack(T+2,T+3),k.emplaceBack(T+3,T),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,a,u,d,m){for(let y=u;y<d;y++){const b=a.get(y),T=this.getSymbolInstanceTextSize(e,m,r,y);this._addCollisionDebugVertices(b,T,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,r,a,u,d,m){for(let y=u;y<d;y++){const b=a.get(y),T=this.getSymbolInstanceIconSize(e,r,m.placedIconSymbolIndex);this._addCollisionDebugVertices(b,T,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Cv(Is,vS.members,Lo),this.iconCollisionBox=new Cv(Is,vS.members,Lo);const a=ff(this.iconSizeData,e),u=ff(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const m=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(u,e,r,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(u,e,r,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(a,e,r,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(a,e,r,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(e,r,a,u){const d=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:u),m=Ag(this.textSizeData,e,d)/fo;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,r,a){const u=this.icon.placedSymbolArray.get(a),d=Ag(this.iconSizeData,e,u);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,r,a,u){e.emplaceBack(r,-a,-a,u),e.emplaceBack(r,a,-a,u),e.emplaceBack(r,a,a,u),e.emplaceBack(r,-a,a,u)}_updateTextDebugCollisionBoxes(e,r,a,u,d,m){for(let y=u;y<d;y++){const b=a.get(y),T=this.getSymbolInstanceTextSize(e,m,r,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,T,b.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(e,r,a,u,d,m){for(let y=u;y<d;y++){const b=a.get(y),T=this.getSymbolInstanceIconSize(e,r,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,T,b.padding,m.zOffset)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=ff(this.iconSizeData,e),u=ff(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const m=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(u,e,r,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(u,e,r,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(a,e,r,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._updateIconDebugCollisionBoxes(a,e,r,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,a,u,d,m,y,b,T){const E={};if(r<a){const{x1:I,y1:k,x2:O,y2:z,padding:N,projectedAnchorX:j,projectedAnchorY:q,projectedAnchorZ:ie,tileAnchorX:oe,tileAnchorY:ae,featureIndex:he}=e.get(r);E.textBox={x1:I,y1:k,x2:O,y2:z,padding:N,projectedAnchorX:j,projectedAnchorY:q,projectedAnchorZ:ie,tileAnchorX:oe,tileAnchorY:ae},E.textFeatureIndex=he}if(u<d){const{x1:I,y1:k,x2:O,y2:z,padding:N,projectedAnchorX:j,projectedAnchorY:q,projectedAnchorZ:ie,tileAnchorX:oe,tileAnchorY:ae,featureIndex:he}=e.get(u);E.verticalTextBox={x1:I,y1:k,x2:O,y2:z,padding:N,projectedAnchorX:j,projectedAnchorY:q,projectedAnchorZ:ie,tileAnchorX:oe,tileAnchorY:ae},E.verticalTextFeatureIndex=he}if(m<y){const{x1:I,y1:k,x2:O,y2:z,padding:N,projectedAnchorX:j,projectedAnchorY:q,projectedAnchorZ:ie,tileAnchorX:oe,tileAnchorY:ae,featureIndex:he}=e.get(m);E.iconBox={x1:I,y1:k,x2:O,y2:z,padding:N,projectedAnchorX:j,projectedAnchorY:q,projectedAnchorZ:ie,tileAnchorX:oe,tileAnchorY:ae},E.iconFeatureIndex=he}if(b<T){const{x1:I,y1:k,x2:O,y2:z,padding:N,projectedAnchorX:j,projectedAnchorY:q,projectedAnchorZ:ie,tileAnchorX:oe,tileAnchorY:ae,featureIndex:he}=e.get(b);E.verticalIconBox={x1:I,y1:k,x2:O,y2:z,padding:N,projectedAnchorX:j,projectedAnchorY:q,projectedAnchorZ:ie,tileAnchorX:oe,tileAnchorY:ae},E.verticalIconFeatureIndex=he}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,r){const a=e.placedSymbolArray.get(r),u=a.vertexStartIndex+4*a.numGlyphs;for(let d=a.vertexStartIndex;d<u;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),a=Math.cos(e),u=[],d=[],m=[];for(let y=0;y<this.symbolInstances.length;++y){m.push(y);const b=this.symbolInstances.get(y);u.push(0|Math.round(r*b.tileAnchorX+a*b.tileAnchorY)),d.push(b.featureIndex)}return m.sort((y,b)=>u[y]-u[b]||d[b]-d[y]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:T}=a;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),d>=0&&d!==u&&this.addIndicesForPlacedSymbol(this.text,d),m>=0&&m!==d&&m!==u&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ei(Vg,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Vg.MAX_GLYPHS=65535,Vg.addDynamicAttributes=Ng;var Qd=Vg;const YO=li([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:JO}=YO,KO=li([{name:"a_packed",components:4,type:"Float32"}]),{members:QO}=KO,$O=bg.types,eR=Math.cos(Math.PI/180*37.5);class Ug{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new As,this.layoutVertexArray2=new yn,this.indexArray=new An,this.programConfigurations=new Uc(e.layers,e.zoom),this.segments=new or,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a,u){this.hasPattern=fv("line",this.layers,r);const d=this.layers[0].layout.get("line-sort-key"),m=[];for(const{feature:E,id:I,index:k,sourceLayerIndex:O}of e){const z=this.layers[0]._featureFilter.needGeometry,N=Wc(E,z);if(!this.layers[0]._featureFilter.filter(new be(this.zoom),N,a))continue;const j=d?d.evaluate(N,{},a):void 0,q={id:I,properties:E.properties,type:E.type,sourceLayerIndex:O,index:k,geometry:z?N.geometry:gl(E,a,u),patterns:{},sortKey:j};m.push(q)}d&&m.sort((E,I)=>E.sortKey-I.sortKey);const{lineAtlas:y,featureIndex:b}=r,T=this.addConstantDashes(y);for(const E of m){const{geometry:I,index:k,sourceLayerIndex:O}=E;if(T&&this.addFeatureDashes(E,y),this.hasPattern){const z=dv("line",this.layers,E,this.zoom,r);this.patternFeatures.push(z)}else this.addFeature(E,I,k,a,y.positions,r.availableImages,r.brightness);b.insert(e[k].feature,I,k,O,this.index)}}addConstantDashes(e){let r=!1;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if(u.kind!=="constant"||d.kind!=="constant")r=!0;else{const m=d.value,y=u.value;if(!y)continue;e.addDash(y,m)}}return r}addFeatureDashes(e,r){const a=this.zoom;for(const u of this.layers){const d=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if(d.kind==="constant"&&m.kind==="constant")continue;let y,b;if(d.kind==="constant"){if(y=d.value,!y)continue}else y=d.evaluate({zoom:a},e);b=m.kind==="constant"?m.value:m.evaluate({zoom:a},e),r.addDash(y,b),e.patterns[u.id]=r.getKey(y,b)}}update(e,r,a,u,d){const m=Object.keys(e).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,m?this.stateDependentLayers:this.layers,a,u,d)}addFeatures(e,r,a,u,d,m){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,r,a,u,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,QO)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,JO),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,u,d,m,y){const b=this.layers[0].layout,T=b.get("line-join").evaluate(e,{}),E=b.get("line-cap").evaluate(e,{}),I=b.get("line-miter-limit"),k=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const O of r)this.addLine(O,e,T,E,I,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,m,u,y)}addLine(e,r,a,u,d,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let q=0;q<e.length-1;q++)this.totalDistance+=e[q].dist(e[q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=$O[r.type]==="Polygon";let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let T=0;for(;T<b-1&&e[T].equals(e[T+1]);)T++;if(b<(y?3:2))return;a==="bevel"&&(d=1.05);const E=this.overscaling<=16?15*Mt/(512*this.overscaling):0,I=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let k,O,z,N,j;this.e1=this.e2=-1,y&&(k=e[b-2],j=e[T].sub(k)._unit()._perp());for(let q=T;q<b;q++){if(z=q===b-1?y?e[T+1]:void 0:e[q+1],z&&e[q].equals(z))continue;j&&(N=j),k&&(O=k),k=e[q],j=z?z.sub(k)._unit()._perp():N,N=N||j;let ie=N.add(j);ie.x===0&&ie.y===0||ie._unit();const oe=N.x*j.x+N.y*j.y,ae=ie.x*j.x+ie.y*j.y,he=ae!==0?1/ae:1/0,me=2*Math.sqrt(2-2*ae),Te=ae<eR&&O&&z,Pe=N.x*j.y-N.y*j.x>0;if(Te&&q>T){const Fe=k.dist(O);if(Fe>2*E){const et=k.sub(k.sub(O)._mult(E/Fe)._round());this.updateDistance(O,et),this.addCurrentVertex(et,N,0,0,I),O=et}}const Re=O&&z;let Ge=Re?a:y?"butt":u;if(Re&&Ge==="round"&&(he<m?Ge="miter":he<=2&&(Ge="fakeround")),Ge==="miter"&&he>d&&(Ge="bevel"),Ge==="bevel"&&(he>2&&(Ge="flipbevel"),he<d&&(Ge="miter")),O&&this.updateDistance(O,k),Ge==="miter")ie._mult(he),this.addCurrentVertex(k,ie,0,0,I);else if(Ge==="flipbevel"){if(he>100)ie=j.mult(-1);else{const Fe=he*N.add(j).mag()/N.sub(j).mag();ie._perp()._mult(Fe*(Pe?-1:1))}this.addCurrentVertex(k,ie,0,0,I),this.addCurrentVertex(k,ie.mult(-1),0,0,I)}else if(Ge==="bevel"||Ge==="fakeround"){const Fe=-Math.sqrt(he*he-1),et=Pe?Fe:0,bt=Pe?0:Fe;if(O&&this.addCurrentVertex(k,N,et,bt,I),Ge==="fakeround"){const Je=Math.round(180*me/Math.PI/20);for(let gt=1;gt<Je;gt++){let Ye=gt/Je;if(Ye!==.5){const $t=Ye-.5;Ye+=Ye*$t*(Ye-1)*((1.0904+oe*(oe*(3.55645-1.43519*oe)-3.2452))*$t*$t+(.848013+oe*(.215638*oe-1.06021)))}const Vt=j.sub(N)._mult(Ye)._add(N)._unit()._mult(Pe?-1:1);this.addHalfVertex(k,Vt.x,Vt.y,!1,Pe,0,I)}}z&&this.addCurrentVertex(k,j,-et,-bt,I)}else if(Ge==="butt")this.addCurrentVertex(k,ie,0,0,I);else if(Ge==="square"){const Fe=O?1:-1;O||this.addCurrentVertex(k,ie,Fe,Fe,I),this.addCurrentVertex(k,ie,0,0,I),O&&this.addCurrentVertex(k,ie,Fe,Fe,I)}else Ge==="round"&&(O&&(this.addCurrentVertex(k,N,0,0,I),this.addCurrentVertex(k,N,1,1,I,!0)),z&&(this.addCurrentVertex(k,j,-1,-1,I,!0),this.addCurrentVertex(k,j,0,0,I)));if(Te&&q<b-1){const Fe=k.dist(z);if(Fe>2*E){const et=k.add(z.sub(k)._mult(E/Fe)._round());this.updateDistance(k,et),this.addCurrentVertex(et,j,0,0,I),k=et}}}}addCurrentVertex(e,r,a,u,d,m=!1){const y=r.y*u-r.x,b=-r.y-r.x*u;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,m,!1,a,d),this.addHalfVertex(e,y,b,m,!0,-u,d)}addHalfVertex({x:e,y:r},a,u,d,m,y,b){this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(r<<1)+(m?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const T=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),b.primitiveLength++),m?this.e2=T:this.e1=T}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}ei(Ug,"LineBucket",{omit:["layers","patternFeatures"]});class lc{constructor(e,r,a,u){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(r,u)}update(e,r,a){const{width:u,height:d}=e,{context:m}=this,{gl:y}=m;if(y.bindTexture(y.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!r||r.premultiply!==!1)),a||this.size&&this.size[0]===u&&this.size[1]===d){const{x:b,y:T}=a||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)y.texSubImage2D(y.TEXTURE_2D,0,b,T,y.RGBA,y.UNSIGNED_BYTE,e);else{let E=this.format,I=y.UNSIGNED_BYTE;this.format===y.R32F&&(E=y.RED,I=y.FLOAT),y.texSubImage2D(y.TEXTURE_2D,0,b,T,u,d,E,I,e.data)}}else if(this.size=[u,d],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let b=this.format;this.format===y.R8&&(b=y.RED),y.texImage2D(y.TEXTURE_2D,0,this.format,b,y.UNSIGNED_BYTE,e)}else{let b=this.format,T=this.format,E=y.UNSIGNED_BYTE;this.format===y.DEPTH_COMPONENT&&(b=y.DEPTH_COMPONENT16,E=y.UNSIGNED_SHORT),this.format===y.R8&&(T=y.RED),this.format===y.R32F&&(E=y.FLOAT,T=y.RED),y.texImage2D(y.TEXTURE_2D,0,b,u,d,0,T,E,e.data)}this.useMipmap=!!(r&&r.useMipmap),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,r,a=!1){const{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,r),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(e,r,a,u){const{context:d}=this,{gl:m}=d;m.bindTexture(m.TEXTURE_2D,this.texture),r!==this.magFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,r),this.magFilter=r),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,a),this.wrapS=a),u!==this.wrapT&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,u),this.wrapT=u)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class jg{constructor(e,r){this.context=e,this.texture=r}bind(e,r){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}}const da=32,_l=33,Kc=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,r=0,a=0,u=0,d=0,m=0,y=0;for(1&e?u=d=m=da:r=a=y=da;(e>>=1)>1;){const T=r+u>>1,E=a+d>>1;1&e?(u=r,d=a,r=m,a=y):(r=u,a=d,u=m,d=y),m=T,y=E}const b=4*t;Kc[b+0]=r,Kc[b+1]=a,Kc[b+2]=u,Kc[b+3]=d}const yl=new Uint16Array(2178),Qc=new Uint8Array(1089),Gg=new Uint16Array(1089);function JS(t){return t===0?-.03125:t===32?.03125:0}var Hg=li([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const KS={type:2,extent:Mt,loadGeometry:()=>[[new Ie(0,0),new Ie(Mt+1,0),new Ie(Mt+1,Mt+1),new Ie(0,Mt+1),new Ie(0,0)]]};class Pv{constructor(e,r,a,u,d){this.tileID=e,this.uid=Si(),this.uses=0,this.tileSize=r,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,u&&u.style&&(this._lastUpdatedBrightness=u.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<ro.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Yc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,d){const m={};if(!d)return m;for(const y of u){const b=y.layerIds.map(T=>d.getLayer(T)).filter(Boolean);if(b.length!==0){y.layers=b,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(T=>b.filter(E=>E.id===T)[0]));for(const T of b)m[T.fqid]=y}}return m}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const d=this.buckets[u];if(d instanceof Qd){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const d=this.buckets[u];if(d instanceof Qd&&d.hasRTLText){this.hasRTLText=!0,Me.isLoading()||Me.isLoaded()||ue()!=="deferred"||ve();break}}this.queryPadding=0;for(const u in this.buckets){const d=this.buckets[u],m=r.style.getOwnLayer(u);if(!m)continue;const y=m.queryRadius(d);this.queryPadding=Math.max(this.queryPadding,y)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new x0}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(const u in this.buckets){const d=this.buckets[u];d.uploadPending()&&d.upload(e)}const r=e.gl,a=this.imageAtlas;if(a&&!a.uploaded){const u=!!Object.keys(a.patternPositions).length;this.imageAtlasTexture=new lc(e,a.image,r.RGBA,{useMipmap:u}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new lc(e,this.glyphAtlasImage,r.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new lc(e,this.lineAtlas.image,r.R8),this.lineAtlas.uploaded=!0)}prepare(e,r,a){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,a),!r||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const u=r.style.getBrightness();(this._lastUpdatedBrightness||u)&&(this._lastUpdatedBrightness&&u&&Math.abs(this._lastUpdatedBrightness-u)<.001||(this._lastUpdatedBrightness=u,this.updateBuckets(void 0,r)))}queryRenderedFeatures(e,r,a,u,d,m,y,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:y,transform:m,params:d,tileTransform:this.tileTransform},e,r,a):{}}querySourceFeatures(e,r){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const u=a.loadVTLayers(),d=r?r.sourceLayer:"",m=u._geojsonTileLayer||u[d];if(!m)return;const y=Yh(r&&r.filter),{z:b,x:T,y:E}=this.tileID.canonical,I={z:b,x:T,y:E};for(let k=0;k<m.length;k++){const O=m.feature(k);if(y.needGeometry){const j=Wc(O,!0);if(!y.filter(new be(this.tileID.overscaledZ),j,this.tileID.canonical))continue}else if(!y.filter(new be(this.tileID.overscaledZ),O))continue;const z=a.getId(O,d),N=new uS(O,b,T,E,z);N.tile=I,e.push(N)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const a=dt(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let u=!1;if(this.expirationTime>a)u=!1;else if(r)if(this.expirationTime<r)u=!0;else{const d=this.expirationTime-r;d?this.expirationTime=a+Math.max(d,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&r&&this.updateBuckets(e,r)}updateBuckets(e,r){if(!this.latestFeatureIndex)return;const a=this.latestFeatureIndex.loadVTLayers(),u=r.style.listImages(),d=r.style.getBrightness();for(const m in this.buckets){if(!r.style.hasLayer(m))continue;const y=this.buckets[m],b=y.layers[0].sourceLayer||"_geojsonTileLayer",T=a[b];let E={};if(e&&(E=e[b],!T||!E||Object.keys(E).length===0))continue;if(y.update(E,T,u,this.imageAtlas&&this.imageAtlas.patternPositions||{},d),y instanceof Ug||y instanceof vg){const k=r.style.getOwnSourceCache(y.layers[0].source);r._terrain&&r._terrain.enabled&&k&&y.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(k.id,this.tileID)}const I=r&&r.style&&r.style.getOwnLayer(m);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ro.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ro.now()+e}setTexture(e,r){const a=r.context,u=a.gl;this.texture=this.texture||r.getTileTexture(e.width),this.texture&&this.texture instanceof lc?this.texture.update(e,{useMipmap:!0}):(this.texture=new lc(a,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE))}setDependencies(e,r){const a={};for(const u of r)a[u]=!0;this.dependencies[e]=a}hasDependency(e,r){for(const a of e){const u=this.dependencies[a];if(u){for(const d of r)if(u[d])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const a=gl(KS,this.tileID.canonical,this.tileTransform)[0],u=new Li,d=new Pd;for(let m=0;m<a.length;m++){const{x:y,y:b}=a[m];u.emplaceBack(y,b),d.emplaceBack(m)}d.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(d),this._tileDebugBuffer=e.createVertexBuffer(u,Rd.members),this._tileDebugSegments=or.simpleSegment(0,0,u.length,d.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const a=gl(KS,this.tileID.canonical,this.tileTransform)[0];let u,d;if(this.isRaster){const m=function(y,b){const T=Yc(y,b),E=Math.pow(2,y.z);for(let j=0;j<_l;j++)for(let q=0;q<_l;q++){const ie=Cs((y.x+(q+JS(q))/da)/E),oe=ho((y.y+(j+JS(j))/da)/E),ae=b.project(ie,oe),he=j*_l+q;yl[2*he+0]=Math.round((ae.x*T.scale-T.x)*Mt),yl[2*he+1]=Math.round((ae.y*T.scale-T.y)*Mt)}Qc.fill(0),Gg.fill(0);for(let j=2045;j>=0;j--){const q=4*j,ie=Kc[q+0],oe=Kc[q+1],ae=Kc[q+2],he=Kc[q+3],me=ie+ae>>1,Te=oe+he>>1,Pe=me+Te-oe,Re=Te+ie-me,Ge=oe*_l+ie,Fe=he*_l+ae,et=Te*_l+me,bt=Math.hypot((yl[2*Ge+0]+yl[2*Fe+0])/2-yl[2*et+0],(yl[2*Ge+1]+yl[2*Fe+1])/2-yl[2*et+1])>=16;Qc[et]=Qc[et]||(bt?1:0),j<1022&&(Qc[et]=Qc[et]||Qc[(oe+Re>>1)*_l+(ie+Pe>>1)]||Qc[(he+Re>>1)*_l+(ae+Pe>>1)])}const I=new Mn,k=new An;let O=0;function z(j,q){const ie=q*_l+j;return Gg[ie]===0&&(I.emplaceBack(yl[2*ie+0],yl[2*ie+1],j*Mt/da,q*Mt/da),Gg[ie]=++O),Gg[ie]-1}function N(j,q,ie,oe,ae,he){const me=j+ie>>1,Te=q+oe>>1;if(Math.abs(j-ae)+Math.abs(q-he)>1&&Qc[Te*_l+me])N(ae,he,j,q,me,Te),N(ie,oe,ae,he,me,Te);else{const Pe=z(j,q),Re=z(ie,oe),Ge=z(ae,he);k.emplaceBack(Pe,Re,Ge)}}return N(0,0,da,da,da,0),N(da,da,0,0,0,da),{vertices:I,indices:k}}(this.tileID.canonical,r);u=m.vertices,d=m.indices}else{u=new Mn,d=new An;for(const{x:y,y:b}of a)u.emplaceBack(y,b,0,0);const m=yg(u.int16,void 0,4);for(let y=0;y<m.length;y+=3)d.emplaceBack(m[y],m[y+1],m[y+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,Hg.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(d),this._tileBoundsSegments=or.simpleSegment(0,0,u.length,d.length)}_makeGlobeTileDebugBuffers(e,r){const a=r.projection;if(!a||a.name!=="globe"||r.freezeTileCoverage)return;const u=this.tileID.canonical,d=Nd(ST(u,r)),m=rc(r.zoom);let y;m>0&&(y=s.m.invert(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,u,r,d,y,m),this._makeGlobeTileDebugTextBuffer(e,u,r,d,y,m)}_globePoint(e,r,a,u,d,m,y){let b=Bd(e,r,a);if(m){const T=1<<a.z,E=pl(u.center.lng),I=ml(u.center.lat),k=(a.x+.5)/T-E;let O=0;k>.5?O=-1:k<-.5&&(O=1);let z=(e/Mt+a.x)/T+O,N=(r/Mt+a.y)/T;z=(z-E)*u._pixelsPerMercatorPixel+E,N=(N-I)*u._pixelsPerMercatorPixel+I;const j=[z*u.worldSize,N*u.worldSize,0];s.v.transformMat4(j,j,m),b=nc(b,j,y)}return s.v.transformMat4(b,b,d)}_makeGlobeTileDebugBorderBuffer(e,r,a,u,d,m){const y=new Li,b=new Pd,T=new Nn,E=(k,O,z,N,j)=>{const q=(z-k)/(j-1),ie=(N-O)/(j-1),oe=y.length;for(let ae=0;ae<j;ae++){const he=k+ae*q,me=O+ae*ie;y.emplaceBack(he,me);const Te=this._globePoint(he,me,r,a,u,d,m);T.emplaceBack(Te[0],Te[1],Te[2]),b.emplaceBack(oe+ae)}},I=Mt;E(0,0,I,0,16),E(I,0,I,I,16),E(I,I,0,I,16),E(0,I,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(b),this._tileDebugBuffer=e.createVertexBuffer(y,Rd.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(T,gT.members),this._tileDebugSegments=or.simpleSegment(0,0,y.length,b.length)}_makeGlobeTileDebugTextBuffer(e,r,a,u,d,m){const y=Mt/4,b=new Li,T=new An,E=new Nn,I=25;T.reserve(32),b.reserve(I),E.reserve(I);const k=(O,z)=>I*O+z;for(let O=0;O<I;O++){const z=O*y;for(let N=0;N<I;N++){const j=N*y;b.emplaceBack(j,z);const q=this._globePoint(j,z,r,a,u,d,m);E.emplaceBack(q[0],q[1],q[2])}}for(let O=0;O<4;O++)for(let z=0;z<4;z++){const N=k(O,z),j=k(O,z+1),q=k(O+1,z),ie=k(O+1,z+1);T.emplaceBack(N,j,q),T.emplaceBack(q,j,ie)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(T),this._tileDebugTextBuffer=e.createVertexBuffer(b,Rd.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(E,gT.members),this._tileDebugTextSegments=or.simpleSegment(0,0,I,32)}destroy(e=!1){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof lc&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.latestFeatureIndex=null,this.state="unloaded"}}class tR{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,a){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const d={value:r,timeout:void 0};if(a!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},a)),this.data[u].push(d),this.order.push(u),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const a=e.wrapped().key,u=r===void 0?0:this.data[a].indexOf(r),d=this.data[a][u];return this.data[a].splice(u,1),d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(d.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const a in this.data)for(const u of this.data[a])e(u.value)||r.push(u);for(const a of r)this.remove(a.value.tileID,a)}}class sh{constructor(e,r,a,u){this.id=sh.uniqueIdxCounter,sh.uniqueIdxCounter++,this.context=e;const d=e.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||u||r.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=sh.uniqueIdxCounter,sh.uniqueIdxCounter++;const r=this.context.gl;this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}sh.uniqueIdxCounter=0;class yf{constructor(e,r,a){this.func=e,this.mask=r,this.range=a}}yf.ReadOnly=!1,yf.ReadWrite=!0,yf.disabled=new yf(519,yf.ReadOnly,[0,1]);const kv=7680;class Dv{constructor(e,r,a,u,d,m){this.test=e,this.ref=r,this.mask=a,this.fail=u,this.depthFail=d,this.pass=m}}Dv.disabled=new Dv({func:519,mask:0},0,0,kv,kv,kv);class pa{constructor(e,r,a,u){this.blendFunction=e,this.blendColor=r,this.mask=a,this.blendEquation=u}}pa.Replace=[1,0,1,0],pa.disabled=new pa(pa.Replace,Ln.transparent,[!1,!1,!1,!1]),pa.unblended=new pa(pa.Replace,Ln.transparent,[!0,!0,!0,!0]),pa.alphaBlended=new pa([1,771,1,771],Ln.transparent,[!0,!0,!0,!0]),pa.multiply=new pa([774,0,774,0],Ln.transparent,[!0,!0,!0,!0]);const Lv=1029,Ov=2305;class ja{constructor(e,r,a){this.enable=e,this.mode=r,this.frontFace=a}}ja.disabled=new ja(!1,Lv,Ov),ja.backCCW=new ja(!0,Lv,Ov),ja.backCW=new ja(!0,Lv,2304),ja.frontCW=new ja(!0,1028,2304),ja.frontCCW=new ja(!0,1028,Ov);class ah extends so{constructor(e,r,a){super(),this.id=e,this._onlySymbols=a,r.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new tR(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new oO,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="errored"&&(r.state!=="loaded"||!r.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const a=this._tiles[r];a.upload(e),a.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return st(this._tiles).map(e=>e.tileID).sort(QS).map(e=>e.key)}getRenderableIds(e,r){const a=[];for(const u in this._tiles)this._isIdRenderable(+u,e,r)&&a.push(this._tiles[u]);return e?a.sort((u,d)=>{const m=u.tileID,y=d.tileID,b=new Ie(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),T=new Ie(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-y.overscaledZ||T.y-b.y||T.x-b.x}).map(u=>u.tileID.key):a.map(u=>u.tileID).sort(QS).map(u=>u.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r,a){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())&&(a||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=r),this._loadTile(a,this._tileLoaded.bind(this,a,e,r)))}_tileLoaded(e,r,a,u){if(u)if(e.state="errored",u.status!==404)this._source.fire(new Po(u,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new xo("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const d=this.map.painter.terrain;this.update(this.transform,d.getScaledDemTileSize(),!0),d.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=ro.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new xo("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let u=0;u<r.length;u++){const d=r[u];if(e.neighboringTiles&&e.neighboringTiles[d]){const m=this.getTileByID(d);a(e,m),a(m,e)}}function a(u,d){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let m=d.tileID.canonical.x-u.tileID.canonical.x;const y=d.tileID.canonical.y-u.tileID.canonical.y,b=Math.pow(2,u.tileID.canonical.z),T=d.tileID.key;m===0&&y===0||Math.abs(y)>1||(Math.abs(m)>1&&(Math.abs(m+b)===1?m+=b:Math.abs(m-b)===1&&(m-=b)),d.dem&&u.dem&&(u.dem.backfillBorder(d.dem,m,y),u.neighboringTiles&&u.neighboringTiles[T]&&(u.neighboringTiles[T].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,a,u){for(const d in this._tiles){let m=this._tiles[d];if(u[d]||!m.hasData()||m.tileID.overscaledZ<=r||m.tileID.overscaledZ>a)continue;let y=m.tileID;for(;m&&m.tileID.overscaledZ>r+1;){const T=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[T.key],m&&m.hasData()&&(y=T)}let b=y;for(;b.overscaledZ>r;)if(b=b.scaledTo(b.overscaledZ-1),e[b.key]){u[y.key]=y;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=r?a:null}for(let a=e.overscaledZ-1;a>=r;a--){const u=e.scaledTo(a),d=this._getLoadedTile(u);if(d)return d}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const a=Math.ceil(e.width/r)+1,u=Math.ceil(e.height/r)+1,d=Math.floor(a*u*5),m=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,d):d,y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(y)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const a={};for(const u in this._tiles){const d=this._tiles[u];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+r),a[d.tileID.key]=d}this._tiles=a;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,r,a,u){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let d;if(this.updateCacheSize(e,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(b=>new lo(b.canonical.z,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y)):(d=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(d=d.filter(b=>this._source.hasTile(b)))):d=[],d.length>0&&this.castsShadows&&u&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Rv(this._source.type)){const b=e.coveringZoomLevel({tileSize:r||this._source.tileSize,roundZoom:this._source.roundZoom&&!a}),T=Math.min(b,this._source.maxzoom),E=e.extendTileCoverForShadows(d,u,T);for(const I of E)this._shadowCasterTiles[I.key]=!0,d.push(I)}const m=this._updateRetainedTiles(d);if(Rv(this._source.type)&&d.length!==0){const b={},T={},E=Object.keys(m);for(const k of E){const O=m[k],z=this._tiles[k];if(!z||z.fadeEndTime&&z.fadeEndTime<=ro.now())continue;const N=this.findLoadedParent(O,Math.max(O.overscaledZ-ah.maxOverzooming,this._source.minzoom));N&&(this._addTile(N.tileID),b[N.tileID.key]=N.tileID),T[k]=O}const I=d[d.length-1].overscaledZ;for(const k in this._tiles){const O=this._tiles[k];if(m[k]||!O.hasData())continue;let z=O.tileID;for(;z.overscaledZ>I;){z=z.scaledTo(z.overscaledZ-1);const N=this._tiles[z.key];if(N&&N.hasData()&&T[z.key]){m[k]=O.tileID;break}}}for(const k in b)m[k]||(this._coveredTiles[k]=!0,m[k]=b[k])}for(const b in m)this._tiles[b].clearFadeHold();const y=function(b,T){const E=[];for(const I in b)I in T||E.push(I);return E}(this._tiles,m);for(const b of y){const T=this._tiles[b];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+b)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(e.length===0)return r;const a={},u=e.reduce((T,E)=>Math.min(T,E.overscaledZ),1/0),d=e[0].overscaledZ,m=Math.max(d-ah.maxOverzooming,this._source.minzoom),y=Math.max(d+ah.maxUnderzooming,this._source.minzoom),b={};for(const T of e){const E=this._addTile(T);r[T.key]=T,E.hasData()||u<this._source.maxzoom&&(b[T.key]=T)}this._retainLoadedChildren(b,u,y,r);for(const T of e){let E=this._tiles[T.key];if(E.hasData())continue;if(T.canonical.z>=this._source.maxzoom){const k=T.children(this._source.maxzoom)[0],O=this.getTile(k);if(O&&O.hasData()){r[k.key]=k;continue}}else{const k=T.children(this._source.maxzoom);if(r[k[0].key]&&r[k[1].key]&&r[k[2].key]&&r[k[3].key])continue}let I=E.wasRequested();for(let k=T.overscaledZ-1;k>=m;--k){const O=T.scaledTo(k);if(a[O.key]||(a[O.key]=!0,E=this.getTile(O),!E&&I&&(E=this._addTile(O)),E&&(r[O.key]=O,I=E.wasRequested(),E.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let a,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){a=this._loadedParentTiles[u.key];break}r.push(u.key);const d=u.scaledTo(u.overscaledZ-1);if(a=this._getLoadedTile(d),a)break;u=d}for(const d of r)this._loadedParentTiles[d]=a}}_addTile(e){let r=this._tiles[e.key];if(r)return r.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const a=!!r;if(!a){const u=this.map?this.map.painter:null;r=new Pv(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,a||this._source.fire(new xo("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=r.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,r,a){const u=[],d=this.transform;if(!d)return u;const m=d.projection.name==="globe",y=pl(d.center.lng);for(const b in this._tiles){const T=this._tiles[b];if(a&&T.clearQueryDebugViz(),T.holdingForFade())continue;let E;if(m){const I=T.tileID.canonical;if(I.z===0){const k=[Math.abs(wt(y,...$d(I,-1))-y),Math.abs(wt(y,...$d(I,1))-y)];E=[0,2*k.indexOf(Math.min(...k))-1]}else{const k=[Math.abs(wt(y,...$d(I,-1))-y),Math.abs(wt(y,...$d(I,0))-y),Math.abs(wt(y,...$d(I,1))-y)];E=[k.indexOf(Math.min(...k))-1]}}else E=[0];for(const I of E){const k=e.containsTile(T,d,r,I);k&&u.push(k)}}return u}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,r){const a=this.getRenderableIds(e,r).map(d=>this._tiles[d].tileID),u=this.transform.projection.name==="globe";for(const d of a)d.projMatrix=this.transform.calculateProjMatrix(d.toUnwrapped()),d.expandedProjMatrix=u?this.transform.calculateProjMatrix(d.toUnwrapped(),!1,!0):d.projMatrix;return a}sortCoordinatesByDistance(e){const r=e.slice(),a=this.transform._camera.position,u=this.transform._camera.forward(),d={};for(const m of r){const y=1/(1<<m.canonical.z);d[m.key]=((m.canonical.x+.5)*y+m.wrap-a[0])*u[0]+((m.canonical.y+.5)*y-a[1])*u[1]-a[2]*u[2]}return r.sort((m,y)=>d[m.key]-d[y.key]),r}hasTransition(){if(this._source.hasTransition())return!0;if(Rv(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=ro.now())return!0}return!1}setFeatureState(e,r,a){this._state.updateState(e=e||"_geojsonTileLayer",r,a)}removeFeatureState(e,r,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,a)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,a){const u=this._tiles[e];u&&u.setDependencies(r,a)}reloadTilesForDependencies(e,r){for(const a in this._tiles)this._tiles[a].hasDependency(e,r)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,r))}_preloadTiles(e,r){if(!this._sourceLoaded){const y=()=>{this._sourceLoaded&&(this._source.off("data",y),this._preloadTiles(e,r))};return void this._source.on("data",y)}const a=new Map,u=Array.isArray(e)?e:[e],d=this.map.painter.terrain,m=this.usedForTerrain&&d?d.getScaledDemTileSize():this._source.tileSize;for(const y of u){const b=y.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const T of b)a.set(T.key,T);this.usedForTerrain&&y.updateElevation(!1)}Mi(Array.from(a.values()),(y,b)=>{const T=new Pv(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(T,E=>{this._source.type==="raster-dem"&&T.dem&&this._backfillDEM(T),b(E,T)})},r)}}function QS(t,e){const r=Math.abs(2*t.wrap)-+(t.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||a-r||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Rv(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function $d(t,e){const r=1<<t.z;return[t.x/r+e,(t.x+1)/r+e]}ah.maxOverzooming=10,ah.maxUnderzooming=3;const iR=li([{name:"a_pos_3f",components:3,type:"Float32"}]),nR=li([{name:"a_color_3f",components:3,type:"Float32"}]),rR=li([{name:"a_color_4f",components:4,type:"Float32"}]),oR=li([{name:"a_uv_2f",components:2,type:"Float32"}]),sR=li([{name:"a_normal_3f",components:3,type:"Float32"}]),aR=li([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),lR=li([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function $S(t,e){const r=Wg(t.projection,t.zoom,t.width,t.height),a=function(d,m,y,b,T){const E=new vn(y.lng-180*$c,y.lat),I=new vn(y.lng+180*$c,y.lat),k=d.project(E.lng,E.lat),O=d.project(I.lng,I.lat),z=-Math.atan2(O.y-k.y,O.x-k.x),N=To.fromLngLat(y);N.y=wt(N.y,-1+$c,1-$c);const j=N.toLngLat(),q=d.project(j.lng,j.lat),ie=To.fromLngLat(j);ie.x+=$c;const oe=ie.toLngLat(),ae=d.project(oe.lng,oe.lat),he=iM(ae.x-q.x,ae.y-q.y,z),me=To.fromLngLat(j);me.y+=$c;const Te=me.toLngLat(),Pe=d.project(Te.lng,Te.lat),Re=iM(Pe.x-q.x,Pe.y-q.y,z),Ge=Math.abs(he.x)/Math.abs(Re.y),Fe=s.m.identity([]);s.m.rotateZ(Fe,Fe,-z*(1-(T?0:b)));const et=s.m.identity([]);return s.m.scale(et,et,[1,1-(1-Ge)*b,1]),et[4]=-Re.x/Re.y*b,s.m.rotateZ(et,et,z),s.m.multiply(et,Fe,et),et}(t.projection,0,t.center,r,e),u=eM(t);return s.m.scale(a,a,[u,u,1]),a}function eM(t){const e=t.projection,r=Wg(t.projection,t.zoom,t.width,t.height),a=tM(e,t.center),u=tM(e,vn.convert(e.center));return Math.pow(2,a*r+(1-r)*u)}function Wg(t,e,r,a,u=1/0){const d=t.range;if(!d)return 0;const m=Math.min(u,Math.max(r,a)),y=Math.log(m/1024)/Math.LN2;return Ii(d[0]+y,d[1]+y,e)}const $c=1/4e4;function tM(t,e){const r=wt(e.lat,-br,br),a=new vn(e.lng-180*$c,r),u=new vn(e.lng+180*$c,r),d=t.project(a.lng,r),m=t.project(u.lng,r),y=To.fromLngLat(a),b=To.fromLngLat(u),T=m.x-d.x,E=m.y-d.y,I=b.x-y.x,k=b.y-y.y,O=Math.sqrt((I*I+k*k)/(T*T+E*E));return Math.log(O)/Math.LN2}function iM(t,e,r){const a=Math.cos(r),u=Math.sin(r);return{x:t*a-e*u,y:t*u+e*a}}function nM(t,e,r){return e*(Mt/(t.tileSize*Math.pow(2,r-t.tileID.overscaledZ)))}function rM(t,e,r){s.m.identity(t),s.m.rotateZ(t,t,Xe(e[2])),s.m.rotateX(t,t,Xe(e[0])),s.m.rotateY(t,t,Xe(e[1])),s.m.scale(t,t,r),s.m.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function qg(t,e,r,a,u,d,m,y){const b=[r[0]-e[0],r[1]-e[1],0],T=[a[0]-e[0],a[1]-e[1],0];if(s.v.length(b)<1e-12||s.v.length(T)<1e-12)return s.q.identity(t);const E=s.v.cross([],b,T);s.v.normalize(E,E),s.v.subtract(T,a,e),b[2]=(d-u)*y,T[2]=(m-u)*y;const I=b;return s.v.cross(I,b,T),s.v.normalize(I,I),s.q.rotationTo(t,E,I)}function oM(t,e,r=!1){const a=rc(e.zoom),u=function(d,m,y){const b=m.worldSize,T=[d[12],d[13],d[14]],E=ho(T[1]/b),I=Cs(T[0]/b),k=s.m.identity([]),O=Jo(1,E)*b,z=Jo(1,0)*b*nh(E,m.zoom),N=1/Y0(b);let j=z*N;if(y){const ae=Wg(m.projection,m.zoom,m.width,m.height,1024);j=N*m.projection.pixelSpaceConversion(m.center.lat,b,ae)}const q=ih(E,I);s.v.add(q,q,s.v.scale([],s.v.normalize([],q),O*j*T[2]));const ie=function(ae){const he=[ae[0],ae[1],ae[2]];let me=[0,1,0];const Te=s.v.cross([],me,he);return s.v.cross(me,he,Te),s.v.squaredLength(me)===0&&(me=[0,1,0],s.v.cross(Te,he,me)),s.v.normalize(Te,Te),s.v.normalize(me,me),s.v.normalize(he,he),[Te[0],Te[1],Te[2],0,me[0],me[1],me[2],0,he[0],he[1],he[2],0,ae[0],ae[1],ae[2],1]}(q);s.m.scale(k,k,[j,j,j*O]),s.m.translate(k,k,[-T[0],-T[1],-T[2]]);const oe=s.m.multiply([],m.globeMatrix,ie);return s.m.multiply(oe,oe,k),s.m.multiply(oe,oe,d),oe}(t,e,r);if(a>0){const d=function(m,y){const b=y.worldSize,T=Jo(1,0)*b*nh(y.center.lat,y.zoom)/Y0(b),E=Jo(1,y.center.lat)*b,I=s.m.identity([]);return s.m.rotateY(I,I,Xe(y.center.lng)),s.m.rotateX(I,I,Xe(y.center.lat)),s.m.translate(I,I,[0,0,Ys]),s.m.scale(I,I,[T,T,T*E]),s.m.translate(I,I,[y.point.x-.5*b,y.point.y-.5*b,0]),s.m.multiply(I,I,m),s.m.multiply(I,y.globeMatrix,I)}(t,e);return function(m,y,b){const T=(z,N,j)=>{const q=s.v.length(z),ie=s.v.length(N),oe=nc(z,N,j);return s.v.scale(oe,oe,1/s.v.length(oe)*Gi(q,ie,j))},E=T([m[0],m[1],m[2]],[y[0],y[1],y[2]],b),I=T([m[4],m[5],m[6]],[y[4],y[5],y[6]],b),k=T([m[8],m[9],m[10]],[y[8],y[9],y[10]],b),O=nc([m[12],m[13],m[14]],[y[12],y[13],y[14]],b);return[E[0],E[1],E[2],0,I[0],I[1],I[2],0,k[0],k[1],k[2],0,O[0],O[1],O[2],1]}(u,d,a)}return u}const lh=64,Zg={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4};function ep(t,e,r=!1){t.uploaded||(t.gfxTexture=new lc(e,t.image,r?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function cR(t,e,r){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,iR.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,sR.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,oR.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?nR:rR).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,lR.members,!0)),t.segments=or.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const a=t.material;a.pbrMetallicRoughness.baseColorTexture&&ep(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&ep(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&ep(a.normalTexture,e),a.occlusionTexture&&ep(a.occlusionTexture,e,r),a.emissionTexture&&ep(a.emissionTexture,e)}function zv(t,e,r){if(t.meshes)for(const a of t.meshes)cR(a,e,r);if(t.children)for(const a of t.children)zv(a,e,r)}function Xg(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)Xg(e)}function Yg(t){if(t.meshes)for(const r of t.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((e=r.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const r of t.children)Yg(r)}class sM{constructor(e,r){this.feature=e,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class aM{constructor(){this.instancedDataArray=new y0,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class lM{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,r,a,u){this.tileToMeter=cg(a);const d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:y,index:b,sourceLayerIndex:T}of e){const E=Wc(m,d);if(!this.layers[0]._featureFilter.filter(new be(this.zoom),E,a))continue;const I={id:y,sourceLayerIndex:T,index:b,geometry:d?E.geometry:gl(m,a,u),properties:m.properties,type:m.type,patterns:{}},k=this.addFeature(I,I.geometry,E);k&&r.featureIndex.insert(m,I.geometry,b,T,this.index,this.instancesPerModel[k].instancedDataArray.length)}this.lookup=null}update(e,r,a,u){for(const d in this.instancesPerModel){const m=this.instancesPerModel[d];for(const y in e)m.idToFeaturesIndex.hasOwnProperty(y)&&this.evaluate(m.features[m.idToFeaturesIndex[y]],e[y],m,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const r in this.instancesPerModel){const a=this.instancesPerModel[r];for(const u of a.features){const d=this.layers[0],m=u.feature,y=this.canonical,b=d.paint.get("model-rotation").evaluate(m,{},y),T=d.paint.get("model-scale").evaluate(m,{},y),E=d.paint.get("model-translation").evaluate(m,{},y);s.v.exactEquals(u.rotation,b)&&s.v.exactEquals(u.scale,T)&&s.v.exactEquals(u.translation,E)||(this.evaluate(u,u.featureStates,a,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const r in this.instancesPerModel){const a=this.instancesPerModel[r];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,aR.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const r=this.instancesPerModel[e];r.instancedDataArray.length!==0&&r.instancedDataBuffer&&r.instancedDataBuffer.destroy()}}addFeature(e,r,a){const u=this.layers[0],d=u.layout.get("model-id").evaluate(a,{},this.canonical);if(!d)return si(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),d;this.instancesPerModel[d]||(this.instancesPerModel[d]=new aM);const m=this.instancesPerModel[d],y=m.instancedDataArray,b=new sM(a,y.length);for(const T of r)for(const E of T){if(E.x<0||E.x>=Mt||E.y<0||E.y>=Mt)continue;const I=(this.lookupDim-1)/Mt,k=this.lookupDim*(E.y*I|0)+E.x*I|0;if(this.lookup){if(this.lookup[k]!==0)continue;this.lookup[k]=1}this.instanceCount++;const O=y.length;y.resize(O+1),m.instancesEvaluatedElevation.push(0),y.float32[16*O]=E.x,y.float32[16*O+1]=E.y}return b.instancedDataCount=m.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(e.id&&(m.idToFeaturesIndex[e.id]=m.features.length),m.features.push(b),this.evaluate(b,{},m,!1)),d}evaluate(e,r,a,u){const d=this.layers[0],m=e.feature,y=this.canonical,b=e.rotation=d.paint.get("model-rotation").evaluate(m,r,y),T=e.scale=d.paint.get("model-scale").evaluate(m,r,y),E=e.translation=d.paint.get("model-translation").evaluate(m,r,y),I=d.paint.get("model-color").evaluate(m,r,y);I.a=d.paint.get("model-color-mix-intensity").evaluate(m,r,y);const k=[];this.maxVerticalOffset<E[2]&&(this.maxVerticalOffset=E[2]),this.maxScale=Math.max(Math.max(this.maxScale,T[0]),Math.max(T[1],T[2])),rM(k,b,T);const O=Math.round(100*I.a)+I.b/1.05;for(let z=0;z<e.instancedDataCount;++z){const N=e.instancedDataOffset+z,j=16*N,q=a.instancedDataArray.float32;let ie=0;u&&(ie=q[j+6]-a.instancesEvaluatedElevation[N]);const oe=0|q[j+1];q[j]=(0|q[j])+I.r/1.05,q[j+1]=oe+I.g/1.05,q[j+2]=O,q[j+3]=1/(y.z>10?this.tileToMeter:cg(y,oe)),q[j+4]=E[0],q[j+5]=E[1],q[j+6]=E[2]+ie,q[j+7]=k[0],q[j+8]=k[1],q[j+9]=k[2],q[j+10]=k[4],q[j+11]=k[5],q[j+12]=k[6],q[j+13]=k[8],q[j+14]=k[9],q[j+15]=k[10],a.instancesEvaluatedElevation[N]=E[2]}}}ei(lM,"ModelBucket",{omit:["layers"]}),ei(aM,"PerModelAttributes"),ei(sM,"ModelFeature");const uR=new ut({visibility:new de(Be.layout_model.visibility),"model-id":new ze(Be.layout_model["model-id"])});var hR={paint:new ut({"model-opacity":new de(Be.paint_model["model-opacity"]),"model-rotation":new ze(Be.paint_model["model-rotation"]),"model-scale":new ze(Be.paint_model["model-scale"]),"model-translation":new ze(Be.paint_model["model-translation"]),"model-color":new ze(Be.paint_model["model-color"]),"model-color-mix-intensity":new ze(Be.paint_model["model-color-mix-intensity"]),"model-type":new de(Be.paint_model["model-type"]),"model-cast-shadows":new de(Be.paint_model["model-cast-shadows"]),"model-receive-shadows":new de(Be.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new de(Be.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ze(Be.paint_model["model-emissive-strength"]),"model-roughness":new ze(Be.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ze(Be.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new de(Be.paint_model["model-cutoff-fade-range"])}),layout:uR};const Fv=new Float32Array(262144),ch=new Uint8Array(262144);function cM(t){let e=0;if(t.meshes)for(const r of t.meshes)e=Math.max(e,r.aabb.max[2]);if(t.children)for(const r of t.children)e=Math.max(e,cM(r));return e}const uM=["","wall","door","roof","window","lamp","logo"];class hM{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:cM(e)}}}}class fM{constructor(e,r,a,u){this.nodes=e,this.id=r,this.modelTraits|=Zg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=Zg.HasMapboxMeshFeatures),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=u,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const r=this.getNodesInfo();for(const a of r){const u=a.node;this.uploaded?this.updatePbrBuffer(u):zv(u,e,!0)}for(const a of r)Xg(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let r=!1;if(!e.meshes)return r;for(const a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),r=!0);return r}needsReEvaluation(e,r,a){const u=e.transform.projectionOptions,d=e.style.getBrightness(),m=this.brightness!==d;return!!(!this.uploaded||this.dirty||u.name!==this.projection.name||tp(a.paint.get("model-color").value,m)||tp(a.paint.get("model-color-mix-intensity").value,m)||tp(a.paint.get("model-roughness").value,m)||tp(a.paint.get("model-emissive-strength").value,m)||tp(a.paint.get("model-height-based-emissive-strength-multiplier").value,m))&&(this.projection=u,this.brightness=d,!0)}evaluateScale(e,r){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const a=this.getNodesInfo(),u=this.id.canonical;for(const d of a){const m=d.feature;d.evaluatedScale=r.paint.get("model-scale").evaluate(m,{},u)}}evaluate(e){const r=this.getNodesInfo();for(const a of r){if(!a.node.meshes)continue;const u=a.feature,d=a.node.meshes&&a.node.meshes[0].featureData,m=a.evaluatedColor[2],y=a.evaluatedRMEA[2],b=this.id.canonical;if(a.hasTranslucentParts=!1,d){for(let T=0;T<uM.length;T++){const E=uM[T];E.length&&(u.properties.part=E);const I=e.paint.get("model-color").evaluate(u,{},b),k=e.paint.get("model-color-mix-intensity").evaluate(u,{},b);a.evaluatedColor[T]=[I.r,I.g,I.b,k],a.evaluatedRMEA[T][0]=e.paint.get("model-roughness").evaluate(u,{},b),a.evaluatedRMEA[T][2]=e.paint.get("model-emissive-strength").evaluate(u,{},b),a.evaluatedRMEA[T][3]=I.a,a.emissionHeightBasedParams[T]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(u,{},b),!a.hasTranslucentParts&&I.a<1&&(a.hasTranslucentParts=!0)}delete u.properties.part,dR(a,m!==a.evaluatedColor[2]||y!==a.evaluatedRMEA[2])}else a.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(u,{},b);a.evaluatedScale=e.paint.get("model-scale").evaluate(u,{},b),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,r,a,u){const d=e.findDEMTileFor(a);if(d&&(d.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;const m=hf.create(e,a,d);if(!m)return;this.modelTraits&Zg.HasMapboxMeshFeatures&&this.updateDEM(e,m,a,u);for(const y of this.getNodesInfo()){const b=y.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;const T=b.footprint.vertices;let E=m.getElevationAt(T[0].x,T[0].y,!0,!0);for(let I=1;I<T.length;I++)E=Math.min(E,m.getElevationAt(T[I].x,T[I].y,!0,!0));b.elevation=E}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=r}}updateDEM(e,r,a,u){let d=r._dem._modifiedForSources[u];if(d===void 0&&(r._dem._modifiedForSources[u]=[],d=r._dem._modifiedForSources[u]),d.includes(a.canonical))return;const m=r._dem.dim;d.push(a.canonical);let y=!1;for(const b of this.getNodesInfo()){const T=b.node;if(!T.footprint||!T.footprint.grid)continue;const E=T.footprint.grid,I=r.tileCoordToPixel(E.min.x,E.min.y),k=r.tileCoordToPixel(E.max.x,E.max.y),O=Math.min(Math.min(m-k.y,I.x),Math.min(I.y,m-k.x));if(O<0)continue;const z=wt(O,2,5);let N=Math.max(0,I.x-z),j=Math.max(0,I.y-z),q=Math.min(k.x+z,m-1),ie=Math.min(k.y+z,m-1);for(let me=j;me<=ie;++me)for(let Te=N;Te<=q;++Te)ch[me*m+Te]=255;let oe=0,ae=0;for(let me=0;me<E.cellsY;++me)for(let Te=0;Te<E.cellsX;++Te){if(!E.cells[me*E.cellsX+Te])continue;const Pe=r.tileCoordToPixel(E.min.x+Te/E.xScale,E.min.y+me/E.yScale),Re=r.tileCoordToPixel(E.min.x+(Te+1)/E.xScale,E.min.y+(me+1)/E.yScale);for(let Ge=Pe.y;Ge<=Math.min(Re.y+1,m-1);++Ge)for(let Fe=Pe.x;Fe<=Math.min(Re.x+1,m-1);++Fe)ch[Ge*m+Fe]===255&&(ch[Ge*m+Fe]=0,oe+=r.getElevationAtPixel(Fe,Ge),ae++)}const he=oe/ae;N=Math.max(1,I.x-z),j=Math.max(1,I.y-z),q=Math.min(k.x+z,m-2),ie=Math.min(k.y+z,m-2),y=!0;for(let me=j;me<=ie;++me)for(let Te=N;Te<=q;++Te)ch[me*m+Te]===0&&(Fv[me*m+Te]=r._dem.set(Te,me,he));for(let me=1;me<z;++me){N=Math.max(1,I.x-me),j=Math.max(1,I.y-me),q=Math.min(k.x+me,m-2),ie=Math.min(k.y+me,m-2);for(let Te=j;Te<=ie;++Te)for(let Pe=N;Pe<=q;++Pe){const Re=Te*m+Pe;if(ch[Re]===255){let Ge=0,Fe=0,et=-1,bt=-1;for(let Je=-1;Je<=1;++Je)for(let gt=-1;gt<=1;++gt){const Ye=(Te+Je)*m+Pe+gt;if(ch[Ye]>=me)continue;const Vt=Fv[Ye],$t=Math.abs(Vt);$t>Fe&&(Ge=Vt,Fe=$t,et=gt,bt=Je)}if(Fe>.1){const Je=1-(me+.5*Math.abs(et*bt))/z;let gt=r._dem.get(Pe,Te)+Ge*Je;const Ye=r._dem.get(Pe+et,Te+bt),Vt=r._dem.get(Pe-et,Te-bt,!0);(gt-Ye)*(gt-Vt)>0&&(gt=(Ye+Vt)/2),Fv[Re]=r._dem.set(Pe,Te,gt),ch[Re]=me}}}}}y&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=ro.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const e of this.nodes)this.nodesInfo.push(new hM(e));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const e of this.nodes)Yg(e);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const e=this.getNodesInfo();for(const r of e)Xg(r.node),Yg(r.node)}isEmpty(){return!this.nodes.length}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const a=r.getReplacementRegionsForTile(e.toUnwrapped()),u=this.getNodesInfo();for(let d=0;d<this.nodesInfo.length;d++){const m=u[d].node;u[d].hiddenByReplacement=!!m.footprint&&!a.find(y=>y.footprint===m.footprint)}}getHeightAtTileCoord(e,r){const a=this.getNodesInfo(),u=[];for(let d=0;d<this.nodesInfo.length;d++){const m=a[d],y=m.node.meshes[0];if(e<y.aabb.min[0]||r<y.aabb.min[1]||e>y.aabb.max[0]||r>y.aabb.max[1])continue;const b=(e-y.aabb.min[0])/(y.aabb.max[0]-y.aabb.min[0])*lh|0,T=Math.min(63,(r-y.aabb.min[1])/(y.aabb.max[1]-y.aabb.min[1])*lh|0)*lh+Math.min(63,b);if(!(y.heightmap[T]<0&&m.node.footprint))return m.hiddenByReplacement?void 0:{height:y.heightmap[T],maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};if(m.node.footprint.grid.query(new Ie(e,r),new Ie(e,r),u),u.length>0)return{height:void 0,maxHeight:m.feature.properties.height,hidden:m.hiddenByReplacement,verticalScale:m.evaluatedScale[2]}}}}function tp(t,e){return!t.isLightConstant&&e}function fR(t,e,r,a,u,d,m,y){let b=(61440&e|(61440&e)>>4)>>8,T=(3840&e|(3840&e)>>4)>>4,E=240&e|(240&e)>>4;r[3]>0&&(b=Gi(b,255*r[0],r[3]),T=Gi(T,255*r[1],r[3]),E=Gi(E,255*r[2],r[3]));const I=b<<8|T,k=E<<8|Math.floor(255*a[3]),O=function(me){const Te=wt(me,0,2);return Math.min(Math.round(.5*Te*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],z=wt(u[0],0,1),N=wt(u[1],0,1),j=wt(u[2],0,1),q=wt(u[3],0,1);let ie,oe,ae,he;if(z!==N&&m!==d&&N!==z){const me=m-d;oe=1/(me*(N-z)),ae=-(d+me*z)/(me*(N-z));const Te=wt(u[4],-1,1);he=Math.pow(10,Te),ie=255*j<<8|255*q}else ie=65535,oe=0,ae=1,he=1;if(t.emplaceBack(I,k,O,ie,oe,ae,he),y){const me=y.length;y.clear();for(let Te=0;Te<me;Te++)y.emplaceBack(I,k,O,ie,oe,ae,he)}}function dR(t,e){const r=t.node;let a=0;for(const u of r.meshes){if(r.lights&&r.lightMeshIndex===a||!u.featureData)continue;u.featureArray=new Qm,u.featureArray.reserve(u.featureData.length);let d=e;for(const m of u.featureData){let y;const b=65535&m,T=(15&b)<8?15&b:0,E=m>>16&65535,I=t.evaluatedRMEA[T],k=t.evaluatedColor[T],O=t.emissionHeightBasedParams[T];if(d&&T===2&&r.lights&&(y=new Qm,y.resize(10*r.lights.length)),fR(u.featureArray,E,k,I,O,u.aabb.min[2],u.aabb.max[2],y),y&&d){d=!1;const z=r.meshes[r.lightMeshIndex];z.featureArray=y,z.featureArray._trim()}}u.featureArray._trim(),a++}}function Jg(t,e){return t.x-e.x||t.y-e.y}function dM(t,e){return Jg(t.min,e.min)===0&&Jg(t.max,e.max)===0}function pM(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function mM(t,e,r){const a=1/Mt,u=1/(1<<r.canonical.z),d=(e.x*a+r.canonical.x)*u+r.wrap,m=(e.y*a+r.canonical.y)*u;return{min:new Ie((t.x*a+r.canonical.x)*u+r.wrap,(t.y*a+r.canonical.y)*u),max:new Ie(d,m)}}function pR(t,e,r){const a=1<<r.canonical.z,u=((e.x-r.wrap)*a-r.canonical.x)*Mt,d=(e.y*a-r.canonical.y)*Mt;return{min:new Ie(((t.x-r.wrap)*a-r.canonical.x)*Mt,(t.y*a-r.canonical.y)*Mt),max:new Ie(u,d)}}function gM(t,e,r,a,u,d,m){const y=t.indices,b=t.vertices,T=[];for(let E=a;E<a+u;E+=3){const I=e[r[E+0]+d],k=e[r[E+1]+d],O=e[r[E+2]+d],z=Math.min(I.x,k.x,O.x),N=Math.max(I.x,k.x,O.x),j=Math.min(I.y,k.y,O.y),q=Math.max(I.y,k.y,O.y);T.length=0,t.grid.query(new Ie(z,j),new Ie(N,q),T);for(let ie=0;ie<T.length;ie++){const oe=T[ie];if(ov(b[y[3*oe+0]],b[y[3*oe+1]],b[y[3*oe+2]],I,k,O,m))return!0}}return!1}function _M(t,e,r,a){if(!t||!r)return!1;let u=t.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(r.vertices.length<t.vertices.length)return _M(r,a,t,e);const d=e.canonical,m=a.canonical,y=Math.pow(2,m.z-d.z);u=t.vertices.map(b=>new Ie(b.x*d.x*Mt*y-m.x*Mt,b.y*d.y*Mt*y-m.y*Mt))}return gM(r,u,t.indices,0,t.indices.length,0,0)}ei(fM,"Tiled3dModelBucket",{omit:["layers"]}),ei(hM,"Tiled3dModelFeature");const mR=bg.types,gR=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],_R=["fill-extrusion-flood-light-ground-radius"],yR=Math.pow(2,13),vR=Math.pow(2,15)-1,yM=new Ie(0,1),eu=2147483648;function ip(t,e,r,a,u,d,m,y){t.emplaceBack((e<<1)+m,(r<<1)+d,(Math.floor(a*yR)<<1)+u,Math.round(y))}function Kg(t,e,r,a,u,d){t.emplaceBack(e.x,e.y,(r.x<<1)+a,(r.y<<1)+u,d)}function np(t,e,r){t.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class vM{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class xM{constructor(){this.centroidXY=new Ie(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ie(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ie(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ie(this.max.x-this.min.x,this.max.y-this.min.y)}}class bM{constructor(){this.acc=new Ie(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,r){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=r.x,e.min.y=e.max.y=r.y)}appendEdge(e,r,a){this.accCount++,this.acc._add(r);let u=!!this.borders;r.x<e.min.x?(e.min.x=r.x,u=!0):r.x>e.max.x&&(e.max.x=r.x,u=!0),r.y<e.min.y?(e.min.y=r.y,u=!0):r.y>e.max.y&&(e.max.y=r.y,u=!0),((r.x===0||r.x===Mt)&&r.x===a.x)!=((r.y===0||r.y===Mt)&&r.y===a.y)&&this.processBorderOverlap(r,a),u&&this.checkBorderIntersection(r,a)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,Gi(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>Mt!=e.x>Mt&&this.addBorderIntersection(1,Gi(r.y,e.y,(Mt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,Gi(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>Mt!=e.y>Mt&&this.addBorderIntersection(3,Gi(r.x,e.x,(Mt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];r<a[0]&&(a[0]=r),r>a[1]&&(a[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,r.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,r.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new Ie(0,0):new Ie(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0):0}}function wM(t,e){const r=t.add(e)._unit(),a=wt(t.x*r.x+t.y*r.y,-1,1);var u,d,m;return u=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(u)))/4*vR*((d=t).x*(m=e).y-d.y*m.x<0?-1:1)}const xR=[t=>t.x<0,t=>t.x>Mt,t=>t.y<0,t=>t.y>Mt];function bR(t,e,r,a){const u=[4];if(a===0)return u;r._mult(a);const d=t.sub(r),m=e.sub(r),y=[t,e,d,m];for(let b=0;b<4;b++)for(const T of y)if(xR[b](T)){u.push(b);break}return u}class TM{constructor(e){this.vertexArray=new Do,this.indexArray=new An,this.programConfigurations=new Uc(e.layers,e.zoom,r=>_R.includes(r)),this._segments=new or,this.hiddenByLandmarkVertexArray=new v0,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new or}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,r,a,u=!1){const d=e.length;if(d>2){let m=Math.max(0,this._segments.get().length-1);const y=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let b;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const T=e[0],E=e[1];b=wM(T.sub(e[d-1])._perp()._unit(),E.sub(T)._perp()._unit())}for(let T=0;T<d;T++){const E=T===d-1?0:T+1,I=e[T],k=e[E],O=e[E===d-1?0:E+1],z=k.sub(I)._perp()._unit(),N=wM(z,O.sub(k)._perp()._unit()),j=b,q=N;if(Bv(I,k,r)||u&&EM(I,r)&&EM(k,r)){b=N;continue}const ie=y.vertexLength;Kg(this.vertexArray,I,k,1,1,j),Kg(this.vertexArray,I,k,1,0,j),Kg(this.vertexArray,I,k,0,1,q),Kg(this.vertexArray,I,k,0,0,q),y.vertexLength+=4;const oe=bR(I,k,z,a);for(const ae of oe)this._segmentToGroundQuads[m].push({id:ie,region:ae}),this._segmentToRegionTriCounts[m][ae]+=2,y.primitiveLength+=2;b=N}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),r=e.length;for(let a=0;a<r;a++)this._segmentToGroundQuads[a].sort((u,d)=>u.region-d.region);for(let a=0;a<r;a++){const u=this._segmentToGroundQuads[a],d=e[a],m=this._segmentToRegionTriCounts[a];m.reduce((b,T)=>b+T,0);let y=0;for(let b=0;b<=4;b++){const T=m[b];if(T!==0){let E=this.regionSegments[b];E||(E=this.regionSegments[b]=new or);const I={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+y,vertexLength:d.vertexLength,primitiveLength:T};E.get().push(I)}y+=T}for(let b=0;b<u.length;b++){const T=u[b].id;this.indexArray.emplaceBack(T,T+1,T+3),this.indexArray.emplaceBack(T,T+3,T+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,r,a,u,d,m){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,r,a,u,d,m)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,zL.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,r,a,u,d,m){this.hasData()&&this.programConfigurations.updatePaintArrays(e,r,a,u,d,m)}updateHiddenByLandmark(e){if(!this.hasData())return;const r=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const a=e.flags&eu?1:0;for(let u=e.groundVertexArrayOffset;u<r;++u)this.hiddenByLandmarkVertexArray.emplace(u,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,BL.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const r=this.regionSegments[e];r&&r.destroy()}}}}class rp{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new An,this.footprintVertices=new Li,this.footprintSegments=[],this.layoutVertexArray=new Mn,this.centroidVertexArray=new Xb,this.indexArray=new An,this.programConfigurations=new Uc(e.layers,e.zoom,r=>gR.includes(r)),this.segments=new or,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new TM(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,r,a,u){this.features=[],this.hasPattern=fv("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=cg(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:d,id:m,index:y,sourceLayerIndex:b}of e){const T=this.layers[0]._featureFilter.needGeometry,E=Wc(d,T);if(!this.layers[0]._featureFilter.filter(new be(this.zoom),E,a))continue;const I={id:m,sourceLayerIndex:b,index:y,geometry:T?E.geometry:gl(d,a,u),properties:d.properties,type:d.type,patterns:{}},k=this.layoutVertexArray.length;this.hasPattern?this.features.push(dv("fill-extrusion",this.layers,I,this.zoom,r)):this.addFeature(I,I.geometry,y,a,{},r.availableImages,u,r.brightness),r.featureIndex.insert(d,I.geometry,y,b,this.index,k)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,r,a,u,d,m){for(const y of this.features){const{geometry:b}=y;this.addFeature(y,b,y.index,r,a,u,d,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,r,a,u,d){const m=Object.keys(e).length!==0;if(m&&!this.stateDependentLayers.length)return;const y=m?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,r,y,a,u,d),this.groundEffect.update(e,r,y,a,u,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,VL),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,NL.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,FL.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,u,d,m,y,b){const T=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,E=[new Ie(0,0),new Ie(Mt,Mt)],I=y.projection,k=I.name==="globe",O=mR[e.type]==="Polygon",z=new bM;z.centroidDataIndex=this.centroidData.length;const N=new xM,j=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},u)<=0,q=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},u);N.height=q,N.vertexArrayOffset=this.layoutVertexArray.length,N.groundVertexArrayOffset=this.groundEffect.vertexArray.length,k&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Jn);const ie=hv(r,500);for(let Pe=ie.length-1;Pe>=0;Pe--){const Re=ie[Pe];(Re.length===0||(oe=Re[0]).every(Ge=>Ge.x<=0)||oe.every(Ge=>Ge.x>=Mt)||oe.every(Ge=>Ge.y<=0)||oe.every(Ge=>Ge.y>=Mt))&&ie.splice(Pe,1)}var oe;let ae;if(k)ae=PM(ie,E,u);else{ae=[];for(const Pe of ie)ae.push({polygon:Pe,bounds:E})}const he=O?this.edgeRadius:0,me=he>0&&this.zoom<17,Te=(Pe,Re)=>{if(Pe.length===0)return!1;const Ge=Pe[Pe.length-1];return Re.x===Ge.x&&Re.y===Ge.y};for(const{polygon:Pe,bounds:Re}of ae){let Ge=0,Fe=0;for(const gt of Pe)O&&!gt[0].equals(gt[gt.length-1])&&gt.push(gt[0]),Fe+=O?gt.length-1:gt.length;const et=this.segments.prepareSegment((O?5:4)*Fe,this.layoutVertexArray,this.indexArray);N.footprintSegIdx<0&&(N.footprintSegIdx=this.footprintSegments.length),N.polygonSegIdx<0&&(N.polygonSegIdx=this.polygonSegments.length);const bt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Je=new vM;if(Je.vertexOffset=this.footprintVertices.length,Je.indexOffset=3*this.footprintIndices.length,Je.ringIndices=[],O){const gt=[],Ye=[];Ge=et.vertexLength;for(let $t=0;$t<Pe.length;$t++){const vt=Pe[$t];vt.length&&$t!==0&&Ye.push(gt.length/2);const vi=[];let ii,Ot;ii=vt[1].sub(vt[0])._perp()._unit(),Je.ringIndices.push(vt.length-1);for(let xi=1;xi<vt.length;xi++){const ci=vt[xi],gi=vt[xi===vt.length-1?1:xi+1],It=ci.clone();if(he){Ot=gi.sub(ci)._perp()._unit();const Ei=ii.add(Ot)._unit(),en=he*Math.min(4,1/(ii.x*Ei.x+ii.y*Ei.y));It.x+=en*Ei.x,It.y+=en*Ei.y,It.x=Math.round(It.x),It.y=Math.round(It.y),ii=Ot}!j||he!==0&&!me||Te(vi,It)||vi.push(It),ip(this.layoutVertexArray,It.x,It.y,0,0,1,1,0),et.vertexLength++,this.footprintVertices.emplaceBack(ci.x,ci.y),gt.push(ci.x,ci.y),k&&np(this.layoutVertexExtArray,I.projectTilePoint(It.x,It.y,u),I.upVector(u,It.x,It.y))}j&&(he===0||me)&&(vi.length!==0&&Te(vi,vi[0])&&vi.pop(),this.groundEffect.addData(vi,Re,T))}const Vt=yg(gt,Ye);for(let $t=0;$t<Vt.length;$t+=3)this.footprintIndices.emplaceBack(Je.vertexOffset+Vt[$t+0],Je.vertexOffset+Vt[$t+1],Je.vertexOffset+Vt[$t+2]),this.indexArray.emplaceBack(Ge+Vt[$t],Ge+Vt[$t+2],Ge+Vt[$t+1]),et.primitiveLength++;Je.indexCount+=Vt.length,Je.vertexCount+=this.footprintVertices.length-Je.vertexOffset}for(let gt=0;gt<Pe.length;gt++){const Ye=Pe[gt];z.startRing(N,Ye[0]);let Vt=Ye.length>4&&AM(Ye[Ye.length-2],Ye[0],Ye[1]),$t=he?wR(Ye[Ye.length-2],Ye[0],Ye[1],he):0;const vt=[];let vi,ii,Ot;ii=Ye[1].sub(Ye[0])._perp()._unit();let xi=!0;for(let ci=1,gi=0;ci<Ye.length;ci++){let It=Ye[ci-1],Ei=Ye[ci];const en=Ye[ci===Ye.length-1?1:ci+1];if(z.appendEdge(N,Ei,It),Bv(Ei,It,Re)){he&&(ii=en.sub(Ei)._perp()._unit(),xi=!xi);continue}const Oi=Ei.sub(It)._perp(),Qi=Oi.x/(Math.abs(Oi.x)+Math.abs(Oi.y)),dn=Oi.y>0?1:0,Vn=It.dist(Ei);if(gi+Vn>32768&&(gi=0),he){Ot=en.sub(Ei)._perp()._unit();let xn=MM(It,Ei,en,SM(ii,Ot),he);isNaN(xn)&&(xn=0);const En=Ei.sub(It)._unit();It=It.add(En.mult($t))._round(),Ei=Ei.add(En.mult(-xn))._round(),$t=xn,ii=Ot,j&&this.zoom>=17&&(Te(vt,It)||vt.push(It),Te(vt,Ei)||vt.push(Ei))}const Hi=et.vertexLength,Qn=Ye.length>4&&AM(It,Ei,en);let Un=IM(gi,Vt,xi);if(ip(this.layoutVertexArray,It.x,It.y,Qi,dn,0,0,Un),ip(this.layoutVertexArray,It.x,It.y,Qi,dn,0,1,Un),gi+=Vn,Un=IM(gi,Qn,!xi),Vt=Qn,ip(this.layoutVertexArray,Ei.x,Ei.y,Qi,dn,0,0,Un),ip(this.layoutVertexArray,Ei.x,Ei.y,Qi,dn,0,1,Un),et.vertexLength+=4,this.indexArray.emplaceBack(Hi+0,Hi+1,Hi+2),this.indexArray.emplaceBack(Hi+1,Hi+3,Hi+2),et.primitiveLength+=2,he){const xn=Ge+(ci===1?Ye.length-2:ci-2),En=ci===1?Ge:xn+1;if(this.indexArray.emplaceBack(Hi+1,xn,Hi+3),this.indexArray.emplaceBack(xn,En,Hi+3),et.primitiveLength+=2,vi===void 0&&(vi=Hi),!Bv(en,Ye[ci],Re)){const pn=ci===Ye.length-1?vi:et.vertexLength;this.indexArray.emplaceBack(Hi+2,Hi+3,pn),this.indexArray.emplaceBack(Hi+3,pn+1,pn),this.indexArray.emplaceBack(Hi+3,En,pn+1),et.primitiveLength+=3}xi=!xi}if(k){const xn=this.layoutVertexExtArray,En=I.projectTilePoint(It.x,It.y,u),pn=I.projectTilePoint(Ei.x,Ei.y,u),gr=I.upVector(u,It.x,It.y),$n=I.upVector(u,Ei.x,Ei.y);np(xn,En,gr),np(xn,En,gr),np(xn,pn,$n),np(xn,pn,$n)}}O&&(Ge+=Ye.length-1),j&&he&&this.zoom>=17&&(vt.length!==0&&Te(vt,vt[0])&&vt.pop(),this.groundEffect.addData(vt,Re,T,he>0))}this.footprintSegments.push(Je),bt.triangleCount=this.indexArray.length-bt.triangleArrayOffset,this.polygonSegments.push(bt),++N.footprintSegLen,++N.polygonSegLen}if(N.vertexCount=this.layoutVertexArray.length-N.vertexArrayOffset,N.groundVertexCount=this.groundEffect.vertexArray.length-N.groundVertexArrayOffset,N.vertexCount!==0){if(N.centroidXY=z.borders?yM:this.encodeCentroid(z,N),this.centroidData.push(N),z.borders){this.featuresOnBorder.push(z);const Pe=this.featuresOnBorder.length-1;for(let Re=0;Re<z.borders.length;Re++)z.borders[Re][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Re].push(Pe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,m,u,b),this.groundEffect.addPaintPropertiesData(e,a,d,m,u,b),this.maxHeight=Math.max(this.maxHeight,q)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((r,a)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){const e=[];for(let y=0;y<this.centroidData.length;y++){const b=this.centroidData[y],T=+(b.min.y+b.max.y>Mt),E=2*T+(+(b.min.x+b.max.x>Mt)^T);for(let I=0;I<b.polygonSegLen;I++){const k=b.polygonSegIdx+I;e.push({centroidIdx:y,subtile:E,polygonSegmentIdx:k,triangleSegmentIdx:this.polygonSegments[k].triangleSegIdx})}}const r=new An;e.sort((y,b)=>y.triangleSegmentIdx===b.triangleSegmentIdx?y.subtile-b.subtile:y.triangleSegmentIdx-b.triangleSegmentIdx);let a=0,u=0,d=0;for(const y of e){if(y.triangleSegmentIdx!==a)break;d++}const m=e.length;for(;u!==e.length;){a=e[u].triangleSegmentIdx;let y=0,b=u,T=u;for(let E=b;E<d&&e[E].subtile===y;E++)T++;for(;b!==d;){const E=e[b];y=E.subtile;const I=this.centroidData[E.centroidIdx].min.clone(),k=this.centroidData[E.centroidIdx].max.clone(),O={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let z=b;z<T;z++){const N=e[z],j=this.polygonSegments[N.polygonSegmentIdx],q=this.centroidData[N.centroidIdx].min,ie=this.centroidData[N.centroidIdx].max,oe=this.indexArray.uint16;for(let ae=j.triangleArrayOffset;ae<j.triangleArrayOffset+j.triangleCount;ae++)r.emplaceBack(oe[3*ae],oe[3*ae+1],oe[3*ae+2]);O.primitiveLength+=j.triangleCount,I.x=Math.min(I.x,q.x),I.y=Math.min(I.y,q.y),k.x=Math.max(k.x,ie.x),k.y=Math.max(k.y,ie.y)}O.primitiveLength>0&&this.triangleSubSegments.push({segment:O,min:I,max:k}),b=T;for(let z=b;z<d&&e[z].subtile===e[b].subtile;z++)T++}u=d;for(let E=u;E<m&&e[E].triangleSegmentIdx===e[u].triangleSegmentIdx;E++)d++}r._trim(),this.indexArray=r}getVisibleSegments(e,r,a){let u=0,d=0;const m=1<<e.canonical.z;if(r){const N=r.getMinMaxForTile(e);N&&(u=N.min,d=N.max)}d+=this.maxHeight;const y=e.toUnwrapped();let b;const T=[y.canonical.x/m+y.wrap,y.canonical.y/m],E=[(y.canonical.x+1)/m+y.wrap,(y.canonical.y+1)/m],I=new or,k=(N,j,q)=>[N[0]*(1-q[0])+j[0]*q[0],N[1]*(1-q[1])+j[1]*q[1]],O=[],z=[];for(const N of this.triangleSubSegments){O[0]=N.min.x/Mt,O[1]=N.min.y/Mt,z[0]=N.max.x/Mt,z[1]=N.max.y/Mt;const j=k(T,E,O),q=k(T,E,z);if(new Ir([j[0],j[1],u],[q[0],q[1],d]).intersectsPrecise(a)===0){b&&(I.segments.push(b),b=void 0);continue}const ie=N.segment;b&&b.vertexOffset!==ie.vertexOffset&&(I.segments.push(b),b=void 0),b?(b.vertexLength+=ie.vertexLength,b.primitiveLength+=ie.primitiveLength):b={vertexOffset:ie.vertexOffset,primitiveLength:ie.primitiveLength,vertexLength:ie.vertexLength,primitiveOffset:ie.primitiveOffset,sortKey:void 0,vaos:{}}}return b&&I.segments.push(b),I}encodeCentroid(e,r){const a=e.centroid(),u=r.span(),d=Math.min(7,Math.round(u.x*this.tileToMeter/10)),m=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new Ie(wt(a.x,1,Mt-1)<<3|d,wt(a.y,1,Mt-1)<<3|m)}encodeBorderCentroid(e){if(!e.borders)return new Ie(0,0);const r=e.borders,a=Number.MAX_VALUE;if(r[0][0]!==a||r[1][0]!==a){const u=r[0][0]!==a?0:1;return new Ie(6|(r[0][0]!==a?0:65528),((r[u][0]+r[u][1])/2|0)<<3|6)}{const u=r[2][0]!==a?2:3;return new Ie(((r[u][0]+r[u][1])/2|0)<<3|6,6|(r[2][0]!==a?0:65528))}}showCentroid(e){const r=this.centroidData[e.centroidDataIndex];r.flags&=eu,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const r=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,u=e.flags&eu?yM:e.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==u.y||d!==u.x){for(let m=r;m<a;++m)this.centroidVertexArray.emplace(m,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const a=r.getReplacementRegionsForTile(e.toUnwrapped());if(function(d,m){if(d.length!==m.length)return!1;for(let y=0;y<d.length;y++)if(d[y].sourceId!==m[y].sourceId||!dM(d[y],m[y]))return!1;return!0}(this.activeReplacements,a))return;if(this.activeReplacements=a,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const d of this.centroidData)d.flags&=2147483647;const u=[];for(const d of this.activeReplacements){const m=Math.pow(2,d.footprintTileId.canonical.z-e.canonical.z);for(const y of this.centroidData)if(!(y.flags&eu||d.min.x>y.max.x||y.min.x>d.max.x||d.min.y>y.max.y||y.min.y>d.max.y))for(let b=0;b<y.footprintSegLen;b++){const T=this.footprintSegments[y.footprintSegIdx+b];if(u.length=0,TR(this.footprintVertices,T.vertexOffset,T.vertexCount,d.footprintTileId.canonical,e.canonical,u),gM(d.footprint,u,this.footprintIndices.uint16,T.indexOffset,T.indexCount,-T.vertexOffset,-m)){y.flags|=eu;break}}}for(const d of this.centroidData)this.writeCentroidToBuffer(d);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,r,a){let u=!1;for(let d=0;d<a.footprintSegLen;d++){const m=this.footprintSegments[a.footprintSegIdx+d];let y=0;for(const b of m.ringIndices){for(let T=y,E=b+y-1;T<b+y;E=T++){const I=this.footprintVertices.int16[2*(T+m.vertexOffset)+0],k=this.footprintVertices.int16[2*(T+m.vertexOffset)+1],O=this.footprintVertices.int16[2*(E+m.vertexOffset)+1];k>r!=O>r&&e<(this.footprintVertices.int16[2*(E+m.vertexOffset)+0]-I)*(r-k)/(O-k)+I&&(u=!u)}y=b}}return u}getHeightAtTileCoord(e,r){let a=Number.NEGATIVE_INFINITY,u=!0;const d=4*(e+Mt)*Mt+(r+Mt);if(this.partLookup.hasOwnProperty(d)){const m=this.partLookup[d];return m?{height:m.height,hidden:!!(m.flags&eu)}:void 0}for(const m of this.centroidData)e>m.max.x||m.min.x>e||r>m.max.y||m.min.y>r||this.footprintContainsPoint(e,r,m)&&m&&m.height>a&&(a=m.height,this.partLookup[d]=m,u=!!(m.flags&eu));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:u};this.partLookup[d]=void 0}}function SM(t,e){const r=t.add(e)._unit();return t.x*r.x+t.y*r.y}function wR(t,e,r,a){const u=e.sub(t)._perp()._unit(),d=r.sub(e)._perp()._unit();return MM(t,e,r,SM(u,d),a)}function MM(t,e,r,a,u){const d=Math.sqrt(1-a*a);return Math.min(t.dist(e)/3,e.dist(r)/3,u*d/a)}function Bv(t,e,r){return t.x<r[0].x&&e.x<r[0].x||t.x>r[1].x&&e.x>r[1].x||t.y<r[0].y&&e.y<r[0].y||t.y>r[1].y&&e.y>r[1].y}function EM(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function AM(t,e,r){if(t.x<0||t.x>=Mt||e.x<0||e.x>=Mt||r.x<0||r.x>=Mt)return!1;const a=r.sub(e),u=a.perp(),d=t.sub(e);return(a.x*d.x+a.y*d.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(d.x*d.x+d.y*d.y))>-.866&&u.x*d.x+u.y*d.y<0}function IM(t,e,r){const a=e?2|t:-3&t;return r?1|a:-2&a}function CM(){const t=Math.PI/32,e=Math.tan(t),r=Vd;return r*Math.sqrt(1+2*e*e)-r}function PM(t,e,r){const a=1<<r.z,u=Cs(r.x/a),d=Cs((r.x+1)/a),m=ho(r.y/a),y=ho((r.y+1)/a);return function(b,T,E,I,k=0,O){const z=[];if(!b.length||!E||!I)return z;const N=(me,Te)=>{for(const Pe of me)z.push({polygon:Pe,bounds:Te})},j=Math.ceil(Math.log2(E)),q=Math.ceil(Math.log2(I)),ie=j-q,oe=[];for(let me=0;me<Math.abs(ie);me++)oe.push(ie>0?0:1);for(let me=0;me<Math.min(j,q);me++)oe.push(0),oe.push(1);let ae=b;if(ae=wg(ae,T[0].y-k,T[1].y+k,1),ae=wg(ae,T[0].x-k,T[1].x+k,0),!ae.length)return z;const he=[];for(oe.length?he.push({polygons:ae,bounds:T,depth:0}):N(ae,T);he.length;){const me=he.pop(),Te=me.depth,Pe=oe[Te],Re=me.bounds[0],Ge=me.bounds[1],Fe=Pe===0?Re.x:Re.y,et=Pe===0?Ge.x:Ge.y,bt=O?O(Pe,Fe,et):.5*(Fe+et),Je=wg(me.polygons,Fe-k,bt+k,Pe),gt=wg(me.polygons,bt-k,et+k,Pe);if(Je.length){const Ye=[Re,new Ie(Pe===0?bt:Ge.x,Pe===1?bt:Ge.y)];oe.length>Te+1?he.push({polygons:Je,bounds:Ye,depth:Te+1}):N(Je,Ye)}if(gt.length){const Ye=[new Ie(Pe===0?bt:Re.x,Pe===1?bt:Re.y),Ge];oe.length>Te+1?he.push({polygons:gt,bounds:Ye,depth:Te+1}):N(gt,Ye)}}return z}(t,e,Math.ceil((d-u)/11.25),Math.ceil((m-y)/11.25),1,(b,T,E)=>{if(b===0)return .5*(T+E);{const I=ho((r.y+T/Mt)/a);return(ml(.5*(ho((r.y+E/Mt)/a)+I))*a-r.y)*Mt}})}function TR(t,e,r,a,u,d){const m=Math.pow(2,a.z-u.z);for(let y=0;y<r;y++){let b=t.int16[2*(y+e)+0],T=t.int16[2*(y+e)+1];b=(b+u.x*Mt)*m-a.x*Mt,T=(T+u.y*Mt)*m-a.y*Mt,d.push(new Ie(b,T))}}ei(rp,"FillExtrusionBucket",{omit:["layers","features"]}),ei(xM,"PartData"),ei(vM,"FootprintSegment"),ei(bM,"BorderCentroidData"),ei(TM,"GroundEffect");const SR=new ut({visibility:new de(Be["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new de(Be["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var MR={paint:new ut({"fill-extrusion-opacity":new de(Be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ze(Be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new de(Be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new de(Be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ze(Be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ze(Be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ze(Be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new de(Be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new de(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new de(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new de(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new de(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new de(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new de(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new de(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ze(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ze(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new de(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new de(Be["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new de(Be["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new de(Be["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new de(Be["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:SR};class vf extends Ie{constructor(e,r,a){super(e,r),this.z=a}}function op(t,e){return t.x*e.x+t.y*e.y}function kM(t,e){if(t.length===1){let r=0;const a=e[r++];let u;for(;!u||a.equals(u);)if(u=e[r++],!u)return 1/0;for(;r<e.length;r++){const d=e[r],m=t[0],y=u.sub(a),b=d.sub(a),T=m.sub(a),E=op(y,y),I=op(y,b),k=op(b,b),O=op(T,y),z=op(T,b),N=E*k-I*I,j=(k*O-I*z)/N,q=(E*z-I*O)/N,ie=a.z*(1-j-q)+u.z*j+d.z*q;if(isFinite(ie))return ie}return 1/0}{let r=1/0;for(const a of e)r=Math.min(r,a.z);return r}}function DM(t,e,r,a,u,d,m,y){const b=m*u.getElevationAt(t,e,!0,!0),T=d[0]!==0,E=T?d[1]===0?m*(d[0]/7-450):m*function(I,k,O){const z=Math.floor(k[0]/8),N=Math.floor(k[1]/8),j=10*(k[0]-8*z),q=10*(k[1]-8*N),ie=I.getElevationAt(z,N,!0,!0),oe=I.getMeterToDEM(O),ae=Math.floor(.5*(j*oe-1)),he=Math.floor(.5*(q*oe-1)),me=I.tileCoordToPixel(z,N),Te=2*ae+1,Pe=2*he+1,Re=function(gt,Ye,Vt,$t,vt){return[gt.getElevationAtPixel(Ye,Vt,!0),gt.getElevationAtPixel(Ye+vt,Vt,!0),gt.getElevationAtPixel(Ye,Vt+vt,!0),gt.getElevationAtPixel(Ye+$t,Vt+vt,!0)]}(I,me.x-ae,me.y-he,Te,Pe),Ge=Math.abs(Re[0]-Re[1]),Fe=Math.abs(Re[2]-Re[3]),et=Math.abs(Re[0]-Re[2])+Math.abs(Re[1]-Re[3]),bt=Math.min(.25,.5*oe*(Ge+Fe)/Te),Je=Math.min(.25,.5*oe*et/Pe);return ie+Math.max(bt*j,Je*q)}(u,d,y):b;return{base:b+(r===0)?-1:r,top:T?Math.max(E+a,b+r+2):b+a}}const ER=new ut({"line-cap":new ze(Be.layout_line["line-cap"]),"line-join":new ze(Be.layout_line["line-join"]),"line-miter-limit":new de(Be.layout_line["line-miter-limit"]),"line-round-limit":new de(Be.layout_line["line-round-limit"]),"line-sort-key":new ze(Be.layout_line["line-sort-key"]),visibility:new de(Be.layout_line.visibility)});var LM={paint:new ut({"line-opacity":new ze(Be.paint_line["line-opacity"]),"line-color":new ze(Be.paint_line["line-color"]),"line-translate":new de(Be.paint_line["line-translate"]),"line-translate-anchor":new de(Be.paint_line["line-translate-anchor"]),"line-width":new ze(Be.paint_line["line-width"]),"line-gap-width":new ze(Be.paint_line["line-gap-width"]),"line-offset":new ze(Be.paint_line["line-offset"]),"line-blur":new ze(Be.paint_line["line-blur"]),"line-dasharray":new ze(Be.paint_line["line-dasharray"]),"line-pattern":new ze(Be.paint_line["line-pattern"]),"line-gradient":new _t(Be.paint_line["line-gradient"]),"line-trim-offset":new de(Be.paint_line["line-trim-offset"]),"line-emissive-strength":new de(Be.paint_line["line-emissive-strength"]),"line-border-width":new ze(Be.paint_line["line-border-width"]),"line-border-color":new ze(Be.paint_line["line-border-color"])}),layout:ER};function OM(t,e){return 1/nM(t,1,e.tileZoom)}function RM(t,e,r,a){return t.translatePosMatrix(a||e.tileID.projMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const zM=t=>{const e=[];FM(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const r=t.paint.get("line-trim-offset");return r[0]===0&&r[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER"),e};function FM(t){const e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}const BM=new class extends ze{possiblyEvaluate(t,e){return e=new be(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,r,a){return e=rt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,r,a)}}(LM.paint.properties["line-width"].specification);function NM(t,e){return e>0?e+2*t:t}BM.useIntegerZoom=!0;const AR=new ut({visibility:new de(Be.layout_background.visibility)});var IR={paint:new ut({"background-color":new de(Be.paint_background["background-color"]),"background-pattern":new de(Be.paint_background["background-pattern"]),"background-opacity":new de(Be.paint_background["background-opacity"]),"background-emissive-strength":new de(Be.paint_background["background-emissive-strength"])}),layout:AR};const CR=new ut({visibility:new de(Be.layout_raster.visibility)});var PR={paint:new ut({"raster-opacity":new de(Be.paint_raster["raster-opacity"]),"raster-color":new _t(Be.paint_raster["raster-color"]),"raster-color-mix":new de(Be.paint_raster["raster-color-mix"]),"raster-color-range":new de(Be.paint_raster["raster-color-range"]),"raster-hue-rotate":new de(Be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new de(Be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new de(Be.paint_raster["raster-brightness-max"]),"raster-saturation":new de(Be.paint_raster["raster-saturation"]),"raster-contrast":new de(Be.paint_raster["raster-contrast"]),"raster-resampling":new de(Be.paint_raster["raster-resampling"]),"raster-fade-duration":new de(Be.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new de(Be.paint_raster["raster-emissive-strength"]),"raster-array-band":new de(Be.paint_raster["raster-array-band"]),"raster-elevation":new de(Be.paint_raster["raster-elevation"])}),layout:CR};function Qg(t,e,r,a,u,d,m,y){const b=[t,e,1,r,a,1,u,d,1],T=[m,y,1],E=s.bx.adjoint([],b),[I,k,O]=s.v.transformMat3(T,T,E);return s.bx.multiply(b,b,[I,0,0,0,k,0,0,0,O])}function VM(t,e,r,a,u,d,m,y){const b=function(T,E,I,k,O,z,N,j){const q=Qg(0,0,1,0,1,1,0,1),ie=Qg(T,E,I,k,O,z,N,j),oe=s.bx.adjoint([],q);return s.bx.multiply(ie,ie,oe)}(t,e,r,a,u,d,m,y);return[b[2]/b[8]/Mt,b[5]/b[8]/Mt]}function $g(t){return[t[0],Math.min(Math.max(t[1],-br),br)]}class UM extends so{constructor(e,r,a,u){super(),this.id=e,this.dispatcher=a,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=r,this._dirty=!1}load(e,r){if(this._loaded=r||!1,this.fire(new xo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=lt(this.map._requestManager.transformRequest(this.url,Wi.Image),(a,u)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new Po(a)):u&&(this.image=u instanceof HTMLImageElement?ro.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new jg(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new xo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof jg||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=e[0][1],a=e[0][1];for(const d of e)d[1]>a&&(a=d[1]),d[1]<r&&(r=d[1]);const u=(a+r)/2;if(u>br?this.onNorthPole=!0:u<-br&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const d=e.map(To.fromLngLat);this.tileID=function(m){let y=1/0,b=1/0,T=-1/0,E=-1/0;for(const N of m)y=Math.min(y,N.x),b=Math.min(b,N.y),T=Math.max(T,N.x),E=Math.max(E,N.y);const I=Math.max(T-y,E-b),k=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),O=Math.pow(2,k);let z=Math.floor((y+T)/2*O);return z>1&&(z-=1),new th(k,z,Math.floor((b+E)/2*O))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new xo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const j in this.tiles){const q=this.tiles[j];q.state!=="loaded"&&(q.state="loaded",q.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const r=Yc(new th(0,0,0),this.map.transform.projection),a=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(j){const q=j[1].x-j[0].x,ie=j[1].y-j[0].y,oe=j[2].x-j[1].x,ae=j[2].y-j[1].y,he=j[3].x-j[2].x,me=j[3].y-j[2].y,Te=j[0].x-j[3].x,Pe=j[0].y-j[3].y,Re=q*ae-oe*ie,Ge=oe*me-he*ae,Fe=he*Pe-Te*me,et=Te*ie-q*Pe;return Re>0&&Ge>0&&Fe>0&&et>0||Re<0&&Ge<0&&Fe<0&&et<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const u=Yc(this.tileID,this.map.transform.projection),[d,m,y,b]=this.coordinates.map(j=>{const q=u.projection.project(j[0],j[1]);return GS(u,q)._round()});this.perspectiveTransform=VM(d.x,d.y,m.x,m.y,y.x,y.y,b.x,b.y);const T=this._boundsArray=new Mn;T.emplaceBack(d.x,d.y,0,0),T.emplaceBack(m.x,m.y,Mt,0),T.emplaceBack(b.x,b.y,0,Mt),T.emplaceBack(y.x,y.y,Mt,Mt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(T,Hg.members),this.boundsSegments=or.simpleSegment(0,0,4,2);const E=[],I=function(j){return[$g(j[0]),$g(j[1]),$g(j[2]),$g(j[3])]}(this.coordinates),[k,O,z,N]=function(j){let q=j[0][0],ie=q,oe=j[0][1],ae=oe;for(let he=1;he<j.length;he++)j[he][0]<q?q=j[he][0]:j[he][0]>ie&&(ie=j[he][0]),j[he][1]<oe?oe=j[he][1]:j[he][1]>ae&&(ae=j[he][1]);return[q,oe,ie-q,ae-oe]}(I);{const j=new Mn,[q,ie,oe,ae]=function(Ye){let Vt=Ye[0].x,$t=Vt,vt=Ye[0].y,vi=vt;for(let ii=1;ii<Ye.length;ii++)Ye[ii].x<Vt?Vt=Ye[ii].x:Ye[ii].x>$t&&($t=Ye[ii].x),Ye[ii].y<vt?vt=Ye[ii].y:Ye[ii].y>vi&&(vi=Ye[ii].y);return[Vt,vt,$t-Vt,vi-vt]}(a),he=Ye=>[(Ye.x-q)/oe,(Ye.y-ie)/ae],[me,Te,Pe,Re]=a.map(he),Ge=function(Ye,Vt,$t,vt,vi,ii,Ot,xi){const ci=Qg(0,0,1,0,1,1,0,1),gi=Qg(Ye,Vt,$t,vt,vi,ii,Ot,xi),It=s.bx.adjoint([],gi);return s.bx.multiply(ci,ci,It)}(me[0],me[1],Te[0],Te[1],Pe[0],Pe[1],Re[0],Re[1]);this.elevatedGlobePerspectiveTransform=VM(me[0],me[1],Te[0],Te[1],Pe[0],Pe[1],Re[0],Re[1]);const Fe=(Ye,Vt)=>{E.push(Ye.lng);const $t=Math.round((Ye.lng-k)/z*Mt),vt=Math.round((Ye.lat-O)/N*Mt),vi=he(Vt),ii=s.v.transformMat3([],[vi[0],vi[1],1],Ge),Ot=Math.round(ii[0]/ii[2]*Mt),xi=Math.round(ii[1]/ii[2]*Mt);j.emplaceBack($t,vt,Ot,xi)},et=a[3].x-a[0].x,bt=a[3].y-a[0].y,Je=a[2].x-a[1].x,gt=a[2].y-a[1].y;for(let Ye=0;Ye<65;Ye++){const Vt=Ye/64,$t=[a[0].x+Vt*et,a[0].y+Vt*bt],vt=[a[1].x+Vt*Je,a[1].y+Vt*gt],vi=vt[0]-$t[0],ii=vt[1]-$t[1];for(let Ot=0;Ot<65;Ot++){const xi=Ot/64,ci={x:$t[0]+vi*xi,y:$t[1]+ii*xi,z:0};Fe(r.projection.unproject(ci.x,ci.y),ci)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(j,Hg.members)}{this.maxLongitudeTriangleSize=0;let j=[],q=new An;const ie=(oe,ae,he)=>{q.emplaceBack(oe,ae,he);const me=E[oe],Te=E[ae],Pe=E[he],Re=Math.min(Math.min(me,Te),Pe),Ge=Math.max(Math.max(me,Te),Pe)-Re;Ge>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ge),j.push(Re+Ge/2)};for(let oe=0;oe<64;oe++)for(let ae=0;ae<64;ae++){const he=65*oe+ae,me=he+1,Te=he+65,Pe=Te+1;ie(he,Te,me),ie(me,Te,Pe)}[j,q]=function(oe,ae){const he=Array.from({length:oe.length},(Pe,Re)=>Re);he.sort((Pe,Re)=>oe[Pe]-oe[Re]);const me=[],Te=new An;for(let Pe=0;Pe<he.length;Pe++){const Re=he[Pe];me.push(oe[Re]);const Ge=3*Re,Fe=Ge+1;Te.emplaceBack(ae.uint16[Ge],ae.uint16[Fe],ae.uint16[Fe+1])}return[me,Te]}(j,q),this.elevatedGlobeTrianglesCenterLongitudes=j,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(q)}this.elevatedGlobeSegments=or.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,z/Mt,0,N/Mt,0,0,O,k,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const r=this.map.painter.context,a=r.gl;!this._dirty||this.texture instanceof jg||(this.texture?this.texture.update(this.image):(this.texture=new lc(r,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(r)}loadTile(e,r){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},r(null)):(e.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;const a=this.elevatedGlobeTrianglesCenterLongitudes;let u=((E,I)=>E+360*Math.round((I-E)/360))(e+180,a[0]);const d=new or,m=(E,I)=>{d.segments.push({vertexOffset:0,primitiveOffset:E,vertexLength:r.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-u)<=y){const E=Zt(a,0,a.length,u+y);return E===a.length||m(E,at(a,E+1,a.length,u+360-y)-E),d}u<a[0]&&(u+=360);const b=at(a,0,a.length,u-y);if(b===a.length)return m(0,a.length),d;m(0,b-0);const T=Zt(a,b+1,a.length,u+y);return T!==a.length&&m(T,a.length-T),d}}class kR extends Jt{constructor(e,r){super(e,{},r),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const DR=new ut({visibility:new de(Be.layout_sky.visibility)});var LR={paint:new ut({"sky-type":new de(Be.paint_sky["sky-type"]),"sky-atmosphere-sun":new de(Be.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new de(Be.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new de(Be.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new de(Be.paint_sky["sky-gradient-radius"]),"sky-gradient":new _t(Be.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new de(Be.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new de(Be.paint_sky["sky-atmosphere-color"]),"sky-opacity":new de(Be.paint_sky["sky-opacity"])}),layout:DR};function Nv(t,e,r){const a=[0,0,1],u=s.q.identity([]);return s.q.rotateY(u,u,r?-Xe(t)+Math.PI:Xe(t)),s.q.rotateX(u,u,-Xe(e)),s.v.transformQuat(a,a,u),s.v.normalize(a,a)}var OR={paint:new ut({})};const RR={circle:class extends Jt{constructor(t,e,r){super(t,fL,e,r)}createBucket(t){return new iv(t)}queryRadius(t){const e=t;return sf("circle-radius",this,e)+sf("circle-stroke-width",this,e)+fg(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,r,a,u,d,m,y){const b=GT(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return WT(t,a,d,m,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,T)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){const r=HT(this);return{config:new Qu(this,e),defines:r,overrideFog:!1}}},heatmap:class extends Jt{createBucket(t){return new ZT(t)}constructor(t,e,r){super(t,yL,e,r),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=dg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return sf("heatmap-radius",this,t)}queryIntersectsFeature(t,e,r,a,u,d,m,y){const b=this.paint.get("heatmap-radius").evaluate(e,r);return WT(t,a,d,m,y,!0,!0,new Ie(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new Qu(this,e),overrideFog:!1}:{}}},hillshade:class extends Jt{constructor(t,e,r){super(t,xL,e,r)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends Jt{constructor(t,e,r){super(t,OL,e,r)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(t,e){return{config:new Qu(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new vg(t)}queryRadius(){return fg(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,r,a,u,d){return!t.queryGeometry.isAboveHorizon&&BT(jT(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends Jt{constructor(t,e,r){super(t,MR,e,r),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new rp(t)}queryRadius(){return fg(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,r,a,u,d,m,y,b){const T=GT(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),E=this.paint.get("fill-extrusion-height").evaluate(e,r),I=this.paint.get("fill-extrusion-base").evaluate(e,r),k=[0,0],O=y&&d.elevation,z=d.elevation?d.elevation.exaggeration():1,N=t.tile.getBucket(this);if(O&&N instanceof rp){const ae=N.centroidVertexArray,he=b+1;he<ae.length&&(k[0]=ae.geta_centroid_pos0(he),k[1]=ae.geta_centroid_pos1(he))}if(k[0]===0&&k[1]===1)return!1;d.projection.name==="globe"&&(a=PM([a],[new Ie(0,0),new Ie(Mt,Mt)],t.tileID.canonical).map(ae=>ae.polygon).flat());const j=O?y:null,[q,ie]=function(ae,he,me,Te,Pe,Re,Ge,Fe,et,bt,Je){return ae.projection.name==="globe"?function(gt,Ye,Vt,$t,vt,vi,ii,Ot,xi,ci,gi){const It=[],Ei=[],en=gt.projection.upVectorScale(gi,gt.center.lat,gt.worldSize).metersToTile,Oi=[0,0,0,1],Qi=[0,0,0,1],dn=(Hi,Qn,Un,xn)=>{Hi[0]=Qn,Hi[1]=Un,Hi[2]=xn,Hi[3]=1},Vn=CM();Vt>0&&(Vt+=Vn),$t+=Vn;for(const Hi of Ye){const Qn=[],Un=[];for(const xn of Hi){const En=xn.x+vt.x,pn=xn.y+vt.y,gr=gt.projection.projectTilePoint(En,pn,gi),$n=gt.projection.upVector(gi,xn.x,xn.y);let wr=Vt,eo=$t;if(ii){const Ko=DM(En,pn,Vt,$t,ii,Ot,xi,ci);wr+=Ko.base,eo+=Ko.top}Vt!==0?dn(Oi,gr.x+$n[0]*en*wr,gr.y+$n[1]*en*wr,gr.z+$n[2]*en*wr):dn(Oi,gr.x,gr.y,gr.z),dn(Qi,gr.x+$n[0]*en*eo,gr.y+$n[1]*en*eo,gr.z+$n[2]*en*eo),s.v.transformMat4(Oi,Oi,vi),s.v.transformMat4(Qi,Qi,vi),Qn.push(new vf(Oi[0],Oi[1],Oi[2])),Un.push(new vf(Qi[0],Qi[1],Qi[2]))}It.push(Qn),Ei.push(Un)}return[It,Ei]}(ae,he,me,Te,Pe,Re,Ge,Fe,et,bt,Je):Ge?function(gt,Ye,Vt,$t,vt,vi,ii,Ot,xi){const ci=[],gi=[],It=[0,0,0,1];for(const Ei of gt){const en=[],Oi=[];for(const Qi of Ei){const dn=Qi.x+$t.x,Vn=Qi.y+$t.y,Hi=DM(dn,Vn,Ye,Vt,vi,ii,Ot,xi);It[0]=dn,It[1]=Vn,It[2]=Hi.base,It[3]=1,s.e.transformMat4(It,It,vt),It[3]=Math.max(It[3],1e-5);const Qn=new vf(It[0]/It[3],It[1]/It[3],It[2]/It[3]);It[0]=dn,It[1]=Vn,It[2]=Hi.top,It[3]=1,s.e.transformMat4(It,It,vt),It[3]=Math.max(It[3],1e-5);const Un=new vf(It[0]/It[3],It[1]/It[3],It[2]/It[3]);en.push(Qn),Oi.push(Un)}ci.push(en),gi.push(Oi)}return[ci,gi]}(he,me,Te,Pe,Re,Ge,Fe,et,bt):function(gt,Ye,Vt,$t,vt){const vi=[],ii=[],Ot=vt[8]*Ye,xi=vt[9]*Ye,ci=vt[10]*Ye,gi=vt[11]*Ye,It=vt[8]*Vt,Ei=vt[9]*Vt,en=vt[10]*Vt,Oi=vt[11]*Vt;for(const Qi of gt){const dn=[],Vn=[];for(const Hi of Qi){const Qn=Hi.x+$t.x,Un=Hi.y+$t.y,xn=vt[0]*Qn+vt[4]*Un+vt[12],En=vt[1]*Qn+vt[5]*Un+vt[13],pn=vt[2]*Qn+vt[6]*Un+vt[14],gr=vt[3]*Qn+vt[7]*Un+vt[15],$n=xn+Ot,wr=En+xi,eo=pn+ci,Ko=Math.max(gr+gi,1e-5),Cr=xn+It,yr=En+Ei,Oo=pn+en,Ro=Math.max(gr+Oi,1e-5);dn.push(new vf($n/Ko,wr/Ko,eo/Ko)),Vn.push(new vf(Cr/Ro,yr/Ro,Oo/Ro))}vi.push(dn),ii.push(Vn)}return[vi,ii]}(he,me,Te,Pe,Re)}(d,a,I,E,T,m,j,k,z,d.center.lat,t.tileID.canonical),oe=t.queryGeometry;return function(ae,he,me){let Te=1/0;BT(me,he)&&(Te=kM(me,he[0]));for(let Pe=0;Pe<he.length;Pe++){const Re=he[Pe],Ge=ae[Pe];for(let Fe=0;Fe<Re.length-1;Fe++){const et=Re[Fe],bt=[et,Re[Fe+1],Ge[Fe+1],Ge[Fe],et];FT(me,bt)&&(Te=Math.min(Te,kM(me,bt)))}}return Te!==1/0&&Te}(q,ie,oe.isPointQuery()?oe.screenBounds:oe.screenGeometry)}},line:class extends Jt{constructor(t,e,r){super(t,LM,e,r),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof oa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=BM.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Ug(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){const r=zM(this);return{config:new Qu(this,e),defines:r,overrideFog:!1}}queryRadius(t){const e=t,r=NM(sf("line-width",this,e),sf("line-gap-width",this,e)),a=sf("line-offset",this,e);return r/2+Math.abs(a)+fg(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,r,a,u,d){if(t.queryGeometry.isAboveHorizon)return!1;const m=jT(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),y=t.pixelToTileUnitsFactor/2*NM(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),b=this.paint.get("line-offset").evaluate(e,r);return b&&(a=function(T,E){const I=[],k=new Ie(0,0);for(let O=0;O<T.length;O++){const z=T[O],N=[];for(let j=0;j<z.length;j++){const q=z[j],ie=z[j+1],oe=j===0?k:q.sub(z[j-1])._unit()._perp(),ae=j===z.length-1?k:ie.sub(q)._unit()._perp(),he=oe._add(ae)._unit();he._mult(1/(he.x*ae.x+he.y*ae.y)),N.push(he._mult(E)._add(q))}I.push(N)}return I}(a,b*t.pixelToTileUnitsFactor)),function(T,E,I){for(let k=0;k<E.length;k++){const O=E[k];if(T.length>=3){for(let z=0;z<O.length;z++)if(rh(T,O[z]))return!0}if(lL(T,O,I))return!0}return!1}(m,a,y)}isTileClipped(){return!0}},symbol:Rg,background:class extends Jt{constructor(t,e,r){super(t,IR,e,r)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:class extends Jt{constructor(t,e,r){super(t,PR,e,r),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(t){return!(t&&t._source instanceof UM)||!t._source.onNorthPole&&!t._source.onSouthPole&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-color"].value.expression,[e,r]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=dg({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:e,end:r}],resolution:256}),this.colorRampTexture=null}},sky:class extends Jt{constructor(t,e,r){super(t,LR,e,r),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=dg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),u=!a,d=t.style.light,m=d.properties.get("position");return u&&d.properties.get("anchor")==="viewport"&&si("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Nv(m.azimuthal,90-m.polar,e):Nv(a[0],90-a[1],e)}const r=this.paint.get("sky-gradient-center");return Nv(r[0],90-r[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends Jt{constructor(t,e,r){super(t,OR,e)}},model:class extends Jt{constructor(t,e,r){super(t,hR,e,r)}createBucket(t){return new lM(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(t,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Wu}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};class zR{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class FR{constructor(){this.tasks={},this.taskQueue=[],Ze(["process"],this),this.invoker=new zR(this.process),this.nextId=0}add(e,r){const a=this.nextId++,u=function({type:d,isSymbolTile:m,zoom:y}){return y=y||0,d==="message"?0:d!=="maybePrepare"||m?d!=="parseTile"||m?d==="parseTile"&&m?300-y:d==="maybePrepare"&&m?400-y:500:200-y:100-y}(r);if(u===0){Ee();try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:r,priority:u,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){Ee();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let u=0;u<this.taskQueue.length;u++){const d=this.tasks[this.taskQueue[u]];d.priority<r&&(r=d.priority,e=u)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class jM{constructor(e,r,a){this.target=e,this.parent=r,this.mapId=a,this.callbacks={},this.cancelCallbacks={},Ze(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new FR}send(e,r,a,u,d=!1,m){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=m,this.callbacks[y]=a);const b=new Set;return this.target.postMessage({id:y,type:e,hasCallback:!!a,targetMapId:u,mustQueue:d,sourceMapId:this.mapId,data:f(r,b)},b),{cancel:()=>{a&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){const r=e.data,a=r.id;if(a&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const u=this.cancelCallbacks[a];delete this.cancelCallbacks[a],u&&u.cancel()}else if(r.mustQueue||Ee()){const u=this.callbacks[a],d=this.scheduler.add(()=>this.processTask(a,r),u&&u.metadata||{type:"message"});d&&(this.cancelCallbacks[a]=d)}else this.processTask(a,r)}processTask(e,r){if(delete this.cancelCallbacks[e],r.type==="<response>"){const a=this.callbacks[e];delete this.callbacks[e],a&&(r.error?a(v(r.error)):a(null,v(r.data)))}else{const a=new Set,u=r.hasCallback?(m,y)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:m?f(m):null,data:f(y,a)},a)}:m=>{},d=v(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,d,u);else if(this.parent.getWorkerSource){const m=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,m[0],d.source,d.scope)[m[1]](d,u)}else u(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class sp{constructor(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Si();const a=this.workerPool.acquire(this.id);for(let u=0;u<a.length;u++){const d=new sp.Actor(a[u],r,this.id);d.name=`Worker ${u}`,this.actors.push(d)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,r,a){Mi(this.actors,(u,d)=>{u.send(e,r,d)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}sp.Actor=jM;class GM{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new oc({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const a=this.getKey(e,r);return this.positions[a]}trim(){const e=this.width,r=this.height=nn(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,a){const u=[];let d=e.length%2==1?-e[e.length-1]*a:0,m=e[0]*a,y=!0;u.push({left:d,right:m,isDash:y,zeroLength:e[0]===0});let b=e[0];for(let T=1;T<e.length;T++){y=!y;const E=e[T];d=b*a,b+=E,m=b*a,u.push({left:d,right:m,isDash:y,zeroLength:E===0})}return u}addRoundDash(e,r,a){const u=r/2;for(let d=-a;d<=a;d++){const m=this.width*(this.nextRow+a+d);let y=0,b=e[y];for(let T=0;T<this.width;T++){T/b.right>1&&(b=e[++y]);const E=Math.abs(T-b.left),I=Math.abs(T-b.right),k=Math.min(E,I);let O;const z=d/a*(u+1);if(b.isDash){const N=u-Math.abs(z);O=Math.sqrt(k*k+N*N)}else O=u-Math.sqrt(k*k+z*z);this.image.data[m+T]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(e,r){for(let b=e.length-1;b>=0;--b){const T=e[b],E=e[b+1];T.zeroLength?e.splice(b,1):E&&E.isDash===T.isDash&&(E.left=T.left,e.splice(b,1))}const a=e[0],u=e[e.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const d=this.width*this.nextRow;let m=0,y=e[m];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++m]);const T=Math.abs(b-y.left),E=Math.abs(b-y.right),I=Math.min(T,E);this.image.data[d+b]=Math.max(0,Math.min(255,(y.isDash?I:-I)+r+128))}}addDash(e,r){const a=this.getKey(e,r);if(this.positions[a])return this.positions[a];const u=r==="round",d=u?7:0,m=2*d+1;if(this.nextRow+m>this.height)return si("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let E=0;E<e.length;E++)e[E]<0&&(si("Negative value is found in line dasharray, replacing values with 0"),e[E]=0),y+=e[E];if(y!==0){const E=this.width/y,I=this.getDashRanges(e,this.width,E);u?this.addRoundDash(I,E,d):this.addRegularDash(I,r==="square"?.5*E:0)}const b=this.nextRow+d;this.nextRow+=m;const T={tl:[b,d],br:[y,0]};return this.positions[a]=T,T}}ei(GM,"LineAtlas");const HM=1*Ua;class WM{constructor(e){const r={},a=[];for(const y in e){const b=e[y],T=r[y]={};for(const E in b.glyphs){const I=b.glyphs[+E];if(!I||I.bitmap.width===0||I.bitmap.height===0)continue;const k=I.metrics.localGlyph?HM:1,O={x:0,y:0,w:I.bitmap.width+2*k,h:I.bitmap.height+2*k};a.push(O),T[E]=O}}const{w:u,h:d}=bv(a),m=new oc({width:u||1,height:d||1});for(const y in e){const b=e[y];for(const T in b.glyphs){const E=b.glyphs[+T];if(!E||E.bitmap.width===0||E.bitmap.height===0)continue;const I=r[y][T],k=E.metrics.localGlyph?HM:1;oc.copy(E.bitmap,m,{x:0,y:0},{x:I.x+k,y:I.y+k},E.bitmap)}}this.image=m,this.positions=r}}ei(WM,"GlyphAtlas");class BR{constructor(e){this.tileID=new lo(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Yc(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster}parse(e,r,a,u,d){this.status="parsing",this.data=e,this.collisionBoxArray=new x0;const m=new rS(Object.keys(e.layers).sort()),y=new gv(this.tileID,this.promoteId);y.bucketLayerIDs=[];const b={},T=new GM(256,256),E={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:T,availableImages:a,brightness:this.brightness},I=r.familiesBySource[this.source];for(const ie in I){const oe=e.layers[ie];if(!oe)continue;let ae=!1,he=!1,me=!1;for(const Re of I[ie])Re[0].type==="symbol"?ae=!0:he=!0,Re[0].is3D()&&Re[0].type!=="model"&&(me=!0);if(this.extraShadowCaster&&!me||this.isSymbolTile===!0&&!ae||this.isSymbolTile===!1&&!he)continue;oe.version===1&&si(`Vector tile source "${this.source}" layer "${ie}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Te=m.encode(ie),Pe=[];for(let Re=0;Re<oe.length;Re++){const Ge=oe.feature(Re),Fe=y.getId(Ge,ie);Pe.push({feature:Ge,id:Fe,index:Re,sourceLayerIndex:Te})}for(const Re of I[ie]){const Ge=Re[0];(!this.extraShadowCaster||Ge.is3D()&&Ge.type!=="model")&&(this.isSymbolTile!==void 0&&Ge.type==="symbol"!==this.isSymbolTile||Ge.minzoom&&this.zoom<Math.floor(Ge.minzoom)||Ge.maxzoom&&this.zoom>=Ge.maxzoom||Ge.visibility!=="none"&&(Vv(Re,this.zoom,E.brightness,a),(b[Ge.id]=Ge.createBucket({index:y.bucketLayerIDs.length,layers:Re,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Te,sourceID:this.source,projection:this.projection.spec})).populate(Pe,E,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(Re.map(Fe=>Fe.id))))}}let k,O,z,N;T.trim();const j={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},q=()=>{if(k)return this.status="done",d(k);if(this.extraShadowCaster)this.status="done",d(null,{buckets:st(b).filter(ie=>!ie.isEmpty()),featureIndex:y,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:E.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(O&&z&&N){const ie=new WM(O),oe=new OS(z,N);for(const ae in b){const he=b[ae];he instanceof Qd?(Vv(he.layers,this.zoom,E.brightness,a),OO(he,O,ie.positions,z,oe.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):he.hasPattern&&(he instanceof Ug||he instanceof vg||he instanceof rp)&&(Vv(he.layers,this.zoom,E.brightness,a),he.addFeatures(E,this.tileID.canonical,oe.patternPositions,a,this.tileTransform,this.brightness))}this.status="done",d(null,{buckets:st(b).filter(ae=>!ae.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ie.image,lineAtlas:T,imageAtlas:oe,brightness:E.brightness})}};if(!this.extraShadowCaster){const ie=Sr(E.glyphDependencies,he=>Object.keys(he).map(Number));Object.keys(ie).length?u.send("getGlyphs",{uid:this.uid,stacks:ie,scope:this.scope},(he,me)=>{k||(k=he,O=me,q())},void 0,!1,j):O={};const oe=Object.keys(E.iconDependencies);oe.length?u.send("getImages",{icons:oe,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(he,me)=>{k||(k=he,z=me,q())},void 0,!1,j):z={};const ae=Object.keys(E.patternDependencies);ae.length?u.send("getImages",{icons:ae,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(he,me)=>{k||(k=he,N=me,q())},void 0,!1,j):N={}}q()}}function Vv(t,e,r,a){const u=new be(e,{brightness:r});for(const d of t)d.recalculate(u,a)}class qM{constructor(e){this.entries={},this.scheduler=e}request(e,r,a,u){const d=this.entries[e]=this.entries[e]||{callbacks:[]};if(d.result){const[m,y]=d.result;return this.scheduler?this.scheduler.add(()=>{u(m,y)},r):u(m,y),()=>{}}return d.callbacks.push(u),d.cancel||(d.cancel=a((m,y)=>{d.result=[m,y];for(const b of d.callbacks)this.scheduler?this.scheduler.add(()=>{b(m,y)},r):b(m,y);setTimeout(()=>delete this.entries[e],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(m=>m!==u),d.callbacks.length||(d.cancel(),delete this.entries[e]))}}}function ZM(t,e,r){const a=JSON.stringify(t.request);return t.data&&(this.deduped.entries[a]={result:[null,t.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},u=>{const d=Er(t.request,(m,y,b,T)=>{m?u(m):y&&u(null,{vectorTile:r?void 0:new pv(new Mg(y)),rawData:y,cacheControl:b,expires:T})});return()=>{d.cancel(),u()}},e)}var ap={workerUrl:"",workerClass:null,workerParams:void 0};function NR(){return ap.workerClass!=null?new ap.workerClass:new self.Worker(ap.workerUrl,ap.workerParams)}const Uv="mapboxgl_preloaded_worker_pool";class lp{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<lp.workerCount;)this.workers.push(new NR);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Uv]}numActive(){return Object.keys(this.active).length}}let cp;function jv(){return cp||(cp=new lp),cp}lp.workerCount=2;let e_,Gv,Ga,Hv=null;function XM(){return Ee()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Gv||D.DRACO_URL}const Wv=5123,qv=5126,Zv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[Wv]:Uint16Array,5125:Uint32Array,[qv]:Float32Array},VR={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[Wv]:"DT_UINT16",5125:"DT_UINT32",[qv]:"DT_FLOAT32"},Xv={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function YM(t,e,r){const a=r.json.bufferViews.length,u=r.buffers.length;e.bufferView=a,r.json.bufferViews[a]={buffer:u,byteLength:t.byteLength},r.buffers[u]=t}const Yv="KHR_draco_mesh_compression";function UR(t,e){const r=t.extensions&&t.extensions[Yv];if(!r)return;const a=new Ga.Decoder,u=$M(e,r.bufferView),d=new Ga.Mesh;if(!a.DecodeArrayToMesh(u,u.byteLength,d))throw new Error("Failed to decode Draco mesh");const m=e.json.accessors[t.indices],y=Zv[m.componentType],b=m.count*y.BYTES_PER_ELEMENT,T=Ga._malloc(b);y===Uint16Array?a.GetTrianglesUInt16Array(d,b,T):a.GetTrianglesUInt32Array(d,b,T),YM(Ga.memory.buffer.slice(T,T+b),m,e),Ga._free(T);for(const E of Object.keys(r.attributes)){const I=a.GetAttributeByUniqueId(d,r.attributes[E]),k=e.json.accessors[t.attributes[E]],O=VR[k.componentType],z=k.count*Xv[k.type]*Zv[k.componentType].BYTES_PER_ELEMENT,N=Ga._malloc(z);a.GetAttributeDataArrayForAllPoints(d,I,Ga[O],z,N),YM(Ga.memory.buffer.slice(N,N+z),k,e),Ga._free(N)}a.destroy(),d.destroy(),delete t.extensions[Yv]}const JM=1179937895,KM=new TextDecoder("utf8");function QM(t,e){return new URL(t,e).href}function jR(t,e,r,a){return fetch(QM(t.uri,a)).then(u=>u.arrayBuffer()).then(u=>{e.buffers[r]=u})}function $M(t,e){const r=t.json.bufferViews[e];return new Uint8Array(t.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function GR(t,e,r,a){if(t.uri){const u=QM(t.uri,a);return fetch(u).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{e.images[r]=d})}if(t.bufferView!==void 0){const u=$M(e,t.bufferView),d=new Blob([u],{type:t.mimeType});return createImageBitmap(d).then(m=>{e.images[r]=m})}}function eE(t,e=0,r){const a={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===JM){const T=new Uint32Array(t,e);let E=2;const I=(T[E++]>>2)-3,k=T[E++]>>2;if(E++,a.json=JSON.parse(KM.decode(T.subarray(E,E+k))),E+=k,E<I){const O=T[E++];E++;const z=e+(E<<2);a.buffers[0]=t.slice(z,z+O)}}else a.json=JSON.parse(KM.decode(new Uint8Array(t,e)));const{buffers:u,images:d,meshes:m,extensionsUsed:y}=a.json;let b=Promise.resolve();if(u){const T=[];for(let E=0;E<u.length;E++){const I=u[E];I.uri?T.push(jR(I,a,E,r)):a.buffers[E]||(a.buffers[E]=null)}b=Promise.all(T)}return b.then(()=>{const T=[],E=y&&y.includes(Yv);if(E&&T.push(function(){if(!Ga)return e_||(e_=function(I){let k,O=null;function z(){k=new Uint8Array(O.buffer)}function N(){throw new Error("Unexpected Draco error.")}const j={a:{a:N,d:function(q,ie,oe){return k.copyWithin(q,ie,ie+oe)},c:function(q){const ie=k.length,oe=Math.max(q>>>0,Math.ceil(1.2*ie)),ae=Math.ceil((oe-ie)/65536);try{return O.grow(ae),z(),!0}catch{return!1}},b:N}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(I,j):I.then(q=>q.arrayBuffer()).then(q=>WebAssembly.instantiate(q,j))).then(q=>{const{Rb:ie,Qb:oe,P:ae,T:he,X:me,Ja:Te,La:Pe,Qa:Re,Va:Ge,Wa:Fe,eb:et,jb:bt,f:Je,e:gt,yb:Ye,zb:Vt,Ab:$t,Bb:vt,Db:vi,Gb:ii}=q.instance.exports;O=gt;const Ot=(()=>{let xi=0,ci=0,gi=0,It=0;return Ei=>{gi&&(ie(It),ie(xi),ci+=gi,gi=xi=0),xi||(ci+=128,xi=oe(ci));const en=Ei.length+7&-8;let Oi=xi;en>=ci&&(gi=en,Oi=It=oe(en));for(let Qi=0;Qi<Ei.length;Qi++)k[Oi+Qi]=Ei[Qi];return Oi}})();return z(),Je(),{memory:gt,_free:ie,_malloc:oe,Mesh:class{constructor(){this.ptr=ae()}destroy(){he(this.ptr)}},Decoder:class{constructor(){this.ptr=Te()}destroy(){bt(this.ptr)}DecodeArrayToMesh(xi,ci,gi){const It=Ot(xi),Ei=Pe(this.ptr,It,ci,gi.ptr);return!!me(Ei)}GetAttributeByUniqueId(xi,ci){return{ptr:Re(this.ptr,xi.ptr,ci)}}GetTrianglesUInt16Array(xi,ci,gi){Ge(this.ptr,xi.ptr,ci,gi)}GetTrianglesUInt32Array(xi,ci,gi){Fe(this.ptr,xi.ptr,ci,gi)}GetAttributeDataArrayForAllPoints(xi,ci,gi,It,Ei){et(this.ptr,xi.ptr,ci.ptr,gi,It,Ei)}},DT_INT8:Ye(),DT_UINT8:Vt(),DT_INT16:$t(),DT_UINT16:vt(),DT_UINT32:vi(),DT_FLOAT32:ii()}})}(fetch(XM())),e_.then(I=>{Ga=I,e_=void 0}))}()),d)for(let I=0;I<d.length;I++)T.push(GR(d[I],a,I,r));return(T.length?Promise.all(T):Promise.resolve()).then(()=>{if(E&&m)for(const{primitives:I}of m)for(const k of I)UR(k,a);return a})})}class tE{constructor(e,r,a){if(this.triangleCount=r.length/3,this.min=new Ie(0,0),this.max=new Ie(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0||a===0)return;const u=e.map(E=>E.x),d=e.map(E=>E.y);this.min=new Ie(Math.min(...u),Math.min(...d)),this.max=new Ie(Math.max(...u),Math.max(...d));const m=this.max.sub(this.min);m.x=Math.max(m.x,1),m.y=Math.max(m.y,1);const y=Math.max(m.x,m.y)/a;this.cellsX=Math.max(1,Math.ceil(m.x/y)),this.cellsY=Math.max(1,Math.ceil(m.y/y)),this.xScale=1/y,this.yScale=1/y;const b=[];for(let E=0;E<this.triangleCount;E++){const I=e[r[3*E+0]].sub(this.min),k=e[r[3*E+1]].sub(this.min),O=e[r[3*E+2]].sub(this.min),z=tu(Math.floor(Math.min(I.x,k.x,O.x)),this.xScale,this.cellsX),N=tu(Math.floor(Math.max(I.x,k.x,O.x)),this.xScale,this.cellsX),j=tu(Math.floor(Math.min(I.y,k.y,O.y)),this.yScale,this.cellsY),q=tu(Math.floor(Math.max(I.y,k.y,O.y)),this.yScale,this.cellsY),ie=new Ie(0,0),oe=new Ie(0,0),ae=new Ie(0,0),he=new Ie(0,0);for(let me=j;me<=q;++me){ie.y=oe.y=me*y,ae.y=he.y=(me+1)*y;for(let Te=z;Te<=N;++Te)ie.x=ae.x=Te*y,oe.x=he.x=(Te+1)*y,(ov(I,k,O,ie,oe,he)||ov(I,k,O,ie,he,ae))&&b.push({cellIdx:me*this.cellsX+Te,triIdx:E})}}if(b.length===0)return;b.sort((E,I)=>E.cellIdx-I.cellIdx||E.triIdx-I.triIdx);let T=0;for(;T<b.length;){const E=b[T].cellIdx,I={start:this.payload.length,len:0};for(;T<b.length&&b[T].cellIdx===E;)++I.len,this.payload.push(b[T++].triIdx);this.cells[E]=I}}query(e,r,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>r.x||e.y>this.max.y||this.min.y>r.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let b=0;b<this.lookup.length;b++)this.lookup[b]=0;const u=tu(e.x-this.min.x,this.xScale,this.cellsX),d=tu(r.x-this.min.x,this.xScale,this.cellsX),m=tu(e.y-this.min.y,this.yScale,this.cellsY),y=tu(r.y-this.min.y,this.yScale,this.cellsY);for(let b=m;b<=y;b++)for(let T=u;T<=d;T++){const E=this.cells[b*this.cellsX+T];if(E)for(let I=0;I<E.len;I++){const k=this.payload[E.start+I],O=Math.floor(k/8),z=1<<k%8;if(!(this.lookup[O]&z)&&(this.lookup[O]|=z,a.push(k),a.length===this.triangleCount))return}}}}function tu(t,e,r){return Math.max(0,Math.min(r-1,Math.floor(t*e)))}function uh(t,e){const r=t.json.bufferViews[e.bufferView];return new Zv[e.componentType](t.buffers[r.buffer],(e.byteOffset||0)+(r.byteOffset||0),e.count*Xv[e.type])}function HR(t,e,r){const a=t.indices,u=t.attributes,d={};d.indexArray=new An;const m=e.json.accessors[a],y=m.count/3;d.indexArray.reserve(y);const b=uh(e,m);for(let k=0;k<y;k++)d.indexArray.emplaceBack(b[3*k],b[3*k+1],b[3*k+2]);d.indexArray._trim(),d.vertexArray=new Ju;const T=e.json.accessors[u.POSITION];d.vertexArray.reserve(T.count);const E=uh(e,T);for(let k=0;k<T.count;k++)d.vertexArray.emplaceBack(E[3*k],E[3*k+1],E[3*k+2]);if(d.vertexArray._trim(),d.aabb=new Ir(T.min,T.max),d.centroid=function(k,O){const z=[0,0,0],N=k.length;if(N>0){for(let j=0;j<N;j++){const q=3*k[j];z[0]+=O[q],z[1]+=O[q+1],z[2]+=O[q+2]}z[0]/=N,z[1]/=N,z[2]/=N}return z}(b,E),u.COLOR_0!==void 0){const k=e.json.accessors[u.COLOR_0],O=Xv[k.type];if(k.componentType===qv){d.colorArray=O===3?new Ju:new yn,d.colorArray.reserve(k.count);const z=uh(e,k);if(O===3)for(let N=0;N<k.count;N++)d.colorArray.emplaceBack(z[3*N],z[3*N+1],z[3*N+2]);else for(let N=0;N<k.count;N++)d.colorArray.emplaceBack(z[4*N],z[4*N+1],z[4*N+2],z[4*N+3]);d.colorArray._trim()}else if(k.componentType===Wv&&O===4){d.colorArray=new yn,d.colorArray.resize(k.count);const z=uh(e,k),N=1/65535,j=d.colorArray.float32;for(let q=0;q<4*z.length;++q)j[q]=z[q]*N}else si(`glTF color buffer parsing for accessor ${JSON.stringify(k)} is not supported`)}if(u.NORMAL!==void 0){d.normalArray=new Ju;const k=e.json.accessors[u.NORMAL];d.normalArray.reserve(k.count);const O=uh(e,k);for(let z=0;z<k.count;z++)d.normalArray.emplaceBack(O[3*z],O[3*z+1],O[3*z+2]);d.normalArray._trim()}if(u.TEXCOORD_0!==void 0&&r.length>0){d.texcoordArray=new kd;const k=e.json.accessors[u.TEXCOORD_0];d.texcoordArray.reserve(k.count);const O=uh(e,k);for(let z=0;z<k.count;z++)d.texcoordArray.emplaceBack(O[2*z],O[2*z+1]);d.texcoordArray._trim()}const I=t.material;return d.material=function(k,O){const{emissiveFactor:z=[0,0,0],alphaMode:N="OPAQUE",alphaCutoff:j=.5,normalTexture:q,occlusionTexture:ie,emissiveTexture:oe,doubleSided:ae}=k,{baseColorFactor:he=[1,1,1,1],metallicFactor:me=1,roughnessFactor:Te=1,baseColorTexture:Pe,metallicRoughnessTexture:Re}=k.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new Ln(...he),metallicFactor:me,roughnessFactor:Te,baseColorTexture:Pe?O[Pe.index]:void 0,metallicRoughnessTexture:Re?O[Re.index]:void 0},doubleSided:ae,emissiveFactor:z,alphaMode:N,alphaCutoff:j,normalTexture:q?O[q.index]:void 0,occlusionTexture:ie?O[ie.index]:void 0,emissionTexture:oe?O[oe.index]:void 0,defined:k.defined===void 0}}(I!==void 0?e.json.materials[I]:{defined:!1},r),u._FEATURE_RGBA4444!==void 0&&(d.featureData=new Uint32Array(uh(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer)),d}function iE(t,e,r){const{matrix:a,rotation:u,translation:d,scale:m,mesh:y,extras:b,children:T}=t,E={};if(E.matrix=a||s.m.fromRotationTranslationScale([],u||[0,0,0,1],d||[0,0,0],m||[1,1,1]),y!==void 0){E.meshes=r[y];const I=E.anchor=[0,0];for(const k of E.meshes){const{min:O,max:z}=k.aabb;I[0]+=O[0]+z[0],I[1]+=O[1]+z[1]}I[0]=Math.floor(I[0]/E.meshes.length/2),I[1]=Math.floor(I[1]/E.meshes.length/2)}if(b&&(b.id&&(E.id=b.id),b.lights&&(E.lights=function(I){if(!I.length)return[];const k=function(q){const ie=atob(q),oe=new Uint8Array(ie.length);for(let ae=0;ae<ie.length;ae++)oe[ae]=ie.codePointAt(ae);return oe}(I),O=[],z=k.length/24,N=new Uint16Array(k.buffer),j=new Float32Array(k.buffer);for(let q=0;q<z;q++){const ie=N[2*q*6]/30,oe=N[2*q*6+1]/30,ae=N[2*q*6+10]/100,he=j[6*q+1],me=j[6*q+2],Te=j[6*q+3],Pe=j[6*q+4],Re=Te-he,Ge=Pe-me,Fe=Math.hypot(Re,Ge);O.push({pos:[he+.5*Re,me+.5*Ge,oe],normal:[Ge/Fe,-Re/Fe,0],width:Fe,height:ie,depth:ae,points:[he,me,Te,Pe]})}return O}(b.lights))),T){const I=[];for(const k of T)I.push(iE(e.json.nodes[k],e,r));E.children=I}return E}function WR(t){if(t.vertices.length===0||t.indices.length===0)return null;const[e,r]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let m=1;m<t.vertices.length;++m){const y=t.vertices[m];e.x=Math.min(e.x,y.x),e.y=Math.min(e.y,y.y),r.x=Math.max(r.x,y.x),r.y=Math.max(r.y,y.y)}const a=Math.ceil(Math.max(r.x-e.x,r.y-e.y)/256),u=Math.max(8,a),d=new tE(t.vertices,t.indices,u);return{vertices:t.vertices,indices:t.indices,grid:d,min:e,max:r}}function qR(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const r=e[0];if(!r||!Array.isArray(r)||r.length===0)return null;const a=[];for(const m of r){if(!Array.isArray(m)||m.length!==2)continue;const y=m[0],b=m[1];typeof y=="number"&&typeof b=="number"&&a.push(new Ie(y,b))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let u=0;for(let m=0;m<a.length;m++){const y=a[m],b=a[(m+1)%a.length],T=a[(m+2)%a.length];u+=(y.x-b.x)*(T.y-b.y)-(T.x-b.x)*(y.y-b.y)}u>0&&a.reverse();const d=yg(a.flatMap(m=>[m.x,m.y]),[]);return d.length===0?null:{vertices:a,indices:d}}function ZR(t){const e=[],r=[];let a=0;for(const u of t){a=e.length;const d=u.vertexArray.float32,m=u.indexArray.uint16;for(let y=0;y<u.vertexArray.length;y++)e.push(new Ie(d[3*y+0],d[3*y+1]));for(let y=0;y<3*u.indexArray.length;y++)r.push(m[y]+a)}if(r.length%3!=0)return null;for(let u=0;u<r.length;u+=3){const d=e[r[u+0]],m=e[r[u+1]],y=e[r[u+2]];(d.x-m.x)*(y.y-m.y)-(y.x-m.x)*(d.y-m.y)>0&&([r[u+1],r[u+2]]=[r[u+2],r[u+1]])}return{vertices:e,indices:r}}function nE(t){const e=function(b,T){const E=[],I=WebGL2RenderingContext;if(b.json.textures)for(const k of b.json.textures){const O={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};k.sampler!==void 0&&Object.assign(O,b.json.samplers[k.sampler]),E.push({image:T[k.source],sampler:O,uploaded:!1})}return E}(t,t.images),r=function(b,T){const E=[];for(const I of b.json.meshes){const k=[];for(const O of I.primitives)k.push(HR(O,b,T));E.push(k)}return E}(t,e),{scenes:a,scene:u,nodes:d}=t.json,m=a?a[u||0].nodes:d,y=[];for(const b of m)y.push(iE(d[b],t,r));return function(b,T,E){const I={},k=new Set;for(let O=0;O<b.length;O++){const z=E[T[O]];if(!z.extras)continue;const N=z.extras["mapbox:footprint:version"],j=z.extras["mapbox:footprint:id"];(N||j)&&k.add(O),N==="1.0.0"&&j&&(I[j]=O)}for(let O=0;O<b.length;O++){if(k.has(O))continue;const z=b[O],N=E[T[O]];if(!N.extras)continue;let j=null;z.id in I&&(j=ZR(b[I[z.id]].meshes)),j||(j=qR(N)),j&&(z.footprint=WR(j))}if(k.size>0){const O=Array.from(k.values()).sort((z,N)=>z-N);for(let z=O.length-1;z>=0;z--)b.splice(O[z],1)}}(y,m,t.json.nodes),y}function XR(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,r=t.aabb.min[0]-1,a=t.aabb.min[1]-1,u=lh/(t.aabb.max[0]-r+2),d=lh/(t.aabb.max[1]-a+2);for(let m=0;m<e.length;m+=3){const y=e[m+2],b=(e[m+0]-r)*u|0,T=(e[m+1]-a)*d|0;y>t.heightmap[T*lh+b]&&(t.heightmap[T*lh+b]=y)}}function YR(t,e){const r={};r.indexArray=new An,r.indexArray.reserve(4*t.length),r.vertexArray=new Ju,r.vertexArray.reserve(10*t.length),r.colorArray=new yn,r.vertexArray.reserve(10*t.length);let a=0;for(const m of t){const y=Math.min(10,Math.max(4,1.3*m.height))*e,b=[-m.normal[1],m.normal[0],0],T=Math.min(.29,.1*m.width/m.depth),E=m.width-2*m.depth*e*(T+.01),I=s.v.scaleAndAdd([],m.pos,b,E/2),k=s.v.scaleAndAdd([],m.pos,b,-E/2),O=[I[0],I[1],I[2]+m.height],z=[k[0],k[1],k[2]+m.height],N=s.v.scaleAndAdd([],m.normal,b,T);s.v.scale(N,N,y);const j=s.v.scaleAndAdd([],m.normal,b,-T);s.v.scale(j,j,y),s.v.add(N,I,N),s.v.add(j,k,j),I[2]+=.1,k[2]+=.1,r.vertexArray.emplaceBack(N[0],N[1],N[2]),r.vertexArray.emplaceBack(j[0],j[1],j[2]),r.vertexArray.emplaceBack(I[0],I[1],I[2]),r.vertexArray.emplaceBack(k[0],k[1],k[2]),r.vertexArray.emplaceBack(O[0],O[1],O[2]),r.vertexArray.emplaceBack(z[0],z[1],z[2]),r.vertexArray.emplaceBack(I[0],I[1],I[2]),r.vertexArray.emplaceBack(k[0],k[1],k[2]),r.vertexArray.emplaceBack(N[0],N[1],N[2]),r.vertexArray.emplaceBack(j[0],j[1],j[2]);const q=E/y/2;r.colorArray.emplaceBack(-q-T,-1,q,.8),r.colorArray.emplaceBack(q+T,-1,q,.8),r.colorArray.emplaceBack(-q,0,q,1.3),r.colorArray.emplaceBack(q,0,q,1.3),r.colorArray.emplaceBack(q+T,-.8,q,.7),r.colorArray.emplaceBack(q+T,-.8,q,.7),r.colorArray.emplaceBack(0,0,q,1.3),r.colorArray.emplaceBack(0,0,q,1.3),r.colorArray.emplaceBack(q+T,-1.2,q,.8),r.colorArray.emplaceBack(q+T,-1.2,q,.8),r.indexArray.emplaceBack(6+a,4+a,8+a),r.indexArray.emplaceBack(7+a,9+a,5+a),r.indexArray.emplaceBack(0+a,1+a,2+a),r.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}const u={defined:!0,emissiveFactor:[0,0,0]},d={};return d.baseColorFactor=Ln.white,u.pbrMetallicRoughness=d,r.material=u,r.aabb=new Ir([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}ei(tE,"TriangleGridIndex");const rE=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Jv{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,a]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=a>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const d=rE[15&a];if(!d)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new Jv(y,m,d,e)}constructor(e,r=64,a=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=rE.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-y%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${a}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+y+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=r,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Kv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:m,nodeSize:y}=this,b=[0,d.length-1,0],T=[];for(;b.length;){const E=b.pop()||0,I=b.pop()||0,k=b.pop()||0;if(I-k<=y){for(let j=k;j<=I;j++){const q=m[2*j],ie=m[2*j+1];q>=e&&q<=a&&ie>=r&&ie<=u&&T.push(d[j])}continue}const O=k+I>>1,z=m[2*O],N=m[2*O+1];z>=e&&z<=a&&N>=r&&N<=u&&T.push(d[O]),(E===0?e<=z:r<=N)&&(b.push(k),b.push(O-1),b.push(1-E)),(E===0?a>=z:u>=N)&&(b.push(O+1),b.push(I),b.push(1-E))}return T}within(e,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:d,nodeSize:m}=this,y=[0,u.length-1,0],b=[],T=a*a;for(;y.length;){const E=y.pop()||0,I=y.pop()||0,k=y.pop()||0;if(I-k<=m){for(let j=k;j<=I;j++)sE(d[2*j],d[2*j+1],e,r)<=T&&b.push(u[j]);continue}const O=k+I>>1,z=d[2*O],N=d[2*O+1];sE(z,N,e,r)<=T&&b.push(u[O]),(E===0?e-a<=z:r-a<=N)&&(y.push(k),y.push(O-1),y.push(1-E)),(E===0?e+a>=z:r+a>=N)&&(y.push(O+1),y.push(I),y.push(1-E))}return b}}function Kv(t,e,r,a,u,d){if(u-a<=r)return;const m=a+u>>1;oE(t,e,m,a,u,d),Kv(t,e,r,a,m-1,1-d),Kv(t,e,r,m+1,u,1-d)}function oE(t,e,r,a,u,d){for(;u>a;){if(u-a>600){const T=u-a+1,E=r-a+1,I=Math.log(T),k=.5*Math.exp(2*I/3),O=.5*Math.sqrt(I*k*(T-k)/T)*(E-T/2<0?-1:1);oE(t,e,r,Math.max(a,Math.floor(r-E*k/T+O)),Math.min(u,Math.floor(r+(T-E)*k/T+O)),d)}const m=e[2*r+d];let y=a,b=u;for(up(t,e,a,r),e[2*u+d]>m&&up(t,e,a,u);y<b;){for(up(t,e,y,b),y++,b--;e[2*y+d]<m;)y++;for(;e[2*b+d]>m;)b--}e[2*a+d]===m?up(t,e,a,b):(b++,up(t,e,b,u)),b<=r&&(a=b+1),r<=b&&(u=b-1)}}function up(t,e,r,a){Qv(t,r,a),Qv(e,2*r,2*a),Qv(e,2*r+1,2*a+1)}function Qv(t,e,r){const a=t[e];t[e]=t[r],t[r]=a}function sE(t,e,r,a){const u=t-r,d=e-a;return u*u+d*d}s.$=45,s.A=br,s.B=function(t){const e=s.m.identity(new Float64Array(16));s.m.multiply(e,t.pixelMatrix,t.globeMatrix);const r=[0,ha,0],a=[0,fa,0];return s.v.transformMat4(r,r,e),s.v.transformMat4(a,a,e),[r[0]>0&&r[0]<=t.width&&r[1]>0&&r[1]<=t.height&&!J0(t,new vn(t.center.lat,90)),a[0]>0&&a[0]<=t.width&&a[1]>0&&a[1]<=t.height&&!J0(t,new vn(t.center.lat,-90))]},s.C=Ln,s.D=jc,s.E=pl,s.F=G0,s.G=wT,s.H=ml,s.I=sh,s.J=Mt,s.K=function(t,e){const{scale:r}=t.tileTransform,a=r*Mt/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return s.h.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},s.L=vn,s.M=To,s.N=Wg,s.O=lo,s.P=Ie,s.Q=$S,s.R=U0,s.S=function(t){const e=$S(t,!0);return s.h.invert([],[e[0],e[1],e[4],e[5]])},s.T=j0,s.U=yT,s.V=function(t){const{x:e,y:r}=t.point,{lng:a,lat:u}=t._center;return CT(e,r,t.worldSize,a,u)},s.W=Ks,s.X=si,s.Y=Tt,s.Z=H0,s._=function(t){const e=Math.round((t+45+360)%360/90)%4;return Yt[e]},s.a=pa,s.a$=tg,s.a0=Q0,s.a1=function(t,e){return Zr(rt(t,{type:"json"}),e)},s.a2=Wi,s.a3=lt,s.a4=ro,s.a5=Js,s.a6=so,s.a7=Po,s.a8=xo,s.a9=lc,s.aA=rh,s.aB=RT,s.aC=Ys,s.aD=qM,s.aE=Ht,s.aF=ZM,s.aG=function(t){pi++,pi>rn&&(t.getActor().send("enforceCacheSizeLimit",qt),pi=0)},s.aH=Zn,s.aI=yu,s.aJ=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},s.aK=UM,s.aL=function(t,e){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let a=0;a<t.length;a++){const u=document.createElement("source");yo(t[a])||(r.crossOrigin="Anonymous"),u.src=t[a],r.appendChild(u)}return{cancel:()=>{}}},s.aM=ri,s.aN=jg,s.aO=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>eE(e,0,t))},s.aP=nE,s.aQ=class{constructor(t,e,r,a){this.id=t,this.position=e!=null?new vn(e[0],e[1]):new vn(0,0),this.orientation=r??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new Ir([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(s.m.multiply(t.matrix,e,t.matrix),t.meshes)for(const r of t.meshes){const a=Ir.applyTransform(r.aabb,t.matrix);this.aabb.encapsulate(a)}if(t.children)for(const r of t.children)this._applyTransformations(r,t.matrix)}computeBoundsAndApplyParent(){const t=s.m.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}_positionModelOnTerrain(t,e){const r=t.elevation;if(!r)return 0;const a=Ir.projectAabbCorners(this.aabb,this.matrix),u=Jo(1,this.position.lat)*t.worldSize,d=function(j,q){const ie=[0,0,1],oe=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const ae of oe){const he=j[ae.corners[0]],me=j[ae.corners[1]],Te=j[ae.corners[2]],Pe=[me[0]-he[0],me[1]-he[1],q*(me[2]-he[2])],Re=s.v.cross(Pe,Pe,[Te[0]-he[0],Te[1]-he[1],q*(Te[2]-he[2])]);s.v.normalize(Re,Re),ae.dotProductWithUp=s.v.dot(Re,ie)}return oe.sort((ae,he)=>ae.dotProductWithUp-he.dotProductWithUp),oe[0].corners}(a,u),m=a[d[0]],y=a[d[1]],b=a[d[2]],T=a[d[3]],E=r.getAtPointOrZero(new To(m[0]/t.worldSize,m[1]/t.worldSize),0),I=r.getAtPointOrZero(new To(y[0]/t.worldSize,y[1]/t.worldSize),0),k=r.getAtPointOrZero(new To(b[0]/t.worldSize,b[1]/t.worldSize),0),O=r.getAtPointOrZero(new To(T[0]/t.worldSize,T[1]/t.worldSize),0),z=(E+O)/2,N=(I+k)/2;return z>N?I<k?qg(e,y,T,m,I,O,E,u):qg(e,b,m,T,k,E,O,u):E<O?qg(e,m,y,b,E,I,k,u):qg(e,T,b,y,O,k,I,u),Math.max(z,N)}computeModelMatrix(t,e,r,a,u,d,m=!1){const y=t.transform,b=y.zoom,T=y.project(this.position),E=nh(this.position.lat,b),I=1/E;s.m.identity(this.matrix),s.m.translate(this.matrix,this.matrix,[T.x+a[0]*I,T.y+a[1]*I,a[2]]);let k=1,O=1;const z=y.worldSize;if(m){if(y.projection.name==="mercator"){let ie=0;y.elevation&&(ie=y.elevation.getAtPointOrZero(new To(T.x/z,T.y/z),0));const oe=s.e.transformMat4([],[T.x,T.y,ie,1],y.projMatrix)[3]/y.cameraToCenterDistance;k=oe,O=oe*nh(y.center.lat,b)}else if(y.projection.name==="globe"){const ie=oM(this.matrix,y),oe=s.m.multiply([],y.projMatrix,ie),ae=[0,0,0,1];s.e.transformMat4(ae,ae,oe);const he=ae[3]/y.cameraToCenterDistance,me=rc(b),Te=y.projection.pixelsPerMeter(this.position.lat,z)*nh(this.position.lat,b),Pe=y.projection.pixelsPerMeter(y.center.lat,z)*nh(y.center.lat,b);k=he/Gi(Te,LT(y.center.lat),me),O=he*E/Te,k*=Pe,O*=Pe}}else k=I;s.m.scale(this.matrix,this.matrix,[k,k,O]);const N=[...this.matrix],j=this.orientation,q=[];if(rM(q,[j[0]+e[0],j[1]+e[1],j[2]+e[2]],r),s.m.multiply(this.matrix,N,q),u&&y.elevation){let ie=0;const oe=[];if(d&&y.elevation){ie=this._positionModelOnTerrain(y,oe);const ae=s.m.fromQuat([],oe),he=s.m.multiply([],ae,q);s.m.multiply(this.matrix,N,he)}else ie=y.elevation.getAtPointOrZero(new To(T.x/z,T.y/z),0);ie!==0&&(this.matrix[14]+=ie)}}upload(t){if(!this.uploaded){for(const e of this.nodes)zv(e,t);for(const e of this.nodes)Xg(e);this.uploaded=!0}}destroy(){for(const t of this.nodes)Yg(t)}},s.aR=Ze,s.aS=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.aT=LS,s.aU=FT,s.aV=fo,s.aW=NS,s.aX=Mv,s.aY=xv,s.aZ=Jv,s.a_=Ld,s.aa=bv,s.ab=wv,s.ac=ut,s.ad=de,s.ae=Be,s.af=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return fe(t.expression.evaluate(e))}interpolate(t,e,r){return{x:Gi(t.x,e.x,r),y:Gi(t.y,e.y,r),z:Gi(t.z,e.z,r),azimuthal:Gi(t.azimuthal,e.azimuthal,r),polar:Gi(t.polar,e.polar,r)}}},s.ag=Ne,s.ah=t=>Hs(Md(t)),s.ai=Km,s.aj=Cd,s.ak=rt,s.al=be,s.am=Wu,s.an=Ii,s.ao=rc,s.ap=t=>Hs(Id(t)),s.aq=js,s.ar=nt,s.as=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([r,a]){const u=fe([1,r,a]);return{x:u.x,y:u.y,z:u.z}}(t.expression.evaluate(e))}interpolate(t,e,r){return{x:Gi(t.x,e.x,r),y:Gi(t.y,e.y,r),z:Gi(t.z,e.z,r)}}},s.at=function(t,e,r=0,a=!0){const u=new Ie(r,r),d=t.sub(u),m=e.add(u),y=[d,new Ie(m.x,d.y),m,new Ie(d.x,m.y)];return a&&y.push(d.clone()),y},s.au=function(t,e){const r=[];for(let a=0;a<t.length;a++){const u=Ui(a-1,-1,t.length-1),d=Ui(a+1,-1,t.length-1),m=t[a],y=t[d],b=t[u].sub(m).unit(),T=y.sub(m).unit(),E=T.angleWithSep(b.x,b.y),I=b.add(T).unit().mult(-1*e/Math.sin(E/2));r.push(m.add(I))}return r},s.av=GS,s.aw=UT,s.ax=function(t,e,r=0){return s.v.fromValues(((e.x-r)*t.scale-t.x)*Mt,(e.y*t.scale-t.y)*Mt,DT(e.z,e.y))},s.ay=nM,s.az=function(t){let e=1/0,r=1/0,a=-1/0,u=-1/0;for(const d of t)e=Math.min(e,d.x),r=Math.min(r,d.y),a=Math.max(a,d.x),u=Math.max(u,d.y);return{min:new Ie(e,r),max:new Ie(a,u)}},s.b=Jo,s.b$=0,s.b0=Ku,s.b1=tw,s.b2=Yo,s.b3=function(t,e,r){const a=Math.sqrt(t*t+e*e+r*r),u=a>0?Math.acos(r/a)*mt:0;let d=t!==0||e!==0?Math.atan2(-e,-t)*mt+90:0;return d<0&&(d+=360),[a,d,u]},s.b4=yf,s.b5=ja,s.b6=Dv,s.b7=T0,s.b8=class extends Kl{constructor(t){super(t),this.current=SD}set(t,e,r){if(this.fetchUniformLocation(t,e)){for(let a=0;a<9;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},s.b9=ew,s.bA=function(t,e){const r=[0,0,0],a=Nd(dl(e.canonical));return s.v.transformMat4(r,r,a),s.v.transformMat4(r,r,t),r},s.bB=t=>({u_camera_to_center_distance:new Yo(t),u_extrude_scale:new S0(t),u_device_pixel_ratio:new Yo(t),u_matrix:new Ld(t),u_inv_rot_matrix:new Ld(t),u_merc_center:new Ku(t),u_tile_id:new T0(t),u_zoom_transition:new Yo(t),u_up_dir:new T0(t),u_emissive_strength:new Yo(t)}),s.bC=t=>({u_matrix:new Ld(t),u_pixels_to_tile_units:new S0(t),u_device_pixel_ratio:new Yo(t),u_units_to_pixels:new Ku(t),u_dash_image:new tg(t),u_gradient_image:new tg(t),u_image_height:new Yo(t),u_texsize:new Ku(t),u_tile_units_to_pixels:new Yo(t),u_alpha_discard_threshold:new Yo(t),u_trim_offset:new Ku(t),u_emissive_strength:new Yo(t)}),s.bD=t=>({u_matrix:new Ld(t),u_texsize:new Ku(t),u_pixels_to_tile_units:new S0(t),u_device_pixel_ratio:new Yo(t),u_image:new tg(t),u_units_to_pixels:new Ku(t),u_tile_units_to_pixels:new Yo(t),u_alpha_discard_threshold:new Yo(t)}),s.bE=Ra,s.bF=_O,s.bG=yO,s.bH=HT,s.bI=(t,e,r,a,u,d)=>{const m=t.transform,y=m.projection.name==="globe";let b;if(d.paint.get("circle-pitch-alignment")==="map")if(y){const E=IT(m.zoom,e.canonical)*m._pixelsPerMercatorPixel;b=Float32Array.from([E,0,0,E])}else b=m.calculatePixelsToTileUnitsMatrix(r);else b=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const T={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(m.projection),u_matrix:t.translatePosMatrix(e.projMatrix,r,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ro.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:dL,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(y){T.u_inv_rot_matrix=a,T.u_merc_center=u,T.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],T.u_zoom_transition=rc(m.zoom);const E=u[0]*Mt,I=u[1]*Mt;T.u_up_dir=m.projection.upVector(new th(0,0,0),E,I)}return T},s.bJ=zM,s.bK=(t,e,r,a,u)=>{const d=t.transform;return{u_matrix:RM(t,e,r,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:d.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_image:0,u_tile_units_to_pixels:OM(e,d),u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}},s.bL=(t,e,r,a,u,d,m)=>{const y=t.transform,b=y.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:RM(t,e,r,a),u_pixels_to_tile_units:b,u_device_pixel_ratio:d,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:FM(r)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:OM(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:m,u_emissive_strength:r.paint.get("line-emissive-strength")}},s.bM=nn,s.bN=dg,s.bO=CM,s.bP=KD,s.bQ=rp,s.bR=eu,s.bS=450,s.bT=7,s.bU=ST,s.bV=X0,s.bW=li,s.bX=Ju,s.bY=Yu,s.bZ=1,s.b_=771,s.ba=mi,s.bb=function(t,e,r){const a=rc(r.zoom),u=t.style.map._antialias,d=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return a===0&&!u&&!d},s.bc=function(t){const e=t.pixelsPerMeter,r=e/Jo(1,t.center.lat),a=s.m.identity(new Float64Array(16));return s.m.translate(a,a,[t.point.x,t.point.y,0]),s.m.scale(a,a,[r,r,e]),Float32Array.from(a)},s.bd=ss,s.be=ag,s.bf=function(t){const e=br-5;t=wt(t,-e,e)/e*90;const r=Math.pow(Math.abs(Math.sin(Xe(t))),3);return Math.round(r*(W0.length-1))},s.bg=function(t,e,r,a){const u=e.getNorth(),d=e.getSouth(),m=e.getWest(),y=e.getEast(),b=1<<t.z,T=y-m,E=u-d,I=T/nf,k=-E/W0[r],O=[0,I,0,k,0,0,u,m,0];if(t.z>0){const z=180/a;s.bx.multiply(O,O,[z/T+1,0,0,0,z/E+1,0,-.5*z/I,.5*z/k,1])}return O[2]=b,O[5]=t.x,O[8]=t.y,O},s.bh=Nd,s.bi=dl,s.bj=function(t,e,r){const a=s.m.identity(new Float64Array(16)),u=(e/(1<<t)-.5)*Math.PI*2;return s.m.rotateY(a,r.globeMatrix,u),Float32Array.from(a)},s.bk=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const r=e.getSource().maxzoom,a=1<<r,u=Math.floor(t.x),d=Math.floor((t.x-u)*a),m=Math.floor(t.y*a),y=this.findDEMTileFor(new lo(r,u,r,d,m));return!(!y||!y.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||t.y<0||t.y>1)return e;const u=a.getSource().maxzoom,d=1<<u,m=Math.floor(t.x),y=t.x-m,b=new lo(u,m,u,Math.floor(y*d),Math.floor(t.y*d)),T=this.findDEMTileFor(b);if(!T||!T.dem)return e;const E=T.dem,I=1<<T.tileID.canonical.z,k=(y*I-T.tileID.canonical.x)*E.dim,O=(t.y*I-T.tileID.canonical.y)*E.dim,z=Math.floor(k),N=Math.floor(O);return(r?this.exaggeration():1)*Gi(Gi(E.get(z,N),E.get(z,N+1),O-N),Gi(E.get(z+1,N),E.get(z+1,N+1),O-N),k-z)}getAtTileOffset(t,e,r){const a=1<<t.canonical.z;return this.getAtPointOrZero(new To(t.wrap+(t.canonical.x+e/Mt)/a,(t.canonical.y+r/Mt)/a))}getAtTileOffsetFunc(t,e,r,a){return u=>{const d=this.getAtTileOffset(t,u.x,u.y),m=a.upVector(t.canonical,u.x,u.y),y=a.upVectorScale(t.canonical,e,r).metersToTile;return s.v.scale(m,m,d*y),m}}getForTilePoints(t,e,r,a){if(this.isUsingMockSource())return!1;const u=hf.create(this,t,a);return!!u&&(e.forEach(d=>{d[2]=this.exaggeration()*u.getElevationAt(d[0],d[1],r)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const r=e.dem.tree,a=e.tileID,u=1<<t.canonical.z-a.canonical.z;let d=t.canonical.x/u-a.canonical.x,m=t.canonical.y/u-a.canonical.y,y=0;for(let b=0;b<t.canonical.z-a.canonical.z&&!r.leaves[y];b++){d*=2,m*=2;const T=2*Math.floor(m)+Math.floor(d);y=r.childOffsets[y]+T,d%=1,m%=1}return{min:this.exaggeration()*r.minimums[y],max:this.exaggeration()*r.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,r=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const u of t){const d=this.getMinMaxForTile(u.tileID);d&&(r=Math.min(r,d.min),a=Math.max(a,d.max),e=!0)}return e?{min:r,max:a}:null}},s.bl=Rd,s.bm=or,s.bn=sg,s.bo=Li,s.bp=An,s.bq=ah,s.br=sp,s.bs=jv,s.bt=Pv,s.bu=JT,s.bv=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},s.bw=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},s.by=IT,s.bz=256,s.c=wt,s.c$=M,s.c0=g0,s.c1=function(t,e,r,a,u){return wt((t-e)/(r-e)*(u-a)+a,a,u)},s.c2=Nu,s.c3=Ir,s.c4=nh,s.c5=oM,s.c6=[1,1,1],s.c7=hf,s.c8=Zg,s.c9=Lo,s.cA=Mr,s.cB=t=>Hs(Ad(t)),s.cC=se,s.cD=Zr,s.cE=Ti,s.cF=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.cG=Zi,s.cH=OT,s.cI=ih,s.cJ=function([t,e,r]){const a=Math.hypot(t,e,r),u=Math.atan2(t,r),d=.5*Math.PI-Math.acos(-e/a);return new vn(Tt(u),Tt(d))},s.cK=Cs,s.cL=Vd,s.cM=D,s.cN=J0,s.cO=PT,s.cP=function(t){const e=[0,0,0],r=s.m.identity(new Float64Array(16));return s.m.multiply(r,t.pixelMatrix,t.globeMatrix),s.v.transformMat4(e,e,r),new Ie(e[0],e[1])},s.cQ=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!function(r){if(ft==null){const a=r.navigator?r.navigator.userAgent:null;ft=!!r.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return ft}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.cR=Si,s.cS=class{constructor(t,e,r){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ye,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!St(t))return t;const r=yt(t);return r.params.push(`sdk=js-${M}`),r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!St(t))return t;const r=yt(t);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeModelURL(t,e){if(!St(t))return t;const r=yt(t);return r.path=`/models/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(t,e,r,a){if(!St(t))return t;const u=yt(t);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),r&&u.params.push(`language=${r}`),a&&u.params.push(`worldview=${a}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(t,e,r,a){const u=yt(t);return St(t)?(u.path=`/styles/v1${u.path}/sprite${e}${r}`,this._makeAPIURL(u,this._customAccessToken||a)):(u.path+=`${e}${r}`,Pi(u))}normalizeTileURL(t,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!St(t))return t;const a=yt(t);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&a.authority!=="raster"&&r===512?"@2x":""}${F.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${D.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${D.TILE_URL_VERSION}${a.path}`);const u=this._customAccessToken||function(d){for(const m of d){const y=m.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(a.params)||D.ACCESS_TOKEN;return D.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,u)}canonicalizeTileURL(t,e){const r=yt(t);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return t;let a="mapbox://";r.path.match(/^\/raster\/v1\//)?a+=`raster/${r.path.replace(`/${D.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${r.path.replace(`/${D.TILE_URL_VERSION}/`,"")}`;let u=r.params;return e&&(u=u.filter(d=>!d.match(/^access_token=/))),u.length&&(a+=`?${u.join("&")}`),a}canonicalizeTileset(t,e){const r=!!e&&St(e),a=[];for(const u of t.tiles||[])Ct(u)?a.push(this.canonicalizeTileURL(u,r)):a.push(u);return a}_makeAPIURL(t,e){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=yt(D.API_URL);if(t.protocol=a.protocol,t.authority=a.authority,t.protocol==="http"){const u=t.params.indexOf("secure");u>=0&&t.params.splice(u,1)}if(a.path!=="/"&&(t.path=`${a.path}${t.path}`),!D.REQUIRE_ACCESS_TOKEN)return Pi(t);if(e=e||D.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return t.params=t.params.filter(u=>u.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Pi(t)}},s.cT=function(t,e){e?vo.add(t):vo.delete(t)},s.cU=F,s.cV=ir,s.cW=Yr,s.cX=xt,s.cY=Xr,s.cZ=function(t){vo.delete(t)},s.c_=Mi,s.ca=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){const e=mM(new Ie(0,0),new Ie(Mt,Mt),t),r=[];for(const a of this._activeRegions){if(a.hiddenByOverlap||!pM(e,a))continue;const u=pR(a.min,a.max,t);r.push({min:u.min,max:u.max,sourceId:this._sourceIds[a.priority],footprint:a.footprint,footprintTileId:a.tileId})}return r}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const r=[];for(const a of e.cache.getVisibleCoordinates()){const u=e.cache.getTile(a).buckets[e.layer];if(u)for(const d of u.getNodesInfo()){const m=d.node;m.footprint&&r.push({footprint:m.footprint,id:a.toUnwrapped()})}}return r}})))}_addSource(t){const e=t.getFootprints();if(e.length!==0){for(const r of e){if(!r.footprint)continue;const a=mM(r.footprint.min,r.footprint.max,r.id);this._activeRegions.push({min:a.min,max:a.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:r.id,footprint:r.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,r)=>e.priority-r.priority||Jg(e.min,r.min)||Jg(e.max,r.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,r=0;for(;!t&&e!==this._activeRegions.length;){const a=this._activeRegions[e],u=this._prevRegions[r];t=a.priority!==u.priority||!dM(a,u),++e,++r}}if(t){++this._updateTime;const e=r=>{const a=this._activeRegions;if(r>=a.length)return r;const u=a[r].priority;for(;r<a.length&&a[r].priority===u;)++r;return r};if(this._sourceIds.length>1){let r=0,a=e(r);for(;r!==a;){let u=r;const d=r;for(;u!==a;){const m=this._activeRegions[u];m.hiddenByOverlap=!1;for(let y=0;y<d;y++){const b=this._activeRegions[y];if(!b.hiddenByOverlap&&pM(m,b)&&(m.hiddenByOverlap=_M(m.footprint,m.tileId,b.footprint,b.tileId),m.hiddenByOverlap))break}++u}r=a,a=e(r)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},s.cb=Mn,s.cc=Hg,s.cd=Pd,s.ce=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){const r=new Li,a=new An,u=[],d=t+1+2,m=e[0]+1,y=e[0]+1+(1+e.length),b=(T,E,I)=>{let k=T===d-1?T-2:T===0?T:T-1;return k+=I?24575:0,[k,E]};for(let T=0;T<d;++T)r.emplaceBack(...b(T,0,!0));for(let T=0;T<m;++T)for(let E=0;E<d;++E)r.emplaceBack(...b(E,T,(E===0||E===d-1)&&!0));for(let T=0;T<e.length;++T){const E=e[T];for(let I=0;I<d;++I)r.emplaceBack(...b(I,E,!0))}for(let T=0;T<e.length;++T){const E=a.length,I=e[T]+1+2,k=new An;for(let N=0;N<I-1;N++){const j=N===I-2,q=j?d*(y-e.length+T-N):d;for(let ie=0;ie<d-1;ie++){const oe=N*d+ie;N===0||j||ie===0||ie===d-2?(k.emplaceBack(oe+1,oe,oe+q),k.emplaceBack(oe+q,oe+q+1,oe+1)):(a.emplaceBack(oe+1,oe,oe+q),a.emplaceBack(oe+q,oe+q+1,oe+1))}}const O=or.simpleSegment(0,E,r.length,a.length-E);for(let N=0;N<k.uint16.length;N+=3)a.emplaceBack(k.uint16[N],k.uint16[N+1],k.uint16[N+2]);const z=or.simpleSegment(0,E,r.length,a.length-E);u.push({withoutSkirts:O,withSkirts:z})}return{vertices:r,indices:a,segments:u}}_createGrid(t){const e=this._fillGridMeshWithLods(nf,W0);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Rd.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new An;for(let m=0;m<=nf;m++)e.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const r=new Yu,a=new Yu,u=new Yu,d=new Yu;this._poleSegments=[];for(let m=0,y=0;m<H0;m++){const b=360/(1<<m);r.emplaceBack(0,-Ys,0,.5,0),a.emplaceBack(0,-Ys,0,.5,1),u.emplaceBack(0,-Ys,0,.5,.5),d.emplaceBack(0,-Ys,0,.5,.5);for(let T=0;T<=nf;T++){let E=T/nf,I=0;const k=Gi(0,b,E),[O,z,N]=rf(tL,iL,k,Ys);r.emplaceBack(O,z,N,E,I),a.emplaceBack(O,z,N,E,1-I);const j=Xe(k);E=.5+.5*Math.sin(j),I=.5+.5*Math.cos(j),u.emplaceBack(O,z,N,E,I),d.emplaceBack(O,z,N,E,1-I)}this._poleSegments.push(or.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(r,og,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(a,og,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(u,og,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(d,og,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},s.cf=function(t){return vo.has(t)},s.cg=cg,s.ch=fe,s.ci=function(t){return t({pluginStatus:K,pluginURL:ce}),se.on("pluginStateChange",t),t},s.cj=pf,s.ck=Tv,s.cl=Xn,s.cm=ge,s.cn=St,s.co=cn,s.cp=function(t,e,r){return t.type==="custom"?new kR(t,e):new RR[t.type](t,e,r)},s.cq=function(t){const e=t.indexOf(ti);return e>=0?t.slice(0,e):t},s.cr=t=>Hs(Ym(t)),s.cs=t=>Hs(Zm(t)),s.ct=t=>Hs(Ed(t)),s.cu=function(t){return t.indexOf(ti)>=0},s.cv=function(t){const e=t.indexOf(ti);return e>=0?t.slice(e+1):""},s.cw=Gu,s.cx=function(t){const e=[],r=t.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},s.cy=t=>Hs(qm(t)),s.cz=t=>Hs(Sd(t)),s.d=Xe,s.d0=function(t,e){qt=t,rn=e},s.d1=function(t,e,r=!1){if(K===Y||K===Q||K===te)throw new Error("setRTLTextPlugin cannot be called multiple times.");ce=ro.resolveURL(t),K=Y,ee=e,_e(),r||ve()},s.d2=ue,s.d3=function(){jv().acquire(Uv)},s.d4=function(){const t=cp;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(Uv),cp=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.d5=lp,s.d6=function(t){const e=_n();if(!e)return;const r=e.delete(Gt);t&&r.catch(t).then(()=>t())},s.d7=ap,s.d8=XM,s.d9=function(t){Gv=ro.resolveURL(t),Hv||(Hv=new sp(jv(),new so)),Hv.broadcast("setDracoUrl",Gv)},s.da=st,s.db=Eg,s.dc=pe,s.dd=bg,s.de=xg,s.df=pt,s.dg=oS,s.dh=class extends so{constructor(t,e,r,a,u,d){super(),this.actor=t,this.layerIndex=e,this.availableImages=r,this.loadVectorData=u||ZM,this.loading={},this.loaded={},this.deduped=new qM(t.scheduler),this.isSpriteLoaded=a,this.scheduler=t.scheduler,this.brightness=d}loadTile(t,e){const r=t.uid,a=t&&t.request,u=a&&a.collectResourceTiming,d=this.loading[r]=new BR(t);d.abort=this.loadVectorData(t,(m,y)=>{const b=!this.loading[r];if(delete this.loading[r],b||m||!y)return d.status="done",b||(this.loaded[r]=d),e(m);const T=y.rawData,E={};y.expires&&(E.expires=y.expires),y.cacheControl&&(E.cacheControl=y.cacheControl),d.vectorTile=y.vectorTile||new pv(new Mg(T));const I=()=>{d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,(k,O)=>{if(k||!O)return e(k);const z={};if(u){const N=kl(a);N.length>0&&(z.resourceTiming=JSON.parse(JSON.stringify(N)))}e(null,rt({rawTileData:T.slice(0)},O,E,z))})};this.isSpriteLoaded?I():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(I,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):I()}),this.loaded=this.loaded||{},this.loaded[r]=d})}reloadTile(t,e){const r=this.loaded,a=t.uid,u=this;if(r&&r[a]){const d=r[a];d.showCollisionBoxes=t.showCollisionBoxes,d.projection=t.projection,d.brightness=t.brightness,d.tileTransform=Yc(t.tileID.canonical,t.projection),d.extraShadowCaster=t.extraShadowCaster;const m=(y,b)=>{const T=d.reloadCallback;T&&(delete d.reloadCallback,d.parse(d.vectorTile,u.layerIndex,this.availableImages,u.actor,T)),e(y,b)};d.status==="parsing"?d.reloadCallback=m:d.status==="done"&&(d.vectorTile?d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,m):m())}else e(null,void 0)}abortTile(t,e){const r=t.uid,a=this.loading[r];a&&(a.abort&&a.abort(),delete this.loading[r]),e()}removeTile(t,e){const r=this.loaded,a=t.uid;r&&r[a]&&delete r[a],e()}},s.di=kl,s.dj=Er,s.dk=gv,s.dl=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==JM){const r=new Uint32Array(t,0,7),[,,a,u,d,m]=r;e=r.byteLength+u+d+m+d,(a!==t.byteLength||e>=t.byteLength)&&si("Invalid b3dm header information.")}return eE(t,e)},s.dm=function(t,e){const r=nE(t);for(const a of r){for(const u of a.meshes)XR(u);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(YR(a.lights,e)))}return r},s.dn=fM,s.dp=jM,s.dq=Me,s.dr=function(t){Tn(),Bi&&Bi.then(e=>{e.keys().then(r=>{for(let a=0;a<r.length-t;a++)e.delete(r[a])})})},s.f=function(t,e){const{x:r,y:a}=t.point,u=CT(r,a,t.worldSize/t._pixelsPerMercatorPixel,0,0);return s.m.multiply(u,u,X0(dl(e)))},s.g=Wt,s.i=ff,s.j=Ag,s.k=Ng,s.l=ho,s.n=Gi,s.o=XS,s.p=function(t,e){const r={};for(let a=0;a<e.length;a++){const u=e[a];u in t&&(r[u]=t[u])}return r},s.r=eM,s.s=function(t,e,r){t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},s.t=th,s.u=function(t,e,r,a,u){const d=5*e+2;t.float32[d+0]=r,t.float32[d+1]=a,t.float32[d+2]=u},s.w=Ui,s.x=ET,s.y=function(t,e,r,a,u,d,m,y,b){if(b.name==="globe")return ET(t,e,new th(r,a,u),!1);const T=Yc({z:r,x:a,y:u},b);return new Ir([(d+T.x/T.scale)*e,e*(T.y/T.scale),m],[(d+T.x2/T.scale)*e,e*(T.y2/T.scale),y])},s.z=function(t,e,r){let a=0;for(let u=0;u<2;++u){const d=r?r[u]:0;t[u]>d&&(a+=(t[u]-d)*(t[u]-d)),e[u]<d&&(a+=(d-e[u])*(d-e[u]))}return a}}),g(["./shared"],function(s){function M(je){if(typeof je=="number"||typeof je=="boolean"||typeof je=="string"||je==null)return JSON.stringify(je);if(Array.isArray(je)){let fe="[";for(const Ee of je)fe+=`${M(Ee)},`;return`${fe}]`}let re="{";for(const fe of Object.keys(je).sort())re+=`${fe}:${M(je[fe])},`;return`${re}}`}function C(je){let re="";for(const fe of s.aS)re+=`/${M(je[fe])}`;return re}class D{constructor(re){this.keyCache={},this._layers={},this._layerConfigs={},re&&this.replace(re)}replace(re,fe){this._layerConfigs={},this._layers={},this.update(re,[],fe)}update(re,fe,Ee){this._options=Ee;for(const ft of re)this._layerConfigs[ft.id]=ft,(this._layers[ft.id]=s.cp(ft,this.scope,this._options)).compileFilter(),this.keyCache[ft.id]&&delete this.keyCache[ft.id];for(const ft of fe)delete this.keyCache[ft],delete this._layerConfigs[ft],delete this._layers[ft];this.familiesBySource={};const dt=function(ft,Ut){const Wt={};for(let Zt=0;Zt<ft.length;Zt++){const Gt=Ut&&Ut[ft[Zt].id]||C(ft[Zt]);Ut&&(Ut[ft[Zt].id]=Gt);let qt=Wt[Gt];qt||(qt=Wt[Gt]=[]),qt.push(ft[Zt])}const at=[];for(const Zt in Wt)at.push(Wt[Zt]);return at}(s.da(this._layerConfigs),this.keyCache);for(const ft of dt){const Ut=ft.map(rn=>this._layers[rn.id]),Wt=Ut[0];if(Wt.visibility==="none")continue;const at=Wt.source||"";let Zt=this.familiesBySource[at];Zt||(Zt=this.familiesBySource[at]={});const Gt=Wt.sourceLayer||"_geojsonTileLayer";let qt=Zt[Gt];qt||(qt=Zt[Gt]=[]),qt.push(Ut)}}}class F{loadTile(re,fe){const{uid:Ee,encoding:dt,rawImageData:ft,padding:Ut}=re,Wt=ImageBitmap&&ft instanceof ImageBitmap?this.getImageData(ft,Ut):ft;fe(null,new s.db(Ee,Wt,dt,Ut<1))}getImageData(re,fe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(re.width,re.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=re.width,this.offscreenCanvas.height=re.height,this.offscreenCanvasContext.drawImage(re,0,0,re.width,re.height);const Ee=this.offscreenCanvasContext.getImageData(-fe,-fe,re.width+2*fe,re.height+2*fe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Ee}}function V(je,re){if(je.length!==0){X(je[0],re);for(var fe=1;fe<je.length;fe++)X(je[fe],!re)}}function X(je,re){for(var fe=0,Ee=0,dt=0,ft=je.length,Ut=ft-1;dt<ft;Ut=dt++){var Wt=(je[dt][0]-je[Ut][0])*(je[Ut][1]+je[dt][1]),at=fe+Wt;Ee+=Math.abs(fe)>=Math.abs(Wt)?fe-at+Wt:Wt-at+fe,fe=at}fe+Ee>=0!=!!re&&je.reverse()}var W=s.dc(function je(re,fe){var Ee,dt=re&&re.type;if(dt==="FeatureCollection")for(Ee=0;Ee<re.features.length;Ee++)je(re.features[Ee],fe);else if(dt==="GeometryCollection")for(Ee=0;Ee<re.geometries.length;Ee++)je(re.geometries[Ee],fe);else if(dt==="Feature")je(re.geometry,fe);else if(dt==="Polygon")V(re.coordinates,fe);else if(dt==="MultiPolygon")for(Ee=0;Ee<re.coordinates.length;Ee++)V(re.coordinates[Ee],fe);return re});const J=s.dd.prototype.toGeoJSON;var $={exports:{}},ne=s.df,ye=s.de.VectorTileFeature,pe=ke;function ke(je,re){this.options=re||{},this.features=je,this.length=je.length}function Ae(je,re){this.id=typeof je.id=="number"?je.id:void 0,this.type=je.type,this.rawGeometry=je.type===1?[je.geometry]:je.geometry,this.properties=je.tags,this.extent=re||4096}ke.prototype.feature=function(je){return new Ae(this.features[je],this.options.extent)},Ae.prototype.loadGeometry=function(){var je=this.rawGeometry;this.geometry=[];for(var re=0;re<je.length;re++){for(var fe=je[re],Ee=[],dt=0;dt<fe.length;dt++)Ee.push(new ne(fe[dt][0],fe[dt][1]));this.geometry.push(Ee)}return this.geometry},Ae.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var je=this.geometry,re=1/0,fe=-1/0,Ee=1/0,dt=-1/0,ft=0;ft<je.length;ft++)for(var Ut=je[ft],Wt=0;Wt<Ut.length;Wt++){var at=Ut[Wt];re=Math.min(re,at.x),fe=Math.max(fe,at.x),Ee=Math.min(Ee,at.y),dt=Math.max(dt,at.y)}return[re,Ee,fe,dt]},Ae.prototype.toGeoJSON=ye.prototype.toGeoJSON;var tt=s.dg,pt=pe;function kt(je){var re=new tt;return function(fe,Ee){for(var dt in fe.layers)Ee.writeMessage(3,Ie,fe.layers[dt])}(je,re),re.finish()}function Ie(je,re){var fe;re.writeVarintField(15,je.version||1),re.writeStringField(1,je.name||""),re.writeVarintField(5,je.extent||4096);var Ee={keys:[],values:[],keycache:{},valuecache:{}};for(fe=0;fe<je.length;fe++)Ee.feature=je.feature(fe),re.writeMessage(2,Et,Ee);var dt=Ee.keys;for(fe=0;fe<dt.length;fe++)re.writeStringField(3,dt[fe]);var ft=Ee.values;for(fe=0;fe<ft.length;fe++)re.writeMessage(4,mi,ft[fe])}function Et(je,re){var fe=je.feature;fe.id!==void 0&&re.writeVarintField(1,fe.id),re.writeMessage(2,mt,je),re.writeVarintField(3,fe.type),re.writeMessage(4,Yt,fe)}function mt(je,re){var fe=je.feature,Ee=je.keys,dt=je.values,ft=je.keycache,Ut=je.valuecache;for(var Wt in fe.properties){var at=fe.properties[Wt],Zt=ft[Wt];if(at!==null){Zt===void 0&&(Ee.push(Wt),ft[Wt]=Zt=Ee.length-1),re.writeVarint(Zt);var Gt=typeof at;Gt!=="string"&&Gt!=="boolean"&&Gt!=="number"&&(at=JSON.stringify(at));var qt=Gt+":"+at,rn=Ut[qt];rn===void 0&&(dt.push(at),Ut[qt]=rn=dt.length-1),re.writeVarint(rn)}}}function Xe(je,re){return(re<<3)+(7&je)}function Tt(je){return je<<1^je>>31}function Yt(je,re){for(var fe=je.loadGeometry(),Ee=je.type,dt=0,ft=0,Ut=fe.length,Wt=0;Wt<Ut;Wt++){var at=fe[Wt],Zt=1;Ee===1&&(Zt=at.length),re.writeVarint(Xe(1,Zt));for(var Gt=Ee===3?at.length-1:at.length,qt=0;qt<Gt;qt++){qt===1&&Ee!==1&&re.writeVarint(Xe(2,Gt-1));var rn=at[qt].x-dt,Bi=at[qt].y-ft;re.writeVarint(Tt(rn)),re.writeVarint(Tt(Bi)),dt+=rn,ft+=Bi}Ee===3&&re.writeVarint(Xe(7,1))}}function mi(je,re){var fe=typeof je;fe==="string"?re.writeStringField(1,je):fe==="boolean"?re.writeBooleanField(7,je):fe==="number"&&(je%1!=0?re.writeDoubleField(3,je):je<0?re.writeSVarintField(6,je):re.writeVarintField(5,je))}$.exports=kt,$.exports.fromVectorTileJs=kt,$.exports.fromGeojsonVt=function(je,re){re=re||{};var fe={};for(var Ee in je)fe[Ee]=new pt(je[Ee].features,re),fe[Ee].name=Ee,fe[Ee].version=re.version,fe[Ee].extent=re.extent;return kt({layers:fe})},$.exports.GeoJSONWrapper=pt;var Ti=s.dc($.exports);const Zi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:je=>je},wt=Math.fround||(Ii=new Float32Array(1),je=>(Ii[0]=+je,Ii[0]));var Ii;const Ui=3,Mi=5,st=6;class rt{constructor(re){this.options=Object.assign(Object.create(Zi),re),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(re){const{log:fe,minZoom:Ee,maxZoom:dt}=this.options;fe&&console.time("total time");const ft=`prepare ${re.length} points`;fe&&console.time(ft),this.points=re;const Ut=[];for(let at=0;at<re.length;at++){const Zt=re[at];if(!Zt.geometry)continue;const[Gt,qt]=Zt.geometry.coordinates,rn=wt(bn(Gt)),Bi=wt(nn(qt));Ut.push(rn,Bi,1/0,at,-1,1),this.options.reduce&&Ut.push(0)}let Wt=this.trees[dt+1]=this._createTree(Ut);fe&&console.timeEnd(ft);for(let at=dt;at>=Ee;at--){const Zt=+Date.now();Wt=this.trees[at]=this._createTree(this._cluster(Wt,at)),fe&&console.log("z%d: %d clusters in %dms",at,Wt.numItems,+Date.now()-Zt)}return fe&&console.timeEnd("total time"),this}getClusters(re,fe){let Ee=((re[0]+180)%360+360)%360-180;const dt=Math.max(-90,Math.min(90,re[1]));let ft=re[2]===180?180:((re[2]+180)%360+360)%360-180;const Ut=Math.max(-90,Math.min(90,re[3]));if(re[2]-re[0]>=360)Ee=-180,ft=180;else if(Ee>ft){const qt=this.getClusters([Ee,dt,180,Ut],fe),rn=this.getClusters([-180,dt,ft,Ut],fe);return qt.concat(rn)}const Wt=this.trees[this._limitZoom(fe)],at=Wt.range(bn(Ee),nn(Ut),bn(ft),nn(dt)),Zt=Wt.data,Gt=[];for(const qt of at){const rn=this.stride*qt;Gt.push(Zt[rn+Mi]>1?zi(Zt,rn,this.clusterProps):this.points[Zt[rn+Ui]])}return Gt}getChildren(re){const fe=this._getOriginId(re),Ee=this._getOriginZoom(re),dt="No cluster with the specified id.",ft=this.trees[Ee];if(!ft)throw new Error(dt);const Ut=ft.data;if(fe*this.stride>=Ut.length)throw new Error(dt);const Wt=this.options.radius/(this.options.extent*Math.pow(2,Ee-1)),at=ft.within(Ut[fe*this.stride],Ut[fe*this.stride+1],Wt),Zt=[];for(const Gt of at){const qt=Gt*this.stride;Ut[qt+4]===re&&Zt.push(Ut[qt+Mi]>1?zi(Ut,qt,this.clusterProps):this.points[Ut[qt+Ui]])}if(Zt.length===0)throw new Error(dt);return Zt}getLeaves(re,fe,Ee){const dt=[];return this._appendLeaves(dt,re,fe=fe||10,Ee=Ee||0,0),dt}getTile(re,fe,Ee){const dt=this.trees[this._limitZoom(re)],ft=Math.pow(2,re),{extent:Ut,radius:Wt}=this.options,at=Wt/Ut,Zt=(Ee-at)/ft,Gt=(Ee+1+at)/ft,qt={features:[]};return this._addTileFeatures(dt.range((fe-at)/ft,Zt,(fe+1+at)/ft,Gt),dt.data,fe,Ee,ft,qt),fe===0&&this._addTileFeatures(dt.range(1-at/ft,Zt,1,Gt),dt.data,ft,Ee,ft,qt),fe===ft-1&&this._addTileFeatures(dt.range(0,Zt,at/ft,Gt),dt.data,-1,Ee,ft,qt),qt.features.length?qt:null}getClusterExpansionZoom(re){let fe=this._getOriginZoom(re)-1;for(;fe<=this.options.maxZoom;){const Ee=this.getChildren(re);if(fe++,Ee.length!==1)break;re=Ee[0].properties.cluster_id}return fe}_appendLeaves(re,fe,Ee,dt,ft){const Ut=this.getChildren(fe);for(const Wt of Ut){const at=Wt.properties;if(at&&at.cluster?ft+at.point_count<=dt?ft+=at.point_count:ft=this._appendLeaves(re,at.cluster_id,Ee,dt,ft):ft<dt?ft++:re.push(Wt),re.length===Ee)break}return ft}_createTree(re){const fe=new s.aZ(re.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ee=0;Ee<re.length;Ee+=this.stride)fe.add(re[Ee],re[Ee+1]);return fe.finish(),fe.data=re,fe}_addTileFeatures(re,fe,Ee,dt,ft,Ut){for(const Wt of re){const at=Wt*this.stride,Zt=fe[at+Mi]>1;let Gt,qt,rn;if(Zt)Gt=Si(fe,at,this.clusterProps),qt=fe[at],rn=fe[at+1];else{const _n=this.points[fe[at+Ui]];Gt=_n.properties;const[Tn,We]=_n.geometry.coordinates;qt=bn(Tn),rn=nn(We)}const Bi={type:1,geometry:[[Math.round(this.options.extent*(qt*ft-Ee)),Math.round(this.options.extent*(rn*ft-dt))]],tags:Gt};let qn;qn=Zt||this.options.generateId?fe[at+Ui]:this.points[fe[at+Ui]].id,qn!==void 0&&(Bi.id=qn),Ut.features.push(Bi)}}_limitZoom(re){return Math.max(this.options.minZoom,Math.min(Math.floor(+re),this.options.maxZoom+1))}_cluster(re,fe){const{radius:Ee,extent:dt,reduce:ft,minPoints:Ut}=this.options,Wt=Ee/(dt*Math.pow(2,fe)),at=re.data,Zt=[],Gt=this.stride;for(let qt=0;qt<at.length;qt+=Gt){if(at[qt+2]<=fe)continue;at[qt+2]=fe;const rn=at[qt],Bi=at[qt+1],qn=re.within(at[qt],at[qt+1],Wt),_n=at[qt+Mi];let Tn=_n;for(const We of qn){const pi=We*Gt;at[pi+2]>fe&&(Tn+=at[pi+Mi])}if(Tn>_n&&Tn>=Ut){let We,pi=rn*_n,Wi=Bi*_n,an=-1;const Xn=((qt/Gt|0)<<5)+(fe+1)+this.points.length;for(const Zr of qn){const Er=Zr*Gt;if(at[Er+2]<=fe)continue;at[Er+2]=fe;const yo=at[Er+Mi];pi+=at[Er]*yo,Wi+=at[Er+1]*yo,at[Er+4]=Xn,ft&&(We||(We=this._map(at,qt,!0),an=this.clusterProps.length,this.clusterProps.push(We)),ft(We,this._map(at,Er)))}at[qt+4]=Xn,Zt.push(pi/Tn,Wi/Tn,1/0,Xn,-1,Tn),ft&&Zt.push(an)}else{for(let We=0;We<Gt;We++)Zt.push(at[qt+We]);if(Tn>1)for(const We of qn){const pi=We*Gt;if(!(at[pi+2]<=fe)){at[pi+2]=fe;for(let Wi=0;Wi<Gt;Wi++)Zt.push(at[pi+Wi])}}}}return Zt}_getOriginId(re){return re-this.points.length>>5}_getOriginZoom(re){return(re-this.points.length)%32}_map(re,fe,Ee){if(re[fe+Mi]>1){const Ut=this.clusterProps[re[fe+st]];return Ee?Object.assign({},Ut):Ut}const dt=this.points[re[fe+Ui]].properties,ft=this.options.map(dt);return Ee&&ft===dt?Object.assign({},ft):ft}}function zi(je,re,fe){return{type:"Feature",id:je[re+Ui],properties:Si(je,re,fe),geometry:{type:"Point",coordinates:[(Ee=je[re],360*(Ee-.5)),hn(je[re+1])]}};var Ee}function Si(je,re,fe){const Ee=je[re+Mi],dt=Ee>=1e4?`${Math.round(Ee/1e3)}k`:Ee>=1e3?Math.round(Ee/100)/10+"k":Ee,ft=je[re+st],Ut=ft===-1?{}:Object.assign({},fe[ft]);return Object.assign(Ut,{cluster:!0,cluster_id:je[re+Ui],point_count:Ee,point_count_abbreviated:dt})}function bn(je){return je/360+.5}function nn(je){const re=Math.sin(je*Math.PI/180),fe=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return fe<0?0:fe>1?1:fe}function hn(je){const re=(180-360*je)*Math.PI/180;return 360*Math.atan(Math.exp(re))/Math.PI-90}var Ze={exports:{}};Ze.exports=function(){function je(Qe,lt,xt,St){for(var Ct,zt=St,jt=xt-lt>>1,Dt=xt-lt,ni=Qe[lt],yt=Qe[lt+1],Pi=Qe[xt],un=Qe[xt+1],fi=lt+3;fi<xt;fi+=3){var on=re(Qe[fi],Qe[fi+1],ni,yt,Pi,un);if(on>zt)Ct=fi,zt=on;else if(on===zt){var Yn=Math.abs(fi-jt);Yn<Dt&&(Ct=fi,Dt=Yn)}}zt>St&&(Ct-lt>3&&je(Qe,lt,Ct,St),Qe[Ct+2]=zt,xt-Ct>3&&je(Qe,Ct,xt,St))}function re(Qe,lt,xt,St,Ct,zt){var jt=Ct-xt,Dt=zt-St;if(jt!==0||Dt!==0){var ni=((Qe-xt)*jt+(lt-St)*Dt)/(jt*jt+Dt*Dt);ni>1?(xt=Ct,St=zt):ni>0&&(xt+=jt*ni,St+=Dt*ni)}return(jt=Qe-xt)*jt+(Dt=lt-St)*Dt}function fe(Qe,lt,xt,St){var Ct={id:Qe===void 0?null:Qe,type:lt,geometry:xt,tags:St,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(zt){var jt=zt.geometry,Dt=zt.type;if(Dt==="Point"||Dt==="MultiPoint"||Dt==="LineString")Ee(zt,jt);else if(Dt==="Polygon"||Dt==="MultiLineString")for(var ni=0;ni<jt.length;ni++)Ee(zt,jt[ni]);else if(Dt==="MultiPolygon")for(ni=0;ni<jt.length;ni++)for(var yt=0;yt<jt[ni].length;yt++)Ee(zt,jt[ni][yt])}(Ct),Ct}function Ee(Qe,lt){for(var xt=0;xt<lt.length;xt+=3)Qe.minX=Math.min(Qe.minX,lt[xt]),Qe.minY=Math.min(Qe.minY,lt[xt+1]),Qe.maxX=Math.max(Qe.maxX,lt[xt]),Qe.maxY=Math.max(Qe.maxY,lt[xt+1])}function dt(Qe,lt,xt,St){if(lt.geometry){var Ct=lt.geometry.coordinates,zt=lt.geometry.type,jt=Math.pow(xt.tolerance/((1<<xt.maxZoom)*xt.extent),2),Dt=[],ni=lt.id;if(xt.promoteId?ni=lt.properties[xt.promoteId]:xt.generateId&&(ni=St||0),zt==="Point")ft(Ct,Dt);else if(zt==="MultiPoint")for(var yt=0;yt<Ct.length;yt++)ft(Ct[yt],Dt);else if(zt==="LineString")Ut(Ct,Dt,jt,!1);else if(zt==="MultiLineString"){if(xt.lineMetrics){for(yt=0;yt<Ct.length;yt++)Ut(Ct[yt],Dt=[],jt,!1),Qe.push(fe(ni,"LineString",Dt,lt.properties));return}Wt(Ct,Dt,jt,!1)}else if(zt==="Polygon")Wt(Ct,Dt,jt,!0);else{if(zt!=="MultiPolygon"){if(zt==="GeometryCollection"){for(yt=0;yt<lt.geometry.geometries.length;yt++)dt(Qe,{id:ni,geometry:lt.geometry.geometries[yt],properties:lt.properties},xt,St);return}throw new Error("Input data is not a valid GeoJSON object.")}for(yt=0;yt<Ct.length;yt++){var Pi=[];Wt(Ct[yt],Pi,jt,!0),Dt.push(Pi)}}Qe.push(fe(ni,zt,Dt,lt.properties))}}function ft(Qe,lt){lt.push(at(Qe[0])),lt.push(Zt(Qe[1])),lt.push(0)}function Ut(Qe,lt,xt,St){for(var Ct,zt,jt=0,Dt=0;Dt<Qe.length;Dt++){var ni=at(Qe[Dt][0]),yt=Zt(Qe[Dt][1]);lt.push(ni),lt.push(yt),lt.push(0),Dt>0&&(jt+=St?(Ct*yt-ni*zt)/2:Math.sqrt(Math.pow(ni-Ct,2)+Math.pow(yt-zt,2))),Ct=ni,zt=yt}var Pi=lt.length-3;lt[2]=1,je(lt,0,Pi,xt),lt[Pi+2]=1,lt.size=Math.abs(jt),lt.start=0,lt.end=lt.size}function Wt(Qe,lt,xt,St){for(var Ct=0;Ct<Qe.length;Ct++){var zt=[];Ut(Qe[Ct],zt,xt,St),lt.push(zt)}}function at(Qe){return Qe/360+.5}function Zt(Qe){var lt=Math.sin(Qe*Math.PI/180),xt=.5-.25*Math.log((1+lt)/(1-lt))/Math.PI;return xt<0?0:xt>1?1:xt}function Gt(Qe,lt,xt,St,Ct,zt,jt,Dt){if(St/=lt,zt>=(xt/=lt)&&jt<St)return Qe;if(jt<xt||zt>=St)return null;for(var ni=[],yt=0;yt<Qe.length;yt++){var Pi=Qe[yt],un=Pi.geometry,fi=Pi.type,on=Ct===0?Pi.minX:Pi.minY,Yn=Ct===0?Pi.maxX:Pi.maxY;if(on>=xt&&Yn<St)ni.push(Pi);else if(!(Yn<xt||on>=St)){var Zn=[];if(fi==="Point"||fi==="MultiPoint")qt(un,Zn,xt,St,Ct);else if(fi==="LineString")rn(un,Zn,xt,St,Ct,!1,Dt.lineMetrics);else if(fi==="MultiLineString")qn(un,Zn,xt,St,Ct,!1);else if(fi==="Polygon")qn(un,Zn,xt,St,Ct,!0);else if(fi==="MultiPolygon")for(var tr=0;tr<un.length;tr++){var Xr=[];qn(un[tr],Xr,xt,St,Ct,!0),Xr.length&&Zn.push(Xr)}if(Zn.length){if(Dt.lineMetrics&&fi==="LineString"){for(tr=0;tr<Zn.length;tr++)ni.push(fe(Pi.id,fi,Zn[tr],Pi.tags));continue}fi!=="LineString"&&fi!=="MultiLineString"||(Zn.length===1?(fi="LineString",Zn=Zn[0]):fi="MultiLineString"),fi!=="Point"&&fi!=="MultiPoint"||(fi=Zn.length===3?"Point":"MultiPoint"),ni.push(fe(Pi.id,fi,Zn,Pi.tags))}}}return ni.length?ni:null}function qt(Qe,lt,xt,St,Ct){for(var zt=0;zt<Qe.length;zt+=3){var jt=Qe[zt+Ct];jt>=xt&&jt<=St&&(lt.push(Qe[zt]),lt.push(Qe[zt+1]),lt.push(Qe[zt+2]))}}function rn(Qe,lt,xt,St,Ct,zt,jt){for(var Dt,ni,yt=Bi(Qe),Pi=Ct===0?Tn:We,un=Qe.start,fi=0;fi<Qe.length-3;fi+=3){var on=Qe[fi],Yn=Qe[fi+1],Zn=Qe[fi+2],tr=Qe[fi+3],Xr=Qe[fi+4],Io=Ct===0?on:Yn,ir=Ct===0?tr:Xr,Co=!1;jt&&(Dt=Math.sqrt(Math.pow(on-tr,2)+Math.pow(Yn-Xr,2))),Io<xt?ir>xt&&(ni=Pi(yt,on,Yn,tr,Xr,xt),jt&&(yt.start=un+Dt*ni)):Io>St?ir<St&&(ni=Pi(yt,on,Yn,tr,Xr,St),jt&&(yt.start=un+Dt*ni)):_n(yt,on,Yn,Zn),ir<xt&&Io>=xt&&(ni=Pi(yt,on,Yn,tr,Xr,xt),Co=!0),ir>St&&Io<=St&&(ni=Pi(yt,on,Yn,tr,Xr,St),Co=!0),!zt&&Co&&(jt&&(yt.end=un+Dt*ni),lt.push(yt),yt=Bi(Qe)),jt&&(un+=Dt)}var Yr=Qe.length-3;on=Qe[Yr],Yn=Qe[Yr+1],Zn=Qe[Yr+2],(Io=Ct===0?on:Yn)>=xt&&Io<=St&&_n(yt,on,Yn,Zn),Yr=yt.length-3,zt&&Yr>=3&&(yt[Yr]!==yt[0]||yt[Yr+1]!==yt[1])&&_n(yt,yt[0],yt[1],yt[2]),yt.length&&lt.push(yt)}function Bi(Qe){var lt=[];return lt.size=Qe.size,lt.start=Qe.start,lt.end=Qe.end,lt}function qn(Qe,lt,xt,St,Ct,zt){for(var jt=0;jt<Qe.length;jt++)rn(Qe[jt],lt,xt,St,Ct,zt,!1)}function _n(Qe,lt,xt,St){Qe.push(lt),Qe.push(xt),Qe.push(St)}function Tn(Qe,lt,xt,St,Ct,zt){var jt=(zt-lt)/(St-lt);return Qe.push(zt),Qe.push(xt+(Ct-xt)*jt),Qe.push(1),jt}function We(Qe,lt,xt,St,Ct,zt){var jt=(zt-xt)/(Ct-xt);return Qe.push(lt+(St-lt)*jt),Qe.push(zt),Qe.push(1),jt}function pi(Qe,lt){for(var xt=[],St=0;St<Qe.length;St++){var Ct,zt=Qe[St],jt=zt.type;if(jt==="Point"||jt==="MultiPoint"||jt==="LineString")Ct=Wi(zt.geometry,lt);else if(jt==="MultiLineString"||jt==="Polygon"){Ct=[];for(var Dt=0;Dt<zt.geometry.length;Dt++)Ct.push(Wi(zt.geometry[Dt],lt))}else if(jt==="MultiPolygon")for(Ct=[],Dt=0;Dt<zt.geometry.length;Dt++){for(var ni=[],yt=0;yt<zt.geometry[Dt].length;yt++)ni.push(Wi(zt.geometry[Dt][yt],lt));Ct.push(ni)}xt.push(fe(zt.id,jt,Ct,zt.tags))}return xt}function Wi(Qe,lt){var xt=[];xt.size=Qe.size,Qe.start!==void 0&&(xt.start=Qe.start,xt.end=Qe.end);for(var St=0;St<Qe.length;St+=3)xt.push(Qe[St]+lt,Qe[St+1],Qe[St+2]);return xt}function an(Qe,lt){if(Qe.transformed)return Qe;var xt,St,Ct,zt=1<<Qe.z,jt=Qe.x,Dt=Qe.y;for(xt=0;xt<Qe.features.length;xt++){var ni=Qe.features[xt],yt=ni.geometry,Pi=ni.type;if(ni.geometry=[],Pi===1)for(St=0;St<yt.length;St+=2)ni.geometry.push(Xn(yt[St],yt[St+1],lt,zt,jt,Dt));else for(St=0;St<yt.length;St++){var un=[];for(Ct=0;Ct<yt[St].length;Ct+=2)un.push(Xn(yt[St][Ct],yt[St][Ct+1],lt,zt,jt,Dt));ni.geometry.push(un)}}return Qe.transformed=!0,Qe}function Xn(Qe,lt,xt,St,Ct,zt){return[Math.round(xt*(Qe*St-Ct)),Math.round(xt*(lt*St-zt))]}function Zr(Qe,lt,xt,St,Ct){for(var zt=lt===Ct.maxZoom?0:Ct.tolerance/((1<<lt)*Ct.extent),jt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:xt,y:St,z:lt,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Dt=0;Dt<Qe.length;Dt++){jt.numFeatures++,Er(jt,Qe[Dt],zt,Ct);var ni=Qe[Dt].minX,yt=Qe[Dt].minY,Pi=Qe[Dt].maxX,un=Qe[Dt].maxY;ni<jt.minX&&(jt.minX=ni),yt<jt.minY&&(jt.minY=yt),Pi>jt.maxX&&(jt.maxX=Pi),un>jt.maxY&&(jt.maxY=un)}return jt}function Er(Qe,lt,xt,St){var Ct=lt.geometry,zt=lt.type,jt=[];if(zt==="Point"||zt==="MultiPoint")for(var Dt=0;Dt<Ct.length;Dt+=3)jt.push(Ct[Dt]),jt.push(Ct[Dt+1]),Qe.numPoints++,Qe.numSimplified++;else if(zt==="LineString")yo(jt,Ct,Qe,xt,!1,!1);else if(zt==="MultiLineString"||zt==="Polygon")for(Dt=0;Dt<Ct.length;Dt++)yo(jt,Ct[Dt],Qe,xt,zt==="Polygon",Dt===0);else if(zt==="MultiPolygon")for(var ni=0;ni<Ct.length;ni++){var yt=Ct[ni];for(Dt=0;Dt<yt.length;Dt++)yo(jt,yt[Dt],Qe,xt,!0,Dt===0)}if(jt.length){var Pi=lt.tags||null;if(zt==="LineString"&&St.lineMetrics){for(var un in Pi={},lt.tags)Pi[un]=lt.tags[un];Pi.mapbox_clip_start=Ct.start/Ct.size,Pi.mapbox_clip_end=Ct.end/Ct.size}var fi={geometry:jt,type:zt==="Polygon"||zt==="MultiPolygon"?3:zt==="LineString"||zt==="MultiLineString"?2:1,tags:Pi};lt.id!==null&&(fi.id=lt.id),Qe.features.push(fi)}}function yo(Qe,lt,xt,St,Ct,zt){var jt=St*St;if(St>0&&lt.size<(Ct?jt:St))xt.numPoints+=lt.length/3;else{for(var Dt=[],ni=0;ni<lt.length;ni+=3)(St===0||lt[ni+2]>jt)&&(xt.numSimplified++,Dt.push(lt[ni]),Dt.push(lt[ni+1])),xt.numPoints++;Ct&&function(yt,Pi){for(var un=0,fi=0,on=yt.length,Yn=on-2;fi<on;Yn=fi,fi+=2)un+=(yt[fi]-yt[Yn])*(yt[fi+1]+yt[Yn+1]);if(un>0===Pi)for(fi=0,on=yt.length;fi<on/2;fi+=2){var Zn=yt[fi],tr=yt[fi+1];yt[fi]=yt[on-2-fi],yt[fi+1]=yt[on-1-fi],yt[on-2-fi]=Zn,yt[on-1-fi]=tr}}(Dt,zt),Qe.push(Dt)}}function jr(Qe,lt){var xt=(lt=this.options=function(Ct,zt){for(var jt in zt)Ct[jt]=zt[jt];return Ct}(Object.create(this.options),lt)).debug;if(xt&&console.time("preprocess data"),lt.maxZoom<0||lt.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(lt.promoteId&&lt.generateId)throw new Error("promoteId and generateId cannot be used together.");var St=function(Ct,zt){var jt=[];if(Ct.type==="FeatureCollection")for(var Dt=0;Dt<Ct.features.length;Dt++)dt(jt,Ct.features[Dt],zt,Dt);else dt(jt,Ct.type==="Feature"?Ct:{geometry:Ct},zt);return jt}(Qe,lt);this.tiles={},this.tileCoords=[],xt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",lt.indexMaxZoom,lt.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(St=function(Ct,zt){var jt=zt.buffer/zt.extent,Dt=Ct,ni=Gt(Ct,1,-1-jt,jt,0,-1,2,zt),yt=Gt(Ct,1,1-jt,2+jt,0,-1,2,zt);return(ni||yt)&&(Dt=Gt(Ct,1,-jt,1+jt,0,-1,2,zt)||[],ni&&(Dt=pi(ni,1).concat(Dt)),yt&&(Dt=Dt.concat(pi(yt,-1)))),Dt}(St,lt)).length&&this.splitTile(St,0,0,0),xt&&(St.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ar(Qe,lt,xt){return 32*((1<<Qe)*xt+lt)+Qe}return jr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},jr.prototype.splitTile=function(Qe,lt,xt,St,Ct,zt,jt){for(var Dt=[Qe,lt,xt,St],ni=this.options,yt=ni.debug;Dt.length;){St=Dt.pop(),xt=Dt.pop(),lt=Dt.pop(),Qe=Dt.pop();var Pi=1<<lt,un=Ar(lt,xt,St),fi=this.tiles[un];if(!fi&&(yt>1&&console.time("creation"),fi=this.tiles[un]=Zr(Qe,lt,xt,St,ni),this.tileCoords.push({z:lt,x:xt,y:St}),yt)){yt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",lt,xt,St,fi.numFeatures,fi.numPoints,fi.numSimplified),console.timeEnd("creation"));var on="z"+lt;this.stats[on]=(this.stats[on]||0)+1,this.total++}if(fi.source=Qe,Ct){if(lt===ni.maxZoom||lt===Ct)continue;var Yn=1<<Ct-lt;if(xt!==Math.floor(zt/Yn)||St!==Math.floor(jt/Yn))continue}else if(lt===ni.indexMaxZoom||fi.numPoints<=ni.indexMaxPoints)continue;if(fi.source=null,Qe.length!==0){yt>1&&console.time("clipping");var Zn,tr,Xr,Io,ir,Co,Yr=.5*ni.buffer/ni.extent,vo=.5-Yr,ys=.5+Yr,$a=1+Yr;Zn=tr=Xr=Io=null,ir=Gt(Qe,Pi,xt-Yr,xt+ys,0,fi.minX,fi.maxX,ni),Co=Gt(Qe,Pi,xt+vo,xt+$a,0,fi.minX,fi.maxX,ni),Qe=null,ir&&(Zn=Gt(ir,Pi,St-Yr,St+ys,1,fi.minY,fi.maxY,ni),tr=Gt(ir,Pi,St+vo,St+$a,1,fi.minY,fi.maxY,ni),ir=null),Co&&(Xr=Gt(Co,Pi,St-Yr,St+ys,1,fi.minY,fi.maxY,ni),Io=Gt(Co,Pi,St+vo,St+$a,1,fi.minY,fi.maxY,ni),Co=null),yt>1&&console.timeEnd("clipping"),Dt.push(Zn||[],lt+1,2*xt,2*St),Dt.push(tr||[],lt+1,2*xt,2*St+1),Dt.push(Xr||[],lt+1,2*xt+1,2*St),Dt.push(Io||[],lt+1,2*xt+1,2*St+1)}}},jr.prototype.getTile=function(Qe,lt,xt){var St=this.options,Ct=St.extent,zt=St.debug;if(Qe<0||Qe>24)return null;var jt=1<<Qe,Dt=Ar(Qe,lt=(lt%jt+jt)%jt,xt);if(this.tiles[Dt])return an(this.tiles[Dt],Ct);zt>1&&console.log("drilling down to z%d-%d-%d",Qe,lt,xt);for(var ni,yt=Qe,Pi=lt,un=xt;!ni&&yt>0;)yt--,Pi=Math.floor(Pi/2),un=Math.floor(un/2),ni=this.tiles[Ar(yt,Pi,un)];return ni&&ni.source?(zt>1&&console.log("found parent tile z%d-%d-%d",yt,Pi,un),zt>1&&console.time("drilling down"),this.splitTile(ni.source,yt,Pi,un,Qe,lt,xt),zt>1&&console.timeEnd("drilling down"),this.tiles[Dt]?an(this.tiles[Dt],Ct):null):null},function(Qe,lt){return new jr(Qe,lt)}}();var wn=s.dc(Ze.exports);function Sr(je,re){const fe=je.tileID.canonical;if(!this._geoJSONIndex)return re(null,null);const Ee=this._geoJSONIndex.getTile(fe.z,fe.x,fe.y);if(!Ee)return re(null,null);const dt=new class{constructor(Ut){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.J,this.length=Ut.length,this._features=Ut}feature(Ut){return new class{constructor(Wt){this._feature=Wt,this.extent=s.J,this.type=Wt.type,this.properties=Wt.tags,"id"in Wt&&!isNaN(Wt.id)&&(this.id=parseInt(Wt.id,10))}loadGeometry(){if(this._feature.type===1){const Wt=[];for(const at of this._feature.geometry)Wt.push([new s.P(at[0],at[1])]);return Wt}{const Wt=[];for(const at of this._feature.geometry){const Zt=[];for(const Gt of at)Zt.push(new s.P(Gt[0],Gt[1]));Wt.push(Zt)}return Wt}}toGeoJSON(Wt,at,Zt){return J.call(this,Wt,at,Zt)}}(this._features[Ut])}}(Ee.features);let ft=Ti(dt);ft.byteOffset===0&&ft.byteLength===ft.buffer.byteLength||(ft=new Uint8Array(ft)),re(null,{vectorTile:dt,rawData:ft.buffer})}class Mr extends s.dh{constructor(re,fe,Ee,dt,ft,Ut){super(re,fe,Ee,dt,Sr,Ut),ft&&(this.loadGeoJSON=ft)}loadData(re,fe){const Ee=re&&re.request,dt=Ee&&Ee.collectResourceTiming;this.loadGeoJSON(re,(ft,Ut)=>{if(ft||!Ut)return fe(ft);if(typeof Ut!="object")return fe(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`));{W(Ut,!0);try{if(re.filter){const at=s.cw(re.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(at.result==="error")throw new Error(at.value.map(Gt=>`${Gt.key}: ${Gt.message}`).join(", "));Ut={type:"FeatureCollection",features:Ut.features.filter(Gt=>at.value.evaluate({zoom:0},Gt))}}this._geoJSONIndex=re.cluster?new rt(function({superclusterOptions:at,clusterProperties:Zt}){if(!Zt||!at)return at;const Gt={},qt={},rn={accumulated:null,zoom:0},Bi={properties:null},qn=Object.keys(Zt);for(const _n of qn){const[Tn,We]=Zt[_n],pi=s.cw(We),Wi=s.cw(typeof Tn=="string"?[Tn,["accumulated"],["get",_n]]:Tn);Gt[_n]=pi.value,qt[_n]=Wi.value}return at.map=_n=>{Bi.properties=_n;const Tn={};for(const We of qn)Tn[We]=Gt[We].evaluate(rn,Bi);return Tn},at.reduce=(_n,Tn)=>{Bi.properties=Tn;for(const We of qn)rn.accumulated=_n[We],_n[We]=qt[We].evaluate(rn,Bi)},at}(re)).load(Ut.features):wn(Ut,re.geojsonVtOptions)}catch(at){return fe(at)}this.loaded={};const Wt={};if(dt){const at=s.di(Ee);at&&(Wt.resourceTiming={},Wt.resourceTiming[re.source]=JSON.parse(JSON.stringify(at)))}fe(null,Wt)}})}reloadTile(re,fe){const Ee=this.loaded;return Ee&&Ee[re.uid]?super.reloadTile(re,fe):this.loadTile(re,fe)}loadGeoJSON(re,fe){if(re.request)s.a1(re.request,fe);else{if(typeof re.data!="string")return fe(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`));try{return fe(null,JSON.parse(re.data))}catch{return fe(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(re,fe){try{fe(null,this._geoJSONIndex.getClusterExpansionZoom(re.clusterId))}catch(Ee){fe(Ee)}}getClusterChildren(re,fe){try{fe(null,this._geoJSONIndex.getChildren(re.clusterId))}catch(Ee){fe(Ee)}}getClusterLeaves(re,fe){try{fe(null,this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset))}catch(Ee){fe(Ee)}}}class cn{constructor(re,fe){this.tileID=new s.O(re.tileID.overscaledZ,re.tileID.wrap,re.tileID.canonical.z,re.tileID.canonical.x,re.tileID.canonical.y),this.tileZoom=re.tileZoom,this.uid=re.uid,this.zoom=re.zoom,this.canonical=re.tileID.canonical,this.pixelRatio=re.pixelRatio,this.tileSize=re.tileSize,this.source=re.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=re.projection,this.brightness=fe}parse(re,fe,Ee,dt){this.status="parsing";const ft=new s.O(Ee.tileID.overscaledZ,Ee.tileID.wrap,Ee.tileID.canonical.z,Ee.tileID.canonical.x,Ee.tileID.canonical.y),Ut={},Wt=fe.familiesBySource[Ee.source],at=new s.dk(ft,Ee.promoteId);return at.bucketLayerIDs=[],s.dl(re).then(Zt=>{if(!Zt)return dt(new Error("Could not parse tile"));const Gt=s.dm(Zt,1/s.cg(Ee.tileID.canonical)),qt=Zt.json.extensionsUsed&&Zt.json.extensionsUsed.includes("MAPBOX_mesh_features"),rn=new s.al(this.zoom,{brightness:this.brightness});for(const Bi in Wt)for(const qn of Wt[Bi]){const _n=qn[0],Tn=Zt.json.extensionsUsed;_n.recalculate(rn,[]);const We=new s.dn(Gt,ft,Tn&&Tn.includes("MAPBOX_mesh_features"),this.brightness);qt||(We.needsUpload=!0),Ut[_n.fqid]=We,We.evaluate(_n)}this.status="done",dt(null,{buckets:Ut,featureIndex:at})}).catch(Zt=>dt(new Error(Zt.message)))}}class Bt{constructor(re,fe,Ee,dt,ft,Ut){this.actor=re,this.layerIndex=fe,this.brightness=Ut,this.loading={},this.loaded={}}loadTile(re,fe){const Ee=re.uid,dt=this.loading[Ee]=new cn(re,this.brightness);s.dj(re.request,(ft,Ut)=>{const Wt=!this.loading[Ee];return delete this.loading[Ee],Wt||ft?(dt.status="done",Wt||(this.loaded[Ee]=dt),fe(ft)):Ut&&Ut.byteLength!==0?void dt.parse(Ut,this.layerIndex,re,(at,Zt)=>{dt.status="done",this.loaded=this.loaded||{},this.loaded[Ee]=dt,at||!Zt?fe(at):fe(null,Zt)}):(dt.status="done",this.loaded[Ee]=dt,fe())})}reloadTile(re,fe){const Ee=this.loaded,dt=re.uid;if(Ee&&Ee[dt]){const ft=Ee[dt];ft.projection=re.projection,ft.brightness=re.brightness;const Ut=(Wt,at)=>{ft.reloadCallback&&(delete ft.reloadCallback,this.loadTile(re,fe)),fe(Wt,at)};ft.status==="parsing"?ft.reloadCallback=Ut:ft.status==="done"&&this.loadTile(re,fe)}}abortTile(re,fe){const Ee=re.uid;this.loading[Ee]&&delete this.loading[Ee],fe()}removeTile(re,fe){const Ee=this.loaded,dt=re.uid;Ee&&Ee[dt]&&delete Ee[dt],fe()}}class si{constructor(re){this.self=re,this.actor=new s.dp(re,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.o({name:"mercator"}),this.workerSourceTypes={vector:s.dh,geojson:Mr,"batched-model":Bt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(fe,Ee)=>{if(this.workerSourceTypes[fe])throw new Error(`Worker source with name "${fe}" already registered.`);this.workerSourceTypes[fe]=Ee},this.self.registerRTLTextPlugin=fe=>{if(s.dq.isParsed())throw new Error("RTL text plugin already registered.");s.dq.applyArabicShaping=fe.applyArabicShaping,s.dq.processBidirectionalText=fe.processBidirectionalText,s.dq.processStyledBidirectionalText=fe.processStyledBidirectionalText}}clearCaches(re,fe,Ee){delete this.layerIndexes[re],delete this.availableImages[re],delete this.workerSources[re],delete this.demWorkerSources[re],Ee()}checkIfReady(re,fe,Ee){Ee()}setReferrer(re,fe){this.referrer=fe}spriteLoaded(re,{scope:fe,isLoaded:Ee}){if(this.isSpriteLoaded[re]||(this.isSpriteLoaded[re]={}),this.isSpriteLoaded[re][fe]=Ee,this.workerSources[re]&&this.workerSources[re][fe])for(const dt in this.workerSources[re][fe]){const ft=this.workerSources[re][fe][dt];for(const Ut in ft)ft[Ut]instanceof s.dh&&(ft[Ut].isSpriteLoaded=Ee,ft[Ut].fire(new s.a8("isSpriteLoaded")))}}setImages(re,{scope:fe,images:Ee},dt){if(this.availableImages[re]||(this.availableImages[re]={}),this.availableImages[re][fe]=Ee,this.workerSources[re]&&this.workerSources[re][fe]){for(const ft in this.workerSources[re][fe]){const Ut=this.workerSources[re][fe][ft];for(const Wt in Ut)Ut[Wt].availableImages=Ee}dt()}else dt()}setProjection(re,fe){this.projections[re]=s.o(fe)}setBrightness(re,fe,Ee){this.brightness=fe,Ee()}setLayers(re,fe,Ee){this.getLayerIndex(re,fe.scope).replace(fe.layers,fe.options),Ee()}updateLayers(re,fe,Ee){this.getLayerIndex(re,fe.scope).update(fe.layers,fe.removedIds,fe.options),Ee()}loadTile(re,fe,Ee){fe.projection=this.projections[re]||this.defaultProjection,this.getWorkerSource(re,fe.type,fe.source,fe.scope).loadTile(fe,Ee)}loadDEMTile(re,fe,Ee){this.getDEMWorkerSource(re,fe.source,fe.scope).loadTile(fe,Ee)}reloadTile(re,fe,Ee){fe.projection=this.projections[re]||this.defaultProjection,this.getWorkerSource(re,fe.type,fe.source,fe.scope).reloadTile(fe,Ee)}abortTile(re,fe,Ee){this.getWorkerSource(re,fe.type,fe.source,fe.scope).abortTile(fe,Ee)}removeTile(re,fe,Ee){this.getWorkerSource(re,fe.type,fe.source,fe.scope).removeTile(fe,Ee)}removeSource(re,fe,Ee){if(!(this.workerSources[re]&&this.workerSources[re][fe.scope]&&this.workerSources[re][fe.scope][fe.type]&&this.workerSources[re][fe.scope][fe.type][fe.source]))return;const dt=this.workerSources[re][fe.scope][fe.type][fe.source];delete this.workerSources[re][fe.scope][fe.type][fe.source],dt.removeSource!==void 0?dt.removeSource(fe,Ee):Ee()}loadWorkerSource(re,fe,Ee){try{this.self.importScripts(fe.url),Ee()}catch(dt){Ee(dt.toString())}}syncRTLPluginState(re,fe,Ee){try{s.dq.setState(fe);const dt=s.dq.getPluginURL();if(s.dq.isLoaded()&&!s.dq.isParsed()&&dt!=null){this.self.importScripts(dt);const ft=s.dq.isParsed();Ee(ft?void 0:new Error(`RTL Text Plugin failed to import scripts from ${dt}`),ft)}}catch(dt){Ee(dt.toString())}}setDracoUrl(re,fe){this.dracoUrl=fe}getAvailableImages(re,fe){this.availableImages[re]||(this.availableImages[re]={});let Ee=this.availableImages[re][fe];return Ee||(Ee=[]),Ee}getLayerIndex(re,fe){this.layerIndexes[re]||(this.layerIndexes[re]={});let Ee=this.layerIndexes[re][fe];return Ee||(Ee=this.layerIndexes[re][fe]=new D,Ee.scope=fe),Ee}getWorkerSource(re,fe,Ee,dt){if(this.workerSources[re]||(this.workerSources[re]={}),this.workerSources[re][dt]||(this.workerSources[re][dt]={}),this.workerSources[re][dt][fe]||(this.workerSources[re][dt][fe]={}),this.isSpriteLoaded[re]||(this.isSpriteLoaded[re]={}),!this.workerSources[re][dt][fe][Ee]){const ft={send:(Ut,Wt,at,Zt,Gt,qt)=>{this.actor.send(Ut,Wt,at,re,Gt,qt)},scheduler:this.actor.scheduler};this.workerSources[re][dt][fe][Ee]=new this.workerSourceTypes[fe](ft,this.getLayerIndex(re,dt),this.getAvailableImages(re,dt),this.isSpriteLoaded[re][dt],void 0,this.brightness)}return this.workerSources[re][dt][fe][Ee]}getDEMWorkerSource(re,fe,Ee){return this.demWorkerSources[re]||(this.demWorkerSources[re]={}),this.demWorkerSources[re][Ee]||(this.demWorkerSources[re][Ee]={}),this.demWorkerSources[re][Ee][fe]||(this.demWorkerSources[re][Ee][fe]=new F),this.demWorkerSources[re][Ee][fe]}enforceCacheSizeLimit(re,fe){s.dr(fe)}getWorkerPerformanceMetrics(re,fe,Ee){Ee(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new si(self)),si}),g(["./shared"],function(s){function M(_,l){if(Array.isArray(_)){if(!Array.isArray(l)||_.length!==l.length)return!1;for(let f=0;f<_.length;f++)if(!M(_[f],l[f]))return!1;return!0}if(typeof _=="object"&&_!==null&&l!==null){if(typeof l!="object"||Object.keys(_).length!==Object.keys(l).length)return!1;for(const f in _)if(!M(_[f],l[f]))return!1;return!0}return _===l}var C=D;function D(_){return!function(l){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,w,S=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(S);try{w=new Worker(A),v=!0}catch{v=!1}return w&&w.terminate(),URL.revokeObjectURL(A),v}()?function(){var v=document.createElement("canvas");v.width=v.height=1;var w=v.getContext("2d");if(!w)return!1;var S=w.getImageData(0,0,1,1);return S&&S.width===v.width}()?(F[f=l&&l.failIfMajorPerformanceCaveat]===void 0&&(F[f]=function(v){var w,S=function(A){var P=document.createElement("canvas"),R=Object.create(D.webGLContextAttributes);return R.failIfMajorPerformanceCaveat=A,P.getContext("webgl2",R)}(v);if(!S)return!1;try{w=S.createShader(S.VERTEX_SHADER)}catch{return!1}return!(!w||S.isContextLost())&&(S.shaderSource(w,"void main() {}"),S.compileShader(w),S.getShaderParameter(w,S.COMPILE_STATUS)===!0)}(f)),F[f]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var f}(_)}var F={};function V(_,l,f){const v=document.createElement(_);return l!=null&&(v.className=l),f&&f.appendChild(v),v}function X(_,l,f){const v=document.createElementNS("http://www.w3.org/2000/svg",_);for(const w of Object.keys(l))v.setAttributeNS(null,w,String(l[w]));return f&&f.appendChild(v),v}D.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const W=typeof document<"u"?document.documentElement&&document.documentElement.style:null,J=W&&W.userSelect!==void 0?"userSelect":"WebkitUserSelect";let $;function ne(){W&&J&&($=W[J],W[J]="none")}function ye(){W&&J&&(W[J]=$)}function pe(_){_.preventDefault(),_.stopPropagation(),window.removeEventListener("click",pe,!0)}function ke(){window.addEventListener("click",pe,!0),window.setTimeout(()=>{window.removeEventListener("click",pe,!0)},0)}function Ae(_,l){const f=_.getBoundingClientRect();return kt(_,f,l)}function tt(_,l){const f=_.getBoundingClientRect(),v=[];for(let w=0;w<l.length;w++)v.push(kt(_,f,l[w]));return v}function pt(_){return window.InstallTrigger!==void 0&&_.button===2&&_.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:_.button}function kt(_,l,f){const v=_.offsetWidth===l.width?1:_.offsetWidth/l.width;return new s.P((f.clientX-l.left)*v,(f.clientY-l.top)*v)}class Ie{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(l,f){this._updatedSourceCaches[l]=f,this.setDirty()}discardSourceCacheUpdate(l){delete this._updatedSourceCaches[l]}updateLayer(l){const f=l.scope;this._updatedLayers[f]=this._updatedLayers[f]||new Set,this._updatedLayers[f].add(l.id),this.setDirty()}removeLayer(l){const f=l.scope;this._removedLayers[f]=this._removedLayers[f]||{},this._updatedLayers[f]=this._updatedLayers[f]||new Set,this._removedLayers[f][l.id]=l,this._updatedLayers[f].delete(l.id),this._updatedPaintProps.delete(l.fqid),this.setDirty()}getRemovedLayer(l){return this._removedLayers[l.scope]?this._removedLayers[l.scope][l.id]:null}discardLayerRemoval(l){this._removedLayers[l.scope]&&delete this._removedLayers[l.scope][l.id]}getLayerUpdatesByScope(){const l={};for(const f in this._updatedLayers)l[f]=l[f]||{},l[f].updatedIds=Array.from(this._updatedLayers[f].values());for(const f in this._removedLayers)l[f]=l[f]||{},l[f].removedIds=Object.keys(this._removedLayers[f]);return l}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(l){this._updatedPaintProps.add(l.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(l){this._updatedImages.add(l),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const Et={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class mt{constructor(l,f,v,w,S,A){this.length=f.length,this.attributes=v,this.itemSize=f.bytesPerElement,this.dynamicDraw=w,this.instanceCount=A,this.context=l;const P=l.gl;this.buffer=P.createBuffer(),l.bindVertexBuffer.set(this.buffer),P.bufferData(P.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?P.DYNAMIC_DRAW:P.STATIC_DRAW),this.dynamicDraw||S||f.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,f){for(let v=0;v<this.attributes.length;v++){const w=f.attributes[this.attributes[v].name];w!==void 0&&l.enableVertexAttribArray(w)}}setVertexAttribPointers(l,f,v){for(let w=0;w<this.attributes.length;w++){const S=this.attributes[w],A=f.attributes[S.name];A!==void 0&&l.vertexAttribPointer(A,S.components,l[Et[S.type]],!1,this.itemSize,S.offset+this.itemSize*(v||0))}}setVertexAttribDivisor(l,f,v){for(let w=0;w<this.attributes.length;w++){const S=f.attributes[this.attributes[w].name];S!==void 0&&this.instanceCount&&this.instanceCount>0&&l.vertexAttribDivisor(S,v)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Xe{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Tt extends Xe{getDefault(){return s.C.transparent}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Yt extends Xe{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class mi extends Xe{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class Ti extends Xe{getDefault(){return[!0,!0,!0,!0]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Zi extends Xe{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class wt extends Xe{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class Ii extends Xe{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const f=this.current;(l.func!==f.func||l.ref!==f.ref||l.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class Ui extends Xe{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class Mi extends Xe{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=l,this.dirty=!1}}class st extends Xe{getDefault(){return[0,1]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class rt extends Xe{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=l,this.dirty=!1}}class zi extends Xe{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Si extends Xe{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.BLEND):f.disable(f.BLEND),this.current=l,this.dirty=!1}}class bn extends Xe{getDefault(){const l=this.gl;return[l.ONE,l.ZERO,l.ONE,l.ZERO]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.blendFuncSeparate(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class nn extends Xe{getDefault(){return s.C.transparent}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class hn extends Xe{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(l,l),this.current=l,this.dirty=!1)}}class Ze extends Xe{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=l,this.dirty=!1}}class wn extends Xe{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Sr extends Xe{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}let Mr=class extends Xe{getDefault(){return null}set(_){(_!==this.current||this.dirty)&&(this.gl.useProgram(_),this.current=_,this.dirty=!1)}};class cn extends Xe{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class Bt extends Xe{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class si extends Xe{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class je extends Xe{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class re extends Xe{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class fe extends Xe{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Ee extends Xe{getDefault(){return null}set(l){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class dt extends Xe{getDefault(){return null}set(l){this.gl&&(l!==this.current||this.dirty)&&(this.gl.bindVertexArray(l),this.current=l,this.dirty=!1)}}class ft extends Xe{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Ut extends Xe{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Wt extends Xe{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class at extends Xe{constructor(l,f){super(l),this.context=l,this.parent=f}getDefault(){return null}}class Zt extends at{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Gt extends at{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,this.attachment(),f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class qt extends at{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,this.attachment(),f.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class rn extends Gt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Bi{constructor(l,f,v,w,S){this.context=l,this.width=f,this.height=v;const A=this.framebuffer=l.gl.createFramebuffer();w&&(this.colorAttachment=new Zt(l,A)),S&&(this.depthAttachmentType=S,this.depthAttachment=S==="renderbuffer"?new Gt(l,A):new qt(l,A))}destroy(){const l=this.context.gl;if(this.colorAttachment){const f=this.colorAttachment.get();f&&l.deleteTexture(f)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const f=this.depthAttachment.get();f&&l.deleteRenderbuffer(f)}else{const f=this.depthAttachment.get();f&&l.deleteTexture(f)}l.deleteFramebuffer(this.framebuffer)}}class qn{constructor(l,f){this.gl=l,this.clearColor=new Tt(this),this.clearDepth=new Yt(this),this.clearStencil=new mi(this),this.colorMask=new Ti(this),this.depthMask=new Zi(this),this.stencilMask=new wt(this),this.stencilFunc=new Ii(this),this.stencilOp=new Ui(this),this.stencilTest=new Mi(this),this.depthRange=new st(this),this.depthTest=new rt(this),this.depthFunc=new zi(this),this.blend=new Si(this),this.blendFunc=new bn(this),this.blendColor=new nn(this),this.blendEquation=new hn(this),this.cullFace=new Ze(this),this.cullFaceSide=new wn(this),this.frontFace=new Sr(this),this.program=new Mr(this),this.activeTexture=new cn(this),this.viewport=new Bt(this),this.bindFramebuffer=new si(this),this.bindRenderbuffer=new je(this),this.bindTexture=new re(this),this.bindVertexBuffer=new fe(this),this.bindElementBuffer=new Ee(this),this.bindVertexArrayOES=new dt(this),this.pixelStoreUnpack=new ft(this),this.pixelStoreUnpackPremultiplyAlpha=new Ut(this),this.pixelStoreUnpackFlipY=new Wt(this),this.options=f?{...f}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=l.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,f,v){return new s.I(this,l,f,v)}createVertexBuffer(l,f,v,w,S){return new mt(this,l,f,v,w,S)}createRenderbuffer(l,f,v){const w=this.gl,S=w.createRenderbuffer();return this.bindRenderbuffer.set(S),w.renderbufferStorage(w.RENDERBUFFER,l,f,v),this.bindRenderbuffer.set(null),S}createFramebuffer(l,f,v,w){return new Bi(this,l,f,v,w)}clear({color:l,depth:f,stencil:v,colorMask:w}){const S=this.gl;let A=0;l&&(A|=S.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set(w||[!0,!0,!0,!0])),f!==void 0&&(A|=S.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),v!==void 0&&(A|=S.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),S.clear(A)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){M(l.blendFunction,s.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor),l.blendEquation?this.blendEquation.set(l.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(l.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class _n{constructor(l=0,f=0,v=0,w=0){if(isNaN(l)||l<0||isNaN(f)||f<0||isNaN(v)||v<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=v,this.right=w}interpolate(l,f,v){return f.top!=null&&l.top!=null&&(this.top=s.n(l.top,f.top,v)),f.bottom!=null&&l.bottom!=null&&(this.bottom=s.n(l.bottom,f.bottom,v)),f.left!=null&&l.left!=null&&(this.left=s.n(l.left,f.left,v)),f.right!=null&&l.right!=null&&(this.right=s.n(l.right,f.right,v)),this}getCenter(l,f){const v=s.c((this.left+l-this.right)/2,0,l),w=s.c((this.top+f-this.bottom)/2,0,f);return new s.P(v,w)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new _n(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Tn(_,l){const f=s.g(_,3);s.m.fromQuat(_,l),s.s(_,3,f)}function We(_,l){const f=s.q.identity([]);return s.q.rotateZ(f,f,-l),s.q.rotateX(f,f,-_),f}function pi(_,l){const f=[_[0],_[1],0],v=[l[0],l[1],0];if(s.v.length(f)>=1e-15){const A=s.v.normalize([],f);s.v.scale(v,A,s.v.dot(v,A)),l[0]=v[0],l[1]=v[1]}const w=s.v.cross([],l,_);if(s.v.len(w)<1e-15)return null;const S=Math.atan2(-w[1],w[0]);return We(Math.atan2(Math.sqrt(_[0]*_[0]+_[1]*_[1]),-_[2]),S)}class Wi{constructor(l,f){this.position=l,this.orientation=f}get position(){return this._position}set position(l){if(l){const f=l instanceof s.M?l:new s.M(l[0],l[1],l[2]);this._renderWorldCopies&&(f.x=s.w(f.x,0,1)),this._position=f}else this._position=null}lookAtPoint(l,f){if(this.orientation=null,!this.position)return;const v=this.position,w=this._elevation?this._elevation.getAtPointOrZero(s.M.fromLngLat(l)):0,S=s.M.fromLngLat(l,w),A=[S.x-v.x,S.y-v.y,S.z-v.z];f||(f=[0,0,1]),f[2]=Math.abs(f[2]),this.orientation=pi(A,f)}setPitchBearing(l,f){this.orientation=We(s.d(l),s.d(-f))}}class an{constructor(l,f){this._transform=s.m.identity([]),this.orientation=f,this.position=l}get mercatorPosition(){const l=this.position;return new s.M(l[0],l[1],l[2])}get position(){const l=s.g(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var f;l&&s.s(this._transform,3,[(f=l)[0],f[1],f[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||s.q.identity([]),l&&Tn(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),f=this.right();return{bearing:Math.atan2(-f[1],f[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,f){this._orientation=We(l,f),Tn(this._transform,this._orientation)}forward(){const l=s.g(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=s.g(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=s.g(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,f){const v=new Float64Array(16);return s.m.invert(v,this.getWorldToCamera(l,f)),v}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(l,f,v){const w=this.position;s.v.scale(w,w,-l);const S=new Float64Array(16);return s.m.fromScaling(S,[v,v,v]),s.m.translate(S,S,w),S[10]*=f,S}getWorldToCamera(l,f){const v=new Float64Array(16),w=new Float64Array(4),S=this.position;return s.q.conjugate(w,this._orientation),s.v.scale(S,S,-l),s.m.fromQuat(v,w),s.m.translate(v,v,S),v[1]*=-1,v[5]*=-1,v[9]*=-1,v[13]*=-1,v[8]*=f,v[9]*=f,v[10]*=f,v[11]*=f,v}getCameraToClipPerspective(l,f,v,w){const S=new Float64Array(16);return s.m.perspective(S,l,f,v,w),S}getCameraToClipOrthographic(l,f,v,w,S,A){const P=new Float64Array(16);return s.m.ortho(P,l,f,v,w,S,A),P}getDistanceToElevation(l,f=!1){const v=l===0?0:s.b(l,f?s.l(this.position[1]):this.position[1]),w=this.forward();return(v-this.position[2])/w[2]}clone(){return new an([...this.position],[...this.orientation])}}const Xn={unknown:0,flipRequired:1,flipNotRequired:2},Zr=Math.tan(85*Math.PI/180);function Er(_,l,f,v,w,S,A){const P=s.m.create();if(f)if(S.name==="globe"){const R=s.f(w,l);s.m.multiply(P,P,R)}else{const R=s.h.invert([],A);P[0]=R[0],P[1]=R[1],P[4]=R[2],P[5]=R[3],v||s.m.rotateZ(P,P,w.angle)}else s.m.multiply(P,w.labelPlaneMatrix,_);return P}function yo(_,l,f,v,w,S,A){const P=Er(_,l,f,v,w,S,A);return S.name==="globe"&&f||(P[2]=P[6]=P[10]=P[14]=0),P}function jr(_,l,f,v,w,S,A){if(f){if(S.name==="globe"){const P=Er(_,l,f,v,w,S,A);return s.m.invert(P,P),s.m.multiply(P,_,P),P}{const P=s.m.clone(_),R=s.m.identity([]);return R[0]=A[0],R[1]=A[1],R[4]=A[2],R[5]=A[3],s.m.multiply(P,P,R),v||s.m.rotateZ(P,P,-w.angle),P}}return w.glCoordMatrix}function Ar(_,l,f,v){const w=[_,l,f,1];f?s.e.transformMat4(w,w,v):Pi(w,w,v);const S=w[3];return w[0]/=S,w[1]/=S,w[2]/=S,w}function Qe(_,l){return Math.min(.5+_/l*.5,1.5)}function lt(_,l){const f=_[0]/_[3],v=_[1]/_[3];return f>=-l[0]&&f<=l[0]&&v>=-l[1]&&v<=l[1]}function xt(_,l,f,v,w,S,A,P,R,B){const U=f.transform,H=v?_.textSizeData:_.iconSizeData,Z=s.i(H,f.transform.zoom),Y=U.projection.name==="globe",Q=[256/f.width*2+1,256/f.height*2+1],te=v?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;te.clear();let ee=null;Y&&(ee=v?_.text.globeExtVertexArray:_.icon.globeExtVertexArray);const K=_.lineVertexArray,ce=v?_.text.placedSymbolArray:_.icon.placedSymbolArray,ge=f.transform.width/f.transform.height;let _e,se=!1;for(let ue=0;ue<ce.length;ue++){const ve=ce.get(ue),{numGlyphs:Me,writingMode:be}=ve;if(be!==s.W.vertical||se||_e===s.W.horizontal||(se=!0),_e=be,(ve.hidden||be===s.W.vertical)&&!se){yt(Me,te);continue}se=!1;const Ce=new s.P(ve.tileAnchorX,ve.tileAnchorY);let{x:$e,y:Ne,z:qe}=U.projection.projectTilePoint(Ce.x,Ce.y,B.canonical);if(R){const[Ht,hi,Jt]=R(Ce);$e+=Ht,Ne+=hi,qe+=Jt}const Le=[$e,Ne,qe,1];if(s.e.transformMat4(Le,Le,l),!lt(Le,Q)){yt(Me,te);continue}const Ke=Le[3],He=Qe(f.transform.getCameraToCenterDistance(U.projection),Ke),nt=s.j(H,Z,ve),de=A?nt/He:nt*He,ze=Ar($e,Ne,qe,w);if(ze[3]<=0){yt(Me,te);continue}let _t={};const ut=A?null:R,ti=zt(ve,de,!1,P,l,w,S,_.glyphOffsetArray,K,te,ee,ze,Ce,_t,ge,ut,U.projection,B,A);se=ti.useVertical,ut&&ti.needsFlipping&&(_t={}),(ti.notEnoughRoom||se||ti.needsFlipping&&zt(ve,de,!0,P,l,w,S,_.glyphOffsetArray,K,te,ee,ze,Ce,_t,ge,ut,U.projection,B,A).notEnoughRoom)&&yt(Me,te)}v?(_.text.dynamicLayoutVertexBuffer.updateData(te),ee&&_.text.globeExtVertexBuffer&&_.text.globeExtVertexBuffer.updateData(ee)):(_.icon.dynamicLayoutVertexBuffer.updateData(te),ee&&_.icon.globeExtVertexBuffer&&_.icon.globeExtVertexBuffer.updateData(ee))}function St(_,l,f,v,w,S,A,P,R,B,U,H,Z,Y,Q,te){const{lineStartIndex:ee,glyphStartIndex:K,segment:ce}=P,ge=K+P.numGlyphs,_e=ee+P.lineLength,se=l.getoffsetX(K),ue=l.getoffsetX(ge-1),ve=ni(_*se,f,v,w,S,A,ce,ee,_e,R,B,U,H,Z,!0,Y,Q,te);if(!ve)return null;const Me=ni(_*ue,f,v,w,S,A,ce,ee,_e,R,B,U,H,Z,!0,Y,Q,te);return Me?{first:ve,last:Me}:null}function Ct(_,l,f,v){return _===s.W.horizontal&&Math.abs(v)>Math.abs(f)?{useVertical:!0}:_===s.W.vertical?v>0?{needsFlipping:!0}:null:l!==Xn.unknown&&function(w,S){return w===0||Math.abs(S/w)>Zr}(f,v)?l===Xn.flipRequired?{needsFlipping:!0}:null:f<0?{needsFlipping:!0}:null}function zt(_,l,f,v,w,S,A,P,R,B,U,H,Z,Y,Q,te,ee,K,ce){const ge=l/24,_e=_.lineOffsetX*ge,se=_.lineOffsetY*ge,{lineStartIndex:ue,glyphStartIndex:ve,numGlyphs:Me,segment:be,writingMode:Ce,flipState:$e}=_,Ne=ue+_.lineLength,qe=Le=>{if(U){const[de,ze,_t]=Le.up,ut=B.length;s.u(U,ut+0,de,ze,_t),s.u(U,ut+1,de,ze,_t),s.u(U,ut+2,de,ze,_t),s.u(U,ut+3,de,ze,_t)}const[Ke,He,nt]=Le.point;s.k(B,Ke,He,nt,Le.angle)};if(Me>1){const Le=St(ge,P,_e,se,f,H,Z,_,R,S,Y,te,!1,ee,K,ce);if(!Le)return{notEnoughRoom:!0};if(v&&!f){let[Ke,He,nt]=Le.first.point,[de,ze,_t]=Le.last.point;[Ke,He]=Ar(Ke,He,nt,A),[de,ze]=Ar(de,ze,_t,A);const ut=Ct(Ce,$e,(de-Ke)*Q,ze-He);if(_.flipState=ut&&ut.needsFlipping?Xn.flipRequired:Xn.flipNotRequired,ut)return ut}qe(Le.first);for(let Ke=ve+1;Ke<ve+Me-1;Ke++){const He=ni(ge*P.getoffsetX(Ke),_e,se,f,H,Z,be,ue,Ne,R,S,Y,te,!1,!1,ee,K,ce);if(!He)return B.length-=4*(Ke-ve),{notEnoughRoom:!0};qe(He)}qe(Le.last)}else{if(v&&!f){const Ke=Ar(Z.x,Z.y,0,w),He=ue+be+1,nt=new s.P(R.getx(He),R.gety(He)),de=Ar(nt.x,nt.y,0,w),ze=de[3]>0?de:Dt(Z,nt,Ke,1,w,void 0,ee,K.canonical),_t=Ct(Ce,$e,(ze[0]-Ke[0])*Q,ze[1]-Ke[1]);if(_.flipState=_t&&_t.needsFlipping?Xn.flipRequired:Xn.flipNotRequired,_t)return _t}const Le=ni(ge*P.getoffsetX(ve),_e,se,f,H,Z,be,ue,Ne,R,S,Y,te,!1,!1,ee,K,ce);if(!Le)return{notEnoughRoom:!0};qe(Le)}return{}}function jt(_,l,f,v,w){const{x:S,y:A,z:P}=v.projectTilePoint(_.x,_.y,l);if(!w)return Ar(S,A,P,f);const[R,B,U]=w(_);return Ar(S+R,A+B,P+U,f)}function Dt(_,l,f,v,w,S,A,P){const R=jt(_.sub(l)._unit()._add(_),P,w,A,S);return s.v.sub(R,f,R),s.v.normalize(R,R),s.v.scaleAndAdd(R,f,R,v)}function ni(_,l,f,v,w,S,A,P,R,B,U,H,Z,Y,Q,te,ee,K){const ce=v?_-l:_+l;let ge=ce>0?1:-1,_e=0;v&&(ge*=-1,_e=Math.PI),ge<0&&(_e+=Math.PI);let se=P+A+(ge>0?0:1)|0,ue=w,ve=w,Me=0,be=0;const Ce=Math.abs(ce),$e=[],Ne=[];let qe=S,Le=qe;const Ke=()=>Dt(Le,qe,ve,Ce-Me+1,U,Z,te,ee.canonical);for(;Me+be<=Ce;){if(se+=ge,se<P||se>=R)return null;if(ve=ue,Le=qe,$e.push(ve),Y&&Ne.push(Le),qe=new s.P(B.getx(se),B.gety(se)),ue=H[se],!ue){const hi=jt(qe,ee.canonical,U,te,Z);ue=hi[3]>0?H[se]=hi:Ke()}Me+=be,be=s.v.distance(ve,ue)}Q&&Z&&(H[se]&&(ue=Ke(),be=s.v.distance(ve,ue)),H[se]=ue);const He=(Ce-Me)/be,nt=qe.sub(Le)._mult(He)._add(Le),de=s.v.sub([],ue,ve),ze=s.v.scaleAndAdd([],ve,de,He);let _t=[0,0,1],ut=de[0],ti=de[1];if(K&&(_t=te.upVector(ee.canonical,nt.x,nt.y),_t[0]!==0||_t[1]!==0||_t[2]!==1)){const hi=[_t[2],0,-_t[0]],Jt=s.v.cross([],_t,hi);s.v.normalize(hi,hi),s.v.normalize(Jt,Jt),ut=s.v.dot(de,hi),ti=s.v.dot(de,Jt)}if(f){const hi=s.v.cross([],_t,de);s.v.normalize(hi,hi),s.v.scaleAndAdd(ze,ze,hi,f*ge)}const Ht=_e+Math.atan2(ti,ut);return $e.push(ze),Y&&Ne.push(nt),{point:ze,angle:Ht,path:$e,tilePath:Ne,up:_t}}function yt(_,l){const f=l.length,v=f+4*_;l.resize(v),l.float32.fill(-1/0,4*f,4*v)}function Pi(_,l,f){const v=l[0],w=l[1];return _[0]=f[0]*v+f[4]*w+f[12],_[1]=f[1]*v+f[5]*w+f[13],_[3]=f[3]*v+f[7]*w+f[15],_}const un=(_,l,f)=>(1-f)*_+f*l,fi=_=>_*_*_*_*_;class on{constructor(l,f,v,w,S,A,P){this.tileSize=512,this._renderWorldCopies=S===void 0||S,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=v??0,this._maxPitch=w??60,this.setProjection(A),this.setMaxBounds(P),this.width=0,this.height=0,this._center=new s.L(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new _n,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new an,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const l=new on(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(l,f=!1){const v=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||v)&&this._updateCameraOnTerrain(),(l||v)&&this._constrainCamera(f),this._calcMatrices()}getProjection(){return s.p(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};const f=this.projection?this.getProjection():void 0;this.projection=s.o(this.projectionOptions);const v=!M(f,this.getProjection());return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setOrthographicProjectionAtLowPitch(l){return this._orthographicProjectionAtLowPitch!==l&&(this._orthographicProjectionAtLowPitch=l,this._calcMatrices(),!0)}setMercatorFromTransition(){const l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.o({name:"mercator"});const f=l!==this.projection.name;return f&&this._calcMatrices(),f}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.b(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.w(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const f=-l*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=s.h.create(),s.h.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const f=s.c(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=s.d(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){const f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._setZoom(f),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}_updateCameraOnTerrain(){const l=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,f=this.elevation&&l===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||l===Number.NEGATIVE_INFINITY&&(!f||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const v=this._elevation;f||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&v.exaggeration()&&this._centerAltitudeValidForExaggeration!==v.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*v.exaggeration(),this._centerAltitudeValidForExaggeration=v.exaggeration()):(this._centerAltitude=l||0,this._centerAltitudeValidForExaggeration=v.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,f=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],v=this.horizonLineFromTop();let w=0,S=0;for(let A=0;A<f.length;A++){const P=new s.P(f[A][0]*this.width,v+f[A][1]*(this.height-v)),R=l.pointCoordinate(P);if(!R)continue;const B=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);w+=R[3]*B,S+=B}return S===0?NaN:w/S}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const l=this._seaLevelZoom,f=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),v=this.pixelsPerMeter/this.worldSize*f,w=this._mercatorZfromZoom(l),S=this._mercatorZfromZoom(this._maxZoom),A=Math.max(w-v,S);this._setZoom(this._zoomFromMercatorZ(A))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const f=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let v;v=l.z<this._camera.position[2]?[f.x,f.y,f.z]:[l.x,l.y,l.z];const w=s.v.length(s.v.sub([],this._camera.position,v));return s.c(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let f=!1;if(l.orientation&&!s.q.exactEquals(l.orientation,this._camera.orientation)&&(f=this._setCameraOrientation(l.orientation)),l.position){const v=[l.position.x,l.position.y,l.position.z];s.v.exactEquals(v,this._camera.position)||(this._setCameraPosition(v),f=!0)}f&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,f=new Wi;return f.position=new s.M(l[0],l[1],l[2]),f.orientation=this._camera.orientation,f._elevation=this.elevation,f._renderWorldCopies=this.renderWorldCopies,f}_setCameraOrientation(l){if(!s.q.length(l))return!1;s.q.normalize(l,l);const f=s.v.transformQuat([],[0,0,-1],l),v=s.v.transformQuat([],[0,-1,0],l);if(v[2]<0)return!1;const w=pi(f,v);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(l){const f=this.zoomScale(this.minZoom)*this.tileSize,v=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;l[2]=s.c(l[2],w/v,w/f),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,f,v){this._unmodified=!1,this._edgeInsets.interpolate(l,f,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(l){const f=[new s.U(0,l)];if(this.renderWorldCopies){const v=this.pointCoordinate(new s.P(0,0)),w=this.pointCoordinate(new s.P(this.width,0)),S=this.pointCoordinate(new s.P(this.width,this.height)),A=this.pointCoordinate(new s.P(0,this.height)),P=Math.floor(Math.min(v.x,w.x,S.x,A.x)),R=Math.floor(Math.max(v.x,w.x,S.x,A.x)),B=1;for(let U=P-B;U<=R+B;U++)U!==0&&f.push(new s.U(U,l))}return f}isLODDisabled(l){return(!l||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(l,f,v){let w=[];if(f[0]===0&&f[1]===0)return w;for(const A of l){const P=A.canonical,R=A.overscaledZ,B=A.wrap,U=1<<P.z,H=P.x+1<U,Z=P.x>0,Y=P.y+1<U,Q=P.y>0,te=A.wrap-(Z?0:1),ee=A.wrap+(H?0:1),K=Z?P.x-1:U-1,ce=H?P.x+1:0;f[0]<0?(w.push(new s.O(R,ee,P.z,ce,P.y)),f[1]<0&&Y&&(w.push(new s.O(R,B,P.z,P.x,P.y+1)),w.push(new s.O(R,ee,P.z,ce,P.y+1))),f[1]>0&&Q&&(w.push(new s.O(R,B,P.z,P.x,P.y-1)),w.push(new s.O(R,ee,P.z,ce,P.y-1)))):f[0]>0?(w.push(new s.O(R,te,P.z,K,P.y)),f[1]<0&&Y&&(w.push(new s.O(R,B,P.z,P.x,P.y+1)),w.push(new s.O(R,te,P.z,K,P.y+1))),f[1]>0&&Q&&(w.push(new s.O(R,B,P.z,P.x,P.y-1)),w.push(new s.O(R,te,P.z,K,P.y-1)))):f[1]<0&&Y?w.push(new s.O(R,B,P.z,P.x,P.y+1)):Q&&w.push(new s.O(R,B,P.z,P.x,P.y-1))}if(w.length>1){w.sort((R,B)=>R.overscaledZ-B.overscaledZ||R.wrap-B.wrap||R.canonical.z-B.canonical.z||R.canonical.x-B.canonical.x||R.canonical.y-B.canonical.y);let A=0,P=0;for(;P<w.length;)w[P].equals(w[A])?++P:w[++A]=w[P++];w.length=A+1}const S=[];for(const A of w)w.some(P=>A.isChildOf(P))||S.push(A);return w=S.filter(A=>!l.some(P=>!!(A.overscaledZ<v&&P.isChildOf(A))||A.equals(P)||A.isChildOf(P))),w}coveringTiles(l){let f=this.coveringZoomLevel(l);const v=f,w=this.elevation&&this.elevation.exaggeration(),S=w&&!l.isTerrainDEM,A=this.projection.name==="mercator";if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);const P=this.locationCoordinate(this.center),R=this.center.lat,B=1<<f,U=[B*P.x,B*P.y,0],H=this.projection.name==="globe",Z=!H,Y=s.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f,Z),Q=H?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),te=B*s.b(1,this.center.lat),ee=this._camera.position[2]/s.b(1,this.center.lat),K=[B*Q.x,B*Q.y,ee*(Z?1:te)],ce=H||w,ge=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),_e=this.isLODDisabled(!0)?f:0;let se;if(this._elevation&&l.isTerrainDEM)se=1e4*this._elevation.exaggeration();else if(this._elevation){const de=this._elevation.getMinMaxForVisibleTiles();se=de?de.max:this._centerAltitude}else se=this._centerAltitude;const ue=l.isTerrainDEM?-se:this._elevation?this._elevation.getMinElevationBelowMSL():0,ve=this.projection.isReprojectedInTileSpace?s.r(this):1,Me=de=>{const _t=new s.M(de.x+25e-6,de.y,de.z),ut=new s.M(de.x,de.y+25e-6,de.z),ti=de.toLngLat(),Ht=_t.toLngLat(),hi=ut.toLngLat(),Jt=this.locationCoordinate(ti),_i=this.locationCoordinate(Ht),yi=this.locationCoordinate(hi),oi=Math.hypot(_i.x-Jt.x,_i.y-Jt.y),li=Math.hypot(yi.x-Jt.x,yi.y-Jt.y);return Math.sqrt(oi*li)*ve/25e-6},be=de=>{const ze=se,_t=ue;return{aabb:s.y(this,B,0,0,0,de,_t,ze,this.projection),zoom:0,x:0,y:0,minZ:_t,maxZ:ze,wrap:de,fullyVisible:!1}},Ce=[];let $e=[];const Ne=f,qe=l.reparseOverscaled?v:f,Le=de=>de*de,Ke=Le((ee-this._centerAltitude)*te),He=de=>{if(!this._elevation||!de.tileID||!A)return;const ze=this._elevation.getMinMaxForTile(de.tileID),_t=de.aabb;ze?(_t.min[2]=ze.min,_t.max[2]=ze.max,_t.center[2]=(_t.min[2]+_t.max[2])/2):(de.shouldSplit=nt(de),de.shouldSplit||(_t.min[2]=_t.max[2]=_t.center[2]=this._centerAltitude))},nt=de=>{if(de.zoom<_e)return!0;if(de.zoom===Ne)return!1;if(de.shouldSplit!=null)return de.shouldSplit;const ze=de.aabb.distanceX(K),_t=de.aabb.distanceY(K);let ut=Ke,ti=1;if(H){ut=Le(de.aabb.distanceZ(K));const Jt=Math.pow(2,de.zoom),_i=s.l((de.y+1)/Jt),yi=s.l(de.y/Jt),oi=Math.min(Math.max(R,_i),yi),li=s.a0(oi)/s.a0(R);if(ti=oi===R?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,li/this._mercatorScaleRatio),this.zoom<=s.Z&&de.zoom===Ne-1&&li>=.9)return!0}else if(S&&(ut=Le(de.aabb.distanceZ(K)*te)),this.projection.isReprojectedInTileSpace&&v<=5){const Jt=Math.pow(2,de.zoom),_i=Me(new s.M((de.x+.5)/Jt,(de.y+.5)/Jt));ti=_i>.85?1:_i}const Ht=ze*ze+_t*_t+ut,hi=Le((1<<Ne-de.zoom)*ge*ti*((Jt,_i)=>{if(_i*Le(.707)<Jt)return 1;const yi=Math.sqrt(_i/Jt);return yi/(1.4144271570014144+(Math.pow(1.1,yi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ut,Ke),Ht));return Ht<hi};if(this.renderWorldCopies)for(let de=1;de<=3;de++)Ce.push(be(-de)),Ce.push(be(de));for(Ce.push(be(0));Ce.length>0;){const de=Ce.pop(),ze=de.x,_t=de.y;let ut=de.fullyVisible;const ti=()=>this.projection.name==="globe"&&(de.y===0||de.y===(1<<de.zoom)-1);if(!ut){let Ht=ce?de.aabb.intersects(Y):de.aabb.intersectsFlat(Y);if(Ht===0&&ti()){const hi=new s.t(de.zoom,ze,_t);Ht=s.x(this,B,hi,!0).intersects(Y)}if(Ht===0)continue;ut=Ht===2}if(de.zoom!==Ne&&nt(de))for(let Ht=0;Ht<4;Ht++){const hi=(ze<<1)+Ht%2,Jt=(_t<<1)+(Ht>>1),_i={aabb:A?de.aabb.quadrant(Ht):s.y(this,B,de.zoom+1,hi,Jt,de.wrap,de.minZ,de.maxZ,this.projection),zoom:de.zoom+1,x:hi,y:Jt,wrap:de.wrap,fullyVisible:ut,tileID:void 0,shouldSplit:void 0,minZ:de.minZ,maxZ:de.maxZ};S&&!H&&(_i.tileID=new s.O(de.zoom+1===Ne?qe:de.zoom+1,de.wrap,de.zoom+1,hi,Jt),He(_i)),Ce.push(_i)}else{const Ht=de.zoom===Ne?qe:de.zoom;if(l.minzoom&&l.minzoom>Ht)continue;if(!ut){let yi=ce?de.aabb.intersectsPrecise(Y):de.aabb.intersectsPreciseFlat(Y);if(yi===0&&ti()){const oi=new s.t(de.zoom,ze,_t);yi=s.x(this,B,oi,!0).intersectsPrecise(Y)}if(yi===0)continue}const hi=U[0]-(.5+ze+(de.wrap<<de.zoom))*(1<<f-de.zoom),Jt=U[1]-.5-_t,_i=de.tileID?de.tileID:new s.O(Ht,de.wrap,de.zoom,ze,_t);$e.push({tileID:_i,distanceSq:hi*hi+Jt*Jt})}}if(this.fogCullDistSq){const de=this.fogCullDistSq,ze=this.horizonLineFromTop();$e=$e.filter(_t=>{const ut=[0,0,0,1],ti=[s.J,s.J,0,1],Ht=this.calculateFogTileMatrix(_t.tileID.toUnwrapped());s.e.transformMat4(ut,ut,Ht),s.e.transformMat4(ti,ti,Ht);const hi=s.e.min([],ut,ti),Jt=s.e.max([],ut,ti),_i=s.z(hi,Jt);if(_i===0)return!0;let yi=!1;const oi=this._elevation;if(oi&&_i>de&&ze!==0){const li=this.calculateProjMatrix(_t.tileID.toUnwrapped());let tn;l.isTerrainDEM||(tn=oi.getMinMaxForTile(_t.tileID)),tn||(tn={min:ue,max:se});const Li=s._(this.rotation),Nn=[Li[0]*s.J,Li[1]*s.J,tn.max];s.v.transformMat4(Nn,Nn,li),yi=(1-Nn[1])*this.height*.5<ze}return _i<de||yi})}return $e.sort((de,ze)=>de.distanceSq-ze.distanceSq).map(de=>de.tileID)}resize(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const f=s.c(l.lat,-s.A,s.A),v=this.projection.project(l.lng,f);return new s.P(v.x*this.worldSize,v.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.b(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,f){let v,w;const S=this.centerPoint;if(this.projection.name==="globe"){const P=this.worldSize;v=(f.x-S.x)/P,w=(f.y-S.y)/P}else{const P=this.pointCoordinate(f),R=this.pointCoordinate(S);v=P.x-R.x,w=P.y-R.y}const A=this.locationCoordinate(l);this.setLocation(new s.M(A.x-v,A.y-w))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,f){const v=f?s.b(f,l.lat):void 0,w=this.projection.project(l.lng,l.lat);return new s.M(w.x,w.y,v)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,f){const v=f??this._centerAltitude,w=[l.x,l.y,0,1],S=[l.x,l.y,1,1];s.e.transformMat4(w,w,this.pixelMatrixInverse),s.e.transformMat4(S,S,this.pixelMatrixInverse);const A=S[3];s.e.scale(w,w,1/w[3]),s.e.scale(S,S,1/A);const P=w[2],R=S[2];return{p0:w,p1:S,t:P===R?0:(v-P)/(R-P)}}screenPointToMercatorRay(l){const f=[l.x,l.y,0,1],v=[l.x,l.y,1,1];return s.e.transformMat4(f,f,this.pixelMatrixInverse),s.e.transformMat4(v,v,this.pixelMatrixInverse),s.e.scale(f,f,1/f[3]),s.e.scale(v,v,1/v[3]),f[2]=s.b(f[2],this._center.lat)*this.worldSize,v[2]=s.b(v[2],this._center.lat)*this.worldSize,s.e.scale(f,f,1/this.worldSize),s.e.scale(v,v,1/this.worldSize),new s.R([f[0],f[1],f[2]],s.v.normalize([],s.v.sub([],v,f)))}rayIntersectionCoordinate(l){const{p0:f,p1:v,t:w}=l,S=s.b(f[2],this._center.lat),A=s.b(v[2],this._center.lat);return new s.M(s.n(f[0],v[0],w)/this.worldSize,s.n(f[1],v[1],w)/this.worldSize,s.n(S,A,w))}pointCoordinate(l,f=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,f)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let f=this.projection.pointCoordinate3D(this,l.x,l.y);if(f)return new s.M(f[0],f[1],f[2]);let v=0,w=this.horizonLineFromTop();if(l.y>w)return this.pointCoordinate(l);const S=.02*w,A=l.clone();for(let P=0;P<10&&w-v>S;P++){A.y=s.n(v,w,.66);const R=this.projection.pointCoordinate3D(this,A.x,A.y);R?(w=A.y,f=R):v=A.y}return f?new s.M(f[0],f[1],f[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}isPointOnSurface(l){if(l.y<0||l.y>this.height||l.x<0||l.x>this.width)return!1;if(this.elevation||this.zoom>=s.G)return!this.isPointAboveHorizon(l);const f=this.pointCoordinate(l);return f.y>=0&&f.y<=1}_coordinatePoint(l,f){const v=f&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,w=[l.x*this.worldSize,l.y*this.worldSize,v+l.toAltitude(),1];return s.e.transformMat4(w,w,this.pixelMatrix),w[3]>0?new s.P(w[0]/w[3],w[1]/w[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:l,left:f}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,S=this.pointLocation3D(new s.P(f,l)),A=this.pointLocation3D(new s.P(w,l)),P=this.pointLocation3D(new s.P(w,v)),R=this.pointLocation3D(new s.P(f,v));let B=Math.min(S.lng,A.lng,P.lng,R.lng),U=Math.max(S.lng,A.lng,P.lng,R.lng),H=Math.min(S.lat,A.lat,P.lat,R.lat),Z=Math.max(S.lat,A.lat,P.lat,R.lat);const Y=Math.pow(2,-this.zoom)/16*270,Q=this.projection.name==="globe"?1:4,te=(ee,K,ce,ge,_e)=>{const se=(ee+ce)/2,ue=(K+ge)/2,ve=new s.P(se,ue),{lng:Me,lat:be}=this.pointLocation3D(ve),Ce=Math.max(0,B-Me,H-be,Me-U,be-Z);B=Math.min(B,Me),U=Math.max(U,Me),H=Math.min(H,be),Z=Math.max(Z,be),(_e<Q||Ce>Y)&&(te(ee,K,se,ue,_e+1),te(se,ue,ce,ge,_e+1))};if(te(f,l,w,l,1),te(w,l,w,v,1),te(w,v,f,v,1),te(f,v,f,l,1),this.projection.name==="globe"){const[ee,K]=s.B(this);ee?(Z=90,U=180,B=-180):K&&(H=-90,U=180,B=-180)}return new s.D(new s.L(B,H),new s.L(U,Z))}_getBoundsRectangular(l,f){const{top:v,left:w}=this._edgeInsets,S=this.height-this._edgeInsets.bottom,A=this.width-this._edgeInsets.right,P=new s.P(w,v),R=new s.P(A,v),B=new s.P(A,S),U=new s.P(w,S);let H=this.pointCoordinate(P,l),Z=this.pointCoordinate(R,l);const Y=this.pointCoordinate(B,f),Q=this.pointCoordinate(U,f),te=(ee,K)=>(K.y-ee.y)/(K.x-ee.x);return H.y>1&&Z.y>=0?H=new s.M((1-Q.y)/te(Q,H)+Q.x,1):H.y<0&&Z.y<=1&&(H=new s.M(-Q.y/te(Q,H)+Q.x,0)),Z.y>1&&H.y>=0?Z=new s.M((1-Y.y)/te(Y,Z)+Y.x,1):Z.y<0&&H.y<=1&&(Z=new s.M(-Y.y/te(Y,Z)+Y.x,0)),new s.D().extend(this.coordinateLocation(H)).extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(Y))}_getBoundsRectangularTerrain(){const l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);const f=l.visibleDemTiles.reduce((v,w)=>{if(w.dem){const S=w.dem.tree;v.min=Math.min(v.min,S.minimums[0]),v.max=Math.max(v.max,S.maximums[0])}return v},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(f.min*l.exaggeration(),f.max*l.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){const f=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,v=this.height/2-f*(1-this._horizonShift);return l?Math.max(0,v):v}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-s.A,this.maxLat=s.A,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.E(this.minLng)*this.tileSize,this.worldMaxX=s.E(this.maxLng)*this.tileSize,this.worldMinY=s.H(this.maxLat)*this.tileSize,this.worldMaxY=s.H(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,f){return this.projection.createTileMatrix(this,f,l)}calculateDistanceTileData(l){const f=l.key,v=this._distanceTileDataCache;if(v[f])return v[f];const w=l.canonical,S=1/this.height,A=this.cameraWorldSize,P=A/this.zoomScale(w.z),R=(w.x+Math.pow(2,w.z)*l.wrap)*P,B=w.y*P,U=this.point;U.x*=A/this.worldSize,U.y*=A/this.worldSize;const H=this.angle,Z=Math.sin(-H),Y=-Math.cos(-H);return v[f]={bearing:[Z,Y],center:[(U.x-R)*S,(U.y-B)*S],scale:P/s.J*S},v[f]}calculateFogTileMatrix(l){const f=l.key,v=this._fogTileMatrixCache;if(v[f])return v[f];const w=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return s.m.multiply(w,this.worldToFogMatrix,w),v[f]=new Float32Array(w),v[f]}calculateProjMatrix(l,f=!1,v=!1){const w=l.key;let S;if(S=v?this._expandedProjMatrixCache:f?this._alignedProjMatrixCache:this._projMatrixCache,S[w])return S[w];const A=this.calculatePosMatrix(l,this.worldSize);let P;return P=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:v?this.expandedFarZProjMatrix:f?this.alignedProjMatrix:this.projMatrix,s.m.multiply(A,P,A),S[w]=new Float32Array(A),S[w]}calculatePixelsToTileUnitsMatrix(l){const f=l.tileID.key,v=this._pixelsToTileUnitsCache;if(v[f])return v[f];const w=s.K(l,this);return v[f]=w,v[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const l=1/this.worldSize,f=s.m.fromScaling([],[l,l,l]);return s.m.multiply(f,f,this.globeMatrix),f}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const l=this._elevation;this._updateCameraState();const f=s.b(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(f),w=this._camera.forward(),S=s.b(1,this._center.lat);v[2]/=S,w[2]/=S,s.v.normalize(w,w);const A=l.raycast(v,w,l.exaggeration());if(A){const P=s.v.scaleAndAdd([],v,w,A),R=new s.M(P[0],P[1],s.b(P[2],s.l(P[1]))),B=(R.z+s.v.length([R.x-v[0],R.y-v[1],R.z-v[2]*S]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(B),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;const f=this._elevation,v=s.b(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(v),S=f.getAtPointOrZero(new s.M(...w)),A=this.pixelsPerMeter/this.worldSize*S,P=this._minimumHeightOverTerrain(),R=w[2]-A;if(R<=P)if(R<0||l){const B=this.locationCoordinate(this._center,this._centerAltitude),U=[w[0],w[1],B.z-w[2]],H=s.v.length(U);U[2]-=(P-R)/this._pixelsPerMercatorPixel;const Z=s.v.length(U);if(Z===0)return;s.v.scale(U,U,H/Z*this._pixelsPerMercatorPixel),this._camera.position=[w[0],w[1],B.z*this._pixelsPerMercatorPixel-U[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){const Z=this.center;return Z.lat=s.c(Z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(Z.lng=s.c(Z.lng,this.minLng,this.maxLng)),this.center=Z,void(this._constraining=!1)}const f=this._unmodified,{x:v,y:w}=this.point;let S=0,A=v,P=w;const R=this.width/2,B=this.height/2,U=this.worldMinY*this.scale,H=this.worldMaxY*this.scale;if(w-B<U&&(P=U+B),w+B>H&&(P=H-B),H-U<this.height&&(S=Math.max(S,this.height/(H-U)),P=(H+U)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Z=this.worldMinX*this.scale,Y=this.worldMaxX*this.scale,Q=this.worldSize/2-(Z+Y)/2;A=(v+Q+this.worldSize)%this.worldSize-Q,A-R<Z&&(A=Z+R),A+R>Y&&(A=Y-R),Y-Z<this.width&&(S=Math.max(S,this.width/(Y-Z)),A=(Y+Z)/2)}A===v&&P===w||(this.center=this.unproject(new s.P(A,P))),S&&(this.zoom+=this.scaleZoom(S)),this._constrainCamera(),this._unmodified=f,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,f=this.projection.name==="globe",v=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.b(1,this.center.lat)/s.b(1,s.$));const w=s.N(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,w),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const S=this.projection.zAxisUnit==="meters"?v:1,A=this._camera.getWorldToCamera(this.worldSize,S);let P;const R=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(R[8]=2*-l.x/this.width,R[9]=2*l.y/this.height,this.isOrthographic){let be=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ce=be*this.aspect,$e=-Ce,Ne=-be;Ce-=l.x,$e-=l.x,be+=l.y,Ne+=l.y,P=this._camera.getCameraToClipOrthographic($e,Ce,Ne,be,this._nearZ,this._farZ),((qe,Le,Ke,He)=>{for(let nt=0;nt<16;nt++)qe[nt]=un(Le[nt],Ke[nt],He)})(P,P,R,fi(this.pitch>=15?1:this.pitch/15))}else P=R;const B=s.m.mul([],R,A);let U=s.m.mul([],P,A);if(this.projection.isReprojectedInTileSpace){const be=this.locationCoordinate(this.center),Ce=s.m.identity([]);s.m.translate(Ce,Ce,[be.x*this.worldSize,be.y*this.worldSize,0]),s.m.multiply(Ce,Ce,s.Q(this)),s.m.translate(Ce,Ce,[-be.x*this.worldSize,-be.y*this.worldSize,0]),s.m.multiply(U,U,Ce),s.m.multiply(B,B,Ce),this.inverseAdjustmentMatrix=s.S(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.m.scale([],U,[this.worldSize,this.worldSize,this.worldSize/S,1]),this.projMatrix=U,this.invProjMatrix=s.m.invert(new Float64Array(16),this.projMatrix),f){const be=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);be[8]=2*-l.x/this.width,be[9]=2*l.y/this.height,this.expandedFarZProjMatrix=s.m.mul([],be,A)}else this.expandedFarZProjMatrix=this.projMatrix;const H=s.m.invert([],P);this.frustumCorners=s.T.fromInvProjectionMatrix(H,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!f);const Z=new Float32Array(16);s.m.identity(Z),s.m.scale(Z,Z,[1,-1,1]),s.m.rotateX(Z,Z,this._pitch),s.m.rotateZ(Z,Z,this.angle);const Y=s.m.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.m.clone(Y);const Q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Y[8]=2*-l.x/this.width,Y[9]=2*(l.y+Q)/this.height,this.skyboxMatrix=s.m.multiply(Z,Y,Z);const te=this.point,ee=te.x,K=te.y,ce=this.width%2/2,ge=this.height%2/2,_e=Math.cos(this.angle),se=Math.sin(this.angle),ue=ee-Math.round(ee)+_e*ce+se*ge,ve=K-Math.round(K)+_e*ge+se*ce,Me=new Float64Array(U);if(s.m.translate(Me,Me,[ue>.5?ue-1:ue,ve>.5?ve-1:ve,0]),this.alignedProjMatrix=Me,U=s.m.create(),s.m.scale(U,U,[this.width/2,-this.height/2,1]),s.m.translate(U,U,[1,-1,0]),this.labelPlaneMatrix=U,U=s.m.create(),s.m.scale(U,U,[1,-1,1]),s.m.translate(U,U,[-1,-1,0]),s.m.scale(U,U,[2/this.width,2/this.height,1]),this.glCoordMatrix=U,this.pixelMatrix=s.m.multiply(new Float64Array(16),this.labelPlaneMatrix,B),this._calcFogMatrices(),this._distanceTileDataCache={},U=s.m.invert(new Float64Array(16),this.pixelMatrix),!U)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=U,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.V(this);const be=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.v.transformMat4(be,be,A),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=U;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSizeForFog,f=this.cameraPixelsPerMeter,v=this._camera.position,w=1/this.height/this._pixelsPerMercatorPixel,S=[l,l,f];s.v.scale(S,S,w),s.v.scale(v,v,-1),s.v.multiply(v,v,S);const A=s.m.create();s.m.translate(A,A,v),s.m.scale(A,A,S),this.mercatorFogMatrix=A,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,f,w)}_computeCameraPosition(l){const f=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,v=this._camera.forward(),w=this.point,S=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*f-l/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-v[0]*S,w.y/this.worldSize-v[1]*S,l/this.worldSize*this._centerAltitude-v[2]*S]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const f=this._maxCameraBoundsDistance()*Math.cos(this._pitch),v=this._camera.position[2],w=l[2];let S=1;this.projection.wrap&&(this.center=this.center.wrap()),w>0&&(S=Math.min((f-v)/w,1)),this._camera.position=s.v.scaleAndAdd([],this._camera.position,l,S),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,f=this._camera.forward(),{pitch:v,bearing:w}=this._camera.getPitchBearing(),S=s.b(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,A=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.d(this._maxPitch)),P=Math.max((l[2]-S)/Math.cos(v),A),R=this._zoomFromMercatorZ(P);s.v.scaleAndAdd(l,l,f,P),this._pitch=s.c(v,s.d(this.minPitch),s.d(this.maxPitch)),this.angle=s.w(w,-Math.PI,Math.PI),this._setZoom(s.c(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.M(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){let f=0,v=s.G,w=0,S=1/0;for(;v-f>1e-6&&v>f;){const A=f+.5*(v-f),P=this.tileSize*Math.pow(2,A),R=this.getCameraToCenterDistance(this.projection,A,P),B=this.scaleZoom(R/(l*this.tileSize)),U=Math.abs(A-B);U<S&&(S=U,w=A),A<B?f=A:v=A}return w}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.X("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,f){const v=Math.min(l.x,f.x),w=Math.max(l.x,f.x),S=Math.min(l.y,f.y),A=Math.max(l.y,f.y);if(S<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const P=[new s.P(v,S),new s.P(w,A),new s.P(v,A),new s.P(w,S)],R=this.renderWorldCopies?-3:0,B=this.renderWorldCopies?4:1;for(const U of P){const H=this.pointRayIntersection(U);if(H.t<0)return!0;const Z=this.rayIntersectionCoordinate(H);if(Z.x<R||Z.y<0||Z.x>B||Z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.Y(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(l,f){const v=s.v.length(s.v.sub([],this._camera.position,l)),w=this._zoomFromMercatorZ(v)+f;return v-this._mercatorZfromZoom(w)}getCameraPoint(){if(this.projection.name==="globe"){const l=function([f,v,w],S){const A=[f,v,w,1];s.e.transformMat4(A,A,S);const P=A[3]=Math.max(A[3],1e-6);return A[0]/=P,A[1]/=P,A[2]/=P,A}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(l[0],l[1])}{const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,l))}}getCameraToCenterDistance(l,f=this.zoom,v=this.worldSize){const w=s.N(l,f,this.width,this.height,1024),S=l.pixelSpaceConversion(this.center.lat,v,w);let A=.5/Math.tan(.5*this._fov)*this.height*S;return this.isOrthographic&&(A=un(1,A,fi(this.pitch>=15?1:this.pitch/15))),A}getWorldToCameraMatrix(){const l=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.m.multiply(l,l,this.globeMatrix),l}getFrustum(l){return s.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,this.projection.zAxisUnit==="meters")}}function Yn(_){const{userImage:l}=_;return!!(l&&l.render&&l.render())&&(_.data.replace(new Uint8Array(l.data.buffer)),!0)}class Zn extends s.a6{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(l){this.images[l]={},this.loaded[l]=!1,this.updatedImages[l]={},this.patterns[l]={},this.callbackDispatchedThisFrame[l]={},this.atlasImage[l]=new s.a5({width:1,height:1})}isLoaded(){for(const l in this.loaded)if(!this.loaded[l])return!1;return!0}setLoaded(l,f){if(this.loaded[f]!==l&&(this.loaded[f]=l,l)){for(const{ids:v,callback:w}of this.requestors)this._notify(v,f,w);this.requestors=[]}}hasImage(l,f){return!!this.getImage(l,f)}getImage(l,f){return this.images[f][l]}addImage(l,f,v){this._validate(l,v)&&(this.images[f][l]=v)}_validate(l,f){let v=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new s.a7(new Error(`Image "${l}" has invalid "stretchX" value`))),v=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new s.a7(new Error(`Image "${l}" has invalid "stretchY" value`))),v=!1),this._validateContent(f.content,f)||(this.fire(new s.a7(new Error(`Image "${l}" has invalid "content" value`))),v=!1),v}_validateStretch(l,f){if(!l)return!0;let v=0;for(const w of l){if(w[0]<v||w[1]<w[0]||f<w[1])return!1;v=w[1]}return!0}_validateContent(l,f){return!(l&&(l.length!==4||l[0]<0||f.data.width<l[0]||l[1]<0||f.data.height<l[1]||l[2]<0||f.data.width<l[2]||l[3]<0||f.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,f,v){v.version=this.images[f][l].version+1,this.images[f][l]=v,this.updatedImages[f][l]=!0}removeImage(l,f){const v=this.images[f][l];delete this.images[f][l],delete this.patterns[f][l],v.userImage&&v.userImage.onRemove&&v.userImage.onRemove()}listImages(l){return Object.keys(this.images[l])}getImages(l,f,v){let w=!0;const S=!!this.loaded[f];if(!S)for(const A of l)this.images[f][A]||(w=!1);S||w?this._notify(l,f,v):this.requestors.push({ids:l,scope:f,callback:v})}getUpdatedImages(l){return this.updatedImages[l]}_notify(l,f,v){const w={};for(const S of l){this.images[f][S]||this.fire(new s.a8("styleimagemissing",{id:S}));const A=this.images[f][S];A?w[S]={data:A.data.clone(),pixelRatio:A.pixelRatio,sdf:A.sdf,version:A.version,stretchX:A.stretchX,stretchY:A.stretchY,content:A.content,hasRenderCallback:!!(A.userImage&&A.userImage.render)}:s.X(`Image "${S}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}v(null,w)}getPixelSize(l){const{width:f,height:v}=this.atlasImage[l];return{width:f,height:v}}getPattern(l,f){const v=this.patterns[f][l],w=this.getImage(l,f);if(!w)return null;if(v&&v.position.version===w.version)return v.position;if(v)v.position.version=w.version;else{const S={w:w.data.width+2,h:w.data.height+2,x:0,y:0},A=new s.ab(S,w);this.patterns[f][l]={bin:S,position:A}}return this._updatePatternAtlas(f),this.patterns[f][l].position}bind(l,f){const v=l.gl;let w=this.atlasTexture[f];w?this.dirty&&(w.update(this.atlasImage[f]),this.dirty=!1):(w=new s.a9(l,this.atlasImage[f],v.RGBA),this.atlasTexture[f]=w),w.bind(v.LINEAR,v.CLAMP_TO_EDGE)}_updatePatternAtlas(l){const f=[];for(const A in this.patterns[l])f.push(this.patterns[l][A].bin);const{w:v,h:w}=s.aa(f),S=this.atlasImage[l];S.resize({width:v||1,height:w||1});for(const A in this.patterns[l]){const{bin:P}=this.patterns[l][A],R=P.x+1,B=P.y+1,U=this.images[l][A].data,H=U.width,Z=U.height;s.a5.copy(U,S,{x:0,y:0},{x:R,y:B},{width:H,height:Z}),s.a5.copy(U,S,{x:0,y:Z-1},{x:R,y:B-1},{width:H,height:1}),s.a5.copy(U,S,{x:0,y:0},{x:R,y:B+Z},{width:H,height:1}),s.a5.copy(U,S,{x:H-1,y:0},{x:R-1,y:B},{width:1,height:Z}),s.a5.copy(U,S,{x:0,y:0},{x:R+H,y:B},{width:1,height:Z})}this.dirty=!0}beginFrame(){for(const l in this.images)this.callbackDispatchedThisFrame[l]={}}dispatchRenderCallbacks(l,f){for(const v of l){if(this.callbackDispatchedThisFrame[f][v])continue;this.callbackDispatchedThisFrame[f][v]=!0;const w=this.images[f][v];Yn(w)&&this.updateImage(v,f,w)}}}const tr=new s.ac({anchor:new s.ad(s.ae.light.anchor),position:new s.af(s.ae.light.position),color:new s.ad(s.ae.light.color),intensity:new s.ad(s.ae.light.intensity)});class Xr extends s.a6{constructor(l,f="flat"){super(),this._transitionable=new s.ag(tr),this.setLight(l,f),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,f,v={}){this._validate(s.ah,l,v)||(this._transitionable.setTransitionOrValue(l),this.id=f)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,f,v){return(!v||v.validate!==!1)&&s.ai(this,l.call(s.aj,s.ak({value:f,style:{glyphs:!0,sprite:!0},styleSpec:s.ae})))}}const Io=new s.ac({source:new s.ad(s.ae.terrain.source),exaggeration:new s.ad(s.ae.terrain.exaggeration)});let ir=class extends s.a6{constructor(_,l,f,v){super(),this.scope=f,this._transitionable=new s.ag(Io,f,v),this._transitionable.setTransitionOrValue(_,v),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(_,l){this._transitionable.setTransitionOrValue(_,l)}updateTransitions(_){this._transitioning=this._transitionable.transitioned(_,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(_){this.properties=this._transitioning.possiblyEvaluate(_)}getExaggeration(_){return this._transitioning.possiblyEvaluate(new s.al(_)).get("exaggeration")}isZoomDependent(){const _=this._transitionable._values.exaggeration;return _!=null&&_.value!=null&&_.value.expression!=null&&_.value.expression instanceof s.am}};const Co=45,Yr=65,vo=.05;function ys(_,l,f,v){const w=s.an(Co,Yr,f),[S,A]=$a(_,v);let P=1-Math.min(1,Math.exp((l-S)/(A-S)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*w*_.alpha}function $a(_,l){const f=.5/Math.tan(.5*l);return[_.range[0]+f,_.range[1]+f]}function kl(_,l,f,v,w){const S=s.v.transformMat4([],[l,f,v],w.mercatorFogMatrix);return ys(_,s.v.length(S),w.pitch,w._fov)}function Ac(_,l,f,v,w,S,A){const P=[[f,v,0],[w,v,0],[w,S,0],[f,S,0]];let R=Number.MAX_VALUE,B=-Number.MAX_VALUE;for(const U of P){const H=s.v.transformMat4([],U,l),Z=s.v.length(H);R=Math.min(R,Z),B=Math.max(B,Z)}return[ys(_,R,A.pitch,A._fov),ys(_,B,A.pitch,A._fov)]}const wa=new s.ac({range:new s.ad(s.ae.fog.range),color:new s.ad(s.ae.fog.color),"high-color":new s.ad(s.ae.fog["high-color"]),"space-color":new s.ad(s.ae.fog["space-color"]),"horizon-blend":new s.ad(s.ae.fog["horizon-blend"]),"star-intensity":new s.ad(s.ae.fog["star-intensity"]),"vertical-range":new s.ad(s.ae.fog["vertical-range"])});class Dl extends s.a6{constructor(l,f){super(),this._transitionable=new s.ag(wa),this.set(l),this._transitioning=this._transitionable.untransitioned(),this._transform=f}get state(){const l=this._transform,f=l.projection.name==="globe",v=s.ao(l.zoom),w=this.properties.get("range"),S=[.5,3];return{range:f?[s.n(S[0],w[0],v),s.n(S[1],w[1],v)]:w,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,f={}){if(this._validate(s.ap,l,f))return;const v=s.ak({},l);for(const w of Object.keys(s.ae.fog))v[w]===void 0&&(v[w]=s.ae.fog[w].default);this._transitionable.setTransitionOrValue(v)}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const f=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.an(Co,Yr,l))*f.a}getOpacityAtLatLng(l,f){return this._transform.projection.supportsFog?function(v,w,S){const A=s.M.fromLngLat(w),P=S.elevation?S.elevation.getAtPointOrZero(A):0;return kl(v,A.x,A.y,P,S)}(this.state,l,f):0}getOpacityForTile(l){if(!this._transform.projection.supportsFog)return[1,1];const f=this._transform.calculateFogTileMatrix(l.toUnwrapped());return Ac(this.state,f,0,0,s.J,s.J,this._transform)}getOpacityForBounds(l,f,v,w,S){return this._transform.projection.supportsFog?Ac(this.state,l,f,v,w,S,this._transform):[1,1]}getFovAdjustedRange(l){return this._transform.projection.supportsFog?$a(this.state,l):[0,1]}isVisibleOnFrustum(l){if(!this._transform.projection.supportsFog)return!1;const f=[4,5,6,7];for(const v of f){const w=l.points[v];let S;if(w[2]>=0)S=w;else{const A=l.points[v-4];S=s.aq(A,w,A[2]/(A[2]-w[2]))}if(kl(this.state,S[0],S[1],0,this._transform)>=vo)return!0}return!1}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,f,v){return(!v||v.validate!==!1)&&s.ai(this,l.call(s.aj,s.ak({value:f,style:{glyphs:!0,sprite:!0},styleSpec:s.ae})))}}class Ta extends s.a6{constructor(l,f,v,w){super(),this.scope=v,this._options=l,this.properties=new s.ar(f),this._transitionable=new s.ag(f,v,new Map(w)),this._transitionable.setTransitionOrValue(l.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(l){this._transitionable.setTransitionOrValue(this._options.properties,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(l,f){this._options=l,this._transitionable.setTransitionOrValue(l.properties,f)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const lr=new s.ac({color:new s.ad(s.ae.properties_light_ambient.color),intensity:new s.ad(s.ae.properties_light_ambient.intensity)}),yu=new s.ac({direction:new s.as(s.ae.properties_light_directional.direction),color:new s.ad(s.ae.properties_light_directional.color),intensity:new s.ad(s.ae.properties_light_directional.intensity),"cast-shadows":new s.ad(s.ae.properties_light_directional["cast-shadows"]),"shadow-intensity":new s.ad(s.ae.properties_light_directional["shadow-intensity"])});class ro{constructor(l,f,v,w){this.screenBounds=l,this.cameraPoint=f,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=v,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,w)}static createFromScreenPoints(l,f){let v,w;if(l instanceof s.P||typeof l[0]=="number"){const S=s.P.convert(l);v=[S],w=f.isPointAboveHorizon(S)}else{const S=s.P.convert(l[0]),A=s.P.convert(l[1]);v=[S,A],w=s.at(S,A).every(P=>f.isPointAboveHorizon(P))}return new ro(v,f.getCameraPoint(),w,f)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(l){return s.at(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const f=this.screenBounds[0],v=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],w=s.at(f,v,0,!1);return this.cameraPoint.y>v.y&&(this.cameraPoint.x>f.x&&this.cameraPoint.x<v.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=v.x?w[2]=this.cameraPoint:this.cameraPoint.x<=f.x&&(w[3]=this.cameraPoint)),s.au(w,l)}bufferedCameraGeometryGlobe(l){const f=this.screenBounds[0],v=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],w=s.at(f,v,l),S=this.cameraPoint.clone();switch(3*((S.y>f.y)+(S.y>v.y))+((S.x>f.x)+(S.x>v.x))){case 0:w[0]=S,w[4]=S.clone();break;case 1:w.splice(1,0,S);break;case 2:w[1]=S;break;case 3:w.splice(4,0,S);break;case 5:w.splice(2,0,S);break;case 6:w[3]=S;break;case 7:w.splice(3,0,S);break;case 8:w[2]=S}return w}containsTile(l,f,v,w=0){const S=l.queryPadding/f._pixelsPerMercatorPixel+1,A=v?this._bufferedCameraMercator(S,f):this._bufferedScreenMercator(S,f);let P=l.tileID.wrap+(A.unwrapped?w:0);const R=A.polygon.map(ee=>s.av(l.tileTransform,ee,P));if(!s.aw(R,0,0,s.J,s.J))return;P=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?w:0);const B=this.screenGeometryMercator.polygon.map(ee=>s.ax(l.tileTransform,ee,P)),U=B.map(ee=>new s.P(ee[0],ee[1])),H=f.getFreeCameraOptions().position||new s.M(0,0,0),Z=s.ax(l.tileTransform,H,P),Y=B.map(ee=>{const K=s.v.sub(ee,ee,Z);return s.v.normalize(K,K),new s.R(Z,K)}),Q=s.ay(l,1,f.zoom)*f._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:U,tilespaceRays:Y,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(te=s.az(R),te.min.x=s.c(te.min.x,0,s.J),te.min.y=s.c(te.min.y,0,s.J),te.max.x=s.c(te.max.x,0,s.J),te.max.y=s.c(te.max.y,0,s.J),te),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:Q};var te}_bufferedScreenMercator(l,f){const v=xo(l);if(this._screenRaycastCache[v])return this._screenRaycastCache[v];{let w;return w=f.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(l),f):{polygon:this.bufferedScreenGeometry(l).map(S=>f.pointCoordinate3D(S)),unwrapped:!0},this._screenRaycastCache[v]=w,w}}_bufferedCameraMercator(l,f){const v=xo(l);if(this._cameraRaycastCache[v])return this._cameraRaycastCache[v];{let w;return w=f.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),f):{polygon:this.bufferedCameraGeometry(l).map(S=>f.pointCoordinate3D(S)),unwrapped:!0},this._cameraRaycastCache[v]=w,w}}_projectAndResample(l,f){const v=function(S,A){const P=s.m.multiply([],A.pixelMatrix,A.globeMatrix),R=[0,-s.aC,0,1],B=[0,s.aC,0,1],U=[0,0,0,1];s.e.transformMat4(R,R,P),s.e.transformMat4(B,B,P),s.e.transformMat4(U,U,P);const H=new s.P(R[0]/R[3],R[1]/R[3]),Z=new s.P(B[0]/B[3],B[1]/B[3]),Y=s.aA(S,H)&&R[3]<U[3],Q=s.aA(S,Z)&&B[3]<U[3];if(!Y&&!Q)return null;const te=function(ve,Me,be){for(let Ce=1;Ce<ve.length;Ce++){const $e=oo(Me.pointCoordinate3D(ve[Ce-1]).x),Ne=oo(Me.pointCoordinate3D(ve[Ce]).x);if(be<0){if($e<Ne)return{idx:Ce,t:-$e/(Ne-1-$e)}}else if(Ne<$e)return{idx:Ce,t:(1-$e)/(Ne+1-$e)}}return null}(S,A,Y?-1:1);if(!te)return null;const{idx:ee,t:K}=te;let ce=ee>1?os(S.slice(0,ee),A):[],ge=ee<S.length?os(S.slice(ee),A):[];ce=ce.map(ve=>new s.P(oo(ve.x),ve.y)),ge=ge.map(ve=>new s.P(oo(ve.x),ve.y));const _e=[...ce];_e.length===0&&_e.push(ge[ge.length-1]);const se=s.n(_e[_e.length-1].y,(ge.length===0?ce[0]:ge[0]).y,K);let ue;return ue=Y?[new s.P(0,se),new s.P(0,0),new s.P(1,0),new s.P(1,se)]:[new s.P(1,se),new s.P(1,1),new s.P(0,1),new s.P(0,se)],_e.push(...ue),ge.length===0?_e.push(ce[0]):_e.push(...ge),{polygon:_e.map(ve=>new s.M(ve.x,ve.y)),unwrapped:!1}}(l,f);if(v)return v;const w=function(S,A){let P=!1,R=-1/0,B=0;for(let H=0;H<S.length-1;H++)S[H].x>R&&(R=S[H].x,B=H);for(let H=0;H<S.length-1;H++){const Z=(B+H)%(S.length-1),Y=S[Z],Q=S[Z+1];Math.abs(Y.x-Q.x)>.5&&(Y.x<Q.x?(Y.x+=1,Z===0&&(S[S.length-1].x+=1)):(Q.x+=1,Z+1===S.length-1&&(S[0].x+=1)),P=!0)}const U=s.E(A.center.lng);return P&&U<Math.abs(U-1)&&S.forEach(H=>{H.x-=1}),{polygon:S,unwrapped:P}}(os(l,f).map(S=>new s.P(oo(S.x),S.y)),f);return{polygon:w.polygon.map(S=>new s.M(S.x,S.y)),unwrapped:w.unwrapped}}}function os(_,l){return s.aB(_,f=>{const v=l.pointCoordinate3D(f);f.x=v.x,f.y=v.y},1/256)}function oo(_){return _<0?1+_%1:_%1}function xo(_){return 100*_|0}function Po(_,l,f,v,w){const S=function(A,P){if(A)return w(A);if(P){_.url&&P.tiles&&_.tiles&&delete _.tiles;const R=s.p(s.ak(P,_),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);P.vector_layers&&(R.vectorLayers=P.vector_layers,R.vectorLayerIds=R.vectorLayers.map(B=>B.id)),R.tiles=l.canonicalizeTileset(R,_.url),w(null,R)}};return _.url?s.a1(l.transformRequest(l.normalizeSourceURL(_.url,null,f,v),s.a2.Source),S):s.a4.frame(()=>S(null,_))}class so{constructor(l,f,v){this.bounds=s.D.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=v||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const f=Math.pow(2,l.z),v=Math.floor(s.E(this.bounds.getWest())*f),w=Math.floor(s.H(this.bounds.getNorth())*f),S=Math.ceil(s.E(this.bounds.getEast())*f),A=Math.ceil(s.H(this.bounds.getSouth())*f);return l.x>=v&&l.x<S&&l.y>=w&&l.y<A}}class Be extends s.a6{constructor(l,f,v,w){if(super(),this.id=l,this.dispatcher=v,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.ak(this,s.p(f,["url","scheme","tileSize","promoteId"])),this._options=s.ak({type:"vector"},f),this._collectResourceTiming=!!f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w),this._tileWorkers={},this._deduped=new s.aD}load(l){this._loaded=!1,this.fire(new s.a8("dataloading",{dataType:"source"}));const f=Array.isArray(this.map._language)?this.map._language.join():this.map._language,v=this.map._worldview;this._tileJSONRequest=Po(this._options,this.map._requestManager,f,v,(w,S)=>{this._tileJSONRequest=null,this._loaded=!0,w?(f&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${f}`),v&&v.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${v}`),this.fire(new s.a7(w))):S&&(s.ak(this,S),S.bounds&&(this.tileBounds=new so(S.bounds,this.minzoom,this.maxzoom)),s.aH(S.tiles,this.map._requestManager._customAccessToken),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))),l&&l(w)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=s.aE(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.ak({},this._options)}loadTile(l,f){const v=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(v,s.a2.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.a4.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:l.isExtraShadowCaster};if(w.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired")l.state==="loading"?l.reloadCallback=f:l.request=l.actor.send("reloadTile",w,S.bind(this));else if(l.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",w,S.bind(this),void 0,!0);else{const A=s.aF.call({deduped:this._deduped},w,(P,R)=>{P||!R?S.call(this,P):(w.data={cacheControl:R.cacheControl,expires:R.expires,rawData:R.rawData.slice(0)},l.actor&&l.actor.send("loadTile",w,S.bind(this),void 0,!0))},!0);l.request={cancel:A}}function S(A,P){return delete l.request,l.aborted?f(null):A&&A.status!==404?f(A):(P&&P.resourceTiming&&(l.resourceTiming=P.resourceTiming),this.map._refreshExpiredTiles&&P&&l.setExpiryData(P),l.loadVectorData(P,this.map.painter),s.aG(this.dispatcher),f(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(l){l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ri extends s.a6{constructor(l,f,v,w){super(),this.id=l,this.dispatcher=v,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.ak({type:"raster"},f),s.ak(this,s.p(f,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new s.a8("dataloading",{dataType:"source"})),this._tileJSONRequest=Po(this._options,this.map._requestManager,null,null,(f,v)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new s.a7(f)):v&&(s.ak(this,v),v.bounds&&(this.tileBounds=new so(v.bounds,this.minzoom,this.maxzoom)),s.aH(v.tiles),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))),l&&l(f)})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=s.aE(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.ak({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,f){const v=s.a4.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),v,this.tileSize);l.request=s.a3(this.map._requestManager.transformRequest(w,s.a2.Tile),(S,A,P,R)=>(delete l.request,l.aborted?(l.state="unloaded",f(null)):S?(l.state="errored",f(S)):A?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:P,expires:R}),l.setTexture(A,this.map.painter),l.state="loaded",s.aG(this.dispatcher),void f(null)):f(null)))}abortTile(l,f){l.request&&(l.request.cancel(),delete l.request),f()}unloadTile(l,f){l.texture&&l.texture instanceof s.a9?(l.destroy(!0),l.texture&&l.texture instanceof s.a9&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),f()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const vs={vector:Be,raster:ri,"raster-dem":class extends ri{constructor(_,l,f,v){super(_,l,f,v),this.type="raster-dem",this.maxzoom=22,this._options=s.ak({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(_,l){const f=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function v(w,S){w&&(_.state="errored",l(w)),S&&(_.dem=S,_.dem.onDeserialize(),_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0,_.state="loaded",l(null))}_.request=s.a3(this.map._requestManager.transformRequest(f,s.a2.Tile),(function(w,S,A,P){if(delete _.request,_.aborted)_.state="unloaded",l(null);else if(w)_.state="errored",l(w);else if(S){this.map._refreshExpiredTiles&&_.setExpiryData({cacheControl:A,expires:P});const R=ImageBitmap&&S instanceof ImageBitmap&&s.aI(),B=1-(S.width-s.aJ(S.width))/2;B<1||_.neighboringTiles||(_.neighboringTiles=this._getNeighboringTiles(_.tileID));const U=R?S:s.a4.getImageData(S,B),H={uid:_.uid,coord:_.tileID,source:this.id,scope:this.scope,rawImageData:U,encoding:this.encoding,padding:B};_.actor&&_.state!=="expired"||(_.actor=this.dispatcher.getActor(),_.actor.send("loadDEMTile",H,v.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(_){const l=_.canonical,f=Math.pow(2,l.z),v=(l.x-1+f)%f,w=l.x===0?_.wrap-1:_.wrap,S=(l.x+1+f)%f,A=l.x+1===f?_.wrap+1:_.wrap,P={};return P[new s.O(_.overscaledZ,w,l.z,v,l.y).key]={backfilled:!1},P[new s.O(_.overscaledZ,A,l.z,S,l.y).key]={backfilled:!1},l.y>0&&(P[new s.O(_.overscaledZ,w,l.z,v,l.y-1).key]={backfilled:!1},P[new s.O(_.overscaledZ,_.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},P[new s.O(_.overscaledZ,A,l.z,S,l.y-1).key]={backfilled:!1}),l.y+1<f&&(P[new s.O(_.overscaledZ,w,l.z,v,l.y+1).key]={backfilled:!1},P[new s.O(_.overscaledZ,_.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},P[new s.O(_.overscaledZ,A,l.z,S,l.y+1).key]={backfilled:!1}),P}},geojson:class extends s.a6{constructor(_,l,f,v){super(),this.id=_,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=f.getActor(),this.setEventedParent(v),this._data=l.data,this._options=s.ak({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const w=s.J/this.tileSize;this.workerOptions=s.ak({source:this.id,scope:this.scope,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*w,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*w,extent:s.J,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:s.J,radius:(l.clusterRadius!==void 0?l.clusterRadius:50)*w,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions)}onAdd(_){this.map=_,this.setData(this._data)}setData(_){return this._data=_,this._updateWorkerData(),this}getClusterExpansionZoom(_,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:_,source:this.id,scope:this.scope},l),this}getClusterChildren(_,l){return this.actor.send("geojson.getClusterChildren",{clusterId:_,source:this.id,scope:this.scope},l),this}getClusterLeaves(_,l,f,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:_,limit:l,offset:f},v),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.a8("dataloading",{dataType:"source"})),this._loaded=!1;const _=s.ak({},this.workerOptions);_.scope=this.scope;const l=this._data;typeof l=="string"?(_.request=this.map._requestManager.transformRequest(s.a4.resolveURL(l),s.a2.Source),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,_,(f,v)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new s.a7(f));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(w.resourceTiming=v.resourceTiming[this.id]),this.fire(new s.a8("data",w)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(_,l){const f=_.actor?"reloadTile":"loadTile";_.actor=this.actor;const v={type:this.type,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:s.a4.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};_.request=this.actor.send(f,v,(w,S)=>(delete _.request,_.destroy(),_.aborted?l(null):w?l(w):(_.loadVectorData(S,this.map.painter,f==="reloadTile"),l(null))),void 0,f==="loadTile")}abortTile(_){_.request&&(_.request.cancel(),delete _.request),_.aborted=!0}unloadTile(_){this.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id,scope:this.scope}),_.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.ak({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aK{constructor(_,l,f,v){super(_,l,f,v),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const _=this.options;this.urls=[];for(const l of _.urls)this.urls.push(this.map._requestManager.transformRequest(l,s.a2.Source).url);s.aL(this.urls,(l,f)=>{this._loaded=!0,l?this.fire(new s.a7(l)):f&&(this.video=f,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(_){if(this.video){const l=this.video.seekable;_<l.start(0)||_>l.end(0)?this.fire(new s.a7(new s.aM(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=_}}getVideo(){return this.video}onAdd(_){this.map||(this.map=_,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const _=this.map.painter.context,l=_.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new s.a9(_,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(_)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aK,model:class extends s.a6{constructor(_,l,f,v){super(),this.id=_,this.type="model",this.models=[],this._loaded=!1,this._options=l}load(){const _=[];for(const l in this._options.models){const f=this._options.models[l],v=s.aO(this.map._requestManager.transformRequest(f.uri,s.a2.Model).url).then(w=>{if(!w)return;const S=s.aP(w),A=new s.aQ(l,f.position,f.orientation,S);A.computeBoundsAndApplyParent(),this.models.push(A)}).catch(w=>{this.fire(new s.a7(new Error(`Could not load model ${l} from ${f.uri}: ${w.message}`)))});_.push(v)}return Promise.allSettled(_).then(()=>{this._loaded=!0,this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(l=>{this.fire(new s.a7(new Error(`Could not load models: ${l.message}`)))})}onAdd(_){this.map=_,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(_,l){}serialize(){return{type:"model"}}},"batched-model":class extends s.a6{constructor(_,l,f,v){super(),this.type="batched-model",this.id=_,this.tileSize=512,this._options=l,this.tiles=this._options.tiles,this.maxzoom=l.maxzoom||19,this.minzoom=l.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=f,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(v)}onAdd(_){this.map=_,this.load()}load(_){this._loaded=!1,this.fire(new s.a8("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map._worldview;this._tileJSONRequest=Po(this._options,this.map._requestManager,l,f,(v,w)=>{this._tileJSONRequest=null,this._loaded=!0,v?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),f&&f.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new s.a7(v))):w&&(s.ak(this,w),w.bounds&&(this.tileBounds=new so(w.bounds,this.minzoom,this.maxzoom)),s.aH(w.tiles,this.map._requestManager._customAccessToken),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))),_&&_(v)})}hasTransition(){return!1}hasTile(_){return!this.tileBounds||this.tileBounds.contains(_.canonical)}loaded(){return this._loaded}loadTile(_,l){const f=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme)),v={request:this.map._requestManager.transformRequest(f,s.a2.Tile),data:void 0,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,tileSize:this.tileSize*_.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:_.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(_.actor&&_.state!=="expired")if(_.state==="loading")_.reloadCallback=l;else{if(_.buckets){const S=Object.values(_.buckets);for(const A of S)A.dirty=!0;return void(_.state="loaded")}_.request=_.actor.send("reloadTile",v,w.bind(this))}else _.actor=this.dispatcher.getActor(),_.request=_.actor.send("loadTile",v,w.bind(this),void 0,!0);function w(S,A){return _.aborted?l(null):S&&S.status!==404?l(S):(A&&(A.resourceTiming&&(_.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&_.setExpiryData(A),_.buckets={..._.buckets,...A.buckets}),_.state="loaded",void l(null))}}serialize(){return s.ak({},this._options)}},canvas:class extends s.aK{constructor(_,l,f,v){super(_,l,f,v),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(w=>!Array.isArray(w)||w.length!==2||w.some(S=>typeof S!="number"))||this.fire(new s.a7(new s.aM(`sources.${_}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.a7(new s.aM(`sources.${_}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new s.a7(new s.aM(`sources.${_}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new s.a7(new s.aM(`sources.${_}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.a7(new s.aM(`sources.${_}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.a7(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(_){this.map=_,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let _=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,_=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,_=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const l=this.map.painter.context;this.texture?!_&&!this._playing||this.texture instanceof s.aN||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.a9(l,this.canvas,l.gl.RGBA,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const _ of[this.canvas.width,this.canvas.height])if(isNaN(_)||_<=0)return!0;return!1}},custom:class extends s.a6{constructor(_,l,f,v){super(),this.id=_,this.type="custom",this._dataType="raster",this._dispatcher=f,this._implementation=l,this.setEventedParent(v),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.a7(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.a7(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new so(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),s.ak(this,s.p(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.p(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(_){this._map=_,this._loaded=!1,this.fire(new s.a8("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(_),this.load()}onRemove(_){this._implementation.onRemove&&this._implementation.onRemove(_)}hasTile(_){if(this._implementation.hasTile){const{x:l,y:f,z:v}=_.canonical;return this._implementation.hasTile({x:l,y:f,z:v})}return!this.tileBounds||this.tileBounds.contains(_.canonical)}loadTile(_,l){const{x:f,y:v,z:w}=_.tileID.canonical,S=new AbortController;_.request=Promise.resolve(this._implementation.loadTile({x:f,y:v,z:w},{signal:S.signal})).then((function(A){return delete _.request,_.aborted?(_.state="unloaded",l(null)):A===void 0?(_.state="errored",l(null)):A===null?(this.loadTileData(_,{width:this.tileSize,height:this.tileSize,data:null}),_.state="loaded",l(null)):function(P){return P instanceof ImageData||P instanceof HTMLCanvasElement||P instanceof ImageBitmap||P instanceof HTMLImageElement}(A)?(this.loadTileData(_,A),_.state="loaded",void l(null)):(_.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(A=>{A.code!==20&&(_.state="errored",l(A))}),_.request.cancel=()=>S.abort()}loadTileData(_,l){_.setTexture(l,this._map.painter)}unloadTile(_,l){if(_.texture&&_.texture instanceof s.a9?(_.destroy(!0),_.texture&&_.texture instanceof s.a9&&this._map.painter.saveTileTexture(_.texture)):_.destroy(),this._implementation.unloadTile){const{x:f,y:v,z:w}=_.tileID.canonical;this._implementation.unloadTile({x:f,y:v,z:w})}l()}abortTile(_,l){_.request&&_.request.cancel&&(_.request.cancel(),delete _.request),l()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(_=>({x:_.canonical.x,y:_.canonical.y,z:_.canonical.z}))}_clearTiles(){const _=s.aE(this.id,this.scope);this._map.style.clearSource(_)}_update(){this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))}}},ss=function(_,l,f,v){const w=new vs[l.type](_,l,f,v);if(w.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${w.id}`);return s.aR(["load","abort","unload","serialize","prepare"],w),w};function dr(_,l){const f=s.m.identity([]);return s.m.scale(f,f,[.5*_.width,.5*-_.height,1]),s.m.translate(f,f,[1,-1,0]),s.m.multiply(f,f,_.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(f)}function as(_,l,f,v,w,S,A,P=!1){const R=_.tilesIn(v,A,P);R.sort(Vo);const B=[];for(const H of R)B.push({wrappedTileID:H.tile.tileID.wrapped().key,queryResults:H.tile.queryRenderedFeatures(l,f,_._state,H,w,S,dr(_.transform,H.tile.tileID),P)});const U=function(H){const Z={},Y={};for(const Q of H){const te=Q.queryResults,ee=Q.wrappedTileID,K=Y[ee]=Y[ee]||{};for(const ce in te){const ge=te[ce],_e=K[ce]=K[ce]||{},se=Z[ce]=Z[ce]||[];for(const ue of ge)_e[ue.featureIndex]||(_e[ue.featureIndex]=!0,se.push(ue))}}return Z}(B);for(const H in U)U[H].forEach(Z=>{const Y=Z.feature,Q=Y.layer;Q&&Q.type!=="background"&&Q.type!=="sky"&&Q.type!=="slot"&&(Y.source=Q.source,Q["source-layer"]&&(Y.sourceLayer=Q["source-layer"]),Y.state=Y.id!==void 0?_.getFeatureState(Q["source-layer"],Y.id):{})});return U}function zh(_,l){const f=_.getRenderableIds().map(S=>_.getTileByID(S)),v=[],w={};for(let S=0;S<f.length;S++){const A=f[S],P=A.tileID.canonical.key;w[P]||(w[P]=!0,A.querySourceFeatures(v,l))}return v}function Vo(_,l){const f=_.tileID,v=l.tileID;return f.overscaledZ-v.overscaledZ||f.canonical.y-v.canonical.y||f.wrap-v.wrap||f.canonical.x-v.canonical.x}class vu{constructor(l){this.style=l}processLayersChanged(){this.layers=[];for(const l in this.style._mergedLayers){const f=this.style._mergedLayers[l];if(f.type==="fill-extrusion")this.layers.push(f);else if(f.type==="model"){const v=this.style.getLayerSource(f);v&&v.type==="batched-model"&&this.layers.push(f)}}}updateZOffset(l,f){this.currentBuildingBuckets=[];for(let w=0;w<this.layers.length;++w){const S=this.layers[w],A=this.style.getLayerSourceCache(S);let P=1;S.type==="fill-extrusion"&&(P=S.paint.get("fill-extrusion-opacity")>0?S.paint.get("fill-extrusion-vertical-scale"):0);let R=A?A.getTile(f):null;if(!R&&A&&f.canonical.z>A.getSource().minzoom){let B=f.scaledTo(Math.min(A.getSource().maxzoom,f.overscaledZ-1));for(;B.overscaledZ>=A.getSource().minzoom&&(R=A.getTile(B),!R&&B.overscaledZ!==0);)B=B.scaledTo(B.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:R?R.getBucket(S):null,tileID:R?R.tileID:f,verticalScale:P})}l.hasAnyZOffset=!1;let v=!1;for(let w=0;w<l.symbolInstances.length;w++){const S=l.symbolInstances.get(w),A=S.zOffset,P=this._getHeightAtTileOffset(f,S.tileAnchorX,S.tileAnchorY);S.zOffset=P!==-1?P:A,v||A===S.zOffset||(v=!0),l.hasAnyZOffset||S.zOffset===0||(l.hasAnyZOffset=!0)}v&&(l.zOffsetBuffersNeedUpload=!0,l.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(l,f,v,w){let S=f,A=v;if(l.canonical.z!==w.canonical.z){const P=w.canonical,R=1/(1<<l.canonical.z-P.z);S=(f+l.canonical.x*s.J)*R-P.x*s.J|0,A=(v+l.canonical.y*s.J)*R-P.y*s.J|0}return{tileX:S,tileY:A}}_getHeightAtTileOffset(l,f,v){let w,S;for(let A=0;A<this.layers.length;++A){if(this.layers[A].type!=="fill-extrusion")continue;const{bucket:P,tileID:R,verticalScale:B}=this.currentBuildingBuckets[A];if(!P)continue;const{tileX:U,tileY:H}=this._mapCoordToOverlappingTile(l,f,v,R),Z=P.getHeightAtTileCoord(U,H);Z&&Z.height!==void 0&&(Z.hidden?w=Z.height:S=Math.max(Z.height*B,S||0))}if(S!==void 0)return S;for(let A=0;A<this.layers.length;++A){if(this.layers[A].type!=="model")continue;const{bucket:P,tileID:R}=this.currentBuildingBuckets[A];if(!P)continue;const{tileX:B,tileY:U}=this._mapCoordToOverlappingTile(l,f,v,R),H=P.getHeightAtTileCoord(B,U);if(H&&!H.hidden)return H.height===void 0&&w!==void 0?Math.min(H.maxHeight,w)*H.verticalScale:(H.height||0)*H.verticalScale}return-1}}function sd(_,l){const f={};for(const v in _)v!=="ref"&&(f[v]=_[v]);return s.aS.forEach(v=>{v in l&&(f[v]=l[v])}),f}function Sa(_){_=_.slice();const l=Object.create(null);for(let f=0;f<_.length;f++)l[_[f].id]=_[f];for(let f=0;f<_.length;f++)"ref"in _[f]&&(_[f]=sd(_[f],l[_[f].ref]));return _}const ct={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function L(_,l,f){f.push({command:ct.addSource,args:[_,l[_]]})}function G(_,l,f){l.push({command:ct.removeSource,args:[_]}),f[_]=!0}function le(_,l,f,v){G(_,f,v),L(_,l,f)}function we(_,l,f){let v;for(v in _[f])if(_[f].hasOwnProperty(v)&&v!=="data"&&!M(_[f][v],l[f][v]))return!1;for(v in l[f])if(l[f].hasOwnProperty(v)&&v!=="data"&&!M(_[f][v],l[f][v]))return!1;return!0}function Se(_,l,f,v,w,S){let A;for(A in l=l||{},_=_||{})_.hasOwnProperty(A)&&(M(_[A],l[A])||f.push({command:S,args:[v,A,l[A],w]}));for(A in l)l.hasOwnProperty(A)&&!_.hasOwnProperty(A)&&(M(_[A],l[A])||f.push({command:S,args:[v,A,l[A],w]}))}function Oe(_){return _.id}function Ve(_,l){return _[l.id]=l,_}class Ft{constructor(l,f){this.reset(l,f)}reset(l,f){this.points=l||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=s.c(l,0,1);let f=1,v=this._distances[f];const w=l*this.paddedLength+this.padding;for(;v<w&&f<this._distances.length;)v=this._distances[++f];const S=f-1,A=this._distances[S],P=v-A,R=P>0?(w-A)/P:0;return this.points[S].mult(1-R).add(this.points[f].mult(R))}}class Nt{constructor(l,f,v){const w=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(l/v),this.yCellCount=Math.ceil(f/v);for(let A=0;A<this.xCellCount*this.yCellCount;A++)w.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,f,v,w,S){this._forEachCell(f,v,w,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(v),this.bboxes.push(w),this.bboxes.push(S)}insertCircle(l,f,v,w){this._forEachCell(f-w,v-w,f+w,v+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(v),this.circles.push(w)}_insertBoxCell(l,f,v,w,S,A){this.boxCells[S].push(A)}_insertCircleCell(l,f,v,w,S,A){this.circleCells[S].push(A)}_query(l,f,v,w,S,A){if(v<0||l>this.width||w<0||f>this.height)return!S&&[];const P=[];if(l<=0&&f<=0&&this.width<=v&&this.height<=w){if(S)return!0;for(let R=0;R<this.boxKeys.length;R++)P.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const B=this.circles[3*R],U=this.circles[3*R+1],H=this.circles[3*R+2];P.push({key:this.circleKeys[R],x1:B-H,y1:U-H,x2:B+H,y2:U+H})}return A?P.filter(A):P}return this._forEachCell(l,f,v,w,this._queryCell,P,{hitTest:S,seenUids:{box:{},circle:{}}},A),S?P.length>0:P}_queryCircle(l,f,v,w,S){const A=l-v,P=l+v,R=f-v,B=f+v;if(P<0||A>this.width||B<0||R>this.height)return!w&&[];const U=[];return this._forEachCell(A,R,P,B,this._queryCellCircle,U,{hitTest:w,circle:{x:l,y:f,radius:v},seenUids:{box:{},circle:{}}},S),w?U.length>0:U}query(l,f,v,w,S){return this._query(l,f,v,w,!1,S)}hitTest(l,f,v,w,S){return this._query(l,f,v,w,!0,S)}hitTestCircle(l,f,v,w){return this._queryCircle(l,f,v,!0,w)}_queryCell(l,f,v,w,S,A,P,R){const B=P.seenUids,U=this.boxCells[S];if(U!==null){const Z=this.bboxes;for(const Y of U)if(!B.box[Y]){B.box[Y]=!0;const Q=4*Y;if(l<=Z[Q+2]&&f<=Z[Q+3]&&v>=Z[Q+0]&&w>=Z[Q+1]&&(!R||R(this.boxKeys[Y]))){if(P.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[Y],x1:Z[Q],y1:Z[Q+1],x2:Z[Q+2],y2:Z[Q+3]})}}}const H=this.circleCells[S];if(H!==null){const Z=this.circles;for(const Y of H)if(!B.circle[Y]){B.circle[Y]=!0;const Q=3*Y;if(this._circleAndRectCollide(Z[Q],Z[Q+1],Z[Q+2],l,f,v,w)&&(!R||R(this.circleKeys[Y]))){if(P.hitTest)return A.push(!0),!0;{const te=Z[Q],ee=Z[Q+1],K=Z[Q+2];A.push({key:this.circleKeys[Y],x1:te-K,y1:ee-K,x2:te+K,y2:ee+K})}}}}}_queryCellCircle(l,f,v,w,S,A,P,R){const B=P.circle,U=P.seenUids,H=this.boxCells[S];if(H!==null){const Y=this.bboxes;for(const Q of H)if(!U.box[Q]){U.box[Q]=!0;const te=4*Q;if(this._circleAndRectCollide(B.x,B.y,B.radius,Y[te+0],Y[te+1],Y[te+2],Y[te+3])&&(!R||R(this.boxKeys[Q])))return A.push(!0),!0}}const Z=this.circleCells[S];if(Z!==null){const Y=this.circles;for(const Q of Z)if(!U.circle[Q]){U.circle[Q]=!0;const te=3*Q;if(this._circlesCollide(Y[te],Y[te+1],Y[te+2],B.x,B.y,B.radius)&&(!R||R(this.circleKeys[Q])))return A.push(!0),!0}}}_forEachCell(l,f,v,w,S,A,P,R){const B=this._convertToXCellCoord(l),U=this._convertToYCellCoord(f),H=this._convertToXCellCoord(v),Z=this._convertToYCellCoord(w);for(let Y=B;Y<=H;Y++)for(let Q=U;Q<=Z;Q++)if(S.call(this,l,f,v,w,this.xCellCount*Q+Y,A,P,R))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,f,v,w,S,A){const P=w-l,R=S-f,B=v+A;return B*B>P*P+R*R}_circleAndRectCollide(l,f,v,w,S,A,P){const R=(A-w)/2,B=Math.abs(l-(w+R));if(B>R+v)return!1;const U=(P-S)/2,H=Math.abs(f-(S+U));if(H>U+v)return!1;if(B<=R||H<=U)return!0;const Z=B-R,Y=H-U;return Z*Z+Y*Y<=v*v}}const Lt=100;class di{constructor(l,f,v=new Nt(l.width+200,l.height+200,25),w=new Nt(l.width+200,l.height+200,25)){this.transform=l,this.grid=v,this.ignoredGrid=w,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Lt,this.screenBottomBoundary=l.height+Lt,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=f}placeCollisionBox(l,f,v,w,S,A,P,R){let B=v.projectedAnchorX,U=v.projectedAnchorY,H=v.projectedAnchorZ;const Z=v.elevation,Y=v.tileID,Q=l.getProjection();if(Z&&Y){const[ue,ve,Me]=Q.upVector(Y.canonical,v.tileAnchorX,v.tileAnchorY),be=Q.upVectorScale(Y.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;B+=ue*Z*be,U+=ve*Z*be,H+=Me*Z*be}const te=this.projectAndGetPerspectiveRatio(P,B,U,H,v.tileID,Q.name==="globe"||!!Z||this.transform.pitch>0,Q),ee=A*te.perspectiveRatio,K=(v.x1*f+w.x-v.padding)*ee+te.point.x,ce=(v.y1*f+w.y-v.padding)*ee+te.point.y,ge=(v.x2*f+w.x+v.padding)*ee+te.point.x,_e=(v.y2*f+w.y+v.padding)*ee+te.point.y,se=te.perspectiveRatio<=.55||te.occluded;return!this.isInsideGrid(K,ce,ge,_e)||!S&&this.grid.hitTest(K,ce,ge,_e,R)||se?{box:[],offscreen:!1,occluded:te.occluded}:{box:[K,ce,ge,_e],offscreen:this.isOffscreen(K,ce,ge,_e),occluded:!1}}placeCollisionCircles(l,f,v,w,S,A,P,R,B,U,H,Z,Y,Q,te){const ee=[],K=this.transform.elevation,ce=l.getProjection(),ge=K?K.getAtTileOffsetFunc(te,this.transform.center.lat,this.transform.worldSize,ce):null,_e=new s.P(v.tileAnchorX,v.tileAnchorY);let{x:se,y:ue,z:ve}=ce.projectTilePoint(_e.x,_e.y,te.canonical);if(ge){const[nt,de,ze]=ge(_e);se+=nt,ue+=de,ve+=ze}const Me=ce.name==="globe",be=this.projectAndGetPerspectiveRatio(P,se,ue,ve,te,Me||!!K||this.transform.pitch>0,ce),{perspectiveRatio:Ce}=be,$e=(H?A/Ce:A*Ce)/s.aV,Ne=Ar(se,ue,ve,R),qe=be.signedDistanceFromCamera>0?St($e,S,v.lineOffsetX*$e,v.lineOffsetY*$e,!1,Ne,_e,v,w,R,{},K&&!H?ge:null,H&&!!K,ce,te,H):null;let Le=!1,Ke=!1,He=!0;if(qe&&!be.occluded){const nt=.5*Y*Ce+Q,de=new s.P(-100,-100),ze=new s.P(this.screenRightBoundary,this.screenBottomBoundary),_t=new Ft,{first:ut,last:ti}=qe,Ht=ut.path.length;let hi=[];for(let yi=Ht-1;yi>=1;yi--)hi.push(ut.path[yi]);for(let yi=1;yi<ti.path.length;yi++)hi.push(ti.path[yi]);const Jt=2.5*nt;B&&(hi=hi.map(([yi,oi,li],tn)=>(ge&&!Me&&(li=ge(tn<Ht-1?ut.tilePath[Ht-1-tn]:ti.tilePath[tn-Ht+2])[2]),Ar(yi,oi,li,B))),hi.some(yi=>yi[3]<=0)&&(hi=[]));let _i=[];if(hi.length>0){let yi=1/0,oi=-1/0,li=1/0,tn=-1/0;for(const Li of hi)yi=Math.min(yi,Li[0]),li=Math.min(li,Li[1]),oi=Math.max(oi,Li[0]),tn=Math.max(tn,Li[1]);oi>=de.x&&yi<=ze.x&&tn>=de.y&&li<=ze.y&&(_i=[hi.map(Li=>new s.P(Li[0],Li[1]))],(yi<de.x||oi>ze.x||li<de.y||tn>ze.y)&&(_i=s.aT(_i,de.x,de.y,ze.x,ze.y)))}for(const yi of _i){_t.reset(yi,.25*nt);let oi=0;oi=_t.length<=.5*nt?1:Math.ceil(_t.paddedLength/Jt)+1;for(let li=0;li<oi;li++){const tn=li/Math.max(oi-1,1),Li=_t.lerp(tn),Nn=Li.x+Lt,Mn=Li.y+Lt;ee.push(Nn,Mn,nt,0);const Do=Nn-nt,As=Mn-nt,yn=Nn+nt,sn=Mn+nt;if(He=He&&this.isOffscreen(Do,As,yn,sn),Ke=Ke||this.isInsideGrid(Do,As,yn,sn),!f&&this.grid.hitTestCircle(Nn,Mn,nt,Z)&&(Le=!0,!U))return{circles:[],offscreen:!1,collisionDetected:Le,occluded:!1}}}}return{circles:!U&&Le||!Ke?[]:ee,offscreen:He,collisionDetected:Le,occluded:be.occluded}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let v=1/0,w=1/0,S=-1/0,A=-1/0;for(const U of l){const H=new s.P(U.x+Lt,U.y+Lt);v=Math.min(v,H.x),w=Math.min(w,H.y),S=Math.max(S,H.x),A=Math.max(A,H.y),f.push(H)}const P=this.grid.query(v,w,S,A).concat(this.ignoredGrid.query(v,w,S,A)),R={},B={};for(const U of P){const H=U.key;if(R[H.bucketInstanceId]===void 0&&(R[H.bucketInstanceId]={}),R[H.bucketInstanceId][H.featureIndex])continue;const Z=[new s.P(U.x1,U.y1),new s.P(U.x2,U.y1),new s.P(U.x2,U.y2),new s.P(U.x1,U.y2)];s.aU(f,Z)&&(R[H.bucketInstanceId][H.featureIndex]=!0,B[H.bucketInstanceId]===void 0&&(B[H.bucketInstanceId]=[]),B[H.bucketInstanceId].push(H.featureIndex))}return B}insertCollisionBox(l,f,v,w,S){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:w,collisionGroupID:S},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,f,v,w,S){const A=f?this.ignoredGrid:this.grid,P={bucketInstanceId:v,featureIndex:w,collisionGroupID:S};for(let R=0;R<l.length;R+=4)A.insertCircle(P,l[R],l[R+1],l[R+2])}projectAndGetPerspectiveRatio(l,f,v,w,S,A,P){const R=[f,v,w,1];let B=!1;w||this.transform.pitch>0?(s.e.transformMat4(R,R,l),this.fogState&&S&&P.name!=="globe"&&(B=function(Z,Y,Q,te,ee,K){const ce=K.calculateFogTileMatrix(ee),ge=[Y,Q,te];return s.v.transformMat4(ge,ge,ce),ys(Z,s.v.length(ge),K.pitch,K._fov)}(this.fogState,f,v,w,S.toUnwrapped(),this.transform)>.9)):Pi(R,R,l);const U=R[3];return{point:new s.P((R[0]/U+1)/2*this.transform.width+Lt,(-R[1]/U+1)/2*this.transform.height+Lt),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(P)/U*.5,1.5),signedDistanceFromCamera:U,occluded:A&&R[2]>U||B}}isOffscreen(l,f,v,w){return v<Lt||l>=this.screenRightBoundary||w<Lt||f>this.screenBottomBoundary}isInsideGrid(l,f,v,w){return v>=0&&l<this.gridRightBoundary&&w>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const l=s.m.identity([]);return s.m.translate(l,l,[-100,-100,0]),l}}function Qt(_,l,f){const v=l.createTileMatrix(_,_.worldSize,f.toUnwrapped());return s.m.multiply(new Float32Array(16),_.projMatrix,v)}function Xi(_,l,f){if(l.projection.name===f.projection.name)return _.projMatrix;const v=f.clone();return v.setProjection(l.projection),Qt(v,l.getProjection(),_)}function Gn(_,l,f){return l.name===f.projection.name?_.projMatrix:Qt(f,l,_)}class Ki{constructor(l,f,v,w){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):w&&v?1:0,this.placed=v}isHidden(){return this.opacity===0&&!this.placed}}class cr{constructor(l,f,v,w,S,A=!1){this.text=new Ki(l?l.text:null,f,v,S),this.icon=new Ki(l?l.icon:null,f,w,S),this.clipped=A}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class At{constructor(l,f,v,w=!1){this.text=l,this.icon=f,this.skipFade=v,this.clipped=w}}class wi{constructor(){this.invProjMatrix=s.m.create(),this.viewportMatrix=s.m.create(),this.circles=[]}}class Cn{constructor(l,f,v,w,S){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=v,this.bucketIndex=w,this.tileID=S}}class Or{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:v=>v.collisionGroupID===f}}return this.collisionGroups[l]}}function Sn(_,l,f,v,w){const{horizontalAlign:S,verticalAlign:A}=s.aY(_),P=-(S-.5)*l,R=-(A-.5)*f,B=s.aW(_,v);return new s.P(P+B[0]*w,R+B[1]*w)}function Ln(_,l,f,v,w){const S=new s.P(_,l);return f&&S._rotate(v?w:-w),S}class xu{constructor(l,f,v,w,S,A){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new di(this.transform,S),this.buildingIndex=A,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new Or(v),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,f,v,w){const S=v.getBucket(f),A=v.latestFeatureIndex;if(!S||!A||f.fqid!==S.layerIds[0])return;const P=S.layers[0].layout,R=v.collisionBoxArray,B=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),U=v.tileSize/s.J,H=v.tileID.toUnwrapped();this.transform.setProjection(S.projection);const Z=(Y=v.tileID,Q=S.getProjection(),te=this.transform,Q.name===this.projection?te.calculateProjMatrix(Y.toUnwrapped()):Qt(te,Q,Y));var Y,Q,te;const ee=P.get("text-pitch-alignment")==="map",K=P.get("text-rotation-alignment")==="map";f.compileFilter();const ce=f.dynamicFilter(),ge=f.dynamicFilterNeedsFeature(),_e=this.transform.calculatePixelsToTileUnitsMatrix(v),se=yo(Z,v.tileID.canonical,ee,K,this.transform,S.getProjection(),_e);let ue=null;if(ee){const be=jr(Z,v.tileID.canonical,ee,K,this.transform,S.getProjection(),_e);ue=s.m.multiply([],this.transform.labelPlaneMatrix,be)}let ve=null;ce&&v.latestFeatureIndex&&(ve={unwrappedTileID:H,dynamicFilter:ce,dynamicFilterNeedsFeature:ge,featureIndex:v.latestFeatureIndex}),this.retainedQueryData[S.bucketInstanceId]=new Cn(S.bucketInstanceId,A,S.sourceLayerIndex,S.index,v.tileID);const Me={bucket:S,layout:P,posMatrix:Z,textLabelPlaneMatrix:se,labelToScreenMatrix:ue,clippingData:ve,scale:B,textPixelRatio:U,holdingForFade:v.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:s.i(S.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.i(S.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(w)for(const be of S.sortKeyRanges){const{sortKey:Ce,symbolInstanceStart:$e,symbolInstanceEnd:Ne}=be;l.push({sortKey:Ce,symbolInstanceStart:$e,symbolInstanceEnd:Ne,parameters:Me})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:Me})}attemptAnchorPlacement(l,f,v,w,S,A,P,R,B,U,H,Z,Y,Q,te,ee,K,ce){const{textOffset0:ge,textOffset1:_e,crossTileID:se}=Z,ue=[ge,_e],ve=Sn(l,v,w,ue,S),Me=this.collisionIndex.placeCollisionBox(Q,S,f,Ln(ve.x,ve.y,A,P,this.transform.angle),H,R,B,U.predicate);if(ee){const be=Q.getSymbolInstanceIconSize(ce,this.transform.zoom,Z.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Q,be,ee,Ln(ve.x,ve.y,A,P,this.transform.angle),H,R,B,U.predicate).box.length===0)return}if(Me.box.length>0){let be;return this.prevPlacement&&this.prevPlacement.variableOffsets[se]&&this.prevPlacement.placements[se]&&this.prevPlacement.placements[se].text&&(be=this.prevPlacement.variableOffsets[se].anchor),this.variableOffsets[se]={textOffset:ue,width:v,height:w,anchor:l,textScale:S,prevAnchor:be},this.markUsedJustification(Q,l,Z,te),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,te,Z),this.placedOrientations[se]=te),{shift:ve,placedGlyphBoxes:Me}}}placeLayerBucketPart(l,f,v,w){const{bucket:S,layout:A,posMatrix:P,textLabelPlaneMatrix:R,labelToScreenMatrix:B,clippingData:U,textPixelRatio:H,holdingForFade:Z,collisionBoxArray:Y,partiallyEvaluatedTextSize:Q,partiallyEvaluatedIconSize:te,collisionGroup:ee}=l.parameters,K=A.get("text-optional"),ce=A.get("icon-optional"),ge=A.get("text-allow-overlap"),_e=A.get("icon-allow-overlap"),se=A.get("text-rotation-alignment")==="map",ue=A.get("text-pitch-alignment")==="map",ve=A.get("symbol-z-order")==="viewport-y",Me=A.get("symbol-z-elevate");this.transform.setProjection(S.projection);let be=ge&&(_e||!S.hasIconData()||ce),Ce=_e&&(ge||!S.hasTextData()||K);!S.collisionArrays&&Y&&S.deserializeCollisionBoxes(Y),v&&w&&S.updateCollisionDebugBuffers(this.transform.zoom,Y);const $e=(Ne,qe,Le)=>{const{crossTileID:Ke,numVerticalGlyphVertices:He}=Ne;if(U){const yn={zoom:this.transform.zoom,pitch:this.transform.pitch};let sn=null;if(U.dynamicFilterNeedsFeature){const fn=this.retainedQueryData[S.bucketInstanceId];sn=U.featureIndex.loadFeature({featureIndex:Ne.featureIndex,bucketIndex:fn.bucketIndex,sourceLayerIndex:fn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,U.dynamicFilter)(yn,sn,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new s.P(Ne.tileAnchorX,Ne.tileAnchorY),this.transform.calculateDistanceTileData(U.unwrappedTileID)))return this.placements[Ke]=new At(!1,!1,!1,!0),void f.add(Ke)}if(f.has(Ke))return;if(Z)return void(this.placements[Ke]=new At(!1,!1,!1));let nt=!1,de=!1,ze=!0,_t=!1,ut=!1,ti=null,Ht={box:null,offscreen:null,occluded:null},hi={box:null,offscreen:null,occluded:null},Jt=null,_i=null,yi=null,oi=0,li=0,tn=0;Le.textFeatureIndex?oi=Le.textFeatureIndex:Ne.useRuntimeCollisionCircles&&(oi=Ne.featureIndex),Le.verticalTextFeatureIndex&&(li=Le.verticalTextFeatureIndex);const Li=yn=>{yn.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const sn=this.transform.elevation;yn.elevation=Ne.zOffset+(sn?sn.getAtTileOffset(yn.tileID,yn.tileAnchorX,yn.tileAnchorY):0)},Nn=Le.textBox;if(Nn){Li(Nn);const yn=fn=>{let Jn=s.W.horizontal;if(S.allowVerticalPlacement&&!fn&&this.prevPlacement){const Kr=this.prevPlacement.placedOrientations[Ke];Kr&&(this.placedOrientations[Ke]=Kr,Jn=Kr,this.markUsedOrientation(S,Jn,Ne))}return Jn},sn=(fn,Jn)=>{if(S.allowVerticalPlacement&&He>0&&Le.verticalTextBox){for(const Kr of S.writingModes)if(Kr===s.W.vertical?(Ht=Jn(),hi=Ht):Ht=fn(),Ht&&Ht.box&&Ht.box.length)break}else Ht=fn()};if(A.get("text-variable-anchor")){let fn=A.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ke]){const Hn=this.prevPlacement.variableOffsets[Ke];fn.indexOf(Hn.anchor)>0&&(fn=fn.filter(co=>co!==Hn.anchor),fn.unshift(Hn.anchor))}const Jn=(Hn,co,Lo)=>{const uo=S.getSymbolInstanceTextSize(Q,Ne,this.transform.zoom,qe),Is=(Hn.x2-Hn.x1)*uo+2*Hn.padding,Ra=(Hn.y2-Hn.y1)*uo+2*Hn.padding,Ws=Ne.hasIconTextFit&&!_e?co:null;Ws&&Li(Ws);let An={box:[],offscreen:!1,occluded:!1};const qs=ge?2*fn.length:fn.length;for(let ca=0;ca<qs;++ca){const za=this.attemptAnchorPlacement(fn[ca%fn.length],Hn,Is,Ra,uo,se,ue,H,P,ee,ca>=fn.length,Ne,qe,S,Lo,Ws,Q,te);if(za&&(An=za.placedGlyphBoxes,An&&An.box&&An.box.length)){nt=!0,ti=za.shift;break}}return An};sn(()=>Jn(Nn,Le.iconBox,s.W.horizontal),()=>{const Hn=Le.verticalTextBox;return Hn&&Li(Hn),S.allowVerticalPlacement&&!(Ht&&Ht.box&&Ht.box.length)&&He>0&&Hn?Jn(Hn,Le.verticalIconBox,s.W.vertical):{box:null,offscreen:null,occluded:null}}),Ht&&(nt=Ht.box,ze=Ht.offscreen,_t=Ht.occluded);const Kr=yn(!(!Ht||!Ht.box));if(!nt&&this.prevPlacement){const Hn=this.prevPlacement.variableOffsets[Ke];Hn&&(this.variableOffsets[Ke]=Hn,this.markUsedJustification(S,Hn.anchor,Ne,Kr))}}else{const fn=(Jn,Kr)=>{const Hn=S.getSymbolInstanceTextSize(Q,Ne,this.transform.zoom,qe),co=this.collisionIndex.placeCollisionBox(S,Hn,Jn,new s.P(0,0),ge,H,P,ee.predicate);return co&&co.box&&co.box.length&&(this.markUsedOrientation(S,Kr,Ne),this.placedOrientations[Ke]=Kr),co};sn(()=>fn(Nn,s.W.horizontal),()=>{const Jn=Le.verticalTextBox;return S.allowVerticalPlacement&&He>0&&Jn?(Li(Jn),fn(Jn,s.W.vertical)):{box:null,offscreen:null,occluded:null}}),yn(!!(Ht&&Ht.box&&Ht.box.length))}}if(Jt=Ht,nt=Jt&&Jt.box&&Jt.box.length>0,ze=Jt&&Jt.offscreen,_t=Jt&&Jt.occluded,Ne.useRuntimeCollisionCircles){const yn=S.text.placedSymbolArray.get(Ne.centerJustifiedTextSymbolIndex>=0?Ne.centerJustifiedTextSymbolIndex:Ne.verticalPlacedTextSymbolIndex),sn=s.j(S.textSizeData,Q,yn),fn=A.get("text-padding");_i=this.collisionIndex.placeCollisionCircles(S,ge,yn,S.lineVertexArray,S.glyphOffsetArray,sn,P,R,B,v,ue,ee.predicate,Ne.collisionCircleDiameter*sn/s.aV,fn,this.retainedQueryData[S.bucketInstanceId].tileID),nt=ge||_i.circles.length>0&&!_i.collisionDetected,ze=ze&&_i.offscreen,_t=_i.occluded}if(Le.iconFeatureIndex&&(tn=Le.iconFeatureIndex),Le.iconBox){const yn=sn=>{Li(sn);const fn=Ne.hasIconTextFit&&ti?Ln(ti.x,ti.y,se,ue,this.transform.angle):new s.P(0,0),Jn=S.getSymbolInstanceIconSize(te,this.transform.zoom,Ne.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,Jn,sn,fn,_e,H,P,ee.predicate)};hi&&hi.box&&hi.box.length&&Le.verticalIconBox?(yi=yn(Le.verticalIconBox),de=yi.box.length>0):(yi=yn(Le.iconBox),de=yi.box.length>0),ze=ze&&yi.offscreen,ut=yi.occluded}const Mn=K||Ne.numHorizontalGlyphVertices===0&&He===0,Do=ce||Ne.numIconVertices===0;if(Mn||Do?Do?Mn||(de=de&&nt):nt=de&&nt:de=nt=de&&nt,nt&&Jt&&Jt.box&&this.collisionIndex.insertCollisionBox(Jt.box,A.get("text-ignore-placement"),S.bucketInstanceId,hi&&hi.box&&li?li:oi,ee.ID),de&&yi&&this.collisionIndex.insertCollisionBox(yi.box,A.get("icon-ignore-placement"),S.bucketInstanceId,tn,ee.ID),_i&&(nt&&this.collisionIndex.insertCollisionCircles(_i.circles,A.get("text-ignore-placement"),S.bucketInstanceId,oi,ee.ID),v)){const yn=S.bucketInstanceId;let sn=this.collisionCircleArrays[yn];sn===void 0&&(sn=this.collisionCircleArrays[yn]=new wi);for(let fn=0;fn<_i.circles.length;fn+=4)sn.circles.push(_i.circles[fn+0]),sn.circles.push(_i.circles[fn+1]),sn.circles.push(_i.circles[fn+2]),sn.circles.push(_i.collisionDetected?1:0)}const As=S.projection.name!=="globe";be=be&&(As||!_t),Ce=Ce&&(As||!ut),this.placements[Ke]=new At(nt||be,de||Ce,ze||S.justReloaded),f.add(Ke)};if(Me&&this.buildingIndex&&(this.buildingIndex.updateZOffset(S,this.retainedQueryData[S.bucketInstanceId].tileID),S.updateZOffset()),ve){const Ne=S.getSortedSymbolIndexes(this.transform.angle);for(let qe=Ne.length-1;qe>=0;--qe){const Le=Ne[qe];$e(S.symbolInstances.get(Le),Le,S.collisionArrays[Le])}S.hasAnyZOffset&&s.X(`${S.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(S.hasAnyZOffset){const Ne=S.getSortedIndexesByZOffset();for(let qe=0;qe<Ne.length;++qe){const Le=Ne[qe];$e(S.symbolInstances.get(Le),Le,S.collisionArrays[Le])}}else for(let Ne=l.symbolInstanceStart;Ne<l.symbolInstanceEnd;Ne++)$e(S.symbolInstances.get(Ne),Ne,S.collisionArrays[Ne]);if(v&&S.bucketInstanceId in this.collisionCircleArrays){const Ne=this.collisionCircleArrays[S.bucketInstanceId];s.m.invert(Ne.invProjMatrix,P),Ne.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(l,f,v,w){const{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:R,crossTileID:B}=v,U=s.aX(f),H=w===s.W.vertical?R:U==="left"?S:U==="center"?A:U==="right"?P:-1;S>=0&&(l.text.placedSymbolArray.get(S).crossTileID=H>=0&&S!==H?0:B),A>=0&&(l.text.placedSymbolArray.get(A).crossTileID=H>=0&&A!==H?0:B),P>=0&&(l.text.placedSymbolArray.get(P).crossTileID=H>=0&&P!==H?0:B),R>=0&&(l.text.placedSymbolArray.get(R).crossTileID=H>=0&&R!==H?0:B)}markUsedOrientation(l,f,v){const w=f===s.W.horizontal||f===s.W.horizontalOnly?f:0,S=f===s.W.vertical?f:0,{leftJustifiedTextSymbolIndex:A,centerJustifiedTextSymbolIndex:P,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:B}=v,U=l.text.placedSymbolArray;A>=0&&(U.get(A).placedOrientation=w),P>=0&&(U.get(P).placedOrientation=w),R>=0&&(U.get(R).placedOrientation=w),B>=0&&(U.get(B).placedOrientation=S)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let v=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const w=f?f.symbolFadeChange(l):1,S=f?f.opacities:{},A=f?f.variableOffsets:{},P=f?f.placedOrientations:{};for(const R in this.placements){const B=this.placements[R],U=S[R];U?(this.opacities[R]=new cr(U,w,B.text,B.icon,null,B.clipped),v=v||B.text!==U.text.placed||B.icon!==U.icon.placed):(this.opacities[R]=new cr(null,w,B.text,B.icon,B.skipFade,B.clipped),v=v||B.text||B.icon)}for(const R in S){const B=S[R];if(!this.opacities[R]){const U=new cr(B,w,!1,!1);U.isHidden()||(this.opacities[R]=U,v=v||B.text.placed||B.icon.placed)}}for(const R in A)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=A[R]);for(const R in P)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=P[R]);v?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)}updateLayerOpacities(l,f){const v=new Set;for(const w of f){const S=w.getBucket(l);S&&w.latestFeatureIndex&&l.fqid===S.layerIds[0]&&(this.updateBucketOpacities(S,v,w.collisionBoxArray),S.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(S,w.tileID),S.updateZOffset()))}}updateBucketOpacities(l,f,v){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const w=l.layers[0].layout,S=!!l.layers[0].dynamicFilter(),A=new cr(null,0,!1,!1,!0),P=w.get("text-allow-overlap"),R=w.get("icon-allow-overlap"),B=w.get("text-variable-anchor"),U=w.get("text-rotation-alignment")==="map",H=w.get("text-pitch-alignment")==="map",Z=new cr(null,0,P&&(R||!l.hasIconData()||w.get("icon-optional")),R&&(P||!l.hasTextData()||w.get("text-optional")),!0);!l.collisionArrays&&v&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(v);const Y=(te,ee,K)=>{for(let ce=0;ce<ee/4;ce++)te.opacityVertexArray.emplaceBack(K)};let Q=0;for(let te=0;te<l.symbolInstances.length;te++){const ee=l.symbolInstances.get(te),{numHorizontalGlyphVertices:K,numVerticalGlyphVertices:ce,crossTileID:ge,numIconVertices:_e}=ee,se=f.has(ge);let ue=this.opacities[ge];se?ue=A:ue||(ue=Z,this.opacities[ge]=ue),f.add(ge);const ve=K>0||ce>0,Me=_e>0,be=this.placedOrientations[ge],Ce=be===s.W.vertical,$e=be===s.W.horizontal||be===s.W.horizontalOnly;if(!ve&&!Me||ue.isHidden()||Q++,ve){const Ne=Ea(ue.text);Y(l.text,K,Ce?pr:Ne),Y(l.text,ce,$e?pr:Ne);const qe=ue.text.isHidden(),{leftJustifiedTextSymbolIndex:Le,centerJustifiedTextSymbolIndex:Ke,rightJustifiedTextSymbolIndex:He,verticalPlacedTextSymbolIndex:nt}=ee,de=l.text.placedSymbolArray,ze=qe||Ce?1:0;Le>=0&&(de.get(Le).hidden=ze),Ke>=0&&(de.get(Ke).hidden=ze),He>=0&&(de.get(He).hidden=ze),nt>=0&&(de.get(nt).hidden=qe||$e?1:0);const _t=this.variableOffsets[ge];_t&&this.markUsedJustification(l,_t.anchor,ee,be);const ut=this.placedOrientations[ge];ut&&(this.markUsedJustification(l,"left",ee,ut),this.markUsedOrientation(l,ut,ee))}if(Me){const Ne=Ea(ue.icon),{placedIconSymbolIndex:qe,verticalPlacedIconSymbolIndex:Le}=ee,Ke=l.icon.placedSymbolArray,He=ue.icon.isHidden()?1:0;qe>=0&&(Y(l.icon,_e,Ce?pr:Ne),Ke.get(qe).hidden=He),Le>=0&&(Y(l.icon,ee.numVerticalIconVertices,$e?pr:Ne),Ke.get(Le).hidden=He)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const Ne=l.collisionArrays[te];if(Ne){let qe=new s.P(0,0),Le=!0;if(Ne.textBox||Ne.verticalTextBox){if(B){const He=this.variableOffsets[ge];He?(qe=Sn(He.anchor,He.width,He.height,He.textOffset,He.textScale),U&&qe._rotate(H?this.transform.angle:-this.transform.angle)):Le=!1}S&&(Le=!ue.clipped),Ne.textBox&&On(l.textCollisionBox.collisionVertexArray,ue.text.placed,!Le||Ce,qe.x,qe.y),Ne.verticalTextBox&&On(l.textCollisionBox.collisionVertexArray,ue.text.placed,!Le||$e,qe.x,qe.y)}const Ke=Le&&!!(!$e&&Ne.verticalIconBox);Ne.iconBox&&On(l.iconCollisionBox.collisionVertexArray,ue.icon.placed,Ke,ee.hasIconTextFit?qe.x:0,ee.hasIconTextFit?qe.y:0),Ne.verticalIconBox&&On(l.iconCollisionBox.collisionVertexArray,ue.icon.placed,!Ke,ee.hasIconTextFit?qe.x:0,ee.hasIconTextFit?qe.y:0)}}}if(l.fullyClipped=Q===0,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const te=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=te.invProjMatrix,l.placementViewportMatrix=te.viewportMatrix,l.collisionCircleArray=te.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,f){const v=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*v>l}setStale(){this.stale=!0}}function On(_,l,f,v,w){_.emplaceBack(l?1:0,f?1:0,v||0,w||0),_.emplaceBack(l?1:0,f?1:0,v||0,w||0),_.emplaceBack(l?1:0,f?1:0,v||0,w||0),_.emplaceBack(l?1:0,f?1:0,v||0,w||0)}const ao=Math.pow(2,25),Uo=Math.pow(2,24),xs=Math.pow(2,17),Ma=Math.pow(2,16),xr=Math.pow(2,9),el=Math.pow(2,8),Ll=Math.pow(2,1);function Ea(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const l=_.placed?1:0,f=Math.floor(127*_.opacity);return f*ao+l*Uo+f*xs+l*Ma+f*xr+l*el+f*Ll+l}const pr=0;class bu{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(l,f,v,w,S){const A=this._bucketParts;for(;this._currentTileIndex<l.length;)if(f.getBucketParts(A,w,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((P,R)=>P.sortKey-R.sortKey));this._currentPartIndex<A.length;){const P=A[this._currentPartIndex];if(f.placeLayerBucketPart(P,this._seenCrossTileIDs,v,P.symbolInstanceStart===0),this._currentPartIndex++,S())return!0}return!1}}class wu{constructor(l,f,v,w,S,A,P,R,B){this.placement=new xu(l,S,A,P,R,B),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(l,f,v,w){const S=s.a4.now(),A=()=>{const P=s.a4.now()-S;return!this._forceFullPlacement&&P>2};for(;this._currentPlacementIndex>=0;){const P=f[l[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=R)&&(!P.maxzoom||P.maxzoom>R)){const B=P,U=B.layout.get("symbol-z-elevate"),H=this._inProgressLayer=this._inProgressLayer||new bu(B),Z=s.aE(P.source,P.scope);if(H.continuePlacement(U?w[Z]:v[Z],this.placement,this._showCollisionBoxes,P,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const ls=512/s.J/2;class tl{constructor(l,f,v){this.tileID=l,this.bucketInstanceId=v,this.index=new s.aZ(f.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const w=l.canonical.x*s.J,S=l.canonical.y*s.J;for(let A=0;A<f.length;A++){const{key:P,crossTileID:R,tileAnchorX:B,tileAnchorY:U}=f.get(A),H=Math.floor((w+B)*ls),Z=Math.floor((S+U)*ls);this.index.add(H,Z),this.keys.push(P),this.crossTileIDs.push(R)}this.index.finish()}findMatches(l,f,v){const w=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),S=ls/Math.pow(2,f.canonical.z-this.tileID.canonical.z),A=f.canonical.x*s.J,P=f.canonical.y*s.J;for(let R=0;R<l.length;R++){const B=l.get(R);if(B.crossTileID)continue;const{key:U,tileAnchorX:H,tileAnchorY:Z}=B,Y=Math.floor((A+H)*S),Q=Math.floor((P+Z)*S),te=this.index.range(Y-w,Q-w,Y+w,Q+w);for(const ee of te){const K=this.crossTileIDs[ee];if(this.keys[ee]===U&&!v.has(K)){v.add(K),B.crossTileID=K;break}}}}}class il{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ln{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const f=Math.round((l-this.lng)/360);if(f!==0)for(const v in this.indexes){const w=this.indexes[v],S={};for(const A in w){const P=w[A];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+f),S[P.tileID.key]=P}this.indexes[v]=S}this.lng=l}addBucket(l,f,v){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let S=0;S<f.symbolInstances.length;S++)f.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]=new Set);const w=this.usedCrossTileIDs[l.overscaledZ];for(const S in this.indexes){const A=this.indexes[S];if(Number(S)>l.overscaledZ)for(const P in A){const R=A[P];R.tileID.isChildOf(l)&&R.findMatches(f.symbolInstances,l,w)}else{const P=A[l.scaledTo(Number(S)).key];P&&P.findMatches(f.symbolInstances,l,w)}}for(let S=0;S<f.symbolInstances.length;S++){const A=f.symbolInstances.get(S);A.crossTileID||(A.crossTileID=v.generate(),w.add(A.crossTileID))}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new tl(l,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(l,f){for(const v of f.crossTileIDs)this.usedCrossTileIDs[l].delete(v)}removeStaleBuckets(l){let f=!1;for(const v in this.indexes){const w=this.indexes[v];for(const S in w)l[w[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,w[S]),delete w[S],f=!0)}return f}}class ad{constructor(){this.layerIndexes={},this.crossTileIDs=new il,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,f,v,w){let S=this.layerIndexes[l.fqid];S===void 0&&(S=this.layerIndexes[l.fqid]=new ln);let A=!1;const P={};w.name!=="globe"&&S.handleWrapJump(v);for(const R of f){const B=R.getBucket(l);B&&l.fqid===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),S.addBucket(R.tileID,B,this.crossTileIDs)&&(A=!0),P[B.bucketInstanceId]=!0)}return S.removeStaleBuckets(P)&&(A=!0),A}pruneUnusedLayers(l){const f={};l.forEach(v=>{f[v]=!0});for(const v in this.layerIndexes)f[v]||delete this.layerIndexes[v]}}var Ic=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,cs=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,Cc=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Pc="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Jr=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Tu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,jo=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Ol=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);vec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return (texCoord.xxyy+vec2(1.5,0.5).xyxy)/texResolution.xxyy;}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image0,c.yz),texture(u_image0,c.xz),texture(u_image0,c.yw),texture(u_image0,c.xw)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image1,c.yz),texture(u_image1,c.xz),texture(u_image1,c.yw),texture(u_image1,c.xw)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texture(u_image0,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texture(u_image1,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,kc=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Rl=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const zl=[];Fs(Ic,zl),Fs(Cc,zl),Fs(cs,zl);const zs={"_prelude_fog.vertex.glsl":Tu,"_prelude_terrain.vertex.glsl":Jr,"_prelude_shadow.vertex.glsl":kc,"_prelude_fog.fragment.glsl":jo,"_prelude_shadow.fragment.glsl":Rl,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Ol},ta={};Yi("",Jr),Yi(jo,Tu),Yi(Rl,kc),Yi(Ol,"");const ia=Yi(cs,Cc),na=Ic;var Su={background:Yi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Yi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Yi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Yi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Yi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Yi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Yi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Yi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Yi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Yi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Yi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Yi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Yi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Yi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Yi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Yi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Yi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Yi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;HANDLE_WIREFRAME_DEBUG;
#endif
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Yi(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Yi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Yi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Yi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Yi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),symbolIcon:Yi(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:Yi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Yi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Yi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Yi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Yi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Pc),skyboxGradient:Yi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Pc),skyboxCapture:Yi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Yi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Yi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Yi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Yi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Yi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function Fs(_,l){const f=_.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let v of f)if(v=v.trim(),v[0]==="#"&&v.includes("if")&&!v.includes("endif")){v=v.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const w=v.split(" ");for(const S of w)l.includes(S)||l.push(S)}}function Yi(_,l){const f=/#include\s+"([^"]+)"/g,v=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let w=l.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);w&&(w=w.map(B=>{const U=B.split(" ");return U[U.length-1]}),w=[...new Set(w)]);const S={},A=[],P=[];if(_=_.replace(f,(B,U)=>(P.push(U),"")),(l=l.replace(f,(B,U)=>(A.push(U),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let R=[...zl];Fs(_,R),Fs(l,R);for(const B of[...A,...P])zs[B]||console.error(`Undefined include: ${B}`),ta[B]||(ta[B]=[],Fs(zs[B],ta[B])),R=[...R,...ta[B]];return{fragmentSource:_=_.replace(v,(B,U,H,Z,Y)=>(S[Y]=!0,U==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
in ${H} ${Z} ${Y};
#else
uniform ${H} ${Z} u_${Y};
#endif
`:U==="initialize"?`
#ifdef HAS_UNIFORM_u_${Y}
    ${H} ${Z} ${Y} = u_${Y};
#endif
`:U==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Y}
    in ${H} ${Z} ${Y};
#endif
`:U==="initialize-attribute"?"":void 0)),vertexSource:l=l.replace(v,(B,U,H,Z,Y)=>{const Q=Z==="float"?"vec2":Z,te=Y.match(/color/)?"color":Q;return U==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${Y}
in ${H} ${Z} a_${Y};
#endif
`:S[Y]?U==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
in ${H} ${Q} a_${Y};
out ${H} ${Z} ${Y};
#else
uniform ${H} ${Z} u_${Y};
#endif
`:U==="initialize"?te==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = a_${Y};
#else
    ${H} ${Z} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = unpack_mix_${te}(a_${Y}, u_${Y}_t);
#else
    ${H} ${Z} ${Y} = u_${Y};
#endif
`:U==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Y}
    in ${H} ${Z} a_${Y};
    out ${H} ${Z} ${Y};
#endif
`:U==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Y}
    ${Y} = a_${Y};
#endif
`:void 0:U==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
in ${H} ${Q} a_${Y};
#else
uniform ${H} ${Z} u_${Y};
#endif
`:U==="define-instanced"?te==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${Y}0;
in vec4 a_${Y}1;
in vec4 a_${Y}2;
in vec4 a_${Y}3;
#else
uniform ${H} ${Z} u_${Y};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${H} ${Q} a_${Y};
#else
uniform ${H} ${Z} u_${Y};
#endif
`:U==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${Y}
    ${H} ${Z} ${Y} = a_${Y};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${H} ${Z} ${Y} = a_${Y};
#else
    ${H} ${Z} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${H} ${Z} ${Y} = unpack_mix_${te}(a_${Y}, u_${Y}_t);
#else
    ${H} ${Z} ${Y} = u_${Y};
#endif
`}),staticAttributes:w,usedDefines:R,vertexIncludes:A,fragmentIncludes:P}}class Fl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,f,v,w,S,A,P,R){this.context=l;let B=this.boundPaintVertexBuffers.length!==w.length;for(let H=0;!B&&H<w.length;H++)this.boundPaintVertexBuffers[H]!==w[H]&&(B=!0);let U=this.boundDynamicVertexBuffers.length!==P.length;for(let H=0;!U&&H<P.length;H++)this.boundDynamicVertexBuffers[H]!==P[H]&&(U=!0);if(!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==v||B||U||this.boundIndexBuffer!==S||this.boundVertexOffset!==A)this.freshBind(f,v,w,S,A,P,R);else{l.bindVertexArrayOES.set(this.vao);for(const H of P)H&&(H.bind(),R&&H.instanceCount&&H.setVertexAttribDivisor(l.gl,f,R));S&&S.dynamicDraw&&S.bind()}}freshBind(l,f,v,w,S,A,P){const R=l.numAttributes,B=this.context,U=B.gl;this.vao&&this.destroy(),this.vao=B.gl.createVertexArray(),B.bindVertexArrayOES.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=w,this.boundVertexOffset=S,this.boundDynamicVertexBuffers=A,f.enableAttributes(U,l),f.bind(),f.setVertexAttribPointers(U,l,S);for(const H of v)H.enableAttributes(U,l),H.bind(),H.setVertexAttribPointers(U,l,S);for(const H of A)H&&(H.enableAttributes(U,l),H.bind(),H.setVertexAttribPointers(U,l,S),P&&H.instanceCount&&H.setVertexAttribDivisor(U,l,P));w&&w.bind(),B.currentNumAttributes=R}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Mu(_,l){const f=Math.pow(2,l.canonical.z),v=l.canonical.y;return[new s.M(0,v/f).toLngLat().lat,new s.M(0,(v+1)/f).toLngLat().lat]}function Eu(_,l,f,v,w,S,A){const P=_.context,R=P.gl,B=f.hillshadeFBO;if(!B)return;_.prepareDrawTile();const U=_.isTileAffectedByFog(l),H=_.getOrCreateProgram("hillshade",{overrideFog:U});P.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,B.colorAttachment.get());const Z=((ee,K,ce,ge)=>{const _e=ce.paint.get("hillshade-shadow-color"),se=ce.paint.get("hillshade-highlight-color"),ue=ce.paint.get("hillshade-accent-color"),ve=ce.paint.get("hillshade-emissive-strength");let Me=s.d(ce.paint.get("hillshade-illumination-direction"));if(ce.paint.get("hillshade-illumination-anchor")==="viewport")Me-=ee.transform.angle;else if(ee.style&&ee.style.enable3dLights()&&ee.style.directionalLight){const Ce=ee.style.directionalLight.properties.get("direction"),$e=s.b3(Ce.x,Ce.y,Ce.z);Me=s.d($e[1])}const be=!ee.options.moving;return{u_matrix:ge||ee.transform.calculateProjMatrix(K.tileID.toUnwrapped(),be),u_image:0,u_latrange:Mu(0,K.tileID),u_light:[ce.paint.get("hillshade-exaggeration"),Me],u_shadow:_e,u_highlight:se,u_emissive_strength:ve,u_accent:ue}})(_,f,v,_.terrain?l.projMatrix:null);_.uploadCommonUniforms(P,H,l.toUnwrapped());const{tileBoundsBuffer:Y,tileBoundsIndexBuffer:Q,tileBoundsSegments:te}=_.getTileBoundsBuffers(f);H.draw(_,R.TRIANGLES,w,S,A,s.b5.disabled,Z,v.id,Y,Q,te)}function Bl(_,l,f){if(!l.needsDEMTextureUpload)return;const v=_.context,w=v.gl;v.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||_.getTileTexture(f.stride);const S=f.getPixels();l.demTexture?l.demTexture.update(S,{premultiply:!1}):l.demTexture=new s.a9(v,S,w.R32F,{premultiply:!1}),l.needsDEMTextureUpload=!1}function Nl(_,l,f){const v=_.context,w=v.gl;if(!l.dem)return;const S=l.dem;if(v.activeTexture.set(w.TEXTURE1),Bl(_,l,S),!l.demTexture)return;l.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);const A=S.dim;v.activeTexture.set(w.TEXTURE0);let P=l.hillshadeFBO;if(!P){const Z=new s.a9(v,{width:A,height:A,data:null},w.RGBA);Z.bind(w.LINEAR,w.CLAMP_TO_EDGE),P=l.hillshadeFBO=v.createFramebuffer(A,A,!0,"renderbuffer"),P.colorAttachment.set(Z.texture)}v.bindFramebuffer.set(P.framebuffer),v.viewport.set([0,0,A,A]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:B,tileBoundsSegments:U}=_.getMercatorTileBoundsBuffers(),H=[];_.linearFloatFilteringSupported()&&H.push("TERRAIN_DEM_FLOAT_FORMAT"),_.getOrCreateProgram("hillshadePrepare",{defines:H}).draw(_,w.TRIANGLES,s.b4.disabled,s.b6.disabled,s.a.unblended,s.b5.disabled,((Z,Y)=>{const Q=Y.stride,te=s.m.create();return s.m.ortho(te,0,s.J,-s.J,0,0,1),s.m.translate(te,te,[0,-s.J,0]),{u_matrix:te,u_image:1,u_dimension:[Q,Q],u_zoom:Z.overscaledZ}})(l.tileID,S),f.id,R,B,U),l.needsHillshadePrepare=!1}const Dc=_=>({u_matrix:new s.a_(_),u_image0:new s.a$(_),u_skirt_height:new s.b2(_),u_ground_shadow_factor:new s.b7(_)}),Au=(_,l,f)=>({u_matrix:_,u_image0:0,u_skirt_height:l,u_ground_shadow_factor:f}),Iu=(_,l,f,v,w,S,A,P,R,B,U,H,Z,Y,Q)=>({u_proj_matrix:Float32Array.from(_),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(v),u_merc_matrix:f,u_zoom_transition:w,u_merc_center:S,u_image0:0,u_frustum_tl:A,u_frustum_tr:P,u_frustum_br:R,u_frustum_bl:B,u_globe_pos:U,u_globe_radius:H,u_viewport:Z,u_grid_matrix:Q?Float32Array.from(Q):new Float32Array(9),u_skirt_height:Y}),Aa=(_,l)=>{if(l>0&&_.terrain&&s.X("Cutoff is currently disabled on terrain"),l<=0||_.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const f=_.transform,v=Math.max(Math.abs(f._zoom-(_.minCutoffZoom-1)),1),w=f.isLODDisabled(!1)?s.an(60,45,f.pitch):s.an(30,15,f.pitch),S=f._farZ-f._nearZ,A=l*f.height,P=((1-(R=w))*f.cameraToCenterDistance+R*(f._farZ+A))*v;var R;return{shouldRenderCutoff:w<1,uniformValues:{u_cutoff_params:[f._nearZ,f._farZ,(P-f._nearZ)/S,(P-A-f._nearZ)/S]}}};function Cu(_,l){return _!=null&&l!=null&&!(!_.hasData()||!l.hasData())&&_.demTexture!=null&&l.demTexture!=null&&_.tileID.key!==l.tileID.key}const us=new class{constructor(){this.operations={}}newMorphing(_,l,f,v,w){if(_ in this.operations){const S=this.operations[_];S.to.tileID.key!==f.tileID.key&&(S.queued=f)}else this.operations[_]={startTime:v,phase:0,duration:w,from:l,to:f,queued:null}}getMorphValuesForProxy(_){if(!(_ in this.operations))return null;const l=this.operations[_];return{from:l.from,to:l.to,phase:l.phase}}update(_){for(const l in this.operations){const f=this.operations[l];for(f.phase=(_-f.startTime)/f.duration;f.phase>=1||!this._validOp(f);)if(!this._nextOp(f,_)){delete this.operations[l];break}}}_nextOp(_,l){return!!_.queued&&(_.from=_.to,_.to=_.queued,_.queued=null,_.phase=0,_.startTime=l,!0)}_validOp(_){return _.from.hasData()&&_.to.hasData()}},nl={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Bs(_,l,f){if(l===0)return 0;const v=l<1&&f===514?.25/l:1;return 6*Math.pow(1.5,22-_)*Math.max(l,1)*v}function hs(_,l){const f=1<<_.z;return!l&&(_.x===0||_.x===f-1)||_.y===0||_.y===f-1}const bs=_=>({u_matrix:_});function Ia(_,l,f,v,w){if(w>0){const S=s.a4.now(),A=(S-_.timeAdded)/w,P=l?(S-l.timeAdded)/w:-1,R=f.getSource(),B=v.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),U=!l||Math.abs(l.tileID.overscaledZ-B)>Math.abs(_.tileID.overscaledZ-B),H=U&&_.refreshedUponExpiration?1:s.c(U?A:1-P,0,1);return _.refreshedUponExpiration&&A>=1&&(_.refreshedUponExpiration=!1),l?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}class Mt extends s.bq{constructor(l){const f={type:"raster-dem",maxzoom:l.transform.maxZoom},v=new s.br(s.bs(),null),w=ss("mock-dem",f,v,l.style);super("mock-dem",w,!1),w.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,f){l.state="loaded",f(null)}}class Fh extends s.bq{constructor(l){const f=ss("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new s.br(s.bs(),null),l.style);super("proxy",f,!1),f.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,f,v){if(l.freezeTileCoverage)return;this.transform=l;const w=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((S,A)=>{if(S[A.key]="",!this._tiles[A.key]){const P=new s.bt(A,this._source.tileSize*A.overscaleFactor(),l.tileZoom);P.state="loaded",this._tiles[A.key]=P}return S},{});for(const S in this._tiles)S in w||(this.freeFBO(S),this._tiles[S].unloadVectorData(),delete this._tiles[S])}freeFBO(l){const f=this.proxyCachedFBO[l];if(f!==void 0){const v=Object.values(f);this.renderCachePool.push(...v),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ca extends s.O{constructor(l,f,v){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=f,this.projMatrix=v}}class Pa extends s.bk{constructor(l,f){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},l.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[v,w,S]=function(R){const B=new s.bo,U=new s.bp,H=131;B.reserve(17161),U.reserve(33800);const Z=s.J/128,Y=s.J+Z/2,Q=Y+Z;for(let ee=-Z;ee<Q;ee+=Z)for(let K=-Z;K<Q;K+=Z){const ce=K<0||K>Y||ee<0||ee>Y?24575:0,ge=s.c(Math.round(K),0,s.J),_e=s.c(Math.round(ee),0,s.J);B.emplaceBack(ge+ce,_e)}const te=(ee,K)=>{const ce=K*H+ee;U.emplaceBack(ce+1,ce,ce+H),U.emplaceBack(ce+H,ce+H+1,ce+1)};for(let ee=1;ee<129;ee++)for(let K=1;K<129;K++)te(K,ee);return[0,129].forEach(ee=>{for(let K=0;K<130;K++)te(K,ee),te(ee,K)}),[B,U,32768]}(),A=l.context;this.gridBuffer=A.createVertexBuffer(v,s.bl.members),this.gridIndexBuffer=A.createIndexBuffer(w),this.gridSegments=s.bm.simpleSegment(0,0,v.length,w.length),this.gridNoSkirtSegments=s.bm.simpleSegment(0,0,v.length,S),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Fh(f.map),this.orthoMatrix=s.m.create(),s.m.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.J,0,s.J,0,1);const P=A.gl;this._overlapStencilMode=new s.b6({func:P.GEQUAL,mask:255},0,255,P.KEEP,P.KEEP,P.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=f,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Mt(f.map),this._pendingGroundEffectLayers=[]}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),this._style=l,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(l,f,v){if(l&&l.terrain){this._style!==l&&(this.style=l,this._evaluationZoom=void 0);const w=l.terrain.properties,S=l.terrain.drapeRenderMode===0,A=l.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.a4.now();const P=l.terrain&&l.terrain.scope,R=w.get("source"),B=S?this._mockSourceCache:l.getSourceCache(R,P);if(!B)return void s.X(`Couldn't find terrain source "${R}".`);if(this.sourceCache=B,this._exaggeration=A?this.calculateExaggeration(f):w.get("exaggeration"),!f.projection.requiresDraping&&A&&this._exaggeration===0)return void this._disable();this.enabled=!0;const U=()=>{this.sourceCache.used&&s.X(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const H=this.getScaledDemTileSize();this.sourceCache.update(f,H,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,U(),this._initializing=!0),U(),f.updateElevation(!0,v),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(f),this._emptyDEMTextureDirty=!0,this._previousZoom=f.zoom}else this._disable()}calculateExaggeration(l){const f=this._previousCameraAltitude,v=l.getFreeCameraOptions().position.z/l.pixelsPerMeter*l.worldSize;this._previousCameraAltitude=v;const w=f!=null?v-f:Number.MAX_VALUE;if(Math.abs(w)<2)return this._exaggeration;const S=l.zoom,A=this._style.terrain;if(!this._previousUpdateTimestamp)return A.getExaggeration(S);let P=S-this._previousZoom;const R=this._previousUpdateTimestamp;let B=S;this._evaluationZoom!=null&&(B=this._evaluationZoom,Math.abs(S-B)>.5&&(P=.5*(S-B+P)),P*w<0&&(B+=P)),this._evaluationZoom=B;const U=A.getExaggeration(B),H=U===A.getExaggeration(Math.max(0,B-.1));if(H&&Math.abs(U-this._exaggeration)<.01)return U;let Z=Math.min(.1,.00375*(this._updateTimestamp-R));return(H||U<.1||Math.abs(P)<1e-4)&&(Z=Math.min(.2,4*Z)),s.n(this._exaggeration,U,Z)}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(l){l.coord&&l.dataType==="source"?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):l.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._mergedSourceCaches)this._style._mergedSourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const f=this.proxySourceCache,v=this.painter.transform;this._initializing&&(this._initializing=v._centerAltitude===0&&this.getAtPointOrZero(s.M.fromLngLat(v.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=f.getIds().map(R=>{const B=f.getTileByID(R).tileID;return B.projMatrix=v.calculateProjMatrix(B.toUnwrapped()),B});(function(R,B){const U=B.transform.pointCoordinate(B.transform.getCameraPoint()),H=new s.P(U.x,U.y);R.sort((Z,Y)=>{if(Y.overscaledZ-Z.overscaledZ)return Y.overscaledZ-Z.overscaledZ;const Q=new s.P(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),te=new s.P(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),ee=H.mult(1<<Z.canonical.z);return ee.x-=.5,ee.y-=.5,ee.distSqr(Q)-ee.distSqr(te)})})(w,this.painter);const S=this.proxyToSource||{};this.proxyToSource={},w.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const A=this._style._mergedSourceCaches;for(const R in A){const B=A[R];if(!B.used||(B!==this.sourceCache&&this.resetTileLookupCache(B.id),this._setupProxiedCoordsForOrtho(B,l[R],S),B.usedForTerrain))continue;const U=l[R];B.getSource().reparseOverscaled&&this._assignTerrainTiles(U)}this.proxiedCoords[f.id]=w.map(R=>new Ca(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(S),this.renderingToTexture=!1;const P={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const B=this.terrainTileForTile[R.key];if(!B)continue;const U=B.tileID.key;U in P||(this._visibleDemTiles.push(B),P[U]=U)}}_assignTerrainTiles(l){this._initializing||l.forEach(f=>{if(this.terrainTileForTile[f.key])return;const v=this._findTileCoveringTileID(f,this.sourceCache);v&&(this.terrainTileForTile[f.key]=v)})}_prepareDEMTextures(){const l=this.painter.context,f=l.gl;for(const v in this.terrainTileForTile){const w=this.terrainTileForTile[v],S=w.dem;!S||w.demTexture&&!w.needsDEMTextureUpload||(l.activeTexture.set(f.TEXTURE1),Bl(this.painter,w,S))}}_prepareDemTileUniforms(l,f,v,w){if(!f||f.demTexture==null)return!1;const S=l.tileID.canonical,A=Math.pow(2,f.tileID.canonical.z-S.z),P=w||"";return v[`u_dem_tl${P}`]=[S.x*A%1,S.y*A%1],v[`u_dem_scale${P}`]=A,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const l=this.painter.context,f=l.gl;if(!this._emptyDepthBufferTexture){const v=new s.a5({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.a9(l,v,f.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let l=0;const f=this._visibleDemTiles.reduce((v,w)=>{if(!w.dem)return v;const S=w.dem.tree.minimums[0];return S>0&&l++,v+S},0);return l?f/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,f=l.gl;l.activeTexture.set(f.TEXTURE2);const v=this._getLoadedAreaMinimum(),[w,S]=(()=>{const P=new s.bu({width:1,height:1},new Float32Array([v]));return[f.R32F,P]})();this._emptyDEMTextureDirty=!1;let A=this._emptyDEMTexture;return A?A.update(S,{premultiply:!1}):A=this._emptyDEMTexture=new s.a9(l,S,w,{premultiply:!1}),A}setupElevationDraw(l,f,v){const w=this.painter.context,S=w.gl,A={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};A.u_exaggeration=this.exaggeration();let P=null,R=null,B=1;if(v&&v.morphing&&this._useVertexMorphing){const Z=v.morphing.srcDemTile,Y=v.morphing.dstDemTile;B=v.morphing.phase,Z&&Y&&(this._prepareDemTileUniforms(l,Z,A,"_prev")&&(R=Z),this._prepareDemTileUniforms(l,Y,A)&&(P=Y))}const U=Z=>Z&&Z.demTexture&&this.painter.linearFloatFilteringSupported()?S.LINEAR:S.NEAREST,H=Z=>{A.u_dem_size=Z.size[0]===1?1:Z.size[0]-2};if(R&&P)w.activeTexture.set(S.TEXTURE2),P.demTexture.bind(U(P),S.CLAMP_TO_EDGE),w.activeTexture.set(S.TEXTURE4),R.demTexture.bind(U(R),S.CLAMP_TO_EDGE),P.demTexture&&H(P.demTexture),A.u_dem_lerp=B;else{P=this.terrainTileForTile[l.tileID.key],w.activeTexture.set(S.TEXTURE2);const Z=this._prepareDemTileUniforms(l,P,A)?P.demTexture:this.emptyDEMTexture;Z.bind(U(P),S.CLAMP_TO_EDGE),H(Z)}if(w.activeTexture.set(S.TEXTURE3),v&&v.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),this._depthFBO&&(A.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),A.u_depth_size_inv=[1,1]),v&&v.useMeterToDem&&P){const Z=(1<<P.tileID.canonical.z)*s.b(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;A.u_meter_to_dem=Z}if(v&&v.labelPlaneMatrixInv&&(A.u_label_plane_matrix_inv=v.labelPlaneMatrixInv),f.setTerrainUniformValues(w,A),this.painter.transform.projection.name==="globe"){const Z=this.globeUniformValues(this.painter.transform,l.tileID.canonical,v&&v.useDenormalizedUpVectorScale);f.setGlobeUniformValues(w,Z)}}globeUniformValues(l,f,v){const w=l.projection;return{u_tile_tl_up:w.upVector(f,0,0),u_tile_tr_up:w.upVector(f,s.J,0),u_tile_br_up:w.upVector(f,s.J,s.J),u_tile_bl_up:w.upVector(f,0,s.J),u_tile_up_scale:v?s.bn(1):w.upVectorScale(f,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){const f=this.painter,v=this.painter.context;l.length!==0&&(v.bindFramebuffer.set(null),v.viewport.set([0,0,f.width,f.height]),f.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(w,S,A,P,R){if(w.transform.projection.name==="globe")(function(B,U,H,Z,Y){const Q=B.context,te=Q.gl;let ee,K;const ce=B.transform,ge=s.bb(B,Q,ce),_e=(qe,Le)=>{if(K===Le)return;const Ke=[nl[Le],"PROJECTION_GLOBE_VIEW"];ge&&Ke.push("CUSTOM_ANTIALIASING");const He=B.isTileAffectedByFog(qe);ee=B.getOrCreateProgram("globeRaster",{defines:Ke,overrideFog:He}),K=Le},se=B.colorModeForRenderPass(),ue=new s.b4(te.LEQUAL,s.b4.ReadWrite,B.depthRangeFor3D);us.update(Y);const ve=s.bc(ce),Me=[s.E(ce.center.lng),s.H(ce.center.lat)],be=B.globeSharedBuffers,Ce=[ce.width*s.a4.devicePixelRatio,ce.height*s.a4.devicePixelRatio],$e=Float32Array.from(ce.globeMatrix),Ne={useDenormalizedUpVectorScale:!0};{const qe=B.transform,Le=Bs(qe.zoom,U.exaggeration(),U.sourceCache._source.tileSize);K=-1;const Ke=te.TRIANGLES;for(const He of Z){const nt=H.getTile(He),de=s.b6.disabled,ze=U.prevTerrainTileForTile[He.key],_t=U.terrainTileForTile[He.key];Cu(ze,_t)&&us.newMorphing(He.key,ze,_t,Y,250),Q.activeTexture.set(te.TEXTURE0),nt.texture&&nt.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE);const ut=us.getMorphValuesForProxy(He.key),ti=ut?1:0;ut&&s.bd(Ne,{morphing:{srcDemTile:ut.from,dstDemTile:ut.to,phase:s.ba(ut.phase)}});const Ht=s.be(He.canonical),hi=s.bf(Ht.getCenter().lat),Jt=s.bg(He.canonical,Ht,hi,qe.worldSize/qe._pixelsPerMercatorPixel),_i=s.bh(s.bi(He.canonical)),yi=Iu(qe.expandedFarZProjMatrix,$e,ve,_i,s.ao(qe.zoom),Me,qe.frustumCorners.TL,qe.frustumCorners.TR,qe.frustumCorners.BR,qe.frustumCorners.BL,qe.globeCenterInViewSpace,qe.globeRadius,Ce,Le,Jt);if(_e(He,ti),ee&&(U.setupElevationDraw(nt,ee,Ne),B.uploadCommonUniforms(Q,ee,He.toUnwrapped()),be)){const[oi,li,tn]=be.getGridBuffers(hi,Le!==0);ee.draw(B,Ke,ue,de,se,s.b5.backCCW,yi,"globe_raster",oi,li,tn)}}}if(be&&(B.renderDefaultNorthPole||B.renderDefaultSouthPole)){const qe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ge&&qe.push("CUSTOM_ANTIALIASING"),ee=B.getOrCreateProgram("globeRaster",{defines:qe});for(const Le of Z){const{x:Ke,y:He,z:nt}=Le.canonical,de=He===0,ze=He===(1<<nt)-1,[_t,ut,ti,Ht]=be.getPoleBuffers(nt,!1);if(Ht&&(de||ze)){const hi=H.getTile(Le);Q.activeTexture.set(te.TEXTURE0),hi.texture&&hi.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE);let Jt=s.bj(nt,Ke,ce);const _i=s.bh(s.bi(Le.canonical)),yi=(oi,li)=>oi.draw(B,te.TRIANGLES,ue,s.b6.disabled,se,s.b5.disabled,Iu(ce.expandedFarZProjMatrix,Jt,Jt,_i,0,Me,ce.frustumCorners.TL,ce.frustumCorners.TR,ce.frustumCorners.BR,ce.frustumCorners.BL,ce.globeCenterInViewSpace,ce.globeRadius,Ce,0),"globe_pole_raster",li,ti,Ht);U.setupElevationDraw(hi,ee,Ne),B.uploadCommonUniforms(Q,ee,Le.toUnwrapped()),de&&B.renderDefaultNorthPole&&yi(ee,_t),ze&&B.renderDefaultSouthPole&&(Jt=s.m.scale(s.m.create(),Jt,[1,-1,1]),yi(ee,ut))}}}})(w,S,A,P,R);else{const B=w.context,U=B.gl;let H,Z;const Y=w.shadowRenderer,Q=Aa(w,w.longestCutoffRange),te=se=>{if(Z===se)return;const ue=[];ue.push(nl[se]),Q.shouldRenderCutoff&&ue.push("RENDER_CUTOFF"),H=w.getOrCreateProgram("terrainRaster",{defines:ue}),Z=se},ee=w.colorModeForRenderPass(),K=new s.b4(U.LEQUAL,s.b4.ReadWrite,w.depthRangeFor3D);us.update(R);const ce=w.transform,ge=Bs(ce.zoom,S.exaggeration(),S.sourceCache._source.tileSize);let _e=[0,0,0];if(Y){const se=w.style.directionalLight,ue=w.style.ambientLight;se&&ue&&(_e=Uh(se,ue))}{Z=-1;const se=U.TRIANGLES,[ue,ve]=[S.gridIndexBuffer,S.gridSegments];for(const Me of P){const be=A.getTile(Me),Ce=s.b6.disabled,$e=S.prevTerrainTileForTile[Me.key],Ne=S.terrainTileForTile[Me.key];Cu($e,Ne)&&us.newMorphing(Me.key,$e,Ne,R,250),B.activeTexture.set(U.TEXTURE0),be.texture&&be.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const qe=us.getMorphValuesForProxy(Me.key),Le=qe?1:0;let Ke;qe&&(Ke={morphing:{srcDemTile:qe.from,dstDemTile:qe.to,phase:s.ba(qe.phase)}});const He=Au(Me.projMatrix,hs(Me.canonical,ce.renderWorldCopies)?ge/10:ge,_e);if(te(Le),!H)continue;S.setupElevationDraw(be,H,Ke);const nt=Me.toUnwrapped();Y&&Y.setupShadows(nt,H),w.uploadCommonUniforms(B,H,nt,null,Q),H.draw(w,se,K,Ce,ee,s.b5.backCCW,He,"terrain_raster",S.gridBuffer,ue,ve)}}}}(f,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,f.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(this._drapedRenderBatches.length===0)return l+1;this.renderingToTexture=!0;const f=this.painter,v=this.painter.context,w=this.proxySourceCache,S=this.proxiedCoords[w.id],A=this._drapedRenderBatches.shift(),P=f.style.order,R=[];let B=0;for(const U of S){const H=w.getTileByID(U.proxyTileKey),Z=w.proxyCachedFBO[U.key]?w.proxyCachedFBO[U.key][l]:void 0,Y=Z!==void 0?w.renderCache[Z]:this.pool[B++],Q=Z!==void 0;if(H.texture=Y.tex,Q&&!Y.dirty){R.push(H.tileID);continue}let te;v.bindFramebuffer.set(Y.fb.framebuffer),this.renderedToTile=!1,Y.dirty&&(v.clear({color:s.C.transparent,stencil:0}),Y.dirty=!1);for(let ee=A.start;ee<=A.end;++ee){const K=f.style._mergedLayers[P[ee]];if(K.isHidden(f.transform.zoom))continue;const ce=f.style.getLayerSourceCache(K),ge=ce?this.proxyToSource[U.key][ce.id]:[U];if(!ge)continue;const _e=ge;v.viewport.set([0,0,Y.fb.width,Y.fb.height]),te!==(ce?ce.id:null)&&(this._setupStencil(Y,ge,K,ce),te=ce?ce.id:null),f.renderLayer(f,ce,K,_e)}if(this._drapedRenderBatches.length===0)for(const ee of this._pendingGroundEffectLayers){const K=f.style._mergedLayers[P[ee]];if(K.isHidden(f.transform.zoom))continue;const ce=f.style.getLayerSourceCache(K),ge=ce?this.proxyToSource[U.key][ce.id]:[U];if(!ge)continue;const _e=ge;v.viewport.set([0,0,Y.fb.width,Y.fb.height]),te!==(ce?ce.id:null)&&(this._setupStencil(Y,ge,K,ce),te=ce?ce.id:null),f.renderLayer(f,ce,K,_e)}this.renderedToTile?(Y.dirty=!0,R.push(H.tileID)):Q||--B,B===5&&(B=0,this.renderToBackBuffer(R))}return this.renderToBackBuffer(R),this.renderingToTexture=!1,v.bindFramebuffer.set(null),v.viewport.set([0,0,f.width,f.height]),A.end+1}postRender(){}isLayerOrderingCorrect(l){const f=l.order.length;let v=-1,w=f;for(let S=0;S<f;++S)this._style.isLayerDraped(l._mergedLayers[l.order[S]])?v=Math.max(v,S):w=Math.min(w,S);return w>v}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(f=>f.dem).forEach(f=>{l=Math.min(l,f.dem.tree.minimums[0])}),l===0?l:(l-30)*this._exaggeration}raycast(l,f,v){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(S=>S.dem).map(S=>{const A=S.tileID,P=1<<A.overscaledZ,{x:R,y:B}=A.canonical,U=R/P,H=(R+1)/P,Z=B/P,Y=(B+1)/P;return{minx:U,miny:Z,maxx:H,maxy:Y,t:S.dem.tree.raycastRoot(U,Z,H,Y,l,f,v),tile:S}});w.sort((S,A)=>(S.t!==null?S.t:Number.MAX_VALUE)-(A.t!==null?A.t:Number.MAX_VALUE));for(const S of w){if(S.t==null)return null;const A=S.tile.dem.tree.raycast(S.minx,S.miny,S.maxx,S.maxy,l,f,v);if(A!=null)return A}return null}_createFBO(){const l=this.painter.context,f=l.gl,v=this.drapeBufferSize;l.activeTexture.set(f.TEXTURE0);const w=new s.a9(l,{width:v[0],height:v[1],data:null},f.RGBA);w.bind(f.LINEAR,f.CLAMP_TO_EDGE);const S=l.createFramebuffer(v[0],v[1],!0,null);return S.colorAttachment.set(w.texture),S.depthAttachment=new rn(l,S.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,v[0],v[1]),this._stencilRef=0,S.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):S.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&f.texParameterf(f.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:S,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const l in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const f=this._style._mergedLayers[l],v=f.isHidden(this.painter.transform.zoom);return f.type==="custom"?!v&&f.shouldRedrape():!v&&f.hasTransition()})}_clearLineLayersFromRenderCache(){let l=!1;for(const v of this._style.getSources())if(v instanceof Be){l=!0;break}if(!l)return;const f={};for(let v=0;v<this._style.order.length;++v){const w=this._style._mergedLayers[this._style.order[v]],S=this._style.getLayerSourceCache(w);if(S&&!f[S.id]&&!w.isHidden(this.painter.transform.zoom)&&w.type==="line"&&w.widthExpression()instanceof s.am){f[S.id]=!0;for(const A of this.proxyCoords){const P=this.proxyToSource[A.key][S.id];if(P)for(const R of P)this._clearRenderCacheForTile(S.id,R)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(const v in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[v]._source instanceof ri){l=!0;break}if(!l)return;const f={};for(let v=0;v<this._style.order.length;++v){const w=this._style._mergedLayers[this._style.order[v]],S=this._style.getLayerSourceCache(w);if(!S||f[S.id]||w.isHidden(this.painter.transform.zoom)||w.type!=="raster")continue;const A=w.paint.get("raster-fade-duration");for(const P of this.proxyCoords){const R=this.proxyToSource[P.key][S.id];if(R)for(const B of R){const U=Ia(S.getTile(B),S.findLoadedParent(B,0),S,this.painter.transform,A);(U.opacity!==1||U.mix!==0)&&this._clearRenderCacheForTile(S.id,B)}}}}_setupDrapedRenderBatches(){const l=this._style.order,f=l.length;if(f===0)return;const v=[];this._pendingGroundEffectLayers=[];let w,S=0,A=this._style._mergedLayers[l[S]];for(;!this._style.isLayerDraped(A)&&A.isHidden(this.painter.transform.zoom)&&++S<f;)A=this._style._mergedLayers[l[S]];for(;S<f;++S){const P=this._style._mergedLayers[l[S]];P.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(P)?w===void 0&&(w=S):(P.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(S),w!==void 0&&(v.push({start:w,end:S-1}),w=void 0)))}if(w!==void 0&&v.push({start:w,end:S-1}),v.length!==0){const P=v[v.length-1];this._pendingGroundEffectLayers.every(R=>R>P.end)||s.X("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=v}_setupRenderCache(l){const f=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,f.renderCache.length>f.renderCachePool.length){const A=Object.values(f.proxyCachedFBO);f.proxyCachedFBO={};for(let P=0;P<A.length;++P){const R=Object.values(A[P]);f.renderCachePool.push(...R)}}return}this._clearRasterLayersFromRenderCache();const v=this.proxyCoords,w=this._tilesDirty;for(let A=v.length-1;A>=0;A--){const P=v[A];if(f.getTileByID(P.key),f.proxyCachedFBO[P.key]!==void 0){const R=l[P.key],B=this.proxyToSource[P.key];let U=0;for(const H in B){const Z=B[H],Y=R[H];if(!Y||Y.length!==Z.length||Z.some((Q,te)=>Q!==Y[te]||w[H]&&w[H].hasOwnProperty(Q.key))){U=-1;break}++U}for(const H in f.proxyCachedFBO[P.key])f.renderCache[f.proxyCachedFBO[P.key][H]].dirty=U<0||U!==Object.values(R).length}}const S=[...this._drapedRenderBatches];S.sort((A,P)=>P.end-P.start-(A.end-A.start));for(const A of S)for(const P of v){if(f.proxyCachedFBO[P.key])continue;let R=f.renderCachePool.pop();R===void 0&&f.renderCache.length<50&&(R=f.renderCache.length,f.renderCache.push(this._createFBO())),R!==void 0&&(f.proxyCachedFBO[P.key]={},f.proxyCachedFBO[P.key][A.start]=R,f.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(l,f,v,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const S=this.painter.context,A=S.gl;if(f.length<=1)return void(this._overlapStencilType=!1);let P;if(v.isTileClipped())P=f.length,this._overlapStencilMode.test={func:A.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(f[0].overscaledZ>f[f.length-1].overscaledZ))return void(this._overlapStencilType=!1);P=1,this._overlapStencilMode.test={func:A.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+P>255&&(S.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=P,this._overlapStencilMode.ref=this._stencilRef,v.isTileClipped()&&this._renderTileClippingMasks(f,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):s.b6.disabled}_renderTileClippingMasks(l,f){const v=this.painter,w=this.painter.context,S=w.gl;v._tileClippingMaskIDs={},w.setColorMode(s.a.disabled),w.setDepthMode(s.b4.disabled);const A=v.getOrCreateProgram("clippingMask");for(const P of l){const R=v._tileClippingMaskIDs[P.key]=--f;A.draw(v,S.TRIANGLES,s.b4.disabled,new s.b6({func:S.ALWAYS,mask:0},R,255,S.KEEP,S.KEEP,S.REPLACE),s.a.disabled,s.b5.disabled,bs(P.projMatrix),"$clipping",v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}pointCoordinate(l){const f=this.painter.transform;if(l.x<0||l.x>f.width||l.y<0||l.y>f.height)return null;const v=[l.x,l.y,1,1];s.e.transformMat4(v,v,f.pixelMatrixInverse),s.e.scale(v,v,1/v[3]),v[0]/=f.worldSize,v[1]/=f.worldSize;const w=f._camera.position,S=s.b(1,f.center.lat),A=[w[0],w[1],w[2]/S,0],P=s.v.subtract([],v.slice(0,3),A);s.v.normalize(P,P);const R=this.raycast(A,P,this._exaggeration);return R!==null&&R?(s.v.scaleAndAdd(A,A,P,R),A[3]=A[2],A[2]*=S,A):null}drawDepth(){const l=this.painter,f=l.context,v=this.proxySourceCache,w=Math.ceil(l.width),S=Math.ceil(l.height);if(!this._depthFBO||this._depthFBO.width===w&&this._depthFBO.height===S||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const A=f.gl,P=f.createFramebuffer(w,S,!0,"renderbuffer");f.activeTexture.set(A.TEXTURE0);const R=new s.a9(f,{width:w,height:S,data:null},A.RGBA);R.bind(A.NEAREST,A.CLAMP_TO_EDGE),P.colorAttachment.set(R.texture);const B=f.createRenderbuffer(f.gl.DEPTH_COMPONENT16,w,S);P.depthAttachment.set(B),this._depthFBO=P,this._depthTexture=R}f.bindFramebuffer.set(this._depthFBO.framebuffer),f.viewport.set([0,0,w,S]),function(A,P,R,B){if(A.transform.projection.name==="globe")return;const U=A.context,H=U.gl;U.clear({depth:1});const Z=A.getOrCreateProgram("terrainDepth"),Y=new s.b4(H.LESS,s.b4.ReadWrite,A.depthRangeFor3D);for(const Q of B){const te=R.getTile(Q),ee=Au(Q.projMatrix,0,[0,0,0]);P.setupElevationDraw(te,Z),Z.draw(A,H.TRIANGLES,Y,s.b6.disabled,s.a.unblended,s.b5.backCCW,ee,"terrain_depth",P.gridBuffer,P.gridIndexBuffer,P.gridNoSkirtSegments)}}(l,this,v,this.proxyCoords)}_setupProxiedCoordsForOrtho(l,f,v){if(l.getSource()instanceof s.aK)return this._setupProxiedCoordsForImageSource(l,f,v);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const w=this.proxiedCoords[l.id]=[],S=this.proxyCoords;for(let R=0;R<S.length;R++){const B=S[R],U=this._findTileCoveringTileID(B,l);if(U){const H=this._createProxiedId(B,U,v[B.key]&&v[B.key][l.id]);w.push(H),this.proxyToSource[B.key][l.id]=[H]}}let A=!1;const P=new Set;for(let R=0;R<f.length;R++){const B=l.getTile(f[R]);if(!B||!B.hasData())continue;const U=this._findTileCoveringTileID(B.tileID,this.proxySourceCache);if(U&&U.tileID.canonical.z!==B.tileID.canonical.z){const H=this.proxyToSource[U.tileID.key][l.id],Z=this._createProxiedId(U.tileID,B,v[U.tileID.key]&&v[U.tileID.key][l.id]);H?H.splice(H.length-1,0,Z):this.proxyToSource[U.tileID.key][l.id]=[Z];const Y=this.proxyToSource[U.tileID.key][l.id];P.has(Y)||P.add(Y),w.push(Z),A=!0}}if(this._sourceTilesOverlap[l.id]=A,A&&this._debugParams.sortTilesHiZFirst)for(const R of P)R.sort((B,U)=>U.overscaledZ-B.overscaledZ)}_setupProxiedCoordsForImageSource(l,f,v){if(!l.getSource().loaded())return;const w=this.proxiedCoords[l.id]=[],S=this.proxyCoords,A=l.getSource(),P=A.tileID;if(!P)return;const R=new s.P(P.x,P.y)._div(1<<P.z),B=A.coordinates.map(s.M.fromLngLat).reduce((H,Z)=>(H.min.x=Math.min(H.min.x,Z.x-R.x),H.min.y=Math.min(H.min.y,Z.y-R.y),H.max.x=Math.max(H.max.x,Z.x-R.x),H.max.y=Math.max(H.max.y,Z.y-R.y),H),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),U=(H,Z)=>{const Y=H.wrap+H.canonical.x/(1<<H.canonical.z),Q=H.canonical.y/(1<<H.canonical.z),te=s.J/(1<<H.canonical.z),ee=Z.wrap+Z.canonical.x/(1<<Z.canonical.z),K=Z.canonical.y/(1<<Z.canonical.z);return Y+te<ee+B.min.x||Y>ee+B.max.x||Q+te<K+B.min.y||Q>K+B.max.y};for(let H=0;H<S.length;H++){const Z=S[H];for(let Y=0;Y<f.length;Y++){const Q=l.getTile(f[Y]);if(!Q||!Q.hasData()||U(Z,Q.tileID))continue;const te=this._createProxiedId(Z,Q,v[Z.key]&&v[Z.key][l.id]),ee=this.proxyToSource[Z.key][l.id];ee?ee.push(te):this.proxyToSource[Z.key][l.id]=[te],w.push(te)}}}_createProxiedId(l,f,v){let w=this.orthoMatrix;if(v){const S=v.find(A=>A.key===f.tileID.key);if(S)return S}if(f.tileID.key!==l.key){const S=l.canonical.z-f.tileID.canonical.z;let A,P,R;w=s.m.create();const B=f.tileID.wrap-l.wrap<<l.overscaledZ;S>0?(A=s.J>>S,P=A*((f.tileID.canonical.x<<S)-l.canonical.x+B),R=A*((f.tileID.canonical.y<<S)-l.canonical.y)):(A=s.J<<-S,P=s.J*(f.tileID.canonical.x-(l.canonical.x+B<<-S)),R=s.J*(f.tileID.canonical.y-(l.canonical.y<<-S))),s.m.ortho(w,0,A,0,A,0,1),s.m.translate(w,w,[P,R,0])}return new Ca(f.tileID,l.key,w)}_findTileCoveringTileID(l,f){let v=f.getTile(l);if(v&&v.hasData())return v;const w=this._findCoveringTileCache[f.id],S=w[l.key];if(v=S?f.getTileByID(S):null,v&&v.hasData()||S===null)return v;let A=v?v.tileID:l,P=A.overscaledZ;const R=f.getSource().minzoom,B=[];if(!S){const H=f.getSource().maxzoom;if(l.canonical.z>=H){const Z=l.canonical.z-H;f.getSource().reparseOverscaled?(P=Math.max(l.canonical.z+2,f.transform.tileZoom),A=new s.O(P,l.wrap,H,l.canonical.x>>Z,l.canonical.y>>Z)):Z!==0&&(P=H,A=new s.O(P,l.wrap,H,l.canonical.x>>Z,l.canonical.y>>Z))}A.key!==l.key&&(B.push(A.key),v=f.getTile(A))}const U=H=>{B.forEach(Z=>{w[Z]=H}),B.length=0};for(P-=1;P>=R&&(!v||!v.hasData());P--){v&&U(v.tileID.key);const H=A.calculateScaledKey(P);if(v=f.getTileByID(H),v&&v.hasData())break;const Z=w[H];if(Z===null)break;Z===void 0?B.push(H):v=f.getTileByID(Z)}return U(v?v.tileID.key:null),v&&v.hasData()?v:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,f){let v=this._tilesDirty[l];v||(v=this._tilesDirty[l]={}),v[f.key]=!0}}function Pu(_,l,f){const v=function(P,R,B){const U=s.v.dot(R,P),H=s.v.dot(B,[.2126,.7152,.0722]),Z=(Q,te,ee)=>(1-ee)*Q+ee*te,Y=Z(1-.3*Math.min(H,1),1,Math.min(U+1,1));return Z(.92,1,Math.asin(s.c(R[2],-1,1))/Math.PI+.5)*Y}(_,[0,0,1],l),w=[0,0,0];s.v.scale(w,f.slice(0,3),v);const S=[0,0,0];s.v.scale(S,l.slice(0,3),_[2]);const A=[0,0,0];return s.v.add(A,w,S),s.bw(A)}const Vl=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Ns=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Lc{static cacheKey(l,f,v,w){let S=`${f}${w?w.cacheKey:""}`;for(const A of v)l.usedDefines.includes(A)&&(S+=`/${A}`);return S}constructor(l,f,v,w,S,A){const P=l.gl;this.program=P.createProgram(),this.configuration=w,this.name=f,this.fixedDefines=[...A];const R=w?w.getBinderAttributes():[],B=(v.staticAttributes||[]).concat(R);let U=w?w.defines():[];U=U.concat(A.map(ee=>`#define ${ee}`));const H=`#version 300 es
`;let Z=H+U.concat("precision mediump float;",na,ia.fragmentSource).join(`
`);for(const ee of v.fragmentIncludes)Z+=`
${zs[ee]}`;Z+=`
${v.fragmentSource}`;let Y=H+U.concat("precision highp float;",na,ia.vertexSource).join(`
`);for(const ee of v.vertexIncludes)Y+=`
${zs[ee]}`;Y+=`
${v.vertexSource}`;const Q=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);P.shaderSource(Q,Z),P.compileShader(Q),P.attachShader(this.program,Q);const te=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(te,Y),P.compileShader(te),P.attachShader(this.program,te),this.attributes={},this.numAttributes=B.length;for(let ee=0;ee<this.numAttributes;ee++)if(B[ee]){const K=B[ee].startsWith("a_")?B[ee]:`a_${B[ee]}`;P.bindAttribLocation(this.program,ee,K),this.attributes[K]=ee}P.linkProgram(this.program),P.deleteShader(te),P.deleteShader(Q),this.fixedUniforms=S(l),this.binderUniforms=w?w.getUniforms(l):[],A.includes("TERRAIN")&&(this.terrainUniforms=(ee=>({u_dem:new s.a$(ee),u_dem_prev:new s.a$(ee),u_dem_tl:new s.b0(ee),u_dem_scale:new s.b2(ee),u_dem_tl_prev:new s.b0(ee),u_dem_scale_prev:new s.b2(ee),u_dem_size:new s.b2(ee),u_dem_lerp:new s.b2(ee),u_exaggeration:new s.b2(ee),u_depth:new s.a$(ee),u_depth_size_inv:new s.b0(ee),u_meter_to_dem:new s.b2(ee),u_label_plane_matrix_inv:new s.a_(ee)}))(l)),A.includes("GLOBE")&&(this.globeUniforms=(ee=>({u_tile_tl_up:new s.b7(ee),u_tile_tr_up:new s.b7(ee),u_tile_br_up:new s.b7(ee),u_tile_bl_up:new s.b7(ee),u_tile_up_scale:new s.b2(ee)}))(l)),A.includes("FOG")&&(this.fogUniforms=(ee=>({u_fog_matrix:new s.a_(ee),u_fog_range:new s.b0(ee),u_fog_color:new s.b9(ee),u_fog_horizon_blend:new s.b2(ee),u_fog_vertical_limit:new s.b0(ee),u_fog_temporal_offset:new s.b2(ee),u_frustum_tl:new s.b7(ee),u_frustum_tr:new s.b7(ee),u_frustum_br:new s.b7(ee),u_frustum_bl:new s.b7(ee),u_globe_pos:new s.b7(ee),u_globe_radius:new s.b2(ee),u_globe_transition:new s.b2(ee),u_is_globe:new s.a$(ee),u_viewport:new s.b0(ee)}))(l)),A.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ee=>({u_cutoff_params:new s.b9(ee)}))(l)),A.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ee=>({u_lighting_ambient_color:new s.b7(ee),u_lighting_directional_dir:new s.b7(ee),u_lighting_directional_color:new s.b7(ee),u_ground_radiance:new s.b7(ee)}))(l)),A.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ee=>({u_light_matrix_0:new s.a_(ee),u_light_matrix_1:new s.a_(ee),u_fade_range:new s.b0(ee),u_shadow_normal_offset:new s.b7(ee),u_shadow_intensity:new s.b2(ee),u_shadow_texel_size:new s.b2(ee),u_shadow_map_resolution:new s.b2(ee),u_shadow_direction:new s.b7(ee),u_shadow_bias:new s.b7(ee),u_shadowmap_0:new s.a$(ee),u_shadowmap_1:new s.a$(ee)}))(l))}}setTerrainUniformValues(l,f){if(!this.terrainUniforms)return;const v=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const w in f)v[w]&&v[w].set(this.program,w,f[w])}}setGlobeUniformValues(l,f){if(!this.globeUniforms)return;const v=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const w in f)v[w]&&v[w].set(this.program,w,f[w])}}setFogUniformValues(l,f){if(!this.fogUniforms)return;const v=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const w in f)v[w].set(this.program,w,f[w])}}setCutoffUniformValues(l,f){if(!this.cutoffUniforms)return;const v=this.cutoffUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const w in f)v[w].set(this.program,w,f[w])}}setLightsUniformValues(l,f){if(!this.lightsUniforms)return;const v=this.lightsUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const w in f)v[w].set(this.program,w,f[w])}}setShadowUniformValues(l,f){if(this.failedToCreate||!this.shadowUniforms)return;const v=this.shadowUniforms;l.program.set(this.program);for(const w in f)v[w].set(this.program,w,f[w])}_drawDebugWireframe(l,f,v,w,S,A,P,R,B,U){const H=l.options.wireframe;if(H.terrain===!1&&H.layers2D===!1&&H.layers3D===!1)return;const Z=l.context;if(!(!(!H.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!H.layers2D||l._terrain&&l._terrain.renderingToTexture||!Vl.includes(this.name))||!(!H.layers3D||!Ns.includes(this.name))))return;const Y=Z.gl,Q=l.wireframeDebugCache.getLinesFromTrianglesBuffer(l.frameCounter,S,Z);if(!Q)return;const te=[...this.fixedDefines];te.push("DEBUG_WIREFRAME");const ee=l.getOrCreateProgram(this.name,{config:this.configuration,defines:te});Z.program.set(ee.program);const K=(_e,se,ue)=>{if(se[_e]&&ue[_e])for(const ve in se[_e])ue[_e][ve]&&ue[_e][ve].set(ue.program,ve,se[_e][ve].current)};B&&B.setUniforms(ee.program,Z,ee.binderUniforms,P,{zoom:R}),K("fixedUniforms",this,ee),K("terrainUniforms",this,ee),K("globeUniforms",this,ee),K("fogUniforms",this,ee),K("lightsUniforms",this,ee),K("shadowUniforms",this,ee),Q.bind(),Z.setColorMode(new s.a([Y.ONE,Y.ONE_MINUS_SRC_ALPHA,Y.ZERO,Y.ONE],s.C.transparent,[!0,!0,!0,!1])),Z.setDepthMode(new s.b4(f.func===Y.LESS?Y.LEQUAL:f.func,s.b4.ReadOnly,f.range)),Z.setStencilMode(s.b6.disabled);const ce=3*A.primitiveLength*2,ge=3*A.primitiveOffset*2*2;U&&U>1?Y.drawElementsInstanced(Y.LINES,ce,Y.UNSIGNED_SHORT,ge,U):Y.drawElements(Y.LINES,ce,Y.UNSIGNED_SHORT,ge),S.bind(),Z.program.set(this.program),Z.setDepthMode(f),Z.setStencilMode(v),Z.setColorMode(w)}draw(l,f,v,w,S,A,P,R,B,U,H,Z,Y,Q,te,ee){const K=l.context,ce=K.gl;if(this.failedToCreate)return;K.program.set(this.program),K.setDepthMode(v),K.setStencilMode(w),K.setColorMode(S),K.setCullFace(A);for(const se of Object.keys(this.fixedUniforms))this.fixedUniforms[se].set(this.program,se,P[se]);Q&&Q.setUniforms(this.program,K,this.binderUniforms,Z,{zoom:Y});const ge={[ce.LINES]:2,[ce.TRIANGLES]:3,[ce.LINE_STRIP]:1}[f],_e=ee&&ee>0?1:void 0;for(const se of H.get()){const ue=se.vaos||(se.vaos={});(ue[R]||(ue[R]=new Fl)).bind(K,this,B,Q?Q.getPaintVertexBuffers():[],U,se.vertexOffset,te||[],_e),ee&&ee>1?ce.drawElementsInstanced(f,se.primitiveLength*ge,ce.UNSIGNED_SHORT,se.primitiveOffset*ge*2,ee):ce.drawElements(f,se.primitiveLength*ge,ce.UNSIGNED_SHORT,se.primitiveOffset*ge*2),f===ce.TRIANGLES&&this._drawDebugWireframe(l,v,w,S,U,se,Z,Y,Q,ee)}}}function Vs(_,l){const f=Math.pow(2,l.tileID.overscaledZ),v=l.tileSize*Math.pow(2,_.transform.tileZoom)/f,w=v*(l.tileID.canonical.x+l.tileID.wrap*f),S=v*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture?l.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ay(l,1,_.transform.tileZoom),u_pixel_coord_upper:[w>>16,S>>16],u_pixel_coord_lower:[65535&w,65535&S]}}const Ul=s.m.create(),ws=(_,l,f,v,w,S,A,P,R,B,U,H,Z,Y,Q,te)=>{const ee=l.style.light,K=ee.properties.get("position"),ce=[K.x,K.y,K.z],ge=s.bx.create();ee.properties.get("anchor")==="viewport"&&(s.bx.fromRotation(ge,-l.transform.angle),s.v.transformMat3(ce,ce,ge));const _e=ee.properties.get("color"),se=l.transform,ue={u_matrix:_,u_lightpos:ce,u_lightintensity:ee.properties.get("intensity"),u_lightcolor:[_e.r,_e.g,_e.b],u_vertical_gradient:+f,u_opacity:v,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ul,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:w,u_edge_radius:S,u_flood_light_color:H,u_vertical_scale:Z,u_flood_light_intensity:Y,u_ground_shadow_factor:Q,u_emissive_strength:te};return se.projection.name==="globe"&&(ue.u_tile_id=[A.canonical.x,A.canonical.y,1<<A.canonical.z],ue.u_zoom_transition=R,ue.u_inv_rot_matrix=U,ue.u_merc_center=B,ue.u_up_dir=se.projection.upVector(new s.t(0,0,0),B[0]*s.J,B[1]*s.J),ue.u_height_lift=P),ue},ra=(_,l,f)=>({u_matrix:_,u_edge_radius:l,u_vertical_scale:f}),ld=(_,l,f,v,w,S,A,P,R,B,U,H,Z,Y)=>{const Q=ws(_,l,f,v,w,S,A,R,B,U,H,Z,Y,1,[0,0,0],0),te={u_height_factor:-Math.pow(2,A.overscaledZ)/P.tileSize/8};return s.ak(Q,Vs(l,P),te)},Ts=(_,l)=>({u_matrix:_,u_emissive_strength:l}),ku=(_,l,f,v)=>s.ak(Ts(_,l),Vs(f,v)),Us=(_,l,f)=>({u_matrix:_,u_world:f,u_emissive_strength:l}),Bh=(_,l,f,v,w)=>s.ak(ku(_,l,f,v),{u_world:w}),cd=(_,l,f,v)=>{const w=s.J/f.tileSize;return{u_matrix:_,u_camera_to_center_distance:l.getCameraToCenterDistance(v),u_extrude_scale:[l.pixelsToGLUnits[0]/w,l.pixelsToGLUnits[1]/w]}},jl=(_,l,f=1)=>({u_matrix:_,u_color:l,u_overlay:0,u_overlay_scale:f}),Du=s.m.create(),Lu=(_,l,f,v,w,S,A)=>{const P=_.transform,R=P.projection.name==="globe",B=R?s.by(P.zoom,l.canonical)*P._pixelsPerMercatorPixel:s.ay(f,1,S),U={u_matrix:l.projMatrix,u_extrude_scale:B,u_intensity:A,u_inv_rot_matrix:Du,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){U.u_inv_rot_matrix=v,U.u_merc_center=w,U.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],U.u_zoom_transition=s.ao(P.zoom);const H=w[0]*s.J,Z=w[1]*s.J;U.u_up_dir=P.projection.upVector(new s.t(0,0,0),H,Z)}return U},Ou=(_,l,f,v,w,S,A,P,R,B,U,H,Z,Y,Q,te,ee,K,ce,ge,_e)=>{return{u_matrix:_,u_normalize_matrix:l,u_globe_matrix:f,u_merc_matrix:v,u_grid_matrix:w,u_tl_parent:S,u_scale_parent:B,u_fade_t:U.mix,u_opacity:U.opacity*H.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:H.paint.get("raster-brightness-min"),u_brightness_high:H.paint.get("raster-brightness-max"),u_saturation_factor:(ue=H.paint.get("raster-saturation"),ue>0?1-1/(1.001-ue):-ue),u_contrast_factor:(se=H.paint.get("raster-contrast"),se>0?1/(1-se):1+se),u_spin_weights:Gl(H.paint.get("raster-hue-rotate")),u_perspective_transform:Z,u_raster_elevation:Y,u_zoom_transition:A,u_merc_center:P,u_cutoff_params:R,u_colorization_mix:Hl(te,K),u_colorization_offset:Ru(ee,K),u_color_ramp:Q,u_texture_offset:[ge/(ce+2*ge),ce/(ce+2*ge)],u_texture_res:[ce+2*ge,ce+2*ge],u_emissive_strength:_e};var se,ue};function Gl(_){_*=Math.PI/180;const l=Math.sin(_),f=Math.cos(_);return[(2*f+1)/3,(-Math.sqrt(3)*l-f+1)/3,(Math.sqrt(3)*l-f+1)/3]}function Hl([_,l,f,v],[w,S]){if(w===S)return[0,0,0,0];const A=(s.bz+3)/(s.bz+1)/(S-w);return[_*A,l*A,f*A,v*A]}function Ru(_,[l,f]){return l===f?0:((_-l)/(f-l)*(s.bz+3)-1)/(s.bz+1)}const Oc=s.m.create(),Ue=(_,l,f,v,w,S,A,P,R,B,U,H,Z,Y,Q,te,ee,K)=>{const ce=w.transform,ge={u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:ce.getCameraToCenterDistance(te),u_rotate_symbol:+f,u_aspect_ratio:ce.width/ce.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:A,u_coord_matrix:P,u_is_text:+R,u_pitch_with_map:+v,u_texsize:B,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Oc,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Oc,u_up_vector:[0,-1,0],u_icon_transition:K||0,u_icon_saturation:ee};return te.name==="globe"&&(ge.u_tile_id=[U.canonical.x,U.canonical.y,1<<U.canonical.z],ge.u_zoom_transition=H,ge.u_inv_rot_matrix=Y,ge.u_merc_center=Z,ge.u_camera_forward=ce._camera.forward(),ge.u_ecef_origin=s.bA(ce.globeMatrix,U.toUnwrapped()),ge.u_tile_matrix=Float32Array.from(ce.globeMatrix),ge.u_up_vector=Q),ge},ht=(_,l,f,v,w,S,A,P,R,B,U,H,Z,Y,Q,te,ee)=>s.ak(Ue(_,l,f,v,w,S,A,P,R,B,H,Z,Y,Q,te,ee,1),{u_gamma_scale:v?w.transform.getCameraToCenterDistance(ee)*Math.cos(w.terrain?0:w.transform._pitch):1,u_device_pixel_ratio:s.a4.devicePixelRatio,u_is_halo:+U,undefined:void 0}),ai=(_,l,f,v,w,S,A,P,R,B,U,H,Z,Y,Q,te)=>s.ak(ht(_,l,f,v,w,S,A,P,!0,R,!0,U,H,Z,Y,Q,te),{u_texsize_icon:B,u_texture_icon:1}),Ci=(_,l,f,v)=>({u_matrix:_,u_emissive_strength:l,u_opacity:f,u_color:v}),Fn=(_,l,f,v,w,S,A)=>s.ak(function(P,R,B,U){const H=B.imageManager.getPattern(P.toString(),R),{width:Z,height:Y}=B.imageManager.getPixelSize(R),Q=Math.pow(2,U.tileID.overscaledZ),te=U.tileSize*Math.pow(2,B.transform.tileZoom)/Q,ee=te*(U.tileID.canonical.x+U.tileID.wrap*Q),K=te*U.tileID.canonical.y;return{u_image:0,u_pattern_tl:H.tl,u_pattern_br:H.br,u_texsize:[Z,Y],u_pattern_size:H.displaySize,u_tile_units_to_pixels:1/s.ay(U,1,B.transform.tileZoom),u_pixel_coord_upper:[ee>>16,K>>16],u_pixel_coord_lower:[65535&ee,65535&K]}}(w,S,v,A),{u_matrix:_,u_emissive_strength:l,u_opacity:f}),ji={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},nr=(_,l,f,v,w,S,A,P,R,B,U,H,Z=[0,0,0])=>{const Y=v.style.light,Q=Y.properties.get("position"),te=[-Q.x,-Q.y,Q.z],ee=s.bx.create();Y.properties.get("anchor")==="viewport"&&(s.bx.fromRotation(ee,-v.transform.angle),s.v.transformMat3(te,te,ee));const K=B.alphaMode==="MASK",ce=Y.properties.get("color"),ge=H.paint.get("model-ambient-occlusion-intensity"),_e=H.paint.get("model-color").constantOr(s.C.white),se=H.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:_,u_lighting_matrix:l,u_normal_matrix:f,u_lightpos:te,u_lightintensity:Y.properties.get("intensity"),u_lightcolor:[ce.r,ce.g,ce.b],u_camera_pos:Z,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+K,u_alphaCutoff:B.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[A[0],A[1],A[2],1],u_metallicFactor:P,u_roughnessFactor:R,u_baseColorTexture:ji.BaseColor,u_metallicRoughnessTexture:ji.MetallicRoughness,u_normalTexture:ji.Normal,u_occlusionTexture:ji.Occlusion,u_emissionTexture:ji.Emission,u_color_mix:[_e.r,_e.g,_e.b,se],u_aoIntensity:ge,u_emissive_strength:U}},rr=new Float32Array(16),bo=(_,l=rr,f=rr)=>({u_matrix:_,u_instance:l,u_node_matrix:f}),Rr={fillExtrusion:_=>({u_matrix:new s.a_(_),u_lightpos:new s.b7(_),u_lightintensity:new s.b2(_),u_lightcolor:new s.b7(_),u_vertical_gradient:new s.b2(_),u_opacity:new s.b2(_),u_edge_radius:new s.b2(_),u_ao:new s.b0(_),u_tile_id:new s.b7(_),u_zoom_transition:new s.b2(_),u_inv_rot_matrix:new s.a_(_),u_merc_center:new s.b0(_),u_up_dir:new s.b7(_),u_height_lift:new s.b2(_),u_flood_light_color:new s.b7(_),u_vertical_scale:new s.b2(_),u_flood_light_intensity:new s.b2(_),u_ground_shadow_factor:new s.b7(_),u_emissive_strength:new s.b2(_)}),fillExtrusionDepth:_=>({u_matrix:new s.a_(_),u_edge_radius:new s.b2(_),u_vertical_scale:new s.b2(_)}),fillExtrusionPattern:_=>({u_matrix:new s.a_(_),u_lightpos:new s.b7(_),u_lightintensity:new s.b2(_),u_lightcolor:new s.b7(_),u_vertical_gradient:new s.b2(_),u_height_factor:new s.b2(_),u_edge_radius:new s.b2(_),u_ao:new s.b0(_),u_tile_id:new s.b7(_),u_zoom_transition:new s.b2(_),u_inv_rot_matrix:new s.a_(_),u_merc_center:new s.b0(_),u_up_dir:new s.b7(_),u_height_lift:new s.b2(_),u_image:new s.a$(_),u_texsize:new s.b0(_),u_pixel_coord_upper:new s.b0(_),u_pixel_coord_lower:new s.b0(_),u_tile_units_to_pixels:new s.b2(_),u_opacity:new s.b2(_)}),fillExtrusionGroundEffect:_=>({u_matrix:new s.a_(_),u_opacity:new s.b2(_),u_ao_pass:new s.b2(_),u_meter_to_tile:new s.b2(_),u_ao:new s.b0(_),u_flood_light_intensity:new s.b2(_),u_flood_light_color:new s.b7(_),u_attenuation:new s.b2(_),u_edge_radius:new s.b2(_),u_fb:new s.a$(_),u_fb_size:new s.b2(_)}),fill:_=>({u_matrix:new s.a_(_),u_emissive_strength:new s.b2(_)}),fillPattern:_=>({u_matrix:new s.a_(_),u_emissive_strength:new s.b2(_),u_image:new s.a$(_),u_texsize:new s.b0(_),u_pixel_coord_upper:new s.b0(_),u_pixel_coord_lower:new s.b0(_),u_tile_units_to_pixels:new s.b2(_)}),fillOutline:_=>({u_matrix:new s.a_(_),u_emissive_strength:new s.b2(_),u_world:new s.b0(_)}),fillOutlinePattern:_=>({u_matrix:new s.a_(_),u_emissive_strength:new s.b2(_),u_world:new s.b0(_),u_image:new s.a$(_),u_texsize:new s.b0(_),u_pixel_coord_upper:new s.b0(_),u_pixel_coord_lower:new s.b0(_),u_tile_units_to_pixels:new s.b2(_)}),circle:s.bB,collisionBox:_=>({u_matrix:new s.a_(_),u_camera_to_center_distance:new s.b2(_),u_extrude_scale:new s.b0(_)}),collisionCircle:_=>({u_matrix:new s.a_(_),u_inv_matrix:new s.a_(_),u_camera_to_center_distance:new s.b2(_),u_viewport_size:new s.b0(_)}),debug:_=>({u_color:new s.b1(_),u_matrix:new s.a_(_),u_overlay:new s.a$(_),u_overlay_scale:new s.b2(_)}),clippingMask:_=>({u_matrix:new s.a_(_)}),heatmap:_=>({u_extrude_scale:new s.b2(_),u_intensity:new s.b2(_),u_matrix:new s.a_(_),u_inv_rot_matrix:new s.a_(_),u_merc_center:new s.b0(_),u_tile_id:new s.b7(_),u_zoom_transition:new s.b2(_),u_up_dir:new s.b7(_)}),heatmapTexture:_=>({u_image:new s.a$(_),u_color_ramp:new s.a$(_),u_opacity:new s.b2(_)}),hillshade:_=>({u_matrix:new s.a_(_),u_image:new s.a$(_),u_latrange:new s.b0(_),u_light:new s.b0(_),u_shadow:new s.b1(_),u_highlight:new s.b1(_),u_emissive_strength:new s.b2(_),u_accent:new s.b1(_)}),hillshadePrepare:_=>({u_matrix:new s.a_(_),u_image:new s.a$(_),u_dimension:new s.b0(_),u_zoom:new s.b2(_)}),line:s.bC,linePattern:s.bD,raster:_=>({u_matrix:new s.a_(_),u_normalize_matrix:new s.a_(_),u_globe_matrix:new s.a_(_),u_merc_matrix:new s.a_(_),u_grid_matrix:new s.b8(_),u_tl_parent:new s.b0(_),u_scale_parent:new s.b2(_),u_fade_t:new s.b2(_),u_opacity:new s.b2(_),u_image0:new s.a$(_),u_image1:new s.a$(_),u_brightness_low:new s.b2(_),u_brightness_high:new s.b2(_),u_saturation_factor:new s.b2(_),u_contrast_factor:new s.b2(_),u_spin_weights:new s.b7(_),u_perspective_transform:new s.b0(_),u_raster_elevation:new s.b2(_),u_zoom_transition:new s.b2(_),u_merc_center:new s.b0(_),u_cutoff_params:new s.b9(_),u_colorization_mix:new s.b9(_),u_colorization_offset:new s.b2(_),u_color_ramp:new s.a$(_),u_texture_offset:new s.b0(_),u_texture_res:new s.b0(_),u_emissive_strength:new s.b2(_)}),symbolIcon:_=>({u_is_size_zoom_constant:new s.a$(_),u_is_size_feature_constant:new s.a$(_),u_size_t:new s.b2(_),u_size:new s.b2(_),u_camera_to_center_distance:new s.b2(_),u_rotate_symbol:new s.a$(_),u_aspect_ratio:new s.b2(_),u_fade_change:new s.b2(_),u_matrix:new s.a_(_),u_label_plane_matrix:new s.a_(_),u_coord_matrix:new s.a_(_),u_is_text:new s.a$(_),u_pitch_with_map:new s.a$(_),u_texsize:new s.b0(_),u_tile_id:new s.b7(_),u_zoom_transition:new s.b2(_),u_inv_rot_matrix:new s.a_(_),u_merc_center:new s.b0(_),u_camera_forward:new s.b7(_),u_tile_matrix:new s.a_(_),u_up_vector:new s.b7(_),u_ecef_origin:new s.b7(_),u_texture:new s.a$(_),u_icon_transition:new s.b2(_),u_icon_saturation:new s.b2(_)}),symbolSDF:_=>({u_is_size_zoom_constant:new s.a$(_),u_is_size_feature_constant:new s.a$(_),u_size_t:new s.b2(_),u_size:new s.b2(_),u_camera_to_center_distance:new s.b2(_),u_rotate_symbol:new s.a$(_),u_aspect_ratio:new s.b2(_),u_fade_change:new s.b2(_),u_matrix:new s.a_(_),u_label_plane_matrix:new s.a_(_),u_coord_matrix:new s.a_(_),u_is_text:new s.a$(_),u_pitch_with_map:new s.a$(_),u_texsize:new s.b0(_),u_texture:new s.a$(_),u_gamma_scale:new s.b2(_),u_device_pixel_ratio:new s.b2(_),u_tile_id:new s.b7(_),u_zoom_transition:new s.b2(_),u_inv_rot_matrix:new s.a_(_),u_merc_center:new s.b0(_),u_camera_forward:new s.b7(_),u_tile_matrix:new s.a_(_),u_up_vector:new s.b7(_),u_ecef_origin:new s.b7(_),u_is_halo:new s.a$(_)}),symbolTextAndIcon:_=>({u_is_size_zoom_constant:new s.a$(_),u_is_size_feature_constant:new s.a$(_),u_size_t:new s.b2(_),u_size:new s.b2(_),u_camera_to_center_distance:new s.b2(_),u_rotate_symbol:new s.a$(_),u_aspect_ratio:new s.b2(_),u_fade_change:new s.b2(_),u_matrix:new s.a_(_),u_label_plane_matrix:new s.a_(_),u_coord_matrix:new s.a_(_),u_is_text:new s.a$(_),u_pitch_with_map:new s.a$(_),u_texsize:new s.b0(_),u_texsize_icon:new s.b0(_),u_texture:new s.a$(_),u_texture_icon:new s.a$(_),u_gamma_scale:new s.b2(_),u_device_pixel_ratio:new s.b2(_),u_is_halo:new s.a$(_)}),background:_=>({u_matrix:new s.a_(_),u_emissive_strength:new s.b2(_),u_opacity:new s.b2(_),u_color:new s.b1(_)}),backgroundPattern:_=>({u_matrix:new s.a_(_),u_emissive_strength:new s.b2(_),u_opacity:new s.b2(_),u_image:new s.a$(_),u_pattern_tl:new s.b0(_),u_pattern_br:new s.b0(_),u_texsize:new s.b0(_),u_pattern_size:new s.b0(_),u_pixel_coord_upper:new s.b0(_),u_pixel_coord_lower:new s.b0(_),u_tile_units_to_pixels:new s.b2(_)}),terrainRaster:Dc,terrainDepth:Dc,skybox:_=>({u_matrix:new s.a_(_),u_sun_direction:new s.b7(_),u_cubemap:new s.a$(_),u_opacity:new s.b2(_),u_temporal_offset:new s.b2(_)}),skyboxGradient:_=>({u_matrix:new s.a_(_),u_color_ramp:new s.a$(_),u_center_direction:new s.b7(_),u_radius:new s.b2(_),u_opacity:new s.b2(_),u_temporal_offset:new s.b2(_)}),skyboxCapture:_=>({u_matrix_3f:new s.b8(_),u_sun_direction:new s.b7(_),u_sun_intensity:new s.b2(_),u_color_tint_r:new s.b9(_),u_color_tint_m:new s.b9(_),u_luminance:new s.b2(_)}),globeRaster:_=>({u_proj_matrix:new s.a_(_),u_globe_matrix:new s.a_(_),u_normalize_matrix:new s.a_(_),u_merc_matrix:new s.a_(_),u_zoom_transition:new s.b2(_),u_merc_center:new s.b0(_),u_image0:new s.a$(_),u_grid_matrix:new s.b8(_),u_skirt_height:new s.b2(_),u_frustum_tl:new s.b7(_),u_frustum_tr:new s.b7(_),u_frustum_br:new s.b7(_),u_frustum_bl:new s.b7(_),u_globe_pos:new s.b7(_),u_globe_radius:new s.b2(_),u_viewport:new s.b0(_)}),globeAtmosphere:_=>({u_frustum_tl:new s.b7(_),u_frustum_tr:new s.b7(_),u_frustum_br:new s.b7(_),u_frustum_bl:new s.b7(_),u_horizon:new s.b2(_),u_transition:new s.b2(_),u_fadeout_range:new s.b2(_),u_color:new s.b9(_),u_high_color:new s.b9(_),u_space_color:new s.b9(_),u_temporal_offset:new s.b2(_),u_horizon_angle:new s.b2(_)}),model:_=>({u_matrix:new s.a_(_),u_lighting_matrix:new s.a_(_),u_normal_matrix:new s.a_(_),u_lightpos:new s.b7(_),u_lightintensity:new s.b2(_),u_lightcolor:new s.b7(_),u_camera_pos:new s.b7(_),u_opacity:new s.b2(_),u_baseColorFactor:new s.b9(_),u_emissiveFactor:new s.b9(_),u_metallicFactor:new s.b2(_),u_roughnessFactor:new s.b2(_),u_baseTextureIsAlpha:new s.a$(_),u_alphaMask:new s.a$(_),u_alphaCutoff:new s.b2(_),u_baseColorTexture:new s.a$(_),u_metallicRoughnessTexture:new s.a$(_),u_normalTexture:new s.a$(_),u_occlusionTexture:new s.a$(_),u_emissionTexture:new s.a$(_),u_color_mix:new s.b9(_),u_aoIntensity:new s.b2(_),u_emissive_strength:new s.b2(_)}),modelDepth:_=>({u_matrix:new s.a_(_),u_instance:new s.a_(_),u_node_matrix:new s.a_(_)}),groundShadow:_=>({u_matrix:new s.a_(_),u_ground_shadow_factor:new s.b7(_)}),stars:_=>({u_matrix:new s.a_(_),u_up:new s.b7(_),u_right:new s.b7(_),u_intensity_multiplier:new s.b2(_)})};let mr;function Go(_,l,f,v,w,S,A){const P=_.context,R=P.gl,B=_.transform,U=_.getOrCreateProgram("collisionBox"),H=[];let Z=0,Y=0;for(let _e=0;_e<v.length;_e++){const se=v[_e],ue=l.getTile(se),ve=ue.getBucket(f);if(!ve)continue;const Me=Xi(se,ve,B);let be=Me;w[0]===0&&w[1]===0||(be=_.translatePosMatrix(Me,ue,w,S));const Ce=A?ve.textCollisionBox:ve.iconCollisionBox,$e=ve.collisionCircleArray;if($e.length>0){const Ne=s.m.create(),qe=be;s.m.mul(Ne,ve.placementInvProjMatrix,B.glCoordMatrix),s.m.mul(Ne,Ne,ve.placementViewportMatrix),H.push({circleArray:$e,circleOffset:Y,transform:qe,invTransform:Ne,projection:ve.getProjection()}),Z+=$e.length/4,Y=Z}Ce&&(_.terrain&&_.terrain.setupElevationDraw(ue,U),U.draw(_,R.LINES,s.b4.disabled,s.b6.disabled,_.colorModeForRenderPass(),s.b5.disabled,cd(be,B,ue,ve.getProjection()),f.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,null,B.zoom,null,[Ce.collisionVertexBuffer,Ce.collisionVertexBufferExt]))}if(!A||!H.length)return;const Q=_.getOrCreateProgram("collisionCircle"),te=new s.bE;te.resize(4*Z),te._trim();let ee=0;for(const _e of H)for(let se=0;se<_e.circleArray.length/4;se++){const ue=4*se,ve=_e.circleArray[ue+0],Me=_e.circleArray[ue+1],be=_e.circleArray[ue+2],Ce=_e.circleArray[ue+3];te.emplace(ee++,ve,Me,be,Ce,0),te.emplace(ee++,ve,Me,be,Ce,1),te.emplace(ee++,ve,Me,be,Ce,2),te.emplace(ee++,ve,Me,be,Ce,3)}(!mr||mr.length<2*Z)&&(mr=function(_e){const se=2*_e,ue=new s.bp;ue.resize(se),ue._trim();for(let ve=0;ve<se;ve++){const Me=6*ve;ue.uint16[Me+0]=4*ve+0,ue.uint16[Me+1]=4*ve+1,ue.uint16[Me+2]=4*ve+2,ue.uint16[Me+3]=4*ve+2,ue.uint16[Me+4]=4*ve+3,ue.uint16[Me+5]=4*ve+0}return ue}(Z));const K=P.createIndexBuffer(mr,!0),ce=P.createVertexBuffer(te,s.bF.members,!0);for(const _e of H){const se={u_matrix:_e.transform,u_inv_matrix:_e.invTransform,u_camera_to_center_distance:(ge=B).getCameraToCenterDistance(_e.projection),u_viewport_size:[ge.width,ge.height]};Q.draw(_,R.TRIANGLES,s.b4.disabled,s.b6.disabled,_.colorModeForRenderPass(),s.b5.disabled,se,f.id,ce,K,s.bm.simpleSegment(0,2*_e.circleOffset,_e.circleArray.length,_e.circleArray.length/2),null,B.zoom)}var ge;ce.destroy(),K.destroy()}const Ho=s.m.create();function Gr({width:_,height:l,anchor:f,textOffset:v,textScale:w},S){const{horizontalAlign:A,verticalAlign:P}=s.aY(f),R=-(A-.5)*_,B=-(P-.5)*l,U=s.aW(f,v);return new s.P((R/w+U[0])*S,(B/w+U[1])*S)}function fs(_,l,f,v,w,S,A,P,R,B,U){const H=_.text.placedSymbolArray,Z=_.text.dynamicLayoutVertexArray,Y=_.icon.dynamicLayoutVertexArray,Q={},te=_.getProjection(),ee=Gn(P,te,S),K=S.elevation,ce=te.upVectorScale(P.canonical,S.center.lat,S.worldSize).metersToTile;Z.clear();for(let ge=0;ge<H.length;ge++){const _e=H.get(ge),{tileAnchorX:se,tileAnchorY:ue,numGlyphs:ve}=_e,Me=_e.hidden||!_e.crossTileID||_.allowVerticalPlacement&&!_e.placedOrientation?null:v[_e.crossTileID];if(Me){let be=0,Ce=0,$e=0;if(K){const _t=K?K.getAtTileOffset(P,se,ue):0,[ut,ti,Ht]=te.upVector(P.canonical,se,ue);be=_t*ut*ce,Ce=_t*ti*ce,$e=_t*Ht*ce}let[Ne,qe,Le,Ke]=Ar(_e.projectedAnchorX+be,_e.projectedAnchorY+Ce,_e.projectedAnchorZ+$e,f?ee:A);const He=Qe(S.getCameraToCenterDistance(te),Ke);let nt=w.evaluateSizeForFeature(_.textSizeData,B,_e)*He/s.aV;f&&(nt*=_.tilePixelRatio/R);const de=Gr(Me,nt);f?({x:Ne,y:qe,z:Le}=te.projectTilePoint(se+de.x,ue+de.y,P.canonical),[Ne,qe,Le]=Ar(Ne+be,qe+Ce,Le+$e,A)):(l&&de._rotate(-S.angle),Ne+=de.x,qe+=de.y,Le=0);const ze=_.allowVerticalPlacement&&_e.placedOrientation===s.W.vertical?Math.PI/2:0;for(let _t=0;_t<ve;_t++)s.k(Z,Ne,qe,Le,ze);U&&_e.associatedIconIndex>=0&&(Q[_e.associatedIconIndex]={x:Ne,y:qe,z:Le,angle:ze})}else yt(ve,Z)}if(U){Y.clear();const ge=_.icon.placedSymbolArray;for(let _e=0;_e<ge.length;_e++){const se=ge.get(_e),{numGlyphs:ue}=se,ve=Q[_e];if(se.hidden||!ve)yt(ue,Y);else{const{x:Me,y:be,z:Ce,angle:$e}=ve;for(let Ne=0;Ne<ue;Ne++)s.k(Y,Me,be,Ce,$e)}}_.icon.dynamicLayoutVertexBuffer.updateData(Y)}_.text.dynamicLayoutVertexBuffer.updateData(Z)}function oa(_,l,f){return f.iconsInText&&l?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function Gi(_,l,f,v,w,S,A,P,R,B,U,H,Z){const Y=_.context,Q=Y.gl,te=_.transform,ee=P==="map",K=R==="map",ce=ee&&f.layout.get("symbol-placement")!=="point",ge=ee&&!K&&!ce,_e=f.layout.get("symbol-sort-key").constantOr(1)!==void 0;let se=!1;const ue=_.depthModeForSublayer(0,s.b4.ReadOnly),ve=[s.E(te.center.lng),s.H(te.center.lat)],Me=f.layout.get("text-variable-anchor"),be=te.projection.name==="globe",Ce=[],$e=[0,-1,0];let Ne=$e;!be&&!te.mercatorFromTransition||ee||(Ne=function(qe){const Le=qe._camera.getWorldToCamera(qe.worldSize,1),Ke=s.m.multiply([],Le,qe.globeMatrix);s.m.invert(Ke,Ke);const He=[0,0,0],nt=[0,1,0,0];return s.e.transformMat4(nt,nt,Ke),He[0]=nt[0],He[1]=nt[1],He[2]=nt[2],s.v.normalize(He,He),He}(te));for(const qe of v){const Le=l.getTile(qe),Ke=Le.getBucket(f);if(!Ke||Ke.projection.name==="mercator"&&be)continue;const He=w?Ke.text:Ke.icon;if(!He||Ke.fullyClipped||!He.segments.get().length)continue;const nt=He.programConfigurations.get(f.id),de=w||Ke.sdfIcons,ze=w?Ke.textSizeData:Ke.iconSizeData,_t=K||te.pitch!==0,ut=s.i(ze,te.zoom);let ti,Ht,hi,Jt,_i=[0,0],yi=null;if(w)Ht=Le.glyphAtlasTexture?Le.glyphAtlasTexture:null,hi=Q.LINEAR,ti=Le.glyphAtlasTexture?Le.glyphAtlasTexture.size:[0,0],Ke.iconsInText&&(_i=Le.imageAtlasTexture?Le.imageAtlasTexture.size:[0,0],yi=Le.imageAtlasTexture?Le.imageAtlasTexture:null,Jt=_t||_.options.rotating||_.options.zooming||ze.kind==="composite"||ze.kind==="camera"?Q.LINEAR:Q.NEAREST);else{const An=f.layout.get("icon-size").constantOr(0)!==1||Ke.iconsNeedLinear;Ht=Le.imageAtlasTexture?Le.imageAtlasTexture:null,hi=de||_.options.rotating||_.options.zooming||An||_t?Q.LINEAR:Q.NEAREST,ti=Le.imageAtlasTexture?Le.imageAtlasTexture.size:[0,0]}const oi=Ke.projection.name==="globe",li=oi?Ne:$e,tn=oi?s.ao(te.zoom):0,Li=Gn(qe,Ke.getProjection(),te),Nn=te.calculatePixelsToTileUnitsMatrix(Le),Mn=Er(Li,Le.tileID.canonical,K,ee,te,Ke.getProjection(),Nn),Do=_.terrain&&K&&ce?s.m.invert(s.m.create(),Mn):Ho,As=jr(Li,Le.tileID.canonical,K,ee,te,Ke.getProjection(),Nn),yn=Me&&Ke.hasTextData(),sn=Ke.hasIconTextFit()&&yn&&Ke.hasIconData();if(ce){const An=te.elevation,qs=An?An.getAtTileOffsetFunc(qe,te.center.lat,te.worldSize,Ke.getProjection()):null,ca=yo(Li,Le.tileID.canonical,K,ee,te,Ke.getProjection(),Nn);xt(Ke,Li,_,w,ca,As,K,B,qs,qe)}const fn=ce||w&&Me||sn,Jn=_.translatePosMatrix(Li,Le,S,A),Kr=fn?Ho:Mn,Hn=_.translatePosMatrix(As,Le,S,A,!0),co=Ke.getProjection().createInversionMatrix(te,qe.canonical),Lo=f.paint.get("icon-image-cross-fade").constantOr(0),uo=[];_.terrainRenderModeElevated()&&K&&uo.push("PITCH_WITH_MAP_TERRAIN"),oi&&(uo.push("PROJECTION_GLOBE_VIEW"),fn&&uo.push("PROJECTED_POS_ON_VIEWPORT")),Lo>0&&uo.push("ICON_TRANSITION"),He.zOffsetVertexBuffer&&uo.push("Z_OFFSET");const Is=de&&f.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ra;de?Ra=Ke.iconsInText?ai(ze.kind,ut,ge,K,_,Jn,Kr,Hn,ti,_i,qe,tn,ve,co,li,Ke.getProjection()):ht(ze.kind,ut,ge,K,_,Jn,Kr,Hn,w,ti,!0,qe,tn,ve,co,li,Ke.getProjection()):(U<1&&uo.push("SATURATION"),Ra=Ue(ze.kind,ut,ge,K,_,Jn,Kr,Hn,w,ti,qe,tn,ve,co,li,Ke.getProjection(),U,Lo));const Ws={program:_.getOrCreateProgram(oa(de,w,Ke),{config:nt,defines:uo}),buffers:He,uniformValues:Ra,atlasTexture:Ht,atlasTextureIcon:yi,atlasInterpolation:hi,atlasInterpolationIcon:Jt,isSDF:de,hasHalo:Is,tile:Le,labelPlaneMatrixInv:Do};if(_e&&Ke.canOverlap){se=!0;const An=He.segments.get();for(const qs of An)Ce.push({segments:new s.bm([qs]),sortKey:qs.sortKey,state:Ws})}else Ce.push({segments:He.segments,sortKey:0,state:Ws})}se&&Ce.sort((qe,Le)=>qe.sortKey-Le.sortKey);for(const qe of Ce){const Le=qe.state;if(_.terrain&&_.terrain.setupElevationDraw(Le.tile,Le.program,{useDepthForOcclusion:te.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Le.labelPlaneMatrixInv}),Y.activeTexture.set(Q.TEXTURE0),Le.atlasTexture&&Le.atlasTexture.bind(Le.atlasInterpolation,Q.CLAMP_TO_EDGE,!0),Le.atlasTextureIcon&&(Y.activeTexture.set(Q.TEXTURE1),Le.atlasTextureIcon&&Le.atlasTextureIcon.bind(Le.atlasInterpolationIcon,Q.CLAMP_TO_EDGE,!0)),_.uploadCommonLightUniforms(_.context,Le.program),Le.hasHalo){const Ke=Le.uniformValues;Ke.u_is_halo=1,js(Le.buffers,qe.segments,f,_,Le.program,ue,H,Z,Ke,2),Ke.u_is_halo=0}else{if(Le.isSDF){const Ke=Le.uniformValues;Le.hasHalo&&(Ke.u_is_halo=1,js(Le.buffers,qe.segments,f,_,Le.program,ue,H,Z,Ke,1)),Ke.u_is_halo=0}js(Le.buffers,qe.segments,f,_,Le.program,ue,H,Z,Le.uniformValues,1)}}}function js(_,l,f,v,w,S,A,P,R,B){const U=[_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer,_.iconTransitioningVertexBuffer,_.globeExtVertexBuffer,_.zOffsetVertexBuffer];w.draw(v,v.context.gl.TRIANGLES,S,A,P,s.b5.disabled,R,f.id,_.layoutVertexBuffer,_.indexBuffer,l,f.paint,v.transform.zoom,_.programConfigurations.get(f.id),U,B)}function Gs(_,l,f,v,w,S,A){const P=_.context.gl,R=f.paint.get("fill-pattern"),B=R&&R.constantOr(1);let U,H,Z,Y,Q;A?(H=B&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=P.LINES):(H=B?"fillPattern":"fill",U=P.TRIANGLES);for(const te of v){const ee=l.getTile(te);if(B&&!ee.patternsLoaded())continue;const K=ee.getBucket(f);if(!K)continue;_.prepareDrawTile();const ce=K.programConfigurations.get(f.id),ge=_.isTileAffectedByFog(te),_e=_.getOrCreateProgram(H,{config:ce,overrideFog:ge});B&&(_.context.activeTexture.set(P.TEXTURE0),ee.imageAtlasTexture&&ee.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),ce.updatePaintBuffers());const se=R.constantOr(null);if(se&&ee.imageAtlas){const Me=ee.imageAtlas.patternPositions[se.toString()];Me&&ce.setConstantPatternPositions(Me)}const ue=_.translatePosMatrix(te.projMatrix,ee,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor")),ve=f.paint.get("fill-emissive-strength");if(A){Y=K.indexBuffer2,Q=K.segments2;const Me=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[P.drawingBufferWidth,P.drawingBufferHeight];Z=H==="fillOutlinePattern"&&B?Bh(ue,ve,_,ee,Me):Us(ue,ve,Me)}else Y=K.indexBuffer,Q=K.segments,Z=B?ku(ue,ve,_,ee):Ts(ue,ve);_.uploadCommonUniforms(_.context,_e,te.toUnwrapped()),_e.draw(_,U,w,_.stencilModeForClipping(te),S,s.b5.disabled,Z,f.id,K.layoutVertexBuffer,Y,Q,f.paint,_.transform.zoom,ce,void 0)}}function rl(_,l,f,v,w,S,A,P){f.resetLayerRenderingStats();const R=_.context,B=R.gl,U=_.transform,H=f.paint.get("fill-extrusion-pattern"),Z=H.constantOr(1),Y=f.paint.get("fill-extrusion-opacity"),Q=_.style.enable3dLights(),te=f.paint.get(Q&&!Z?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ee=[f.paint.get("fill-extrusion-ambient-occlusion-intensity"),te],K=f.layout.get("fill-extrusion-edge-radius"),ce=K>0&&!f.paint.get("fill-extrusion-rounded-roof"),ge=ce?0:K,_e=U.projection.name==="globe"?s.bO():0,se=U.projection.name==="globe",ue=se?s.ao(U.zoom):0,ve=[s.E(U.center.lng),s.H(U.center.lat)],Me=f.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),be=f.paint.get("fill-extrusion-flood-light-intensity"),Ce=f.paint.get("fill-extrusion-vertical-scale"),$e=Aa(_,f.paint.get("fill-extrusion-cutoff-fade-range")),Ne=f.paint.get("fill-extrusion-emissive-strength"),qe=[];let Le;se&&qe.push("PROJECTION_GLOBE_VIEW"),ee[0]>0&&qe.push("FAUX_AO"),ce&&qe.push("ZERO_ROOF_RADIUS"),P&&qe.push("HAS_CENTROID"),be>0&&qe.push("FLOOD_LIGHT"),$e.shouldRenderCutoff&&qe.push("RENDER_CUTOFF");const Ke=_.renderPass==="shadow",He=_.shadowRenderer,nt=Ke&&!!He;_.shadowRenderer&&(_.shadowRenderer.useNormalOffset=!0);let de=[0,0,0];if(He){const ut=_.style.directionalLight,ti=_.style.ambientLight;ut&&ti&&(de=Uh(ut,ti)),Le=qe.concat(["SHADOWS_SINGLE_CASCADE"])}const ze=nt?"fillExtrusionDepth":Z?"fillExtrusionPattern":"fillExtrusion",_t=f.getLayerRenderingStats();for(const ut of v){const ti=l.getTile(ut),Ht=ti.getBucket(f);if(!Ht||Ht.projection.name!==U.projection.name)continue;let hi=!1;He&&(hi=He.getMaxCascadeForTile(ut.toUnwrapped())===0);const Jt=_.isTileAffectedByFog(ut),_i=Ht.programConfigurations.get(f.id),yi=_.getOrCreateProgram(ze,{config:_i,defines:hi?Le:qe,overrideFog:Jt});if(_.terrain&&_.terrain.setupElevationDraw(ti,yi,{useMeterToDem:!0}),!Ht.centroidVertexBuffer){const Mn=yi.attributes.a_centroid_pos;Mn!==void 0&&B.vertexAttrib2f(Mn,0,0)}!Ke&&He&&He.setupShadows(ti.tileID.toUnwrapped(),yi,"vector-tile",ti.tileID.overscaledZ),Z&&(_.context.activeTexture.set(B.TEXTURE0),ti.imageAtlasTexture&&ti.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),_i.updatePaintBuffers());const oi=H.constantOr(null);if(oi&&ti.imageAtlas){const Mn=ti.imageAtlas.patternPositions[oi.toString()];Mn&&_i.setConstantPatternPositions(Mn)}const li=f.paint.get("fill-extrusion-vertical-gradient");let tn;if(Ke&&He){if(sa(ti.tileID,Ht,_))continue;const Mn=He.calculateShadowPassMatrixFromTile(ti.tileID.toUnwrapped());tn=ra(Mn,ge,Ce)}else{const Mn=_.translatePosMatrix(ut.expandedProjMatrix,ti,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),Do=U.projection.createInversionMatrix(U,ut.canonical);tn=Z?ld(Mn,_,li,Y,ee,ge,ut,ti,_e,ue,ve,Do,Me,Ce):ws(Mn,_,li,Y,ee,ge,ut,_e,ue,ve,Do,Me,Ce,be,de,Ne)}_.uploadCommonUniforms(R,yi,ut.toUnwrapped(),null,$e);let Li=Ht.segments;if(U.projection.name==="mercator"&&!Ke&&(Li=Ht.getVisibleSegments(ti.tileID,_.terrain,_.transform.getFrustum(0)),!Li.get().length))continue;if(_t)if(Ke)for(const Mn of Li.get())_t.numRenderedVerticesInShadowPass+=Mn.primitiveLength;else for(const Mn of Li.get())_t.numRenderedVerticesInTransparentPass+=Mn.primitiveLength;const Nn=[];(_.terrain||P)&&Nn.push(Ht.centroidVertexBuffer),se&&Nn.push(Ht.layoutVertexExtBuffer),yi.draw(_,R.gl.TRIANGLES,w,S,A,s.b5.backCCW,tn,f.id,Ht.layoutVertexBuffer,Ht.indexBuffer,Li,f.paint,_.transform.zoom,_i,Nn)}_.shadowRenderer&&(_.shadowRenderer.useNormalOffset=!1)}function ka(_,l,f,v,w,S,A,P,R,B,U,H,Z,Y,Q,te,ee,K,ce){const ge=_.context,_e=ge.gl,se=_.transform,ue=_.transform.zoom,ve=[],Me=Aa(_,f.paint.get("fill-extrusion-cutoff-fade-range"));B==="clear"?(ve.push("CLEAR_SUBPASS"),ce&&(ve.push("CLEAR_FROM_TEXTURE"),ge.activeTexture.set(_e.TEXTURE0),ce.bind(_e.LINEAR,_e.CLAMP_TO_EDGE))):B==="sdf"&&ve.push("SDF_SUBPASS"),ee&&ve.push("HAS_CENTROID"),Me.shouldRenderCutoff&&ve.push("RENDER_CUTOFF");const be=f.layout.get("fill-extrusion-edge-radius"),Ce=($e,Ne,qe,Le,Ke)=>{const He=Ne.programConfigurations.get(f.id),nt=_.isTileAffectedByFog($e),de=_.getOrCreateProgram("fillExtrusionGroundEffect",{config:He,defines:ve,overrideFog:nt}),ze=((ut,ti,Ht,hi,Jt,_i,yi,oi,li,tn,Li)=>({u_matrix:ti,u_opacity:Ht,u_ao_pass:hi?1:0,u_meter_to_tile:Jt,u_ao:_i,u_flood_light_intensity:yi,u_flood_light_color:oi,u_attenuation:li,u_edge_radius:tn,u_fb:0,u_fb_size:Li}))(0,Le,U,R,Ke,[H,Z*Ke],Y,Q,te,ue>=17?0:be*Ke,ce?ce.size[0]:0),_t=[];ee&&_t.push(Ne.hiddenByLandmarkVertexBuffer),_.uploadCommonUniforms(ge,de,$e.toUnwrapped(),null,Me),de.draw(_,ge.gl.TRIANGLES,w,S,A,P,ze,f.id,Ne.vertexBuffer,Ne.indexBuffer,qe,f.paint,ue,He,_t)};for(const $e of v){const Ne=l.getTile($e),qe=Ne.getBucket(f);if(!qe||qe.projection.name!==se.projection.name||!qe.groundEffect||qe.groundEffect&&!qe.groundEffect.hasData())continue;const Le=qe.groundEffect,Ke=1/qe.tileToMeter;{const He=_.translatePosMatrix($e.projMatrix,Ne,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),nt=Le.getDefaultSegment();Ce($e,Le,nt,He,Ke)}if(K)for(let He=0;He<4;He++){const nt=s.bP[He]($e),de=l.getTile(nt);if(!de)continue;const ze=de.getBucket(f);if(!ze||ze.projection.name!==se.projection.name||!ze.groundEffect||ze.groundEffect&&!ze.groundEffect.hasData())continue;const _t=ze.groundEffect;let ut,ti;He===0?(ut=[-s.J,0,0],ti=1):He===1?(ut=[s.J,0,0],ti=0):He===2?(ut=[0,-s.J,0],ti=3):(ut=[0,s.J,0],ti=2);const Ht=_t.regionSegments[ti];if(!Ht)continue;const hi=new Float32Array(16);s.m.translate(hi,$e.projMatrix,ut),Ce($e,_t,Ht,_.translatePosMatrix(hi,Ne,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),Ke)}}}function Nh(_,l,f,v,w,S,A){v.centroidVertexArray.length===0&&v.createCentroidsBuffer();const P=S?S.findDEMTileFor(f):null;if(!(P&&P.dem||A))return;const R=K=>new s.P(Math.ceil((K+s.bS)*s.bT),0),B=K=>{const ce=l.getSource().minzoom,ge=se=>{const ue=l.getTileByID(se);if(ue&&ue.hasData())return ue.getBucket(w)},_e=[0,-1,1];for(const se of _e){if(K.overscaledZ+se<ce)continue;const ue=ge(K.calculateScaledKey(K.overscaledZ+se));if(ue)return ue}},U=[0,0,0],H=(K,ce)=>(U[0]=Math.min(K.min.y,ce.min.y),U[1]=Math.max(K.max.y,ce.max.y),U[2]=s.J-ce.min.x>K.max.x?ce.min.x-s.J:K.max.x,U),Z=(K,ce)=>(U[0]=Math.min(K.min.x,ce.min.x),U[1]=Math.max(K.max.x,ce.max.x),U[2]=s.J-ce.min.y>K.max.y?ce.min.y-s.J:K.max.y,U),Y=[(K,ce)=>H(K,ce),(K,ce)=>H(ce,K),(K,ce)=>Z(K,ce),(K,ce)=>Z(ce,K)],Q=(K,ce,ge,_e,se,ue,ve)=>{if(!S)return 0;const Me=[[ue?ge:K,ue?K:ge,0],[ue?ge:ce,ue?ce:ge,0]],be=ve<0?s.J+ve:ve,Ce=[ue?be:(K+ce)/2,ue?(K+ce)/2:be,0];return ge===0&&ve<0||ge!==0&&ve>0?S.getForTilePoints(se,[Ce],!0,_e):Me.push(Ce),S.getForTilePoints(f,Me,!0,P),Math.max(Me[0][2],Me[1][2],Ce[2])/S.exaggeration()};for(let K=0;K<4;K++){const ce=v.borderFeatureIndices[K];if(ce.length===0)continue;const ge=s.bP[K](f),_e=B(ge);if(!(_e&&_e instanceof s.bQ)||v.borderDoneWithNeighborZ[K]===_e.canonical.z)continue;_e.centroidVertexArray.length===0&&_e.createCentroidsBuffer();const se=S?S.findDEMTileFor(ge):null;if(!(se&&se.dem||A))continue;const ue=(K<2?1:5)-K,ve=_e.borderDoneWithNeighborZ[ue]!==v.canonical.z,Me=_e.borderFeatureIndices[ue];let be=0;if(v.canonical.z!==_e.canonical.z){for(const Ce of ce)v.showCentroid(v.featuresOnBorder[Ce]);if(ve)for(const Ce of Me)_e.showCentroid(_e.featuresOnBorder[Ce]);v.borderDoneWithNeighborZ[K]=_e.canonical.z,_e.borderDoneWithNeighborZ[ue]=v.canonical.z}for(const Ce of ce){const $e=v.featuresOnBorder[Ce],Ne=v.centroidData[$e.centroidDataIndex],qe=$e.borders[K];let Le;for(;be<Me.length;){Le=_e.featuresOnBorder[Me[be]];const Ke=Le.borders[ue];if(Ke[1]>qe[0]+3||Ke[0]>qe[0]-3)break;_e.showCentroid(Le),be++}if(Le&&be<Me.length){const Ke=be;let He=0;for(;!(Le.borders[ue][0]>qe[1]-3)&&(He++,++be!==Me.length);)Le=_e.featuresOnBorder[Me[be]];if(Le=_e.featuresOnBorder[Me[Ke]],He>1){const ze=Le.borders[ue];Math.abs(qe[0]-ze[0])<3&&Math.abs(qe[1]-ze[1])<3&&(He=1,be=Ke+1)}else if(He===0){v.showCentroid($e);continue}const nt=_e.centroidData[Le.centroidDataIndex];A&&He===1&&(((te=Ne).flags|(ee=nt).flags)&s.bR?(te.flags|=s.bR,ee.flags|=s.bR):(te.flags&=~s.bR,ee.flags&=~s.bR));const de=$e.intersectsCount()>1||Le.intersectsCount()>1;if(He>1)be=Ke,Ne.centroidXY=nt.centroidXY=new s.P(0,0);else if(se&&se.dem&&!de){const ze=Y[K](Ne,nt),_t=K%2?s.J-1:0,ut=Q(ze[0],Math.min(s.J-1,ze[1]),_t,se,ge,K<2,ze[2]);Ne.centroidXY=nt.centroidXY=R(ut)}else de?Ne.centroidXY=nt.centroidXY=new s.P(0,0):(Ne.centroidXY=v.encodeBorderCentroid($e),nt.centroidXY=_e.encodeBorderCentroid(Le));v.writeCentroidToBuffer(Ne),_e.writeCentroidToBuffer(nt)}else v.showCentroid($e)}v.borderDoneWithNeighborZ[K]=_e.canonical.z,_e.borderDoneWithNeighborZ[ue]=v.canonical.z}var te,ee;(v.needsCentroidUpdate||!v.centroidVertexBuffer&&v.centroidVertexArray.length!==0)&&v.uploadCentroid(_)}const Pn=[1,0,0],Bn=[0,1,0],Rc=[0,0,1];function sa(_,l,f){const v=f.transform,w=f.shadowRenderer;if(!w)return!0;const S=_.toUnwrapped(),A=v.tileSize*w._cascades[f.currentShadowCascade].scale;let P=l.maxHeight;if(v.elevation){const te=v.elevation.getMinMaxForTile(_);te&&(P+=te.max)}const R=[...w.shadowDirection];R[2]=-R[2];const B=w.computeSimplifiedTileShadowVolume(S,P,A,R);if(!B)return!1;const U=[Pn,Bn,Rc,R,[R[0],0,R[2]],[0,R[1],R[2]]],H=v.projection.name==="globe",Z=v.scaleZoom(A),Y=s.F.fromInvProjectionMatrix(v.invProjMatrix,v.worldSize,Z,!H),Q=w.getCurrentCascadeFrustum();return Y.intersectsPrecise(B.vertices,B.planes,U)===0||Q.intersectsPrecise(B.vertices,B.planes,U)===0}function zu(_){const l=_._nearZ,f=_.projection.farthestPixelDistance(_),v=f-l,w=.2*_.height,S=l+w;return[l,f,(S-w-l)/v,(S-l)/v]}const wo=new s.C(1,0,0,1),ds=new s.C(0,1,0,1),Ss=new s.C(0,0,1,1),Da=new s.C(1,0,1,1),Wl=new s.C(0,1,1,1);function Wo(_,l,f,v,w,S){const A=_.context,P=_.transform,R=A.gl,B=P.projection.name==="globe",U=B?["PROJECTION_GLOBE_VIEW"]:[];let H=s.m.clone(f.projMatrix);if(B&&s.ao(P.zoom)>0){const Le=s.bU(f.canonical,P),Ke=s.bV(Le);H=s.m.multiply(new Float32Array(16),P.globeMatrix,Ke),s.m.multiply(H,P.projMatrix,H)}const Z=s.m.create();Z[12]+=2*w/(s.a4.devicePixelRatio*P.width),Z[13]+=2*S/(s.a4.devicePixelRatio*P.height),s.m.multiply(H,Z,H);const Y=_.getOrCreateProgram("debug",{defines:U}),Q=l.getTileByID(f.key);_.terrain&&_.terrain.setupElevationDraw(Q,Y);const te=s.b4.disabled,ee=s.b6.disabled,K=_.colorModeForRenderPass(),ce="$debug";A.activeTexture.set(R.TEXTURE0),_.emptyTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),B?Q._makeGlobeTileDebugBuffers(_.context,P):Q._makeDebugTileBoundsBuffers(_.context,P.projection);const ge=Q._tileDebugBuffer||_.debugBuffer,_e=Q._tileDebugIndexBuffer||_.debugIndexBuffer,se=Q._tileDebugSegments||_.debugSegments;Y.draw(_,R.LINE_STRIP,te,ee,K,s.b5.disabled,jl(H,v),ce,ge,_e,se,null,null,null,[Q._globeTileDebugBorderBuffer]);const ue=Q.latestRawTileData,ve=Math.floor((ue&&ue.byteLength||0)/1024),Me=l.getTile(f).tileSize,be=512/Math.min(Me,512)*(f.overscaledZ/P.zoom)*.5;let Ce=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(Ce+=` => ${f.overscaledZ}`),Ce+=` ${ve}kb`,function(Le,Ke){Le.initDebugOverlayCanvas();const He=Le.debugOverlayCanvas,nt=Le.context.gl,de=Le.debugOverlayCanvas.getContext("2d");de.clearRect(0,0,He.width,He.height),de.shadowColor="white",de.shadowBlur=2,de.lineWidth=1.5,de.strokeStyle="white",de.textBaseline="top",de.font="bold 36px Open Sans, sans-serif",de.fillText(Ke,5,5),de.strokeText(Ke,5,5),Le.debugOverlayTexture.update(He),Le.debugOverlayTexture.bind(nt.LINEAR,nt.CLAMP_TO_EDGE)}(_,Ce);const $e=Q._tileDebugTextBuffer||_.debugBuffer,Ne=Q._tileDebugTextIndexBuffer||_.quadTriangleIndexBuffer,qe=Q._tileDebugTextSegments||_.debugSegments;Y.draw(_,R.TRIANGLES,te,ee,s.a.alphaBlended,s.b5.disabled,jl(H,s.C.transparent,be),ce,$e,Ne,qe,null,null,null,[Q._globeTileDebugTextBuffer])}function aa(_,l,f,v){ps(_,0,l+f/2,_.transform.width,f,v)}function La(_,l,f,v){ps(_,l-f/2,0,f,_.transform.height,v)}function ps(_,l,f,v,w,S){const A=_.context,P=A.gl;P.enable(P.SCISSOR_TEST),P.scissor(l*s.a4.devicePixelRatio,f*s.a4.devicePixelRatio,v*s.a4.devicePixelRatio,w*s.a4.devicePixelRatio),A.clear({color:S}),P.disable(P.SCISSOR_TEST)}const zc=s.bW([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Oa}=zc;function ko(_,l,f,v){_.emplaceBack(l,f,v)}class qo{constructor(l){this.vertexArray=new s.bX,this.indices=new s.bp,ko(this.vertexArray,-1,-1,1),ko(this.vertexArray,1,-1,1),ko(this.vertexArray,-1,1,1),ko(this.vertexArray,1,1,1),ko(this.vertexArray,-1,-1,-1),ko(this.vertexArray,1,-1,-1),ko(this.vertexArray,-1,1,-1),ko(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,Oa),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=s.bm.simpleSegment(0,0,36,12)}}function ms(_,l,f,v,w,S){const A=_.context.gl,P=l.paint.get("sky-atmosphere-color"),R=l.paint.get("sky-atmosphere-halo-color"),B=l.paint.get("sky-atmosphere-sun-intensity"),U=((H,Z,Y,Q,te)=>({u_matrix_3f:H,u_sun_direction:Z,u_sun_intensity:Y,u_color_tint_r:[Q.r,Q.g,Q.b,Q.a],u_color_tint_m:[te.r,te.g,te.b,te.a],u_luminance:5e-5}))(s.bx.fromMat4(s.bx.create(),v),w,B,P,R);A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_CUBE_MAP_POSITIVE_X+S,l.skyboxTexture,0),f.draw(_,A.TRIANGLES,s.b4.disabled,s.b6.disabled,s.a.unblended,s.b5.frontCW,U,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const ql=s.bW([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ud{constructor(l){const f=new s.bY;f.emplaceBack(-1,1,1,0,0),f.emplaceBack(1,1,1,1,0),f.emplaceBack(1,-1,1,1,1),f.emplaceBack(-1,-1,1,0,1);const v=new s.bp;v.emplaceBack(0,1,2),v.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(f,ql.members),this.indexBuffer=l.createIndexBuffer(v),this.segments=s.bm.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Em=s.bW([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class hd{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15}}class i0{constructor(l){this.colorModeAlphaBlendedWriteRGB=new s.a([s.bZ,s.b_,s.bZ,s.b_],s.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new s.a([s.bZ,s.b$,s.bZ,s.b$],s.C.transparent,[!1,!1,!1,!0]),this.params=new hd,this.allocatedStarsCount=0,l.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1}),l.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01})}update(l){const f=l.context;if(!this.atmosphereBuffer||this.allocatedStarsCount!==this.params.starsCount){this.atmosphereBuffer=new ud(f),this.allocatedStarsCount=this.params.starsCount;const v=100,w=200,S=function(U){const H=s.c2(30),Z=[];for(let Y=0;Y<U;++Y){const Q=2*Math.PI*H(),te=Math.acos(1-2*H())-.5*Math.PI;Z.push(s.v.fromValues(Math.cos(te)*Math.cos(Q),Math.cos(te)*Math.sin(Q),Math.sin(te)))}return Z}(this.allocatedStarsCount),A=s.c2(300),P=new s.c0,R=new s.bp;let B=0;for(let U=0;U<S.length;++U){const H=s.v.scale([],S[U],200),Z=Math.max(0,1+.01*v*(1*A()-.5)),Y=Math.max(0,1+.01*w*(1*A()-.5));P.emplaceBack(H[0],H[1],H[2],-1,-1,Z,Y),P.emplaceBack(H[0],H[1],H[2],1,-1,Z,Y),P.emplaceBack(H[0],H[1],H[2],1,1,Z,Y),P.emplaceBack(H[0],H[1],H[2],-1,1,Z,Y),R.emplaceBack(B+0,B+1,B+2),R.emplaceBack(B+0,B+2,B+3),B+=4}this.starsVx=f.createVertexBuffer(P,Em.members),this.starsIdx=f.createIndexBuffer(R),this.starsSegments=s.bm.simpleSegment(0,0,P.length,R.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(l,f){const v=l.context,w=v.gl,S=l.transform,A=new s.b4(w.LEQUAL,s.b4.ReadOnly,[0,1]),P=s.ao(S.zoom),R=f.properties.get("color").toArray01(),B=f.properties.get("high-color").toArray01(),U=f.properties.get("space-color").toArray01PremultipliedAlpha(),H=5e-4,Z=s.c1(f.properties.get("horizon-blend"),0,1,H,.25),Y=s.bb(l,v,S)&&Z===H?S.worldSize/(2*Math.PI*1.025)-1:S.globeRadius,Q=l.frameCounter/1e3%1,te=s.v.length(S.globeCenterInViewSpace),ee=Math.sqrt(Math.pow(te,2)-Math.pow(Y,2)),K=Math.acos(ee/te),ce=ge=>{const _e=S.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ge&&_e.push("ALPHA_PASS");const se=l.getOrCreateProgram("globeAtmosphere",{defines:_e}),ue=((Me,be,Ce,$e,Ne,qe,Le,Ke,He,nt,de,ze)=>({u_frustum_tl:Me,u_frustum_tr:be,u_frustum_br:Ce,u_frustum_bl:$e,u_horizon:Ne,u_transition:qe,u_fadeout_range:Le,u_color:Ke,u_high_color:He,u_space_color:nt,u_temporal_offset:de,u_horizon_angle:ze}))(S.frustumCorners.TL,S.frustumCorners.TR,S.frustumCorners.BR,S.frustumCorners.BL,S.frustumCorners.horizon,P,Z,R,B,U,Q,K);l.uploadCommonUniforms(v,se);const ve=this.atmosphereBuffer;ve&&se.draw(l,w.TRIANGLES,A,s.b6.disabled,ge?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,s.b5.backCW,ue,ge?"atmosphere_glow_alpha":"atmosphere_glow",ve.vertexBuffer,ve.indexBuffer,ve.segments)};ce(!1),ce(!0)}drawStars(l,f){const v=s.c(f.properties.get("star-intensity"),0,1);if(v===0)return;const w=l.context,S=w.gl,A=l.transform,P=l.getOrCreateProgram("stars"),R=s.q.identity([]);s.q.rotateX(R,R,-A._pitch),s.q.rotateZ(R,R,-A.angle),s.q.rotateX(R,R,s.d(A._center.lat)),s.q.rotateY(R,R,-s.d(A._center.lng));const B=s.m.fromQuat(new Float32Array(16),R),U=s.m.multiply([],A.starsProjMatrix,B),H=s.bx.fromMat4([],B),Z=s.bx.invert([],H),Y=[0,1,0];s.v.transformMat3(Y,Y,Z),s.v.scale(Y,Y,this.params.sizeMultiplier);const Q=[1,0,0];s.v.transformMat3(Q,Q,Z),s.v.scale(Q,Q,this.params.sizeMultiplier);const te=(ee=Y,K=Q,ce=v,{u_matrix:Float32Array.from(U),u_up:ee,u_right:K,u_intensity_multiplier:ce});var ee,K,ce;l.uploadCommonUniforms(w,P),this.starsVx&&this.starsIdx&&P.draw(l,S.TRIANGLES,s.b4.disabled,s.b6.disabled,this.colorModeAlphaBlendedWriteRGB,s.b5.disabled,te,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Vh(_,l){const f=[..._],v=l.cameraWorldSizeForFog/l.worldSize,w=s.m.identity([]);return s.m.scale(w,w,[v,v,1]),s.m.multiply(f,w,f),s.m.multiply(f,l.worldToFogMatrix,f),f}function fd(_,l,f,v){const w=f.material,S=v.context,{baseColorTexture:A,metallicRoughnessTexture:P}=w.pbrMetallicRoughness,{normalTexture:R,occlusionTexture:B,emissionTexture:U}=w;function H(Z,Y,Q){if(Z&&(_.push(Y),S.activeTexture.set(S.gl.TEXTURE0+Q),Z.gfxTexture)){const{minFilter:te,magFilter:ee,wrapS:K,wrapT:ce}=Z.sampler;Z.gfxTexture.bindExtraParam(te,ee,K,ce)}}H(A,"HAS_TEXTURE_u_baseColorTexture",ji.BaseColor),H(P,"HAS_TEXTURE_u_metallicRoughnessTexture",ji.MetallicRoughness),H(R,"HAS_TEXTURE_u_normalTexture",ji.Normal),H(B,"HAS_TEXTURE_u_occlusionTexture",ji.Occlusion),H(U,"HAS_TEXTURE_u_emissionTexture",ji.Emission),f.texcoordBuffer&&(_.push("HAS_ATTRIBUTE_a_uv_2f"),l.push(f.texcoordBuffer)),f.colorBuffer&&(_.push(f.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),l.push(f.colorBuffer)),f.normalBuffer&&(_.push("HAS_ATTRIBUTE_a_normal_3f"),l.push(f.normalBuffer)),f.pbrBuffer&&(_.push("HAS_ATTRIBUTE_a_pbr"),_.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),l.push(f.pbrBuffer)),w.alphaMode!=="OPAQUE"&&w.alphaMode!=="MASK"||_.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||_.push("DIFFUSE_SHADED"),_.push("USE_STANDARD_DERIVATIVES")}function Zl(_,l,f,v,w,S){const A=f.paint.get("model-opacity"),P=l.context,R=new s.b4(l.context.gl.LEQUAL,s.b4.ReadWrite,l.depthRangeFor3D),B=l.transform,U=_.mesh,H=U.material,Z=H.pbrMetallicRoughness,Y=l.style.fog;let Q;Q=l.transform.projection.zAxisUnit==="pixels"?[..._.nodeModelMatrix]:s.m.multiply([],v.zScaleMatrix,_.nodeModelMatrix),s.m.multiply(Q,v.negCameraPosMatrix,Q);const te=s.m.invert([],Q);s.m.transpose(te,te);const ee=f.paint.get("model-emissive-strength").constantOr(0),K=nr(new Float32Array(_.worldViewProjection),new Float32Array(Q),new Float32Array(te),l,A,Z.baseColorFactor,H.emissiveFactor,Z.metallicFactor,Z.roughnessFactor,H,ee,f),ce={defines:[]},ge=[];fd(ce.defines,ge,U,l);const _e=l.shadowRenderer;_e&&(_e.useNormalOffset=!1);let se=null;if(Y){const Me=Vh(_.nodeModelMatrix,l.transform);if(se=new Float32Array(Me),B.projection.name!=="globe"){const be=U.aabb.min,Ce=U.aabb.max,[$e,Ne]=Y.getOpacityForBounds(Me,be[0],be[1],Ce[0],Ce[1]);ce.overrideFog=$e>=vo||Ne>=vo}}const ue=Aa(l,f.paint.get("model-cutoff-fade-range"));ue.shouldRenderCutoff&&ce.defines.push("RENDER_CUTOFF");const ve=l.getOrCreateProgram("model",ce);l.uploadCommonUniforms(P,ve,null,se,ue),l.renderPass!=="shadow"&&_e&&_e.setupShadowsFromMatrix(_.nodeModelMatrix,ve),ve.draw(l,P.gl.TRIANGLES,R,w,S,U.material.doubleSided?s.b5.disabled:s.b5.backCCW,K,f.id,U.vertexBuffer,U.indexBuffer,U.segments,f.paint,l.transform.zoom,void 0,ge)}function Am(_,l,f,v,w,S,A){let P;P=_.projection.name==="globe"?s.c5(f,_):[...f],s.m.multiply(P,P,l.matrix);const R=s.m.multiply([],v,P);if(l.meshes)for(const B of l.meshes){if(B.material.alphaMode!=="BLEND"){A.push({mesh:B,depth:0,modelIndex:w,worldViewProjection:R,nodeModelMatrix:P});continue}const U=s.v.transformMat4([],B.centroid,R);U[2]>0&&S.push({mesh:B,depth:U[2],modelIndex:w,worldViewProjection:R,nodeModelMatrix:P})}if(l.children)for(const B of l.children)Am(_,B,f,v,w,S,A)}function Fu(_,l,f,v){const w=f.shadowRenderer;if(!w)return;const S=w.getShadowPassDepthMode(),A=w.getShadowPassColorMode(),P=w.calculateShadowPassMatrixFromMatrix(l),R=bo(P);f.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(f,f.context.gl.TRIANGLES,S,s.b6.disabled,A,s.b5.backCCW,R,v.id,_.vertexBuffer,_.indexBuffer,_.segments,v.paint,f.transform.zoom,void 0,void 0)}function n0(_,l,f){const v=l.updateZoomBasedPaintProperties(),w=function(S,A,P){let R,B,U,H=S.terrain?S.terrain.exaggeration():0;if(S.terrain&&H>0){const Z=S.terrain,Y=Z.findDEMTileFor(P);Y&&Y.dem?R=s.c7.create(Z,P,Y):H=0}if(H===0&&(A.terrainElevationMin=0,A.terrainElevationMax=0),H===A.validForExaggeration&&(H===0||R&&R._demTile&&R._demTile.tileID===A.validForDEMTile.id&&R._dem._timestamp===A.validForDEMTile.timestamp))return!1;for(const Z in A.instancesPerModel){const Y=A.instancesPerModel[Z];for(let Q=0;Q<Y.instancedDataArray.length;++Q){const te=(R?H*R.getElevationAt(0|Y.instancedDataArray.float32[16*Q],0|Y.instancedDataArray.float32[16*Q+1],!0,!0):0)+Y.instancesEvaluatedElevation[Q];Y.instancedDataArray.float32[16*Q+6]=te,B=B?Math.min(A.terrainElevationMin,te):te,U=U?Math.max(A.terrainElevationMax,te):te}}return A.terrainElevationMin=B||0,A.terrainElevationMax=U||0,A.validForExaggeration=H,A.validForDEMTile=R&&R._demTile?{id:R._demTile.tileID,timestamp:R._dem._timestamp}:{id:void 0,timestamp:0},!0}(_,l,f);(v||w)&&(l.uploaded=!1,l.upload(_.context))}const Ms={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.c3([0,0,0],[s.J,s.J,0])};function r0(_,l){const f=1<<_.canonical.z,v=l.getFreeCameraOptions().position,w=l.elevation,S=_.canonical.x/f,A=(_.canonical.x+1)/f,P=_.canonical.y/f,R=(_.canonical.y+1)/f;let B=l._centerAltitude;if(w){const Y=w.getMinMaxForTile(_);Y&&Y.max>B&&(B=Y.max)}const U=s.c(v.x,S,A)-v.x,H=s.c(v.y,P,R)-v.y,Z=s.b(B,l.center.lat)-v.z;return l._zoomFromMercatorZ(Math.sqrt(U*U+H*H+Z*Z))}function Bu(_,l,f,v,w,S,A){const P=_.context,R=_.renderPass==="shadow",B=_.shadowRenderer,U=R&&B?B.getShadowPassDepthMode():new s.b4(P.gl.LEQUAL,s.b4.ReadWrite,_.depthRangeFor3D),H=_.isTileAffectedByFog(S);if(f.meshes)for(const Z of f.meshes){const Y=["MODEL_POSITION_ON_GPU"],Q=[];let te,ee,K;v.instancedDataArray.length>20&&Y.push("INSTANCED_ARRAYS");const ce=Aa(_,l.paint.get("model-cutoff-fade-range"));if(ce.shouldRenderCutoff&&Y.push("RENDER_CUTOFF"),R&&B)te=_.getOrCreateProgram("modelDepth",{defines:Y}),ee=bo(A.shadowTileMatrix,A.shadowTileMatrix,Float32Array.from(f.matrix)),K=B.getShadowPassColorMode();else{fd(Y,Q,Z,_),te=_.getOrCreateProgram("model",{defines:Y,overrideFog:H});const _e=Z.material,se=_e.pbrMetallicRoughness,ue=l.paint.get("model-opacity"),ve=l.paint.get("model-emissive-strength").constantOr(0);ee=nr(S.expandedProjMatrix,Float32Array.from(f.matrix),new Float32Array(16),_,ue,se.baseColorFactor,_e.emissiveFactor,se.metallicFactor,se.roughnessFactor,_e,ve,l,w),B&&(A.shadowUniformsInitialized?te.setShadowUniformValues(P,B.getShadowUniformValues()):(B.setupShadows(S.toUnwrapped(),te,"model-tile",S.overscaledZ),A.shadowUniformsInitialized=!0)),K=ce.shouldRenderCutoff||ue<1||_e.alphaMode!=="OPAQUE"?s.a.alphaBlended:s.a.unblended}_.uploadCommonUniforms(P,te,S.toUnwrapped(),null,ce);const ge=Z.material.doubleSided?s.b5.disabled:s.b5.backCCW;if(v.instancedDataArray.length>20)Q.push(v.instancedDataBuffer),te.draw(_,P.gl.TRIANGLES,U,s.b6.disabled,K,ge,ee,l.id,Z.vertexBuffer,Z.indexBuffer,Z.segments,l.paint,_.transform.zoom,void 0,Q,v.instancedDataArray.length);else{const _e=R?"u_instance":"u_normal_matrix";for(let se=0;se<v.instancedDataArray.length;++se)ee[_e]=new Float32Array(v.instancedDataArray.arrayBuffer,64*se,16),te.draw(_,P.gl.TRIANGLES,U,s.b6.disabled,K,ge,ee,l.id,Z.vertexBuffer,Z.indexBuffer,Z.segments,l.paint,_.transform.zoom,void 0,Q)}}if(f.children)for(const Z of f.children)Bu(_,l,Z,v,w,S,A)}const o0=[1,-1,1];function Im(_,l,f,v){if(!f.modelManager)return!0;const w=f.modelManager;if(!f.shadowRenderer)return!0;const S=f.shadowRenderer,A=l.aabb;let P=!0,R=_.maxHeight;if(R===0){let U=0;for(const H in _.instancesPerModel){const Z=w.getModel(H,v);Z?U=Math.max(U,Math.max(Math.max(Z.aabb.max[0],Z.aabb.max[1]),Z.aabb.max[2])):P=!1}R=_.maxScale*U*1.41+_.maxVerticalOffset,P&&(_.maxHeight=R)}A.max[2]=R,A.min[2]+=_.terrainElevationMin,A.max[2]+=_.terrainElevationMax,s.v.transformMat4(A.min,A.min,l.tileMatrix),s.v.transformMat4(A.max,A.max,l.tileMatrix);const B=A.intersects(S.getCurrentCascadeFrustum());return f.currentShadowCascade===0&&(_.isInsideFirstShadowMapFrustum=B===2),B===0}class Cm{}class Fc{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(l,f,v){{const H=this._storage.get(f.id);if(H)return H.lastUsedFrameIdx=l,H.buf}const w=v.gl,S=w.getBufferParameter(w.ELEMENT_ARRAY_BUFFER,w.BUFFER_SIZE),A=new ArrayBuffer(S),P=new Int16Array(A);w.getBufferSubData(w.ELEMENT_ARRAY_BUFFER,0,new Int16Array(A));const R=new s.c9;for(let H=0;H<S/2;H+=3){const Z=P[H],Y=P[H+1],Q=P[H+2];R.emplaceBack(Z,Y),R.emplaceBack(Y,Q),R.emplaceBack(Q,Z)}const B=v.bindVertexArrayOES.current,U=new Cm;return U.buf=new s.I(v,R),U.lastUsedFrameIdx=l,this._storage.set(f.id,U),v.bindVertexArrayOES.set(B),U.buf}update(l){for(const[f,v]of this._storage)l-v.lastUsedFrameIdx>30&&(v.buf.destroy(),this._storage.delete(f))}destroy(){for(const[l,f]of this._storage)f.buf.destroy(),this._storage.delete(l)}}class Pm{registerParameter(l,f,v,w,S){}registerButton(l,f,v){}}const dd={symbol:function(_,l,f,v,w){if(_.renderPass!=="translucent")return;const S=s.b6.disabled,A=_.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&function(P,R,B,U,H,Z,Y){const Q=R.transform,te=H==="map",ee=Z==="map";for(const K of P){const ce=U.getTile(K),ge=ce.getBucket(B);if(!ge||!ge.text||!ge.text.segments.get().length)continue;const _e=s.i(ge.textSizeData,Q.zoom),se=Gn(K,ge.getProjection(),Q),ue=Q.calculatePixelsToTileUnitsMatrix(ce),ve=Er(se,ce.tileID.canonical,ee,te,Q,ge.getProjection(),ue),Me=ge.hasIconTextFit()&&ge.hasIconData();if(_e){const be=Math.pow(2,Q.zoom-ce.tileID.overscaledZ);fs(ge,te,ee,Y,s.bG,Q,ve,K,be,_e,Me)}}}(v,_,f,l,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),w),f.paint.get("icon-opacity").constantOr(1)!==0&&Gi(_,l,f,v,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),f.paint.get("icon-color-saturation"),S,A),f.paint.get("text-opacity").constantOr(1)!==0&&Gi(_,l,f,v,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),f.paint.get("icon-color-saturation"),S,A),l.map.showCollisionBoxes&&(Go(_,l,f,v,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),Go(_,l,f,v,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))},circle:function(_,l,f,v){if(_.renderPass!=="translucent")return;const w=f.paint.get("circle-opacity"),S=f.paint.get("circle-stroke-width"),A=f.paint.get("circle-stroke-opacity"),P=f.layout.get("circle-sort-key").constantOr(1)!==void 0,R=f.paint.get("circle-emissive-strength");if(w.constantOr(1)===0&&(S.constantOr(1)===0||A.constantOr(1)===0))return;const B=_.context,U=B.gl,H=_.transform,Z=_.depthModeForSublayer(0,s.b4.ReadOnly),Y=s.b6.disabled,Q=_.colorModeForDrapableLayerRenderPass(R),te=H.projection.name==="globe",ee=[s.E(H.center.lng),s.H(H.center.lat)],K=[];for(let ge=0;ge<v.length;ge++){const _e=v[ge],se=l.getTile(_e),ue=se.getBucket(f);if(!ue||ue.projection.name!==H.projection.name)continue;const ve=ue.programConfigurations.get(f.id),Me=s.bH(f),be=_.isTileAffectedByFog(_e);te&&Me.push("PROJECTION_GLOBE_VIEW");const Ce=_.getOrCreateProgram("circle",{config:ve,defines:Me,overrideFog:be}),$e=ue.layoutVertexBuffer,Ne=ue.globeExtVertexBuffer,qe=ue.indexBuffer,Le=H.projection.createInversionMatrix(H,_e.canonical),Ke={programConfiguration:ve,program:Ce,layoutVertexBuffer:$e,globeExtVertexBuffer:Ne,indexBuffer:qe,uniformValues:s.bI(_,_e,se,Le,ee,f),tile:se};if(P){const He=ue.segments.get();for(const nt of He)K.push({segments:new s.bm([nt]),sortKey:nt.sortKey,state:Ke})}else K.push({segments:ue.segments,sortKey:0,state:Ke})}P&&K.sort((ge,_e)=>ge.sortKey-_e.sortKey);const ce={useDepthForOcclusion:H.depthOcclusionForSymbolsAndCircles};for(const ge of K){const{programConfiguration:_e,program:se,layoutVertexBuffer:ue,globeExtVertexBuffer:ve,indexBuffer:Me,uniformValues:be,tile:Ce}=ge.state,$e=ge.segments;_.terrain&&_.terrain.setupElevationDraw(Ce,se,ce),_.uploadCommonUniforms(B,se,Ce.tileID.toUnwrapped()),se.draw(_,U.TRIANGLES,Z,Y,Q,s.b5.disabled,be,f.id,ue,Me,$e,f.paint,H.zoom,_e,[ve])}},heatmap:function(_,l,f,v){if(f.paint.get("heatmap-opacity")!==0)if(_.renderPass==="offscreen"){const w=_.context,S=w.gl,A=s.b6.disabled,P=new s.a([S.ONE,S.ONE,S.ONE,S.ONE],s.C.transparent,[!0,!0,!0,!0]);(function(Y,Q,te,ee){const K=Y.gl,ce=Q.width*ee,ge=Q.height*ee;Y.activeTexture.set(K.TEXTURE1),Y.viewport.set([0,0,ce,ge]);let _e=te.heatmapFbo;if(!_e||_e&&(_e.width!==ce||_e.height!==ge)){_e&&_e.destroy();const se=K.createTexture();K.bindTexture(K.TEXTURE_2D,se),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),_e=te.heatmapFbo=Y.createFramebuffer(ce,ge,!0,null),function(ue,ve,Me,be,Ce,$e){const Ne=ue.gl;Ne.texImage2D(Ne.TEXTURE_2D,0,ue.extRenderToTextureHalfFloat?Ne.RGBA16F:Ne.RGBA,Ce,$e,0,Ne.RGBA,ue.extRenderToTextureHalfFloat?Ne.HALF_FLOAT:Ne.UNSIGNED_BYTE,null),be.colorAttachment.set(Me)}(Y,0,se,_e,ce,ge)}else K.bindTexture(K.TEXTURE_2D,_e.colorAttachment.get()),Y.bindFramebuffer.set(_e.framebuffer)})(w,_,f,_.transform.projection.name==="globe"?.5:.25),w.clear({color:s.C.transparent});const R=_.transform,B=R.projection.name==="globe",U=B?["PROJECTION_GLOBE_VIEW"]:[],H=B?s.b5.frontCCW:s.b5.disabled,Z=[s.E(R.center.lng),s.H(R.center.lat)];for(let Y=0;Y<v.length;Y++){const Q=v[Y];if(l.hasRenderableParent(Q))continue;const te=l.getTile(Q),ee=te.getBucket(f);if(!ee||ee.projection.name!==R.projection.name)continue;const K=_.isTileAffectedByFog(Q),ce=ee.programConfigurations.get(f.id),ge=_.getOrCreateProgram("heatmap",{config:ce,defines:U,overrideFog:K}),{zoom:_e}=_.transform;_.terrain&&_.terrain.setupElevationDraw(te,ge),_.uploadCommonUniforms(w,ge,Q.toUnwrapped());const se=R.projection.createInversionMatrix(R,Q.canonical);ge.draw(_,S.TRIANGLES,s.b4.disabled,A,P,H,Lu(_,Q,te,se,Z,_e,f.paint.get("heatmap-intensity")),f.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,f.paint,_.transform.zoom,ce,B?[ee.globeExtVertexBuffer]:null)}w.viewport.set([0,0,_.width,_.height])}else _.renderPass==="translucent"&&(_.context.setColorMode(_.colorModeForRenderPass()),function(w,S){const A=w.context,P=A.gl,R=S.heatmapFbo;if(!R)return;A.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,R.colorAttachment.get()),A.activeTexture.set(P.TEXTURE1);let B=S.colorRampTexture;B||(B=S.colorRampTexture=new s.a9(A,S.colorRamp,P.RGBA)),B.bind(P.LINEAR,P.CLAMP_TO_EDGE),w.getOrCreateProgram("heatmapTexture").draw(w,P.TRIANGLES,s.b4.disabled,s.b6.disabled,w.colorModeForRenderPass(),s.b5.disabled,((U,H,Z,Y)=>({u_image:0,u_color_ramp:1,u_opacity:H.paint.get("heatmap-opacity")}))(0,S),S.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,S.paint,w.transform.zoom)}(_,f))},line:function(_,l,f,v){if(_.renderPass!=="translucent")return;const w=f.paint.get("line-opacity"),S=f.paint.get("line-width");if(w.constantOr(1)===0||S.constantOr(1)===0)return;const A=f.paint.get("line-emissive-strength"),P=_.depthModeForSublayer(0,s.b4.ReadOnly),R=_.colorModeForDrapableLayerRenderPass(A),B=_.terrain&&_.terrain.renderingToTexture?1:s.a4.devicePixelRatio,U=f.paint.get("line-dasharray"),H=U.constantOr(1),Z=f.layout.get("line-cap"),Y=f.paint.get("line-pattern"),Q=Y.constantOr(1),te=f.paint.get("line-pattern").constantOr(1),ee=f.paint.get("line-opacity").constantOr(1)!==1;let K=!te&&ee;const ce=f.paint.get("line-gradient"),ge=Q?"linePattern":"line",_e=_.context,se=_e.gl,ue=s.bJ(f);_.terrain&&_.terrain.clipOrMaskOverlapStencilType()&&(K=!1);for(const ve of v){const Me=l.getTile(ve);if(Q&&!Me.patternsLoaded())continue;const be=Me.getBucket(f);if(!be)continue;_.prepareDrawTile();const Ce=be.programConfigurations.get(f.id),$e=_.isTileAffectedByFog(ve),Ne=_.getOrCreateProgram(ge,{config:Ce,defines:ue,overrideFog:$e}),qe=Y.constantOr(null);if(qe&&Me.imageAtlas){const ut=Me.imageAtlas.patternPositions[qe.toString()];ut&&Ce.setConstantPatternPositions(ut)}const Le=U.constantOr(null),Ke=Z.constantOr(null);if(!Q&&Le&&Ke&&Me.lineAtlas){const ut=Me.lineAtlas.getDash(Le,Ke);ut&&Ce.setConstantPatternPositions(ut)}let[He,nt]=f.paint.get("line-trim-offset");(Ke==="round"||Ke==="square")&&He!==nt&&(He===0&&(He-=1),nt===1&&(nt+=1));const de=_.terrain?ve.projMatrix:null,ze=Q?s.bK(_,Me,f,de,B):s.bL(_,Me,f,de,be.lineClipsArray.length,B,[He,nt]);if(ce){const ut=be.gradients[f.id];let ti=ut.texture;if(f.gradientVersion!==ut.version){let Ht=256;if(f.stepInterpolant){const hi=l.getSource().maxzoom,Jt=ve.canonical.z===hi?Math.ceil(1<<_.transform.maxZoom-ve.canonical.z):1;Ht=s.c(s.bM(be.maxLineLength/s.J*1024*Jt),256,_e.maxTextureSize)}ut.gradient=s.bN({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:Ht,image:ut.gradient||void 0,clips:be.lineClipsArray}),ut.texture?ut.texture.update(ut.gradient):ut.texture=new s.a9(_e,ut.gradient,se.RGBA),ut.version=f.gradientVersion,ti=ut.texture}_e.activeTexture.set(se.TEXTURE1),ti.bind(f.stepInterpolant?se.NEAREST:se.LINEAR,se.CLAMP_TO_EDGE)}H&&(_e.activeTexture.set(se.TEXTURE0),Me.lineAtlasTexture&&Me.lineAtlasTexture.bind(se.LINEAR,se.REPEAT),Ce.updatePaintBuffers()),Q&&(_e.activeTexture.set(se.TEXTURE0),Me.imageAtlasTexture&&Me.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),Ce.updatePaintBuffers()),_.uploadCommonUniforms(_e,Ne,ve.toUnwrapped());const _t=ut=>{Ne.draw(_,se.TRIANGLES,P,ut,R,s.b5.disabled,ze,f.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,f.paint,_.transform.zoom,Ce,[be.layoutVertexBuffer2])};if(K){const ut=_.stencilModeForClipping(ve).ref;ut===0&&_.terrain&&_e.clear({stencil:0});const ti={func:se.EQUAL,mask:255};ze.u_alpha_discard_threshold=.8,_t(new s.b6(ti,ut,255,se.KEEP,se.KEEP,se.INVERT)),ze.u_alpha_discard_threshold=0,_t(new s.b6(ti,ut,255,se.KEEP,se.KEEP,se.KEEP))}else _t(_.stencilModeForClipping(ve))}K&&(_.resetStencilClippingMasks(),_.terrain&&_e.clear({stencil:0}))},fill:function(_,l,f,v){const w=f.paint.get("fill-color"),S=f.paint.get("fill-opacity");if(S.constantOr(1)===0)return;const A=f.paint.get("fill-emissive-strength"),P=_.colorModeForDrapableLayerRenderPass(A),R=f.paint.get("fill-pattern"),B=_.opaquePassEnabledForLayer()&&!R.constantOr(1)&&w.constantOr(s.C.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";if(_.renderPass===B){const U=_.depthModeForSublayer(1,_.renderPass==="opaque"?s.b4.ReadWrite:s.b4.ReadOnly);Gs(_,l,f,v,U,P,!1)}if(_.renderPass==="translucent"&&f.paint.get("fill-antialias")){const U=_.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,s.b4.ReadOnly);Gs(_,l,f,v,U,P,!0)}},"fill-extrusion":function(_,l,f,v){const w=f.paint.get("fill-extrusion-opacity"),S=_.context,A=S.gl,P=_.terrain,R=P&&P.renderingToTexture;if(w===0)return;const B=_.conflationActive&&_.layerUsedInConflation(f,l.getSource());if(B&&function(U,H,Z,Y){for(const Q of Y){const te=H.getTile(Q).getBucket(Z);te&&(te.updateReplacement(Q,U.replacementSource),te.uploadCentroid(U.context))}}(_,l,f,v),P||B)for(const U of v){const H=l.getTile(U).getBucket(f);H&&Nh(_.context,l,U,H,f,P,B)}if(_.renderPass==="shadow"&&_.shadowRenderer){const U=_.shadowRenderer;if(P&&w<.65&&f._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.am)return;const H=U.getShadowPassDepthMode(),Z=U.getShadowPassColorMode();rl(_,l,f,v,H,s.b6.disabled,Z,B)}else if(_.renderPass==="translucent"){const U=!f.paint.get("fill-extrusion-pattern").constantOr(1),H=f.paint.get("fill-extrusion-color").constantOr(s.C.white);if(!R&&H.a!==0){const Z=new s.b4(_.context.gl.LEQUAL,s.b4.ReadWrite,_.depthRangeFor3D);w===1&&U?rl(_,l,f,v,Z,s.b6.disabled,s.a.unblended,B):(rl(_,l,f,v,Z,s.b6.disabled,s.a.disabled,B),rl(_,l,f,v,Z,_.stencilModeFor3D(),_.colorModeForRenderPass(),B),_.resetStencilClippingMasks())}if(_.style.enable3dLights()&&U&&(!P&&_.transform.projection.name!=="globe"||R)){const Z=f.paint.get("fill-extrusion-opacity"),Y=f.paint.get("fill-extrusion-ambient-occlusion-intensity"),Q=f.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),te=f.paint.get("fill-extrusion-flood-light-intensity"),ee=f.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),K=Y>0&&Q>0,ce=te>0,ge=(se,ue,ve)=>(1-ve)*se+ve*ue,_e=se=>{const ue=_.depthModeForSublayer(1,s.b4.ReadOnly,A.LEQUAL,!0),ve=f.paint.get(se?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Me=ge(.1,3,ve),be=_._showOverdrawInspector;if(!be){const Ce=new s.b6({func:A.ALWAYS,mask:255},255,255,A.KEEP,A.KEEP,A.REPLACE),$e=new s.a([A.ONE,A.ONE,A.ONE,A.ONE],s.C.transparent,[!1,!1,!1,!0],A.MIN);ka(_,l,f,v,ue,Ce,$e,s.b5.disabled,se,"sdf",Z,Y,Q,te,ee,Me,B,!1)}{const Ce=be?s.b6.disabled:new s.b6({func:A.EQUAL,mask:255},255,255,A.KEEP,A.DECR,A.DECR),$e=be?_.colorModeForRenderPass():new s.a([A.ONE_MINUS_DST_ALPHA,A.DST_ALPHA,A.ONE,A.ONE],s.C.transparent,[!0,!0,!0,!0]);ka(_,l,f,v,ue,Ce,$e,s.b5.disabled,se,"color",Z,Y,Q,te,ee,Me,B,!1)}};if(R){const se=(ue,ve,Me)=>{const be=_.depthModeForSublayer(1,s.b4.ReadOnly,A.LEQUAL,!1),Ce=f.paint.get(ue?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),$e=ge(.1,3,Ce);{const Ne=new s.a([A.ONE,A.ONE,A.ONE,A.ONE],s.C.transparent,[!1,!1,!1,!0]);ka(_,l,f,v,be,s.b6.disabled,Ne,s.b5.disabled,ue,"clear",Z,Y,Q,te,ee,$e,B,ve)}{const Ne=new s.b6({func:A.ALWAYS,mask:255},255,255,A.KEEP,A.KEEP,A.REPLACE),qe=new s.a([A.ONE,A.ONE,A.ONE,A.ONE],s.C.transparent,[!1,!1,!1,!0],A.MIN);ka(_,l,f,v,be,Ne,qe,s.b5.disabled,ue,"sdf",Z,Y,Q,te,ee,$e,B,ve)}{const Ne=ue?A.ZERO:A.ONE_MINUS_DST_ALPHA,qe=new s.b6({func:A.EQUAL,mask:255},255,255,A.KEEP,A.DECR,A.DECR),Le=new s.a([Ne,A.DST_ALPHA,A.ONE_MINUS_DST_ALPHA,A.ZERO],s.C.transparent,[!0,!0,!0,!0]);ka(_,l,f,v,be,qe,Le,s.b5.disabled,ue,"color",Z,Y,Q,te,ee,$e,B,ve)}{const Ne=new s.a([A.ONE,A.ONE,A.ONE,ue?A.ZERO:A.ONE],s.C.transparent,[!1,!1,!1,!0],ue?A.FUNC_ADD:A.MAX);ka(_,l,f,v,be,s.b6.disabled,Ne,s.b5.disabled,ue,"clear",Z,Y,Q,te,ee,$e,B,ve,Me)}};if(K||ce){let ue;if(_.prepareDrawTile(),P){const ve=P.drapeBufferSize[0],Me=P.drapeBufferSize[1];ue=P.framebufferCopyTexture,ue&&(!ue||ue.size[0]===ve&&ue.size[1]===Me)||(ue&&ue.destroy(),ue=P.framebufferCopyTexture=new s.a9(S,new s.a5({width:ve,height:Me}),A.RGBA)),ue.bind(A.LINEAR,A.CLAMP_TO_EDGE),A.copyTexImage2D(A.TEXTURE_2D,0,A.RGBA,0,0,ve,Me,0)}K&&se(!0,!1,ue),ce&&se(!1,!0,ue)}}else K&&_e(!0),ce&&_e(!1)}}},hillshade:function(_,l,f,v){if(_.renderPass!=="offscreen"&&_.renderPass!=="translucent"||_.style.disableElevatedTerrain)return;const w=_.context,S=_.terrain&&_.terrain.renderingToTexture,[A,P]=_.renderPass!=="translucent"||S?[{},v]:_.stencilConfigForOverlap(v);for(const R of P){const B=l.getTile(R);if(B.needsHillshadePrepare&&_.renderPass==="offscreen")Nl(_,B,f);else if(_.renderPass==="translucent"){const U=_.depthModeForSublayer(0,s.b4.ReadOnly),H=f.paint.get("hillshade-emissive-strength"),Z=_.colorModeForDrapableLayerRenderPass(H),Y=S&&_.terrain?_.terrain.stencilModeForRTTOverlap(R):A[R.overscaledZ];Eu(_,R,B,f,U,Y,Z)}}w.viewport.set([0,0,_.width,_.height]),_.resetStencilClippingMasks()},raster:function(_,l,f,v,w,S){if(_.renderPass!=="translucent"||f.paint.get("raster-opacity")===0)return;const A=_.context,P=A.gl,R=l.getSource(),B=function(ve,Me,be){const Ce=ve.paint.get("raster-color"),$e=[],Ne=ve.paint.get("raster-resampling"),qe=ve.paint.get("raster-color-mix"),Le=ve.paint.get("raster-color-range"),Ke=[qe[0],qe[1],qe[2],0],He=qe[3],nt=Ne==="nearest"?be.NEAREST:be.LINEAR;if(Ce&&$e.push("RASTER_COLOR"),Ce){Me.activeTexture.set(be.TEXTURE2);let de=ve.colorRampTexture;de||(de=ve.colorRampTexture=new s.a9(Me,ve.colorRamp,be.RGBA)),de.bind(be.LINEAR,be.CLAMP_TO_EDGE)}return{mix:Ke,range:Le,offset:He,defines:$e,resampling:nt}}(f,A,P),U=B.defines,H=_.transform.projection.name==="globe";let Z=!1;if(R instanceof s.aK&&!v.length){if(!H)return;if(R.onNorthPole)Z=!0,U.push("GLOBE_POLES");else{if(!R.onSouthPole)return;Z=!0,U.push("GLOBE_POLES")}}const Y=f.paint.get("raster-emissive-strength"),Q=_.colorModeForDrapableLayerRenderPass(Y),te=_.terrain&&_.terrain.renderingToTexture,ee=R instanceof s.aK&&f.paint.get("raster-elevation")!==0,K=!_.options.moving,ce=f.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;if(Z){const ve=l.getSource();if(!(ve instanceof s.aK))return;const Me=ve.texture;if(!Me)return;const be=_.globeSharedBuffers;if(!be)return;const Ce=new s.b4(P.LEQUAL,s.b4.ReadWrite,_.depthRangeFor3D),$e=Float32Array.from(_.transform.expandedFarZProjMatrix);let Ne=s.bj(0,0,_.transform);const qe=Float32Array.from(s.bh(s.bi(new s.t(0,0,0)))),Le={opacity:1,mix:0};_.terrain&&_.terrain.prepareDrawTile(),A.activeTexture.set(P.TEXTURE0),Me.bind(ce,P.CLAMP_TO_EDGE),A.activeTexture.set(P.TEXTURE1),Me.bind(ce,P.CLAMP_TO_EDGE),Me.useMipmap&&A.extTextureFilterAnisotropic&&_.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);const[Ke,He,nt,de]=be.getPoleBuffers(0,!0);let ze;ve.onNorthPole?(ze=Ke,_.renderDefaultNorthPole=!1):(Ne=s.m.scale(s.m.create(),Ne,[1,-1,1]),ze=He,_.renderDefaultSouthPole=!1);const _t=((ti,Ht,hi,Jt,_i,yi,oi,li,tn,Li,Nn,Mn)=>Ou(ti,Ht,hi,new Float32Array(16),new Float32Array(9),[0,0],0,[0,0],[0,0,0,0],1,Jt,_i,[0,0],oi,2,tn,Li,Nn,1,0,Mn))($e,qe,Ne,Le,f,0,f.paint.get("raster-elevation"),0,B.mix,B.offset,B.range,Y),ut=_.getOrCreateProgram("raster",{defines:B.defines});return _.uploadCommonUniforms(A,ut,null),void ut.draw(_,P.TRIANGLES,Ce,s.b6.disabled,Q,s.b5.disabled,_t,f.id,ze,nt,de)}if(!v.length)return;const[ge,_e]=R instanceof s.aK||te?[{},v]:_.stencilConfigForOverlap(v),se=_e[_e.length-1].overscaledZ,ue=ee&&H;ue&&B.defines.push("PROJECTION_GLOBE_VIEW"),ee&&B.defines.push("RENDER_CUTOFF");for(const ve of _e){const Me=ve.toUnwrapped(),be=l.getTile(ve);if(te&&(!be||!be.hasData())||!be.texture)continue;let Ce,$e;te?(Ce=s.b4.disabled,$e=ve.projMatrix):ee?(Ce=new s.b4(P.LEQUAL,s.b4.ReadWrite,_.depthRangeFor3D),$e=H?Float32Array.from(_.transform.expandedFarZProjMatrix):_.transform.calculateProjMatrix(Me,K)):(Ce=_.depthModeForSublayer(ve.overscaledZ-se,f.paint.get("raster-opacity")===1?s.b4.ReadWrite:s.b4.ReadOnly,P.LESS),$e=_.transform.calculateProjMatrix(Me,K));const Ne=_.terrain&&te?_.terrain.stencilModeForRTTOverlap(ve):ge[ve.overscaledZ],qe=S?0:f.paint.get("raster-fade-duration");be.registerFadeDuration(qe);const Le=l.findLoadedParent(ve,0),Ke=Ia(be,Le,l,_.transform,qe);let He,nt;_.terrain&&_.terrain.prepareDrawTile(),A.activeTexture.set(P.TEXTURE0),be.texture&&be.texture.bind(ce,P.CLAMP_TO_EDGE),A.activeTexture.set(P.TEXTURE1),Le?(Le.texture&&Le.texture.bind(ce,P.CLAMP_TO_EDGE),He=Math.pow(2,Le.tileID.overscaledZ-be.tileID.overscaledZ),nt=[be.tileID.canonical.x*He%1,be.tileID.canonical.y*He%1]):be.texture&&be.texture.bind(ce,P.CLAMP_TO_EDGE),be.texture&&be.texture.useMipmap&&A.extTextureFilterAnisotropic&&_.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);const de=_.transform;let ze;const _t=ee?zu(de):[0,0,0,0];let ut,ti,Ht,hi,Jt;ue&&R instanceof s.aK&&R.coordinates.length>3?(ut=Float32Array.from(s.bh(s.bi(new s.t(0,0,0)))),ti=Float32Array.from(de.globeMatrix),Ht=Float32Array.from(s.bc(de)),hi=[s.E(de.center.lng),s.H(de.center.lat)],ze=R.elevatedGlobePerspectiveTransform,Jt=R.elevatedGlobeGridMatrix||new Float32Array(9)):(ze=R instanceof s.aK?R.perspectiveTransform:[0,0],ut=new Float32Array(16),ti=new Float32Array(9),Ht=new Float32Array(16),hi=[0,0],Jt=new Float32Array(9));const _i=Ou($e,ut,ti,Ht,Jt,nt||[0,0],s.ao(_.transform.zoom),hi,_t,He||1,Ke,f,ze,ee?f.paint.get("raster-elevation"):0,2,B.mix,B.offset,B.range,1,0,Y),yi=_.isTileAffectedByFog(ve),oi=_.getOrCreateProgram("raster",{defines:B.defines,overrideFog:yi});if(_.uploadCommonUniforms(A,oi,Me),R instanceof s.aK){const li=R.elevatedGlobeVertexBuffer,tn=R.elevatedGlobeIndexBuffer;if(te||!H)R.boundsBuffer&&R.boundsSegments&&oi.draw(_,P.TRIANGLES,Ce,s.b6.disabled,Q,s.b5.disabled,_i,f.id,R.boundsBuffer,_.quadTriangleIndexBuffer,R.boundsSegments);else if(li&&tn){const Li=de.zoom<=s.Z?R.elevatedGlobeSegments:R.getSegmentsForLongitude(de.center.lng);Li&&(oi.draw(_,P.TRIANGLES,Ce,s.b6.disabled,Q,s.b5.backCW,_i,f.id,li,tn,Li),oi.draw(_,P.TRIANGLES,Ce,s.b6.disabled,Q,s.b5.frontCW,_i,f.id,li,tn,Li))}}else{const{tileBoundsBuffer:li,tileBoundsIndexBuffer:tn,tileBoundsSegments:Li}=_.getTileBoundsBuffers(be);oi.draw(_,P.TRIANGLES,Ce,Ne,Q,s.b5.disabled,_i,f.id,li,tn,Li)}}_.resetStencilClippingMasks()},background:function(_,l,f,v){const w=f.paint.get("background-color"),S=f.paint.get("background-opacity"),A=f.paint.get("background-emissive-strength");if(S===0)return;const P=_.context,R=P.gl,B=_.transform,U=B.tileSize,H=f.paint.get("background-pattern");if(_.isPatternMissing(H,f.scope))return;const Z=!H&&w.a===1&&S===1&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==Z)return;const Y=s.b6.disabled,Q=_.depthModeForSublayer(0,Z==="opaque"?s.b4.ReadWrite:s.b4.ReadOnly),te=_.colorModeForDrapableLayerRenderPass(A),ee=H?"backgroundPattern":"background";let K,ce=v;ce||(K=_.getBackgroundTiles(),ce=Object.values(K).map(ge=>ge.tileID)),H&&(P.activeTexture.set(R.TEXTURE0),_.imageManager.bind(_.context,f.scope));for(const ge of ce){const _e=_.isTileAffectedByFog(ge),se=_.getOrCreateProgram(ee,{overrideFog:_e}),ue=ge.toUnwrapped(),ve=v?ge.projMatrix:_.transform.calculateProjMatrix(ue);_.prepareDrawTile();const Me=l?l.getTile(ge):K?K[ge.key]:new s.bt(ge,U,B.zoom,_),be=H?Fn(ve,A,S,_,H,f.scope,{tileID:ge,tileSize:U}):Ci(ve,A,S,w);_.uploadCommonUniforms(P,se,ue);const{tileBoundsBuffer:Ce,tileBoundsIndexBuffer:$e,tileBoundsSegments:Ne}=_.getTileBoundsBuffers(Me);se.draw(_,R.TRIANGLES,Q,Y,te,s.b5.disabled,be,f.id,Ce,$e,Ne)}},sky:function(_,l,f){const v=_._atmosphere?s.ao(_.transform.zoom):1,w=f.paint.get("sky-opacity")*v;if(w===0)return;const S=_.context,A=f.paint.get("sky-type"),P=new s.b4(S.gl.LEQUAL,s.b4.ReadOnly,[0,1]),R=_.frameCounter/1e3%1;A==="atmosphere"?_.renderPass==="offscreen"?f.needsSkyboxCapture(_)&&(function(B,U,H,Z){const Y=B.context,Q=Y.gl;let te=U.skyboxFbo;if(!te){te=U.skyboxFbo=Y.createFramebuffer(32,32,!0,null),U.skyboxGeometry=new qo(Y),U.skyboxTexture=Y.gl.createTexture(),Q.bindTexture(Q.TEXTURE_CUBE_MAP,U.skyboxTexture),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MAG_FILTER,Q.LINEAR);for(let ge=0;ge<6;++ge)Q.texImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+ge,0,Q.RGBA,32,32,0,Q.RGBA,Q.UNSIGNED_BYTE,null)}Y.bindFramebuffer.set(te.framebuffer),Y.viewport.set([0,0,32,32]);const ee=U.getCenter(B,!0),K=B.getOrCreateProgram("skyboxCapture"),ce=new Float64Array(16);s.m.identity(ce),s.m.rotateY(ce,ce,.5*-Math.PI),ms(B,U,K,ce,ee,0),s.m.identity(ce),s.m.rotateY(ce,ce,.5*Math.PI),ms(B,U,K,ce,ee,1),s.m.identity(ce),s.m.rotateX(ce,ce,.5*-Math.PI),ms(B,U,K,ce,ee,2),s.m.identity(ce),s.m.rotateX(ce,ce,.5*Math.PI),ms(B,U,K,ce,ee,3),s.m.identity(ce),ms(B,U,K,ce,ee,4),s.m.identity(ce),s.m.rotateY(ce,ce,Math.PI),ms(B,U,K,ce,ee,5),Y.viewport.set([0,0,B.width,B.height])}(_,f),f.markSkyboxValid(_)):_.renderPass==="sky"&&function(B,U,H,Z,Y){const Q=B.context,te=Q.gl,ee=B.transform,K=B.getOrCreateProgram("skybox");Q.activeTexture.set(te.TEXTURE0),te.bindTexture(te.TEXTURE_CUBE_MAP,U.skyboxTexture);const ce=((ge,_e,se,ue,ve)=>({u_matrix:ge,u_sun_direction:_e,u_cubemap:0,u_opacity:ue,u_temporal_offset:ve}))(ee.skyboxMatrix,U.getCenter(B,!1),0,Z,Y);B.uploadCommonUniforms(Q,K),K.draw(B,te.TRIANGLES,H,s.b6.disabled,B.colorModeForRenderPass(),s.b5.backCW,ce,"skybox",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(_,f,P,w,R):A==="gradient"&&_.renderPass==="sky"&&function(B,U,H,Z,Y){const Q=B.context,te=Q.gl,ee=B.transform,K=B.getOrCreateProgram("skyboxGradient");U.skyboxGeometry||(U.skyboxGeometry=new qo(Q)),Q.activeTexture.set(te.TEXTURE0);let ce=U.colorRampTexture;ce||(ce=U.colorRampTexture=new s.a9(Q,U.colorRamp,te.RGBA)),ce.bind(te.LINEAR,te.CLAMP_TO_EDGE);const ge=((_e,se,ue,ve,Me)=>({u_matrix:_e,u_color_ramp:0,u_center_direction:se,u_radius:s.d(ue),u_opacity:ve,u_temporal_offset:Me}))(ee.skyboxMatrix,U.getCenter(B,!1),U.paint.get("sky-gradient-radius"),Z,Y);B.uploadCommonUniforms(Q,K),K.draw(B,te.TRIANGLES,H,s.b6.disabled,B.colorModeForRenderPass(),s.b5.backCW,ge,"skyboxGradient",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(_,f,P,w,R)},debug:function(_,l,f,v,w){for(let S=0;S<f.length;S++)if(w){const R=new s.C(v.r*.8,v.g*.8,v.b*.8,1);Wo(_,l,f[S],v,-1,-1),Wo(_,l,f[S],v,-1,1),Wo(_,l,f[S],v,1,1),Wo(_,l,f[S],v,1,-1),Wo(_,l,f[S],R,0,0)}else Wo(_,l,f[S],v,0,0)},custom:function(_,l,f,v){const w=_.context,S=f.implementation;if(!_.transform.projection.unsupportedLayers||!_.transform.projection.unsupportedLayers.includes("custom")||_.terrain&&(_.terrain.renderingToTexture||_.renderPass==="offscreen")&&f.isLayerDraped(l)){if(_.renderPass==="offscreen"){const A=S.prerender;if(A){if(_.setCustomLayerDefaults(),w.setColorMode(_.colorModeForRenderPass()),_.transform.projection.name==="globe"){const P=_.transform.pointMerc;A.call(S,w.gl,_.transform.customLayerMatrix(),_.transform.getProjection(),_.transform.globeToMercatorMatrix(),s.ao(_.transform.zoom),[P.x,P.y],_.transform.pixelsPerMeterRatio)}else A.call(S,w.gl,_.transform.customLayerMatrix());w.setDirty(),_.setBaseState()}}else if(_.renderPass==="translucent"){if(_.terrain&&_.terrain.renderingToTexture){const P=S.renderToTile;if(P){const R=v[0].canonical,B=new s.M(R.x+v[0].wrap*(1<<R.z),R.y,R.z);w.setDepthMode(s.b4.disabled),w.setStencilMode(s.b6.disabled),w.setColorMode(_.colorModeForRenderPass()),_.setCustomLayerDefaults(),P.call(S,w.gl,B),w.setDirty(),_.setBaseState()}return}_.setCustomLayerDefaults(),w.setColorMode(_.colorModeForRenderPass()),w.setStencilMode(s.b6.disabled);const A=S.renderingMode==="3d"?new s.b4(_.context.gl.LEQUAL,s.b4.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,s.b4.ReadOnly);if(w.setDepthMode(A),_.transform.projection.name==="globe"){const P=_.transform.pointMerc;S.render(w.gl,_.transform.customLayerMatrix(),_.transform.getProjection(),_.transform.globeToMercatorMatrix(),s.ao(_.transform.zoom),[P.x,P.y],_.transform.pixelsPerMeterRatio)}else S.render(w.gl,_.transform.customLayerMatrix());w.setDirty(),_.setBaseState(),w.bindFramebuffer.set(null)}}else s.X("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(_,l,f,v){if(_.renderPass==="opaque")return;const w=f.paint.get("model-opacity");if(w===0)return;const S=f.paint.get("model-cast-shadows");if(_.renderPass==="shadow"&&(!S||_.terrain&&w<.65&&f._transitionablePaint._values["model-opacity"].value.expression instanceof s.am))return;const A=_.shadowRenderer,P=f.paint.get("model-receive-shadows");A&&(A.useNormalOffset=!0,P||(A.enabled=!1));const R=()=>{A&&(A.useNormalOffset=!0,P||(A.enabled=!0))},B=l.getSource();if(_.renderPass==="light-beam"&&B.type!=="batched-model")return;if(B.type==="vector"||B.type==="geojson")return function(K,ce,ge,_e){const se=K.transform;if(se.projection.name!=="mercator")return void s.X(`Drawing 3D models for ${se.projection.name} projection is not yet implemented`);const ue=se.getFreeCameraOptions().position;if(!K.modelManager)return;const ve=K.modelManager,Me=K.shadowRenderer;if(!ge._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const be=ge._unevaluatedLayout._values["model-id"],Ce={...ge.layout.get("model-id").parameters};for(const $e of _e){const Ne=ce.getTile($e).getBucket(ge);if(!Ne||Ne.projection.name!==se.projection.name)continue;const qe=r0($e,se);Ce.zoom=qe;const Le=be.possiblyEvaluate(Ce);if(n0(K,Ne,$e),Ms.shadowUniformsInitialized=!1,Ms.useSingleShadowCascade=!!Me&&Me.getMaxCascadeForTile($e.toUnwrapped())===0,K.renderPass==="shadow"&&Me){if(K.currentShadowCascade===1&&Ne.isInsideFirstShadowMapFrustum)continue;const nt=se.calculatePosMatrix($e.toUnwrapped(),se.worldSize);if(Ms.tileMatrix.set(nt),Ms.shadowTileMatrix=Float32Array.from(Me.calculateShadowPassMatrixFromMatrix(nt)),Ms.aabb.min.fill(0),Ms.aabb.max[0]=Ms.aabb.max[1]=s.J,Ms.aabb.max[2]=0,Im(Ne,Ms,K,ge.scope))continue}const Ke=1<<$e.canonical.z,He=[((ue.x-$e.wrap)*Ke-$e.canonical.x)*s.J,(ue.y*Ke-$e.canonical.y)*s.J,ue.z*Ke*s.J];for(let nt in Ne.instancesPerModel){const de=Ne.instancesPerModel[nt];de.features.length>0&&(nt=Le.evaluate(de.features[0].feature,{}));const ze=ve.getModel(nt,ge.scope);if(ze&&ze.uploaded)for(const _t of ze.nodes)Bu(K,ge,_t,de,He,$e,Ms)}}}(_,l,f,v),void R();if(!B.loaded())return;if(B.type==="batched-model")return function(K,ce,ge,_e){const se=K.context,ue=K.transform,ve=K.style.fog,Me=K.shadowRenderer;if(ue.projection.name!=="mercator")return void s.X(`Drawing 3D landmark models for ${ue.projection.name} projection is not yet implemented`);const be=K.transform.getFreeCameraOptions().position,Ce=s.v.scale([],[be.x,be.y,be.z],K.transform.worldSize);s.v.negate(Ce,Ce);const $e=s.m.identity([]),Ne=s.c4(ue.center.lat,ue.zoom),qe=s.m.fromScaling([],[1,1,1/Ne]);s.m.translate($e,$e,Ce);const Le=ge.paint.get("model-opacity"),Ke=new s.b4(se.gl.LEQUAL,s.b4.ReadWrite,K.depthRangeFor3D),He=new s.b4(se.gl.LEQUAL,s.b4.ReadOnly,K.depthRangeFor3D),nt=function(de,ze){for(const _t of _e){const ut=ce.getTile(_t).getBucket(ge);if(!ut||!ut.uploaded)continue;let ti=!1;Me&&(ti=Me.getMaxCascadeForTile(_t.toUnwrapped())===0);const Ht=ue.calculatePosMatrix(_t.toUnwrapped(),ue.worldSize),hi=ut.modelTraits;for(const Jt of ut.getNodesInfo()){if(Jt.hiddenByReplacement||!Jt.node.meshes)continue;const _i=Jt.node,yi=K.renderPass==="light-beam",oi=[...Ht],li=Jt.evaluatedScale;let tn=0;K.terrain&&_i.elevation&&(tn=_i.elevation*K.terrain.exaggeration()),s.m.translate(oi,oi,[(_i.anchor?_i.anchor[0]:0)*(li[0]-1),(_i.anchor?_i.anchor[1]:0)*(li[1]-1),tn]),li!==s.c6&&s.m.scale(oi,oi,li),s.m.multiply(oi,oi,_i.matrix);const Li=s.m.multiply([],qe,oi);s.m.multiply(Li,$e,Li);const Nn=s.m.invert([],Li);s.m.transpose(Nn,Nn),s.m.scale(Nn,Nn,o0);const Mn=s.m.multiply([],ue.expandedFarZProjMatrix,oi),Do=hi&s.c8.HasMapboxMeshFeatures,As=Do?0:Jt.evaluatedRMEA[0][2];for(let yn=0;yn<_i.meshes.length;++yn){const sn=_i.meshes[yn],fn=yn===_i.lightMeshIndex;if(fn){if(!yi&&!K.terrain&&K.shadowRenderer){K.currentLayer<K.firstLightBeamLayer&&(K.firstLightBeamLayer=K.currentLayer);continue}}else if(yi)continue;const Jn={defines:[]},Kr=[];fd(Jn.defines,Kr,sn,K),Do||Jn.defines.push("DIFFUSE_SHADED"),ti&&Jn.defines.push("SHADOWS_SINGLE_CASCADE");const Hn=K.renderPass==="shadow";if(Hn){Fu(sn,oi,K,ge);continue}let co=null;if(ve){const Ws=Vh(oi,K.transform);if(co=new Float32Array(Ws),ue.projection.name!=="globe"){const An=sn.aabb.min,qs=sn.aabb.max,[ca,za]=ve.getOpacityForBounds(Ws,An[0],An[1],qs[0],qs[1]);Jn.overrideFog=ca>=vo||za>=vo}}const Lo=K.getOrCreateProgram("model",Jn);!Hn&&Me&&(Me.useNormalOffset=!!sn.normalBuffer,Me.setupShadowsFromMatrix(oi,Lo,Me.useNormalOffset)),K.uploadCommonUniforms(se,Lo,_t.toUnwrapped(),co);const uo=sn.material,Is=uo.pbrMetallicRoughness;Is.metallicFactor=.9,Is.roughnessFactor=.5;const Ra=nr(new Float32Array(Mn),new Float32Array(Li),new Float32Array(Nn),K,Le,Is.baseColorFactor,uo.emissiveFactor,Is.metallicFactor,Is.roughnessFactor,uo,As,ge);Lo.draw(K,se.gl.TRIANGLES,ze&&!fn?Ke:He,s.b6.disabled,de?fn||Le<1||Jt.hasTranslucentParts?s.a.alphaBlended:s.a.unblended:s.a.disabled,s.b5.backCCW,Ra,ge.id,sn.vertexBuffer,sn.indexBuffer,sn.segments,ge.paint,K.transform.zoom,void 0,Kr)}}}};(function(de,ze,_t,ut){const ti=de.terrain?de.terrain.exaggeration():0,Ht=de.transform.zoom;for(const hi of ut){const Jt=ze.getTile(hi).getBucket(_t);Jt&&(de.conflationActive&&Jt.updateReplacement(hi,de.replacementSource),Jt.evaluateScale(de,_t),de.terrain&&ti>0&&Jt.elevationUpdate(de.terrain,ti,hi,_t.source),Jt.needsReEvaluation(de,Ht,_t)&&Jt.evaluate(_t))}})(K,ce,ge,_e),Le===1?nt(!0,!0):(nt(!1,!0),nt(!0,!1))}(_,l,f,v),void R();const U=B.getModels(),H=[],Z=_.transform.getFreeCameraOptions().position,Y=s.v.scale([],[Z.x,Z.y,Z.z],_.transform.worldSize);s.v.negate(Y,Y);const Q=[],te=[];let ee=0;for(const K of U){const ce=f.paint.get("model-rotation").constantOr(null),ge=f.paint.get("model-scale").constantOr(null),_e=f.paint.get("model-translation").constantOr(null);K.computeModelMatrix(_,ce,ge,_e,!0,!0,!1);const se=s.m.identity([]),ue=s.c4(K.position.lat,_.transform.zoom),ve=s.m.fromScaling([],[1,1,1/ue]);s.m.translate(se,se,Y),H.push({zScaleMatrix:ve,negCameraPosMatrix:se});for(const Me of K.nodes)Am(_.transform,Me,K.matrix,_.transform.expandedFarZProjMatrix,ee,Q,te);ee++}if(Q.sort((K,ce)=>ce.depth-K.depth),_.renderPass!=="shadow"){if(w===1)for(const K of te)Zl(K,_,f,H[K.modelIndex],s.b6.disabled,_.colorModeForRenderPass());else{for(const K of te)Zl(K,_,f,H[K.modelIndex],s.b6.disabled,s.a.disabled);for(const K of te)Zl(K,_,f,H[K.modelIndex],_.stencilModeFor3D(),_.colorModeForRenderPass());_.resetStencilClippingMasks()}for(const K of Q)Zl(K,_,f,H[K.modelIndex],s.b6.disabled,_.colorModeForRenderPass());R()}else{for(const K of te)Fu(K.mesh,K.nodeModelMatrix,_,f);for(const K of Q)Fu(K.mesh,K.nodeModelMatrix,_,f);R()}}},km={modelUpload:function(_,l,f){const v=l.getSource();if(!v.loaded())return;if(v.type==="vector"||v.type==="geojson")return void(_.modelManager&&_.modelManager.upload(_,f));if(v.type==="batched-model")return;const w=v.getModels();for(const S of w)S.upload(_.context)}};class s0{constructor(l,f,v,w){this.context=new qn(l,f),this.transform=v,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=w,this._debugParams={showTerrainProxyTiles:!1},w.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=s.bq.maxUnderzooming+s.bq.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.ca,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new md(this),this._wireframeDebugCache=new Fc,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(l,f){const v=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(v||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Pa(this,l));const w=this._terrain;this.transform.elevation=v?w:null,w.update(l,this.transform,f),this.transform.elevation&&!w.enabled&&(this.transform.elevation=null)}_updateFog(l){const f=l.fog;if(!f||this.transform.projection.name==="globe"||f.getOpacity(this.transform.pitch)<1||f.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[v,w]=f.getFovAdjustedRange(this.transform._fov);if(v>w)return void(this.transform.fogCullDistSq=null);const S=v+.78*(w-v);this.transform.fogCullDistSq=S*S}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(l,f){if(this.width=l*s.a4.devicePixelRatio,this.height=f*s.a4.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style.order)this.style._mergedLayers[v].resize()}setup(){const l=this.context,f=new s.bo;f.emplaceBack(0,0),f.emplaceBack(s.J,0),f.emplaceBack(0,s.J),f.emplaceBack(s.J,s.J),this.tileExtentBuffer=l.createVertexBuffer(f,s.bl.members),this.tileExtentSegments=s.bm.simpleSegment(0,0,4,2);const v=new s.bo;v.emplaceBack(0,0),v.emplaceBack(s.J,0),v.emplaceBack(0,s.J),v.emplaceBack(s.J,s.J),this.debugBuffer=l.createVertexBuffer(v,s.bl.members),this.debugSegments=s.bm.simpleSegment(0,0,4,5);const w=new s.bo;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(w,s.bl.members),this.viewportSegments=s.bm.simpleSegment(0,0,4,2);const S=new s.cb;S.emplaceBack(0,0,0,0),S.emplaceBack(s.J,0,s.J,0),S.emplaceBack(0,s.J,0,s.J),S.emplaceBack(s.J,s.J,s.J,s.J),this.mercatorBoundsBuffer=l.createVertexBuffer(S,s.cc.members),this.mercatorBoundsSegments=s.bm.simpleSegment(0,0,4,2);const A=new s.bp;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(A);const P=new s.cd;for(const B of[0,1,3,2,0])P.emplaceBack(B);this.debugIndexBuffer=l.createIndexBuffer(P),this.emptyTexture=new s.a9(l,new s.a5({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA),this.identityMat=s.m.create();const R=this.context.gl;this.stencilClearMode=new s.b6({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,l.TRIANGLES,s.b4.disabled,this.stencilClearMode,s.a.disabled,s.b5.disabled,bs(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,f,v){if(!f||this.currentStencilSource===f.id||!l.isTileClipped()||!v||v.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let P=!1;for(const R of v)if(this._tileClippingMaskIDs[R.key]===void 0){P=!0;break}if(!P)return}this.currentStencilSource=f.id;const w=this.context,S=w.gl;this.nextStencilID+v.length>256&&this.clearStencil(),w.setColorMode(s.a.disabled),w.setDepthMode(s.b4.disabled);const A=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of v){const R=f.getTile(P),B=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,{tileBoundsBuffer:U,tileBoundsIndexBuffer:H,tileBoundsSegments:Z}=this.getTileBoundsBuffers(R);A.draw(this,S.TRIANGLES,s.b4.disabled,new s.b6({func:S.ALWAYS,mask:0},B,255,S.KEEP,S.KEEP,S.REPLACE),s.a.disabled,s.b5.disabled,bs(P.projMatrix),"$clipping",U,H,Z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,f=this.context.gl;return new s.b6({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const f=this.context.gl;return new s.b6({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(l){const f=this.context.gl,v=l.sort((A,P)=>P.overscaledZ-A.overscaledZ),w=v[v.length-1].overscaledZ,S=v[0].overscaledZ-w+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const A={};for(let P=0;P<S;P++)A[P+w]=new s.b6({func:f.GEQUAL,mask:255},P+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=S,[A,v]}return[{[w]:s.b6.disabled},v]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new s.a([l.CONSTANT_COLOR,l.ONE,l.CONSTANT_COLOR,l.ONE],new s.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.a.unblended:s.a.alphaBlended}colorModeForDrapableLayerRenderPass(l){const f=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new s.a([f.ONE,f.ONE_MINUS_SRC_ALPHA,f.CONSTANT_ALPHA,f.ONE_MINUS_SRC_ALPHA],new s.C(0,0,0,l===void 0?0:l),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(l,f,v,w=!1){if(!this.opaquePassEnabledForLayer()&&!w)return s.b4.disabled;const S=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new s.b4(v||this.context.gl.LEQUAL,f,[S,S])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,f){this._wireframeDebugCache.update(this.frameCounter),this.style=l,this.options=f;const v=this.style._mergedLayers,w=this.style.order,S=w.map(se=>v[se]),A=this.style._mergedSourceCaches;this.imageManager=l.imageManager,this.modelManager=l.modelManager,this.symbolFadeChange=l.placement.symbolFadeChange(s.a4.now()),this.imageManager.beginFrame();let P=0,R=!1;for(const se in A){const ue=A[se];ue.used&&(ue.prepare(this.context),ue.getSource().usedInConflation&&++P)}const B={},U={},H={},Z={},Y={};for(const se in A){const ue=A[se];B[se]=ue.getVisibleCoordinates(),U[se]=B[se].slice().reverse(),H[se]=ue.getVisibleCoordinates(!0).reverse(),Z[se]=ue.getShadowCasterCoordinates(),Y[se]=ue.sortCoordinatesByDistance(B[se])}const Q=se=>{const ue=this.style.getLayerSourceCache(se);return ue&&ue.used?ue.getSource():null};if(P){const se=[];for(const ue of S)this.layerUsedInConflation(ue,Q(ue))&&se.push(ue);if(se&&se.length>1){const ue=[];for(const ve of se){const Me=this.style.getLayerSourceCache(ve);Me&&Me.used&&Me.getSource().usedInConflation&&ue.push({layer:ve.fqid,cache:Me})}this.replacementSource.setSources(ue),R=!0}}R||this.replacementSource.clear(),this.conflationActive=R,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const se of S){const ue=se.cutoffRange();if(this.longestCutoffRange=Math.max(ue,this.longestCutoffRange),ue>0){const ve=Q(se);ve&&(this.minCutoffZoom=Math.max(ve.minzoom,this.minCutoffZoom)),se.minzoom&&(this.minCutoffZoom=Math.max(se.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let se=0;se<S.length;se++)if(S[se].is3D()){this.opaquePassCutoff=se;break}const te=this.style&&this.style.fog;te?(this._fogVisible=te.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=te.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(H),this.opaquePassCutoff=0);const ee=this._shadowRenderer;if(ee){ee.updateShadowParameters(this.transform,this.style.directionalLight);for(const se in A)for(const ue of B[se]){let ve={min:0,max:0};this.terrain&&(ve=this.terrain.getMinMaxForTile(ue)||ve),ee.addShadowReceiver(ue.toUnwrapped(),ve.min,ve.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.ce(this.context));for(const se of S){if(se.isHidden(this.transform.zoom))continue;const ue=l.getLayerSourceCache(se);this.uploadLayer(this,se,ue)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new i0(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!s.cf(this.context.gl))return;this.renderPass="offscreen";for(const se of S){const ue=l.getLayerSourceCache(se);if(!se.hasOffscreenPass()||se.isHidden(this.transform.zoom))continue;const ve=ue?U[ue.id]:void 0;(se.type==="custom"||se.type==="raster"||se.isSky()||ve&&ve.length)&&this.renderLayer(this,ue,se,ve)}this.depthRangeFor3D=[0,1-(S.length+2)*this.numSublayers*this.depthEpsilon];const K=this.terrain;K&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&K.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Z)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ce=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ge=(()=>{if(f.showOverdrawInspector)return s.C.black;if(this.style.fog&&this.transform.projection.supportsFog&&!ce){const se=this.style.fog.properties.get("color").toArray01();return new s.C(...se)}if(this.style.fog&&this.transform.projection.supportsFog&&ce){const se=this.style.fog.properties.get("space-color").toArray01();return new s.C(...se)}return s.C.transparent})();if(this.context.clear({color:ge,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ce&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const se=S[this.currentLayer],ue=l.getLayerSourceCache(se);if(se.isSky())continue;const ve=ue?(se.is3D()?Y:U)[ue.id]:void 0;this._renderTileClippingMasks(se,ue,ve),this.renderLayer(this,ue,se,ve)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ce&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.ao(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const se=S[this.currentLayer],ue=l.getLayerSourceCache(se);se.isSky()&&this.renderLayer(this,ue,se,ue?U[ue.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let _e=0;for(ee&&(_e=ee.getShadowCastingLayerCount());this.currentLayer<w.length;){const se=S[this.currentLayer],ue=l.getLayerSourceCache(se);if(se.isSky()){++this.currentLayer;continue}if(K&&this.style.isLayerDraped(se)){if(se.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=K.renderBatch(this.currentLayer);continue}let ve;if(ue&&(ve=(se.type==="symbol"?H:se.is3D()?Y:U)[ue.id]),this._renderTileClippingMasks(se,ue,ue?B[ue.id]:void 0),this.renderLayer(this,ue,se,ve),!K&&ee&&_e>0&&se.hasShadowPass()&&--_e==0&&(ee.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Me=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Me;this.currentLayer++){const be=S[this.currentLayer];if(!be.hasLightBeamPass())continue;const Ce=l.getLayerSourceCache(be);this.renderLayer(this,Ce,be,Ce?U[Ce.id]:void 0)}this.currentLayer=Me,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let se=null;S.forEach(ue=>{const ve=l.getLayerSourceCache(ue);ve&&!ue.isHidden(this.transform.zoom)&&ve.getVisibleCoordinates().length&&(!se||se.getSource().maxzoom<ve.getSource().maxzoom)&&(se=ve)}),se&&this.options.showTileBoundaries&&dd.debug(this,se,se.getVisibleCoordinates(),s.C.red,!1)}this.terrain&&this._debugParams.showTerrainProxyTiles&&dd.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.C(1,.8,.1,1),!0),this.options.showPadding&&function(se){const ue=se.transform.padding;aa(se,se.transform.height-(ue.top||0),3,wo),aa(se,ue.bottom||0,3,ds),La(se,ue.left||0,3,Ss),La(se,se.transform.width-(ue.right||0),3,Da);const ve=se.transform.centerPoint;(function(Me,be,Ce,$e){ps(Me,be-1,Ce-10,2,20,$e),ps(Me,be-10,Ce-1,20,2,$e)})(se,ve.x,se.transform.height-ve.y,Wl)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),R||(this.conflationActive=!1)}uploadLayer(l,f,v){this.gpuTimingStart(f),(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes(f.type)||l.terrain&&f.type==="custom")&&km[`${f.type}Upload`]&&km[`${f.type}Upload`](l,v,f.scope),this.gpuTimingEnd()}renderLayer(l,f,v,w){v.isHidden(this.transform.zoom)||(v.type==="background"||v.type==="sky"||v.type==="custom"||v.type==="model"||v.type==="raster"||w&&w.length)&&(this.id=v.id,this.gpuTimingStart(v),(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes(v.type)||l.terrain&&v.type==="custom")&&dd[v.type](l,f,v,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const f=this.context.extTimerQuery,v=this.context.gl;let w=this.gpuTimers[l.id];w||(w=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:v.createQuery()}),w.calls++,v.beginQuery(f.TIME_ELAPSED_EXT,w.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const l=this.context.extTimerQuery,f=this.context.gl,v=f.createQuery();this.deferredRenderGpuTimeQueries.push(v),f.beginQuery(l.TIME_ELAPSED_EXT,v)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){const l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){const f={};for(const v in l){const w=l[v],S=this.context.extTimerQuery,A=S.getQueryParameter(w.query,this.context.gl.QUERY_RESULT)/1e6;S.deleteQueryEXT(w.query),f[v]=A}return f}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;const f=this.context.extTimerQuery,v=this.context.gl;let w=0;for(const S of l)w+=f.getQueryParameter(S,v.QUERY_RESULT)/1e6,f.deleteQueryEXT(S);return w}translatePosMatrix(l,f,v,w,S){if(!v[0]&&!v[1])return l;const A=S?w==="map"?this.transform.angle:0:w==="viewport"?-this.transform.angle:0;if(A){const B=Math.sin(A),U=Math.cos(A);v=[v[0]*U-v[1]*B,v[0]*B+v[1]*U]}const P=[S?v[0]:s.ay(f,v[0],this.transform.zoom),S?v[1]:s.ay(f,v[1],this.transform.zoom),0],R=new Float32Array(16);return s.m.translate(R,l,P),R}saveTileTexture(l){const f=l.size[0],v=this._tileTextures[f];v?v.push(l):this._tileTextures[f]=[l]}getTileTexture(l){const f=this._tileTextures[l];return f&&f.length>0?f.pop():null}isPatternMissing(l,f){return l===null||l!==void 0&&!this.imageManager.getPattern(l.toString(),f)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(l,f,v){const w=v===void 0?this.terrain&&this.terrain.renderingToTexture:v,S=this.terrain&&this.terrain.exaggeration()===0,A=[];return this.style&&this.style.enable3dLights()&&(l==="globeRaster"||l==="terrainRaster"?(A.push("LIGHTING_3D_MODE"),A.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):w||A.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||A.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?A.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):A.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(A.push("TERRAIN"),this.linearFloatFilteringSupported()&&A.push("TERRAIN_DEM_FLOAT_FORMAT"),S&&A.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&A.push("GLOBE"),!this._fogVisible||w||f!==void 0&&!f||A.push("FOG","FOG_DITHERING"),w&&A.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&A.push("OVERDRAW_INSPECTOR"),A}getOrCreateProgram(l,f){this.cache=this.cache||{};const v=f&&f.defines||[],w=f&&f.config,S=this.currentGlobalDefines(l,f&&f.overrideFog,f&&f.overrideRtt).concat(v),A=Lc.cacheKey(Su[l],l,S,w);return this.cache[A]||(this.cache[A]=new Lc(this.context,l,Su[l],w,Rr[l],S)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.a9(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(l,f){if(this.style.enable3dLights()){const v=this.style.directionalLight,w=this.style.ambientLight;if(v&&w){const S=((A,P)=>{const R=A.properties.get("direction"),B=A.properties.get("color").toArray01(),U=A.properties.get("intensity"),H=P.properties.get("color").toArray01(),Z=P.properties.get("intensity"),Y=[R.x,R.y,R.z],Q=s.bv(H,Z),te=s.bv(B,U);return{u_lighting_ambient_color:Q,u_lighting_directional_dir:Y,u_lighting_directional_color:te,u_ground_radiance:Pu(Y,te,Q)}})(v,w);f.setLightsUniformValues(l,S)}}}uploadCommonUniforms(l,f,v,w,S){if(this.uploadCommonLightUniforms(l,f),this.terrain&&this.terrain.renderingToTexture)return;const A=this.style.fog;if(A){const P=A.getOpacity(this.transform.pitch),R=((B,U,H,Z,Y,Q,te,ee,K,ce,ge,_e)=>{const se=B.transform,ue=U.properties.get("color").toArray01();ue[3]=Z;const ve=B.frameCounter/1e3%1,[Me,be]=U.properties.get("vertical-range");return{u_fog_matrix:H?se.calculateFogTileMatrix(H):_e||B.identityMat,u_fog_range:U.getFovAdjustedRange(se._fov),u_fog_color:ue,u_fog_horizon_blend:U.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Me,be),be],u_fog_temporal_offset:ve,u_frustum_tl:Y,u_frustum_tr:Q,u_frustum_br:te,u_frustum_bl:ee,u_globe_pos:K,u_globe_radius:ce,u_viewport:ge,u_globe_transition:s.ao(se.zoom),u_is_globe:+(se.projection.name==="globe")}})(this,A,v,P,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.a4.devicePixelRatio,this.transform.height*s.a4.devicePixelRatio],w);f.setFogUniformValues(l,R)}S&&f.setCutoffUniformValues(l,S.uniformValues)}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){const l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){const l=this.context.gl,f=l.createTexture();return l.bindTexture(l.TEXTURE_2D,f),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),f}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&l.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const l=this._backgroundTiles,f=this._backgroundTiles={},v=this.transform.coveringTiles({tileSize:512});for(const w of v)f[w.key]=l[w.key]||new s.bt(w,512,this.transform.tileZoom,this);return f}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(l,f){return!(!l.is3D()||l.minzoom&&l.minzoom>this.transform.zoom||l.sourceLayer!=="building"&&(!f||f.type!=="batched-model"))}isTileAffectedByFog(l){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let f=this._cachedTileFogOpacities[l.key];return f||(this._cachedTileFogOpacities[l.key]=f=this.style.fog.getOpacityForTile(l)),f[0]>=vo||f[1]>=vo}}const Zo={cascadeCount:2,shadowMapResolution:2048};class a0{constructor(l,f){this.aabb=l,this.lastCascade=f}}class pd{add(l,f){const v=this.receivers[l.key];v!==void 0?(v.aabb.min[0]=Math.min(v.aabb.min[0],f.min[0]),v.aabb.min[1]=Math.min(v.aabb.min[1],f.min[1]),v.aabb.min[2]=Math.min(v.aabb.min[2],f.min[2]),v.aabb.max[0]=Math.max(v.aabb.max[0],f.max[0]),v.aabb.max[1]=Math.max(v.aabb.max[1],f.max[1]),v.aabb.max[2]=Math.max(v.aabb.max[2],f.max[2])):this.receivers[l.key]=new a0(f,null)}clear(){this.receivers={}}get(l){return this.receivers[l.key]}computeRequiredCascades(l,f,v){const w=s.c3.fromPoints(l.points);let S=0;for(const A in this.receivers){const P=this.receivers[A];if(!P||!w.intersectsAabb(P.aabb))continue;P.aabb.min=w.closestPoint(P.aabb.min),P.aabb.max=w.closestPoint(P.aabb.max);const R=P.aabb.getCorners();for(let B=0;B<v.length;B++){let U=!0;for(const H of R){const Z=[H[0]*f,H[1]*f,H[2]];if(s.v.transformMat4(Z,Z,v[B].matrix),Z[0]<-1||Z[0]>1||Z[1]<-1||Z[1]>1){U=!1;break}}if(P.lastCascade=B,S=Math.max(S,B),U)break}}return S+1}}class md{constructor(l){this.painter=l,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new pd,this._depthMode=new s.b4(l.context.gl.LEQUAL,s.b4.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,l.tp.registerParameter(Zo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),l.tp.registerParameter(Zo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(const l of this._cascades)l.texture.destroy(),l.framebuffer.destroy();this._cascades=[]}updateShadowParameters(l,f){const v=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!f||!f.properties)return;const w=f.properties.get("shadow-intensity");if(!f.shadowsEnabled()||w<=0||(this._shadowLayerCount=v.style.order.reduce((Q,te)=>{const ee=v.style._mergedLayers[te];return Q+(ee.hasShadowPass()&&!ee.isHidden(l.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const S=v.context,A=Zo.shadowMapResolution,P=Zo.shadowMapResolution;if(this._cascades.length===0||Zo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Q=0;Q<Zo.cascadeCount;++Q){const te=v._shadowMapDebug,ee=S.gl,K=S.createFramebuffer(A,P,te,"texture"),ce=new s.a9(S,{width:A,height:P,data:null},ee.DEPTH_COMPONENT);if(K.depthAttachment.set(ce.texture),te){const ge=new s.a9(S,{width:A,height:P,data:null},ee.RGBA);K.colorAttachment.set(ge.texture)}this._cascades.push({framebuffer:K,texture:ce,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.F,scale:0})}}this.shadowDirection=gd(f);let R=0;if(l.elevation){const Q=l.elevation,te=[1e4,-1e4];Q.visibleDemTiles.filter(ee=>ee.dem).forEach(ee=>{const K=ee.dem.tree;te[0]=Math.min(te[0],K.minimums[0]),te[1]=Math.max(te[1],K.maximums[0])}),te[0]!==1e4&&(R=(te[1]-te[0])*Q.exaggeration())}const B=1.5*l.cameraToCenterDistance,U=3*B,H=new Float64Array(16);for(let Q=0;Q<this._cascades.length;++Q){const te=this._cascades[Q];let ee=l.height/50,K=1;Zo.cascadeCount===1?K=U:Q===0?K=B:(ee=B,K=U);const[ce,ge]=Dm(l,this.shadowDirection,ee,K,Zo.shadowMapResolution,R);te.scale=l.scale,te.matrix=ce,te.boundingSphereRadius=ge,s.m.invert(H,te.matrix),te.frustum=s.F.fromInvProjectionMatrix(H,1,0,!0),te.far=K}const Z=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[Z].far,this._cascades[Z].far],this._uniformValues.u_shadow_intensity=w,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Zo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Zo.shadowMapResolution,this._uniformValues.u_shadowmap_0=ji.ShadowMap0,this._uniformValues.u_shadowmap_1=ji.ShadowMap0+1,this._groundShadowTiles=v.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Y=v.transform.elevation;for(const Q of this._groundShadowTiles){let te={min:0,max:0};if(Y){const ee=Y.getMinMaxForTile(Q);ee&&(te=ee)}this.addShadowReceiver(Q.toUnwrapped(),te.min,te.max)}}get enabled(){return this._enabled}set enabled(l){this._enabled=l}drawShadowPass(l,f){if(!this._enabled)return;const v=this.painter,w=v.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(v.transform.getFrustum(0),v.transform.worldSize,this._cascades),w.viewport.set([0,0,Zo.shadowMapResolution,Zo.shadowMapResolution]);for(let S=0;S<this._numCascadesToRender;++S){v.currentShadowCascade=S,w.bindFramebuffer.set(this._cascades[S].framebuffer.framebuffer),w.clear({color:s.C.white,depth:1});for(const A of l.order){const P=l._mergedLayers[A];if(!P.hasShadowPass()||P.isHidden(v.transform.zoom))continue;const R=l.getLayerSourceCache(P),B=R?f[R.id]:void 0;(P.type==="model"||B&&B.length)&&v.renderLayer(v,R,P,B)}}v.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const l=this.painter,f=l.style,v=l.context,w=f.directionalLight,S=f.ambientLight;if(!w||!S)return;const A=[],P=Aa(l,l.longestCutoffRange);P.shouldRenderCutoff&&A.push("RENDER_CUTOFF");const R=Uh(w,S),B=new s.b4(v.gl.LEQUAL,s.b4.ReadOnly,l.depthRangeFor3D);for(const U of this._groundShadowTiles){const H=U.toUnwrapped(),Z=l.isTileAffectedByFog(U),Y=l.getOrCreateProgram("groundShadow",{defines:A,overrideFog:Z});this.setupShadows(H,Y),l.uploadCommonUniforms(v,Y,H,null,P);const Q={u_matrix:l.transform.calculateProjMatrix(H),u_ground_shadow_factor:R};Y.draw(l,v.gl.TRIANGLES,B,s.b6.disabled,s.a.multiply,s.b5.disabled,Q,"ground_shadow",l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments,{},l.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?s.a.unblended:s.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(l){const f=this.painter.transform,v=f.calculatePosMatrix(l,f.worldSize);return s.m.multiply(v,this._cascades[this.painter.currentShadowCascade].matrix,v),Float32Array.from(v)}calculateShadowPassMatrixFromMatrix(l){return s.m.multiply(l,this._cascades[this.painter.currentShadowCascade].matrix,l),Float32Array.from(l)}setupShadows(l,f,v,w=0){if(!this._enabled)return;const S=this.painter.transform,A=this.painter.context,P=A.gl,R=this._uniformValues,B=new Float64Array(16),U=S.calculatePosMatrix(l,S.worldSize);for(let H=0;H<this._cascades.length;H++)s.m.multiply(B,this._cascades[H].matrix,U),R[H===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(B),A.activeTexture.set(P.TEXTURE0+ji.ShadowMap0+H),this._cascades[H].texture.bind(P.NEAREST,P.CLAMP_TO_EDGE);if(this.useNormalOffset=!!v,this.useNormalOffset){const H=s.cg(l.canonical),Z=2/S.tileSize*s.J/Zo.shadowMapResolution,Y=Z*this._cascades[0].boundingSphereRadius,Q=Z*this._cascades[this._cascades.length-1].boundingSphereRadius,te=(v==="vector-tile"?1:3)/Math.pow(2,w-l.canonical.z-(1-S.zoom+Math.floor(S.zoom)));R.u_shadow_normal_offset=[H,Y*te,Q*te],R.u_shadow_bias=[6e-5,.0012,.012]}else R.u_shadow_bias=[36e-5,.0012,.012];f.setShadowUniformValues(A,R)}setupShadowsFromMatrix(l,f,v=!1){if(!this._enabled)return;const w=this.painter.context,S=w.gl,A=this._uniformValues,P=new Float64Array(16);for(let R=0;R<Zo.cascadeCount;R++)s.m.multiply(P,this._cascades[R].matrix,l),A[R===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),w.activeTexture.set(S.TEXTURE0+ji.ShadowMap0+R),this._cascades[R].texture.bind(S.NEAREST,S.CLAMP_TO_EDGE);this.useNormalOffset=v,v?(A.u_shadow_normal_offset=[1,5,5],A.u_shadow_bias=[6e-5,.0012,.012]):A.u_shadow_bias=[36e-5,.0012,.012],f.setShadowUniformValues(w,A)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(l,f,v,w){if(w[2]>=0)return{};const S=function(R,B,U){const H=U/(1<<R.canonical.z);return new s.c3([R.canonical.x*H+R.wrap*U,R.canonical.y*H+R.wrap*U,0],[(R.canonical.x+1)*H+R.wrap*U,(R.canonical.y+1)*H+R.wrap*U,B])}(l,f,v).getCorners(),A=f/-w[2];w[0]<0?(s.v.add(S[0],S[0],[w[0]*A,0,0]),s.v.add(S[3],S[3],[w[0]*A,0,0])):w[0]>0&&(s.v.add(S[1],S[1],[w[0]*A,0,0]),s.v.add(S[2],S[2],[w[0]*A,0,0])),w[1]<0?(s.v.add(S[0],S[0],[0,w[1]*A,0]),s.v.add(S[1],S[1],[0,w[1]*A,0])):w[1]>0&&(s.v.add(S[2],S[2],[0,w[1]*A,0]),s.v.add(S[3],S[3],[0,w[1]*A,0]));const P={};return P.vertices=S,P.planes=[Nu(S[1],S[0],S[4]),Nu(S[2],S[1],S[5]),Nu(S[3],S[2],S[6]),Nu(S[0],S[3],S[7])],P}addShadowReceiver(l,f,v){this._receivers.add(l,s.c3.fromTileIdAndHeight(l,f,v))}getMaxCascadeForTile(l){const f=this._receivers.get(l);return f&&f.lastCascade?f.lastCascade:0}}function Nu(_,l,f){const v=s.v.sub([],f,l),w=s.v.sub([],_,l),S=s.v.cross([],v,w),A=s.v.length(S);return A===0?[0,0,1,0]:(s.v.scale(S,S,1/A),[S[0],S[1],S[2],-s.v.dot(S,l)])}function gd(_){const l=_.properties.get("direction"),f=s.b3(l.x,l.y,l.z);f[2]=s.c(f[2],0,75);const v=s.ch([f[0],f[1],f[2]]);return s.v.fromValues(v.x,v.y,v.z)}function Uh(_,l){const f=_.properties.get("color"),v=_.properties.get("intensity"),w=_.properties.get("direction"),S=[w.x,w.y,w.z],A=l.properties.get("color"),P=l.properties.get("intensity"),R=Math.max(s.v.dot([0,0,1],S),0),B=[0,0,0];s.v.scale(B,A.toArray01Linear().slice(0,3),P);const U=[0,0,0];return s.v.scale(U,f.toArray01Linear().slice(0,3),R*v),s.bw([B[0]>0?B[0]/(B[0]+U[0]):0,B[1]>0?B[1]/(B[1]+U[1]):0,B[2]>0?B[2]/(B[2]+U[2]):0])}function Dm(_,l,f,v,w,S){const A=_.zoom,P=_.scale,R=_.worldSize,B=1/R,U=_.aspect,H=Math.sqrt(1+U*U)*Math.tan(.5*_.fovX),Z=H*H,Y=v-f,Q=v+f;let te,ee;Z>Y/Q?(te=v,ee=v*H):(te=.5*Q*(1+Z),ee=.5*Math.sqrt(Y*Y+2*(v*v+f*f)*Z+Q*Q*Z*Z));const K=_.projection.pixelsPerMeter(_.center.lat,R),ce=_._camera.getCameraToWorldMercator(),ge=[0,0,-te*B];s.v.transformMat4(ge,ge,ce);let _e=ee*B;const se=_._edgeInsets;if(!(se.left===0&&se.top===0&&se.right===0&&se.bottom===0||se.left===se.right&&se.top===se.bottom)){const ut=_._camera.getWorldToCamera(_.worldSize,_.projection.zAxisUnit==="meters"?K:1),ti=_._camera.getCameraToClipPerspective(_._fov,_.width/_.height,f,v);ti[8]=2*-_.centerOffset.x/_.width,ti[9]=2*_.centerOffset.y/_.height;const Ht=new Float64Array(16);s.m.mul(Ht,ti,ut);const hi=new Float64Array(16);s.m.invert(hi,Ht);const Jt=s.F.fromInvProjectionMatrix(hi,R,A,!0);for(const _i of Jt.points){const yi=((ue=_i)[0]/=P,ue[1]/=P,ue[2]=s.b(ue[2],_._center.lat),ue);_e=Math.max(_e,s.v.len(s.v.subtract([],ge,yi)))}}var ue;_e*=w/(w-1);const ve=Math.acos(l[2]),Me=Math.atan2(-l[0],-l[1]),be=new an;be.position=ge,be.setPitchBearing(ve,Me);const Ce=be.getWorldToCamera(R,K),$e=_e*R,Ne=Math.min(_._mercatorZfromZoom(17)*R*-2,-2*$e),qe=be.getCameraToClipOrthographic(-$e,$e,-$e,$e,Ne,($e+S*K)/l[2]),Le=new Float64Array(16);s.m.multiply(Le,qe,Ce);const Ke=s.v.fromValues(Math.floor(1e6*ge[0])/1e6*R,Math.floor(1e6*ge[1])/1e6*R,0),He=.5*w,nt=[0,0,0];s.v.transformMat4(nt,Ke,Le),s.v.scale(nt,nt,He);const de=[Math.floor(nt[0]),Math.floor(nt[1]),Math.floor(nt[2])],ze=[0,0,0];s.v.sub(ze,nt,de),s.v.scale(ze,ze,-1/He);const _t=new Float64Array(16);return s.m.identity(_t),s.m.translate(_t,_t,ze),s.m.multiply(Le,_t,Le),[Le,$e]}class Lm extends s.a6{constructor(l){super(),this.requestManager=l,this.models={"":{}},this.numModelsLoading={}}loadModel(l,f){return s.aO(this.requestManager.transformRequest(f,s.a2.Model).url).then(v=>{if(!v)return;const w=s.aP(v),S=new s.aQ(l,void 0,void 0,w);return S.computeBoundsAndApplyParent(),S}).catch(v=>{this.fire(new s.a7(new Error(`Could not load model ${l} from ${f}: ${v.message}`)))})}load(l,f){this.models[f]||(this.models[f]={});const v=Object.keys(l);this.numModelsLoading[f]=(this.numModelsLoading[f]||0)+v.length;const w=[];for(const S of v)w.push(this.loadModel(S,l[S]));Promise.allSettled(w).then(S=>{for(let A=0;A<S.length;A++){const{status:P,value:R}=S[A];P==="fulfilled"&&R&&(this.models[f][v[A]]=R)}this.numModelsLoading[f]-=v.length,this.fire(new s.a8("data",{dataType:"style"}))}).catch(S=>{this.fire(new s.a7(new Error(`Could not load models: ${S.message}`)))})}isLoaded(){for(const l in this.numModelsLoading)if(this.numModelsLoading[l]>0)return!1;return!0}hasModel(l,f){return!!this.getModel(l,f)}getModel(l,f){return this.models[f]||(this.models[f]={}),this.models[f][l]}addModel(l,f,v){this.models[v]||(this.models[v]={}),this.hasModel(l,v)&&this.removeModel(l,v),this.load({[l]:this.requestManager.normalizeModelURL(f)},v)}addModels(l,f){const v={};for(const w in l)v[w]=this.requestManager.normalizeModelURL(l[w]);this.load(v,f)}removeModel(l,f){this.models[f]||(this.models[f]={});const v=this.models[f][l];delete this.models[f][l],v.destroy()}listModels(l){return this.models[l]||(this.models[l]={}),Object.keys(this.models[l])}upload(l,f){this.models[f]||(this.models[f]={});for(const v in this.models[f])this.models[f][v].upload(l.context)}}const Xl=(_,l)=>s.ai(_,l&&l.filter(f=>f.identifier!=="source.canvas")),Om=s.p(ct,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),Rm=s.p(ct,["setCenter","setZoom","setBearing","setPitch"]),_d={version:8,layers:[],sources:{}},ol={duration:300,delay:0},Vu=new Set(["fill","line","background","hillshade","raster"]);class Es extends s.a6{constructor(l,f={}){super(),this.map=l,this.scope=f.scope||"",this.fragments=[],this.importDepth=f.importDepth||0,this.importsCache=f.importsCache||new Map,this.resolvedImports=f.resolvedImports||new Set,this.transition=s.ak({},ol),this._buildingIndex=new vu(this),this.crossTileSymbolIndex=new ad,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=f.styleChanges||new Ie,this.dispatcher=f.dispatcher?f.dispatcher:new s.br(s.bs(),this),f.imageManager?this.imageManager=f.imageManager:(this.imageManager=new Zn,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=f.glyphManager?f.glyphManager:new s.cj(l._requestManager,f.localFontFamily?s.ck.all:f.localIdeographFontFamily?s.ck.ideographs:s.ck.none,f.localFontFamily||f.localIdeographFontFamily),f.modelManager?this.modelManager=f.modelManager:(this.modelManager=new Lm(l._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=f.configOptions?f.configOptions:new Map,this._configDependentLayers=f.configDependentLayers?f.configDependentLayers:new Set,this._config=f.config,this.dispatcher.broadcast("setReferrer",s.cl());const v=this;this._rtlTextPluginCallback=Es.registerForPluginStateChange(w=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(S,A)=>{if(s.cm(S),A&&A.every(P=>P))for(const P in v._sourceCaches){const R=v._sourceCaches[P],B=R.getSource().type;B!=="vector"&&B!=="geojson"||R.reload()}})}),this.on("data",w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const S=this.getOwnSource(w.sourceId);if(S&&S.vectorLayerIds)for(const A in this._layers){const P=this._layers[A];P.source===S.id&&this._validateLayer(P)}})}loadURL(l,f={}){this.fire(new s.a8("dataloading",{dataType:"style"}));const v=typeof f.validate=="boolean"?f.validate:!s.cn(l);l=this.map._requestManager.normalizeStyleURL(l,f.accessToken),this.resolvedImports.add(l);const w=this.importsCache.get(l);if(w)return this._load(w,v);const S=this.map._requestManager.transformRequest(l,s.a2.Style);this._request=s.a1(S,(A,P)=>{if(this._request=null,A)this.fire(new s.a7(A));else if(P)return this.importsCache.set(l,P),this._load(P,v)})}loadJSON(l,f={}){this.fire(new s.a8("dataloading",{dataType:"style"})),this._request=s.a4.frame(()=>{this._request=null,this._load(l,f.validate!==!1)})}loadEmpty(){this.fire(new s.a8("dataloading",{dataType:"style"})),this._load(_d,!1)}_loadImports(l,f){if(this.importDepth>=4)return s.X("Style doesn't support nesting deeper than 5"),Promise.resolve();const v=[];for(const w of l){const S=this._createFragmentStyle(w),A=new Promise(R=>{S.once("style.import.load",R),S.once("error",R)}).then(()=>this.mergeAll());if(v.push(A),this.resolvedImports.has(w.url)){S.loadEmpty();continue}const P=w.data||this.importsCache.get(w.url);P?S.loadJSON(P,{validate:f}):w.url?S.loadURL(w.url,{validate:f}):S.loadEmpty(),this.fragments.push({style:S,id:w.id,config:w.config})}return Promise.allSettled(v)}_createFragmentStyle(l){const f=this.scope?s.aE(l.id,this.scope):l.id,v=new Es(this.map,{scope:f,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:l.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const l=this.isRootStyle();this._shouldPrecompile=l,this.fire(new s.a8(l?"style.load":"style.import.load"))}_load(l,f){const v=l.schema;if(this.isRootStyle()&&(l.fragment||v&&l.fragment!==!1)){const A=s.ak({},_d,{imports:[{id:"basemap",data:l,url:""}]});return void this._load(A,f)}if(this.setConfig(this._config,v),f&&Xl(this,s.aj(l)))return;this._loaded=!0,this.stylesheet=s.co(l);for(const A in l.sources)this.addSource(A,l.sources[A],{validate:!1,isInitialLoad:!0});l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(l.glyphs,this.scope);const w=Sa(this.stylesheet.layers);if(this._order=w.map(A=>A.id),this.stylesheet.light&&s.X("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const A=this.stylesheet.lights[0];this.light=new Xr(A.properties,A.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Xr(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const A of w){const P=s.cp(A,this.scope,this.options);P.isConfigDependent&&this._configDependentLayers.add(P.fqid),P.setEventedParent(this,{layer:{id:P.id}}),this._layers[P.id]=P,this._serializedLayers[P.id]=P.serialize();const R=this.getOwnLayerSourceCache(P),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();R&&P.canCastShadows()&&B&&(R.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const S=this.stylesheet.terrain;S&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.a4.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?s.X("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(S,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.a8("data",{dataType:"style"})),l.imports?this._loadImports(l.imports,f).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let l,f,v,w,S,A,P,R;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(B=>{if(B.stylesheet){if(B.light!=null&&(l=B.light),B.stylesheet.lights)for(const U of B.stylesheet.lights)U.type==="ambient"&&B.ambientLight!=null&&(f=B.ambientLight),U.type==="directional"&&B.directionalLight!=null&&(v=B.directionalLight);w=this._prioritizeTerrain(w,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(S=B.fog),B.stylesheet.camera!=null&&(R=B.stylesheet.camera),B.stylesheet.projection!=null&&(A=B.stylesheet.projection),B.stylesheet.transition!=null&&(P=B.stylesheet.transition)}}),this.light=l,this.ambientLight=f,this.directionalLight=v,this.fog=S,w===null?delete this.terrain:this.terrain=w,this.camera=R||{"camera-projection":"perspective"},this.projection=A||{name:"mercator"},this.transition=s.ak({},ol,P),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(l){const f=v=>{for(const w of v.fragments)f(w.style);l(v)};f(this)}_prioritizeTerrain(l,f,v){const w=l&&l.drapeRenderMode===0;return v===null?f&&f.drapeRenderMode===0?f:w?l:null:f!=null&&(!l||w||f&&f.drapeRenderMode===1)?f:l}mergeTerrain(){let l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(f=>{l=this._prioritizeTerrain(l,f.terrain,f.stylesheet.terrain)}),l===null?delete this.terrain:this.terrain=l}mergeProjection(){let l;this.forEachFragmentStyle(f=>{f.stylesheet.projection!=null&&(l=f.stylesheet.projection)}),this.projection=l||{name:"mercator"}}mergeSources(){const l={},f={},v={};this.forEachFragmentStyle(w=>{for(const S in w._sourceCaches){const A=s.aE(S,w.scope);l[A]=w._sourceCaches[S]}for(const S in w._otherSourceCaches){const A=s.aE(S,w.scope);f[A]=w._otherSourceCaches[S]}for(const S in w._symbolSourceCaches){const A=s.aE(S,w.scope);v[A]=w._symbolSourceCaches[S]}}),this._mergedSourceCaches=l,this._mergedOtherSourceCaches=f,this._mergedSymbolSourceCaches=v}mergeLayers(){const l={},f=[],v={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(S=>{for(const A of S._order){const P=S._layers[A];if(P.type==="slot"){const R=s.cq(A);if(l[R])continue;l[R]=[]}P.slot&&l[P.slot]?l[P.slot].push(P):f.push(P)}}),this._mergedOrder=[];const w=(S=[])=>{for(const A of S)if(A.type==="slot"){const P=s.cq(A.id);l[P]&&w(l[P])}else{const P=s.aE(A.id,A.scope);this._mergedOrder.push(P),v[P]=A,A.is3D()&&(this._has3DLayers=!0),A.type==="circle"&&(this._hasCircleLayers=!0),A.type==="symbol"&&(this._hasSymbolLayers=!0)}};w(f),this._mergedLayers=v,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(l){return this.stylesheet.camera=s.ak({},this.stylesheet.camera,l),this.camera=this.stylesheet.camera,this}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(l){this._spriteRequest=function(f,v,w){let S,A,P;const R=s.a4.devicePixelRatio>1?"@2x":"";let B=s.a1(v.transformRequest(v.normalizeSpriteURL(f,R,".json"),s.a2.SpriteJSON),(Z,Y)=>{B=null,P||(P=Z,S=Y,H())}),U=s.a3(v.transformRequest(v.normalizeSpriteURL(f,R,".png"),s.a2.SpriteImage),(Z,Y)=>{U=null,P||(P=Z,A=Y,H())});function H(){if(P)w(P);else if(S&&A){const Z=s.a4.getImageData(A),Y={};for(const Q in S){const{width:te,height:ee,x:K,y:ce,sdf:ge,pixelRatio:_e,stretchX:se,stretchY:ue,content:ve}=S[Q],Me=new s.a5({width:te,height:ee});s.a5.copy(Z,Me,{x:K,y:ce},{x:0,y:0},{width:te,height:ee}),Y[Q]={data:Me,pixelRatio:_e,sdf:ge,stretchX:se,stretchY:ue,content:ve}}w(null,Y)}}return{cancel(){B&&(B.cancel(),B=null),U&&(U.cancel(),U=null)}}}(l,this.map._requestManager,(f,v)=>{if(this._spriteRequest=null,f)this.fire(new s.a7(f));else if(v)for(const w in v)this.imageManager.addImage(w,this.scope,v[w]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.a8("data",{dataType:"style"}))})}_validateLayer(l){const f=this.getOwnSource(l.source);if(!f)return;const v=l.sourceLayer;v&&(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(v)===-1)&&this.fire(new s.a7(new Error(`Source layer "${v}" does not exist on source "${f.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:l}of this.fragments)if(!l.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((l,f)=>{const v=this.fragments[f];return v&&v.style&&(l.data=v.style.serialize()),l})}_serializeSources(){const l={};for(const f in this._sourceCaches){const v=this._sourceCaches[f].getSource();l[v.id]||(l[v.id]=v.serialize())}return l}_serializeLayers(l){const f=[];for(const v of l){const w=this._layers[v];w&&w.type!=="custom"&&f.push(w.serialize())}return f}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(l){return!!this.terrain&&(typeof l.isLayerDraped=="function"?l.isLayerDraped(this.getLayerSourceCache(l)):Vu.has(l.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(l){const f=this.getOwnLayer(l);if(f)return f;this.fire(new s.a7(new Error(`The layer '${l}' does not exist in the map's style.`)))}_checkSource(l){const f=this.getOwnSource(l);if(f)return f;this.fire(new s.a7(new Error(`The source '${l}' does not exist in the map's style.`)))}update(l){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(l),this.directionalLight&&this.directionalLight.recalculate(l);const f=this.calculateLightsBrightness();l.brightness=f||0,f!==this._brightness&&(this._brightness=f,this.dispatcher.broadcast("setBrightness",f));const v=this._changes.isDirty();if(this._changes.isDirty()){const S=this._changes.getLayerUpdatesByScope();for(const A in S){const{updatedIds:P,removedIds:R}=S[A];(P||R)&&this._updateWorkerLayers(A,P,R)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(l),this.light&&this.light.updateTransitions(l),this.ambientLight&&this.ambientLight.updateTransitions(l),this.directionalLight&&this.directionalLight.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._changes.reset()}const w={};for(const S in this._mergedSourceCaches){const A=this._mergedSourceCaches[S];w[S]=A.used,A.used=!1}for(const S of this._mergedOrder){const A=this._mergedLayers[S];if(A.recalculate(l,this._availableImages),!A.isHidden(l.zoom)){const P=this.getLayerSourceCache(A);P&&(P.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let P=A.minzoom||0;P<(A.maxzoom||25.5);P++){const R=this.map.painter;if(R){const B=A.getProgramIds();if(!B)continue;for(const U of B){const H=A.getDefaultProgramParams(U,l.zoom);H&&(R.style=this,this.fog&&(R._fogVisible=!0,H.overrideFog=!0,R.getOrCreateProgram(U,H)),R._fogVisible=!1,H.overrideFog=!1,R.getOrCreateProgram(U,H),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(H.overrideRtt=!0,R.getOrCreateProgram(U,H)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const S in w){const A=this._mergedSourceCaches[S];w[S]!==A.used&&A.getSource().fire(new s.a8("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light&&this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),v&&this.fire(new s.a8("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=this._changes.getUpdatedImages();if(l.length){for(const f in this._sourceCaches)this._sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],l);this._changes.resetUpdatedImages()}}_updateWorkerLayers(l,f,v){const w=this.getFragmentStyle(l);w&&this.dispatcher.broadcast("updateLayers",{layers:f?w._serializeLayers(f):[],scope:l,removedIds:v||[],options:w.options})}setState(l){if(this._checkLoaded(),Xl(this,s.aj(l)))return!1;(l=s.co(l)).layers=Sa(l.layers);const f=function(w,S){if(!w)return[{command:ct.setStyle,args:[S]}];let A=[];try{if(!M(w.version,S.version))return[{command:ct.setStyle,args:[S]}];M(w.center,S.center)||A.push({command:ct.setCenter,args:[S.center]}),M(w.zoom,S.zoom)||A.push({command:ct.setZoom,args:[S.zoom]}),M(w.bearing,S.bearing)||A.push({command:ct.setBearing,args:[S.bearing]}),M(w.pitch,S.pitch)||A.push({command:ct.setPitch,args:[S.pitch]}),M(w.sprite,S.sprite)||A.push({command:ct.setSprite,args:[S.sprite]}),M(w.glyphs,S.glyphs)||A.push({command:ct.setGlyphs,args:[S.glyphs]}),M(w.imports,S.imports)||function(H=[],Z=[],Y){Z=Z||[];const Q=(H=H||[]).map(Oe),te=Z.map(Oe),ee=H.reduce(Ve,{}),K=Z.reduce(Ve,{}),ce=Q.slice();let ge,_e,se,ue;for(ge=0,_e=0;ge<Q.length;ge++)se=Q[ge],K.hasOwnProperty(se)?_e++:(Y.push({command:ct.removeImport,args:[se]}),ce.splice(ce.indexOf(se,_e),1));for(ge=0,_e=0;ge<te.length;ge++)se=te[te.length-1-ge],ce[ce.length-1-ge]!==se&&(ee.hasOwnProperty(se)?(Y.push({command:ct.removeImport,args:[se]}),ce.splice(ce.lastIndexOf(se,ce.length-_e),1)):_e++,ue=ce[ce.length-ge],Y.push({command:ct.addImport,args:[K[se],ue]}),ce.splice(ce.length-ge,0,se));for(const ve of Z){const Me=ee[ve.id];if(!Me||M(Me,ve))continue;M(Me.config,ve.config)||Y.push({command:ct.setImportConfig,args:[ve.id,ve.config]}),M(Me.url,ve.url)||Y.push({command:ct.setImportUrl,args:[ve.id,ve.url]});const be=ve.data;M(Me&&Me.data,be)||Y.push({command:ct.setImportData,args:[ve.id,be]})}}(w.imports,S.imports,A),M(w.transition,S.transition)||A.push({command:ct.setTransition,args:[S.transition]}),M(w.light,S.light)||A.push({command:ct.setLight,args:[S.light]}),M(w.fog,S.fog)||A.push({command:ct.setFog,args:[S.fog]}),M(w.projection,S.projection)||A.push({command:ct.setProjection,args:[S.projection]}),M(w.lights,S.lights)||A.push({command:ct.setLights,args:[S.lights]}),M(w.camera,S.camera)||A.push({command:ct.setCamera,args:[S.camera]});const P={},R=[];(function(H,Z,Y,Q){let te;for(te in Z=Z||{},H=H||{})H.hasOwnProperty(te)&&(Z.hasOwnProperty(te)||G(te,Y,Q));for(te in Z){if(!Z.hasOwnProperty(te))continue;const ee=Z[te];H.hasOwnProperty(te)?M(H[te],ee)||(H[te].type==="geojson"&&ee.type==="geojson"&&we(H,Z,te)?Y.push({command:ct.setGeoJSONSourceData,args:[te,ee.data]}):le(te,Z,Y,Q)):L(te,Z,Y)}})(w.sources,S.sources,R,P);const B=[];w.layers&&w.layers.forEach(H=>{H.source&&P[H.source]?A.push({command:ct.removeLayer,args:[H.id]}):B.push(H)});let U=w.terrain;U&&P[U.source]&&(A.push({command:ct.setTerrain,args:[void 0]}),U=void 0),A=A.concat(R),M(U,S.terrain)||A.push({command:ct.setTerrain,args:[S.terrain]}),function(H,Z,Y){Z=Z||[];const Q=(H=H||[]).map(Oe),te=Z.map(Oe),ee=H.reduce(Ve,{}),K=Z.reduce(Ve,{}),ce=Q.slice(),ge=Object.create(null);let _e,se,ue,ve,Me,be,Ce;for(_e=0,se=0;_e<Q.length;_e++)ue=Q[_e],K.hasOwnProperty(ue)?se++:(Y.push({command:ct.removeLayer,args:[ue]}),ce.splice(ce.indexOf(ue,se),1));for(_e=0,se=0;_e<te.length;_e++)ue=te[te.length-1-_e],ce[ce.length-1-_e]!==ue&&(ee.hasOwnProperty(ue)?(Y.push({command:ct.removeLayer,args:[ue]}),ce.splice(ce.lastIndexOf(ue,ce.length-se),1)):se++,be=ce[ce.length-_e],Y.push({command:ct.addLayer,args:[K[ue],be]}),ce.splice(ce.length-_e,0,ue),ge[ue]=!0);for(_e=0;_e<te.length;_e++)if(ue=te[_e],ve=ee[ue],Me=K[ue],!ge[ue]&&!M(ve,Me))if(M(ve.source,Me.source)&&M(ve["source-layer"],Me["source-layer"])&&M(ve.type,Me.type)){for(Ce in Se(ve.layout,Me.layout,Y,ue,null,ct.setLayoutProperty),Se(ve.paint,Me.paint,Y,ue,null,ct.setPaintProperty),M(ve.slot,Me.slot)||Y.push({command:ct.setSlot,args:[ue,Me.slot]}),M(ve.filter,Me.filter)||Y.push({command:ct.setFilter,args:[ue,Me.filter]}),M(ve.minzoom,Me.minzoom)&&M(ve.maxzoom,Me.maxzoom)||Y.push({command:ct.setLayerZoomRange,args:[ue,Me.minzoom,Me.maxzoom]}),ve)ve.hasOwnProperty(Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&Ce!=="slot"&&(Ce.indexOf("paint.")===0?Se(ve[Ce],Me[Ce],Y,ue,Ce.slice(6),ct.setPaintProperty):M(ve[Ce],Me[Ce])||Y.push({command:ct.setLayerProperty,args:[ue,Ce,Me[Ce]]}));for(Ce in Me)Me.hasOwnProperty(Ce)&&!ve.hasOwnProperty(Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&Ce!=="slot"&&(Ce.indexOf("paint.")===0?Se(ve[Ce],Me[Ce],Y,ue,Ce.slice(6),ct.setPaintProperty):M(ve[Ce],Me[Ce])||Y.push({command:ct.setLayerProperty,args:[ue,Ce,Me[Ce]]}))}else Y.push({command:ct.removeLayer,args:[ue]}),be=ce[ce.lastIndexOf(ue)+1],Y.push({command:ct.addLayer,args:[Me,be]})}(B,S.layers,A)}catch(P){console.warn("Unable to compute style diff:",P),A=[{command:ct.setStyle,args:[S]}]}return A}(this.serialize(),l).filter(w=>!(w.command in Rm));if(f.length===0)return!1;const v=f.filter(w=>!(w.command in Om));if(v.length>0)throw new Error(`Unimplemented: ${v.map(w=>w.command).join(", ")}.`);return f.forEach(w=>{this[w.command].apply(this,w.args)}),this.stylesheet=l,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(l,f){return this.getImage(l)?this.fire(new s.a7(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,this.scope,f),this._afterImageUpdated(l),this)}updateImage(l,f){this.imageManager.updateImage(l,this.scope,f)}getImage(l){return this.imageManager.getImage(l,this.scope)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l,this.scope),this._afterImageUpdated(l),this):this.fire(new s.a7(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(l),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new s.a8("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(l,f,v={}){return this._checkLoaded(),this._validate(s.cr,`models.${l}`,f,null,v)||(this.modelManager.addModel(l,f,this.scope),this._changes.setDirty()),this}hasModel(l){return this.modelManager.hasModel(l,this.scope)}removeModel(l){return this.hasModel(l)?(this.modelManager.removeModel(l,this.scope),this):this.fire(new s.a7(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(l,f,v={}){if(this._checkLoaded(),this.getOwnSource(l)!==void 0)throw new Error(`There is already a source with ID "${l}".`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(s.cs,`sources.${l}`,f,null,v))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const w=ss(l,f,this.dispatcher,this);w.scope=this.scope,w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(w.id),source:w.serialize(),sourceId:w.id}));const S=A=>{const P=(A?"symbol:":"other:")+w.id,R=s.aE(P,this.scope),B=this._sourceCaches[P]=new s.bq(R,w,A);(A?this._symbolSourceCaches:this._otherSourceCaches)[w.id]=B,B.onAdd(this.map)};S(!1),f.type!=="vector"&&f.type!=="geojson"||S(!0),w.onAdd&&w.onAdd(this.map),v.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(l){this._checkLoaded();const f=this.getOwnSource(l);if(!f)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===l)return this.fire(new s.a7(new Error(`Source "${l}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===l)return this.fire(new s.a7(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));const v=this.getOwnSourceCaches(l);for(const w of v){const S=s.cq(w.id);delete this._sourceCaches[S],this._changes.discardSourceCacheUpdate(w.id),w.fire(new s.a8("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles()}return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],this.mergeSources(),f.setEventedParent(null),f.onRemove&&f.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(l,f){this._checkLoaded(),this.getOwnSource(l).setData(f),this._changes.setDirty()}getOwnSource(l){const f=this.getOwnSourceCache(l);return f&&f.getSource()}getOwnSources(){const l=[];for(const f in this._otherSourceCaches){const v=this.getOwnSourceCache(f);v&&l.push(v.getSource())}return l}areTilesLoaded(){const l=this._mergedSourceCaches;for(const f in l){const v=l[f]._tiles;for(const w in v){const S=v[w];if(S.state!=="loaded"&&S.state!=="errored")return!1}}return!0}setLights(l){if(this._checkLoaded(),!l)return delete this.ambientLight,void delete this.directionalLight;const f=this._getTransitionParameters();for(const w of l){if(this._validate(s.ct,"lights",w))return;switch(w.type){case"ambient":if(this.ambientLight){const S=this.ambientLight;S.set(w),S.updateTransitions(f)}else this.ambientLight=new Ta(w,lr,this.scope,this.options);break;case"directional":if(this.directionalLight){const S=this.directionalLight;S.set(w),S.updateTransitions(f)}else this.directionalLight=new Ta(w,yu,this.scope,this.options)}}const v=new s.al(this.z||0,f);this.ambientLight&&this.ambientLight.recalculate(v),this.directionalLight&&this.directionalLight.recalculate(v),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const l=this.directionalLight,f=this.ambientLight;if(!l||!f)return;const v=H=>.2126*(H[0]<=.03928?H[0]/12.92:Math.pow((H[0]+.055)/1.055,2.4))+.7152*(H[1]<=.03928?H[1]/12.92:Math.pow((H[1]+.055)/1.055,2.4))+.0722*(H[2]<=.03928?H[2]/12.92:Math.pow((H[2]+.055)/1.055,2.4)),w=l.properties.get("color").toArray01(),S=l.properties.get("intensity"),A=l.properties.get("direction"),P=1-s.b3(A.x,A.y,A.z)[2]/90,R=v(w)*S*P,B=f.properties.get("color").toArray01(),U=f.properties.get("intensity");return(R+v(B)*U)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const l=[];return this.directionalLight&&l.push(this.directionalLight.get()),this.ambientLight&&l.push(this.ambientLight.get()),l}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(l){if(!l)return this;if(s.cu(l)){const f=s.cv(l),v=this.fragments.find(({id:S})=>S===f);if(!v)throw new Error(`Style import not found: ${l}`);const w=s.cq(l);return v.style.getFragmentStyle(w)}{const f=this.fragments.find(({id:v})=>v===l);if(!f)throw new Error(`Style import not found: ${l}`);return f.style}}getConfigProperty(l,f){const v=this.getFragmentStyle(l);if(!v)return null;const w=s.aE(f,v.scope),S=v.options.get(w),A=S?S.value||S.default:null;return A?A.serialize():null}setConfigProperty(l,f,v){const w=s.cw(v);if(w.result!=="success")return void Xl(this,w.value);const S=w.value.expression,A=this.getFragmentStyle(l);if(!A)return;const P=s.aE(f,A.scope),R=A.options.get(P);R&&(this.options.set(P,{...R,value:S}),this.updateConfigDependencies())}setConfig(l,f){if(this._config=l,l||f)if(f)for(const v in f){let w,S;const A=s.cw(f[v].default);if(A.result==="success"&&(w=A.value.expression),l&&l[v]!==void 0){const Z=s.cw(l[v]);Z.result==="success"&&(S=Z.value.expression)}const{minValue:P,maxValue:R,stepValue:B,type:U,values:H}=f[v];if(w){const Z=s.aE(v,this.scope);this.options.set(Z,{default:w,value:S,minValue:P,maxValue:R,stepValue:B,type:U,values:H})}else this.fire(new s.a7(new Error(`No schema defined for config option "${v}".`)))}else this.fire(new s.a7(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const l of this._configDependentLayers){const f=this.getLayer(l);f&&(f.possiblyEvaluateVisibility(),this._updateLayer(f))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this._changes.setDirty()}addLayer(l,f,v={}){this._checkLoaded();const w=l.id;if(this._layers[w])return void this.fire(new s.a7(new Error(`Layer with id "${w}" already exists on this map`)));let S;if(l.type==="custom"){if(Xl(this,s.cx(l)))return;S=s.cp(l,this.scope,this.options)}else{if(typeof l.source=="object"&&(this.addSource(w,l.source),l=s.co(l),l=s.ak(l,{source:w})),this._validate(s.cy,`layers.${w}`,l,{arrayIndex:-1},v))return;S=s.cp(l,this.scope,this.options),this._validateLayer(S),S.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[S.id]=S.serialize()}S.isConfigDependent&&this._configDependentLayers.add(S.fqid);let A=this._order.length;if(f){const U=this._order.indexOf(f);if(U===-1)return void this.fire(new s.a7(new Error(`Layer with id "${f}" does not exist on this map.`)));S.slot===this._layers[f].slot?A=U:s.X(`Layer with id "${f}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(A,0,w),this._layerOrderChanged=!0,this._layers[w]=S;const P=this.getOwnLayerSourceCache(S),R=!!this.directionalLight&&this.directionalLight.shadowsEnabled();P&&S.canCastShadows()&&R&&(P.castsShadows=!0);const B=this._changes.getRemovedLayer(S);if(B&&S.source&&P&&S.type!=="custom"){this._changes.discardLayerRemoval(S);const U=s.aE(S.source,S.scope);B.type!==S.type?this._changes.updateSourceCache(U,"clear"):(this._changes.updateSourceCache(U,"reload"),P.pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map),S.scope=this.scope,this.mergeLayers()}moveLayer(l,f){this._checkLoaded();const v=this._checkLayer(l);if(!v||l===f)return;const w=this._order.indexOf(l);this._order.splice(w,1);let S=this._order.length;if(f){const A=this._order.indexOf(f);if(A===-1)return void this.fire(new s.a7(new Error(`Layer with id "${f}" does not exist on this map.`)));v.slot===this._layers[f].slot?S=A:s.X(`Layer with id "${f}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,l),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(l){this._checkLoaded();const f=this._checkLayer(l);if(!f)return;f.setEventedParent(null);const v=this._order.indexOf(l);this._order.splice(v,1),delete this._layers[l],delete this._serializedLayers[l],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(f.fqid),this._changes.removeLayer(f);const w=this.getOwnLayerSourceCache(f);if(w&&w.castsShadows){let S=!1;for(const A in this._layers)if(this._layers[A].source===f.source&&this._layers[A].canCastShadows()){S=!0;break}w.castsShadows=S}f.onRemove&&f.onRemove(this.map),this.mergeLayers()}getOwnLayer(l){return this._layers[l]}hasLayer(l){return l in this._mergedLayers}hasLayerType(l){for(const f in this._layers)if(this._layers[f].type===l)return!0;return!1}setLayerZoomRange(l,f,v){this._checkLoaded();const w=this._checkLayer(l);w&&(w.minzoom===f&&w.maxzoom===v||(f!=null&&(w.minzoom=f),v!=null&&(w.maxzoom=v),this._updateLayer(w)))}setSlot(l,f){this._checkLoaded();const v=this._checkLayer(l);v&&v.slot!==f&&(v.slot=f,this._updateLayer(v))}setFilter(l,f,v={}){this._checkLoaded();const w=this._checkLayer(l);if(w&&!M(w.filter,f))return f==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(s.cz,`layers.${w.id}.filter`,f,{layerType:w.type},v)||(w.filter=s.co(f),this._updateLayer(w)))}getFilter(l){const f=this._checkLayer(l);if(f)return s.co(f.filter)}setLayoutProperty(l,f,v,w={}){this._checkLoaded();const S=this._checkLayer(l);S&&(M(S.getLayoutProperty(f),v)||(S.setLayoutProperty(f,v,w),S.isConfigDependent&&this._configDependentLayers.add(S.fqid),this._updateLayer(S)))}getLayoutProperty(l,f){const v=this._checkLayer(l);if(v)return v.getLayoutProperty(f)}setPaintProperty(l,f,v,w={}){this._checkLoaded();const S=this._checkLayer(l);if(!S||M(S.getPaintProperty(f),v))return;const A=S.setPaintProperty(f,v,w);S.isConfigDependent&&this._configDependentLayers.add(S.fqid),A&&this._updateLayer(S),this._changes.updatePaintProperties(S)}getPaintProperty(l,f){const v=this._checkLayer(l);if(v)return v.getPaintProperty(f)}setFeatureState(l,f){this._checkLoaded();const v=l.source,w=l.sourceLayer,S=this._checkSource(v);if(!S)return;const A=S.type;if(A==="geojson"&&w)return void this.fire(new s.a7(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(A==="vector"&&!w)return void this.fire(new s.a7(new Error("The sourceLayer parameter must be provided for vector source types.")));l.id===void 0&&this.fire(new s.a7(new Error("The feature id parameter must be provided.")));const P=this.getOwnSourceCaches(v);for(const R of P)R.setFeatureState(w,l.id,f)}removeFeatureState(l,f){this._checkLoaded();const v=l.source,w=this._checkSource(v);if(!w)return;const S=w.type,A=S==="vector"?l.sourceLayer:void 0;if(S==="vector"&&!A)return void this.fire(new s.a7(new Error("The sourceLayer parameter must be provided for vector source types.")));if(f&&typeof l.id!="string"&&typeof l.id!="number")return void this.fire(new s.a7(new Error("A feature id is required to remove its specific state property.")));const P=this.getOwnSourceCaches(v);for(const R of P)R.removeFeatureState(A,l.id,f)}getFeatureState(l){this._checkLoaded();const f=l.source,v=l.sourceLayer,w=this._checkSource(f);if(w){if(w.type!=="vector"||v)return l.id===void 0&&this.fire(new s.a7(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(f)[0].getFeatureState(v,l.id);this.fire(new s.a7(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(l){return this.stylesheet.transition=s.ak({},this.stylesheet.transition,l),this.transition=this.stylesheet.transition,this}getTransition(){return s.ak({},this.stylesheet.transition)}serialize(){this._checkLoaded();const l=this.getTerrain(),f=l&&this.terrain&&this.terrain.scope===this.scope?l:this.stylesheet.terrain;return s.cA({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:f,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},v=>v!==void 0)}_updateLayer(l){this._changes.updateLayer(l);const f=this.getLayerSourceCache(l),v=s.aE(l.source,l.scope),w=this._changes.getUpdatedSourceCaches();l.source&&!w[v]&&f&&f.getSource().type!=="raster"&&(this._changes.updateSourceCache(v,"reload"),f.pause()),l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const f=P=>this._mergedLayers[P].type==="fill-extrusion",v=this.order,w={},S=[];for(let P=v.length-1;P>=0;P--){const R=v[P];if(f(R)){w[R]=P;for(const B of l){const U=B[R];if(U)for(const H of U)S.push(H)}}}S.sort((P,R)=>R.intersectionZ-P.intersectionZ);const A=[];for(let P=v.length-1;P>=0;P--){const R=v[P];if(f(R))for(let B=S.length-1;B>=0;B--){const U=S[B].feature;if(w[U.layer.id]<P)break;A.push(U),S.pop()}else for(const B of l){const U=B[R];if(U)for(const H of U)A.push(H.feature)}}return A}queryRenderedFeatures(l,f,v){f&&f.filter&&this._validate(s.cz,"queryRenderedFeatures.filter",f.filter,null,f),f.scope=this.scope,f.availableImages=this._availableImages,f.serializedLayers=this._serializedLayers;const w={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new s.a7(new Error("parameters.layers must be an Array."))),[];for(const B of f.layers){const U=this._mergedLayers[B];if(!U)return this.fire(new s.a7(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];w[U.source]=!0}}const S=[],A=f.serializedLayers||{},P=f&&f.layers?f.layers.some(B=>{const U=this.getLayer(B);return U&&U.is3D()}):this.has3DLayers(),R=ro.createFromScreenPoints(l,v);for(const B in this._mergedSourceCaches){const U=this._mergedSourceCaches[B].getSource();if(!U||U.scope!==f.scope)continue;const H=this._mergedSourceCaches[B].getSource().id;f.layers&&!w[H]||S.push(as(this._mergedSourceCaches[B],this._mergedLayers,A,R,f,v,P,!!this.map._showQueryGeometry))}return this.placement&&S.push(function(B,U,H,Z,Y,Q,te){const ee={},K=Q.queryRenderedSymbols(Z),ce=[];for(const ge of Object.keys(K).map(Number))ce.push(te[ge]);ce.sort(Vo);for(const ge of ce){const _e=ge.featureIndex.lookupSymbolFeatures(K[ge.bucketInstanceId],U,ge.bucketIndex,ge.sourceLayerIndex,Y.filter,Y.layers,Y.availableImages,B);for(const se in _e){const ue=ee[se]=ee[se]||[],ve=_e[se];ve.sort((Me,be)=>{const Ce=ge.featureSortOrder;if(Ce){const $e=Ce.indexOf(Me.featureIndex);return Ce.indexOf(be.featureIndex)-$e}return be.featureIndex-Me.featureIndex});for(const Me of ve)ue.push(Me)}}for(const ge in ee)ee[ge].forEach(_e=>{const se=_e.feature,ue=H(B[ge]);if(!ue)return;const ve=ue.getFeatureState(se.layer["source-layer"],se.id);se.source=se.layer.source,se.layer["source-layer"]&&(se.sourceLayer=se.layer["source-layer"]),se.state=ve});return ee}(this._mergedLayers,A,this.getLayerSourceCache.bind(this),R.screenGeometry,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(l,f){f&&f.filter&&this._validate(s.cz,"querySourceFeatures.filter",f.filter,null,f);const v=this.getOwnSourceCaches(l);let w=[];for(const S of v)w=w.concat(zh(S,f));return w}addSourceType(l,f,v){return Es.getSourceType(l)?v(new Error(`A source type called "${l}" already exists.`)):(Es.setSourceType(l,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:f.workerSourceURL},v):v(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(l,f,v={}){this._checkLoaded();const w=this.light.getLight();let S=!1;for(const P in l)if(!M(l[P],w[P])){S=!0;break}if(!S)return;const A=this._getTransitionParameters();this.light.setLight(l,f,v),this.light.updateTransitions(A)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(l,f=1){if(this._checkLoaded(),!l)return delete this.terrain,l===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let v=l;const w=l.source==null;if(f===1){if(typeof v.source=="object"){const P="terrain-dem-src";this.addSource(P,v.source),v=s.co(v),v=s.ak(v,{source:P})}const S=s.ak({},v),A={};if(this.terrain&&w){S.source=this.terrain.get().source;const P=this.terrain?this.getFragmentStyle(this.terrain.scope):null;P&&(A.style=P.serialize())}if(this._validate(s.cB,"terrain",S,A))return}if(!this.terrain||this.terrain.scope!==this.scope&&!w||this.terrain&&f!==this.terrain.drapeRenderMode){if(!v)return;this._createTerrain(v,f),this.fire(new s.a8("data",{dataType:"style"}))}else{const S=this.terrain,A=S.get();for(const P of Object.keys(s.ae.terrain))!v.hasOwnProperty(P)&&s.ae.terrain[P].default&&(v[P]=s.ae.terrain[P].default);for(const P in l)if(!M(l[P],A[P])){S.set(l,this.options),this.stylesheet.terrain=l;const R=this._getTransitionParameters({duration:0});S.updateTransitions(R),this.fire(new s.a8("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const f=this.fog=new Dl(l,this.map.transform);this.stylesheet.fog=f.get();const v=this._getTransitionParameters({duration:0});f.updateTransitions(v)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const f=this.fog;if(!M(f.get(),l)){f.set(l),this.stylesheet.fog=f.get();const v=this._getTransitionParameters({duration:0});f.updateTransitions(v)}}else this._createFog(l);this._markersNeedUpdate=!0}_getTransitionParameters(l){return{now:s.a4.now(),transition:s.ak(this.transition,l)}}updateDrapeFirstLayers(){if(!this.terrain)return;const l=[],f=[];for(const v in this._mergedLayers)this.isLayerDraped(this._mergedLayers[v])?l.push(v):f.push(v);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...f)}_createTerrain(l,f){const v=this.terrain=new ir(l,f,this.scope,this.options);f===1&&(this.stylesheet.terrain=l),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const w=this._getTransitionParameters({duration:0});v.updateTransitions(w)}_force3DLayerUpdate(){for(const l in this._layers){const f=this._layers[l];f.type==="fill-extrusion"&&this._updateLayer(f)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const f=this._layers[l];f.type==="symbol"&&this._updateLayer(f)}}_validate(l,f,v,w,S={}){if(S&&S.validate===!1)return!1;const A=s.ak({},this.serialize());return Xl(this,l.call(s.aj,s.ak({key:f,style:A,value:v,styleSpec:s.ae},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.cC.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._mergedLayers)this._mergedLayers[l].setEventedParent(null);for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles(),this._mergedSourceCaches[l].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(l){const f=this.getSourceCaches(l);for(const v of f)v.clearTiles()}clearSources(){for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles()}reloadSource(l){const f=this.getSourceCaches(l);for(const v of f)v.resume(),v.reload()}reloadSources(){for(const l of this.getSources())l.reload&&l.reload()}updateSources(l){let f;this.directionalLight&&(f=gd(this.directionalLight));for(const v in this._mergedSourceCaches)this._mergedSourceCaches[v].update(l,void 0,void 0,f)}_generateCollisionBoxes(){for(const l in this._sourceCaches){const f=this._sourceCaches[l];f.resume(),f.reload()}}_updatePlacement(l,f,v,w,S=!1){let A=!1,P=!1;const R={},B={};for(const U of this._mergedOrder){const H=this._mergedLayers[U];if(H.type!=="symbol")continue;const Z=s.aE(H.source,H.scope);let Y=R[Z];if(!Y){const te=this.getLayerSourceCache(H);if(!te)continue;const ee=te.getRenderableIds(!0).map(K=>te.getTileByID(K));B[Z]=ee.slice(),Y=R[Z]=ee.sort((K,ce)=>ce.tileID.overscaledZ-K.tileID.overscaledZ||(K.tileID.isLessThan(ce.tileID)?-1:1))}const Q=this.crossTileSymbolIndex.addLayer(H,Y,l.center.lng,l.projection);A=A||Q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),S=S||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new s.a8("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.a4.now(),l.zoom))&&(this.pauseablePlacement=new wu(l,this._mergedOrder,S,f,v,w,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,R,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.a4.now()),P=!0),A&&this.pauseablePlacement.placement.setStale()),P||A)for(const U of this._mergedOrder){const H=this._mergedLayers[U];H.type==="symbol"&&this.placement.updateLayerOpacities(H,R[s.aE(H.source,H.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.a4.now())}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}addImport(l){this._checkLoaded();const f=this.stylesheet.imports=this.stylesheet.imports||[];return f.findIndex(({id:v})=>v===l.id)!==-1?this.fire(new s.a7(new Error(`Import with id '${l.id}' already exists in the map's style.`))):(f.push(l),this._loadImports([l],!0),this)}setImportUrl(l,f){this._checkLoaded();const v=this.stylesheet.imports||[],w=this.getImportIndex(l);if(w===-1)return this;v[w].url=f;const S=this.fragments[w];return S.style=this._createFragmentStyle(v[w]),S.style.on("style.import.load",()=>this.mergeAll()),S.style.loadURL(f),this}setImportData(l,f){this._checkLoaded();const v=this.getImportIndex(l),w=this.stylesheet.imports||[];return v===-1?this:f?(this.fragments[v].style.setState(f),this._reloadImports(),this):(delete w[v].data,this.setImportUrl(l,w[v].url))}setImportConfig(l,f){this._checkLoaded();const v=this.getImportIndex(l),w=this.stylesheet.imports||[];if(v===-1)return this;f?w[v].config=f:delete w[v].config;const S=this.fragments[v],A=S.style.stylesheet&&S.style.stylesheet.schema;return S.config=f,S.style.setConfig(f,A),this.updateConfigDependencies(),this}removeImport(l){this._checkLoaded();const f=this.stylesheet.imports||[],v=this.getImportIndex(l);return v===-1||(f.splice(v,1),this.fragments[v].style._remove(),this.fragments.splice(v,1),this._reloadImports()),this}getImportIndex(l){const f=(this.stylesheet.imports||[]).findIndex(v=>v.id===l);return f===-1&&this.fire(new s.a7(new Error(`Import '${l}' does not exist in the map's style and cannot be updated.`))),f}getLayer(l){return this._mergedLayers[l]}getSources(){const l=[];for(const f in this._mergedOtherSourceCaches){const v=this._mergedOtherSourceCaches[f];v&&l.push(v.getSource())}return l}getSource(l,f){const v=this.getSourceCache(l,f);return v&&v.getSource()}getLayerSource(l){const f=this.getLayerSourceCache(l);return f&&f.getSource()}getSourceCache(l,f){const v=s.aE(l,f);return this._mergedOtherSourceCaches[v]}getLayerSourceCache(l){const f=s.aE(l.source,l.scope);return l.type==="symbol"?this._mergedSymbolSourceCaches[f]:this._mergedOtherSourceCaches[f]}getSourceCaches(l){const f=[];return this._mergedOtherSourceCaches[l]&&f.push(this._mergedOtherSourceCaches[l]),this._mergedSymbolSourceCaches[l]&&f.push(this._mergedSymbolSourceCaches[l]),f}updateSourceCaches(){const l=this._changes.getUpdatedSourceCaches();for(const f in l){const v=l[f];v==="reload"?this.reloadSource(f):v==="clear"&&this.clearSource(f)}}updateLayers(l){const f=this._changes.getUpdatedPaintProperties();for(const v of f){const w=this.getLayer(v);w&&w.updateTransitions(l)}}getImages(l,f,v){this.imageManager.getImages(f.icons,f.scope,v),this._updateTilesForChangedImages();const w=S=>{S&&S.setDependencies(f.tileID.key,f.type,f.icons)};w(this._otherSourceCaches[f.source]),w(this._symbolSourceCaches[f.source])}getGlyphs(l,f,v){this.glyphManager.getGlyphs(f.stacks,f.scope,v)}getResource(l,f,v){return s.cD(f,v)}getOwnSourceCache(l){return this._otherSourceCaches[l]}getOwnLayerSourceCache(l){return l.type==="symbol"?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}getOwnSourceCaches(l){const f=[];return this._otherSourceCaches[l]&&f.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&f.push(this._symbolSourceCaches[l]),f}_isSourceCacheLoaded(l){const f=this.getOwnSourceCaches(l);return f.length===0?(this.fire(new s.a7(new Error(`There is no source with ID '${l}'`))),!1):f.every(v=>v.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function sl(_,l){let f=!1,v=null;const w=()=>{v=null,f&&(_(),v=setTimeout(w,l),f=!1)};return()=>(f=!0,v||w(),v)}Es.getSourceType=function(_){return vs[_]},Es.setSourceType=function(_,l){vs[_]=l},Es.registerForPluginStateChange=s.ci;class zm{constructor(l){this._hashName=l&&encodeURIComponent(l),s.aR(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=sl(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const l=this._map;if(!l)return"";const f=al(l);if(this._hashName){const v=this._hashName;let w=!1;const S=location.hash.slice(1).split("&").map(A=>{const P=A.split("=")[0];return P===v?(w=!0,`${P}=${f}`):A}).filter(A=>A);return w||S.push(`${v}=${f}`),`#${S.join("&")}`}return`#${f}`}_getCurrentHash(){const l=location.hash.replace("#","");if(this._hashName){let f;return l.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(f=v)}),(f&&f[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._map;if(!l)return!1;const f=this._getCurrentHash();if(f.length>=3&&!f.some(v=>isNaN(v))){const v=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(f[3]||0):l.getBearing();return l.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:v,pitch:+(f[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function al(_,l){const f=_.getCenter(),v=Math.round(100*_.getZoom())/100,w=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,w),A=Math.round(f.lng*S)/S,P=Math.round(f.lat*S)/S,R=_.getBearing(),B=_.getPitch();let U=l?`/${A}/${P}/${v}`:`${v}/${P}/${A}`;return(R||B)&&(U+="/"+Math.round(10*R)/10),B&&(U+=`/${Math.round(B)}`),U}const Uu={linearity:.3,easing:s.cE(0,0,.3,1)},yd=s.ak({deceleration:2500,maxSpeed:1400},Uu),vd=s.ak({deceleration:20,maxSpeed:1400},Uu),jh=s.ak({deceleration:1e3,maxSpeed:360},Uu),l0=s.ak({deceleration:1e3,maxSpeed:90},Uu);class Fm{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.a4.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,f=s.a4.now();for(;l.length>0&&f-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const f={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)f.zoom+=S.zoomDelta||0,f.bearing+=S.bearingDelta||0,f.pitch+=S.pitchDelta||0,S.panDelta&&f.pan._add(S.panDelta),S.around&&(f.around=S.around),S.pinchAround&&(f.pinchAround=S.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(f.pan.mag()){const S=Gh(f.pan.mag(),v,s.ak({},yd,l||{}));w.offset=f.pan.mult(S.amount/f.pan.mag()),w.center=this._map.transform.center,ll(w,S)}if(f.zoom){const S=Gh(f.zoom,v,vd);w.zoom=this._map.transform.zoom+S.amount,ll(w,S)}if(f.bearing){const S=Gh(f.bearing,v,jh);w.bearing=this._map.transform.bearing+s.c(S.amount,-179,179),ll(w,S)}if(f.pitch){const S=Gh(f.pitch,v,l0);w.pitch=this._map.transform.pitch+S.amount,ll(w,S)}if(w.zoom||w.bearing){const S=f.pinchAround===void 0?f.around:f.pinchAround;w.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function ll(_,l){(!_.duration||_.duration<l.duration)&&(_.duration=l.duration,_.easing=l.easing)}function Gh(_,l,f){const{maxSpeed:v,linearity:w,deceleration:S}=f,A=s.c(_*w/(l/1e3),-v,v),P=Math.abs(A)/(S*w);return{easing:f.easing,duration:1e3*P,amount:A*(P/2)}}class gs extends s.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,v,w={}){const S=Ae(f.getCanvasContainer(),v),A=f.unproject(S);super(l,s.ak({point:S,lngLat:A,originalEvent:v},w)),this._defaultPrevented=!1,this.target=f}}class ju extends s.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,v){const w=l==="touchend"?v.changedTouches:v.touches,S=tt(f.getCanvasContainer(),w),A=S.map(R=>f.unproject(R)),P=S.reduce((R,B,U,H)=>R.add(B.div(H.length)),new s.P(0,0));super(l,{points:S,point:P,lngLats:A,lngLat:f.unproject(P),originalEvent:v}),this._defaultPrevented=!1}}class c0 extends s.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,v){super(l,{originalEvent:v}),this._defaultPrevented=!1}}class xd{constructor(l,f){this._map=l,this._clickTolerance=f.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new c0(l.type,this._map,l))}mousedown(l,f){return this._mousedownPos=f,this._firePreventable(new gs(l.type,this._map,l))}mouseup(l){this._map.fire(new gs(l.type,this._map,l))}preclick(l){const f=s.ak({},l);f.type="preclick",this._map.fire(new gs(f.type,this._map,f))}click(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||(this.preclick(l),this._map.fire(new gs(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new gs(l.type,this._map,l))}mouseover(l){this._map.fire(new gs(l.type,this._map,l))}mouseout(l){this._map.fire(new gs(l.type,this._map,l))}touchstart(l){return this._firePreventable(new ju(l.type,this._map,l))}touchmove(l){this._map.fire(new ju(l.type,this._map,l))}touchend(l){this._map.fire(new ju(l.type,this._map,l))}touchcancel(l){this._map.fire(new ju(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hh{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new gs(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new gs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new gs(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Gu{constructor(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(ne(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(l,f){if(!this._active)return;const v=f,w=this._startPos,S=this._lastPos;if(!w||!S||S.equals(v)||!this._box&&v.dist(w)<this._clickTolerance)return;this._lastPos=v,this._box||(this._box=V("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const A=Math.min(w.x,v.x),P=Math.max(w.x,v.x),R=Math.min(w.y,v.y),B=Math.max(w.y,v.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${A}px,${R}px)`,this._box.style.width=P-A+"px",this._box.style.height=B-R+"px")})}mouseupWindow(l,f){if(!this._active)return;const v=this._startPos,w=f;if(v&&l.button===0){if(this.reset(),ke(),v.x!==w.x||v.y!==w.y)return this._map.fire(new s.a8("boxzoomend",{originalEvent:l})),{cameraAnimation:S=>S.fitScreenCoordinates(v,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ye(),delete this._startPos,delete this._lastPos}_fireEvent(l,f){return this._map.fire(new s.a8(l,{originalEvent:f}))}}function Hu(_,l){const f={};for(let v=0;v<_.length;v++)f[_[v].identifier]=l[v];return f}class Wu{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,f,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=l.timeStamp),v.length===this.numTouches&&(this.centroid=function(w){const S=new s.P(0,0);for(const A of w)S._add(A);return S.div(w.length)}(f),this.touches=Hu(v,f)))}touchmove(l,f,v){if(this.aborted||!this.centroid)return;const w=Hu(v,f);for(const S in this.touches){const A=w[S];(!A||A.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(l,f,v){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),v.length===0){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class qu{constructor(l){this.singleTap=new Wu(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,f,v){this.singleTap.touchstart(l,f,v)}touchmove(l,f,v){this.singleTap.touchmove(l,f,v)}touchend(l,f,v){const w=this.singleTap.touchend(l,f,v);if(w){const S=l.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(w)<30;if(S&&A||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class Wh{constructor(){this._zoomIn=new qu({numTouches:1,numTaps:2}),this._zoomOut=new qu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,f,v){this._zoomIn.touchstart(l,f,v),this._zoomOut.touchstart(l,f,v)}touchmove(l,f,v){this._zoomIn.touchmove(l,f,v),this._zoomOut.touchmove(l,f,v)}touchend(l,f,v){const w=this._zoomIn.touchend(l,f,v),S=this._zoomOut.touchend(l,f,v);return w?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()+1,around:A.unproject(w)},{originalEvent:l})}):S?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()-1,around:A.unproject(S)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const qh={0:1,2:2};class Xo{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,f){return!1}_move(l,f){return{}}mousedown(l,f){if(this._lastPoint)return;const v=pt(l);this._correctButton(l,v)&&(this._lastPoint=f,this._eventButton=v)}mousemoveWindow(l,f){const v=this._lastPoint;if(v){if(l.preventDefault(),this._eventButton!=null&&function(w,S){const A=qh[S];return w.buttons===void 0||(w.buttons&A)!==A}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(v,f)}}mouseupWindow(l){this._lastPoint&&pt(l)===this._eventButton&&(this._moved&&ke(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bm extends Xo{mousedown(l,f){super.mousedown(l,f),this._lastPoint&&(this._active=!0)}_correctButton(l,f){return f===0&&!l.ctrlKey}_move(l,f){return{around:f,panDelta:f.sub(l)}}}class bd extends Xo{_correctButton(l,f){return f===0&&l.ctrlKey||f===2}_move(l,f){const v=.8*(f.x-l.x);if(v)return this._active=!0,{bearingDelta:v}}contextmenu(l){l.preventDefault()}}class wd extends Xo{_correctButton(l,f){return f===0&&l.ctrlKey||f===2}_move(l,f){const v=-.5*(f.y-l.y);if(v)return this._active=!0,{pitchDelta:v}}contextmenu(l){l.preventDefault()}}class Yl{constructor(l,f){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset(),s.aR(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(l,f,v){return this._calculateTransform(l,f,v)}touchmove(l,f,v){if(this._active&&!(v.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(v.length===1&&!s.cF())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,f,v)}}touchend(l,f,v){this._calculateTransform(l,f,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,f,v){v.length>0&&(this._active=!0);const w=Hu(v,f),S=new s.P(0,0),A=new s.P(0,0);let P=0;for(const B in w){const U=w[B],H=this._touches[B];H&&(S._add(U),A._add(U.sub(H)),P++,w[B]=U)}if(this._touches=w,P<this._minTouches||!A.mag())return;const R=A.div(P);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(P),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=V("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Zh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,f,v){return{}}touchstart(l,f,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([f[0],f[1]]))}touchmove(l,f,v){const w=this._firstTwoTouches;if(!w)return;l.preventDefault();const[S,A]=w,P=Jl(v,f,S),R=Jl(v,f,A);if(!P||!R)return;const B=this._aroundCenter?null:P.add(R).div(2);return this._move([P,R],B,l)}touchend(l,f,v){if(!this._firstTwoTouches)return;const[w,S]=this._firstTwoTouches,A=Jl(v,f,w),P=Jl(v,f,S);A&&P||(this._active&&ke(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Jl(_,l,f){for(let v=0;v<_.length;v++)if(_[v].identifier===f)return l[v]}function Xh(_,l){return Math.log(_/l)/Math.LN2}class Yh extends Zh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,f){const v=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Xh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Xh(this._distance,v),pinchAround:f}}}function Td(_,l){return 180*_.angleWith(l)/Math.PI}class Nm extends Zh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,f){const v=this._vector;if(this._vector=l[0].sub(l[1]),v&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Td(this._vector,v),pinchAround:f}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const f=25/(Math.PI*this._minDiameter)*360,v=this._startVector;if(!v)return!1;const w=Td(l,v);return Math.abs(w)<f}}function cl(_){return Math.abs(_.y)>Math.abs(_.x)}class u0 extends Zh{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,cl(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,f,v){const w=this._lastPoints;if(!w)return;const S=l[0].sub(w[0]),A=l[1].sub(w[1]);return this._map._cooperativeGestures&&!s.cF()&&v.touches.length<3||(this._valid=this.gestureBeginsVertically(S,A,v.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(S.y+A.y)/2*-.5})}gestureBeginsVertically(l,f,v){if(this._valid!==void 0)return this._valid;const w=l.mag()>=2,S=f.mag()>=2;if(!w&&!S)return;if(!w||!S)return this._firstMove==null&&(this._firstMove=v),v-this._firstMove<100&&void 0;const A=l.y>0==f.y>0;return cl(l)&&cl(f)&&A}}const h0={panStep:100,bearingStep:15,pitchStep:10};class Vm{constructor(){const l=h0;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let f=0,v=0,w=0,S=0,A=0;switch(l.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:l.shiftKey?v=-1:(l.preventDefault(),S=-1);break;case 39:l.shiftKey?v=1:(l.preventDefault(),S=1);break;case 38:l.shiftKey?w=1:(l.preventDefault(),A=-1);break;case 40:l.shiftKey?w=-1:(l.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(v=0,w=0),{cameraAnimation:P=>{const R=P.getZoom();P.easeTo({duration:300,easeId:"keyboardHandler",easing:Jh,zoom:f?Math.round(R)+f*(l.shiftKey?2:1):R,bearing:P.getBearing()+v*this._bearingStep,pitch:P.getPitch()+w*this._pitchStep,offset:[-S*this._panStep,-A*this._panStep],center:P.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Jh(_){return _*(2-_)}const Kh=4.000244140625;class Um{constructor(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.aR(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||s.cF()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let f=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const v=s.a4.now(),w=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,f!==0&&f%Kh==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(w*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=Ae(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:f,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;this._type==="wheel"&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const f=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(this._delta!==0){const B=this._type==="wheel"&&Math.abs(this._delta)>Kh?this._wheelZoomRate:this._defaultZoomRate;let U=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&U!==0&&(U=1/U);const H=f(),Z=Math.pow(2,H),Y=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):Z;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(Y*U))),this._type==="wheel"&&(this._startZoom=H,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const v=typeof this._targetZoom=="number"?this._targetZoom:f(),w=this._startZoom,S=this._easing;let A,P=!1;if(this._type==="wheel"&&w&&S){const B=Math.min((s.a4.now()-this._lastWheelEventTime)/200,1),U=S(B);A=s.n(w,v,U),B<1?this._frameId||(this._frameId=!0):P=!0}else A=v,P=!0;this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let R=A-f();return R*this._lastDelta<0&&(R=0),{noInertia:!0,needsRenderFrame:!P,zoomDelta:R,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let f=s.cG;if(this._prevEase){const v=this._prevEase,w=(s.a4.now()-v.start)/v.duration,S=v.easing(w+.01)-v.easing(w),A=.27/Math.sqrt(S*S+1e-4)*.01,P=Math.sqrt(.0729-A*A);f=s.cE(A,P,.25,1)}return this._prevEase={start:s.a4.now(),duration:l,easing:f},f}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=V("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class jm{constructor(l,f){this._clickZoom=l,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Qh{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,f){return l.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:v.getZoom()+(l.shiftKey?-1:1),around:v.unproject(f)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sd{constructor(){this._tap=new qu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,f,v){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=f[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(l,f,v))}touchmove(l,f,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const w=f[0],S=w.y-this._swipePoint.y;return this._swipePoint=w,l.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(l,f,v)}touchend(l,f,v){this._tapTime?this._swipePoint&&v.length===0&&this.reset():this._tap.touchend(l,f,v)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gm{constructor(l,f,v){this._el=l,this._mousePan=f,this._touchPan=v}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Hm{constructor(l,f,v){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Wm{constructor(l,f,v,w){this._el=l,this._touchZoom=f,this._touchRotate=v,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Zu=_=>_.zoom||_.drag||_.pitch||_.rotate;class qm extends s.a8{}class Bc{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,f){const v=s.v.sub([],f,l);this.radius=s.v.length(v[2]<0?s.v.div([],v,this.constants):[v[0],v[1],0])}projectRay(l){s.v.div(l,l,this.constants),s.v.normalize(l,l),s.v.mul(l,l,this.constants);const f=s.v.scale([],l,this.radius);if(f[2]>0){const v=s.v.scale([],[0,0,1],s.v.dot(f,[0,0,1])),w=s.v.scale([],s.v.normalize([],[f[0],f[1],0]),this.radius),S=s.v.add([],f,s.v.scale([],s.v.sub([],s.v.add([],w,v),f),2));f[0]=S[0],f[1]=S[1]}return f}}function Xu(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class Zm{constructor(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Fm(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Bc,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(f),s.aR(["handleEvent","handleWindowEvent"],this);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[window,"blur",void 0]];for(const[w,S,A]of this._listeners){const P=w===document?this.handleWindowEvent:this.handleEvent;w.addEventListener(S,P,A)}}destroy(){for(const[l,f,v]of this._listeners){const w=l===document?this.handleWindowEvent:this.handleEvent;l.removeEventListener(f,w,v)}}_addDefaultHandlers(l){const f=this._map,v=f.getCanvasContainer();this._add("mapEvent",new xd(f,l));const w=f.boxZoom=new Gu(f,l);this._add("boxZoom",w);const S=new Wh,A=new Qh;f.doubleClickZoom=new jm(A,S),this._add("tapZoom",S),this._add("clickZoom",A);const P=new Sd;this._add("tapDragZoom",P);const R=f.touchPitch=new u0(f);this._add("touchPitch",R);const B=new bd(l),U=new wd(l);f.dragRotate=new Hm(l,B,U),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",U,["mouseRotate"]);const H=new Bm(l),Z=new Yl(f,l);f.dragPan=new Gm(v,H,Z),this._add("mousePan",H),this._add("touchPan",Z,["touchZoom","touchRotate"]);const Y=new Nm,Q=new Yh;f.touchZoomRotate=new Wm(v,Q,Y,P),this._add("touchRotate",Y,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Hh(f));const te=f.scrollZoom=new Um(f,this);this._add("scrollZoom",te,["mousePan"]);const ee=f.keyboard=new Vm;this._add("keyboard",ee);for(const K of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[K]&&f[K].enable(l[K])}_add(l,f,v){this._handlers.push({handlerName:l,handler:f,allowed:v}),this._handlersById[l]=f}stop(l){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Zu(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,f,v){for(const w in l)if(w!==v&&(!f||f.indexOf(w)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const f=[];for(const v of l)this._el.contains(v.target)&&f.push(v);return f}handleEvent(l,f){this._updatingCamera=!0;const v=l.type==="renderFrame",w=v?void 0:l,S={needsRenderFrame:!1},A={},P={},R=l.touches?this._getMapTouches(l.touches):void 0,B=R?tt(this._el,R):v?void 0:Ae(this._el,l);for(const{handlerName:Z,handler:Y,allowed:Q}of this._handlers){if(!Y.isEnabled())continue;let te;this._blockedByActive(P,Q,Z)?Y.reset():Y[f||l.type]&&(te=Y[f||l.type](l,B,R),this.mergeHandlerResult(S,A,te,Z,w),te&&te.needsRenderFrame&&this._triggerRenderFrame()),(te||Y.isActive())&&(P[Z]=Y)}const U={};for(const Z in this._previousActiveHandlers)P[Z]||(U[Z]=w);this._previousActiveHandlers=P,(Object.keys(U).length||Xu(S))&&(this._changes.push([S,A,U]),this._triggerRenderFrame()),(Object.keys(P).length||Xu(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=S;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))}mergeHandlerResult(l,f,v,w,S){if(!v)return;s.ak(l,v);const A={handlerName:w,originalEvent:v.originalEvent||S};v.zoomDelta!==void 0&&(f.zoom=A),v.panDelta!==void 0&&(f.drag=A),v.pitchDelta!==void 0&&(f.pitch=A),v.bearingDelta!==void 0&&(f.rotate=A)}_applyChanges(){const l={},f={},v={};for(const[w,S,A]of this._changes)w.panDelta&&(l.panDelta=(l.panDelta||new s.P(0,0))._add(w.panDelta)),w.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+w.pitchDelta),w.around!==void 0&&(l.around=w.around),w.aroundCoord!==void 0&&(l.aroundCoord=w.aroundCoord),w.pinchAround!==void 0&&(l.pinchAround=w.pinchAround),w.noInertia&&(l.noInertia=w.noInertia),s.ak(f,S),s.ak(v,A);this._updateMapTransform(l,f,v),this._changes=[]}_updateMapTransform(l,f,v){const w=this._map,S=w.transform,A=ce=>[ce.x,ce.y,ce.z];if((ce=>{const ge=this._eventsInProgress.drag;return ge&&!this._handlersById[ge.handlerName].isActive()})()&&!Xu(l)){const ce=S.zoom;S.cameraElevationReference="sea",this._originalZoom!=null&&S._orthographicProjectionAtLowPitch&&S.projection.name!=="globe"&&S.pitch===0?(S.cameraElevationReference="ground",S.zoom=this._originalZoom):(S.recenterOnTerrain(),S.cameraElevationReference="ground"),ce!==S.zoom&&this._map._update(!0)}if(S._isCameraConstrained&&w._stop(!0),!Xu(l))return void this._fireEvents(f,v,!0);let{panDelta:P,zoomDelta:R,bearingDelta:B,pitchDelta:U,around:H,aroundCoord:Z,pinchAround:Y}=l;S._isCameraConstrained&&(R>0&&(R=0),S._isCameraConstrained=!1),Y!==void 0&&(H=Y),(R||(ce=>f[ce]&&!this._eventsInProgress[ce])("drag"))&&H&&(this._dragOrigin=A(S.pointCoordinate3D(H)),this._originalZoom=S.zoom,this._trackingEllipsoid.setup(S._camera.position,this._dragOrigin)),S.cameraElevationReference="sea",w._stop(!0),H=H||w.transform.centerPoint,B&&(S.bearing+=B),U&&(S.pitch+=U),S._updateCameraState();const Q=[0,0,0];if(P)if(S.projection.name==="mercator"){const ce=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(H).dir),ge=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(H.sub(P)).dir);Q[0]=ge[0]-ce[0],Q[1]=ge[1]-ce[1]}else{const ce=S.pointCoordinate(H);if(S.projection.name==="globe"){P=P.rotate(-S.angle);const ge=S._pixelsPerMercatorPixel/S.worldSize;Q[0]=-P.x*s.cH(s.l(ce.y))*ge,Q[1]=-P.y*s.cH(S.center.lat)*ge}else{const ge=S.pointCoordinate(H.sub(P));ce&&ge&&(Q[0]=ge.x-ce.x,Q[1]=ge.y-ce.y)}}const te=S.zoom,ee=[0,0,0];if(R){const ce=A(Z||S.pointCoordinate3D(H)),ge={dir:s.v.normalize([],s.v.sub([],ce,S._camera.position))};if(ge.dir[2]<0){const _e=S.zoomDeltaToMovement(ce,R);s.v.scale(ee,ge.dir,_e)}}const K=s.v.add(Q,Q,ee);S._translateCameraConstrained(K),R&&Math.abs(S.zoom-te)>1e-4&&S.recenterOnTerrain(),S.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,v,!0)}_fireEvents(l,f,v){const w=Zu(this._eventsInProgress),S=Zu(l),A={};for(const U in l){const{originalEvent:H}=l[U];this._eventsInProgress[U]||(A[`${U}start`]=H),this._eventsInProgress[U]=l[U]}!w&&S&&this._fireEvent("movestart",S.originalEvent);for(const U in A)this._fireEvent(U,A[U]);S&&this._fireEvent("move",S.originalEvent);for(const U in l){const{originalEvent:H}=l[U];this._fireEvent(U,H)}const P={};let R;for(const U in this._eventsInProgress){const{handlerName:H,originalEvent:Z}=this._eventsInProgress[U];this._handlersById[H].isActive()||(delete this._eventsInProgress[U],R=f[H]||Z,P[`${U}end`]=R)}for(const U in P)this._fireEvent(U,P[U]);const B=Zu(this._eventsInProgress);if(v&&(w||S)&&!B){this._updatingCamera=!0;const U=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;U?(H(U.bearing||this._map.getBearing())&&(U.bearing=0),this._map.easeTo(U,{originalEvent:R})):(this._map.fire(new s.a8("moveend",{originalEvent:R})),H(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,f){this._map.fire(new s.a8(l,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new qm("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Xm="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ym extends s.a6{constructor(l,f){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=f.bearingSnap,this._respectPrefersReducedMotion=f.respectPrefersReducedMotion!==!1,s.aR(["_renderFrameCallback"],this)}getCenter(){return new s.L(this.transform.center.lng,this.transform.center.lat)}setCenter(l,f){return this.jumpTo({center:l},f)}panBy(l,f,v){return l=s.P.convert(l).mult(-1),this.panTo(this.transform.center,s.ak({offset:l},f),v)}panTo(l,f,v){return this.easeTo(s.ak({center:l},f),v)}getZoom(){return this.transform.zoom}setZoom(l,f){return this.jumpTo({zoom:l},f),this}zoomTo(l,f,v){return this.easeTo(s.ak({zoom:l},f),v)}zoomIn(l,f){return this.zoomTo(this.getZoom()+1,l,f),this}zoomOut(l,f){return this.zoomTo(this.getZoom()-1,l,f),this}getBearing(){return this.transform.bearing}setBearing(l,f){return this.jumpTo({bearing:l},f),this}getPadding(){return this.transform.padding}setPadding(l,f){return this.jumpTo({padding:l},f),this}rotateTo(l,f,v){return this.easeTo(s.ak({bearing:l},f),v)}resetNorth(l,f){return this.rotateTo(0,s.ak({duration:1e3},l),f),this}resetNorthPitch(l,f){return this.easeTo(s.ak({bearing:0,pitch:0,duration:1e3},l),f),this}snapToNorth(l,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,f):this}getPitch(){return this.transform.pitch}setPitch(l,f){return this.jumpTo({pitch:l},f),this}cameraForBounds(l,f){l=s.D.convert(l);const v=f&&f.bearing||0,w=f&&f.pitch||0,S=l.getNorthWest(),A=l.getSouthEast();return this._cameraForBounds(this.transform,S,A,v,w,f)}_extendCameraOptions(l){const f={top:0,bottom:0,right:0,left:0};if(typeof(l=s.ak({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=="number"){const v=l.padding;l.padding={top:v,bottom:v,right:v,left:v}}return l.padding=s.ak(f,l.padding),l}_minimumAABBFrustumDistance(l,f){const v=f.max[0]-f.min[0],w=f.max[1]-f.min[1];return v/w>l.aspect?v/(2*Math.tan(.5*l.fovX)*l.aspect):w/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,f,v,w,S,A){const P=l.clone(),R=this._extendCameraOptions(A);P.bearing=w,P.pitch=S;const B=s.L.convert(f),U=s.L.convert(v),H=.5*(B.lat+U.lat),Z=.5*(B.lng+U.lng),Y=s.cI(H,Z),Q=s.v.normalize([],Y),te=s.v.normalize([],s.v.cross([],Q,[0,1,0])),ee=s.v.cross([],te,Q),K=[te[0],te[1],te[2],0,ee[0],ee[1],ee[2],0,Q[0],Q[1],Q[2],0,0,0,0,1],ce=[Y,s.cI(B.lat,B.lng),s.cI(U.lat,B.lng),s.cI(U.lat,U.lng),s.cI(B.lat,U.lng),s.cI(H,B.lng),s.cI(H,U.lng),s.cI(B.lat,Z),s.cI(U.lat,Z)];let ge=s.c3.fromPoints(ce.map(ze=>[s.v.dot(te,ze),s.v.dot(ee,ze),s.v.dot(Q,ze)]));const _e=s.v.transformMat4([],ge.center,K);s.v.squaredLength(_e)===0&&s.v.set(_e,0,0,1),s.v.normalize(_e,_e),s.v.scale(_e,_e,s.aC),P.center=s.cJ(_e);const se=P.getWorldToCameraMatrix(),ue=s.m.invert(new Float64Array(16),se);ge=s.c3.applyTransform(ge,s.m.multiply([],se,K)),s.v.transformMat4(_e,_e,se);const ve=.5*(ge.max[2]-ge.min[2]),Me=this._minimumAABBFrustumDistance(P,ge),be=s.v.scale([],[0,0,1],ve),Ce=s.v.add(be,_e,be),$e=Me+(P.pitch===0?0:s.v.distance(_e,Ce)),Ne=P.globeCenterInViewSpace,qe=s.v.sub([],_e,[Ne[0],Ne[1],Ne[2]]);s.v.normalize(qe,qe),s.v.scale(qe,qe,$e);const Le=s.v.add([],_e,qe);s.v.transformMat4(Le,Le,ue);const Ke=s.cL/s.aC,He=s.v.length(Le),nt=s.b(Math.max(He*Ke-s.cL,Number.EPSILON),0),de=Math.min(P.zoomFromMercatorZAdjusted(nt),R.maxZoom);return de>.5*(s.Z+s.G)?(P.setProjection({name:"mercator"}),P.zoom=de,this._cameraForBounds(P,f,v,w,S,A)):{center:P.center,zoom:de,bearing:w,pitch:S}}queryTerrainElevation(l,f){const v=this.transform.elevation;return v?(f=s.ak({},{exaggerated:!0},f),v.getAtPoint(s.M.fromLngLat(l),null,f.exaggerated)):null}_cameraForBounds(l,f,v,w,S,A){if(l.projection.name==="globe")return this._cameraForBoundsOnGlobe(l,f,v,w,S,A);const P=l.clone(),R=this._extendCameraOptions(A),B=P.padding;P.bearing=w,P.pitch=S;const U=s.L.convert(f),H=s.L.convert(v),Z=new s.L(U.lng,H.lat),Y=new s.L(H.lng,U.lat),Q=P.project(U),te=P.project(H),ee=this.queryTerrainElevation(U),K=this.queryTerrainElevation(H),ce=this.queryTerrainElevation(Z),ge=this.queryTerrainElevation(Y),_e=[[Q.x,Q.y,Math.min(ee||0,K||0,ce||0,ge||0)],[te.x,te.y,Math.max(ee||0,K||0,ce||0,ge||0)]];let se=s.c3.fromPoints(_e);const ue=P.getWorldToCameraMatrix(),ve=s.m.invert(new Float64Array(16),ue);se=s.c3.applyTransform(se,ue);const Me=s.v.sub([],se.max,se.min),be=B.left||0,Ce=B.right||0,$e=B.bottom||0,Ne=B.top||0,{left:qe,right:Le,top:Ke,bottom:He}=R.padding,nt=.5*(be+Ce),de=.5*(Ne+$e),ze=Math.min(P.scaleZoom(P.scale*Math.min((P.width-(be+Ce+qe+Le))/Me[0],(P.height-($e+Ne+He+Ke))/Me[1])),R.maxZoom),_t=P.scale/P.zoomScale(ze);se=new s.c3([se.min[0]-(qe+nt)*_t,se.min[1]-(He+de)*_t,se.min[2]],[se.max[0]+(Le+nt)*_t,se.max[1]+(Ke+de)*_t,se.max[2]]);const ut=.5*Me[2],ti=this._minimumAABBFrustumDistance(P,se),Ht=[0,0,1,0];s.e.transformMat4(Ht,Ht,ue),s.e.normalize(Ht,Ht);const hi=s.v.scale([],Ht,ti+ut),Jt=s.v.add([],se.center,hi),_i=(typeof R.offset.x=="number"&&typeof R.offset.y=="number"?new s.P(R.offset.x,R.offset.y):s.P.convert(R.offset)).rotate(-s.d(w));se.center[0]-=_i.x*_t,se.center[1]+=_i.y*_t,s.v.transformMat4(se.center,se.center,ve),s.v.transformMat4(Jt,Jt,ve);const yi=[se.center[0],se.center[1],Jt[2]*P.pixelsPerMeter];s.v.scale(yi,yi,1/P.worldSize);const oi=s.cK(yi[0]),li=s.l(yi[1]),tn=Math.min(P._zoomFromMercatorZ(yi[2]),R.maxZoom),Li=new s.L(oi,li);return P.mercatorFromTransition&&tn<.5*(s.Z+s.G)?(P.setProjection({name:"globe"}),P.zoom=tn,this._cameraForBounds(P,f,v,w,S,A)):{center:Li,zoom:tn,bearing:w,pitch:S}}fitBounds(l,f,v){const w=this.cameraForBounds(l,f);return this._fitInternal(w,f,v)}fitScreenCoordinates(l,f,v,w,S){const A=s.P.convert(l),P=s.P.convert(f),R=new s.P(Math.min(A.x,P.x),Math.min(A.y,P.y)),B=new s.P(Math.max(A.x,P.x),Math.max(A.y,P.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(A,P))return this;const U=this.transform.pointLocation3D(R),H=this.transform.pointLocation3D(B),Z=this.transform.pointLocation3D(new s.P(R.x,B.y)),Y=this.transform.pointLocation3D(new s.P(B.x,R.y)),Q=[Math.min(U.lng,H.lng,Z.lng,Y.lng),Math.min(U.lat,H.lat,Z.lat,Y.lat)],te=[Math.max(U.lng,H.lng,Z.lng,Y.lng),Math.max(U.lat,H.lat,Z.lat,Y.lat)],ee=w&&w.pitch?w.pitch:this.getPitch(),K=this._cameraForBounds(this.transform,Q,te,v,ee,w);return this._fitInternal(K,w,S)}_fitInternal(l,f,v){return l?(delete(f=s.ak(l,f)).padding,f.linear?this.easeTo(f,v):this.flyTo(f,v)):this}jumpTo(l,f){this.stop();const v=l.preloadOnly?this.transform.clone():this.transform;let w=!1,S=!1,A=!1;return"zoom"in l&&v.zoom!==+l.zoom&&(w=!0,v.zoom=+l.zoom),l.center!==void 0&&(v.center=s.L.convert(l.center)),"bearing"in l&&v.bearing!==+l.bearing&&(S=!0,v.bearing=+l.bearing),"pitch"in l&&v.pitch!==+l.pitch&&(A=!0,v.pitch=+l.pitch),l.padding==null||v.isPaddingEqual(l.padding)||(v.padding=l.padding),l.preloadOnly?(this._preloadTiles(v),this):(this.fire(new s.a8("movestart",f)).fire(new s.a8("move",f)),w&&this.fire(new s.a8("zoomstart",f)).fire(new s.a8("zoom",f)).fire(new s.a8("zoomend",f)),S&&this.fire(new s.a8("rotatestart",f)).fire(new s.a8("rotate",f)).fire(new s.a8("rotateend",f)),A&&this.fire(new s.a8("pitchstart",f)).fire(new s.a8("pitch",f)).fire(new s.a8("pitchend",f)),this.fire(new s.a8("moveend",f)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.X(Xm),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,f){const v=this.transform;if(!v.projection.supportsFreeCamera)return s.X(Xm),this;this.stop();const w=v.zoom,S=v.pitch,A=v.bearing;v.setFreeCameraOptions(l);const P=w!==v.zoom,R=S!==v.pitch,B=A!==v.bearing;return this.fire(new s.a8("movestart",f)).fire(new s.a8("move",f)),P&&this.fire(new s.a8("zoomstart",f)).fire(new s.a8("zoom",f)).fire(new s.a8("zoomend",f)),B&&this.fire(new s.a8("rotatestart",f)).fire(new s.a8("rotate",f)).fire(new s.a8("rotateend",f)),R&&this.fire(new s.a8("pitchstart",f)).fire(new s.a8("pitch",f)).fire(new s.a8("pitchend",f)),this.fire(new s.a8("moveend",f)),this}easeTo(l,f){this._stop(!1,l.easeId),((l=s.ak({offset:[0,0],duration:500,easing:s.cG},l)).animate===!1||this._prefersReducedMotion(l))&&(l.duration=0);const v=this.transform,w=this.getZoom(),S=this.getBearing(),A=this.getPitch(),P=this.getPadding(),R="zoom"in l?+l.zoom:w,B="bearing"in l?this._normalizeBearing(l.bearing,S):S,U="pitch"in l?+l.pitch:A,H="padding"in l?l.padding:v.padding,Z=s.P.convert(l.offset);let Y,Q,te;if(v.projection.name==="globe"){const be=s.M.fromLngLat(v.center),Ce=Z.rotate(-v.angle);be.x+=Ce.x/v.worldSize,be.y+=Ce.y/v.worldSize;const $e=be.toLngLat(),Ne=s.L.convert(l.center||$e);this._normalizeCenter(Ne),Y=v.centerPoint.add(Ce),Q=new s.P(be.x,be.y).mult(v.worldSize),te=new s.P(s.E(Ne.lng),s.H(Ne.lat)).mult(v.worldSize).sub(Q)}else{Y=v.centerPoint.add(Z);const be=v.pointLocation(Y),Ce=s.L.convert(l.center||be);this._normalizeCenter(Ce),Q=v.project(be),te=v.project(Ce).sub(Q)}const ee=v.zoomScale(R-w);let K,ce;l.around&&(K=s.L.convert(l.around),ce=v.locationPoint(K));const ge=this._zooming||R!==w,_e=this._rotating||S!==B,se=this._pitching||U!==A,ue=!v.isPaddingEqual(H),ve=be=>Ce=>{if(ge&&(be.zoom=s.n(w,R,Ce)),_e&&(be.bearing=s.n(S,B,Ce)),se&&(be.pitch=s.n(A,U,Ce)),ue&&(be.interpolatePadding(P,H,Ce),Y=be.centerPoint.add(Z)),K)be.setLocationAtPoint(K,ce);else{const $e=be.zoomScale(be.zoom-w),Ne=R>w?Math.min(2,ee):Math.max(.5,ee),qe=Math.pow(Ne,1-Ce),Le=be.unproject(Q.add(te.mult(Ce*qe)).mult($e));be.setLocationAtPoint(be.renderWorldCopies?Le.wrap():Le,Y)}return l.preloadOnly||this._fireMoveEvents(f),be};if(l.preloadOnly){const be=this._emulate(ve,l.duration,v);return this._preloadTiles(be),this}const Me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ge,this._rotating=_e,this._pitching=se,this._easeId=l.easeId,this._prepareEase(f,l.noMoveStart,Me),this._ease(ve(v),be=>{v.cameraElevationReference==="sea"&&v.recenterOnTerrain(),this._afterEase(f,be)},l),this}_prepareEase(l,f,v={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),f||v.moving||this.fire(new s.a8("movestart",l)),this._zooming&&!v.zooming&&this.fire(new s.a8("zoomstart",l)),this._rotating&&!v.rotating&&this.fire(new s.a8("rotatestart",l)),this._pitching&&!v.pitching&&this.fire(new s.a8("pitchstart",l))}_fireMoveEvents(l){this.fire(new s.a8("move",l)),this._zooming&&this.fire(new s.a8("zoom",l)),this._rotating&&this.fire(new s.a8("rotate",l)),this._pitching&&this.fire(new s.a8("pitch",l))}_afterEase(l,f){if(this._easeId&&f&&this._easeId===f)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const v=this._zooming,w=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,v&&this.fire(new s.a8("zoomend",l)),w&&this.fire(new s.a8("rotateend",l)),S&&this.fire(new s.a8("pitchend",l)),this.fire(new s.a8("moveend",l))}flyTo(l,f){if(this._prefersReducedMotion(l)){const He=s.p(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(He,f)}this.stop(),l=s.ak({offset:[0,0],speed:1.2,curve:1.42,easing:s.cG},l);const v=this.transform,w=this.getZoom(),S=this.getBearing(),A=this.getPitch(),P="zoom"in l?s.c(+l.zoom,v.minZoom,v.maxZoom):w,R="bearing"in l?this._normalizeBearing(l.bearing,S):S,B="pitch"in l?+l.pitch:A,U=v.zoomScale(P-w),H=s.P.convert(l.offset),Z=v.centerPoint.add(H),Y=v.pointLocation(Z);let Q=l.center;if(Q&&l.padding){const He=this._cameraForBounds(this.transform,Q,Q,R,B,l);He&&(Q=He.center)}Q=s.L.convert(Q||Y),this._normalizeCenter(Q);const te=v.project(Y),ee=v.project(Q).sub(te);let K=l.curve;const ce=Math.max(v.width,v.height),ge=ce/U,_e=ee.mag();if("minZoom"in l){const He=s.c(Math.min(l.minZoom,w,P),v.minZoom,v.maxZoom),nt=ce/v.zoomScale(He-w);K=Math.sqrt(nt/_e*2)}const se=K*K;function ue(He){const nt=(ge*ge-ce*ce+(He?-1:1)*se*se*_e*_e)/(2*(He?ge:ce)*se*_e);return Math.log(Math.sqrt(nt*nt+1)-nt)}function ve(He){return(Math.exp(He)-Math.exp(-He))/2}function Me(He){return(Math.exp(He)+Math.exp(-He))/2}const be=ue(0);let Ce=function(He){return Me(be)/Me(be+K*He)},$e=function(He){return ce*((Me(be)*(ve(nt=be+K*He)/Me(nt))-ve(be))/se)/_e;var nt},Ne=(ue(1)-be)/K;if(Math.abs(_e)<1e-6||!isFinite(Ne)){if(Math.abs(ce-ge)<1e-6)return this.easeTo(l,f);const He=ge<ce?-1:1;Ne=Math.abs(Math.log(ge/ce))/K,$e=function(){return 0},Ce=function(nt){return Math.exp(He*K*nt)}}l.duration="duration"in l?+l.duration:1e3*Ne/("screenSpeed"in l?+l.screenSpeed/K:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const qe=S!==R,Le=B!==A,Ke=He=>nt=>{const de=nt*Ne,ze=1/Ce(de);He.zoom=nt===1?P:w+He.scaleZoom(ze),qe&&(He.bearing=s.n(S,R,nt)),Le&&(He.pitch=s.n(A,B,nt));const _t=nt===1?Q:He.unproject(te.add(ee.mult($e(de))).mult(ze));return He.setLocationAtPoint(He.renderWorldCopies?_t.wrap():_t,Z),He._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(f),He};if(l.preloadOnly){const He=this._emulate(Ke,l.duration,v);return this._preloadTiles(He),this}return this._zooming=!0,this._rotating=qe,this._pitching=Le,this._prepareEase(f,!1),this._ease(Ke(v),()=>this._afterEase(f),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const v=this._onEaseEnd;this._onEaseEnd=void 0,v.call(this,f)}if(!l){const v=this.handlers;v&&v.stop(!1)}return this}_ease(l,f,v){v.animate===!1||v.duration===0?(l(1),f()):(this._easeStart=s.a4.now(),this._easeOptions=v,this._onEaseFrame=l,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((s.a4.now()-this._easeStart)/this._easeOptions.duration,1),f=this._onEaseFrame;f&&f(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,f){l=s.w(l,-180,180);const v=Math.abs(l-f);return Math.abs(l-360-f)<v&&(l-=360),Math.abs(l+360-f)<v&&(l+=360),l}_normalizeCenter(l){const f=this.transform;if(f.maxBounds||f.projection.name!=="globe"&&!f.renderWorldCopies)return;const v=l.lng-f.center.lng;l.lng+=v>180?-360:v<-180?360:0}_prefersReducedMotion(l){return this._respectPrefersReducedMotion&&s.a4.prefersReducedMotion&&!(l&&l.essential)}_emulate(l,f,v){const w=Math.ceil(15*f/1e3),S=[],A=l(v.clone());for(let P=0;P<=w;P++){const R=A(P/w);S.push(R.clone())}return S}}class Md{constructor(l={}){this.options=l,s.aR(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const f=this.options&&this.options.compact;return this._map=l,this._container=V("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=V("button","mapboxgl-ctrl-attrib-button",this._container),V("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V("div","mapboxgl-ctrl-attrib-inner",this._container),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(l,f){const v=this._map._getUIString(`AttributionControl.${f}`);l.removeAttribute("title"),l.firstElementChild&&l.firstElementChild.setAttribute("title",v)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.cM.ACCESS_TOKEN}];if(l){const v=f.reduce((w,S,A)=>(S.value&&(w+=`${S.key}=${S.value}${A<f.length-1?"&":""}`),w),"?");l.href=`${s.cM.FEEDBACK_URL}/${v}#${al(this._map,!0)}`,l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}}_updateData(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const f=this._map.style._mergedSourceCaches;for(const w in f){const S=f[w];if(S.used){const A=S.getSource();A.attribution&&l.indexOf(A.attribution)<0&&l.push(A.attribution)}}l.sort((w,S)=>w.length-S.length),l=l.filter((w,S)=>{for(let A=S+1;A<l.length;A++)if(l[A].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const v=l.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,l.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ed{constructor(){s.aR(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=V("div","mapboxgl-ctrl");const f=V("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(Object.entries(l).length===0)return!0;for(const f in l){const v=l[f].getSource();if(v.hasOwnProperty("mapbox_logo")&&!v.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}}}class Ad{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f}remove(l){const f=this._currentlyRunning,v=f?this._queue.concat(f):this._queue;for(const w of v)if(w.id===l)return void(w.cancelled=!0)}run(l=0){const f=this._currentlyRunning=this._queue;this._queue=[];for(const v of f)if(!v.cancelled&&(v.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Id(_,l,f){if(_=new s.L(_.lng,_.lat),l){const v=new s.L(_.lng-360,_.lat),w=new s.L(_.lng+360,_.lat),S=360*Math.ceil(Math.abs(_.lng-f.center.lng)/360),A=f.locationPoint(_).distSqr(l),P=l.x<0||l.y<0||l.x>f.width||l.y>f.height;f.locationPoint(v).distSqr(l)<A&&(P||Math.abs(v.lng-f.center.lng)<S)?_=v:f.locationPoint(w).distSqr(l)<A&&(P||Math.abs(w.lng-f.center.lng)<S)&&(_=w)}for(;Math.abs(_.lng-f.center.lng)>180;){const v=f.locationPoint(_);if(v.x>=0&&v.y>=0&&v.x<=f.width&&v.y<=f.height)break;_.lng>f.center.lng?_.lng-=360:_.lng+=360}return _}const $h={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Nr extends s.a6{constructor(l,f){if(super(),(l instanceof HTMLElement||f)&&(l=s.ak({element:l},f)),s.aR(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=s.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=V("div");const S=41,A=27,P=X("svg",{display:"block",height:S*this._scale+"px",width:A*this._scale+"px",viewBox:`0 0 ${A} ${S}`},this._element),R=X("radialGradient",{id:"shadowGradient"},X("defs",{},P));X("stop",{offset:"10%","stop-opacity":.4},R),X("stop",{offset:"100%","stop-opacity":.05},R),X("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},P),X("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},P),X("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},P),X("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},P),this._offset=s.P.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",S=>{S.preventDefault()}),this._element.addEventListener("mousedown",S=>{S.preventDefault()});const v=this._element.classList;for(const S in $h)v.remove(`mapboxgl-marker-anchor-${S}`);v.add(`mapboxgl-marker-anchor-${this._anchor}`);const w=l&&l.className?l.className.trim().split(/\s+/):[];v.add(...w),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){const l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=s.L.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(38.1-13.5+w)],"bottom-right":[-w,-1*(38.1-13.5+w)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const f=l.code,v=l.charCode||l.keyCode;f!=="Space"&&f!=="Enter"&&v!==32&&v!==13||this.togglePopup()}_onMapClick(l){const f=l.originalEvent.target,v=this._element;this._popup&&(f===v||v.contains(f))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const l=this._map,f=this._pos;if(!l||!f)return!1;const v=l.unproject(f),w=l.getFreeCameraOptions();if(!w.position)return!1;const S=w.position.toLngLat();return S.distanceTo(v)<.9*S.distanceTo(this._lngLat)}_evaluateOpacity(){const l=this._map;if(!l)return;const f=this._pos;if(!f||f.x<0||f.x>l.transform.width||f.y<0||f.y>l.transform.height)return void this._clearFadeTimer();const v=l.unproject(f);let w;l._showingGlobe()&&s.cN(l.transform,this._lngLat)?w=0:(w=1-l._queryFogOpacity(v),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(w*=this._occludedOpacity)),this._element.style.opacity=`${w}`,this._element.style.pointerEvents=w>0?"auto":"none",this._popup&&this._popup._setOpacity(w),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const l=this._pos;if(!l||!this._map)return;const f=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${l.x}px,${l.y}px)
            ${$h[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${f.x}px,${f.y}px)
        `}_calculateXYTransform(){const l=this._pos,f=this._map,v=this.getPitchAlignment();if(!f||!l||v!=="map")return"";if(!f._showingGlobe()){const R=f.getPitch();return R?`rotateX(${R}deg)`:""}const w=s.Y(s.cO(f.transform,this._lngLat)),S=l.sub(s.cP(f.transform)),A=Math.abs(S.x)+Math.abs(S.y);if(A===0)return"";const P=w/A;return`rotateX(${-S.y*P}deg) rotateY(${S.x*P}deg)`}_calculateZTransform(){const l=this._pos,f=this._map;if(!f||!l)return"";let v=0;const w=this.getRotationAlignment();if(w==="map")if(f._showingGlobe()){const S=f.project(new s.L(this._lngLat.lng,this._lngLat.lat+.001)),A=f.project(new s.L(this._lngLat.lng,this._lngLat.lat-.001)).sub(S);v=s.Y(Math.atan2(A.y,A.x))-90}else v=-f.getBearing();else if(w==="horizon"){const S=s.an(4,6,f.getZoom()),A=s.cP(f.transform);A.y+=S*f.transform.height;const P=l.sub(A),R=s.Y(Math.atan2(P.y,P.x));v=(R>90?R-270:R+90)*(1-S)}return v+=this._rotation,v?`rotateZ(${v}deg)`:""}_update(l){cancelAnimationFrame(this._updateFrameId);const f=this._map;f&&(f.transform.renderWorldCopies&&(this._lngLat=Id(this._lngLat,this._pos,f.transform)),this._pos=f.project(this._lngLat),l===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),f._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(f._showingGlobe()||f.getTerrain()||f.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=s.P.convert(l),this._update(),this}addClassName(l){return this._element.classList.add(l),this}removeClassName(l){return this._element.classList.remove(l),this}toggleClassName(l){return this._element.classList.toggle(l)}_onMove(l){const f=this._map;if(!f)return;const v=this._pointerdownPos,w=this._positionDelta;if(v&&w){if(!this._isDragging){const S=this._clickTolerance||f._clickTolerance;if(l.point.dist(v)<S)return;this._isDragging=!0}this._pos=l.point.sub(w),this._lngLat=f.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.a8("dragstart"))),this.fire(new s.a8("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.a8("dragend")),this._state="inactive"}_addDragHandler(l){const f=this._map,v=this._pos;f&&v&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(v),this._pointerdownPos=l.point,this._state="pending",f.on("mousemove",this._onMove),f.on("touchmove",this._onMove),f.once("mouseup",this._onUp),f.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;const f=this._map;return f&&(l?(f.on("mousedown",this._addDragHandler),f.on("touchstart",this._addDragHandler)):(f.off("mousedown",this._addDragHandler),f.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const f0={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Jm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Cd(_=new s.P(0,0),l="bottom"){if(typeof _=="number"){const f=Math.round(Math.sqrt(.5*Math.pow(_,2)));switch(l){case"top":return new s.P(0,_);case"top-left":return new s.P(f,f);case"top-right":return new s.P(-f,f);case"bottom":return new s.P(0,-_);case"bottom-left":return new s.P(f,-f);case"bottom-right":return new s.P(-f,-f);case"left":return new s.P(_,0);case"right":return new s.P(-_,0)}return new s.P(0,0)}return _ instanceof s.P||Array.isArray(_)?s.P.convert(_):s.P.convert(_[l]||[0,0])}class d0{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const f=s.ba((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-f)+this._end*f}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,f,v){this._start=this.getValue(f),this._end=l,this._startTime=f,this._endTime=f+v}}const p0={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Hs={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class Km{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.continuousRedraw=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}const m0={showCompass:!0,showZoom:!0,visualizePitch:!1};class ul{constructor(l,f,v=!1){this._clickTolerance=10,this.element=f,this.mouseRotate=new bd({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,v&&(this.mousePitch=new wd({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),s.aR(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener("mousedown",this.mousedown),f.addEventListener("touchstart",this.touchstart,{passive:!1}),f.addEventListener("touchmove",this.touchmove),f.addEventListener("touchend",this.touchend),f.addEventListener("touchcancel",this.reset)}down(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),ne()}move(l,f){const v=this.map,w=this.mouseRotate.mousemoveWindow(l,f),S=w&&w.bearingDelta;if(S&&v.setBearing(v.getBearing()+S),this.mousePitch){const A=this.mousePitch.mousemoveWindow(l,f),P=A&&A.pitchDelta;P&&v.setPitch(v.getPitch()+P)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ye(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(s.ak({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),Ae(this.element,l)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,Ae(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=tt(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){l.targetTouches.length!==1?this.reset():(this._lastPos=tt(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const la={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Nc={maxWidth:100,unit:"metric"},ef={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:s.c$,supported:C,setRTLTextPlugin:s.d1,getRTLTextPluginStatus:s.d2,Map:class extends Ym{constructor(_){const l=_;if((_=s.ak({},Hs,_)).minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(_.antialias&&s.cQ(window)&&(_.antialias=!1,s.X("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new on(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies),_),this._repaint=!1,this._interactive=_.interactive,this._minTileCacheSize=_.minTileCacheSize,this._maxTileCacheSize=_.maxTileCacheSize,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=_.crossSourceCollisions,this._collectResourceTiming=_.collectResourceTiming,this._language=this._parseLanguage(_.language),this._worldview=_.worldview,this._renderTaskQueue=new Ad,this._domRenderTaskQueue=new Ad,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.cR(),this._locale=s.ak({},p0,_.locale),this._clickTolerance=_.clickTolerance,this._cooperativeGestures=_.cooperativeGestures,this._performanceMetricsCollection=_.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new d0(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.cS(_.transformRequest,_.accessToken,_.testMode),this._silenceAuthErrors=!!_.testMode,this._contextCreateOptions=_.contextCreateOptions?{..._.contextCreateOptions}:{},typeof _.container=="string"){const f=document.getElementById(_.container);if(!f)throw new Error(`Container '${_.container.toString()}' not found.`);this._container=f}else{if(!(_.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(this._container.childNodes.length>0&&s.X("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),_.maxBounds&&this.setMaxBounds(_.maxBounds),s.aR(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new Km,this._tp=_.devtools?new Pm(this):new Pm,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,f=>{this.repaint=f}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Zm(this,_),this._localFontFamily=_.localFontFamily,this._localIdeographFontFamily=_.localIdeographFontFamily,(_.style||!_.testMode)&&this.setStyle(_.style||s.cM.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),_.projection&&this.setProjection(_.projection),_.hash&&(this._hash=new zm(typeof _.hash=="string"&&_.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){l.center==null&&l.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch});const f=_.bounds;f&&(this.resize(),this.fitBounds(f,s.ak({},_.fitBoundsOptions,{duration:0})))}this.resize(),_.attributionControl&&this.addControl(new Md({customAttribution:_.customAttribution})),this._logoControl=new Ed,this.addControl(this._logoControl,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",f=>{this._update(f.dataType==="style"),this.fire(new s.a8(`${f.dataType}data`,f))}),this.on("dataloading",f=>{this.fire(new s.a8(`${f.dataType}dataloading`,f))})}_getMapId(){return this._mapId}addControl(_,l){if(l===void 0&&(l=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new s.a7(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=_.onAdd(this);this._controls.push(_);const v=this._controlPositions[l];return l.indexOf("bottom")!==-1?v.insertBefore(f,v.firstChild):v.appendChild(f),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new s.a7(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(_);return l>-1&&this._controls.splice(l,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(_){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new s.a8("movestart",_)).fire(new s.a8("move",_)),this.fire(new s.a8("resize",_)),l&&this.fire(new s.a8("moveend",_)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(_){return this.transform.setMaxBounds(s.D.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_?this.setZoom(_):this.fire(new s.a8("zoomstart")).fire(new s.a8("zoom")).fire(new s.a8("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_?this.setZoom(_):this.fire(new s.a8("zoomstart")).fire(new s.a8("zoom")).fire(new s.a8("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_?this.setPitch(_):this.fire(new s.a8("pitchstart")).fire(new s.a8("pitch")).fire(new s.a8("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_?this.setPitch(_):this.fire(new s.a8("pitchstart")).fire(new s.a8("pitch")).fire(new s.a8("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(_){return _==="auto"?navigator.language:Array.isArray(_)?_.length===0?void 0:_.map(l=>l==="auto"?navigator.language:l):_}setLanguage(_){const l=this._parseLanguage(_);if(!this.style||l===this._language)return this;this._language=l,this.style.reloadSources();for(const f of this._controls)f._setLanguage&&f._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(_){return this.style&&_!==this._worldview?(this._worldview=_,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(_){return this._lazyInitEmptyStyle(),_?typeof _=="string"&&(_={name:_}):_=null,this._useExplicitProjection=!!_,this._prioritizeAndUpdateProjection(_,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const _=this.transform,l=_.projection.name;let f;l==="globe"&&_.zoom>=s.G?(_.setMercatorFromTransition(),f=!0):l==="mercator"&&_.zoom<s.G&&(_.setProjection({name:"globe"}),f=!0),f&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(_,l){return this._updateProjection(_||l||{name:"mercator"})}_updateProjection(_){let l;return l=_.name==="globe"&&this.transform.zoom>=s.G?this.transform.setMercatorFromTransition():this.transform.setProjection(_),this.style.applyProjectionUpdate(),l&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(_){return this.transform.locationPoint3D(s.L.convert(_))}unproject(_){return this.transform.pointLocation3D(s.P.convert(_))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(_,l,f){if(_==="mouseenter"||_==="mouseover"){let v=!1;const w=A=>{const P=l.filter(B=>this.getLayer(B)),R=P.length?this.queryRenderedFeatures(A.point,{layers:P}):[];R.length?v||(v=!0,f.call(this,new gs(_,this,A.originalEvent,{features:R}))):v=!1},S=()=>{v=!1};return{layers:new Set(l),listener:f,delegates:{mousemove:w,mouseout:S}}}if(_==="mouseleave"||_==="mouseout"){let v=!1;const w=A=>{const P=l.filter(R=>this.getLayer(R));(P.length?this.queryRenderedFeatures(A.point,{layers:P}):[]).length?v=!0:v&&(v=!1,f.call(this,new gs(_,this,A.originalEvent)))},S=A=>{v&&(v=!1,f.call(this,new gs(_,this,A.originalEvent)))};return{layers:new Set(l),listener:f,delegates:{mousemove:w,mouseout:S}}}{const v=w=>{const S=l.filter(P=>this.getLayer(P)),A=S.length?this.queryRenderedFeatures(w.point,{layers:S}):[];A.length&&(w.features=A,f.call(this,w),delete w.features)};return{layers:new Set(l),listener:f,delegates:{[_]:v}}}}on(_,l,f){if(f===void 0)return super.on(_,l);if(Array.isArray(l)||(l=[l]),l){for(const w of l)if(!this._isValidId(w))return this}const v=this._createDelegatedListener(_,l,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(v);for(const w in v.delegates)this.on(w,v.delegates[w]);return this}once(_,l,f){if(f===void 0)return super.once(_,l);if(Array.isArray(l)||(l=[l]),l){for(const w of l)if(!this._isValidId(w))return this}const v=this._createDelegatedListener(_,l,f);for(const w in v.delegates)this.once(w,v.delegates[w]);return this}off(_,l,f){if(f===void 0)return super.off(_,l);l=new Set(Array.isArray(l)?l:[l]);for(const S of l)if(!this._isValidId(S))return this;const v=(S,A)=>{if(S.size!==A.size)return!1;for(const P of S)if(!A.has(P))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[_]:void 0;return w&&(S=>{for(let A=0;A<S.length;A++){const P=S[A];if(P.listener===f&&v(P.layers,l)){for(const R in P.delegates)this.off(R,P.delegates[R]);return S.splice(A,1),this}}})(w),this}queryRenderedFeatures(_,l){if(!this.style)return[];if(l!==void 0||_===void 0||_ instanceof s.P||Array.isArray(_)||(l=_,_=void 0),_=_||[[0,0],[this.transform.width,this.transform.height]],(l=l||{}).layers&&Array.isArray(l.layers)){for(const f of l.layers)if(!this._isValidId(f))return[]}return this.style.queryRenderedFeatures(_,l,this.transform)}querySourceFeatures(_,l){return this._isValidId(_)?this.style.querySourceFeatures(_,l):[]}isPointOnSurface(_){const{name:l}=this.transform.projection;return l!=="globe"&&l!=="mercator"&&s.X(`${l} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(_))}setStyle(_,l){return(l=s.ak({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&l.localFontFamily===this._localFontFamily&&this.style&&_?(this._diffStyle(_,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(_,l))}_getUIString(_){const l=this._locale[_];if(l==null)throw new Error(`Missing UI string '${_}'`);return l}_updateStyle(_,l){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),_&&(this.style=new Es(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_):this.style.loadJSON(_)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Es(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,l){if(typeof _=="string"){const f=this._requestManager.normalizeStyleURL(_),v=this._requestManager.transformRequest(f,s.a2.Style);s.a1(v,(w,S)=>{w?this.fire(new s.a7(w)):S&&this._updateDiff(S,l)})}else typeof _=="object"&&this._updateDiff(_,l)}_updateDiff(_,l){try{this.style.setState(_)&&this._update(!0)}catch(f){s.X(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(_,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.X("There is no style added to the map."),!1)}_isValidId(_){return _==null?(this.fire(new s.a7(new Error("IDs can't be empty."))),!1):!s.cu(_)||(this.fire(new s.a7(new Error(`IDs can't contain special symbols: "${_}".`))),!1)}addSource(_,l){return this._isValidId(_)?(this._lazyInitEmptyStyle(),this.style.addSource(_,l),this._update(!0)):this}isSourceLoaded(_){return!!this._isValidId(_)&&!!this.style&&this.style._isSourceCacheLoaded(_)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(_,l,f){this._lazyInitEmptyStyle(),this.style.addSourceType(_,l,f)}removeSource(_){return this._isValidId(_)?(this.style.removeSource(_),this._updateTerrain(),this._update(!0)):this}getSource(_){return this._isValidId(_)?this.style.getOwnSource(_):null}addImage(_,l,{pixelRatio:f=1,sdf:v=!1,stretchX:w,stretchY:S,content:A}={}){if(this._lazyInitEmptyStyle(),l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap){const{width:P,height:R,data:B}=s.a4.getImageData(l);this.style.addImage(_,{data:new s.a5({width:P,height:R},B),pixelRatio:f,stretchX:w,stretchY:S,content:A,sdf:v,version:0})}else if(l.width===void 0||l.height===void 0)this.fire(new s.a7(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:P,height:R}=l,B=l;this.style.addImage(_,{data:new s.a5({width:P,height:R},new Uint8Array(B.data)),pixelRatio:f,stretchX:w,stretchY:S,content:A,sdf:v,version:0,userImage:B}),B.onAdd&&B.onAdd(this,_)}}updateImage(_,l){this._lazyInitEmptyStyle();const f=this.style.getImage(_);if(!f)return void this.fire(new s.a7(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap?s.a4.getImageData(l):l,{width:w,height:S}=v,A=v.data;if(w===void 0||S===void 0)return void this.fire(new s.a7(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(w!==f.data.width||S!==f.data.height)return void this.fire(new s.a7(new Error(`The width and height of the updated image (${w}, ${S})
                must be that same as the previous version of the image
                (${f.data.width}, ${f.data.height})`)));const P=!(l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap);f.data.replace(A,P),this.style.updateImage(_,f)}hasImage(_){return _?!!this.style&&!!this.style.getImage(_):(this.fire(new s.a7(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_,l){s.a3(this._requestManager.transformRequest(_,s.a2.Image),(f,v)=>{l(f,v instanceof HTMLImageElement?s.a4.getImageData(v):v)})}listImages(){return this.style.listImages()}addModel(_,l){this._lazyInitEmptyStyle(),this.style.addModel(_,l)}hasModel(_){return _?this.style.hasModel(_):(this.fire(new s.a7(new Error("Missing required model id"))),!1)}removeModel(_){this.style.removeModel(_)}listModels(){return this.style.listModels()}addLayer(_,l){return this._isValidId(_.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(_,l),this._update(!0)):this}moveLayer(_,l){return this._isValidId(_)?(this.style.moveLayer(_,l),this._update(!0)):this}removeLayer(_){return this._isValidId(_)?(this.style.removeLayer(_),this._update(!0)):this}getLayer(_){return this._isValidId(_)?this.style.getOwnLayer(_):null}setLayerZoomRange(_,l,f){return this._isValidId(_)?(this.style.setLayerZoomRange(_,l,f),this._update(!0)):this}setFilter(_,l,f={}){return this._isValidId(_)?(this.style.setFilter(_,l,f),this._update(!0)):this}getFilter(_){return this._isValidId(_)?this.style.getFilter(_):null}setPaintProperty(_,l,f,v={}){return this._isValidId(_)?(this.style.setPaintProperty(_,l,f,v),this._update(!0)):this}getPaintProperty(_,l){return this._isValidId(_)?this.style.getPaintProperty(_,l):null}setLayoutProperty(_,l,f,v={}){return this._isValidId(_)?(this.style.setLayoutProperty(_,l,f,v),this._update(!0)):this}getLayoutProperty(_,l){return this._isValidId(_)?this.style.getLayoutProperty(_,l):null}getConfigProperty(_,l){return this.style.getConfigProperty(_,l)}setConfigProperty(_,l,f){return this.style.setConfigProperty(_,l,f),this._update(!0)}setLights(_){if(this._lazyInitEmptyStyle(),_&&_.length===1&&_[0].type==="flat"){const l=_[0];l.properties?this.style.setFlatLight(l.properties,l.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(_),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const _=this.style.getLights()||[];return _.length===0&&_.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),_}setLight(_,l={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:_}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(_){return this._lazyInitEmptyStyle(),!_&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(_),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(_){return this._lazyInitEmptyStyle(),this.style.setFog(_),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(_){return this.style.setCamera(_),this._triggerCameraUpdate(_)}_triggerCameraUpdate(_){return this._update(this.transform.setOrthographicProjectionAtLowPitch(_["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(_){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.L.convert(_),this.transform):0}setFeatureState(_,l){return this._isValidId(_.source)?(this.style.setFeatureState(_,l),this._update()):this}removeFeatureState(_,l){return this._isValidId(_.source)?(this.style.removeFeatureState(_,l),this._update()):this}getFeatureState(_){return this._isValidId(_.source)?this.style.getFeatureState(_):null}_updateContainerDimensions(){if(!this._container)return;const _=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let f,v,w,S=this._container;for(;S&&(!v||!w);){const A=window.getComputedStyle(S).transform;A&&A!=="none"&&(f=A.match(/matrix.*\((.+)\)/)[1].split(", "),f[0]&&f[0]!=="0"&&f[0]!=="1"&&(v=f[0]),f[3]&&f[3]!=="0"&&f[3]!=="1"&&(w=f[3])),S=S.parentElement}this._containerWidth=v?Math.abs(_/v):_,this._containerHeight=w?Math.abs(l/w):l}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.X("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const _=this._container;_.classList.add("mapboxgl-map"),(this._missingCSSCanary=V("div","mapboxgl-canary",_)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=V("div","mapboxgl-canvas-container",_);this._canvas=V("canvas","mapboxgl-canvas",l),this._interactive&&(l.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const f=this._controlContainer=V("div","mapboxgl-control-container",_),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{v[w]=V("div",`mapboxgl-ctrl-${w}`,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,l){const f=s.a4.devicePixelRatio||1;this._canvas.width=f*Math.ceil(_),this._canvas.height=f*Math.ceil(l),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${l}px`}_addMarker(_){this._markers.push(_)}_removeMarker(_){const l=this._markers.indexOf(_);l!==-1&&this._markers.splice(l,1)}_addPopup(_){this._popups.push(_)}_removePopup(_){const l=this._popups.indexOf(_);l!==-1&&this._popups.splice(l,1)}_setupPainter(){const _=s.ak({},C.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._canvas.getContext("webgl2",_);l?(s.cT(l,!0),this.painter=new s0(l,this._contextCreateOptions,this.transform,this._tp),this.on("data",f=>{f.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.cU.testSupport(l)):this.fire(new s.a7(new Error("Failed to initialize WebGL")))}_contextLost(_){_.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.a8("webglcontextlost",{originalEvent:_}))}_contextRestored(_){this._setupPainter(),this.resize(),this._update(),this.fire(new s.a8("webglcontextrestored",{originalEvent:_}))}_onMapScroll(_){if(_.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_requestDomTask(_){!this.loaded()||this.loaded()&&!this.isMoving()?_():this._domRenderTaskQueue.add(_)}_render(_){let l;this.fire(new s.a8("renderstart"));const f=this.painter.context.extTimerQuery,v=s.a4.now(),w=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(l=w.createQuery(),w.beginQuery(f.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(_),this._domRenderTaskQueue.run(_),this._removed)return;this._updateProjectionTransition();const S=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,B=this.transform.pitch,U=s.a4.now(),H=new s.al(R,{now:U,fadeDuration:S,pitch:B,transition:this.style.transition});this.style.update(H)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let A=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),A=this._updateAverageElevation(v),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):A=this._updateAverageElevation(v),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,S,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:S,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.a8("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.a8("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){const R=s.a4.now()-v;w.endQuery(f.TIME_ELAPSED_EXT),setTimeout(()=>{const B=w.getQueryParameter(l,w.QUERY_RESULT)/1e6;w.deleteQuery(l),this.fire(new s.a8("gpu-timing-frame",{cpuTime:R,gpuTime:B}))},50)}if(this.listens("gpu-timing-layer")){const R=this.painter.collectGpuTimers();setTimeout(()=>{const B=this.painter.queryGpuTimers(R);this.fire(new s.a8("gpu-timing-layer",{layerTimes:B}))},50)}if(this.listens("gpu-timing-deferred-render")){const R=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const B=this.painter.queryGpuTimeDeferredRender(R);this.fire(new s.a8("gpu-timing-deferred-render",{gpuTime:B}))},50)}const P=this._sourcesDirty||this._styleDirty||this._placementDirty||A;if(P||this._repaint)this.triggerRepaint();else{const R=!this.isMoving()&&this.loaded();if(R&&(A=this._updateAverageElevation(v,!0)),A)this.triggerRepaint();else if(this._triggerFrame(!1),R&&(this.fire(new s.a8("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const B=this._calculateSpeedIndex();this.fire(new s.a8("speedindexcompleted",{speedIndex:B})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||P||(this._fullyLoaded=!0,this._performanceMetricsCollection&&s.cV(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(_){for(const l of this._markers)_&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(const l of this._popups)!_||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(_,l=!1){const f=w=>(this.transform.averageElevation=w,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&f(0);const v=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(v||(l||_-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(_)){const w=this.transform.averageElevation;let S=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(S)?S=0:this._averageElevationLastSampledAt=_;const A=Math.abs(w-S);if(A>1){if(this._isInitialLoad||v)return this._averageElevation.jumpTo(S),f(S);this._averageElevation.easeTo(S,_,300)}else if(A>1e-4)return this._averageElevation.jumpTo(S),f(S)}return!!this._averageElevation.isEasing(_)&&f(this._averageElevation.getValue(_))}_authenticate(){s.cW(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,_=>{if(_&&(_.message===s.cX||_.status===401)){const l=this.painter.context.gl;s.cT(l,!1),this._logoControl instanceof Ed&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.a7(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.cY(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const _=this._isDragging();this.painter.updateTerrain(this.style,_)}_calculateSpeedIndex(){const _=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const f=this.painter.context.gl,v=f.createFramebuffer();function w(S){f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,S,0);const A=new Uint8Array(f.drawingBufferWidth*f.drawingBufferHeight*4);return f.readPixels(0,0,f.drawingBufferWidth,f.drawingBufferHeight,f.RGBA,f.UNSIGNED_BYTE,A),A}return f.bindFramebuffer(f.FRAMEBUFFER,v),this._canvasPixelComparison(w(_),l.canvasCopies.map(w),l.timeStamps)}_canvasPixelComparison(_,l,f){let v=f[1]-f[0];const w=_.length/4;for(let S=0;S<l.length;S++){const A=l[S];let P=0;for(let R=0;R<A.length;R+=4)A[R]===_[R]&&A[R+1]===_[R+1]&&A[R+2]===_[R+2]&&A[R+3]===_[R+3]&&(P+=1);v+=(f[S+2]-f[S+1])*(1-P/w)}return v}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const _=this.painter.context.gl.getExtension("WEBGL_lose_context");_&&_.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.cZ(this.painter.context.gl),this._removed=!0,this.fire(new s.a8("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(_){this._renderNextFrame=this._renderNextFrame||_,this.style&&!this._frame&&(this._frame=s.a4.frame(l=>{const f=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,f&&this._render(l)}))}_preloadTiles(_){const l=this.style?Object.values(this.style._sourceCaches):[];return s.c_(l,(f,v)=>f._preloadTiles(_,v),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(_){this._trackResize&&this.resize({originalEvent:_})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(_){this._showTerrainWireframe!==_&&(this._showTerrainWireframe=_,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(_){this._showLayers2DWireframe!==_&&(this._showLayers2DWireframe=_,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(_){this._showLayers3DWireframe!==_&&(this._showLayers3DWireframe=_,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(_){this._speedIndexTiming!==_&&(this._speedIndexTiming=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(_){this._showTileAABBs!==_&&(this._showTileAABBs=_,_&&this._update())}_setCacheLimits(_,l){s.d0(_,l)}get version(){return s.c$}},NavigationControl:class{constructor(_){this.options=s.ak({},m0,_),this._container=V("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(s.aR(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),V("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),V("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aR(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{const f=this._map;f&&(this.options.visualizePitch?f.resetNorthPitch({},{originalEvent:l}):f.resetNorth({},{originalEvent:l}))}),this._compassIcon=V("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const _=this._map;if(!_)return;const l=_.getZoom(),f=l===_.getMaxZoom(),v=l===_.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=v,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",v.toString())}_rotateCompassArrow(){const _=this._map;if(!_)return;const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(_.transform.pitch*(Math.PI/180)),.5)}) rotateX(${_.transform.pitch}deg) rotateZ(${_.transform.angle*(180/Math.PI)}deg)`:`rotate(${_.transform.angle*(180/Math.PI)}deg)`;_._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),_.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&_.on("pitch",this._rotateCompassArrow),_.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ul(_,this._compass,this.options.visualizePitch)),this._container}onRemove(){const _=this._map;_&&(this._container.remove(),this.options.showZoom&&_.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&_.off("pitch",this._rotateCompassArrow),_.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(_,l){const f=V("button",_,this._container);return f.type="button",f.addEventListener("click",l),f}_setButtonTitle(_,l){if(!this._map)return;const f=this._map._getUIString(`NavigationControl.${l}`);_.setAttribute("aria-label",f),_.firstElementChild&&_.firstElementChild.setAttribute("title",f)}},GeolocateControl:class extends s.a6{constructor(_){super();const l=navigator.geolocation;this.options=s.ak({geolocation:l},la,_),s.aR(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=sl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(_){return this._map=_,this._container=V("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(_){const l=(f=!!this.options.geolocation)=>{this._supportsGeolocation=f,_(f)};this._supportsGeolocation!==void 0?_(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(f=>l(f.state!=="denied")).catch(()=>l()):l()}_isOutOfMapMaxBounds(_){const l=this._map.getMaxBounds(),f=_.coords;return!!l&&(f.longitude<l.getWest()||f.longitude>l.getEast()||f.latitude<l.getSouth()||f.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(_){if(this._map){if(this._isOutOfMapMaxBounds(_))return this._setErrorState(),this.fire(new s.a8("outofmaxbounds",_)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=_,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(_),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(_),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.a8("geolocate",_)),this._finish()}}_updateCamera(_){const l=new s.L(_.coords.longitude,_.coords.latitude),f=_.coords.accuracy,v=this._map.getBearing(),w=s.ak({bearing:v},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(f),w,{geolocateSource:!0})}_updateMarker(_){if(_){const l=new s.L(_.coords.longitude,_.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=_.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const _=this._map.transform,l=s.b(1,_._center.lat)*_.worldSize,f=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(_){if(this._map){if(this.options.trackUserLocation)if(_.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(_.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.a8("error",_)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(_){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=V("button","mapboxgl-ctrl-geolocate",this._container),V("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",_===!1){s.X("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V("div","mapboxgl-user-location"),this._dotElement.appendChild(V("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(V("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Nr({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=V("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Nr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.a8("trackuserlocationend")))})}}_onDeviceOrientation(_){this._userLocationDotMarker&&(_.webkitCompassHeading?this._heading=_.webkitCompassHeading:_.absolute===!0&&(this._heading=-1*_.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.X("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.a8("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.a8("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.a8("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(_={maximumAge:6e5,timeout:0},this._noTimeout=!0):(_=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,_),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const _=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(l=>{l==="granted"&&_()}).catch(console.error):_()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Md,ScaleControl:class{constructor(_){this.options=s.ak({},Nc,_),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aR(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const _=this.options.maxWidth||100,l=this._map,f=l._containerHeight/2,v=l._containerWidth/2-_/2,w=l.unproject([v,f]),S=l.unproject([v+_,f]),A=w.distanceTo(S);if(this.options.unit==="imperial"){const P=3.2808*A;P>5280?this._setScale(_,P/5280,"mile"):this._setScale(_,P,"foot")}else this.options.unit==="nautical"?this._setScale(_,A/1852,"nautical-mile"):A>=1e3?this._setScale(_,A/1e3,"kilometer"):this._setScale(_,A,"meter")}_setScale(_,l,f){this._map._requestDomTask(()=>{const v=function(S){const A=Math.pow(10,`${Math.floor(S)}`.length-1);let P=S/A;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(R){const B=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*B)/B}(P),A*P}(l),w=v/l;this._container.innerHTML=this._isNumberFormatSupported&&f!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:f}).format(v):`${v}&nbsp;${ef[f]}`,this._container.style.width=_*w+"px"})}onAdd(_){return this._map=_,this._language=_.getLanguage(),this._container=V("div","mapboxgl-ctrl mapboxgl-ctrl-scale",_.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(_){this._language=_,this._update()}setUnit(_){this.options.unit=_,this._update()}},FullscreenControl:class{constructor(_){this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:s.X("Full screen control 'container' must be a DOM element.")),s.aR(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=V("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.X("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const _=this._fullscreenButton=V("button","mapboxgl-ctrl-fullscreen",this._controlContainer);V("span","mapboxgl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",_)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.a6{constructor(_){super(),this.options=s.ak(Object.create(f0),_),s.aR(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(_&&_.className?_.className.trim().split(/\s+/):[])}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&_.on("preclick",this._onClose),this.options.closeOnMove&&_.on("move",this._onClose),_.on("remove",this.remove),this._update(),_._addPopup(this),this._focusFirstElement(),this._trackPointer?(_.on("mousemove",this._onMouseEvent),_.on("mouseup",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")):_.on("move",this._update),this.fire(new s.a8("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const _=this._map;return _&&(_.off("move",this._update),_.off("move",this._onClose),_.off("preclick",this._onClose),_.off("click",this._onClose),_.off("remove",this.remove),_.off("mousemove",this._onMouseEvent),_.off("mouseup",this._onMouseEvent),_.off("drag",this._onMouseEvent),_._canvasContainer&&_._canvasContainer.classList.remove("mapboxgl-track-pointer"),_._removePopup(this),this._map=void 0),this.fire(new s.a8("close")),this}getLngLat(){return this._lngLat}setLngLat(_){this._lngLat=s.L.convert(_),this._pos=null,this._trackPointer=!1,this._update();const l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const _=this._map;return _&&(_.off("move",this._update),_.on("mousemove",this._onMouseEvent),_.on("drag",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){const l=document.createDocumentFragment(),f=document.createElement("body");let v;for(f.innerHTML=_;v=f.firstChild,v;)l.appendChild(v);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=V("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(_),this.options.closeButton){const f=this._closeButton=V("button","mapboxgl-popup-close-button",l);f.type="button",f.setAttribute("aria-label","Close popup"),f.setAttribute("aria-hidden","true"),f.innerHTML="&#215;",f.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(_){return this._classList.add(_),this._updateClassList(),this}removeClassName(_){return this._classList.delete(_),this._updateClassList(),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){let l;return this._classList.delete(_)?l=!1:(this._classList.add(_),l=!0),this._updateClassList(),l}_onMouseEvent(_){this._update(_.point)}_getAnchor(_){if(this.options.anchor)return this.options.anchor;const l=this._map,f=this._container,v=this._pos;if(!l||!f||!v)return"bottom";const w=f.offsetWidth,S=f.offsetHeight,A=v.x<w/2,P=v.x>l.transform.width-w/2;if(v.y+_<S)return A?"top-left":P?"top-right":"top";if(v.y>l.transform.height-S){if(A)return"bottom-left";if(P)return"bottom-right"}return A?"left":P?"right":"bottom"}_updateClassList(){const _=this._container;if(!_)return;const l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),_.className=l.join(" ")}_update(_){const l=this._map,f=this._content;if(!l||!this._lngLat&&!this._trackPointer||!f)return;let v=this._container;if(v||(v=this._container=V("div","mapboxgl-popup",l.getContainer()),this._tip=V("div","mapboxgl-popup-tip",v),v.appendChild(f)),this.options.maxWidth&&v.style.maxWidth!==this.options.maxWidth&&(v.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Id(this._lngLat,this._pos,l.transform)),!this._trackPointer||_){const w=this._pos=this._trackPointer&&_?_:l.project(this._lngLat),S=Cd(this.options.offset),A=this._anchor=this._getAnchor(S.y),P=Cd(this.options.offset,A),R=w.add(P).round();l._requestDomTask(()=>{this._container&&A&&(this._container.style.transform=`${$h[A]} translate(${R.x}px,${R.y}px)`)})}if(!this._marker&&l._showingGlobe()){const w=s.cN(l.transform,this._lngLat)?0:1;this._setOpacity(w)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(Jm);_&&_.focus()}_onClose(){this.remove()}_setOpacity(_){this._container&&(this._container.style.opacity=`${_}`),this._content&&(this._content.style.pointerEvents=_?"auto":"none")}},Marker:Nr,Style:Es,LngLat:s.L,LngLatBounds:s.D,Point:s.P,MercatorCoordinate:s.M,FreeCameraOptions:Wi,Evented:s.a6,config:s.cM,prewarm:s.d3,clearPrewarmedResources:s.d4,get accessToken(){return s.cM.ACCESS_TOKEN},set accessToken(_){s.cM.ACCESS_TOKEN=_},get baseApiUrl(){return s.cM.API_URL},set baseApiUrl(_){s.cM.API_URL=_},get workerCount(){return s.d5.workerCount},set workerCount(_){s.d5.workerCount=_},get maxParallelImageRequests(){return s.cM.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(_){s.cM.MAX_PARALLEL_IMAGE_REQUESTS=_},clearStorage(_){s.d6(_)},get workerUrl(){return s.d7.workerUrl},set workerUrl(_){s.d7.workerUrl=_},get workerClass(){return s.d7.workerClass},set workerClass(_){s.d7.workerClass=_},get workerParams(){return s.d7.workerParams},set workerParams(_){s.d7.workerParams=_},get dracoUrl(){return s.d8()},set dracoUrl(_){s.d9(_)},setNow:s.a4.setNow,restoreNow:s.a4.restoreNow}});var x=p;return x})})(ZP);var b4=ZP.exports;const hq=qP(b4);function YP(n,i){return function(){return n.apply(i,arguments)}}const{toString:w4}=Object.prototype,{getPrototypeOf:$1}=Object,Gy=(n=>i=>{const o=w4.call(i);return n[o]||(n[o]=o.slice(8,-1).toLowerCase())})(Object.create(null)),Cl=n=>(n=n.toLowerCase(),i=>Gy(i)===n),Hy=n=>i=>typeof i===n,{isArray:id}=Array,Kp=Hy("undefined");function T4(n){return n!==null&&!Kp(n)&&n.constructor!==null&&!Kp(n.constructor)&&va(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const JP=Cl("ArrayBuffer");function S4(n){let i;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?i=ArrayBuffer.isView(n):i=n&&n.buffer&&JP(n.buffer),i}const M4=Hy("string"),va=Hy("function"),KP=Hy("number"),Wy=n=>n!==null&&typeof n=="object",E4=n=>n===!0||n===!1,C_=n=>{if(Gy(n)!=="object")return!1;const i=$1(n);return(i===null||i===Object.prototype||Object.getPrototypeOf(i)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},A4=Cl("Date"),I4=Cl("File"),C4=Cl("Blob"),P4=Cl("FileList"),k4=n=>Wy(n)&&va(n.pipe),D4=n=>{let i;return n&&(typeof FormData=="function"&&n instanceof FormData||va(n.append)&&((i=Gy(n))==="formdata"||i==="object"&&va(n.toString)&&n.toString()==="[object FormData]"))},L4=Cl("URLSearchParams"),O4=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function _m(n,i,{allOwnKeys:o=!1}={}){if(n===null||typeof n>"u")return;let c,h;if(typeof n!="object"&&(n=[n]),id(n))for(c=0,h=n.length;c<h;c++)i.call(null,n[c],c,n);else{const p=o?Object.getOwnPropertyNames(n):Object.keys(n),g=p.length;let x;for(c=0;c<g;c++)x=p[c],i.call(null,n[x],x,n)}}function QP(n,i){i=i.toLowerCase();const o=Object.keys(n);let c=o.length,h;for(;c-- >0;)if(h=o[c],i===h.toLowerCase())return h;return null}const $P=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,ek=n=>!Kp(n)&&n!==$P;function $x(){const{caseless:n}=ek(this)&&this||{},i={},o=(c,h)=>{const p=n&&QP(i,h)||h;C_(i[p])&&C_(c)?i[p]=$x(i[p],c):C_(c)?i[p]=$x({},c):id(c)?i[p]=c.slice():i[p]=c};for(let c=0,h=arguments.length;c<h;c++)arguments[c]&&_m(arguments[c],o);return i}const R4=(n,i,o,{allOwnKeys:c}={})=>(_m(i,(h,p)=>{o&&va(h)?n[p]=YP(h,o):n[p]=h},{allOwnKeys:c}),n),z4=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),F4=(n,i,o,c)=>{n.prototype=Object.create(i.prototype,c),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:i.prototype}),o&&Object.assign(n.prototype,o)},B4=(n,i,o,c)=>{let h,p,g;const x={};if(i=i||{},n==null)return i;do{for(h=Object.getOwnPropertyNames(n),p=h.length;p-- >0;)g=h[p],(!c||c(g,n,i))&&!x[g]&&(i[g]=n[g],x[g]=!0);n=o!==!1&&$1(n)}while(n&&(!o||o(n,i))&&n!==Object.prototype);return i},N4=(n,i,o)=>{n=String(n),(o===void 0||o>n.length)&&(o=n.length),o-=i.length;const c=n.indexOf(i,o);return c!==-1&&c===o},V4=n=>{if(!n)return null;if(id(n))return n;let i=n.length;if(!KP(i))return null;const o=new Array(i);for(;i-- >0;)o[i]=n[i];return o},U4=(n=>i=>n&&i instanceof n)(typeof Uint8Array<"u"&&$1(Uint8Array)),j4=(n,i)=>{const c=(n&&n[Symbol.iterator]).call(n);let h;for(;(h=c.next())&&!h.done;){const p=h.value;i.call(n,p[0],p[1])}},G4=(n,i)=>{let o;const c=[];for(;(o=n.exec(i))!==null;)c.push(o);return c},H4=Cl("HTMLFormElement"),W4=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(o,c,h){return c.toUpperCase()+h}),kE=(({hasOwnProperty:n})=>(i,o)=>n.call(i,o))(Object.prototype),q4=Cl("RegExp"),tk=(n,i)=>{const o=Object.getOwnPropertyDescriptors(n),c={};_m(o,(h,p)=>{let g;(g=i(h,p,n))!==!1&&(c[p]=g||h)}),Object.defineProperties(n,c)},Z4=n=>{tk(n,(i,o)=>{if(va(n)&&["arguments","caller","callee"].indexOf(o)!==-1)return!1;const c=n[o];if(va(c)){if(i.enumerable=!1,"writable"in i){i.writable=!1;return}i.set||(i.set=()=>{throw Error("Can not rewrite read-only method '"+o+"'")})}})},X4=(n,i)=>{const o={},c=h=>{h.forEach(p=>{o[p]=!0})};return id(n)?c(n):c(String(n).split(i)),o},Y4=()=>{},J4=(n,i)=>(n=+n,Number.isFinite(n)?n:i),ux="abcdefghijklmnopqrstuvwxyz",DE="0123456789",ik={DIGIT:DE,ALPHA:ux,ALPHA_DIGIT:ux+ux.toUpperCase()+DE},K4=(n=16,i=ik.ALPHA_DIGIT)=>{let o="";const{length:c}=i;for(;n--;)o+=i[Math.random()*c|0];return o};function Q4(n){return!!(n&&va(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const $4=n=>{const i=new Array(10),o=(c,h)=>{if(Wy(c)){if(i.indexOf(c)>=0)return;if(!("toJSON"in c)){i[h]=c;const p=id(c)?[]:{};return _m(c,(g,x)=>{const s=o(g,h+1);!Kp(s)&&(p[x]=s)}),i[h]=void 0,p}}return c};return o(n,0)},e5=Cl("AsyncFunction"),t5=n=>n&&(Wy(n)||va(n))&&va(n.then)&&va(n.catch),Rt={isArray:id,isArrayBuffer:JP,isBuffer:T4,isFormData:D4,isArrayBufferView:S4,isString:M4,isNumber:KP,isBoolean:E4,isObject:Wy,isPlainObject:C_,isUndefined:Kp,isDate:A4,isFile:I4,isBlob:C4,isRegExp:q4,isFunction:va,isStream:k4,isURLSearchParams:L4,isTypedArray:U4,isFileList:P4,forEach:_m,merge:$x,extend:R4,trim:O4,stripBOM:z4,inherits:F4,toFlatObject:B4,kindOf:Gy,kindOfTest:Cl,endsWith:N4,toArray:V4,forEachEntry:j4,matchAll:G4,isHTMLForm:H4,hasOwnProperty:kE,hasOwnProp:kE,reduceDescriptors:tk,freezeMethods:Z4,toObjectSet:X4,toCamelCase:W4,noop:Y4,toFiniteNumber:J4,findKey:QP,global:$P,isContextDefined:ek,ALPHABET:ik,generateString:K4,isSpecCompliantForm:Q4,toJSONObject:$4,isAsyncFn:e5,isThenable:t5};function jn(n,i,o,c,h){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",i&&(this.code=i),o&&(this.config=o),c&&(this.request=c),h&&(this.response=h)}Rt.inherits(jn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Rt.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const nk=jn.prototype,rk={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{rk[n]={value:n}});Object.defineProperties(jn,rk);Object.defineProperty(nk,"isAxiosError",{value:!0});jn.from=(n,i,o,c,h,p)=>{const g=Object.create(nk);return Rt.toFlatObject(n,g,function(s){return s!==Error.prototype},x=>x!=="isAxiosError"),jn.call(g,n.message,i,o,c,h),g.cause=n,g.name=n.name,p&&Object.assign(g,p),g};const i5=null;function e1(n){return Rt.isPlainObject(n)||Rt.isArray(n)}function ok(n){return Rt.endsWith(n,"[]")?n.slice(0,-2):n}function LE(n,i,o){return n?n.concat(i).map(function(h,p){return h=ok(h),!o&&p?"["+h+"]":h}).join(o?".":""):i}function n5(n){return Rt.isArray(n)&&!n.some(e1)}const r5=Rt.toFlatObject(Rt,{},null,function(i){return/^is[A-Z]/.test(i)});function qy(n,i,o){if(!Rt.isObject(n))throw new TypeError("target must be an object");i=i||new FormData,o=Rt.toFlatObject(o,{metaTokens:!0,dots:!1,indexes:!1},!1,function(W,J){return!Rt.isUndefined(J[W])});const c=o.metaTokens,h=o.visitor||C,p=o.dots,g=o.indexes,s=(o.Blob||typeof Blob<"u"&&Blob)&&Rt.isSpecCompliantForm(i);if(!Rt.isFunction(h))throw new TypeError("visitor must be a function");function M(X){if(X===null)return"";if(Rt.isDate(X))return X.toISOString();if(!s&&Rt.isBlob(X))throw new jn("Blob is not supported. Use a Buffer instead.");return Rt.isArrayBuffer(X)||Rt.isTypedArray(X)?s&&typeof Blob=="function"?new Blob([X]):Buffer.from(X):X}function C(X,W,J){let $=X;if(X&&!J&&typeof X=="object"){if(Rt.endsWith(W,"{}"))W=c?W:W.slice(0,-2),X=JSON.stringify(X);else if(Rt.isArray(X)&&n5(X)||(Rt.isFileList(X)||Rt.endsWith(W,"[]"))&&($=Rt.toArray(X)))return W=ok(W),$.forEach(function(ye,pe){!(Rt.isUndefined(ye)||ye===null)&&i.append(g===!0?LE([W],pe,p):g===null?W:W+"[]",M(ye))}),!1}return e1(X)?!0:(i.append(LE(J,W,p),M(X)),!1)}const D=[],F=Object.assign(r5,{defaultVisitor:C,convertValue:M,isVisitable:e1});function V(X,W){if(!Rt.isUndefined(X)){if(D.indexOf(X)!==-1)throw Error("Circular reference detected in "+W.join("."));D.push(X),Rt.forEach(X,function($,ne){(!(Rt.isUndefined($)||$===null)&&h.call(i,$,Rt.isString(ne)?ne.trim():ne,W,F))===!0&&V($,W?W.concat(ne):[ne])}),D.pop()}}if(!Rt.isObject(n))throw new TypeError("data must be an object");return V(n),i}function OE(n){const i={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(c){return i[c]})}function eb(n,i){this._pairs=[],n&&qy(n,this,i)}const sk=eb.prototype;sk.append=function(i,o){this._pairs.push([i,o])};sk.toString=function(i){const o=i?function(c){return i.call(this,c,OE)}:OE;return this._pairs.map(function(h){return o(h[0])+"="+o(h[1])},"").join("&")};function o5(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ak(n,i,o){if(!i)return n;const c=o&&o.encode||o5,h=o&&o.serialize;let p;if(h?p=h(i,o):p=Rt.isURLSearchParams(i)?i.toString():new eb(i,o).toString(c),p){const g=n.indexOf("#");g!==-1&&(n=n.slice(0,g)),n+=(n.indexOf("?")===-1?"?":"&")+p}return n}class RE{constructor(){this.handlers=[]}use(i,o,c){return this.handlers.push({fulfilled:i,rejected:o,synchronous:c?c.synchronous:!1,runWhen:c?c.runWhen:null}),this.handlers.length-1}eject(i){this.handlers[i]&&(this.handlers[i]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(i){Rt.forEach(this.handlers,function(c){c!==null&&i(c)})}}const lk={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},s5=typeof URLSearchParams<"u"?URLSearchParams:eb,a5=typeof FormData<"u"?FormData:null,l5=typeof Blob<"u"?Blob:null,c5={isBrowser:!0,classes:{URLSearchParams:s5,FormData:a5,Blob:l5},protocols:["http","https","file","blob","url","data"]},ck=typeof window<"u"&&typeof document<"u",u5=(n=>ck&&["ReactNative","NativeScript","NS"].indexOf(n)<0)(typeof navigator<"u"&&navigator.product),h5=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",f5=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:ck,hasStandardBrowserEnv:u5,hasStandardBrowserWebWorkerEnv:h5},Symbol.toStringTag,{value:"Module"})),El={...f5,...c5};function d5(n,i){return qy(n,new El.classes.URLSearchParams,Object.assign({visitor:function(o,c,h,p){return El.isNode&&Rt.isBuffer(o)?(this.append(c,o.toString("base64")),!1):p.defaultVisitor.apply(this,arguments)}},i))}function p5(n){return Rt.matchAll(/\w+|\[(\w*)]/g,n).map(i=>i[0]==="[]"?"":i[1]||i[0])}function m5(n){const i={},o=Object.keys(n);let c;const h=o.length;let p;for(c=0;c<h;c++)p=o[c],i[p]=n[p];return i}function uk(n){function i(o,c,h,p){let g=o[p++];if(g==="__proto__")return!0;const x=Number.isFinite(+g),s=p>=o.length;return g=!g&&Rt.isArray(h)?h.length:g,s?(Rt.hasOwnProp(h,g)?h[g]=[h[g],c]:h[g]=c,!x):((!h[g]||!Rt.isObject(h[g]))&&(h[g]=[]),i(o,c,h[g],p)&&Rt.isArray(h[g])&&(h[g]=m5(h[g])),!x)}if(Rt.isFormData(n)&&Rt.isFunction(n.entries)){const o={};return Rt.forEachEntry(n,(c,h)=>{i(p5(c),h,o,0)}),o}return null}function g5(n,i,o){if(Rt.isString(n))try{return(i||JSON.parse)(n),Rt.trim(n)}catch(c){if(c.name!=="SyntaxError")throw c}return(o||JSON.stringify)(n)}const tb={transitional:lk,adapter:["xhr","http"],transformRequest:[function(i,o){const c=o.getContentType()||"",h=c.indexOf("application/json")>-1,p=Rt.isObject(i);if(p&&Rt.isHTMLForm(i)&&(i=new FormData(i)),Rt.isFormData(i))return h?JSON.stringify(uk(i)):i;if(Rt.isArrayBuffer(i)||Rt.isBuffer(i)||Rt.isStream(i)||Rt.isFile(i)||Rt.isBlob(i))return i;if(Rt.isArrayBufferView(i))return i.buffer;if(Rt.isURLSearchParams(i))return o.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),i.toString();let x;if(p){if(c.indexOf("application/x-www-form-urlencoded")>-1)return d5(i,this.formSerializer).toString();if((x=Rt.isFileList(i))||c.indexOf("multipart/form-data")>-1){const s=this.env&&this.env.FormData;return qy(x?{"files[]":i}:i,s&&new s,this.formSerializer)}}return p||h?(o.setContentType("application/json",!1),g5(i)):i}],transformResponse:[function(i){const o=this.transitional||tb.transitional,c=o&&o.forcedJSONParsing,h=this.responseType==="json";if(i&&Rt.isString(i)&&(c&&!this.responseType||h)){const g=!(o&&o.silentJSONParsing)&&h;try{return JSON.parse(i)}catch(x){if(g)throw x.name==="SyntaxError"?jn.from(x,jn.ERR_BAD_RESPONSE,this,null,this.response):x}}return i}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:El.classes.FormData,Blob:El.classes.Blob},validateStatus:function(i){return i>=200&&i<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Rt.forEach(["delete","get","head","post","put","patch"],n=>{tb.headers[n]={}});const ib=tb,_5=Rt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),y5=n=>{const i={};let o,c,h;return n&&n.split(`
`).forEach(function(g){h=g.indexOf(":"),o=g.substring(0,h).trim().toLowerCase(),c=g.substring(h+1).trim(),!(!o||i[o]&&_5[o])&&(o==="set-cookie"?i[o]?i[o].push(c):i[o]=[c]:i[o]=i[o]?i[o]+", "+c:c)}),i},zE=Symbol("internals");function mp(n){return n&&String(n).trim().toLowerCase()}function P_(n){return n===!1||n==null?n:Rt.isArray(n)?n.map(P_):String(n)}function v5(n){const i=Object.create(null),o=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let c;for(;c=o.exec(n);)i[c[1]]=c[2];return i}const x5=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function hx(n,i,o,c,h){if(Rt.isFunction(c))return c.call(this,i,o);if(h&&(i=o),!!Rt.isString(i)){if(Rt.isString(c))return i.indexOf(c)!==-1;if(Rt.isRegExp(c))return c.test(i)}}function b5(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(i,o,c)=>o.toUpperCase()+c)}function w5(n,i){const o=Rt.toCamelCase(" "+i);["get","set","has"].forEach(c=>{Object.defineProperty(n,c+o,{value:function(h,p,g){return this[c].call(this,i,h,p,g)},configurable:!0})})}class Zy{constructor(i){i&&this.set(i)}set(i,o,c){const h=this;function p(x,s,M){const C=mp(s);if(!C)throw new Error("header name must be a non-empty string");const D=Rt.findKey(h,C);(!D||h[D]===void 0||M===!0||M===void 0&&h[D]!==!1)&&(h[D||s]=P_(x))}const g=(x,s)=>Rt.forEach(x,(M,C)=>p(M,C,s));return Rt.isPlainObject(i)||i instanceof this.constructor?g(i,o):Rt.isString(i)&&(i=i.trim())&&!x5(i)?g(y5(i),o):i!=null&&p(o,i,c),this}get(i,o){if(i=mp(i),i){const c=Rt.findKey(this,i);if(c){const h=this[c];if(!o)return h;if(o===!0)return v5(h);if(Rt.isFunction(o))return o.call(this,h,c);if(Rt.isRegExp(o))return o.exec(h);throw new TypeError("parser must be boolean|regexp|function")}}}has(i,o){if(i=mp(i),i){const c=Rt.findKey(this,i);return!!(c&&this[c]!==void 0&&(!o||hx(this,this[c],c,o)))}return!1}delete(i,o){const c=this;let h=!1;function p(g){if(g=mp(g),g){const x=Rt.findKey(c,g);x&&(!o||hx(c,c[x],x,o))&&(delete c[x],h=!0)}}return Rt.isArray(i)?i.forEach(p):p(i),h}clear(i){const o=Object.keys(this);let c=o.length,h=!1;for(;c--;){const p=o[c];(!i||hx(this,this[p],p,i,!0))&&(delete this[p],h=!0)}return h}normalize(i){const o=this,c={};return Rt.forEach(this,(h,p)=>{const g=Rt.findKey(c,p);if(g){o[g]=P_(h),delete o[p];return}const x=i?b5(p):String(p).trim();x!==p&&delete o[p],o[x]=P_(h),c[x]=!0}),this}concat(...i){return this.constructor.concat(this,...i)}toJSON(i){const o=Object.create(null);return Rt.forEach(this,(c,h)=>{c!=null&&c!==!1&&(o[h]=i&&Rt.isArray(c)?c.join(", "):c)}),o}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([i,o])=>i+": "+o).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(i){return i instanceof this?i:new this(i)}static concat(i,...o){const c=new this(i);return o.forEach(h=>c.set(h)),c}static accessor(i){const c=(this[zE]=this[zE]={accessors:{}}).accessors,h=this.prototype;function p(g){const x=mp(g);c[x]||(w5(h,g),c[x]=!0)}return Rt.isArray(i)?i.forEach(p):p(i),this}}Zy.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Rt.reduceDescriptors(Zy.prototype,({value:n},i)=>{let o=i[0].toUpperCase()+i.slice(1);return{get:()=>n,set(c){this[o]=c}}});Rt.freezeMethods(Zy);const Sc=Zy;function fx(n,i){const o=this||ib,c=i||o,h=Sc.from(c.headers);let p=c.data;return Rt.forEach(n,function(x){p=x.call(o,p,h.normalize(),i?i.status:void 0)}),h.normalize(),p}function hk(n){return!!(n&&n.__CANCEL__)}function ym(n,i,o){jn.call(this,n??"canceled",jn.ERR_CANCELED,i,o),this.name="CanceledError"}Rt.inherits(ym,jn,{__CANCEL__:!0});function T5(n,i,o){const c=o.config.validateStatus;!o.status||!c||c(o.status)?n(o):i(new jn("Request failed with status code "+o.status,[jn.ERR_BAD_REQUEST,jn.ERR_BAD_RESPONSE][Math.floor(o.status/100)-4],o.config,o.request,o))}const S5=El.hasStandardBrowserEnv?{write(n,i,o,c,h,p){const g=[n+"="+encodeURIComponent(i)];Rt.isNumber(o)&&g.push("expires="+new Date(o).toGMTString()),Rt.isString(c)&&g.push("path="+c),Rt.isString(h)&&g.push("domain="+h),p===!0&&g.push("secure"),document.cookie=g.join("; ")},read(n){const i=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function M5(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function E5(n,i){return i?n.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):n}function fk(n,i){return n&&!M5(i)?E5(n,i):i}const A5=El.hasStandardBrowserEnv?function(){const i=/(msie|trident)/i.test(navigator.userAgent),o=document.createElement("a");let c;function h(p){let g=p;return i&&(o.setAttribute("href",g),g=o.href),o.setAttribute("href",g),{href:o.href,protocol:o.protocol?o.protocol.replace(/:$/,""):"",host:o.host,search:o.search?o.search.replace(/^\?/,""):"",hash:o.hash?o.hash.replace(/^#/,""):"",hostname:o.hostname,port:o.port,pathname:o.pathname.charAt(0)==="/"?o.pathname:"/"+o.pathname}}return c=h(window.location.href),function(g){const x=Rt.isString(g)?h(g):g;return x.protocol===c.protocol&&x.host===c.host}}():function(){return function(){return!0}}();function I5(n){const i=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return i&&i[1]||""}function C5(n,i){n=n||10;const o=new Array(n),c=new Array(n);let h=0,p=0,g;return i=i!==void 0?i:1e3,function(s){const M=Date.now(),C=c[p];g||(g=M),o[h]=s,c[h]=M;let D=p,F=0;for(;D!==h;)F+=o[D++],D=D%n;if(h=(h+1)%n,h===p&&(p=(p+1)%n),M-g<i)return;const V=C&&M-C;return V?Math.round(F*1e3/V):void 0}}function FE(n,i){let o=0;const c=C5(50,250);return h=>{const p=h.loaded,g=h.lengthComputable?h.total:void 0,x=p-o,s=c(x),M=p<=g;o=p;const C={loaded:p,total:g,progress:g?p/g:void 0,bytes:x,rate:s||void 0,estimated:s&&g&&M?(g-p)/s:void 0,event:h};C[i?"download":"upload"]=!0,n(C)}}const P5=typeof XMLHttpRequest<"u",k5=P5&&function(n){return new Promise(function(o,c){let h=n.data;const p=Sc.from(n.headers).normalize();let{responseType:g,withXSRFToken:x}=n,s;function M(){n.cancelToken&&n.cancelToken.unsubscribe(s),n.signal&&n.signal.removeEventListener("abort",s)}let C;if(Rt.isFormData(h)){if(El.hasStandardBrowserEnv||El.hasStandardBrowserWebWorkerEnv)p.setContentType(!1);else if((C=p.getContentType())!==!1){const[W,...J]=C?C.split(";").map($=>$.trim()).filter(Boolean):[];p.setContentType([W||"multipart/form-data",...J].join("; "))}}let D=new XMLHttpRequest;if(n.auth){const W=n.auth.username||"",J=n.auth.password?unescape(encodeURIComponent(n.auth.password)):"";p.set("Authorization","Basic "+btoa(W+":"+J))}const F=fk(n.baseURL,n.url);D.open(n.method.toUpperCase(),ak(F,n.params,n.paramsSerializer),!0),D.timeout=n.timeout;function V(){if(!D)return;const W=Sc.from("getAllResponseHeaders"in D&&D.getAllResponseHeaders()),$={data:!g||g==="text"||g==="json"?D.responseText:D.response,status:D.status,statusText:D.statusText,headers:W,config:n,request:D};T5(function(ye){o(ye),M()},function(ye){c(ye),M()},$),D=null}if("onloadend"in D?D.onloadend=V:D.onreadystatechange=function(){!D||D.readyState!==4||D.status===0&&!(D.responseURL&&D.responseURL.indexOf("file:")===0)||setTimeout(V)},D.onabort=function(){D&&(c(new jn("Request aborted",jn.ECONNABORTED,n,D)),D=null)},D.onerror=function(){c(new jn("Network Error",jn.ERR_NETWORK,n,D)),D=null},D.ontimeout=function(){let J=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const $=n.transitional||lk;n.timeoutErrorMessage&&(J=n.timeoutErrorMessage),c(new jn(J,$.clarifyTimeoutError?jn.ETIMEDOUT:jn.ECONNABORTED,n,D)),D=null},El.hasStandardBrowserEnv&&(x&&Rt.isFunction(x)&&(x=x(n)),x||x!==!1&&A5(F))){const W=n.xsrfHeaderName&&n.xsrfCookieName&&S5.read(n.xsrfCookieName);W&&p.set(n.xsrfHeaderName,W)}h===void 0&&p.setContentType(null),"setRequestHeader"in D&&Rt.forEach(p.toJSON(),function(J,$){D.setRequestHeader($,J)}),Rt.isUndefined(n.withCredentials)||(D.withCredentials=!!n.withCredentials),g&&g!=="json"&&(D.responseType=n.responseType),typeof n.onDownloadProgress=="function"&&D.addEventListener("progress",FE(n.onDownloadProgress,!0)),typeof n.onUploadProgress=="function"&&D.upload&&D.upload.addEventListener("progress",FE(n.onUploadProgress)),(n.cancelToken||n.signal)&&(s=W=>{D&&(c(!W||W.type?new ym(null,n,D):W),D.abort(),D=null)},n.cancelToken&&n.cancelToken.subscribe(s),n.signal&&(n.signal.aborted?s():n.signal.addEventListener("abort",s)));const X=I5(F);if(X&&El.protocols.indexOf(X)===-1){c(new jn("Unsupported protocol "+X+":",jn.ERR_BAD_REQUEST,n));return}D.send(h||null)})},t1={http:i5,xhr:k5};Rt.forEach(t1,(n,i)=>{if(n){try{Object.defineProperty(n,"name",{value:i})}catch{}Object.defineProperty(n,"adapterName",{value:i})}});const BE=n=>`- ${n}`,D5=n=>Rt.isFunction(n)||n===null||n===!1,dk={getAdapter:n=>{n=Rt.isArray(n)?n:[n];const{length:i}=n;let o,c;const h={};for(let p=0;p<i;p++){o=n[p];let g;if(c=o,!D5(o)&&(c=t1[(g=String(o)).toLowerCase()],c===void 0))throw new jn(`Unknown adapter '${g}'`);if(c)break;h[g||"#"+p]=c}if(!c){const p=Object.entries(h).map(([x,s])=>`adapter ${x} `+(s===!1?"is not supported by the environment":"is not available in the build"));let g=i?p.length>1?`since :
`+p.map(BE).join(`
`):" "+BE(p[0]):"as no adapter specified";throw new jn("There is no suitable adapter to dispatch the request "+g,"ERR_NOT_SUPPORT")}return c},adapters:t1};function dx(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new ym(null,n)}function NE(n){return dx(n),n.headers=Sc.from(n.headers),n.data=fx.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),dk.getAdapter(n.adapter||ib.adapter)(n).then(function(c){return dx(n),c.data=fx.call(n,n.transformResponse,c),c.headers=Sc.from(c.headers),c},function(c){return hk(c)||(dx(n),c&&c.response&&(c.response.data=fx.call(n,n.transformResponse,c.response),c.response.headers=Sc.from(c.response.headers))),Promise.reject(c)})}const VE=n=>n instanceof Sc?n.toJSON():n;function Hf(n,i){i=i||{};const o={};function c(M,C,D){return Rt.isPlainObject(M)&&Rt.isPlainObject(C)?Rt.merge.call({caseless:D},M,C):Rt.isPlainObject(C)?Rt.merge({},C):Rt.isArray(C)?C.slice():C}function h(M,C,D){if(Rt.isUndefined(C)){if(!Rt.isUndefined(M))return c(void 0,M,D)}else return c(M,C,D)}function p(M,C){if(!Rt.isUndefined(C))return c(void 0,C)}function g(M,C){if(Rt.isUndefined(C)){if(!Rt.isUndefined(M))return c(void 0,M)}else return c(void 0,C)}function x(M,C,D){if(D in i)return c(M,C);if(D in n)return c(void 0,M)}const s={url:p,method:p,data:p,baseURL:g,transformRequest:g,transformResponse:g,paramsSerializer:g,timeout:g,timeoutMessage:g,withCredentials:g,withXSRFToken:g,adapter:g,responseType:g,xsrfCookieName:g,xsrfHeaderName:g,onUploadProgress:g,onDownloadProgress:g,decompress:g,maxContentLength:g,maxBodyLength:g,beforeRedirect:g,transport:g,httpAgent:g,httpsAgent:g,cancelToken:g,socketPath:g,responseEncoding:g,validateStatus:x,headers:(M,C)=>h(VE(M),VE(C),!0)};return Rt.forEach(Object.keys(Object.assign({},n,i)),function(C){const D=s[C]||h,F=D(n[C],i[C],C);Rt.isUndefined(F)&&D!==x||(o[C]=F)}),o}const pk="1.6.7",nb={};["object","boolean","number","function","string","symbol"].forEach((n,i)=>{nb[n]=function(c){return typeof c===n||"a"+(i<1?"n ":" ")+n}});const UE={};nb.transitional=function(i,o,c){function h(p,g){return"[Axios v"+pk+"] Transitional option '"+p+"'"+g+(c?". "+c:"")}return(p,g,x)=>{if(i===!1)throw new jn(h(g," has been removed"+(o?" in "+o:"")),jn.ERR_DEPRECATED);return o&&!UE[g]&&(UE[g]=!0,console.warn(h(g," has been deprecated since v"+o+" and will be removed in the near future"))),i?i(p,g,x):!0}};function L5(n,i,o){if(typeof n!="object")throw new jn("options must be an object",jn.ERR_BAD_OPTION_VALUE);const c=Object.keys(n);let h=c.length;for(;h-- >0;){const p=c[h],g=i[p];if(g){const x=n[p],s=x===void 0||g(x,p,n);if(s!==!0)throw new jn("option "+p+" must be "+s,jn.ERR_BAD_OPTION_VALUE);continue}if(o!==!0)throw new jn("Unknown option "+p,jn.ERR_BAD_OPTION)}}const i1={assertOptions:L5,validators:nb},nu=i1.validators;class ay{constructor(i){this.defaults=i,this.interceptors={request:new RE,response:new RE}}async request(i,o){try{return await this._request(i,o)}catch(c){if(c instanceof Error){let h;Error.captureStackTrace?Error.captureStackTrace(h={}):h=new Error;const p=h.stack?h.stack.replace(/^.+\n/,""):"";c.stack?p&&!String(c.stack).endsWith(p.replace(/^.+\n.+\n/,""))&&(c.stack+=`
`+p):c.stack=p}throw c}}_request(i,o){typeof i=="string"?(o=o||{},o.url=i):o=i||{},o=Hf(this.defaults,o);const{transitional:c,paramsSerializer:h,headers:p}=o;c!==void 0&&i1.assertOptions(c,{silentJSONParsing:nu.transitional(nu.boolean),forcedJSONParsing:nu.transitional(nu.boolean),clarifyTimeoutError:nu.transitional(nu.boolean)},!1),h!=null&&(Rt.isFunction(h)?o.paramsSerializer={serialize:h}:i1.assertOptions(h,{encode:nu.function,serialize:nu.function},!0)),o.method=(o.method||this.defaults.method||"get").toLowerCase();let g=p&&Rt.merge(p.common,p[o.method]);p&&Rt.forEach(["delete","get","head","post","put","patch","common"],X=>{delete p[X]}),o.headers=Sc.concat(g,p);const x=[];let s=!0;this.interceptors.request.forEach(function(W){typeof W.runWhen=="function"&&W.runWhen(o)===!1||(s=s&&W.synchronous,x.unshift(W.fulfilled,W.rejected))});const M=[];this.interceptors.response.forEach(function(W){M.push(W.fulfilled,W.rejected)});let C,D=0,F;if(!s){const X=[NE.bind(this),void 0];for(X.unshift.apply(X,x),X.push.apply(X,M),F=X.length,C=Promise.resolve(o);D<F;)C=C.then(X[D++],X[D++]);return C}F=x.length;let V=o;for(D=0;D<F;){const X=x[D++],W=x[D++];try{V=X(V)}catch(J){W.call(this,J);break}}try{C=NE.call(this,V)}catch(X){return Promise.reject(X)}for(D=0,F=M.length;D<F;)C=C.then(M[D++],M[D++]);return C}getUri(i){i=Hf(this.defaults,i);const o=fk(i.baseURL,i.url);return ak(o,i.params,i.paramsSerializer)}}Rt.forEach(["delete","get","head","options"],function(i){ay.prototype[i]=function(o,c){return this.request(Hf(c||{},{method:i,url:o,data:(c||{}).data}))}});Rt.forEach(["post","put","patch"],function(i){function o(c){return function(p,g,x){return this.request(Hf(x||{},{method:i,headers:c?{"Content-Type":"multipart/form-data"}:{},url:p,data:g}))}}ay.prototype[i]=o(),ay.prototype[i+"Form"]=o(!0)});const k_=ay;class rb{constructor(i){if(typeof i!="function")throw new TypeError("executor must be a function.");let o;this.promise=new Promise(function(p){o=p});const c=this;this.promise.then(h=>{if(!c._listeners)return;let p=c._listeners.length;for(;p-- >0;)c._listeners[p](h);c._listeners=null}),this.promise.then=h=>{let p;const g=new Promise(x=>{c.subscribe(x),p=x}).then(h);return g.cancel=function(){c.unsubscribe(p)},g},i(function(p,g,x){c.reason||(c.reason=new ym(p,g,x),o(c.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(i){if(this.reason){i(this.reason);return}this._listeners?this._listeners.push(i):this._listeners=[i]}unsubscribe(i){if(!this._listeners)return;const o=this._listeners.indexOf(i);o!==-1&&this._listeners.splice(o,1)}static source(){let i;return{token:new rb(function(h){i=h}),cancel:i}}}const O5=rb;function R5(n){return function(o){return n.apply(null,o)}}function z5(n){return Rt.isObject(n)&&n.isAxiosError===!0}const n1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(n1).forEach(([n,i])=>{n1[i]=n});const F5=n1;function mk(n){const i=new k_(n),o=YP(k_.prototype.request,i);return Rt.extend(o,k_.prototype,i,{allOwnKeys:!0}),Rt.extend(o,i,null,{allOwnKeys:!0}),o.create=function(h){return mk(Hf(n,h))},o}const _o=mk(ib);_o.Axios=k_;_o.CanceledError=ym;_o.CancelToken=O5;_o.isCancel=hk;_o.VERSION=pk;_o.toFormData=qy;_o.AxiosError=jn;_o.Cancel=_o.CanceledError;_o.all=function(i){return Promise.all(i)};_o.spread=R5;_o.isAxiosError=z5;_o.mergeConfig=Hf;_o.AxiosHeaders=Sc;_o.formToJSON=n=>uk(Rt.isHTMLForm(n)?new FormData(n):n);_o.getAdapter=dk.getAdapter;_o.HttpStatusCode=F5;_o.default=_o;var B5=Error,N5=EvalError,V5=RangeError,U5=ReferenceError,gk=SyntaxError,vm=TypeError,j5=URIError,G5=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var i={},o=Symbol("test"),c=Object(o);if(typeof o=="string"||Object.prototype.toString.call(o)!=="[object Symbol]"||Object.prototype.toString.call(c)!=="[object Symbol]")return!1;var h=42;i[o]=h;for(o in i)return!1;if(typeof Object.keys=="function"&&Object.keys(i).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(i).length!==0)return!1;var p=Object.getOwnPropertySymbols(i);if(p.length!==1||p[0]!==o||!Object.prototype.propertyIsEnumerable.call(i,o))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var g=Object.getOwnPropertyDescriptor(i,o);if(g.value!==h||g.enumerable!==!0)return!1}return!0},jE=typeof Symbol<"u"&&Symbol,H5=G5,W5=function(){return typeof jE!="function"||typeof Symbol!="function"||typeof jE("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:H5()},px={__proto__:null,foo:{}},q5=Object,Z5=function(){return{__proto__:px}.foo===px.foo&&!(px instanceof q5)},X5="Function.prototype.bind called on incompatible ",Y5=Object.prototype.toString,J5=Math.max,K5="[object Function]",GE=function(i,o){for(var c=[],h=0;h<i.length;h+=1)c[h]=i[h];for(var p=0;p<o.length;p+=1)c[p+i.length]=o[p];return c},Q5=function(i,o){for(var c=[],h=o||0,p=0;h<i.length;h+=1,p+=1)c[p]=i[h];return c},$5=function(n,i){for(var o="",c=0;c<n.length;c+=1)o+=n[c],c+1<n.length&&(o+=i);return o},eF=function(i){var o=this;if(typeof o!="function"||Y5.apply(o)!==K5)throw new TypeError(X5+o);for(var c=Q5(arguments,1),h,p=function(){if(this instanceof h){var C=o.apply(this,GE(c,arguments));return Object(C)===C?C:this}return o.apply(i,GE(c,arguments))},g=J5(0,o.length-c.length),x=[],s=0;s<g;s++)x[s]="$"+s;if(h=Function("binder","return function ("+$5(x,",")+"){ return binder.apply(this,arguments); }")(p),o.prototype){var M=function(){};M.prototype=o.prototype,h.prototype=new M,M.prototype=null}return h},tF=eF,ob=Function.prototype.bind||tF,iF=Function.prototype.call,nF=Object.prototype.hasOwnProperty,rF=ob,oF=rF.call(iF,nF),kn,sF=B5,aF=N5,lF=V5,cF=U5,Wf=gk,Ff=vm,uF=j5,_k=Function,mx=function(n){try{return _k('"use strict"; return ('+n+").constructor;")()}catch{}},Mh=Object.getOwnPropertyDescriptor;if(Mh)try{Mh({},"")}catch{Mh=null}var gx=function(){throw new Ff},hF=Mh?function(){try{return arguments.callee,gx}catch{try{return Mh(arguments,"callee").get}catch{return gx}}}():gx,Mf=W5(),fF=Z5(),Mo=Object.getPrototypeOf||(fF?function(n){return n.__proto__}:null),Pf={},dF=typeof Uint8Array>"u"||!Mo?kn:Mo(Uint8Array),Eh={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?kn:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?kn:ArrayBuffer,"%ArrayIteratorPrototype%":Mf&&Mo?Mo([][Symbol.iterator]()):kn,"%AsyncFromSyncIteratorPrototype%":kn,"%AsyncFunction%":Pf,"%AsyncGenerator%":Pf,"%AsyncGeneratorFunction%":Pf,"%AsyncIteratorPrototype%":Pf,"%Atomics%":typeof Atomics>"u"?kn:Atomics,"%BigInt%":typeof BigInt>"u"?kn:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?kn:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?kn:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?kn:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":sF,"%eval%":eval,"%EvalError%":aF,"%Float32Array%":typeof Float32Array>"u"?kn:Float32Array,"%Float64Array%":typeof Float64Array>"u"?kn:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?kn:FinalizationRegistry,"%Function%":_k,"%GeneratorFunction%":Pf,"%Int8Array%":typeof Int8Array>"u"?kn:Int8Array,"%Int16Array%":typeof Int16Array>"u"?kn:Int16Array,"%Int32Array%":typeof Int32Array>"u"?kn:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Mf&&Mo?Mo(Mo([][Symbol.iterator]())):kn,"%JSON%":typeof JSON=="object"?JSON:kn,"%Map%":typeof Map>"u"?kn:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Mf||!Mo?kn:Mo(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?kn:Promise,"%Proxy%":typeof Proxy>"u"?kn:Proxy,"%RangeError%":lF,"%ReferenceError%":cF,"%Reflect%":typeof Reflect>"u"?kn:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?kn:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Mf||!Mo?kn:Mo(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?kn:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Mf&&Mo?Mo(""[Symbol.iterator]()):kn,"%Symbol%":Mf?Symbol:kn,"%SyntaxError%":Wf,"%ThrowTypeError%":hF,"%TypedArray%":dF,"%TypeError%":Ff,"%Uint8Array%":typeof Uint8Array>"u"?kn:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?kn:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?kn:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?kn:Uint32Array,"%URIError%":uF,"%WeakMap%":typeof WeakMap>"u"?kn:WeakMap,"%WeakRef%":typeof WeakRef>"u"?kn:WeakRef,"%WeakSet%":typeof WeakSet>"u"?kn:WeakSet};if(Mo)try{null.error}catch(n){var pF=Mo(Mo(n));Eh["%Error.prototype%"]=pF}var mF=function n(i){var o;if(i==="%AsyncFunction%")o=mx("async function () {}");else if(i==="%GeneratorFunction%")o=mx("function* () {}");else if(i==="%AsyncGeneratorFunction%")o=mx("async function* () {}");else if(i==="%AsyncGenerator%"){var c=n("%AsyncGeneratorFunction%");c&&(o=c.prototype)}else if(i==="%AsyncIteratorPrototype%"){var h=n("%AsyncGenerator%");h&&Mo&&(o=Mo(h.prototype))}return Eh[i]=o,o},HE={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},xm=ob,ly=oF,gF=xm.call(Function.call,Array.prototype.concat),_F=xm.call(Function.apply,Array.prototype.splice),WE=xm.call(Function.call,String.prototype.replace),cy=xm.call(Function.call,String.prototype.slice),yF=xm.call(Function.call,RegExp.prototype.exec),vF=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,xF=/\\(\\)?/g,bF=function(i){var o=cy(i,0,1),c=cy(i,-1);if(o==="%"&&c!=="%")throw new Wf("invalid intrinsic syntax, expected closing `%`");if(c==="%"&&o!=="%")throw new Wf("invalid intrinsic syntax, expected opening `%`");var h=[];return WE(i,vF,function(p,g,x,s){h[h.length]=x?WE(s,xF,"$1"):g||p}),h},wF=function(i,o){var c=i,h;if(ly(HE,c)&&(h=HE[c],c="%"+h[0]+"%"),ly(Eh,c)){var p=Eh[c];if(p===Pf&&(p=mF(c)),typeof p>"u"&&!o)throw new Ff("intrinsic "+i+" exists, but is not available. Please file an issue!");return{alias:h,name:c,value:p}}throw new Wf("intrinsic "+i+" does not exist!")},nd=function(i,o){if(typeof i!="string"||i.length===0)throw new Ff("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof o!="boolean")throw new Ff('"allowMissing" argument must be a boolean');if(yF(/^%?[^%]*%?$/,i)===null)throw new Wf("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var c=bF(i),h=c.length>0?c[0]:"",p=wF("%"+h+"%",o),g=p.name,x=p.value,s=!1,M=p.alias;M&&(h=M[0],_F(c,gF([0,1],M)));for(var C=1,D=!0;C<c.length;C+=1){var F=c[C],V=cy(F,0,1),X=cy(F,-1);if((V==='"'||V==="'"||V==="`"||X==='"'||X==="'"||X==="`")&&V!==X)throw new Wf("property names with quotes must have matching quotes");if((F==="constructor"||!D)&&(s=!0),h+="."+F,g="%"+h+"%",ly(Eh,g))x=Eh[g];else if(x!=null){if(!(F in x)){if(!o)throw new Ff("base intrinsic for "+i+" exists, but the property is not available.");return}if(Mh&&C+1>=c.length){var W=Mh(x,F);D=!!W,D&&"get"in W&&!("originalValue"in W.get)?x=W.get:x=x[F]}else D=ly(x,F),x=x[F];D&&!s&&(Eh[g]=x)}}return x},yk={exports:{}},_x,qE;function sb(){if(qE)return _x;qE=1;var n=nd,i=n("%Object.defineProperty%",!0)||!1;if(i)try{i({},"a",{value:1})}catch{i=!1}return _x=i,_x}var TF=nd,D_=TF("%Object.getOwnPropertyDescriptor%",!0);if(D_)try{D_([],"length")}catch{D_=null}var vk=D_,ZE=sb(),SF=gk,Ef=vm,XE=vk,MF=function(i,o,c){if(!i||typeof i!="object"&&typeof i!="function")throw new Ef("`obj` must be an object or a function`");if(typeof o!="string"&&typeof o!="symbol")throw new Ef("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Ef("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Ef("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Ef("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Ef("`loose`, if provided, must be a boolean");var h=arguments.length>3?arguments[3]:null,p=arguments.length>4?arguments[4]:null,g=arguments.length>5?arguments[5]:null,x=arguments.length>6?arguments[6]:!1,s=!!XE&&XE(i,o);if(ZE)ZE(i,o,{configurable:g===null&&s?s.configurable:!g,enumerable:h===null&&s?s.enumerable:!h,value:c,writable:p===null&&s?s.writable:!p});else if(x||!h&&!p&&!g)i[o]=c;else throw new SF("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},r1=sb(),xk=function(){return!!r1};xk.hasArrayLengthDefineBug=function(){if(!r1)return null;try{return r1([],"length",{value:1}).length!==1}catch{return!0}};var EF=xk,AF=nd,YE=MF,IF=EF(),JE=vk,KE=vm,CF=AF("%Math.floor%"),PF=function(i,o){if(typeof i!="function")throw new KE("`fn` is not a function");if(typeof o!="number"||o<0||o>4294967295||CF(o)!==o)throw new KE("`length` must be a positive 32-bit integer");var c=arguments.length>2&&!!arguments[2],h=!0,p=!0;if("length"in i&&JE){var g=JE(i,"length");g&&!g.configurable&&(h=!1),g&&!g.writable&&(p=!1)}return(h||p||!c)&&(IF?YE(i,"length",o,!0,!0):YE(i,"length",o)),i};(function(n){var i=ob,o=nd,c=PF,h=vm,p=o("%Function.prototype.apply%"),g=o("%Function.prototype.call%"),x=o("%Reflect.apply%",!0)||i.call(g,p),s=sb(),M=o("%Math.max%");n.exports=function(F){if(typeof F!="function")throw new h("a function is required");var V=x(i,g,arguments);return c(V,1+M(0,F.length-(arguments.length-1)),!0)};var C=function(){return x(i,p,arguments)};s?s(n.exports,"apply",{value:C}):n.exports.apply=C})(yk);var kF=yk.exports,bk=nd,wk=kF,DF=wk(bk("String.prototype.indexOf")),LF=function(i,o){var c=bk(i,!!o);return typeof c=="function"&&DF(i,".prototype.")>-1?wk(c):c};const OF={},RF=Object.freeze(Object.defineProperty({__proto__:null,default:OF},Symbol.toStringTag,{value:"Module"})),zF=x4(RF);var ab=typeof Map=="function"&&Map.prototype,yx=Object.getOwnPropertyDescriptor&&ab?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,uy=ab&&yx&&typeof yx.get=="function"?yx.get:null,QE=ab&&Map.prototype.forEach,lb=typeof Set=="function"&&Set.prototype,vx=Object.getOwnPropertyDescriptor&&lb?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,hy=lb&&vx&&typeof vx.get=="function"?vx.get:null,$E=lb&&Set.prototype.forEach,FF=typeof WeakMap=="function"&&WeakMap.prototype,Np=FF?WeakMap.prototype.has:null,BF=typeof WeakSet=="function"&&WeakSet.prototype,Vp=BF?WeakSet.prototype.has:null,NF=typeof WeakRef=="function"&&WeakRef.prototype,eA=NF?WeakRef.prototype.deref:null,VF=Boolean.prototype.valueOf,UF=Object.prototype.toString,jF=Function.prototype.toString,GF=String.prototype.match,cb=String.prototype.slice,lu=String.prototype.replace,HF=String.prototype.toUpperCase,tA=String.prototype.toLowerCase,Tk=RegExp.prototype.test,iA=Array.prototype.concat,Ml=Array.prototype.join,WF=Array.prototype.slice,nA=Math.floor,o1=typeof BigInt=="function"?BigInt.prototype.valueOf:null,xx=Object.getOwnPropertySymbols,s1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,qf=typeof Symbol=="function"&&typeof Symbol.iterator=="object",ns=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===qf||!0)?Symbol.toStringTag:null,Sk=Object.prototype.propertyIsEnumerable,rA=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(n){return n.__proto__}:null);function oA(n,i){if(n===1/0||n===-1/0||n!==n||n&&n>-1e3&&n<1e3||Tk.call(/e/,i))return i;var o=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof n=="number"){var c=n<0?-nA(-n):nA(n);if(c!==n){var h=String(c),p=cb.call(i,h.length+1);return lu.call(h,o,"$&_")+"."+lu.call(lu.call(p,/([0-9]{3})/g,"$&_"),/_$/,"")}}return lu.call(i,o,"$&_")}var a1=zF,sA=a1.custom,aA=Ek(sA)?sA:null,qF=function n(i,o,c,h){var p=o||{};if(su(p,"quoteStyle")&&p.quoteStyle!=="single"&&p.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(su(p,"maxStringLength")&&(typeof p.maxStringLength=="number"?p.maxStringLength<0&&p.maxStringLength!==1/0:p.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var g=su(p,"customInspect")?p.customInspect:!0;if(typeof g!="boolean"&&g!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(su(p,"indent")&&p.indent!==null&&p.indent!=="	"&&!(parseInt(p.indent,10)===p.indent&&p.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(su(p,"numericSeparator")&&typeof p.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var x=p.numericSeparator;if(typeof i>"u")return"undefined";if(i===null)return"null";if(typeof i=="boolean")return i?"true":"false";if(typeof i=="string")return Ik(i,p);if(typeof i=="number"){if(i===0)return 1/0/i>0?"0":"-0";var s=String(i);return x?oA(i,s):s}if(typeof i=="bigint"){var M=String(i)+"n";return x?oA(i,M):M}var C=typeof p.depth>"u"?5:p.depth;if(typeof c>"u"&&(c=0),c>=C&&C>0&&typeof i=="object")return l1(i)?"[Array]":"[Object]";var D=uB(p,c);if(typeof h>"u")h=[];else if(Ak(h,i)>=0)return"[Circular]";function F(Xe,Tt,Yt){if(Tt&&(h=WF.call(h),h.push(Tt)),Yt){var mi={depth:p.depth};return su(p,"quoteStyle")&&(mi.quoteStyle=p.quoteStyle),n(Xe,mi,c+1,h)}return n(Xe,p,c+1,h)}if(typeof i=="function"&&!lA(i)){var V=tB(i),X=r_(i,F);return"[Function"+(V?": "+V:" (anonymous)")+"]"+(X.length>0?" { "+Ml.call(X,", ")+" }":"")}if(Ek(i)){var W=qf?lu.call(String(i),/^(Symbol\(.*\))_[^)]*$/,"$1"):s1.call(i);return typeof i=="object"&&!qf?gp(W):W}if(aB(i)){for(var J="<"+tA.call(String(i.nodeName)),$=i.attributes||[],ne=0;ne<$.length;ne++)J+=" "+$[ne].name+"="+Mk(ZF($[ne].value),"double",p);return J+=">",i.childNodes&&i.childNodes.length&&(J+="..."),J+="</"+tA.call(String(i.nodeName))+">",J}if(l1(i)){if(i.length===0)return"[]";var ye=r_(i,F);return D&&!cB(ye)?"["+c1(ye,D)+"]":"[ "+Ml.call(ye,", ")+" ]"}if(YF(i)){var pe=r_(i,F);return!("cause"in Error.prototype)&&"cause"in i&&!Sk.call(i,"cause")?"{ ["+String(i)+"] "+Ml.call(iA.call("[cause]: "+F(i.cause),pe),", ")+" }":pe.length===0?"["+String(i)+"]":"{ ["+String(i)+"] "+Ml.call(pe,", ")+" }"}if(typeof i=="object"&&g){if(aA&&typeof i[aA]=="function"&&a1)return a1(i,{depth:C-c});if(g!=="symbol"&&typeof i.inspect=="function")return i.inspect()}if(iB(i)){var ke=[];return QE&&QE.call(i,function(Xe,Tt){ke.push(F(Tt,i,!0)+" => "+F(Xe,i))}),cA("Map",uy.call(i),ke,D)}if(oB(i)){var Ae=[];return $E&&$E.call(i,function(Xe){Ae.push(F(Xe,i))}),cA("Set",hy.call(i),Ae,D)}if(nB(i))return bx("WeakMap");if(sB(i))return bx("WeakSet");if(rB(i))return bx("WeakRef");if(KF(i))return gp(F(Number(i)));if($F(i))return gp(F(o1.call(i)));if(QF(i))return gp(VF.call(i));if(JF(i))return gp(F(String(i)));if(typeof window<"u"&&i===window)return"{ [object Window] }";if(i===vh)return"{ [object globalThis] }";if(!XF(i)&&!lA(i)){var tt=r_(i,F),pt=rA?rA(i)===Object.prototype:i instanceof Object||i.constructor===Object,kt=i instanceof Object?"":"null prototype",Ie=!pt&&ns&&Object(i)===i&&ns in i?cb.call(gu(i),8,-1):kt?"Object":"",Et=pt||typeof i.constructor!="function"?"":i.constructor.name?i.constructor.name+" ":"",mt=Et+(Ie||kt?"["+Ml.call(iA.call([],Ie||[],kt||[]),": ")+"] ":"");return tt.length===0?mt+"{}":D?mt+"{"+c1(tt,D)+"}":mt+"{ "+Ml.call(tt,", ")+" }"}return String(i)};function Mk(n,i,o){var c=(o.quoteStyle||i)==="double"?'"':"'";return c+n+c}function ZF(n){return lu.call(String(n),/"/g,"&quot;")}function l1(n){return gu(n)==="[object Array]"&&(!ns||!(typeof n=="object"&&ns in n))}function XF(n){return gu(n)==="[object Date]"&&(!ns||!(typeof n=="object"&&ns in n))}function lA(n){return gu(n)==="[object RegExp]"&&(!ns||!(typeof n=="object"&&ns in n))}function YF(n){return gu(n)==="[object Error]"&&(!ns||!(typeof n=="object"&&ns in n))}function JF(n){return gu(n)==="[object String]"&&(!ns||!(typeof n=="object"&&ns in n))}function KF(n){return gu(n)==="[object Number]"&&(!ns||!(typeof n=="object"&&ns in n))}function QF(n){return gu(n)==="[object Boolean]"&&(!ns||!(typeof n=="object"&&ns in n))}function Ek(n){if(qf)return n&&typeof n=="object"&&n instanceof Symbol;if(typeof n=="symbol")return!0;if(!n||typeof n!="object"||!s1)return!1;try{return s1.call(n),!0}catch{}return!1}function $F(n){if(!n||typeof n!="object"||!o1)return!1;try{return o1.call(n),!0}catch{}return!1}var eB=Object.prototype.hasOwnProperty||function(n){return n in this};function su(n,i){return eB.call(n,i)}function gu(n){return UF.call(n)}function tB(n){if(n.name)return n.name;var i=GF.call(jF.call(n),/^function\s*([\w$]+)/);return i?i[1]:null}function Ak(n,i){if(n.indexOf)return n.indexOf(i);for(var o=0,c=n.length;o<c;o++)if(n[o]===i)return o;return-1}function iB(n){if(!uy||!n||typeof n!="object")return!1;try{uy.call(n);try{hy.call(n)}catch{return!0}return n instanceof Map}catch{}return!1}function nB(n){if(!Np||!n||typeof n!="object")return!1;try{Np.call(n,Np);try{Vp.call(n,Vp)}catch{return!0}return n instanceof WeakMap}catch{}return!1}function rB(n){if(!eA||!n||typeof n!="object")return!1;try{return eA.call(n),!0}catch{}return!1}function oB(n){if(!hy||!n||typeof n!="object")return!1;try{hy.call(n);try{uy.call(n)}catch{return!0}return n instanceof Set}catch{}return!1}function sB(n){if(!Vp||!n||typeof n!="object")return!1;try{Vp.call(n,Vp);try{Np.call(n,Np)}catch{return!0}return n instanceof WeakSet}catch{}return!1}function aB(n){return!n||typeof n!="object"?!1:typeof HTMLElement<"u"&&n instanceof HTMLElement?!0:typeof n.nodeName=="string"&&typeof n.getAttribute=="function"}function Ik(n,i){if(n.length>i.maxStringLength){var o=n.length-i.maxStringLength,c="... "+o+" more character"+(o>1?"s":"");return Ik(cb.call(n,0,i.maxStringLength),i)+c}var h=lu.call(lu.call(n,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,lB);return Mk(h,"single",i)}function lB(n){var i=n.charCodeAt(0),o={8:"b",9:"t",10:"n",12:"f",13:"r"}[i];return o?"\\"+o:"\\x"+(i<16?"0":"")+HF.call(i.toString(16))}function gp(n){return"Object("+n+")"}function bx(n){return n+" { ? }"}function cA(n,i,o,c){var h=c?c1(o,c):Ml.call(o,", ");return n+" ("+i+") {"+h+"}"}function cB(n){for(var i=0;i<n.length;i++)if(Ak(n[i],`
`)>=0)return!1;return!0}function uB(n,i){var o;if(n.indent==="	")o="	";else if(typeof n.indent=="number"&&n.indent>0)o=Ml.call(Array(n.indent+1)," ");else return null;return{base:o,prev:Ml.call(Array(i+1),o)}}function c1(n,i){if(n.length===0)return"";var o=`
`+i.prev+i.base;return o+Ml.call(n,","+o)+`
`+i.prev}function r_(n,i){var o=l1(n),c=[];if(o){c.length=n.length;for(var h=0;h<n.length;h++)c[h]=su(n,h)?i(n[h],n):""}var p=typeof xx=="function"?xx(n):[],g;if(qf){g={};for(var x=0;x<p.length;x++)g["$"+p[x]]=p[x]}for(var s in n)su(n,s)&&(o&&String(Number(s))===s&&s<n.length||qf&&g["$"+s]instanceof Symbol||(Tk.call(/[^\w$]/,s)?c.push(i(s,n)+": "+i(n[s],n)):c.push(s+": "+i(n[s],n))));if(typeof xx=="function")for(var M=0;M<p.length;M++)Sk.call(n,p[M])&&c.push("["+i(p[M])+"]: "+i(n[p[M]],n));return c}var Ck=nd,rd=LF,hB=qF,fB=vm,o_=Ck("%WeakMap%",!0),s_=Ck("%Map%",!0),dB=rd("WeakMap.prototype.get",!0),pB=rd("WeakMap.prototype.set",!0),mB=rd("WeakMap.prototype.has",!0),gB=rd("Map.prototype.get",!0),_B=rd("Map.prototype.set",!0),yB=rd("Map.prototype.has",!0),ub=function(n,i){for(var o=n,c;(c=o.next)!==null;o=c)if(c.key===i)return o.next=c.next,c.next=n.next,n.next=c,c},vB=function(n,i){var o=ub(n,i);return o&&o.value},xB=function(n,i,o){var c=ub(n,i);c?c.value=o:n.next={key:i,next:n.next,value:o}},bB=function(n,i){return!!ub(n,i)},wB=function(){var i,o,c,h={assert:function(p){if(!h.has(p))throw new fB("Side channel does not contain "+hB(p))},get:function(p){if(o_&&p&&(typeof p=="object"||typeof p=="function")){if(i)return dB(i,p)}else if(s_){if(o)return gB(o,p)}else if(c)return vB(c,p)},has:function(p){if(o_&&p&&(typeof p=="object"||typeof p=="function")){if(i)return mB(i,p)}else if(s_){if(o)return yB(o,p)}else if(c)return bB(c,p);return!1},set:function(p,g){o_&&p&&(typeof p=="object"||typeof p=="function")?(i||(i=new o_),pB(i,p,g)):s_?(o||(o=new s_),_B(o,p,g)):(c||(c={key:{},next:null}),xB(c,p,g))}};return h},TB=String.prototype.replace,SB=/%20/g,wx={RFC1738:"RFC1738",RFC3986:"RFC3986"},hb={default:wx.RFC3986,formatters:{RFC1738:function(n){return TB.call(n,SB,"+")},RFC3986:function(n){return String(n)}},RFC1738:wx.RFC1738,RFC3986:wx.RFC3986},MB=hb,Tx=Object.prototype.hasOwnProperty,xh=Array.isArray,xl=function(){for(var n=[],i=0;i<256;++i)n.push("%"+((i<16?"0":"")+i.toString(16)).toUpperCase());return n}(),EB=function(i){for(;i.length>1;){var o=i.pop(),c=o.obj[o.prop];if(xh(c)){for(var h=[],p=0;p<c.length;++p)typeof c[p]<"u"&&h.push(c[p]);o.obj[o.prop]=h}}},Pk=function(i,o){for(var c=o&&o.plainObjects?Object.create(null):{},h=0;h<i.length;++h)typeof i[h]<"u"&&(c[h]=i[h]);return c},AB=function n(i,o,c){if(!o)return i;if(typeof o!="object"){if(xh(i))i.push(o);else if(i&&typeof i=="object")(c&&(c.plainObjects||c.allowPrototypes)||!Tx.call(Object.prototype,o))&&(i[o]=!0);else return[i,o];return i}if(!i||typeof i!="object")return[i].concat(o);var h=i;return xh(i)&&!xh(o)&&(h=Pk(i,c)),xh(i)&&xh(o)?(o.forEach(function(p,g){if(Tx.call(i,g)){var x=i[g];x&&typeof x=="object"&&p&&typeof p=="object"?i[g]=n(x,p,c):i.push(p)}else i[g]=p}),i):Object.keys(o).reduce(function(p,g){var x=o[g];return Tx.call(p,g)?p[g]=n(p[g],x,c):p[g]=x,p},h)},IB=function(i,o){return Object.keys(o).reduce(function(c,h){return c[h]=o[h],c},i)},CB=function(n,i,o){var c=n.replace(/\+/g," ");if(o==="iso-8859-1")return c.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(c)}catch{return c}},PB=function(i,o,c,h,p){if(i.length===0)return i;var g=i;if(typeof i=="symbol"?g=Symbol.prototype.toString.call(i):typeof i!="string"&&(g=String(i)),c==="iso-8859-1")return escape(g).replace(/%u[0-9a-f]{4}/gi,function(C){return"%26%23"+parseInt(C.slice(2),16)+"%3B"});for(var x="",s=0;s<g.length;++s){var M=g.charCodeAt(s);if(M===45||M===46||M===95||M===126||M>=48&&M<=57||M>=65&&M<=90||M>=97&&M<=122||p===MB.RFC1738&&(M===40||M===41)){x+=g.charAt(s);continue}if(M<128){x=x+xl[M];continue}if(M<2048){x=x+(xl[192|M>>6]+xl[128|M&63]);continue}if(M<55296||M>=57344){x=x+(xl[224|M>>12]+xl[128|M>>6&63]+xl[128|M&63]);continue}s+=1,M=65536+((M&1023)<<10|g.charCodeAt(s)&1023),x+=xl[240|M>>18]+xl[128|M>>12&63]+xl[128|M>>6&63]+xl[128|M&63]}return x},kB=function(i){for(var o=[{obj:{o:i},prop:"o"}],c=[],h=0;h<o.length;++h)for(var p=o[h],g=p.obj[p.prop],x=Object.keys(g),s=0;s<x.length;++s){var M=x[s],C=g[M];typeof C=="object"&&C!==null&&c.indexOf(C)===-1&&(o.push({obj:g,prop:M}),c.push(C))}return EB(o),i},DB=function(i){return Object.prototype.toString.call(i)==="[object RegExp]"},LB=function(i){return!i||typeof i!="object"?!1:!!(i.constructor&&i.constructor.isBuffer&&i.constructor.isBuffer(i))},OB=function(i,o){return[].concat(i,o)},RB=function(i,o){if(xh(i)){for(var c=[],h=0;h<i.length;h+=1)c.push(o(i[h]));return c}return o(i)},kk={arrayToObject:Pk,assign:IB,combine:OB,compact:kB,decode:CB,encode:PB,isBuffer:LB,isRegExp:DB,maybeMap:RB,merge:AB},Dk=wB,L_=kk,Up=hb,zB=Object.prototype.hasOwnProperty,Lk={brackets:function(i){return i+"[]"},comma:"comma",indices:function(i,o){return i+"["+o+"]"},repeat:function(i){return i}},Tl=Array.isArray,FB=Array.prototype.push,Ok=function(n,i){FB.apply(n,Tl(i)?i:[i])},BB=Date.prototype.toISOString,uA=Up.default,po={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:L_.encode,encodeValuesOnly:!1,format:uA,formatter:Up.formatters[uA],indices:!1,serializeDate:function(i){return BB.call(i)},skipNulls:!1,strictNullHandling:!1},NB=function(i){return typeof i=="string"||typeof i=="number"||typeof i=="boolean"||typeof i=="symbol"||typeof i=="bigint"},Sx={},VB=function n(i,o,c,h,p,g,x,s,M,C,D,F,V,X,W,J,$,ne){for(var ye=i,pe=ne,ke=0,Ae=!1;(pe=pe.get(Sx))!==void 0&&!Ae;){var tt=pe.get(i);if(ke+=1,typeof tt<"u"){if(tt===ke)throw new RangeError("Cyclic object value");Ae=!0}typeof pe.get(Sx)>"u"&&(ke=0)}if(typeof C=="function"?ye=C(o,ye):ye instanceof Date?ye=V(ye):c==="comma"&&Tl(ye)&&(ye=L_.maybeMap(ye,function(Ii){return Ii instanceof Date?V(Ii):Ii})),ye===null){if(g)return M&&!J?M(o,po.encoder,$,"key",X):o;ye=""}if(NB(ye)||L_.isBuffer(ye)){if(M){var pt=J?o:M(o,po.encoder,$,"key",X);return[W(pt)+"="+W(M(ye,po.encoder,$,"value",X))]}return[W(o)+"="+W(String(ye))]}var kt=[];if(typeof ye>"u")return kt;var Ie;if(c==="comma"&&Tl(ye))J&&M&&(ye=L_.maybeMap(ye,M)),Ie=[{value:ye.length>0?ye.join(",")||null:void 0}];else if(Tl(C))Ie=C;else{var Et=Object.keys(ye);Ie=D?Et.sort(D):Et}var mt=s?o.replace(/\./g,"%2E"):o,Xe=h&&Tl(ye)&&ye.length===1?mt+"[]":mt;if(p&&Tl(ye)&&ye.length===0)return Xe+"[]";for(var Tt=0;Tt<Ie.length;++Tt){var Yt=Ie[Tt],mi=typeof Yt=="object"&&typeof Yt.value<"u"?Yt.value:ye[Yt];if(!(x&&mi===null)){var Ti=F&&s?Yt.replace(/\./g,"%2E"):Yt,Zi=Tl(ye)?typeof c=="function"?c(Xe,Ti):Xe:Xe+(F?"."+Ti:"["+Ti+"]");ne.set(i,ke);var wt=Dk();wt.set(Sx,ne),Ok(kt,n(mi,Zi,c,h,p,g,x,s,c==="comma"&&J&&Tl(ye)?null:M,C,D,F,V,X,W,J,$,wt))}}return kt},UB=function(i){if(!i)return po;if(typeof i.allowEmptyArrays<"u"&&typeof i.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof i.encodeDotInKeys<"u"&&typeof i.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(i.encoder!==null&&typeof i.encoder<"u"&&typeof i.encoder!="function")throw new TypeError("Encoder has to be a function.");var o=i.charset||po.charset;if(typeof i.charset<"u"&&i.charset!=="utf-8"&&i.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var c=Up.default;if(typeof i.format<"u"){if(!zB.call(Up.formatters,i.format))throw new TypeError("Unknown format option provided.");c=i.format}var h=Up.formatters[c],p=po.filter;(typeof i.filter=="function"||Tl(i.filter))&&(p=i.filter);var g;if(i.arrayFormat in Lk?g=i.arrayFormat:"indices"in i?g=i.indices?"indices":"repeat":g=po.arrayFormat,"commaRoundTrip"in i&&typeof i.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var x=typeof i.allowDots>"u"?i.encodeDotInKeys===!0?!0:po.allowDots:!!i.allowDots;return{addQueryPrefix:typeof i.addQueryPrefix=="boolean"?i.addQueryPrefix:po.addQueryPrefix,allowDots:x,allowEmptyArrays:typeof i.allowEmptyArrays=="boolean"?!!i.allowEmptyArrays:po.allowEmptyArrays,arrayFormat:g,charset:o,charsetSentinel:typeof i.charsetSentinel=="boolean"?i.charsetSentinel:po.charsetSentinel,commaRoundTrip:i.commaRoundTrip,delimiter:typeof i.delimiter>"u"?po.delimiter:i.delimiter,encode:typeof i.encode=="boolean"?i.encode:po.encode,encodeDotInKeys:typeof i.encodeDotInKeys=="boolean"?i.encodeDotInKeys:po.encodeDotInKeys,encoder:typeof i.encoder=="function"?i.encoder:po.encoder,encodeValuesOnly:typeof i.encodeValuesOnly=="boolean"?i.encodeValuesOnly:po.encodeValuesOnly,filter:p,format:c,formatter:h,serializeDate:typeof i.serializeDate=="function"?i.serializeDate:po.serializeDate,skipNulls:typeof i.skipNulls=="boolean"?i.skipNulls:po.skipNulls,sort:typeof i.sort=="function"?i.sort:null,strictNullHandling:typeof i.strictNullHandling=="boolean"?i.strictNullHandling:po.strictNullHandling}},jB=function(n,i){var o=n,c=UB(i),h,p;typeof c.filter=="function"?(p=c.filter,o=p("",o)):Tl(c.filter)&&(p=c.filter,h=p);var g=[];if(typeof o!="object"||o===null)return"";var x=Lk[c.arrayFormat],s=x==="comma"&&c.commaRoundTrip;h||(h=Object.keys(o)),c.sort&&h.sort(c.sort);for(var M=Dk(),C=0;C<h.length;++C){var D=h[C];c.skipNulls&&o[D]===null||Ok(g,VB(o[D],D,x,s,c.allowEmptyArrays,c.strictNullHandling,c.skipNulls,c.encodeDotInKeys,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.format,c.formatter,c.encodeValuesOnly,c.charset,M))}var F=g.join(c.delimiter),V=c.addQueryPrefix===!0?"?":"";return c.charsetSentinel&&(c.charset==="iso-8859-1"?V+="utf8=%26%2310003%3B&":V+="utf8=%E2%9C%93&"),F.length>0?V+F:""},Zf=kk,u1=Object.prototype.hasOwnProperty,GB=Array.isArray,to={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!0,decoder:Zf.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},HB=function(n){return n.replace(/&#(\d+);/g,function(i,o){return String.fromCharCode(parseInt(o,10))})},Rk=function(n,i){return n&&typeof n=="string"&&i.comma&&n.indexOf(",")>-1?n.split(","):n},WB="utf8=%26%2310003%3B",qB="utf8=%E2%9C%93",ZB=function(i,o){var c={__proto__:null},h=o.ignoreQueryPrefix?i.replace(/^\?/,""):i,p=o.parameterLimit===1/0?void 0:o.parameterLimit,g=h.split(o.delimiter,p),x=-1,s,M=o.charset;if(o.charsetSentinel)for(s=0;s<g.length;++s)g[s].indexOf("utf8=")===0&&(g[s]===qB?M="utf-8":g[s]===WB&&(M="iso-8859-1"),x=s,s=g.length);for(s=0;s<g.length;++s)if(s!==x){var C=g[s],D=C.indexOf("]="),F=D===-1?C.indexOf("="):D+1,V,X;F===-1?(V=o.decoder(C,to.decoder,M,"key"),X=o.strictNullHandling?null:""):(V=o.decoder(C.slice(0,F),to.decoder,M,"key"),X=Zf.maybeMap(Rk(C.slice(F+1),o),function(J){return o.decoder(J,to.decoder,M,"value")})),X&&o.interpretNumericEntities&&M==="iso-8859-1"&&(X=HB(X)),C.indexOf("[]=")>-1&&(X=GB(X)?[X]:X);var W=u1.call(c,V);W&&o.duplicates==="combine"?c[V]=Zf.combine(c[V],X):(!W||o.duplicates==="last")&&(c[V]=X)}return c},XB=function(n,i,o,c){for(var h=c?i:Rk(i,o),p=n.length-1;p>=0;--p){var g,x=n[p];if(x==="[]"&&o.parseArrays)g=o.allowEmptyArrays&&h===""?[]:[].concat(h);else{g=o.plainObjects?Object.create(null):{};var s=x.charAt(0)==="["&&x.charAt(x.length-1)==="]"?x.slice(1,-1):x,M=o.decodeDotInKeys?s.replace(/%2E/g,"."):s,C=parseInt(M,10);!o.parseArrays&&M===""?g={0:h}:!isNaN(C)&&x!==M&&String(C)===M&&C>=0&&o.parseArrays&&C<=o.arrayLimit?(g=[],g[C]=h):M!=="__proto__"&&(g[M]=h)}h=g}return h},YB=function(i,o,c,h){if(i){var p=c.allowDots?i.replace(/\.([^.[]+)/g,"[$1]"):i,g=/(\[[^[\]]*])/,x=/(\[[^[\]]*])/g,s=c.depth>0&&g.exec(p),M=s?p.slice(0,s.index):p,C=[];if(M){if(!c.plainObjects&&u1.call(Object.prototype,M)&&!c.allowPrototypes)return;C.push(M)}for(var D=0;c.depth>0&&(s=x.exec(p))!==null&&D<c.depth;){if(D+=1,!c.plainObjects&&u1.call(Object.prototype,s[1].slice(1,-1))&&!c.allowPrototypes)return;C.push(s[1])}return s&&C.push("["+p.slice(s.index)+"]"),XB(C,o,c,h)}},JB=function(i){if(!i)return to;if(typeof i.allowEmptyArrays<"u"&&typeof i.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof i.decodeDotInKeys<"u"&&typeof i.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(i.decoder!==null&&typeof i.decoder<"u"&&typeof i.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof i.charset<"u"&&i.charset!=="utf-8"&&i.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var o=typeof i.charset>"u"?to.charset:i.charset,c=typeof i.duplicates>"u"?to.duplicates:i.duplicates;if(c!=="combine"&&c!=="first"&&c!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var h=typeof i.allowDots>"u"?i.decodeDotInKeys===!0?!0:to.allowDots:!!i.allowDots;return{allowDots:h,allowEmptyArrays:typeof i.allowEmptyArrays=="boolean"?!!i.allowEmptyArrays:to.allowEmptyArrays,allowPrototypes:typeof i.allowPrototypes=="boolean"?i.allowPrototypes:to.allowPrototypes,allowSparse:typeof i.allowSparse=="boolean"?i.allowSparse:to.allowSparse,arrayLimit:typeof i.arrayLimit=="number"?i.arrayLimit:to.arrayLimit,charset:o,charsetSentinel:typeof i.charsetSentinel=="boolean"?i.charsetSentinel:to.charsetSentinel,comma:typeof i.comma=="boolean"?i.comma:to.comma,decodeDotInKeys:typeof i.decodeDotInKeys=="boolean"?i.decodeDotInKeys:to.decodeDotInKeys,decoder:typeof i.decoder=="function"?i.decoder:to.decoder,delimiter:typeof i.delimiter=="string"||Zf.isRegExp(i.delimiter)?i.delimiter:to.delimiter,depth:typeof i.depth=="number"||i.depth===!1?+i.depth:to.depth,duplicates:c,ignoreQueryPrefix:i.ignoreQueryPrefix===!0,interpretNumericEntities:typeof i.interpretNumericEntities=="boolean"?i.interpretNumericEntities:to.interpretNumericEntities,parameterLimit:typeof i.parameterLimit=="number"?i.parameterLimit:to.parameterLimit,parseArrays:i.parseArrays!==!1,plainObjects:typeof i.plainObjects=="boolean"?i.plainObjects:to.plainObjects,strictNullHandling:typeof i.strictNullHandling=="boolean"?i.strictNullHandling:to.strictNullHandling}},KB=function(n,i){var o=JB(i);if(n===""||n===null||typeof n>"u")return o.plainObjects?Object.create(null):{};for(var c=typeof n=="string"?ZB(n,o):n,h=o.plainObjects?Object.create(null):{},p=Object.keys(c),g=0;g<p.length;++g){var x=p[g],s=YB(x,c[x],o,typeof n=="string");h=Zf.merge(h,s,o)}return o.allowSparse===!0?h:Zf.compact(h)},QB=jB,$B=KB,e6=hb,t6={formats:e6,parse:$B,stringify:QB};const fq=qP(t6);/*!
 * @kurkle/color v0.3.2
 * https://github.com/kurkle/color#readme
 * (c) 2023 Jukka Kurkela
 * Released under the MIT License
 */function bm(n){return n+.5|0}const cu=(n,i,o)=>Math.max(Math.min(n,o),i);function Ap(n){return cu(bm(n*2.55),0,255)}function du(n){return cu(bm(n*255),0,255)}function _c(n){return cu(bm(n/2.55)/100,0,1)}function hA(n){return cu(bm(n*100),0,100)}const ma={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},h1=[..."0123456789ABCDEF"],i6=n=>h1[n&15],n6=n=>h1[(n&240)>>4]+h1[n&15],a_=n=>(n&240)>>4===(n&15),r6=n=>a_(n.r)&&a_(n.g)&&a_(n.b)&&a_(n.a);function o6(n){var i=n.length,o;return n[0]==="#"&&(i===4||i===5?o={r:255&ma[n[1]]*17,g:255&ma[n[2]]*17,b:255&ma[n[3]]*17,a:i===5?ma[n[4]]*17:255}:(i===7||i===9)&&(o={r:ma[n[1]]<<4|ma[n[2]],g:ma[n[3]]<<4|ma[n[4]],b:ma[n[5]]<<4|ma[n[6]],a:i===9?ma[n[7]]<<4|ma[n[8]]:255})),o}const s6=(n,i)=>n<255?i(n):"";function a6(n){var i=r6(n)?i6:n6;return n?"#"+i(n.r)+i(n.g)+i(n.b)+s6(n.a,i):void 0}const l6=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function zk(n,i,o){const c=i*Math.min(o,1-o),h=(p,g=(p+n/30)%12)=>o-c*Math.max(Math.min(g-3,9-g,1),-1);return[h(0),h(8),h(4)]}function c6(n,i,o){const c=(h,p=(h+n/60)%6)=>o-o*i*Math.max(Math.min(p,4-p,1),0);return[c(5),c(3),c(1)]}function u6(n,i,o){const c=zk(n,1,.5);let h;for(i+o>1&&(h=1/(i+o),i*=h,o*=h),h=0;h<3;h++)c[h]*=1-i-o,c[h]+=i;return c}function h6(n,i,o,c,h){return n===h?(i-o)/c+(i<o?6:0):i===h?(o-n)/c+2:(n-i)/c+4}function fb(n){const o=n.r/255,c=n.g/255,h=n.b/255,p=Math.max(o,c,h),g=Math.min(o,c,h),x=(p+g)/2;let s,M,C;return p!==g&&(C=p-g,M=x>.5?C/(2-p-g):C/(p+g),s=h6(o,c,h,C,p),s=s*60+.5),[s|0,M||0,x]}function db(n,i,o,c){return(Array.isArray(i)?n(i[0],i[1],i[2]):n(i,o,c)).map(du)}function pb(n,i,o){return db(zk,n,i,o)}function f6(n,i,o){return db(u6,n,i,o)}function d6(n,i,o){return db(c6,n,i,o)}function Fk(n){return(n%360+360)%360}function p6(n){const i=l6.exec(n);let o=255,c;if(!i)return;i[5]!==c&&(o=i[6]?Ap(+i[5]):du(+i[5]));const h=Fk(+i[2]),p=+i[3]/100,g=+i[4]/100;return i[1]==="hwb"?c=f6(h,p,g):i[1]==="hsv"?c=d6(h,p,g):c=pb(h,p,g),{r:c[0],g:c[1],b:c[2],a:o}}function m6(n,i){var o=fb(n);o[0]=Fk(o[0]+i),o=pb(o),n.r=o[0],n.g=o[1],n.b=o[2]}function g6(n){if(!n)return;const i=fb(n),o=i[0],c=hA(i[1]),h=hA(i[2]);return n.a<255?`hsla(${o}, ${c}%, ${h}%, ${_c(n.a)})`:`hsl(${o}, ${c}%, ${h}%)`}const fA={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},dA={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function _6(){const n={},i=Object.keys(dA),o=Object.keys(fA);let c,h,p,g,x;for(c=0;c<i.length;c++){for(g=x=i[c],h=0;h<o.length;h++)p=o[h],x=x.replace(p,fA[p]);p=parseInt(dA[g],16),n[x]=[p>>16&255,p>>8&255,p&255]}return n}let l_;function y6(n){l_||(l_=_6(),l_.transparent=[0,0,0,0]);const i=l_[n.toLowerCase()];return i&&{r:i[0],g:i[1],b:i[2],a:i.length===4?i[3]:255}}const v6=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function x6(n){const i=v6.exec(n);let o=255,c,h,p;if(i){if(i[7]!==c){const g=+i[7];o=i[8]?Ap(g):cu(g*255,0,255)}return c=+i[1],h=+i[3],p=+i[5],c=255&(i[2]?Ap(c):cu(c,0,255)),h=255&(i[4]?Ap(h):cu(h,0,255)),p=255&(i[6]?Ap(p):cu(p,0,255)),{r:c,g:h,b:p,a:o}}}function b6(n){return n&&(n.a<255?`rgba(${n.r}, ${n.g}, ${n.b}, ${_c(n.a)})`:`rgb(${n.r}, ${n.g}, ${n.b})`)}const Mx=n=>n<=.0031308?n*12.92:Math.pow(n,1/2.4)*1.055-.055,Af=n=>n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4);function w6(n,i,o){const c=Af(_c(n.r)),h=Af(_c(n.g)),p=Af(_c(n.b));return{r:du(Mx(c+o*(Af(_c(i.r))-c))),g:du(Mx(h+o*(Af(_c(i.g))-h))),b:du(Mx(p+o*(Af(_c(i.b))-p))),a:n.a+o*(i.a-n.a)}}function c_(n,i,o){if(n){let c=fb(n);c[i]=Math.max(0,Math.min(c[i]+c[i]*o,i===0?360:1)),c=pb(c),n.r=c[0],n.g=c[1],n.b=c[2]}}function Bk(n,i){return n&&Object.assign(i||{},n)}function pA(n){var i={r:0,g:0,b:0,a:255};return Array.isArray(n)?n.length>=3&&(i={r:n[0],g:n[1],b:n[2],a:255},n.length>3&&(i.a=du(n[3]))):(i=Bk(n,{r:0,g:0,b:0,a:1}),i.a=du(i.a)),i}function T6(n){return n.charAt(0)==="r"?x6(n):p6(n)}let Nk=class f1{constructor(i){if(i instanceof f1)return i;const o=typeof i;let c;o==="object"?c=pA(i):o==="string"&&(c=o6(i)||y6(i)||T6(i)),this._rgb=c,this._valid=!!c}get valid(){return this._valid}get rgb(){var i=Bk(this._rgb);return i&&(i.a=_c(i.a)),i}set rgb(i){this._rgb=pA(i)}rgbString(){return this._valid?b6(this._rgb):void 0}hexString(){return this._valid?a6(this._rgb):void 0}hslString(){return this._valid?g6(this._rgb):void 0}mix(i,o){if(i){const c=this.rgb,h=i.rgb;let p;const g=o===p?.5:o,x=2*g-1,s=c.a-h.a,M=((x*s===-1?x:(x+s)/(1+x*s))+1)/2;p=1-M,c.r=255&M*c.r+p*h.r+.5,c.g=255&M*c.g+p*h.g+.5,c.b=255&M*c.b+p*h.b+.5,c.a=g*c.a+(1-g)*h.a,this.rgb=c}return this}interpolate(i,o){return i&&(this._rgb=w6(this._rgb,i._rgb,o)),this}clone(){return new f1(this.rgb)}alpha(i){return this._rgb.a=du(i),this}clearer(i){const o=this._rgb;return o.a*=1-i,this}greyscale(){const i=this._rgb,o=bm(i.r*.3+i.g*.59+i.b*.11);return i.r=i.g=i.b=o,this}opaquer(i){const o=this._rgb;return o.a*=1+i,this}negate(){const i=this._rgb;return i.r=255-i.r,i.g=255-i.g,i.b=255-i.b,this}lighten(i){return c_(this._rgb,2,i),this}darken(i){return c_(this._rgb,2,-i),this}saturate(i){return c_(this._rgb,1,i),this}desaturate(i){return c_(this._rgb,1,-i),this}rotate(i){return m6(this._rgb,i),this}};/*!
 * Chart.js v4.4.2
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */function hc(){}const S6=(()=>{let n=0;return()=>n++})();function Wn(n){return n===null||typeof n>"u"}function kr(n){if(Array.isArray&&Array.isArray(n))return!0;const i=Object.prototype.toString.call(n);return i.slice(0,7)==="[object"&&i.slice(-6)==="Array]"}function Dn(n){return n!==null&&Object.prototype.toString.call(n)==="[object Object]"}function Hr(n){return(typeof n=="number"||n instanceof Number)&&isFinite(+n)}function Qs(n,i){return Hr(n)?n:i}function mn(n,i){return typeof n>"u"?i:n}const M6=(n,i)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100:+n/i,Vk=(n,i)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100*i:+n;function Tr(n,i,o){if(n&&typeof n.call=="function")return n.apply(o,i)}function hr(n,i,o,c){let h,p,g;if(kr(n))if(p=n.length,c)for(h=p-1;h>=0;h--)i.call(o,n[h],h);else for(h=0;h<p;h++)i.call(o,n[h],h);else if(Dn(n))for(g=Object.keys(n),p=g.length,h=0;h<p;h++)i.call(o,n[g[h]],g[h])}function fy(n,i){let o,c,h,p;if(!n||!i||n.length!==i.length)return!1;for(o=0,c=n.length;o<c;++o)if(h=n[o],p=i[o],h.datasetIndex!==p.datasetIndex||h.index!==p.index)return!1;return!0}function dy(n){if(kr(n))return n.map(dy);if(Dn(n)){const i=Object.create(null),o=Object.keys(n),c=o.length;let h=0;for(;h<c;++h)i[o[h]]=dy(n[o[h]]);return i}return n}function Uk(n){return["__proto__","prototype","constructor"].indexOf(n)===-1}function E6(n,i,o,c){if(!Uk(n))return;const h=i[n],p=o[n];Dn(h)&&Dn(p)?Qp(h,p,c):i[n]=dy(p)}function Qp(n,i,o){const c=kr(i)?i:[i],h=c.length;if(!Dn(n))return n;o=o||{};const p=o.merger||E6;let g;for(let x=0;x<h;++x){if(g=c[x],!Dn(g))continue;const s=Object.keys(g);for(let M=0,C=s.length;M<C;++M)p(s[M],n,g,o)}return n}function jp(n,i){return Qp(n,i,{merger:A6})}function A6(n,i,o){if(!Uk(n))return;const c=i[n],h=o[n];Dn(c)&&Dn(h)?jp(c,h):Object.prototype.hasOwnProperty.call(i,n)||(i[n]=dy(h))}const mA={"":n=>n,x:n=>n.x,y:n=>n.y};function I6(n){const i=n.split("."),o=[];let c="";for(const h of i)c+=h,c.endsWith("\\")?c=c.slice(0,-1)+".":(o.push(c),c="");return o}function C6(n){const i=I6(n);return o=>{for(const c of i){if(c==="")break;o=o&&o[c]}return o}}function pu(n,i){return(mA[i]||(mA[i]=C6(i)))(n)}function mb(n){return n.charAt(0).toUpperCase()+n.slice(1)}const $p=n=>typeof n<"u",mu=n=>typeof n=="function",gA=(n,i)=>{if(n.size!==i.size)return!1;for(const o of n)if(!i.has(o))return!1;return!0};function P6(n){return n.type==="mouseup"||n.type==="click"||n.type==="contextmenu"}const Lr=Math.PI,Dr=2*Lr,k6=Dr+Lr,py=Number.POSITIVE_INFINITY,D6=Lr/180,io=Lr/2,dh=Lr/4,_A=Lr*2/3,uu=Math.log10,Al=Math.sign;function Gp(n,i,o){return Math.abs(n-i)<o}function yA(n){const i=Math.round(n);n=Gp(n,i,n/1e3)?i:n;const o=Math.pow(10,Math.floor(uu(n))),c=n/o;return(c<=1?1:c<=2?2:c<=5?5:10)*o}function L6(n){const i=[],o=Math.sqrt(n);let c;for(c=1;c<o;c++)n%c===0&&(i.push(c),i.push(n/c));return o===(o|0)&&i.push(o),i.sort((h,p)=>h-p).pop(),i}function Xf(n){return!isNaN(parseFloat(n))&&isFinite(n)}function O6(n,i){const o=Math.round(n);return o-i<=n&&o+i>=n}function jk(n,i,o){let c,h,p;for(c=0,h=n.length;c<h;c++)p=n[c][o],isNaN(p)||(i.min=Math.min(i.min,p),i.max=Math.max(i.max,p))}function Xa(n){return n*(Lr/180)}function gb(n){return n*(180/Lr)}function vA(n){if(!Hr(n))return;let i=1,o=0;for(;Math.round(n*i)/i!==n;)i*=10,o++;return o}function Gk(n,i){const o=i.x-n.x,c=i.y-n.y,h=Math.sqrt(o*o+c*c);let p=Math.atan2(c,o);return p<-.5*Lr&&(p+=Dr),{angle:p,distance:h}}function d1(n,i){return Math.sqrt(Math.pow(i.x-n.x,2)+Math.pow(i.y-n.y,2))}function R6(n,i){return(n-i+k6)%Dr-Lr}function $s(n){return(n%Dr+Dr)%Dr}function em(n,i,o,c){const h=$s(n),p=$s(i),g=$s(o),x=$s(p-h),s=$s(g-h),M=$s(h-p),C=$s(h-g);return h===p||h===g||c&&p===g||x>s&&M<C}function Eo(n,i,o){return Math.max(i,Math.min(o,n))}function z6(n){return Eo(n,-32768,32767)}function xc(n,i,o,c=1e-6){return n>=Math.min(i,o)-c&&n<=Math.max(i,o)+c}function _b(n,i,o){o=o||(g=>n[g]<i);let c=n.length-1,h=0,p;for(;c-h>1;)p=h+c>>1,o(p)?h=p:c=p;return{lo:h,hi:c}}const bc=(n,i,o,c)=>_b(n,o,c?h=>{const p=n[h][i];return p<o||p===o&&n[h+1][i]===o}:h=>n[h][i]<o),F6=(n,i,o)=>_b(n,o,c=>n[c][i]>=o);function B6(n,i,o){let c=0,h=n.length;for(;c<h&&n[c]<i;)c++;for(;h>c&&n[h-1]>o;)h--;return c>0||h<n.length?n.slice(c,h):n}const Hk=["push","pop","shift","splice","unshift"];function N6(n,i){if(n._chartjs){n._chartjs.listeners.push(i);return}Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[i]}}),Hk.forEach(o=>{const c="_onData"+mb(o),h=n[o];Object.defineProperty(n,o,{configurable:!0,enumerable:!1,value(...p){const g=h.apply(this,p);return n._chartjs.listeners.forEach(x=>{typeof x[c]=="function"&&x[c](...p)}),g}})})}function xA(n,i){const o=n._chartjs;if(!o)return;const c=o.listeners,h=c.indexOf(i);h!==-1&&c.splice(h,1),!(c.length>0)&&(Hk.forEach(p=>{delete n[p]}),delete n._chartjs)}function Wk(n){const i=new Set(n);return i.size===n.length?n:Array.from(i)}const qk=function(){return typeof window>"u"?function(n){return n()}:window.requestAnimationFrame}();function Zk(n,i){let o=[],c=!1;return function(...h){o=h,c||(c=!0,qk.call(window,()=>{c=!1,n.apply(i,o)}))}}function V6(n,i){let o;return function(...c){return i?(clearTimeout(o),o=setTimeout(n,i,c)):n.apply(this,c),i}}const yb=n=>n==="start"?"left":n==="end"?"right":"center",$o=(n,i,o)=>n==="start"?i:n==="end"?o:(i+o)/2,U6=(n,i,o,c)=>n===(c?"left":"right")?o:n==="center"?(i+o)/2:i;function Xk(n,i,o){const c=i.length;let h=0,p=c;if(n._sorted){const{iScale:g,_parsed:x}=n,s=g.axis,{min:M,max:C,minDefined:D,maxDefined:F}=g.getUserBounds();D&&(h=Eo(Math.min(bc(x,s,M).lo,o?c:bc(i,s,g.getPixelForValue(M)).lo),0,c-1)),F?p=Eo(Math.max(bc(x,g.axis,C,!0).hi+1,o?0:bc(i,s,g.getPixelForValue(C),!0).hi+1),h,c)-h:p=c-h}return{start:h,count:p}}function Yk(n){const{xScale:i,yScale:o,_scaleRanges:c}=n,h={xmin:i.min,xmax:i.max,ymin:o.min,ymax:o.max};if(!c)return n._scaleRanges=h,!0;const p=c.xmin!==i.min||c.xmax!==i.max||c.ymin!==o.min||c.ymax!==o.max;return Object.assign(c,h),p}const u_=n=>n===0||n===1,bA=(n,i,o)=>-(Math.pow(2,10*(n-=1))*Math.sin((n-i)*Dr/o)),wA=(n,i,o)=>Math.pow(2,-10*n)*Math.sin((n-i)*Dr/o)+1,Hp={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>-n*(n-2),easeInOutQuad:n=>(n/=.5)<1?.5*n*n:-.5*(--n*(n-2)-1),easeInCubic:n=>n*n*n,easeOutCubic:n=>(n-=1)*n*n+1,easeInOutCubic:n=>(n/=.5)<1?.5*n*n*n:.5*((n-=2)*n*n+2),easeInQuart:n=>n*n*n*n,easeOutQuart:n=>-((n-=1)*n*n*n-1),easeInOutQuart:n=>(n/=.5)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2),easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>(n-=1)*n*n*n*n+1,easeInOutQuint:n=>(n/=.5)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2),easeInSine:n=>-Math.cos(n*io)+1,easeOutSine:n=>Math.sin(n*io),easeInOutSine:n=>-.5*(Math.cos(Lr*n)-1),easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:-Math.pow(2,-10*n)+1,easeInOutExpo:n=>u_(n)?n:n<.5?.5*Math.pow(2,10*(n*2-1)):.5*(-Math.pow(2,-10*(n*2-1))+2),easeInCirc:n=>n>=1?n:-(Math.sqrt(1-n*n)-1),easeOutCirc:n=>Math.sqrt(1-(n-=1)*n),easeInOutCirc:n=>(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1),easeInElastic:n=>u_(n)?n:bA(n,.075,.3),easeOutElastic:n=>u_(n)?n:wA(n,.075,.3),easeInOutElastic(n){return u_(n)?n:n<.5?.5*bA(n*2,.1125,.45):.5+.5*wA(n*2-1,.1125,.45)},easeInBack(n){return n*n*((1.70158+1)*n-1.70158)},easeOutBack(n){return(n-=1)*n*((1.70158+1)*n+1.70158)+1},easeInOutBack(n){let i=1.70158;return(n/=.5)<1?.5*(n*n*(((i*=1.525)+1)*n-i)):.5*((n-=2)*n*(((i*=1.525)+1)*n+i)+2)},easeInBounce:n=>1-Hp.easeOutBounce(1-n),easeOutBounce(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},easeInOutBounce:n=>n<.5?Hp.easeInBounce(n*2)*.5:Hp.easeOutBounce(n*2-1)*.5+.5};function vb(n){if(n&&typeof n=="object"){const i=n.toString();return i==="[object CanvasPattern]"||i==="[object CanvasGradient]"}return!1}function TA(n){return vb(n)?n:new Nk(n)}function Ex(n){return vb(n)?n:new Nk(n).saturate(.5).darken(.1).hexString()}const j6=["x","y","borderWidth","radius","tension"],G6=["color","borderColor","backgroundColor"];function H6(n){n.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),n.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:i=>i!=="onProgress"&&i!=="onComplete"&&i!=="fn"}),n.set("animations",{colors:{type:"color",properties:G6},numbers:{type:"number",properties:j6}}),n.describe("animations",{_fallback:"animation"}),n.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:i=>i|0}}}})}function W6(n){n.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const SA=new Map;function q6(n,i){i=i||{};const o=n+JSON.stringify(i);let c=SA.get(o);return c||(c=new Intl.NumberFormat(n,i),SA.set(o,c)),c}function wm(n,i,o){return q6(i,o).format(n)}const Jk={values(n){return kr(n)?n:""+n},numeric(n,i,o){if(n===0)return"0";const c=this.chart.options.locale;let h,p=n;if(o.length>1){const M=Math.max(Math.abs(o[0].value),Math.abs(o[o.length-1].value));(M<1e-4||M>1e15)&&(h="scientific"),p=Z6(n,o)}const g=uu(Math.abs(p)),x=isNaN(g)?1:Math.max(Math.min(-1*Math.floor(g),20),0),s={notation:h,minimumFractionDigits:x,maximumFractionDigits:x};return Object.assign(s,this.options.ticks.format),wm(n,c,s)},logarithmic(n,i,o){if(n===0)return"0";const c=o[i].significand||n/Math.pow(10,Math.floor(uu(n)));return[1,2,3,5,10,15].includes(c)||i>.8*o.length?Jk.numeric.call(this,n,i,o):""}};function Z6(n,i){let o=i.length>3?i[2].value-i[1].value:i[1].value-i[0].value;return Math.abs(o)>=1&&n!==Math.floor(n)&&(o=n-Math.floor(n)),o}var Xy={formatters:Jk};function X6(n){n.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(i,o)=>o.lineWidth,tickColor:(i,o)=>o.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Xy.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),n.route("scale.ticks","color","","color"),n.route("scale.grid","color","","borderColor"),n.route("scale.border","color","","borderColor"),n.route("scale.title","color","","color"),n.describe("scale",{_fallback:!1,_scriptable:i=>!i.startsWith("before")&&!i.startsWith("after")&&i!=="callback"&&i!=="parser",_indexable:i=>i!=="borderDash"&&i!=="tickBorderDash"&&i!=="dash"}),n.describe("scales",{_fallback:"scale"}),n.describe("scale.ticks",{_scriptable:i=>i!=="backdropPadding"&&i!=="callback",_indexable:i=>i!=="backdropPadding"})}const kh=Object.create(null),p1=Object.create(null);function Wp(n,i){if(!i)return n;const o=i.split(".");for(let c=0,h=o.length;c<h;++c){const p=o[c];n=n[p]||(n[p]=Object.create(null))}return n}function Ax(n,i,o){return typeof i=="string"?Qp(Wp(n,i),o):Qp(Wp(n,""),i)}class Y6{constructor(i,o){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=c=>c.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(c,h)=>Ex(h.backgroundColor),this.hoverBorderColor=(c,h)=>Ex(h.borderColor),this.hoverColor=(c,h)=>Ex(h.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(i),this.apply(o)}set(i,o){return Ax(this,i,o)}get(i){return Wp(this,i)}describe(i,o){return Ax(p1,i,o)}override(i,o){return Ax(kh,i,o)}route(i,o,c,h){const p=Wp(this,i),g=Wp(this,c),x="_"+o;Object.defineProperties(p,{[x]:{value:p[o],writable:!0},[o]:{enumerable:!0,get(){const s=this[x],M=g[h];return Dn(s)?Object.assign({},M,s):mn(s,M)},set(s){this[x]=s}}})}apply(i){i.forEach(o=>o(this))}}var Wr=new Y6({_scriptable:n=>!n.startsWith("on"),_indexable:n=>n!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[H6,W6,X6]);function J6(n){return!n||Wn(n.size)||Wn(n.family)?null:(n.style?n.style+" ":"")+(n.weight?n.weight+" ":"")+n.size+"px "+n.family}function my(n,i,o,c,h){let p=i[h];return p||(p=i[h]=n.measureText(h).width,o.push(h)),p>c&&(c=p),c}function K6(n,i,o,c){c=c||{};let h=c.data=c.data||{},p=c.garbageCollect=c.garbageCollect||[];c.font!==i&&(h=c.data={},p=c.garbageCollect=[],c.font=i),n.save(),n.font=i;let g=0;const x=o.length;let s,M,C,D,F;for(s=0;s<x;s++)if(D=o[s],D!=null&&!kr(D))g=my(n,h,p,g,D);else if(kr(D))for(M=0,C=D.length;M<C;M++)F=D[M],F!=null&&!kr(F)&&(g=my(n,h,p,g,F));n.restore();const V=p.length/2;if(V>o.length){for(s=0;s<V;s++)delete h[p[s]];p.splice(0,V)}return g}function ph(n,i,o){const c=n.currentDevicePixelRatio,h=o!==0?Math.max(o/2,.5):0;return Math.round((i-h)*c)/c+h}function MA(n,i){i=i||n.getContext("2d"),i.save(),i.resetTransform(),i.clearRect(0,0,n.width,n.height),i.restore()}function m1(n,i,o,c){Kk(n,i,o,c,null)}function Kk(n,i,o,c,h){let p,g,x,s,M,C,D,F;const V=i.pointStyle,X=i.rotation,W=i.radius;let J=(X||0)*D6;if(V&&typeof V=="object"&&(p=V.toString(),p==="[object HTMLImageElement]"||p==="[object HTMLCanvasElement]")){n.save(),n.translate(o,c),n.rotate(J),n.drawImage(V,-V.width/2,-V.height/2,V.width,V.height),n.restore();return}if(!(isNaN(W)||W<=0)){switch(n.beginPath(),V){default:h?n.ellipse(o,c,h/2,W,0,0,Dr):n.arc(o,c,W,0,Dr),n.closePath();break;case"triangle":C=h?h/2:W,n.moveTo(o+Math.sin(J)*C,c-Math.cos(J)*W),J+=_A,n.lineTo(o+Math.sin(J)*C,c-Math.cos(J)*W),J+=_A,n.lineTo(o+Math.sin(J)*C,c-Math.cos(J)*W),n.closePath();break;case"rectRounded":M=W*.516,s=W-M,g=Math.cos(J+dh)*s,D=Math.cos(J+dh)*(h?h/2-M:s),x=Math.sin(J+dh)*s,F=Math.sin(J+dh)*(h?h/2-M:s),n.arc(o-D,c-x,M,J-Lr,J-io),n.arc(o+F,c-g,M,J-io,J),n.arc(o+D,c+x,M,J,J+io),n.arc(o-F,c+g,M,J+io,J+Lr),n.closePath();break;case"rect":if(!X){s=Math.SQRT1_2*W,C=h?h/2:s,n.rect(o-C,c-s,2*C,2*s);break}J+=dh;case"rectRot":D=Math.cos(J)*(h?h/2:W),g=Math.cos(J)*W,x=Math.sin(J)*W,F=Math.sin(J)*(h?h/2:W),n.moveTo(o-D,c-x),n.lineTo(o+F,c-g),n.lineTo(o+D,c+x),n.lineTo(o-F,c+g),n.closePath();break;case"crossRot":J+=dh;case"cross":D=Math.cos(J)*(h?h/2:W),g=Math.cos(J)*W,x=Math.sin(J)*W,F=Math.sin(J)*(h?h/2:W),n.moveTo(o-D,c-x),n.lineTo(o+D,c+x),n.moveTo(o+F,c-g),n.lineTo(o-F,c+g);break;case"star":D=Math.cos(J)*(h?h/2:W),g=Math.cos(J)*W,x=Math.sin(J)*W,F=Math.sin(J)*(h?h/2:W),n.moveTo(o-D,c-x),n.lineTo(o+D,c+x),n.moveTo(o+F,c-g),n.lineTo(o-F,c+g),J+=dh,D=Math.cos(J)*(h?h/2:W),g=Math.cos(J)*W,x=Math.sin(J)*W,F=Math.sin(J)*(h?h/2:W),n.moveTo(o-D,c-x),n.lineTo(o+D,c+x),n.moveTo(o+F,c-g),n.lineTo(o-F,c+g);break;case"line":g=h?h/2:Math.cos(J)*W,x=Math.sin(J)*W,n.moveTo(o-g,c-x),n.lineTo(o+g,c+x);break;case"dash":n.moveTo(o,c),n.lineTo(o+Math.cos(J)*(h?h/2:W),c+Math.sin(J)*W);break;case!1:n.closePath();break}n.fill(),i.borderWidth>0&&n.stroke()}}function wc(n,i,o){return o=o||.5,!i||n&&n.x>i.left-o&&n.x<i.right+o&&n.y>i.top-o&&n.y<i.bottom+o}function Yy(n,i){n.save(),n.beginPath(),n.rect(i.left,i.top,i.right-i.left,i.bottom-i.top),n.clip()}function Jy(n){n.restore()}function Q6(n,i,o,c,h){if(!i)return n.lineTo(o.x,o.y);if(h==="middle"){const p=(i.x+o.x)/2;n.lineTo(p,i.y),n.lineTo(p,o.y)}else h==="after"!=!!c?n.lineTo(i.x,o.y):n.lineTo(o.x,i.y);n.lineTo(o.x,o.y)}function $6(n,i,o,c){if(!i)return n.lineTo(o.x,o.y);n.bezierCurveTo(c?i.cp1x:i.cp2x,c?i.cp1y:i.cp2y,c?o.cp2x:o.cp1x,c?o.cp2y:o.cp1y,o.x,o.y)}function eN(n,i){i.translation&&n.translate(i.translation[0],i.translation[1]),Wn(i.rotation)||n.rotate(i.rotation),i.color&&(n.fillStyle=i.color),i.textAlign&&(n.textAlign=i.textAlign),i.textBaseline&&(n.textBaseline=i.textBaseline)}function tN(n,i,o,c,h){if(h.strikethrough||h.underline){const p=n.measureText(c),g=i-p.actualBoundingBoxLeft,x=i+p.actualBoundingBoxRight,s=o-p.actualBoundingBoxAscent,M=o+p.actualBoundingBoxDescent,C=h.strikethrough?(s+M)/2:M;n.strokeStyle=n.fillStyle,n.beginPath(),n.lineWidth=h.decorationWidth||2,n.moveTo(g,C),n.lineTo(x,C),n.stroke()}}function iN(n,i){const o=n.fillStyle;n.fillStyle=i.color,n.fillRect(i.left,i.top,i.width,i.height),n.fillStyle=o}function Dh(n,i,o,c,h,p={}){const g=kr(i)?i:[i],x=p.strokeWidth>0&&p.strokeColor!=="";let s,M;for(n.save(),n.font=h.string,eN(n,p),s=0;s<g.length;++s)M=g[s],p.backdrop&&iN(n,p.backdrop),x&&(p.strokeColor&&(n.strokeStyle=p.strokeColor),Wn(p.strokeWidth)||(n.lineWidth=p.strokeWidth),n.strokeText(M,o,c,p.maxWidth)),n.fillText(M,o,c,p.maxWidth),tN(n,o,c,M,p),c+=Number(h.lineHeight);n.restore()}function tm(n,i){const{x:o,y:c,w:h,h:p,radius:g}=i;n.arc(o+g.topLeft,c+g.topLeft,g.topLeft,1.5*Lr,Lr,!0),n.lineTo(o,c+p-g.bottomLeft),n.arc(o+g.bottomLeft,c+p-g.bottomLeft,g.bottomLeft,Lr,io,!0),n.lineTo(o+h-g.bottomRight,c+p),n.arc(o+h-g.bottomRight,c+p-g.bottomRight,g.bottomRight,io,0,!0),n.lineTo(o+h,c+g.topRight),n.arc(o+h-g.topRight,c+g.topRight,g.topRight,0,-io,!0),n.lineTo(o+g.topLeft,c)}const nN=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,rN=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function oN(n,i){const o=(""+n).match(nN);if(!o||o[1]==="normal")return i*1.2;switch(n=+o[2],o[3]){case"px":return n;case"%":n/=100;break}return i*n}const sN=n=>+n||0;function xb(n,i){const o={},c=Dn(i),h=c?Object.keys(i):i,p=Dn(n)?c?g=>mn(n[g],n[i[g]]):g=>n[g]:()=>n;for(const g of h)o[g]=sN(p(g));return o}function Qk(n){return xb(n,{top:"y",right:"x",bottom:"y",left:"x"})}function Ah(n){return xb(n,["topLeft","topRight","bottomLeft","bottomRight"])}function rs(n){const i=Qk(n);return i.width=i.left+i.right,i.height=i.top+i.bottom,i}function mo(n,i){n=n||{},i=i||Wr.font;let o=mn(n.size,i.size);typeof o=="string"&&(o=parseInt(o,10));let c=mn(n.style,i.style);c&&!(""+c).match(rN)&&(console.warn('Invalid font style specified: "'+c+'"'),c=void 0);const h={family:mn(n.family,i.family),lineHeight:oN(mn(n.lineHeight,i.lineHeight),o),size:o,style:c,weight:mn(n.weight,i.weight),string:""};return h.string=J6(h),h}function Ip(n,i,o,c){let h=!0,p,g,x;for(p=0,g=n.length;p<g;++p)if(x=n[p],x!==void 0&&(i!==void 0&&typeof x=="function"&&(x=x(i),h=!1),o!==void 0&&kr(x)&&(x=x[o%x.length],h=!1),x!==void 0))return c&&!h&&(c.cacheable=!1),x}function aN(n,i,o){const{min:c,max:h}=n,p=Vk(i,(h-c)/2),g=(x,s)=>o&&x===0?0:x+s;return{min:g(c,-Math.abs(p)),max:g(h,p)}}function _u(n,i){return Object.assign(Object.create(n),i)}function bb(n,i=[""],o,c,h=()=>n[0]){const p=o||n;typeof c>"u"&&(c=i3("_fallback",n));const g={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:n,_rootScopes:p,_fallback:c,_getTarget:h,override:x=>bb([x,...n],i,p,c)};return new Proxy(g,{deleteProperty(x,s){return delete x[s],delete x._keys,delete n[0][s],!0},get(x,s){return e3(x,s,()=>mN(s,i,n,x))},getOwnPropertyDescriptor(x,s){return Reflect.getOwnPropertyDescriptor(x._scopes[0],s)},getPrototypeOf(){return Reflect.getPrototypeOf(n[0])},has(x,s){return AA(x).includes(s)},ownKeys(x){return AA(x)},set(x,s,M){const C=x._storage||(x._storage=h());return x[s]=C[s]=M,delete x._keys,!0}})}function Yf(n,i,o,c){const h={_cacheable:!1,_proxy:n,_context:i,_subProxy:o,_stack:new Set,_descriptors:$k(n,c),setContext:p=>Yf(n,p,o,c),override:p=>Yf(n.override(p),i,o,c)};return new Proxy(h,{deleteProperty(p,g){return delete p[g],delete n[g],!0},get(p,g,x){return e3(p,g,()=>cN(p,g,x))},getOwnPropertyDescriptor(p,g){return p._descriptors.allKeys?Reflect.has(n,g)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(n,g)},getPrototypeOf(){return Reflect.getPrototypeOf(n)},has(p,g){return Reflect.has(n,g)},ownKeys(){return Reflect.ownKeys(n)},set(p,g,x){return n[g]=x,delete p[g],!0}})}function $k(n,i={scriptable:!0,indexable:!0}){const{_scriptable:o=i.scriptable,_indexable:c=i.indexable,_allKeys:h=i.allKeys}=n;return{allKeys:h,scriptable:o,indexable:c,isScriptable:mu(o)?o:()=>o,isIndexable:mu(c)?c:()=>c}}const lN=(n,i)=>n?n+mb(i):i,wb=(n,i)=>Dn(i)&&n!=="adapters"&&(Object.getPrototypeOf(i)===null||i.constructor===Object);function e3(n,i,o){if(Object.prototype.hasOwnProperty.call(n,i))return n[i];const c=o();return n[i]=c,c}function cN(n,i,o){const{_proxy:c,_context:h,_subProxy:p,_descriptors:g}=n;let x=c[i];return mu(x)&&g.isScriptable(i)&&(x=uN(i,x,n,o)),kr(x)&&x.length&&(x=hN(i,x,n,g.isIndexable)),wb(i,x)&&(x=Yf(x,h,p&&p[i],g)),x}function uN(n,i,o,c){const{_proxy:h,_context:p,_subProxy:g,_stack:x}=o;if(x.has(n))throw new Error("Recursion detected: "+Array.from(x).join("->")+"->"+n);x.add(n);let s=i(p,g||c);return x.delete(n),wb(n,s)&&(s=Tb(h._scopes,h,n,s)),s}function hN(n,i,o,c){const{_proxy:h,_context:p,_subProxy:g,_descriptors:x}=o;if(typeof p.index<"u"&&c(n))return i[p.index%i.length];if(Dn(i[0])){const s=i,M=h._scopes.filter(C=>C!==s);i=[];for(const C of s){const D=Tb(M,h,n,C);i.push(Yf(D,p,g&&g[n],x))}}return i}function t3(n,i,o){return mu(n)?n(i,o):n}const fN=(n,i)=>n===!0?i:typeof n=="string"?pu(i,n):void 0;function dN(n,i,o,c,h){for(const p of i){const g=fN(o,p);if(g){n.add(g);const x=t3(g._fallback,o,h);if(typeof x<"u"&&x!==o&&x!==c)return x}else if(g===!1&&typeof c<"u"&&o!==c)return null}return!1}function Tb(n,i,o,c){const h=i._rootScopes,p=t3(i._fallback,o,c),g=[...n,...h],x=new Set;x.add(c);let s=EA(x,g,o,p||o,c);return s===null||typeof p<"u"&&p!==o&&(s=EA(x,g,p,s,c),s===null)?!1:bb(Array.from(x),[""],h,p,()=>pN(i,o,c))}function EA(n,i,o,c,h){for(;o;)o=dN(n,i,o,c,h);return o}function pN(n,i,o){const c=n._getTarget();i in c||(c[i]={});const h=c[i];return kr(h)&&Dn(o)?o:h||{}}function mN(n,i,o,c){let h;for(const p of i)if(h=i3(lN(p,n),o),typeof h<"u")return wb(n,h)?Tb(o,c,n,h):h}function i3(n,i){for(const o of i){if(!o)continue;const c=o[n];if(typeof c<"u")return c}}function AA(n){let i=n._keys;return i||(i=n._keys=gN(n._scopes)),i}function gN(n){const i=new Set;for(const o of n)for(const c of Object.keys(o).filter(h=>!h.startsWith("_")))i.add(c);return Array.from(i)}function n3(n,i,o,c){const{iScale:h}=n,{key:p="r"}=this._parsing,g=new Array(c);let x,s,M,C;for(x=0,s=c;x<s;++x)M=x+o,C=i[M],g[x]={r:h.parse(pu(C,p),M)};return g}const _N=Number.EPSILON||1e-14,Jf=(n,i)=>i<n.length&&!n[i].skip&&n[i],r3=n=>n==="x"?"y":"x";function yN(n,i,o,c){const h=n.skip?i:n,p=i,g=o.skip?i:o,x=d1(p,h),s=d1(g,p);let M=x/(x+s),C=s/(x+s);M=isNaN(M)?0:M,C=isNaN(C)?0:C;const D=c*M,F=c*C;return{previous:{x:p.x-D*(g.x-h.x),y:p.y-D*(g.y-h.y)},next:{x:p.x+F*(g.x-h.x),y:p.y+F*(g.y-h.y)}}}function vN(n,i,o){const c=n.length;let h,p,g,x,s,M=Jf(n,0);for(let C=0;C<c-1;++C)if(s=M,M=Jf(n,C+1),!(!s||!M)){if(Gp(i[C],0,_N)){o[C]=o[C+1]=0;continue}h=o[C]/i[C],p=o[C+1]/i[C],x=Math.pow(h,2)+Math.pow(p,2),!(x<=9)&&(g=3/Math.sqrt(x),o[C]=h*g*i[C],o[C+1]=p*g*i[C])}}function xN(n,i,o="x"){const c=r3(o),h=n.length;let p,g,x,s=Jf(n,0);for(let M=0;M<h;++M){if(g=x,x=s,s=Jf(n,M+1),!x)continue;const C=x[o],D=x[c];g&&(p=(C-g[o])/3,x[`cp1${o}`]=C-p,x[`cp1${c}`]=D-p*i[M]),s&&(p=(s[o]-C)/3,x[`cp2${o}`]=C+p,x[`cp2${c}`]=D+p*i[M])}}function bN(n,i="x"){const o=r3(i),c=n.length,h=Array(c).fill(0),p=Array(c);let g,x,s,M=Jf(n,0);for(g=0;g<c;++g)if(x=s,s=M,M=Jf(n,g+1),!!s){if(M){const C=M[i]-s[i];h[g]=C!==0?(M[o]-s[o])/C:0}p[g]=x?M?Al(h[g-1])!==Al(h[g])?0:(h[g-1]+h[g])/2:h[g-1]:h[g]}vN(n,h,p),xN(n,p,i)}function h_(n,i,o){return Math.max(Math.min(n,o),i)}function wN(n,i){let o,c,h,p,g,x=wc(n[0],i);for(o=0,c=n.length;o<c;++o)g=p,p=x,x=o<c-1&&wc(n[o+1],i),p&&(h=n[o],g&&(h.cp1x=h_(h.cp1x,i.left,i.right),h.cp1y=h_(h.cp1y,i.top,i.bottom)),x&&(h.cp2x=h_(h.cp2x,i.left,i.right),h.cp2y=h_(h.cp2y,i.top,i.bottom)))}function TN(n,i,o,c,h){let p,g,x,s;if(i.spanGaps&&(n=n.filter(M=>!M.skip)),i.cubicInterpolationMode==="monotone")bN(n,h);else{let M=c?n[n.length-1]:n[0];for(p=0,g=n.length;p<g;++p)x=n[p],s=yN(M,x,n[Math.min(p+1,g-(c?0:1))%g],i.tension),x.cp1x=s.previous.x,x.cp1y=s.previous.y,x.cp2x=s.next.x,x.cp2y=s.next.y,M=x}i.capBezierPoints&&wN(n,o)}function Sb(){return typeof window<"u"&&typeof document<"u"}function Mb(n){let i=n.parentNode;return i&&i.toString()==="[object ShadowRoot]"&&(i=i.host),i}function gy(n,i,o){let c;return typeof n=="string"?(c=parseInt(n,10),n.indexOf("%")!==-1&&(c=c/100*i.parentNode[o])):c=n,c}const Ky=n=>n.ownerDocument.defaultView.getComputedStyle(n,null);function SN(n,i){return Ky(n).getPropertyValue(i)}const MN=["top","right","bottom","left"];function Ih(n,i,o){const c={};o=o?"-"+o:"";for(let h=0;h<4;h++){const p=MN[h];c[p]=parseFloat(n[i+"-"+p+o])||0}return c.width=c.left+c.right,c.height=c.top+c.bottom,c}const EN=(n,i,o)=>(n>0||i>0)&&(!o||!o.shadowRoot);function AN(n,i){const o=n.touches,c=o&&o.length?o[0]:n,{offsetX:h,offsetY:p}=c;let g=!1,x,s;if(EN(h,p,n.target))x=h,s=p;else{const M=i.getBoundingClientRect();x=c.clientX-M.left,s=c.clientY-M.top,g=!0}return{x,y:s,box:g}}function _h(n,i){if("native"in n)return n;const{canvas:o,currentDevicePixelRatio:c}=i,h=Ky(o),p=h.boxSizing==="border-box",g=Ih(h,"padding"),x=Ih(h,"border","width"),{x:s,y:M,box:C}=AN(n,o),D=g.left+(C&&x.left),F=g.top+(C&&x.top);let{width:V,height:X}=i;return p&&(V-=g.width+x.width,X-=g.height+x.height),{x:Math.round((s-D)/V*o.width/c),y:Math.round((M-F)/X*o.height/c)}}function IN(n,i,o){let c,h;if(i===void 0||o===void 0){const p=Mb(n);if(!p)i=n.clientWidth,o=n.clientHeight;else{const g=p.getBoundingClientRect(),x=Ky(p),s=Ih(x,"border","width"),M=Ih(x,"padding");i=g.width-M.width-s.width,o=g.height-M.height-s.height,c=gy(x.maxWidth,p,"clientWidth"),h=gy(x.maxHeight,p,"clientHeight")}}return{width:i,height:o,maxWidth:c||py,maxHeight:h||py}}const f_=n=>Math.round(n*10)/10;function CN(n,i,o,c){const h=Ky(n),p=Ih(h,"margin"),g=gy(h.maxWidth,n,"clientWidth")||py,x=gy(h.maxHeight,n,"clientHeight")||py,s=IN(n,i,o);let{width:M,height:C}=s;if(h.boxSizing==="content-box"){const F=Ih(h,"border","width"),V=Ih(h,"padding");M-=V.width+F.width,C-=V.height+F.height}return M=Math.max(0,M-p.width),C=Math.max(0,c?M/c:C-p.height),M=f_(Math.min(M,g,s.maxWidth)),C=f_(Math.min(C,x,s.maxHeight)),M&&!C&&(C=f_(M/2)),(i!==void 0||o!==void 0)&&c&&s.height&&C>s.height&&(C=s.height,M=f_(Math.floor(C*c))),{width:M,height:C}}function IA(n,i,o){const c=i||1,h=Math.floor(n.height*c),p=Math.floor(n.width*c);n.height=Math.floor(n.height),n.width=Math.floor(n.width);const g=n.canvas;return g.style&&(o||!g.style.height&&!g.style.width)&&(g.style.height=`${n.height}px`,g.style.width=`${n.width}px`),n.currentDevicePixelRatio!==c||g.height!==h||g.width!==p?(n.currentDevicePixelRatio=c,g.height=h,g.width=p,n.ctx.setTransform(c,0,0,c,0,0),!0):!1}const PN=function(){let n=!1;try{const i={get passive(){return n=!0,!1}};Sb()&&(window.addEventListener("test",null,i),window.removeEventListener("test",null,i))}catch{}return n}();function CA(n,i){const o=SN(n,i),c=o&&o.match(/^(\d+)(\.\d+)?px$/);return c?+c[1]:void 0}function yh(n,i,o,c){return{x:n.x+o*(i.x-n.x),y:n.y+o*(i.y-n.y)}}function kN(n,i,o,c){return{x:n.x+o*(i.x-n.x),y:c==="middle"?o<.5?n.y:i.y:c==="after"?o<1?n.y:i.y:o>0?i.y:n.y}}function DN(n,i,o,c){const h={x:n.cp2x,y:n.cp2y},p={x:i.cp1x,y:i.cp1y},g=yh(n,h,o),x=yh(h,p,o),s=yh(p,i,o),M=yh(g,x,o),C=yh(x,s,o);return yh(M,C,o)}const LN=function(n,i){return{x(o){return n+n+i-o},setWidth(o){i=o},textAlign(o){return o==="center"?o:o==="right"?"left":"right"},xPlus(o,c){return o-c},leftForLtr(o,c){return o-c}}},ON=function(){return{x(n){return n},setWidth(n){},textAlign(n){return n},xPlus(n,i){return n+i},leftForLtr(n,i){return n}}};function Bf(n,i,o){return n?LN(i,o):ON()}function o3(n,i){let o,c;(i==="ltr"||i==="rtl")&&(o=n.canvas.style,c=[o.getPropertyValue("direction"),o.getPropertyPriority("direction")],o.setProperty("direction",i,"important"),n.prevTextDirection=c)}function s3(n,i){i!==void 0&&(delete n.prevTextDirection,n.canvas.style.setProperty("direction",i[0],i[1]))}function a3(n){return n==="angle"?{between:em,compare:R6,normalize:$s}:{between:xc,compare:(i,o)=>i-o,normalize:i=>i}}function PA({start:n,end:i,count:o,loop:c,style:h}){return{start:n%o,end:i%o,loop:c&&(i-n+1)%o===0,style:h}}function RN(n,i,o){const{property:c,start:h,end:p}=o,{between:g,normalize:x}=a3(c),s=i.length;let{start:M,end:C,loop:D}=n,F,V;if(D){for(M+=s,C+=s,F=0,V=s;F<V&&g(x(i[M%s][c]),h,p);++F)M--,C--;M%=s,C%=s}return C<M&&(C+=s),{start:M,end:C,loop:D,style:n.style}}function l3(n,i,o){if(!o)return[n];const{property:c,start:h,end:p}=o,g=i.length,{compare:x,between:s,normalize:M}=a3(c),{start:C,end:D,loop:F,style:V}=RN(n,i,o),X=[];let W=!1,J=null,$,ne,ye;const pe=()=>s(h,ye,$)&&x(h,ye)!==0,ke=()=>x(p,$)===0||s(p,ye,$),Ae=()=>W||pe(),tt=()=>!W||ke();for(let pt=C,kt=C;pt<=D;++pt)ne=i[pt%g],!ne.skip&&($=M(ne[c]),$!==ye&&(W=s($,h,p),J===null&&Ae()&&(J=x($,h)===0?pt:kt),J!==null&&tt()&&(X.push(PA({start:J,end:pt,loop:F,count:g,style:V})),J=null),kt=pt,ye=$));return J!==null&&X.push(PA({start:J,end:D,loop:F,count:g,style:V})),X}function c3(n,i){const o=[],c=n.segments;for(let h=0;h<c.length;h++){const p=l3(c[h],n.points,i);p.length&&o.push(...p)}return o}function zN(n,i,o,c){let h=0,p=i-1;if(o&&!c)for(;h<i&&!n[h].skip;)h++;for(;h<i&&n[h].skip;)h++;for(h%=i,o&&(p+=h);p>h&&n[p%i].skip;)p--;return p%=i,{start:h,end:p}}function FN(n,i,o,c){const h=n.length,p=[];let g=i,x=n[i],s;for(s=i+1;s<=o;++s){const M=n[s%h];M.skip||M.stop?x.skip||(c=!1,p.push({start:i%h,end:(s-1)%h,loop:c}),i=g=M.stop?s:null):(g=s,x.skip&&(i=s)),x=M}return g!==null&&p.push({start:i%h,end:g%h,loop:c}),p}function BN(n,i){const o=n.points,c=n.options.spanGaps,h=o.length;if(!h)return[];const p=!!n._loop,{start:g,end:x}=zN(o,h,p,c);if(c===!0)return kA(n,[{start:g,end:x,loop:p}],o,i);const s=x<g?x+h:x,M=!!n._fullLoop&&g===0&&x===h-1;return kA(n,FN(o,g,s,M),o,i)}function kA(n,i,o,c){return!c||!c.setContext||!o?i:NN(n,i,o,c)}function NN(n,i,o,c){const h=n._chart.getContext(),p=DA(n.options),{_datasetIndex:g,options:{spanGaps:x}}=n,s=o.length,M=[];let C=p,D=i[0].start,F=D;function V(X,W,J,$){const ne=x?-1:1;if(X!==W){for(X+=s;o[X%s].skip;)X-=ne;for(;o[W%s].skip;)W+=ne;X%s!==W%s&&(M.push({start:X%s,end:W%s,loop:J,style:$}),C=$,D=W%s)}}for(const X of i){D=x?D:X.start;let W=o[D%s],J;for(F=D+1;F<=X.end;F++){const $=o[F%s];J=DA(c.setContext(_u(h,{type:"segment",p0:W,p1:$,p0DataIndex:(F-1)%s,p1DataIndex:F%s,datasetIndex:g}))),VN(J,C)&&V(D,F-1,X.loop,C),W=$,C=J}D<F-1&&V(D,F-1,X.loop,C)}return M}function DA(n){return{backgroundColor:n.backgroundColor,borderCapStyle:n.borderCapStyle,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderJoinStyle:n.borderJoinStyle,borderWidth:n.borderWidth,borderColor:n.borderColor}}function VN(n,i){if(!i)return!1;const o=[],c=function(h,p){return vb(p)?(o.includes(p)||o.push(p),o.indexOf(p)):p};return JSON.stringify(n,c)!==JSON.stringify(i,c)}/*!
 * Chart.js v4.4.2
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */class UN{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(i,o,c,h){const p=o.listeners[h],g=o.duration;p.forEach(x=>x({chart:i,initial:o.initial,numSteps:g,currentStep:Math.min(c-o.start,g)}))}_refresh(){this._request||(this._running=!0,this._request=qk.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(i=Date.now()){let o=0;this._charts.forEach((c,h)=>{if(!c.running||!c.items.length)return;const p=c.items;let g=p.length-1,x=!1,s;for(;g>=0;--g)s=p[g],s._active?(s._total>c.duration&&(c.duration=s._total),s.tick(i),x=!0):(p[g]=p[p.length-1],p.pop());x&&(h.draw(),this._notify(h,c,i,"progress")),p.length||(c.running=!1,this._notify(h,c,i,"complete"),c.initial=!1),o+=p.length}),this._lastDate=i,o===0&&(this._running=!1)}_getAnims(i){const o=this._charts;let c=o.get(i);return c||(c={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},o.set(i,c)),c}listen(i,o,c){this._getAnims(i).listeners[o].push(c)}add(i,o){!o||!o.length||this._getAnims(i).items.push(...o)}has(i){return this._getAnims(i).items.length>0}start(i){const o=this._charts.get(i);o&&(o.running=!0,o.start=Date.now(),o.duration=o.items.reduce((c,h)=>Math.max(c,h._duration),0),this._refresh())}running(i){if(!this._running)return!1;const o=this._charts.get(i);return!(!o||!o.running||!o.items.length)}stop(i){const o=this._charts.get(i);if(!o||!o.items.length)return;const c=o.items;let h=c.length-1;for(;h>=0;--h)c[h].cancel();o.items=[],this._notify(i,o,Date.now(),"complete")}remove(i){return this._charts.delete(i)}}var pc=new UN;const LA="transparent",jN={boolean(n,i,o){return o>.5?i:n},color(n,i,o){const c=TA(n||LA),h=c.valid&&TA(i||LA);return h&&h.valid?h.mix(c,o).hexString():i},number(n,i,o){return n+(i-n)*o}};class GN{constructor(i,o,c,h){const p=o[c];h=Ip([i.to,h,p,i.from]);const g=Ip([i.from,p,h]);this._active=!0,this._fn=i.fn||jN[i.type||typeof g],this._easing=Hp[i.easing]||Hp.linear,this._start=Math.floor(Date.now()+(i.delay||0)),this._duration=this._total=Math.floor(i.duration),this._loop=!!i.loop,this._target=o,this._prop=c,this._from=g,this._to=h,this._promises=void 0}active(){return this._active}update(i,o,c){if(this._active){this._notify(!1);const h=this._target[this._prop],p=c-this._start,g=this._duration-p;this._start=c,this._duration=Math.floor(Math.max(g,i.duration)),this._total+=p,this._loop=!!i.loop,this._to=Ip([i.to,o,h,i.from]),this._from=Ip([i.from,h,o])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(i){const o=i-this._start,c=this._duration,h=this._prop,p=this._from,g=this._loop,x=this._to;let s;if(this._active=p!==x&&(g||o<c),!this._active){this._target[h]=x,this._notify(!0);return}if(o<0){this._target[h]=p;return}s=o/c%2,s=g&&s>1?2-s:s,s=this._easing(Math.min(1,Math.max(0,s))),this._target[h]=this._fn(p,x,s)}wait(){const i=this._promises||(this._promises=[]);return new Promise((o,c)=>{i.push({res:o,rej:c})})}_notify(i){const o=i?"res":"rej",c=this._promises||[];for(let h=0;h<c.length;h++)c[h][o]()}}class u3{constructor(i,o){this._chart=i,this._properties=new Map,this.configure(o)}configure(i){if(!Dn(i))return;const o=Object.keys(Wr.animation),c=this._properties;Object.getOwnPropertyNames(i).forEach(h=>{const p=i[h];if(!Dn(p))return;const g={};for(const x of o)g[x]=p[x];(kr(p.properties)&&p.properties||[h]).forEach(x=>{(x===h||!c.has(x))&&c.set(x,g)})})}_animateOptions(i,o){const c=o.options,h=WN(i,c);if(!h)return[];const p=this._createAnimations(h,c);return c.$shared&&HN(i.options.$animations,c).then(()=>{i.options=c},()=>{}),p}_createAnimations(i,o){const c=this._properties,h=[],p=i.$animations||(i.$animations={}),g=Object.keys(o),x=Date.now();let s;for(s=g.length-1;s>=0;--s){const M=g[s];if(M.charAt(0)==="$")continue;if(M==="options"){h.push(...this._animateOptions(i,o));continue}const C=o[M];let D=p[M];const F=c.get(M);if(D)if(F&&D.active()){D.update(F,C,x);continue}else D.cancel();if(!F||!F.duration){i[M]=C;continue}p[M]=D=new GN(F,i,M,C),h.push(D)}return h}update(i,o){if(this._properties.size===0){Object.assign(i,o);return}const c=this._createAnimations(i,o);if(c.length)return pc.add(this._chart,c),!0}}function HN(n,i){const o=[],c=Object.keys(i);for(let h=0;h<c.length;h++){const p=n[c[h]];p&&p.active()&&o.push(p.wait())}return Promise.all(o)}function WN(n,i){if(!i)return;let o=n.options;if(!o){n.options=i;return}return o.$shared&&(n.options=o=Object.assign({},o,{$shared:!1,$animations:{}})),o}function OA(n,i){const o=n&&n.options||{},c=o.reverse,h=o.min===void 0?i:0,p=o.max===void 0?i:0;return{start:c?p:h,end:c?h:p}}function qN(n,i,o){if(o===!1)return!1;const c=OA(n,o),h=OA(i,o);return{top:h.end,right:c.end,bottom:h.start,left:c.start}}function ZN(n){let i,o,c,h;return Dn(n)?(i=n.top,o=n.right,c=n.bottom,h=n.left):i=o=c=h=n,{top:i,right:o,bottom:c,left:h,disabled:n===!1}}function h3(n,i){const o=[],c=n._getSortedDatasetMetas(i);let h,p;for(h=0,p=c.length;h<p;++h)o.push(c[h].index);return o}function RA(n,i,o,c={}){const h=n.keys,p=c.mode==="single";let g,x,s,M;if(i!==null){for(g=0,x=h.length;g<x;++g){if(s=+h[g],s===o){if(c.all)continue;break}M=n.values[s],Hr(M)&&(p||i===0||Al(i)===Al(M))&&(i+=M)}return i}}function XN(n){const i=Object.keys(n),o=new Array(i.length);let c,h,p;for(c=0,h=i.length;c<h;++c)p=i[c],o[c]={x:p,y:n[p]};return o}function zA(n,i){const o=n&&n.options.stacked;return o||o===void 0&&i.stack!==void 0}function YN(n,i,o){return`${n.id}.${i.id}.${o.stack||o.type}`}function JN(n){const{min:i,max:o,minDefined:c,maxDefined:h}=n.getUserBounds();return{min:c?i:Number.NEGATIVE_INFINITY,max:h?o:Number.POSITIVE_INFINITY}}function KN(n,i,o){const c=n[i]||(n[i]={});return c[o]||(c[o]={})}function FA(n,i,o,c){for(const h of i.getMatchingVisibleMetas(c).reverse()){const p=n[h.index];if(o&&p>0||!o&&p<0)return h.index}return null}function BA(n,i){const{chart:o,_cachedMeta:c}=n,h=o._stacks||(o._stacks={}),{iScale:p,vScale:g,index:x}=c,s=p.axis,M=g.axis,C=YN(p,g,c),D=i.length;let F;for(let V=0;V<D;++V){const X=i[V],{[s]:W,[M]:J}=X,$=X._stacks||(X._stacks={});F=$[M]=KN(h,C,W),F[x]=J,F._top=FA(F,g,!0,c.type),F._bottom=FA(F,g,!1,c.type);const ne=F._visualValues||(F._visualValues={});ne[x]=J}}function Ix(n,i){const o=n.scales;return Object.keys(o).filter(c=>o[c].axis===i).shift()}function QN(n,i){return _u(n,{active:!1,dataset:void 0,datasetIndex:i,index:i,mode:"default",type:"dataset"})}function $N(n,i,o){return _u(n,{active:!1,dataIndex:i,parsed:void 0,raw:void 0,element:o,index:i,mode:"default",type:"data"})}function _p(n,i){const o=n.controller.index,c=n.vScale&&n.vScale.axis;if(c){i=i||n._parsed;for(const h of i){const p=h._stacks;if(!p||p[c]===void 0||p[c][o]===void 0)return;delete p[c][o],p[c]._visualValues!==void 0&&p[c]._visualValues[o]!==void 0&&delete p[c]._visualValues[o]}}}const Cx=n=>n==="reset"||n==="none",NA=(n,i)=>i?n:Object.assign({},n),e8=(n,i,o)=>n&&!i.hidden&&i._stacked&&{keys:h3(o,!0),values:null};class Ja{constructor(i,o){this.chart=i,this._ctx=i.ctx,this.index=o,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const i=this._cachedMeta;this.configure(),this.linkScales(),i._stacked=zA(i.vScale,i),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(i){this.index!==i&&_p(this._cachedMeta),this.index=i}linkScales(){const i=this.chart,o=this._cachedMeta,c=this.getDataset(),h=(D,F,V,X)=>D==="x"?F:D==="r"?X:V,p=o.xAxisID=mn(c.xAxisID,Ix(i,"x")),g=o.yAxisID=mn(c.yAxisID,Ix(i,"y")),x=o.rAxisID=mn(c.rAxisID,Ix(i,"r")),s=o.indexAxis,M=o.iAxisID=h(s,p,g,x),C=o.vAxisID=h(s,g,p,x);o.xScale=this.getScaleForId(p),o.yScale=this.getScaleForId(g),o.rScale=this.getScaleForId(x),o.iScale=this.getScaleForId(M),o.vScale=this.getScaleForId(C)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(i){return this.chart.scales[i]}_getOtherScale(i){const o=this._cachedMeta;return i===o.iScale?o.vScale:o.iScale}reset(){this._update("reset")}_destroy(){const i=this._cachedMeta;this._data&&xA(this._data,this),i._stacked&&_p(i)}_dataCheck(){const i=this.getDataset(),o=i.data||(i.data=[]),c=this._data;if(Dn(o))this._data=XN(o);else if(c!==o){if(c){xA(c,this);const h=this._cachedMeta;_p(h),h._parsed=[]}o&&Object.isExtensible(o)&&N6(o,this),this._syncList=[],this._data=o}}addElements(){const i=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(i.dataset=new this.datasetElementType)}buildOrUpdateElements(i){const o=this._cachedMeta,c=this.getDataset();let h=!1;this._dataCheck();const p=o._stacked;o._stacked=zA(o.vScale,o),o.stack!==c.stack&&(h=!0,_p(o),o.stack=c.stack),this._resyncElements(i),(h||p!==o._stacked)&&BA(this,o._parsed)}configure(){const i=this.chart.config,o=i.datasetScopeKeys(this._type),c=i.getOptionScopes(this.getDataset(),o,!0);this.options=i.createResolver(c,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(i,o){const{_cachedMeta:c,_data:h}=this,{iScale:p,_stacked:g}=c,x=p.axis;let s=i===0&&o===h.length?!0:c._sorted,M=i>0&&c._parsed[i-1],C,D,F;if(this._parsing===!1)c._parsed=h,c._sorted=!0,F=h;else{kr(h[i])?F=this.parseArrayData(c,h,i,o):Dn(h[i])?F=this.parseObjectData(c,h,i,o):F=this.parsePrimitiveData(c,h,i,o);const V=()=>D[x]===null||M&&D[x]<M[x];for(C=0;C<o;++C)c._parsed[C+i]=D=F[C],s&&(V()&&(s=!1),M=D);c._sorted=s}g&&BA(this,F)}parsePrimitiveData(i,o,c,h){const{iScale:p,vScale:g}=i,x=p.axis,s=g.axis,M=p.getLabels(),C=p===g,D=new Array(h);let F,V,X;for(F=0,V=h;F<V;++F)X=F+c,D[F]={[x]:C||p.parse(M[X],X),[s]:g.parse(o[X],X)};return D}parseArrayData(i,o,c,h){const{xScale:p,yScale:g}=i,x=new Array(h);let s,M,C,D;for(s=0,M=h;s<M;++s)C=s+c,D=o[C],x[s]={x:p.parse(D[0],C),y:g.parse(D[1],C)};return x}parseObjectData(i,o,c,h){const{xScale:p,yScale:g}=i,{xAxisKey:x="x",yAxisKey:s="y"}=this._parsing,M=new Array(h);let C,D,F,V;for(C=0,D=h;C<D;++C)F=C+c,V=o[F],M[C]={x:p.parse(pu(V,x),F),y:g.parse(pu(V,s),F)};return M}getParsed(i){return this._cachedMeta._parsed[i]}getDataElement(i){return this._cachedMeta.data[i]}applyStack(i,o,c){const h=this.chart,p=this._cachedMeta,g=o[i.axis],x={keys:h3(h,!0),values:o._stacks[i.axis]._visualValues};return RA(x,g,p.index,{mode:c})}updateRangeFromParsed(i,o,c,h){const p=c[o.axis];let g=p===null?NaN:p;const x=h&&c._stacks[o.axis];h&&x&&(h.values=x,g=RA(h,p,this._cachedMeta.index)),i.min=Math.min(i.min,g),i.max=Math.max(i.max,g)}getMinMax(i,o){const c=this._cachedMeta,h=c._parsed,p=c._sorted&&i===c.iScale,g=h.length,x=this._getOtherScale(i),s=e8(o,c,this.chart),M={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:C,max:D}=JN(x);let F,V;function X(){V=h[F];const W=V[x.axis];return!Hr(V[i.axis])||C>W||D<W}for(F=0;F<g&&!(!X()&&(this.updateRangeFromParsed(M,i,V,s),p));++F);if(p){for(F=g-1;F>=0;--F)if(!X()){this.updateRangeFromParsed(M,i,V,s);break}}return M}getAllParsedValues(i){const o=this._cachedMeta._parsed,c=[];let h,p,g;for(h=0,p=o.length;h<p;++h)g=o[h][i.axis],Hr(g)&&c.push(g);return c}getMaxOverflow(){return!1}getLabelAndValue(i){const o=this._cachedMeta,c=o.iScale,h=o.vScale,p=this.getParsed(i);return{label:c?""+c.getLabelForValue(p[c.axis]):"",value:h?""+h.getLabelForValue(p[h.axis]):""}}_update(i){const o=this._cachedMeta;this.update(i||"default"),o._clip=ZN(mn(this.options.clip,qN(o.xScale,o.yScale,this.getMaxOverflow())))}update(i){}draw(){const i=this._ctx,o=this.chart,c=this._cachedMeta,h=c.data||[],p=o.chartArea,g=[],x=this._drawStart||0,s=this._drawCount||h.length-x,M=this.options.drawActiveElementsOnTop;let C;for(c.dataset&&c.dataset.draw(i,p,x,s),C=x;C<x+s;++C){const D=h[C];D.hidden||(D.active&&M?g.push(D):D.draw(i,p))}for(C=0;C<g.length;++C)g[C].draw(i,p)}getStyle(i,o){const c=o?"active":"default";return i===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(c):this.resolveDataElementOptions(i||0,c)}getContext(i,o,c){const h=this.getDataset();let p;if(i>=0&&i<this._cachedMeta.data.length){const g=this._cachedMeta.data[i];p=g.$context||(g.$context=$N(this.getContext(),i,g)),p.parsed=this.getParsed(i),p.raw=h.data[i],p.index=p.dataIndex=i}else p=this.$context||(this.$context=QN(this.chart.getContext(),this.index)),p.dataset=h,p.index=p.datasetIndex=this.index;return p.active=!!o,p.mode=c,p}resolveDatasetElementOptions(i){return this._resolveElementOptions(this.datasetElementType.id,i)}resolveDataElementOptions(i,o){return this._resolveElementOptions(this.dataElementType.id,o,i)}_resolveElementOptions(i,o="default",c){const h=o==="active",p=this._cachedDataOpts,g=i+"-"+o,x=p[g],s=this.enableOptionSharing&&$p(c);if(x)return NA(x,s);const M=this.chart.config,C=M.datasetElementScopeKeys(this._type,i),D=h?[`${i}Hover`,"hover",i,""]:[i,""],F=M.getOptionScopes(this.getDataset(),C),V=Object.keys(Wr.elements[i]),X=()=>this.getContext(c,h,o),W=M.resolveNamedOptions(F,V,X,D);return W.$shared&&(W.$shared=s,p[g]=Object.freeze(NA(W,s))),W}_resolveAnimations(i,o,c){const h=this.chart,p=this._cachedDataOpts,g=`animation-${o}`,x=p[g];if(x)return x;let s;if(h.options.animation!==!1){const C=this.chart.config,D=C.datasetAnimationScopeKeys(this._type,o),F=C.getOptionScopes(this.getDataset(),D);s=C.createResolver(F,this.getContext(i,c,o))}const M=new u3(h,s&&s.animations);return s&&s._cacheable&&(p[g]=Object.freeze(M)),M}getSharedOptions(i){if(i.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},i))}includeOptions(i,o){return!o||Cx(i)||this.chart._animationsDisabled}_getSharedOptions(i,o){const c=this.resolveDataElementOptions(i,o),h=this._sharedOptions,p=this.getSharedOptions(c),g=this.includeOptions(o,p)||p!==h;return this.updateSharedOptions(p,o,c),{sharedOptions:p,includeOptions:g}}updateElement(i,o,c,h){Cx(h)?Object.assign(i,c):this._resolveAnimations(o,h).update(i,c)}updateSharedOptions(i,o,c){i&&!Cx(o)&&this._resolveAnimations(void 0,o).update(i,c)}_setStyle(i,o,c,h){i.active=h;const p=this.getStyle(o,h);this._resolveAnimations(o,c,h).update(i,{options:!h&&this.getSharedOptions(p)||p})}removeHoverStyle(i,o,c){this._setStyle(i,c,"active",!1)}setHoverStyle(i,o,c){this._setStyle(i,c,"active",!0)}_removeDatasetHoverStyle(){const i=this._cachedMeta.dataset;i&&this._setStyle(i,void 0,"active",!1)}_setDatasetHoverStyle(){const i=this._cachedMeta.dataset;i&&this._setStyle(i,void 0,"active",!0)}_resyncElements(i){const o=this._data,c=this._cachedMeta.data;for(const[x,s,M]of this._syncList)this[x](s,M);this._syncList=[];const h=c.length,p=o.length,g=Math.min(p,h);g&&this.parse(0,g),p>h?this._insertElements(h,p-h,i):p<h&&this._removeElements(p,h-p)}_insertElements(i,o,c=!0){const h=this._cachedMeta,p=h.data,g=i+o;let x;const s=M=>{for(M.length+=o,x=M.length-1;x>=g;x--)M[x]=M[x-o]};for(s(p),x=i;x<g;++x)p[x]=new this.dataElementType;this._parsing&&s(h._parsed),this.parse(i,o),c&&this.updateElements(p,i,o,"reset")}updateElements(i,o,c,h){}_removeElements(i,o){const c=this._cachedMeta;if(this._parsing){const h=c._parsed.splice(i,o);c._stacked&&_p(c,h)}c.data.splice(i,o)}_sync(i){if(this._parsing)this._syncList.push(i);else{const[o,c,h]=i;this[o](c,h)}this.chart._dataChanges.push([this.index,...i])}_onDataPush(){const i=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-i,i])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(i,o){o&&this._sync(["_removeElements",i,o]);const c=arguments.length-2;c&&this._sync(["_insertElements",i,c])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}ui(Ja,"defaults",{}),ui(Ja,"datasetElementType",null),ui(Ja,"dataElementType",null);function t8(n,i){if(!n._cache.$bar){const o=n.getMatchingVisibleMetas(i);let c=[];for(let h=0,p=o.length;h<p;h++)c=c.concat(o[h].controller.getAllParsedValues(n));n._cache.$bar=Wk(c.sort((h,p)=>h-p))}return n._cache.$bar}function i8(n){const i=n.iScale,o=t8(i,n.type);let c=i._length,h,p,g,x;const s=()=>{g===32767||g===-32768||($p(x)&&(c=Math.min(c,Math.abs(g-x)||c)),x=g)};for(h=0,p=o.length;h<p;++h)g=i.getPixelForValue(o[h]),s();for(x=void 0,h=0,p=i.ticks.length;h<p;++h)g=i.getPixelForTick(h),s();return c}function n8(n,i,o,c){const h=o.barThickness;let p,g;return Wn(h)?(p=i.min*o.categoryPercentage,g=o.barPercentage):(p=h*c,g=1),{chunk:p/c,ratio:g,start:i.pixels[n]-p/2}}function r8(n,i,o,c){const h=i.pixels,p=h[n];let g=n>0?h[n-1]:null,x=n<h.length-1?h[n+1]:null;const s=o.categoryPercentage;g===null&&(g=p-(x===null?i.end-i.start:x-p)),x===null&&(x=p+p-g);const M=p-(p-Math.min(g,x))/2*s;return{chunk:Math.abs(x-g)/2*s/c,ratio:o.barPercentage,start:M}}function o8(n,i,o,c){const h=o.parse(n[0],c),p=o.parse(n[1],c),g=Math.min(h,p),x=Math.max(h,p);let s=g,M=x;Math.abs(g)>Math.abs(x)&&(s=x,M=g),i[o.axis]=M,i._custom={barStart:s,barEnd:M,start:h,end:p,min:g,max:x}}function f3(n,i,o,c){return kr(n)?o8(n,i,o,c):i[o.axis]=o.parse(n,c),i}function VA(n,i,o,c){const h=n.iScale,p=n.vScale,g=h.getLabels(),x=h===p,s=[];let M,C,D,F;for(M=o,C=o+c;M<C;++M)F=i[M],D={},D[h.axis]=x||h.parse(g[M],M),s.push(f3(F,D,p,M));return s}function Px(n){return n&&n.barStart!==void 0&&n.barEnd!==void 0}function s8(n,i,o){return n!==0?Al(n):(i.isHorizontal()?1:-1)*(i.min>=o?1:-1)}function a8(n){let i,o,c,h,p;return n.horizontal?(i=n.base>n.x,o="left",c="right"):(i=n.base<n.y,o="bottom",c="top"),i?(h="end",p="start"):(h="start",p="end"),{start:o,end:c,reverse:i,top:h,bottom:p}}function l8(n,i,o,c){let h=i.borderSkipped;const p={};if(!h){n.borderSkipped=p;return}if(h===!0){n.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:g,end:x,reverse:s,top:M,bottom:C}=a8(n);h==="middle"&&o&&(n.enableBorderRadius=!0,(o._top||0)===c?h=M:(o._bottom||0)===c?h=C:(p[UA(C,g,x,s)]=!0,h=M)),p[UA(h,g,x,s)]=!0,n.borderSkipped=p}function UA(n,i,o,c){return c?(n=c8(n,i,o),n=jA(n,o,i)):n=jA(n,i,o),n}function c8(n,i,o){return n===i?o:n===o?i:n}function jA(n,i,o){return n==="start"?i:n==="end"?o:n}function u8(n,{inflateAmount:i},o){n.inflateAmount=i==="auto"?o===1?.33:0:i}class O_ extends Ja{parsePrimitiveData(i,o,c,h){return VA(i,o,c,h)}parseArrayData(i,o,c,h){return VA(i,o,c,h)}parseObjectData(i,o,c,h){const{iScale:p,vScale:g}=i,{xAxisKey:x="x",yAxisKey:s="y"}=this._parsing,M=p.axis==="x"?x:s,C=g.axis==="x"?x:s,D=[];let F,V,X,W;for(F=c,V=c+h;F<V;++F)W=o[F],X={},X[p.axis]=p.parse(pu(W,M),F),D.push(f3(pu(W,C),X,g,F));return D}updateRangeFromParsed(i,o,c,h){super.updateRangeFromParsed(i,o,c,h);const p=c._custom;p&&o===this._cachedMeta.vScale&&(i.min=Math.min(i.min,p.min),i.max=Math.max(i.max,p.max))}getMaxOverflow(){return 0}getLabelAndValue(i){const o=this._cachedMeta,{iScale:c,vScale:h}=o,p=this.getParsed(i),g=p._custom,x=Px(g)?"["+g.start+", "+g.end+"]":""+h.getLabelForValue(p[h.axis]);return{label:""+c.getLabelForValue(p[c.axis]),value:x}}initialize(){this.enableOptionSharing=!0,super.initialize();const i=this._cachedMeta;i.stack=this.getDataset().stack}update(i){const o=this._cachedMeta;this.updateElements(o.data,0,o.data.length,i)}updateElements(i,o,c,h){const p=h==="reset",{index:g,_cachedMeta:{vScale:x}}=this,s=x.getBasePixel(),M=x.isHorizontal(),C=this._getRuler(),{sharedOptions:D,includeOptions:F}=this._getSharedOptions(o,h);for(let V=o;V<o+c;V++){const X=this.getParsed(V),W=p||Wn(X[x.axis])?{base:s,head:s}:this._calculateBarValuePixels(V),J=this._calculateBarIndexPixels(V,C),$=(X._stacks||{})[x.axis],ne={horizontal:M,base:W.base,enableBorderRadius:!$||Px(X._custom)||g===$._top||g===$._bottom,x:M?W.head:J.center,y:M?J.center:W.head,height:M?J.size:Math.abs(W.size),width:M?Math.abs(W.size):J.size};F&&(ne.options=D||this.resolveDataElementOptions(V,i[V].active?"active":h));const ye=ne.options||i[V].options;l8(ne,ye,$,g),u8(ne,ye,C.ratio),this.updateElement(i[V],V,ne,h)}}_getStacks(i,o){const{iScale:c}=this._cachedMeta,h=c.getMatchingVisibleMetas(this._type).filter(s=>s.controller.options.grouped),p=c.options.stacked,g=[],x=s=>{const M=s.controller.getParsed(o),C=M&&M[s.vScale.axis];if(Wn(C)||isNaN(C))return!0};for(const s of h)if(!(o!==void 0&&x(s))&&((p===!1||g.indexOf(s.stack)===-1||p===void 0&&s.stack===void 0)&&g.push(s.stack),s.index===i))break;return g.length||g.push(void 0),g}_getStackCount(i){return this._getStacks(void 0,i).length}_getStackIndex(i,o,c){const h=this._getStacks(i,c),p=o!==void 0?h.indexOf(o):-1;return p===-1?h.length-1:p}_getRuler(){const i=this.options,o=this._cachedMeta,c=o.iScale,h=[];let p,g;for(p=0,g=o.data.length;p<g;++p)h.push(c.getPixelForValue(this.getParsed(p)[c.axis],p));const x=i.barThickness;return{min:x||i8(o),pixels:h,start:c._startPixel,end:c._endPixel,stackCount:this._getStackCount(),scale:c,grouped:i.grouped,ratio:x?1:i.categoryPercentage*i.barPercentage}}_calculateBarValuePixels(i){const{_cachedMeta:{vScale:o,_stacked:c,index:h},options:{base:p,minBarLength:g}}=this,x=p||0,s=this.getParsed(i),M=s._custom,C=Px(M);let D=s[o.axis],F=0,V=c?this.applyStack(o,s,c):D,X,W;V!==D&&(F=V-D,V=D),C&&(D=M.barStart,V=M.barEnd-M.barStart,D!==0&&Al(D)!==Al(M.barEnd)&&(F=0),F+=D);const J=!Wn(p)&&!C?p:F;let $=o.getPixelForValue(J);if(this.chart.getDataVisibility(i)?X=o.getPixelForValue(F+V):X=$,W=X-$,Math.abs(W)<g){W=s8(W,o,x)*g,D===x&&($-=W/2);const ne=o.getPixelForDecimal(0),ye=o.getPixelForDecimal(1),pe=Math.min(ne,ye),ke=Math.max(ne,ye);$=Math.max(Math.min($,ke),pe),X=$+W,c&&!C&&(s._stacks[o.axis]._visualValues[h]=o.getValueForPixel(X)-o.getValueForPixel($))}if($===o.getPixelForValue(x)){const ne=Al(W)*o.getLineWidthForValue(x)/2;$+=ne,W-=ne}return{size:W,base:$,head:X,center:X+W/2}}_calculateBarIndexPixels(i,o){const c=o.scale,h=this.options,p=h.skipNull,g=mn(h.maxBarThickness,1/0);let x,s;if(o.grouped){const M=p?this._getStackCount(i):o.stackCount,C=h.barThickness==="flex"?r8(i,o,h,M):n8(i,o,h,M),D=this._getStackIndex(this.index,this._cachedMeta.stack,p?i:void 0);x=C.start+C.chunk*D+C.chunk/2,s=Math.min(g,C.chunk*C.ratio)}else x=c.getPixelForValue(this.getParsed(i)[c.axis],i),s=Math.min(g,o.min*o.ratio);return{base:x-s/2,head:x+s/2,center:x,size:s}}draw(){const i=this._cachedMeta,o=i.vScale,c=i.data,h=c.length;let p=0;for(;p<h;++p)this.getParsed(p)[o.axis]!==null&&c[p].draw(this._ctx)}}ui(O_,"id","bar"),ui(O_,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),ui(O_,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class R_ extends Ja{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(i,o,c,h){const p=super.parsePrimitiveData(i,o,c,h);for(let g=0;g<p.length;g++)p[g]._custom=this.resolveDataElementOptions(g+c).radius;return p}parseArrayData(i,o,c,h){const p=super.parseArrayData(i,o,c,h);for(let g=0;g<p.length;g++){const x=o[c+g];p[g]._custom=mn(x[2],this.resolveDataElementOptions(g+c).radius)}return p}parseObjectData(i,o,c,h){const p=super.parseObjectData(i,o,c,h);for(let g=0;g<p.length;g++){const x=o[c+g];p[g]._custom=mn(x&&x.r&&+x.r,this.resolveDataElementOptions(g+c).radius)}return p}getMaxOverflow(){const i=this._cachedMeta.data;let o=0;for(let c=i.length-1;c>=0;--c)o=Math.max(o,i[c].size(this.resolveDataElementOptions(c))/2);return o>0&&o}getLabelAndValue(i){const o=this._cachedMeta,c=this.chart.data.labels||[],{xScale:h,yScale:p}=o,g=this.getParsed(i),x=h.getLabelForValue(g.x),s=p.getLabelForValue(g.y),M=g._custom;return{label:c[i]||"",value:"("+x+", "+s+(M?", "+M:"")+")"}}update(i){const o=this._cachedMeta.data;this.updateElements(o,0,o.length,i)}updateElements(i,o,c,h){const p=h==="reset",{iScale:g,vScale:x}=this._cachedMeta,{sharedOptions:s,includeOptions:M}=this._getSharedOptions(o,h),C=g.axis,D=x.axis;for(let F=o;F<o+c;F++){const V=i[F],X=!p&&this.getParsed(F),W={},J=W[C]=p?g.getPixelForDecimal(.5):g.getPixelForValue(X[C]),$=W[D]=p?x.getBasePixel():x.getPixelForValue(X[D]);W.skip=isNaN(J)||isNaN($),M&&(W.options=s||this.resolveDataElementOptions(F,V.active?"active":h),p&&(W.options.radius=0)),this.updateElement(V,F,W,h)}}resolveDataElementOptions(i,o){const c=this.getParsed(i);let h=super.resolveDataElementOptions(i,o);h.$shared&&(h=Object.assign({},h,{$shared:!1}));const p=h.radius;return o!=="active"&&(h.radius=0),h.radius+=mn(c&&c._custom,p),h}}ui(R_,"id","bubble"),ui(R_,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),ui(R_,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function h8(n,i,o){let c=1,h=1,p=0,g=0;if(i<Dr){const x=n,s=x+i,M=Math.cos(x),C=Math.sin(x),D=Math.cos(s),F=Math.sin(s),V=(ye,pe,ke)=>em(ye,x,s,!0)?1:Math.max(pe,pe*o,ke,ke*o),X=(ye,pe,ke)=>em(ye,x,s,!0)?-1:Math.min(pe,pe*o,ke,ke*o),W=V(0,M,D),J=V(io,C,F),$=X(Lr,M,D),ne=X(Lr+io,C,F);c=(W-$)/2,h=(J-ne)/2,p=-(W+$)/2,g=-(J+ne)/2}return{ratioX:c,ratioY:h,offsetX:p,offsetY:g}}class bh extends Ja{constructor(i,o){super(i,o),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(i,o){const c=this.getDataset().data,h=this._cachedMeta;if(this._parsing===!1)h._parsed=c;else{let p=s=>+c[s];if(Dn(c[i])){const{key:s="value"}=this._parsing;p=M=>+pu(c[M],s)}let g,x;for(g=i,x=i+o;g<x;++g)h._parsed[g]=p(g)}}_getRotation(){return Xa(this.options.rotation-90)}_getCircumference(){return Xa(this.options.circumference)}_getRotationExtents(){let i=Dr,o=-Dr;for(let c=0;c<this.chart.data.datasets.length;++c)if(this.chart.isDatasetVisible(c)&&this.chart.getDatasetMeta(c).type===this._type){const h=this.chart.getDatasetMeta(c).controller,p=h._getRotation(),g=h._getCircumference();i=Math.min(i,p),o=Math.max(o,p+g)}return{rotation:i,circumference:o-i}}update(i){const o=this.chart,{chartArea:c}=o,h=this._cachedMeta,p=h.data,g=this.getMaxBorderWidth()+this.getMaxOffset(p)+this.options.spacing,x=Math.max((Math.min(c.width,c.height)-g)/2,0),s=Math.min(M6(this.options.cutout,x),1),M=this._getRingWeight(this.index),{circumference:C,rotation:D}=this._getRotationExtents(),{ratioX:F,ratioY:V,offsetX:X,offsetY:W}=h8(D,C,s),J=(c.width-g)/F,$=(c.height-g)/V,ne=Math.max(Math.min(J,$)/2,0),ye=Vk(this.options.radius,ne),pe=Math.max(ye*s,0),ke=(ye-pe)/this._getVisibleDatasetWeightTotal();this.offsetX=X*ye,this.offsetY=W*ye,h.total=this.calculateTotal(),this.outerRadius=ye-ke*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-ke*M,0),this.updateElements(p,0,p.length,i)}_circumference(i,o){const c=this.options,h=this._cachedMeta,p=this._getCircumference();return o&&c.animation.animateRotate||!this.chart.getDataVisibility(i)||h._parsed[i]===null||h.data[i].hidden?0:this.calculateCircumference(h._parsed[i]*p/Dr)}updateElements(i,o,c,h){const p=h==="reset",g=this.chart,x=g.chartArea,M=g.options.animation,C=(x.left+x.right)/2,D=(x.top+x.bottom)/2,F=p&&M.animateScale,V=F?0:this.innerRadius,X=F?0:this.outerRadius,{sharedOptions:W,includeOptions:J}=this._getSharedOptions(o,h);let $=this._getRotation(),ne;for(ne=0;ne<o;++ne)$+=this._circumference(ne,p);for(ne=o;ne<o+c;++ne){const ye=this._circumference(ne,p),pe=i[ne],ke={x:C+this.offsetX,y:D+this.offsetY,startAngle:$,endAngle:$+ye,circumference:ye,outerRadius:X,innerRadius:V};J&&(ke.options=W||this.resolveDataElementOptions(ne,pe.active?"active":h)),$+=ye,this.updateElement(pe,ne,ke,h)}}calculateTotal(){const i=this._cachedMeta,o=i.data;let c=0,h;for(h=0;h<o.length;h++){const p=i._parsed[h];p!==null&&!isNaN(p)&&this.chart.getDataVisibility(h)&&!o[h].hidden&&(c+=Math.abs(p))}return c}calculateCircumference(i){const o=this._cachedMeta.total;return o>0&&!isNaN(i)?Dr*(Math.abs(i)/o):0}getLabelAndValue(i){const o=this._cachedMeta,c=this.chart,h=c.data.labels||[],p=wm(o._parsed[i],c.options.locale);return{label:h[i]||"",value:p}}getMaxBorderWidth(i){let o=0;const c=this.chart;let h,p,g,x,s;if(!i){for(h=0,p=c.data.datasets.length;h<p;++h)if(c.isDatasetVisible(h)){g=c.getDatasetMeta(h),i=g.data,x=g.controller;break}}if(!i)return 0;for(h=0,p=i.length;h<p;++h)s=x.resolveDataElementOptions(h),s.borderAlign!=="inner"&&(o=Math.max(o,s.borderWidth||0,s.hoverBorderWidth||0));return o}getMaxOffset(i){let o=0;for(let c=0,h=i.length;c<h;++c){const p=this.resolveDataElementOptions(c);o=Math.max(o,p.offset||0,p.hoverOffset||0)}return o}_getRingWeightOffset(i){let o=0;for(let c=0;c<i;++c)this.chart.isDatasetVisible(c)&&(o+=this._getRingWeight(c));return o}_getRingWeight(i){return Math.max(mn(this.chart.data.datasets[i].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}ui(bh,"id","doughnut"),ui(bh,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),ui(bh,"descriptors",{_scriptable:i=>i!=="spacing",_indexable:i=>i!=="spacing"&&!i.startsWith("borderDash")&&!i.startsWith("hoverBorderDash")}),ui(bh,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(i){const o=i.data;if(o.labels.length&&o.datasets.length){const{labels:{pointStyle:c,color:h}}=i.legend.options;return o.labels.map((p,g)=>{const s=i.getDatasetMeta(0).controller.getStyle(g);return{text:p,fillStyle:s.backgroundColor,strokeStyle:s.borderColor,fontColor:h,lineWidth:s.borderWidth,pointStyle:c,hidden:!i.getDataVisibility(g),index:g}})}return[]}},onClick(i,o,c){c.chart.toggleDataVisibility(o.index),c.chart.update()}}}});class z_ extends Ja{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(i){const o=this._cachedMeta,{dataset:c,data:h=[],_dataset:p}=o,g=this.chart._animationsDisabled;let{start:x,count:s}=Xk(o,h,g);this._drawStart=x,this._drawCount=s,Yk(o)&&(x=0,s=h.length),c._chart=this.chart,c._datasetIndex=this.index,c._decimated=!!p._decimated,c.points=h;const M=this.resolveDatasetElementOptions(i);this.options.showLine||(M.borderWidth=0),M.segment=this.options.segment,this.updateElement(c,void 0,{animated:!g,options:M},i),this.updateElements(h,x,s,i)}updateElements(i,o,c,h){const p=h==="reset",{iScale:g,vScale:x,_stacked:s,_dataset:M}=this._cachedMeta,{sharedOptions:C,includeOptions:D}=this._getSharedOptions(o,h),F=g.axis,V=x.axis,{spanGaps:X,segment:W}=this.options,J=Xf(X)?X:Number.POSITIVE_INFINITY,$=this.chart._animationsDisabled||p||h==="none",ne=o+c,ye=i.length;let pe=o>0&&this.getParsed(o-1);for(let ke=0;ke<ye;++ke){const Ae=i[ke],tt=$?Ae:{};if(ke<o||ke>=ne){tt.skip=!0;continue}const pt=this.getParsed(ke),kt=Wn(pt[V]),Ie=tt[F]=g.getPixelForValue(pt[F],ke),Et=tt[V]=p||kt?x.getBasePixel():x.getPixelForValue(s?this.applyStack(x,pt,s):pt[V],ke);tt.skip=isNaN(Ie)||isNaN(Et)||kt,tt.stop=ke>0&&Math.abs(pt[F]-pe[F])>J,W&&(tt.parsed=pt,tt.raw=M.data[ke]),D&&(tt.options=C||this.resolveDataElementOptions(ke,Ae.active?"active":h)),$||this.updateElement(Ae,ke,tt,h),pe=pt}}getMaxOverflow(){const i=this._cachedMeta,o=i.dataset,c=o.options&&o.options.borderWidth||0,h=i.data||[];if(!h.length)return c;const p=h[0].size(this.resolveDataElementOptions(0)),g=h[h.length-1].size(this.resolveDataElementOptions(h.length-1));return Math.max(c,p,g)/2}draw(){const i=this._cachedMeta;i.dataset.updateControlPoints(this.chart.chartArea,i.iScale.axis),super.draw()}}ui(z_,"id","line"),ui(z_,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),ui(z_,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class qp extends Ja{constructor(i,o){super(i,o),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(i){const o=this._cachedMeta,c=this.chart,h=c.data.labels||[],p=wm(o._parsed[i].r,c.options.locale);return{label:h[i]||"",value:p}}parseObjectData(i,o,c,h){return n3.bind(this)(i,o,c,h)}update(i){const o=this._cachedMeta.data;this._updateRadius(),this.updateElements(o,0,o.length,i)}getMinMax(){const i=this._cachedMeta,o={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return i.data.forEach((c,h)=>{const p=this.getParsed(h).r;!isNaN(p)&&this.chart.getDataVisibility(h)&&(p<o.min&&(o.min=p),p>o.max&&(o.max=p))}),o}_updateRadius(){const i=this.chart,o=i.chartArea,c=i.options,h=Math.min(o.right-o.left,o.bottom-o.top),p=Math.max(h/2,0),g=Math.max(c.cutoutPercentage?p/100*c.cutoutPercentage:1,0),x=(p-g)/i.getVisibleDatasetCount();this.outerRadius=p-x*this.index,this.innerRadius=this.outerRadius-x}updateElements(i,o,c,h){const p=h==="reset",g=this.chart,s=g.options.animation,M=this._cachedMeta.rScale,C=M.xCenter,D=M.yCenter,F=M.getIndexAngle(0)-.5*Lr;let V=F,X;const W=360/this.countVisibleElements();for(X=0;X<o;++X)V+=this._computeAngle(X,h,W);for(X=o;X<o+c;X++){const J=i[X];let $=V,ne=V+this._computeAngle(X,h,W),ye=g.getDataVisibility(X)?M.getDistanceFromCenterForValue(this.getParsed(X).r):0;V=ne,p&&(s.animateScale&&(ye=0),s.animateRotate&&($=ne=F));const pe={x:C,y:D,innerRadius:0,outerRadius:ye,startAngle:$,endAngle:ne,options:this.resolveDataElementOptions(X,J.active?"active":h)};this.updateElement(J,X,pe,h)}}countVisibleElements(){const i=this._cachedMeta;let o=0;return i.data.forEach((c,h)=>{!isNaN(this.getParsed(h).r)&&this.chart.getDataVisibility(h)&&o++}),o}_computeAngle(i,o,c){return this.chart.getDataVisibility(i)?Xa(this.resolveDataElementOptions(i,o).angle||c):0}}ui(qp,"id","polarArea"),ui(qp,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),ui(qp,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(i){const o=i.data;if(o.labels.length&&o.datasets.length){const{labels:{pointStyle:c,color:h}}=i.legend.options;return o.labels.map((p,g)=>{const s=i.getDatasetMeta(0).controller.getStyle(g);return{text:p,fillStyle:s.backgroundColor,strokeStyle:s.borderColor,fontColor:h,lineWidth:s.borderWidth,pointStyle:c,hidden:!i.getDataVisibility(g),index:g}})}return[]}},onClick(i,o,c){c.chart.toggleDataVisibility(o.index),c.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class g1 extends bh{}ui(g1,"id","pie"),ui(g1,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class F_ extends Ja{getLabelAndValue(i){const o=this._cachedMeta.vScale,c=this.getParsed(i);return{label:o.getLabels()[i],value:""+o.getLabelForValue(c[o.axis])}}parseObjectData(i,o,c,h){return n3.bind(this)(i,o,c,h)}update(i){const o=this._cachedMeta,c=o.dataset,h=o.data||[],p=o.iScale.getLabels();if(c.points=h,i!=="resize"){const g=this.resolveDatasetElementOptions(i);this.options.showLine||(g.borderWidth=0);const x={_loop:!0,_fullLoop:p.length===h.length,options:g};this.updateElement(c,void 0,x,i)}this.updateElements(h,0,h.length,i)}updateElements(i,o,c,h){const p=this._cachedMeta.rScale,g=h==="reset";for(let x=o;x<o+c;x++){const s=i[x],M=this.resolveDataElementOptions(x,s.active?"active":h),C=p.getPointPositionForValue(x,this.getParsed(x).r),D=g?p.xCenter:C.x,F=g?p.yCenter:C.y,V={x:D,y:F,angle:C.angle,skip:isNaN(D)||isNaN(F),options:M};this.updateElement(s,x,V,h)}}}ui(F_,"id","radar"),ui(F_,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),ui(F_,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class B_ extends Ja{getLabelAndValue(i){const o=this._cachedMeta,c=this.chart.data.labels||[],{xScale:h,yScale:p}=o,g=this.getParsed(i),x=h.getLabelForValue(g.x),s=p.getLabelForValue(g.y);return{label:c[i]||"",value:"("+x+", "+s+")"}}update(i){const o=this._cachedMeta,{data:c=[]}=o,h=this.chart._animationsDisabled;let{start:p,count:g}=Xk(o,c,h);if(this._drawStart=p,this._drawCount=g,Yk(o)&&(p=0,g=c.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:x,_dataset:s}=o;x._chart=this.chart,x._datasetIndex=this.index,x._decimated=!!s._decimated,x.points=c;const M=this.resolveDatasetElementOptions(i);M.segment=this.options.segment,this.updateElement(x,void 0,{animated:!h,options:M},i)}else this.datasetElementType&&(delete o.dataset,this.datasetElementType=!1);this.updateElements(c,p,g,i)}addElements(){const{showLine:i}=this.options;!this.datasetElementType&&i&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(i,o,c,h){const p=h==="reset",{iScale:g,vScale:x,_stacked:s,_dataset:M}=this._cachedMeta,C=this.resolveDataElementOptions(o,h),D=this.getSharedOptions(C),F=this.includeOptions(h,D),V=g.axis,X=x.axis,{spanGaps:W,segment:J}=this.options,$=Xf(W)?W:Number.POSITIVE_INFINITY,ne=this.chart._animationsDisabled||p||h==="none";let ye=o>0&&this.getParsed(o-1);for(let pe=o;pe<o+c;++pe){const ke=i[pe],Ae=this.getParsed(pe),tt=ne?ke:{},pt=Wn(Ae[X]),kt=tt[V]=g.getPixelForValue(Ae[V],pe),Ie=tt[X]=p||pt?x.getBasePixel():x.getPixelForValue(s?this.applyStack(x,Ae,s):Ae[X],pe);tt.skip=isNaN(kt)||isNaN(Ie)||pt,tt.stop=pe>0&&Math.abs(Ae[V]-ye[V])>$,J&&(tt.parsed=Ae,tt.raw=M.data[pe]),F&&(tt.options=D||this.resolveDataElementOptions(pe,ke.active?"active":h)),ne||this.updateElement(ke,pe,tt,h),ye=Ae}this.updateSharedOptions(D,h,C)}getMaxOverflow(){const i=this._cachedMeta,o=i.data||[];if(!this.options.showLine){let x=0;for(let s=o.length-1;s>=0;--s)x=Math.max(x,o[s].size(this.resolveDataElementOptions(s))/2);return x>0&&x}const c=i.dataset,h=c.options&&c.options.borderWidth||0;if(!o.length)return h;const p=o[0].size(this.resolveDataElementOptions(0)),g=o[o.length-1].size(this.resolveDataElementOptions(o.length-1));return Math.max(h,p,g)/2}}ui(B_,"id","scatter"),ui(B_,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),ui(B_,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var f8=Object.freeze({__proto__:null,BarController:O_,BubbleController:R_,DoughnutController:bh,LineController:z_,PieController:g1,PolarAreaController:qp,RadarController:F_,ScatterController:B_});function mh(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Eb{constructor(i){ui(this,"options");this.options=i||{}}static override(i){Object.assign(Eb.prototype,i)}init(){}formats(){return mh()}parse(){return mh()}format(){return mh()}add(){return mh()}diff(){return mh()}startOf(){return mh()}endOf(){return mh()}}var d8={_date:Eb};function p8(n,i,o,c){const{controller:h,data:p,_sorted:g}=n,x=h._cachedMeta.iScale;if(x&&i===x.axis&&i!=="r"&&g&&p.length){const s=x._reversePixels?F6:bc;if(c){if(h._sharedOptions){const M=p[0],C=typeof M.getRange=="function"&&M.getRange(i);if(C){const D=s(p,i,o-C),F=s(p,i,o+C);return{lo:D.lo,hi:F.hi}}}}else return s(p,i,o)}return{lo:0,hi:p.length-1}}function Tm(n,i,o,c,h){const p=n.getSortedVisibleDatasetMetas(),g=o[i];for(let x=0,s=p.length;x<s;++x){const{index:M,data:C}=p[x],{lo:D,hi:F}=p8(p[x],i,g,h);for(let V=D;V<=F;++V){const X=C[V];X.skip||c(X,M,V)}}}function m8(n){const i=n.indexOf("x")!==-1,o=n.indexOf("y")!==-1;return function(c,h){const p=i?Math.abs(c.x-h.x):0,g=o?Math.abs(c.y-h.y):0;return Math.sqrt(Math.pow(p,2)+Math.pow(g,2))}}function kx(n,i,o,c,h){const p=[];return!h&&!n.isPointInArea(i)||Tm(n,o,i,function(x,s,M){!h&&!wc(x,n.chartArea,0)||x.inRange(i.x,i.y,c)&&p.push({element:x,datasetIndex:s,index:M})},!0),p}function g8(n,i,o,c){let h=[];function p(g,x,s){const{startAngle:M,endAngle:C}=g.getProps(["startAngle","endAngle"],c),{angle:D}=Gk(g,{x:i.x,y:i.y});em(D,M,C)&&h.push({element:g,datasetIndex:x,index:s})}return Tm(n,o,i,p),h}function _8(n,i,o,c,h,p){let g=[];const x=m8(o);let s=Number.POSITIVE_INFINITY;function M(C,D,F){const V=C.inRange(i.x,i.y,h);if(c&&!V)return;const X=C.getCenterPoint(h);if(!(!!p||n.isPointInArea(X))&&!V)return;const J=x(i,X);J<s?(g=[{element:C,datasetIndex:D,index:F}],s=J):J===s&&g.push({element:C,datasetIndex:D,index:F})}return Tm(n,o,i,M),g}function Dx(n,i,o,c,h,p){return!p&&!n.isPointInArea(i)?[]:o==="r"&&!c?g8(n,i,o,h):_8(n,i,o,c,h,p)}function GA(n,i,o,c,h){const p=[],g=o==="x"?"inXRange":"inYRange";let x=!1;return Tm(n,o,i,(s,M,C)=>{s[g](i[o],h)&&(p.push({element:s,datasetIndex:M,index:C}),x=x||s.inRange(i.x,i.y,h))}),c&&!x?[]:p}var y8={evaluateInteractionItems:Tm,modes:{index(n,i,o,c){const h=_h(i,n),p=o.axis||"x",g=o.includeInvisible||!1,x=o.intersect?kx(n,h,p,c,g):Dx(n,h,p,!1,c,g),s=[];return x.length?(n.getSortedVisibleDatasetMetas().forEach(M=>{const C=x[0].index,D=M.data[C];D&&!D.skip&&s.push({element:D,datasetIndex:M.index,index:C})}),s):[]},dataset(n,i,o,c){const h=_h(i,n),p=o.axis||"xy",g=o.includeInvisible||!1;let x=o.intersect?kx(n,h,p,c,g):Dx(n,h,p,!1,c,g);if(x.length>0){const s=x[0].datasetIndex,M=n.getDatasetMeta(s).data;x=[];for(let C=0;C<M.length;++C)x.push({element:M[C],datasetIndex:s,index:C})}return x},point(n,i,o,c){const h=_h(i,n),p=o.axis||"xy",g=o.includeInvisible||!1;return kx(n,h,p,c,g)},nearest(n,i,o,c){const h=_h(i,n),p=o.axis||"xy",g=o.includeInvisible||!1;return Dx(n,h,p,o.intersect,c,g)},x(n,i,o,c){const h=_h(i,n);return GA(n,h,"x",o.intersect,c)},y(n,i,o,c){const h=_h(i,n);return GA(n,h,"y",o.intersect,c)}}};const d3=["left","top","right","bottom"];function yp(n,i){return n.filter(o=>o.pos===i)}function HA(n,i){return n.filter(o=>d3.indexOf(o.pos)===-1&&o.box.axis===i)}function vp(n,i){return n.sort((o,c)=>{const h=i?c:o,p=i?o:c;return h.weight===p.weight?h.index-p.index:h.weight-p.weight})}function v8(n){const i=[];let o,c,h,p,g,x;for(o=0,c=(n||[]).length;o<c;++o)h=n[o],{position:p,options:{stack:g,stackWeight:x=1}}=h,i.push({index:o,box:h,pos:p,horizontal:h.isHorizontal(),weight:h.weight,stack:g&&p+g,stackWeight:x});return i}function x8(n){const i={};for(const o of n){const{stack:c,pos:h,stackWeight:p}=o;if(!c||!d3.includes(h))continue;const g=i[c]||(i[c]={count:0,placed:0,weight:0,size:0});g.count++,g.weight+=p}return i}function b8(n,i){const o=x8(n),{vBoxMaxWidth:c,hBoxMaxHeight:h}=i;let p,g,x;for(p=0,g=n.length;p<g;++p){x=n[p];const{fullSize:s}=x.box,M=o[x.stack],C=M&&x.stackWeight/M.weight;x.horizontal?(x.width=C?C*c:s&&i.availableWidth,x.height=h):(x.width=c,x.height=C?C*h:s&&i.availableHeight)}return o}function w8(n){const i=v8(n),o=vp(i.filter(M=>M.box.fullSize),!0),c=vp(yp(i,"left"),!0),h=vp(yp(i,"right")),p=vp(yp(i,"top"),!0),g=vp(yp(i,"bottom")),x=HA(i,"x"),s=HA(i,"y");return{fullSize:o,leftAndTop:c.concat(p),rightAndBottom:h.concat(s).concat(g).concat(x),chartArea:yp(i,"chartArea"),vertical:c.concat(h).concat(s),horizontal:p.concat(g).concat(x)}}function WA(n,i,o,c){return Math.max(n[o],i[o])+Math.max(n[c],i[c])}function p3(n,i){n.top=Math.max(n.top,i.top),n.left=Math.max(n.left,i.left),n.bottom=Math.max(n.bottom,i.bottom),n.right=Math.max(n.right,i.right)}function T8(n,i,o,c){const{pos:h,box:p}=o,g=n.maxPadding;if(!Dn(h)){o.size&&(n[h]-=o.size);const D=c[o.stack]||{size:0,count:1};D.size=Math.max(D.size,o.horizontal?p.height:p.width),o.size=D.size/D.count,n[h]+=o.size}p.getPadding&&p3(g,p.getPadding());const x=Math.max(0,i.outerWidth-WA(g,n,"left","right")),s=Math.max(0,i.outerHeight-WA(g,n,"top","bottom")),M=x!==n.w,C=s!==n.h;return n.w=x,n.h=s,o.horizontal?{same:M,other:C}:{same:C,other:M}}function S8(n){const i=n.maxPadding;function o(c){const h=Math.max(i[c]-n[c],0);return n[c]+=h,h}n.y+=o("top"),n.x+=o("left"),o("right"),o("bottom")}function M8(n,i){const o=i.maxPadding;function c(h){const p={left:0,top:0,right:0,bottom:0};return h.forEach(g=>{p[g]=Math.max(i[g],o[g])}),p}return c(n?["left","right"]:["top","bottom"])}function Cp(n,i,o,c){const h=[];let p,g,x,s,M,C;for(p=0,g=n.length,M=0;p<g;++p){x=n[p],s=x.box,s.update(x.width||i.w,x.height||i.h,M8(x.horizontal,i));const{same:D,other:F}=T8(i,o,x,c);M|=D&&h.length,C=C||F,s.fullSize||h.push(x)}return M&&Cp(h,i,o,c)||C}function d_(n,i,o,c,h){n.top=o,n.left=i,n.right=i+c,n.bottom=o+h,n.width=c,n.height=h}function qA(n,i,o,c){const h=o.padding;let{x:p,y:g}=i;for(const x of n){const s=x.box,M=c[x.stack]||{count:1,placed:0,weight:1},C=x.stackWeight/M.weight||1;if(x.horizontal){const D=i.w*C,F=M.size||s.height;$p(M.start)&&(g=M.start),s.fullSize?d_(s,h.left,g,o.outerWidth-h.right-h.left,F):d_(s,i.left+M.placed,g,D,F),M.start=g,M.placed+=D,g=s.bottom}else{const D=i.h*C,F=M.size||s.width;$p(M.start)&&(p=M.start),s.fullSize?d_(s,p,h.top,F,o.outerHeight-h.bottom-h.top):d_(s,p,i.top+M.placed,F,D),M.start=p,M.placed+=D,p=s.right}}i.x=p,i.y=g}var ts={addBox(n,i){n.boxes||(n.boxes=[]),i.fullSize=i.fullSize||!1,i.position=i.position||"top",i.weight=i.weight||0,i._layers=i._layers||function(){return[{z:0,draw(o){i.draw(o)}}]},n.boxes.push(i)},removeBox(n,i){const o=n.boxes?n.boxes.indexOf(i):-1;o!==-1&&n.boxes.splice(o,1)},configure(n,i,o){i.fullSize=o.fullSize,i.position=o.position,i.weight=o.weight},update(n,i,o,c){if(!n)return;const h=rs(n.options.layout.padding),p=Math.max(i-h.width,0),g=Math.max(o-h.height,0),x=w8(n.boxes),s=x.vertical,M=x.horizontal;hr(n.boxes,W=>{typeof W.beforeLayout=="function"&&W.beforeLayout()});const C=s.reduce((W,J)=>J.box.options&&J.box.options.display===!1?W:W+1,0)||1,D=Object.freeze({outerWidth:i,outerHeight:o,padding:h,availableWidth:p,availableHeight:g,vBoxMaxWidth:p/2/C,hBoxMaxHeight:g/2}),F=Object.assign({},h);p3(F,rs(c));const V=Object.assign({maxPadding:F,w:p,h:g,x:h.left,y:h.top},h),X=b8(s.concat(M),D);Cp(x.fullSize,V,D,X),Cp(s,V,D,X),Cp(M,V,D,X)&&Cp(s,V,D,X),S8(V),qA(x.leftAndTop,V,D,X),V.x+=V.w,V.y+=V.h,qA(x.rightAndBottom,V,D,X),n.chartArea={left:V.left,top:V.top,right:V.left+V.w,bottom:V.top+V.h,height:V.h,width:V.w},hr(x.chartArea,W=>{const J=W.box;Object.assign(J,n.chartArea),J.update(V.w,V.h,{left:0,top:0,right:0,bottom:0})})}};class m3{acquireContext(i,o){}releaseContext(i){return!1}addEventListener(i,o,c){}removeEventListener(i,o,c){}getDevicePixelRatio(){return 1}getMaximumSize(i,o,c,h){return o=Math.max(0,o||i.width),c=c||i.height,{width:o,height:Math.max(0,h?Math.floor(o/h):c)}}isAttached(i){return!0}updateConfig(i){}}class E8 extends m3{acquireContext(i){return i&&i.getContext&&i.getContext("2d")||null}updateConfig(i){i.options.animation=!1}}const N_="$chartjs",A8={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},ZA=n=>n===null||n==="";function I8(n,i){const o=n.style,c=n.getAttribute("height"),h=n.getAttribute("width");if(n[N_]={initial:{height:c,width:h,style:{display:o.display,height:o.height,width:o.width}}},o.display=o.display||"block",o.boxSizing=o.boxSizing||"border-box",ZA(h)){const p=CA(n,"width");p!==void 0&&(n.width=p)}if(ZA(c))if(n.style.height==="")n.height=n.width/(i||2);else{const p=CA(n,"height");p!==void 0&&(n.height=p)}return n}const g3=PN?{passive:!0}:!1;function C8(n,i,o){n&&n.addEventListener(i,o,g3)}function P8(n,i,o){n&&n.canvas&&n.canvas.removeEventListener(i,o,g3)}function k8(n,i){const o=A8[n.type]||n.type,{x:c,y:h}=_h(n,i);return{type:o,chart:i,native:n,x:c!==void 0?c:null,y:h!==void 0?h:null}}function _y(n,i){for(const o of n)if(o===i||o.contains(i))return!0}function D8(n,i,o){const c=n.canvas,h=new MutationObserver(p=>{let g=!1;for(const x of p)g=g||_y(x.addedNodes,c),g=g&&!_y(x.removedNodes,c);g&&o()});return h.observe(document,{childList:!0,subtree:!0}),h}function L8(n,i,o){const c=n.canvas,h=new MutationObserver(p=>{let g=!1;for(const x of p)g=g||_y(x.removedNodes,c),g=g&&!_y(x.addedNodes,c);g&&o()});return h.observe(document,{childList:!0,subtree:!0}),h}const im=new Map;let XA=0;function _3(){const n=window.devicePixelRatio;n!==XA&&(XA=n,im.forEach((i,o)=>{o.currentDevicePixelRatio!==n&&i()}))}function O8(n,i){im.size||window.addEventListener("resize",_3),im.set(n,i)}function R8(n){im.delete(n),im.size||window.removeEventListener("resize",_3)}function z8(n,i,o){const c=n.canvas,h=c&&Mb(c);if(!h)return;const p=Zk((x,s)=>{const M=h.clientWidth;o(x,s),M<h.clientWidth&&o()},window),g=new ResizeObserver(x=>{const s=x[0],M=s.contentRect.width,C=s.contentRect.height;M===0&&C===0||p(M,C)});return g.observe(h),O8(n,p),g}function Lx(n,i,o){o&&o.disconnect(),i==="resize"&&R8(n)}function F8(n,i,o){const c=n.canvas,h=Zk(p=>{n.ctx!==null&&o(k8(p,n))},n);return C8(c,i,h),h}class B8 extends m3{acquireContext(i,o){const c=i&&i.getContext&&i.getContext("2d");return c&&c.canvas===i?(I8(i,o),c):null}releaseContext(i){const o=i.canvas;if(!o[N_])return!1;const c=o[N_].initial;["height","width"].forEach(p=>{const g=c[p];Wn(g)?o.removeAttribute(p):o.setAttribute(p,g)});const h=c.style||{};return Object.keys(h).forEach(p=>{o.style[p]=h[p]}),o.width=o.width,delete o[N_],!0}addEventListener(i,o,c){this.removeEventListener(i,o);const h=i.$proxies||(i.$proxies={}),g={attach:D8,detach:L8,resize:z8}[o]||F8;h[o]=g(i,o,c)}removeEventListener(i,o){const c=i.$proxies||(i.$proxies={}),h=c[o];if(!h)return;({attach:Lx,detach:Lx,resize:Lx}[o]||P8)(i,o,h),c[o]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(i,o,c,h){return CN(i,o,c,h)}isAttached(i){const o=Mb(i);return!!(o&&o.isConnected)}}function N8(n){return!Sb()||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?E8:B8}class Ka{constructor(){ui(this,"x");ui(this,"y");ui(this,"active",!1);ui(this,"options");ui(this,"$animations")}tooltipPosition(i){const{x:o,y:c}=this.getProps(["x","y"],i);return{x:o,y:c}}hasValue(){return Xf(this.x)&&Xf(this.y)}getProps(i,o){const c=this.$animations;if(!o||!c)return this;const h={};return i.forEach(p=>{h[p]=c[p]&&c[p].active()?c[p]._to:this[p]}),h}}ui(Ka,"defaults",{}),ui(Ka,"defaultRoutes");function V8(n,i){const o=n.options.ticks,c=U8(n),h=Math.min(o.maxTicksLimit||c,c),p=o.major.enabled?G8(i):[],g=p.length,x=p[0],s=p[g-1],M=[];if(g>h)return H8(i,M,p,g/h),M;const C=j8(p,i,h);if(g>0){let D,F;const V=g>1?Math.round((s-x)/(g-1)):null;for(p_(i,M,C,Wn(V)?0:x-V,x),D=0,F=g-1;D<F;D++)p_(i,M,C,p[D],p[D+1]);return p_(i,M,C,s,Wn(V)?i.length:s+V),M}return p_(i,M,C),M}function U8(n){const i=n.options.offset,o=n._tickSize(),c=n._length/o+(i?0:1),h=n._maxLength/o;return Math.floor(Math.min(c,h))}function j8(n,i,o){const c=W8(n),h=i.length/o;if(!c)return Math.max(h,1);const p=L6(c);for(let g=0,x=p.length-1;g<x;g++){const s=p[g];if(s>h)return s}return Math.max(h,1)}function G8(n){const i=[];let o,c;for(o=0,c=n.length;o<c;o++)n[o].major&&i.push(o);return i}function H8(n,i,o,c){let h=0,p=o[0],g;for(c=Math.ceil(c),g=0;g<n.length;g++)g===p&&(i.push(n[g]),h++,p=o[h*c])}function p_(n,i,o,c,h){const p=mn(c,0),g=Math.min(mn(h,n.length),n.length);let x=0,s,M,C;for(o=Math.ceil(o),h&&(s=h-c,o=s/Math.floor(s/o)),C=p;C<0;)x++,C=Math.round(p+x*o);for(M=Math.max(p,0);M<g;M++)M===C&&(i.push(n[M]),x++,C=Math.round(p+x*o))}function W8(n){const i=n.length;let o,c;if(i<2)return!1;for(c=n[0],o=1;o<i;++o)if(n[o]-n[o-1]!==c)return!1;return c}const q8=n=>n==="left"?"right":n==="right"?"left":n,YA=(n,i,o)=>i==="top"||i==="left"?n[i]+o:n[i]-o,JA=(n,i)=>Math.min(i||n,n);function KA(n,i){const o=[],c=n.length/i,h=n.length;let p=0;for(;p<h;p+=c)o.push(n[Math.floor(p)]);return o}function Z8(n,i,o){const c=n.ticks.length,h=Math.min(i,c-1),p=n._startPixel,g=n._endPixel,x=1e-6;let s=n.getPixelForTick(h),M;if(!(o&&(c===1?M=Math.max(s-p,g-s):i===0?M=(n.getPixelForTick(1)-s)/2:M=(s-n.getPixelForTick(h-1))/2,s+=h<i?M:-M,s<p-x||s>g+x)))return s}function X8(n,i){hr(n,o=>{const c=o.gc,h=c.length/2;let p;if(h>i){for(p=0;p<h;++p)delete o.data[c[p]];c.splice(0,h)}})}function xp(n){return n.drawTicks?n.tickLength:0}function QA(n,i){if(!n.display)return 0;const o=mo(n.font,i),c=rs(n.padding);return(kr(n.text)?n.text.length:1)*o.lineHeight+c.height}function Y8(n,i){return _u(n,{scale:i,type:"scale"})}function J8(n,i,o){return _u(n,{tick:o,index:i,type:"tick"})}function K8(n,i,o){let c=yb(n);return(o&&i!=="right"||!o&&i==="right")&&(c=q8(c)),c}function Q8(n,i,o,c){const{top:h,left:p,bottom:g,right:x,chart:s}=n,{chartArea:M,scales:C}=s;let D=0,F,V,X;const W=g-h,J=x-p;if(n.isHorizontal()){if(V=$o(c,p,x),Dn(o)){const $=Object.keys(o)[0],ne=o[$];X=C[$].getPixelForValue(ne)+W-i}else o==="center"?X=(M.bottom+M.top)/2+W-i:X=YA(n,o,i);F=x-p}else{if(Dn(o)){const $=Object.keys(o)[0],ne=o[$];V=C[$].getPixelForValue(ne)-J+i}else o==="center"?V=(M.left+M.right)/2-J+i:V=YA(n,o,i);X=$o(c,g,h),D=o==="left"?-io:io}return{titleX:V,titleY:X,maxWidth:F,rotation:D}}class Rh extends Ka{constructor(i){super(),this.id=i.id,this.type=i.type,this.options=void 0,this.ctx=i.ctx,this.chart=i.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(i){this.options=i.setContext(this.getContext()),this.axis=i.axis,this._userMin=this.parse(i.min),this._userMax=this.parse(i.max),this._suggestedMin=this.parse(i.suggestedMin),this._suggestedMax=this.parse(i.suggestedMax)}parse(i,o){return i}getUserBounds(){let{_userMin:i,_userMax:o,_suggestedMin:c,_suggestedMax:h}=this;return i=Qs(i,Number.POSITIVE_INFINITY),o=Qs(o,Number.NEGATIVE_INFINITY),c=Qs(c,Number.POSITIVE_INFINITY),h=Qs(h,Number.NEGATIVE_INFINITY),{min:Qs(i,c),max:Qs(o,h),minDefined:Hr(i),maxDefined:Hr(o)}}getMinMax(i){let{min:o,max:c,minDefined:h,maxDefined:p}=this.getUserBounds(),g;if(h&&p)return{min:o,max:c};const x=this.getMatchingVisibleMetas();for(let s=0,M=x.length;s<M;++s)g=x[s].controller.getMinMax(this,i),h||(o=Math.min(o,g.min)),p||(c=Math.max(c,g.max));return o=p&&o>c?c:o,c=h&&o>c?o:c,{min:Qs(o,Qs(c,o)),max:Qs(c,Qs(o,c))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const i=this.chart.data;return this.options.labels||(this.isHorizontal()?i.xLabels:i.yLabels)||i.labels||[]}getLabelItems(i=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(i))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Tr(this.options.beforeUpdate,[this])}update(i,o,c){const{beginAtZero:h,grace:p,ticks:g}=this.options,x=g.sampleSize;this.beforeUpdate(),this.maxWidth=i,this.maxHeight=o,this._margins=c=Object.assign({left:0,right:0,top:0,bottom:0},c),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+c.left+c.right:this.height+c.top+c.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=aN(this,p,h),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const s=x<this.ticks.length;this._convertTicksToLabels(s?KA(this.ticks,x):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),g.display&&(g.autoSkip||g.source==="auto")&&(this.ticks=V8(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),s&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let i=this.options.reverse,o,c;this.isHorizontal()?(o=this.left,c=this.right):(o=this.top,c=this.bottom,i=!i),this._startPixel=o,this._endPixel=c,this._reversePixels=i,this._length=c-o,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Tr(this.options.afterUpdate,[this])}beforeSetDimensions(){Tr(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Tr(this.options.afterSetDimensions,[this])}_callHooks(i){this.chart.notifyPlugins(i,this.getContext()),Tr(this.options[i],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Tr(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(i){const o=this.options.ticks;let c,h,p;for(c=0,h=i.length;c<h;c++)p=i[c],p.label=Tr(o.callback,[p.value,c,i],this)}afterTickToLabelConversion(){Tr(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Tr(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const i=this.options,o=i.ticks,c=JA(this.ticks.length,i.ticks.maxTicksLimit),h=o.minRotation||0,p=o.maxRotation;let g=h,x,s,M;if(!this._isVisible()||!o.display||h>=p||c<=1||!this.isHorizontal()){this.labelRotation=h;return}const C=this._getLabelSizes(),D=C.widest.width,F=C.highest.height,V=Eo(this.chart.width-D,0,this.maxWidth);x=i.offset?this.maxWidth/c:V/(c-1),D+6>x&&(x=V/(c-(i.offset?.5:1)),s=this.maxHeight-xp(i.grid)-o.padding-QA(i.title,this.chart.options.font),M=Math.sqrt(D*D+F*F),g=gb(Math.min(Math.asin(Eo((C.highest.height+6)/x,-1,1)),Math.asin(Eo(s/M,-1,1))-Math.asin(Eo(F/M,-1,1)))),g=Math.max(h,Math.min(p,g))),this.labelRotation=g}afterCalculateLabelRotation(){Tr(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Tr(this.options.beforeFit,[this])}fit(){const i={width:0,height:0},{chart:o,options:{ticks:c,title:h,grid:p}}=this,g=this._isVisible(),x=this.isHorizontal();if(g){const s=QA(h,o.options.font);if(x?(i.width=this.maxWidth,i.height=xp(p)+s):(i.height=this.maxHeight,i.width=xp(p)+s),c.display&&this.ticks.length){const{first:M,last:C,widest:D,highest:F}=this._getLabelSizes(),V=c.padding*2,X=Xa(this.labelRotation),W=Math.cos(X),J=Math.sin(X);if(x){const $=c.mirror?0:J*D.width+W*F.height;i.height=Math.min(this.maxHeight,i.height+$+V)}else{const $=c.mirror?0:W*D.width+J*F.height;i.width=Math.min(this.maxWidth,i.width+$+V)}this._calculatePadding(M,C,J,W)}}this._handleMargins(),x?(this.width=this._length=o.width-this._margins.left-this._margins.right,this.height=i.height):(this.width=i.width,this.height=this._length=o.height-this._margins.top-this._margins.bottom)}_calculatePadding(i,o,c,h){const{ticks:{align:p,padding:g},position:x}=this.options,s=this.labelRotation!==0,M=x!=="top"&&this.axis==="x";if(this.isHorizontal()){const C=this.getPixelForTick(0)-this.left,D=this.right-this.getPixelForTick(this.ticks.length-1);let F=0,V=0;s?M?(F=h*i.width,V=c*o.height):(F=c*i.height,V=h*o.width):p==="start"?V=o.width:p==="end"?F=i.width:p!=="inner"&&(F=i.width/2,V=o.width/2),this.paddingLeft=Math.max((F-C+g)*this.width/(this.width-C),0),this.paddingRight=Math.max((V-D+g)*this.width/(this.width-D),0)}else{let C=o.height/2,D=i.height/2;p==="start"?(C=0,D=i.height):p==="end"&&(C=o.height,D=0),this.paddingTop=C+g,this.paddingBottom=D+g}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Tr(this.options.afterFit,[this])}isHorizontal(){const{axis:i,position:o}=this.options;return o==="top"||o==="bottom"||i==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(i){this.beforeTickToLabelConversion(),this.generateTickLabels(i);let o,c;for(o=0,c=i.length;o<c;o++)Wn(i[o].label)&&(i.splice(o,1),c--,o--);this.afterTickToLabelConversion()}_getLabelSizes(){let i=this._labelSizes;if(!i){const o=this.options.ticks.sampleSize;let c=this.ticks;o<c.length&&(c=KA(c,o)),this._labelSizes=i=this._computeLabelSizes(c,c.length,this.options.ticks.maxTicksLimit)}return i}_computeLabelSizes(i,o,c){const{ctx:h,_longestTextCache:p}=this,g=[],x=[],s=Math.floor(o/JA(o,c));let M=0,C=0,D,F,V,X,W,J,$,ne,ye,pe,ke;for(D=0;D<o;D+=s){if(X=i[D].label,W=this._resolveTickFontOptions(D),h.font=J=W.string,$=p[J]=p[J]||{data:{},gc:[]},ne=W.lineHeight,ye=pe=0,!Wn(X)&&!kr(X))ye=my(h,$.data,$.gc,ye,X),pe=ne;else if(kr(X))for(F=0,V=X.length;F<V;++F)ke=X[F],!Wn(ke)&&!kr(ke)&&(ye=my(h,$.data,$.gc,ye,ke),pe+=ne);g.push(ye),x.push(pe),M=Math.max(ye,M),C=Math.max(pe,C)}X8(p,o);const Ae=g.indexOf(M),tt=x.indexOf(C),pt=kt=>({width:g[kt]||0,height:x[kt]||0});return{first:pt(0),last:pt(o-1),widest:pt(Ae),highest:pt(tt),widths:g,heights:x}}getLabelForValue(i){return i}getPixelForValue(i,o){return NaN}getValueForPixel(i){}getPixelForTick(i){const o=this.ticks;return i<0||i>o.length-1?null:this.getPixelForValue(o[i].value)}getPixelForDecimal(i){this._reversePixels&&(i=1-i);const o=this._startPixel+i*this._length;return z6(this._alignToPixels?ph(this.chart,o,0):o)}getDecimalForPixel(i){const o=(i-this._startPixel)/this._length;return this._reversePixels?1-o:o}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:i,max:o}=this;return i<0&&o<0?o:i>0&&o>0?i:0}getContext(i){const o=this.ticks||[];if(i>=0&&i<o.length){const c=o[i];return c.$context||(c.$context=J8(this.getContext(),i,c))}return this.$context||(this.$context=Y8(this.chart.getContext(),this))}_tickSize(){const i=this.options.ticks,o=Xa(this.labelRotation),c=Math.abs(Math.cos(o)),h=Math.abs(Math.sin(o)),p=this._getLabelSizes(),g=i.autoSkipPadding||0,x=p?p.widest.width+g:0,s=p?p.highest.height+g:0;return this.isHorizontal()?s*c>x*h?x/c:s/h:s*h<x*c?s/c:x/h}_isVisible(){const i=this.options.display;return i!=="auto"?!!i:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(i){const o=this.axis,c=this.chart,h=this.options,{grid:p,position:g,border:x}=h,s=p.offset,M=this.isHorizontal(),D=this.ticks.length+(s?1:0),F=xp(p),V=[],X=x.setContext(this.getContext()),W=X.display?X.width:0,J=W/2,$=function(mi){return ph(c,mi,W)};let ne,ye,pe,ke,Ae,tt,pt,kt,Ie,Et,mt,Xe;if(g==="top")ne=$(this.bottom),tt=this.bottom-F,kt=ne-J,Et=$(i.top)+J,Xe=i.bottom;else if(g==="bottom")ne=$(this.top),Et=i.top,Xe=$(i.bottom)-J,tt=ne+J,kt=this.top+F;else if(g==="left")ne=$(this.right),Ae=this.right-F,pt=ne-J,Ie=$(i.left)+J,mt=i.right;else if(g==="right")ne=$(this.left),Ie=i.left,mt=$(i.right)-J,Ae=ne+J,pt=this.left+F;else if(o==="x"){if(g==="center")ne=$((i.top+i.bottom)/2+.5);else if(Dn(g)){const mi=Object.keys(g)[0],Ti=g[mi];ne=$(this.chart.scales[mi].getPixelForValue(Ti))}Et=i.top,Xe=i.bottom,tt=ne+J,kt=tt+F}else if(o==="y"){if(g==="center")ne=$((i.left+i.right)/2);else if(Dn(g)){const mi=Object.keys(g)[0],Ti=g[mi];ne=$(this.chart.scales[mi].getPixelForValue(Ti))}Ae=ne-J,pt=Ae-F,Ie=i.left,mt=i.right}const Tt=mn(h.ticks.maxTicksLimit,D),Yt=Math.max(1,Math.ceil(D/Tt));for(ye=0;ye<D;ye+=Yt){const mi=this.getContext(ye),Ti=p.setContext(mi),Zi=x.setContext(mi),wt=Ti.lineWidth,Ii=Ti.color,Ui=Zi.dash||[],Mi=Zi.dashOffset,st=Ti.tickWidth,rt=Ti.tickColor,zi=Ti.tickBorderDash||[],Si=Ti.tickBorderDashOffset;pe=Z8(this,ye,s),pe!==void 0&&(ke=ph(c,pe,wt),M?Ae=pt=Ie=mt=ke:tt=kt=Et=Xe=ke,V.push({tx1:Ae,ty1:tt,tx2:pt,ty2:kt,x1:Ie,y1:Et,x2:mt,y2:Xe,width:wt,color:Ii,borderDash:Ui,borderDashOffset:Mi,tickWidth:st,tickColor:rt,tickBorderDash:zi,tickBorderDashOffset:Si}))}return this._ticksLength=D,this._borderValue=ne,V}_computeLabelItems(i){const o=this.axis,c=this.options,{position:h,ticks:p}=c,g=this.isHorizontal(),x=this.ticks,{align:s,crossAlign:M,padding:C,mirror:D}=p,F=xp(c.grid),V=F+C,X=D?-C:V,W=-Xa(this.labelRotation),J=[];let $,ne,ye,pe,ke,Ae,tt,pt,kt,Ie,Et,mt,Xe="middle";if(h==="top")Ae=this.bottom-X,tt=this._getXAxisLabelAlignment();else if(h==="bottom")Ae=this.top+X,tt=this._getXAxisLabelAlignment();else if(h==="left"){const Yt=this._getYAxisLabelAlignment(F);tt=Yt.textAlign,ke=Yt.x}else if(h==="right"){const Yt=this._getYAxisLabelAlignment(F);tt=Yt.textAlign,ke=Yt.x}else if(o==="x"){if(h==="center")Ae=(i.top+i.bottom)/2+V;else if(Dn(h)){const Yt=Object.keys(h)[0],mi=h[Yt];Ae=this.chart.scales[Yt].getPixelForValue(mi)+V}tt=this._getXAxisLabelAlignment()}else if(o==="y"){if(h==="center")ke=(i.left+i.right)/2-V;else if(Dn(h)){const Yt=Object.keys(h)[0],mi=h[Yt];ke=this.chart.scales[Yt].getPixelForValue(mi)}tt=this._getYAxisLabelAlignment(F).textAlign}o==="y"&&(s==="start"?Xe="top":s==="end"&&(Xe="bottom"));const Tt=this._getLabelSizes();for($=0,ne=x.length;$<ne;++$){ye=x[$],pe=ye.label;const Yt=p.setContext(this.getContext($));pt=this.getPixelForTick($)+p.labelOffset,kt=this._resolveTickFontOptions($),Ie=kt.lineHeight,Et=kr(pe)?pe.length:1;const mi=Et/2,Ti=Yt.color,Zi=Yt.textStrokeColor,wt=Yt.textStrokeWidth;let Ii=tt;g?(ke=pt,tt==="inner"&&($===ne-1?Ii=this.options.reverse?"left":"right":$===0?Ii=this.options.reverse?"right":"left":Ii="center"),h==="top"?M==="near"||W!==0?mt=-Et*Ie+Ie/2:M==="center"?mt=-Tt.highest.height/2-mi*Ie+Ie:mt=-Tt.highest.height+Ie/2:M==="near"||W!==0?mt=Ie/2:M==="center"?mt=Tt.highest.height/2-mi*Ie:mt=Tt.highest.height-Et*Ie,D&&(mt*=-1),W!==0&&!Yt.showLabelBackdrop&&(ke+=Ie/2*Math.sin(W))):(Ae=pt,mt=(1-Et)*Ie/2);let Ui;if(Yt.showLabelBackdrop){const Mi=rs(Yt.backdropPadding),st=Tt.heights[$],rt=Tt.widths[$];let zi=mt-Mi.top,Si=0-Mi.left;switch(Xe){case"middle":zi-=st/2;break;case"bottom":zi-=st;break}switch(tt){case"center":Si-=rt/2;break;case"right":Si-=rt;break;case"inner":$===ne-1?Si-=rt:$>0&&(Si-=rt/2);break}Ui={left:Si,top:zi,width:rt+Mi.width,height:st+Mi.height,color:Yt.backdropColor}}J.push({label:pe,font:kt,textOffset:mt,options:{rotation:W,color:Ti,strokeColor:Zi,strokeWidth:wt,textAlign:Ii,textBaseline:Xe,translation:[ke,Ae],backdrop:Ui}})}return J}_getXAxisLabelAlignment(){const{position:i,ticks:o}=this.options;if(-Xa(this.labelRotation))return i==="top"?"left":"right";let h="center";return o.align==="start"?h="left":o.align==="end"?h="right":o.align==="inner"&&(h="inner"),h}_getYAxisLabelAlignment(i){const{position:o,ticks:{crossAlign:c,mirror:h,padding:p}}=this.options,g=this._getLabelSizes(),x=i+p,s=g.widest.width;let M,C;return o==="left"?h?(C=this.right+p,c==="near"?M="left":c==="center"?(M="center",C+=s/2):(M="right",C+=s)):(C=this.right-x,c==="near"?M="right":c==="center"?(M="center",C-=s/2):(M="left",C=this.left)):o==="right"?h?(C=this.left+p,c==="near"?M="right":c==="center"?(M="center",C-=s/2):(M="left",C-=s)):(C=this.left+x,c==="near"?M="left":c==="center"?(M="center",C+=s/2):(M="right",C=this.right)):M="right",{textAlign:M,x:C}}_computeLabelArea(){if(this.options.ticks.mirror)return;const i=this.chart,o=this.options.position;if(o==="left"||o==="right")return{top:0,left:this.left,bottom:i.height,right:this.right};if(o==="top"||o==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:i.width}}drawBackground(){const{ctx:i,options:{backgroundColor:o},left:c,top:h,width:p,height:g}=this;o&&(i.save(),i.fillStyle=o,i.fillRect(c,h,p,g),i.restore())}getLineWidthForValue(i){const o=this.options.grid;if(!this._isVisible()||!o.display)return 0;const h=this.ticks.findIndex(p=>p.value===i);return h>=0?o.setContext(this.getContext(h)).lineWidth:0}drawGrid(i){const o=this.options.grid,c=this.ctx,h=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(i));let p,g;const x=(s,M,C)=>{!C.width||!C.color||(c.save(),c.lineWidth=C.width,c.strokeStyle=C.color,c.setLineDash(C.borderDash||[]),c.lineDashOffset=C.borderDashOffset,c.beginPath(),c.moveTo(s.x,s.y),c.lineTo(M.x,M.y),c.stroke(),c.restore())};if(o.display)for(p=0,g=h.length;p<g;++p){const s=h[p];o.drawOnChartArea&&x({x:s.x1,y:s.y1},{x:s.x2,y:s.y2},s),o.drawTicks&&x({x:s.tx1,y:s.ty1},{x:s.tx2,y:s.ty2},{color:s.tickColor,width:s.tickWidth,borderDash:s.tickBorderDash,borderDashOffset:s.tickBorderDashOffset})}}drawBorder(){const{chart:i,ctx:o,options:{border:c,grid:h}}=this,p=c.setContext(this.getContext()),g=c.display?p.width:0;if(!g)return;const x=h.setContext(this.getContext(0)).lineWidth,s=this._borderValue;let M,C,D,F;this.isHorizontal()?(M=ph(i,this.left,g)-g/2,C=ph(i,this.right,x)+x/2,D=F=s):(D=ph(i,this.top,g)-g/2,F=ph(i,this.bottom,x)+x/2,M=C=s),o.save(),o.lineWidth=p.width,o.strokeStyle=p.color,o.beginPath(),o.moveTo(M,D),o.lineTo(C,F),o.stroke(),o.restore()}drawLabels(i){if(!this.options.ticks.display)return;const c=this.ctx,h=this._computeLabelArea();h&&Yy(c,h);const p=this.getLabelItems(i);for(const g of p){const x=g.options,s=g.font,M=g.label,C=g.textOffset;Dh(c,M,0,C,s,x)}h&&Jy(c)}drawTitle(){const{ctx:i,options:{position:o,title:c,reverse:h}}=this;if(!c.display)return;const p=mo(c.font),g=rs(c.padding),x=c.align;let s=p.lineHeight/2;o==="bottom"||o==="center"||Dn(o)?(s+=g.bottom,kr(c.text)&&(s+=p.lineHeight*(c.text.length-1))):s+=g.top;const{titleX:M,titleY:C,maxWidth:D,rotation:F}=Q8(this,s,o,x);Dh(i,c.text,0,0,p,{color:c.color,maxWidth:D,rotation:F,textAlign:K8(x,o,h),textBaseline:"middle",translation:[M,C]})}draw(i){this._isVisible()&&(this.drawBackground(),this.drawGrid(i),this.drawBorder(),this.drawTitle(),this.drawLabels(i))}_layers(){const i=this.options,o=i.ticks&&i.ticks.z||0,c=mn(i.grid&&i.grid.z,-1),h=mn(i.border&&i.border.z,0);return!this._isVisible()||this.draw!==Rh.prototype.draw?[{z:o,draw:p=>{this.draw(p)}}]:[{z:c,draw:p=>{this.drawBackground(),this.drawGrid(p),this.drawTitle()}},{z:h,draw:()=>{this.drawBorder()}},{z:o,draw:p=>{this.drawLabels(p)}}]}getMatchingVisibleMetas(i){const o=this.chart.getSortedVisibleDatasetMetas(),c=this.axis+"AxisID",h=[];let p,g;for(p=0,g=o.length;p<g;++p){const x=o[p];x[c]===this.id&&(!i||x.type===i)&&h.push(x)}return h}_resolveTickFontOptions(i){const o=this.options.ticks.setContext(this.getContext(i));return mo(o.font)}_maxDigits(){const i=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/i}}class m_{constructor(i,o,c){this.type=i,this.scope=o,this.override=c,this.items=Object.create(null)}isForType(i){return Object.prototype.isPrototypeOf.call(this.type.prototype,i.prototype)}register(i){const o=Object.getPrototypeOf(i);let c;tV(o)&&(c=this.register(o));const h=this.items,p=i.id,g=this.scope+"."+p;if(!p)throw new Error("class does not have id: "+i);return p in h||(h[p]=i,$8(i,g,c),this.override&&Wr.override(i.id,i.overrides)),g}get(i){return this.items[i]}unregister(i){const o=this.items,c=i.id,h=this.scope;c in o&&delete o[c],h&&c in Wr[h]&&(delete Wr[h][c],this.override&&delete kh[c])}}function $8(n,i,o){const c=Qp(Object.create(null),[o?Wr.get(o):{},Wr.get(i),n.defaults]);Wr.set(i,c),n.defaultRoutes&&eV(i,n.defaultRoutes),n.descriptors&&Wr.describe(i,n.descriptors)}function eV(n,i){Object.keys(i).forEach(o=>{const c=o.split("."),h=c.pop(),p=[n].concat(c).join("."),g=i[o].split("."),x=g.pop(),s=g.join(".");Wr.route(p,h,s,x)})}function tV(n){return"id"in n&&"defaults"in n}class iV{constructor(){this.controllers=new m_(Ja,"datasets",!0),this.elements=new m_(Ka,"elements"),this.plugins=new m_(Object,"plugins"),this.scales=new m_(Rh,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...i){this._each("register",i)}remove(...i){this._each("unregister",i)}addControllers(...i){this._each("register",i,this.controllers)}addElements(...i){this._each("register",i,this.elements)}addPlugins(...i){this._each("register",i,this.plugins)}addScales(...i){this._each("register",i,this.scales)}getController(i){return this._get(i,this.controllers,"controller")}getElement(i){return this._get(i,this.elements,"element")}getPlugin(i){return this._get(i,this.plugins,"plugin")}getScale(i){return this._get(i,this.scales,"scale")}removeControllers(...i){this._each("unregister",i,this.controllers)}removeElements(...i){this._each("unregister",i,this.elements)}removePlugins(...i){this._each("unregister",i,this.plugins)}removeScales(...i){this._each("unregister",i,this.scales)}_each(i,o,c){[...o].forEach(h=>{const p=c||this._getRegistryForType(h);c||p.isForType(h)||p===this.plugins&&h.id?this._exec(i,p,h):hr(h,g=>{const x=c||this._getRegistryForType(g);this._exec(i,x,g)})})}_exec(i,o,c){const h=mb(i);Tr(c["before"+h],[],c),o[i](c),Tr(c["after"+h],[],c)}_getRegistryForType(i){for(let o=0;o<this._typedRegistries.length;o++){const c=this._typedRegistries[o];if(c.isForType(i))return c}return this.plugins}_get(i,o,c){const h=o.get(i);if(h===void 0)throw new Error('"'+i+'" is not a registered '+c+".");return h}}var wl=new iV;class nV{constructor(){this._init=[]}notify(i,o,c,h){o==="beforeInit"&&(this._init=this._createDescriptors(i,!0),this._notify(this._init,i,"install"));const p=h?this._descriptors(i).filter(h):this._descriptors(i),g=this._notify(p,i,o,c);return o==="afterDestroy"&&(this._notify(p,i,"stop"),this._notify(this._init,i,"uninstall")),g}_notify(i,o,c,h){h=h||{};for(const p of i){const g=p.plugin,x=g[c],s=[o,h,p.options];if(Tr(x,s,g)===!1&&h.cancelable)return!1}return!0}invalidate(){Wn(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(i){if(this._cache)return this._cache;const o=this._cache=this._createDescriptors(i);return this._notifyStateChanges(i),o}_createDescriptors(i,o){const c=i&&i.config,h=mn(c.options&&c.options.plugins,{}),p=rV(c);return h===!1&&!o?[]:sV(i,p,h,o)}_notifyStateChanges(i){const o=this._oldCache||[],c=this._cache,h=(p,g)=>p.filter(x=>!g.some(s=>x.plugin.id===s.plugin.id));this._notify(h(o,c),i,"stop"),this._notify(h(c,o),i,"start")}}function rV(n){const i={},o=[],c=Object.keys(wl.plugins.items);for(let p=0;p<c.length;p++)o.push(wl.getPlugin(c[p]));const h=n.plugins||[];for(let p=0;p<h.length;p++){const g=h[p];o.indexOf(g)===-1&&(o.push(g),i[g.id]=!0)}return{plugins:o,localIds:i}}function oV(n,i){return!i&&n===!1?null:n===!0?{}:n}function sV(n,{plugins:i,localIds:o},c,h){const p=[],g=n.getContext();for(const x of i){const s=x.id,M=oV(c[s],h);M!==null&&p.push({plugin:x,options:aV(n.config,{plugin:x,local:o[s]},M,g)})}return p}function aV(n,{plugin:i,local:o},c,h){const p=n.pluginScopeKeys(i),g=n.getOptionScopes(c,p);return o&&i.defaults&&g.push(i.defaults),n.createResolver(g,h,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function _1(n,i){const o=Wr.datasets[n]||{};return((i.datasets||{})[n]||{}).indexAxis||i.indexAxis||o.indexAxis||"x"}function lV(n,i){let o=n;return n==="_index_"?o=i:n==="_value_"&&(o=i==="x"?"y":"x"),o}function cV(n,i){return n===i?"_index_":"_value_"}function $A(n){if(n==="x"||n==="y"||n==="r")return n}function uV(n){if(n==="top"||n==="bottom")return"x";if(n==="left"||n==="right")return"y"}function y1(n,...i){if($A(n))return n;for(const o of i){const c=o.axis||uV(o.position)||n.length>1&&$A(n[0].toLowerCase());if(c)return c}throw new Error(`Cannot determine type of '${n}' axis. Please provide 'axis' or 'position' option.`)}function eI(n,i,o){if(o[i+"AxisID"]===n)return{axis:i}}function hV(n,i){if(i.data&&i.data.datasets){const o=i.data.datasets.filter(c=>c.xAxisID===n||c.yAxisID===n);if(o.length)return eI(n,"x",o[0])||eI(n,"y",o[0])}return{}}function fV(n,i){const o=kh[n.type]||{scales:{}},c=i.scales||{},h=_1(n.type,i),p=Object.create(null);return Object.keys(c).forEach(g=>{const x=c[g];if(!Dn(x))return console.error(`Invalid scale configuration for scale: ${g}`);if(x._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${g}`);const s=y1(g,x,hV(g,n),Wr.scales[x.type]),M=cV(s,h),C=o.scales||{};p[g]=jp(Object.create(null),[{axis:s},x,C[s],C[M]])}),n.data.datasets.forEach(g=>{const x=g.type||n.type,s=g.indexAxis||_1(x,i),C=(kh[x]||{}).scales||{};Object.keys(C).forEach(D=>{const F=lV(D,s),V=g[F+"AxisID"]||F;p[V]=p[V]||Object.create(null),jp(p[V],[{axis:F},c[V],C[D]])})}),Object.keys(p).forEach(g=>{const x=p[g];jp(x,[Wr.scales[x.type],Wr.scale])}),p}function y3(n){const i=n.options||(n.options={});i.plugins=mn(i.plugins,{}),i.scales=fV(n,i)}function v3(n){return n=n||{},n.datasets=n.datasets||[],n.labels=n.labels||[],n}function dV(n){return n=n||{},n.data=v3(n.data),y3(n),n}const tI=new Map,x3=new Set;function g_(n,i){let o=tI.get(n);return o||(o=i(),tI.set(n,o),x3.add(o)),o}const bp=(n,i,o)=>{const c=pu(i,o);c!==void 0&&n.add(c)};class pV{constructor(i){this._config=dV(i),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(i){this._config.type=i}get data(){return this._config.data}set data(i){this._config.data=v3(i)}get options(){return this._config.options}set options(i){this._config.options=i}get plugins(){return this._config.plugins}update(){const i=this._config;this.clearCache(),y3(i)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(i){return g_(i,()=>[[`datasets.${i}`,""]])}datasetAnimationScopeKeys(i,o){return g_(`${i}.transition.${o}`,()=>[[`datasets.${i}.transitions.${o}`,`transitions.${o}`],[`datasets.${i}`,""]])}datasetElementScopeKeys(i,o){return g_(`${i}-${o}`,()=>[[`datasets.${i}.elements.${o}`,`datasets.${i}`,`elements.${o}`,""]])}pluginScopeKeys(i){const o=i.id,c=this.type;return g_(`${c}-plugin-${o}`,()=>[[`plugins.${o}`,...i.additionalOptionScopes||[]]])}_cachedScopes(i,o){const c=this._scopeCache;let h=c.get(i);return(!h||o)&&(h=new Map,c.set(i,h)),h}getOptionScopes(i,o,c){const{options:h,type:p}=this,g=this._cachedScopes(i,c),x=g.get(o);if(x)return x;const s=new Set;o.forEach(C=>{i&&(s.add(i),C.forEach(D=>bp(s,i,D))),C.forEach(D=>bp(s,h,D)),C.forEach(D=>bp(s,kh[p]||{},D)),C.forEach(D=>bp(s,Wr,D)),C.forEach(D=>bp(s,p1,D))});const M=Array.from(s);return M.length===0&&M.push(Object.create(null)),x3.has(o)&&g.set(o,M),M}chartOptionScopes(){const{options:i,type:o}=this;return[i,kh[o]||{},Wr.datasets[o]||{},{type:o},Wr,p1]}resolveNamedOptions(i,o,c,h=[""]){const p={$shared:!0},{resolver:g,subPrefixes:x}=iI(this._resolverCache,i,h);let s=g;if(gV(g,o)){p.$shared=!1,c=mu(c)?c():c;const M=this.createResolver(i,c,x);s=Yf(g,c,M)}for(const M of o)p[M]=s[M];return p}createResolver(i,o,c=[""],h){const{resolver:p}=iI(this._resolverCache,i,c);return Dn(o)?Yf(p,o,void 0,h):p}}function iI(n,i,o){let c=n.get(i);c||(c=new Map,n.set(i,c));const h=o.join();let p=c.get(h);return p||(p={resolver:bb(i,o),subPrefixes:o.filter(x=>!x.toLowerCase().includes("hover"))},c.set(h,p)),p}const mV=n=>Dn(n)&&Object.getOwnPropertyNames(n).some(i=>mu(n[i]));function gV(n,i){const{isScriptable:o,isIndexable:c}=$k(n);for(const h of i){const p=o(h),g=c(h),x=(g||p)&&n[h];if(p&&(mu(x)||mV(x))||g&&kr(x))return!0}return!1}var _V="4.4.2";const yV=["top","bottom","left","right","chartArea"];function nI(n,i){return n==="top"||n==="bottom"||yV.indexOf(n)===-1&&i==="x"}function rI(n,i){return function(o,c){return o[n]===c[n]?o[i]-c[i]:o[n]-c[n]}}function oI(n){const i=n.chart,o=i.options.animation;i.notifyPlugins("afterRender"),Tr(o&&o.onComplete,[n],i)}function vV(n){const i=n.chart,o=i.options.animation;Tr(o&&o.onProgress,[n],i)}function b3(n){return Sb()&&typeof n=="string"?n=document.getElementById(n):n&&n.length&&(n=n[0]),n&&n.canvas&&(n=n.canvas),n}const V_={},sI=n=>{const i=b3(n);return Object.values(V_).filter(o=>o.canvas===i).pop()};function xV(n,i,o){const c=Object.keys(n);for(const h of c){const p=+h;if(p>=i){const g=n[h];delete n[h],(o>0||p>i)&&(n[p+o]=g)}}}function bV(n,i,o,c){return!o||n.type==="mouseout"?null:c?i:n}function __(n,i,o){return n.options.clip?n[o]:i[o]}function wV(n,i){const{xScale:o,yScale:c}=n;return o&&c?{left:__(o,i,"left"),right:__(o,i,"right"),top:__(c,i,"top"),bottom:__(c,i,"bottom")}:i}class au{static register(...i){wl.add(...i),aI()}static unregister(...i){wl.remove(...i),aI()}constructor(i,o){const c=this.config=new pV(o),h=b3(i),p=sI(h);if(p)throw new Error("Canvas is already in use. Chart with ID '"+p.id+"' must be destroyed before the canvas with ID '"+p.canvas.id+"' can be reused.");const g=c.createResolver(c.chartOptionScopes(),this.getContext());this.platform=new(c.platform||N8(h)),this.platform.updateConfig(c);const x=this.platform.acquireContext(h,g.aspectRatio),s=x&&x.canvas,M=s&&s.height,C=s&&s.width;if(this.id=S6(),this.ctx=x,this.canvas=s,this.width=C,this.height=M,this._options=g,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new nV,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=V6(D=>this.update(D),g.resizeDelay||0),this._dataChanges=[],V_[this.id]=this,!x||!s){console.error("Failed to create chart: can't acquire context from the given item");return}pc.listen(this,"complete",oI),pc.listen(this,"progress",vV),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:i,maintainAspectRatio:o},width:c,height:h,_aspectRatio:p}=this;return Wn(i)?o&&p?p:h?c/h:null:i}get data(){return this.config.data}set data(i){this.config.data=i}get options(){return this._options}set options(i){this.config.options=i}get registry(){return wl}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():IA(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return MA(this.canvas,this.ctx),this}stop(){return pc.stop(this),this}resize(i,o){pc.running(this)?this._resizeBeforeDraw={width:i,height:o}:this._resize(i,o)}_resize(i,o){const c=this.options,h=this.canvas,p=c.maintainAspectRatio&&this.aspectRatio,g=this.platform.getMaximumSize(h,i,o,p),x=c.devicePixelRatio||this.platform.getDevicePixelRatio(),s=this.width?"resize":"attach";this.width=g.width,this.height=g.height,this._aspectRatio=this.aspectRatio,IA(this,x,!0)&&(this.notifyPlugins("resize",{size:g}),Tr(c.onResize,[this,g],this),this.attached&&this._doResize(s)&&this.render())}ensureScalesHaveIDs(){const o=this.options.scales||{};hr(o,(c,h)=>{c.id=h})}buildOrUpdateScales(){const i=this.options,o=i.scales,c=this.scales,h=Object.keys(c).reduce((g,x)=>(g[x]=!1,g),{});let p=[];o&&(p=p.concat(Object.keys(o).map(g=>{const x=o[g],s=y1(g,x),M=s==="r",C=s==="x";return{options:x,dposition:M?"chartArea":C?"bottom":"left",dtype:M?"radialLinear":C?"category":"linear"}}))),hr(p,g=>{const x=g.options,s=x.id,M=y1(s,x),C=mn(x.type,g.dtype);(x.position===void 0||nI(x.position,M)!==nI(g.dposition))&&(x.position=g.dposition),h[s]=!0;let D=null;if(s in c&&c[s].type===C)D=c[s];else{const F=wl.getScale(C);D=new F({id:s,type:C,ctx:this.ctx,chart:this}),c[D.id]=D}D.init(x,i)}),hr(h,(g,x)=>{g||delete c[x]}),hr(c,g=>{ts.configure(this,g,g.options),ts.addBox(this,g)})}_updateMetasets(){const i=this._metasets,o=this.data.datasets.length,c=i.length;if(i.sort((h,p)=>h.index-p.index),c>o){for(let h=o;h<c;++h)this._destroyDatasetMeta(h);i.splice(o,c-o)}this._sortedMetasets=i.slice(0).sort(rI("order","index"))}_removeUnreferencedMetasets(){const{_metasets:i,data:{datasets:o}}=this;i.length>o.length&&delete this._stacks,i.forEach((c,h)=>{o.filter(p=>p===c._dataset).length===0&&this._destroyDatasetMeta(h)})}buildOrUpdateControllers(){const i=[],o=this.data.datasets;let c,h;for(this._removeUnreferencedMetasets(),c=0,h=o.length;c<h;c++){const p=o[c];let g=this.getDatasetMeta(c);const x=p.type||this.config.type;if(g.type&&g.type!==x&&(this._destroyDatasetMeta(c),g=this.getDatasetMeta(c)),g.type=x,g.indexAxis=p.indexAxis||_1(x,this.options),g.order=p.order||0,g.index=c,g.label=""+p.label,g.visible=this.isDatasetVisible(c),g.controller)g.controller.updateIndex(c),g.controller.linkScales();else{const s=wl.getController(x),{datasetElementType:M,dataElementType:C}=Wr.datasets[x];Object.assign(s,{dataElementType:wl.getElement(C),datasetElementType:M&&wl.getElement(M)}),g.controller=new s(this,c),i.push(g.controller)}}return this._updateMetasets(),i}_resetElements(){hr(this.data.datasets,(i,o)=>{this.getDatasetMeta(o).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(i){const o=this.config;o.update();const c=this._options=o.createResolver(o.chartOptionScopes(),this.getContext()),h=this._animationsDisabled=!c.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:i,cancelable:!0})===!1)return;const p=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let g=0;for(let M=0,C=this.data.datasets.length;M<C;M++){const{controller:D}=this.getDatasetMeta(M),F=!h&&p.indexOf(D)===-1;D.buildOrUpdateElements(F),g=Math.max(+D.getMaxOverflow(),g)}g=this._minPadding=c.layout.autoPadding?g:0,this._updateLayout(g),h||hr(p,M=>{M.reset()}),this._updateDatasets(i),this.notifyPlugins("afterUpdate",{mode:i}),this._layers.sort(rI("z","_idx"));const{_active:x,_lastEvent:s}=this;s?this._eventHandler(s,!0):x.length&&this._updateHoverStyles(x,x,!0),this.render()}_updateScales(){hr(this.scales,i=>{ts.removeBox(this,i)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const i=this.options,o=new Set(Object.keys(this._listeners)),c=new Set(i.events);(!gA(o,c)||!!this._responsiveListeners!==i.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:i}=this,o=this._getUniformDataChanges()||[];for(const{method:c,start:h,count:p}of o){const g=c==="_removeElements"?-p:p;xV(i,h,g)}}_getUniformDataChanges(){const i=this._dataChanges;if(!i||!i.length)return;this._dataChanges=[];const o=this.data.datasets.length,c=p=>new Set(i.filter(g=>g[0]===p).map((g,x)=>x+","+g.splice(1).join(","))),h=c(0);for(let p=1;p<o;p++)if(!gA(h,c(p)))return;return Array.from(h).map(p=>p.split(",")).map(p=>({method:p[1],start:+p[2],count:+p[3]}))}_updateLayout(i){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;ts.update(this,this.width,this.height,i);const o=this.chartArea,c=o.width<=0||o.height<=0;this._layers=[],hr(this.boxes,h=>{c&&h.position==="chartArea"||(h.configure&&h.configure(),this._layers.push(...h._layers()))},this),this._layers.forEach((h,p)=>{h._idx=p}),this.notifyPlugins("afterLayout")}_updateDatasets(i){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:i,cancelable:!0})!==!1){for(let o=0,c=this.data.datasets.length;o<c;++o)this.getDatasetMeta(o).controller.configure();for(let o=0,c=this.data.datasets.length;o<c;++o)this._updateDataset(o,mu(i)?i({datasetIndex:o}):i);this.notifyPlugins("afterDatasetsUpdate",{mode:i})}}_updateDataset(i,o){const c=this.getDatasetMeta(i),h={meta:c,index:i,mode:o,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",h)!==!1&&(c.controller._update(o),h.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",h))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(pc.has(this)?this.attached&&!pc.running(this)&&pc.start(this):(this.draw(),oI({chart:this})))}draw(){let i;if(this._resizeBeforeDraw){const{width:c,height:h}=this._resizeBeforeDraw;this._resize(c,h),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const o=this._layers;for(i=0;i<o.length&&o[i].z<=0;++i)o[i].draw(this.chartArea);for(this._drawDatasets();i<o.length;++i)o[i].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(i){const o=this._sortedMetasets,c=[];let h,p;for(h=0,p=o.length;h<p;++h){const g=o[h];(!i||g.visible)&&c.push(g)}return c}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const i=this.getSortedVisibleDatasetMetas();for(let o=i.length-1;o>=0;--o)this._drawDataset(i[o]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(i){const o=this.ctx,c=i._clip,h=!c.disabled,p=wV(i,this.chartArea),g={meta:i,index:i.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",g)!==!1&&(h&&Yy(o,{left:c.left===!1?0:p.left-c.left,right:c.right===!1?this.width:p.right+c.right,top:c.top===!1?0:p.top-c.top,bottom:c.bottom===!1?this.height:p.bottom+c.bottom}),i.controller.draw(),h&&Jy(o),g.cancelable=!1,this.notifyPlugins("afterDatasetDraw",g))}isPointInArea(i){return wc(i,this.chartArea,this._minPadding)}getElementsAtEventForMode(i,o,c,h){const p=y8.modes[o];return typeof p=="function"?p(this,i,c,h):[]}getDatasetMeta(i){const o=this.data.datasets[i],c=this._metasets;let h=c.filter(p=>p&&p._dataset===o).pop();return h||(h={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:o&&o.order||0,index:i,_dataset:o,_parsed:[],_sorted:!1},c.push(h)),h}getContext(){return this.$context||(this.$context=_u(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(i){const o=this.data.datasets[i];if(!o)return!1;const c=this.getDatasetMeta(i);return typeof c.hidden=="boolean"?!c.hidden:!o.hidden}setDatasetVisibility(i,o){const c=this.getDatasetMeta(i);c.hidden=!o}toggleDataVisibility(i){this._hiddenIndices[i]=!this._hiddenIndices[i]}getDataVisibility(i){return!this._hiddenIndices[i]}_updateVisibility(i,o,c){const h=c?"show":"hide",p=this.getDatasetMeta(i),g=p.controller._resolveAnimations(void 0,h);$p(o)?(p.data[o].hidden=!c,this.update()):(this.setDatasetVisibility(i,c),g.update(p,{visible:c}),this.update(x=>x.datasetIndex===i?h:void 0))}hide(i,o){this._updateVisibility(i,o,!1)}show(i,o){this._updateVisibility(i,o,!0)}_destroyDatasetMeta(i){const o=this._metasets[i];o&&o.controller&&o.controller._destroy(),delete this._metasets[i]}_stop(){let i,o;for(this.stop(),pc.remove(this),i=0,o=this.data.datasets.length;i<o;++i)this._destroyDatasetMeta(i)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:i,ctx:o}=this;this._stop(),this.config.clearCache(),i&&(this.unbindEvents(),MA(i,o),this.platform.releaseContext(o),this.canvas=null,this.ctx=null),delete V_[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...i){return this.canvas.toDataURL(...i)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const i=this._listeners,o=this.platform,c=(p,g)=>{o.addEventListener(this,p,g),i[p]=g},h=(p,g,x)=>{p.offsetX=g,p.offsetY=x,this._eventHandler(p)};hr(this.options.events,p=>c(p,h))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const i=this._responsiveListeners,o=this.platform,c=(s,M)=>{o.addEventListener(this,s,M),i[s]=M},h=(s,M)=>{i[s]&&(o.removeEventListener(this,s,M),delete i[s])},p=(s,M)=>{this.canvas&&this.resize(s,M)};let g;const x=()=>{h("attach",x),this.attached=!0,this.resize(),c("resize",p),c("detach",g)};g=()=>{this.attached=!1,h("resize",p),this._stop(),this._resize(0,0),c("attach",x)},o.isAttached(this.canvas)?x():g()}unbindEvents(){hr(this._listeners,(i,o)=>{this.platform.removeEventListener(this,o,i)}),this._listeners={},hr(this._responsiveListeners,(i,o)=>{this.platform.removeEventListener(this,o,i)}),this._responsiveListeners=void 0}updateHoverStyle(i,o,c){const h=c?"set":"remove";let p,g,x,s;for(o==="dataset"&&(p=this.getDatasetMeta(i[0].datasetIndex),p.controller["_"+h+"DatasetHoverStyle"]()),x=0,s=i.length;x<s;++x){g=i[x];const M=g&&this.getDatasetMeta(g.datasetIndex).controller;M&&M[h+"HoverStyle"](g.element,g.datasetIndex,g.index)}}getActiveElements(){return this._active||[]}setActiveElements(i){const o=this._active||[],c=i.map(({datasetIndex:p,index:g})=>{const x=this.getDatasetMeta(p);if(!x)throw new Error("No dataset found at index "+p);return{datasetIndex:p,element:x.data[g],index:g}});!fy(c,o)&&(this._active=c,this._lastEvent=null,this._updateHoverStyles(c,o))}notifyPlugins(i,o,c){return this._plugins.notify(this,i,o,c)}isPluginEnabled(i){return this._plugins._cache.filter(o=>o.plugin.id===i).length===1}_updateHoverStyles(i,o,c){const h=this.options.hover,p=(s,M)=>s.filter(C=>!M.some(D=>C.datasetIndex===D.datasetIndex&&C.index===D.index)),g=p(o,i),x=c?i:p(i,o);g.length&&this.updateHoverStyle(g,h.mode,!1),x.length&&h.mode&&this.updateHoverStyle(x,h.mode,!0)}_eventHandler(i,o){const c={event:i,replay:o,cancelable:!0,inChartArea:this.isPointInArea(i)},h=g=>(g.options.events||this.options.events).includes(i.native.type);if(this.notifyPlugins("beforeEvent",c,h)===!1)return;const p=this._handleEvent(i,o,c.inChartArea);return c.cancelable=!1,this.notifyPlugins("afterEvent",c,h),(p||c.changed)&&this.render(),this}_handleEvent(i,o,c){const{_active:h=[],options:p}=this,g=o,x=this._getActiveElements(i,h,c,g),s=P6(i),M=bV(i,this._lastEvent,c,s);c&&(this._lastEvent=null,Tr(p.onHover,[i,x,this],this),s&&Tr(p.onClick,[i,x,this],this));const C=!fy(x,h);return(C||o)&&(this._active=x,this._updateHoverStyles(x,h,o)),this._lastEvent=M,C}_getActiveElements(i,o,c,h){if(i.type==="mouseout")return[];if(!c)return o;const p=this.options.hover;return this.getElementsAtEventForMode(i,p.mode,p,h)}}ui(au,"defaults",Wr),ui(au,"instances",V_),ui(au,"overrides",kh),ui(au,"registry",wl),ui(au,"version",_V),ui(au,"getChart",sI);function aI(){return hr(au.instances,n=>n._plugins.invalidate())}function TV(n,i,o){const{startAngle:c,pixelMargin:h,x:p,y:g,outerRadius:x,innerRadius:s}=i;let M=h/x;n.beginPath(),n.arc(p,g,x,c-M,o+M),s>h?(M=h/s,n.arc(p,g,s,o+M,c-M,!0)):n.arc(p,g,h,o+io,c-io),n.closePath(),n.clip()}function SV(n){return xb(n,["outerStart","outerEnd","innerStart","innerEnd"])}function MV(n,i,o,c){const h=SV(n.options.borderRadius),p=(o-i)/2,g=Math.min(p,c*i/2),x=s=>{const M=(o-Math.min(p,s))*c/2;return Eo(s,0,Math.min(p,M))};return{outerStart:x(h.outerStart),outerEnd:x(h.outerEnd),innerStart:Eo(h.innerStart,0,g),innerEnd:Eo(h.innerEnd,0,g)}}function If(n,i,o,c){return{x:o+n*Math.cos(i),y:c+n*Math.sin(i)}}function yy(n,i,o,c,h,p){const{x:g,y:x,startAngle:s,pixelMargin:M,innerRadius:C}=i,D=Math.max(i.outerRadius+c+o-M,0),F=C>0?C+c+o+M:0;let V=0;const X=h-s;if(c){const Yt=C>0?C-c:0,mi=D>0?D-c:0,Ti=(Yt+mi)/2,Zi=Ti!==0?X*Ti/(Ti+c):X;V=(X-Zi)/2}const W=Math.max(.001,X*D-o/Lr)/D,J=(X-W)/2,$=s+J+V,ne=h-J-V,{outerStart:ye,outerEnd:pe,innerStart:ke,innerEnd:Ae}=MV(i,F,D,ne-$),tt=D-ye,pt=D-pe,kt=$+ye/tt,Ie=ne-pe/pt,Et=F+ke,mt=F+Ae,Xe=$+ke/Et,Tt=ne-Ae/mt;if(n.beginPath(),p){const Yt=(kt+Ie)/2;if(n.arc(g,x,D,kt,Yt),n.arc(g,x,D,Yt,Ie),pe>0){const wt=If(pt,Ie,g,x);n.arc(wt.x,wt.y,pe,Ie,ne+io)}const mi=If(mt,ne,g,x);if(n.lineTo(mi.x,mi.y),Ae>0){const wt=If(mt,Tt,g,x);n.arc(wt.x,wt.y,Ae,ne+io,Tt+Math.PI)}const Ti=(ne-Ae/F+($+ke/F))/2;if(n.arc(g,x,F,ne-Ae/F,Ti,!0),n.arc(g,x,F,Ti,$+ke/F,!0),ke>0){const wt=If(Et,Xe,g,x);n.arc(wt.x,wt.y,ke,Xe+Math.PI,$-io)}const Zi=If(tt,$,g,x);if(n.lineTo(Zi.x,Zi.y),ye>0){const wt=If(tt,kt,g,x);n.arc(wt.x,wt.y,ye,$-io,kt)}}else{n.moveTo(g,x);const Yt=Math.cos(kt)*D+g,mi=Math.sin(kt)*D+x;n.lineTo(Yt,mi);const Ti=Math.cos(Ie)*D+g,Zi=Math.sin(Ie)*D+x;n.lineTo(Ti,Zi)}n.closePath()}function EV(n,i,o,c,h){const{fullCircles:p,startAngle:g,circumference:x}=i;let s=i.endAngle;if(p){yy(n,i,o,c,s,h);for(let M=0;M<p;++M)n.fill();isNaN(x)||(s=g+(x%Dr||Dr))}return yy(n,i,o,c,s,h),n.fill(),s}function AV(n,i,o,c,h){const{fullCircles:p,startAngle:g,circumference:x,options:s}=i,{borderWidth:M,borderJoinStyle:C,borderDash:D,borderDashOffset:F}=s,V=s.borderAlign==="inner";if(!M)return;n.setLineDash(D||[]),n.lineDashOffset=F,V?(n.lineWidth=M*2,n.lineJoin=C||"round"):(n.lineWidth=M,n.lineJoin=C||"bevel");let X=i.endAngle;if(p){yy(n,i,o,c,X,h);for(let W=0;W<p;++W)n.stroke();isNaN(x)||(X=g+(x%Dr||Dr))}V&&TV(n,i,X),p||(yy(n,i,o,c,X,h),n.stroke())}class Pp extends Ka{constructor(o){super();ui(this,"circumference");ui(this,"endAngle");ui(this,"fullCircles");ui(this,"innerRadius");ui(this,"outerRadius");ui(this,"pixelMargin");ui(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,o&&Object.assign(this,o)}inRange(o,c,h){const p=this.getProps(["x","y"],h),{angle:g,distance:x}=Gk(p,{x:o,y:c}),{startAngle:s,endAngle:M,innerRadius:C,outerRadius:D,circumference:F}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],h),V=(this.options.spacing+this.options.borderWidth)/2,W=mn(F,M-s)>=Dr||em(g,s,M),J=xc(x,C+V,D+V);return W&&J}getCenterPoint(o){const{x:c,y:h,startAngle:p,endAngle:g,innerRadius:x,outerRadius:s}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],o),{offset:M,spacing:C}=this.options,D=(p+g)/2,F=(x+s+C+M)/2;return{x:c+Math.cos(D)*F,y:h+Math.sin(D)*F}}tooltipPosition(o){return this.getCenterPoint(o)}draw(o){const{options:c,circumference:h}=this,p=(c.offset||0)/4,g=(c.spacing||0)/2,x=c.circular;if(this.pixelMargin=c.borderAlign==="inner"?.33:0,this.fullCircles=h>Dr?Math.floor(h/Dr):0,h===0||this.innerRadius<0||this.outerRadius<0)return;o.save();const s=(this.startAngle+this.endAngle)/2;o.translate(Math.cos(s)*p,Math.sin(s)*p);const M=1-Math.sin(Math.min(Lr,h||0)),C=p*M;o.fillStyle=c.backgroundColor,o.strokeStyle=c.borderColor,EV(o,this,C,g,x),AV(o,this,C,g,x),o.restore()}}ui(Pp,"id","arc"),ui(Pp,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),ui(Pp,"defaultRoutes",{backgroundColor:"backgroundColor"}),ui(Pp,"descriptors",{_scriptable:!0,_indexable:o=>o!=="borderDash"});function w3(n,i,o=i){n.lineCap=mn(o.borderCapStyle,i.borderCapStyle),n.setLineDash(mn(o.borderDash,i.borderDash)),n.lineDashOffset=mn(o.borderDashOffset,i.borderDashOffset),n.lineJoin=mn(o.borderJoinStyle,i.borderJoinStyle),n.lineWidth=mn(o.borderWidth,i.borderWidth),n.strokeStyle=mn(o.borderColor,i.borderColor)}function IV(n,i,o){n.lineTo(o.x,o.y)}function CV(n){return n.stepped?Q6:n.tension||n.cubicInterpolationMode==="monotone"?$6:IV}function T3(n,i,o={}){const c=n.length,{start:h=0,end:p=c-1}=o,{start:g,end:x}=i,s=Math.max(h,g),M=Math.min(p,x),C=h<g&&p<g||h>x&&p>x;return{count:c,start:s,loop:i.loop,ilen:M<s&&!C?c+M-s:M-s}}function PV(n,i,o,c){const{points:h,options:p}=i,{count:g,start:x,loop:s,ilen:M}=T3(h,o,c),C=CV(p);let{move:D=!0,reverse:F}=c||{},V,X,W;for(V=0;V<=M;++V)X=h[(x+(F?M-V:V))%g],!X.skip&&(D?(n.moveTo(X.x,X.y),D=!1):C(n,W,X,F,p.stepped),W=X);return s&&(X=h[(x+(F?M:0))%g],C(n,W,X,F,p.stepped)),!!s}function kV(n,i,o,c){const h=i.points,{count:p,start:g,ilen:x}=T3(h,o,c),{move:s=!0,reverse:M}=c||{};let C=0,D=0,F,V,X,W,J,$;const ne=pe=>(g+(M?x-pe:pe))%p,ye=()=>{W!==J&&(n.lineTo(C,J),n.lineTo(C,W),n.lineTo(C,$))};for(s&&(V=h[ne(0)],n.moveTo(V.x,V.y)),F=0;F<=x;++F){if(V=h[ne(F)],V.skip)continue;const pe=V.x,ke=V.y,Ae=pe|0;Ae===X?(ke<W?W=ke:ke>J&&(J=ke),C=(D*C+pe)/++D):(ye(),n.lineTo(pe,ke),X=Ae,D=0,W=J=ke),$=ke}ye()}function v1(n){const i=n.options,o=i.borderDash&&i.borderDash.length;return!n._decimated&&!n._loop&&!i.tension&&i.cubicInterpolationMode!=="monotone"&&!i.stepped&&!o?kV:PV}function DV(n){return n.stepped?kN:n.tension||n.cubicInterpolationMode==="monotone"?DN:yh}function LV(n,i,o,c){let h=i._path;h||(h=i._path=new Path2D,i.path(h,o,c)&&h.closePath()),w3(n,i.options),n.stroke(h)}function OV(n,i,o,c){const{segments:h,options:p}=i,g=v1(i);for(const x of h)w3(n,p,x.style),n.beginPath(),g(n,i,x,{start:o,end:o+c-1})&&n.closePath(),n.stroke()}const RV=typeof Path2D=="function";function zV(n,i,o,c){RV&&!i.options.segment?LV(n,i,o,c):OV(n,i,o,c)}class hu extends Ka{constructor(i){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,i&&Object.assign(this,i)}updateControlPoints(i,o){const c=this.options;if((c.tension||c.cubicInterpolationMode==="monotone")&&!c.stepped&&!this._pointsUpdated){const h=c.spanGaps?this._loop:this._fullLoop;TN(this._points,c,i,h,o),this._pointsUpdated=!0}}set points(i){this._points=i,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=BN(this,this.options.segment))}first(){const i=this.segments,o=this.points;return i.length&&o[i[0].start]}last(){const i=this.segments,o=this.points,c=i.length;return c&&o[i[c-1].end]}interpolate(i,o){const c=this.options,h=i[o],p=this.points,g=c3(this,{property:o,start:h,end:h});if(!g.length)return;const x=[],s=DV(c);let M,C;for(M=0,C=g.length;M<C;++M){const{start:D,end:F}=g[M],V=p[D],X=p[F];if(V===X){x.push(V);continue}const W=Math.abs((h-V[o])/(X[o]-V[o])),J=s(V,X,W,c.stepped);J[o]=i[o],x.push(J)}return x.length===1?x[0]:x}pathSegment(i,o,c){return v1(this)(i,this,o,c)}path(i,o,c){const h=this.segments,p=v1(this);let g=this._loop;o=o||0,c=c||this.points.length-o;for(const x of h)g&=p(i,this,x,{start:o,end:o+c-1});return!!g}draw(i,o,c,h){const p=this.options||{};(this.points||[]).length&&p.borderWidth&&(i.save(),zV(i,this,c,h),i.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}ui(hu,"id","line"),ui(hu,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),ui(hu,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),ui(hu,"descriptors",{_scriptable:!0,_indexable:i=>i!=="borderDash"&&i!=="fill"});function lI(n,i,o,c){const h=n.options,{[o]:p}=n.getProps([o],c);return Math.abs(i-p)<h.radius+h.hitRadius}class U_ extends Ka{constructor(o){super();ui(this,"parsed");ui(this,"skip");ui(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,o&&Object.assign(this,o)}inRange(o,c,h){const p=this.options,{x:g,y:x}=this.getProps(["x","y"],h);return Math.pow(o-g,2)+Math.pow(c-x,2)<Math.pow(p.hitRadius+p.radius,2)}inXRange(o,c){return lI(this,o,"x",c)}inYRange(o,c){return lI(this,o,"y",c)}getCenterPoint(o){const{x:c,y:h}=this.getProps(["x","y"],o);return{x:c,y:h}}size(o){o=o||this.options||{};let c=o.radius||0;c=Math.max(c,c&&o.hoverRadius||0);const h=c&&o.borderWidth||0;return(c+h)*2}draw(o,c){const h=this.options;this.skip||h.radius<.1||!wc(this,c,this.size(h)/2)||(o.strokeStyle=h.borderColor,o.lineWidth=h.borderWidth,o.fillStyle=h.backgroundColor,m1(o,h,this.x,this.y))}getRange(){const o=this.options||{};return o.radius+o.hitRadius}}ui(U_,"id","point"),ui(U_,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),ui(U_,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function S3(n,i){const{x:o,y:c,base:h,width:p,height:g}=n.getProps(["x","y","base","width","height"],i);let x,s,M,C,D;return n.horizontal?(D=g/2,x=Math.min(o,h),s=Math.max(o,h),M=c-D,C=c+D):(D=p/2,x=o-D,s=o+D,M=Math.min(c,h),C=Math.max(c,h)),{left:x,top:M,right:s,bottom:C}}function fu(n,i,o,c){return n?0:Eo(i,o,c)}function FV(n,i,o){const c=n.options.borderWidth,h=n.borderSkipped,p=Qk(c);return{t:fu(h.top,p.top,0,o),r:fu(h.right,p.right,0,i),b:fu(h.bottom,p.bottom,0,o),l:fu(h.left,p.left,0,i)}}function BV(n,i,o){const{enableBorderRadius:c}=n.getProps(["enableBorderRadius"]),h=n.options.borderRadius,p=Ah(h),g=Math.min(i,o),x=n.borderSkipped,s=c||Dn(h);return{topLeft:fu(!s||x.top||x.left,p.topLeft,0,g),topRight:fu(!s||x.top||x.right,p.topRight,0,g),bottomLeft:fu(!s||x.bottom||x.left,p.bottomLeft,0,g),bottomRight:fu(!s||x.bottom||x.right,p.bottomRight,0,g)}}function NV(n){const i=S3(n),o=i.right-i.left,c=i.bottom-i.top,h=FV(n,o/2,c/2),p=BV(n,o/2,c/2);return{outer:{x:i.left,y:i.top,w:o,h:c,radius:p},inner:{x:i.left+h.l,y:i.top+h.t,w:o-h.l-h.r,h:c-h.t-h.b,radius:{topLeft:Math.max(0,p.topLeft-Math.max(h.t,h.l)),topRight:Math.max(0,p.topRight-Math.max(h.t,h.r)),bottomLeft:Math.max(0,p.bottomLeft-Math.max(h.b,h.l)),bottomRight:Math.max(0,p.bottomRight-Math.max(h.b,h.r))}}}}function Ox(n,i,o,c){const h=i===null,p=o===null,x=n&&!(h&&p)&&S3(n,c);return x&&(h||xc(i,x.left,x.right))&&(p||xc(o,x.top,x.bottom))}function VV(n){return n.topLeft||n.topRight||n.bottomLeft||n.bottomRight}function UV(n,i){n.rect(i.x,i.y,i.w,i.h)}function Rx(n,i,o={}){const c=n.x!==o.x?-i:0,h=n.y!==o.y?-i:0,p=(n.x+n.w!==o.x+o.w?i:0)-c,g=(n.y+n.h!==o.y+o.h?i:0)-h;return{x:n.x+c,y:n.y+h,w:n.w+p,h:n.h+g,radius:n.radius}}class j_ extends Ka{constructor(i){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,i&&Object.assign(this,i)}draw(i){const{inflateAmount:o,options:{borderColor:c,backgroundColor:h}}=this,{inner:p,outer:g}=NV(this),x=VV(g.radius)?tm:UV;i.save(),(g.w!==p.w||g.h!==p.h)&&(i.beginPath(),x(i,Rx(g,o,p)),i.clip(),x(i,Rx(p,-o,g)),i.fillStyle=c,i.fill("evenodd")),i.beginPath(),x(i,Rx(p,o)),i.fillStyle=h,i.fill(),i.restore()}inRange(i,o,c){return Ox(this,i,o,c)}inXRange(i,o){return Ox(this,i,null,o)}inYRange(i,o){return Ox(this,null,i,o)}getCenterPoint(i){const{x:o,y:c,base:h,horizontal:p}=this.getProps(["x","y","base","horizontal"],i);return{x:p?(o+h)/2:o,y:p?c:(c+h)/2}}getRange(i){return i==="x"?this.width/2:this.height/2}}ui(j_,"id","bar"),ui(j_,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),ui(j_,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var jV=Object.freeze({__proto__:null,ArcElement:Pp,BarElement:j_,LineElement:hu,PointElement:U_});const x1=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],cI=x1.map(n=>n.replace("rgb(","rgba(").replace(")",", 0.5)"));function M3(n){return x1[n%x1.length]}function E3(n){return cI[n%cI.length]}function GV(n,i){return n.borderColor=M3(i),n.backgroundColor=E3(i),++i}function HV(n,i){return n.backgroundColor=n.data.map(()=>M3(i++)),i}function WV(n,i){return n.backgroundColor=n.data.map(()=>E3(i++)),i}function qV(n){let i=0;return(o,c)=>{const h=n.getDatasetMeta(c).controller;h instanceof bh?i=HV(o,i):h instanceof qp?i=WV(o,i):h&&(i=GV(o,i))}}function uI(n){let i;for(i in n)if(n[i].borderColor||n[i].backgroundColor)return!0;return!1}function ZV(n){return n&&(n.borderColor||n.backgroundColor)}var XV={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(n,i,o){if(!o.enabled)return;const{data:{datasets:c},options:h}=n.config,{elements:p}=h;if(!o.forceOverride&&(uI(c)||ZV(h)||p&&uI(p)))return;const g=qV(n);c.forEach(g)}};function YV(n,i,o,c,h){const p=h.samples||c;if(p>=o)return n.slice(i,i+o);const g=[],x=(o-2)/(p-2);let s=0;const M=i+o-1;let C=i,D,F,V,X,W;for(g[s++]=n[C],D=0;D<p-2;D++){let J=0,$=0,ne;const ye=Math.floor((D+1)*x)+1+i,pe=Math.min(Math.floor((D+2)*x)+1,o)+i,ke=pe-ye;for(ne=ye;ne<pe;ne++)J+=n[ne].x,$+=n[ne].y;J/=ke,$/=ke;const Ae=Math.floor(D*x)+1+i,tt=Math.min(Math.floor((D+1)*x)+1,o)+i,{x:pt,y:kt}=n[C];for(V=X=-1,ne=Ae;ne<tt;ne++)X=.5*Math.abs((pt-J)*(n[ne].y-kt)-(pt-n[ne].x)*($-kt)),X>V&&(V=X,F=n[ne],W=ne);g[s++]=F,C=W}return g[s++]=n[M],g}function JV(n,i,o,c){let h=0,p=0,g,x,s,M,C,D,F,V,X,W;const J=[],$=i+o-1,ne=n[i].x,pe=n[$].x-ne;for(g=i;g<i+o;++g){x=n[g],s=(x.x-ne)/pe*c,M=x.y;const ke=s|0;if(ke===C)M<X?(X=M,D=g):M>W&&(W=M,F=g),h=(p*h+x.x)/++p;else{const Ae=g-1;if(!Wn(D)&&!Wn(F)){const tt=Math.min(D,F),pt=Math.max(D,F);tt!==V&&tt!==Ae&&J.push({...n[tt],x:h}),pt!==V&&pt!==Ae&&J.push({...n[pt],x:h})}g>0&&Ae!==V&&J.push(n[Ae]),J.push(x),C=ke,p=0,X=W=M,D=F=V=g}}return J}function A3(n){if(n._decimated){const i=n._data;delete n._decimated,delete n._data,Object.defineProperty(n,"data",{configurable:!0,enumerable:!0,writable:!0,value:i})}}function hI(n){n.data.datasets.forEach(i=>{A3(i)})}function KV(n,i){const o=i.length;let c=0,h;const{iScale:p}=n,{min:g,max:x,minDefined:s,maxDefined:M}=p.getUserBounds();return s&&(c=Eo(bc(i,p.axis,g).lo,0,o-1)),M?h=Eo(bc(i,p.axis,x).hi+1,c,o)-c:h=o-c,{start:c,count:h}}var QV={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(n,i,o)=>{if(!o.enabled){hI(n);return}const c=n.width;n.data.datasets.forEach((h,p)=>{const{_data:g,indexAxis:x}=h,s=n.getDatasetMeta(p),M=g||h.data;if(Ip([x,n.options.indexAxis])==="y"||!s.controller.supportsDecimation)return;const C=n.scales[s.xAxisID];if(C.type!=="linear"&&C.type!=="time"||n.options.parsing)return;let{start:D,count:F}=KV(s,M);const V=o.threshold||4*c;if(F<=V){A3(h);return}Wn(g)&&(h._data=M,delete h.data,Object.defineProperty(h,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(W){this._data=W}}));let X;switch(o.algorithm){case"lttb":X=YV(M,D,F,c,o);break;case"min-max":X=JV(M,D,F,c);break;default:throw new Error(`Unsupported decimation algorithm '${o.algorithm}'`)}h._decimated=X})},destroy(n){hI(n)}};function $V(n,i,o){const c=n.segments,h=n.points,p=i.points,g=[];for(const x of c){let{start:s,end:M}=x;M=Ab(s,M,h);const C=b1(o,h[s],h[M],x.loop);if(!i.segments){g.push({source:x,target:C,start:h[s],end:h[M]});continue}const D=c3(i,C);for(const F of D){const V=b1(o,p[F.start],p[F.end],F.loop),X=l3(x,h,V);for(const W of X)g.push({source:W,target:F,start:{[o]:fI(C,V,"start",Math.max)},end:{[o]:fI(C,V,"end",Math.min)}})}}return g}function b1(n,i,o,c){if(c)return;let h=i[n],p=o[n];return n==="angle"&&(h=$s(h),p=$s(p)),{property:n,start:h,end:p}}function eU(n,i){const{x:o=null,y:c=null}=n||{},h=i.points,p=[];return i.segments.forEach(({start:g,end:x})=>{x=Ab(g,x,h);const s=h[g],M=h[x];c!==null?(p.push({x:s.x,y:c}),p.push({x:M.x,y:c})):o!==null&&(p.push({x:o,y:s.y}),p.push({x:o,y:M.y}))}),p}function Ab(n,i,o){for(;i>n;i--){const c=o[i];if(!isNaN(c.x)&&!isNaN(c.y))break}return i}function fI(n,i,o,c){return n&&i?c(n[o],i[o]):n?n[o]:i?i[o]:0}function I3(n,i){let o=[],c=!1;return kr(n)?(c=!0,o=n):o=eU(n,i),o.length?new hu({points:o,options:{tension:0},_loop:c,_fullLoop:c}):null}function dI(n){return n&&n.fill!==!1}function tU(n,i,o){let h=n[i].fill;const p=[i];let g;if(!o)return h;for(;h!==!1&&p.indexOf(h)===-1;){if(!Hr(h))return h;if(g=n[h],!g)return!1;if(g.visible)return h;p.push(h),h=g.fill}return!1}function iU(n,i,o){const c=sU(n);if(Dn(c))return isNaN(c.value)?!1:c;let h=parseFloat(c);return Hr(h)&&Math.floor(h)===h?nU(c[0],i,h,o):["origin","start","end","stack","shape"].indexOf(c)>=0&&c}function nU(n,i,o,c){return(n==="-"||n==="+")&&(o=i+o),o===i||o<0||o>=c?!1:o}function rU(n,i){let o=null;return n==="start"?o=i.bottom:n==="end"?o=i.top:Dn(n)?o=i.getPixelForValue(n.value):i.getBasePixel&&(o=i.getBasePixel()),o}function oU(n,i,o){let c;return n==="start"?c=o:n==="end"?c=i.options.reverse?i.min:i.max:Dn(n)?c=n.value:c=i.getBaseValue(),c}function sU(n){const i=n.options,o=i.fill;let c=mn(o&&o.target,o);return c===void 0&&(c=!!i.backgroundColor),c===!1||c===null?!1:c===!0?"origin":c}function aU(n){const{scale:i,index:o,line:c}=n,h=[],p=c.segments,g=c.points,x=lU(i,o);x.push(I3({x:null,y:i.bottom},c));for(let s=0;s<p.length;s++){const M=p[s];for(let C=M.start;C<=M.end;C++)cU(h,g[C],x)}return new hu({points:h,options:{}})}function lU(n,i){const o=[],c=n.getMatchingVisibleMetas("line");for(let h=0;h<c.length;h++){const p=c[h];if(p.index===i)break;p.hidden||o.unshift(p.dataset)}return o}function cU(n,i,o){const c=[];for(let h=0;h<o.length;h++){const p=o[h],{first:g,last:x,point:s}=uU(p,i,"x");if(!(!s||g&&x)){if(g)c.unshift(s);else if(n.push(s),!x)break}}n.push(...c)}function uU(n,i,o){const c=n.interpolate(i,o);if(!c)return{};const h=c[o],p=n.segments,g=n.points;let x=!1,s=!1;for(let M=0;M<p.length;M++){const C=p[M],D=g[C.start][o],F=g[C.end][o];if(xc(h,D,F)){x=h===D,s=h===F;break}}return{first:x,last:s,point:c}}class C3{constructor(i){this.x=i.x,this.y=i.y,this.radius=i.radius}pathSegment(i,o,c){const{x:h,y:p,radius:g}=this;return o=o||{start:0,end:Dr},i.arc(h,p,g,o.end,o.start,!0),!c.bounds}interpolate(i){const{x:o,y:c,radius:h}=this,p=i.angle;return{x:o+Math.cos(p)*h,y:c+Math.sin(p)*h,angle:p}}}function hU(n){const{chart:i,fill:o,line:c}=n;if(Hr(o))return fU(i,o);if(o==="stack")return aU(n);if(o==="shape")return!0;const h=dU(n);return h instanceof C3?h:I3(h,c)}function fU(n,i){const o=n.getDatasetMeta(i);return o&&n.isDatasetVisible(i)?o.dataset:null}function dU(n){return(n.scale||{}).getPointPositionForValue?mU(n):pU(n)}function pU(n){const{scale:i={},fill:o}=n,c=rU(o,i);if(Hr(c)){const h=i.isHorizontal();return{x:h?c:null,y:h?null:c}}return null}function mU(n){const{scale:i,fill:o}=n,c=i.options,h=i.getLabels().length,p=c.reverse?i.max:i.min,g=oU(o,i,p),x=[];if(c.grid.circular){const s=i.getPointPositionForValue(0,p);return new C3({x:s.x,y:s.y,radius:i.getDistanceFromCenterForValue(g)})}for(let s=0;s<h;++s)x.push(i.getPointPositionForValue(s,g));return x}function zx(n,i,o){const c=hU(i),{line:h,scale:p,axis:g}=i,x=h.options,s=x.fill,M=x.backgroundColor,{above:C=M,below:D=M}=s||{};c&&h.points.length&&(Yy(n,o),gU(n,{line:h,target:c,above:C,below:D,area:o,scale:p,axis:g}),Jy(n))}function gU(n,i){const{line:o,target:c,above:h,below:p,area:g,scale:x}=i,s=o._loop?"angle":i.axis;n.save(),s==="x"&&p!==h&&(pI(n,c,g.top),mI(n,{line:o,target:c,color:h,scale:x,property:s}),n.restore(),n.save(),pI(n,c,g.bottom)),mI(n,{line:o,target:c,color:p,scale:x,property:s}),n.restore()}function pI(n,i,o){const{segments:c,points:h}=i;let p=!0,g=!1;n.beginPath();for(const x of c){const{start:s,end:M}=x,C=h[s],D=h[Ab(s,M,h)];p?(n.moveTo(C.x,C.y),p=!1):(n.lineTo(C.x,o),n.lineTo(C.x,C.y)),g=!!i.pathSegment(n,x,{move:g}),g?n.closePath():n.lineTo(D.x,o)}n.lineTo(i.first().x,o),n.closePath(),n.clip()}function mI(n,i){const{line:o,target:c,property:h,color:p,scale:g}=i,x=$V(o,c,h);for(const{source:s,target:M,start:C,end:D}of x){const{style:{backgroundColor:F=p}={}}=s,V=c!==!0;n.save(),n.fillStyle=F,_U(n,g,V&&b1(h,C,D)),n.beginPath();const X=!!o.pathSegment(n,s);let W;if(V){X?n.closePath():gI(n,c,D,h);const J=!!c.pathSegment(n,M,{move:X,reverse:!0});W=X&&J,W||gI(n,c,C,h)}n.closePath(),n.fill(W?"evenodd":"nonzero"),n.restore()}}function _U(n,i,o){const{top:c,bottom:h}=i.chart.chartArea,{property:p,start:g,end:x}=o||{};p==="x"&&(n.beginPath(),n.rect(g,c,x-g,h-c),n.clip())}function gI(n,i,o,c){const h=i.interpolate(o,c);h&&n.lineTo(h.x,h.y)}var yU={id:"filler",afterDatasetsUpdate(n,i,o){const c=(n.data.datasets||[]).length,h=[];let p,g,x,s;for(g=0;g<c;++g)p=n.getDatasetMeta(g),x=p.dataset,s=null,x&&x.options&&x instanceof hu&&(s={visible:n.isDatasetVisible(g),index:g,fill:iU(x,g,c),chart:n,axis:p.controller.options.indexAxis,scale:p.vScale,line:x}),p.$filler=s,h.push(s);for(g=0;g<c;++g)s=h[g],!(!s||s.fill===!1)&&(s.fill=tU(h,g,o.propagate))},beforeDraw(n,i,o){const c=o.drawTime==="beforeDraw",h=n.getSortedVisibleDatasetMetas(),p=n.chartArea;for(let g=h.length-1;g>=0;--g){const x=h[g].$filler;x&&(x.line.updateControlPoints(p,x.axis),c&&x.fill&&zx(n.ctx,x,p))}},beforeDatasetsDraw(n,i,o){if(o.drawTime!=="beforeDatasetsDraw")return;const c=n.getSortedVisibleDatasetMetas();for(let h=c.length-1;h>=0;--h){const p=c[h].$filler;dI(p)&&zx(n.ctx,p,n.chartArea)}},beforeDatasetDraw(n,i,o){const c=i.meta.$filler;!dI(c)||o.drawTime!=="beforeDatasetDraw"||zx(n.ctx,c,n.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const _I=(n,i)=>{let{boxHeight:o=i,boxWidth:c=i}=n;return n.usePointStyle&&(o=Math.min(o,i),c=n.pointStyleWidth||Math.min(c,i)),{boxWidth:c,boxHeight:o,itemHeight:Math.max(i,o)}},vU=(n,i)=>n!==null&&i!==null&&n.datasetIndex===i.datasetIndex&&n.index===i.index;class yI extends Ka{constructor(i){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=i.chart,this.options=i.options,this.ctx=i.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(i,o,c){this.maxWidth=i,this.maxHeight=o,this._margins=c,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const i=this.options.labels||{};let o=Tr(i.generateLabels,[this.chart],this)||[];i.filter&&(o=o.filter(c=>i.filter(c,this.chart.data))),i.sort&&(o=o.sort((c,h)=>i.sort(c,h,this.chart.data))),this.options.reverse&&o.reverse(),this.legendItems=o}fit(){const{options:i,ctx:o}=this;if(!i.display){this.width=this.height=0;return}const c=i.labels,h=mo(c.font),p=h.size,g=this._computeTitleHeight(),{boxWidth:x,itemHeight:s}=_I(c,p);let M,C;o.font=h.string,this.isHorizontal()?(M=this.maxWidth,C=this._fitRows(g,p,x,s)+10):(C=this.maxHeight,M=this._fitCols(g,h,x,s)+10),this.width=Math.min(M,i.maxWidth||this.maxWidth),this.height=Math.min(C,i.maxHeight||this.maxHeight)}_fitRows(i,o,c,h){const{ctx:p,maxWidth:g,options:{labels:{padding:x}}}=this,s=this.legendHitBoxes=[],M=this.lineWidths=[0],C=h+x;let D=i;p.textAlign="left",p.textBaseline="middle";let F=-1,V=-C;return this.legendItems.forEach((X,W)=>{const J=c+o/2+p.measureText(X.text).width;(W===0||M[M.length-1]+J+2*x>g)&&(D+=C,M[M.length-(W>0?0:1)]=0,V+=C,F++),s[W]={left:0,top:V,row:F,width:J,height:h},M[M.length-1]+=J+x}),D}_fitCols(i,o,c,h){const{ctx:p,maxHeight:g,options:{labels:{padding:x}}}=this,s=this.legendHitBoxes=[],M=this.columnSizes=[],C=g-i;let D=x,F=0,V=0,X=0,W=0;return this.legendItems.forEach((J,$)=>{const{itemWidth:ne,itemHeight:ye}=xU(c,o,p,J,h);$>0&&V+ye+2*x>C&&(D+=F+x,M.push({width:F,height:V}),X+=F+x,W++,F=V=0),s[$]={left:X,top:V,col:W,width:ne,height:ye},F=Math.max(F,ne),V+=ye+x}),D+=F,M.push({width:F,height:V}),D}adjustHitBoxes(){if(!this.options.display)return;const i=this._computeTitleHeight(),{legendHitBoxes:o,options:{align:c,labels:{padding:h},rtl:p}}=this,g=Bf(p,this.left,this.width);if(this.isHorizontal()){let x=0,s=$o(c,this.left+h,this.right-this.lineWidths[x]);for(const M of o)x!==M.row&&(x=M.row,s=$o(c,this.left+h,this.right-this.lineWidths[x])),M.top+=this.top+i+h,M.left=g.leftForLtr(g.x(s),M.width),s+=M.width+h}else{let x=0,s=$o(c,this.top+i+h,this.bottom-this.columnSizes[x].height);for(const M of o)M.col!==x&&(x=M.col,s=$o(c,this.top+i+h,this.bottom-this.columnSizes[x].height)),M.top=s,M.left+=this.left+h,M.left=g.leftForLtr(g.x(M.left),M.width),s+=M.height+h}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const i=this.ctx;Yy(i,this),this._draw(),Jy(i)}}_draw(){const{options:i,columnSizes:o,lineWidths:c,ctx:h}=this,{align:p,labels:g}=i,x=Wr.color,s=Bf(i.rtl,this.left,this.width),M=mo(g.font),{padding:C}=g,D=M.size,F=D/2;let V;this.drawTitle(),h.textAlign=s.textAlign("left"),h.textBaseline="middle",h.lineWidth=.5,h.font=M.string;const{boxWidth:X,boxHeight:W,itemHeight:J}=_I(g,D),$=function(Ae,tt,pt){if(isNaN(X)||X<=0||isNaN(W)||W<0)return;h.save();const kt=mn(pt.lineWidth,1);if(h.fillStyle=mn(pt.fillStyle,x),h.lineCap=mn(pt.lineCap,"butt"),h.lineDashOffset=mn(pt.lineDashOffset,0),h.lineJoin=mn(pt.lineJoin,"miter"),h.lineWidth=kt,h.strokeStyle=mn(pt.strokeStyle,x),h.setLineDash(mn(pt.lineDash,[])),g.usePointStyle){const Ie={radius:W*Math.SQRT2/2,pointStyle:pt.pointStyle,rotation:pt.rotation,borderWidth:kt},Et=s.xPlus(Ae,X/2),mt=tt+F;Kk(h,Ie,Et,mt,g.pointStyleWidth&&X)}else{const Ie=tt+Math.max((D-W)/2,0),Et=s.leftForLtr(Ae,X),mt=Ah(pt.borderRadius);h.beginPath(),Object.values(mt).some(Xe=>Xe!==0)?tm(h,{x:Et,y:Ie,w:X,h:W,radius:mt}):h.rect(Et,Ie,X,W),h.fill(),kt!==0&&h.stroke()}h.restore()},ne=function(Ae,tt,pt){Dh(h,pt.text,Ae,tt+J/2,M,{strikethrough:pt.hidden,textAlign:s.textAlign(pt.textAlign)})},ye=this.isHorizontal(),pe=this._computeTitleHeight();ye?V={x:$o(p,this.left+C,this.right-c[0]),y:this.top+C+pe,line:0}:V={x:this.left+C,y:$o(p,this.top+pe+C,this.bottom-o[0].height),line:0},o3(this.ctx,i.textDirection);const ke=J+C;this.legendItems.forEach((Ae,tt)=>{h.strokeStyle=Ae.fontColor,h.fillStyle=Ae.fontColor;const pt=h.measureText(Ae.text).width,kt=s.textAlign(Ae.textAlign||(Ae.textAlign=g.textAlign)),Ie=X+F+pt;let Et=V.x,mt=V.y;s.setWidth(this.width),ye?tt>0&&Et+Ie+C>this.right&&(mt=V.y+=ke,V.line++,Et=V.x=$o(p,this.left+C,this.right-c[V.line])):tt>0&&mt+ke>this.bottom&&(Et=V.x=Et+o[V.line].width+C,V.line++,mt=V.y=$o(p,this.top+pe+C,this.bottom-o[V.line].height));const Xe=s.x(Et);if($(Xe,mt,Ae),Et=U6(kt,Et+X+F,ye?Et+Ie:this.right,i.rtl),ne(s.x(Et),mt,Ae),ye)V.x+=Ie+C;else if(typeof Ae.text!="string"){const Tt=M.lineHeight;V.y+=P3(Ae,Tt)+C}else V.y+=ke}),s3(this.ctx,i.textDirection)}drawTitle(){const i=this.options,o=i.title,c=mo(o.font),h=rs(o.padding);if(!o.display)return;const p=Bf(i.rtl,this.left,this.width),g=this.ctx,x=o.position,s=c.size/2,M=h.top+s;let C,D=this.left,F=this.width;if(this.isHorizontal())F=Math.max(...this.lineWidths),C=this.top+M,D=$o(i.align,D,this.right-F);else{const X=this.columnSizes.reduce((W,J)=>Math.max(W,J.height),0);C=M+$o(i.align,this.top,this.bottom-X-i.labels.padding-this._computeTitleHeight())}const V=$o(x,D,D+F);g.textAlign=p.textAlign(yb(x)),g.textBaseline="middle",g.strokeStyle=o.color,g.fillStyle=o.color,g.font=c.string,Dh(g,o.text,V,C,c)}_computeTitleHeight(){const i=this.options.title,o=mo(i.font),c=rs(i.padding);return i.display?o.lineHeight+c.height:0}_getLegendItemAt(i,o){let c,h,p;if(xc(i,this.left,this.right)&&xc(o,this.top,this.bottom)){for(p=this.legendHitBoxes,c=0;c<p.length;++c)if(h=p[c],xc(i,h.left,h.left+h.width)&&xc(o,h.top,h.top+h.height))return this.legendItems[c]}return null}handleEvent(i){const o=this.options;if(!TU(i.type,o))return;const c=this._getLegendItemAt(i.x,i.y);if(i.type==="mousemove"||i.type==="mouseout"){const h=this._hoveredItem,p=vU(h,c);h&&!p&&Tr(o.onLeave,[i,h,this],this),this._hoveredItem=c,c&&!p&&Tr(o.onHover,[i,c,this],this)}else c&&Tr(o.onClick,[i,c,this],this)}}function xU(n,i,o,c,h){const p=bU(c,n,i,o),g=wU(h,c,i.lineHeight);return{itemWidth:p,itemHeight:g}}function bU(n,i,o,c){let h=n.text;return h&&typeof h!="string"&&(h=h.reduce((p,g)=>p.length>g.length?p:g)),i+o.size/2+c.measureText(h).width}function wU(n,i,o){let c=n;return typeof i.text!="string"&&(c=P3(i,o)),c}function P3(n,i){const o=n.text?n.text.length:0;return i*o}function TU(n,i){return!!((n==="mousemove"||n==="mouseout")&&(i.onHover||i.onLeave)||i.onClick&&(n==="click"||n==="mouseup"))}var SU={id:"legend",_element:yI,start(n,i,o){const c=n.legend=new yI({ctx:n.ctx,options:o,chart:n});ts.configure(n,c,o),ts.addBox(n,c)},stop(n){ts.removeBox(n,n.legend),delete n.legend},beforeUpdate(n,i,o){const c=n.legend;ts.configure(n,c,o),c.options=o},afterUpdate(n){const i=n.legend;i.buildLabels(),i.adjustHitBoxes()},afterEvent(n,i){i.replay||n.legend.handleEvent(i.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(n,i,o){const c=i.datasetIndex,h=o.chart;h.isDatasetVisible(c)?(h.hide(c),i.hidden=!0):(h.show(c),i.hidden=!1)},onHover:null,onLeave:null,labels:{color:n=>n.chart.options.color,boxWidth:40,padding:10,generateLabels(n){const i=n.data.datasets,{labels:{usePointStyle:o,pointStyle:c,textAlign:h,color:p,useBorderRadius:g,borderRadius:x}}=n.legend.options;return n._getSortedDatasetMetas().map(s=>{const M=s.controller.getStyle(o?0:void 0),C=rs(M.borderWidth);return{text:i[s.index].label,fillStyle:M.backgroundColor,fontColor:p,hidden:!s.visible,lineCap:M.borderCapStyle,lineDash:M.borderDash,lineDashOffset:M.borderDashOffset,lineJoin:M.borderJoinStyle,lineWidth:(C.width+C.height)/4,strokeStyle:M.borderColor,pointStyle:c||M.pointStyle,rotation:M.rotation,textAlign:h||M.textAlign,borderRadius:g&&(x||M.borderRadius),datasetIndex:s.index}},this)}},title:{color:n=>n.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:n=>!n.startsWith("on"),labels:{_scriptable:n=>!["generateLabels","filter","sort"].includes(n)}}};class Ib extends Ka{constructor(i){super(),this.chart=i.chart,this.options=i.options,this.ctx=i.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(i,o){const c=this.options;if(this.left=0,this.top=0,!c.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=i,this.height=this.bottom=o;const h=kr(c.text)?c.text.length:1;this._padding=rs(c.padding);const p=h*mo(c.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=p:this.width=p}isHorizontal(){const i=this.options.position;return i==="top"||i==="bottom"}_drawArgs(i){const{top:o,left:c,bottom:h,right:p,options:g}=this,x=g.align;let s=0,M,C,D;return this.isHorizontal()?(C=$o(x,c,p),D=o+i,M=p-c):(g.position==="left"?(C=c+i,D=$o(x,h,o),s=Lr*-.5):(C=p-i,D=$o(x,o,h),s=Lr*.5),M=h-o),{titleX:C,titleY:D,maxWidth:M,rotation:s}}draw(){const i=this.ctx,o=this.options;if(!o.display)return;const c=mo(o.font),p=c.lineHeight/2+this._padding.top,{titleX:g,titleY:x,maxWidth:s,rotation:M}=this._drawArgs(p);Dh(i,o.text,0,0,c,{color:o.color,maxWidth:s,rotation:M,textAlign:yb(o.align),textBaseline:"middle",translation:[g,x]})}}function MU(n,i){const o=new Ib({ctx:n.ctx,options:i,chart:n});ts.configure(n,o,i),ts.addBox(n,o),n.titleBlock=o}var EU={id:"title",_element:Ib,start(n,i,o){MU(n,o)},stop(n){const i=n.titleBlock;ts.removeBox(n,i),delete n.titleBlock},beforeUpdate(n,i,o){const c=n.titleBlock;ts.configure(n,c,o),c.options=o},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const y_=new WeakMap;var AU={id:"subtitle",start(n,i,o){const c=new Ib({ctx:n.ctx,options:o,chart:n});ts.configure(n,c,o),ts.addBox(n,c),y_.set(n,c)},stop(n){ts.removeBox(n,y_.get(n)),y_.delete(n)},beforeUpdate(n,i,o){const c=y_.get(n);ts.configure(n,c,o),c.options=o},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const kp={average(n){if(!n.length)return!1;let i,o,c=new Set,h=0,p=0;for(i=0,o=n.length;i<o;++i){const x=n[i].element;if(x&&x.hasValue()){const s=x.tooltipPosition();c.add(s.x),h+=s.y,++p}}return{x:[...c].reduce((x,s)=>x+s)/c.size,y:h/p}},nearest(n,i){if(!n.length)return!1;let o=i.x,c=i.y,h=Number.POSITIVE_INFINITY,p,g,x;for(p=0,g=n.length;p<g;++p){const s=n[p].element;if(s&&s.hasValue()){const M=s.getCenterPoint(),C=d1(i,M);C<h&&(h=C,x=s)}}if(x){const s=x.tooltipPosition();o=s.x,c=s.y}return{x:o,y:c}}};function bl(n,i){return i&&(kr(i)?Array.prototype.push.apply(n,i):n.push(i)),n}function mc(n){return(typeof n=="string"||n instanceof String)&&n.indexOf(`
`)>-1?n.split(`
`):n}function IU(n,i){const{element:o,datasetIndex:c,index:h}=i,p=n.getDatasetMeta(c).controller,{label:g,value:x}=p.getLabelAndValue(h);return{chart:n,label:g,parsed:p.getParsed(h),raw:n.data.datasets[c].data[h],formattedValue:x,dataset:p.getDataset(),dataIndex:h,datasetIndex:c,element:o}}function vI(n,i){const o=n.chart.ctx,{body:c,footer:h,title:p}=n,{boxWidth:g,boxHeight:x}=i,s=mo(i.bodyFont),M=mo(i.titleFont),C=mo(i.footerFont),D=p.length,F=h.length,V=c.length,X=rs(i.padding);let W=X.height,J=0,$=c.reduce((pe,ke)=>pe+ke.before.length+ke.lines.length+ke.after.length,0);if($+=n.beforeBody.length+n.afterBody.length,D&&(W+=D*M.lineHeight+(D-1)*i.titleSpacing+i.titleMarginBottom),$){const pe=i.displayColors?Math.max(x,s.lineHeight):s.lineHeight;W+=V*pe+($-V)*s.lineHeight+($-1)*i.bodySpacing}F&&(W+=i.footerMarginTop+F*C.lineHeight+(F-1)*i.footerSpacing);let ne=0;const ye=function(pe){J=Math.max(J,o.measureText(pe).width+ne)};return o.save(),o.font=M.string,hr(n.title,ye),o.font=s.string,hr(n.beforeBody.concat(n.afterBody),ye),ne=i.displayColors?g+2+i.boxPadding:0,hr(c,pe=>{hr(pe.before,ye),hr(pe.lines,ye),hr(pe.after,ye)}),ne=0,o.font=C.string,hr(n.footer,ye),o.restore(),J+=X.width,{width:J,height:W}}function CU(n,i){const{y:o,height:c}=i;return o<c/2?"top":o>n.height-c/2?"bottom":"center"}function PU(n,i,o,c){const{x:h,width:p}=c,g=o.caretSize+o.caretPadding;if(n==="left"&&h+p+g>i.width||n==="right"&&h-p-g<0)return!0}function kU(n,i,o,c){const{x:h,width:p}=o,{width:g,chartArea:{left:x,right:s}}=n;let M="center";return c==="center"?M=h<=(x+s)/2?"left":"right":h<=p/2?M="left":h>=g-p/2&&(M="right"),PU(M,n,i,o)&&(M="center"),M}function xI(n,i,o){const c=o.yAlign||i.yAlign||CU(n,o);return{xAlign:o.xAlign||i.xAlign||kU(n,i,o,c),yAlign:c}}function DU(n,i){let{x:o,width:c}=n;return i==="right"?o-=c:i==="center"&&(o-=c/2),o}function LU(n,i,o){let{y:c,height:h}=n;return i==="top"?c+=o:i==="bottom"?c-=h+o:c-=h/2,c}function bI(n,i,o,c){const{caretSize:h,caretPadding:p,cornerRadius:g}=n,{xAlign:x,yAlign:s}=o,M=h+p,{topLeft:C,topRight:D,bottomLeft:F,bottomRight:V}=Ah(g);let X=DU(i,x);const W=LU(i,s,M);return s==="center"?x==="left"?X+=M:x==="right"&&(X-=M):x==="left"?X-=Math.max(C,F)+h:x==="right"&&(X+=Math.max(D,V)+h),{x:Eo(X,0,c.width-i.width),y:Eo(W,0,c.height-i.height)}}function v_(n,i,o){const c=rs(o.padding);return i==="center"?n.x+n.width/2:i==="right"?n.x+n.width-c.right:n.x+c.left}function wI(n){return bl([],mc(n))}function OU(n,i,o){return _u(n,{tooltip:i,tooltipItems:o,type:"tooltip"})}function TI(n,i){const o=i&&i.dataset&&i.dataset.tooltip&&i.dataset.tooltip.callbacks;return o?n.override(o):n}const k3={beforeTitle:hc,title(n){if(n.length>0){const i=n[0],o=i.chart.data.labels,c=o?o.length:0;if(this&&this.options&&this.options.mode==="dataset")return i.dataset.label||"";if(i.label)return i.label;if(c>0&&i.dataIndex<c)return o[i.dataIndex]}return""},afterTitle:hc,beforeBody:hc,beforeLabel:hc,label(n){if(this&&this.options&&this.options.mode==="dataset")return n.label+": "+n.formattedValue||n.formattedValue;let i=n.dataset.label||"";i&&(i+=": ");const o=n.formattedValue;return Wn(o)||(i+=o),i},labelColor(n){const o=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{borderColor:o.borderColor,backgroundColor:o.backgroundColor,borderWidth:o.borderWidth,borderDash:o.borderDash,borderDashOffset:o.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(n){const o=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{pointStyle:o.pointStyle,rotation:o.rotation}},afterLabel:hc,afterBody:hc,beforeFooter:hc,footer:hc,afterFooter:hc};function Ls(n,i,o,c){const h=n[i].call(o,c);return typeof h>"u"?k3[i].call(o,c):h}class w1 extends Ka{constructor(i){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=i.chart,this.options=i.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(i){this.options=i,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const i=this._cachedAnimations;if(i)return i;const o=this.chart,c=this.options.setContext(this.getContext()),h=c.enabled&&o.options.animation&&c.animations,p=new u3(this.chart,h);return h._cacheable&&(this._cachedAnimations=Object.freeze(p)),p}getContext(){return this.$context||(this.$context=OU(this.chart.getContext(),this,this._tooltipItems))}getTitle(i,o){const{callbacks:c}=o,h=Ls(c,"beforeTitle",this,i),p=Ls(c,"title",this,i),g=Ls(c,"afterTitle",this,i);let x=[];return x=bl(x,mc(h)),x=bl(x,mc(p)),x=bl(x,mc(g)),x}getBeforeBody(i,o){return wI(Ls(o.callbacks,"beforeBody",this,i))}getBody(i,o){const{callbacks:c}=o,h=[];return hr(i,p=>{const g={before:[],lines:[],after:[]},x=TI(c,p);bl(g.before,mc(Ls(x,"beforeLabel",this,p))),bl(g.lines,Ls(x,"label",this,p)),bl(g.after,mc(Ls(x,"afterLabel",this,p))),h.push(g)}),h}getAfterBody(i,o){return wI(Ls(o.callbacks,"afterBody",this,i))}getFooter(i,o){const{callbacks:c}=o,h=Ls(c,"beforeFooter",this,i),p=Ls(c,"footer",this,i),g=Ls(c,"afterFooter",this,i);let x=[];return x=bl(x,mc(h)),x=bl(x,mc(p)),x=bl(x,mc(g)),x}_createItems(i){const o=this._active,c=this.chart.data,h=[],p=[],g=[];let x=[],s,M;for(s=0,M=o.length;s<M;++s)x.push(IU(this.chart,o[s]));return i.filter&&(x=x.filter((C,D,F)=>i.filter(C,D,F,c))),i.itemSort&&(x=x.sort((C,D)=>i.itemSort(C,D,c))),hr(x,C=>{const D=TI(i.callbacks,C);h.push(Ls(D,"labelColor",this,C)),p.push(Ls(D,"labelPointStyle",this,C)),g.push(Ls(D,"labelTextColor",this,C))}),this.labelColors=h,this.labelPointStyles=p,this.labelTextColors=g,this.dataPoints=x,x}update(i,o){const c=this.options.setContext(this.getContext()),h=this._active;let p,g=[];if(!h.length)this.opacity!==0&&(p={opacity:0});else{const x=kp[c.position].call(this,h,this._eventPosition);g=this._createItems(c),this.title=this.getTitle(g,c),this.beforeBody=this.getBeforeBody(g,c),this.body=this.getBody(g,c),this.afterBody=this.getAfterBody(g,c),this.footer=this.getFooter(g,c);const s=this._size=vI(this,c),M=Object.assign({},x,s),C=xI(this.chart,c,M),D=bI(c,M,C,this.chart);this.xAlign=C.xAlign,this.yAlign=C.yAlign,p={opacity:1,x:D.x,y:D.y,width:s.width,height:s.height,caretX:x.x,caretY:x.y}}this._tooltipItems=g,this.$context=void 0,p&&this._resolveAnimations().update(this,p),i&&c.external&&c.external.call(this,{chart:this.chart,tooltip:this,replay:o})}drawCaret(i,o,c,h){const p=this.getCaretPosition(i,c,h);o.lineTo(p.x1,p.y1),o.lineTo(p.x2,p.y2),o.lineTo(p.x3,p.y3)}getCaretPosition(i,o,c){const{xAlign:h,yAlign:p}=this,{caretSize:g,cornerRadius:x}=c,{topLeft:s,topRight:M,bottomLeft:C,bottomRight:D}=Ah(x),{x:F,y:V}=i,{width:X,height:W}=o;let J,$,ne,ye,pe,ke;return p==="center"?(pe=V+W/2,h==="left"?(J=F,$=J-g,ye=pe+g,ke=pe-g):(J=F+X,$=J+g,ye=pe-g,ke=pe+g),ne=J):(h==="left"?$=F+Math.max(s,C)+g:h==="right"?$=F+X-Math.max(M,D)-g:$=this.caretX,p==="top"?(ye=V,pe=ye-g,J=$-g,ne=$+g):(ye=V+W,pe=ye+g,J=$+g,ne=$-g),ke=ye),{x1:J,x2:$,x3:ne,y1:ye,y2:pe,y3:ke}}drawTitle(i,o,c){const h=this.title,p=h.length;let g,x,s;if(p){const M=Bf(c.rtl,this.x,this.width);for(i.x=v_(this,c.titleAlign,c),o.textAlign=M.textAlign(c.titleAlign),o.textBaseline="middle",g=mo(c.titleFont),x=c.titleSpacing,o.fillStyle=c.titleColor,o.font=g.string,s=0;s<p;++s)o.fillText(h[s],M.x(i.x),i.y+g.lineHeight/2),i.y+=g.lineHeight+x,s+1===p&&(i.y+=c.titleMarginBottom-x)}}_drawColorBox(i,o,c,h,p){const g=this.labelColors[c],x=this.labelPointStyles[c],{boxHeight:s,boxWidth:M}=p,C=mo(p.bodyFont),D=v_(this,"left",p),F=h.x(D),V=s<C.lineHeight?(C.lineHeight-s)/2:0,X=o.y+V;if(p.usePointStyle){const W={radius:Math.min(M,s)/2,pointStyle:x.pointStyle,rotation:x.rotation,borderWidth:1},J=h.leftForLtr(F,M)+M/2,$=X+s/2;i.strokeStyle=p.multiKeyBackground,i.fillStyle=p.multiKeyBackground,m1(i,W,J,$),i.strokeStyle=g.borderColor,i.fillStyle=g.backgroundColor,m1(i,W,J,$)}else{i.lineWidth=Dn(g.borderWidth)?Math.max(...Object.values(g.borderWidth)):g.borderWidth||1,i.strokeStyle=g.borderColor,i.setLineDash(g.borderDash||[]),i.lineDashOffset=g.borderDashOffset||0;const W=h.leftForLtr(F,M),J=h.leftForLtr(h.xPlus(F,1),M-2),$=Ah(g.borderRadius);Object.values($).some(ne=>ne!==0)?(i.beginPath(),i.fillStyle=p.multiKeyBackground,tm(i,{x:W,y:X,w:M,h:s,radius:$}),i.fill(),i.stroke(),i.fillStyle=g.backgroundColor,i.beginPath(),tm(i,{x:J,y:X+1,w:M-2,h:s-2,radius:$}),i.fill()):(i.fillStyle=p.multiKeyBackground,i.fillRect(W,X,M,s),i.strokeRect(W,X,M,s),i.fillStyle=g.backgroundColor,i.fillRect(J,X+1,M-2,s-2))}i.fillStyle=this.labelTextColors[c]}drawBody(i,o,c){const{body:h}=this,{bodySpacing:p,bodyAlign:g,displayColors:x,boxHeight:s,boxWidth:M,boxPadding:C}=c,D=mo(c.bodyFont);let F=D.lineHeight,V=0;const X=Bf(c.rtl,this.x,this.width),W=function(pt){o.fillText(pt,X.x(i.x+V),i.y+F/2),i.y+=F+p},J=X.textAlign(g);let $,ne,ye,pe,ke,Ae,tt;for(o.textAlign=g,o.textBaseline="middle",o.font=D.string,i.x=v_(this,J,c),o.fillStyle=c.bodyColor,hr(this.beforeBody,W),V=x&&J!=="right"?g==="center"?M/2+C:M+2+C:0,pe=0,Ae=h.length;pe<Ae;++pe){for($=h[pe],ne=this.labelTextColors[pe],o.fillStyle=ne,hr($.before,W),ye=$.lines,x&&ye.length&&(this._drawColorBox(o,i,pe,X,c),F=Math.max(D.lineHeight,s)),ke=0,tt=ye.length;ke<tt;++ke)W(ye[ke]),F=D.lineHeight;hr($.after,W)}V=0,F=D.lineHeight,hr(this.afterBody,W),i.y-=p}drawFooter(i,o,c){const h=this.footer,p=h.length;let g,x;if(p){const s=Bf(c.rtl,this.x,this.width);for(i.x=v_(this,c.footerAlign,c),i.y+=c.footerMarginTop,o.textAlign=s.textAlign(c.footerAlign),o.textBaseline="middle",g=mo(c.footerFont),o.fillStyle=c.footerColor,o.font=g.string,x=0;x<p;++x)o.fillText(h[x],s.x(i.x),i.y+g.lineHeight/2),i.y+=g.lineHeight+c.footerSpacing}}drawBackground(i,o,c,h){const{xAlign:p,yAlign:g}=this,{x,y:s}=i,{width:M,height:C}=c,{topLeft:D,topRight:F,bottomLeft:V,bottomRight:X}=Ah(h.cornerRadius);o.fillStyle=h.backgroundColor,o.strokeStyle=h.borderColor,o.lineWidth=h.borderWidth,o.beginPath(),o.moveTo(x+D,s),g==="top"&&this.drawCaret(i,o,c,h),o.lineTo(x+M-F,s),o.quadraticCurveTo(x+M,s,x+M,s+F),g==="center"&&p==="right"&&this.drawCaret(i,o,c,h),o.lineTo(x+M,s+C-X),o.quadraticCurveTo(x+M,s+C,x+M-X,s+C),g==="bottom"&&this.drawCaret(i,o,c,h),o.lineTo(x+V,s+C),o.quadraticCurveTo(x,s+C,x,s+C-V),g==="center"&&p==="left"&&this.drawCaret(i,o,c,h),o.lineTo(x,s+D),o.quadraticCurveTo(x,s,x+D,s),o.closePath(),o.fill(),h.borderWidth>0&&o.stroke()}_updateAnimationTarget(i){const o=this.chart,c=this.$animations,h=c&&c.x,p=c&&c.y;if(h||p){const g=kp[i.position].call(this,this._active,this._eventPosition);if(!g)return;const x=this._size=vI(this,i),s=Object.assign({},g,this._size),M=xI(o,i,s),C=bI(i,s,M,o);(h._to!==C.x||p._to!==C.y)&&(this.xAlign=M.xAlign,this.yAlign=M.yAlign,this.width=x.width,this.height=x.height,this.caretX=g.x,this.caretY=g.y,this._resolveAnimations().update(this,C))}}_willRender(){return!!this.opacity}draw(i){const o=this.options.setContext(this.getContext());let c=this.opacity;if(!c)return;this._updateAnimationTarget(o);const h={width:this.width,height:this.height},p={x:this.x,y:this.y};c=Math.abs(c)<.001?0:c;const g=rs(o.padding),x=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;o.enabled&&x&&(i.save(),i.globalAlpha=c,this.drawBackground(p,i,h,o),o3(i,o.textDirection),p.y+=g.top,this.drawTitle(p,i,o),this.drawBody(p,i,o),this.drawFooter(p,i,o),s3(i,o.textDirection),i.restore())}getActiveElements(){return this._active||[]}setActiveElements(i,o){const c=this._active,h=i.map(({datasetIndex:x,index:s})=>{const M=this.chart.getDatasetMeta(x);if(!M)throw new Error("Cannot find a dataset at index "+x);return{datasetIndex:x,element:M.data[s],index:s}}),p=!fy(c,h),g=this._positionChanged(h,o);(p||g)&&(this._active=h,this._eventPosition=o,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(i,o,c=!0){if(o&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const h=this.options,p=this._active||[],g=this._getActiveElements(i,p,o,c),x=this._positionChanged(g,i),s=o||!fy(g,p)||x;return s&&(this._active=g,(h.enabled||h.external)&&(this._eventPosition={x:i.x,y:i.y},this.update(!0,o))),s}_getActiveElements(i,o,c,h){const p=this.options;if(i.type==="mouseout")return[];if(!h)return o.filter(x=>this.chart.data.datasets[x.datasetIndex]&&this.chart.getDatasetMeta(x.datasetIndex).controller.getParsed(x.index)!==void 0);const g=this.chart.getElementsAtEventForMode(i,p.mode,p,c);return p.reverse&&g.reverse(),g}_positionChanged(i,o){const{caretX:c,caretY:h,options:p}=this,g=kp[p.position].call(this,i,o);return g!==!1&&(c!==g.x||h!==g.y)}}ui(w1,"positioners",kp);var RU={id:"tooltip",_element:w1,positioners:kp,afterInit(n,i,o){o&&(n.tooltip=new w1({chart:n,options:o}))},beforeUpdate(n,i,o){n.tooltip&&n.tooltip.initialize(o)},reset(n,i,o){n.tooltip&&n.tooltip.initialize(o)},afterDraw(n){const i=n.tooltip;if(i&&i._willRender()){const o={tooltip:i};if(n.notifyPlugins("beforeTooltipDraw",{...o,cancelable:!0})===!1)return;i.draw(n.ctx),n.notifyPlugins("afterTooltipDraw",o)}},afterEvent(n,i){if(n.tooltip){const o=i.replay;n.tooltip.handleEvent(i.event,o,i.inChartArea)&&(i.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(n,i)=>i.bodyFont.size,boxWidth:(n,i)=>i.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:k3},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:n=>n!=="filter"&&n!=="itemSort"&&n!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},zU=Object.freeze({__proto__:null,Colors:XV,Decimation:QV,Filler:yU,Legend:SU,SubTitle:AU,Title:EU,Tooltip:RU});const FU=(n,i,o,c)=>(typeof i=="string"?(o=n.push(i)-1,c.unshift({index:o,label:i})):isNaN(i)&&(o=null),o);function BU(n,i,o,c){const h=n.indexOf(i);if(h===-1)return FU(n,i,o,c);const p=n.lastIndexOf(i);return h!==p?o:h}const NU=(n,i)=>n===null?null:Eo(Math.round(n),0,i);function SI(n){const i=this.getLabels();return n>=0&&n<i.length?i[n]:n}class T1 extends Rh{constructor(i){super(i),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(i){const o=this._addedLabels;if(o.length){const c=this.getLabels();for(const{index:h,label:p}of o)c[h]===p&&c.splice(h,1);this._addedLabels=[]}super.init(i)}parse(i,o){if(Wn(i))return null;const c=this.getLabels();return o=isFinite(o)&&c[o]===i?o:BU(c,i,mn(o,i),this._addedLabels),NU(o,c.length-1)}determineDataLimits(){const{minDefined:i,maxDefined:o}=this.getUserBounds();let{min:c,max:h}=this.getMinMax(!0);this.options.bounds==="ticks"&&(i||(c=0),o||(h=this.getLabels().length-1)),this.min=c,this.max=h}buildTicks(){const i=this.min,o=this.max,c=this.options.offset,h=[];let p=this.getLabels();p=i===0&&o===p.length-1?p:p.slice(i,o+1),this._valueRange=Math.max(p.length-(c?0:1),1),this._startValue=this.min-(c?.5:0);for(let g=i;g<=o;g++)h.push({value:g});return h}getLabelForValue(i){return SI.call(this,i)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(i){return typeof i!="number"&&(i=this.parse(i)),i===null?NaN:this.getPixelForDecimal((i-this._startValue)/this._valueRange)}getPixelForTick(i){const o=this.ticks;return i<0||i>o.length-1?null:this.getPixelForValue(o[i].value)}getValueForPixel(i){return Math.round(this._startValue+this.getDecimalForPixel(i)*this._valueRange)}getBasePixel(){return this.bottom}}ui(T1,"id","category"),ui(T1,"defaults",{ticks:{callback:SI}});function VU(n,i){const o=[],{bounds:h,step:p,min:g,max:x,precision:s,count:M,maxTicks:C,maxDigits:D,includeBounds:F}=n,V=p||1,X=C-1,{min:W,max:J}=i,$=!Wn(g),ne=!Wn(x),ye=!Wn(M),pe=(J-W)/(D+1);let ke=yA((J-W)/X/V)*V,Ae,tt,pt,kt;if(ke<1e-14&&!$&&!ne)return[{value:W},{value:J}];kt=Math.ceil(J/ke)-Math.floor(W/ke),kt>X&&(ke=yA(kt*ke/X/V)*V),Wn(s)||(Ae=Math.pow(10,s),ke=Math.ceil(ke*Ae)/Ae),h==="ticks"?(tt=Math.floor(W/ke)*ke,pt=Math.ceil(J/ke)*ke):(tt=W,pt=J),$&&ne&&p&&O6((x-g)/p,ke/1e3)?(kt=Math.round(Math.min((x-g)/ke,C)),ke=(x-g)/kt,tt=g,pt=x):ye?(tt=$?g:tt,pt=ne?x:pt,kt=M-1,ke=(pt-tt)/kt):(kt=(pt-tt)/ke,Gp(kt,Math.round(kt),ke/1e3)?kt=Math.round(kt):kt=Math.ceil(kt));const Ie=Math.max(vA(ke),vA(tt));Ae=Math.pow(10,Wn(s)?Ie:s),tt=Math.round(tt*Ae)/Ae,pt=Math.round(pt*Ae)/Ae;let Et=0;for($&&(F&&tt!==g?(o.push({value:g}),tt<g&&Et++,Gp(Math.round((tt+Et*ke)*Ae)/Ae,g,MI(g,pe,n))&&Et++):tt<g&&Et++);Et<kt;++Et){const mt=Math.round((tt+Et*ke)*Ae)/Ae;if(ne&&mt>x)break;o.push({value:mt})}return ne&&F&&pt!==x?o.length&&Gp(o[o.length-1].value,x,MI(x,pe,n))?o[o.length-1].value=x:o.push({value:x}):(!ne||pt===x)&&o.push({value:pt}),o}function MI(n,i,{horizontal:o,minRotation:c}){const h=Xa(c),p=(o?Math.sin(h):Math.cos(h))||.001,g=.75*i*(""+n).length;return Math.min(i/p,g)}class vy extends Rh{constructor(i){super(i),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(i,o){return Wn(i)||(typeof i=="number"||i instanceof Number)&&!isFinite(+i)?null:+i}handleTickRangeOptions(){const{beginAtZero:i}=this.options,{minDefined:o,maxDefined:c}=this.getUserBounds();let{min:h,max:p}=this;const g=s=>h=o?h:s,x=s=>p=c?p:s;if(i){const s=Al(h),M=Al(p);s<0&&M<0?x(0):s>0&&M>0&&g(0)}if(h===p){let s=p===0?1:Math.abs(p*.05);x(p+s),i||g(h-s)}this.min=h,this.max=p}getTickLimit(){const i=this.options.ticks;let{maxTicksLimit:o,stepSize:c}=i,h;return c?(h=Math.ceil(this.max/c)-Math.floor(this.min/c)+1,h>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${c} would result generating up to ${h} ticks. Limiting to 1000.`),h=1e3)):(h=this.computeTickLimit(),o=o||11),o&&(h=Math.min(o,h)),h}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const i=this.options,o=i.ticks;let c=this.getTickLimit();c=Math.max(2,c);const h={maxTicks:c,bounds:i.bounds,min:i.min,max:i.max,precision:o.precision,step:o.stepSize,count:o.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:o.minRotation||0,includeBounds:o.includeBounds!==!1},p=this._range||this,g=VU(h,p);return i.bounds==="ticks"&&jk(g,this,"value"),i.reverse?(g.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),g}configure(){const i=this.ticks;let o=this.min,c=this.max;if(super.configure(),this.options.offset&&i.length){const h=(c-o)/Math.max(i.length-1,1)/2;o-=h,c+=h}this._startValue=o,this._endValue=c,this._valueRange=c-o}getLabelForValue(i){return wm(i,this.chart.options.locale,this.options.ticks.format)}}class S1 extends vy{determineDataLimits(){const{min:i,max:o}=this.getMinMax(!0);this.min=Hr(i)?i:0,this.max=Hr(o)?o:1,this.handleTickRangeOptions()}computeTickLimit(){const i=this.isHorizontal(),o=i?this.width:this.height,c=Xa(this.options.ticks.minRotation),h=(i?Math.sin(c):Math.cos(c))||.001,p=this._resolveTickFontOptions(0);return Math.ceil(o/Math.min(40,p.lineHeight/h))}getPixelForValue(i){return i===null?NaN:this.getPixelForDecimal((i-this._startValue)/this._valueRange)}getValueForPixel(i){return this._startValue+this.getDecimalForPixel(i)*this._valueRange}}ui(S1,"id","linear"),ui(S1,"defaults",{ticks:{callback:Xy.formatters.numeric}});const nm=n=>Math.floor(uu(n)),gh=(n,i)=>Math.pow(10,nm(n)+i);function EI(n){return n/Math.pow(10,nm(n))===1}function AI(n,i,o){const c=Math.pow(10,o),h=Math.floor(n/c);return Math.ceil(i/c)-h}function UU(n,i){const o=i-n;let c=nm(o);for(;AI(n,i,c)>10;)c++;for(;AI(n,i,c)<10;)c--;return Math.min(c,nm(n))}function jU(n,{min:i,max:o}){i=Qs(n.min,i);const c=[],h=nm(i);let p=UU(i,o),g=p<0?Math.pow(10,Math.abs(p)):1;const x=Math.pow(10,p),s=h>p?Math.pow(10,h):0,M=Math.round((i-s)*g)/g,C=Math.floor((i-s)/x/10)*x*10;let D=Math.floor((M-C)/Math.pow(10,p)),F=Qs(n.min,Math.round((s+C+D*Math.pow(10,p))*g)/g);for(;F<o;)c.push({value:F,major:EI(F),significand:D}),D>=10?D=D<15?15:20:D++,D>=20&&(p++,D=2,g=p>=0?1:g),F=Math.round((s+C+D*Math.pow(10,p))*g)/g;const V=Qs(n.max,F);return c.push({value:V,major:EI(V),significand:D}),c}class M1 extends Rh{constructor(i){super(i),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(i,o){const c=vy.prototype.parse.apply(this,[i,o]);if(c===0){this._zero=!0;return}return Hr(c)&&c>0?c:null}determineDataLimits(){const{min:i,max:o}=this.getMinMax(!0);this.min=Hr(i)?Math.max(0,i):null,this.max=Hr(o)?Math.max(0,o):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Hr(this._userMin)&&(this.min=i===gh(this.min,0)?gh(this.min,-1):gh(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:i,maxDefined:o}=this.getUserBounds();let c=this.min,h=this.max;const p=x=>c=i?c:x,g=x=>h=o?h:x;c===h&&(c<=0?(p(1),g(10)):(p(gh(c,-1)),g(gh(h,1)))),c<=0&&p(gh(h,-1)),h<=0&&g(gh(c,1)),this.min=c,this.max=h}buildTicks(){const i=this.options,o={min:this._userMin,max:this._userMax},c=jU(o,this);return i.bounds==="ticks"&&jk(c,this,"value"),i.reverse?(c.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),c}getLabelForValue(i){return i===void 0?"0":wm(i,this.chart.options.locale,this.options.ticks.format)}configure(){const i=this.min;super.configure(),this._startValue=uu(i),this._valueRange=uu(this.max)-uu(i)}getPixelForValue(i){return(i===void 0||i===0)&&(i=this.min),i===null||isNaN(i)?NaN:this.getPixelForDecimal(i===this.min?0:(uu(i)-this._startValue)/this._valueRange)}getValueForPixel(i){const o=this.getDecimalForPixel(i);return Math.pow(10,this._startValue+o*this._valueRange)}}ui(M1,"id","logarithmic"),ui(M1,"defaults",{ticks:{callback:Xy.formatters.logarithmic,major:{enabled:!0}}});function E1(n){const i=n.ticks;if(i.display&&n.display){const o=rs(i.backdropPadding);return mn(i.font&&i.font.size,Wr.font.size)+o.height}return 0}function GU(n,i,o){return o=kr(o)?o:[o],{w:K6(n,i.string,o),h:o.length*i.lineHeight}}function II(n,i,o,c,h){return n===c||n===h?{start:i-o/2,end:i+o/2}:n<c||n>h?{start:i-o,end:i}:{start:i,end:i+o}}function HU(n){const i={l:n.left+n._padding.left,r:n.right-n._padding.right,t:n.top+n._padding.top,b:n.bottom-n._padding.bottom},o=Object.assign({},i),c=[],h=[],p=n._pointLabels.length,g=n.options.pointLabels,x=g.centerPointLabels?Lr/p:0;for(let s=0;s<p;s++){const M=g.setContext(n.getPointLabelContext(s));h[s]=M.padding;const C=n.getPointPosition(s,n.drawingArea+h[s],x),D=mo(M.font),F=GU(n.ctx,D,n._pointLabels[s]);c[s]=F;const V=$s(n.getIndexAngle(s)+x),X=Math.round(gb(V)),W=II(X,C.x,F.w,0,180),J=II(X,C.y,F.h,90,270);WU(o,i,V,W,J)}n.setCenterPoint(i.l-o.l,o.r-i.r,i.t-o.t,o.b-i.b),n._pointLabelItems=XU(n,c,h)}function WU(n,i,o,c,h){const p=Math.abs(Math.sin(o)),g=Math.abs(Math.cos(o));let x=0,s=0;c.start<i.l?(x=(i.l-c.start)/p,n.l=Math.min(n.l,i.l-x)):c.end>i.r&&(x=(c.end-i.r)/p,n.r=Math.max(n.r,i.r+x)),h.start<i.t?(s=(i.t-h.start)/g,n.t=Math.min(n.t,i.t-s)):h.end>i.b&&(s=(h.end-i.b)/g,n.b=Math.max(n.b,i.b+s))}function qU(n,i,o){const c=n.drawingArea,{extra:h,additionalAngle:p,padding:g,size:x}=o,s=n.getPointPosition(i,c+h+g,p),M=Math.round(gb($s(s.angle+io))),C=KU(s.y,x.h,M),D=YU(M),F=JU(s.x,x.w,D);return{visible:!0,x:s.x,y:C,textAlign:D,left:F,top:C,right:F+x.w,bottom:C+x.h}}function ZU(n,i){if(!i)return!0;const{left:o,top:c,right:h,bottom:p}=n;return!(wc({x:o,y:c},i)||wc({x:o,y:p},i)||wc({x:h,y:c},i)||wc({x:h,y:p},i))}function XU(n,i,o){const c=[],h=n._pointLabels.length,p=n.options,{centerPointLabels:g,display:x}=p.pointLabels,s={extra:E1(p)/2,additionalAngle:g?Lr/h:0};let M;for(let C=0;C<h;C++){s.padding=o[C],s.size=i[C];const D=qU(n,C,s);c.push(D),x==="auto"&&(D.visible=ZU(D,M),D.visible&&(M=D))}return c}function YU(n){return n===0||n===180?"center":n<180?"left":"right"}function JU(n,i,o){return o==="right"?n-=i:o==="center"&&(n-=i/2),n}function KU(n,i,o){return o===90||o===270?n-=i/2:(o>270||o<90)&&(n-=i),n}function QU(n,i,o){const{left:c,top:h,right:p,bottom:g}=o,{backdropColor:x}=i;if(!Wn(x)){const s=Ah(i.borderRadius),M=rs(i.backdropPadding);n.fillStyle=x;const C=c-M.left,D=h-M.top,F=p-c+M.width,V=g-h+M.height;Object.values(s).some(X=>X!==0)?(n.beginPath(),tm(n,{x:C,y:D,w:F,h:V,radius:s}),n.fill()):n.fillRect(C,D,F,V)}}function $U(n,i){const{ctx:o,options:{pointLabels:c}}=n;for(let h=i-1;h>=0;h--){const p=n._pointLabelItems[h];if(!p.visible)continue;const g=c.setContext(n.getPointLabelContext(h));QU(o,g,p);const x=mo(g.font),{x:s,y:M,textAlign:C}=p;Dh(o,n._pointLabels[h],s,M+x.lineHeight/2,x,{color:g.color,textAlign:C,textBaseline:"middle"})}}function D3(n,i,o,c){const{ctx:h}=n;if(o)h.arc(n.xCenter,n.yCenter,i,0,Dr);else{let p=n.getPointPosition(0,i);h.moveTo(p.x,p.y);for(let g=1;g<c;g++)p=n.getPointPosition(g,i),h.lineTo(p.x,p.y)}}function ej(n,i,o,c,h){const p=n.ctx,g=i.circular,{color:x,lineWidth:s}=i;!g&&!c||!x||!s||o<0||(p.save(),p.strokeStyle=x,p.lineWidth=s,p.setLineDash(h.dash),p.lineDashOffset=h.dashOffset,p.beginPath(),D3(n,o,g,c),p.closePath(),p.stroke(),p.restore())}function tj(n,i,o){return _u(n,{label:o,index:i,type:"pointLabel"})}class Dp extends vy{constructor(i){super(i),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const i=this._padding=rs(E1(this.options)/2),o=this.width=this.maxWidth-i.width,c=this.height=this.maxHeight-i.height;this.xCenter=Math.floor(this.left+o/2+i.left),this.yCenter=Math.floor(this.top+c/2+i.top),this.drawingArea=Math.floor(Math.min(o,c)/2)}determineDataLimits(){const{min:i,max:o}=this.getMinMax(!1);this.min=Hr(i)&&!isNaN(i)?i:0,this.max=Hr(o)&&!isNaN(o)?o:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/E1(this.options))}generateTickLabels(i){vy.prototype.generateTickLabels.call(this,i),this._pointLabels=this.getLabels().map((o,c)=>{const h=Tr(this.options.pointLabels.callback,[o,c],this);return h||h===0?h:""}).filter((o,c)=>this.chart.getDataVisibility(c))}fit(){const i=this.options;i.display&&i.pointLabels.display?HU(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(i,o,c,h){this.xCenter+=Math.floor((i-o)/2),this.yCenter+=Math.floor((c-h)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(i,o,c,h))}getIndexAngle(i){const o=Dr/(this._pointLabels.length||1),c=this.options.startAngle||0;return $s(i*o+Xa(c))}getDistanceFromCenterForValue(i){if(Wn(i))return NaN;const o=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-i)*o:(i-this.min)*o}getValueForDistanceFromCenter(i){if(Wn(i))return NaN;const o=i/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-o:this.min+o}getPointLabelContext(i){const o=this._pointLabels||[];if(i>=0&&i<o.length){const c=o[i];return tj(this.getContext(),i,c)}}getPointPosition(i,o,c=0){const h=this.getIndexAngle(i)-io+c;return{x:Math.cos(h)*o+this.xCenter,y:Math.sin(h)*o+this.yCenter,angle:h}}getPointPositionForValue(i,o){return this.getPointPosition(i,this.getDistanceFromCenterForValue(o))}getBasePosition(i){return this.getPointPositionForValue(i||0,this.getBaseValue())}getPointLabelPosition(i){const{left:o,top:c,right:h,bottom:p}=this._pointLabelItems[i];return{left:o,top:c,right:h,bottom:p}}drawBackground(){const{backgroundColor:i,grid:{circular:o}}=this.options;if(i){const c=this.ctx;c.save(),c.beginPath(),D3(this,this.getDistanceFromCenterForValue(this._endValue),o,this._pointLabels.length),c.closePath(),c.fillStyle=i,c.fill(),c.restore()}}drawGrid(){const i=this.ctx,o=this.options,{angleLines:c,grid:h,border:p}=o,g=this._pointLabels.length;let x,s,M;if(o.pointLabels.display&&$U(this,g),h.display&&this.ticks.forEach((C,D)=>{if(D!==0||D===0&&this.min<0){s=this.getDistanceFromCenterForValue(C.value);const F=this.getContext(D),V=h.setContext(F),X=p.setContext(F);ej(this,V,s,g,X)}}),c.display){for(i.save(),x=g-1;x>=0;x--){const C=c.setContext(this.getPointLabelContext(x)),{color:D,lineWidth:F}=C;!F||!D||(i.lineWidth=F,i.strokeStyle=D,i.setLineDash(C.borderDash),i.lineDashOffset=C.borderDashOffset,s=this.getDistanceFromCenterForValue(o.ticks.reverse?this.min:this.max),M=this.getPointPosition(x,s),i.beginPath(),i.moveTo(this.xCenter,this.yCenter),i.lineTo(M.x,M.y),i.stroke())}i.restore()}}drawBorder(){}drawLabels(){const i=this.ctx,o=this.options,c=o.ticks;if(!c.display)return;const h=this.getIndexAngle(0);let p,g;i.save(),i.translate(this.xCenter,this.yCenter),i.rotate(h),i.textAlign="center",i.textBaseline="middle",this.ticks.forEach((x,s)=>{if(s===0&&this.min>=0&&!o.reverse)return;const M=c.setContext(this.getContext(s)),C=mo(M.font);if(p=this.getDistanceFromCenterForValue(this.ticks[s].value),M.showLabelBackdrop){i.font=C.string,g=i.measureText(x.label).width,i.fillStyle=M.backdropColor;const D=rs(M.backdropPadding);i.fillRect(-g/2-D.left,-p-C.size/2-D.top,g+D.width,C.size+D.height)}Dh(i,x.label,0,-p,C,{color:M.color,strokeColor:M.textStrokeColor,strokeWidth:M.textStrokeWidth})}),i.restore()}drawTitle(){}}ui(Dp,"id","radialLinear"),ui(Dp,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Xy.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(i){return i},padding:5,centerPointLabels:!1}}),ui(Dp,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),ui(Dp,"descriptors",{angleLines:{_fallback:"grid"}});const Qy={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Os=Object.keys(Qy);function CI(n,i){return n-i}function PI(n,i){if(Wn(i))return null;const o=n._adapter,{parser:c,round:h,isoWeekday:p}=n._parseOpts;let g=i;return typeof c=="function"&&(g=c(g)),Hr(g)||(g=typeof c=="string"?o.parse(g,c):o.parse(g)),g===null?null:(h&&(g=h==="week"&&(Xf(p)||p===!0)?o.startOf(g,"isoWeek",p):o.startOf(g,h)),+g)}function kI(n,i,o,c){const h=Os.length;for(let p=Os.indexOf(n);p<h-1;++p){const g=Qy[Os[p]],x=g.steps?g.steps:Number.MAX_SAFE_INTEGER;if(g.common&&Math.ceil((o-i)/(x*g.size))<=c)return Os[p]}return Os[h-1]}function ij(n,i,o,c,h){for(let p=Os.length-1;p>=Os.indexOf(o);p--){const g=Os[p];if(Qy[g].common&&n._adapter.diff(h,c,g)>=i-1)return g}return Os[o?Os.indexOf(o):0]}function nj(n){for(let i=Os.indexOf(n)+1,o=Os.length;i<o;++i)if(Qy[Os[i]].common)return Os[i]}function DI(n,i,o){if(!o)n[i]=!0;else if(o.length){const{lo:c,hi:h}=_b(o,i),p=o[c]>=i?o[c]:o[h];n[p]=!0}}function rj(n,i,o,c){const h=n._adapter,p=+h.startOf(i[0].value,c),g=i[i.length-1].value;let x,s;for(x=p;x<=g;x=+h.add(x,1,c))s=o[x],s>=0&&(i[s].major=!0);return i}function LI(n,i,o){const c=[],h={},p=i.length;let g,x;for(g=0;g<p;++g)x=i[g],h[x]=g,c.push({value:x,major:!1});return p===0||!o?c:rj(n,c,h,o)}class rm extends Rh{constructor(i){super(i),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(i,o={}){const c=i.time||(i.time={}),h=this._adapter=new d8._date(i.adapters.date);h.init(o),jp(c.displayFormats,h.formats()),this._parseOpts={parser:c.parser,round:c.round,isoWeekday:c.isoWeekday},super.init(i),this._normalized=o.normalized}parse(i,o){return i===void 0?null:PI(this,i)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const i=this.options,o=this._adapter,c=i.time.unit||"day";let{min:h,max:p,minDefined:g,maxDefined:x}=this.getUserBounds();function s(M){!g&&!isNaN(M.min)&&(h=Math.min(h,M.min)),!x&&!isNaN(M.max)&&(p=Math.max(p,M.max))}(!g||!x)&&(s(this._getLabelBounds()),(i.bounds!=="ticks"||i.ticks.source!=="labels")&&s(this.getMinMax(!1))),h=Hr(h)&&!isNaN(h)?h:+o.startOf(Date.now(),c),p=Hr(p)&&!isNaN(p)?p:+o.endOf(Date.now(),c)+1,this.min=Math.min(h,p-1),this.max=Math.max(h+1,p)}_getLabelBounds(){const i=this.getLabelTimestamps();let o=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;return i.length&&(o=i[0],c=i[i.length-1]),{min:o,max:c}}buildTicks(){const i=this.options,o=i.time,c=i.ticks,h=c.source==="labels"?this.getLabelTimestamps():this._generate();i.bounds==="ticks"&&h.length&&(this.min=this._userMin||h[0],this.max=this._userMax||h[h.length-1]);const p=this.min,g=this.max,x=B6(h,p,g);return this._unit=o.unit||(c.autoSkip?kI(o.minUnit,this.min,this.max,this._getLabelCapacity(p)):ij(this,x.length,o.minUnit,this.min,this.max)),this._majorUnit=!c.major.enabled||this._unit==="year"?void 0:nj(this._unit),this.initOffsets(h),i.reverse&&x.reverse(),LI(this,x,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(i=>+i.value))}initOffsets(i=[]){let o=0,c=0,h,p;this.options.offset&&i.length&&(h=this.getDecimalForValue(i[0]),i.length===1?o=1-h:o=(this.getDecimalForValue(i[1])-h)/2,p=this.getDecimalForValue(i[i.length-1]),i.length===1?c=p:c=(p-this.getDecimalForValue(i[i.length-2]))/2);const g=i.length<3?.5:.25;o=Eo(o,0,g),c=Eo(c,0,g),this._offsets={start:o,end:c,factor:1/(o+1+c)}}_generate(){const i=this._adapter,o=this.min,c=this.max,h=this.options,p=h.time,g=p.unit||kI(p.minUnit,o,c,this._getLabelCapacity(o)),x=mn(h.ticks.stepSize,1),s=g==="week"?p.isoWeekday:!1,M=Xf(s)||s===!0,C={};let D=o,F,V;if(M&&(D=+i.startOf(D,"isoWeek",s)),D=+i.startOf(D,M?"day":g),i.diff(c,o,g)>1e5*x)throw new Error(o+" and "+c+" are too far apart with stepSize of "+x+" "+g);const X=h.ticks.source==="data"&&this.getDataTimestamps();for(F=D,V=0;F<c;F=+i.add(F,x,g),V++)DI(C,F,X);return(F===c||h.bounds==="ticks"||V===1)&&DI(C,F,X),Object.keys(C).sort(CI).map(W=>+W)}getLabelForValue(i){const o=this._adapter,c=this.options.time;return c.tooltipFormat?o.format(i,c.tooltipFormat):o.format(i,c.displayFormats.datetime)}format(i,o){const h=this.options.time.displayFormats,p=this._unit,g=o||h[p];return this._adapter.format(i,g)}_tickFormatFunction(i,o,c,h){const p=this.options,g=p.ticks.callback;if(g)return Tr(g,[i,o,c],this);const x=p.time.displayFormats,s=this._unit,M=this._majorUnit,C=s&&x[s],D=M&&x[M],F=c[o],V=M&&D&&F&&F.major;return this._adapter.format(i,h||(V?D:C))}generateTickLabels(i){let o,c,h;for(o=0,c=i.length;o<c;++o)h=i[o],h.label=this._tickFormatFunction(h.value,o,i)}getDecimalForValue(i){return i===null?NaN:(i-this.min)/(this.max-this.min)}getPixelForValue(i){const o=this._offsets,c=this.getDecimalForValue(i);return this.getPixelForDecimal((o.start+c)*o.factor)}getValueForPixel(i){const o=this._offsets,c=this.getDecimalForPixel(i)/o.factor-o.end;return this.min+c*(this.max-this.min)}_getLabelSize(i){const o=this.options.ticks,c=this.ctx.measureText(i).width,h=Xa(this.isHorizontal()?o.maxRotation:o.minRotation),p=Math.cos(h),g=Math.sin(h),x=this._resolveTickFontOptions(0).size;return{w:c*p+x*g,h:c*g+x*p}}_getLabelCapacity(i){const o=this.options.time,c=o.displayFormats,h=c[o.unit]||c.millisecond,p=this._tickFormatFunction(i,0,LI(this,[i],this._majorUnit),h),g=this._getLabelSize(p),x=Math.floor(this.isHorizontal()?this.width/g.w:this.height/g.h)-1;return x>0?x:1}getDataTimestamps(){let i=this._cache.data||[],o,c;if(i.length)return i;const h=this.getMatchingVisibleMetas();if(this._normalized&&h.length)return this._cache.data=h[0].controller.getAllParsedValues(this);for(o=0,c=h.length;o<c;++o)i=i.concat(h[o].controller.getAllParsedValues(this));return this._cache.data=this.normalize(i)}getLabelTimestamps(){const i=this._cache.labels||[];let o,c;if(i.length)return i;const h=this.getLabels();for(o=0,c=h.length;o<c;++o)i.push(PI(this,h[o]));return this._cache.labels=this._normalized?i:this.normalize(i)}normalize(i){return Wk(i.sort(CI))}}ui(rm,"id","time"),ui(rm,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function x_(n,i,o){let c=0,h=n.length-1,p,g,x,s;o?(i>=n[c].pos&&i<=n[h].pos&&({lo:c,hi:h}=bc(n,"pos",i)),{pos:p,time:x}=n[c],{pos:g,time:s}=n[h]):(i>=n[c].time&&i<=n[h].time&&({lo:c,hi:h}=bc(n,"time",i)),{time:p,pos:x}=n[c],{time:g,pos:s}=n[h]);const M=g-p;return M?x+(s-x)*(i-p)/M:x}class A1 extends rm{constructor(i){super(i),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const i=this._getTimestampsForTable(),o=this._table=this.buildLookupTable(i);this._minPos=x_(o,this.min),this._tableRange=x_(o,this.max)-this._minPos,super.initOffsets(i)}buildLookupTable(i){const{min:o,max:c}=this,h=[],p=[];let g,x,s,M,C;for(g=0,x=i.length;g<x;++g)M=i[g],M>=o&&M<=c&&h.push(M);if(h.length<2)return[{time:o,pos:0},{time:c,pos:1}];for(g=0,x=h.length;g<x;++g)C=h[g+1],s=h[g-1],M=h[g],Math.round((C+s)/2)!==M&&p.push({time:M,pos:g/(x-1)});return p}_generate(){const i=this.min,o=this.max;let c=super.getDataTimestamps();return(!c.includes(i)||!c.length)&&c.splice(0,0,i),(!c.includes(o)||c.length===1)&&c.push(o),c.sort((h,p)=>h-p)}_getTimestampsForTable(){let i=this._cache.all||[];if(i.length)return i;const o=this.getDataTimestamps(),c=this.getLabelTimestamps();return o.length&&c.length?i=this.normalize(o.concat(c)):i=o.length?o:c,i=this._cache.all=i,i}getDecimalForValue(i){return(x_(this._table,i)-this._minPos)/this._tableRange}getValueForPixel(i){const o=this._offsets,c=this.getDecimalForPixel(i)/o.factor-o.end;return x_(this._table,c*this._tableRange+this._minPos,!0)}}ui(A1,"id","timeseries"),ui(A1,"defaults",rm.defaults);var oj=Object.freeze({__proto__:null,CategoryScale:T1,LinearScale:S1,LogarithmicScale:M1,RadialLinearScale:Dp,TimeScale:rm,TimeSeriesScale:A1});const sj=[f8,jV,zU,oj];au.register(...sj);var aj={exports:{}};(function(n,i){(function(o,c){n.exports=c()})(vh,function(){var o=function(L,G){var le={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},we={on:function(Oe,Ve,Ft){if(le[Oe]===void 0)throw new Error("Invalid event type: "+Oe);le[Oe].push({selector:Ve,fn:Ft})},render:function(Oe){G.store.featureChanged(Oe)}},Se=function(Oe,Ve){for(var Ft=le[Oe],Nt=Ft.length;Nt--;){var Lt=Ft[Nt];if(Lt.selector(Ve)){Lt.fn.call(we,Ve)||G.store.render(),G.ui.updateMapClasses();break}}};return L.start.call(we),{render:L.render,stop:function(){L.stop&&L.stop()},trash:function(){L.trash&&(L.trash(),G.store.render())},combineFeatures:function(){L.combineFeatures&&L.combineFeatures()},uncombineFeatures:function(){L.uncombineFeatures&&L.uncombineFeatures()},drag:function(Oe){Se("drag",Oe)},click:function(Oe){Se("click",Oe)},mousemove:function(Oe){Se("mousemove",Oe)},mousedown:function(Oe){Se("mousedown",Oe)},mouseup:function(Oe){Se("mouseup",Oe)},mouseout:function(Oe){Se("mouseout",Oe)},keydown:function(Oe){Se("keydown",Oe)},keyup:function(Oe){Se("keyup",Oe)},touchstart:function(Oe){Se("touchstart",Oe)},touchmove:function(Oe){Se("touchmove",Oe)},touchend:function(Oe){Se("touchend",Oe)},tap:function(Oe){Se("tap",Oe)}}};function c(L){return L&&L.__esModule&&Object.prototype.hasOwnProperty.call(L,"default")?L.default:L}function h(L){if(L.__esModule)return L;var G=L.default;if(typeof G=="function"){var le=function we(){if(this instanceof we){var Se=[null];Se.push.apply(Se,arguments);var Oe=Function.bind.apply(G,Se);return new Oe}return G.apply(this,arguments)};le.prototype=G.prototype}else le={};return Object.defineProperty(le,"__esModule",{value:!0}),Object.keys(L).forEach(function(we){var Se=Object.getOwnPropertyDescriptor(L,we);Object.defineProperty(le,we,Se.get?Se:{enumerable:!0,get:function(){return L[we]}})}),le}var p={},g={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},x=g;function s(L){var G=0;if(L&&L.length>0){G+=Math.abs(M(L[0]));for(var le=1;le<L.length;le++)G-=Math.abs(M(L[le]))}return G}function M(L){var G,le,we,Se,Oe,Ve,Ft=0,Nt=L.length;if(Nt>2){for(Ve=0;Ve<Nt;Ve++)Ve===Nt-2?(we=Nt-2,Se=Nt-1,Oe=0):Ve===Nt-1?(we=Nt-1,Se=0,Oe=1):(we=Ve,Se=Ve+1,Oe=Ve+2),G=L[we],le=L[Se],Ft+=(C(L[Oe][0])-C(G[0]))*Math.sin(C(le[1]));Ft=Ft*x.RADIUS*x.RADIUS/2}return Ft}function C(L){return L*Math.PI/180}p.geometry=function L(G){var le,we=0;switch(G.type){case"Polygon":return s(G.coordinates);case"MultiPolygon":for(le=0;le<G.coordinates.length;le++)we+=s(G.coordinates[le]);return we;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(le=0;le<G.geometries.length;le++)we+=L(G.geometries[le]);return we}},p.ring=M;var D={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},F={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},V={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},X={POLYGON:"polygon",LINE:"line_string",POINT:"point"},W={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},J={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},$={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},ne={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},ye={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},pe={ACTIVE:"true",INACTIVE:"false"},ke=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Ae=-85,tt=Object.freeze({__proto__:null,classes:D,sources:F,cursors:V,types:X,geojsonTypes:W,modes:J,events:$,updateActions:ne,meta:ye,activeStates:pe,interactions:ke,LAT_MIN:-90,LAT_RENDERED_MIN:Ae,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),pt={Point:0,LineString:1,MultiLineString:1,Polygon:2};function kt(L,G){var le=pt[L.geometry.type]-pt[G.geometry.type];return le===0&&L.geometry.type===W.POLYGON?L.area-G.area:le}function Ie(L){return L.map(function(G){return G.geometry.type===W.POLYGON&&(G.area=p.geometry({type:W.FEATURE,property:{},geometry:G.geometry})),G}).sort(kt).map(function(G){return delete G.area,G})}function Et(L,G){return G===void 0&&(G=0),[[L.point.x-G,L.point.y-G],[L.point.x+G,L.point.y+G]]}function mt(L){if(this._items={},this._nums={},this._length=L?L.length:0,L)for(var G=0,le=L.length;G<le;G++)this.add(L[G]),L[G]!==void 0&&(typeof L[G]=="string"?this._items[L[G]]=G:this._nums[L[G]]=G)}mt.prototype.add=function(L){return this.has(L)||(this._length++,typeof L=="string"?this._items[L]=this._length:this._nums[L]=this._length),this},mt.prototype.delete=function(L){return this.has(L)===!1||(this._length--,delete this._items[L],delete this._nums[L]),this},mt.prototype.has=function(L){return(typeof L=="string"||typeof L=="number")&&(this._items[L]!==void 0||this._nums[L]!==void 0)},mt.prototype.values=function(){var L=this,G=[];return Object.keys(this._items).forEach(function(le){G.push({k:le,v:L._items[le]})}),Object.keys(this._nums).forEach(function(le){G.push({k:JSON.parse(le),v:L._nums[le]})}),G.sort(function(le,we){return le.v-we.v}).map(function(le){return le.k})},mt.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Xe=[ye.FEATURE,ye.MIDPOINT,ye.VERTEX],Tt={click:function(L,G,le){return Yt(L,G,le,le.options.clickBuffer)},touch:function(L,G,le){return Yt(L,G,le,le.options.touchBuffer)}};function Yt(L,G,le,we){if(le.map===null)return[];var Se=L?Et(L,we):G,Oe={};le.options.styles&&(Oe.layers=le.options.styles.map(function(Lt){return Lt.id}).filter(function(Lt){return le.map.getLayer(Lt)!=null}));var Ve=le.map.queryRenderedFeatures(Se,Oe).filter(function(Lt){return Xe.indexOf(Lt.properties.meta)!==-1}),Ft=new mt,Nt=[];return Ve.forEach(function(Lt){var di=Lt.properties.id;Ft.has(di)||(Ft.add(di),Nt.push(Lt))}),Ie(Nt)}function mi(L,G){var le=Tt.click(L,null,G),we={mouse:V.NONE};return le[0]&&(we.mouse=le[0].properties.active===pe.ACTIVE?V.MOVE:V.POINTER,we.feature=le[0].properties.meta),G.events.currentModeName().indexOf("draw")!==-1&&(we.mouse=V.ADD),G.ui.queueMapClasses(we),G.ui.updateMapClasses(),le[0]}function Ti(L,G){var le=L.x-G.x,we=L.y-G.y;return Math.sqrt(le*le+we*we)}function Zi(L,G,le){le===void 0&&(le={});var we=le.fineTolerance!=null?le.fineTolerance:4,Se=le.grossTolerance!=null?le.grossTolerance:12,Oe=le.interval!=null?le.interval:500;L.point=L.point||G.point,L.time=L.time||G.time;var Ve=Ti(L.point,G.point);return Ve<we||Ve<Se&&G.time-L.time<Oe}function wt(L,G,le){le===void 0&&(le={});var we=le.tolerance!=null?le.tolerance:25,Se=le.interval!=null?le.interval:250;return L.point=L.point||G.point,L.time=L.time||G.time,Ti(L.point,G.point)<we&&G.time-L.time<Se}var Ii={exports:{}},Ui=Ii.exports=function(L,G){if(G||(G=16),L===void 0&&(L=128),L<=0)return"0";for(var le=Math.log(Math.pow(2,L))/Math.log(G),we=2;le===1/0;we*=2)le=Math.log(Math.pow(2,L/we))/Math.log(G)*we;var Se=le-Math.floor(le),Oe="";for(we=0;we<Math.floor(le);we++)Oe=Math.floor(Math.random()*G).toString(G)+Oe;if(Se){var Ve=Math.pow(G,Se);Oe=Math.floor(Math.random()*Ve).toString(G)+Oe}var Ft=parseInt(Oe,G);return Ft!==1/0&&Ft>=Math.pow(2,L)?Ui(L,G):Oe};Ui.rack=function(L,G,le){var we=function(Oe){var Ve=0;do{if(Ve++>10){if(!le)throw new Error("too many ID collisions, use more bits");L+=le}var Ft=Ui(L,G)}while(Object.hasOwnProperty.call(Se,Ft));return Se[Ft]=Oe,Ft},Se=we.hats={};return we.get=function(Oe){return we.hats[Oe]},we.set=function(Oe,Ve){return we.hats[Oe]=Ve,we},we.bits=L||128,we.base=G||16,we};var Mi=c(Ii.exports),st=function(L,G){this.ctx=L,this.properties=G.properties||{},this.coordinates=G.geometry.coordinates,this.id=G.id||Mi(),this.type=G.geometry.type};st.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},st.prototype.incomingCoords=function(L){this.setCoordinates(L)},st.prototype.setCoordinates=function(L){this.coordinates=L,this.changed()},st.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},st.prototype.setProperty=function(L,G){this.properties[L]=G},st.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:W.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},st.prototype.internal=function(L){var G={id:this.id,meta:ye.FEATURE,"meta:type":this.type,active:pe.INACTIVE,mode:L};if(this.ctx.options.userProperties)for(var le in this.properties)G["user_"+le]=this.properties[le];return{type:W.FEATURE,properties:G,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var rt=function(L,G){st.call(this,L,G)};(rt.prototype=Object.create(st.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},rt.prototype.updateCoordinate=function(L,G,le){this.coordinates=arguments.length===3?[G,le]:[L,G],this.changed()},rt.prototype.getCoordinate=function(){return this.getCoordinates()};var zi=function(L,G){st.call(this,L,G)};(zi.prototype=Object.create(st.prototype)).isValid=function(){return this.coordinates.length>1},zi.prototype.addCoordinate=function(L,G,le){this.changed();var we=parseInt(L,10);this.coordinates.splice(we,0,[G,le])},zi.prototype.getCoordinate=function(L){var G=parseInt(L,10);return JSON.parse(JSON.stringify(this.coordinates[G]))},zi.prototype.removeCoordinate=function(L){this.changed(),this.coordinates.splice(parseInt(L,10),1)},zi.prototype.updateCoordinate=function(L,G,le){var we=parseInt(L,10);this.coordinates[we]=[G,le],this.changed()};var Si=function(L,G){st.call(this,L,G),this.coordinates=this.coordinates.map(function(le){return le.slice(0,-1)})};(Si.prototype=Object.create(st.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(L){return L.length>2})},Si.prototype.incomingCoords=function(L){this.coordinates=L.map(function(G){return G.slice(0,-1)}),this.changed()},Si.prototype.setCoordinates=function(L){this.coordinates=L,this.changed()},Si.prototype.addCoordinate=function(L,G,le){this.changed();var we=L.split(".").map(function(Se){return parseInt(Se,10)});this.coordinates[we[0]].splice(we[1],0,[G,le])},Si.prototype.removeCoordinate=function(L){this.changed();var G=L.split(".").map(function(we){return parseInt(we,10)}),le=this.coordinates[G[0]];le&&(le.splice(G[1],1),le.length<3&&this.coordinates.splice(G[0],1))},Si.prototype.getCoordinate=function(L){var G=L.split(".").map(function(we){return parseInt(we,10)}),le=this.coordinates[G[0]];return JSON.parse(JSON.stringify(le[G[1]]))},Si.prototype.getCoordinates=function(){return this.coordinates.map(function(L){return L.concat([L[0]])})},Si.prototype.updateCoordinate=function(L,G,le){this.changed();var we=L.split("."),Se=parseInt(we[0],10),Oe=parseInt(we[1],10);this.coordinates[Se]===void 0&&(this.coordinates[Se]=[]),this.coordinates[Se][Oe]=[G,le]};var bn={MultiPoint:rt,MultiLineString:zi,MultiPolygon:Si},nn=function(L,G,le,we,Se){var Oe=le.split("."),Ve=parseInt(Oe[0],10),Ft=Oe[1]?Oe.slice(1).join("."):null;return L[Ve][G](Ft,we,Se)},hn=function(L,G){if(st.call(this,L,G),delete this.coordinates,this.model=bn[G.geometry.type],this.model===void 0)throw new TypeError(G.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(G.geometry.coordinates)};function Ze(L){this.map=L.map,this.drawConfig=JSON.parse(JSON.stringify(L.options||{})),this._ctx=L}(hn.prototype=Object.create(st.prototype))._coordinatesToFeatures=function(L){var G=this,le=this.model.bind(this);return L.map(function(we){return new le(G.ctx,{id:Mi(),type:W.FEATURE,properties:{},geometry:{coordinates:we,type:G.type.replace("Multi","")}})})},hn.prototype.isValid=function(){return this.features.every(function(L){return L.isValid()})},hn.prototype.setCoordinates=function(L){this.features=this._coordinatesToFeatures(L),this.changed()},hn.prototype.getCoordinate=function(L){return nn(this.features,"getCoordinate",L)},hn.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(L){return L.type===W.POLYGON?L.getCoordinates():L.coordinates})))},hn.prototype.updateCoordinate=function(L,G,le){nn(this.features,"updateCoordinate",L,G,le),this.changed()},hn.prototype.addCoordinate=function(L,G,le){nn(this.features,"addCoordinate",L,G,le),this.changed()},hn.prototype.removeCoordinate=function(L){nn(this.features,"removeCoordinate",L),this.changed()},hn.prototype.getFeatures=function(){return this.features},Ze.prototype.setSelected=function(L){return this._ctx.store.setSelected(L)},Ze.prototype.setSelectedCoordinates=function(L){var G=this;this._ctx.store.setSelectedCoordinates(L),L.reduce(function(le,we){return le[we.feature_id]===void 0&&(le[we.feature_id]=!0,G._ctx.store.get(we.feature_id).changed()),le},{})},Ze.prototype.getSelected=function(){return this._ctx.store.getSelected()},Ze.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Ze.prototype.isSelected=function(L){return this._ctx.store.isSelected(L)},Ze.prototype.getFeature=function(L){return this._ctx.store.get(L)},Ze.prototype.select=function(L){return this._ctx.store.select(L)},Ze.prototype.deselect=function(L){return this._ctx.store.deselect(L)},Ze.prototype.deleteFeature=function(L,G){return G===void 0&&(G={}),this._ctx.store.delete(L,G)},Ze.prototype.addFeature=function(L){return this._ctx.store.add(L)},Ze.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Ze.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Ze.prototype.setActionableState=function(L){L===void 0&&(L={});var G={trash:L.trash||!1,combineFeatures:L.combineFeatures||!1,uncombineFeatures:L.uncombineFeatures||!1};return this._ctx.events.actionable(G)},Ze.prototype.changeMode=function(L,G,le){return G===void 0&&(G={}),le===void 0&&(le={}),this._ctx.events.changeMode(L,G,le)},Ze.prototype.updateUIClasses=function(L){return this._ctx.ui.queueMapClasses(L)},Ze.prototype.activateUIButton=function(L){return this._ctx.ui.setActiveButton(L)},Ze.prototype.featuresAt=function(L,G,le){if(le===void 0&&(le="click"),le!=="click"&&le!=="touch")throw new Error("invalid buffer type");return Tt[le](L,G,this._ctx)},Ze.prototype.newFeature=function(L){var G=L.geometry.type;return G===W.POINT?new rt(this._ctx,L):G===W.LINE_STRING?new zi(this._ctx,L):G===W.POLYGON?new Si(this._ctx,L):new hn(this._ctx,L)},Ze.prototype.isInstanceOf=function(L,G){if(L===W.POINT)return G instanceof rt;if(L===W.LINE_STRING)return G instanceof zi;if(L===W.POLYGON)return G instanceof Si;if(L==="MultiFeature")return G instanceof hn;throw new Error("Unknown feature class: "+L)},Ze.prototype.doRender=function(L){return this._ctx.store.featureChanged(L)},Ze.prototype.onSetup=function(){},Ze.prototype.onDrag=function(){},Ze.prototype.onClick=function(){},Ze.prototype.onMouseMove=function(){},Ze.prototype.onMouseDown=function(){},Ze.prototype.onMouseUp=function(){},Ze.prototype.onMouseOut=function(){},Ze.prototype.onKeyUp=function(){},Ze.prototype.onKeyDown=function(){},Ze.prototype.onTouchStart=function(){},Ze.prototype.onTouchMove=function(){},Ze.prototype.onTouchEnd=function(){},Ze.prototype.onTap=function(){},Ze.prototype.onStop=function(){},Ze.prototype.onTrash=function(){},Ze.prototype.onCombineFeature=function(){},Ze.prototype.onUncombineFeature=function(){},Ze.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var wn={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Sr=Object.keys(wn);function Mr(L){var G=Object.keys(L);return function(le,we){we===void 0&&(we={});var Se={},Oe=G.reduce(function(Ve,Ft){return Ve[Ft]=L[Ft],Ve},new Ze(le));return{start:function(){var Ve=this;Se=Oe.onSetup(we),Sr.forEach(function(Ft){var Nt,Lt=wn[Ft],di=function(){return!1};L[Lt]&&(di=function(){return!0}),Ve.on(Ft,di,(Nt=Lt,function(Qt){return Oe[Nt](Se,Qt)}))})},stop:function(){Oe.onStop(Se)},trash:function(){Oe.onTrash(Se)},combineFeatures:function(){Oe.onCombineFeatures(Se)},uncombineFeatures:function(){Oe.onUncombineFeatures(Se)},render:function(Ve,Ft){Oe.toDisplayFeatures(Se,Ve,Ft)}}}}function cn(L){return[].concat(L).filter(function(G){return G!==void 0})}function Bt(){var L=this;if(!(L.ctx.map&&L.ctx.map.getSource(F.HOT)!==void 0))return Nt();var G=L.ctx.events.currentModeName();L.ctx.ui.queueMapClasses({mode:G});var le=[],we=[];L.isDirty?we=L.getAllIds():(le=L.getChangedIds().filter(function(Lt){return L.get(Lt)!==void 0}),we=L.sources.hot.filter(function(Lt){return Lt.properties.id&&le.indexOf(Lt.properties.id)===-1&&L.get(Lt.properties.id)!==void 0}).map(function(Lt){return Lt.properties.id})),L.sources.hot=[];var Se=L.sources.cold.length;L.sources.cold=L.isDirty?[]:L.sources.cold.filter(function(Lt){var di=Lt.properties.id||Lt.properties.parent;return le.indexOf(di)===-1});var Oe=Se!==L.sources.cold.length||we.length>0;function Ve(Lt,di){var Qt=L.get(Lt).internal(G);L.ctx.events.currentModeRender(Qt,function(Xi){L.sources[di].push(Xi)})}if(le.forEach(function(Lt){return Ve(Lt,"hot")}),we.forEach(function(Lt){return Ve(Lt,"cold")}),Oe&&L.ctx.map.getSource(F.COLD).setData({type:W.FEATURE_COLLECTION,features:L.sources.cold}),L.ctx.map.getSource(F.HOT).setData({type:W.FEATURE_COLLECTION,features:L.sources.hot}),L._emitSelectionChange&&(L.ctx.map.fire($.SELECTION_CHANGE,{features:L.getSelected().map(function(Lt){return Lt.toGeoJSON()}),points:L.getSelectedCoordinates().map(function(Lt){return{type:W.FEATURE,properties:{},geometry:{type:W.POINT,coordinates:Lt.coordinates}}})}),L._emitSelectionChange=!1),L._deletedFeaturesToEmit.length){var Ft=L._deletedFeaturesToEmit.map(function(Lt){return Lt.toGeoJSON()});L._deletedFeaturesToEmit=[],L.ctx.map.fire($.DELETE,{features:Ft})}function Nt(){L.isDirty=!1,L.clearChangedIds()}Nt(),L.ctx.map.fire($.RENDER,{})}function si(L){var G,le=this;this._features={},this._featureIds=new mt,this._selectedFeatureIds=new mt,this._selectedCoordinates=[],this._changedFeatureIds=new mt,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=L,this.sources={hot:[],cold:[]},this.render=function(){G||(G=requestAnimationFrame(function(){G=null,Bt.call(le)}))},this.isDirty=!1}function je(L,G){var le=L._selectedCoordinates.filter(function(we){return L._selectedFeatureIds.has(we.feature_id)});L._selectedCoordinates.length===le.length||G.silent||(L._emitSelectionChange=!0),L._selectedCoordinates=le}si.prototype.createRenderBatch=function(){var L=this,G=this.render,le=0;return this.render=function(){le++},function(){L.render=G,le>0&&L.render()}},si.prototype.setDirty=function(){return this.isDirty=!0,this},si.prototype.featureChanged=function(L){return this._changedFeatureIds.add(L),this},si.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},si.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},si.prototype.getAllIds=function(){return this._featureIds.values()},si.prototype.add=function(L){return this.featureChanged(L.id),this._features[L.id]=L,this._featureIds.add(L.id),this},si.prototype.delete=function(L,G){var le=this;return G===void 0&&(G={}),cn(L).forEach(function(we){le._featureIds.has(we)&&(le._featureIds.delete(we),le._selectedFeatureIds.delete(we),G.silent||le._deletedFeaturesToEmit.indexOf(le._features[we])===-1&&le._deletedFeaturesToEmit.push(le._features[we]),delete le._features[we],le.isDirty=!0)}),je(this,G),this},si.prototype.get=function(L){return this._features[L]},si.prototype.getAll=function(){var L=this;return Object.keys(this._features).map(function(G){return L._features[G]})},si.prototype.select=function(L,G){var le=this;return G===void 0&&(G={}),cn(L).forEach(function(we){le._selectedFeatureIds.has(we)||(le._selectedFeatureIds.add(we),le._changedFeatureIds.add(we),G.silent||(le._emitSelectionChange=!0))}),this},si.prototype.deselect=function(L,G){var le=this;return G===void 0&&(G={}),cn(L).forEach(function(we){le._selectedFeatureIds.has(we)&&(le._selectedFeatureIds.delete(we),le._changedFeatureIds.add(we),G.silent||(le._emitSelectionChange=!0))}),je(this,G),this},si.prototype.clearSelected=function(L){return L===void 0&&(L={}),this.deselect(this._selectedFeatureIds.values(),{silent:L.silent}),this},si.prototype.setSelected=function(L,G){var le=this;return G===void 0&&(G={}),L=cn(L),this.deselect(this._selectedFeatureIds.values().filter(function(we){return L.indexOf(we)===-1}),{silent:G.silent}),this.select(L.filter(function(we){return!le._selectedFeatureIds.has(we)}),{silent:G.silent}),this},si.prototype.setSelectedCoordinates=function(L){return this._selectedCoordinates=L,this._emitSelectionChange=!0,this},si.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},si.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},si.prototype.getSelected=function(){var L=this;return this._selectedFeatureIds.values().map(function(G){return L.get(G)})},si.prototype.getSelectedCoordinates=function(){var L=this;return this._selectedCoordinates.map(function(G){return{coordinates:L.get(G.feature_id).getCoordinate(G.coord_path)}})},si.prototype.isSelected=function(L){return this._selectedFeatureIds.has(L)},si.prototype.setFeatureProperty=function(L,G,le){this.get(L).setProperty(G,le),this.featureChanged(L)},si.prototype.storeMapConfig=function(){var L=this;ke.forEach(function(G){L.ctx.map[G]&&(L._mapInitialConfig[G]=L.ctx.map[G].isEnabled())})},si.prototype.restoreMapConfig=function(){var L=this;Object.keys(this._mapInitialConfig).forEach(function(G){L._mapInitialConfig[G]?L.ctx.map[G].enable():L.ctx.map[G].disable()})},si.prototype.getInitialConfigValue=function(L){return this._mapInitialConfig[L]===void 0||this._mapInitialConfig[L]};var re=function(){for(var L=arguments,G={},le=0;le<arguments.length;le++){var we=L[le];for(var Se in we)fe.call(we,Se)&&(G[Se]=we[Se])}return G},fe=Object.prototype.hasOwnProperty,Ee=c(re),dt=["mode","feature","mouse"];function ft(L){var G=null,le=null,we={onRemove:function(){return L.map.off("load",we.connect),clearInterval(le),we.removeLayers(),L.store.restoreMapConfig(),L.ui.removeButtons(),L.events.removeEventListeners(),L.ui.clearMapClasses(),L.boxZoomInitial&&L.map.boxZoom.enable(),L.map=null,L.container=null,L.store=null,G&&G.parentNode&&G.parentNode.removeChild(G),G=null,this},connect:function(){L.map.off("load",we.connect),clearInterval(le),we.addLayers(),L.store.storeMapConfig(),L.events.addEventListeners()},onAdd:function(Se){var Oe=Se.fire;return Se.fire=function(Ve,Ft){var Nt=arguments;return Oe.length===1&&arguments.length!==1&&(Nt=[Ee({},{type:Ve},Ft)]),Oe.apply(Se,Nt)},L.map=Se,L.events=function(Ve){var Ft=Object.keys(Ve.options.modes).reduce(function(At,wi){return At[wi]=Mr(Ve.options.modes[wi]),At},{}),Nt={},Lt={},di={},Qt=null,Xi=null;di.drag=function(At,wi){wi({point:At.point,time:new Date().getTime()})?(Ve.ui.queueMapClasses({mouse:V.DRAG}),Xi.drag(At)):At.originalEvent.stopPropagation()},di.mousedrag=function(At){di.drag(At,function(wi){return!Zi(Nt,wi)})},di.touchdrag=function(At){di.drag(At,function(wi){return!wt(Lt,wi)})},di.mousemove=function(At){if((At.originalEvent.buttons!==void 0?At.originalEvent.buttons:At.originalEvent.which)===1)return di.mousedrag(At);var wi=mi(At,Ve);At.featureTarget=wi,Xi.mousemove(At)},di.mousedown=function(At){Nt={time:new Date().getTime(),point:At.point};var wi=mi(At,Ve);At.featureTarget=wi,Xi.mousedown(At)},di.mouseup=function(At){var wi=mi(At,Ve);At.featureTarget=wi,Zi(Nt,{point:At.point,time:new Date().getTime()})?Xi.click(At):Xi.mouseup(At)},di.mouseout=function(At){Xi.mouseout(At)},di.touchstart=function(At){if(Ve.options.touchEnabled){Lt={time:new Date().getTime(),point:At.point};var wi=Tt.touch(At,null,Ve)[0];At.featureTarget=wi,Xi.touchstart(At)}},di.touchmove=function(At){if(Ve.options.touchEnabled)return Xi.touchmove(At),di.touchdrag(At)},di.touchend=function(At){if(At.originalEvent.preventDefault(),Ve.options.touchEnabled){var wi=Tt.touch(At,null,Ve)[0];At.featureTarget=wi,wt(Lt,{time:new Date().getTime(),point:At.point})?Xi.tap(At):Xi.touchend(At)}};var Gn=function(At){return!(At===8||At===46||At>=48&&At<=57)};function Ki(At,wi,Cn){Cn===void 0&&(Cn={}),Xi.stop();var Or=Ft[At];if(Or===void 0)throw new Error(At+" is not valid");Qt=At;var Sn=Or(Ve,wi);Xi=o(Sn,Ve),Cn.silent||Ve.map.fire($.MODE_CHANGE,{mode:At}),Ve.store.setDirty(),Ve.store.render()}di.keydown=function(At){(At.srcElement||At.target).classList.contains("mapboxgl-canvas")&&(At.keyCode!==8&&At.keyCode!==46||!Ve.options.controls.trash?Gn(At.keyCode)?Xi.keydown(At):At.keyCode===49&&Ve.options.controls.point?Ki(J.DRAW_POINT):At.keyCode===50&&Ve.options.controls.line_string?Ki(J.DRAW_LINE_STRING):At.keyCode===51&&Ve.options.controls.polygon&&Ki(J.DRAW_POLYGON):(At.preventDefault(),Xi.trash()))},di.keyup=function(At){Gn(At.keyCode)&&Xi.keyup(At)},di.zoomend=function(){Ve.store.changeZoom()},di.data=function(At){if(At.dataType==="style"){var wi=Ve.setup,Cn=Ve.map,Or=Ve.options,Sn=Ve.store;Or.styles.some(function(Ln){return Cn.getLayer(Ln.id)})||(wi.addLayers(),Sn.setDirty(),Sn.render())}};var cr={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){Qt=Ve.options.defaultMode,Xi=o(Ft[Qt](Ve),Ve)},changeMode:Ki,actionable:function(At){var wi=!1;Object.keys(At).forEach(function(Cn){if(cr[Cn]===void 0)throw new Error("Invalid action type");cr[Cn]!==At[Cn]&&(wi=!0),cr[Cn]=At[Cn]}),wi&&Ve.map.fire($.ACTIONABLE,{actions:cr})},currentModeName:function(){return Qt},currentModeRender:function(At,wi){return Xi.render(At,wi)},fire:function(At,wi){di[At]&&di[At](wi)},addEventListeners:function(){Ve.map.on("mousemove",di.mousemove),Ve.map.on("mousedown",di.mousedown),Ve.map.on("mouseup",di.mouseup),Ve.map.on("data",di.data),Ve.map.on("touchmove",di.touchmove),Ve.map.on("touchstart",di.touchstart),Ve.map.on("touchend",di.touchend),Ve.container.addEventListener("mouseout",di.mouseout),Ve.options.keybindings&&(Ve.container.addEventListener("keydown",di.keydown),Ve.container.addEventListener("keyup",di.keyup))},removeEventListeners:function(){Ve.map.off("mousemove",di.mousemove),Ve.map.off("mousedown",di.mousedown),Ve.map.off("mouseup",di.mouseup),Ve.map.off("data",di.data),Ve.map.off("touchmove",di.touchmove),Ve.map.off("touchstart",di.touchstart),Ve.map.off("touchend",di.touchend),Ve.container.removeEventListener("mouseout",di.mouseout),Ve.options.keybindings&&(Ve.container.removeEventListener("keydown",di.keydown),Ve.container.removeEventListener("keyup",di.keyup))},trash:function(At){Xi.trash(At)},combineFeatures:function(){Xi.combineFeatures()},uncombineFeatures:function(){Xi.uncombineFeatures()},getMode:function(){return Qt}}}(L),L.ui=function(Ve){var Ft={},Nt=null,Lt={mode:null,feature:null,mouse:null},di={mode:null,feature:null,mouse:null};function Qt(At){di=Ee(di,At)}function Xi(){var At,wi;if(Ve.container){var Cn=[],Or=[];dt.forEach(function(Sn){di[Sn]!==Lt[Sn]&&(Cn.push(Sn+"-"+Lt[Sn]),di[Sn]!==null&&Or.push(Sn+"-"+di[Sn]))}),Cn.length>0&&(At=Ve.container.classList).remove.apply(At,Cn),Or.length>0&&(wi=Ve.container.classList).add.apply(wi,Or),Lt=Ee(Lt,di)}}function Gn(At,wi){wi===void 0&&(wi={});var Cn=document.createElement("button");return Cn.className=D.CONTROL_BUTTON+" "+wi.className,Cn.setAttribute("title",wi.title),wi.container.appendChild(Cn),Cn.addEventListener("click",function(Or){if(Or.preventDefault(),Or.stopPropagation(),Or.target===Nt)return Ki(),void wi.onDeactivate();cr(At),wi.onActivate()},!0),Cn}function Ki(){Nt&&(Nt.classList.remove(D.ACTIVE_BUTTON),Nt=null)}function cr(At){Ki();var wi=Ft[At];wi&&wi&&At!=="trash"&&(wi.classList.add(D.ACTIVE_BUTTON),Nt=wi)}return{setActiveButton:cr,queueMapClasses:Qt,updateMapClasses:Xi,clearMapClasses:function(){Qt({mode:null,feature:null,mouse:null}),Xi()},addButtons:function(){var At=Ve.options.controls,wi=document.createElement("div");return wi.className=D.CONTROL_GROUP+" "+D.CONTROL_BASE,At&&(At[X.LINE]&&(Ft[X.LINE]=Gn(X.LINE,{container:wi,className:D.CONTROL_BUTTON_LINE,title:"LineString tool "+(Ve.options.keybindings?"(l)":""),onActivate:function(){return Ve.events.changeMode(J.DRAW_LINE_STRING)},onDeactivate:function(){return Ve.events.trash()}})),At[X.POLYGON]&&(Ft[X.POLYGON]=Gn(X.POLYGON,{container:wi,className:D.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(Ve.options.keybindings?"(p)":""),onActivate:function(){return Ve.events.changeMode(J.DRAW_POLYGON)},onDeactivate:function(){return Ve.events.trash()}})),At[X.POINT]&&(Ft[X.POINT]=Gn(X.POINT,{container:wi,className:D.CONTROL_BUTTON_POINT,title:"Marker tool "+(Ve.options.keybindings?"(m)":""),onActivate:function(){return Ve.events.changeMode(J.DRAW_POINT)},onDeactivate:function(){return Ve.events.trash()}})),At.trash&&(Ft.trash=Gn("trash",{container:wi,className:D.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){Ve.events.trash()}})),At.combine_features&&(Ft.combine_features=Gn("combineFeatures",{container:wi,className:D.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){Ve.events.combineFeatures()}})),At.uncombine_features&&(Ft.uncombine_features=Gn("uncombineFeatures",{container:wi,className:D.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){Ve.events.uncombineFeatures()}}))),wi},removeButtons:function(){Object.keys(Ft).forEach(function(At){var wi=Ft[At];wi.parentNode&&wi.parentNode.removeChild(wi),delete Ft[At]})}}}(L),L.container=Se.getContainer(),L.store=new si(L),G=L.ui.addButtons(),L.options.boxSelect&&(L.boxZoomInitial=Se.boxZoom.isEnabled(),Se.boxZoom.disable(),Se.dragPan.disable(),Se.dragPan.enable()),Se.loaded()?we.connect():(Se.on("load",we.connect),le=setInterval(function(){Se.loaded()&&we.connect()},16)),L.events.start(),G},addLayers:function(){L.map.addSource(F.COLD,{data:{type:W.FEATURE_COLLECTION,features:[]},type:"geojson"}),L.map.addSource(F.HOT,{data:{type:W.FEATURE_COLLECTION,features:[]},type:"geojson"}),L.options.styles.forEach(function(Se){L.map.addLayer(Se)}),L.store.setDirty(!0),L.store.render()},removeLayers:function(){L.options.styles.forEach(function(Se){L.map.getLayer(Se.id)&&L.map.removeLayer(Se.id)}),L.map.getSource(F.COLD)&&L.map.removeSource(F.COLD),L.map.getSource(F.HOT)&&L.map.removeSource(F.HOT)}};return L.setup=we,we}var Ut=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function Wt(L){return function(G){var le=G.featureTarget;return!!le&&!!le.properties&&le.properties.meta===L}}function at(L){return!!L.originalEvent&&!!L.originalEvent.shiftKey&&L.originalEvent.button===0}function Zt(L){return!!L.featureTarget&&!!L.featureTarget.properties&&L.featureTarget.properties.active===pe.ACTIVE&&L.featureTarget.properties.meta===ye.FEATURE}function Gt(L){return!!L.featureTarget&&!!L.featureTarget.properties&&L.featureTarget.properties.active===pe.INACTIVE&&L.featureTarget.properties.meta===ye.FEATURE}function qt(L){return L.featureTarget===void 0}function rn(L){return!!L.featureTarget&&!!L.featureTarget.properties&&L.featureTarget.properties.meta===ye.FEATURE}function Bi(L){var G=L.featureTarget;return!!G&&!!G.properties&&G.properties.meta===ye.VERTEX}function qn(L){return!!L.originalEvent&&L.originalEvent.shiftKey===!0}function _n(L){return L.keyCode===27}function Tn(L){return L.keyCode===13}var We=Object.freeze({__proto__:null,isOfMetaType:Wt,isShiftMousedown:at,isActiveFeature:Zt,isInactiveFeature:Gt,noTarget:qt,isFeature:rn,isVertex:Bi,isShiftDown:qn,isEscapeKey:_n,isEnterKey:Tn,isTrue:function(){return!0}}),pi=Wi;function Wi(L,G){this.x=L,this.y=G}Wi.prototype={clone:function(){return new Wi(this.x,this.y)},add:function(L){return this.clone()._add(L)},sub:function(L){return this.clone()._sub(L)},multByPoint:function(L){return this.clone()._multByPoint(L)},divByPoint:function(L){return this.clone()._divByPoint(L)},mult:function(L){return this.clone()._mult(L)},div:function(L){return this.clone()._div(L)},rotate:function(L){return this.clone()._rotate(L)},rotateAround:function(L,G){return this.clone()._rotateAround(L,G)},matMult:function(L){return this.clone()._matMult(L)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(L){return this.x===L.x&&this.y===L.y},dist:function(L){return Math.sqrt(this.distSqr(L))},distSqr:function(L){var G=L.x-this.x,le=L.y-this.y;return G*G+le*le},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(L){return Math.atan2(this.y-L.y,this.x-L.x)},angleWith:function(L){return this.angleWithSep(L.x,L.y)},angleWithSep:function(L,G){return Math.atan2(this.x*G-this.y*L,this.x*L+this.y*G)},_matMult:function(L){var G=L[0]*this.x+L[1]*this.y,le=L[2]*this.x+L[3]*this.y;return this.x=G,this.y=le,this},_add:function(L){return this.x+=L.x,this.y+=L.y,this},_sub:function(L){return this.x-=L.x,this.y-=L.y,this},_mult:function(L){return this.x*=L,this.y*=L,this},_div:function(L){return this.x/=L,this.y/=L,this},_multByPoint:function(L){return this.x*=L.x,this.y*=L.y,this},_divByPoint:function(L){return this.x/=L.x,this.y/=L.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var L=this.y;return this.y=this.x,this.x=-L,this},_rotate:function(L){var G=Math.cos(L),le=Math.sin(L),we=G*this.x-le*this.y,Se=le*this.x+G*this.y;return this.x=we,this.y=Se,this},_rotateAround:function(L,G){var le=Math.cos(L),we=Math.sin(L),Se=G.x+le*(this.x-G.x)-we*(this.y-G.y),Oe=G.y+we*(this.x-G.x)+le*(this.y-G.y);return this.x=Se,this.y=Oe,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Wi.convert=function(L){return L instanceof Wi?L:Array.isArray(L)?new Wi(L[0],L[1]):L};var an=c(pi);function Xn(L,G){var le=G.getBoundingClientRect();return new an(L.clientX-le.left-(G.clientLeft||0),L.clientY-le.top-(G.clientTop||0))}function Zr(L,G,le,we){return{type:W.FEATURE,properties:{meta:ye.VERTEX,parent:L,coord_path:le,active:we?pe.ACTIVE:pe.INACTIVE},geometry:{type:W.POINT,coordinates:G}}}function Er(L,G,le){var we=G.geometry.coordinates,Se=le.geometry.coordinates;if(we[1]>85||we[1]<Ae||Se[1]>85||Se[1]<Ae)return null;var Oe={lng:(we[0]+Se[0])/2,lat:(we[1]+Se[1])/2};return{type:W.FEATURE,properties:{meta:ye.MIDPOINT,parent:L,lng:Oe.lng,lat:Oe.lat,coord_path:le.properties.coord_path},geometry:{type:W.POINT,coordinates:[Oe.lng,Oe.lat]}}}function yo(L,G,le){G===void 0&&(G={}),le===void 0&&(le=null);var we,Se=L.geometry,Oe=Se.type,Ve=Se.coordinates,Ft=L.properties&&L.properties.id,Nt=[];function Lt(Qt,Xi){var Gn="",Ki=null;Qt.forEach(function(cr,At){var wi=Xi!=null?Xi+"."+At:String(At),Cn=Zr(Ft,cr,wi,di(wi));if(G.midpoints&&Ki){var Or=Er(Ft,Ki,Cn);Or&&Nt.push(Or)}Ki=Cn;var Sn=JSON.stringify(cr);Gn!==Sn&&Nt.push(Cn),At===0&&(Gn=Sn)})}function di(Qt){return!!G.selectedPaths&&G.selectedPaths.indexOf(Qt)!==-1}return Oe===W.POINT?Nt.push(Zr(Ft,Ve,le,di(le))):Oe===W.POLYGON?Ve.forEach(function(Qt,Xi){Lt(Qt,le!==null?le+"."+Xi:String(Xi))}):Oe===W.LINE_STRING?Lt(Ve,le):Oe.indexOf(W.MULTI_PREFIX)===0&&(we=Oe.replace(W.MULTI_PREFIX,""),Ve.forEach(function(Qt,Xi){var Gn={type:W.FEATURE,properties:L.properties,geometry:{type:we,coordinates:Qt}};Nt=Nt.concat(yo(Gn,G,Xi))})),Nt}var jr={enable:function(L){setTimeout(function(){L.map&&L.map.doubleClickZoom&&L._ctx&&L._ctx.store&&L._ctx.store.getInitialConfigValue&&L._ctx.store.getInitialConfigValue("doubleClickZoom")&&L.map.doubleClickZoom.enable()},0)},disable:function(L){setTimeout(function(){L.map&&L.map.doubleClickZoom&&L.map.doubleClickZoom.disable()},0)}},Ar={exports:{}},Qe=function(L){if(!L||!L.type)return null;var G=lt[L.type];if(!G)return null;if(G==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:L}]};if(G==="feature")return{type:"FeatureCollection",features:[L]};if(G==="featurecollection")return L},lt={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},xt=c(Qe),St=Object.freeze({__proto__:null,default:function L(G){switch(G&&G.type||null){case"FeatureCollection":return G.features=G.features.reduce(function(le,we){return le.concat(L(we))},[]),G;case"Feature":return G.geometry?L(G.geometry).map(function(le){var we={type:"Feature",properties:JSON.parse(JSON.stringify(G.properties)),geometry:le};return G.id!==void 0&&(we.id=G.id),we}):[G];case"MultiPoint":return G.coordinates.map(function(le){return{type:"Point",coordinates:le}});case"MultiPolygon":return G.coordinates.map(function(le){return{type:"Polygon",coordinates:le}});case"MultiLineString":return G.coordinates.map(function(le){return{type:"LineString",coordinates:le}});case"GeometryCollection":return G.geometries.map(L).reduce(function(le,we){return le.concat(we)},[]);case"Point":case"Polygon":case"LineString":return[G]}}}),Ct=Qe,zt=h(St),jt=function(L){return function G(le){return Array.isArray(le)&&le.length&&typeof le[0]=="number"?[le]:le.reduce(function(we,Se){return Array.isArray(Se)&&Array.isArray(Se[0])?we.concat(G(Se)):(we.push(Se),we)},[])}(L)};zt instanceof Function||(zt=zt.default);var Dt={exports:{}},ni=Dt.exports=function(L){return new yt(L)};function yt(L){this.value=L}function Pi(L,G,le){var we=[],Se=[],Oe=!0;return function Ve(Ft){var Nt=le?un(Ft):Ft,Lt={},di=!0,Qt={node:Nt,node_:Ft,path:[].concat(we),parent:Se[Se.length-1],parents:Se,key:we.slice(-1)[0],isRoot:we.length===0,level:we.length,circular:null,update:function(Ki,cr){Qt.isRoot||(Qt.parent.node[Qt.key]=Ki),Qt.node=Ki,cr&&(di=!1)},delete:function(Ki){delete Qt.parent.node[Qt.key],Ki&&(di=!1)},remove:function(Ki){Yn(Qt.parent.node)?Qt.parent.node.splice(Qt.key,1):delete Qt.parent.node[Qt.key],Ki&&(di=!1)},keys:null,before:function(Ki){Lt.before=Ki},after:function(Ki){Lt.after=Ki},pre:function(Ki){Lt.pre=Ki},post:function(Ki){Lt.post=Ki},stop:function(){Oe=!1},block:function(){di=!1}};if(!Oe)return Qt;function Xi(){if(typeof Qt.node=="object"&&Qt.node!==null){Qt.keys&&Qt.node_===Qt.node||(Qt.keys=fi(Qt.node)),Qt.isLeaf=Qt.keys.length==0;for(var Ki=0;Ki<Se.length;Ki++)if(Se[Ki].node_===Ft){Qt.circular=Se[Ki];break}}else Qt.isLeaf=!0,Qt.keys=null;Qt.notLeaf=!Qt.isLeaf,Qt.notRoot=!Qt.isRoot}Xi();var Gn=G.call(Qt,Qt.node);return Gn!==void 0&&Qt.update&&Qt.update(Gn),Lt.before&&Lt.before.call(Qt,Qt.node),di&&(typeof Qt.node!="object"||Qt.node===null||Qt.circular||(Se.push(Qt),Xi(),Zn(Qt.keys,function(Ki,cr){we.push(Ki),Lt.pre&&Lt.pre.call(Qt,Qt.node[Ki],Ki);var At=Ve(Qt.node[Ki]);le&&tr.call(Qt.node,Ki)&&(Qt.node[Ki]=At.node),At.isLast=cr==Qt.keys.length-1,At.isFirst=cr==0,Lt.post&&Lt.post.call(Qt,At),we.pop()}),Se.pop()),Lt.after&&Lt.after.call(Qt,Qt.node)),Qt}(L).node}function un(L){if(typeof L=="object"&&L!==null){var G;if(Yn(L))G=[];else if(on(L)==="[object Date]")G=new Date(L.getTime?L.getTime():L);else if(function(Se){return on(Se)==="[object RegExp]"}(L))G=new RegExp(L);else if(function(Se){return on(Se)==="[object Error]"}(L))G={message:L.message};else if(function(Se){return on(Se)==="[object Boolean]"}(L))G=new Boolean(L);else if(function(Se){return on(Se)==="[object Number]"}(L))G=new Number(L);else if(function(Se){return on(Se)==="[object String]"}(L))G=new String(L);else if(Object.create&&Object.getPrototypeOf)G=Object.create(Object.getPrototypeOf(L));else if(L.constructor===Object)G={};else{var le=L.constructor&&L.constructor.prototype||L.__proto__||{},we=function(){};we.prototype=le,G=new we}return Zn(fi(L),function(Se){G[Se]=L[Se]}),G}return L}yt.prototype.get=function(L){for(var G=this.value,le=0;le<L.length;le++){var we=L[le];if(!G||!tr.call(G,we)){G=void 0;break}G=G[we]}return G},yt.prototype.has=function(L){for(var G=this.value,le=0;le<L.length;le++){var we=L[le];if(!G||!tr.call(G,we))return!1;G=G[we]}return!0},yt.prototype.set=function(L,G){for(var le=this.value,we=0;we<L.length-1;we++){var Se=L[we];tr.call(le,Se)||(le[Se]={}),le=le[Se]}return le[L[we]]=G,G},yt.prototype.map=function(L){return Pi(this.value,L,!0)},yt.prototype.forEach=function(L){return this.value=Pi(this.value,L,!1),this.value},yt.prototype.reduce=function(L,G){var le=arguments.length===1,we=le?this.value:G;return this.forEach(function(Se){this.isRoot&&le||(we=L.call(this,we,Se))}),we},yt.prototype.paths=function(){var L=[];return this.forEach(function(G){L.push(this.path)}),L},yt.prototype.nodes=function(){var L=[];return this.forEach(function(G){L.push(this.node)}),L},yt.prototype.clone=function(){var L=[],G=[];return function le(we){for(var Se=0;Se<L.length;Se++)if(L[Se]===we)return G[Se];if(typeof we=="object"&&we!==null){var Oe=un(we);return L.push(we),G.push(Oe),Zn(fi(we),function(Ve){Oe[Ve]=le(we[Ve])}),L.pop(),G.pop(),Oe}return we}(this.value)};var fi=Object.keys||function(L){var G=[];for(var le in L)G.push(le);return G};function on(L){return Object.prototype.toString.call(L)}var Yn=Array.isArray||function(L){return Object.prototype.toString.call(L)==="[object Array]"},Zn=function(L,G){if(L.forEach)return L.forEach(G);for(var le=0;le<L.length;le++)G(L[le],le,L)};Zn(fi(yt.prototype),function(L){ni[L]=function(G){var le=[].slice.call(arguments,1),we=new yt(G);return we[L].apply(we,le)}});var tr=Object.hasOwnProperty||function(L,G){return G in L},Xr=Dt.exports,Io=ir;function ir(L){if(!(this instanceof ir))return new ir(L);this._bbox=L||[1/0,1/0,-1/0,-1/0],this._valid=!!L}ir.prototype.include=function(L){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],L[0]),this._bbox[1]=Math.min(this._bbox[1],L[1]),this._bbox[2]=Math.max(this._bbox[2],L[0]),this._bbox[3]=Math.max(this._bbox[3],L[1]),this},ir.prototype.equals=function(L){var G;return G=L instanceof ir?L.bbox():L,this._bbox[0]==G[0]&&this._bbox[1]==G[1]&&this._bbox[2]==G[2]&&this._bbox[3]==G[3]},ir.prototype.center=function(L){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},ir.prototype.union=function(L){var G;return this._valid=!0,G=L instanceof ir?L.bbox():L,this._bbox[0]=Math.min(this._bbox[0],G[0]),this._bbox[1]=Math.min(this._bbox[1],G[1]),this._bbox[2]=Math.max(this._bbox[2],G[2]),this._bbox[3]=Math.max(this._bbox[3],G[3]),this},ir.prototype.bbox=function(){return this._valid?this._bbox:null},ir.prototype.contains=function(L){if(!L)return this._fastContains();if(!this._valid)return null;var G=L[0],le=L[1];return this._bbox[0]<=G&&this._bbox[1]<=le&&this._bbox[2]>=G&&this._bbox[3]>=le},ir.prototype.intersect=function(L){return this._valid?(G=L instanceof ir?L.bbox():L,!(this._bbox[0]>G[2]||this._bbox[2]<G[0]||this._bbox[3]<G[1]||this._bbox[1]>G[3])):null;var G},ir.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var L="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",L)},ir.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Co=function(L){if(!L)return[];var G=zt(Ct(L)),le=[];return G.features.forEach(function(we){we.geometry&&(le=le.concat(jt(we.geometry.coordinates)))}),le},Yr=Xr,vo=Io,ys={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},$a=Object.keys(ys);function kl(L){for(var G=vo(),le=Co(L),we=0;we<le.length;we++)G.include(le[we]);return G}Ar.exports=function(L){return kl(L).bbox()},Ar.exports.polygon=function(L){return kl(L).polygon()},Ar.exports.bboxify=function(L){return Yr(L).map(function(G){G&&$a.some(function(le){return!!G[le]&&ys[le].indexOf(G.type)!==-1})&&(G.bbox=kl(G).bbox(),this.update(G))})};var Ac=c(Ar.exports),wa=-90;function Dl(L,G){var le=wa,we=90,Se=wa,Oe=90,Ve=270,Ft=-270;L.forEach(function(Lt){var di=Ac(Lt),Qt=di[1],Xi=di[3],Gn=di[0],Ki=di[2];Qt>le&&(le=Qt),Xi<we&&(we=Xi),Xi>Se&&(Se=Xi),Qt<Oe&&(Oe=Qt),Gn<Ve&&(Ve=Gn),Ki>Ft&&(Ft=Ki)});var Nt=G;return le+Nt.lat>85&&(Nt.lat=85-le),Se+Nt.lat>90&&(Nt.lat=90-Se),we+Nt.lat<-85&&(Nt.lat=-85-we),Oe+Nt.lat<wa&&(Nt.lat=wa-Oe),Ve+Nt.lng<=-270&&(Nt.lng+=360*Math.ceil(Math.abs(Nt.lng)/360)),Ft+Nt.lng>=270&&(Nt.lng-=360*Math.ceil(Math.abs(Nt.lng)/360)),Nt}function Ta(L,G){var le=Dl(L.map(function(we){return we.toGeoJSON()}),G);L.forEach(function(we){var Se,Oe=we.getCoordinates(),Ve=function(Nt){var Lt={lng:Nt[0]+le.lng,lat:Nt[1]+le.lat};return[Lt.lng,Lt.lat]},Ft=function(Nt){return Nt.map(function(Lt){return Ve(Lt)})};we.type===W.POINT?Se=Ve(Oe):we.type===W.LINE_STRING||we.type===W.MULTI_POINT?Se=Oe.map(Ve):we.type===W.POLYGON||we.type===W.MULTI_LINE_STRING?Se=Oe.map(Ft):we.type===W.MULTI_POLYGON&&(Se=Oe.map(function(Nt){return Nt.map(function(Lt){return Ft(Lt)})})),we.incomingCoords(Se)})}var lr={onSetup:function(L){var G=this,le={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:L.featureIds||[]};return this.setSelected(le.initiallySelectedFeatureIds.filter(function(we){return G.getFeature(we)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),le},fireUpdate:function(){this.map.fire($.UPDATE,{action:ne.MOVE,features:this.getSelected().map(function(L){return L.toGeoJSON()})})},fireActionable:function(){var L=this,G=this.getSelected(),le=G.filter(function(Ft){return L.isInstanceOf("MultiFeature",Ft)}),we=!1;if(G.length>1){we=!0;var Se=G[0].type.replace("Multi","");G.forEach(function(Ft){Ft.type.replace("Multi","")!==Se&&(we=!1)})}var Oe=le.length>0,Ve=G.length>0;this.setActionableState({combineFeatures:we,uncombineFeatures:Oe,trash:Ve})},getUniqueIds:function(L){return L.length?L.map(function(G){return G.properties.id}).filter(function(G){return G!==void 0}).reduce(function(G,le){return G.add(le),G},new mt).values():[]},stopExtendedInteractions:function(L){L.boxSelectElement&&(L.boxSelectElement.parentNode&&L.boxSelectElement.parentNode.removeChild(L.boxSelectElement),L.boxSelectElement=null),this.map.dragPan.enable(),L.boxSelecting=!1,L.canBoxSelect=!1,L.dragMoving=!1,L.canDragMove=!1},onStop:function(){jr.enable(this)},onMouseMove:function(L,G){return rn(G)&&L.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(L),!0},onMouseOut:function(L){return!L.dragMoving||this.fireUpdate()}};lr.onTap=lr.onClick=function(L,G){return qt(G)?this.clickAnywhere(L,G):Wt(ye.VERTEX)(G)?this.clickOnVertex(L,G):rn(G)?this.clickOnFeature(L,G):void 0},lr.clickAnywhere=function(L){var G=this,le=this.getSelectedIds();le.length&&(this.clearSelectedFeatures(),le.forEach(function(we){return G.doRender(we)})),jr.enable(this),this.stopExtendedInteractions(L)},lr.clickOnVertex=function(L,G){this.changeMode(J.DIRECT_SELECT,{featureId:G.featureTarget.properties.parent,coordPath:G.featureTarget.properties.coord_path,startPos:G.lngLat}),this.updateUIClasses({mouse:V.MOVE})},lr.startOnActiveFeature=function(L,G){this.stopExtendedInteractions(L),this.map.dragPan.disable(),this.doRender(G.featureTarget.properties.id),L.canDragMove=!0,L.dragMoveLocation=G.lngLat},lr.clickOnFeature=function(L,G){var le=this;jr.disable(this),this.stopExtendedInteractions(L);var we=qn(G),Se=this.getSelectedIds(),Oe=G.featureTarget.properties.id,Ve=this.isSelected(Oe);if(!we&&Ve&&this.getFeature(Oe).type!==W.POINT)return this.changeMode(J.DIRECT_SELECT,{featureId:Oe});Ve&&we?(this.deselect(Oe),this.updateUIClasses({mouse:V.POINTER}),Se.length===1&&jr.enable(this)):!Ve&&we?(this.select(Oe),this.updateUIClasses({mouse:V.MOVE})):Ve||we||(Se.forEach(function(Ft){return le.doRender(Ft)}),this.setSelected(Oe),this.updateUIClasses({mouse:V.MOVE})),this.doRender(Oe)},lr.onMouseDown=function(L,G){return Zt(G)?this.startOnActiveFeature(L,G):this.drawConfig.boxSelect&&at(G)?this.startBoxSelect(L,G):void 0},lr.startBoxSelect=function(L,G){this.stopExtendedInteractions(L),this.map.dragPan.disable(),L.boxSelectStartLocation=Xn(G.originalEvent,this.map.getContainer()),L.canBoxSelect=!0},lr.onTouchStart=function(L,G){if(Zt(G))return this.startOnActiveFeature(L,G)},lr.onDrag=function(L,G){return L.canDragMove?this.dragMove(L,G):this.drawConfig.boxSelect&&L.canBoxSelect?this.whileBoxSelect(L,G):void 0},lr.whileBoxSelect=function(L,G){L.boxSelecting=!0,this.updateUIClasses({mouse:V.ADD}),L.boxSelectElement||(L.boxSelectElement=document.createElement("div"),L.boxSelectElement.classList.add(D.BOX_SELECT),this.map.getContainer().appendChild(L.boxSelectElement));var le=Xn(G.originalEvent,this.map.getContainer()),we=Math.min(L.boxSelectStartLocation.x,le.x),Se=Math.max(L.boxSelectStartLocation.x,le.x),Oe=Math.min(L.boxSelectStartLocation.y,le.y),Ve=Math.max(L.boxSelectStartLocation.y,le.y),Ft="translate("+we+"px, "+Oe+"px)";L.boxSelectElement.style.transform=Ft,L.boxSelectElement.style.WebkitTransform=Ft,L.boxSelectElement.style.width=Se-we+"px",L.boxSelectElement.style.height=Ve-Oe+"px"},lr.dragMove=function(L,G){L.dragMoving=!0,G.originalEvent.stopPropagation();var le={lng:G.lngLat.lng-L.dragMoveLocation.lng,lat:G.lngLat.lat-L.dragMoveLocation.lat};Ta(this.getSelected(),le),L.dragMoveLocation=G.lngLat},lr.onTouchEnd=lr.onMouseUp=function(L,G){var le=this;if(L.dragMoving)this.fireUpdate();else if(L.boxSelecting){var we=[L.boxSelectStartLocation,Xn(G.originalEvent,this.map.getContainer())],Se=this.featuresAt(null,we,"click"),Oe=this.getUniqueIds(Se).filter(function(Ve){return!le.isSelected(Ve)});Oe.length&&(this.select(Oe),Oe.forEach(function(Ve){return le.doRender(Ve)}),this.updateUIClasses({mouse:V.MOVE}))}this.stopExtendedInteractions(L)},lr.toDisplayFeatures=function(L,G,le){G.properties.active=this.isSelected(G.properties.id)?pe.ACTIVE:pe.INACTIVE,le(G),this.fireActionable(),G.properties.active===pe.ACTIVE&&G.geometry.type!==W.POINT&&yo(G).forEach(le)},lr.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},lr.onCombineFeatures=function(){var L=this.getSelected();if(!(L.length===0||L.length<2)){for(var G=[],le=[],we=L[0].type.replace("Multi",""),Se=0;Se<L.length;Se++){var Oe=L[Se];if(Oe.type.replace("Multi","")!==we)return;Oe.type.includes("Multi")?Oe.getCoordinates().forEach(function(Ft){G.push(Ft)}):G.push(Oe.getCoordinates()),le.push(Oe.toGeoJSON())}if(le.length>1){var Ve=this.newFeature({type:W.FEATURE,properties:le[0].properties,geometry:{type:"Multi"+we,coordinates:G}});this.addFeature(Ve),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([Ve.id]),this.map.fire($.COMBINE_FEATURES,{createdFeatures:[Ve.toGeoJSON()],deletedFeatures:le})}this.fireActionable()}},lr.onUncombineFeatures=function(){var L=this,G=this.getSelected();if(G.length!==0){for(var le=[],we=[],Se=function(Ve){var Ft=G[Ve];L.isInstanceOf("MultiFeature",Ft)&&(Ft.getFeatures().forEach(function(Nt){L.addFeature(Nt),Nt.properties=Ft.properties,le.push(Nt.toGeoJSON()),L.select([Nt.id])}),L.deleteFeature(Ft.id,{silent:!0}),we.push(Ft.toGeoJSON()))},Oe=0;Oe<G.length;Oe++)Se(Oe);le.length>1&&this.map.fire($.UNCOMBINE_FEATURES,{createdFeatures:le,deletedFeatures:we}),this.fireActionable()}};var yu=Wt(ye.VERTEX),ro=Wt(ye.MIDPOINT),os={fireUpdate:function(){this.map.fire($.UPDATE,{action:ne.CHANGE_COORDINATES,features:this.getSelected().map(function(L){return L.toGeoJSON()})})},fireActionable:function(L){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:L.selectedCoordPaths.length>0})},startDragging:function(L,G){this.map.dragPan.disable(),L.canDragMove=!0,L.dragMoveLocation=G.lngLat},stopDragging:function(L){this.map.dragPan.enable(),L.dragMoving=!1,L.canDragMove=!1,L.dragMoveLocation=null},onVertex:function(L,G){this.startDragging(L,G);var le=G.featureTarget.properties,we=L.selectedCoordPaths.indexOf(le.coord_path);qn(G)||we!==-1?qn(G)&&we===-1&&L.selectedCoordPaths.push(le.coord_path):L.selectedCoordPaths=[le.coord_path];var Se=this.pathsToCoordinates(L.featureId,L.selectedCoordPaths);this.setSelectedCoordinates(Se)},onMidpoint:function(L,G){this.startDragging(L,G);var le=G.featureTarget.properties;L.feature.addCoordinate(le.coord_path,le.lng,le.lat),this.fireUpdate(),L.selectedCoordPaths=[le.coord_path]},pathsToCoordinates:function(L,G){return G.map(function(le){return{feature_id:L,coord_path:le}})},onFeature:function(L,G){L.selectedCoordPaths.length===0?this.startDragging(L,G):this.stopDragging(L)},dragFeature:function(L,G,le){Ta(this.getSelected(),le),L.dragMoveLocation=G.lngLat},dragVertex:function(L,G,le){for(var we=L.selectedCoordPaths.map(function(Ft){return L.feature.getCoordinate(Ft)}),Se=Dl(we.map(function(Ft){return{type:W.FEATURE,properties:{},geometry:{type:W.POINT,coordinates:Ft}}}),le),Oe=0;Oe<we.length;Oe++){var Ve=we[Oe];L.feature.updateCoordinate(L.selectedCoordPaths[Oe],Ve[0]+Se.lng,Ve[1]+Se.lat)}},clickNoTarget:function(){this.changeMode(J.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(J.SIMPLE_SELECT)},clickActiveFeature:function(L){L.selectedCoordPaths=[],this.clearSelectedCoordinates(),L.feature.changed()},onSetup:function(L){var G=L.featureId,le=this.getFeature(G);if(!le)throw new Error("You must provide a featureId to enter direct_select mode");if(le.type===W.POINT)throw new TypeError("direct_select mode doesn't handle point features");var we={featureId:G,feature:le,dragMoveLocation:L.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:L.coordPath?[L.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(G,we.selectedCoordPaths)),this.setSelected(G),jr.disable(this),this.setActionableState({trash:!0}),we},onStop:function(){jr.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(L,G,le){L.featureId===G.properties.id?(G.properties.active=pe.ACTIVE,le(G),yo(G,{map:this.map,midpoints:!0,selectedPaths:L.selectedCoordPaths}).forEach(le)):(G.properties.active=pe.INACTIVE,le(G)),this.fireActionable(L)},onTrash:function(L){L.selectedCoordPaths.sort(function(G,le){return le.localeCompare(G,"en",{numeric:!0})}).forEach(function(G){return L.feature.removeCoordinate(G)}),this.fireUpdate(),L.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(L),L.feature.isValid()===!1&&(this.deleteFeature([L.featureId]),this.changeMode(J.SIMPLE_SELECT,{}))},onMouseMove:function(L,G){var le=Zt(G),we=yu(G),Se=ro(G),Oe=L.selectedCoordPaths.length===0;return le&&Oe||we&&!Oe?this.updateUIClasses({mouse:V.MOVE}):this.updateUIClasses({mouse:V.NONE}),(we||le||Se)&&L.dragMoving&&this.fireUpdate(),this.stopDragging(L),!0},onMouseOut:function(L){return L.dragMoving&&this.fireUpdate(),!0}};os.onTouchStart=os.onMouseDown=function(L,G){return yu(G)?this.onVertex(L,G):Zt(G)?this.onFeature(L,G):ro(G)?this.onMidpoint(L,G):void 0},os.onDrag=function(L,G){if(L.canDragMove===!0){L.dragMoving=!0,G.originalEvent.stopPropagation();var le={lng:G.lngLat.lng-L.dragMoveLocation.lng,lat:G.lngLat.lat-L.dragMoveLocation.lat};L.selectedCoordPaths.length>0?this.dragVertex(L,G,le):this.dragFeature(L,G,le),L.dragMoveLocation=G.lngLat}},os.onClick=function(L,G){return qt(G)?this.clickNoTarget(L,G):Zt(G)?this.clickActiveFeature(L,G):Gt(G)?this.clickInactive(L,G):void this.stopDragging(L)},os.onTap=function(L,G){return qt(G)?this.clickNoTarget(L,G):Zt(G)?this.clickActiveFeature(L,G):Gt(G)?this.clickInactive(L,G):void 0},os.onTouchEnd=os.onMouseUp=function(L){L.dragMoving&&this.fireUpdate(),this.stopDragging(L)};var oo={};function xo(L,G){return!!L.lngLat&&L.lngLat.lng===G[0]&&L.lngLat.lat===G[1]}oo.onSetup=function(){var L=this.newFeature({type:W.FEATURE,properties:{},geometry:{type:W.POINT,coordinates:[]}});return this.addFeature(L),this.clearSelectedFeatures(),this.updateUIClasses({mouse:V.ADD}),this.activateUIButton(X.POINT),this.setActionableState({trash:!0}),{point:L}},oo.stopDrawingAndRemove=function(L){this.deleteFeature([L.point.id],{silent:!0}),this.changeMode(J.SIMPLE_SELECT)},oo.onTap=oo.onClick=function(L,G){this.updateUIClasses({mouse:V.MOVE}),L.point.updateCoordinate("",G.lngLat.lng,G.lngLat.lat),this.map.fire($.CREATE,{features:[L.point.toGeoJSON()]}),this.changeMode(J.SIMPLE_SELECT,{featureIds:[L.point.id]})},oo.onStop=function(L){this.activateUIButton(),L.point.getCoordinate().length||this.deleteFeature([L.point.id],{silent:!0})},oo.toDisplayFeatures=function(L,G,le){var we=G.properties.id===L.point.id;if(G.properties.active=we?pe.ACTIVE:pe.INACTIVE,!we)return le(G)},oo.onTrash=oo.stopDrawingAndRemove,oo.onKeyUp=function(L,G){if(_n(G)||Tn(G))return this.stopDrawingAndRemove(L,G)};var Po={onSetup:function(){var L=this.newFeature({type:W.FEATURE,properties:{},geometry:{type:W.POLYGON,coordinates:[[]]}});return this.addFeature(L),this.clearSelectedFeatures(),jr.disable(this),this.updateUIClasses({mouse:V.ADD}),this.activateUIButton(X.POLYGON),this.setActionableState({trash:!0}),{polygon:L,currentVertexPosition:0}},clickAnywhere:function(L,G){if(L.currentVertexPosition>0&&xo(G,L.polygon.coordinates[0][L.currentVertexPosition-1]))return this.changeMode(J.SIMPLE_SELECT,{featureIds:[L.polygon.id]});this.updateUIClasses({mouse:V.ADD}),L.polygon.updateCoordinate("0."+L.currentVertexPosition,G.lngLat.lng,G.lngLat.lat),L.currentVertexPosition++,L.polygon.updateCoordinate("0."+L.currentVertexPosition,G.lngLat.lng,G.lngLat.lat)},clickOnVertex:function(L){return this.changeMode(J.SIMPLE_SELECT,{featureIds:[L.polygon.id]})},onMouseMove:function(L,G){L.polygon.updateCoordinate("0."+L.currentVertexPosition,G.lngLat.lng,G.lngLat.lat),Bi(G)&&this.updateUIClasses({mouse:V.POINTER})}};Po.onTap=Po.onClick=function(L,G){return Bi(G)?this.clickOnVertex(L,G):this.clickAnywhere(L,G)},Po.onKeyUp=function(L,G){_n(G)?(this.deleteFeature([L.polygon.id],{silent:!0}),this.changeMode(J.SIMPLE_SELECT)):Tn(G)&&this.changeMode(J.SIMPLE_SELECT,{featureIds:[L.polygon.id]})},Po.onStop=function(L){this.updateUIClasses({mouse:V.NONE}),jr.enable(this),this.activateUIButton(),this.getFeature(L.polygon.id)!==void 0&&(L.polygon.removeCoordinate("0."+L.currentVertexPosition),L.polygon.isValid()?this.map.fire($.CREATE,{features:[L.polygon.toGeoJSON()]}):(this.deleteFeature([L.polygon.id],{silent:!0}),this.changeMode(J.SIMPLE_SELECT,{},{silent:!0})))},Po.toDisplayFeatures=function(L,G,le){var we=G.properties.id===L.polygon.id;if(G.properties.active=we?pe.ACTIVE:pe.INACTIVE,!we)return le(G);if(G.geometry.coordinates.length!==0){var Se=G.geometry.coordinates[0].length;if(!(Se<3)){if(G.properties.meta=ye.FEATURE,le(Zr(L.polygon.id,G.geometry.coordinates[0][0],"0.0",!1)),Se>3){var Oe=G.geometry.coordinates[0].length-3;le(Zr(L.polygon.id,G.geometry.coordinates[0][Oe],"0."+Oe,!1))}if(Se<=4){var Ve=[[G.geometry.coordinates[0][0][0],G.geometry.coordinates[0][0][1]],[G.geometry.coordinates[0][1][0],G.geometry.coordinates[0][1][1]]];if(le({type:W.FEATURE,properties:G.properties,geometry:{coordinates:Ve,type:W.LINE_STRING}}),Se===3)return}return le(G)}}},Po.onTrash=function(L){this.deleteFeature([L.polygon.id],{silent:!0}),this.changeMode(J.SIMPLE_SELECT)};var so={onSetup:function(L){var G,le,we=(L=L||{}).featureId,Se="forward";if(we){if(!(G=this.getFeature(we)))throw new Error("Could not find a feature with the provided featureId");var Oe=L.from;if(Oe&&Oe.type==="Feature"&&Oe.geometry&&Oe.geometry.type==="Point"&&(Oe=Oe.geometry),Oe&&Oe.type==="Point"&&Oe.coordinates&&Oe.coordinates.length===2&&(Oe=Oe.coordinates),!Oe||!Array.isArray(Oe))throw new Error("Please use the `from` property to indicate which point to continue the line from");var Ve=G.coordinates.length-1;if(G.coordinates[Ve][0]===Oe[0]&&G.coordinates[Ve][1]===Oe[1])le=Ve+1,G.addCoordinate.apply(G,[le].concat(G.coordinates[Ve]));else{if(G.coordinates[0][0]!==Oe[0]||G.coordinates[0][1]!==Oe[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");Se="backwards",le=0,G.addCoordinate.apply(G,[le].concat(G.coordinates[0]))}}else G=this.newFeature({type:W.FEATURE,properties:{},geometry:{type:W.LINE_STRING,coordinates:[]}}),le=0,this.addFeature(G);return this.clearSelectedFeatures(),jr.disable(this),this.updateUIClasses({mouse:V.ADD}),this.activateUIButton(X.LINE),this.setActionableState({trash:!0}),{line:G,currentVertexPosition:le,direction:Se}},clickAnywhere:function(L,G){if(L.currentVertexPosition>0&&xo(G,L.line.coordinates[L.currentVertexPosition-1])||L.direction==="backwards"&&xo(G,L.line.coordinates[L.currentVertexPosition+1]))return this.changeMode(J.SIMPLE_SELECT,{featureIds:[L.line.id]});this.updateUIClasses({mouse:V.ADD}),L.line.updateCoordinate(L.currentVertexPosition,G.lngLat.lng,G.lngLat.lat),L.direction==="forward"?(L.currentVertexPosition++,L.line.updateCoordinate(L.currentVertexPosition,G.lngLat.lng,G.lngLat.lat)):L.line.addCoordinate(0,G.lngLat.lng,G.lngLat.lat)},clickOnVertex:function(L){return this.changeMode(J.SIMPLE_SELECT,{featureIds:[L.line.id]})},onMouseMove:function(L,G){L.line.updateCoordinate(L.currentVertexPosition,G.lngLat.lng,G.lngLat.lat),Bi(G)&&this.updateUIClasses({mouse:V.POINTER})}};so.onTap=so.onClick=function(L,G){if(Bi(G))return this.clickOnVertex(L,G);this.clickAnywhere(L,G)},so.onKeyUp=function(L,G){Tn(G)?this.changeMode(J.SIMPLE_SELECT,{featureIds:[L.line.id]}):_n(G)&&(this.deleteFeature([L.line.id],{silent:!0}),this.changeMode(J.SIMPLE_SELECT))},so.onStop=function(L){jr.enable(this),this.activateUIButton(),this.getFeature(L.line.id)!==void 0&&(L.line.removeCoordinate(""+L.currentVertexPosition),L.line.isValid()?this.map.fire($.CREATE,{features:[L.line.toGeoJSON()]}):(this.deleteFeature([L.line.id],{silent:!0}),this.changeMode(J.SIMPLE_SELECT,{},{silent:!0})))},so.onTrash=function(L){this.deleteFeature([L.line.id],{silent:!0}),this.changeMode(J.SIMPLE_SELECT)},so.toDisplayFeatures=function(L,G,le){var we=G.properties.id===L.line.id;if(G.properties.active=we?pe.ACTIVE:pe.INACTIVE,!we)return le(G);G.geometry.coordinates.length<2||(G.properties.meta=ye.FEATURE,le(Zr(L.line.id,G.geometry.coordinates[L.direction==="forward"?G.geometry.coordinates.length-2:1],""+(L.direction==="forward"?G.geometry.coordinates.length-2:1),!1)),le(G))};var Be={simple_select:lr,direct_select:os,draw_point:oo,draw_polygon:Po,draw_line_string:so},ri={defaultMode:J.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Ut,modes:Be,controls:{},userProperties:!1},vs={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},ss={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function dr(L,G){return L.map(function(le){return le.source?le:Ee(le,{id:le.id+"."+G,source:G==="hot"?F.HOT:F.COLD})})}var as={exports:{}};(function(L,G){var le="__lodash_hash_undefined__",we=9007199254740991,Se="[object Arguments]",Oe="[object Array]",Ve="[object Boolean]",Ft="[object Date]",Nt="[object Error]",Lt="[object Function]",di="[object Map]",Qt="[object Number]",Xi="[object Object]",Gn="[object Promise]",Ki="[object RegExp]",cr="[object Set]",At="[object String]",wi="[object Symbol]",Cn="[object WeakMap]",Or="[object ArrayBuffer]",Sn="[object DataView]",Ln=/^\[object .+?Constructor\]$/,xu=/^(?:0|[1-9]\d*)$/,On={};On["[object Float32Array]"]=On["[object Float64Array]"]=On["[object Int8Array]"]=On["[object Int16Array]"]=On["[object Int32Array]"]=On["[object Uint8Array]"]=On["[object Uint8ClampedArray]"]=On["[object Uint16Array]"]=On["[object Uint32Array]"]=!0,On[Se]=On[Oe]=On[Or]=On[Ve]=On[Sn]=On[Ft]=On[Nt]=On[Lt]=On[di]=On[Qt]=On[Xi]=On[Ki]=On[cr]=On[At]=On[Cn]=!1;var ao=typeof vh=="object"&&vh&&vh.Object===Object&&vh,Uo=typeof self=="object"&&self&&self.Object===Object&&self,xs=ao||Uo||Function("return this")(),Ma=G&&!G.nodeType&&G,xr=Ma&&L&&!L.nodeType&&L,el=xr&&xr.exports===Ma,Ll=el&&ao.process,Ea=function(){try{return Ll&&Ll.binding&&Ll.binding("util")}catch{}}(),pr=Ea&&Ea.isTypedArray;function bu(Ue,ht){for(var ai=-1,Ci=Ue==null?0:Ue.length;++ai<Ci;)if(ht(Ue[ai],ai,Ue))return!0;return!1}function wu(Ue){var ht=-1,ai=Array(Ue.size);return Ue.forEach(function(Ci,Fn){ai[++ht]=[Fn,Ci]}),ai}function ls(Ue){var ht=-1,ai=Array(Ue.size);return Ue.forEach(function(Ci){ai[++ht]=Ci}),ai}var tl,il,ln,ad=Array.prototype,Ic=Function.prototype,cs=Object.prototype,Cc=xs["__core-js_shared__"],Pc=Ic.toString,Jr=cs.hasOwnProperty,Tu=(tl=/[^.]+$/.exec(Cc&&Cc.keys&&Cc.keys.IE_PROTO||""))?"Symbol(src)_1."+tl:"",jo=cs.toString,Ol=RegExp("^"+Pc.call(Jr).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),kc=el?xs.Buffer:void 0,Rl=xs.Symbol,zl=xs.Uint8Array,zs=cs.propertyIsEnumerable,ta=ad.splice,ia=Rl?Rl.toStringTag:void 0,na=Object.getOwnPropertySymbols,Su=kc?kc.isBuffer:void 0,Fs=(il=Object.keys,ln=Object,function(Ue){return il(ln(Ue))}),Yi=ra(xs,"DataView"),Fl=ra(xs,"Map"),Mu=ra(xs,"Promise"),Eu=ra(xs,"Set"),Bl=ra(xs,"WeakMap"),Nl=ra(Object,"create"),Dc=Us(Yi),Au=Us(Fl),Iu=Us(Mu),Aa=Us(Eu),Cu=Us(Bl),us=Rl?Rl.prototype:void 0,nl=us?us.valueOf:void 0;function Bs(Ue){var ht=-1,ai=Ue==null?0:Ue.length;for(this.clear();++ht<ai;){var Ci=Ue[ht];this.set(Ci[0],Ci[1])}}function hs(Ue){var ht=-1,ai=Ue==null?0:Ue.length;for(this.clear();++ht<ai;){var Ci=Ue[ht];this.set(Ci[0],Ci[1])}}function bs(Ue){var ht=-1,ai=Ue==null?0:Ue.length;for(this.clear();++ht<ai;){var Ci=Ue[ht];this.set(Ci[0],Ci[1])}}function Ia(Ue){var ht=-1,ai=Ue==null?0:Ue.length;for(this.__data__=new bs;++ht<ai;)this.add(Ue[ht])}function Mt(Ue){var ht=this.__data__=new hs(Ue);this.size=ht.size}function Fh(Ue,ht){var ai=jl(Ue),Ci=!ai&&cd(Ue),Fn=!ai&&!Ci&&Du(Ue),ji=!ai&&!Ci&&!Fn&&Ru(Ue),nr=ai||Ci||Fn||ji,rr=nr?function(mr,Go){for(var Ho=-1,Gr=Array(mr);++Ho<mr;)Gr[Ho]=Go(Ho);return Gr}(Ue.length,String):[],bo=rr.length;for(var Rr in Ue)!ht&&!Jr.call(Ue,Rr)||nr&&(Rr=="length"||Fn&&(Rr=="offset"||Rr=="parent")||ji&&(Rr=="buffer"||Rr=="byteLength"||Rr=="byteOffset")||ku(Rr,bo))||rr.push(Rr);return rr}function Ca(Ue,ht){for(var ai=Ue.length;ai--;)if(Bh(Ue[ai][0],ht))return ai;return-1}function Pa(Ue){return Ue==null?Ue===void 0?"[object Undefined]":"[object Null]":ia&&ia in Object(Ue)?function(ht){var ai=Jr.call(ht,ia),Ci=ht[ia];try{ht[ia]=void 0;var Fn=!0}catch{}var ji=jo.call(ht);return Fn&&(ai?ht[ia]=Ci:delete ht[ia]),ji}(Ue):function(ht){return jo.call(ht)}(Ue)}function Pu(Ue){return Hl(Ue)&&Pa(Ue)==Se}function Vl(Ue,ht,ai,Ci,Fn){return Ue===ht||(Ue==null||ht==null||!Hl(Ue)&&!Hl(ht)?Ue!=Ue&&ht!=ht:function(ji,nr,rr,bo,Rr,mr){var Go=jl(ji),Ho=jl(nr),Gr=Go?Oe:Ts(ji),fs=Ho?Oe:Ts(nr),oa=(Gr=Gr==Se?Xi:Gr)==Xi,Gi=(fs=fs==Se?Xi:fs)==Xi,js=Gr==fs;if(js&&Du(ji)){if(!Du(nr))return!1;Go=!0,oa=!1}if(js&&!oa)return mr||(mr=new Mt),Go||Ru(ji)?Vs(ji,nr,rr,bo,Rr,mr):function(Pn,Bn,Rc,sa,zu,wo,ds){switch(Rc){case Sn:if(Pn.byteLength!=Bn.byteLength||Pn.byteOffset!=Bn.byteOffset)return!1;Pn=Pn.buffer,Bn=Bn.buffer;case Or:return!(Pn.byteLength!=Bn.byteLength||!wo(new zl(Pn),new zl(Bn)));case Ve:case Ft:case Qt:return Bh(+Pn,+Bn);case Nt:return Pn.name==Bn.name&&Pn.message==Bn.message;case Ki:case At:return Pn==Bn+"";case di:var Ss=wu;case cr:var Da=1&sa;if(Ss||(Ss=ls),Pn.size!=Bn.size&&!Da)return!1;var Wl=ds.get(Pn);if(Wl)return Wl==Bn;sa|=2,ds.set(Pn,Bn);var Wo=Vs(Ss(Pn),Ss(Bn),sa,zu,wo,ds);return ds.delete(Pn),Wo;case wi:if(nl)return nl.call(Pn)==nl.call(Bn)}return!1}(ji,nr,Gr,rr,bo,Rr,mr);if(!(1&rr)){var Gs=oa&&Jr.call(ji,"__wrapped__"),rl=Gi&&Jr.call(nr,"__wrapped__");if(Gs||rl){var ka=Gs?ji.value():ji,Nh=rl?nr.value():nr;return mr||(mr=new Mt),Rr(ka,Nh,rr,bo,mr)}}return js?(mr||(mr=new Mt),function(Pn,Bn,Rc,sa,zu,wo){var ds=1&Rc,Ss=Ul(Pn),Da=Ss.length,Wl=Ul(Bn).length;if(Da!=Wl&&!ds)return!1;for(var Wo=Da;Wo--;){var aa=Ss[Wo];if(!(ds?aa in Bn:Jr.call(Bn,aa)))return!1}var La=wo.get(Pn);if(La&&wo.get(Bn))return La==Bn;var ps=!0;wo.set(Pn,Bn),wo.set(Bn,Pn);for(var zc=ds;++Wo<Da;){var Oa=Pn[aa=Ss[Wo]],ko=Bn[aa];if(sa)var qo=ds?sa(ko,Oa,aa,Bn,Pn,wo):sa(Oa,ko,aa,Pn,Bn,wo);if(!(qo===void 0?Oa===ko||zu(Oa,ko,Rc,sa,wo):qo)){ps=!1;break}zc||(zc=aa=="constructor")}if(ps&&!zc){var ms=Pn.constructor,ql=Bn.constructor;ms==ql||!("constructor"in Pn)||!("constructor"in Bn)||typeof ms=="function"&&ms instanceof ms&&typeof ql=="function"&&ql instanceof ql||(ps=!1)}return wo.delete(Pn),wo.delete(Bn),ps}(ji,nr,rr,bo,Rr,mr)):!1}(Ue,ht,ai,Ci,Vl,Fn))}function Ns(Ue){return!(!Gl(Ue)||function(ht){return!!Tu&&Tu in ht}(Ue))&&(Lu(Ue)?Ol:Ln).test(Us(Ue))}function Lc(Ue){if(ai=(ht=Ue)&&ht.constructor,Ci=typeof ai=="function"&&ai.prototype||cs,ht!==Ci)return Fs(Ue);var ht,ai,Ci,Fn=[];for(var ji in Object(Ue))Jr.call(Ue,ji)&&ji!="constructor"&&Fn.push(ji);return Fn}function Vs(Ue,ht,ai,Ci,Fn,ji){var nr=1&ai,rr=Ue.length,bo=ht.length;if(rr!=bo&&!(nr&&bo>rr))return!1;var Rr=ji.get(Ue);if(Rr&&ji.get(ht))return Rr==ht;var mr=-1,Go=!0,Ho=2&ai?new Ia:void 0;for(ji.set(Ue,ht),ji.set(ht,Ue);++mr<rr;){var Gr=Ue[mr],fs=ht[mr];if(Ci)var oa=nr?Ci(fs,Gr,mr,ht,Ue,ji):Ci(Gr,fs,mr,Ue,ht,ji);if(oa!==void 0){if(oa)continue;Go=!1;break}if(Ho){if(!bu(ht,function(Gi,js){if(Gs=js,!Ho.has(Gs)&&(Gr===Gi||Fn(Gr,Gi,ai,Ci,ji)))return Ho.push(js);var Gs})){Go=!1;break}}else if(Gr!==fs&&!Fn(Gr,fs,ai,Ci,ji)){Go=!1;break}}return ji.delete(Ue),ji.delete(ht),Go}function Ul(Ue){return function(ht,ai,Ci){var Fn=ai(ht);return jl(ht)?Fn:function(ji,nr){for(var rr=-1,bo=nr.length,Rr=ji.length;++rr<bo;)ji[Rr+rr]=nr[rr];return ji}(Fn,Ci(ht))}(Ue,Oc,ld)}function ws(Ue,ht){var ai,Ci,Fn=Ue.__data__;return((Ci=typeof(ai=ht))=="string"||Ci=="number"||Ci=="symbol"||Ci=="boolean"?ai!=="__proto__":ai===null)?Fn[typeof ht=="string"?"string":"hash"]:Fn.map}function ra(Ue,ht){var ai=function(Ci,Fn){return Ci==null?void 0:Ci[Fn]}(Ue,ht);return Ns(ai)?ai:void 0}Bs.prototype.clear=function(){this.__data__=Nl?Nl(null):{},this.size=0},Bs.prototype.delete=function(Ue){var ht=this.has(Ue)&&delete this.__data__[Ue];return this.size-=ht?1:0,ht},Bs.prototype.get=function(Ue){var ht=this.__data__;if(Nl){var ai=ht[Ue];return ai===le?void 0:ai}return Jr.call(ht,Ue)?ht[Ue]:void 0},Bs.prototype.has=function(Ue){var ht=this.__data__;return Nl?ht[Ue]!==void 0:Jr.call(ht,Ue)},Bs.prototype.set=function(Ue,ht){var ai=this.__data__;return this.size+=this.has(Ue)?0:1,ai[Ue]=Nl&&ht===void 0?le:ht,this},hs.prototype.clear=function(){this.__data__=[],this.size=0},hs.prototype.delete=function(Ue){var ht=this.__data__,ai=Ca(ht,Ue);return!(ai<0)&&(ai==ht.length-1?ht.pop():ta.call(ht,ai,1),--this.size,!0)},hs.prototype.get=function(Ue){var ht=this.__data__,ai=Ca(ht,Ue);return ai<0?void 0:ht[ai][1]},hs.prototype.has=function(Ue){return Ca(this.__data__,Ue)>-1},hs.prototype.set=function(Ue,ht){var ai=this.__data__,Ci=Ca(ai,Ue);return Ci<0?(++this.size,ai.push([Ue,ht])):ai[Ci][1]=ht,this},bs.prototype.clear=function(){this.size=0,this.__data__={hash:new Bs,map:new(Fl||hs),string:new Bs}},bs.prototype.delete=function(Ue){var ht=ws(this,Ue).delete(Ue);return this.size-=ht?1:0,ht},bs.prototype.get=function(Ue){return ws(this,Ue).get(Ue)},bs.prototype.has=function(Ue){return ws(this,Ue).has(Ue)},bs.prototype.set=function(Ue,ht){var ai=ws(this,Ue),Ci=ai.size;return ai.set(Ue,ht),this.size+=ai.size==Ci?0:1,this},Ia.prototype.add=Ia.prototype.push=function(Ue){return this.__data__.set(Ue,le),this},Ia.prototype.has=function(Ue){return this.__data__.has(Ue)},Mt.prototype.clear=function(){this.__data__=new hs,this.size=0},Mt.prototype.delete=function(Ue){var ht=this.__data__,ai=ht.delete(Ue);return this.size=ht.size,ai},Mt.prototype.get=function(Ue){return this.__data__.get(Ue)},Mt.prototype.has=function(Ue){return this.__data__.has(Ue)},Mt.prototype.set=function(Ue,ht){var ai=this.__data__;if(ai instanceof hs){var Ci=ai.__data__;if(!Fl||Ci.length<199)return Ci.push([Ue,ht]),this.size=++ai.size,this;ai=this.__data__=new bs(Ci)}return ai.set(Ue,ht),this.size=ai.size,this};var ld=na?function(Ue){return Ue==null?[]:(Ue=Object(Ue),function(ht,ai){for(var Ci=-1,Fn=ht==null?0:ht.length,ji=0,nr=[];++Ci<Fn;){var rr=ht[Ci];ai(rr,Ci,ht)&&(nr[ji++]=rr)}return nr}(na(Ue),function(ht){return zs.call(Ue,ht)}))}:function(){return[]},Ts=Pa;function ku(Ue,ht){return!!(ht=ht??we)&&(typeof Ue=="number"||xu.test(Ue))&&Ue>-1&&Ue%1==0&&Ue<ht}function Us(Ue){if(Ue!=null){try{return Pc.call(Ue)}catch{}try{return Ue+""}catch{}}return""}function Bh(Ue,ht){return Ue===ht||Ue!=Ue&&ht!=ht}(Yi&&Ts(new Yi(new ArrayBuffer(1)))!=Sn||Fl&&Ts(new Fl)!=di||Mu&&Ts(Mu.resolve())!=Gn||Eu&&Ts(new Eu)!=cr||Bl&&Ts(new Bl)!=Cn)&&(Ts=function(Ue){var ht=Pa(Ue),ai=ht==Xi?Ue.constructor:void 0,Ci=ai?Us(ai):"";if(Ci)switch(Ci){case Dc:return Sn;case Au:return di;case Iu:return Gn;case Aa:return cr;case Cu:return Cn}return ht});var cd=Pu(function(){return arguments}())?Pu:function(Ue){return Hl(Ue)&&Jr.call(Ue,"callee")&&!zs.call(Ue,"callee")},jl=Array.isArray,Du=Su||function(){return!1};function Lu(Ue){if(!Gl(Ue))return!1;var ht=Pa(Ue);return ht==Lt||ht=="[object GeneratorFunction]"||ht=="[object AsyncFunction]"||ht=="[object Proxy]"}function Ou(Ue){return typeof Ue=="number"&&Ue>-1&&Ue%1==0&&Ue<=we}function Gl(Ue){var ht=typeof Ue;return Ue!=null&&(ht=="object"||ht=="function")}function Hl(Ue){return Ue!=null&&typeof Ue=="object"}var Ru=pr?function(Ue){return function(ht){return Ue(ht)}}(pr):function(Ue){return Hl(Ue)&&Ou(Ue.length)&&!!On[Pa(Ue)]};function Oc(Ue){return(ht=Ue)!=null&&Ou(ht.length)&&!Lu(ht)?Fh(Ue):Lc(Ue);var ht}L.exports=function(Ue,ht){return Vl(Ue,ht)}})(as,as.exports);var zh=c(as.exports);function Vo(L,G){return L.length===G.length&&JSON.stringify(L.map(function(le){return le}).sort())===JSON.stringify(G.map(function(le){return le}).sort())}var vu={Polygon:Si,LineString:zi,Point:rt,MultiPolygon:hn,MultiLineString:hn,MultiPoint:hn},sd=Object.freeze({__proto__:null,CommonSelectors:We,constrainFeatureMovement:Dl,createMidPoint:Er,createSupplementaryPoints:yo,createVertex:Zr,doubleClickZoom:jr,euclideanDistance:Ti,featuresAt:Tt,getFeatureAtAndSetCursors:mi,isClick:Zi,isEventAtCoordinates:xo,isTap:wt,mapEventToBoundingBox:Et,ModeHandler:o,moveFeatures:Ta,sortFeatures:Ie,stringSetsAreEqual:Vo,StringSet:mt,theme:Ut,toDenseArray:cn}),Sa=function(L,G){var le={options:L=function(Se){Se===void 0&&(Se={});var Oe=Ee(Se);return Se.controls||(Oe.controls={}),Se.displayControlsDefault===!1?Oe.controls=Ee(ss,Se.controls):Oe.controls=Ee(vs,Se.controls),(Oe=Ee(ri,Oe)).styles=dr(Oe.styles,"cold").concat(dr(Oe.styles,"hot")),Oe}(L)};G=function(Se,Oe){return Oe.modes=J,Oe.getFeatureIdsAt=function(Ve){return Tt.click({point:Ve},null,Se).map(function(Ft){return Ft.properties.id})},Oe.getSelectedIds=function(){return Se.store.getSelectedIds()},Oe.getSelected=function(){return{type:W.FEATURE_COLLECTION,features:Se.store.getSelectedIds().map(function(Ve){return Se.store.get(Ve)}).map(function(Ve){return Ve.toGeoJSON()})}},Oe.getSelectedPoints=function(){return{type:W.FEATURE_COLLECTION,features:Se.store.getSelectedCoordinates().map(function(Ve){return{type:W.FEATURE,properties:{},geometry:{type:W.POINT,coordinates:Ve.coordinates}}})}},Oe.set=function(Ve){if(Ve.type===void 0||Ve.type!==W.FEATURE_COLLECTION||!Array.isArray(Ve.features))throw new Error("Invalid FeatureCollection");var Ft=Se.store.createRenderBatch(),Nt=Se.store.getAllIds().slice(),Lt=Oe.add(Ve),di=new mt(Lt);return(Nt=Nt.filter(function(Qt){return!di.has(Qt)})).length&&Oe.delete(Nt),Ft(),Lt},Oe.add=function(Ve){var Ft=JSON.parse(JSON.stringify(xt(Ve))).features.map(function(Nt){if(Nt.id=Nt.id||Mi(),Nt.geometry===null)throw new Error("Invalid geometry: null");if(Se.store.get(Nt.id)===void 0||Se.store.get(Nt.id).type!==Nt.geometry.type){var Lt=vu[Nt.geometry.type];if(Lt===void 0)throw new Error("Invalid geometry type: "+Nt.geometry.type+".");var di=new Lt(Se,Nt);Se.store.add(di)}else{var Qt=Se.store.get(Nt.id);Qt.properties=Nt.properties,zh(Qt.properties,Nt.properties)||Se.store.featureChanged(Qt.id),zh(Qt.getCoordinates(),Nt.geometry.coordinates)||Qt.incomingCoords(Nt.geometry.coordinates)}return Nt.id});return Se.store.render(),Ft},Oe.get=function(Ve){var Ft=Se.store.get(Ve);if(Ft)return Ft.toGeoJSON()},Oe.getAll=function(){return{type:W.FEATURE_COLLECTION,features:Se.store.getAll().map(function(Ve){return Ve.toGeoJSON()})}},Oe.delete=function(Ve){return Se.store.delete(Ve,{silent:!0}),Oe.getMode()!==J.DIRECT_SELECT||Se.store.getSelectedIds().length?Se.store.render():Se.events.changeMode(J.SIMPLE_SELECT,void 0,{silent:!0}),Oe},Oe.deleteAll=function(){return Se.store.delete(Se.store.getAllIds(),{silent:!0}),Oe.getMode()===J.DIRECT_SELECT?Se.events.changeMode(J.SIMPLE_SELECT,void 0,{silent:!0}):Se.store.render(),Oe},Oe.changeMode=function(Ve,Ft){return Ft===void 0&&(Ft={}),Ve===J.SIMPLE_SELECT&&Oe.getMode()===J.SIMPLE_SELECT?(Vo(Ft.featureIds||[],Se.store.getSelectedIds())||(Se.store.setSelected(Ft.featureIds,{silent:!0}),Se.store.render()),Oe):(Ve===J.DIRECT_SELECT&&Oe.getMode()===J.DIRECT_SELECT&&Ft.featureId===Se.store.getSelectedIds()[0]||Se.events.changeMode(Ve,Ft,{silent:!0}),Oe)},Oe.getMode=function(){return Se.events.getMode()},Oe.trash=function(){return Se.events.trash({silent:!0}),Oe},Oe.combineFeatures=function(){return Se.events.combineFeatures({silent:!0}),Oe},Oe.uncombineFeatures=function(){return Se.events.uncombineFeatures({silent:!0}),Oe},Oe.setFeatureProperty=function(Ve,Ft,Nt){return Se.store.setFeatureProperty(Ve,Ft,Nt),Oe},Oe}(le,G),le.api=G;var we=ft(le);return G.onAdd=we.onAdd,G.onRemove=we.onRemove,G.types=X,G.options=L,G};function ct(L){Sa(L,this)}return ct.modes=Be,ct.constants=tt,ct.lib=sd,ct})})(aj);function OI(n){return Object.prototype.toString.call(n)==="[object Date]"}function I1(n,i,o,c){if(typeof o=="number"||OI(o)){const h=c-o,p=(o-i)/(n.dt||1/60),g=n.opts.stiffness*h,x=n.opts.damping*p,s=(g-x)*n.inv_mass,M=(p+s)*n.dt;return Math.abs(M)<n.opts.precision&&Math.abs(h)<n.opts.precision?c:(n.settled=!1,OI(o)?new Date(o.getTime()+M):o+M)}else{if(Array.isArray(o))return o.map((h,p)=>I1(n,i[p],o[p],c[p]));if(typeof o=="object"){const h={};for(const p in o)h[p]=I1(n,i[p],o[p],c[p]);return h}else throw new Error(`Cannot spring ${typeof o} values`)}}function lj(n,i={}){const o=mm(n),{stiffness:c=.15,damping:h=.8,precision:p=.01}=i;let g,x,s,M=n,C=n,D=1,F=0,V=!1;function X(J,$={}){C=J;const ne=s={};return n==null||$.hard||W.stiffness>=1&&W.damping>=1?(V=!0,g=Zx(),M=J,o.set(n=C),Promise.resolve()):($.soft&&(F=1/(($.soft===!0?.5:+$.soft)*60),D=0),x||(g=Zx(),V=!1,x=hP(ye=>{if(V)return V=!1,x=null,!1;D=Math.min(D+F,1);const pe={inv_mass:D,opts:W,settled:!0,dt:(ye-g)*60/1e3},ke=I1(pe,M,n,C);return g=ye,M=n,o.set(n=ke),pe.settled&&(x=null),!pe.settled})),new Promise(ye=>{x.promise.then(()=>{ne===s&&ye()})}))}const W={set:X,update:(J,$)=>X(J(C,n),$),subscribe:o.subscribe,stiffness:c,damping:h,precision:p};return W}function L3(n){return n<.5?4*n*n*n:.5*Math.pow(2*n-2,3)+1}function O3(n){const i=n-1;return i*i*i+1}function dq(n){const i=Math.cos(n*Math.PI*.5);return Math.abs(i)<1e-14?1:1-i}function RI(n,i,o){const c=n.slice();return c[37]=i[o],c[39]=o,c}function zI(n){let i,o,c,h,p=(n[6]==="label"||n[7]==="label")&&FI(n);return{c(){i=Di("span"),p&&p.c(),this.h()},l(g){i=Vi(g,"SPAN",{class:!0,style:!0});var x=ot(i);p&&p.l(x),x.forEach(De),this.h()},h(){xe(i,"class","pip first"),xe(i,"style",o=n[14]+": 0%;"),Ri(i,"selected",n[18](n[0])),Ri(i,"in-range",n[17](n[0]))},m(g,x){Ai(g,i,x),p&&p.m(i,null),c||(h=[Pt(i,"pointerdown",n[30]),Pt(i,"pointerup",n[31])],c=!0)},p(g,x){g[6]==="label"||g[7]==="label"?p?p.p(g,x):(p=FI(g),p.c(),p.m(i,null)):p&&(p.d(1),p=null),x[0]&16384&&o!==(o=g[14]+": 0%;")&&xe(i,"style",o),x[0]&262145&&Ri(i,"selected",g[18](g[0])),x[0]&131073&&Ri(i,"in-range",g[17](g[0]))},d(g){g&&De(i),p&&p.d(),c=!1,Br(h)}}}function FI(n){let i,o,c,h=n[12](n[16](n[0]),0,0)+"",p,g=n[10]&&BI(n),x=n[11]&&NI(n);return{c(){i=Di("span"),g&&g.c(),o=ar(),c=new Sh(!1),p=ar(),x&&x.c(),this.h()},l(s){i=Vi(s,"SPAN",{class:!0});var M=ot(i);g&&g.l(M),o=ar(),c=Oy(M,!1),p=ar(),x&&x.l(M),M.forEach(De),this.h()},h(){c.a=p,xe(i,"class","pipVal")},m(s,M){Ai(s,i,M),g&&g.m(i,null),it(i,o),c.m(h,i),it(i,p),x&&x.m(i,null)},p(s,M){s[10]?g?g.p(s,M):(g=BI(s),g.c(),g.m(i,o)):g&&(g.d(1),g=null),M[0]&69633&&h!==(h=s[12](s[16](s[0]),0,0)+"")&&c.p(h),s[11]?x?x.p(s,M):(x=NI(s),x.c(),x.m(i,null)):x&&(x.d(1),x=null)},d(s){s&&De(i),g&&g.d(),x&&x.d()}}}function BI(n){let i,o;return{c(){i=Di("span"),o=fr(n[10]),this.h()},l(c){i=Vi(c,"SPAN",{class:!0});var h=ot(i);o=vr(h,n[10]),h.forEach(De),this.h()},h(){xe(i,"class","pipVal-prefix")},m(c,h){Ai(c,i,h),it(i,o)},p(c,h){h[0]&1024&&go(o,c[10])},d(c){c&&De(i)}}}function NI(n){let i,o;return{c(){i=Di("span"),o=fr(n[11]),this.h()},l(c){i=Vi(c,"SPAN",{class:!0});var h=ot(i);o=vr(h,n[11]),h.forEach(De),this.h()},h(){xe(i,"class","pipVal-suffix")},m(c,h){Ai(c,i,h),it(i,o)},p(c,h){h[0]&2048&&go(o,c[11])},d(c){c&&De(i)}}}function VI(n){let i,o=So(Array(n[20]+1)),c=[];for(let h=0;h<o.length;h+=1)c[h]=WI(RI(n,o,h));return{c(){for(let h=0;h<c.length;h+=1)c[h].c();i=ar()},l(h){for(let p=0;p<c.length;p+=1)c[p].l(h);i=ar()},m(h,p){for(let g=0;g<c.length;g+=1)c[g]&&c[g].m(h,p);Ai(h,i,p)},p(h,p){if(p[0]&8314435){o=So(Array(h[20]+1));let g;for(g=0;g<o.length;g+=1){const x=RI(h,o,g);c[g]?c[g].p(x,p):(c[g]=WI(x),c[g].c(),c[g].m(i.parentNode,i))}for(;g<c.length;g+=1)c[g].d(1);c.length=o.length}},d(h){h&&De(i),gc(c,h)}}}function UI(n){let i,o,c,h,p,g=(n[6]==="label"||n[9]==="label")&&jI(n);function x(...s){return n[33](n[39],...s)}return{c(){i=Di("span"),g&&g.c(),o=zr(),this.h()},l(s){i=Vi(s,"SPAN",{class:!0,style:!0});var M=ot(i);g&&g.l(M),o=Fr(M),M.forEach(De),this.h()},h(){xe(i,"class","pip"),xe(i,"style",c=n[14]+": "+n[15](n[19](n[39]))+"%;"),Ri(i,"selected",n[18](n[19](n[39]))),Ri(i,"in-range",n[17](n[19](n[39])))},m(s,M){Ai(s,i,M),g&&g.m(i,null),it(i,o),h||(p=[Pt(i,"pointerdown",n[32]),Pt(i,"pointerup",x)],h=!0)},p(s,M){n=s,n[6]==="label"||n[9]==="label"?g?g.p(n,M):(g=jI(n),g.c(),g.m(i,o)):g&&(g.d(1),g=null),M[0]&573440&&c!==(c=n[14]+": "+n[15](n[19](n[39]))+"%;")&&xe(i,"style",c),M[0]&786432&&Ri(i,"selected",n[18](n[19](n[39]))),M[0]&655360&&Ri(i,"in-range",n[17](n[19](n[39])))},d(s){s&&De(i),g&&g.d(),h=!1,Br(p)}}}function jI(n){let i,o,c,h=n[12](n[19](n[39]),n[39],n[15](n[19](n[39])))+"",p,g=n[10]&&GI(n),x=n[11]&&HI(n);return{c(){i=Di("span"),g&&g.c(),o=ar(),c=new Sh(!1),p=ar(),x&&x.c(),this.h()},l(s){i=Vi(s,"SPAN",{class:!0});var M=ot(i);g&&g.l(M),o=ar(),c=Oy(M,!1),p=ar(),x&&x.l(M),M.forEach(De),this.h()},h(){c.a=p,xe(i,"class","pipVal")},m(s,M){Ai(s,i,M),g&&g.m(i,null),it(i,o),c.m(h,i),it(i,p),x&&x.m(i,null)},p(s,M){s[10]?g?g.p(s,M):(g=GI(s),g.c(),g.m(i,o)):g&&(g.d(1),g=null),M[0]&561152&&h!==(h=s[12](s[19](s[39]),s[39],s[15](s[19](s[39])))+"")&&c.p(h),s[11]?x?x.p(s,M):(x=HI(s),x.c(),x.m(i,null)):x&&(x.d(1),x=null)},d(s){s&&De(i),g&&g.d(),x&&x.d()}}}function GI(n){let i,o;return{c(){i=Di("span"),o=fr(n[10]),this.h()},l(c){i=Vi(c,"SPAN",{class:!0});var h=ot(i);o=vr(h,n[10]),h.forEach(De),this.h()},h(){xe(i,"class","pipVal-prefix")},m(c,h){Ai(c,i,h),it(i,o)},p(c,h){h[0]&1024&&go(o,c[10])},d(c){c&&De(i)}}}function HI(n){let i,o;return{c(){i=Di("span"),o=fr(n[11]),this.h()},l(c){i=Vi(c,"SPAN",{class:!0});var h=ot(i);o=vr(h,n[11]),h.forEach(De),this.h()},h(){xe(i,"class","pipVal-suffix")},m(c,h){Ai(c,i,h),it(i,o)},p(c,h){h[0]&2048&&go(o,c[11])},d(c){c&&De(i)}}}function WI(n){let i=n[19](n[39])!==n[0]&&n[19](n[39])!==n[1],o,c=i&&UI(n);return{c(){c&&c.c(),o=ar()},l(h){c&&c.l(h),o=ar()},m(h,p){c&&c.m(h,p),Ai(h,o,p)},p(h,p){p[0]&524291&&(i=h[19](h[39])!==h[0]&&h[19](h[39])!==h[1]),i?c?c.p(h,p):(c=UI(h),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null)},d(h){h&&De(o),c&&c.d(h)}}}function qI(n){let i,o,c,h,p=(n[6]==="label"||n[8]==="label")&&ZI(n);return{c(){i=Di("span"),p&&p.c(),this.h()},l(g){i=Vi(g,"SPAN",{class:!0,style:!0});var x=ot(i);p&&p.l(x),x.forEach(De),this.h()},h(){xe(i,"class","pip last"),xe(i,"style",o=n[14]+": 100%;"),Ri(i,"selected",n[18](n[1])),Ri(i,"in-range",n[17](n[1]))},m(g,x){Ai(g,i,x),p&&p.m(i,null),c||(h=[Pt(i,"pointerdown",n[34]),Pt(i,"pointerup",n[35])],c=!0)},p(g,x){g[6]==="label"||g[8]==="label"?p?p.p(g,x):(p=ZI(g),p.c(),p.m(i,null)):p&&(p.d(1),p=null),x[0]&16384&&o!==(o=g[14]+": 100%;")&&xe(i,"style",o),x[0]&262146&&Ri(i,"selected",g[18](g[1])),x[0]&131074&&Ri(i,"in-range",g[17](g[1]))},d(g){g&&De(i),p&&p.d(),c=!1,Br(h)}}}function ZI(n){let i,o,c,h=n[12](n[16](n[1]),n[20],100)+"",p,g=n[10]&&XI(n),x=n[11]&&YI(n);return{c(){i=Di("span"),g&&g.c(),o=ar(),c=new Sh(!1),p=ar(),x&&x.c(),this.h()},l(s){i=Vi(s,"SPAN",{class:!0});var M=ot(i);g&&g.l(M),o=ar(),c=Oy(M,!1),p=ar(),x&&x.l(M),M.forEach(De),this.h()},h(){c.a=p,xe(i,"class","pipVal")},m(s,M){Ai(s,i,M),g&&g.m(i,null),it(i,o),c.m(h,i),it(i,p),x&&x.m(i,null)},p(s,M){s[10]?g?g.p(s,M):(g=XI(s),g.c(),g.m(i,o)):g&&(g.d(1),g=null),M[0]&1118210&&h!==(h=s[12](s[16](s[1]),s[20],100)+"")&&c.p(h),s[11]?x?x.p(s,M):(x=YI(s),x.c(),x.m(i,null)):x&&(x.d(1),x=null)},d(s){s&&De(i),g&&g.d(),x&&x.d()}}}function XI(n){let i,o;return{c(){i=Di("span"),o=fr(n[10]),this.h()},l(c){i=Vi(c,"SPAN",{class:!0});var h=ot(i);o=vr(h,n[10]),h.forEach(De),this.h()},h(){xe(i,"class","pipVal-prefix")},m(c,h){Ai(c,i,h),it(i,o)},p(c,h){h[0]&1024&&go(o,c[10])},d(c){c&&De(i)}}}function YI(n){let i,o;return{c(){i=Di("span"),o=fr(n[11]),this.h()},l(c){i=Vi(c,"SPAN",{class:!0});var h=ot(i);o=vr(h,n[11]),h.forEach(De),this.h()},h(){xe(i,"class","pipVal-suffix")},m(c,h){Ai(c,i,h),it(i,o)},p(c,h){h[0]&2048&&go(o,c[11])},d(c){c&&De(i)}}}function cj(n){let i,o,c,h=(n[6]&&n[7]!==!1||n[7])&&zI(n),p=(n[6]&&n[9]!==!1||n[9])&&VI(n),g=(n[6]&&n[8]!==!1||n[8])&&qI(n);return{c(){i=Di("div"),h&&h.c(),o=zr(),p&&p.c(),c=zr(),g&&g.c(),this.h()},l(x){i=Vi(x,"DIV",{class:!0});var s=ot(i);h&&h.l(s),o=Fr(s),p&&p.l(s),c=Fr(s),g&&g.l(s),s.forEach(De),this.h()},h(){xe(i,"class","rangePips"),Ri(i,"disabled",n[5]),Ri(i,"hoverable",n[4]),Ri(i,"vertical",n[2]),Ri(i,"reversed",n[3]),Ri(i,"focus",n[13])},m(x,s){Ai(x,i,s),h&&h.m(i,null),it(i,o),p&&p.m(i,null),it(i,c),g&&g.m(i,null)},p(x,s){x[6]&&x[7]!==!1||x[7]?h?h.p(x,s):(h=zI(x),h.c(),h.m(i,o)):h&&(h.d(1),h=null),x[6]&&x[9]!==!1||x[9]?p?p.p(x,s):(p=VI(x),p.c(),p.m(i,c)):p&&(p.d(1),p=null),x[6]&&x[8]!==!1||x[8]?g?g.p(x,s):(g=qI(x),g.c(),g.m(i,null)):g&&(g.d(1),g=null),s[0]&32&&Ri(i,"disabled",x[5]),s[0]&16&&Ri(i,"hoverable",x[4]),s[0]&4&&Ri(i,"vertical",x[2]),s[0]&8&&Ri(i,"reversed",x[3]),s[0]&8192&&Ri(i,"focus",x[13])},i:Rn,o:Rn,d(x){x&&De(i),h&&h.d(),p&&p.d(),g&&g.d()}}}function uj(n,i,o){let c,h,p,g,x,{range:s=!1}=i,{min:M=0}=i,{max:C=100}=i,{step:D=1}=i,{values:F=[(C+M)/2]}=i,{vertical:V=!1}=i,{reversed:X=!1}=i,{hoverable:W=!0}=i,{disabled:J=!1}=i,{pipstep:$=void 0}=i,{all:ne=!0}=i,{first:ye=void 0}=i,{last:pe=void 0}=i,{rest:ke=void 0}=i,{prefix:Ae=""}=i,{suffix:tt=""}=i,{formatter:pt=(rt,zi,Si)=>rt}=i,{focus:kt=void 0}=i,{orientationStart:Ie=void 0}=i,{percentOf:Et=void 0}=i,{moveHandle:mt=void 0}=i,{fixFloat:Xe=void 0}=i,{normalisedClient:Tt=void 0}=i,Yt;function mi(rt){rt=Tt(rt),Yt={x:rt.clientX,y:rt.clientY}}function Ti(rt,zi){if(zi=Tt(zi),!J){const Si=Math.sqrt(Math.pow(Yt.x-zi.clientX,2)+Math.pow(Yt.y-zi.clientY,2));Yt&&Si<=5&&mt(void 0,rt)}}const Zi=rt=>{mi(rt)},wt=rt=>{Ti(M,rt)},Ii=rt=>{mi(rt)},Ui=(rt,zi)=>{Ti(p(rt),zi)},Mi=rt=>{mi(rt)},st=rt=>{Ti(C,rt)};return n.$$set=rt=>{"range"in rt&&o(23,s=rt.range),"min"in rt&&o(0,M=rt.min),"max"in rt&&o(1,C=rt.max),"step"in rt&&o(24,D=rt.step),"values"in rt&&o(25,F=rt.values),"vertical"in rt&&o(2,V=rt.vertical),"reversed"in rt&&o(3,X=rt.reversed),"hoverable"in rt&&o(4,W=rt.hoverable),"disabled"in rt&&o(5,J=rt.disabled),"pipstep"in rt&&o(26,$=rt.pipstep),"all"in rt&&o(6,ne=rt.all),"first"in rt&&o(7,ye=rt.first),"last"in rt&&o(8,pe=rt.last),"rest"in rt&&o(9,ke=rt.rest),"prefix"in rt&&o(10,Ae=rt.prefix),"suffix"in rt&&o(11,tt=rt.suffix),"formatter"in rt&&o(12,pt=rt.formatter),"focus"in rt&&o(13,kt=rt.focus),"orientationStart"in rt&&o(14,Ie=rt.orientationStart),"percentOf"in rt&&o(15,Et=rt.percentOf),"moveHandle"in rt&&o(27,mt=rt.moveHandle),"fixFloat"in rt&&o(16,Xe=rt.fixFloat),"normalisedClient"in rt&&o(28,Tt=rt.normalisedClient)},n.$$.update=()=>{n.$$.dirty[0]&83886087&&o(29,c=$||((C-M)/D>=(V?50:100)?(C-M)/(V?10:20):1)),n.$$.dirty[0]&553648131&&o(20,h=parseInt((C-M)/(D*c),10)),n.$$.dirty[0]&553713665&&o(19,p=function(rt){return Xe(M+rt*D*c)}),n.$$.dirty[0]&33619968&&o(18,g=function(rt){return F.some(zi=>Xe(zi)===Xe(rt))}),n.$$.dirty[0]&41943040&&o(17,x=function(rt){if(s==="min")return F[0]>rt;if(s==="max")return F[0]<rt;if(s)return F[0]<rt&&F[1]>rt})},[M,C,V,X,W,J,ne,ye,pe,ke,Ae,tt,pt,kt,Ie,Et,Xe,x,g,p,h,mi,Ti,s,D,F,$,mt,Tt,c,Zi,wt,Ii,Ui,Mi,st]}class hj extends No{constructor(i){super(),Bo(this,i,uj,cj,Ao,{range:23,min:0,max:1,step:24,values:25,vertical:2,reversed:3,hoverable:4,disabled:5,pipstep:26,all:6,first:7,last:8,rest:9,prefix:10,suffix:11,formatter:12,focus:13,orientationStart:14,percentOf:15,moveHandle:27,fixFloat:16,normalisedClient:28},null,[-1,-1])}}function JI(n,i,o){const c=n.slice();return c[65]=i[o],c[67]=o,c}function KI(n){let i,o,c,h=n[21](n[65],n[67],n[24](n[65]))+"",p,g=n[18]&&QI(n),x=n[19]&&$I(n);return{c(){i=Di("span"),g&&g.c(),o=ar(),c=new Sh(!1),p=ar(),x&&x.c(),this.h()},l(s){i=Vi(s,"SPAN",{class:!0});var M=ot(i);g&&g.l(M),o=ar(),c=Oy(M,!1),p=ar(),x&&x.l(M),M.forEach(De),this.h()},h(){c.a=p,xe(i,"class","rangeFloat")},m(s,M){Ai(s,i,M),g&&g.m(i,null),it(i,o),c.m(h,i),it(i,p),x&&x.m(i,null)},p(s,M){s[18]?g?g.p(s,M):(g=QI(s),g.c(),g.m(i,o)):g&&(g.d(1),g=null),M[0]&18874369&&h!==(h=s[21](s[65],s[67],s[24](s[65]))+"")&&c.p(h),s[19]?x?x.p(s,M):(x=$I(s),x.c(),x.m(i,null)):x&&(x.d(1),x=null)},d(s){s&&De(i),g&&g.d(),x&&x.d()}}}function QI(n){let i,o;return{c(){i=Di("span"),o=fr(n[18]),this.h()},l(c){i=Vi(c,"SPAN",{class:!0});var h=ot(i);o=vr(h,n[18]),h.forEach(De),this.h()},h(){xe(i,"class","rangeFloat-prefix")},m(c,h){Ai(c,i,h),it(i,o)},p(c,h){h[0]&262144&&go(o,c[18])},d(c){c&&De(i)}}}function $I(n){let i,o;return{c(){i=Di("span"),o=fr(n[19]),this.h()},l(c){i=Vi(c,"SPAN",{class:!0});var h=ot(i);o=vr(h,n[19]),h.forEach(De),this.h()},h(){xe(i,"class","rangeFloat-suffix")},m(c,h){Ai(c,i,h),it(i,o)},p(c,h){h[0]&524288&&go(o,c[19])},d(c){c&&De(i)}}}function eC(n){let i,o,c,h,p,g,x,s,M,C,D,F,V,X=n[7]&&KI(n);return{c(){i=Di("span"),o=Di("span"),c=zr(),X&&X.c(),this.h()},l(W){i=Vi(W,"SPAN",{role:!0,class:!0,"data-handle":!0,style:!0,"aria-label":!0,"aria-valuemin":!0,"aria-valuemax":!0,"aria-valuenow":!0,"aria-valuetext":!0,"aria-orientation":!0,"aria-disabled":!0,disabled:!0,tabindex:!0});var J=ot(i);o=Vi(J,"SPAN",{class:!0}),ot(o).forEach(De),c=Fr(J),X&&X.l(J),J.forEach(De),this.h()},h(){xe(o,"class","rangeNub"),xe(i,"role","slider"),xe(i,"class","rangeHandle"),xe(i,"data-handle",n[67]),xe(i,"style",h=n[29]+": "+n[30][n[67]]+"%; z-index: "+(n[27]===n[67]?3:2)+";"),xe(i,"aria-label",p=n[22][n[67]]),xe(i,"aria-valuemin",g=n[2]===!0&&n[67]===1?n[0][0]:n[3]),xe(i,"aria-valuemax",x=n[2]===!0&&n[67]===0?n[0][1]:n[4]),xe(i,"aria-valuenow",s=n[65]),xe(i,"aria-valuetext",M=""+(n[18]+rC(n[21](n[65],n[67],n[24](n[65])))+n[19])),xe(i,"aria-orientation",C=n[6]?"vertical":"horizontal"),xe(i,"aria-disabled",n[10]),xe(i,"disabled",n[10]),xe(i,"tabindex",D=n[10]?-1:0),Ri(i,"active",n[25]&&n[27]===n[67]),Ri(i,"press",n[26]&&n[27]===n[67])},m(W,J){Ai(W,i,J),it(i,o),it(i,c),X&&X.m(i,null),F||(V=[Pt(i,"blur",n[35]),Pt(i,"focus",n[36]),Pt(i,"keydown",n[37])],F=!0)},p(W,J){W[7]?X?X.p(W,J):(X=KI(W),X.c(),X.m(i,null)):X&&(X.d(1),X=null),J[0]&1744830464&&h!==(h=W[29]+": "+W[30][W[67]]+"%; z-index: "+(W[27]===W[67]?3:2)+";")&&xe(i,"style",h),J[0]&4194304&&p!==(p=W[22][W[67]])&&xe(i,"aria-label",p),J[0]&13&&g!==(g=W[2]===!0&&W[67]===1?W[0][0]:W[3])&&xe(i,"aria-valuemin",g),J[0]&21&&x!==(x=W[2]===!0&&W[67]===0?W[0][1]:W[4])&&xe(i,"aria-valuemax",x),J[0]&1&&s!==(s=W[65])&&xe(i,"aria-valuenow",s),J[0]&19660801&&M!==(M=""+(W[18]+rC(W[21](W[65],W[67],W[24](W[65])))+W[19]))&&xe(i,"aria-valuetext",M),J[0]&64&&C!==(C=W[6]?"vertical":"horizontal")&&xe(i,"aria-orientation",C),J[0]&1024&&xe(i,"aria-disabled",W[10]),J[0]&1024&&xe(i,"disabled",W[10]),J[0]&1024&&D!==(D=W[10]?-1:0)&&xe(i,"tabindex",D),J[0]&167772160&&Ri(i,"active",W[25]&&W[27]===W[67]),J[0]&201326592&&Ri(i,"press",W[26]&&W[27]===W[67])},d(W){W&&De(i),X&&X.d(),F=!1,Br(V)}}}function tC(n){let i,o;return{c(){i=Di("span"),this.h()},l(c){i=Vi(c,"SPAN",{class:!0,style:!0}),ot(i).forEach(De),this.h()},h(){xe(i,"class","rangeBar"),xe(i,"style",o=n[29]+": "+n[33](n[30])+"%; "+n[28]+": "+n[34](n[30])+"%;")},m(c,h){Ai(c,i,h)},p(c,h){h[0]&1879048192&&o!==(o=c[29]+": "+c[33](c[30])+"%; "+c[28]+": "+c[34](c[30])+"%;")&&xe(i,"style",o)},d(c){c&&De(i)}}}function iC(n){let i,o;return i=new hj({props:{values:n[0],min:n[3],max:n[4],step:n[5],range:n[2],vertical:n[6],reversed:n[8],orientationStart:n[29],hoverable:n[9],disabled:n[10],all:n[13],first:n[14],last:n[15],rest:n[16],pipstep:n[12],prefix:n[18],suffix:n[19],formatter:n[20],focus:n[25],percentOf:n[24],moveHandle:n[32],fixFloat:n[31],normalisedClient:G_}}),{c(){Fy(i.$$.fragment)},l(c){By(i.$$.fragment,c)},m(c,h){dm(i,c,h),o=!0},p(c,h){const p={};h[0]&1&&(p.values=c[0]),h[0]&8&&(p.min=c[3]),h[0]&16&&(p.max=c[4]),h[0]&32&&(p.step=c[5]),h[0]&4&&(p.range=c[2]),h[0]&64&&(p.vertical=c[6]),h[0]&256&&(p.reversed=c[8]),h[0]&536870912&&(p.orientationStart=c[29]),h[0]&512&&(p.hoverable=c[9]),h[0]&1024&&(p.disabled=c[10]),h[0]&8192&&(p.all=c[13]),h[0]&16384&&(p.first=c[14]),h[0]&32768&&(p.last=c[15]),h[0]&65536&&(p.rest=c[16]),h[0]&4096&&(p.pipstep=c[12]),h[0]&262144&&(p.prefix=c[18]),h[0]&524288&&(p.suffix=c[19]),h[0]&1048576&&(p.formatter=c[20]),h[0]&33554432&&(p.focus=c[25]),h[0]&16777216&&(p.percentOf=c[24]),i.$set(p)},i(c){o||(no(i.$$.fragment,c),o=!0)},o(c){Fo(i.$$.fragment,c),o=!1},d(c){pm(i,c)}}}function fj(n){let i,o,c,h,p,g,x=So(n[0]),s=[];for(let D=0;D<x.length;D+=1)s[D]=eC(JI(n,x,D));let M=n[2]&&tC(n),C=n[11]&&iC(n);return{c(){i=Di("div");for(let D=0;D<s.length;D+=1)s[D].c();o=zr(),M&&M.c(),c=zr(),C&&C.c(),this.h()},l(D){i=Vi(D,"DIV",{id:!0,role:!0,class:!0});var F=ot(i);for(let V=0;V<s.length;V+=1)s[V].l(F);o=Fr(F),M&&M.l(F),c=Fr(F),C&&C.l(F),F.forEach(De),this.h()},h(){xe(i,"id",n[17]),xe(i,"role","none"),xe(i,"class","rangeSlider"),Ri(i,"range",n[2]),Ri(i,"disabled",n[10]),Ri(i,"hoverable",n[9]),Ri(i,"vertical",n[6]),Ri(i,"reversed",n[8]),Ri(i,"focus",n[25]),Ri(i,"min",n[2]==="min"),Ri(i,"max",n[2]==="max"),Ri(i,"pips",n[11]),Ri(i,"pip-labels",n[13]==="label"||n[14]==="label"||n[15]==="label"||n[16]==="label")},m(D,F){Ai(D,i,F);for(let V=0;V<s.length;V+=1)s[V]&&s[V].m(i,null);it(i,o),M&&M.m(i,null),it(i,c),C&&C.m(i,null),n[51](i),h=!0,p||(g=[Pt(window,"mousedown",n[40]),Pt(window,"touchstart",n[40]),Pt(window,"mousemove",n[41]),Pt(window,"touchmove",n[41]),Pt(window,"mouseup",n[42]),Pt(window,"touchend",n[43]),Pt(window,"keydown",n[44]),Pt(i,"mousedown",n[38]),Pt(i,"mouseup",n[39]),Pt(i,"touchstart",_E(n[38])),Pt(i,"touchend",_E(n[39]))],p=!0)},p(D,F){if(F[0]&1869350109|F[1]&112){x=So(D[0]);let V;for(V=0;V<x.length;V+=1){const X=JI(D,x,V);s[V]?s[V].p(X,F):(s[V]=eC(X),s[V].c(),s[V].m(i,o))}for(;V<s.length;V+=1)s[V].d(1);s.length=x.length}D[2]?M?M.p(D,F):(M=tC(D),M.c(),M.m(i,c)):M&&(M.d(1),M=null),D[11]?C?(C.p(D,F),F[0]&2048&&no(C,1)):(C=iC(D),C.c(),no(C,1),C.m(i,null)):C&&(Ry(),Fo(C,1,1,()=>{C=null}),zy()),(!h||F[0]&131072)&&xe(i,"id",D[17]),(!h||F[0]&4)&&Ri(i,"range",D[2]),(!h||F[0]&1024)&&Ri(i,"disabled",D[10]),(!h||F[0]&512)&&Ri(i,"hoverable",D[9]),(!h||F[0]&64)&&Ri(i,"vertical",D[6]),(!h||F[0]&256)&&Ri(i,"reversed",D[8]),(!h||F[0]&33554432)&&Ri(i,"focus",D[25]),(!h||F[0]&4)&&Ri(i,"min",D[2]==="min"),(!h||F[0]&4)&&Ri(i,"max",D[2]==="max"),(!h||F[0]&2048)&&Ri(i,"pips",D[11]),(!h||F[0]&122880)&&Ri(i,"pip-labels",D[13]==="label"||D[14]==="label"||D[15]==="label"||D[16]==="label")},i(D){h||(no(C),h=!0)},o(D){Fo(C),h=!1},d(D){D&&De(i),gc(s,D),M&&M.d(),C&&C.d(),n[51](null),p=!1,Br(g)}}}function nC(n){if(!n)return-1;for(var i=0;n=n.previousElementSibling;)i++;return i}function G_(n){return n.type.includes("touch")?n.touches[0]||n.changedTouches[0]:n}function rC(n){return`${n}`.replace(/<[^>]*>/g,"")}function dj(n,i,o){let c,h,p,g,x,s,M=Rn,C=()=>(M(),M=aP(Ze,We=>o(30,s=We)),Ze);n.$$.on_destroy.push(()=>M());let{slider:D=void 0}=i,{range:F=!1}=i,{pushy:V=!1}=i,{min:X=0}=i,{max:W=100}=i,{step:J=1}=i,{values:$=[(W+X)/2]}=i,{vertical:ne=!1}=i,{float:ye=!1}=i,{reversed:pe=!1}=i,{hoverable:ke=!0}=i,{disabled:Ae=!1}=i,{pips:tt=!1}=i,{pipstep:pt=void 0}=i,{all:kt=void 0}=i,{first:Ie=void 0}=i,{last:Et=void 0}=i,{rest:mt=void 0}=i,{id:Xe=void 0}=i,{prefix:Tt=""}=i,{suffix:Yt=""}=i,{formatter:mi=(We,pi,Wi)=>We}=i,{handleFormatter:Ti=mi}=i,{ariaLabels:Zi=[]}=i,{precision:wt=2}=i,{springValues:Ii={stiffness:.15,damping:.4}}=i;const Ui=j1();let Mi=0,st=!1,rt=!1,zi=!1,Si=!1,bn=$.length-1,nn,hn,Ze;const wn=We=>parseFloat((+We).toFixed(wt));function Sr(We){const pi=D.querySelectorAll(".handle"),Wi=Array.prototype.includes.call(pi,We),an=Array.prototype.some.call(pi,Xn=>Xn.contains(We));return Wi||an}function Mr(We){return F==="min"||F==="max"?We.slice(0,1):F?We.slice(0,2):We}function cn(){return D.getBoundingClientRect()}function Bt(We){const pi=cn();let Wi=0,an=0,Xn=0;ne?(Wi=We.clientY-pi.top,an=Wi/pi.height*100,an=pe?an:100-an):(Wi=We.clientX-pi.left,an=Wi/pi.width*100,an=pe?100-an:an),Xn=(W-X)/100*an+X;let Zr;return F===!0&&$[0]===$[1]?Xn>$[1]?1:0:(Zr=$.indexOf([...$].sort((Er,yo)=>Math.abs(Xn-Er)-Math.abs(Xn-yo))[0]),Zr)}function si(We){const pi=cn();let Wi=0,an=0,Xn=0;ne?(Wi=We.clientY-pi.top,an=Wi/pi.height*100,an=pe?an:100-an):(Wi=We.clientX-pi.left,an=Wi/pi.width*100,an=pe?100-an:an),Xn=(W-X)/100*an+X,je(bn,Xn)}function je(We,pi){return pi=p(pi),typeof We>"u"&&(We=bn),F&&(We===0&&pi>$[1]?V?o(0,$[1]=pi,$):pi=$[1]:We===1&&pi<$[0]&&(V?o(0,$[0]=pi,$):pi=$[0])),$[We]!==pi&&o(0,$[We]=pi,$),hn!==pi&&(_n(),hn=pi),pi}function re(We){return F==="min"?0:We[0]}function fe(We){return F==="max"?0:F==="min"?100-We[0]:100-We[1]}function Ee(We){Si&&(o(25,st=!1),rt=!1,o(26,zi=!1))}function dt(We){Ae||(o(27,bn=nC(We.target)),o(25,st=!0))}function ft(We){if(!Ae){const pi=nC(We.target);let Wi=We.ctrlKey||We.metaKey||We.shiftKey?J*10:J,an=!1;switch(We.key){case"PageDown":Wi*=10;case"ArrowRight":case"ArrowUp":je(pi,$[pi]+Wi),an=!0;break;case"PageUp":Wi*=10;case"ArrowLeft":case"ArrowDown":je(pi,$[pi]-Wi),an=!0;break;case"Home":je(pi,X),an=!0;break;case"End":je(pi,W),an=!0;break}an&&(We.preventDefault(),We.stopPropagation())}}function Ut(We){if(!Ae){const pi=We.target,Wi=G_(We);o(25,st=!0),rt=!0,o(26,zi=!0),o(27,bn=Bt(Wi)),nn=hn=p($[bn]),Bi(),We.type==="touchstart"&&!pi.matches(".pipVal")&&si(Wi)}}function Wt(We){We.type==="touchend"&&qn(),o(26,zi=!1)}function at(We){Si=!1,st&&We.target!==D&&!D.contains(We.target)&&o(25,st=!1)}function Zt(We){Ae||rt&&si(G_(We))}function Gt(We){if(!Ae){const pi=We.target;rt&&((pi===D||D.contains(pi))&&(o(25,st=!0),!Sr(pi)&&!pi.matches(".pipVal")&&si(G_(We))),qn())}rt=!1,o(26,zi=!1)}function qt(We){rt=!1,o(26,zi=!1)}function rn(We){Ae||(We.target===D||D.contains(We.target))&&(Si=!0)}function Bi(){!Ae&&Ui("start",{activeHandle:bn,value:nn,values:$.map(We=>p(We))})}function qn(){!Ae&&Ui("stop",{activeHandle:bn,startValue:nn,value:$[bn],values:$.map(We=>p(We))})}function _n(){!Ae&&Ui("change",{activeHandle:bn,startValue:nn,previousValue:typeof hn>"u"?nn:hn,value:$[bn],values:$.map(We=>p(We))})}function Tn(We){Za[We?"unshift":"push"](()=>{D=We,o(1,D)})}return n.$$set=We=>{"slider"in We&&o(1,D=We.slider),"range"in We&&o(2,F=We.range),"pushy"in We&&o(45,V=We.pushy),"min"in We&&o(3,X=We.min),"max"in We&&o(4,W=We.max),"step"in We&&o(5,J=We.step),"values"in We&&o(0,$=We.values),"vertical"in We&&o(6,ne=We.vertical),"float"in We&&o(7,ye=We.float),"reversed"in We&&o(8,pe=We.reversed),"hoverable"in We&&o(9,ke=We.hoverable),"disabled"in We&&o(10,Ae=We.disabled),"pips"in We&&o(11,tt=We.pips),"pipstep"in We&&o(12,pt=We.pipstep),"all"in We&&o(13,kt=We.all),"first"in We&&o(14,Ie=We.first),"last"in We&&o(15,Et=We.last),"rest"in We&&o(16,mt=We.rest),"id"in We&&o(17,Xe=We.id),"prefix"in We&&o(18,Tt=We.prefix),"suffix"in We&&o(19,Yt=We.suffix),"formatter"in We&&o(20,mi=We.formatter),"handleFormatter"in We&&o(21,Ti=We.handleFormatter),"ariaLabels"in We&&o(22,Zi=We.ariaLabels),"precision"in We&&o(46,wt=We.precision),"springValues"in We&&o(47,Ii=We.springValues)},n.$$.update=()=>{if(n.$$.dirty[0]&24&&o(50,h=function(We){return We<=X?X:We>=W?W:We}),n.$$.dirty[0]&56|n.$$.dirty[1]&524288&&o(49,p=function(We){if(We<=X)return wn(X);if(We>=W)return wn(W);We=wn(We);let pi=(We-X)%J,Wi=We-pi;return Math.abs(pi)*2>=J&&(Wi+=pi>0?J:-J),Wi=h(Wi),wn(Wi)}),n.$$.dirty[0]&24&&o(24,c=function(We){let pi=(We-X)/(W-X)*100;return isNaN(pi)||pi<=0?0:pi>=100?100:wn(pi)}),n.$$.dirty[0]&29360153|n.$$.dirty[1]&458752){Array.isArray($)||(o(0,$=[(W+X)/2]),console.error("'values' prop should be an Array (https://github.com/simeydotme/svelte-range-slider-pips#slider-props)"));const We=Mr($.map(pi=>p(pi)));($.length!==We.length||!$.every((pi,Wi)=>wn(pi)===We[Wi]))&&o(0,$=We),Mi!==$.length?C(o(23,Ze=lj($.map(pi=>c(pi)),Ii))):Ze.set($.map(pi=>c(pi))),o(48,Mi=$.length),$.length>1&&!Array.isArray(Zi)&&console.warn("'ariaLabels' prop should be an Array (https://github.com/simeydotme/svelte-range-slider-pips#slider-props)")}n.$$.dirty[0]&320&&o(29,g=ne?pe?"top":"bottom":pe?"right":"left"),n.$$.dirty[0]&320&&o(28,x=ne?pe?"bottom":"top":pe?"left":"right")},[$,D,F,X,W,J,ne,ye,pe,ke,Ae,tt,pt,kt,Ie,Et,mt,Xe,Tt,Yt,mi,Ti,Zi,Ze,c,st,zi,bn,x,g,s,wn,je,re,fe,Ee,dt,ft,Ut,Wt,at,Zt,Gt,qt,rn,V,wt,Ii,Mi,p,h,Tn]}class pq extends No{constructor(i){super(),Bo(this,i,dj,fj,Ao,{slider:1,range:2,pushy:45,min:3,max:4,step:5,values:0,vertical:6,float:7,reversed:8,hoverable:9,disabled:10,pips:11,pipstep:12,all:13,first:14,last:15,rest:16,id:17,prefix:18,suffix:19,formatter:20,handleFormatter:21,ariaLabels:22,precision:46,springValues:47},null,[-1,-1,-1])}}function oC(n){let i,o,c=("00"+n[0].getHours()).slice(-2)+"",h,p,g,x=("00"+n[0].getMinutes()).slice(-2)+"",s,M,C,D,F=n[1]!=="minute"&&sC(n);return{c(){i=Di("div"),o=Di("span"),h=fr(c),p=fr(`:
		`),g=Di("span"),s=fr(x),M=zr(),F&&F.c(),this.h()},l(V){i=Vi(V,"DIV",{class:!0,role:!0});var X=ot(i);o=Vi(X,"SPAN",{role:!0,"aria-label":!0,tabindex:!0,contenteditable:!0,inputmode:!0,class:!0});var W=ot(o);h=vr(W,c),W.forEach(De),p=vr(X,`:
		`),g=Vi(X,"SPAN",{role:!0,"aria-label":!0,tabindex:!0,contenteditable:!0,inputmode:!0,class:!0});var J=ot(g);s=vr(J,x),J.forEach(De),M=Fr(X),F&&F.l(X),X.forEach(De),this.h()},h(){xe(o,"role","spinbutton"),xe(o,"aria-label","Hours"),xe(o,"tabindex","0"),xe(o,"contenteditable",""),xe(o,"inputmode","numeric"),xe(o,"class","svelte-132npca"),xe(g,"role","spinbutton"),xe(g,"aria-label","Minutes"),xe(g,"tabindex","0"),xe(g,"contenteditable",""),xe(g,"inputmode","numeric"),xe(g,"class","svelte-132npca"),xe(i,"class","time-picker svelte-132npca"),xe(i,"role","none")},m(V,X){Ai(V,i,X),it(i,o),it(o,h),n[6](o),it(i,p),it(i,g),it(g,s),n[7](g),it(i,M),F&&F.m(i,null),C||(D=[Pt(o,"keydown",n[3]),Pt(o,"input",n[4]),Pt(o,"focus",xy),Pt(g,"keydown",n[3]),Pt(g,"input",n[4]),Pt(g,"focus",xy),Pt(i,"mousedown",n[10])],C=!0)},p(V,X){X&1&&c!==(c=("00"+V[0].getHours()).slice(-2)+"")&&Y_(h,c),X&1&&x!==(x=("00"+V[0].getMinutes()).slice(-2)+"")&&Y_(s,x),V[1]!=="minute"?F?F.p(V,X):(F=sC(V),F.c(),F.m(i,null)):F&&(F.d(1),F=null)},d(V){V&&De(i),n[6](null),n[7](null),F&&F.d(),C=!1,Br(D)}}}function sC(n){let i,o,c=("00"+n[0].getSeconds()).slice(-2)+"",h,p,g,x,s,M=n[1]!=="second"&&aC(n);return{c(){i=fr(":"),o=Di("span"),h=fr(c),p=zr(),M&&M.c(),g=ar(),this.h()},l(C){i=vr(C,":"),o=Vi(C,"SPAN",{role:!0,"aria-label":!0,tabindex:!0,contenteditable:!0,inputmode:!0,class:!0});var D=ot(o);h=vr(D,c),D.forEach(De),p=Fr(C),M&&M.l(C),g=ar(),this.h()},h(){xe(o,"role","spinbutton"),xe(o,"aria-label","Seconds"),xe(o,"tabindex","0"),xe(o,"contenteditable",""),xe(o,"inputmode","numeric"),xe(o,"class","svelte-132npca")},m(C,D){Ai(C,i,D),Ai(C,o,D),it(o,h),n[8](o),Ai(C,p,D),M&&M.m(C,D),Ai(C,g,D),x||(s=[Pt(o,"keydown",n[3]),Pt(o,"input",n[4]),Pt(o,"focus",xy)],x=!0)},p(C,D){D&1&&c!==(c=("00"+C[0].getSeconds()).slice(-2)+"")&&Y_(h,c),C[1]!=="second"?M?M.p(C,D):(M=aC(C),M.c(),M.m(g.parentNode,g)):M&&(M.d(1),M=null)},d(C){C&&(De(i),De(o),De(p),De(g)),n[8](null),M&&M.d(C),x=!1,Br(s)}}}function aC(n){let i,o,c=("000"+n[0].getMilliseconds()).slice(-3)+"",h,p,g;return{c(){i=fr("."),o=Di("span"),h=fr(c),this.h()},l(x){i=vr(x,"."),o=Vi(x,"SPAN",{role:!0,"aria-label":!0,tabindex:!0,contenteditable:!0,inputmode:!0,class:!0});var s=ot(o);h=vr(s,c),s.forEach(De),this.h()},h(){xe(o,"role","spinbutton"),xe(o,"aria-label","Milliseconds"),xe(o,"tabindex","0"),xe(o,"contenteditable",""),xe(o,"inputmode","numeric"),xe(o,"class","svelte-132npca")},m(x,s){Ai(x,i,s),Ai(x,o,s),it(o,h),n[9](o),p||(g=[Pt(o,"keydown",n[3]),Pt(o,"input",n[4]),Pt(o,"focus",xy)],p=!0)},p(x,s){s&1&&c!==(c=("000"+x[0].getMilliseconds()).slice(-3)+"")&&Y_(h,c)},d(x){x&&(De(i),De(o)),n[9](null),p=!1,Br(g)}}}function pj(n){let i,o=n[1]&&oC(n);return{c(){o&&o.c(),i=ar()},l(c){o&&o.l(c),i=ar()},m(c,h){o&&o.m(c,h),Ai(c,i,h)},p(c,[h]){c[1]?o?o.p(c,h):(o=oC(c),o.c(),o.m(i.parentNode,i)):o&&(o.d(1),o=null)},i:Rn,o:Rn,d(c){c&&De(i),o&&o.d(c)}}}function H_(n){const i=window.getSelection(),o=document.createRange();o.selectNodeContents(n),i==null||i.removeAllRanges(),i==null||i.addRange(o)}function mj(n,i,o){return o&&n<0?i:o&&n>i?0:Math.max(0,Math.min(i,n))}function Fx(n){const i=n.getAttribute("aria-label");if(i==="Hours")return{label:i,len:2,max:23};if(i==="Minutes")return{label:i,len:2,max:59};if(i==="Seconds")return{label:i,len:2,max:59};if(i==="Milliseconds")return{label:i,len:3,max:999};throw new Error("Invalid label "+i)}function Bx(n,i){return parseInt(n.replace(/[^\d]/g,"").slice(-i))}function xy(n){H_(n.currentTarget)}function gj(n,i,o){let{browseDate:c}=i,{timePrecision:h}=i,{setTime:p}=i,g=[];function x($){if($.key==="ArrowUp"||$.key==="ArrowDown"){const ne=s($.currentTarget),ye=$.key==="ArrowUp"?1:-1;C($.currentTarget,ne+ye,!0),$.preventDefault(),H_($.currentTarget)}else if($.key==="ArrowLeft"||$.key==="ArrowRight"||":;-,.".includes($.key)){const ne=g.indexOf($.currentTarget),ye=$.key==="ArrowLeft"?-1:1,pe=g[ne+ye];$.preventDefault(),pe&&(pe.focus(),H_(pe))}}function s($){const ne=Fx($).label;return ne==="Hours"?c.getHours():ne==="Minutes"?c.getMinutes():ne==="Seconds"?c.getSeconds():c.getMilliseconds()}function M($){const ne=("00"+$.getHours()).slice(-2),ye=("00"+$.getMinutes()).slice(-2),pe=("00"+$.getSeconds()).slice(-2),ke=("000"+$.getMilliseconds()).slice(-3);g[0]&&g[0].innerText!==ne&&o(2,g[0].innerText=ne,g),g[1]&&g[1].innerText!==ye&&o(2,g[1].innerText=ye,g),g[2]&&g[2].innerText!==pe&&o(2,g[2].innerText=pe,g),g[3]&&g[3].innerText!==ke&&o(2,g[3].innerText=ke,g)}function C($,ne,ye=!1){const pe=Fx($);ne=mj(ne,pe.max,ye),pe.label==="Hours"?c.setHours(ne):pe.label==="Minutes"?c.setMinutes(ne):pe.label==="Seconds"?c.setSeconds(ne):pe.label==="Milliseconds"&&c.setMilliseconds(ne),o(0,c=p(c)),M(c)}function D($){const ne=$,ye=Fx(ne.currentTarget);let pe;if(ne.inputType==="insertText"){const ke="000"+s(ne.currentTarget);pe=Bx(ke+ne.currentTarget.innerText,ye.len),pe>ye.max&&ne.data&&(pe=Bx(ne.data,ye.len))}else pe=Bx("000"+ne.currentTarget.innerText,ye.len);C(ne.currentTarget,pe),H_(ne.currentTarget)}function F($){Za[$?"unshift":"push"](()=>{g[0]=$,o(2,g)})}function V($){Za[$?"unshift":"push"](()=>{g[1]=$,o(2,g)})}function X($){Za[$?"unshift":"push"](()=>{g[2]=$,o(2,g)})}function W($){Za[$?"unshift":"push"](()=>{g[3]=$,o(2,g)})}const J=$=>{$.target instanceof HTMLElement&&$.target.tagName==="SPAN"&&($.target.focus(),$.preventDefault())};return n.$$set=$=>{"browseDate"in $&&o(0,c=$.browseDate),"timePrecision"in $&&o(1,h=$.timePrecision),"setTime"in $&&o(5,p=$.setTime)},n.$$.update=()=>{n.$$.dirty&1&&M(c)},[c,h,g,x,D,p,F,V,X,W,J]}class _j extends No{constructor(i){super(),Bo(this,i,gj,pj,Ao,{browseDate:0,timePrecision:1,setTime:5})}}function yj(n){return n%4===0&&n%100!==0||n%400===0}function om(n,i){return[31,yj(n)?29:28,31,30,31,30,31,31,30,31,30,31][i]}function lC(n,i){let o="";if(n)for(const c of i)typeof c=="string"?o+=c:o+=c.toString(n);return o}function Nx(n,i){const o=om(n,i),c=[];for(let h=0;h<o;h++)c.push({year:n,month:i,number:h+1});return c}function vj(n,i){const o=n.getFullYear(),c=n.getMonth(),h=new Date(o,c,1).getDay();let p=[];const g=(h-i+7)%7;if(g>0){let C=c-1,D=o;C===-1&&(C=11,D=o-1),p=Nx(D,C).slice(-g)}p=p.concat(Nx(o,c));let x=c+1,s=o;x===12&&(x=0,s=o+1);const M=42-p.length;return p=p.concat(Nx(s,x).slice(0,M)),p}function xj(){return{weekdays:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekStartsOn:1}}function bj(n={}){const i=xj();return typeof n.weekStartsOn=="number"&&(i.weekStartsOn=n.weekStartsOn),n.months&&(i.months=n.months),n.weekdays&&(i.weekdays=n.weekdays),i}function cC(n,i,o){const c=n.slice();return c[36]=i[o],c[38]=o,c}function uC(n,i,o){const c=n.slice();return c[39]=i[o],c}function hC(n,i,o){const c=n.slice();return c[36]=i[o],c[43]=o,c}function fC(n,i,o){const c=n.slice();return c[44]=i[o],c}function dC(n,i,o){const c=n.slice();return c[44]=i[o],c}function pC(n,i,o){const c=n.slice();return c[49]=i[o],c[43]=o,c}function mC(n,i,o){const c=n.slice();return c[49]=i[o],c[43]=o,c}function gC(n){let i,o=n[49]+"",c,h;return{c(){i=Di("option"),c=fr(o),this.h()},l(p){i=Vi(p,"OPTION",{});var g=ot(i);c=vr(g,o),g.forEach(De),this.h()},h(){i.disabled=h=new Date(n[9],n[43],om(n[9],n[43]),23,59,59,999)<n[2]||new Date(n[9],n[43])>n[3],i.__value=n[43],Uf(i,i.__value)},m(p,g){Ai(p,i,g),it(i,c)},p(p,g){g[0]&32&&o!==(o=p[49]+"")&&go(c,o),g[0]&588&&h!==(h=new Date(p[9],p[43],om(p[9],p[43]),23,59,59,999)<p[2]||new Date(p[9],p[43])>p[3])&&(i.disabled=h)},d(p){p&&De(i)}}}function _C(n){let i,o=n[49]+"",c,h;return{c(){i=Di("option"),c=fr(o),this.h()},l(p){i=Vi(p,"OPTION",{});var g=ot(i);c=vr(g,o),g.forEach(De),this.h()},h(){i.__value=n[43],Uf(i,i.__value),i.selected=h=n[43]===n[8]},m(p,g){Ai(p,i,g),it(i,c)},p(p,g){g[0]&32&&o!==(o=p[49]+"")&&go(c,o),g[0]&256&&h!==(h=p[43]===p[8])&&(i.selected=h)},d(p){p&&De(i)}}}function yC(n){let i,o=n[44]+"",c,h;return{c(){i=Di("option"),c=fr(o),this.h()},l(p){i=Vi(p,"OPTION",{});var g=ot(i);c=vr(g,o),g.forEach(De),this.h()},h(){i.__value=h=n[44],Uf(i,i.__value)},m(p,g){Ai(p,i,g),it(i,c)},p(p,g){g[0]&64&&o!==(o=p[44]+"")&&go(c,o),g[0]&64&&h!==(h=p[44])&&(i.__value=h,Uf(i,i.__value))},d(p){p&&De(i)}}}function vC(n){let i,o=n[44]+"",c,h,p;return{c(){i=Di("option"),c=fr(o),this.h()},l(g){i=Vi(g,"OPTION",{});var x=ot(i);c=vr(x,o),x.forEach(De),this.h()},h(){i.__value=h=n[44],Uf(i,i.__value),i.selected=p=n[44]===n[4].getFullYear()},m(g,x){Ai(g,i,x),it(i,c)},p(g,x){x[0]&64&&o!==(o=g[44]+"")&&go(c,o),x[0]&64&&h!==(h=g[44])&&(i.__value=h,Uf(i,i.__value)),x[0]&80&&p!==(p=g[44]===g[4].getFullYear())&&(i.selected=p)},d(g){g&&De(i)}}}function wj(n){let i,o=n[5].weekdays[n[5].weekStartsOn+n[43]-7]+"",c;return{c(){i=Di("div"),c=fr(o),this.h()},l(h){i=Vi(h,"DIV",{class:!0});var p=ot(i);c=vr(p,o),p.forEach(De),this.h()},h(){xe(i,"class","header-cell svelte-go79cf")},m(h,p){Ai(h,i,p),it(i,c)},p(h,p){p[0]&32&&o!==(o=h[5].weekdays[h[5].weekStartsOn+h[43]-7]+"")&&go(c,o)},d(h){h&&De(i)}}}function Tj(n){let i,o=n[5].weekdays[n[5].weekStartsOn+n[43]]+"",c;return{c(){i=Di("div"),c=fr(o),this.h()},l(h){i=Vi(h,"DIV",{class:!0});var p=ot(i);c=vr(p,o),p.forEach(De),this.h()},h(){xe(i,"class","header-cell svelte-go79cf")},m(h,p){Ai(h,i,p),it(i,c)},p(h,p){p[0]&32&&o!==(o=h[5].weekdays[h[5].weekStartsOn+h[43]]+"")&&go(c,o)},d(h){h&&De(i)}}}function xC(n){let i;function o(p,g){return p[43]+p[5].weekStartsOn<7?Tj:wj}let c=o(n),h=c(n);return{c(){h.c(),i=ar()},l(p){h.l(p),i=ar()},m(p,g){h.m(p,g),Ai(p,i,g)},p(p,g){c===(c=o(p))&&h?h.p(p,g):(h.d(1),h=c(p),h&&(h.c(),h.m(i.parentNode,i)))},d(p){p&&De(i),h.d(p)}}}function bC(n){let i,o,c=n[39].number+"",h,p,g;function x(){return n[27](n[39])}return{c(){i=Di("div"),o=Di("span"),h=fr(c),this.h()},l(s){i=Vi(s,"DIV",{class:!0});var M=ot(i);o=Vi(M,"SPAN",{class:!0});var C=ot(o);h=vr(C,c),C.forEach(De),M.forEach(De),this.h()},h(){xe(o,"class","svelte-go79cf"),xe(i,"class","cell svelte-go79cf"),Ri(i,"disabled",!C1(n[39],n[2],n[3])),Ri(i,"selected",n[0]&&n[39].year===n[0].getFullYear()&&n[39].month===n[0].getMonth()&&n[39].number===n[0].getDate()),Ri(i,"today",n[39].year===n[11].getFullYear()&&n[39].month===n[11].getMonth()&&n[39].number===n[11].getDate()),Ri(i,"other-month",n[39].month!==n[8])},m(s,M){Ai(s,i,M),it(i,o),it(o,h),p||(g=Pt(i,"click",x),p=!0)},p(s,M){n=s,M[0]&128&&c!==(c=n[39].number+"")&&go(h,c),M[0]&140&&Ri(i,"disabled",!C1(n[39],n[2],n[3])),M[0]&129&&Ri(i,"selected",n[0]&&n[39].year===n[0].getFullYear()&&n[39].month===n[0].getMonth()&&n[39].number===n[0].getDate()),M[0]&2176&&Ri(i,"today",n[39].year===n[11].getFullYear()&&n[39].month===n[11].getMonth()&&n[39].number===n[11].getDate()),M[0]&384&&Ri(i,"other-month",n[39].month!==n[8])},d(s){s&&De(i),p=!1,g()}}}function wC(n){let i,o=So(n[7].slice(n[38]*7,n[38]*7+7)),c=[];for(let h=0;h<o.length;h+=1)c[h]=bC(uC(n,o,h));return{c(){i=Di("div");for(let h=0;h<c.length;h+=1)c[h].c();this.h()},l(h){i=Vi(h,"DIV",{class:!0});var p=ot(i);for(let g=0;g<c.length;g+=1)c[g].l(p);p.forEach(De),this.h()},h(){xe(i,"class","week svelte-go79cf")},m(h,p){Ai(h,i,p);for(let g=0;g<c.length;g+=1)c[g]&&c[g].m(i,null)},p(h,p){if(p[0]&18829){o=So(h[7].slice(h[38]*7,h[38]*7+7));let g;for(g=0;g<o.length;g+=1){const x=uC(h,o,g);c[g]?c[g].p(x,p):(c[g]=bC(x),c[g].c(),c[g].m(i,null))}for(;g<c.length;g+=1)c[g].d(1);c.length=o.length}},d(h){h&&De(i),gc(c,h)}}}function Sj(n){let i,o,c,h,p='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="svelte-go79cf"><path d="M5 3l3.057-3 11.943 12-11.943 12-3.057-3 9-9z" transform="rotate(180, 12, 12)"></path></svg>',g,x,s,M,C,D,F,V,X,W,J,$,ne,ye,pe,ke,Ae,tt,pt='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="svelte-go79cf"><path d="M5 3l3.057-3 11.943 12-11.943 12-3.057-3 9-9z"></path></svg>',kt,Ie,Et,mt,Xe,Tt,Yt,mi,Ti,Zi,wt=So(n[5].months),Ii=[];for(let Bt=0;Bt<wt.length;Bt+=1)Ii[Bt]=gC(mC(n,wt,Bt));let Ui=So(n[5].months),Mi=[];for(let Bt=0;Bt<Ui.length;Bt+=1)Mi[Bt]=_C(pC(n,Ui,Bt));let st=So(n[6]),rt=[];for(let Bt=0;Bt<st.length;Bt+=1)rt[Bt]=yC(dC(n,st,Bt));let zi=So(n[6]),Si=[];for(let Bt=0;Bt<zi.length;Bt+=1)Si[Bt]=vC(fC(n,zi,Bt));let bn=So(Array(7)),nn=[];for(let Bt=0;Bt<bn.length;Bt+=1)nn[Bt]=xC(hC(n,bn,Bt));let hn=So(Array(6)),Ze=[];for(let Bt=0;Bt<hn.length;Bt+=1)Ze[Bt]=wC(cC(n,hn,Bt));function wn(Bt){n[28](Bt)}let Sr={timePrecision:n[1],setTime:n[10]};n[4]!==void 0&&(Sr.browseDate=n[4]),Xe=new _j({props:Sr}),Za.push(()=>bP(Xe,"browseDate",wn));const Mr=n[21].default,cn=cm(Mr,n,n[20],null);return{c(){i=Di("div"),o=Di("div"),c=Di("div"),h=Di("button"),h.innerHTML=p,g=zr(),x=Di("div"),s=Di("select");for(let Bt=0;Bt<Ii.length;Bt+=1)Ii[Bt].c();M=zr(),C=Di("select");for(let Bt=0;Bt<Mi.length;Bt+=1)Mi[Bt].c();D=zr(),F=Xt("svg"),V=Xt("path"),X=zr(),W=Di("div"),J=Di("select");for(let Bt=0;Bt<rt.length;Bt+=1)rt[Bt].c();$=zr(),ne=Di("select");for(let Bt=0;Bt<Si.length;Bt+=1)Si[Bt].c();ye=zr(),pe=Xt("svg"),ke=Xt("path"),Ae=zr(),tt=Di("button"),tt.innerHTML=pt,kt=zr(),Ie=Di("div");for(let Bt=0;Bt<nn.length;Bt+=1)nn[Bt].c();Et=zr();for(let Bt=0;Bt<Ze.length;Bt+=1)Ze[Bt].c();mt=zr(),Fy(Xe.$$.fragment),Yt=zr(),cn&&cn.c(),this.h()},l(Bt){i=Vi(Bt,"DIV",{class:!0,tabindex:!0});var si=ot(i);o=Vi(si,"DIV",{class:!0,tabindex:!0});var je=ot(o);c=Vi(je,"DIV",{class:!0});var re=ot(c);h=Vi(re,"BUTTON",{type:!0,class:!0,tabindex:!0,"data-svelte-h":!0}),yE(h)!=="svelte-t4cock"&&(h.innerHTML=p),g=Fr(re),x=Vi(re,"DIV",{class:!0});var fe=ot(x);s=Vi(fe,"SELECT",{class:!0});var Ee=ot(s);for(let qt=0;qt<Ii.length;qt+=1)Ii[qt].l(Ee);Ee.forEach(De),M=Fr(fe),C=Vi(fe,"SELECT",{class:!0,tabindex:!0});var dt=ot(C);for(let qt=0;qt<Mi.length;qt+=1)Mi[qt].l(dt);dt.forEach(De),D=Fr(fe),F=Kt(fe,"svg",{xmlns:!0,width:!0,height:!0,viewBox:!0,class:!0});var ft=ot(F);V=Kt(ft,"path",{d:!0,transform:!0}),ot(V).forEach(De),ft.forEach(De),fe.forEach(De),X=Fr(re),W=Vi(re,"DIV",{class:!0});var Ut=ot(W);J=Vi(Ut,"SELECT",{class:!0});var Wt=ot(J);for(let qt=0;qt<rt.length;qt+=1)rt[qt].l(Wt);Wt.forEach(De),$=Fr(Ut),ne=Vi(Ut,"SELECT",{class:!0,tabindex:!0});var at=ot(ne);for(let qt=0;qt<Si.length;qt+=1)Si[qt].l(at);at.forEach(De),ye=Fr(Ut),pe=Kt(Ut,"svg",{xmlns:!0,width:!0,height:!0,viewBox:!0,class:!0});var Zt=ot(pe);ke=Kt(Zt,"path",{d:!0,transform:!0}),ot(ke).forEach(De),Zt.forEach(De),Ut.forEach(De),Ae=Fr(re),tt=Vi(re,"BUTTON",{type:!0,class:!0,tabindex:!0,"data-svelte-h":!0}),yE(tt)!=="svelte-1a006lp"&&(tt.innerHTML=pt),re.forEach(De),kt=Fr(je),Ie=Vi(je,"DIV",{class:!0});var Gt=ot(Ie);for(let qt=0;qt<nn.length;qt+=1)nn[qt].l(Gt);Gt.forEach(De),Et=Fr(je);for(let qt=0;qt<Ze.length;qt+=1)Ze[qt].l(je);mt=Fr(je),By(Xe.$$.fragment,je),Yt=Fr(je),cn&&cn.l(je),je.forEach(De),si.forEach(De),this.h()},h(){xe(h,"type","button"),xe(h,"class","page-button svelte-go79cf"),xe(h,"tabindex","-1"),xe(s,"class","svelte-go79cf"),xe(C,"class","dummy-select svelte-go79cf"),xe(C,"tabindex","-1"),xe(V,"d","M6 0l12 12-12 12z"),xe(V,"transform","rotate(90, 12, 12)"),xe(F,"xmlns","http://www.w3.org/2000/svg"),xe(F,"width","24"),xe(F,"height","24"),xe(F,"viewBox","0 0 24 24"),xe(F,"class","svelte-go79cf"),xe(x,"class","dropdown month svelte-go79cf"),xe(J,"class","svelte-go79cf"),xe(ne,"class","dummy-select svelte-go79cf"),xe(ne,"tabindex","-1"),xe(ke,"d","M6 0l12 12-12 12z"),xe(ke,"transform","rotate(90, 12, 12)"),xe(pe,"xmlns","http://www.w3.org/2000/svg"),xe(pe,"width","24"),xe(pe,"height","24"),xe(pe,"viewBox","0 0 24 24"),xe(pe,"class","svelte-go79cf"),xe(W,"class","dropdown year svelte-go79cf"),xe(tt,"type","button"),xe(tt,"class","page-button svelte-go79cf"),xe(tt,"tabindex","-1"),xe(c,"class","top svelte-go79cf"),xe(Ie,"class","header svelte-go79cf"),xe(o,"class","tab-container svelte-go79cf"),xe(o,"tabindex","-1"),xe(i,"class","date-time-picker svelte-go79cf"),xe(i,"tabindex","0")},m(Bt,si){Ai(Bt,i,si),it(i,o),it(o,c),it(c,h),it(c,g),it(c,x),it(x,s);for(let je=0;je<Ii.length;je+=1)Ii[je]&&Ii[je].m(s,null);n_(s,n[8]),it(x,M),it(x,C);for(let je=0;je<Mi.length;je+=1)Mi[je]&&Mi[je].m(C,null);it(x,D),it(x,F),it(F,V),it(c,X),it(c,W),it(W,J);for(let je=0;je<rt.length;je+=1)rt[je]&&rt[je].m(J,null);n_(J,n[9]),it(W,$),it(W,ne);for(let je=0;je<Si.length;je+=1)Si[je]&&Si[je].m(ne,null);it(W,ye),it(W,pe),it(pe,ke),it(c,Ae),it(c,tt),it(o,kt),it(o,Ie);for(let je=0;je<nn.length;je+=1)nn[je]&&nn[je].m(Ie,null);it(o,Et);for(let je=0;je<Ze.length;je+=1)Ze[je]&&Ze[je].m(o,null);it(o,mt),dm(Xe,o,null),it(o,Yt),cn&&cn.m(o,null),mi=!0,Ti||(Zi=[Pt(h,"click",n[23]),Pt(s,"keydown",n[16]),Pt(s,"input",n[24]),Pt(J,"input",n[25]),Pt(J,"keydown",n[15]),Pt(tt,"click",n[26]),Pt(i,"focusout",n[22]),Pt(i,"keydown",n[17])],Ti=!0)},p(Bt,si){if(si[0]&556){wt=So(Bt[5].months);let re;for(re=0;re<wt.length;re+=1){const fe=mC(Bt,wt,re);Ii[re]?Ii[re].p(fe,si):(Ii[re]=gC(fe),Ii[re].c(),Ii[re].m(s,null))}for(;re<Ii.length;re+=1)Ii[re].d(1);Ii.length=wt.length}if((!mi||si[0]&256)&&n_(s,Bt[8]),si[0]&288){Ui=So(Bt[5].months);let re;for(re=0;re<Ui.length;re+=1){const fe=pC(Bt,Ui,re);Mi[re]?Mi[re].p(fe,si):(Mi[re]=_C(fe),Mi[re].c(),Mi[re].m(C,null))}for(;re<Mi.length;re+=1)Mi[re].d(1);Mi.length=Ui.length}if(si[0]&64){st=So(Bt[6]);let re;for(re=0;re<st.length;re+=1){const fe=dC(Bt,st,re);rt[re]?rt[re].p(fe,si):(rt[re]=yC(fe),rt[re].c(),rt[re].m(J,null))}for(;re<rt.length;re+=1)rt[re].d(1);rt.length=st.length}if((!mi||si[0]&576)&&n_(J,Bt[9]),si[0]&80){zi=So(Bt[6]);let re;for(re=0;re<zi.length;re+=1){const fe=fC(Bt,zi,re);Si[re]?Si[re].p(fe,si):(Si[re]=vC(fe),Si[re].c(),Si[re].m(ne,null))}for(;re<Si.length;re+=1)Si[re].d(1);Si.length=zi.length}if(si[0]&32){bn=So(Array(7));let re;for(re=0;re<bn.length;re+=1){const fe=hC(Bt,bn,re);nn[re]?nn[re].p(fe,si):(nn[re]=xC(fe),nn[re].c(),nn[re].m(Ie,null))}for(;re<nn.length;re+=1)nn[re].d(1);nn.length=bn.length}if(si[0]&18829){hn=So(Array(6));let re;for(re=0;re<hn.length;re+=1){const fe=cC(Bt,hn,re);Ze[re]?Ze[re].p(fe,si):(Ze[re]=wC(fe),Ze[re].c(),Ze[re].m(o,mt))}for(;re<Ze.length;re+=1)Ze[re].d(1);Ze.length=hn.length}const je={};si[0]&2&&(je.timePrecision=Bt[1]),!Tt&&si[0]&16&&(Tt=!0,je.browseDate=Bt[4],vP(()=>Tt=!1)),Xe.$set(je),cn&&cn.p&&(!mi||si[0]&1048576)&&hm(cn,Mr,Bt,Bt[20],mi?um(Mr,Bt[20],si,null):fm(Bt[20]),null)},i(Bt){mi||(no(Xe.$$.fragment,Bt),no(cn,Bt),mi=!0)},o(Bt){Fo(Xe.$$.fragment,Bt),Fo(cn,Bt),mi=!1},d(Bt){Bt&&De(i),gc(Ii,Bt),gc(Mi,Bt),gc(rt,Bt),gc(Si,Bt),gc(nn,Bt),gc(Ze,Bt),pm(Xe),cn&&cn.d(Bt),Ti=!1,Br(Zi)}}}function Sl(n){return new Date(n.getTime())}function by(n,i,o){return n>o?Sl(o):n<i?Sl(i):Sl(n)}function Vx(n,i,o){const c=by(n,i,o);return c.getTime()!==n.getTime()&&(n=new Date(c.getFullYear(),c.getMonth(),c.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()),n=by(n,i,o)),n}function TC(n,i){let o=[];for(let c=n.getFullYear();c<=i.getFullYear();c++)o.push(c);return o}function C1(n,i,o){const c=new Date(n.year,n.month,n.number),h=new Date(i.getFullYear(),i.getMonth(),i.getDate()),p=new Date(o.getFullYear(),o.getMonth(),o.getDate());return c>=h&&c<=p}function Mj(n,i,o){let c,h,p,g,{$$slots:x={},$$scope:s}=i;const M=j1();let{value:C=null}=i;function D(st){st.getTime()!==(C==null?void 0:C.getTime())&&(o(4,pe=by(st,ne,ye)),o(0,C=Sl(pe)))}function F(st){st.getTime()!==(C==null?void 0:C.getTime())&&(o(4,pe=Vx(st,ne,ye)),o(0,C=Sl(pe)))}function V(st){o(4,pe=Vx(st,ne,ye)),!pt&&C&&D(pe)}function X(st){return o(4,pe=by(st,ne,ye)),C&&D(pe),pe}const W=new Date,J=new Date;let{timePrecision:$=null}=i,{min:ne=new Date(J.getFullYear()-20,0,1)}=i,{max:ye=new Date(J.getFullYear(),11,31,23,59,59,999)}=i,pe=Sl(C||Vx(J,ne,ye));function ke(st){pe.getTime()!==(st==null?void 0:st.getTime())&&o(4,pe=st?Sl(st):pe)}let Ae=TC(ne,ye),{locale:tt={}}=i,{browseWithoutSelecting:pt=!1}=i;function kt(st){pe.setFullYear(st),V(pe)}function Ie(st){let rt=pe.getFullYear();st===12?(st=0,rt++):st===-1&&(st=11,rt--);const zi=om(rt,st),Si=Math.min(pe.getDate(),zi);V(new Date(rt,st,Si,pe.getHours(),pe.getMinutes(),pe.getSeconds(),pe.getMilliseconds()))}function Et(st){C1(st,ne,ye)&&(pe.setFullYear(0),pe.setMonth(0),pe.setDate(1),pe.setFullYear(st.year),pe.setMonth(st.month),pe.setDate(st.number),F(pe),M("select",Sl(pe)))}function mt(st){if(st.shiftKey&&st.key==="ArrowUp")kt(pe.getFullYear()-1);else if(st.shiftKey&&st.key==="ArrowDown")kt(pe.getFullYear()+1);else if(st.shiftKey&&st.key==="ArrowLeft")Ie(pe.getMonth()-1);else if(st.shiftKey&&st.key==="ArrowRight")Ie(pe.getMonth()+1);else return!1;return st.preventDefault(),!0}function Xe(st){if(st.shiftKey||st.altKey){mt(st);return}else if(st.key==="ArrowUp")kt(pe.getFullYear()-1);else if(st.key==="ArrowDown")kt(pe.getFullYear()+1);else if(st.key==="ArrowLeft")Ie(pe.getMonth()-1);else if(st.key==="ArrowRight")Ie(pe.getMonth()+1);else{mt(st);return}st.preventDefault()}function Tt(st){if(st.shiftKey||st.altKey){mt(st);return}else if(st.key==="ArrowUp"||st.key==="ArrowLeft")Ie(pe.getMonth()-1);else if(st.key==="ArrowDown"||st.key==="ArrowRight")Ie(pe.getMonth()+1);else{mt(st);return}st.preventDefault()}function Yt(st){var zi,Si;let rt=st.shiftKey||st.altKey;if(!(((zi=st.target)==null?void 0:zi.tagName)==="SELECT"||((Si=st.target)==null?void 0:Si.tagName)==="SPAN")){if(rt){mt(st);return}else if(st.key==="ArrowUp")pe.setDate(pe.getDate()-7),F(pe);else if(st.key==="ArrowDown")pe.setDate(pe.getDate()+7),F(pe);else if(st.key==="ArrowLeft")pe.setDate(pe.getDate()-1),F(pe);else if(st.key==="ArrowRight")pe.setDate(pe.getDate()+1),F(pe);else if(st.key==="Enter")D(pe),M("select",Sl(pe));else return;st.preventDefault()}}function mi(st){bi.call(this,n,st)}const Ti=()=>Ie(pe.getMonth()-1),Zi=st=>Ie(parseInt(st.currentTarget.value)),wt=st=>kt(parseInt(st.currentTarget.value)),Ii=()=>Ie(pe.getMonth()+1),Ui=st=>Et(st);function Mi(st){pe=st,o(4,pe)}return n.$$set=st=>{"value"in st&&o(0,C=st.value),"timePrecision"in st&&o(1,$=st.timePrecision),"min"in st&&o(2,ne=st.min),"max"in st&&o(3,ye=st.max),"locale"in st&&o(18,tt=st.locale),"browseWithoutSelecting"in st&&o(19,pt=st.browseWithoutSelecting),"$$scope"in st&&o(20,s=st.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&13&&(C&&C>ye?D(ye):C&&C<ne&&D(ne)),n.$$.dirty[0]&1&&ke(C),n.$$.dirty[0]&12&&o(6,Ae=TC(ne,ye)),n.$$.dirty[0]&262144&&o(5,c=bj(tt)),n.$$.dirty[0]&16&&o(9,h=pe.getFullYear()),n.$$.dirty[0]&16&&o(8,p=pe.getMonth()),n.$$.dirty[0]&48&&o(7,g=vj(pe,c.weekStartsOn))},[C,$,ne,ye,pe,c,Ae,g,p,h,X,W,kt,Ie,Et,Xe,Tt,Yt,tt,pt,s,x,mi,Ti,Zi,wt,Ii,Ui,Mi]}class Ej extends No{constructor(i){super(),Bo(this,i,Mj,Sj,Ao,{value:0,timePrecision:1,min:2,max:3,locale:18,browseWithoutSelecting:19},null,[-1,-1])}}function Aj(n,{delay:i=0,duration:o=400,easing:c=L3,amount:h=5,opacity:p=0}={}){const g=getComputedStyle(n),x=+g.opacity,s=g.filter==="none"?"":g.filter,M=x*(1-p),[C,D]=qx(h);return{delay:i,duration:o,easing:c,css:(F,V)=>`opacity: ${x-M*V}; filter: ${s} blur(${V*C}${D});`}}function Ij(n,{delay:i=0,duration:o=400,easing:c=oP}={}){const h=+getComputedStyle(n).opacity;return{delay:i,duration:o,easing:c,css:p=>`opacity: ${p*h}`}}function R3(n,{delay:i=0,duration:o=400,easing:c=O3,x:h=0,y:p=0,opacity:g=0}={}){const x=getComputedStyle(n),s=+x.opacity,M=x.transform==="none"?"":x.transform,C=s*(1-g),[D,F]=qx(h),[V,X]=qx(p);return{delay:i,duration:o,easing:c,css:(W,J)=>`
			transform: ${M} translate(${(1-W)*D}${F}, ${(1-W)*V}${X});
			opacity: ${s-C*J}`}}function Cj(n,{delay:i=0,duration:o=400,easing:c=O3,axis:h="y"}={}){const p=getComputedStyle(n),g=+p.opacity,x=h==="y"?"height":"width",s=parseFloat(p[x]),M=h==="y"?["top","bottom"]:["left","right"],C=M.map($=>`${$[0].toUpperCase()}${$.slice(1)}`),D=parseFloat(p[`padding${C[0]}`]),F=parseFloat(p[`padding${C[1]}`]),V=parseFloat(p[`margin${C[0]}`]),X=parseFloat(p[`margin${C[1]}`]),W=parseFloat(p[`border${C[0]}Width`]),J=parseFloat(p[`border${C[1]}Width`]);return{delay:i,duration:o,easing:c,css:$=>`overflow: hidden;opacity: ${Math.min($*20,1)*g};${x}: ${$*s}px;padding-${M[0]}: ${$*D}px;padding-${M[1]}: ${$*F}px;margin-${M[0]}: ${$*V}px;margin-${M[1]}: ${$*X}px;border-${M[0]}-width: ${$*W}px;border-${M[1]}-width: ${$*J}px;`}}function SC(n,i,o){let c="",h=!0;o=o||new Date(2020,0,1,0,0,0,0);let p=o.getFullYear(),g=o.getMonth(),x=o.getDate(),s=o.getHours(),M=o.getMinutes(),C=o.getSeconds();const D=o.getMilliseconds();function F(J){for(let $=0;$<J.length;$++)if(n.startsWith(J[$]))n=n.slice(1);else{h=!1,n.length===0&&(c=J.slice($));return}}function V(J,$,ne){const ye=n.match(J);if(ye!=null&&ye[0]){n=n.slice(ye[0].length);const pe=parseInt(ye[0]);return pe>ne||pe<$?(h=!1,null):pe}else return h=!1,null}function X(J){if(typeof J=="string")F(J);else if(J.id==="yy"){const $=V(/^[0-9]{2}/,0,99);$!==null&&(p=2e3+$)}else if(J.id==="yyyy"){const $=V(/^[0-9]{4}/,0,9999);$!==null&&(p=$)}else if(J.id==="MM"){const $=V(/^[0-9]{2}/,1,12);$!==null&&(g=$-1)}else if(J.id==="dd"){const $=V(/^[0-9]{2}/,1,31);$!==null&&(x=$)}else if(J.id==="HH"){const $=V(/^[0-9]{2}/,0,23);$!==null&&(s=$)}else if(J.id==="mm"){const $=V(/^[0-9]{2}/,0,59);$!==null&&(M=$)}else if(J.id==="ss"){const $=V(/^[0-9]{2}/,0,59);$!==null&&(C=$)}}for(const J of i)if(X(J),!h)break;const W=om(p,g);return x>W&&(h=!1),{date:h?new Date(p,g,x,s,M,C,D):null,missingPunctuation:c}}function wp(n){return("0"+n.toString()).slice(-2)}const Pj=[{id:"yyyy",toString:n=>n.getFullYear().toString()},{id:"yy",toString:n=>n.getFullYear().toString().slice(-2)},{id:"MM",toString:n=>wp(n.getMonth()+1)},{id:"dd",toString:n=>wp(n.getDate())},{id:"HH",toString:n=>wp(n.getHours())},{id:"mm",toString:n=>wp(n.getMinutes())},{id:"ss",toString:n=>wp(n.getSeconds())}];function kj(n){for(const i of Pj)if(n.startsWith(i.id))return i}function MC(n){const i=[];for(;n.length>0;){const o=kj(n);o?(i.push(o),n=n.slice(o.id.length)):typeof i[i.length-1]=="string"?(i[i.length-1]+=n[0],n=n.slice(1)):(i.push(n[0]),n=n.slice(1))}return i}function EC(n){let i,o,c,h,p=`${n[18]}px`,g;function x(M){n[34](M)}let s={min:n[3],max:n[4],locale:n[10],browseWithoutSelecting:n[11],timePrecision:n[12],$$slots:{default:[Dj]},$$scope:{ctx:n}};return n[14]!==void 0&&(s.value=n[14]),o=new Ej({props:s}),Za.push(()=>bP(o,"value",x)),o.$on("focusout",n[21]),o.$on("select",n[23]),{c(){i=Di("div"),Fy(o.$$.fragment),this.h()},l(M){i=Vi(M,"DIV",{class:!0});var C=ot(i);By(o.$$.fragment,C),C.forEach(De),this.h()},h(){xe(i,"class","picker svelte-1vabmef"),Ri(i,"visible",n[2]),Ri(i,"above",n[17]),xE(i,"--picker-left-position",p)},m(M,C){Ai(M,i,C),dm(o,i,null),n[35](i),g=!0},p(M,C){const D={};C[0]&8&&(D.min=M[3]),C[0]&16&&(D.max=M[4]),C[0]&1024&&(D.locale=M[10]),C[0]&2048&&(D.browseWithoutSelecting=M[11]),C[0]&4096&&(D.timePrecision=M[12]),C[1]&32&&(D.$$scope={dirty:C,ctx:M}),!c&&C[0]&16384&&(c=!0,D.value=M[14],vP(()=>c=!1)),o.$set(D),(!g||C[0]&4)&&Ri(i,"visible",M[2]),(!g||C[0]&131072)&&Ri(i,"above",M[17]),C[0]&262144&&p!==(p=`${M[18]}px`)&&xE(i,"--picker-left-position",p)},i(M){g||(no(o.$$.fragment,M),M&&jf(()=>{g&&(h||(h=Q_(i,n[24],{},!0)),h.run(1))}),g=!0)},o(M){Fo(o.$$.fragment,M),M&&(h||(h=Q_(i,n[24],{},!1)),h.run(0)),g=!1},d(M){M&&De(i),pm(o),n[35](null),M&&h&&h.end()}}}function Dj(n){let i;const o=n[29].default,c=cm(o,n,n[36],null);return{c(){c&&c.c()},l(h){c&&c.l(h)},m(h,p){c&&c.m(h,p),i=!0},p(h,p){c&&c.p&&(!i||p[1]&32)&&hm(c,o,h,h[36],i?um(o,h[36],p,null):fm(h[36]),null)},i(h){i||(no(c,h),i=!0)},o(h){Fo(c,h),i=!1},d(h){c&&c.d(h)}}}function Lj(n){let i,o,c,h,p,g,x,s=n[2]&&!n[7]&&EC(n);return{c(){i=Di("div"),o=Di("input"),c=zr(),s&&s.c(),this.h()},l(M){i=Vi(M,"DIV",{class:!0});var C=ot(i);o=Vi(C,"INPUT",{type:!0,id:!0,placeholder:!0,class:!0}),c=Fr(C),s&&s.l(C),C.forEach(De),this.h()},h(){xe(o,"type","text"),o.value=n[0],xe(o,"id",n[5]),xe(o,"placeholder",n[6]),o.disabled=n[7],o.required=n[8],xe(o,"class","svelte-1vabmef"),Ri(o,"invalid",!n[1]),xe(i,"class",h="date-time-field "+n[9]+" svelte-1vabmef")},m(M,C){Ai(M,i,C),it(i,o),n[30](o),it(i,c),s&&s.m(i,null),p=!0,g||(x=[Pt(o,"focus",n[31]),Pt(o,"mousedown",n[32]),Pt(o,"input",n[33]),Pt(i,"focusout",n[21]),Pt(i,"keydown",n[22])],g=!0)},p(M,C){(!p||C[0]&1&&o.value!==M[0])&&(o.value=M[0]),(!p||C[0]&32)&&xe(o,"id",M[5]),(!p||C[0]&64)&&xe(o,"placeholder",M[6]),(!p||C[0]&128)&&(o.disabled=M[7]),(!p||C[0]&256)&&(o.required=M[8]),(!p||C[0]&2)&&Ri(o,"invalid",!M[1]),M[2]&&!M[7]?s?(s.p(M,C),C[0]&132&&no(s,1)):(s=EC(M),s.c(),no(s,1),s.m(i,null)):s&&(Ry(),Fo(s,1,1,()=>{s=null}),zy()),(!p||C[0]&512&&h!==(h="date-time-field "+M[9]+" svelte-1vabmef"))&&xe(i,"class",h)},i(M){p||(no(s),p=!0)},o(M){Fo(s),p=!1},d(M){M&&De(i),n[30](null),s&&s.d(),g=!1,Br(x)}}}function Oj(n,i,o){let c,h,{$$slots:p={},$$scope:g}=i;const x=j1(),s=new Date,M=mm(null);Wx(n,M,Ze=>o(37,h=Ze));const C={subscribe:M.subscribe,set:Ze=>{Ze==null?(M.set(null),o(25,D=Ze)):Ze.getTime()!==(h==null?void 0:h.getTime())&&(M.set(Ze),o(25,D=Ze))}};Wx(n,C,Ze=>o(14,c=Ze));let{value:D=null}=i,{min:F=new Date(s.getFullYear()-20,0,1)}=i,{max:V=new Date(s.getFullYear(),11,31,23,59,59,999)}=i,{id:X=null}=i,{placeholder:W="2020-12-31 23:00:00"}=i,{valid:J=!0}=i,{disabled:$=!1}=i,{required:ne=!1}=i,{class:ye=""}=i,{format:pe="yyyy-MM-dd HH:mm:ss"}=i,ke=MC(pe),{locale:Ae={}}=i;function tt(Ze,wn){o(0,pt=lC(Ze,wn))}let{text:pt=lC(c,ke)}=i;function kt(Ze,wn){if(Ze.length){const Sr=SC(Ze,wn,c);Sr.date!==null?(o(1,J=!0),C.set(Sr.date)):o(1,J=!1)}else o(1,J=!0),D&&(o(25,D=null),C.set(null))}let{visible:Ie=!1}=i,{closeOnSelection:Et=!1}=i,{browseWithoutSelecting:mt=!1}=i,{timePrecision:Xe=null}=i;function Tt(Ze){(Ze==null?void 0:Ze.currentTarget)instanceof HTMLElement&&Ze.relatedTarget&&Ze.relatedTarget instanceof Node&&Ze.currentTarget.contains(Ze.relatedTarget)||o(2,Ie=!1)}function Yt(Ze){Ze.key==="Escape"&&Ie?(o(2,Ie=!1),Ze.preventDefault(),Ze.stopPropagation()):Ze.key==="Enter"&&(o(2,Ie=!Ie),Ze.preventDefault())}function mi(Ze){x("select",Ze.detail),Et&&o(2,Ie=!1)}let{dynamicPositioning:Ti=!1}=i,Zi,wt,Ii=!1,Ui=null;function Mi(){if(o(17,Ii=!1),o(18,Ui=null),Ie&&wt&&Ti){const Ze=Zi.getBoundingClientRect(),wn=wt.offsetWidth-Ze.width,Sr=Ze.bottom+wt.offsetHeight+5,Mr=Ze.left+wt.offsetWidth+5;if(Sr>window.innerHeight&&o(17,Ii=!0),Mr>window.innerWidth&&(o(18,Ui=-wn),Ze.left<wn+5)){const Bt=window.innerWidth/2-wt.offsetWidth/2;o(18,Ui=Bt-Ze.left)}}}function st(Ze){return Mi(),R3(Ze,{duration:200,easing:L3,y:Ii?5:-5})}function rt(Ze){Za[Ze?"unshift":"push"](()=>{Zi=Ze,o(15,Zi)})}const zi=()=>o(2,Ie=!0),Si=()=>o(2,Ie=!0),bn=Ze=>{if(Ze instanceof InputEvent&&Ze.inputType==="insertText"&&typeof Ze.data=="string"&&Ze.currentTarget.value===pt+Ze.data){let wn=SC(pt,ke,c);if(wn.missingPunctuation!==""&&!wn.missingPunctuation.startsWith(Ze.data)){o(0,pt=pt+wn.missingPunctuation+Ze.data);return}}o(0,pt=Ze.currentTarget.value)};function nn(Ze){c=Ze,C.set(c)}function hn(Ze){Za[Ze?"unshift":"push"](()=>{wt=Ze,o(16,wt)})}return n.$$set=Ze=>{"value"in Ze&&o(25,D=Ze.value),"min"in Ze&&o(3,F=Ze.min),"max"in Ze&&o(4,V=Ze.max),"id"in Ze&&o(5,X=Ze.id),"placeholder"in Ze&&o(6,W=Ze.placeholder),"valid"in Ze&&o(1,J=Ze.valid),"disabled"in Ze&&o(7,$=Ze.disabled),"required"in Ze&&o(8,ne=Ze.required),"class"in Ze&&o(9,ye=Ze.class),"format"in Ze&&o(26,pe=Ze.format),"locale"in Ze&&o(10,Ae=Ze.locale),"text"in Ze&&o(0,pt=Ze.text),"visible"in Ze&&o(2,Ie=Ze.visible),"closeOnSelection"in Ze&&o(27,Et=Ze.closeOnSelection),"browseWithoutSelecting"in Ze&&o(11,mt=Ze.browseWithoutSelecting),"timePrecision"in Ze&&o(12,Xe=Ze.timePrecision),"dynamicPositioning"in Ze&&o(28,Ti=Ze.dynamicPositioning),"$$scope"in Ze&&o(36,g=Ze.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&33554432&&C.set(D),n.$$.dirty[0]&67108864&&o(13,ke=MC(pe)),n.$$.dirty[0]&24576&&tt(c,ke),n.$$.dirty[0]&8193&&kt(pt,ke)},[pt,J,Ie,F,V,X,W,$,ne,ye,Ae,mt,Xe,ke,c,Zi,wt,Ii,Ui,M,C,Tt,Yt,mi,st,D,pe,Et,Ti,p,rt,zi,Si,bn,nn,hn,g]}class mq extends No{constructor(i){super(),Bo(this,i,Oj,Lj,Ao,{value:25,min:3,max:4,id:5,placeholder:6,valid:1,disabled:7,required:8,class:9,format:26,locale:10,text:0,visible:2,closeOnSelection:27,browseWithoutSelecting:11,timePrecision:12,dynamicPositioning:28},null,[-1,-1])}}const Cb="-";function Rj(n){const i=Fj(n),{conflictingClassGroups:o,conflictingClassGroupModifiers:c}=n;function h(g){const x=g.split(Cb);return x[0]===""&&x.length!==1&&x.shift(),z3(x,i)||zj(g)}function p(g,x){const s=o[g]||[];return x&&c[g]?[...s,...c[g]]:s}return{getClassGroupId:h,getConflictingClassGroupIds:p}}function z3(n,i){var g;if(n.length===0)return i.classGroupId;const o=n[0],c=i.nextPart.get(o),h=c?z3(n.slice(1),c):void 0;if(h)return h;if(i.validators.length===0)return;const p=n.join(Cb);return(g=i.validators.find(({validator:x})=>x(p)))==null?void 0:g.classGroupId}const AC=/^\[(.+)\]$/;function zj(n){if(AC.test(n)){const i=AC.exec(n)[1],o=i==null?void 0:i.substring(0,i.indexOf(":"));if(o)return"arbitrary.."+o}}function Fj(n){const{theme:i,prefix:o}=n,c={nextPart:new Map,validators:[]};return Nj(Object.entries(n.classGroups),o).forEach(([p,g])=>{P1(g,c,p,i)}),c}function P1(n,i,o,c){n.forEach(h=>{if(typeof h=="string"){const p=h===""?i:IC(i,h);p.classGroupId=o;return}if(typeof h=="function"){if(Bj(h)){P1(h(c),i,o,c);return}i.validators.push({validator:h,classGroupId:o});return}Object.entries(h).forEach(([p,g])=>{P1(g,IC(i,p),o,c)})})}function IC(n,i){let o=n;return i.split(Cb).forEach(c=>{o.nextPart.has(c)||o.nextPart.set(c,{nextPart:new Map,validators:[]}),o=o.nextPart.get(c)}),o}function Bj(n){return n.isThemeGetter}function Nj(n,i){return i?n.map(([o,c])=>{const h=c.map(p=>typeof p=="string"?i+p:typeof p=="object"?Object.fromEntries(Object.entries(p).map(([g,x])=>[i+g,x])):p);return[o,h]}):n}function Vj(n){if(n<1)return{get:()=>{},set:()=>{}};let i=0,o=new Map,c=new Map;function h(p,g){o.set(p,g),i++,i>n&&(i=0,c=o,o=new Map)}return{get(p){let g=o.get(p);if(g!==void 0)return g;if((g=c.get(p))!==void 0)return h(p,g),g},set(p,g){o.has(p)?o.set(p,g):h(p,g)}}}const F3="!";function Uj(n){const i=n.separator,o=i.length===1,c=i[0],h=i.length;return function(g){const x=[];let s=0,M=0,C;for(let W=0;W<g.length;W++){let J=g[W];if(s===0){if(J===c&&(o||g.slice(W,W+h)===i)){x.push(g.slice(M,W)),M=W+h;continue}if(J==="/"){C=W;continue}}J==="["?s++:J==="]"&&s--}const D=x.length===0?g:g.substring(M),F=D.startsWith(F3),V=F?D.substring(1):D,X=C&&C>M?C-M:void 0;return{modifiers:x,hasImportantModifier:F,baseClassName:V,maybePostfixModifierPosition:X}}}function jj(n){if(n.length<=1)return n;const i=[];let o=[];return n.forEach(c=>{c[0]==="["?(i.push(...o.sort(),c),o=[]):o.push(c)}),i.push(...o.sort()),i}function Gj(n){return{cache:Vj(n.cacheSize),splitModifiers:Uj(n),...Rj(n)}}const Hj=/\s+/;function Wj(n,i){const{splitModifiers:o,getClassGroupId:c,getConflictingClassGroupIds:h}=i,p=new Set;return n.trim().split(Hj).map(g=>{const{modifiers:x,hasImportantModifier:s,baseClassName:M,maybePostfixModifierPosition:C}=o(g);let D=c(C?M.substring(0,C):M),F=!!C;if(!D){if(!C)return{isTailwindClass:!1,originalClassName:g};if(D=c(M),!D)return{isTailwindClass:!1,originalClassName:g};F=!1}const V=jj(x).join(":");return{isTailwindClass:!0,modifierId:s?V+F3:V,classGroupId:D,originalClassName:g,hasPostfixModifier:F}}).reverse().filter(g=>{if(!g.isTailwindClass)return!0;const{modifierId:x,classGroupId:s,hasPostfixModifier:M}=g,C=x+s;return p.has(C)?!1:(p.add(C),h(s,M).forEach(D=>p.add(x+D)),!0)}).reverse().map(g=>g.originalClassName).join(" ")}function qj(){let n=0,i,o,c="";for(;n<arguments.length;)(i=arguments[n++])&&(o=B3(i))&&(c&&(c+=" "),c+=o);return c}function B3(n){if(typeof n=="string")return n;let i,o="";for(let c=0;c<n.length;c++)n[c]&&(i=B3(n[c]))&&(o&&(o+=" "),o+=i);return o}function Zj(n,...i){let o,c,h,p=g;function g(s){const M=i.reduce((C,D)=>D(C),n());return o=Gj(M),c=o.cache.get,h=o.cache.set,p=x,x(s)}function x(s){const M=c(s);if(M)return M;const C=Wj(s,o);return h(s,C),C}return function(){return p(qj.apply(null,arguments))}}function Pr(n){const i=o=>o[n]||[];return i.isThemeGetter=!0,i}const N3=/^\[(?:([a-z-]+):)?(.+)\]$/i,Xj=/^\d+\/\d+$/,Yj=new Set(["px","full","screen"]),Jj=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Kj=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Qj=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,$j=/^-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,e7=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/;function fc(n){return wh(n)||Yj.has(n)||Xj.test(n)}function ru(n){return od(n,"length",l7)}function wh(n){return!!n&&!Number.isNaN(Number(n))}function b_(n){return od(n,"number",wh)}function Tp(n){return!!n&&Number.isInteger(Number(n))}function t7(n){return n.endsWith("%")&&wh(n.slice(0,-1))}function gn(n){return N3.test(n)}function ou(n){return Jj.test(n)}const i7=new Set(["length","size","percentage"]);function n7(n){return od(n,i7,V3)}function r7(n){return od(n,"position",V3)}const o7=new Set(["image","url"]);function s7(n){return od(n,o7,u7)}function a7(n){return od(n,"",c7)}function Sp(){return!0}function od(n,i,o){const c=N3.exec(n);return c?c[1]?typeof i=="string"?c[1]===i:i.has(c[1]):o(c[2]):!1}function l7(n){return Kj.test(n)&&!Qj.test(n)}function V3(){return!1}function c7(n){return $j.test(n)}function u7(n){return e7.test(n)}function h7(){const n=Pr("colors"),i=Pr("spacing"),o=Pr("blur"),c=Pr("brightness"),h=Pr("borderColor"),p=Pr("borderRadius"),g=Pr("borderSpacing"),x=Pr("borderWidth"),s=Pr("contrast"),M=Pr("grayscale"),C=Pr("hueRotate"),D=Pr("invert"),F=Pr("gap"),V=Pr("gradientColorStops"),X=Pr("gradientColorStopPositions"),W=Pr("inset"),J=Pr("margin"),$=Pr("opacity"),ne=Pr("padding"),ye=Pr("saturate"),pe=Pr("scale"),ke=Pr("sepia"),Ae=Pr("skew"),tt=Pr("space"),pt=Pr("translate"),kt=()=>["auto","contain","none"],Ie=()=>["auto","hidden","clip","visible","scroll"],Et=()=>["auto",gn,i],mt=()=>[gn,i],Xe=()=>["",fc,ru],Tt=()=>["auto",wh,gn],Yt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],mi=()=>["solid","dashed","dotted","double","none"],Ti=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter"],Zi=()=>["start","end","center","between","around","evenly","stretch"],wt=()=>["","0",gn],Ii=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Ui=()=>[wh,b_],Mi=()=>[wh,gn];return{cacheSize:500,separator:":",theme:{colors:[Sp],spacing:[fc,ru],blur:["none","",ou,gn],brightness:Ui(),borderColor:[n],borderRadius:["none","","full",ou,gn],borderSpacing:mt(),borderWidth:Xe(),contrast:Ui(),grayscale:wt(),hueRotate:Mi(),invert:wt(),gap:mt(),gradientColorStops:[n],gradientColorStopPositions:[t7,ru],inset:Et(),margin:Et(),opacity:Ui(),padding:mt(),saturate:Ui(),scale:Ui(),sepia:wt(),skew:Mi(),space:mt(),translate:mt()},classGroups:{aspect:[{aspect:["auto","square","video",gn]}],container:["container"],columns:[{columns:[ou]}],"break-after":[{"break-after":Ii()}],"break-before":[{"break-before":Ii()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Yt(),gn]}],overflow:[{overflow:Ie()}],"overflow-x":[{"overflow-x":Ie()}],"overflow-y":[{"overflow-y":Ie()}],overscroll:[{overscroll:kt()}],"overscroll-x":[{"overscroll-x":kt()}],"overscroll-y":[{"overscroll-y":kt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[W]}],"inset-x":[{"inset-x":[W]}],"inset-y":[{"inset-y":[W]}],start:[{start:[W]}],end:[{end:[W]}],top:[{top:[W]}],right:[{right:[W]}],bottom:[{bottom:[W]}],left:[{left:[W]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Tp,gn]}],basis:[{basis:Et()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",gn]}],grow:[{grow:wt()}],shrink:[{shrink:wt()}],order:[{order:["first","last","none",Tp,gn]}],"grid-cols":[{"grid-cols":[Sp]}],"col-start-end":[{col:["auto",{span:["full",Tp,gn]},gn]}],"col-start":[{"col-start":Tt()}],"col-end":[{"col-end":Tt()}],"grid-rows":[{"grid-rows":[Sp]}],"row-start-end":[{row:["auto",{span:[Tp,gn]},gn]}],"row-start":[{"row-start":Tt()}],"row-end":[{"row-end":Tt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",gn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",gn]}],gap:[{gap:[F]}],"gap-x":[{"gap-x":[F]}],"gap-y":[{"gap-y":[F]}],"justify-content":[{justify:["normal",...Zi()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Zi(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Zi(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[ne]}],px:[{px:[ne]}],py:[{py:[ne]}],ps:[{ps:[ne]}],pe:[{pe:[ne]}],pt:[{pt:[ne]}],pr:[{pr:[ne]}],pb:[{pb:[ne]}],pl:[{pl:[ne]}],m:[{m:[J]}],mx:[{mx:[J]}],my:[{my:[J]}],ms:[{ms:[J]}],me:[{me:[J]}],mt:[{mt:[J]}],mr:[{mr:[J]}],mb:[{mb:[J]}],ml:[{ml:[J]}],"space-x":[{"space-x":[tt]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[tt]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",gn,i]}],"min-w":[{"min-w":[gn,i,"min","max","fit"]}],"max-w":[{"max-w":[gn,i,"none","full","min","max","fit","prose",{screen:[ou]},ou]}],h:[{h:[gn,i,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[gn,i,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[gn,i,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[gn,i,"auto","min","max","fit"]}],"font-size":[{text:["base",ou,ru]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",b_]}],"font-family":[{font:[Sp]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",gn]}],"line-clamp":[{"line-clamp":["none",wh,b_]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",fc,gn]}],"list-image":[{"list-image":["none",gn]}],"list-style-type":[{list:["none","disc","decimal",gn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[n]}],"placeholder-opacity":[{"placeholder-opacity":[$]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[n]}],"text-opacity":[{"text-opacity":[$]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...mi(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",fc,ru]}],"underline-offset":[{"underline-offset":["auto",fc,gn]}],"text-decoration-color":[{decoration:[n]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:mt()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",gn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",gn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[$]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Yt(),r7]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",n7]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},s7]}],"bg-color":[{bg:[n]}],"gradient-from-pos":[{from:[X]}],"gradient-via-pos":[{via:[X]}],"gradient-to-pos":[{to:[X]}],"gradient-from":[{from:[V]}],"gradient-via":[{via:[V]}],"gradient-to":[{to:[V]}],rounded:[{rounded:[p]}],"rounded-s":[{"rounded-s":[p]}],"rounded-e":[{"rounded-e":[p]}],"rounded-t":[{"rounded-t":[p]}],"rounded-r":[{"rounded-r":[p]}],"rounded-b":[{"rounded-b":[p]}],"rounded-l":[{"rounded-l":[p]}],"rounded-ss":[{"rounded-ss":[p]}],"rounded-se":[{"rounded-se":[p]}],"rounded-ee":[{"rounded-ee":[p]}],"rounded-es":[{"rounded-es":[p]}],"rounded-tl":[{"rounded-tl":[p]}],"rounded-tr":[{"rounded-tr":[p]}],"rounded-br":[{"rounded-br":[p]}],"rounded-bl":[{"rounded-bl":[p]}],"border-w":[{border:[x]}],"border-w-x":[{"border-x":[x]}],"border-w-y":[{"border-y":[x]}],"border-w-s":[{"border-s":[x]}],"border-w-e":[{"border-e":[x]}],"border-w-t":[{"border-t":[x]}],"border-w-r":[{"border-r":[x]}],"border-w-b":[{"border-b":[x]}],"border-w-l":[{"border-l":[x]}],"border-opacity":[{"border-opacity":[$]}],"border-style":[{border:[...mi(),"hidden"]}],"divide-x":[{"divide-x":[x]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[x]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[$]}],"divide-style":[{divide:mi()}],"border-color":[{border:[h]}],"border-color-x":[{"border-x":[h]}],"border-color-y":[{"border-y":[h]}],"border-color-t":[{"border-t":[h]}],"border-color-r":[{"border-r":[h]}],"border-color-b":[{"border-b":[h]}],"border-color-l":[{"border-l":[h]}],"divide-color":[{divide:[h]}],"outline-style":[{outline:["",...mi()]}],"outline-offset":[{"outline-offset":[fc,gn]}],"outline-w":[{outline:[fc,ru]}],"outline-color":[{outline:[n]}],"ring-w":[{ring:Xe()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[n]}],"ring-opacity":[{"ring-opacity":[$]}],"ring-offset-w":[{"ring-offset":[fc,ru]}],"ring-offset-color":[{"ring-offset":[n]}],shadow:[{shadow:["","inner","none",ou,a7]}],"shadow-color":[{shadow:[Sp]}],opacity:[{opacity:[$]}],"mix-blend":[{"mix-blend":Ti()}],"bg-blend":[{"bg-blend":Ti()}],filter:[{filter:["","none"]}],blur:[{blur:[o]}],brightness:[{brightness:[c]}],contrast:[{contrast:[s]}],"drop-shadow":[{"drop-shadow":["","none",ou,gn]}],grayscale:[{grayscale:[M]}],"hue-rotate":[{"hue-rotate":[C]}],invert:[{invert:[D]}],saturate:[{saturate:[ye]}],sepia:[{sepia:[ke]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[o]}],"backdrop-brightness":[{"backdrop-brightness":[c]}],"backdrop-contrast":[{"backdrop-contrast":[s]}],"backdrop-grayscale":[{"backdrop-grayscale":[M]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[C]}],"backdrop-invert":[{"backdrop-invert":[D]}],"backdrop-opacity":[{"backdrop-opacity":[$]}],"backdrop-saturate":[{"backdrop-saturate":[ye]}],"backdrop-sepia":[{"backdrop-sepia":[ke]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[g]}],"border-spacing-x":[{"border-spacing-x":[g]}],"border-spacing-y":[{"border-spacing-y":[g]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",gn]}],duration:[{duration:Mi()}],ease:[{ease:["linear","in","out","in-out",gn]}],delay:[{delay:Mi()}],animate:[{animate:["none","spin","ping","pulse","bounce",gn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[pe]}],"scale-x":[{"scale-x":[pe]}],"scale-y":[{"scale-y":[pe]}],rotate:[{rotate:[Tp,gn]}],"translate-x":[{"translate-x":[pt]}],"translate-y":[{"translate-y":[pt]}],"skew-x":[{"skew-x":[Ae]}],"skew-y":[{"skew-y":[Ae]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",gn]}],accent:[{accent:["auto",n]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",gn]}],"caret-color":[{caret:[n]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":mt()}],"scroll-mx":[{"scroll-mx":mt()}],"scroll-my":[{"scroll-my":mt()}],"scroll-ms":[{"scroll-ms":mt()}],"scroll-me":[{"scroll-me":mt()}],"scroll-mt":[{"scroll-mt":mt()}],"scroll-mr":[{"scroll-mr":mt()}],"scroll-mb":[{"scroll-mb":mt()}],"scroll-ml":[{"scroll-ml":mt()}],"scroll-p":[{"scroll-p":mt()}],"scroll-px":[{"scroll-px":mt()}],"scroll-py":[{"scroll-py":mt()}],"scroll-ps":[{"scroll-ps":mt()}],"scroll-pe":[{"scroll-pe":mt()}],"scroll-pt":[{"scroll-pt":mt()}],"scroll-pr":[{"scroll-pr":mt()}],"scroll-pb":[{"scroll-pb":mt()}],"scroll-pl":[{"scroll-pl":mt()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",gn]}],fill:[{fill:[n,"none"]}],"stroke-w":[{stroke:[fc,ru,b_]}],stroke:[{stroke:[n,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}}const xa=Zj(h7);function f7(n){let i,o,c,h,p,g=[{xmlns:"http://www.w3.org/2000/svg"},{fill:"none"},n[7],{class:c=xa("shrink-0",n[6][n[0]],n[8].class)},{role:n[1]},{"aria-label":n[5]},{viewBox:"0 0 24 24"}],x={};for(let s=0;s<g.length;s+=1)x=zn(x,g[s]);return{c(){i=Xt("svg"),o=Xt("path"),this.h()},l(s){i=Kt(s,"svg",{xmlns:!0,fill:!0,class:!0,role:!0,"aria-label":!0,viewBox:!0});var M=ot(i);o=Kt(M,"path",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),ot(o).forEach(De),M.forEach(De),this.h()},h(){xe(o,"stroke","currentColor"),xe(o,"stroke-linecap",n[2]),xe(o,"stroke-linejoin",n[3]),xe(o,"stroke-width",n[4]),xe(o,"d","M16 16.9V7a1 1 0 0 0-1.6-.8l-6 5a1 1 0 0 0 0 1.5l6 4.9a1 1 0 0 0 1.6-.8Z"),is(i,x)},m(s,M){Ai(s,i,M),it(i,o),h||(p=[Pt(i,"click",n[9]),Pt(i,"keydown",n[10]),Pt(i,"keyup",n[11]),Pt(i,"focus",n[12]),Pt(i,"blur",n[13]),Pt(i,"mouseenter",n[14]),Pt(i,"mouseleave",n[15]),Pt(i,"mouseover",n[16]),Pt(i,"mouseout",n[17])],h=!0)},p(s,[M]){M&4&&xe(o,"stroke-linecap",s[2]),M&8&&xe(o,"stroke-linejoin",s[3]),M&16&&xe(o,"stroke-width",s[4]),is(i,x=ba(g,[{xmlns:"http://www.w3.org/2000/svg"},{fill:"none"},M&128&&s[7],M&257&&c!==(c=xa("shrink-0",s[6][s[0]],s[8].class))&&{class:c},M&2&&{role:s[1]},M&32&&{"aria-label":s[5]},{viewBox:"0 0 24 24"}]))},i:Rn,o:Rn,d(s){s&&De(i),h=!1,Br(p)}}}function d7(n,i,o){const c=["size","role","strokeLinecap","strokeLinejoin","strokeWidth","ariaLabel"];let h=qr(i,c);const p=Ec("iconCtx")??{},g={xs:"w-3 h-3",sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6",xl:"w-8 h-8"};let{size:x=p.size||"md"}=i,{role:s=p.role||"img"}=i,{strokeLinecap:M=p.strokeLinecap||"round"}=i,{strokeLinejoin:C=p.strokeLinejoin||"round"}=i,{strokeWidth:D=p.strokeWidth||"2"}=i,{ariaLabel:F="caret left outline"}=i;function V(Ae){bi.call(this,n,Ae)}function X(Ae){bi.call(this,n,Ae)}function W(Ae){bi.call(this,n,Ae)}function J(Ae){bi.call(this,n,Ae)}function $(Ae){bi.call(this,n,Ae)}function ne(Ae){bi.call(this,n,Ae)}function ye(Ae){bi.call(this,n,Ae)}function pe(Ae){bi.call(this,n,Ae)}function ke(Ae){bi.call(this,n,Ae)}return n.$$set=Ae=>{o(8,i=zn(zn({},i),zo(Ae))),o(7,h=qr(i,c)),"size"in Ae&&o(0,x=Ae.size),"role"in Ae&&o(1,s=Ae.role),"strokeLinecap"in Ae&&o(2,M=Ae.strokeLinecap),"strokeLinejoin"in Ae&&o(3,C=Ae.strokeLinejoin),"strokeWidth"in Ae&&o(4,D=Ae.strokeWidth),"ariaLabel"in Ae&&o(5,F=Ae.ariaLabel)},i=zo(i),[x,s,M,C,D,F,g,h,i,V,X,W,J,$,ne,ye,pe,ke]}class gq extends No{constructor(i){super(),Bo(this,i,d7,f7,Ao,{size:0,role:1,strokeLinecap:2,strokeLinejoin:3,strokeWidth:4,ariaLabel:5})}}function p7(n){let i,o,c,h,p,g=[{xmlns:"http://www.w3.org/2000/svg"},{fill:"none"},n[7],{class:c=xa("shrink-0",n[6][n[0]],n[8].class)},{role:n[1]},{"aria-label":n[5]},{viewBox:"0 0 24 24"}],x={};for(let s=0;s<g.length;s+=1)x=zn(x,g[s]);return{c(){i=Xt("svg"),o=Xt("path"),this.h()},l(s){i=Kt(s,"svg",{xmlns:!0,fill:!0,class:!0,role:!0,"aria-label":!0,viewBox:!0});var M=ot(i);o=Kt(M,"path",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),ot(o).forEach(De),M.forEach(De),this.h()},h(){xe(o,"stroke","currentColor"),xe(o,"stroke-linecap",n[2]),xe(o,"stroke-linejoin",n[3]),xe(o,"stroke-width",n[4]),xe(o,"d","M8 16.9V7a1 1 0 0 1 1.6-.8l6 5a1 1 0 0 1 0 1.5l-6 4.9a1 1 0 0 1-1.6-.8Z"),is(i,x)},m(s,M){Ai(s,i,M),it(i,o),h||(p=[Pt(i,"click",n[9]),Pt(i,"keydown",n[10]),Pt(i,"keyup",n[11]),Pt(i,"focus",n[12]),Pt(i,"blur",n[13]),Pt(i,"mouseenter",n[14]),Pt(i,"mouseleave",n[15]),Pt(i,"mouseover",n[16]),Pt(i,"mouseout",n[17])],h=!0)},p(s,[M]){M&4&&xe(o,"stroke-linecap",s[2]),M&8&&xe(o,"stroke-linejoin",s[3]),M&16&&xe(o,"stroke-width",s[4]),is(i,x=ba(g,[{xmlns:"http://www.w3.org/2000/svg"},{fill:"none"},M&128&&s[7],M&257&&c!==(c=xa("shrink-0",s[6][s[0]],s[8].class))&&{class:c},M&2&&{role:s[1]},M&32&&{"aria-label":s[5]},{viewBox:"0 0 24 24"}]))},i:Rn,o:Rn,d(s){s&&De(i),h=!1,Br(p)}}}function m7(n,i,o){const c=["size","role","strokeLinecap","strokeLinejoin","strokeWidth","ariaLabel"];let h=qr(i,c);const p=Ec("iconCtx")??{},g={xs:"w-3 h-3",sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6",xl:"w-8 h-8"};let{size:x=p.size||"md"}=i,{role:s=p.role||"img"}=i,{strokeLinecap:M=p.strokeLinecap||"round"}=i,{strokeLinejoin:C=p.strokeLinejoin||"round"}=i,{strokeWidth:D=p.strokeWidth||"2"}=i,{ariaLabel:F="caret right outline"}=i;function V(Ae){bi.call(this,n,Ae)}function X(Ae){bi.call(this,n,Ae)}function W(Ae){bi.call(this,n,Ae)}function J(Ae){bi.call(this,n,Ae)}function $(Ae){bi.call(this,n,Ae)}function ne(Ae){bi.call(this,n,Ae)}function ye(Ae){bi.call(this,n,Ae)}function pe(Ae){bi.call(this,n,Ae)}function ke(Ae){bi.call(this,n,Ae)}return n.$$set=Ae=>{o(8,i=zn(zn({},i),zo(Ae))),o(7,h=qr(i,c)),"size"in Ae&&o(0,x=Ae.size),"role"in Ae&&o(1,s=Ae.role),"strokeLinecap"in Ae&&o(2,M=Ae.strokeLinecap),"strokeLinejoin"in Ae&&o(3,C=Ae.strokeLinejoin),"strokeWidth"in Ae&&o(4,D=Ae.strokeWidth),"ariaLabel"in Ae&&o(5,F=Ae.ariaLabel)},i=zo(i),[x,s,M,C,D,F,g,h,i,V,X,W,J,$,ne,ye,pe,ke]}class _q extends No{constructor(i){super(),Bo(this,i,m7,p7,Ao,{size:0,role:1,strokeLinecap:2,strokeLinejoin:3,strokeWidth:4,ariaLabel:5})}}function g7(n){let i,o,c,h,p,g=[{xmlns:"http://www.w3.org/2000/svg"},{fill:"none"},n[4],{class:c=xa("shrink-0",n[3][n[0]],n[5].class)},{role:n[1]},{"aria-label":n[2]},{viewBox:"0 0 24 24"}],x={};for(let s=0;s<g.length;s+=1)x=zn(x,g[s]);return{c(){i=Xt("svg"),o=Xt("path"),this.h()},l(s){i=Kt(s,"svg",{xmlns:!0,fill:!0,class:!0,role:!0,"aria-label":!0,viewBox:!0});var M=ot(i);o=Kt(M,"path",{fill:!0,"fill-rule":!0,d:!0,"clip-rule":!0}),ot(o).forEach(De),M.forEach(De),this.h()},h(){xe(o,"fill","currentColor"),xe(o,"fill-rule","evenodd"),xe(o,"d","M2 12a10 10 0 1 1 20 0 10 10 0 0 1-20 0Zm9.4-5.5a1 1 0 1 0 0 2 1 1 0 1 0 0-2ZM10 10a1 1 0 1 0 0 2h1v3h-1a1 1 0 1 0 0 2h4a1 1 0 1 0 0-2h-1v-4c0-.6-.4-1-1-1h-2Z"),xe(o,"clip-rule","evenodd"),is(i,x)},m(s,M){Ai(s,i,M),it(i,o),h||(p=[Pt(i,"click",n[6]),Pt(i,"keydown",n[7]),Pt(i,"keyup",n[8]),Pt(i,"focus",n[9]),Pt(i,"blur",n[10]),Pt(i,"mouseenter",n[11]),Pt(i,"mouseleave",n[12]),Pt(i,"mouseover",n[13]),Pt(i,"mouseout",n[14])],h=!0)},p(s,[M]){is(i,x=ba(g,[{xmlns:"http://www.w3.org/2000/svg"},{fill:"none"},M&16&&s[4],M&33&&c!==(c=xa("shrink-0",s[3][s[0]],s[5].class))&&{class:c},M&2&&{role:s[1]},M&4&&{"aria-label":s[2]},{viewBox:"0 0 24 24"}]))},i:Rn,o:Rn,d(s){s&&De(i),h=!1,Br(p)}}}function _7(n,i,o){const c=["size","role","ariaLabel"];let h=qr(i,c);const p=Ec("iconCtx")??{},g={xs:"w-3 h-3",sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6",xl:"w-8 h-8"};let{size:x=p.size||"md"}=i,{role:s=p.role||"img"}=i,{ariaLabel:M="info circle solid"}=i;function C(ye){bi.call(this,n,ye)}function D(ye){bi.call(this,n,ye)}function F(ye){bi.call(this,n,ye)}function V(ye){bi.call(this,n,ye)}function X(ye){bi.call(this,n,ye)}function W(ye){bi.call(this,n,ye)}function J(ye){bi.call(this,n,ye)}function $(ye){bi.call(this,n,ye)}function ne(ye){bi.call(this,n,ye)}return n.$$set=ye=>{o(5,i=zn(zn({},i),zo(ye))),o(4,h=qr(i,c)),"size"in ye&&o(0,x=ye.size),"role"in ye&&o(1,s=ye.role),"ariaLabel"in ye&&o(2,M=ye.ariaLabel)},i=zo(i),[x,s,M,g,h,i,C,D,F,V,X,W,J,$,ne]}class yq extends No{constructor(i){super(),Bo(this,i,_7,g7,Ao,{size:0,role:1,ariaLabel:2})}}function W_(n,i){return n==null||i==null?NaN:n<i?-1:n>i?1:n>=i?0:NaN}function y7(n,i){return n==null||i==null?NaN:i<n?-1:i>n?1:i>=n?0:NaN}function U3(n){let i,o,c;n.length!==2?(i=W_,o=(x,s)=>W_(n(x),s),c=(x,s)=>n(x)-s):(i=n===W_||n===y7?n:v7,o=n,c=n);function h(x,s,M=0,C=x.length){if(M<C){if(i(s,s)!==0)return C;do{const D=M+C>>>1;o(x[D],s)<0?M=D+1:C=D}while(M<C)}return M}function p(x,s,M=0,C=x.length){if(M<C){if(i(s,s)!==0)return C;do{const D=M+C>>>1;o(x[D],s)<=0?M=D+1:C=D}while(M<C)}return M}function g(x,s,M=0,C=x.length){const D=h(x,s,M,C-1);return D>M&&c(x[D-1],s)>-c(x[D],s)?D-1:D}return{left:h,center:g,right:p}}function v7(){return 0}function x7(n){return n===null?NaN:+n}const b7=U3(W_),w7=b7.right;U3(x7).center;const T7=Math.sqrt(50),S7=Math.sqrt(10),M7=Math.sqrt(2);function wy(n,i,o){const c=(i-n)/Math.max(0,o),h=Math.floor(Math.log10(c)),p=c/Math.pow(10,h),g=p>=T7?10:p>=S7?5:p>=M7?2:1;let x,s,M;return h<0?(M=Math.pow(10,-h)/g,x=Math.round(n*M),s=Math.round(i*M),x/M<n&&++x,s/M>i&&--s,M=-M):(M=Math.pow(10,h)*g,x=Math.round(n/M),s=Math.round(i/M),x*M<n&&++x,s*M>i&&--s),s<x&&.5<=o&&o<2?wy(n,i,o*2):[x,s,M]}function E7(n,i,o){if(i=+i,n=+n,o=+o,!(o>0))return[];if(n===i)return[n];const c=i<n,[h,p,g]=c?wy(i,n,o):wy(n,i,o);if(!(p>=h))return[];const x=p-h+1,s=new Array(x);if(c)if(g<0)for(let M=0;M<x;++M)s[M]=(p-M)/-g;else for(let M=0;M<x;++M)s[M]=(p-M)*g;else if(g<0)for(let M=0;M<x;++M)s[M]=(h+M)/-g;else for(let M=0;M<x;++M)s[M]=(h+M)*g;return s}function k1(n,i,o){return i=+i,n=+n,o=+o,wy(n,i,o)[2]}function A7(n,i,o){i=+i,n=+n,o=+o;const c=i<n,h=c?k1(i,n,o):k1(n,i,o);return(c?-1:1)*(h<0?1/-h:h)}function I7(n){return n}var Ux=1,jx=2,D1=3,w_=4,CC=1e-6;function C7(n){return"translate("+n+",0)"}function P7(n){return"translate(0,"+n+")"}function k7(n){return i=>+n(i)}function D7(n,i){return i=Math.max(0,n.bandwidth()-i*2)/2,n.round()&&(i=Math.round(i)),o=>+n(o)+i}function L7(){return!this.__axis}function O7(n,i){var o=[],c=null,h=null,p=6,g=6,x=3,s=typeof window<"u"&&window.devicePixelRatio>1?0:.5,M=n===Ux||n===w_?-1:1,C=n===w_||n===jx?"x":"y",D=n===Ux||n===D1?C7:P7;function F(V){var X=c??(i.ticks?i.ticks.apply(i,o):i.domain()),W=h??(i.tickFormat?i.tickFormat.apply(i,o):I7),J=Math.max(p,0)+x,$=i.range(),ne=+$[0]+s,ye=+$[$.length-1]+s,pe=(i.bandwidth?D7:k7)(i.copy(),s),ke=V.selection?V.selection():V,Ae=ke.selectAll(".domain").data([null]),tt=ke.selectAll(".tick").data(X,i).order(),pt=tt.exit(),kt=tt.enter().append("g").attr("class","tick"),Ie=tt.select("line"),Et=tt.select("text");Ae=Ae.merge(Ae.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),tt=tt.merge(kt),Ie=Ie.merge(kt.append("line").attr("stroke","currentColor").attr(C+"2",M*p)),Et=Et.merge(kt.append("text").attr("fill","currentColor").attr(C,M*J).attr("dy",n===Ux?"0em":n===D1?"0.71em":"0.32em")),V!==ke&&(Ae=Ae.transition(V),tt=tt.transition(V),Ie=Ie.transition(V),Et=Et.transition(V),pt=pt.transition(V).attr("opacity",CC).attr("transform",function(mt){return isFinite(mt=pe(mt))?D(mt+s):this.getAttribute("transform")}),kt.attr("opacity",CC).attr("transform",function(mt){var Xe=this.parentNode.__axis;return D((Xe&&isFinite(Xe=Xe(mt))?Xe:pe(mt))+s)})),pt.remove(),Ae.attr("d",n===w_||n===jx?g?"M"+M*g+","+ne+"H"+s+"V"+ye+"H"+M*g:"M"+s+","+ne+"V"+ye:g?"M"+ne+","+M*g+"V"+s+"H"+ye+"V"+M*g:"M"+ne+","+s+"H"+ye),tt.attr("opacity",1).attr("transform",function(mt){return D(pe(mt)+s)}),Ie.attr(C+"2",M*p),Et.attr(C,M*J).text(W),ke.filter(L7).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",n===jx?"start":n===w_?"end":"middle"),ke.each(function(){this.__axis=pe})}return F.scale=function(V){return arguments.length?(i=V,F):i},F.ticks=function(){return o=Array.from(arguments),F},F.tickArguments=function(V){return arguments.length?(o=V==null?[]:Array.from(V),F):o.slice()},F.tickValues=function(V){return arguments.length?(c=V==null?null:Array.from(V),F):c&&c.slice()},F.tickFormat=function(V){return arguments.length?(h=V,F):h},F.tickSize=function(V){return arguments.length?(p=g=+V,F):p},F.tickSizeInner=function(V){return arguments.length?(p=+V,F):p},F.tickSizeOuter=function(V){return arguments.length?(g=+V,F):g},F.tickPadding=function(V){return arguments.length?(x=+V,F):x},F.offset=function(V){return arguments.length?(s=+V,F):s},F}function vq(n){return O7(D1,n)}var R7={value:()=>{}};function j3(){for(var n=0,i=arguments.length,o={},c;n<i;++n){if(!(c=arguments[n]+"")||c in o||/[\s.]/.test(c))throw new Error("illegal type: "+c);o[c]=[]}return new q_(o)}function q_(n){this._=n}function z7(n,i){return n.trim().split(/^|\s+/).map(function(o){var c="",h=o.indexOf(".");if(h>=0&&(c=o.slice(h+1),o=o.slice(0,h)),o&&!i.hasOwnProperty(o))throw new Error("unknown type: "+o);return{type:o,name:c}})}q_.prototype=j3.prototype={constructor:q_,on:function(n,i){var o=this._,c=z7(n+"",o),h,p=-1,g=c.length;if(arguments.length<2){for(;++p<g;)if((h=(n=c[p]).type)&&(h=F7(o[h],n.name)))return h;return}if(i!=null&&typeof i!="function")throw new Error("invalid callback: "+i);for(;++p<g;)if(h=(n=c[p]).type)o[h]=PC(o[h],n.name,i);else if(i==null)for(h in o)o[h]=PC(o[h],n.name,null);return this},copy:function(){var n={},i=this._;for(var o in i)n[o]=i[o].slice();return new q_(n)},call:function(n,i){if((h=arguments.length-2)>0)for(var o=new Array(h),c=0,h,p;c<h;++c)o[c]=arguments[c+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(p=this._[n],c=0,h=p.length;c<h;++c)p[c].value.apply(i,o)},apply:function(n,i,o){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var c=this._[n],h=0,p=c.length;h<p;++h)c[h].value.apply(i,o)}};function F7(n,i){for(var o=0,c=n.length,h;o<c;++o)if((h=n[o]).name===i)return h.value}function PC(n,i,o){for(var c=0,h=n.length;c<h;++c)if(n[c].name===i){n[c]=R7,n=n.slice(0,c).concat(n.slice(c+1));break}return o!=null&&n.push({name:i,value:o}),n}var L1="http://www.w3.org/1999/xhtml";const kC={svg:"http://www.w3.org/2000/svg",xhtml:L1,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function $y(n){var i=n+="",o=i.indexOf(":");return o>=0&&(i=n.slice(0,o))!=="xmlns"&&(n=n.slice(o+1)),kC.hasOwnProperty(i)?{space:kC[i],local:n}:n}function B7(n){return function(){var i=this.ownerDocument,o=this.namespaceURI;return o===L1&&i.documentElement.namespaceURI===L1?i.createElement(n):i.createElementNS(o,n)}}function N7(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function G3(n){var i=$y(n);return(i.local?N7:B7)(i)}function V7(){}function Pb(n){return n==null?V7:function(){return this.querySelector(n)}}function U7(n){typeof n!="function"&&(n=Pb(n));for(var i=this._groups,o=i.length,c=new Array(o),h=0;h<o;++h)for(var p=i[h],g=p.length,x=c[h]=new Array(g),s,M,C=0;C<g;++C)(s=p[C])&&(M=n.call(s,s.__data__,C,p))&&("__data__"in s&&(M.__data__=s.__data__),x[C]=M);return new ea(c,this._parents)}function j7(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function G7(){return[]}function H3(n){return n==null?G7:function(){return this.querySelectorAll(n)}}function H7(n){return function(){return j7(n.apply(this,arguments))}}function W7(n){typeof n=="function"?n=H7(n):n=H3(n);for(var i=this._groups,o=i.length,c=[],h=[],p=0;p<o;++p)for(var g=i[p],x=g.length,s,M=0;M<x;++M)(s=g[M])&&(c.push(n.call(s,s.__data__,M,g)),h.push(s));return new ea(c,h)}function W3(n){return function(){return this.matches(n)}}function q3(n){return function(i){return i.matches(n)}}var q7=Array.prototype.find;function Z7(n){return function(){return q7.call(this.children,n)}}function X7(){return this.firstElementChild}function Y7(n){return this.select(n==null?X7:Z7(typeof n=="function"?n:q3(n)))}var J7=Array.prototype.filter;function K7(){return Array.from(this.children)}function Q7(n){return function(){return J7.call(this.children,n)}}function $7(n){return this.selectAll(n==null?K7:Q7(typeof n=="function"?n:q3(n)))}function e9(n){typeof n!="function"&&(n=W3(n));for(var i=this._groups,o=i.length,c=new Array(o),h=0;h<o;++h)for(var p=i[h],g=p.length,x=c[h]=[],s,M=0;M<g;++M)(s=p[M])&&n.call(s,s.__data__,M,p)&&x.push(s);return new ea(c,this._parents)}function Z3(n){return new Array(n.length)}function t9(){return new ea(this._enter||this._groups.map(Z3),this._parents)}function Ty(n,i){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=i}Ty.prototype={constructor:Ty,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,i){return this._parent.insertBefore(n,i)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function i9(n){return function(){return n}}function n9(n,i,o,c,h,p){for(var g=0,x,s=i.length,M=p.length;g<M;++g)(x=i[g])?(x.__data__=p[g],c[g]=x):o[g]=new Ty(n,p[g]);for(;g<s;++g)(x=i[g])&&(h[g]=x)}function r9(n,i,o,c,h,p,g){var x,s,M=new Map,C=i.length,D=p.length,F=new Array(C),V;for(x=0;x<C;++x)(s=i[x])&&(F[x]=V=g.call(s,s.__data__,x,i)+"",M.has(V)?h[x]=s:M.set(V,s));for(x=0;x<D;++x)V=g.call(n,p[x],x,p)+"",(s=M.get(V))?(c[x]=s,s.__data__=p[x],M.delete(V)):o[x]=new Ty(n,p[x]);for(x=0;x<C;++x)(s=i[x])&&M.get(F[x])===s&&(h[x]=s)}function o9(n){return n.__data__}function s9(n,i){if(!arguments.length)return Array.from(this,o9);var o=i?r9:n9,c=this._parents,h=this._groups;typeof n!="function"&&(n=i9(n));for(var p=h.length,g=new Array(p),x=new Array(p),s=new Array(p),M=0;M<p;++M){var C=c[M],D=h[M],F=D.length,V=a9(n.call(C,C&&C.__data__,M,c)),X=V.length,W=x[M]=new Array(X),J=g[M]=new Array(X),$=s[M]=new Array(F);o(C,D,W,J,$,V,i);for(var ne=0,ye=0,pe,ke;ne<X;++ne)if(pe=W[ne]){for(ne>=ye&&(ye=ne+1);!(ke=J[ye])&&++ye<X;);pe._next=ke||null}}return g=new ea(g,c),g._enter=x,g._exit=s,g}function a9(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function l9(){return new ea(this._exit||this._groups.map(Z3),this._parents)}function c9(n,i,o){var c=this.enter(),h=this,p=this.exit();return typeof n=="function"?(c=n(c),c&&(c=c.selection())):c=c.append(n+""),i!=null&&(h=i(h),h&&(h=h.selection())),o==null?p.remove():o(p),c&&h?c.merge(h).order():h}function u9(n){for(var i=n.selection?n.selection():n,o=this._groups,c=i._groups,h=o.length,p=c.length,g=Math.min(h,p),x=new Array(h),s=0;s<g;++s)for(var M=o[s],C=c[s],D=M.length,F=x[s]=new Array(D),V,X=0;X<D;++X)(V=M[X]||C[X])&&(F[X]=V);for(;s<h;++s)x[s]=o[s];return new ea(x,this._parents)}function h9(){for(var n=this._groups,i=-1,o=n.length;++i<o;)for(var c=n[i],h=c.length-1,p=c[h],g;--h>=0;)(g=c[h])&&(p&&g.compareDocumentPosition(p)^4&&p.parentNode.insertBefore(g,p),p=g);return this}function f9(n){n||(n=d9);function i(D,F){return D&&F?n(D.__data__,F.__data__):!D-!F}for(var o=this._groups,c=o.length,h=new Array(c),p=0;p<c;++p){for(var g=o[p],x=g.length,s=h[p]=new Array(x),M,C=0;C<x;++C)(M=g[C])&&(s[C]=M);s.sort(i)}return new ea(h,this._parents).order()}function d9(n,i){return n<i?-1:n>i?1:n>=i?0:NaN}function p9(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function m9(){return Array.from(this)}function g9(){for(var n=this._groups,i=0,o=n.length;i<o;++i)for(var c=n[i],h=0,p=c.length;h<p;++h){var g=c[h];if(g)return g}return null}function _9(){let n=0;for(const i of this)++n;return n}function y9(){return!this.node()}function v9(n){for(var i=this._groups,o=0,c=i.length;o<c;++o)for(var h=i[o],p=0,g=h.length,x;p<g;++p)(x=h[p])&&n.call(x,x.__data__,p,h);return this}function x9(n){return function(){this.removeAttribute(n)}}function b9(n){return function(){this.removeAttributeNS(n.space,n.local)}}function w9(n,i){return function(){this.setAttribute(n,i)}}function T9(n,i){return function(){this.setAttributeNS(n.space,n.local,i)}}function S9(n,i){return function(){var o=i.apply(this,arguments);o==null?this.removeAttribute(n):this.setAttribute(n,o)}}function M9(n,i){return function(){var o=i.apply(this,arguments);o==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,o)}}function E9(n,i){var o=$y(n);if(arguments.length<2){var c=this.node();return o.local?c.getAttributeNS(o.space,o.local):c.getAttribute(o)}return this.each((i==null?o.local?b9:x9:typeof i=="function"?o.local?M9:S9:o.local?T9:w9)(o,i))}function X3(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function A9(n){return function(){this.style.removeProperty(n)}}function I9(n,i,o){return function(){this.style.setProperty(n,i,o)}}function C9(n,i,o){return function(){var c=i.apply(this,arguments);c==null?this.style.removeProperty(n):this.style.setProperty(n,c,o)}}function P9(n,i,o){return arguments.length>1?this.each((i==null?A9:typeof i=="function"?C9:I9)(n,i,o??"")):Kf(this.node(),n)}function Kf(n,i){return n.style.getPropertyValue(i)||X3(n).getComputedStyle(n,null).getPropertyValue(i)}function k9(n){return function(){delete this[n]}}function D9(n,i){return function(){this[n]=i}}function L9(n,i){return function(){var o=i.apply(this,arguments);o==null?delete this[n]:this[n]=o}}function O9(n,i){return arguments.length>1?this.each((i==null?k9:typeof i=="function"?L9:D9)(n,i)):this.node()[n]}function Y3(n){return n.trim().split(/^|\s+/)}function kb(n){return n.classList||new J3(n)}function J3(n){this._node=n,this._names=Y3(n.getAttribute("class")||"")}J3.prototype={add:function(n){var i=this._names.indexOf(n);i<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var i=this._names.indexOf(n);i>=0&&(this._names.splice(i,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function K3(n,i){for(var o=kb(n),c=-1,h=i.length;++c<h;)o.add(i[c])}function Q3(n,i){for(var o=kb(n),c=-1,h=i.length;++c<h;)o.remove(i[c])}function R9(n){return function(){K3(this,n)}}function z9(n){return function(){Q3(this,n)}}function F9(n,i){return function(){(i.apply(this,arguments)?K3:Q3)(this,n)}}function B9(n,i){var o=Y3(n+"");if(arguments.length<2){for(var c=kb(this.node()),h=-1,p=o.length;++h<p;)if(!c.contains(o[h]))return!1;return!0}return this.each((typeof i=="function"?F9:i?R9:z9)(o,i))}function N9(){this.textContent=""}function V9(n){return function(){this.textContent=n}}function U9(n){return function(){var i=n.apply(this,arguments);this.textContent=i??""}}function j9(n){return arguments.length?this.each(n==null?N9:(typeof n=="function"?U9:V9)(n)):this.node().textContent}function G9(){this.innerHTML=""}function H9(n){return function(){this.innerHTML=n}}function W9(n){return function(){var i=n.apply(this,arguments);this.innerHTML=i??""}}function q9(n){return arguments.length?this.each(n==null?G9:(typeof n=="function"?W9:H9)(n)):this.node().innerHTML}function Z9(){this.nextSibling&&this.parentNode.appendChild(this)}function X9(){return this.each(Z9)}function Y9(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function J9(){return this.each(Y9)}function K9(n){var i=typeof n=="function"?n:G3(n);return this.select(function(){return this.appendChild(i.apply(this,arguments))})}function Q9(){return null}function $9(n,i){var o=typeof n=="function"?n:G3(n),c=i==null?Q9:typeof i=="function"?i:Pb(i);return this.select(function(){return this.insertBefore(o.apply(this,arguments),c.apply(this,arguments)||null)})}function eG(){var n=this.parentNode;n&&n.removeChild(this)}function tG(){return this.each(eG)}function iG(){var n=this.cloneNode(!1),i=this.parentNode;return i?i.insertBefore(n,this.nextSibling):n}function nG(){var n=this.cloneNode(!0),i=this.parentNode;return i?i.insertBefore(n,this.nextSibling):n}function rG(n){return this.select(n?nG:iG)}function oG(n){return arguments.length?this.property("__data__",n):this.node().__data__}function sG(n){return function(i){n.call(this,i,this.__data__)}}function aG(n){return n.trim().split(/^|\s+/).map(function(i){var o="",c=i.indexOf(".");return c>=0&&(o=i.slice(c+1),i=i.slice(0,c)),{type:i,name:o}})}function lG(n){return function(){var i=this.__on;if(i){for(var o=0,c=-1,h=i.length,p;o<h;++o)p=i[o],(!n.type||p.type===n.type)&&p.name===n.name?this.removeEventListener(p.type,p.listener,p.options):i[++c]=p;++c?i.length=c:delete this.__on}}}function cG(n,i,o){return function(){var c=this.__on,h,p=sG(i);if(c){for(var g=0,x=c.length;g<x;++g)if((h=c[g]).type===n.type&&h.name===n.name){this.removeEventListener(h.type,h.listener,h.options),this.addEventListener(h.type,h.listener=p,h.options=o),h.value=i;return}}this.addEventListener(n.type,p,o),h={type:n.type,name:n.name,value:i,listener:p,options:o},c?c.push(h):this.__on=[h]}}function uG(n,i,o){var c=aG(n+""),h,p=c.length,g;if(arguments.length<2){var x=this.node().__on;if(x){for(var s=0,M=x.length,C;s<M;++s)for(h=0,C=x[s];h<p;++h)if((g=c[h]).type===C.type&&g.name===C.name)return C.value}return}for(x=i?cG:lG,h=0;h<p;++h)this.each(x(c[h],i,o));return this}function $3(n,i,o){var c=X3(n),h=c.CustomEvent;typeof h=="function"?h=new h(i,o):(h=c.document.createEvent("Event"),o?(h.initEvent(i,o.bubbles,o.cancelable),h.detail=o.detail):h.initEvent(i,!1,!1)),n.dispatchEvent(h)}function hG(n,i){return function(){return $3(this,n,i)}}function fG(n,i){return function(){return $3(this,n,i.apply(this,arguments))}}function dG(n,i){return this.each((typeof i=="function"?fG:hG)(n,i))}function*pG(){for(var n=this._groups,i=0,o=n.length;i<o;++i)for(var c=n[i],h=0,p=c.length,g;h<p;++h)(g=c[h])&&(yield g)}var eD=[null];function ea(n,i){this._groups=n,this._parents=i}function Sm(){return new ea([[document.documentElement]],eD)}function mG(){return this}ea.prototype=Sm.prototype={constructor:ea,select:U7,selectAll:W7,selectChild:Y7,selectChildren:$7,filter:e9,data:s9,enter:t9,exit:l9,join:c9,merge:u9,selection:mG,order:h9,sort:f9,call:p9,nodes:m9,node:g9,size:_9,empty:y9,each:v9,attr:E9,style:P9,property:O9,classed:B9,text:j9,html:q9,raise:X9,lower:J9,append:K9,insert:$9,remove:tG,clone:rG,datum:oG,on:uG,dispatch:dG,[Symbol.iterator]:pG};function xq(n){return typeof n=="string"?new ea([[document.querySelector(n)]],[document.documentElement]):new ea([[n]],eD)}function Db(n,i,o){n.prototype=i.prototype=o,o.constructor=n}function tD(n,i){var o=Object.create(n.prototype);for(var c in i)o[c]=i[c];return o}function Mm(){}var sm=.7,Sy=1/sm,Nf="\\s*([+-]?\\d+)\\s*",am="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Il="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",gG=/^#([0-9a-f]{3,8})$/,_G=new RegExp(`^rgb\\(${Nf},${Nf},${Nf}\\)$`),yG=new RegExp(`^rgb\\(${Il},${Il},${Il}\\)$`),vG=new RegExp(`^rgba\\(${Nf},${Nf},${Nf},${am}\\)$`),xG=new RegExp(`^rgba\\(${Il},${Il},${Il},${am}\\)$`),bG=new RegExp(`^hsl\\(${am},${Il},${Il}\\)$`),wG=new RegExp(`^hsla\\(${am},${Il},${Il},${am}\\)$`),DC={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Db(Mm,Lh,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:LC,formatHex:LC,formatHex8:TG,formatHsl:SG,formatRgb:OC,toString:OC});function LC(){return this.rgb().formatHex()}function TG(){return this.rgb().formatHex8()}function SG(){return iD(this).formatHsl()}function OC(){return this.rgb().formatRgb()}function Lh(n){var i,o;return n=(n+"").trim().toLowerCase(),(i=gG.exec(n))?(o=i[1].length,i=parseInt(i[1],16),o===6?RC(i):o===3?new Rs(i>>8&15|i>>4&240,i>>4&15|i&240,(i&15)<<4|i&15,1):o===8?T_(i>>24&255,i>>16&255,i>>8&255,(i&255)/255):o===4?T_(i>>12&15|i>>8&240,i>>8&15|i>>4&240,i>>4&15|i&240,((i&15)<<4|i&15)/255):null):(i=_G.exec(n))?new Rs(i[1],i[2],i[3],1):(i=yG.exec(n))?new Rs(i[1]*255/100,i[2]*255/100,i[3]*255/100,1):(i=vG.exec(n))?T_(i[1],i[2],i[3],i[4]):(i=xG.exec(n))?T_(i[1]*255/100,i[2]*255/100,i[3]*255/100,i[4]):(i=bG.exec(n))?BC(i[1],i[2]/100,i[3]/100,1):(i=wG.exec(n))?BC(i[1],i[2]/100,i[3]/100,i[4]):DC.hasOwnProperty(n)?RC(DC[n]):n==="transparent"?new Rs(NaN,NaN,NaN,0):null}function RC(n){return new Rs(n>>16&255,n>>8&255,n&255,1)}function T_(n,i,o,c){return c<=0&&(n=i=o=NaN),new Rs(n,i,o,c)}function MG(n){return n instanceof Mm||(n=Lh(n)),n?(n=n.rgb(),new Rs(n.r,n.g,n.b,n.opacity)):new Rs}function O1(n,i,o,c){return arguments.length===1?MG(n):new Rs(n,i,o,c??1)}function Rs(n,i,o,c){this.r=+n,this.g=+i,this.b=+o,this.opacity=+c}Db(Rs,O1,tD(Mm,{brighter(n){return n=n==null?Sy:Math.pow(Sy,n),new Rs(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?sm:Math.pow(sm,n),new Rs(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Rs(Ch(this.r),Ch(this.g),Ch(this.b),My(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:zC,formatHex:zC,formatHex8:EG,formatRgb:FC,toString:FC}));function zC(){return`#${Th(this.r)}${Th(this.g)}${Th(this.b)}`}function EG(){return`#${Th(this.r)}${Th(this.g)}${Th(this.b)}${Th((isNaN(this.opacity)?1:this.opacity)*255)}`}function FC(){const n=My(this.opacity);return`${n===1?"rgb(":"rgba("}${Ch(this.r)}, ${Ch(this.g)}, ${Ch(this.b)}${n===1?")":`, ${n})`}`}function My(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Ch(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function Th(n){return n=Ch(n),(n<16?"0":"")+n.toString(16)}function BC(n,i,o,c){return c<=0?n=i=o=NaN:o<=0||o>=1?n=i=NaN:i<=0&&(n=NaN),new qa(n,i,o,c)}function iD(n){if(n instanceof qa)return new qa(n.h,n.s,n.l,n.opacity);if(n instanceof Mm||(n=Lh(n)),!n)return new qa;if(n instanceof qa)return n;n=n.rgb();var i=n.r/255,o=n.g/255,c=n.b/255,h=Math.min(i,o,c),p=Math.max(i,o,c),g=NaN,x=p-h,s=(p+h)/2;return x?(i===p?g=(o-c)/x+(o<c)*6:o===p?g=(c-i)/x+2:g=(i-o)/x+4,x/=s<.5?p+h:2-p-h,g*=60):x=s>0&&s<1?0:g,new qa(g,x,s,n.opacity)}function AG(n,i,o,c){return arguments.length===1?iD(n):new qa(n,i,o,c??1)}function qa(n,i,o,c){this.h=+n,this.s=+i,this.l=+o,this.opacity=+c}Db(qa,AG,tD(Mm,{brighter(n){return n=n==null?Sy:Math.pow(Sy,n),new qa(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?sm:Math.pow(sm,n),new qa(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,i=isNaN(n)||isNaN(this.s)?0:this.s,o=this.l,c=o+(o<.5?o:1-o)*i,h=2*o-c;return new Rs(Gx(n>=240?n-240:n+120,h,c),Gx(n,h,c),Gx(n<120?n+240:n-120,h,c),this.opacity)},clamp(){return new qa(NC(this.h),S_(this.s),S_(this.l),My(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=My(this.opacity);return`${n===1?"hsl(":"hsla("}${NC(this.h)}, ${S_(this.s)*100}%, ${S_(this.l)*100}%${n===1?")":`, ${n})`}`}}));function NC(n){return n=(n||0)%360,n<0?n+360:n}function S_(n){return Math.max(0,Math.min(1,n||0))}function Gx(n,i,o){return(n<60?i+(o-i)*n/60:n<180?o:n<240?i+(o-i)*(240-n)/60:i)*255}const Lb=n=>()=>n;function IG(n,i){return function(o){return n+o*i}}function CG(n,i,o){return n=Math.pow(n,o),i=Math.pow(i,o)-n,o=1/o,function(c){return Math.pow(n+c*i,o)}}function PG(n){return(n=+n)==1?nD:function(i,o){return o-i?CG(i,o,n):Lb(isNaN(i)?o:i)}}function nD(n,i){var o=i-n;return o?IG(n,o):Lb(isNaN(n)?i:n)}const Ey=function n(i){var o=PG(i);function c(h,p){var g=o((h=O1(h)).r,(p=O1(p)).r),x=o(h.g,p.g),s=o(h.b,p.b),M=nD(h.opacity,p.opacity);return function(C){return h.r=g(C),h.g=x(C),h.b=s(C),h.opacity=M(C),h+""}}return c.gamma=n,c}(1);function kG(n,i){i||(i=[]);var o=n?Math.min(i.length,n.length):0,c=i.slice(),h;return function(p){for(h=0;h<o;++h)c[h]=n[h]*(1-p)+i[h]*p;return c}}function DG(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function LG(n,i){var o=i?i.length:0,c=n?Math.min(o,n.length):0,h=new Array(c),p=new Array(o),g;for(g=0;g<c;++g)h[g]=Ob(n[g],i[g]);for(;g<o;++g)p[g]=i[g];return function(x){for(g=0;g<c;++g)p[g]=h[g](x);return p}}function OG(n,i){var o=new Date;return n=+n,i=+i,function(c){return o.setTime(n*(1-c)+i*c),o}}function Wa(n,i){return n=+n,i=+i,function(o){return n*(1-o)+i*o}}function RG(n,i){var o={},c={},h;(n===null||typeof n!="object")&&(n={}),(i===null||typeof i!="object")&&(i={});for(h in i)h in n?o[h]=Ob(n[h],i[h]):c[h]=i[h];return function(p){for(h in o)c[h]=o[h](p);return c}}var R1=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Hx=new RegExp(R1.source,"g");function zG(n){return function(){return n}}function FG(n){return function(i){return n(i)+""}}function rD(n,i){var o=R1.lastIndex=Hx.lastIndex=0,c,h,p,g=-1,x=[],s=[];for(n=n+"",i=i+"";(c=R1.exec(n))&&(h=Hx.exec(i));)(p=h.index)>o&&(p=i.slice(o,p),x[g]?x[g]+=p:x[++g]=p),(c=c[0])===(h=h[0])?x[g]?x[g]+=h:x[++g]=h:(x[++g]=null,s.push({i:g,x:Wa(c,h)})),o=Hx.lastIndex;return o<i.length&&(p=i.slice(o),x[g]?x[g]+=p:x[++g]=p),x.length<2?s[0]?FG(s[0].x):zG(i):(i=s.length,function(M){for(var C=0,D;C<i;++C)x[(D=s[C]).i]=D.x(M);return x.join("")})}function Ob(n,i){var o=typeof i,c;return i==null||o==="boolean"?Lb(i):(o==="number"?Wa:o==="string"?(c=Lh(i))?(i=c,Ey):rD:i instanceof Lh?Ey:i instanceof Date?OG:DG(i)?kG:Array.isArray(i)?LG:typeof i.valueOf!="function"&&typeof i.toString!="function"||isNaN(i)?RG:Wa)(n,i)}function BG(n,i){return n=+n,i=+i,function(o){return Math.round(n*(1-o)+i*o)}}var VC=180/Math.PI,z1={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function oD(n,i,o,c,h,p){var g,x,s;return(g=Math.sqrt(n*n+i*i))&&(n/=g,i/=g),(s=n*o+i*c)&&(o-=n*s,c-=i*s),(x=Math.sqrt(o*o+c*c))&&(o/=x,c/=x,s/=x),n*c<i*o&&(n=-n,i=-i,s=-s,g=-g),{translateX:h,translateY:p,rotate:Math.atan2(i,n)*VC,skewX:Math.atan(s)*VC,scaleX:g,scaleY:x}}var M_;function NG(n){const i=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return i.isIdentity?z1:oD(i.a,i.b,i.c,i.d,i.e,i.f)}function VG(n){return n==null||(M_||(M_=document.createElementNS("http://www.w3.org/2000/svg","g")),M_.setAttribute("transform",n),!(n=M_.transform.baseVal.consolidate()))?z1:(n=n.matrix,oD(n.a,n.b,n.c,n.d,n.e,n.f))}function sD(n,i,o,c){function h(M){return M.length?M.pop()+" ":""}function p(M,C,D,F,V,X){if(M!==D||C!==F){var W=V.push("translate(",null,i,null,o);X.push({i:W-4,x:Wa(M,D)},{i:W-2,x:Wa(C,F)})}else(D||F)&&V.push("translate("+D+i+F+o)}function g(M,C,D,F){M!==C?(M-C>180?C+=360:C-M>180&&(M+=360),F.push({i:D.push(h(D)+"rotate(",null,c)-2,x:Wa(M,C)})):C&&D.push(h(D)+"rotate("+C+c)}function x(M,C,D,F){M!==C?F.push({i:D.push(h(D)+"skewX(",null,c)-2,x:Wa(M,C)}):C&&D.push(h(D)+"skewX("+C+c)}function s(M,C,D,F,V,X){if(M!==D||C!==F){var W=V.push(h(V)+"scale(",null,",",null,")");X.push({i:W-4,x:Wa(M,D)},{i:W-2,x:Wa(C,F)})}else(D!==1||F!==1)&&V.push(h(V)+"scale("+D+","+F+")")}return function(M,C){var D=[],F=[];return M=n(M),C=n(C),p(M.translateX,M.translateY,C.translateX,C.translateY,D,F),g(M.rotate,C.rotate,D,F),x(M.skewX,C.skewX,D,F),s(M.scaleX,M.scaleY,C.scaleX,C.scaleY,D,F),M=C=null,function(V){for(var X=-1,W=F.length,J;++X<W;)D[(J=F[X]).i]=J.x(V);return D.join("")}}}var UG=sD(NG,"px, ","px)","deg)"),jG=sD(VG,", ",")",")"),Qf=0,Lp=0,Mp=0,aD=1e3,Ay,Op,Iy=0,Oh=0,e0=0,lm=typeof performance=="object"&&performance.now?performance:Date,lD=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function Rb(){return Oh||(lD(GG),Oh=lm.now()+e0)}function GG(){Oh=0}function Cy(){this._call=this._time=this._next=null}Cy.prototype=cD.prototype={constructor:Cy,restart:function(n,i,o){if(typeof n!="function")throw new TypeError("callback is not a function");o=(o==null?Rb():+o)+(i==null?0:+i),!this._next&&Op!==this&&(Op?Op._next=this:Ay=this,Op=this),this._call=n,this._time=o,F1()},stop:function(){this._call&&(this._call=null,this._time=1/0,F1())}};function cD(n,i,o){var c=new Cy;return c.restart(n,i,o),c}function HG(){Rb(),++Qf;for(var n=Ay,i;n;)(i=Oh-n._time)>=0&&n._call.call(void 0,i),n=n._next;--Qf}function UC(){Oh=(Iy=lm.now())+e0,Qf=Lp=0;try{HG()}finally{Qf=0,qG(),Oh=0}}function WG(){var n=lm.now(),i=n-Iy;i>aD&&(e0-=i,Iy=n)}function qG(){for(var n,i=Ay,o,c=1/0;i;)i._call?(c>i._time&&(c=i._time),n=i,i=i._next):(o=i._next,i._next=null,i=n?n._next=o:Ay=o);Op=n,F1(c)}function F1(n){if(!Qf){Lp&&(Lp=clearTimeout(Lp));var i=n-Oh;i>24?(n<1/0&&(Lp=setTimeout(UC,n-lm.now()-e0)),Mp&&(Mp=clearInterval(Mp))):(Mp||(Iy=lm.now(),Mp=setInterval(WG,aD)),Qf=1,lD(UC))}}function jC(n,i,o){var c=new Cy;return i=i==null?0:+i,c.restart(h=>{c.stop(),n(h+i)},i,o),c}var ZG=j3("start","end","cancel","interrupt"),XG=[],uD=0,GC=1,B1=2,Z_=3,HC=4,N1=5,X_=6;function t0(n,i,o,c,h,p){var g=n.__transition;if(!g)n.__transition={};else if(o in g)return;YG(n,o,{name:i,index:c,group:h,on:ZG,tween:XG,time:p.time,delay:p.delay,duration:p.duration,ease:p.ease,timer:null,state:uD})}function zb(n,i){var o=Qa(n,i);if(o.state>uD)throw new Error("too late; already scheduled");return o}function Pl(n,i){var o=Qa(n,i);if(o.state>Z_)throw new Error("too late; already running");return o}function Qa(n,i){var o=n.__transition;if(!o||!(o=o[i]))throw new Error("transition not found");return o}function YG(n,i,o){var c=n.__transition,h;c[i]=o,o.timer=cD(p,0,o.time);function p(M){o.state=GC,o.timer.restart(g,o.delay,o.time),o.delay<=M&&g(M-o.delay)}function g(M){var C,D,F,V;if(o.state!==GC)return s();for(C in c)if(V=c[C],V.name===o.name){if(V.state===Z_)return jC(g);V.state===HC?(V.state=X_,V.timer.stop(),V.on.call("interrupt",n,n.__data__,V.index,V.group),delete c[C]):+C<i&&(V.state=X_,V.timer.stop(),V.on.call("cancel",n,n.__data__,V.index,V.group),delete c[C])}if(jC(function(){o.state===Z_&&(o.state=HC,o.timer.restart(x,o.delay,o.time),x(M))}),o.state=B1,o.on.call("start",n,n.__data__,o.index,o.group),o.state===B1){for(o.state=Z_,h=new Array(F=o.tween.length),C=0,D=-1;C<F;++C)(V=o.tween[C].value.call(n,n.__data__,o.index,o.group))&&(h[++D]=V);h.length=D+1}}function x(M){for(var C=M<o.duration?o.ease.call(null,M/o.duration):(o.timer.restart(s),o.state=N1,1),D=-1,F=h.length;++D<F;)h[D].call(n,C);o.state===N1&&(o.on.call("end",n,n.__data__,o.index,o.group),s())}function s(){o.state=X_,o.timer.stop(),delete c[i];for(var M in c)return;delete n.__transition}}function JG(n,i){var o=n.__transition,c,h,p=!0,g;if(o){i=i==null?null:i+"";for(g in o){if((c=o[g]).name!==i){p=!1;continue}h=c.state>B1&&c.state<N1,c.state=X_,c.timer.stop(),c.on.call(h?"interrupt":"cancel",n,n.__data__,c.index,c.group),delete o[g]}p&&delete n.__transition}}function KG(n){return this.each(function(){JG(this,n)})}function QG(n,i){var o,c;return function(){var h=Pl(this,n),p=h.tween;if(p!==o){c=o=p;for(var g=0,x=c.length;g<x;++g)if(c[g].name===i){c=c.slice(),c.splice(g,1);break}}h.tween=c}}function $G(n,i,o){var c,h;if(typeof o!="function")throw new Error;return function(){var p=Pl(this,n),g=p.tween;if(g!==c){h=(c=g).slice();for(var x={name:i,value:o},s=0,M=h.length;s<M;++s)if(h[s].name===i){h[s]=x;break}s===M&&h.push(x)}p.tween=h}}function eH(n,i){var o=this._id;if(n+="",arguments.length<2){for(var c=Qa(this.node(),o).tween,h=0,p=c.length,g;h<p;++h)if((g=c[h]).name===n)return g.value;return null}return this.each((i==null?QG:$G)(o,n,i))}function Fb(n,i,o){var c=n._id;return n.each(function(){var h=Pl(this,c);(h.value||(h.value={}))[i]=o.apply(this,arguments)}),function(h){return Qa(h,c).value[i]}}function hD(n,i){var o;return(typeof i=="number"?Wa:i instanceof Lh?Ey:(o=Lh(i))?(i=o,Ey):rD)(n,i)}function tH(n){return function(){this.removeAttribute(n)}}function iH(n){return function(){this.removeAttributeNS(n.space,n.local)}}function nH(n,i,o){var c,h=o+"",p;return function(){var g=this.getAttribute(n);return g===h?null:g===c?p:p=i(c=g,o)}}function rH(n,i,o){var c,h=o+"",p;return function(){var g=this.getAttributeNS(n.space,n.local);return g===h?null:g===c?p:p=i(c=g,o)}}function oH(n,i,o){var c,h,p;return function(){var g,x=o(this),s;return x==null?void this.removeAttribute(n):(g=this.getAttribute(n),s=x+"",g===s?null:g===c&&s===h?p:(h=s,p=i(c=g,x)))}}function sH(n,i,o){var c,h,p;return function(){var g,x=o(this),s;return x==null?void this.removeAttributeNS(n.space,n.local):(g=this.getAttributeNS(n.space,n.local),s=x+"",g===s?null:g===c&&s===h?p:(h=s,p=i(c=g,x)))}}function aH(n,i){var o=$y(n),c=o==="transform"?jG:hD;return this.attrTween(n,typeof i=="function"?(o.local?sH:oH)(o,c,Fb(this,"attr."+n,i)):i==null?(o.local?iH:tH)(o):(o.local?rH:nH)(o,c,i))}function lH(n,i){return function(o){this.setAttribute(n,i.call(this,o))}}function cH(n,i){return function(o){this.setAttributeNS(n.space,n.local,i.call(this,o))}}function uH(n,i){var o,c;function h(){var p=i.apply(this,arguments);return p!==c&&(o=(c=p)&&cH(n,p)),o}return h._value=i,h}function hH(n,i){var o,c;function h(){var p=i.apply(this,arguments);return p!==c&&(o=(c=p)&&lH(n,p)),o}return h._value=i,h}function fH(n,i){var o="attr."+n;if(arguments.length<2)return(o=this.tween(o))&&o._value;if(i==null)return this.tween(o,null);if(typeof i!="function")throw new Error;var c=$y(n);return this.tween(o,(c.local?uH:hH)(c,i))}function dH(n,i){return function(){zb(this,n).delay=+i.apply(this,arguments)}}function pH(n,i){return i=+i,function(){zb(this,n).delay=i}}function mH(n){var i=this._id;return arguments.length?this.each((typeof n=="function"?dH:pH)(i,n)):Qa(this.node(),i).delay}function gH(n,i){return function(){Pl(this,n).duration=+i.apply(this,arguments)}}function _H(n,i){return i=+i,function(){Pl(this,n).duration=i}}function yH(n){var i=this._id;return arguments.length?this.each((typeof n=="function"?gH:_H)(i,n)):Qa(this.node(),i).duration}function vH(n,i){if(typeof i!="function")throw new Error;return function(){Pl(this,n).ease=i}}function xH(n){var i=this._id;return arguments.length?this.each(vH(i,n)):Qa(this.node(),i).ease}function bH(n,i){return function(){var o=i.apply(this,arguments);if(typeof o!="function")throw new Error;Pl(this,n).ease=o}}function wH(n){if(typeof n!="function")throw new Error;return this.each(bH(this._id,n))}function TH(n){typeof n!="function"&&(n=W3(n));for(var i=this._groups,o=i.length,c=new Array(o),h=0;h<o;++h)for(var p=i[h],g=p.length,x=c[h]=[],s,M=0;M<g;++M)(s=p[M])&&n.call(s,s.__data__,M,p)&&x.push(s);return new Mc(c,this._parents,this._name,this._id)}function SH(n){if(n._id!==this._id)throw new Error;for(var i=this._groups,o=n._groups,c=i.length,h=o.length,p=Math.min(c,h),g=new Array(c),x=0;x<p;++x)for(var s=i[x],M=o[x],C=s.length,D=g[x]=new Array(C),F,V=0;V<C;++V)(F=s[V]||M[V])&&(D[V]=F);for(;x<c;++x)g[x]=i[x];return new Mc(g,this._parents,this._name,this._id)}function MH(n){return(n+"").trim().split(/^|\s+/).every(function(i){var o=i.indexOf(".");return o>=0&&(i=i.slice(0,o)),!i||i==="start"})}function EH(n,i,o){var c,h,p=MH(i)?zb:Pl;return function(){var g=p(this,n),x=g.on;x!==c&&(h=(c=x).copy()).on(i,o),g.on=h}}function AH(n,i){var o=this._id;return arguments.length<2?Qa(this.node(),o).on.on(n):this.each(EH(o,n,i))}function IH(n){return function(){var i=this.parentNode;for(var o in this.__transition)if(+o!==n)return;i&&i.removeChild(this)}}function CH(){return this.on("end.remove",IH(this._id))}function PH(n){var i=this._name,o=this._id;typeof n!="function"&&(n=Pb(n));for(var c=this._groups,h=c.length,p=new Array(h),g=0;g<h;++g)for(var x=c[g],s=x.length,M=p[g]=new Array(s),C,D,F=0;F<s;++F)(C=x[F])&&(D=n.call(C,C.__data__,F,x))&&("__data__"in C&&(D.__data__=C.__data__),M[F]=D,t0(M[F],i,o,F,M,Qa(C,o)));return new Mc(p,this._parents,i,o)}function kH(n){var i=this._name,o=this._id;typeof n!="function"&&(n=H3(n));for(var c=this._groups,h=c.length,p=[],g=[],x=0;x<h;++x)for(var s=c[x],M=s.length,C,D=0;D<M;++D)if(C=s[D]){for(var F=n.call(C,C.__data__,D,s),V,X=Qa(C,o),W=0,J=F.length;W<J;++W)(V=F[W])&&t0(V,i,o,W,F,X);p.push(F),g.push(C)}return new Mc(p,g,i,o)}var DH=Sm.prototype.constructor;function LH(){return new DH(this._groups,this._parents)}function OH(n,i){var o,c,h;return function(){var p=Kf(this,n),g=(this.style.removeProperty(n),Kf(this,n));return p===g?null:p===o&&g===c?h:h=i(o=p,c=g)}}function fD(n){return function(){this.style.removeProperty(n)}}function RH(n,i,o){var c,h=o+"",p;return function(){var g=Kf(this,n);return g===h?null:g===c?p:p=i(c=g,o)}}function zH(n,i,o){var c,h,p;return function(){var g=Kf(this,n),x=o(this),s=x+"";return x==null&&(s=x=(this.style.removeProperty(n),Kf(this,n))),g===s?null:g===c&&s===h?p:(h=s,p=i(c=g,x))}}function FH(n,i){var o,c,h,p="style."+i,g="end."+p,x;return function(){var s=Pl(this,n),M=s.on,C=s.value[p]==null?x||(x=fD(i)):void 0;(M!==o||h!==C)&&(c=(o=M).copy()).on(g,h=C),s.on=c}}function BH(n,i,o){var c=(n+="")=="transform"?UG:hD;return i==null?this.styleTween(n,OH(n,c)).on("end.style."+n,fD(n)):typeof i=="function"?this.styleTween(n,zH(n,c,Fb(this,"style."+n,i))).each(FH(this._id,n)):this.styleTween(n,RH(n,c,i),o).on("end.style."+n,null)}function NH(n,i,o){return function(c){this.style.setProperty(n,i.call(this,c),o)}}function VH(n,i,o){var c,h;function p(){var g=i.apply(this,arguments);return g!==h&&(c=(h=g)&&NH(n,g,o)),c}return p._value=i,p}function UH(n,i,o){var c="style."+(n+="");if(arguments.length<2)return(c=this.tween(c))&&c._value;if(i==null)return this.tween(c,null);if(typeof i!="function")throw new Error;return this.tween(c,VH(n,i,o??""))}function jH(n){return function(){this.textContent=n}}function GH(n){return function(){var i=n(this);this.textContent=i??""}}function HH(n){return this.tween("text",typeof n=="function"?GH(Fb(this,"text",n)):jH(n==null?"":n+""))}function WH(n){return function(i){this.textContent=n.call(this,i)}}function qH(n){var i,o;function c(){var h=n.apply(this,arguments);return h!==o&&(i=(o=h)&&WH(h)),i}return c._value=n,c}function ZH(n){var i="text";if(arguments.length<1)return(i=this.tween(i))&&i._value;if(n==null)return this.tween(i,null);if(typeof n!="function")throw new Error;return this.tween(i,qH(n))}function XH(){for(var n=this._name,i=this._id,o=dD(),c=this._groups,h=c.length,p=0;p<h;++p)for(var g=c[p],x=g.length,s,M=0;M<x;++M)if(s=g[M]){var C=Qa(s,i);t0(s,n,o,M,g,{time:C.time+C.delay+C.duration,delay:0,duration:C.duration,ease:C.ease})}return new Mc(c,this._parents,n,o)}function YH(){var n,i,o=this,c=o._id,h=o.size();return new Promise(function(p,g){var x={value:g},s={value:function(){--h===0&&p()}};o.each(function(){var M=Pl(this,c),C=M.on;C!==n&&(i=(n=C).copy(),i._.cancel.push(x),i._.interrupt.push(x),i._.end.push(s)),M.on=i}),h===0&&p()})}var JH=0;function Mc(n,i,o,c){this._groups=n,this._parents=i,this._name=o,this._id=c}function dD(){return++JH}var dc=Sm.prototype;Mc.prototype={constructor:Mc,select:PH,selectAll:kH,selectChild:dc.selectChild,selectChildren:dc.selectChildren,filter:TH,merge:SH,selection:LH,transition:XH,call:dc.call,nodes:dc.nodes,node:dc.node,size:dc.size,empty:dc.empty,each:dc.each,on:AH,attr:aH,attrTween:fH,style:BH,styleTween:UH,text:HH,textTween:ZH,remove:CH,tween:eH,delay:mH,duration:yH,ease:xH,easeVarying:wH,end:YH,[Symbol.iterator]:dc[Symbol.iterator]};function KH(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var QH={time:null,delay:0,duration:250,ease:KH};function $H(n,i){for(var o;!(o=n.__transition)||!(o=o[i]);)if(!(n=n.parentNode))throw new Error(`transition ${i} not found`);return o}function eW(n){var i,o;n instanceof Mc?(i=n._id,n=n._name):(i=dD(),(o=QH).time=Rb(),n=n==null?null:n+"");for(var c=this._groups,h=c.length,p=0;p<h;++p)for(var g=c[p],x=g.length,s,M=0;M<x;++M)(s=g[M])&&t0(s,n,i,M,g,o||$H(s,i));return new Mc(c,this._parents,n,i)}Sm.prototype.interrupt=KG;Sm.prototype.transition=eW;function tW(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function Py(n,i){if((o=(n=i?n.toExponential(i-1):n.toExponential()).indexOf("e"))<0)return null;var o,c=n.slice(0,o);return[c.length>1?c[0]+c.slice(2):c,+n.slice(o+1)]}function $f(n){return n=Py(Math.abs(n)),n?n[1]:NaN}function iW(n,i){return function(o,c){for(var h=o.length,p=[],g=0,x=n[0],s=0;h>0&&x>0&&(s+x+1>c&&(x=Math.max(1,c-s)),p.push(o.substring(h-=x,h+x)),!((s+=x+1)>c));)x=n[g=(g+1)%n.length];return p.reverse().join(i)}}function nW(n){return function(i){return i.replace(/[0-9]/g,function(o){return n[+o]})}}var rW=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ky(n){if(!(i=rW.exec(n)))throw new Error("invalid format: "+n);var i;return new Bb({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}ky.prototype=Bb.prototype;function Bb(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}Bb.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function oW(n){e:for(var i=n.length,o=1,c=-1,h;o<i;++o)switch(n[o]){case".":c=h=o;break;case"0":c===0&&(c=o),h=o;break;default:if(!+n[o])break e;c>0&&(c=0);break}return c>0?n.slice(0,c)+n.slice(h+1):n}var pD;function sW(n,i){var o=Py(n,i);if(!o)return n+"";var c=o[0],h=o[1],p=h-(pD=Math.max(-8,Math.min(8,Math.floor(h/3)))*3)+1,g=c.length;return p===g?c:p>g?c+new Array(p-g+1).join("0"):p>0?c.slice(0,p)+"."+c.slice(p):"0."+new Array(1-p).join("0")+Py(n,Math.max(0,i+p-1))[0]}function WC(n,i){var o=Py(n,i);if(!o)return n+"";var c=o[0],h=o[1];return h<0?"0."+new Array(-h).join("0")+c:c.length>h+1?c.slice(0,h+1)+"."+c.slice(h+1):c+new Array(h-c.length+2).join("0")}const qC={"%":(n,i)=>(n*100).toFixed(i),b:n=>Math.round(n).toString(2),c:n=>n+"",d:tW,e:(n,i)=>n.toExponential(i),f:(n,i)=>n.toFixed(i),g:(n,i)=>n.toPrecision(i),o:n=>Math.round(n).toString(8),p:(n,i)=>WC(n*100,i),r:WC,s:sW,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function ZC(n){return n}var XC=Array.prototype.map,YC=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function aW(n){var i=n.grouping===void 0||n.thousands===void 0?ZC:iW(XC.call(n.grouping,Number),n.thousands+""),o=n.currency===void 0?"":n.currency[0]+"",c=n.currency===void 0?"":n.currency[1]+"",h=n.decimal===void 0?".":n.decimal+"",p=n.numerals===void 0?ZC:nW(XC.call(n.numerals,String)),g=n.percent===void 0?"%":n.percent+"",x=n.minus===void 0?"":n.minus+"",s=n.nan===void 0?"NaN":n.nan+"";function M(D){D=ky(D);var F=D.fill,V=D.align,X=D.sign,W=D.symbol,J=D.zero,$=D.width,ne=D.comma,ye=D.precision,pe=D.trim,ke=D.type;ke==="n"?(ne=!0,ke="g"):qC[ke]||(ye===void 0&&(ye=12),pe=!0,ke="g"),(J||F==="0"&&V==="=")&&(J=!0,F="0",V="=");var Ae=W==="$"?o:W==="#"&&/[boxX]/.test(ke)?"0"+ke.toLowerCase():"",tt=W==="$"?c:/[%p]/.test(ke)?g:"",pt=qC[ke],kt=/[defgprs%]/.test(ke);ye=ye===void 0?6:/[gprs]/.test(ke)?Math.max(1,Math.min(21,ye)):Math.max(0,Math.min(20,ye));function Ie(Et){var mt=Ae,Xe=tt,Tt,Yt,mi;if(ke==="c")Xe=pt(Et)+Xe,Et="";else{Et=+Et;var Ti=Et<0||1/Et<0;if(Et=isNaN(Et)?s:pt(Math.abs(Et),ye),pe&&(Et=oW(Et)),Ti&&+Et==0&&X!=="+"&&(Ti=!1),mt=(Ti?X==="("?X:x:X==="-"||X==="("?"":X)+mt,Xe=(ke==="s"?YC[8+pD/3]:"")+Xe+(Ti&&X==="("?")":""),kt){for(Tt=-1,Yt=Et.length;++Tt<Yt;)if(mi=Et.charCodeAt(Tt),48>mi||mi>57){Xe=(mi===46?h+Et.slice(Tt+1):Et.slice(Tt))+Xe,Et=Et.slice(0,Tt);break}}}ne&&!J&&(Et=i(Et,1/0));var Zi=mt.length+Et.length+Xe.length,wt=Zi<$?new Array($-Zi+1).join(F):"";switch(ne&&J&&(Et=i(wt+Et,wt.length?$-Xe.length:1/0),wt=""),V){case"<":Et=mt+Et+Xe+wt;break;case"=":Et=mt+wt+Et+Xe;break;case"^":Et=wt.slice(0,Zi=wt.length>>1)+mt+Et+Xe+wt.slice(Zi);break;default:Et=wt+mt+Et+Xe;break}return p(Et)}return Ie.toString=function(){return D+""},Ie}function C(D,F){var V=M((D=ky(D),D.type="f",D)),X=Math.max(-8,Math.min(8,Math.floor($f(F)/3)))*3,W=Math.pow(10,-X),J=YC[8+X/3];return function($){return V(W*$)+J}}return{format:M,formatPrefix:C}}var E_,mD,gD;lW({thousands:",",grouping:[3],currency:["$",""]});function lW(n){return E_=aW(n),mD=E_.format,gD=E_.formatPrefix,E_}function cW(n){return Math.max(0,-$f(Math.abs(n)))}function uW(n,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor($f(i)/3)))*3-$f(Math.abs(n)))}function hW(n,i){return n=Math.abs(n),i=Math.abs(i)-n,Math.max(0,$f(i)-$f(n))+1}function fW(n,i){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(i).domain(n);break}return this}function dW(n){return function(){return n}}function pW(n){return+n}var JC=[0,1];function Df(n){return n}function V1(n,i){return(i-=n=+n)?function(o){return(o-n)/i}:dW(isNaN(i)?NaN:.5)}function mW(n,i){var o;return n>i&&(o=n,n=i,i=o),function(c){return Math.max(n,Math.min(i,c))}}function gW(n,i,o){var c=n[0],h=n[1],p=i[0],g=i[1];return h<c?(c=V1(h,c),p=o(g,p)):(c=V1(c,h),p=o(p,g)),function(x){return p(c(x))}}function _W(n,i,o){var c=Math.min(n.length,i.length)-1,h=new Array(c),p=new Array(c),g=-1;for(n[c]<n[0]&&(n=n.slice().reverse(),i=i.slice().reverse());++g<c;)h[g]=V1(n[g],n[g+1]),p[g]=o(i[g],i[g+1]);return function(x){var s=w7(n,x,1,c)-1;return p[s](h[s](x))}}function yW(n,i){return i.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function vW(){var n=JC,i=JC,o=Ob,c,h,p,g=Df,x,s,M;function C(){var F=Math.min(n.length,i.length);return g!==Df&&(g=mW(n[0],n[F-1])),x=F>2?_W:gW,s=M=null,D}function D(F){return F==null||isNaN(F=+F)?p:(s||(s=x(n.map(c),i,o)))(c(g(F)))}return D.invert=function(F){return g(h((M||(M=x(i,n.map(c),Wa)))(F)))},D.domain=function(F){return arguments.length?(n=Array.from(F,pW),C()):n.slice()},D.range=function(F){return arguments.length?(i=Array.from(F),C()):i.slice()},D.rangeRound=function(F){return i=Array.from(F),o=BG,C()},D.clamp=function(F){return arguments.length?(g=F?!0:Df,C()):g!==Df},D.interpolate=function(F){return arguments.length?(o=F,C()):o},D.unknown=function(F){return arguments.length?(p=F,D):p},function(F,V){return c=F,h=V,C()}}function xW(){return vW()(Df,Df)}function bW(n,i,o,c){var h=A7(n,i,o),p;switch(c=ky(c??",f"),c.type){case"s":{var g=Math.max(Math.abs(n),Math.abs(i));return c.precision==null&&!isNaN(p=uW(h,g))&&(c.precision=p),gD(c,g)}case"":case"e":case"g":case"p":case"r":{c.precision==null&&!isNaN(p=hW(h,Math.max(Math.abs(n),Math.abs(i))))&&(c.precision=p-(c.type==="e"));break}case"f":case"%":{c.precision==null&&!isNaN(p=cW(h))&&(c.precision=p-(c.type==="%")*2);break}}return mD(c)}function wW(n){var i=n.domain;return n.ticks=function(o){var c=i();return E7(c[0],c[c.length-1],o??10)},n.tickFormat=function(o,c){var h=i();return bW(h[0],h[h.length-1],o??10,c)},n.nice=function(o){o==null&&(o=10);var c=i(),h=0,p=c.length-1,g=c[h],x=c[p],s,M,C=10;for(x<g&&(M=g,g=x,x=M,M=h,h=p,p=M);C-- >0;){if(M=k1(g,x,o),M===s)return c[h]=g,c[p]=x,i(c);if(M>0)g=Math.floor(g/M)*M,x=Math.ceil(x/M)*M;else if(M<0)g=Math.ceil(g*M)/M,x=Math.floor(x*M)/M;else break;s=M}return n},n}function TW(){var n=xW();return n.copy=function(){return yW(n,TW())},fW.apply(n,arguments),wW(n)}function Rp(n,i,o){this.k=n,this.x=i,this.y=o}Rp.prototype={constructor:Rp,scale:function(n){return n===1?this:new Rp(this.k*n,this.x,this.y)},translate:function(n,i){return n===0&i===0?this:new Rp(this.k,this.x+this.k*n,this.y+this.k*i)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Rp.prototype;const SW=n=>({svgSize:n&4}),KC=n=>({svgSize:n[5][n[2]]}),MW=n=>({svgSize:n&4}),QC=n=>({svgSize:n[5][n[2]]});function EW(n){let i,o,c,h,p,g,x=n[0]&&$C(n);const s=n[9].default,M=cm(s,n,n[8],KC);let C=[{type:"button"},n[6],{class:n[4]},{"aria-label":c=n[1]??n[0]}],D={};for(let F=0;F<C.length;F+=1)D=zn(D,C[F]);return{c(){i=Di("button"),x&&x.c(),o=zr(),M&&M.c(),this.h()},l(F){i=Vi(F,"BUTTON",{type:!0,class:!0,"aria-label":!0});var V=ot(i);x&&x.l(V),o=Fr(V),M&&M.l(V),V.forEach(De),this.h()},h(){Vf(i,D)},m(F,V){Ai(F,i,V),x&&x.m(i,null),it(i,o),M&&M.m(i,null),i.autofocus&&i.focus(),h=!0,p||(g=Pt(i,"click",n[10]),p=!0)},p(F,V){F[0]?x?x.p(F,V):(x=$C(F),x.c(),x.m(i,o)):x&&(x.d(1),x=null),M&&M.p&&(!h||V&260)&&hm(M,s,F,F[8],h?um(s,F[8],V,SW):fm(F[8]),KC),Vf(i,D=ba(C,[{type:"button"},V&64&&F[6],(!h||V&16)&&{class:F[4]},(!h||V&3&&c!==(c=F[1]??F[0]))&&{"aria-label":c}]))},i(F){h||(no(M,F),h=!0)},o(F){Fo(M,F),h=!1},d(F){F&&De(i),x&&x.d(),M&&M.d(F),p=!1,g()}}}function AW(n){let i,o,c,h,p=n[0]&&eP(n);const g=n[9].default,x=cm(g,n,n[8],QC);let s=[{href:n[3]},n[6],{class:n[4]},{"aria-label":c=n[1]??n[0]}],M={};for(let C=0;C<s.length;C+=1)M=zn(M,s[C]);return{c(){i=Di("a"),p&&p.c(),o=zr(),x&&x.c(),this.h()},l(C){i=Vi(C,"A",{href:!0,class:!0,"aria-label":!0});var D=ot(i);p&&p.l(D),o=Fr(D),x&&x.l(D),D.forEach(De),this.h()},h(){Vf(i,M)},m(C,D){Ai(C,i,D),p&&p.m(i,null),it(i,o),x&&x.m(i,null),h=!0},p(C,D){C[0]?p?p.p(C,D):(p=eP(C),p.c(),p.m(i,o)):p&&(p.d(1),p=null),x&&x.p&&(!h||D&260)&&hm(x,g,C,C[8],h?um(g,C[8],D,MW):fm(C[8]),QC),Vf(i,M=ba(s,[(!h||D&8)&&{href:C[3]},D&64&&C[6],(!h||D&16)&&{class:C[4]},(!h||D&3&&c!==(c=C[1]??C[0]))&&{"aria-label":c}]))},i(C){h||(no(x,C),h=!0)},o(C){Fo(x,C),h=!1},d(C){C&&De(i),p&&p.d(),x&&x.d(C)}}}function $C(n){let i,o;return{c(){i=Di("span"),o=fr(n[0]),this.h()},l(c){i=Vi(c,"SPAN",{class:!0});var h=ot(i);o=vr(h,n[0]),h.forEach(De),this.h()},h(){xe(i,"class","sr-only")},m(c,h){Ai(c,i,h),it(i,o)},p(c,h){h&1&&go(o,c[0])},d(c){c&&De(i)}}}function eP(n){let i,o;return{c(){i=Di("span"),o=fr(n[0]),this.h()},l(c){i=Vi(c,"SPAN",{class:!0});var h=ot(i);o=vr(h,n[0]),h.forEach(De),this.h()},h(){xe(i,"class","sr-only")},m(c,h){Ai(c,i,h),it(i,o)},p(c,h){h&1&&go(o,c[0])},d(c){c&&De(i)}}}function IW(n){let i,o,c,h;const p=[AW,EW],g=[];function x(s,M){return s[3]?0:1}return i=x(n),o=g[i]=p[i](n),{c(){o.c(),c=ar()},l(s){o.l(s),c=ar()},m(s,M){g[i].m(s,M),Ai(s,c,M),h=!0},p(s,[M]){let C=i;i=x(s),i===C?g[i].p(s,M):(Ry(),Fo(g[C],1,1,()=>{g[C]=null}),zy(),o=g[i],o?o.p(s,M):(o=g[i]=p[i](s),o.c()),no(o,1),o.m(c.parentNode,c))},i(s){h||(no(o),h=!0)},o(s){Fo(o),h=!1},d(s){s&&De(c),g[i].d(s)}}}function CW(n,i,o){const c=["color","name","ariaLabel","size","href"];let h=qr(i,c),{$$slots:p={},$$scope:g}=i;const x=Ec("background");let{color:s="default"}=i,{name:M=void 0}=i,{ariaLabel:C=void 0}=i,{size:D="md"}=i,{href:F=void 0}=i;const V={dark:"text-gray-500 hover:text-gray-900 hover:bg-gray-200 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-600",gray:"text-gray-500 focus:ring-gray-400 hover:bg-gray-200 dark:hover:bg-gray-800 dark:hover:text-gray-300",red:"text-red-500 focus:ring-red-400 hover:bg-red-200 dark:hover:bg-red-800 dark:hover:text-red-300",yellow:"text-yellow-500 focus:ring-yellow-400 hover:bg-yellow-200 dark:hover:bg-yellow-800 dark:hover:text-yellow-300",green:"text-green-500 focus:ring-green-400 hover:bg-green-200 dark:hover:bg-green-800 dark:hover:text-green-300",indigo:"text-indigo-500 focus:ring-indigo-400 hover:bg-indigo-200 dark:hover:bg-indigo-800 dark:hover:text-indigo-300",purple:"text-purple-500 focus:ring-purple-400 hover:bg-purple-200 dark:hover:bg-purple-800 dark:hover:text-purple-300",pink:"text-pink-500 focus:ring-pink-400 hover:bg-pink-200 dark:hover:bg-pink-800 dark:hover:text-pink-300",blue:"text-blue-500 focus:ring-blue-400 hover:bg-blue-200 dark:hover:bg-blue-800 dark:hover:text-blue-300",primary:"text-primary-500 focus:ring-primary-400 hover:bg-primary-200 dark:hover:bg-primary-800 dark:hover:text-primary-300",default:"focus:ring-gray-400"},X={xs:"m-0.5 rounded-sm focus:ring-1 p-0.5",sm:"m-0.5 rounded focus:ring-1 p-0.5",md:"m-0.5 rounded-lg focus:ring-2 p-1.5",lg:"m-0.5 rounded-lg focus:ring-2 p-2.5"};let W;const J={xs:"w-3 h-3",sm:"w-3.5 h-3.5",md:"w-5 h-5",lg:"w-5 h-5"};function $(ne){bi.call(this,n,ne)}return n.$$set=ne=>{o(14,i=zn(zn({},i),zo(ne))),o(6,h=qr(i,c)),"color"in ne&&o(7,s=ne.color),"name"in ne&&o(0,M=ne.name),"ariaLabel"in ne&&o(1,C=ne.ariaLabel),"size"in ne&&o(2,D=ne.size),"href"in ne&&o(3,F=ne.href),"$$scope"in ne&&o(8,g=ne.$$scope)},n.$$.update=()=>{o(4,W=xa("focus:outline-none whitespace-normal",X[D],V[s],s==="default"&&(x?"hover:bg-gray-100 dark:hover:bg-gray-600":"hover:bg-gray-100 dark:hover:bg-gray-700"),i.class))},i=zo(i),[M,C,D,F,W,J,h,s,g,p,$]}class PW extends No{constructor(i){super(),Bo(this,i,CW,IW,Ao,{color:7,name:0,ariaLabel:1,size:2,href:3})}}function kW(n){let i,o,c;return{c(){i=Xt("svg"),o=Xt("path"),this.h()},l(h){i=Kt(h,"svg",{class:!0,fill:!0,viewBox:!0,xmlns:!0});var p=ot(i);o=Kt(p,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),ot(o).forEach(De),p.forEach(De),this.h()},h(){xe(o,"fill-rule","evenodd"),xe(o,"d","M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"),xe(o,"clip-rule","evenodd"),xe(i,"class",c=n[4]),xe(i,"fill","currentColor"),xe(i,"viewBox","0 0 20 20"),xe(i,"xmlns","http://www.w3.org/2000/svg")},m(h,p){Ai(h,i,p),it(i,o)},p(h,p){p&16&&c!==(c=h[4])&&xe(i,"class",c)},d(h){h&&De(i)}}}function DW(n){let i,o;const c=[{name:n[0]},n[1],{class:xa("ms-auto",n[2].class)}];let h={$$slots:{default:[kW,({svgSize:p})=>({4:p}),({svgSize:p})=>p?16:0]},$$scope:{ctx:n}};for(let p=0;p<c.length;p+=1)h=zn(h,c[p]);return i=new PW({props:h}),i.$on("click",n[3]),{c(){Fy(i.$$.fragment)},l(p){By(i.$$.fragment,p)},m(p,g){dm(i,p,g),o=!0},p(p,[g]){const x=g&7?ba(c,[g&1&&{name:p[0]},g&2&&xz(p[1]),g&4&&{class:xa("ms-auto",p[2].class)}]):{};g&48&&(x.$$scope={dirty:g,ctx:p}),i.$set(x)},i(p){o||(no(i.$$.fragment,p),o=!0)},o(p){Fo(i.$$.fragment,p),o=!1},d(p){pm(i,p)}}}function LW(n,i,o){const c=["name"];let h=qr(i,c),{name:p="Close"}=i;function g(x){bi.call(this,n,x)}return n.$$set=x=>{o(2,i=zn(zn({},i),zo(x))),o(1,h=qr(i,c)),"name"in x&&o(0,p=x.name)},i=zo(i),[p,h,i,g]}class bq extends No{constructor(i){super(),Bo(this,i,LW,DW,Ao,{name:0})}}const OW=(n,i)=>{const o=c=>{c!=null&&c.target&&n&&!n.contains(c.target)&&!c.defaultPrevented&&i()};return document.addEventListener("click",o,!0),{destroy(){document.removeEventListener("click",o,!0)}}},RW=n=>({hidden:n&1}),tP=n=>({hidden:n[0]});function iP(n){let i,o,c,h,p,g,x;function s(W,J){if(W[4]&&W[1])return FW;if(W[4]&&!W[1])return zW}let M=s(n),C=M&&M(n);const D=n[25].default,F=cm(D,n,n[24],tP);let V=[{id:n[6]},n[15],{class:c=xa(n[7],n[3],n[2],n[10][n[5]],n[16].class)},{tabindex:"-1"},{"aria-controls":n[6]},{"aria-labelledby":n[6]}],X={};for(let W=0;W<V.length;W+=1)X=zn(X,V[W]);return{c(){C&&C.c(),i=zr(),o=Di("div"),F&&F.c(),this.h()},l(W){C&&C.l(W),i=Fr(W),o=Vi(W,"DIV",{id:!0,class:!0,tabindex:!0,"aria-controls":!0,"aria-labelledby":!0});var J=ot(o);F&&F.l(J),J.forEach(De),this.h()},h(){Vf(o,X)},m(W,J){C&&C.m(W,J),Ai(W,i,J),Ai(W,o,J),F&&F.m(o,null),p=!0,g||(x=ez(n[14].call(null,o,n[12])),g=!0)},p(W,J){n=W,M===(M=s(n))&&C?C.p(n,J):(C&&C.d(1),C=M&&M(n),C&&(C.c(),C.m(i.parentNode,i))),F&&F.p&&(!p||J&16777217)&&hm(F,D,n,n[24],p?um(D,n[24],J,RW):fm(n[24]),tP),Vf(o,X=ba(V,[(!p||J&64)&&{id:n[6]},J&32768&&n[15],(!p||J&65708&&c!==(c=xa(n[7],n[3],n[2],n[10][n[5]],n[16].class)))&&{class:c},{tabindex:"-1"},(!p||J&64)&&{"aria-controls":n[6]},(!p||J&64)&&{"aria-labelledby":n[6]}]))},i(W){p||(no(F,W),W&&jf(()=>{p&&(h||(h=Q_(o,n[9],n[8],!0)),h.run(1))}),p=!0)},o(W){Fo(F,W),W&&(h||(h=Q_(o,n[9],n[8],!1)),h.run(0)),p=!1},d(W){W&&(De(i),De(o)),C&&C.d(W),F&&F.d(W),W&&h&&h.end(),g=!1,x()}}}function zW(n){let i;return{c(){i=Di("div"),this.h()},l(o){i=Vi(o,"DIV",{role:!0,class:!0}),ot(i).forEach(De),this.h()},h(){xe(i,"role","presentation"),xe(i,"class",n[13])},m(o,c){Ai(o,i,c)},p:Rn,d(o){o&&De(i)}}}function FW(n){let i,o,c;return{c(){i=Di("div"),this.h()},l(h){i=Vi(h,"DIV",{role:!0,class:!0}),ot(i).forEach(De),this.h()},h(){xe(i,"role","presentation"),xe(i,"class",n[13])},m(h,p){Ai(h,i,p),o||(c=Pt(i,"click",n[26]),o=!0)},p:Rn,d(h){h&&De(i),o=!1,c()}}}function BW(n){let i,o,c=!n[0]&&iP(n);return{c(){c&&c.c(),i=ar()},l(h){c&&c.l(h),i=ar()},m(h,p){c&&c.m(h,p),Ai(h,i,p),o=!0},p(h,[p]){h[0]?c&&(Ry(),Fo(c,1,1,()=>{c=null}),zy()):c?(c.p(h,p),p&1&&no(c,1)):(c=iP(h),c.c(),no(c,1),c.m(i.parentNode,i))},i(h){o||(no(c),o=!0)},o(h){Fo(c),o=!1},d(h){h&&De(i),c&&c.d(h)}}}function NW(n,i,o){const c=["activateClickOutside","hidden","position","leftOffset","rightOffset","topOffset","bottomOffset","width","backdrop","bgColor","bgOpacity","placement","id","divClass","transitionParams","transitionType"];let h=qr(i,c),{$$slots:p={},$$scope:g}=i,{activateClickOutside:x=!0}=i,{hidden:s=!0}=i,{position:M="fixed"}=i,{leftOffset:C="inset-y-0 start-0"}=i,{rightOffset:D="inset-y-0 end-0"}=i,{topOffset:F="inset-x-0 top-0"}=i,{bottomOffset:V="inset-x-0 bottom-0"}=i,{width:X="w-80"}=i,{backdrop:W=!0}=i,{bgColor:J="bg-gray-900"}=i,{bgOpacity:$="bg-opacity-75"}=i,{placement:ne="left"}=i,{id:ye="drawer-example"}=i,{divClass:pe="overflow-y-auto z-50 p-4 bg-white dark:bg-gray-800"}=i,{transitionParams:ke={}}=i,{transitionType:Ae="fly"}=i;function tt(Tt,Yt){switch(Ae){case"slide":return Cj(Tt,Yt);case"blur":return Aj(Tt,Yt);case"fade":return Ij(Tt,Yt);default:return R3(Tt,Yt)}}const pt={left:C,right:D,top:F,bottom:V},kt=()=>{o(0,s=!s)},Ie=()=>x&&!s&&kt();let Et=xa("fixed top-0 start-0 z-50 w-full h-full",W&&J,W&&$);function mt(Tt,Yt){return x?OW(Tt,Yt):void 0}const Xe=()=>!s&&kt();return n.$$set=Tt=>{o(16,i=zn(zn({},i),zo(Tt))),o(15,h=qr(i,c)),"activateClickOutside"in Tt&&o(1,x=Tt.activateClickOutside),"hidden"in Tt&&o(0,s=Tt.hidden),"position"in Tt&&o(2,M=Tt.position),"leftOffset"in Tt&&o(17,C=Tt.leftOffset),"rightOffset"in Tt&&o(18,D=Tt.rightOffset),"topOffset"in Tt&&o(19,F=Tt.topOffset),"bottomOffset"in Tt&&o(20,V=Tt.bottomOffset),"width"in Tt&&o(3,X=Tt.width),"backdrop"in Tt&&o(4,W=Tt.backdrop),"bgColor"in Tt&&o(21,J=Tt.bgColor),"bgOpacity"in Tt&&o(22,$=Tt.bgOpacity),"placement"in Tt&&o(5,ne=Tt.placement),"id"in Tt&&o(6,ye=Tt.id),"divClass"in Tt&&o(7,pe=Tt.divClass),"transitionParams"in Tt&&o(8,ke=Tt.transitionParams),"transitionType"in Tt&&o(23,Ae=Tt.transitionType),"$$scope"in Tt&&o(24,g=Tt.$$scope)},i=zo(i),[s,x,M,X,W,ne,ye,pe,ke,tt,pt,kt,Ie,Et,mt,h,i,C,D,F,V,J,$,Ae,g,p,Xe]}class wq extends No{constructor(i){super(),Bo(this,i,NW,BW,Ao,{activateClickOutside:1,hidden:0,position:2,leftOffset:17,rightOffset:18,topOffset:19,bottomOffset:20,width:3,backdrop:4,bgColor:21,bgOpacity:22,placement:5,id:6,divClass:7,transitionParams:8,transitionType:23})}}function VW(n){let i,o,c,h,p,g,x,s,M,C,D,F,V,X,W,J,$,ne,ye,pe,ke,Ae,tt,pt,kt,Ie,Et,mt,Xe,Tt,Yt,mi,Ti,Zi,wt,Ii,Ui,Mi,st,rt,zi,Si,bn,nn,hn,Ze,wn,Sr,Mr,cn,Bt,si,je,re,fe,Ee,dt,ft,Ut=[{xmlns:"http://www.w3.org/2000/svg"},{"xmlns:xlink":"http://www.w3.org/1999/xlink"},{id:"flag-icons-kh"},{width:n[0]},{height:n[0]},n[3],{role:n[1]},{"aria-label":n[2]},{viewBox:"0 0 640 480"}],Wt={};for(let at=0;at<Ut.length;at+=1)Wt=zn(Wt,Ut[at]);return{c(){i=Xt("svg"),o=Xt("path"),c=Xt("path"),h=Xt("g"),p=Xt("g"),g=Xt("path"),x=Xt("path"),s=Xt("path"),M=Xt("path"),C=Xt("path"),D=Xt("path"),F=Xt("path"),V=Xt("path"),X=Xt("path"),W=Xt("path"),J=Xt("path"),$=Xt("path"),ne=Xt("path"),ye=Xt("path"),pe=Xt("g"),ke=Xt("path"),Ae=Xt("path"),tt=Xt("path"),pt=Xt("path"),kt=Xt("path"),Ie=Xt("path"),Et=Xt("path"),mt=Xt("path"),Xe=Xt("path"),Tt=Xt("path"),Yt=Xt("g"),mi=Xt("path"),Ti=Xt("path"),Zi=Xt("path"),wt=Xt("path"),Ii=Xt("path"),Ui=Xt("path"),Mi=Xt("path"),st=Xt("path"),rt=Xt("path"),zi=Xt("path"),Si=Xt("path"),bn=Xt("path"),nn=Xt("path"),hn=Xt("path"),Ze=Xt("path"),wn=Xt("path"),Sr=Xt("path"),Mr=Xt("use"),cn=Xt("path"),Bt=Xt("path"),si=Xt("path"),je=Xt("path"),re=Xt("path"),fe=Xt("path"),Ee=Xt("path"),this.h()},l(at){i=Kt(at,"svg",{xmlns:!0,"xmlns:xlink":!0,id:!0,width:!0,height:!0,role:!0,"aria-label":!0,viewBox:!0});var Zt=ot(i);o=Kt(Zt,"path",{fill:!0,d:!0}),ot(o).forEach(De),c=Kt(Zt,"path",{fill:!0,d:!0}),ot(c).forEach(De),h=Kt(Zt,"g",{fill:!0,stroke:!0,transform:!0});var Gt=ot(h);p=Kt(Gt,"g",{"stroke-linejoin":!0});var qt=ot(p);g=Kt(qt,"path",{d:!0}),ot(g).forEach(De),x=Kt(qt,"path",{d:!0}),ot(x).forEach(De),s=Kt(qt,"path",{"stroke-width":!0,d:!0}),ot(s).forEach(De),M=Kt(qt,"path",{d:!0}),ot(M).forEach(De),C=Kt(qt,"path",{"stroke-linejoin":!0,d:!0}),ot(C).forEach(De),qt.forEach(De),D=Kt(Gt,"path",{d:!0}),ot(D).forEach(De),F=Kt(Gt,"path",{"stroke-linejoin":!0,d:!0}),ot(F).forEach(De),V=Kt(Gt,"path",{d:!0}),ot(V).forEach(De),X=Kt(Gt,"path",{d:!0}),ot(X).forEach(De),W=Kt(Gt,"path",{d:!0}),ot(W).forEach(De),J=Kt(Gt,"path",{d:!0}),ot(J).forEach(De),$=Kt(Gt,"path",{"stroke-linejoin":!0,d:!0}),ot($).forEach(De),ne=Kt(Gt,"path",{d:!0}),ot(ne).forEach(De),ye=Kt(Gt,"path",{d:!0}),ot(ye).forEach(De),pe=Kt(Gt,"g",{fill:!0,"stroke-width":!0});var rn=ot(pe);ke=Kt(rn,"path",{d:!0}),ot(ke).forEach(De),Ae=Kt(rn,"path",{"stroke-width":!0,d:!0}),ot(Ae).forEach(De),rn.forEach(De),tt=Kt(Gt,"path",{d:!0}),ot(tt).forEach(De),pt=Kt(Gt,"path",{d:!0}),ot(pt).forEach(De),kt=Kt(Gt,"path",{d:!0}),ot(kt).forEach(De),Ie=Kt(Gt,"path",{"stroke-linejoin":!0,d:!0}),ot(Ie).forEach(De),Et=Kt(Gt,"path",{"stroke-linejoin":!0,d:!0}),ot(Et).forEach(De),mt=Kt(Gt,"path",{"stroke-linejoin":!0,d:!0}),ot(mt).forEach(De),Xe=Kt(Gt,"path",{"stroke-linejoin":!0,d:!0}),ot(Xe).forEach(De),Tt=Kt(Gt,"path",{d:!0}),ot(Tt).forEach(De),Yt=Kt(Gt,"g",{id:!0});var Bi=ot(Yt);mi=Kt(Bi,"path",{d:!0}),ot(mi).forEach(De),Ti=Kt(Bi,"path",{d:!0}),ot(Ti).forEach(De),Zi=Kt(Bi,"path",{d:!0}),ot(Zi).forEach(De),wt=Kt(Bi,"path",{d:!0}),ot(wt).forEach(De),Ii=Kt(Bi,"path",{d:!0}),ot(Ii).forEach(De),Ui=Kt(Bi,"path",{d:!0}),ot(Ui).forEach(De),Mi=Kt(Bi,"path",{"stroke-linejoin":!0,d:!0}),ot(Mi).forEach(De),st=Kt(Bi,"path",{d:!0}),ot(st).forEach(De),rt=Kt(Bi,"path",{d:!0}),ot(rt).forEach(De),zi=Kt(Bi,"path",{d:!0}),ot(zi).forEach(De),Si=Kt(Bi,"path",{d:!0}),ot(Si).forEach(De),bn=Kt(Bi,"path",{d:!0}),ot(bn).forEach(De),nn=Kt(Bi,"path",{d:!0}),ot(nn).forEach(De),hn=Kt(Bi,"path",{d:!0}),ot(hn).forEach(De),Ze=Kt(Bi,"path",{d:!0}),ot(Ze).forEach(De),wn=Kt(Bi,"path",{d:!0}),ot(wn).forEach(De),Sr=Kt(Bi,"path",{d:!0}),ot(Sr).forEach(De),Bi.forEach(De),Mr=Kt(Gt,"use",{"xlink:href":!0,width:!0,height:!0,transform:!0}),ot(Mr).forEach(De),cn=Kt(Gt,"path",{d:!0}),ot(cn).forEach(De),Bt=Kt(Gt,"path",{d:!0}),ot(Bt).forEach(De),si=Kt(Gt,"path",{d:!0}),ot(si).forEach(De),je=Kt(Gt,"path",{d:!0}),ot(je).forEach(De),re=Kt(Gt,"path",{d:!0}),ot(re).forEach(De),fe=Kt(Gt,"path",{d:!0}),ot(fe).forEach(De),Ee=Kt(Gt,"path",{fill:!0,d:!0}),ot(Ee).forEach(De),Gt.forEach(De),Zt.forEach(De),this.h()},h(){xe(o,"fill","#032ea1"),xe(o,"d","M0 0h640v480H0z"),xe(c,"fill","#e00025"),xe(c,"d","M0 120h640v240H0z"),xe(g,"d","M139 623.5h113.8v43.8H139z"),xe(x,"d","M247 647.6h3.5v16.5H247zm-108-8.1h113.8v5H139zm0-7h113.8v4.6H139z"),xe(s,"stroke-width",".9"),xe(s,"d","M139 625.7h113.8v4.3H139z"),xe(M,"d","M169 647.6h3.6v16.5H169zm49 0h3.6v16.5H218zm-78 0h3.5v16.5H140zm7 0h3.5v16.5H147zm7.5 0h3.5v16.5h-3.5zm7.5 0h3.5v16.5H162zm62.8 0h3.6v16.5h-3.6zm7.5 0h3.6v16.5h-3.6zm7.5 0h3.6v16.5h-3.6z"),xe(C,"stroke-linejoin","miter"),xe(C,"d","M94.5 669.5a9.3 9.3 0 0 0 4.4-5.3H292a9.3 9.3 0 0 0 4.4 5.3z"),xe(p,"stroke-linejoin","bevel"),xe(D,"d","M193 556.8s-.1-4.1 2.3-4.2c2.3 0 2.2 4.2 2.2 4.2zm-12.5 54.5v-5.5c0-2.8-2.8-3-2.8-5 0 0-.4-3 .4-4.4 1.1 4 3 3.3 3 1.6 0-1.4-1-2.8-3.3-6.3-.8-1.1-.3-4.6.7-5.9.4 3 .9 4.5 2.2 4.5.8 0 1.4-.5 1.4-2 0-2-1.3-3-2-4.8a5 5 0 0 1 1.1-5.3c.5 3 .4 4.2 1.7 4.2 2.7-.9 0-4.8-.6-5.8-.6-1.1 1-3.4 1-3.4.8 2.7 1 2.9 2 2.6 1.2-.3 1-2-.4-3.4-.9-1-.8-2.3.2-3.3 1 1.9 2.2 1.8 2.3.6l-.8-4.4H204l-.9 4.3c-.2 1.2 1.4 1.5 2.4-.5 1 1 1.1 2.4.2 3.3-1.4 1.4-1.6 3.1-.4 3.4 1 .3 1.2 0 2-2.6 0 0 1.5 1.5 1 3.4-.6 1-3.3 5-.6 5.8 1.3 0 1.2-1.2 1.7-4.2a5 5 0 0 1 1 5.3c-.6 1.8-2 2.8-2 4.8 0 1.5.7 2 1.5 2 1.3 0 1.8-1.4 2.2-4.5 1 1.3 1.5 4.8.7 6-2.3 3.4-3.4 4.8-3.4 6.2 0 1.7 2 2.4 3-1.6.9 1.4.5 4.4.5 4.4 0 2-2.7 2.2-2.8 5v5.5zm7.2-46-.4-3.1h15.9l-.4 3.1zm1-3.2-.2-2.5H202l-.3 2.5zm2.3-2.6-.3-2.6h9l-.1 2.6zm33 110c-2-.7-5-2.9-5-5v-24.3l2.6-3.4H169l2.5 3.4v24.3c0 2.1-2 4.3-4 5z"),xe(F,"stroke-linejoin","bevel"),xe(F,"d","M178.2 647.6h3.6v16.5h-3.6zm30.4 0h3.6v16.5h-3.6z"),xe(V,"d","M168 609.2v27.6h54v-27.6a4.2 4.2 0 0 0-2.6 2.8v11.8h-48.7V612s-.6-2-2.8-2.8z"),xe(X,"d","M214.6 669.5c-1.8-.7-5.6-2.9-5.6-5v-27.2c.4-1.5 2.4-2.4 3.7-3.4H177c1.7 1 3.6 1.7 4.3 3.4v27.2c0 2.1-3 4.3-4.8 5z"),xe(W,"d","M219.4 634.2v-19.6h-4.9v-1.9h-38.8v2h-5v19.5zM207 669.5c-1.8-.7-4.3-2.9-4.3-5v-23.2l1.4-2.1h-17.7l1.5 2v23.3c0 2.1-2.6 4.3-4.3 5z"),xe(J,"d","M190.7 639.2h9v30.3h-9z"),xe($,"stroke-linejoin","bevel"),xe($,"d","M204.4 632.5c0-2 5.8-2.1 8.8-3.8h-36c3 1.7 8.7 1.8 8.7 3.8l1.2 3.9 15 .6z"),xe(ne,"d","M211.4 611.3c0-4.9.2-6.7 1.7-6.7V620c-3.7 1.4-6.3 6-6.3 6h-23.2s-2.6-4.6-6.3-6v-15.5c1.8 0 1.8 2 1.8 6.7zm1.7-2c0-5.6 4.9-6.2 4.9-6.2v5c-1.9-.1-2.8 1.6-2.8 4 0 2.5 1.5 2.5 1.5 2.5v14.2h-3.6z"),xe(ye,"d","M177.3 609.3c0-5.6-4.9-6.2-4.9-6.2v5c1.9-.1 2.8 1.6 2.8 4 0 2.5-1.5 2.5-1.5 2.5v14.2h3.6z"),xe(ke,"d","M186.8 570.6H204m-19.2 5.4h21m-23 6.5h24.9m-27 7.9h29.5m-30.2 9h30.4"),xe(Ae,"stroke-width","1"),xe(Ae,"d","M170.8 629h48.6m-33.2 0h18v6.6h-18z"),xe(pe,"fill","none"),xe(pe,"stroke-width",".8"),xe(tt,"d","M184 614.2c3 3.6 2.6 9.7 2.6 13.3H204c0-3.6-.4-9.7 2.6-13.3zm9.7-41-2.4-1.3v-3.5c1 .3 2 .4 2.2 2 .3-2.3 1-2.1 1.9-3 1 .9 1.5.7 1.9 3 0-1.6 1.2-1.7 2.1-2v3.5l-2.3 1.2z"),xe(pt,"d","m193.5 578.9-4-2.8V573c1.5.3 3 .5 3.2 2.2.4-2.5 1.3-3.7 2.7-4.7 1.3 1 2.2 2.2 2.7 4.7.1-1.7 1.7-1.9 3-2.2v3.2l-3.9 2.7z"),xe(kt,"d","m193.2 587.8-4.5-4v-4.7c1.6.4 3.4.6 3.6 3.1.5-3.5 1.5-5.4 3-6.8 1.6 1.4 2.6 3.3 3.2 6.8.2-2.5 2-2.7 3.6-3.1v4.7l-4.6 4zm8.4 5.3-4 5.7h-4.7l-4.1-5.7zm-15.2 9.5c2 1.1 2.8 3.4 3 7.6H201c.2-4.2 1-6.5 3-7.6z"),xe(Ie,"stroke-linejoin","bevel"),xe(Ie,"d","M204.2 593v-5.6a5.2 5.2 0 0 0-3.8 3.3c0-2-2.5-6.3-5.2-8.5-2.7 2.4-5.3 6.4-5.2 8.4-.5-1.5-1.8-2.7-3.8-3.2v5.7z"),xe(Et,"stroke-linejoin","bevel"),xe(Et,"d","M205 602.6V597c-2.1.6-3.5 1.7-4.1 3.3 0-2-2.7-6.3-5.7-8.5-3 2.5-5.8 6.4-5.7 8.5-.5-1.5-2-2.7-4.1-3.3v5.7z"),xe(mt,"stroke-linejoin","bevel"),xe(mt,"d","M207.4 614.3v-6.6a9.6 9.6 0 0 0-5.1 3.8c0-3.5-4-9-7.1-10.7-3.2 1.8-7.1 7.4-7.1 10.7a9.7 9.7 0 0 0-5.2-3.8v6.6z"),xe(Xe,"stroke-linejoin","bevel"),xe(Xe,"d","M206 629v-6.8c-2.4.9-3 3.1-3.8 4.7.3-6.9-3.8-14.2-7-16.1-3.2 1.9-7.4 9.4-7 16-.8-1.4-1.5-3.7-3.8-4.6v6.7z"),xe(Tt,"d","M204.4 639.2v-6.8c-2.5.6-2.6 1.5-3.4 3 .3-4.1-2.6-8.8-5.8-10.6-3.2 1.8-6 6.5-5.8 10.6-.8-1.5-.9-2.4-3.4-3v6.8z"),xe(mi,"d","M99 664.2v-20.4c-.7-2.6-3-5-4.6-5.4v-18l3.7 2 4.3 18.9v23z"),xe(Ti,"d","M99 664.3v-20.5c-.7-2.6-3-5-4.6-5.4v-19.2c2.5 0 3.7 3.2 3.7 3.2l4.3 18.9v22.9z"),xe(Zi,"d","M96.3 669.5c1.7-.7 4.2-2.9 4.2-5v-25.6l-1.2-2H143l-1.7 2v25.6a6 6 0 0 0 3.4 5z"),xe(wt,"d","M135.8 669.5c-1.7-.7-4.2-2.9-4.2-5v-24.3l3.6-3.4h-29.6l3.6 3.4v24.3c0 2.1-2.5 4.3-4.2 5z"),xe(Ii,"d","M131.7 669.5c-1.7-.7-4.3-2.9-4.3-5v-22l2.4-3.3H111l2.4 3.3v22c0 2.1-2.5 4.3-4.3 5z"),xe(Ui,"d","M116 639.2h8.9v30.4h-9z"),xe(Mi,"stroke-linejoin","bevel"),xe(Mi,"d","M103.7 647.6h3.6v16.5h-3.6zm30.8 0h3.5v16.5h-3.6zm-33.9-27.8h4.4v17h-4.4zm0-3.2h4.3v3.2h-4.3zm35.6 6.9h6.1v13h-6.1z"),xe(st,"d","M104.9 636.6v-29c1.2 0 1.4 4.3 4.2 4.3 1.5 0 1.4-1.8.5-3.2-.7-1.3-1.6-3-.4-6.3.9 2.5 3.1 3.3 2.7 1.8-.7-2.7-2.8-3.2-1.2-7.3.5 3.4 2.7 3.3 2.2 1.3-.6-2.3-1.9-3.3-.3-6.5.9 3.7 2 3.5 2 1.2 0-3.4 0-7 4.2-8.3 0 0 .3-3 1.9-3 1.5 0 1.8 3 1.8 3 4.3 1.3 4.2 5 4.2 8.3 0 2.3 1.1 2.5 2-1.2 1.6 3.2.3 4.2-.3 6.5-.5 2 1.7 2.1 2.2-1.3 1.6 4.1-.5 4.6-1.2 7.3-.4 1.5 1.8.7 2.7-1.8 1.2 3.3.3 5-.4 6.3-.8 1.4-1 3.2.5 3.2 2.8 0 3-4.2 4.2-4.2v28.9zM98 614.7v22.1h2.5v-22.1c-.9-.5-1.7-.5-2.5 0z"),xe(rt,"d","M98.2 629c3.1 1.6 6.2 3.5 7 7.8h-7zm43.2-6.6v14.4h2v-14.4c-.6-.3-1.5-.4-2 0z"),xe(zi,"d","M143.4 629c-3.1 1.5-6.2 3.3-7 7.7h7zm-20.6-33.7 1.8-1.5v-2c-.6 0-1 .3-1.5 1a5 5 0 0 0-2.5-3 5 5 0 0 0-2.6 2.9c-.5-.7-.8-.8-1.5-1v2l1.8 1.6z"),xe(Si,"d","m123.8 600.2.8-1.9v-2.5c-.6 0-1 .3-1.5 1a5 5 0 0 0-2.5-3 5 5 0 0 0-2.6 2.9c-.5-.7-.8-.8-1.5-.9v2.5l.8 1.9z"),xe(bn,"d","m124 606.8 2.6-3.3v-3.2c-1 0-1.5.5-2.2 1.6-.7-2.3-2-2.7-3.8-3.8-1.9 1-3.2 1.5-3.8 3.7-.8-1.1-1.3-1.4-2.3-1.5v3.2l2.7 3.3z"),xe(nn,"d","M124.7 613.3s3.2-2.7 3.3-4.2v-3.5c-1.2.1-2.3.4-3.2 1.9-.8-2.9-2-3.7-4.2-5-2.3 1.3-3.5 2.1-4.2 5-1-1.5-2-1.8-3.3-2v3.6a15 15 0 0 0 3.3 4.2z"),xe(hn,"d","M126 625.3s4.4-4.7 4.5-6.6v-5.4c-1.6.2-3.2 1.3-4.4 3.6-1-4.5-2.6-7.6-5.5-9.8-3 2.2-4.6 5.3-5.6 9.8-1.2-2.3-2.7-3.4-4.3-3.6v5.4c.3 1.9 4.4 6.6 4.4 6.6z"),xe(Ze,"d","M126 632.4s3.7-3.7 4.5-5.3v-5.4c-1.6.2-3.2 1.3-4.4 3.5a14 14 0 0 0-5.5-9.2c-3 2.2-4.6 4.7-5.6 9.2-1.2-2.2-2.7-3.3-4.3-3.5v5.4c1 1.6 4.4 5.3 4.4 5.3z"),xe(wn,"d","M127.5 636.6c-1-4.7-2-8.2-7.1-11.7-5.2 3.5-6.1 7-7.2 11.7z"),xe(Sr,"d","M130.2 639.2v-6.8c-2.4 1-4.5 2.3-5.3 3.8-.8-3.8-2.5-5.4-4.6-7.7-2.1 2.3-3.5 4-4.4 7.7-.8-1.5-2.9-2.9-5.2-3.8v6.8z"),xe(Yt,"id","kh-a"),Ep(Mr,"xlink:href","#kh-a"),xe(Mr,"width","100%"),xe(Mr,"height","100%"),xe(Mr,"transform","matrix(-1 0 0 1 390.7 0)"),xe(cn,"d","M72.7 694.3H318v12.5H72.7zm-6.5 12.5h258.3v12.5H66.2zm19.4-31.3H305v8.1H85.6z"),xe(Bt,"d","M79.2 683.6h232.4v10.6H79.2zm10.2-14.3h212v6.2h-212z"),xe(si,"d","M112.4 669.3h16v50h-16z"),xe(je,"d","M116 669.3h8.9v50h-9zm71 0h16v50h-16z"),xe(re,"d","M190.7 669.3h9v50h-9zm71.5 0h16v50h-16z"),xe(fe,"d","M265.7 669.3h9v50h-9z"),xe(Ee,"fill","none"),xe(Ee,"d","M99 664.2h193M115.8 713h9.2m-9.2-6.3h9.2m-9.2-6.2h9.2m-9.2-6.3h9.2m-9.2-6.2h9.2m-9.2-6.3h9.2m-9.2-6.2h9.2m65.8 37.5h8.6m-8.6-6.3h8.6m-8.6-6.2h8.6m-8.6-6.3h8.6m-8.6-6.2h8.6m-8.6-6.3h8.6m-8.6-6.2h8.6m66.2 37.5h9.2m-9.2-6.3h9.2m-9.2-6.2h9.2m-9.2-6.3h9.2m-9.2-6.2h9.2m-9.2-6.3h9.2m-9.2-6.2h9.2"),xe(h,"fill","#fff"),xe(h,"stroke","#000"),xe(h,"transform","matrix(1.2 0 0 1.2 85.6 -522)"),is(i,Wt)},m(at,Zt){Ai(at,i,Zt),it(i,o),it(i,c),it(i,h),it(h,p),it(p,g),it(p,x),it(p,s),it(p,M),it(p,C),it(h,D),it(h,F),it(h,V),it(h,X),it(h,W),it(h,J),it(h,$),it(h,ne),it(h,ye),it(h,pe),it(pe,ke),it(pe,Ae),it(h,tt),it(h,pt),it(h,kt),it(h,Ie),it(h,Et),it(h,mt),it(h,Xe),it(h,Tt),it(h,Yt),it(Yt,mi),it(Yt,Ti),it(Yt,Zi),it(Yt,wt),it(Yt,Ii),it(Yt,Ui),it(Yt,Mi),it(Yt,st),it(Yt,rt),it(Yt,zi),it(Yt,Si),it(Yt,bn),it(Yt,nn),it(Yt,hn),it(Yt,Ze),it(Yt,wn),it(Yt,Sr),it(h,Mr),it(h,cn),it(h,Bt),it(h,si),it(h,je),it(h,re),it(h,fe),it(h,Ee),dt||(ft=[Pt(i,"click",n[4]),Pt(i,"keydown",n[5]),Pt(i,"keyup",n[6]),Pt(i,"focus",n[7]),Pt(i,"blur",n[8]),Pt(i,"mouseenter",n[9]),Pt(i,"mouseleave",n[10]),Pt(i,"mouseover",n[11]),Pt(i,"mouseout",n[12])],dt=!0)},p(at,[Zt]){is(i,Wt=ba(Ut,[{xmlns:"http://www.w3.org/2000/svg"},{"xmlns:xlink":"http://www.w3.org/1999/xlink"},{id:"flag-icons-kh"},Zt&1&&{width:at[0]},Zt&1&&{height:at[0]},Zt&8&&at[3],Zt&2&&{role:at[1]},Zt&4&&{"aria-label":at[2]},{viewBox:"0 0 640 480"}]))},i:Rn,o:Rn,d(at){at&&De(i),dt=!1,Br(ft)}}}function UW(n,i,o){const c=["size","role","ariaLabel"];let h=qr(i,c);const p=Ec("iconCtx")??{};let{size:g=p.size||"24"}=i,{role:x=p.role||"img"}=i,{ariaLabel:s="flag of kh"}=i;function M(ne){bi.call(this,n,ne)}function C(ne){bi.call(this,n,ne)}function D(ne){bi.call(this,n,ne)}function F(ne){bi.call(this,n,ne)}function V(ne){bi.call(this,n,ne)}function X(ne){bi.call(this,n,ne)}function W(ne){bi.call(this,n,ne)}function J(ne){bi.call(this,n,ne)}function $(ne){bi.call(this,n,ne)}return n.$$set=ne=>{i=zn(zn({},i),zo(ne)),o(3,h=qr(i,c)),"size"in ne&&o(0,g=ne.size),"role"in ne&&o(1,x=ne.role),"ariaLabel"in ne&&o(2,s=ne.ariaLabel)},[g,x,s,h,M,C,D,F,V,X,W,J,$]}class Tq extends No{constructor(i){super(),Bo(this,i,UW,VW,Ao,{size:0,role:1,ariaLabel:2})}}function jW(n){let i,o,c,h,p,g,x,s,M,C,D=[{xmlns:"http://www.w3.org/2000/svg"},{id:"flag-icons-la"},{width:n[0]},{height:n[0]},n[3],{role:n[1]},{"aria-label":n[2]},{viewBox:"0 0 640 480"}],F={};for(let V=0;V<D.length;V+=1)F=zn(F,D[V]);return{c(){i=Xt("svg"),o=Xt("defs"),c=Xt("clipPath"),h=Xt("path"),p=Xt("g"),g=Xt("path"),x=Xt("path"),s=Xt("path"),this.h()},l(V){i=Kt(V,"svg",{xmlns:!0,id:!0,width:!0,height:!0,role:!0,"aria-label":!0,viewBox:!0});var X=ot(i);o=Kt(X,"defs",{});var W=ot(o);c=Kt(W,"clipPath",{id:!0});var J=ot(c);h=Kt(J,"path",{"fill-opacity":!0,d:!0}),ot(h).forEach(De),J.forEach(De),W.forEach(De),p=Kt(X,"g",{"fill-rule":!0,"clip-path":!0});var $=ot(p);g=Kt($,"path",{fill:!0,d:!0}),ot(g).forEach(De),x=Kt($,"path",{fill:!0,d:!0}),ot(x).forEach(De),s=Kt($,"path",{fill:!0,d:!0}),ot(s).forEach(De),$.forEach(De),X.forEach(De),this.h()},h(){xe(h,"fill-opacity",".7"),xe(h,"d","M0 0h640v480H0z"),xe(c,"id","la-a"),xe(g,"fill","#ce1126"),xe(g,"d","M-40 0h720v480H-40z"),xe(x,"fill","#002868"),xe(x,"d","M-40 119.3h720v241.4H-40z"),xe(s,"fill","#fff"),xe(s,"d","M423.4 240a103.4 103.4 0 1 1-206.8 0 103.4 103.4 0 1 1 206.8 0z"),xe(p,"fill-rule","evenodd"),xe(p,"clip-path","url(#la-a)"),is(i,F)},m(V,X){Ai(V,i,X),it(i,o),it(o,c),it(c,h),it(i,p),it(p,g),it(p,x),it(p,s),M||(C=[Pt(i,"click",n[4]),Pt(i,"keydown",n[5]),Pt(i,"keyup",n[6]),Pt(i,"focus",n[7]),Pt(i,"blur",n[8]),Pt(i,"mouseenter",n[9]),Pt(i,"mouseleave",n[10]),Pt(i,"mouseover",n[11]),Pt(i,"mouseout",n[12])],M=!0)},p(V,[X]){is(i,F=ba(D,[{xmlns:"http://www.w3.org/2000/svg"},{id:"flag-icons-la"},X&1&&{width:V[0]},X&1&&{height:V[0]},X&8&&V[3],X&2&&{role:V[1]},X&4&&{"aria-label":V[2]},{viewBox:"0 0 640 480"}]))},i:Rn,o:Rn,d(V){V&&De(i),M=!1,Br(C)}}}function GW(n,i,o){const c=["size","role","ariaLabel"];let h=qr(i,c);const p=Ec("iconCtx")??{};let{size:g=p.size||"24"}=i,{role:x=p.role||"img"}=i,{ariaLabel:s="flag of la"}=i;function M(ne){bi.call(this,n,ne)}function C(ne){bi.call(this,n,ne)}function D(ne){bi.call(this,n,ne)}function F(ne){bi.call(this,n,ne)}function V(ne){bi.call(this,n,ne)}function X(ne){bi.call(this,n,ne)}function W(ne){bi.call(this,n,ne)}function J(ne){bi.call(this,n,ne)}function $(ne){bi.call(this,n,ne)}return n.$$set=ne=>{i=zn(zn({},i),zo(ne)),o(3,h=qr(i,c)),"size"in ne&&o(0,g=ne.size),"role"in ne&&o(1,x=ne.role),"ariaLabel"in ne&&o(2,s=ne.ariaLabel)},[g,x,s,h,M,C,D,F,V,X,W,J,$]}class Sq extends No{constructor(i){super(),Bo(this,i,GW,jW,Ao,{size:0,role:1,ariaLabel:2})}}function HW(n){let i,o,c,h,p,g,x,s,M,C,D,F,V=[{xmlns:"http://www.w3.org/2000/svg"},{"xmlns:xlink":"http://www.w3.org/1999/xlink"},{id:"flag-icons-mm"},{width:n[0]},{height:n[0]},n[3],{role:n[1]},{"aria-label":n[2]},{viewBox:"0 0 640 480"}],X={};for(let W=0;W<V.length;W+=1)X=zn(X,V[W]);return{c(){i=Xt("svg"),o=Xt("path"),c=Xt("path"),h=Xt("path"),p=Xt("g"),g=Xt("path"),x=Xt("use"),s=Xt("use"),M=Xt("use"),C=Xt("use"),this.h()},l(W){i=Kt(W,"svg",{xmlns:!0,"xmlns:xlink":!0,id:!0,width:!0,height:!0,role:!0,"aria-label":!0,viewBox:!0});var J=ot(i);o=Kt(J,"path",{fill:!0,d:!0}),ot(o).forEach(De),c=Kt(J,"path",{fill:!0,d:!0}),ot(c).forEach(De),h=Kt(J,"path",{fill:!0,d:!0}),ot(h).forEach(De),p=Kt(J,"g",{transform:!0});var $=ot(p);g=Kt($,"path",{id:!0,fill:!0,d:!0}),ot(g).forEach(De),x=Kt($,"use",{"xlink:href":!0,width:!0,height:!0,transform:!0}),ot(x).forEach(De),s=Kt($,"use",{"xlink:href":!0,width:!0,height:!0,transform:!0}),ot(s).forEach(De),M=Kt($,"use",{"xlink:href":!0,width:!0,height:!0,transform:!0}),ot(M).forEach(De),C=Kt($,"use",{"xlink:href":!0,width:!0,height:!0,transform:!0}),ot(C).forEach(De),$.forEach(De),J.forEach(De),this.h()},h(){xe(o,"fill","#fecb00"),xe(o,"d","M0 0h640v480H0z"),xe(c,"fill","#34b233"),xe(c,"d","M0 160h640v320H0z"),xe(h,"fill","#ea2839"),xe(h,"d","M0 320h640v160H0z"),xe(g,"id","mm-a"),xe(g,"fill","#fff"),xe(g,"d","m0-1 .3 1h-.6z"),Ep(x,"xlink:href","#mm-a"),xe(x,"width","100%"),xe(x,"height","100%"),xe(x,"transform","rotate(-144)"),Ep(s,"xlink:href","#mm-a"),xe(s,"width","100%"),xe(s,"height","100%"),xe(s,"transform","rotate(-72)"),Ep(M,"xlink:href","#mm-a"),xe(M,"width","100%"),xe(M,"height","100%"),xe(M,"transform","rotate(72)"),Ep(C,"xlink:href","#mm-a"),xe(C,"width","100%"),xe(C,"height","100%"),xe(C,"transform","rotate(144)"),xe(p,"transform","translate(320 256.9) scale(176.87999)"),is(i,X)},m(W,J){Ai(W,i,J),it(i,o),it(i,c),it(i,h),it(i,p),it(p,g),it(p,x),it(p,s),it(p,M),it(p,C),D||(F=[Pt(i,"click",n[4]),Pt(i,"keydown",n[5]),Pt(i,"keyup",n[6]),Pt(i,"focus",n[7]),Pt(i,"blur",n[8]),Pt(i,"mouseenter",n[9]),Pt(i,"mouseleave",n[10]),Pt(i,"mouseover",n[11]),Pt(i,"mouseout",n[12])],D=!0)},p(W,[J]){is(i,X=ba(V,[{xmlns:"http://www.w3.org/2000/svg"},{"xmlns:xlink":"http://www.w3.org/1999/xlink"},{id:"flag-icons-mm"},J&1&&{width:W[0]},J&1&&{height:W[0]},J&8&&W[3],J&2&&{role:W[1]},J&4&&{"aria-label":W[2]},{viewBox:"0 0 640 480"}]))},i:Rn,o:Rn,d(W){W&&De(i),D=!1,Br(F)}}}function WW(n,i,o){const c=["size","role","ariaLabel"];let h=qr(i,c);const p=Ec("iconCtx")??{};let{size:g=p.size||"24"}=i,{role:x=p.role||"img"}=i,{ariaLabel:s="flag of mm"}=i;function M(ne){bi.call(this,n,ne)}function C(ne){bi.call(this,n,ne)}function D(ne){bi.call(this,n,ne)}function F(ne){bi.call(this,n,ne)}function V(ne){bi.call(this,n,ne)}function X(ne){bi.call(this,n,ne)}function W(ne){bi.call(this,n,ne)}function J(ne){bi.call(this,n,ne)}function $(ne){bi.call(this,n,ne)}return n.$$set=ne=>{i=zn(zn({},i),zo(ne)),o(3,h=qr(i,c)),"size"in ne&&o(0,g=ne.size),"role"in ne&&o(1,x=ne.role),"ariaLabel"in ne&&o(2,s=ne.ariaLabel)},[g,x,s,h,M,C,D,F,V,X,W,J,$]}class Mq extends No{constructor(i){super(),Bo(this,i,WW,HW,Ao,{size:0,role:1,ariaLabel:2})}}function qW(n){let i,o,c,h,p,g,x,s=[{xmlns:"http://www.w3.org/2000/svg"},{id:"flag-icons-th"},{width:n[0]},{height:n[0]},n[3],{role:n[1]},{"aria-label":n[2]},{viewBox:"0 0 640 480"}],M={};for(let C=0;C<s.length;C+=1)M=zn(M,s[C]);return{c(){i=Xt("svg"),o=Xt("g"),c=Xt("path"),h=Xt("path"),p=Xt("path"),this.h()},l(C){i=Kt(C,"svg",{xmlns:!0,id:!0,width:!0,height:!0,role:!0,"aria-label":!0,viewBox:!0});var D=ot(i);o=Kt(D,"g",{"fill-rule":!0});var F=ot(o);c=Kt(F,"path",{fill:!0,d:!0}),ot(c).forEach(De),h=Kt(F,"path",{fill:!0,d:!0}),ot(h).forEach(De),p=Kt(F,"path",{fill:!0,d:!0}),ot(p).forEach(De),F.forEach(De),D.forEach(De),this.h()},h(){xe(c,"fill","#f4f5f8"),xe(c,"d","M0 0h640v480H0z"),xe(h,"fill","#2d2a4a"),xe(h,"d","M0 162.5h640v160H0z"),xe(p,"fill","#a51931"),xe(p,"d","M0 0h640v82.5H0zm0 400h640v80H0z"),xe(o,"fill-rule","evenodd"),is(i,M)},m(C,D){Ai(C,i,D),it(i,o),it(o,c),it(o,h),it(o,p),g||(x=[Pt(i,"click",n[4]),Pt(i,"keydown",n[5]),Pt(i,"keyup",n[6]),Pt(i,"focus",n[7]),Pt(i,"blur",n[8]),Pt(i,"mouseenter",n[9]),Pt(i,"mouseleave",n[10]),Pt(i,"mouseover",n[11]),Pt(i,"mouseout",n[12])],g=!0)},p(C,[D]){is(i,M=ba(s,[{xmlns:"http://www.w3.org/2000/svg"},{id:"flag-icons-th"},D&1&&{width:C[0]},D&1&&{height:C[0]},D&8&&C[3],D&2&&{role:C[1]},D&4&&{"aria-label":C[2]},{viewBox:"0 0 640 480"}]))},i:Rn,o:Rn,d(C){C&&De(i),g=!1,Br(x)}}}function ZW(n,i,o){const c=["size","role","ariaLabel"];let h=qr(i,c);const p=Ec("iconCtx")??{};let{size:g=p.size||"24"}=i,{role:x=p.role||"img"}=i,{ariaLabel:s="flag of th"}=i;function M(ne){bi.call(this,n,ne)}function C(ne){bi.call(this,n,ne)}function D(ne){bi.call(this,n,ne)}function F(ne){bi.call(this,n,ne)}function V(ne){bi.call(this,n,ne)}function X(ne){bi.call(this,n,ne)}function W(ne){bi.call(this,n,ne)}function J(ne){bi.call(this,n,ne)}function $(ne){bi.call(this,n,ne)}return n.$$set=ne=>{i=zn(zn({},i),zo(ne)),o(3,h=qr(i,c)),"size"in ne&&o(0,g=ne.size),"role"in ne&&o(1,x=ne.role),"ariaLabel"in ne&&o(2,s=ne.ariaLabel)},[g,x,s,h,M,C,D,F,V,X,W,J,$]}class Eq extends No{constructor(i){super(),Bo(this,i,ZW,qW,Ao,{size:0,role:1,ariaLabel:2})}}function XW(n){let i,o,c,h,p,g,x,s,M,C=[{xmlns:"http://www.w3.org/2000/svg"},{id:"flag-icons-vn"},{width:n[0]},{height:n[0]},n[3],{role:n[1]},{"aria-label":n[2]},{viewBox:"0 0 640 480"}],D={};for(let F=0;F<C.length;F+=1)D=zn(D,C[F]);return{c(){i=Xt("svg"),o=Xt("defs"),c=Xt("clipPath"),h=Xt("path"),p=Xt("g"),g=Xt("path"),x=Xt("path"),this.h()},l(F){i=Kt(F,"svg",{xmlns:!0,id:!0,width:!0,height:!0,role:!0,"aria-label":!0,viewBox:!0});var V=ot(i);o=Kt(V,"defs",{});var X=ot(o);c=Kt(X,"clipPath",{id:!0});var W=ot(c);h=Kt(W,"path",{"fill-opacity":!0,d:!0}),ot(h).forEach(De),W.forEach(De),X.forEach(De),p=Kt(V,"g",{"fill-rule":!0,"clip-path":!0,transform:!0});var J=ot(p);g=Kt(J,"path",{fill:!0,d:!0}),ot(g).forEach(De),x=Kt(J,"path",{fill:!0,d:!0}),ot(x).forEach(De),J.forEach(De),V.forEach(De),this.h()},h(){xe(h,"fill-opacity",".7"),xe(h,"d","M-85.3 0h682.6v512H-85.3z"),xe(c,"id","vn-a"),xe(g,"fill","#da251d"),xe(g,"d","M-128 0h768v512h-768z"),xe(x,"fill","#ff0"),xe(x,"d","M349.6 381 260 314.3l-89 67.3L204 272l-89-67.7 110.1-1 34.2-109.4L294 203l110.1.1-88.5 68.4 33.9 109.6z"),xe(p,"fill-rule","evenodd"),xe(p,"clip-path","url(#vn-a)"),xe(p,"transform","translate(80) scale(.9375)"),is(i,D)},m(F,V){Ai(F,i,V),it(i,o),it(o,c),it(c,h),it(i,p),it(p,g),it(p,x),s||(M=[Pt(i,"click",n[4]),Pt(i,"keydown",n[5]),Pt(i,"keyup",n[6]),Pt(i,"focus",n[7]),Pt(i,"blur",n[8]),Pt(i,"mouseenter",n[9]),Pt(i,"mouseleave",n[10]),Pt(i,"mouseover",n[11]),Pt(i,"mouseout",n[12])],s=!0)},p(F,[V]){is(i,D=ba(C,[{xmlns:"http://www.w3.org/2000/svg"},{id:"flag-icons-vn"},V&1&&{width:F[0]},V&1&&{height:F[0]},V&8&&F[3],V&2&&{role:F[1]},V&4&&{"aria-label":F[2]},{viewBox:"0 0 640 480"}]))},i:Rn,o:Rn,d(F){F&&De(i),s=!1,Br(M)}}}function YW(n,i,o){const c=["size","role","ariaLabel"];let h=qr(i,c);const p=Ec("iconCtx")??{};let{size:g=p.size||"24"}=i,{role:x=p.role||"img"}=i,{ariaLabel:s="flag of vn"}=i;function M(ne){bi.call(this,n,ne)}function C(ne){bi.call(this,n,ne)}function D(ne){bi.call(this,n,ne)}function F(ne){bi.call(this,n,ne)}function V(ne){bi.call(this,n,ne)}function X(ne){bi.call(this,n,ne)}function W(ne){bi.call(this,n,ne)}function J(ne){bi.call(this,n,ne)}function $(ne){bi.call(this,n,ne)}return n.$$set=ne=>{i=zn(zn({},i),zo(ne)),o(3,h=qr(i,c)),"size"in ne&&o(0,g=ne.size),"role"in ne&&o(1,x=ne.role),"ariaLabel"in ne&&o(2,s=ne.ariaLabel)},[g,x,s,h,M,C,D,F,V,X,W,J,$]}class Aq extends No{constructor(i){super(),Bo(this,i,YW,XW,Ao,{size:0,role:1,ariaLabel:2})}}export{Br as $,pm as A,mz as B,cm as C,yE as D,cq as E,it as F,Pt as G,hm as H,fm as I,um as J,mm as K,Rn as L,Wx as M,sq as N,hq as O,QW as P,mq as Q,bP as R,No as S,pq as T,gq as U,_q as V,vP as W,_o as X,$W as Y,eq as Z,lq as _,zr as a,oq as a0,bi as a1,TW as a2,xq as a3,vq as a4,So as a5,jf as a6,n_ as a7,gc as a8,Uf as a9,tq as aa,KW as ab,wq as ac,bq as ad,Eq as ae,Sq as af,Aq as ag,Tq as ah,Mq as ai,dq as aj,yq as ak,au as al,fq as am,aq as an,Ai as b,Fr as c,zy as d,ar as e,no as f,De as g,rq as h,Bo as i,Di as j,Vi as k,ot as l,xe as m,xE as n,nq as o,fr as p,vr as q,go as r,Ao as s,Fo as t,Ry as u,Za as v,iq as w,Fy as x,By as y,dm as z};
