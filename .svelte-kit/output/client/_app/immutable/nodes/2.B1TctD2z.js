var DR=Object.defineProperty;var LR=(r,i,o)=>i in r?DR(r,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[i]=o;var bi=(r,i,o)=>(LR(r,typeof i!="symbol"?i+"":i,o),o);import{s as go,e as $e,a as Si,c as Qe,m as xn,g as Mi,b as Et,f as ze,o as be,i as yi,n as _r,k as Fi,U as OR,x as mb,V as an,z as Zr,W as Ui,h as De,p as Ei,E as rs,v as hr,X as py,Y as my,t as Vn,d as Un,j as jr,Z as _a,_ as OM,$ as gb,a0 as RR,a1 as N_,l as Dh,a2 as Ld,a3 as Od,a4 as ya,a5 as qa,u as Lh,q as Oh,r as Rh,a6 as ea,a7 as gy,a8 as yx,I as zR,y as El,G as tf,a9 as FR,aa as BR,ab as NR,ac as _y,ad as Nd,ae as VR,af as Cl,ag as Vd,ah as Ud,ai as UR,aj as qg}from"../chunks/scheduler.z29CB46i.js";import{S as _o,i as yo,n as RM,l as jR,t as $i,g as yc,a as ln,c as vc,b as oo,d as so,m as ao,e as lo,f as Wa,h as V_}from"../chunks/index.3qLXtoSo.js";import{w as yr}from"../chunks/index.Bz_6iSah.js";function Nr(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function yy(r,i){const o={},c={},h={$$scope:1};let m=r.length;for(;m--;){const _=r[m],x=i[m];if(x){for(const s in _)s in x||(c[s]=1);for(const s in x)h[s]||(o[s]=x[s],h[s]=1);r[m]=x}else for(const s in _)h[s]=1}for(const _ in c)_ in o||(o[_]=void 0);return o}function GR(r){return typeof r=="object"&&r!==null?r:{}}const HR=!1,qR=!0,WR=!0,_H=Object.freeze(Object.defineProperty({__proto__:null,csr:qR,prerender:WR,ssr:HR},Symbol.toStringTag,{value:"Module"})),vx="http://localhost:8080/api/",Ed="http://216.218.240.247:8080/thredds/wms/",ZR="https://wind-data-servir.adpc.net/latest";var xh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wC(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function XR(r){if(r.__esModule)return r;var i=r.default;if(typeof i=="function"){var o=function c(){return this instanceof c?Reflect.construct(i,arguments,this.constructor):i.apply(this,arguments)};o.prototype=i.prototype}else o={};return Object.defineProperty(o,"__esModule",{value:!0}),Object.keys(r).forEach(function(c){var h=Object.getOwnPropertyDescriptor(r,c);Object.defineProperty(o,c,h.get?h:{enumerable:!0,get:function(){return r[c]}})}),o}var TC={exports:{}};(function(r,i){var o={};(function(c,h){r.exports=h()})(xh,function(){var c,h,m;function _(s,M){if(!c)c=M;else if(!h)h=M;else{var P="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+c+")(sharedChunk); ("+h+")(sharedChunk); self.onerror = null;",L={};c(L),m=M(L),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(m.workerUrl=window.URL.createObjectURL(new Blob([P],{type:"text/javascript"})))}}_(["exports"],function(s){var M="3.2.0";let P;const L={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(P==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{P=o.API_URL_REGEX!=null?new RegExp(o.API_URL_REGEX):t}catch{P=t}}return P},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!L.API_URL)return null;try{const t=new URL(L.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},F={supported:!1,testSupport:function(t){!q&&X&&(Y?ue(t):V=t)}};let V,X,q=!1,Y=!1;const J=typeof self<"u"?self:{};function ue(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,X),t.isContextLost())return;F.supported=!0}catch{}t.deleteTexture(e),q=!0}J.document&&(X=J.document.createElement("img"),X.onload=function(){V&&ue(V),V=null,Y=!0},X.onerror=function(){q=!0,V=null},X.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ce="01";function fe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ae=Ce;function Ce(t,e,n,a){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=a}Ce.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,a=0;a<8;a++){var u=this.sampleCurveX(n)-t;if(Math.abs(u)<e)return n;var f=this.sampleCurveDerivativeX(n);if(Math.abs(f)<1e-6)break;n-=u/f}var p=0,y=1;for(n=t,a=0;a<20&&(u=this.sampleCurveX(n),!(Math.abs(u-t)<e));a++)t>u?p=n:y=n,n=.5*(y-p)+p;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var He=fe(Ae),We=nt;function nt(t,e){this.x=t,this.y=e}nt.prototype={clone:function(){return new nt(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),a=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=a,this},_rotateAround:function(t,e){var n=Math.cos(t),a=Math.sin(t),u=e.y+a*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-a*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},nt.convert=function(t){return t instanceof nt?t:Array.isArray(t)?new nt(t[0],t[1]):t};var we=fe(We);const ht=Math.PI/180,pt=180/Math.PI;function Xe(t){return t*ht}function mt(t){return t*pt}const Ft=[[0,0],[1,0],[1,1],[0,1]];function tt(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function ei(t,e,n,a){const u=new He(t,e,n,a);return function(f){return u.solve(f)}}const ki=ei(.25,.1,.25,1);function rt(t,e,n){return Math.min(n,Math.max(e,t))}function yt(t,e,n){return(n=rt((n-t)/(e-t),0,1))*n*(3-2*n)}function Xt(t,e,n){const a=n-e,u=((t-e)%a+a)%a+e;return u===e?n:u}function kt(t,e,n){if(!t.length)return n(null,[]);let a=t.length;const u=new Array(t.length);let f=null;t.forEach((p,y)=>{e(p,(b,T)=>{b&&(f=b),u[y]=T,--a==0&&n(f,u)})})}function Ue(t){const e=[];for(const n in t)e.push(t[n]);return e}function Ye(t,...e){for(const n of e)for(const a in n)t[a]=n[a];return t}let Kt=1;function vi(){return Kt++}function en(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Li(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Zi(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function it(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Sn(t,e){return t.indexOf(e,t.length-e.length)!==-1}function dr(t,e,n){const a={};for(const u in t)a[u]=e.call(n||this,t[u],u,t);return a}function Hr(t,e,n){const a={};for(const u in t)e.call(n||this,t[u],u,t)&&(a[u]=t[u]);return a}function xi(t){return Array.isArray(t)?t.map(xi):typeof t=="object"&&t?dr(t,xi):t}const wt={};function ni(t){wt[t]||(typeof console<"u"&&console.warn(t),wt[t]=!0)}function Ve(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function ne(t){let e=0;for(let n,a,u=0,f=t.length,p=f-1;u<f;p=u++)n=t[u],a=t[p],e+=(a.x-n.x)*(n.y+a.y);return e}function pe([t,e,n]){const a=Xe(e+90),u=Xe(n);return{x:t*Math.cos(a)*Math.sin(u),y:t*Math.sin(a)*Math.sin(u),z:t*Math.cos(u),azimuthal:e,polar:n}}function Ie(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function xt(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,a,u,f)=>{const p=u||f;return e[a]=!p||p.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let vt=null;function Wt(t){try{const e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Jt(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function Tt(t,e,n,a){for(;e<n;){const u=e+n>>1;t[u]<a?e=u+1:n=u}return e}function li(t,e,n,a){for(;e<n;){const u=e+n>>1;t[u]<=a?e=u+1:n=u}return e}const wi="mapbox-tiles";let $t=500,cn=50,dn,Fn;function gn(){try{return caches}catch{}}function wn(){const t=gn();t&&!dn&&(dn=t.open(wi))}function Je(t){const e=t.indexOf("?");if(e<0)return t;const n=function(u){const f=u.indexOf("?");return f>0?u.slice(f+1).split("&"):[]}(t),a=n.filter(u=>{const f=u.split("=");return f[0]==="language"||f[0]==="worldview"});return a.length?`${t.slice(0,e)}?${a.join("&")}`:t.slice(0,e)}let mi=1/0;const Gi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Gi);class fn extends Error{constructor(e,n,a){n===401&&zt(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const $n=Ie()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Jr=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test($n())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,u){const f=new AbortController,p=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:$n(),referrerPolicy:a.referrerPolicy,signal:f.signal});let y=!1,b=!1;const T=(E=p.url).indexOf("sku=")>0&&zt(E);var E;a.type==="json"&&p.headers.set("Accept","application/json");const I=(O,z,N)=>{if(b)return;if(O&&O.message!=="SecurityError"&&ni(O.toString()),z&&N)return k(z);const j=Date.now();fetch(p).then(W=>{if(W.ok){const ie=T?W.clone():null;return k(W,ie,j)}return u(new fn(W.statusText,W.status,a.url))}).catch(W=>{W.name!=="AbortError"&&u(new Error(`${W.message} ${a.url}`))})},k=(O,z,N)=>{(a.type==="arrayBuffer"?O.arrayBuffer():a.type==="json"?O.json():O.text()).then(j=>{b||(z&&N&&function(W,ie,re){if(wn(),!dn)return;const se={status:ie.status,statusText:ie.statusText,headers:new Headers};ie.headers.forEach((Se,ke)=>se.headers.set(ke,Se));const de=xt(ie.headers.get("Cache-Control")||"");if(de["no-store"])return;de["max-age"]&&se.headers.set("Expires",new Date(re+1e3*de["max-age"]).toUTCString());const ge=se.headers.get("Expires");ge&&(new Date(ge).getTime()-re<42e4||function(Se,ke){if(Fn===void 0)try{new Response(new ReadableStream),Fn=!0}catch{Fn=!1}Fn?ke(Se.body):Se.blob().then(ke)}(ie,Se=>{const ke=new Response(Se,se);wn(),dn&&dn.then(Re=>Re.put(Je(W.url),ke)).catch(Re=>ni(Re.message))}))}(p,z,N),y=!0,u(null,j,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(j=>{b||u(new Error(j.message))})};return T?function(O,z){if(wn(),!dn)return z(null);const N=Je(O.url);dn.then(j=>{j.match(N).then(W=>{const ie=function(re){if(!re)return!1;const se=new Date(re.headers.get("Expires")||0),de=xt(re.headers.get("Cache-Control")||"");return se>Date.now()&&!de["no-cache"]}(W);j.delete(N),ie&&j.put(N,W.clone()),z(null,W,ie)}).catch(z)}).catch(z)}(p,I):I(null,null),{cancel:()=>{b=!0,y||f.abort()}}}(t,e);if(Ie()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(a,u){const f=new XMLHttpRequest;f.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const p in a.headers)f.setRequestHeader(p,a.headers[p]);return a.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=a.credentials==="include",f.onerror=()=>{u(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let p=f.response;if(a.type==="json")try{p=JSON.parse(f.response)}catch(y){return u(y)}u(null,p,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else u(new fn(f.statusText,f.status,a.url))},f.send(a.body),{cancel:()=>f.abort()}}(t,e)},Cr=function(t,e){return Jr(Ye(t,{type:"arrayBuffer"}),e)};function Mo(t){const e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}const qr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Pr,lt;Pr=[],lt=0;const ft=function(t,e){if(F.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),lt>=L.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Pr.push(f),f}lt++;let n=!1;const a=()=>{if(!n)for(n=!0,lt--;Pr.length&&lt<L.MAX_PARALLEL_IMAGE_REQUESTS;){const f=Pr.shift(),{requestParameters:p,callback:y,cancelled:b}=f;b||(f.cancel=ft(p,y).cancel)}},u=Cr(t,(f,p,y,b)=>{a(),f?e(f):p&&(self.createImageBitmap?function(T,E){const I=new Blob([new Uint8Array(T)],{type:"image/png"});createImageBitmap(I).then(k=>{E(null,k)}).catch(k=>{E(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(T,E)=>e(T,E,y,b)):function(T,E){const I=new Image;I.onload=()=>{E(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=qr})},I.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const k=new Blob([new Uint8Array(T)],{type:"image/png"});I.src=T.byteLength?URL.createObjectURL(k):qr}(p,(T,E)=>e(T,E,y,b)))});return{cancel:()=>{u.cancel(),a()}}},Ct="NO_ACCESS_TOKEN";function Dt(t){return t.indexOf("mapbox:")===0}function zt(t){return L.API_URL_REGEX.test(t)}function jt(t){return L.API_CDN_URL_REGEX.test(t)}function Zt(t){return L.API_STYLE_REGEX.test(t)&&!Bt(t)}function Bt(t){return L.API_SPRITE_REGEX.test(t)}const ai=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function At(t){const e=t.match(ai);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function zi(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const mn="mapbox.eventData";function gi(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class un{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=gi(L.ACCESS_TOKEN);let a="";return a=n&&n.u?btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(u,f)=>String.fromCharCode(+("0x"+f)))):L.ACCESS_TOKEN||"",e?`${mn}.${e}:${a}`:`${mn}:${a}`}fetchEventData(){const e=Wt("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{const u=localStorage.getItem(n);u&&(this.eventData=JSON.parse(u));const f=localStorage.getItem(a);f&&(this.anonId=f)}catch{ni("Unable to read from LocalStorage")}}saveEventData(){const e=Wt("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid"),u=this.anonId;if(e&&u)try{localStorage.setItem(a,u),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{ni("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,a,u){if(!L.EVENTS_URL)return;const f=At(L.EVENTS_URL);f.params.push(`access_token=${u||L.ACCESS_TOKEN||""}`);const p={event:this.type,created:new Date(e).toISOString()},y=n?Ye(p,n):p,b={url:zi(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=function(T,E){return Jr(Ye(T,{method:"POST"}),E)}(b,T=>{this.pendingRequest=null,a(T),this.saveEventData(),this.processRequests(u)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const Qn=new class extends un{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){L.EVENTS_URL&&L.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>Dt(n)||zt(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=gi(L.ACCESS_TOKEN),n=e?e.u:L.ACCESS_TOKEN;let a=n!==this.eventData.tokenU;Zi(this.anonId)||(this.anonId=en(),a=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),p=new Date(u),y=(u-this.eventData.lastSuccess)/864e5;a=a||y>=1||y<-1||f.getDate()!==p.getDate()}else a=!0;a?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:M,skuId:ce,"enabled.telemetry":!1,userId:this.anonId},f=>{f||(this.eventData.lastSuccess=u,this.eventData.tokenU=n)},t):this.processRequests()}},Kn=Qn.postTurnstileEvent.bind(Qn),or=new class extends un{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,a){this.skuToken=e,this.errorCb=a,L.EVENTS_URL&&(n||L.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Ct)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Zi(this.anonId)||(this.anonId=en()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:M,skuId:ce,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t))}},Kr=or.postMapLoadEvent.bind(or),Lo=new class extends un{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){L.EVENTS_URL&&(t||L.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:n}=this.queue.shift(),a=function(u){const f=performance.getEntriesByType("resource"),p=performance.getEntriesByType("mark"),y=function(O){const z={};if(O){for(const N in O)if(N!=="other")for(const j of O[N]){const W=`${N}ResolveRangeMin`,ie=`${N}ResolveRangeMax`,re=`${N}RequestCount`,se=`${N}RequestCachedCount`;z[W]=Math.min(z[W]||1/0,j.startTime),z[ie]=Math.max(z[ie]||-1/0,j.responseEnd);const de=ge=>{z[ge]===void 0&&(z[ge]=0),++z[ge]};j.transferSize!==void 0&&j.transferSize===0&&de(se),de(re)}}return z}(function(O,z){const N={};if(O)for(const j of O){const W=z(j);N[W]===void 0&&(N[W]=[]),N[W].push(j)}return N}(f,Ka)),b=window.devicePixelRatio,T=navigator.connection||navigator.mozConnection||navigator.webkitConnection,E=T?T.effectiveType:void 0,I={counters:[],metadata:[],attributes:[]},k=(O,z,N)=>{N!=null&&O.push({name:z,value:N.toString()})};for(const O in y)k(I.counters,O,y[O]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(k(I.counters,"interactionRangeMin",u.interactionRange[0]),k(I.counters,"interactionRangeMax",u.interactionRange[1])),p)for(const O of Object.keys(ys)){const z=ys[O],N=p.find(j=>j.name===z);N&&k(I.counters,z,N.startTime)}return k(I.counters,"visibilityHidden",u.visibilityHidden),k(I.attributes,"style",function(O){if(O)for(const z of O){const N=z.name.split("?")[0];if(Zt(N)){const j=N.split("/").slice(-2);if(j.length===2)return`mapbox://styles/${j[0]}/${j[1]}`}}}(f)),k(I.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),k(I.attributes,"fogEnabled",u.fogEnabled?"true":"false"),k(I.attributes,"projection",u.projection),k(I.attributes,"zoom",u.zoom),k(I.metadata,"devicePixelRatio",b),k(I.metadata,"connectionEffectiveType",E),k(I.metadata,"navigatorUserAgent",navigator.userAgent),k(I.metadata,"screenWidth",window.screen.width),k(I.metadata,"screenHeight",window.screen.height),k(I.metadata,"windowWidth",window.innerWidth),k(I.metadata,"windowHeight",window.innerHeight),k(I.metadata,"mapWidth",u.width/b),k(I.metadata,"mapHeight",u.height/b),k(I.metadata,"webglRenderer",u.renderer),k(I.metadata,"webglVendor",u.vendor),k(I.metadata,"sdkVersion",M),k(I.metadata,"sdkIdentifier","mapbox-gl-js"),I}(n);for(const u of a.metadata);for(const u of a.counters);for(const u of a.attributes);this.postEvent(e,a,()=>{},t)}},sr=Lo.postPerformanceEvent.bind(Lo),Oo=new class extends un{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,a){if(!L.API_URL||!L.SESSION_PATH)return;const u=At(L.API_URL+L.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${a||L.ACCESS_TOKEN||""}`);const f={url:zi(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(p,y){return Jr(Ye(p,{method:"GET"}),y)}(f,p=>{this.pendingRequest=null,n(p),this.saveEventData(),this.processRequests(a)})}getSessionAPI(t,e,n,a){this.skuToken=e,this.errorCb=a,L.SESSION_PATH&&L.API_URL&&(n||L.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Ct)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t)}},$r=Oo.getSessionAPI.bind(Oo),Eo=new Set,ys={create:"create",load:"load",fullLoad:"fullLoad"};function Ka(t){const e=t.name.split("?")[0];return jt(e)&&e.includes("mapbox-gl.js")?"javascript":jt(e)&&e.includes("mapbox-gl.css")?"css":function(n){return L.API_FONTS_REGEX.test(n)}(e)?"fontRange":Bt(e)?"sprite":Zt(e)?"style":function(n){return L.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}function Dl(t){const e=t?t.url.toString():void 0;return e?performance.getEntriesByName(e):[]}let Ec,xa,Ll,ba,fr;function _u(){return Ec==null&&(Ec=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ec}const uo={now:()=>ba!==void 0?ba:performance.now(),setNow(t){ba=t},restoreNow(){ba=void 0},frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:n,height:a}=t;fr||(fr=document.createElement("canvas"));const u=fr.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(n>fr.width||a>fr.height)&&(fr.width=n,fr.height=a),u.clearRect(-e,-e,n+2*e,a+2*e),u.drawImage(t,0,0,n,a),u.getImageData(-e,-e,n+2*e,a+2*e)},resolveURL:t=>(xa||(xa=document.createElement("a")),xa.href=t,xa.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ll==null&&(Ll=window.matchMedia("(prefers-reduced-motion: reduce)")),Ll.matches)},hasCanvasFingerprintNoise(){if(!_u())return!1;const t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let n=0;for(let u=0;u<t.width;++u)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(u,0,1,1);const a=e.getImageData(0,0,t.width,t.height);n=0;for(let u=0;u<a.data.length;++u)if(u%4!=3&&n++!==a.data[u])return!0;return!1}};function os(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function ho(t,e,n){if(n&&n[t]){const a=n[t].indexOf(e);a!==-1&&n[t].splice(a,1)}}class Ao{constructor(e,n={}){Ye(this,n),this.type=e}}class Ro extends Ao{constructor(e,n={}){super("error",Ye({error:e},n))}}class fo{on(e,n){return this._listeners=this._listeners||{},os(e,n,this._listeners),this}off(e,n){return ho(e,n,this._listeners),ho(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},os(e,n,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,n){typeof e=="string"&&(e=new Ao(e,n||{}));const a=e.type;if(this.listens(a)){e.target=this;const u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const y of u)y.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const y of f)ho(a,y,this._oneTimeListeners),y.call(this,e);const p=this._eventedParent;p&&(Ye(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof Ro&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var Ne=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class ci{constructor(e,n,a,u){this.message=(e?`${e}: `:"")+a,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}class vs extends ci{}function ss(t,...e){for(const n of e)for(const a in n)t[a]=n[a];return t}function vr(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function as(t){if(Array.isArray(t))return t.map(as);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=as(t[n]);return e}return vr(t)}class Uh extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var Uo=Uh;class yu{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[a,u]of n)this.bindings[a]=u}concat(e){return new yu(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var af=yu;const wa={kind:"null"},gt={kind:"number"},D={kind:"string"},G={kind:"boolean"},ae={kind:"color"},Te={kind:"object"},Me={kind:"value"},Oe={kind:"collator"},Ge={kind:"formatted"},Gt={kind:"resolvedImage"};function Ht(t,e){return{kind:"array",itemType:t,N:e}}function Nt(t){if(t.kind==="array"){const e=Nt(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const _i=[wa,gt,D,G,ae,Ge,Te,Ht(Me),Gt];function ti(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ti(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const n of _i)if(!ti(n,e))return null}}return`Expected ${Nt(t)} but found ${Nt(e)} instead.`}function Ji(t,e){return e.some(n=>n.kind===t.kind)}function Xn(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}var tn,pr={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ot(t){return(t=Math.round(t))<0?0:t>255?255:t}function Di(t){return Ot(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Ln(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Fr(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{tn={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in pr)return pr[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=n.indexOf("("),u=n.indexOf(")");if(a!==-1&&u+1===n.length){var f=n.substr(0,a),p=n.substr(a+1,u-(a+1)).split(","),y=1;switch(f){case"rgba":if(p.length!==4)return null;y=Ln(p.pop());case"rgb":return p.length!==3?null:[Di(p[0]),Di(p[1]),Di(p[2]),y];case"hsla":if(p.length!==4)return null;y=Ln(p.pop());case"hsl":if(p.length!==3)return null;var b=(parseFloat(p[0])%360+360)%360/360,T=Ln(p[1]),E=Ln(p[2]),I=E<=.5?E*(T+1):E+T-E*T,k=2*E-I;return[Ot(255*Fr(k,I,b+1/3)),Ot(255*Fr(k,I,b)),Ot(255*Fr(k,I,b-1/3)),y];default:return null}}return null}}catch{}class In{constructor(e,n,a,u=1){this.r=e,this.g=n,this.b=a,this.a=u}static parse(e){if(!e)return;if(e instanceof In)return e;if(typeof e!="string")return;const n=tn(e);return n?new In(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,a,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(a)},${u})`}toArray(){const{r:e,g:n,b:a,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*n/u,255*a/u,u]}toArray01(){const{r:e,g:n,b:a,a:u}=this;return u===0?[0,0,0,0]:[e/u,n/u,a/u,u]}toArray01Scaled(e){const{r:n,g:a,b:u,a:f}=this;return f===0?[0,0,0]:[n/f*e,a/f*e,u/f*e]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:a,a:u}=this;return[e,n,a,u]}toArray01Linear(){const{r:e,g:n,b:a,a:u}=this;return u===0?[0,0,0,0]:[Math.pow(e/u,2.2),Math.pow(n/u,2.2),Math.pow(a/u,2.2),u]}}In.black=new In(0,0,0,1),In.white=new In(1,1,1,1),In.transparent=new In(0,0,0,0),In.red=new In(1,0,0,1),In.blue=new In(0,0,1,1);var Bn=In;class vu{constructor(e,n,a){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Nn{constructor(e,n,a,u,f){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=a,this.fontStack=u,this.textColor=f}}class po{constructor(e){this.sections=e}static fromString(e){return new po([new Nn(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof po?e:po.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);const a={};n.fontStack&&(a["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(a["font-scale"]=n.scale),n.textColor&&(a["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(a)}return e}}class jo{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new jo({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function xs(t,e,n,a){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[t,e,n,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[t,e,n,a]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ta(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Bn||t instanceof vu||t instanceof po||t instanceof jo)return!0;if(Array.isArray(t)){for(const e of t)if(!Ta(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!Ta(t[e]))return!1;return!0}return!1}function Mr(t){if(t===null)return wa;if(typeof t=="string")return D;if(typeof t=="boolean")return G;if(typeof t=="number")return gt;if(t instanceof Bn)return ae;if(t instanceof vu)return Oe;if(t instanceof po)return Ge;if(t instanceof jo)return Gt;if(Array.isArray(t)){const e=t.length;let n;for(const a of t){const u=Mr(a);if(n){if(n===u)continue;n=Me;break}n=u}return Ht(n||Me,e)}return Te}function $a(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Bn||t instanceof po||t instanceof jo?t.toString():JSON.stringify(t)}class Ol{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ta(e[1]))return n.error("invalid value");const a=e[1];let u=Mr(a);const f=n.expectedType;return u.kind!=="array"||u.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(u=f),new Ol(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Bn?["rgba"].concat(this.value.toArray()):this.value instanceof po?this.value.serialize():this.value}}var Sa=Ol,xr=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const xu={string:D,number:gt,boolean:G,object:Te};class bu{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a,u=1;const f=e[0];if(f==="array"){let y,b;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in xu)||T==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);y=xu[T],u++}else y=Me;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);b=e[2],u++}a=Ht(y,b)}else a=xu[f];const p=[];for(;u<e.length;u++){const y=n.parse(e[u],u,Me);if(!y)return null;p.push(y)}return new bu(a,p)}evaluate(e){for(let n=0;n<this.args.length;n++){const a=this.args[n].evaluate(e);if(!ti(this.type,Mr(a)))return a;if(n===this.args.length-1)throw new xr(`Expected value to be of type ${Nt(this.type)}, but found ${Nt(Mr(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){n.push(a.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&n.push(u)}}return n.concat(this.args.map(a=>a.serialize()))}}var ls=bu;class Qa{constructor(e){this.type=Ge,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return n.error("First argument must be an image or text section.");const u=[];let f=!1;for(let p=1;p<=e.length-1;++p){const y=e[p];if(f&&typeof y=="object"&&!Array.isArray(y)){f=!1;let b=null;if(y["font-scale"]&&(b=n.parse(y["font-scale"],1,gt),!b))return null;let T=null;if(y["text-font"]&&(T=n.parse(y["text-font"],1,Ht(D)),!T))return null;let E=null;if(y["text-color"]&&(E=n.parse(y["text-color"],1,ae),!E))return null;const I=u[u.length-1];I.scale=b,I.font=T,I.textColor=E}else{const b=n.parse(e[p],1,Me);if(!b)return null;const T=b.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:b,scale:null,font:null,textColor:null})}}return new Qa(u)}evaluate(e){return new po(this.sections.map(n=>{const a=n.content.evaluate(e);return Mr(a)===Gt?new Nn("",a,null,null,null):new Nn($a(a),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const a={};n.scale&&(a["font-scale"]=n.scale.serialize()),n.font&&(a["text-font"]=n.font.serialize()),n.textColor&&(a["text-color"]=n.textColor.serialize()),e.push(a)}return e}}class el{constructor(e,n){this.type=Gt,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");const a=n.parse(e[1],1,D);if(!a)return n.error("No image name provided.");if(e.length===2)return new el(a);const u=n.parse(e[2],1,D);return u?new el(a,u):n.error("Secondary image variant is not a string.")}evaluate(e){const n=jo.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function pn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}const lf={"to-boolean":G,"to-color":ae,"to-number":gt,"to-string":D};class Ac{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const a=e[0],u=[];let f=wa;if(a==="to-array"){if(!Array.isArray(e[1]))return null;const p=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);f=Ht(n.expectedType.itemType,p)}else{if(!(p>0&&Ta(e[1][0])))return null;f=Ht(Mr(e[1][0]),p)}for(let y=0;y<p;y++){const b=e[1][y];let T;if(pn(b)==="array")T=n.parse(b,void 0,f.itemType);else{const E=pn(b);if(E!==f.itemType.kind)return n.error(`Expected ${f.itemType.kind} but found ${E}.`);T=n.registry.literal.parse(["literal",b===void 0?null:b],n)}if(!T)return null;u.push(T)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return n.error("Expected one argument.");f=lf[a];for(let p=1;p<e.length;p++){const y=n.parse(e[p],p,Me);if(!y)return null;u.push(y)}}return new Ac(f,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,a;for(const u of this.args){if(n=u.evaluate(e),a=null,n instanceof Bn)return n;if(typeof n=="string"){const f=e.parseColor(n);if(f)return f}else if(Array.isArray(n)&&(a=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:xs(n[0],n[1],n[2],n[3]),!a))return new Bn(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new xr(a||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const a of this.args){if(n=a.evaluate(e),n===null)return 0;const u=Number(n);if(!isNaN(u))return u}throw new xr(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?po.fromString($a(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?jo.fromString($a(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):$a(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Qa([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new el(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var cs=Ac;const Ic=["Unknown","Point","LineString","Polygon"];var Cc=class{constructor(t,e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=e}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ic[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(a*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Bn.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class Qr{constructor(e,n,a,u,f){this.name=e,this.type=n,this._evaluate=a,this.args=u,this._overloadIndex=f}evaluate(e){if(!this._evaluate){const n=Qr.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const a=e[0],u=Qr.definitions[a];if(!u)return n.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,p=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=[];let b=null,T=-1;for(const[E,I]of p){if(Array.isArray(E)&&E.length!==e.length-1)continue;y.push(E),T++,b=new Ho(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);const k=[];let O=!1;for(let z=1;z<e.length;z++){const N=e[z],j=Array.isArray(E)?E[z-1]:E.type,W=b.parse(N,1+k.length,j);if(!W){O=!0;break}k.push(W)}if(!O)if(Array.isArray(E)&&E.length!==k.length)b.error(`Expected ${E.length} arguments, but found ${k.length} instead.`);else{for(let z=0;z<k.length;z++){const N=Array.isArray(E)?E[z]:E.type,j=k[z];b.concat(z+1).checkSubtype(N,j.type)}if(b.errors.length===0)return new Qr(a,f,I,k,T)}}if(y.length===1)n.errors.push(...b.errors);else{const E=(y.length?y:p.map(([k])=>k)).map(wu).join(" | "),I=[];for(let k=1;k<e.length;k++){const O=n.parse(e[k],1+I.length);if(!O)return null;I.push(Nt(O.type))}n.error(`Expected arguments of type ${E}, but found (${I.join(", ")}) instead.`)}return null}static register(e,n){Qr.definitions=n;for(const a in n)e[a]=Qr}}function wu(t){return Array.isArray(t)?`(${t.map(Nt).join(", ")})`:`(${Nt(t.type)}...)`}var Go=Qr;class Rl{constructor(e,n,a){this.type=Oe,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return n.error("Collator options argument must be an object.");const u=n.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,G);if(!u)return null;const f=n.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,G);if(!f)return null;let p=null;return a.locale&&(p=n.parse(a.locale,1,D),!p)?null:new Rl(u,f,p)}evaluate(e){return new vu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Pc={exports:{}};Pc.exports=function(){function t(a,u,f,p,y){for(;p>f;){if(p-f>600){var b=p-f+1,T=u-f+1,E=Math.log(b),I=.5*Math.exp(2*E/3),k=.5*Math.sqrt(E*I*(b-I)/b)*(T-b/2<0?-1:1);t(a,u,Math.max(f,Math.floor(u-T*I/b+k)),Math.min(p,Math.floor(u+(b-T)*I/b+k)),y)}var O=a[u],z=f,N=p;for(e(a,f,u),y(a[p],O)>0&&e(a,f,p);z<N;){for(e(a,z,N),z++,N--;y(a[z],O)<0;)z++;for(;y(a[N],O)>0;)N--}y(a[f],O)===0?e(a,f,N):e(a,++N,p),N<=u&&(f=N+1),u<=N&&(p=N-1)}}function e(a,u,f){var p=a[u];a[u]=a[f],a[f]=p}function n(a,u){return a<u?-1:a>u?1:0}return function(a,u,f,p,y){t(a,u,f||0,p||a.length-1,y||n)}}();var zl=fe(Pc.exports);function Fl(t){let e=0;for(let n,a,u=0,f=t.length,p=f-1;u<f;p=u++)n=t[u],a=t[p],e+=(a.x-n.x)*(n.y+a.y);return e}function zs(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function ia(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function na(t,e,n){const a=t[0]-e[0],u=t[1]-e[1],f=t[0]-n[0],p=t[1]-n[1];return a*p-f*u==0&&a*f<=0&&u*p<=0}function ra(t,e,n=!1){let a=!1;for(let y=0,b=e.length;y<b;y++){const T=e[y];for(let E=0,I=T.length,k=I-1;E<I;k=E++){const O=T[k],z=T[E];if(na(t,O,z))return n;(f=O)[1]>(u=t)[1]!=(p=z)[1]>u[1]&&u[0]<(p[0]-f[0])*(u[1]-f[1])/(p[1]-f[1])+f[0]&&(a=!a)}}var u,f,p;return a}function Tu(t,e,n,a){const u=a[0]-n[0],f=a[1]-n[1],p=(t[0]-n[0])*f-u*(t[1]-n[1]),y=(e[0]-n[0])*f-u*(e[1]-n[1]);return p>0&&y<0||p<0&&y>0}function Fs(t,e,n,a){return(u=[a[0]-n[0],a[1]-n[1]])[0]*(f=[e[0]-t[0],e[1]-t[1]])[1]-u[1]*f[0]!=0&&!(!Tu(t,e,n,a)||!Tu(n,a,t,e));var u,f}const Ki=8192;function Bl(t,e){const n=(180+t[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(n*u*Ki),Math.round(a*u*Ki)]}function Su(t,e){for(let n=0;n<e.length;n++)if(ra(t,e[n]))return!0;return!1}function Mu(t,e,n){for(const a of n)for(let u=0,f=a.length,p=f-1;u<f;p=u++)if(Fs(t,e,a[p],a[u]))return!0;return!1}function Nl(t,e){for(let n=0;n<t.length;++n)if(!ra(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Mu(t[n],t[n+1],e))return!1;return!0}function Vl(t,e){for(let n=0;n<e.length;n++)if(Nl(t,e[n]))return!0;return!1}function kc(t,e,n){const a=[];for(let u=0;u<t.length;u++){const f=[];for(let p=0;p<t[u].length;p++){const y=Bl(t[u][p],n);zs(e,y),f.push(y)}a.push(f)}return a}function Eu(t,e,n){const a=[];for(let u=0;u<t.length;u++){const f=kc(t[u],e,n);a.push(f)}return a}function Au(t,e,n,a){if(t[0]<n[0]||t[0]>n[2]){const u=.5*a;let f=t[0]-n[0]>u?-a:n[0]-t[0]>u?a:0;f===0&&(f=t[0]-n[2]>u?-a:n[2]-t[0]>u?a:0),t[0]+=f}zs(e,t)}function Ma(t,e,n,a){const u=Math.pow(2,a.z)*Ki,f=[a.x*Ki,a.y*Ki],p=[];if(!t)return p;for(const y of t)for(const b of y){const T=[b.x+f[0],b.y+f[1]];Au(T,e,n,u),p.push(T)}return p}function Iu(t,e,n,a){const u=Math.pow(2,a.z)*Ki,f=[a.x*Ki,a.y*Ki],p=[];if(!t)return p;for(const b of t){const T=[];for(const E of b){const I=[E.x+f[0],E.y+f[1]];zs(e,I),T.push(I)}p.push(T)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of p)for(const T of b)Au(T,e,n,u)}var y;return p}class us{constructor(e,n){this.type=G,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ta(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let u=0;u<a.features.length;++u){const f=a.features[u].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new us(a,a.features[u].geometry)}else if(a.type==="Feature"){const u=a.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new us(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new us(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,a){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(a.type==="Polygon"){const y=kc(a.coordinates,f,p),b=Ma(n.geometry(),u,f,p);if(!ia(u,f))return!1;for(const T of b)if(!ra(T,y))return!1}if(a.type==="MultiPolygon"){const y=Eu(a.coordinates,f,p),b=Ma(n.geometry(),u,f,p);if(!ia(u,f))return!1;for(const T of b)if(!Su(T,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,a){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(a.type==="Polygon"){const y=kc(a.coordinates,f,p),b=Iu(n.geometry(),u,f,p);if(!ia(u,f))return!1;for(const T of b)if(!Nl(T,y))return!1}if(a.type==="MultiPolygon"){const y=Eu(a.coordinates,f,p),b=Iu(n.geometry(),u,f,p);if(!ia(u,f))return!1;for(const T of b)if(!Vl(T,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var tl=us,Bs={exports:{}};Bs.exports=function(){var t={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,n=e*(2-e),a=Math.PI/180,u=function(T,E){if(T===void 0)throw new Error("No latitude given.");if(E&&!t[E])throw new Error("Unknown unit "+E+". Use one of: "+Object.keys(t).join(", "));var I=6378.137*a*(E?t[E]:1),k=Math.cos(T*a),O=1/(1-n*(1-k*k)),z=Math.sqrt(O);this.kx=I*z*k,this.ky=I*z*O*(1-n)},f={units:{configurable:!0}};function p(T,E){return T[0]===E[0]&&T[1]===E[1]}function y(T,E,I){var k=b(E[0]-T[0]);return[T[0]+k*I,T[1]+(E[1]-T[1])*I]}function b(T){for(;T<-180;)T+=360;for(;T>180;)T-=360;return T}return u.fromTile=function(T,E,I){var k=Math.PI*(1-2*(T+.5)/Math.pow(2,E)),O=Math.atan(.5*(Math.exp(k)-Math.exp(-k)))/a;return new u(O,I)},f.units.get=function(){return t},u.prototype.distance=function(T,E){var I=b(T[0]-E[0])*this.kx,k=(T[1]-E[1])*this.ky;return Math.sqrt(I*I+k*k)},u.prototype.bearing=function(T,E){var I=b(E[0]-T[0])*this.kx;return Math.atan2(I,(E[1]-T[1])*this.ky)/a},u.prototype.destination=function(T,E,I){var k=I*a;return this.offset(T,Math.sin(k)*E,Math.cos(k)*E)},u.prototype.offset=function(T,E,I){return[T[0]+E/this.kx,T[1]+I/this.ky]},u.prototype.lineDistance=function(T){for(var E=0,I=0;I<T.length-1;I++)E+=this.distance(T[I],T[I+1]);return E},u.prototype.area=function(T){for(var E=0,I=0;I<T.length;I++)for(var k=T[I],O=0,z=k.length,N=z-1;O<z;N=O++)E+=b(k[O][0]-k[N][0])*(k[O][1]+k[N][1])*(I?-1:1);return Math.abs(E)/2*this.kx*this.ky},u.prototype.along=function(T,E){var I=0;if(E<=0)return T[0];for(var k=0;k<T.length-1;k++){var O=T[k],z=T[k+1],N=this.distance(O,z);if((I+=N)>E)return y(O,z,(E-(I-N))/N)}return T[T.length-1]},u.prototype.pointToSegmentDistance=function(T,E,I){var k=E[0],O=E[1],z=b(I[0]-k)*this.kx,N=(I[1]-O)*this.ky,j=0;return z===0&&N===0||((j=(b(T[0]-k)*this.kx*z+(T[1]-O)*this.ky*N)/(z*z+N*N))>1?(k=I[0],O=I[1]):j>0&&(k+=z/this.kx*j,O+=N/this.ky*j)),z=b(T[0]-k)*this.kx,N=(T[1]-O)*this.ky,Math.sqrt(z*z+N*N)},u.prototype.pointOnLine=function(T,E){for(var I,k,O,z,N=1/0,j=0;j<T.length-1;j++){var W=T[j][0],ie=T[j][1],re=b(T[j+1][0]-W)*this.kx,se=(T[j+1][1]-ie)*this.ky,de=0;re===0&&se===0||((de=(b(E[0]-W)*this.kx*re+(E[1]-ie)*this.ky*se)/(re*re+se*se))>1?(W=T[j+1][0],ie=T[j+1][1]):de>0&&(W+=re/this.kx*de,ie+=se/this.ky*de));var ge=(re=b(E[0]-W)*this.kx)*re+(se=(E[1]-ie)*this.ky)*se;ge<N&&(N=ge,I=W,k=ie,O=j,z=de)}return{point:[I,k],index:O,t:Math.max(0,Math.min(1,z))}},u.prototype.lineSlice=function(T,E,I){var k=this.pointOnLine(I,T),O=this.pointOnLine(I,E);if(k.index>O.index||k.index===O.index&&k.t>O.t){var z=k;k=O,O=z}var N=[k.point],j=k.index+1,W=O.index;!p(I[j],N[0])&&j<=W&&N.push(I[j]);for(var ie=j+1;ie<=W;ie++)N.push(I[ie]);return p(I[W],O.point)||N.push(O.point),N},u.prototype.lineSliceAlong=function(T,E,I){for(var k=0,O=[],z=0;z<I.length-1;z++){var N=I[z],j=I[z+1],W=this.distance(N,j);if((k+=W)>T&&O.length===0&&O.push(y(N,j,(T-(k-W))/W)),k>=E)return O.push(y(N,j,(E-(k-W))/W)),O;k>T&&O.push(j)}return O},u.prototype.bufferPoint=function(T,E){var I=E/this.ky,k=E/this.kx;return[T[0]-k,T[1]-I,T[0]+k,T[1]+I]},u.prototype.bufferBBox=function(T,E){var I=E/this.ky,k=E/this.kx;return[T[0]-k,T[1]-I,T[2]+k,T[3]+I]},u.prototype.insideBBox=function(T,E){return b(T[0]-E[0])>=0&&b(T[0]-E[2])<=0&&T[1]>=E[1]&&T[1]<=E[3]},Object.defineProperties(u,f),u}();var hs=fe(Bs.exports),bs={exports:{}};bs.exports=function(){var t=function(n,a){if(n===void 0&&(n=[]),a===void 0&&(a=e),this.data=n,this.length=this.data.length,this.compare=a,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function e(n,a){return n<a?-1:n>a?1:0}return t.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(this.length!==0){var n=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),n}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(n){for(var a=this.data,u=this.compare,f=a[n];n>0;){var p=n-1>>1,y=a[p];if(u(f,y)>=0)break;a[n]=y,n=p}a[n]=f},t.prototype._down=function(n){for(var a=this.data,u=this.compare,f=this.length>>1,p=a[n];n<f;){var y=1+(n<<1),b=a[y],T=y+1;if(T<this.length&&u(a[T],b)<0&&(y=T,b=a[T]),u(b,p)>=0)break;a[n]=b,n=y}a[n]=p},t}();var Ea=fe(bs.exports),Lt=8192;function jh(t,e){return e.dist-t.dist}const Aa=100,Ia=50;function Cu(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Ul(t){return t[1]-t[0]+1}function Ns(t,e){const n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function Dc(t,e){if(t[0]>t[1])return[null,null];const n=Ul(t);if(e){if(n===2)return[t,null];const a=Math.floor(n/2);return[[t[0],t[0]+a],[t[0]+a,t[1]]]}{if(n===1)return[t,null];const a=Math.floor(n/2)-1;return[[t[0],t[0]+a],[t[0]+a+1,t[1]]]}}function Vs(t,e){const n=[1/0,1/0,-1/0,-1/0];if(!Ns(e,t.length))return n;for(let a=e[0];a<=e[1];++a)zs(n,t[a]);return n}function jl(t){const e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let a=0;a<t[n].length;++a)zs(e,t[n][a]);return e}function ws(t,e,n){if(Cu(t)||Cu(e))return NaN;let a=0,u=0;return t[2]<e[0]&&(a=e[0]-t[2]),t[0]>e[2]&&(a=t[0]-e[2]),t[1]>e[3]&&(u=t[1]-e[3]),t[3]<e[1]&&(u=e[1]-t[3]),n.distance([0,0],[a,u])}function oa(t,e){const n=Math.pow(2,e.z);return[(u=(t.x/Lt+e.x)/n,360*u-180),(a=(t.y/Lt+e.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,u}function cf(t,e){const n=[];for(let a=0;a<t.length;++a)n.push(oa(t[a],e));return n}function Ts(t,e,n){const a=n.pointOnLine(e,t).point;return n.distance(t,a)}function Pu(t,e,n,a,u){const f=n.slice(a[0],a[1]+1);let p=1/0;for(let y=e[0];y<=e[1];++y)if((p=Math.min(p,Ts(t[y],f,u)))===0)return 0;return p}function Us(t,e,n,a,u){const f=Math.min(u.pointToSegmentDistance(t,n,a),u.pointToSegmentDistance(e,n,a)),p=Math.min(u.pointToSegmentDistance(n,t,e),u.pointToSegmentDistance(a,t,e));return Math.min(f,p)}function Gh(t,e,n,a,u){if(!Ns(e,t.length)||!Ns(a,n.length))return NaN;let f=1/0;for(let p=e[0];p<e[1];++p)for(let y=a[0];y<a[1];++y){if(Fs(t[p],t[p+1],n[y],n[y+1]))return 0;f=Math.min(f,Us(t[p],t[p+1],n[y],n[y+1],u))}return f}function uf(t,e,n,a,u){if(!Ns(e,t.length)||!Ns(a,n.length))return NaN;let f=1/0;for(let p=e[0];p<=e[1];++p)for(let y=a[0];y<=a[1];++y)if((f=Math.min(f,u.distance(t[p],n[y])))===0)return f;return f}function Gl(t,e,n){if(ra(t,e,!0))return 0;let a=1/0;for(const u of e){const f=u.length;if(f<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[f-1]&&(a=Math.min(a,n.pointToSegmentDistance(t,u[f-1],u[0])))===0||(a=Math.min(a,Ts(t,u,n)))===0)return a}return a}function ku(t,e,n,a){if(!Ns(e,t.length))return NaN;for(let f=e[0];f<=e[1];++f)if(ra(t[f],n,!0))return 0;let u=1/0;for(let f=e[0];f<e[1];++f)for(const p of n)for(let y=0,b=p.length,T=b-1;y<b;T=y++){if(Fs(t[f],t[f+1],p[T],p[y]))return 0;u=Math.min(u,Us(t[f],t[f+1],p[T],p[y],a))}return u}function Du(t,e){for(const n of t)for(let a=0;a<=n.length-1;++a)if(ra(n[a],e,!0))return!0;return!1}function Lu(t,e,n,a=1/0){const u=jl(t),f=jl(e);if(a!==1/0&&ws(u,f,n)>=a)return a;if(ia(u,f)){if(Du(t,e))return 0}else if(Du(e,t))return 0;let p=a;for(const y of t)for(let b=0,T=y.length,E=T-1;b<T;E=b++)for(const I of e)for(let k=0,O=I.length,z=O-1;k<O;z=k++){if(Fs(y[E],y[b],I[z],I[k]))return 0;p=Math.min(p,Us(y[E],y[b],I[z],I[k],n))}return p}function Hl(t,e,n,a,u,f,p){if(f===null||p===null)return;const y=ws(Vs(a,f),Vs(u,p),n);y<e&&t.push({dist:y,range1:f,range2:p})}function ql(t,e,n,a,u=1/0){let f=Math.min(a.distance(t[0],n[0][0]),u);if(f===0)return f;const p=new Ea([{dist:0,range1:[0,t.length-1],range2:[0,0]}],jh),y=e?Ia:Aa,b=jl(n);for(;p.length;){const T=p.pop();if(T.dist>=f)continue;const E=T.range1;if(Ul(E)<=y){if(!Ns(E,t.length))return NaN;if(e){const I=ku(t,E,n,a);if((f=Math.min(f,I))===0)return f}else for(let I=E[0];I<=E[1];++I){const k=Gl(t[I],n,a);if((f=Math.min(f,k))===0)return f}}else{const I=Dc(E,e);if(I[0]!==null){const k=ws(Vs(t,I[0]),b,a);k<f&&p.push({dist:k,range1:I[0],range2:[0,0]})}if(I[1]!==null){const k=ws(Vs(t,I[1]),b,a);k<f&&p.push({dist:k,range1:I[1],range2:[0,0]})}}}return f}function Ou(t,e,n,a,u,f=1/0){let p=Math.min(f,u.distance(t[0],n[0]));if(p===0)return p;const y=new Ea([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],jh),b=e?Ia:Aa,T=a?Ia:Aa;for(;y.length;){const E=y.pop();if(E.dist>=p)continue;const I=E.range1,k=E.range2;if(Ul(I)<=b&&Ul(k)<=T){if(!Ns(I,t.length)||!Ns(k,n.length))return NaN;if(e&&a?p=Math.min(p,Gh(t,I,n,k,u)):e||a?e&&!a?p=Math.min(p,Pu(n,k,t,I,u)):!e&&a&&(p=Math.min(p,Pu(t,I,n,k,u))):p=Math.min(p,uf(t,I,n,k,u)),p===0)return p}else{const O=Dc(I,e),z=Dc(k,a);Hl(y,p,u,t,n,O[0],z[0]),Hl(y,p,u,t,n,O[0],z[1]),Hl(y,p,u,t,n,O[1],z[0]),Hl(y,p,u,t,n,O[1],z[1])}}return p}function Lc(t,e,n,a,u=1/0){let f=u;const p=Vs(t,[0,t.length-1]);for(const y of n)if(!(f!==1/0&&ws(p,Vs(y,[0,y.length-1]),a)>=f)&&(f=Math.min(f,Ou(t,e,y,!0,a,f)),f===0))return f;return f}function qe(t,e,n,a,u=1/0){let f=u;const p=Vs(t,[0,t.length-1]);for(const y of n){if(f!==1/0&&ws(p,jl(y),a)>=f)continue;const b=ql(t,e,y,a,f);if(isNaN(b))return b;if((f=Math.min(f,b))===0)return f}return f}function bt(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class hi{constructor(e,n){this.type=gt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Ta(e[1])){const a=e[1];if(a.type==="FeatureCollection"){for(let u=0;u<a.features.length;++u)if(bt(a.features[u].geometry.type))return new hi(a,a.features[u].geometry)}else if(a.type==="Feature"){if(bt(a.geometry.type))return new hi(a,a.geometry)}else if(bt(a.type))return new hi(a,a)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const n=e.geometry(),a=e.canonicalID();if(n!=null&&a!=null){if(e.geometryType()==="Point")return function(u,f,p){const y=[];for(const T of u)for(const E of T)y.push(oa(E,f));const b=new hs(y[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?Ou(y,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",b):p.type==="MultiLineString"?Lc(y,!1,p.coordinates,b):p.type==="Polygon"||p.type==="MultiPolygon"?qe(y,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,b):null}(n,a,this.geometries);if(e.geometryType()==="LineString")return function(u,f,p){const y=[];for(const T of u){const E=[];for(const I of T)E.push(oa(I,f));y.push(E)}const b=new hs(y[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Lc(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",y,b);if(p.type==="MultiLineString"){let T=1/0;for(let E=0;E<p.coordinates.length;E++){const I=Lc(p.coordinates[E],!0,y,b,T);if(isNaN(I))return I;if((T=Math.min(T,I))===0)return T}return T}if(p.type==="Polygon"||p.type==="MultiPolygon"){let T=1/0;for(let E=0;E<y.length;E++){const I=qe(y[E],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,b,T);if(isNaN(I))return I;if((T=Math.min(T,I))===0)return T}return T}return null}(n,a,this.geometries);if(e.geometryType()==="Polygon")return function(u,f,p){const y=[];for(const T of function(E,I){const k=E.length;if(k<=1)return[E];const O=[];let z,N;for(let j=0;j<k;j++){const W=Fl(E[j]);W!==0&&(E[j].area=Math.abs(W),N===void 0&&(N=W<0),N===W<0?(z&&O.push(z),z=[E[j]]):z.push(E[j]))}return z&&O.push(z),O}(u)){const E=[];for(let I=0;I<T.length;++I)E.push(cf(T[I],f));y.push(E)}const b=new hs(y[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return qe(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",y,b);if(p.type==="MultiLineString"){let T=1/0;for(let E=0;E<p.coordinates.length;E++){const I=qe(p.coordinates[E],!0,y,b,T);if(isNaN(I))return I;if((T=Math.min(T,I))===0)return T}return T}return p.type==="Polygon"||p.type==="MultiPolygon"?function(T,E,I){let k=1/0;for(const O of T)for(const z of E){const N=Lu(O,z,I,k);if(isNaN(N))return N;if((k=Math.min(k,N))===0)return k}return k}(p.type==="Polygon"?[p.coordinates]:p.coordinates,y,b):null}(n,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var Ri=hi;function jn(t){if(t instanceof Go&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof tl||t instanceof Ri)return!1;let e=!0;return t.eachChild(n=>{e&&!jn(n)&&(e=!1)}),e}function qi(t){if(t instanceof Go&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!qi(n)&&(e=!1)}),e}function ar(t){if(t instanceof Go&&t.name==="config")return!1;let e=!0;return t.eachChild(n=>{e&&!ar(n)&&(e=!1)}),e}function lr(t,e){if(t instanceof Go&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(a=>{n&&!lr(a,e)&&(n=!1)}),n}class Io{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const a=e[1];return n.scope.has(a)?new Io(a,n.scope.get(a)):n.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Br=Io;class br{constructor(e,n=[],a,u=new af,f=[],p,y){this.registry=e,this.path=n,this.key=n.map(b=>`[${b}]`).join(""),this.scope=u,this.errors=f,this.expectedType=a,this._scope=p,this.options=y}parse(e,n,a,u,f={}){return n||a?this.concat(n,a,u)._parse(e,f):this._parse(e,f)}_parse(e,n){function a(u,f,p){return p==="assert"?new ls(f,[u]):p==="coerce"?new cs(f,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let f=u.parse(e,this);if(!f)return null;if(this.expectedType){const p=this.expectedType,y=f.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||y.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(p,y))return null}else f=a(f,p,n.typeAnnotation||"coerce");else f=a(f,p,n.typeAnnotation||"assert")}if(!(f instanceof Sa)&&f.type.kind!=="resolvedImage"&&qo(f)){const p=new Cc(this._scope,this.options);try{f=new Sa(f.type,f.evaluate(p))}catch(y){return this.error(y.message),null}}return f}return cs.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,a){const u=typeof e=="number"?this.path.concat(e):this.path,f=a?this.scope.concat(a):this.scope;return new br(this.registry,u,n||null,f,this.errors,this._scope,this.options)}error(e,...n){const a=`${this.key}${n.map(u=>`[${u}]`).join("")}`;this.errors.push(new Uo(a,e))}checkSubtype(e,n){const a=ti(e,n);return a&&this.error(a),a}}var Ho=br;function qo(t){if(t instanceof Br)return qo(t.boundExpression);if(t instanceof Go&&t.name==="error"||t instanceof Go&&t.name==="config"||t instanceof Rl||t instanceof tl||t instanceof Ri)return!1;const e=t instanceof cs||t instanceof ls;let n=!0;return t.eachChild(a=>{n=e?n&&qo(a):n&&a instanceof Sa}),!!n&&jn(t)&&lr(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function Wr(t,e){const n=t.length-1;let a,u,f=0,p=n,y=0;for(;f<=p;)if(y=Math.floor((f+p)/2),a=t[y],u=t[y+1],a<=e){if(y===n||e<u)return y;f=y+1}else{if(!(a>e))throw new xr("Input is not a number.");p=y-1}return 0}class ds{constructor(e,n,a){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[u,f]of a)this.labels.push(u),this.outputs.push(f)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const a=n.parse(e[1],1,gt);if(!a)return null;const u=[];let f=null;n.expectedType&&n.expectedType.kind!=="value"&&(f=n.expectedType);for(let p=1;p<e.length;p+=2){const y=p===1?-1/0:e[p],b=e[p+1],T=p,E=p+1;if(typeof y!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(u.length&&u[u.length-1][0]>=y)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const I=n.parse(b,E,f);if(!I)return null;f=f||I.type,u.push([y,I])}return new ds(f,a,u)}evaluate(e){const n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return a[0].evaluate(e);const f=n.length;return u>=n[f-1]?a[f-1].evaluate(e):a[Wr(n,u)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var sa=ds;function Wi(t,e,n){return t*(1-n)+e*n}function js(t,e,n){return t.map((a,u)=>Wi(a,e[u],n))}var Gs=Object.freeze({__proto__:null,array:js,color:function(t,e,n){return new Bn(Wi(t.r,e.r,n),Wi(t.g,e.g,n),Wi(t.b,e.b,n),Wi(t.a,e.a,n))},number:Wi});const il=.95047,Ca=1.08883,Hh=4/29,On=6/29,Gn=3*On*On,Oc=On*On*On,aa=Math.PI/180,Ru=180/Math.PI;function Co(t){return t>Oc?Math.pow(t,1/3):t/Gn+Hh}function fs(t){return t>On?t*t*t:Gn*(t-Hh)}function Ss(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Pa(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Wl(t){const e=Pa(t.r),n=Pa(t.g),a=Pa(t.b),u=Co((.4124564*e+.3575761*n+.1804375*a)/il),f=Co((.2126729*e+.7151522*n+.072175*a)/1);return{l:116*f-16,a:500*(u-f),b:200*(f-Co((.0193339*e+.119192*n+.9503041*a)/Ca)),alpha:t.a}}function Wo(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,a=isNaN(t.b)?e:e-t.b/200;return e=1*fs(e),n=il*fs(n),a=Ca*fs(a),new Bn(Ss(3.2404542*n-1.5371385*e-.4985314*a),Ss(-.969266*n+1.8760108*e+.041556*a),Ss(.0556434*n-.2040259*e+1.0572252*a),t.alpha)}function la(t,e,n){const a=e-t;return t+n*(a>180||a<-180?a-360*Math.round(a/360):a)}const ka={forward:Wl,reverse:Wo,interpolate:function(t,e,n){return{l:Wi(t.l,e.l,n),a:Wi(t.a,e.a,n),b:Wi(t.b,e.b,n),alpha:Wi(t.alpha,e.alpha,n)}}},ps={forward:function(t){const{l:e,a:n,b:a}=Wl(t),u=Math.atan2(a,n)*Ru;return{h:u<0?u+360:u,c:Math.sqrt(n*n+a*a),l:e,alpha:t.a}},reverse:function(t){const e=t.h*aa,n=t.c;return Wo({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:la(t.h,e.h,n),c:Wi(t.c,e.c,n),l:Wi(t.l,e.l,n),alpha:Wi(t.alpha,e.alpha,n)}}};var Rc=Object.freeze({__proto__:null,hcl:ps,lab:ka});class Da{constructor(e,n,a,u,f){this.type=e,this.operator=n,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(const[p,y]of f)this.labels.push(p),this.outputs.push(y)}static interpolationFactor(e,n,a,u){let f=0;if(e.name==="exponential")f=zo(n,e.base,a,u);else if(e.name==="linear")f=zo(n,1,a,u);else if(e.name==="cubic-bezier"){const p=e.controlPoints;f=new He(p[0],p[1],p[2],p[3]).solve(zo(n,1,a,u))}return f}static parse(e,n){let[a,u,f,...p]=e;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const T=u[1];if(typeof T!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:T}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const T=u.slice(1);if(T.length!==4||T.some(E=>typeof E!="number"||E<0||E>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(f=n.parse(f,2,gt),!f)return null;const y=[];let b=null;a==="interpolate-hcl"||a==="interpolate-lab"?b=ae:n.expectedType&&n.expectedType.kind!=="value"&&(b=n.expectedType);for(let T=0;T<p.length;T+=2){const E=p[T],I=p[T+1],k=T+3,O=T+4;if(typeof E!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(y.length&&y[y.length-1][0]>=E)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const z=n.parse(I,O,b);if(!z)return null;b=b||z.type,y.push([E,z])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new Da(b,a,u,f,y):n.error(`Type ${Nt(b)} is not interpolatable.`)}evaluate(e){const n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return a[0].evaluate(e);const f=n.length;if(u>=n[f-1])return a[f-1].evaluate(e);const p=Wr(n,u),y=Da.interpolationFactor(this.interpolation,u,n[p],n[p+1]),b=a[p].evaluate(e),T=a[p+1].evaluate(e);return this.operator==="interpolate"?Gs[this.type.kind.toLowerCase()](b,T,y):this.operator==="interpolate-hcl"?ps.reverse(ps.interpolate(ps.forward(b),ps.forward(T),y)):ka.reverse(ka.interpolate(ka.forward(b),ka.forward(T),y))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)n.push(this.labels[a],this.outputs[a].serialize());return n}}function zo(t,e,n,a){const u=a-n,f=t-n;return u===0?0:e===1?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}var Zo=Da;class ms{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let a=null;const u=n.expectedType;u&&u.kind!=="value"&&(a=u);const f=[];for(const y of e.slice(1)){const b=n.parse(y,1+f.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,f.push(b)}const p=u&&f.some(y=>ti(u,y.type));return new ms(p?Me:a,f)}evaluate(e){let n,a=null,u=0;for(const f of this.args){if(u++,a=f.evaluate(e),a&&a instanceof jo&&!a.available&&(n||(n=a),a=null,u===this.args.length))return n;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Zl=ms;class hf{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let f=1;f<e.length-1;f+=2){const p=e[f];if(typeof p!="string")return n.error(`Expected string, but found ${typeof p} instead.`,f);if(/[^a-zA-Z0-9_]/.test(p))return n.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=n.parse(e[f+1],f+1);if(!y)return null;a.push([p,y])}const u=n.parse(e[e.length-1],e.length-1,n.expectedType,a);return u?new hf(a,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,a]of this.bindings)e.push(n,a.serialize());return e.push(this.result.serialize()),e}}var mm=hf;class df{constructor(e,n,a){this.type=e,this.index=n,this.input=a}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,gt),u=n.parse(e[2],2,Ht(n.expectedType||Me));return a&&u?new df(u.type.itemType,a,u):null}evaluate(e){const n=this.index.evaluate(e),a=this.input.evaluate(e);if(n<0)throw new xr(`Array index out of bounds: ${n} < 0.`);if(n>=a.length)throw new xr(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n!==Math.floor(n))throw new xr(`Array index must be an integer, but found ${n} instead.`);return a[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Ly=df;class qh{constructor(e,n){this.type=G,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,Me),u=n.parse(e[2],2,Me);return a&&u?Ji(a.type,[G,D,gt,wa,Me])?new qh(a,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nt(a.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!Xn(n,["boolean","string","number","null"]))throw new xr(`Expected first argument to be of type boolean, string, number or null, but found ${Nt(Mr(n))} instead.`);if(!Xn(a,["string","array"]))throw new xr(`Expected second argument to be of type array or string, but found ${Nt(Mr(a))} instead.`);return a.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ff=qh;class Xl{constructor(e,n,a){this.type=gt,this.needle=e,this.haystack=n,this.fromIndex=a}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,Me),u=n.parse(e[2],2,Me);if(!a||!u)return null;if(!Ji(a.type,[G,D,gt,wa,Me]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nt(a.type)} instead`);if(e.length===4){const f=n.parse(e[3],3,gt);return f?new Xl(a,u,f):null}return new Xl(a,u)}evaluate(e){const n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Xn(n,["boolean","string","number","null"]))throw new xr(`Expected first argument to be of type boolean, string, number or null, but found ${Nt(Mr(n))} instead.`);if(!Xn(a,["string","array"]))throw new xr(`Expected second argument to be of type array or string, but found ${Nt(Mr(a))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return a.indexOf(n,u)}return a.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var gm=Xl;class zu{constructor(e,n,a,u,f,p){this.inputType=e,this.type=n,this.input=a,this.cases=u,this.outputs=f,this.otherwise=p}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let a,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);const f={},p=[];for(let T=2;T<e.length-1;T+=2){let E=e[T];const I=e[T+1];Array.isArray(E)||(E=[E]);const k=n.concat(T);if(E.length===0)return k.error("Expected at least one branch label.");for(const z of E){if(typeof z!="number"&&typeof z!="string")return k.error("Branch labels must be numbers or strings.");if(typeof z=="number"&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof z=="number"&&Math.floor(z)!==z)return k.error("Numeric branch labels must be integer values.");if(a){if(k.checkSubtype(a,Mr(z)))return null}else a=Mr(z);if(f[String(z)]!==void 0)return k.error("Branch labels must be unique.");f[String(z)]=p.length}const O=n.parse(I,T,u);if(!O)return null;u=u||O.type,p.push(O)}const y=n.parse(e[1],1,Me);if(!y)return null;const b=n.parse(e[e.length-1],e.length-1,u);return b?y.type.kind!=="value"&&n.concat(1).checkSubtype(a,y.type)?null:new zu(a,u,y,f,p,b):null}evaluate(e){const n=this.input.evaluate(e);return(Mr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),a=[],u={};for(const p of n){const y=u[this.cases[p]];y===void 0?(u[this.cases[p]]=a.length,a.push([this.cases[p],[p]])):a[y][1].push(p)}const f=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,y]of a)e.push(y.length===1?f(y[0]):y.map(f)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}var Oy=zu;class Ms{constructor(e,n,a){this.type=e,this.branches=n,this.otherwise=a}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);const u=[];for(let p=1;p<e.length-1;p+=2){const y=n.parse(e[p],p,G);if(!y)return null;const b=n.parse(e[p+1],p+1,a);if(!b)return null;u.push([y,b]),a=a||b.type}const f=n.parse(e[e.length-1],e.length-1,a);return f?new Ms(a,u,f):null}evaluate(e){for(const[n,a]of this.branches)if(n.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,a]of this.branches)e(n),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Ry=Ms;class Fu{constructor(e,n,a,u){this.type=e,this.input=n,this.beginIndex=a,this.endIndex=u}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,Me),u=n.parse(e[2],2,gt);if(!a||!u)return null;if(!Ji(a.type,[Ht(Me),D,Me]))return n.error(`Expected first argument to be of type array or string, but found ${Nt(a.type)} instead`);if(e.length===4){const f=n.parse(e[3],3,gt);return f?new Fu(a.type,a,u,f):null}return new Fu(a.type,a,u)}evaluate(e){const n=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Xn(n,["string","array"]))throw new xr(`Expected first argument to be of type array or string, but found ${Nt(Mr(n))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return n.slice(a,u)}return n.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var zy=Fu;function _m(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function ym(t,e,n,a){return a.compare(e,n)===0}function zc(t,e,n){const a=t!=="=="&&t!=="!=";return class SC{constructor(f,p,y){this.type=G,this.lhs=f,this.rhs=p,this.collator=y,this.hasUntypedArgument=f.type.kind==="value"||p.type.kind==="value"}static parse(f,p){if(f.length!==3&&f.length!==4)return p.error("Expected two or three arguments.");const y=f[0];let b=p.parse(f[1],1,Me);if(!b)return null;if(!_m(y,b.type))return p.concat(1).error(`"${y}" comparisons are not supported for type '${Nt(b.type)}'.`);let T=p.parse(f[2],2,Me);if(!T)return null;if(!_m(y,T.type))return p.concat(2).error(`"${y}" comparisons are not supported for type '${Nt(T.type)}'.`);if(b.type.kind!==T.type.kind&&b.type.kind!=="value"&&T.type.kind!=="value")return p.error(`Cannot compare types '${Nt(b.type)}' and '${Nt(T.type)}'.`);a&&(b.type.kind==="value"&&T.type.kind!=="value"?b=new ls(T.type,[b]):b.type.kind!=="value"&&T.type.kind==="value"&&(T=new ls(b.type,[T])));let E=null;if(f.length===4){if(b.type.kind!=="string"&&T.type.kind!=="string"&&b.type.kind!=="value"&&T.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(E=p.parse(f[3],3,Oe),!E)return null}return new SC(b,T,E)}evaluate(f){const p=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(a&&this.hasUntypedArgument){const b=Mr(p),T=Mr(y);if(b.kind!==T.kind||b.kind!=="string"&&b.kind!=="number")throw new xr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${b.kind}, ${T.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=Mr(p),T=Mr(y);if(b.kind!=="string"||T.kind!=="string")return e(f,p,y)}return this.collator?n(f,p,y,this.collator.evaluate(f)):e(f,p,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[t];return this.eachChild(p=>{f.push(p.serialize())}),f}}}const vm=zc("==",function(t,e,n){return e===n},ym),pf=zc("!=",function(t,e,n){return e!==n},function(t,e,n,a){return!ym(0,e,n,a)}),xm=zc("<",function(t,e,n){return e<n},function(t,e,n,a){return a.compare(e,n)<0}),Fy=zc(">",function(t,e,n){return e>n},function(t,e,n,a){return a.compare(e,n)>0}),Xo=zc("<=",function(t,e,n){return e<=n},function(t,e,n,a){return a.compare(e,n)<=0}),By=zc(">=",function(t,e,n){return e>=n},function(t,e,n,a){return a.compare(e,n)>=0});class mf{constructor(e,n,a,u,f,p){this.type=D,this.number=e,this.locale=n,this.currency=a,this.unit=u,this.minFractionDigits=f,this.maxFractionDigits=p}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const a=n.parse(e[1],1,gt);if(!a)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=n.parse(u.locale,1,D),!f))return null;let p=null;if(u.currency&&(p=n.parse(u.currency,1,D),!p))return null;let y=null;if(u.unit&&(y=n.parse(u.unit,1,D),!y))return null;let b=null;if(u["min-fraction-digits"]&&(b=n.parse(u["min-fraction-digits"],1,gt),!b))return null;let T=null;return u["max-fraction-digits"]&&(T=n.parse(u["max-fraction-digits"],1,gt),!T)?null:new mf(a,f,p,y,b,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class gf{constructor(e){this.type=gt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=n.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Nt(a.type)} instead.`):new gf(a):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new xr(`Expected value to be of type string or array, but found ${Nt(Mr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function Bu(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const _f={"==":vm,"!=":pf,">":Fy,"<":xm,">=":By,"<=":Xo,array:ls,at:Ly,boolean:ls,case:Ry,coalesce:Zl,collator:Rl,format:Qa,image:el,in:ff,"index-of":gm,interpolate:Zo,"interpolate-hcl":Zo,"interpolate-lab":Zo,length:gf,let:mm,literal:Sa,match:Oy,number:ls,"number-format":mf,object:ls,slice:zy,step:sa,string:ls,"to-boolean":cs,"to-color":cs,"to-number":cs,"to-string":cs,var:Br,within:tl,distance:Ri};function Wh(t,[e,n,a,u]){e=e.evaluate(t),n=n.evaluate(t),a=a.evaluate(t);const f=u?u.evaluate(t):1,p=xs(e,n,a,f);if(p)throw new xr(p);return new Bn(e/255*f,n/255*f,a/255*f,f)}function bm(t,[e,n,a,u]){e=e.evaluate(t),n=n.evaluate(t),a=a.evaluate(t);const f=u?u.evaluate(t):1,p=function(T,E,I,k){return typeof T=="number"&&T>=0&&T<=360?typeof E=="number"&&E>=0&&E<=100&&typeof I=="number"&&I>=0&&I<=100?k===void 0||typeof k=="number"&&k>=0&&k<=1?null:`Invalid hsla value [${[T,E,I,k].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof k=="number"?[T,E,I,k]:[T,E,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof k=="number"?[T,E,I,k]:[T,E,I]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,a,f);if(p)throw new xr(p);const y=`hsla(${e}, ${n}%, ${a}%, ${f})`,b=Bn.parse(y);if(!b)throw new xr(`Failed to parse HSLA color: ${y}`);return b}function wm(t,e){return t in e}function Yl(t,e){const n=e[t];return n===void 0?null:n}function Tm(t,e){switch(t){case"string":return String(e);case"number":return+e;case"boolean":return!!e;case"color":return Bn.parse(e)}return e}function Sm(t,e,n,a){return a!==void 0&&(t=a*Math.round(t/a)),e!==void 0&&t<e&&(t=e),n!==void 0&&t>n&&(t=n),t}function yf(t,e,n){e=[e,n,t.scope].filter(Boolean).join("");const a=t.getConfig(e);if(!a)return null;const{type:u,value:f,values:p,minValue:y,maxValue:b,stepValue:T}=a,E=a.default.evaluate(t);let I=E;if(f){const k=t.scope;t.scope=(k||"").split("").slice(1).join(""),I=f.evaluate(t),t.scope=k}return u&&(I=Tm(u,I)),f!==void 0&&I!==void 0&&p&&!p.includes(I)&&(I=E,u&&(I=Tm(u,I))),I===void 0||y===void 0&&b===void 0&&T===void 0||(typeof I=="number"?I=Sm(I,y,b,T):Array.isArray(I)&&(I=I.map(k=>typeof k=="number"?Sm(k,y,b,T):k))),I}function nl(t){return{type:t}}Go.register(_f,{error:[{kind:"error"},[D],(t,[e])=>{throw new xr(e.evaluate(t))}],typeof:[D,[Me],(t,[e])=>Nt(Mr(e.evaluate(t)))],"to-rgba":[Ht(gt,4),[ae],(t,[e])=>e.evaluate(t).toArray()],rgb:[ae,[gt,gt,gt],Wh],rgba:[ae,[gt,gt,gt,gt],Wh],hsl:[ae,[gt,gt,gt],bm],hsla:[ae,[gt,gt,gt,gt],bm],has:{type:G,overloads:[[[D],(t,[e])=>wm(e.evaluate(t),t.properties())],[[D,Te],(t,[e,n])=>wm(e.evaluate(t),n.evaluate(t))]]},get:{type:Me,overloads:[[[D],(t,[e])=>Yl(e.evaluate(t),t.properties())],[[D,Te],(t,[e,n])=>Yl(e.evaluate(t),n.evaluate(t))]]},config:{type:Me,overloads:[[[D],(t,[e])=>yf(t,e.evaluate(t))],[[D,D],(t,[e,n])=>yf(t,e.evaluate(t),n.evaluate(t))]]},"feature-state":[Me,[D],(t,[e])=>Yl(e.evaluate(t),t.featureState||{})],properties:[Te,[],t=>t.properties()],"geometry-type":[D,[],t=>t.geometryType()],id:[Me,[],t=>t.id()],zoom:[gt,[],t=>t.globals.zoom],pitch:[gt,[],t=>t.globals.pitch||0],"distance-from-center":[gt,[],t=>t.distanceFromCenter()],"measure-light":[gt,[D],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[gt,[],t=>t.globals.heatmapDensity||0],"line-progress":[gt,[],t=>t.globals.lineProgress||0],"raster-value":[gt,[],t=>t.globals.rasterValue||0],"sky-radial-progress":[gt,[],t=>t.globals.skyRadialProgress||0],accumulated:[Me,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[gt,nl(gt),(t,e)=>{let n=0;for(const a of e)n+=a.evaluate(t);return n}],"*":[gt,nl(gt),(t,e)=>{let n=1;for(const a of e)n*=a.evaluate(t);return n}],"-":{type:gt,overloads:[[[gt,gt],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[gt],(t,[e])=>-e.evaluate(t)]]},"/":[gt,[gt,gt],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[gt,[gt,gt],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[gt,[],()=>Math.LN2],pi:[gt,[],()=>Math.PI],e:[gt,[],()=>Math.E],"^":[gt,[gt,gt],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[gt,[gt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[gt,[gt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[gt,[gt],(t,[e])=>Math.log(e.evaluate(t))],log2:[gt,[gt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[gt,[gt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[gt,[gt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[gt,[gt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[gt,[gt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[gt,[gt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[gt,[gt],(t,[e])=>Math.atan(e.evaluate(t))],min:[gt,nl(gt),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[gt,nl(gt),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[gt,[gt],(t,[e])=>Math.abs(e.evaluate(t))],round:[gt,[gt],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[gt,[gt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[gt,[gt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[G,[D,Me],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[G,[Me],(t,[e])=>t.id()===e.value],"filter-type-==":[G,[D],(t,[e])=>t.geometryType()===e.value],"filter-<":[G,[D,Me],(t,[e,n])=>{const a=t.properties()[e.value],u=n.value;return typeof a==typeof u&&a<u}],"filter-id-<":[G,[Me],(t,[e])=>{const n=t.id(),a=e.value;return typeof n==typeof a&&n<a}],"filter->":[G,[D,Me],(t,[e,n])=>{const a=t.properties()[e.value],u=n.value;return typeof a==typeof u&&a>u}],"filter-id->":[G,[Me],(t,[e])=>{const n=t.id(),a=e.value;return typeof n==typeof a&&n>a}],"filter-<=":[G,[D,Me],(t,[e,n])=>{const a=t.properties()[e.value],u=n.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[G,[Me],(t,[e])=>{const n=t.id(),a=e.value;return typeof n==typeof a&&n<=a}],"filter->=":[G,[D,Me],(t,[e,n])=>{const a=t.properties()[e.value],u=n.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[G,[Me],(t,[e])=>{const n=t.id(),a=e.value;return typeof n==typeof a&&n>=a}],"filter-has":[G,[Me],(t,[e])=>e.value in t.properties()],"filter-has-id":[G,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[G,[Ht(D)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[G,[Ht(Me)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[G,[D,Ht(Me)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[G,[D,Ht(Me)],(t,[e,n])=>function(a,u,f,p){for(;f<=p;){const y=f+p>>1;if(u[y]===a)return!0;u[y]>a?p=y-1:f=y+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:G,overloads:[[[G,G],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[nl(G),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:G,overloads:[[[G,G],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[nl(G),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[G,[G],(t,[e])=>!e.evaluate(t)],"is-supported-script":[G,[D],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[D,[D],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[D,[D],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[D,nl(Me),(t,e)=>e.map(n=>$a(n.evaluate(t))).join("")],"resolved-locale":[D,[Oe],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[gt,[gt,gt,Me],(t,e)=>{const[n,a,u]=e.map(p=>p.evaluate(t));if(n>a||n===a)return n;let f;if(typeof u=="string")f=function(p){let y=0;if(p.length===0)return y;for(let b=0;b<p.length;b++)y=(y<<5)-y+p.charCodeAt(b),y&=y;return y}(u);else{if(typeof u!="number")throw new xr(`Invalid seed input: ${u}`);f=u}return n+Bu(f)()*(a-n)}]});var Nu=_f;function Es(t){return{result:"success",value:t}}function rl(t){return{result:"error",value:t}}function Mm(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function ol(t){return t["property-type"]==="data-driven"}function Vu(t){return Mm(t.expression,"measure-light")}function vf(t){return Mm(t.expression,"zoom")}function xf(t){return!!t.expression&&t.expression.interpolated}function Zh(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Ny(t){return t}function Em(t,e){const n=e.type==="color",a=t.stops&&typeof t.stops[0][0]=="object",u=a||!(a||t.property!==void 0),f=t.type||(xf(e)?"exponential":"interval");if(n&&((t=ss({},t)).stops&&(t.stops=t.stops.map(T=>[T[0],Bn.parse(T[1])])),t.default=Bn.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Rc[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let p,y,b;if(f==="exponential")p=Uu;else if(f==="interval")p=gs;else if(f==="categorical"){p=Xh,y=Object.create(null);for(const T of t.stops)y[T[0]]=T[1];b=typeof t.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);p=Vy}if(a){const T={},E=[];for(let O=0;O<t.stops.length;O++){const z=t.stops[O],N=z[0].zoom;T[N]===void 0&&(T[N]={zoom:N,type:t.type,property:t.property,default:t.default,stops:[]},E.push(N)),T[N].stops.push([z[0].value,z[1]])}const I=[];for(const O of E)I.push([T[O].zoom,Em(T[O],e)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:Zo.interpolationFactor.bind(void 0,k),zoomStops:I.map(O=>O[0]),evaluate:({zoom:O},z)=>Uu({stops:I,base:t.base},e,O).evaluate(O,z)}}if(u){const T=f==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:Zo.interpolationFactor.bind(void 0,T),zoomStops:t.stops.map(E=>E[0]),evaluate:({zoom:E})=>p(t,e,E,y,b)}}return{kind:"source",evaluate(T,E){const I=E&&E.properties?E.properties[t.property]:void 0;return I===void 0?sl(t.default,e.default):p(t,e,I,y,b)}}}function sl(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function Xh(t,e,n,a,u){return sl(typeof n===u?a[n]:void 0,t.default,e.default)}function gs(t,e,n){if(pn(n)!=="number")return sl(t.default,e.default);const a=t.stops.length;if(a===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[a-1][0])return t.stops[a-1][1];const u=Wr(t.stops.map(f=>f[0]),n);return t.stops[u][1]}function Uu(t,e,n){const a=t.base!==void 0?t.base:1;if(pn(n)!=="number")return sl(t.default,e.default);const u=t.stops.length;if(u===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[u-1][0])return t.stops[u-1][1];const f=Wr(t.stops.map(E=>E[0]),n),p=function(E,I,k,O){const z=O-k,N=E-k;return z===0?0:I===1?N/z:(Math.pow(I,N)-1)/(Math.pow(I,z)-1)}(n,a,t.stops[f][0],t.stops[f+1][0]),y=t.stops[f][1],b=t.stops[f+1][1];let T=Gs[e.type]||Ny;if(t.colorSpace&&t.colorSpace!=="rgb"){const E=Rc[t.colorSpace];T=(I,k)=>E.reverse(E.interpolate(E.forward(I),E.forward(k),p))}return typeof y.evaluate=="function"?{evaluate(...E){const I=y.evaluate.apply(void 0,E),k=b.evaluate.apply(void 0,E);if(I!==void 0&&k!==void 0)return T(I,k,p)}}:T(y,b,p)}function Vy(t,e,n){return e.type==="color"?n=Bn.parse(n):e.type==="formatted"?n=po.fromString(n.toString()):e.type==="resolvedImage"?n=jo.fromString(n.toString()):pn(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),sl(n,t.default,e.default)}class bf{constructor(e,n,a,u){this.expression=e,this._warningHistory={},this._evaluator=new Cc(a,u),this._defaultValue=n?function(f){return f.type==="color"&&(Zh(f.default)||Array.isArray(f.default))?new Bn(0,0,0,0):f.type==="color"?Bn.parse(f.default)||null:f.default===void 0?null:f.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,a,u,f,p,y,b){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,a,u,f,p,y,b){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new xr(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Yh(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Nu}function ju(t,e,n,a){const u=new Ho(Nu,[],e?function(p){const y={color:ae,string:D,number:gt,enum:D,boolean:G,formatted:Ge,resolvedImage:Gt};return p.type==="array"?Ht(y[p.value]||Me,p.length):y[p.type]}(e):void 0,void 0,void 0,n,a),f=u.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Es(new bf(f,e,n,a)):rl(u.errors)}class Gu{constructor(e,n,a){this.kind=e,this._styleExpression=n,this.isLightConstant=a,this.isStateDependent=e!=="constant"&&!qi(n.expression),this.isConfigDependent=!ar(n.expression)}evaluateWithoutErrorHandling(e,n,a,u,f,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,u,f,p)}evaluate(e,n,a,u,f,p){return this._styleExpression.evaluate(e,n,a,u,f,p)}}class Hu{constructor(e,n,a,u,f){this.kind=e,this.zoomStops=a,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!qi(n.expression),this.isLightConstant=f,this.isConfigDependent=!ar(n.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,n,a,u,f,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,u,f,p)}evaluate(e,n,a,u,f,p){return this._styleExpression.evaluate(e,n,a,u,f,p)}interpolationFactor(e,n,a){return this.interpolationType?Zo.interpolationFactor(this.interpolationType,e,n,a):0}}function qu(t,e,n,a){if((t=ju(t,e,n,a)).result==="error")return t;const u=t.value.expression,f=jn(u);if(!f&&!ol(e))return rl([new Uo("","data expressions not supported")]);const p=lr(u,["zoom","pitch","distance-from-center"]);if(!p&&!vf(e))return rl([new Uo("","zoom expressions not supported")]);const y=lr(u,["measure-light"]);if(!y&&!Vu(e))return rl([new Uo("","measure-light expression not supported")]);const b=e.expression&&e.expression.relaxZoomRestriction,T=Kh(u);return T||p||b?T instanceof Uo?rl([T]):T instanceof Zo&&!xf(e)?rl([new Uo("",'"interpolate" expressions cannot be used with this property')]):Es(T?new Hu(f?"camera":"composite",t.value,T.labels,T instanceof Zo?T.interpolation:void 0,y):new Gu(f?"constant":"source",t.value,y)):rl([new Uo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Jh{constructor(e,n){this._parameters=e,this._specification=n,ss(this,Em(this._parameters,this._specification))}static deserialize(e){return new Jh(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Kh(t){let e=null;if(t instanceof mm)e=Kh(t.result);else if(t instanceof Zl){for(const n of t.args)if(e=Kh(n),e)break}else(t instanceof sa||t instanceof Zo)&&t.input instanceof Go&&t.input.name==="zoom"&&(e=t);return e instanceof Uo||t.eachChild(n=>{const a=Kh(n);a instanceof Uo?e=a:e&&a&&e!==a&&(e=new Uo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Yo(t){const e=t.key,n=t.value,a=t.valueSpec||{},u=t.objectElementValidators||{},f=t.style,p=t.styleSpec;let y=[];const b=pn(n);if(b!=="object")return[new ci(e,n,`object expected, ${b} found`)];for(const T in n){const E=T.split(".")[0];let I;u[E]?I=u[E]:a[E]?I=Vr:u["*"]?I=u["*"]:a["*"]&&(I=Vr),I?y=y.concat(I({key:(e&&`${e}.`)+T,value:n[T],valueSpec:a[E]||a["*"],style:f,styleSpec:p,object:n,objectKey:T},n)):y.push(new vs(e,n[T],`unknown property "${T}"`))}for(const T in a)u[T]||a[T].required&&a[T].default===void 0&&n[T]===void 0&&y.push(new ci(e,n,`missing required property "${T}"`));return y}function Am(t){const e=t.value,n=t.valueSpec,a=t.style,u=t.styleSpec,f=t.key,p=t.arrayElementValidator||Vr;if(pn(e)!=="array")return[new ci(f,e,`array expected, ${pn(e)} found`)];if(n.length&&e.length!==n.length)return[new ci(f,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new ci(f,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let y={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};u.$version<7&&(y.function=n.function),pn(n.value)==="object"&&(y=n.value);let b=[];for(let T=0;T<e.length;T++)b=b.concat(p({array:e,arrayIndex:T,value:e[T],valueSpec:y,style:a,styleSpec:u,key:`${f}[${T}]`},!0));return b}function wf(t){const e=t.key,n=t.value,a=t.valueSpec;let u=pn(n);if(u==="number"&&n!=n&&(u="NaN"),u!=="number")return[new ci(e,n,`number expected, ${u} found`)];if("minimum"in a){let f=a.minimum;if(pn(a.minimum)==="array"&&(f=a.minimum[t.arrayIndex]),n<f)return[new ci(e,n,`${n} is less than the minimum value ${f}`)]}if("maximum"in a){let f=a.maximum;if(pn(a.maximum)==="array"&&(f=a.maximum[t.arrayIndex]),n>f)return[new ci(e,n,`${n} is greater than the maximum value ${f}`)]}return[]}function Tf(t){const e=t.valueSpec,n=vr(t.value.type);let a,u,f,p={};const y=n!=="categorical"&&t.value.property===void 0,b=!y,T=pn(t.value.stops)==="array"&&pn(t.value.stops[0])==="array"&&pn(t.value.stops[0][0])==="object",E=Yo({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(O){if(n==="identity")return[new ci(O.key,O.value,'identity function may not have a "stops" property')];let z=[];const N=O.value;return z=z.concat(Am({key:O.key,value:N,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:I})),pn(N)==="array"&&N.length===0&&z.push(new ci(O.key,N,"array must have at least one stop")),z},default:function(O){return Vr({key:O.key,value:O.value,valueSpec:e,style:O.style,styleSpec:O.styleSpec})}}});return n==="identity"&&y&&E.push(new ci(t.key,t.value,'missing required property "property"')),n==="identity"||t.value.stops||E.push(new ci(t.key,t.value,'missing required property "stops"')),n==="exponential"&&t.valueSpec.expression&&!xf(t.valueSpec)&&E.push(new ci(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(b&&!ol(t.valueSpec)?E.push(new ci(t.key,t.value,"property functions not supported")):y&&!vf(t.valueSpec)&&E.push(new ci(t.key,t.value,"zoom functions not supported"))),n!=="categorical"&&!T||t.value.property!==void 0||E.push(new ci(t.key,t.value,'"property" property is required')),E;function I(O){let z=[];const N=O.value,j=O.key;if(pn(N)!=="array")return[new ci(j,N,`array expected, ${pn(N)} found`)];if(N.length!==2)return[new ci(j,N,`array length 2 expected, length ${N.length} found`)];if(T){if(pn(N[0])!=="object")return[new ci(j,N,`object expected, ${pn(N[0])} found`)];if(N[0].zoom===void 0)return[new ci(j,N,"object stop key must have zoom")];if(N[0].value===void 0)return[new ci(j,N,"object stop key must have value")];const W=vr(N[0].zoom);if(typeof W!="number")return[new ci(j,N[0].zoom,"stop zoom values must be numbers")];if(f&&f>W)return[new ci(j,N[0].zoom,"stop zoom values must appear in ascending order")];W!==f&&(f=W,u=void 0,p={}),z=z.concat(Yo({key:`${j}[0]`,value:N[0],valueSpec:{zoom:{}},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:wf,value:k}}))}else z=z.concat(k({key:`${j}[0]`,value:N[0],valueSpec:{},style:O.style,styleSpec:O.styleSpec},N));return Yh(as(N[1]))?z.concat([new ci(`${j}[1]`,N[1],"expressions are not allowed in function stops.")]):z.concat(Vr({key:`${j}[1]`,value:N[1],valueSpec:e,style:O.style,styleSpec:O.styleSpec}))}function k(O,z){const N=pn(O.value),j=vr(O.value),W=O.value!==null?O.value:z;if(a){if(N!==a)return[new ci(O.key,W,`${N} stop domain type must match previous stop domain type ${a}`)]}else a=N;if(N!=="number"&&N!=="string"&&N!=="boolean"&&typeof j!="number"&&typeof j!="string"&&typeof j!="boolean")return[new ci(O.key,W,"stop domain value must be a number, string, or boolean")];if(N!=="number"&&n!=="categorical"){let ie=`number expected, ${N} found`;return ol(e)&&n===void 0&&(ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ci(O.key,W,ie)]}return n!=="categorical"||N!=="number"||typeof j=="number"&&isFinite(j)&&Math.floor(j)===j?n!=="categorical"&&N==="number"&&typeof j=="number"&&typeof u=="number"&&u!==void 0&&j<u?[new ci(O.key,W,"stop domain values must appear in ascending order")]:(u=j,n==="categorical"&&j in p?[new ci(O.key,W,"stop domain values must be unique")]:(p[j]=!0,[])):[new ci(O.key,W,`integer expected, found ${String(j)}`)]}}function Jl(t){const e=(t.expressionContext==="property"?qu:ju)(as(t.value),t.valueSpec);if(e.result==="error")return e.value.map(a=>new ci(`${t.key}${a.key}`,t.value,a.message));const n=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!n.outputDefined())return[new ci(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!qi(n))return[new ci(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return $h(n,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!lr(n,["zoom","feature-state"]))return[new ci(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!jn(n))return[new ci(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function $h(t,e){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const u of e.valueSpec.expression.parameters)n.delete(u);if(n.size===0)return[];const a=[];return t instanceof Go&&n.has(t.name)?[new ci(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(u=>{a.push(...$h(u,e))}),a)}function Kl(t){const e=t.key,n=t.value,a=t.valueSpec,u=[];return Array.isArray(a.values)?a.values.indexOf(vr(n))===-1&&u.push(new ci(e,n,`expected one of [${a.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(a.values).indexOf(vr(n))===-1&&u.push(new ci(e,n,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(n)} found`)),u}function Qh(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Qh(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function ed(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Qh(t)||(t=td(t));const n=t;let a=!0;try{a=function(T){if(!al(T))return T;let E=as(T);return Im(E),E=Sf(E),E}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}const u=Ne[`filter_${e}`],f=ju(a,u);let p=null;if(f.result==="error")throw new Error(f.value.map(T=>`${T.key}: ${T.message}`).join(", "));p=(T,E,I)=>f.value.evaluate(T,E,{},I);let y=null,b=null;if(a!==n){const T=ju(n,u);if(T.result==="error")throw new Error(T.value.map(E=>`${E.key}: ${E.message}`).join(", "));y=(E,I,k,O,z)=>T.value.evaluate(E,I,{},k,void 0,void 0,O,z),b=!jn(T.value.expression)}return{filter:p,dynamicFilter:y||void 0,needGeometry:Cm(a),needFeature:!!b}}function Sf(t){if(!Array.isArray(t))return t;const e=function(n){if(Uy.has(n[0])){for(let a=1;a<n.length;a++)if(al(n[a]))return!0}return n}(t);return e===!0?e:e.map(n=>Sf(n))}function Im(t){let e=!1;const n=[];if(t[0]==="case"){for(let a=1;a<t.length-1;a+=2)e=e||al(t[a]),n.push(t[a+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||al(t[1]);for(let a=2;a<t.length-1;a+=2)n.push(t[a+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||al(t[1]);for(let a=1;a<t.length-1;a+=2)n.push(t[a+1])}e&&(t.length=0,t.push("any",...n));for(let a=1;a<t.length;a++)Im(t[a])}function al(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(al(t[n]))return!0;return!1}const Uy=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function jy(t,e){return t<e?-1:t>e?1:0}function Cm(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(Cm(t[e]))return!0;return!1}function td(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?id(t[1],t[2],"=="):e==="!="?nd(id(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?id(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(td))):e==="all"?["all"].concat(t.slice(1).map(td)):e==="none"?["all"].concat(t.slice(1).map(td).map(nd)):e==="in"?Pm(t[1],t.slice(2)):e==="!in"?nd(Pm(t[1],t.slice(2))):e==="has"?km(t[1]):e!=="!has"||nd(km(t[1]));var n}function id(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function Pm(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(jy)]]:["filter-in-small",t,["literal",e]]}}function km(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function nd(t){return["!",t]}function Mf(t){return Qh(as(t.value))?Jl(ss({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):Dm(t)}function Dm(t){const e=t.value,n=t.key;if(pn(e)!=="array")return[new ci(n,e,`array expected, ${pn(e)} found`)];const a=t.styleSpec;let u,f=[];if(e.length<1)return[new ci(n,e,"filter array must have at least 1 element")];switch(f=f.concat(Kl({key:`${n}[0]`,value:e[0],valueSpec:a.filter_operator,style:t.style,styleSpec:t.styleSpec})),vr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&vr(e[1])==="$type"&&f.push(new ci(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&f.push(new ci(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=pn(e[1]),u!=="string"&&f.push(new ci(`${n}[1]`,e[1],`string expected, ${u} found`)));for(let p=2;p<e.length;p++)u=pn(e[p]),vr(e[1])==="$type"?f=f.concat(Kl({key:`${n}[${p}]`,value:e[p],valueSpec:a.geometry_type,style:t.style,styleSpec:t.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&f.push(new ci(`${n}[${p}]`,e[p],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)f=f.concat(Dm({key:`${n}[${p}]`,value:e[p],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":u=pn(e[1]),e.length!==2?f.push(new ci(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&f.push(new ci(`${n}[1]`,e[1],`string expected, ${u} found`))}return f}function Lm(t,e){const n=t.key,a=t.style,u=t.layer,f=t.styleSpec,p=t.value,y=t.objectKey,b=f[`${e}_${t.layerType}`];if(!b)return[];const T=y.match(/^(.*)-transition$/);if(e==="paint"&&T&&b[T[1]]&&b[T[1]].transition)return Vr({key:n,value:p,valueSpec:f.transition,style:a,styleSpec:f});const E=t.valueSpec||b[y];if(!E)return[new vs(n,p,`unknown property "${y}"`)];let I;if(pn(p)==="string"&&ol(E)&&!E.tokens&&(I=/^{([^}]+)}$/.exec(p))){const O=`\`{ "type": "identity", "property": ${I?JSON.stringify(I[1]):'"_"'} }\``;return[new ci(n,p,`"${y}" does not support interpolation syntax
Use an identity property function instead: ${O}.`)]}const k=[];if(t.layerType==="symbol")y!=="text-field"||!a||a.glyphs||a.imports||k.push(new ci(n,p,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&Zh(as(p))&&vr(p.type)==="identity"&&k.push(new ci(n,p,'"text-font" does not support identity functions'));else if(t.layerType==="model"&&e==="paint"&&u&&u.layout&&u.layout.hasOwnProperty("model-id")&&ol(E)&&(Vu(E)||vf(E))){const O=qu(as(p),E),z=O.value.expression||O.value._styleExpression.expression;z&&!lr(z,["measure-light"])&&(y==="model-emissive-strength"&&jn(z)&&qi(z)||k.push(new ci(n,p,`${y} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return k.concat(Vr({key:t.key,value:p,valueSpec:E,style:a,styleSpec:f,expressionContext:"property",propertyType:e,propertyKey:y}))}function Om(t){return Lm(t,"paint")}function Wu(t){return Lm(t,"layout")}function Rm(t){let e=[];const n=t.value,a=t.key,u=t.style,f=t.styleSpec;n.type||n.ref||e.push(new ci(a,n,'either "type" or "ref" is required'));let p=vr(n.type);const y=vr(n.ref);if(n.id){const b=vr(n.id);for(let T=0;T<t.arrayIndex;T++){const E=u.layers[T];vr(E.id)===b&&e.push(new ci(a,n.id,`duplicate layer id "${n.id}", previously used at line ${E.id.__line__}`))}}if("ref"in n){let b;["type","source","source-layer","filter","layout"].forEach(T=>{T in n&&e.push(new ci(a,n[T],`"${T}" is prohibited for ref layers`))}),u.layers.forEach(T=>{vr(T.id)===y&&(b=T)}),b?b.ref?e.push(new ci(a,n.ref,"ref cannot reference another ref layer")):p=vr(b.type):typeof y=="string"&&e.push(new ci(a,n.ref,`ref layer "${y}" not found`))}else if(p!=="background"&&p!=="sky"&&p!=="slot")if(n.source){const b=u.sources&&u.sources[n.source],T=b&&vr(b.type);b?T==="vector"&&p==="raster"?e.push(new ci(a,n.source,`layer "${n.id}" requires a raster source`)):T==="raster"&&p!=="raster"?e.push(new ci(a,n.source,`layer "${n.id}" requires a vector source`)):T!=="vector"||n["source-layer"]?T==="raster-dem"&&p!=="hillshade"?e.push(new ci(a,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||T==="geojson"&&b.lineMetrics||e.push(new ci(a,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ci(a,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new ci(a,n.source,`source "${n.source}" not found`))}else e.push(new ci(a,n,'missing required property "source"'));return e=e.concat(Yo({key:a,value:n,valueSpec:f.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Vr({key:`${a}.type`,value:n.type,valueSpec:f.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:b=>Mf(ss({layerType:p},b)),layout:b=>Yo({layer:n,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":T=>Wu(ss({layerType:p},T))}}),paint:b=>Yo({layer:n,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":T=>Om(ss({layerType:p,layer:n},T))}})}})),e}function Fc(t){const e=t.value,n=t.key,a=pn(e);return a!=="string"?[new ci(n,e,`string expected, ${a} found`)]:[]}const Zu={promoteId:function({key:t,value:e}){if(pn(e)==="string")return Fc({key:t,value:e});{const n=[];for(const a in e)n.push(...Fc({key:`${t}.${a}`,value:e[a]}));return n}}};function zm(t){const e=t.value,n=t.key,a=t.styleSpec,u=t.style;if(!e.type)return[new ci(n,e,'"type" is required')];const f=vr(e.type);let p=[];switch(["vector","raster","raster-dem"].includes(f)&&(e.url||e.tiles||p.push(new vs(n,e,'Either "url" or "tiles" is required.'))),f){case"vector":case"raster":case"raster-dem":return p=p.concat(Yo({key:n,value:e,valueSpec:a[`source_${f.replace("-","_")}`],style:t.style,styleSpec:a,objectElementValidators:Zu})),p;case"geojson":if(p=Yo({key:n,value:e,valueSpec:a.source_geojson,style:u,styleSpec:a,objectElementValidators:Zu}),e.cluster)for(const y in e.clusterProperties){const[b,T]=e.clusterProperties[y],E=typeof b=="string"?[b,["accumulated"],["get",y]]:b;p.push(...Jl({key:`${n}.${y}.map`,value:T,expressionContext:"cluster-map"})),p.push(...Jl({key:`${n}.${y}.reduce`,value:E,expressionContext:"cluster-reduce"}))}return p;case"video":return Yo({key:n,value:e,valueSpec:a.source_video,style:u,styleSpec:a});case"image":return Yo({key:n,value:e,valueSpec:a.source_image,style:u,styleSpec:a});case"canvas":return[new ci(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Kl({key:`${n}.type`,value:e.type,valueSpec:{values:Fm(a)},style:u,styleSpec:a})}}function Fm(t){return t.source.reduce((e,n)=>{const a=t[n];return a.type.type==="enum"&&(e=e.concat(Object.keys(a.type.values))),e},[])}function Bm(t){const e=t.value;let n=[];if(!e)return n;const a=pn(e);return a!=="string"?(n=n.concat([new ci(t.key,e,`string expected, "${a}" found`)]),n):(function(u){const f=u.indexOf("://")===-1;try{return new URL(u,f?"http://example.com":void 0),!0}catch{return!1}}(e)||(n=n.concat([new ci(t.key,e,`invalid url "${e}"`)])),n)}function Ef(t){const e=t.value,n=t.styleSpec,a=n.light,u=t.style;let f=[];const p=pn(e);if(e===void 0)return f;if(p!=="object")return f=f.concat([new ci("light",e,`object expected, ${p} found`)]),f;for(const y in e){const b=y.match(/^(.*)-transition$/);f=f.concat(b&&a[b[1]]&&a[b[1]].transition?Vr({key:y,value:e[y],valueSpec:n.transition,style:u,styleSpec:n}):a[y]?Vr({key:y,value:e[y],valueSpec:a[y],style:u,styleSpec:n}):[new ci(y,e[y],`unknown property "${y}"`)])}return f}function Af(t){const e=t.value;let n=[];if(!e)return n;const a=pn(e);if(a!=="object")return n=n.concat([new ci("light-3d",e,`object expected, ${a} found`)]),n;const u=t.styleSpec,f=u["light-3d"],p=t.key,y=t.style,b=t.style.lights;for(const I of["type","id"])if(!(I in e))return n=n.concat([new ci("light-3d",e,`missing property ${I} on light`)]),n;if(e.type&&b)for(let I=0;I<t.arrayIndex;I++){const k=vr(e.type),O=b[I];vr(O.type)===k&&n.push(new ci(p,e.id,`duplicate light type "${e.type}", previously defined at line ${O.id.__line__}`))}const T=`properties_light_${e.type}`;if(!(T in u))return n=n.concat([new ci("light-3d",e,`Invalid light type ${e.type}`)]),n;const E=u[T];for(const I in e)if(I==="properties"){const k=e[I],O=pn(k);if(O!=="object")return n=n.concat([new ci("properties",k,`object expected, ${O} found`)]),n;for(const z in k)n=n.concat(E[z]?Vr({key:z,value:k[z],valueSpec:E[z],style:y,styleSpec:u}):[new vs(t.key,k[z],`unknown property "${z}"`)])}else{const k=I.match(/^(.*)-transition$/);n=n.concat(k&&f[k[1]]&&f[k[1]].transition?Vr({key:I,value:e[I],valueSpec:u.transition,style:y,styleSpec:u}):f[I]?Vr({key:I,value:e[I],valueSpec:f[I],style:y,styleSpec:u}):[new vs(I,e[I],`unknown property "${I}"`)])}return n}function If(t){const e=t.value,n=t.key,a=t.style,u=t.styleSpec,f=u.terrain;let p=[];const y=pn(e);if(e===void 0||y==="null")return p;if(y!=="object")return p=p.concat([new ci("terrain",e,`object expected, ${y} found`)]),p;for(const b in e){const T=b.match(/^(.*)-transition$/);p=p.concat(T&&f[T[1]]&&f[T[1]].transition?Vr({key:b,value:e[b],valueSpec:u.transition,style:a,styleSpec:u}):f[b]?Vr({key:b,value:e[b],valueSpec:f[b],style:a,styleSpec:u}):[new vs(b,e[b],`unknown property "${b}"`)])}if(e.source){const b=a.sources&&a.sources[e.source],T=b&&vr(b.type);b?T!=="raster-dem"&&p.push(new ci(n,e.source,`terrain cannot be used with a source of type ${String(T)}, it only be used with a "raster-dem" source type`)):p.push(new ci(n,e.source,`source "${e.source}" not found`))}else p.push(new ci(n,e,'terrain is missing required property "source"'));return p}function Cf(t){const e=t.value,n=t.style,a=t.styleSpec,u=a.fog;let f=[];const p=pn(e);if(e===void 0)return f;if(p!=="object")return f=f.concat([new ci("fog",e,`object expected, ${p} found`)]),f;for(const y in e){const b=y.match(/^(.*)-transition$/);f=f.concat(b&&u[b[1]]&&u[b[1]].transition?Vr({key:y,value:e[y],valueSpec:a.transition,style:n,styleSpec:a}):u[y]?Vr({key:y,value:e[y],valueSpec:u[y],style:n,styleSpec:a}):[new vs(y,e[y],`unknown property "${y}"`)])}return f}const rd={"*":()=>[],array:Am,boolean:function(t){const e=t.value,n=t.key,a=pn(e);return a!=="boolean"?[new ci(n,e,`boolean expected, ${a} found`)]:[]},number:wf,color:function(t){const e=t.key,n=t.value,a=pn(n);return a!=="string"?[new ci(e,n,`color expected, ${a} found`)]:tn(n)===null?[new ci(e,n,`color expected, "${n}" found`)]:[]},enum:Kl,filter:Mf,function:Tf,layer:Rm,object:Yo,source:zm,model:Bm,light:Ef,"light-3d":Af,terrain:If,fog:Cf,string:Fc,formatted:function(t){return Fc(t).length===0?[]:Jl(t)},resolvedImage:function(t){return Fc(t).length===0?[]:Jl(t)},projection:function(t){const e=t.value,n=t.styleSpec,a=n.projection,u=t.style;let f=[];const p=pn(e);if(p==="object")for(const y in e)f=f.concat(Vr({key:y,value:e[y],valueSpec:a[y],style:u,styleSpec:n}));else p!=="string"&&(f=f.concat([new ci("projection",e,`object or string expected, ${p} found`)]));return f},import:function(t){const{value:e,styleSpec:n}=t,{data:a,...u}=e;Object.defineProperty(u,"__line__",{value:e.__line__,enumerable:!1});let f=Yo(ss({},t,{value:u,valueSpec:n.import}));return vr(u.id)===""&&f.push(new ci(`${t.key}.id`,u,"import id can't be an empty string")),a&&(f=f.concat(Nm(a,n,{key:`${t.key}.data`}))),f}};function Vr(t,e=!1){const n=t.value,a=t.valueSpec,u=t.styleSpec;if(a.expression&&Zh(vr(n)))return Tf(t);if(a.expression&&Yh(as(n)))return Jl(t);if(a.type&&rd[a.type]){const f=rd[a.type](t);return e===!0&&f.length>0&&pn(t.value)==="array"?Jl(t):f}return Yo(ss({},t,{valueSpec:a.type?u[a.type]:a}))}function Gy(t){const e=t.value,n=t.key,a=Fc(t);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new ci(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new ci(n,e,'"glyphs" url must include a "{range}" token'))),a}function Nm(t,e=Ne,n={}){return Vr({key:n.key||"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Gy,"*":()=>[]}})}function Pf(t,e=Ne){return Hs(Nm(t,e))}const Hy=t=>Hs(Om(t)),qy=t=>Hs(Wu(t));function Hs(t){return t.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function Vm(t,e){let n=!1;if(e&&e.length)for(const a of e)a instanceof vs?ni(a.message):(t.fire(new Ro(new Error(a.message))),n=!0);return n}var Wy=ca,ll=3;function ca(t,e,n){var a=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var u=new Int32Array(this.arrayBuffer);t=u[0],this.d=(e=u[1])+2*(n=u[2]);for(var f=0;f<this.d*this.d;f++){var p=u[ll+f],y=u[ll+f+1];a.push(p===y?null:u.subarray(p,y))}var b=u[ll+a.length+1];this.keys=u.subarray(u[ll+a.length],b),this.bboxes=u.subarray(b),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var T=0;T<this.d*this.d;T++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var E=n/e*t;this.min=-E,this.max=t+E}ca.prototype.insert=function(t,e,n,a,u){this._forEachCell(e,n,a,u,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(u)},ca.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ca.prototype._insertCell=function(t,e,n,a,u,f){this.cells[u].push(f)},ca.prototype.query=function(t,e,n,a,u){var f=this.min,p=this.max;if(t<=f&&e<=f&&p<=n&&p<=a&&!u)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(t,e,n,a,this._queryCell,y,{},u),y},ca.prototype._queryCell=function(t,e,n,a,u,f,p,y){var b=this.cells[u];if(b!==null)for(var T=this.keys,E=this.bboxes,I=0;I<b.length;I++){var k=b[I];if(p[k]===void 0){var O=4*k;(y?y(E[O+0],E[O+1],E[O+2],E[O+3]):t<=E[O+2]&&e<=E[O+3]&&n>=E[O+0]&&a>=E[O+1])?(p[k]=!0,f.push(T[k])):p[k]=!1}}},ca.prototype._forEachCell=function(t,e,n,a,u,f,p,y){for(var b=this._convertToCellCoord(t),T=this._convertToCellCoord(e),E=this._convertToCellCoord(n),I=this._convertToCellCoord(a),k=b;k<=E;k++)for(var O=T;O<=I;O++){var z=this.d*O+k;if((!y||y(this._convertFromCellCoord(k),this._convertFromCellCoord(O),this._convertFromCellCoord(k+1),this._convertFromCellCoord(O+1)))&&u.call(this,t,e,n,a,z,f,p,y))return}},ca.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ca.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ca.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=ll+this.cells.length+1+1,n=0,a=0;a<this.cells.length;a++)n+=this.cells[a].length;var u=new Int32Array(e+n+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var f=e,p=0;p<t.length;p++){var y=t[p];u[ll+p]=f,u.set(y,f),f+=y.length}return u[ll+t.length]=f,u.set(this.keys,f),u[ll+t.length+1]=f+=this.keys.length,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer};var Bc=fe(Wy);const od={};function ri(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),od[e]={klass:t,omit:n.omit||[]}}ri(Object,"Object"),Bc.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},Bc.deserialize=function(t){return new Bc(t.buffer)},Object.defineProperty(Bc,"name",{value:"Grid"}),ri(Bc,"Grid"),ri(Bn,"Color"),ri(Error,"Error"),ri(po,"Formatted"),ri(Nn,"FormattedSection"),ri(fn,"AJAXError"),ri(jo,"ResolvedImage"),ri(Jh,"StylePropertyFunction"),ri(bf,"StyleExpression",{omit:["_evaluator"]}),ri(Hu,"ZoomDependentExpression"),ri(Gu,"ZoomConstantExpression"),ri(Go,"CompoundExpression",{omit:["_evaluate"]});for(const t in Nu)od[Nu[t]._classRegistryKey]||ri(Nu[t],`Expression${t}`);function g(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function l(t){return self.ImageBitmap&&t instanceof ImageBitmap}function d(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(g(t)||l(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.add(n.buffer),n}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const a of t)n.push(d(a,e));return n}if(t instanceof Map){const n={$name:"Map"};for(const[a,u]of t.entries())n[a]=d(u);return n}if(typeof t=="object"){const n=t.constructor,a=n._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);const u=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const f in t)t.hasOwnProperty(f)&&(od[a].omit.indexOf(f)>=0||(u[f]=d(t[f],e)));t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(u.$name=a),u}throw new Error("can't serialize object of type "+typeof t)}function v(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||g(t)||l(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(v);if(typeof t=="object"){const e=t.$name||"Object";if(e==="Map"){const u=new Map;for(const f of Object.keys(t))f!=="$name"&&u.set(f,v(t[f]));return u}const{klass:n}=od[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const a=Object.create(n.prototype);for(const u of Object.keys(t))u!=="$name"&&(a[u]=v(t[u]));return a}throw new Error("can't deserialize object of type "+typeof t)}const w={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function S(t){for(const e of t)if(R(e.charCodeAt(0)))return!0;return!1}function A(t){for(const e of t)if(!C(e.charCodeAt(0)))return!1;return!0}function C(t){return!(w.Arabic(t)||w["Arabic Supplement"](t)||w["Arabic Extended-A"](t)||w["Arabic Presentation Forms-A"](t)||w["Arabic Presentation Forms-B"](t))}function R(t){return!(t!==746&&t!==747&&(t<4352||!(w["Bopomofo Extended"](t)||w.Bopomofo(t)||w["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||w["CJK Compatibility Ideographs"](t)||w["CJK Compatibility"](t)||w["CJK Radicals Supplement"](t)||w["CJK Strokes"](t)||!(!w["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||w["CJK Unified Ideographs Extension A"](t)||w["CJK Unified Ideographs"](t)||w["Enclosed CJK Letters and Months"](t)||w["Hangul Compatibility Jamo"](t)||w["Hangul Jamo Extended-A"](t)||w["Hangul Jamo Extended-B"](t)||w["Hangul Jamo"](t)||w["Hangul Syllables"](t)||w.Hiragana(t)||w["Ideographic Description Characters"](t)||w.Kanbun(t)||w["Kangxi Radicals"](t)||w["Katakana Phonetic Extensions"](t)||w.Katakana(t)&&t!==12540||!(!w["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!w["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||w["Unified Canadian Aboriginal Syllabics"](t)||w["Unified Canadian Aboriginal Syllabics Extended"](t)||w["Vertical Forms"](t)||w["Yijing Hexagram Symbols"](t)||w["Yi Syllables"](t)||w["Yi Radicals"](t))))}function B(t){return!(R(t)||function(e){return!!(w["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||w["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||w["Letterlike Symbols"](e)||w["Number Forms"](e)||w["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||w["Control Pictures"](e)&&e!==9251||w["Optical Character Recognition"](e)||w["Enclosed Alphanumerics"](e)||w["Geometric Shapes"](e)||w["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||w["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||w["CJK Symbols and Punctuation"](e)||w.Katakana(e)||w["Private Use Area"](e)||w["CJK Compatibility Forms"](e)||w["Small Form Variants"](e)||w["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function U(t){return t>=1424&&t<=2303||w["Arabic Presentation Forms-A"](t)||w["Arabic Presentation Forms-B"](t)}function H(t,e){return!(!e&&U(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||w.Khmer(t))}function Z(t){for(const e of t)if(U(e.charCodeAt(0)))return!0;return!1}const K="deferred",Q="loading",te="loaded";let ee=null,$="unavailable",le=null;const _e=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&($="error"),ee&&ee(t)};function ye(){oe.fire(new Ao("pluginStateChange",{pluginStatus:$,pluginURL:le}))}const oe=new fo,he=function(){return $},ve=function(){if($!==K||!le)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");$=Q,ye(),le&&Cr({url:le},t=>{t?_e(t):($=te,ye())})},Ee={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>$===te||Ee.applyArabicShaping!=null,isLoading:()=>$===Q,setState(t){$=t.pluginStatus,le=t.pluginURL},isParsed:()=>Ee.applyArabicShaping!=null&&Ee.processBidirectionalText!=null&&Ee.processStyledBidirectionalText!=null,getPluginURL:()=>le};class xe{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,a){for(const u of n)if(!H(u.charCodeAt(0),a))return!1;return!0}(e,Ee.isLoaded())}}class Pe{constructor(e,n,a,u){this.property=e,this.value=n,this.expression=function(f,p,y,b){if(Zh(f))return new Jh(f,p);if(Yh(f)||Array.isArray(f)&&f.length>0){const T=qu(f,p,y,b);if(T.result==="error")throw new Error(T.value.map(E=>`${E.key}: ${E.message}`).join(", "));return T.value}{let T=f;return typeof f=="string"&&p.type==="color"&&(T=Bn.parse(f)),{kind:"constant",isConfigDependent:!1,evaluate:()=>T}}}(n===void 0?e.specification.default:n,e.specification,a,u)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,a){return this.property.possiblyEvaluate(this,e,n,a)}}class ct{constructor(e,n,a){this.property=e,this.value=new Pe(e,void 0,n,a)}transitioned(e,n){return new et(this.property,this.value,n,Ye({},e.transition,this.transition),e.now)}untransitioned(){return new et(this.property,this.value,null,{},0)}}class je{constructor(e,n,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=a,this.isConfigDependent=!1}getValue(e){return xi(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new ct(this._values[e].property,this._scope,this._options)),this._values[e].value=new Pe(this._values[e].property,n===null?void 0:xi(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);const a=this._properties.properties;if(e)for(const u in e){const f=e[u];if(Sn(u,"-transition")){const p=u.slice(0,-11);a[p]&&this.setTransition(p,f)}else a[u]&&this.setValue(u,f)}}getTransition(e){return xi(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new ct(this._values[e].property)),this._values[e].transition=xi(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const a=this.getValue(n);a!==void 0&&(e[n]=a);const u=this.getTransition(n);u!==void 0&&(e[`${n}-transition`]=u)}return e}transitioned(e,n){const a=new Le(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(e,n._values[u]);return a}untransitioned(){const e=new Le(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class et{constructor(e,n,a,u,f){const p=u.delay||0,y=u.duration||0;f=f||0,this.property=e,this.value=n,this.begin=f+p,this.end=this.begin+y,e.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(e,n,a){const u=e.now||0,f=this.value.possiblyEvaluate(e,n,a),p=this.prior;if(p){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return p.possiblyEvaluate(e,n,a);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,n,a),f,tt(y))}}return f}}class Le{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,a){const u=new dt(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,n,a);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class at{constructor(e,n,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=a,this.isConfigDependent=!1}getValue(e){return xi(this._values[e].value)}setValue(e,n){this._values[e]=new Pe(this._values[e].property,n===null?void 0:xi(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const n of Object.keys(this._values)){const a=this.getValue(n);a!==void 0&&(e[n]=a)}return e}possiblyEvaluate(e,n,a){const u=new dt(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,n,a);return u}}class Ke{constructor(e,n,a){this.property=e,this.value=n,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,a,u){return this.property.evaluate(this.value,this.parameters,e,n,a,u)}}class dt{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class me{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,a){const u=Gs[this.specification.type];return u?u(e,n,a):e}}class Fe{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,a,u){return new Ke(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},a,u)}:e.expression,n)}interpolate(e,n,a){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Ke(this,{kind:"constant",value:void 0},e.parameters);const u=Gs[this.specification.type];return u?new Ke(this,{kind:"constant",value:u(e.value.value,n.value.value,a)},e.parameters):e}evaluate(e,n,a,u,f,p){return e.kind==="constant"?e.value:e.evaluate(n,a,u,f,p)}}class Mt{constructor(e){this.specification=e}possiblyEvaluate(e,n,a,u){return!!e.expression.evaluate(n,null,{},a,u)}interpolate(){return!1}}class _t{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new xe(0,{});for(const a in e){const u=e[a];u.specification.overridable&&this.overridableProperties.push(a);const f=this.defaultPropertyValues[a]=new Pe(u,void 0),p=this.defaultTransitionablePropertyValues[a]=new ct(u);this.defaultTransitioningPropertyValues[a]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=f.possiblyEvaluate(n)}}}ri(Fe,"DataDrivenProperty"),ri(me,"DataConstantProperty"),ri(Mt,"ColorRampProperty");const oi="";function Yt(t,e){return e?`${t}${oi}${e}`:t}const pi="-transition";class Qt extends fo{constructor(e,n,a,u){if(super(),this.id=e.id,this.fqid=Yt(this.id,a),this.type=e.type,this.scope=a,this.options=u,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new at(n.layout,this.scope,u),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new je(n.paint,this.scope,u);for(const f in e.paint)this.setPaintProperty(f,e.paint[f],{validate:!1});for(const f in e.layout)this.setLayoutProperty(f,e.layout[f],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new dt(n.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,a={}){if(n!=null&&this._validate(qy,`layers.${this.id}.layout.${e}`,e,n,a))return;if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);const u=this._unevaluatedLayout;u._properties.properties[e]&&(u.setValue(e,n),this.isConfigDependent=this.isConfigDependent||u.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Sn(e,pi)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,a={}){if(n!=null&&this._validate(Hy,`layers.${this.id}.paint.${e}`,e,n,a))return!1;const u=this._transitionablePaint,f=u._properties.properties;if(Sn(e,pi)){const k=e.slice(0,-11);return f[k]&&u.setTransition(k,n||void 0),!1}if(!f[e])return!1;const p=u._values[e],y=p.value.isDataDriven(),b=p.value;u.setValue(e,n),this.isConfigDependent=this.isConfigDependent||u.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const T=u._values[e].value,E=T.isDataDriven(),I=Sn(e,"pattern")||e==="line-dasharray";return E||y||I||this._handleOverridablePaintPropertyUpdate(e,b,T)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n){return null}_handleOverridablePaintPropertyUpdate(e,n,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return Hr({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}_validate(e,n,a,u,f={}){return(!f||f.validate!==!1)&&Vm(this,e.call(Pf,{key:n,layerType:this.type,objectKey:a,value:u,styleSpec:Ne,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Ke&&ol(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ed(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(){this._stats&&(this._stats.numRenderedVerticesInShadowPass=0,this._stats.numRenderedVerticesInTransparentPass=0)}}const Ai={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ii{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ui{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function di(t,e=1){let n=0,a=0;return{members:t.map(u=>{const f=Ai[u.type].BYTES_PER_ELEMENT,p=n=sn(n,Math.max(e,f)),y=u.components||1;return a=Math.max(a,f),n+=f*y,{name:u.name,type:u.type,components:y,offset:p}}),size:sn(n,Math.max(a,e)),alignment:e}}function sn(t,e){return Math.ceil(t/e)*e}class Ni extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){const u=2*e;return this.int16[u+0]=n,this.int16[u+1]=a,e}}Ni.prototype.bytesPerElement=4,ri(Ni,"StructArrayLayout2i4");class Hn extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,a)}emplace(e,n,a,u){const f=3*e;return this.int16[f+0]=n,this.int16[f+1]=a,this.int16[f+2]=u,e}}Hn.prototype.bytesPerElement=6,ri(Hn,"StructArrayLayout3i6");class Cn extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,u)}emplace(e,n,a,u,f){const p=4*e;return this.int16[p+0]=n,this.int16[p+1]=a,this.int16[p+2]=u,this.int16[p+3]=f,e}}Cn.prototype.bytesPerElement=8,ri(Cn,"StructArrayLayout4i8");class Fo extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,u,f)}emplace(e,n,a,u,f,p){const y=5*e;return this.int16[y+0]=n,this.int16[y+1]=a,this.int16[y+2]=u,this.int16[y+3]=f,this.int16[y+4]=p,e}}Fo.prototype.bytesPerElement=10,ri(Fo,"StructArrayLayout5i10");class As extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,f,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,a,u,f,p,y)}emplace(e,n,a,u,f,p,y,b){const T=6*e,E=12*e,I=3*e;return this.int16[T+0]=n,this.int16[T+1]=a,this.uint8[E+4]=u,this.uint8[E+5]=f,this.uint8[E+6]=p,this.uint8[E+7]=y,this.float32[I+2]=b,e}}As.prototype.bytesPerElement=12,ri(As,"StructArrayLayout2i4ub1f12");class Mn extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,u)}emplace(e,n,a,u,f){const p=4*e;return this.float32[p+0]=n,this.float32[p+1]=a,this.float32[p+2]=u,this.float32[p+3]=f,e}}Mn.prototype.bytesPerElement=16,ri(Mn,"StructArrayLayout4f16");class hn extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,u,f)}emplace(e,n,a,u,f,p){const y=6*e,b=3*e;return this.uint16[y+0]=n,this.uint16[y+1]=a,this.uint16[y+2]=u,this.uint16[y+3]=f,this.float32[b+2]=p,e}}hn.prototype.bytesPerElement=12,ri(hn,"StructArrayLayout4ui1f12");class _n extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,u)}emplace(e,n,a,u,f){const p=4*e;return this.uint16[p+0]=n,this.uint16[p+1]=a,this.uint16[p+2]=u,this.uint16[p+3]=f,e}}_n.prototype.bytesPerElement=8,ri(_n,"StructArrayLayout4ui8");class er extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,u,f,p)}emplace(e,n,a,u,f,p,y){const b=6*e;return this.int16[b+0]=n,this.int16[b+1]=a,this.int16[b+2]=u,this.int16[b+3]=f,this.int16[b+4]=p,this.int16[b+5]=y,e}}er.prototype.bytesPerElement=12,ri(er,"StructArrayLayout6i12");class eo extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,f,p,y,b,T,E,I,k){const O=this.length;return this.resize(O+1),this.emplace(O,e,n,a,u,f,p,y,b,T,E,I,k)}emplace(e,n,a,u,f,p,y,b,T,E,I,k,O){const z=12*e;return this.int16[z+0]=n,this.int16[z+1]=a,this.int16[z+2]=u,this.int16[z+3]=f,this.uint16[z+4]=p,this.uint16[z+5]=y,this.uint16[z+6]=b,this.uint16[z+7]=T,this.int16[z+8]=E,this.int16[z+9]=I,this.int16[z+10]=k,this.int16[z+11]=O,e}}eo.prototype.bytesPerElement=24,ri(eo,"StructArrayLayout4i4ui4i24");class Yn extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,u,f,p)}emplace(e,n,a,u,f,p,y){const b=10*e,T=5*e;return this.int16[b+0]=n,this.int16[b+1]=a,this.int16[b+2]=u,this.float32[T+2]=f,this.float32[T+3]=p,this.float32[T+4]=y,e}}Yn.prototype.bytesPerElement=20,ri(Yn,"StructArrayLayout3i3f20");class vo extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}vo.prototype.bytesPerElement=4,ri(vo,"StructArrayLayout1ul4");class Bo extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){const u=2*e;return this.uint16[u+0]=n,this.uint16[u+1]=a,e}}Bo.prototype.bytesPerElement=4,ri(Bo,"StructArrayLayout2ui4");class xo extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,f,p,y,b,T,E,I,k,O){const z=this.length;return this.resize(z+1),this.emplace(z,e,n,a,u,f,p,y,b,T,E,I,k,O)}emplace(e,n,a,u,f,p,y,b,T,E,I,k,O,z){const N=20*e,j=10*e;return this.int16[N+0]=n,this.int16[N+1]=a,this.int16[N+2]=u,this.int16[N+3]=f,this.int16[N+4]=p,this.float32[j+3]=y,this.float32[j+4]=b,this.float32[j+5]=T,this.float32[j+6]=E,this.int16[N+14]=I,this.uint32[j+8]=k,this.uint16[N+18]=O,this.uint16[N+19]=z,e}}xo.prototype.bytesPerElement=40,ri(xo,"StructArrayLayout5i4f1i1ul2ui40");class Is extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,f,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,a,u,f,p,y)}emplace(e,n,a,u,f,p,y,b){const T=8*e;return this.int16[T+0]=n,this.int16[T+1]=a,this.int16[T+2]=u,this.int16[T+4]=f,this.int16[T+5]=p,this.int16[T+6]=y,this.int16[T+7]=b,e}}Is.prototype.bytesPerElement=16,ri(Is,"StructArrayLayout3i2i2i16");class La extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,u,f)}emplace(e,n,a,u,f,p){const y=4*e,b=8*e;return this.float32[y+0]=n,this.float32[y+1]=a,this.float32[y+2]=u,this.int16[b+6]=f,this.int16[b+7]=p,e}}La.prototype.bytesPerElement=16,ri(La,"StructArrayLayout2f1f2i16");class qs extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,u)}emplace(e,n,a,u,f){const p=12*e,y=3*e;return this.uint8[p+0]=n,this.uint8[p+1]=a,this.float32[y+1]=u,this.float32[y+2]=f,e}}qs.prototype.bytesPerElement=12,ri(qs,"StructArrayLayout2ub2f12");class kn extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,a)}emplace(e,n,a,u){const f=3*e;return this.uint16[f+0]=n,this.uint16[f+1]=a,this.uint16[f+2]=u,e}}kn.prototype.bytesPerElement=6,ri(kn,"StructArrayLayout3ui6");class Ws extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,f,p,y,b,T,E,I,k,O,z,N,j,W,ie,re,se,de){const ge=this.length;return this.resize(ge+1),this.emplace(ge,e,n,a,u,f,p,y,b,T,E,I,k,O,z,N,j,W,ie,re,se,de)}emplace(e,n,a,u,f,p,y,b,T,E,I,k,O,z,N,j,W,ie,re,se,de,ge){const Se=30*e,ke=15*e,Re=60*e;return this.int16[Se+0]=n,this.int16[Se+1]=a,this.int16[Se+2]=u,this.float32[ke+2]=f,this.float32[ke+3]=p,this.uint16[Se+8]=y,this.uint16[Se+9]=b,this.uint32[ke+5]=T,this.uint32[ke+6]=E,this.uint32[ke+7]=I,this.uint16[Se+16]=k,this.uint16[Se+17]=O,this.uint16[Se+18]=z,this.float32[ke+10]=N,this.float32[ke+11]=j,this.uint8[Re+48]=W,this.uint8[Re+49]=ie,this.uint8[Re+50]=re,this.uint32[ke+13]=se,this.int16[Se+28]=de,this.uint8[Re+58]=ge,e}}Ws.prototype.bytesPerElement=60,ri(Ws,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ua extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,f,p,y,b,T,E,I,k,O,z,N,j,W,ie,re,se,de,ge,Se,ke,Re,Ze,Be,ut,Pt,st,St,ot){const qt=this.length;return this.resize(qt+1),this.emplace(qt,e,n,a,u,f,p,y,b,T,E,I,k,O,z,N,j,W,ie,re,se,de,ge,Se,ke,Re,Ze,Be,ut,Pt,st,St,ot)}emplace(e,n,a,u,f,p,y,b,T,E,I,k,O,z,N,j,W,ie,re,se,de,ge,Se,ke,Re,Ze,Be,ut,Pt,st,St,ot,qt){const ii=20*e,It=40*e,Ci=80*e;return this.float32[ii+0]=n,this.float32[ii+1]=a,this.int16[It+4]=u,this.int16[It+5]=f,this.int16[It+6]=p,this.int16[It+7]=y,this.int16[It+8]=b,this.int16[It+9]=T,this.int16[It+10]=E,this.int16[It+11]=I,this.int16[It+12]=k,this.uint16[It+13]=O,this.uint16[It+14]=z,this.uint16[It+15]=N,this.uint16[It+16]=j,this.uint16[It+17]=W,this.uint16[It+18]=ie,this.uint16[It+19]=re,this.uint16[It+20]=se,this.uint16[It+21]=de,this.uint16[It+22]=ge,this.uint16[It+23]=Se,this.uint16[It+24]=ke,this.uint16[It+25]=Re,this.uint16[It+26]=Ze,this.uint16[It+27]=Be,this.uint32[ii+14]=ut,this.float32[ii+15]=Pt,this.float32[ii+16]=st,this.float32[ii+17]=St,this.float32[ii+18]=ot,this.uint8[Ci+76]=qt,e}}ua.prototype.bytesPerElement=80,ri(ua,"StructArrayLayout2f9i15ui1ul4f1ub80");class Oa extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Oa.prototype.bytesPerElement=4,ri(Oa,"StructArrayLayout1f4");class Xu extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,u,f)}emplace(e,n,a,u,f,p){const y=5*e;return this.float32[y+0]=n,this.float32[y+1]=a,this.float32[y+2]=u,this.float32[y+3]=f,this.float32[y+4]=p,e}}Xu.prototype.bytesPerElement=20,ri(Xu,"StructArrayLayout5f20");class Zy extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,f,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,a,u,f,p,y)}emplace(e,n,a,u,f,p,y,b){const T=7*e;return this.float32[T+0]=n,this.float32[T+1]=a,this.float32[T+2]=u,this.float32[T+3]=f,this.float32[T+4]=p,this.float32[T+5]=y,this.float32[T+6]=b,e}}Zy.prototype.bytesPerElement=28,ri(Zy,"StructArrayLayout7f28");class Xy extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,u)}emplace(e,n,a,u,f){const p=6*e;return this.uint32[3*e+0]=n,this.uint16[p+2]=a,this.uint16[p+3]=u,this.uint16[p+4]=f,e}}Xy.prototype.bytesPerElement=12,ri(Xy,"StructArrayLayout1ul3ui12");class kf extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}kf.prototype.bytesPerElement=2,ri(kf,"StructArrayLayout1ui2");class Yu extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,a)}emplace(e,n,a,u){const f=3*e;return this.float32[f+0]=n,this.float32[f+1]=a,this.float32[f+2]=u,e}}Yu.prototype.bytesPerElement=12,ri(Yu,"StructArrayLayout3f12");class Df extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){const u=2*e;return this.float32[u+0]=n,this.float32[u+1]=a,e}}Df.prototype.bytesPerElement=8,ri(Df,"StructArrayLayout2f8");class Yy extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,f,p,y,b,T,E,I,k,O,z,N,j){const W=this.length;return this.resize(W+1),this.emplace(W,e,n,a,u,f,p,y,b,T,E,I,k,O,z,N,j)}emplace(e,n,a,u,f,p,y,b,T,E,I,k,O,z,N,j,W){const ie=16*e;return this.float32[ie+0]=n,this.float32[ie+1]=a,this.float32[ie+2]=u,this.float32[ie+3]=f,this.float32[ie+4]=p,this.float32[ie+5]=y,this.float32[ie+6]=b,this.float32[ie+7]=T,this.float32[ie+8]=E,this.float32[ie+9]=I,this.float32[ie+10]=k,this.float32[ie+11]=O,this.float32[ie+12]=z,this.float32[ie+13]=N,this.float32[ie+14]=j,this.float32[ie+15]=W,e}}Yy.prototype.bytesPerElement=64,ri(Yy,"StructArrayLayout16f64");class Um extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,f,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,a,u,f,p,y)}emplace(e,n,a,u,f,p,y,b){const T=10*e,E=5*e;return this.uint16[T+0]=n,this.uint16[T+1]=a,this.uint16[T+2]=u,this.uint16[T+3]=f,this.float32[E+2]=p,this.float32[E+3]=y,this.float32[E+4]=b,e}}Um.prototype.bytesPerElement=20,ri(Um,"StructArrayLayout4ui3f20");class Jy extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}Jy.prototype.bytesPerElement=1,ri(Jy,"StructArrayLayout1ub1");class n1 extends Ii{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}n1.prototype.size=40;class Ky extends xo{get(e){return new n1(this,e)}}ri(Ky,"CollisionBoxArray");class r1 extends Ii{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}r1.prototype.size=60;class o1 extends Ws{get(e){return new r1(this,e)}}ri(o1,"PlacedSymbolArray");class s1 extends Ii{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}s1.prototype.size=80;class a1 extends ua{get(e){return new s1(this,e)}}ri(a1,"SymbolInstanceArray");class l1 extends Oa{getoffsetX(e){return this.float32[1*e+0]}}ri(l1,"GlyphOffsetArray");class c1 extends Ni{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ri(c1,"SymbolLineVertexArray");class u1 extends Ii{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}u1.prototype.size=12;class h1 extends Xy{get(e){return new u1(this,e)}}ri(h1,"FeatureIndexArray");class d1 extends Bo{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ri(d1,"FillExtrusionCentroidArray");const $k=di([{name:"a_pos",components:2,type:"Int16"}],4),Qk=di([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class cr{constructor(e=[]){this.segments=e}_prepareSegment(e,n,a,u){let f=this.segments[this.segments.length-1];return e>cr.MAX_VERTEX_ARRAY_LENGTH&&ni(`Max vertices per segment is ${cr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>cr.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:n,primitiveOffset:a,vertexLength:0,primitiveLength:0},u!==void 0&&(f.sortKey=u),this.segments.push(f)),f}prepareSegment(e,n,a,u){return this._prepareSegment(e,n.length,a.length,u)}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,a,u){return new cr([{vertexOffset:e,primitiveOffset:n,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}function f1(t,e){return 256*(t=rt(Math.floor(t),0,255))+rt(Math.floor(e),0,255)}cr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ri(cr,"SegmentVector");const eD=di([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),tD=di([{name:"a_dash",components:4,type:"Uint16"}]);var jm={exports:{}},p1={exports:{}};(function(t){t.exports=function(e,n){var a,u,f,p,y,b,T,E;for(u=e.length-(a=3&e.length),f=n,y=3432918353,b=461845907,E=0;E<u;)T=255&e.charCodeAt(E)|(255&e.charCodeAt(++E))<<8|(255&e.charCodeAt(++E))<<16|(255&e.charCodeAt(++E))<<24,++E,f=27492+(65535&(p=5*(65535&(f=(f^=T=(65535&(T=(T=(65535&T)*y+(((T>>>16)*y&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(T=0,a){case 3:T^=(255&e.charCodeAt(E+2))<<16;case 2:T^=(255&e.charCodeAt(E+1))<<8;case 1:f^=T=(65535&(T=(T=(65535&(T^=255&e.charCodeAt(E)))*y+(((T>>>16)*y&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295}return f^=e.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}})(p1);var iD=p1.exports,m1={exports:{}};(function(t){t.exports=function(e,n){for(var a,u=e.length,f=n^u,p=0;u>=4;)a=1540483477*(65535&(a=255&e.charCodeAt(p)|(255&e.charCodeAt(++p))<<8|(255&e.charCodeAt(++p))<<16|(255&e.charCodeAt(++p))<<24))+((1540483477*(a>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),u-=4,++p;switch(u){case 3:f^=(255&e.charCodeAt(p+2))<<16;case 2:f^=(255&e.charCodeAt(p+1))<<8;case 1:f=1540483477*(65535&(f^=255&e.charCodeAt(p)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}})(m1);var g1=iD,nD=m1.exports;jm.exports=g1,jm.exports.murmur3=g1,jm.exports.murmur2=nD;var $y=fe(jm.exports);class Lf{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,a,u){this.ids.push(_1(e)),this.positions.push(n,a,u)}eachPosition(e,n){const a=_1(e);let u=0,f=this.ids.length-1;for(;u<f;){const p=u+f>>1;this.ids[p]>=a?f=p:u=p+1}for(;this.ids[u]===a;)n(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,n){const a=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Qy(a,u,0,a.length-1),n&&(n.add(a.buffer),n.add(u.buffer)),{ids:a,positions:u}}static deserialize(e){const n=new Lf;let a;n.ids=e.ids,n.positions=e.positions;for(const u of n.ids)u!==a&&n.uniqueIds.push(u),a=u;return n.indexed=!0,n}}function _1(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:$y(String(t))}function Qy(t,e,n,a){for(;n<a;){const u=t[n+a>>1];let f=n-1,p=a+1;for(;;){do f++;while(t[f]<u);do p--;while(t[p]>u);if(f>=p)break;Gm(t,f,p),Gm(e,3*f,3*p),Gm(e,3*f+1,3*p+1),Gm(e,3*f+2,3*p+2)}p-n<a-p?(Qy(t,e,n,p),n=p+1):(Qy(t,e,p+1,a),a=p)}}function Gm(t,e,n){const a=t[e];t[e]=t[n],t[n]=a}ri(Lf,"FeaturePositionMap");class $l{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class Hm extends $l{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class Jo extends $l{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Ju extends $l{constructor(e){super(e),this.current=[0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class e0 extends $l{constructor(e){super(e),this.current=[0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class y1 extends $l{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class v1 extends $l{constructor(e){super(e),this.current=Bn.transparent}set(e,n,a){this.fetchUniformLocation(e,n)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const rD=new Float32Array(16);class Of extends $l{constructor(e){super(e),this.current=rD}set(e,n,a){if(this.fetchUniformLocation(e,n)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let u=1;u<16;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}const oD=new Float32Array(9),sD=new Float32Array(4);class t0 extends $l{constructor(e){super(e),this.current=sD}set(e,n,a){if(this.fetchUniformLocation(e,n)){for(let u=0;u<4;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function i0(t){return[f1(255*t.r,255*t.g),f1(255*t.b,255*t.a)]}class Rf{constructor(e,n,a){this.value=e,this.uniformNames=n.map(u=>`u_${u}`),this.type=a}setUniform(e,n,a,u,f){n.set(e,f,u.constantOr(this.value))}getBinding(e,n){return this.type==="color"?new v1(e):new Jo(e)}}class sd{constructor(e,n){this.uniformNames=n.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,a,u,f){const p=f==="u_pattern"||f==="u_dash"?this.pattern:f==="u_pixel_ratio"?this.pixelRatio:null;p&&n.set(e,f,p)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new y1(e):new Jo(e)}}class Ql{constructor(e,n,a,u){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map(f=>({name:`a_${f}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,n,a,u,f,p,y){const b=this.paintVertexArray.length,T=this.expression.evaluate(new xe(0,{brightness:p}),n,{},f,u,y);this.paintVertexArray.resize(e),this._setPaintValue(b,e,T)}updatePaintArray(e,n,a,u,f,p,y){const b=this.expression.evaluate({zoom:0,brightness:y},a,u,void 0,f);this._setPaintValue(e,n,b)}_setPaintValue(e,n,a){if(this.type==="color"){const u=i0(a);for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ra{constructor(e,n,a,u,f,p){this.expression=e,this.uniformNames=n.map(y=>`u_${y}_t`),this.type=a,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=n.map(y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,n,a,u,f,p,y){const b=this.expression.evaluate(new xe(this.zoom,{brightness:p}),n,{},f,u,y),T=this.expression.evaluate(new xe(this.zoom+1,{brightness:p}),n,{},f,u,y),E=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(E,e,b,T)}updatePaintArray(e,n,a,u,f,p,y){const b=this.expression.evaluate({zoom:this.zoom,brightness:y},a,u,void 0,f),T=this.expression.evaluate({zoom:this.zoom+1,brightness:y},a,u,void 0,f);this._setPaintValue(e,n,b,T)}_setPaintValue(e,n,a,u){if(this.type==="color"){const f=i0(a),p=i0(u);for(let y=e;y<n;y++)this.paintVertexArray.emplace(y,f[0],f[1],p[0],p[1])}else{for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,a,u,f){const p=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,y=rt(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);n.set(e,f,y)}getBinding(e,n){return new Jo(e)}}class Nc{constructor(e,n,a,u,f){this.expression=e,this.layerId=f,this.paintVertexAttributes=(a==="array"?tD:eD).members;for(let p=0;p<n.length;++p);this.paintVertexArray=new u}populatePaintArray(e,n,a){const u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,n.patterns&&n.patterns[this.layerId],a)}updatePaintArray(e,n,a,u,f,p,y){this._setPaintValues(e,n,a.patterns&&a.patterns[this.layerId],p)}_setPaintValues(e,n,a,u){if(!u||!a)return;const f=u[a];if(!f)return;const{tl:p,br:y,pixelRatio:b}=f;for(let T=e;T<n;T++)this.paintVertexArray.emplace(T,p[0],p[1],y[0],y[1],b)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ku{constructor(e,n,a=()=>!0){this.binders={},this._buffers=[];const u=[];for(const f in e.paint._values){const p=e.paint.get(f);if(!a(f)||!(p instanceof Ke&&ol(p.property.specification)))continue;const y=lD(f,e.type),b=p.value,T=p.property.specification.type,E=!!p.property.useIntegerZoom,I=f==="line-dasharray"||f.endsWith("pattern"),k=f==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(b.kind!=="constant"||k)if(b.kind==="source"||k||I){const O=x1(f,T,"source");this.binders[f]=I?new Nc(b,y,T,O,e.id):new Ql(b,y,T,O),u.push(`/a_${f}`)}else{const O=x1(f,T,"composite");this.binders[f]=new Ra(b,y,T,E,n,O),u.push(`/z_${f}`)}else this.binders[f]=I?new sd(b.value,y):new Rf(b.value,y,T),u.push(`/u_${f}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof Ql||n instanceof Ra?n.maxValue:0}populatePaintArrays(e,n,a,u,f,p,y){for(const b in this.binders){const T=this.binders[b];(T instanceof Ql||T instanceof Ra||T instanceof Nc)&&T.populatePaintArray(e,n,a,u,f,p,y)}}setConstantPatternPositions(e){for(const n in this.binders){const a=this.binders[n];a instanceof sd&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,n,a,u,f,p,y,b){let T=!1;const E=Object.keys(e),I=E.length!==0,k=I?E:n.uniqueIds;for(const O in this.binders){const z=this.binders[O];if((z instanceof Ql||z instanceof Ra||z instanceof Nc)&&(z.expression.isStateDependent===!0||z.expression.isLightConstant===!1)){const N=f.paint.get(O);z.expression=N.value;for(const j of k){const W=e[j.toString()];n.eachPosition(j,(ie,re,se)=>{const de=u.feature(ie);z.updatePaintArray(re,se,de,W,p,y,b)})}if(!I)for(const j of a.uniqueIds){const W=e[j.toString()];a.eachPosition(j,(ie,re,se)=>{const de=u.feature(ie);z.updatePaintArray(re,se,de,W,p,y,b)})}T=!0}}return T}defines(){const e=[];for(const n in this.binders){const a=this.binders[n];(a instanceof Rf||a instanceof sd)&&e.push(...a.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof Ql||a instanceof Ra||a instanceof Nc)for(let u=0;u<a.paintVertexAttributes.length;u++)e.push(a.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof Rf||a instanceof sd||a instanceof Ra)for(const u of a.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof Rf||u instanceof sd||u instanceof Ra)for(const f of u.uniformNames)n.push({name:f,property:a,binding:u.getBinding(e,f)})}return n}setUniforms(e,n,a,u,f){for(const{name:p,property:y,binding:b}of a)this.binders[y].setUniform(e,b,f,u.get(y),p)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof Ql||n instanceof Ra||n instanceof Nc)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const n in this.binders){const a=this.binders[n];(a instanceof Ql||a instanceof Ra||a instanceof Nc)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof Ql||n instanceof Ra||n instanceof Nc)&&n.destroy()}}}class Vc{constructor(e,n,a=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Ku(u,n,a);this.needsUpload=!1,this._featureMap=new Lf,this._featureMapWithoutIds=new Lf,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,a,u,f,p,y,b){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(e,n,u,f,p,y,b);n.id!==void 0?this._featureMap.add(n.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,a,u,f,p){for(const y of a)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,y,u,f,p||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const aD={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function lD(t,e){return aD[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const cD={"line-pattern":{source:hn,composite:hn},"fill-pattern":{source:hn,composite:hn},"fill-extrusion-pattern":{source:hn,composite:hn},"line-dasharray":{source:_n,composite:_n}},uD={color:{source:Df,composite:Mn},number:{source:Oa,composite:Df}};function x1(t,e,n){const a=cD[t];return a&&a[n]||uD[e][n]}ri(Rf,"ConstantBinder"),ri(sd,"PatternConstantBinder"),ri(Ql,"SourceExpressionBinder"),ri(Nc,"PatternCompositeBinder"),ri(Ra,"CompositeExpressionBinder"),ri(Ku,"ProgramConfiguration",{omit:["_buffers"]}),ri(Vc,"ProgramConfigurationSet");class Uc{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof En?new En(e.lng,e.lat):En.convert(e),this}setSouthWest(e){return this._sw=e instanceof En?new En(e.lng,e.lat):En.convert(e),this}extend(e){const n=this._sw,a=this._ne;let u,f;if(e instanceof En)u=e,f=e;else{if(!(e instanceof Uc))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Uc.convert(e)):this.extend(En.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(En.convert(e)):this;if(u=e._sw,f=e._ne,!u||!f)return this}return n||a?(n.lng=Math.min(u.lng,n.lng),n.lat=Math.min(u.lat,n.lat),a.lng=Math.max(f.lng,a.lng),a.lat=Math.max(f.lat,a.lat)):(this._sw=new En(u.lng,u.lat),this._ne=new En(f.lng,f.lat)),this}getCenter(){return new En((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new En(this.getWest(),this.getNorth())}getSouthEast(){return new En(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:a}=En.convert(e);let u=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u}static convert(e){return!e||e instanceof Uc?e:new Uc(e)}}var to={},io={};Object.defineProperty(io,"__esModule",{value:!0}),io.setMatrixArrayType=function(t){io.ARRAY_TYPE=w1=t},io.toRadian=function(t){return t*dD},io.equals=function(t,e){return Math.abs(t-e)<=b1*Math.max(1,Math.abs(t),Math.abs(e))},io.RANDOM=io.ARRAY_TYPE=io.EPSILON=void 0;var b1=1e-6;io.EPSILON=b1;var w1=typeof Float32Array<"u"?Float32Array:Array;io.ARRAY_TYPE=w1;var hD=Math.random;io.RANDOM=hD;var dD=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var ur={};function n0(t){return n0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n0(t)}Object.defineProperty(ur,"__esModule",{value:!0}),ur.create=function(){var t=new jc.ARRAY_TYPE(4);return jc.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},ur.clone=function(t){var e=new jc.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},ur.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},ur.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},ur.fromValues=function(t,e,n,a){var u=new jc.ARRAY_TYPE(4);return u[0]=t,u[1]=e,u[2]=n,u[3]=a,u},ur.set=function(t,e,n,a,u){return t[0]=e,t[1]=n,t[2]=a,t[3]=u,t},ur.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},ur.invert=function(t,e){var n=e[0],a=e[1],u=e[2],f=e[3],p=n*f-u*a;return p?(t[0]=f*(p=1/p),t[1]=-a*p,t[2]=-u*p,t[3]=n*p,t):null},ur.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},ur.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},ur.multiply=S1,ur.rotate=function(t,e,n){var a=e[0],u=e[1],f=e[2],p=e[3],y=Math.sin(n),b=Math.cos(n);return t[0]=a*b+f*y,t[1]=u*b+p*y,t[2]=a*-y+f*b,t[3]=u*-y+p*b,t},ur.scale=function(t,e,n){var a=e[1],u=e[2],f=e[3],p=n[0],y=n[1];return t[0]=e[0]*p,t[1]=a*p,t[2]=u*y,t[3]=f*y,t},ur.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=-n,t[3]=a,t},ur.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},ur.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},ur.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},ur.LDU=function(t,e,n,a){return t[2]=a[2]/a[0],n[0]=a[0],n[1]=a[1],n[3]=a[3]-t[2]*n[1],[t,e,n]},ur.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},ur.subtract=M1,ur.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},ur.equals=function(t,e){var n=t[0],a=t[1],u=t[2],f=t[3],p=e[0],y=e[1],b=e[2],T=e[3];return Math.abs(n-p)<=jc.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-y)<=jc.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(u-b)<=jc.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(f-T)<=jc.EPSILON*Math.max(1,Math.abs(f),Math.abs(T))},ur.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},ur.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t},ur.sub=ur.mul=void 0;var jc=function(t,e){if(t&&t.__esModule)return t;if(t===null||n0(t)!=="object"&&typeof t!="function")return{default:t};var n=T1(void 0);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in t)if(f!=="default"&&Object.prototype.hasOwnProperty.call(t,f)){var p=u?Object.getOwnPropertyDescriptor(t,f):null;p&&(p.get||p.set)?Object.defineProperty(a,f,p):a[f]=t[f]}return a.default=t,n&&n.set(t,a),a}(io);function T1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(T1=function(a){return a?n:e})(t)}function S1(t,e,n){var a=e[0],u=e[1],f=e[2],p=e[3],y=n[0],b=n[1],T=n[2],E=n[3];return t[0]=a*y+f*b,t[1]=u*y+p*b,t[2]=a*T+f*E,t[3]=u*T+p*E,t}function M1(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}ur.mul=S1,ur.sub=M1;var mr={};function r0(t){return r0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r0(t)}Object.defineProperty(mr,"__esModule",{value:!0}),mr.create=function(){var t=new cl.ARRAY_TYPE(6);return cl.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},mr.clone=function(t){var e=new cl.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},mr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},mr.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},mr.fromValues=function(t,e,n,a,u,f){var p=new cl.ARRAY_TYPE(6);return p[0]=t,p[1]=e,p[2]=n,p[3]=a,p[4]=u,p[5]=f,p},mr.set=function(t,e,n,a,u,f,p){return t[0]=e,t[1]=n,t[2]=a,t[3]=u,t[4]=f,t[5]=p,t},mr.invert=function(t,e){var n=e[0],a=e[1],u=e[2],f=e[3],p=e[4],y=e[5],b=n*f-a*u;return b?(t[0]=f*(b=1/b),t[1]=-a*b,t[2]=-u*b,t[3]=n*b,t[4]=(u*y-f*p)*b,t[5]=(a*p-n*y)*b,t):null},mr.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},mr.multiply=A1,mr.rotate=function(t,e,n){var a=e[0],u=e[1],f=e[2],p=e[3],y=e[4],b=e[5],T=Math.sin(n),E=Math.cos(n);return t[0]=a*E+f*T,t[1]=u*E+p*T,t[2]=a*-T+f*E,t[3]=u*-T+p*E,t[4]=y,t[5]=b,t},mr.scale=function(t,e,n){var a=e[1],u=e[2],f=e[3],p=e[4],y=e[5],b=n[0],T=n[1];return t[0]=e[0]*b,t[1]=a*b,t[2]=u*T,t[3]=f*T,t[4]=p,t[5]=y,t},mr.translate=function(t,e,n){var a=e[0],u=e[1],f=e[2],p=e[3],y=e[4],b=e[5],T=n[0],E=n[1];return t[0]=a,t[1]=u,t[2]=f,t[3]=p,t[4]=a*T+f*E+y,t[5]=u*T+p*E+b,t},mr.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=-n,t[3]=a,t[4]=0,t[5]=0,t},mr.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},mr.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},mr.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},mr.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},mr.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},mr.subtract=I1,mr.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},mr.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t},mr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},mr.equals=function(t,e){var n=t[0],a=t[1],u=t[2],f=t[3],p=t[4],y=t[5],b=e[0],T=e[1],E=e[2],I=e[3],k=e[4],O=e[5];return Math.abs(n-b)<=cl.EPSILON*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(a-T)<=cl.EPSILON*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(u-E)<=cl.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(f-I)<=cl.EPSILON*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(p-k)<=cl.EPSILON*Math.max(1,Math.abs(p),Math.abs(k))&&Math.abs(y-O)<=cl.EPSILON*Math.max(1,Math.abs(y),Math.abs(O))},mr.sub=mr.mul=void 0;var cl=function(t,e){if(t&&t.__esModule)return t;if(t===null||r0(t)!=="object"&&typeof t!="function")return{default:t};var n=E1(void 0);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in t)if(f!=="default"&&Object.prototype.hasOwnProperty.call(t,f)){var p=u?Object.getOwnPropertyDescriptor(t,f):null;p&&(p.get||p.set)?Object.defineProperty(a,f,p):a[f]=t[f]}return a.default=t,n&&n.set(t,a),a}(io);function E1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(E1=function(a){return a?n:e})(t)}function A1(t,e,n){var a=e[0],u=e[1],f=e[2],p=e[3],y=e[4],b=e[5],T=n[0],E=n[1],I=n[2],k=n[3],O=n[4],z=n[5];return t[0]=a*T+f*E,t[1]=u*T+p*E,t[2]=a*I+f*k,t[3]=u*I+p*k,t[4]=a*O+f*z+y,t[5]=u*O+p*z+b,t}function I1(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}mr.mul=A1,mr.sub=I1;var Dn={};function o0(t){return o0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o0(t)}Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.create=function(){var t=new Zs.ARRAY_TYPE(9);return Zs.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},Dn.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},Dn.clone=function(t){var e=new Zs.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Dn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Dn.fromValues=function(t,e,n,a,u,f,p,y,b){var T=new Zs.ARRAY_TYPE(9);return T[0]=t,T[1]=e,T[2]=n,T[3]=a,T[4]=u,T[5]=f,T[6]=p,T[7]=y,T[8]=b,T},Dn.set=function(t,e,n,a,u,f,p,y,b,T){return t[0]=e,t[1]=n,t[2]=a,t[3]=u,t[4]=f,t[5]=p,t[6]=y,t[7]=b,t[8]=T,t},Dn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Dn.transpose=function(t,e){if(t===e){var n=e[1],a=e[2],u=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=a,t[7]=u}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},Dn.invert=function(t,e){var n=e[0],a=e[1],u=e[2],f=e[3],p=e[4],y=e[5],b=e[6],T=e[7],E=e[8],I=E*p-y*T,k=-E*f+y*b,O=T*f-p*b,z=n*I+a*k+u*O;return z?(t[0]=I*(z=1/z),t[1]=(-E*a+u*T)*z,t[2]=(y*a-u*p)*z,t[3]=k*z,t[4]=(E*n-u*b)*z,t[5]=(-y*n+u*f)*z,t[6]=O*z,t[7]=(-T*n+a*b)*z,t[8]=(p*n-a*f)*z,t):null},Dn.adjoint=function(t,e){var n=e[0],a=e[1],u=e[2],f=e[3],p=e[4],y=e[5],b=e[6],T=e[7],E=e[8];return t[0]=p*E-y*T,t[1]=u*T-a*E,t[2]=a*y-u*p,t[3]=y*b-f*E,t[4]=n*E-u*b,t[5]=u*f-n*y,t[6]=f*T-p*b,t[7]=a*b-n*T,t[8]=n*p-a*f,t},Dn.determinant=function(t){var e=t[3],n=t[4],a=t[5],u=t[6],f=t[7],p=t[8];return t[0]*(p*n-a*f)+t[1]*(-p*e+a*u)+t[2]*(f*e-n*u)},Dn.multiply=P1,Dn.translate=function(t,e,n){var a=e[0],u=e[1],f=e[2],p=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=e[8],k=n[0],O=n[1];return t[0]=a,t[1]=u,t[2]=f,t[3]=p,t[4]=y,t[5]=b,t[6]=k*a+O*p+T,t[7]=k*u+O*y+E,t[8]=k*f+O*b+I,t},Dn.rotate=function(t,e,n){var a=e[0],u=e[1],f=e[2],p=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=e[8],k=Math.sin(n),O=Math.cos(n);return t[0]=O*a+k*p,t[1]=O*u+k*y,t[2]=O*f+k*b,t[3]=O*p-k*a,t[4]=O*y-k*u,t[5]=O*b-k*f,t[6]=T,t[7]=E,t[8]=I,t},Dn.scale=function(t,e,n){var a=n[0],u=n[1];return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=u*e[3],t[4]=u*e[4],t[5]=u*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Dn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},Dn.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=0,t[3]=-n,t[4]=a,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Dn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Dn.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},Dn.fromQuat=function(t,e){var n=e[0],a=e[1],u=e[2],f=e[3],p=n+n,y=a+a,b=u+u,T=n*p,E=a*p,I=a*y,k=u*p,O=u*y,z=u*b,N=f*p,j=f*y,W=f*b;return t[0]=1-I-z,t[3]=E-W,t[6]=k+j,t[1]=E+W,t[4]=1-T-z,t[7]=O-N,t[2]=k-j,t[5]=O+N,t[8]=1-T-I,t},Dn.normalFromMat4=function(t,e){var n=e[0],a=e[1],u=e[2],f=e[3],p=e[4],y=e[5],b=e[6],T=e[7],E=e[8],I=e[9],k=e[10],O=e[11],z=e[12],N=e[13],j=e[14],W=e[15],ie=n*y-a*p,re=n*b-u*p,se=n*T-f*p,de=a*b-u*y,ge=a*T-f*y,Se=u*T-f*b,ke=E*N-I*z,Re=E*j-k*z,Ze=E*W-O*z,Be=I*j-k*N,ut=I*W-O*N,Pt=k*W-O*j,st=ie*Pt-re*ut+se*Be+de*Ze-ge*Re+Se*ke;return st?(t[0]=(y*Pt-b*ut+T*Be)*(st=1/st),t[1]=(b*Ze-p*Pt-T*Re)*st,t[2]=(p*ut-y*Ze+T*ke)*st,t[3]=(u*ut-a*Pt-f*Be)*st,t[4]=(n*Pt-u*Ze+f*Re)*st,t[5]=(a*Ze-n*ut-f*ke)*st,t[6]=(N*Se-j*ge+W*de)*st,t[7]=(j*se-z*Se-W*re)*st,t[8]=(z*ge-N*se+W*ie)*st,t):null},Dn.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},Dn.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},Dn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},Dn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},Dn.subtract=k1,Dn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},Dn.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t[6]=e[6]+n[6]*a,t[7]=e[7]+n[7]*a,t[8]=e[8]+n[8]*a,t},Dn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},Dn.equals=function(t,e){var n=t[0],a=t[1],u=t[2],f=t[3],p=t[4],y=t[5],b=t[6],T=t[7],E=t[8],I=e[0],k=e[1],O=e[2],z=e[3],N=e[4],j=e[5],W=e[6],ie=e[7],re=e[8];return Math.abs(n-I)<=Zs.EPSILON*Math.max(1,Math.abs(n),Math.abs(I))&&Math.abs(a-k)<=Zs.EPSILON*Math.max(1,Math.abs(a),Math.abs(k))&&Math.abs(u-O)<=Zs.EPSILON*Math.max(1,Math.abs(u),Math.abs(O))&&Math.abs(f-z)<=Zs.EPSILON*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(p-N)<=Zs.EPSILON*Math.max(1,Math.abs(p),Math.abs(N))&&Math.abs(y-j)<=Zs.EPSILON*Math.max(1,Math.abs(y),Math.abs(j))&&Math.abs(b-W)<=Zs.EPSILON*Math.max(1,Math.abs(b),Math.abs(W))&&Math.abs(T-ie)<=Zs.EPSILON*Math.max(1,Math.abs(T),Math.abs(ie))&&Math.abs(E-re)<=Zs.EPSILON*Math.max(1,Math.abs(E),Math.abs(re))},Dn.sub=Dn.mul=void 0;var Zs=function(t,e){if(t&&t.__esModule)return t;if(t===null||o0(t)!=="object"&&typeof t!="function")return{default:t};var n=C1(void 0);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in t)if(f!=="default"&&Object.prototype.hasOwnProperty.call(t,f)){var p=u?Object.getOwnPropertyDescriptor(t,f):null;p&&(p.get||p.set)?Object.defineProperty(a,f,p):a[f]=t[f]}return a.default=t,n&&n.set(t,a),a}(io);function C1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(C1=function(a){return a?n:e})(t)}function P1(t,e,n){var a=e[0],u=e[1],f=e[2],p=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=e[8],k=n[0],O=n[1],z=n[2],N=n[3],j=n[4],W=n[5],ie=n[6],re=n[7],se=n[8];return t[0]=k*a+O*p+z*T,t[1]=k*u+O*y+z*E,t[2]=k*f+O*b+z*I,t[3]=N*a+j*p+W*T,t[4]=N*u+j*y+W*E,t[5]=N*f+j*b+W*I,t[6]=ie*a+re*p+se*T,t[7]=ie*u+re*y+se*E,t[8]=ie*f+re*b+se*I,t}function k1(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}Dn.mul=P1,Dn.sub=k1;var Hi={};function s0(t){return s0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s0(t)}Object.defineProperty(Hi,"__esModule",{value:!0}),Hi.create=function(){var t=new Tr.ARRAY_TYPE(16);return Tr.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Hi.clone=function(t){var e=new Tr.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Hi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Hi.fromValues=function(t,e,n,a,u,f,p,y,b,T,E,I,k,O,z,N){var j=new Tr.ARRAY_TYPE(16);return j[0]=t,j[1]=e,j[2]=n,j[3]=a,j[4]=u,j[5]=f,j[6]=p,j[7]=y,j[8]=b,j[9]=T,j[10]=E,j[11]=I,j[12]=k,j[13]=O,j[14]=z,j[15]=N,j},Hi.set=function(t,e,n,a,u,f,p,y,b,T,E,I,k,O,z,N,j){return t[0]=e,t[1]=n,t[2]=a,t[3]=u,t[4]=f,t[5]=p,t[6]=y,t[7]=b,t[8]=T,t[9]=E,t[10]=I,t[11]=k,t[12]=O,t[13]=z,t[14]=N,t[15]=j,t},Hi.identity=L1,Hi.transpose=function(t,e){if(t===e){var n=e[1],a=e[2],u=e[3],f=e[6],p=e[7],y=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=a,t[9]=f,t[11]=e[14],t[12]=u,t[13]=p,t[14]=y}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Hi.invert=function(t,e){var n=e[0],a=e[1],u=e[2],f=e[3],p=e[4],y=e[5],b=e[6],T=e[7],E=e[8],I=e[9],k=e[10],O=e[11],z=e[12],N=e[13],j=e[14],W=e[15],ie=n*y-a*p,re=n*b-u*p,se=n*T-f*p,de=a*b-u*y,ge=a*T-f*y,Se=u*T-f*b,ke=E*N-I*z,Re=E*j-k*z,Ze=E*W-O*z,Be=I*j-k*N,ut=I*W-O*N,Pt=k*W-O*j,st=ie*Pt-re*ut+se*Be+de*Ze-ge*Re+Se*ke;return st?(t[0]=(y*Pt-b*ut+T*Be)*(st=1/st),t[1]=(u*ut-a*Pt-f*Be)*st,t[2]=(N*Se-j*ge+W*de)*st,t[3]=(k*ge-I*Se-O*de)*st,t[4]=(b*Ze-p*Pt-T*Re)*st,t[5]=(n*Pt-u*Ze+f*Re)*st,t[6]=(j*se-z*Se-W*re)*st,t[7]=(E*Se-k*se+O*re)*st,t[8]=(p*ut-y*Ze+T*ke)*st,t[9]=(a*Ze-n*ut-f*ke)*st,t[10]=(z*ge-N*se+W*ie)*st,t[11]=(I*se-E*ge-O*ie)*st,t[12]=(y*Re-p*Be-b*ke)*st,t[13]=(n*Be-a*Re+u*ke)*st,t[14]=(N*re-z*de-j*ie)*st,t[15]=(E*de-I*re+k*ie)*st,t):null},Hi.adjoint=function(t,e){var n=e[0],a=e[1],u=e[2],f=e[3],p=e[4],y=e[5],b=e[6],T=e[7],E=e[8],I=e[9],k=e[10],O=e[11],z=e[12],N=e[13],j=e[14],W=e[15];return t[0]=y*(k*W-O*j)-I*(b*W-T*j)+N*(b*O-T*k),t[1]=-(a*(k*W-O*j)-I*(u*W-f*j)+N*(u*O-f*k)),t[2]=a*(b*W-T*j)-y*(u*W-f*j)+N*(u*T-f*b),t[3]=-(a*(b*O-T*k)-y*(u*O-f*k)+I*(u*T-f*b)),t[4]=-(p*(k*W-O*j)-E*(b*W-T*j)+z*(b*O-T*k)),t[5]=n*(k*W-O*j)-E*(u*W-f*j)+z*(u*O-f*k),t[6]=-(n*(b*W-T*j)-p*(u*W-f*j)+z*(u*T-f*b)),t[7]=n*(b*O-T*k)-p*(u*O-f*k)+E*(u*T-f*b),t[8]=p*(I*W-O*N)-E*(y*W-T*N)+z*(y*O-T*I),t[9]=-(n*(I*W-O*N)-E*(a*W-f*N)+z*(a*O-f*I)),t[10]=n*(y*W-T*N)-p*(a*W-f*N)+z*(a*T-f*y),t[11]=-(n*(y*O-T*I)-p*(a*O-f*I)+E*(a*T-f*y)),t[12]=-(p*(I*j-k*N)-E*(y*j-b*N)+z*(y*k-b*I)),t[13]=n*(I*j-k*N)-E*(a*j-u*N)+z*(a*k-u*I),t[14]=-(n*(y*j-b*N)-p*(a*j-u*N)+z*(a*b-u*y)),t[15]=n*(y*k-b*I)-p*(a*k-u*I)+E*(a*b-u*y),t},Hi.determinant=function(t){var e=t[0],n=t[1],a=t[2],u=t[3],f=t[4],p=t[5],y=t[6],b=t[7],T=t[8],E=t[9],I=t[10],k=t[11],O=t[12],z=t[13],N=t[14],j=t[15];return(e*p-n*f)*(I*j-k*N)-(e*y-a*f)*(E*j-k*z)+(e*b-u*f)*(E*N-I*z)+(n*y-a*p)*(T*j-k*O)-(n*b-u*p)*(T*N-I*O)+(a*b-u*y)*(T*z-E*O)},Hi.multiply=O1,Hi.translate=function(t,e,n){var a,u,f,p,y,b,T,E,I,k,O,z,N=n[0],j=n[1],W=n[2];return e===t?(t[12]=e[0]*N+e[4]*j+e[8]*W+e[12],t[13]=e[1]*N+e[5]*j+e[9]*W+e[13],t[14]=e[2]*N+e[6]*j+e[10]*W+e[14],t[15]=e[3]*N+e[7]*j+e[11]*W+e[15]):(u=e[1],f=e[2],p=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=e[8],k=e[9],O=e[10],z=e[11],t[0]=a=e[0],t[1]=u,t[2]=f,t[3]=p,t[4]=y,t[5]=b,t[6]=T,t[7]=E,t[8]=I,t[9]=k,t[10]=O,t[11]=z,t[12]=a*N+y*j+I*W+e[12],t[13]=u*N+b*j+k*W+e[13],t[14]=f*N+T*j+O*W+e[14],t[15]=p*N+E*j+z*W+e[15]),t},Hi.scale=function(t,e,n){var a=n[0],u=n[1],f=n[2];return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*u,t[5]=e[5]*u,t[6]=e[6]*u,t[7]=e[7]*u,t[8]=e[8]*f,t[9]=e[9]*f,t[10]=e[10]*f,t[11]=e[11]*f,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Hi.rotate=function(t,e,n,a){var u,f,p,y,b,T,E,I,k,O,z,N,j,W,ie,re,se,de,ge,Se,ke,Re,Ze,Be,ut=a[0],Pt=a[1],st=a[2],St=Math.hypot(ut,Pt,st);return St<Tr.EPSILON?null:(ut*=St=1/St,Pt*=St,st*=St,u=Math.sin(n),f=Math.cos(n),b=e[1],T=e[2],E=e[3],k=e[5],O=e[6],z=e[7],j=e[9],W=e[10],ie=e[11],ge=ut*Pt*(p=1-f)-st*u,Se=Pt*Pt*p+f,ke=st*Pt*p+ut*u,Re=ut*st*p+Pt*u,Ze=Pt*st*p-ut*u,Be=st*st*p+f,t[0]=(y=e[0])*(re=ut*ut*p+f)+(I=e[4])*(se=Pt*ut*p+st*u)+(N=e[8])*(de=st*ut*p-Pt*u),t[1]=b*re+k*se+j*de,t[2]=T*re+O*se+W*de,t[3]=E*re+z*se+ie*de,t[4]=y*ge+I*Se+N*ke,t[5]=b*ge+k*Se+j*ke,t[6]=T*ge+O*Se+W*ke,t[7]=E*ge+z*Se+ie*ke,t[8]=y*Re+I*Ze+N*Be,t[9]=b*Re+k*Ze+j*Be,t[10]=T*Re+O*Ze+W*Be,t[11]=E*Re+z*Ze+ie*Be,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Hi.rotateX=function(t,e,n){var a=Math.sin(n),u=Math.cos(n),f=e[4],p=e[5],y=e[6],b=e[7],T=e[8],E=e[9],I=e[10],k=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=f*u+T*a,t[5]=p*u+E*a,t[6]=y*u+I*a,t[7]=b*u+k*a,t[8]=T*u-f*a,t[9]=E*u-p*a,t[10]=I*u-y*a,t[11]=k*u-b*a,t},Hi.rotateY=function(t,e,n){var a=Math.sin(n),u=Math.cos(n),f=e[0],p=e[1],y=e[2],b=e[3],T=e[8],E=e[9],I=e[10],k=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=f*u-T*a,t[1]=p*u-E*a,t[2]=y*u-I*a,t[3]=b*u-k*a,t[8]=f*a+T*u,t[9]=p*a+E*u,t[10]=y*a+I*u,t[11]=b*a+k*u,t},Hi.rotateZ=function(t,e,n){var a=Math.sin(n),u=Math.cos(n),f=e[0],p=e[1],y=e[2],b=e[3],T=e[4],E=e[5],I=e[6],k=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=f*u+T*a,t[1]=p*u+E*a,t[2]=y*u+I*a,t[3]=b*u+k*a,t[4]=T*u-f*a,t[5]=E*u-p*a,t[6]=I*u-y*a,t[7]=k*u-b*a,t},Hi.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Hi.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Hi.fromRotation=function(t,e,n){var a,u,f,p=n[0],y=n[1],b=n[2],T=Math.hypot(p,y,b);return T<Tr.EPSILON?null:(p*=T=1/T,y*=T,b*=T,a=Math.sin(e),u=Math.cos(e),t[0]=p*p*(f=1-u)+u,t[1]=y*p*f+b*a,t[2]=b*p*f-y*a,t[3]=0,t[4]=p*y*f-b*a,t[5]=y*y*f+u,t[6]=b*y*f+p*a,t[7]=0,t[8]=p*b*f+y*a,t[9]=y*b*f-p*a,t[10]=b*b*f+u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Hi.fromXRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Hi.fromYRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Hi.fromZRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Hi.fromRotationTranslation=R1,Hi.fromQuat2=function(t,e){var n=new Tr.ARRAY_TYPE(3),a=-e[0],u=-e[1],f=-e[2],p=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=a*a+u*u+f*f+p*p;return I>0?(n[0]=2*(y*p+E*a+b*f-T*u)/I,n[1]=2*(b*p+E*u+T*a-y*f)/I,n[2]=2*(T*p+E*f+y*u-b*a)/I):(n[0]=2*(y*p+E*a+b*f-T*u),n[1]=2*(b*p+E*u+T*a-y*f),n[2]=2*(T*p+E*f+y*u-b*a)),R1(t,e,n),t},Hi.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Hi.getScaling=z1,Hi.getRotation=function(t,e){var n=new Tr.ARRAY_TYPE(3);z1(n,e);var a=1/n[0],u=1/n[1],f=1/n[2],p=e[0]*a,y=e[1]*u,b=e[2]*f,T=e[4]*a,E=e[5]*u,I=e[6]*f,k=e[8]*a,O=e[9]*u,z=e[10]*f,N=p+E+z,j=0;return N>0?(j=2*Math.sqrt(N+1),t[3]=.25*j,t[0]=(I-O)/j,t[1]=(k-b)/j,t[2]=(y-T)/j):p>E&&p>z?(j=2*Math.sqrt(1+p-E-z),t[3]=(I-O)/j,t[0]=.25*j,t[1]=(y+T)/j,t[2]=(k+b)/j):E>z?(j=2*Math.sqrt(1+E-p-z),t[3]=(k-b)/j,t[0]=(y+T)/j,t[1]=.25*j,t[2]=(I+O)/j):(j=2*Math.sqrt(1+z-p-E),t[3]=(y-T)/j,t[0]=(k+b)/j,t[1]=(I+O)/j,t[2]=.25*j),t},Hi.fromRotationTranslationScale=function(t,e,n,a){var u=e[0],f=e[1],p=e[2],y=e[3],b=u+u,T=f+f,E=p+p,I=u*b,k=u*T,O=u*E,z=f*T,N=f*E,j=p*E,W=y*b,ie=y*T,re=y*E,se=a[0],de=a[1],ge=a[2];return t[0]=(1-(z+j))*se,t[1]=(k+re)*se,t[2]=(O-ie)*se,t[3]=0,t[4]=(k-re)*de,t[5]=(1-(I+j))*de,t[6]=(N+W)*de,t[7]=0,t[8]=(O+ie)*ge,t[9]=(N-W)*ge,t[10]=(1-(I+z))*ge,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},Hi.fromRotationTranslationScaleOrigin=function(t,e,n,a,u){var f=e[0],p=e[1],y=e[2],b=e[3],T=f+f,E=p+p,I=y+y,k=f*T,O=f*E,z=f*I,N=p*E,j=p*I,W=y*I,ie=b*T,re=b*E,se=b*I,de=a[0],ge=a[1],Se=a[2],ke=u[0],Re=u[1],Ze=u[2],Be=(1-(N+W))*de,ut=(O+se)*de,Pt=(z-re)*de,st=(O-se)*ge,St=(1-(k+W))*ge,ot=(j+ie)*ge,qt=(z+re)*Se,ii=(j-ie)*Se,It=(1-(k+N))*Se;return t[0]=Be,t[1]=ut,t[2]=Pt,t[3]=0,t[4]=st,t[5]=St,t[6]=ot,t[7]=0,t[8]=qt,t[9]=ii,t[10]=It,t[11]=0,t[12]=n[0]+ke-(Be*ke+st*Re+qt*Ze),t[13]=n[1]+Re-(ut*ke+St*Re+ii*Ze),t[14]=n[2]+Ze-(Pt*ke+ot*Re+It*Ze),t[15]=1,t},Hi.fromQuat=function(t,e){var n=e[0],a=e[1],u=e[2],f=e[3],p=n+n,y=a+a,b=u+u,T=n*p,E=a*p,I=a*y,k=u*p,O=u*y,z=u*b,N=f*p,j=f*y,W=f*b;return t[0]=1-I-z,t[1]=E+W,t[2]=k-j,t[3]=0,t[4]=E-W,t[5]=1-T-z,t[6]=O+N,t[7]=0,t[8]=k+j,t[9]=O-N,t[10]=1-T-I,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Hi.frustum=function(t,e,n,a,u,f,p){var y=1/(n-e),b=1/(u-a),T=1/(f-p);return t[0]=2*f*y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*f*b,t[6]=0,t[7]=0,t[8]=(n+e)*y,t[9]=(u+a)*b,t[10]=(p+f)*T,t[11]=-1,t[12]=0,t[13]=0,t[14]=p*f*2*T,t[15]=0,t},Hi.perspectiveNO=F1,Hi.perspectiveZO=function(t,e,n,a,u){var f,p=1/Math.tan(e/2);return t[0]=p/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,u!=null&&u!==1/0?(t[10]=u*(f=1/(a-u)),t[14]=u*a*f):(t[10]=-1,t[14]=-a),t},Hi.perspectiveFromFieldOfView=function(t,e,n,a){var u=Math.tan(e.upDegrees*Math.PI/180),f=Math.tan(e.downDegrees*Math.PI/180),p=Math.tan(e.leftDegrees*Math.PI/180),y=Math.tan(e.rightDegrees*Math.PI/180),b=2/(p+y),T=2/(u+f);return t[0]=b,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=T,t[6]=0,t[7]=0,t[8]=-(p-y)*b*.5,t[9]=(u-f)*T*.5,t[10]=a/(n-a),t[11]=-1,t[12]=0,t[13]=0,t[14]=a*n/(n-a),t[15]=0,t},Hi.orthoNO=B1,Hi.orthoZO=function(t,e,n,a,u,f,p){var y=1/(e-n),b=1/(a-u),T=1/(f-p);return t[0]=-2*y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*b,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=T,t[11]=0,t[12]=(e+n)*y,t[13]=(u+a)*b,t[14]=f*T,t[15]=1,t},Hi.lookAt=function(t,e,n,a){var u,f,p,y,b,T,E,I,k,O,z=e[0],N=e[1],j=e[2],W=a[0],ie=a[1],re=a[2],se=n[0],de=n[1],ge=n[2];return Math.abs(z-se)<Tr.EPSILON&&Math.abs(N-de)<Tr.EPSILON&&Math.abs(j-ge)<Tr.EPSILON?L1(t):(E=z-se,I=N-de,k=j-ge,u=ie*(k*=O=1/Math.hypot(E,I,k))-re*(I*=O),f=re*(E*=O)-W*k,p=W*I-ie*E,(O=Math.hypot(u,f,p))?(u*=O=1/O,f*=O,p*=O):(u=0,f=0,p=0),y=I*p-k*f,b=k*u-E*p,T=E*f-I*u,(O=Math.hypot(y,b,T))?(y*=O=1/O,b*=O,T*=O):(y=0,b=0,T=0),t[0]=u,t[1]=y,t[2]=E,t[3]=0,t[4]=f,t[5]=b,t[6]=I,t[7]=0,t[8]=p,t[9]=T,t[10]=k,t[11]=0,t[12]=-(u*z+f*N+p*j),t[13]=-(y*z+b*N+T*j),t[14]=-(E*z+I*N+k*j),t[15]=1,t)},Hi.targetTo=function(t,e,n,a){var u=e[0],f=e[1],p=e[2],y=a[0],b=a[1],T=a[2],E=u-n[0],I=f-n[1],k=p-n[2],O=E*E+I*I+k*k;O>0&&(E*=O=1/Math.sqrt(O),I*=O,k*=O);var z=b*k-T*I,N=T*E-y*k,j=y*I-b*E;return(O=z*z+N*N+j*j)>0&&(z*=O=1/Math.sqrt(O),N*=O,j*=O),t[0]=z,t[1]=N,t[2]=j,t[3]=0,t[4]=I*j-k*N,t[5]=k*z-E*j,t[6]=E*N-I*z,t[7]=0,t[8]=E,t[9]=I,t[10]=k,t[11]=0,t[12]=u,t[13]=f,t[14]=p,t[15]=1,t},Hi.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Hi.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Hi.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},Hi.subtract=N1,Hi.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},Hi.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t[6]=e[6]+n[6]*a,t[7]=e[7]+n[7]*a,t[8]=e[8]+n[8]*a,t[9]=e[9]+n[9]*a,t[10]=e[10]+n[10]*a,t[11]=e[11]+n[11]*a,t[12]=e[12]+n[12]*a,t[13]=e[13]+n[13]*a,t[14]=e[14]+n[14]*a,t[15]=e[15]+n[15]*a,t},Hi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Hi.equals=function(t,e){var n=t[0],a=t[1],u=t[2],f=t[3],p=t[4],y=t[5],b=t[6],T=t[7],E=t[8],I=t[9],k=t[10],O=t[11],z=t[12],N=t[13],j=t[14],W=t[15],ie=e[0],re=e[1],se=e[2],de=e[3],ge=e[4],Se=e[5],ke=e[6],Re=e[7],Ze=e[8],Be=e[9],ut=e[10],Pt=e[11],st=e[12],St=e[13],ot=e[14],qt=e[15];return Math.abs(n-ie)<=Tr.EPSILON*Math.max(1,Math.abs(n),Math.abs(ie))&&Math.abs(a-re)<=Tr.EPSILON*Math.max(1,Math.abs(a),Math.abs(re))&&Math.abs(u-se)<=Tr.EPSILON*Math.max(1,Math.abs(u),Math.abs(se))&&Math.abs(f-de)<=Tr.EPSILON*Math.max(1,Math.abs(f),Math.abs(de))&&Math.abs(p-ge)<=Tr.EPSILON*Math.max(1,Math.abs(p),Math.abs(ge))&&Math.abs(y-Se)<=Tr.EPSILON*Math.max(1,Math.abs(y),Math.abs(Se))&&Math.abs(b-ke)<=Tr.EPSILON*Math.max(1,Math.abs(b),Math.abs(ke))&&Math.abs(T-Re)<=Tr.EPSILON*Math.max(1,Math.abs(T),Math.abs(Re))&&Math.abs(E-Ze)<=Tr.EPSILON*Math.max(1,Math.abs(E),Math.abs(Ze))&&Math.abs(I-Be)<=Tr.EPSILON*Math.max(1,Math.abs(I),Math.abs(Be))&&Math.abs(k-ut)<=Tr.EPSILON*Math.max(1,Math.abs(k),Math.abs(ut))&&Math.abs(O-Pt)<=Tr.EPSILON*Math.max(1,Math.abs(O),Math.abs(Pt))&&Math.abs(z-st)<=Tr.EPSILON*Math.max(1,Math.abs(z),Math.abs(st))&&Math.abs(N-St)<=Tr.EPSILON*Math.max(1,Math.abs(N),Math.abs(St))&&Math.abs(j-ot)<=Tr.EPSILON*Math.max(1,Math.abs(j),Math.abs(ot))&&Math.abs(W-qt)<=Tr.EPSILON*Math.max(1,Math.abs(W),Math.abs(qt))},Hi.sub=Hi.mul=Hi.ortho=Hi.perspective=void 0;var Tr=function(t,e){if(t&&t.__esModule)return t;if(t===null||s0(t)!=="object"&&typeof t!="function")return{default:t};var n=D1(void 0);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in t)if(f!=="default"&&Object.prototype.hasOwnProperty.call(t,f)){var p=u?Object.getOwnPropertyDescriptor(t,f):null;p&&(p.get||p.set)?Object.defineProperty(a,f,p):a[f]=t[f]}return a.default=t,n&&n.set(t,a),a}(io);function D1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(D1=function(a){return a?n:e})(t)}function L1(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function O1(t,e,n){var a=e[0],u=e[1],f=e[2],p=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=e[8],k=e[9],O=e[10],z=e[11],N=e[12],j=e[13],W=e[14],ie=e[15],re=n[0],se=n[1],de=n[2],ge=n[3];return t[0]=re*a+se*y+de*I+ge*N,t[1]=re*u+se*b+de*k+ge*j,t[2]=re*f+se*T+de*O+ge*W,t[3]=re*p+se*E+de*z+ge*ie,t[4]=(re=n[4])*a+(se=n[5])*y+(de=n[6])*I+(ge=n[7])*N,t[5]=re*u+se*b+de*k+ge*j,t[6]=re*f+se*T+de*O+ge*W,t[7]=re*p+se*E+de*z+ge*ie,t[8]=(re=n[8])*a+(se=n[9])*y+(de=n[10])*I+(ge=n[11])*N,t[9]=re*u+se*b+de*k+ge*j,t[10]=re*f+se*T+de*O+ge*W,t[11]=re*p+se*E+de*z+ge*ie,t[12]=(re=n[12])*a+(se=n[13])*y+(de=n[14])*I+(ge=n[15])*N,t[13]=re*u+se*b+de*k+ge*j,t[14]=re*f+se*T+de*O+ge*W,t[15]=re*p+se*E+de*z+ge*ie,t}function R1(t,e,n){var a=e[0],u=e[1],f=e[2],p=e[3],y=a+a,b=u+u,T=f+f,E=a*y,I=a*b,k=a*T,O=u*b,z=u*T,N=f*T,j=p*y,W=p*b,ie=p*T;return t[0]=1-(O+N),t[1]=I+ie,t[2]=k-W,t[3]=0,t[4]=I-ie,t[5]=1-(E+N),t[6]=z+j,t[7]=0,t[8]=k+W,t[9]=z-j,t[10]=1-(E+O),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function z1(t,e){var n=e[4],a=e[5],u=e[6],f=e[8],p=e[9],y=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,a,u),t[2]=Math.hypot(f,p,y),t}function F1(t,e,n,a,u){var f,p=1/Math.tan(e/2);return t[0]=p/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,u!=null&&u!==1/0?(t[10]=(u+a)*(f=1/(a-u)),t[14]=2*u*a*f):(t[10]=-1,t[14]=-2*a),t}function B1(t,e,n,a,u,f,p){var y=1/(e-n),b=1/(a-u),T=1/(f-p);return t[0]=-2*y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*b,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*T,t[11]=0,t[12]=(e+n)*y,t[13]=(u+a)*b,t[14]=(p+f)*T,t[15]=1,t}function N1(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}Hi.perspective=F1,Hi.ortho=B1,Hi.mul=O1,Hi.sub=N1;var Bi={},ji={};function a0(t){return a0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a0(t)}Object.defineProperty(ji,"__esModule",{value:!0}),ji.create=U1,ji.clone=function(t){var e=new ec.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},ji.length=j1,ji.fromValues=function(t,e,n){var a=new ec.ARRAY_TYPE(3);return a[0]=t,a[1]=e,a[2]=n,a},ji.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},ji.set=function(t,e,n,a){return t[0]=e,t[1]=n,t[2]=a,t},ji.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},ji.subtract=G1,ji.multiply=H1,ji.divide=q1,ji.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},ji.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},ji.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},ji.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},ji.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},ji.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},ji.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t},ji.distance=W1,ji.squaredDistance=Z1,ji.squaredLength=X1,ji.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},ji.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},ji.normalize=function(t,e){var n=e[0],a=e[1],u=e[2],f=n*n+a*a+u*u;return f>0&&(f=1/Math.sqrt(f)),t[0]=e[0]*f,t[1]=e[1]*f,t[2]=e[2]*f,t},ji.dot=Y1,ji.cross=function(t,e,n){var a=e[0],u=e[1],f=e[2],p=n[0],y=n[1],b=n[2];return t[0]=u*b-f*y,t[1]=f*p-a*b,t[2]=a*y-u*p,t},ji.lerp=function(t,e,n,a){var u=e[0],f=e[1],p=e[2];return t[0]=u+a*(n[0]-u),t[1]=f+a*(n[1]-f),t[2]=p+a*(n[2]-p),t},ji.hermite=function(t,e,n,a,u,f){var p=f*f,y=p*(2*f-3)+1,b=p*(f-2)+f,T=p*(f-1),E=p*(3-2*f);return t[0]=e[0]*y+n[0]*b+a[0]*T+u[0]*E,t[1]=e[1]*y+n[1]*b+a[1]*T+u[1]*E,t[2]=e[2]*y+n[2]*b+a[2]*T+u[2]*E,t},ji.bezier=function(t,e,n,a,u,f){var p=1-f,y=p*p,b=f*f,T=y*p,E=3*f*y,I=3*b*p,k=b*f;return t[0]=e[0]*T+n[0]*E+a[0]*I+u[0]*k,t[1]=e[1]*T+n[1]*E+a[1]*I+u[1]*k,t[2]=e[2]*T+n[2]*E+a[2]*I+u[2]*k,t},ji.random=function(t,e){e=e||1;var n=2*ec.RANDOM()*Math.PI,a=2*ec.RANDOM()-1,u=Math.sqrt(1-a*a)*e;return t[0]=Math.cos(n)*u,t[1]=Math.sin(n)*u,t[2]=a*e,t},ji.transformMat4=function(t,e,n){var a=e[0],u=e[1],f=e[2],p=n[3]*a+n[7]*u+n[11]*f+n[15];return t[0]=(n[0]*a+n[4]*u+n[8]*f+n[12])/(p=p||1),t[1]=(n[1]*a+n[5]*u+n[9]*f+n[13])/p,t[2]=(n[2]*a+n[6]*u+n[10]*f+n[14])/p,t},ji.transformMat3=function(t,e,n){var a=e[0],u=e[1],f=e[2];return t[0]=a*n[0]+u*n[3]+f*n[6],t[1]=a*n[1]+u*n[4]+f*n[7],t[2]=a*n[2]+u*n[5]+f*n[8],t},ji.transformQuat=function(t,e,n){var a=n[0],u=n[1],f=n[2],p=e[0],y=e[1],b=e[2],T=u*b-f*y,E=f*p-a*b,I=a*y-u*p,k=u*I-f*E,O=f*T-a*I,z=a*E-u*T,N=2*n[3];return E*=N,I*=N,O*=2,z*=2,t[0]=p+(T*=N)+(k*=2),t[1]=y+E+O,t[2]=b+I+z,t},ji.rotateX=function(t,e,n,a){var u=[],f=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],f[0]=u[0],f[1]=u[1]*Math.cos(a)-u[2]*Math.sin(a),f[2]=u[1]*Math.sin(a)+u[2]*Math.cos(a),t[0]=f[0]+n[0],t[1]=f[1]+n[1],t[2]=f[2]+n[2],t},ji.rotateY=function(t,e,n,a){var u=[],f=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],f[0]=u[2]*Math.sin(a)+u[0]*Math.cos(a),f[1]=u[1],f[2]=u[2]*Math.cos(a)-u[0]*Math.sin(a),t[0]=f[0]+n[0],t[1]=f[1]+n[1],t[2]=f[2]+n[2],t},ji.rotateZ=function(t,e,n,a){var u=[],f=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],f[0]=u[0]*Math.cos(a)-u[1]*Math.sin(a),f[1]=u[0]*Math.sin(a)+u[1]*Math.cos(a),f[2]=u[2],t[0]=f[0]+n[0],t[1]=f[1]+n[1],t[2]=f[2]+n[2],t},ji.angle=function(t,e){var n=t[0],a=t[1],u=t[2],f=e[0],p=e[1],y=e[2],b=Math.sqrt(n*n+a*a+u*u)*Math.sqrt(f*f+p*p+y*y),T=b&&Y1(t,e)/b;return Math.acos(Math.min(Math.max(T,-1),1))},ji.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},ji.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},ji.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},ji.equals=function(t,e){var n=t[0],a=t[1],u=t[2],f=e[0],p=e[1],y=e[2];return Math.abs(n-f)<=ec.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(a-p)<=ec.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(u-y)<=ec.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))},ji.forEach=ji.sqrLen=ji.len=ji.sqrDist=ji.dist=ji.div=ji.mul=ji.sub=void 0;var ec=function(t,e){if(t&&t.__esModule)return t;if(t===null||a0(t)!=="object"&&typeof t!="function")return{default:t};var n=V1(void 0);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in t)if(f!=="default"&&Object.prototype.hasOwnProperty.call(t,f)){var p=u?Object.getOwnPropertyDescriptor(t,f):null;p&&(p.get||p.set)?Object.defineProperty(a,f,p):a[f]=t[f]}return a.default=t,n&&n.set(t,a),a}(io);function V1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(V1=function(a){return a?n:e})(t)}function U1(){var t=new ec.ARRAY_TYPE(3);return ec.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function j1(t){return Math.hypot(t[0],t[1],t[2])}function G1(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function H1(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function q1(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function W1(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function Z1(t,e){var n=e[0]-t[0],a=e[1]-t[1],u=e[2]-t[2];return n*n+a*a+u*u}function X1(t){var e=t[0],n=t[1],a=t[2];return e*e+n*n+a*a}function Y1(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}ji.sub=G1,ji.mul=H1,ji.div=q1,ji.dist=W1,ji.sqrDist=Z1,ji.len=j1,ji.sqrLen=X1;var tc,fD=(tc=U1(),function(t,e,n,a,u,f){var p,y;for(e||(e=3),n||(n=0),y=a?Math.min(a*e+n,t.length):t.length,p=n;p<y;p+=e)tc[0]=t[p],tc[1]=t[p+1],tc[2]=t[p+2],u(tc,tc,f),t[p]=tc[0],t[p+1]=tc[1],t[p+2]=tc[2];return t});ji.forEach=fD;var Qi={};function l0(t){return l0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l0(t)}Object.defineProperty(Qi,"__esModule",{value:!0}),Qi.create=K1,Qi.clone=function(t){var e=new ha.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Qi.fromValues=function(t,e,n,a){var u=new ha.ARRAY_TYPE(4);return u[0]=t,u[1]=e,u[2]=n,u[3]=a,u},Qi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Qi.set=function(t,e,n,a,u){return t[0]=e,t[1]=n,t[2]=a,t[3]=u,t},Qi.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Qi.subtract=$1,Qi.multiply=Q1,Qi.divide=ew,Qi.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Qi.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Qi.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},Qi.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},Qi.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Qi.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Qi.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t},Qi.distance=tw,Qi.squaredDistance=iw,Qi.length=nw,Qi.squaredLength=rw,Qi.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Qi.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Qi.normalize=function(t,e){var n=e[0],a=e[1],u=e[2],f=e[3],p=n*n+a*a+u*u+f*f;return p>0&&(p=1/Math.sqrt(p)),t[0]=n*p,t[1]=a*p,t[2]=u*p,t[3]=f*p,t},Qi.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Qi.cross=function(t,e,n,a){var u=n[0]*a[1]-n[1]*a[0],f=n[0]*a[2]-n[2]*a[0],p=n[0]*a[3]-n[3]*a[0],y=n[1]*a[2]-n[2]*a[1],b=n[1]*a[3]-n[3]*a[1],T=n[2]*a[3]-n[3]*a[2],E=e[0],I=e[1],k=e[2],O=e[3];return t[0]=I*T-k*b+O*y,t[1]=-E*T+k*p-O*f,t[2]=E*b-I*p+O*u,t[3]=-E*y+I*f-k*u,t},Qi.lerp=function(t,e,n,a){var u=e[0],f=e[1],p=e[2],y=e[3];return t[0]=u+a*(n[0]-u),t[1]=f+a*(n[1]-f),t[2]=p+a*(n[2]-p),t[3]=y+a*(n[3]-y),t},Qi.random=function(t,e){var n,a,u,f,p,y;e=e||1;do p=(n=2*ha.RANDOM()-1)*n+(a=2*ha.RANDOM()-1)*a;while(p>=1);do y=(u=2*ha.RANDOM()-1)*u+(f=2*ha.RANDOM()-1)*f;while(y>=1);var b=Math.sqrt((1-p)/y);return t[0]=e*n,t[1]=e*a,t[2]=e*u*b,t[3]=e*f*b,t},Qi.transformMat4=function(t,e,n){var a=e[0],u=e[1],f=e[2],p=e[3];return t[0]=n[0]*a+n[4]*u+n[8]*f+n[12]*p,t[1]=n[1]*a+n[5]*u+n[9]*f+n[13]*p,t[2]=n[2]*a+n[6]*u+n[10]*f+n[14]*p,t[3]=n[3]*a+n[7]*u+n[11]*f+n[15]*p,t},Qi.transformQuat=function(t,e,n){var a=e[0],u=e[1],f=e[2],p=n[0],y=n[1],b=n[2],T=n[3],E=T*a+y*f-b*u,I=T*u+b*a-p*f,k=T*f+p*u-y*a,O=-p*a-y*u-b*f;return t[0]=E*T+O*-p+I*-b-k*-y,t[1]=I*T+O*-y+k*-p-E*-b,t[2]=k*T+O*-b+E*-y-I*-p,t[3]=e[3],t},Qi.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Qi.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Qi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Qi.equals=function(t,e){var n=t[0],a=t[1],u=t[2],f=t[3],p=e[0],y=e[1],b=e[2],T=e[3];return Math.abs(n-p)<=ha.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-y)<=ha.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(u-b)<=ha.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(f-T)<=ha.EPSILON*Math.max(1,Math.abs(f),Math.abs(T))},Qi.forEach=Qi.sqrLen=Qi.len=Qi.sqrDist=Qi.dist=Qi.div=Qi.mul=Qi.sub=void 0;var ha=function(t,e){if(t&&t.__esModule)return t;if(t===null||l0(t)!=="object"&&typeof t!="function")return{default:t};var n=J1(void 0);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in t)if(f!=="default"&&Object.prototype.hasOwnProperty.call(t,f)){var p=u?Object.getOwnPropertyDescriptor(t,f):null;p&&(p.get||p.set)?Object.defineProperty(a,f,p):a[f]=t[f]}return a.default=t,n&&n.set(t,a),a}(io);function J1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(J1=function(a){return a?n:e})(t)}function K1(){var t=new ha.ARRAY_TYPE(4);return ha.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function $1(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function Q1(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function ew(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function tw(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function iw(t,e){var n=e[0]-t[0],a=e[1]-t[1],u=e[2]-t[2],f=e[3]-t[3];return n*n+a*a+u*u+f*f}function nw(t){return Math.hypot(t[0],t[1],t[2],t[3])}function rw(t){var e=t[0],n=t[1],a=t[2],u=t[3];return e*e+n*n+a*a+u*u}Qi.sub=$1,Qi.mul=Q1,Qi.div=ew,Qi.dist=tw,Qi.sqrDist=iw,Qi.len=nw,Qi.sqrLen=rw;var pD=function(){var t=K1();return function(e,n,a,u,f,p){var y,b;for(n||(n=4),a||(a=0),b=u?Math.min(u*n+a,e.length):e.length,y=a;y<b;y+=n)t[0]=e[y],t[1]=e[y+1],t[2]=e[y+2],t[3]=e[y+3],f(t,t,p),e[y]=t[0],e[y+1]=t[1],e[y+2]=t[2],e[y+3]=t[3];return e}}();function c0(t){return c0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c0(t)}Qi.forEach=pD,Object.defineProperty(Bi,"__esModule",{value:!0}),Bi.create=u0,Bi.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Bi.setAxisAngle=sw,Bi.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),a=Math.sin(n/2);return a>$u.EPSILON?(t[0]=e[0]/a,t[1]=e[1]/a,t[2]=e[2]/a):(t[0]=1,t[1]=0,t[2]=0),n},Bi.getAngle=function(t,e){var n=dw(t,e);return Math.acos(2*n*n-1)},Bi.multiply=aw,Bi.rotateX=function(t,e,n){n*=.5;var a=e[0],u=e[1],f=e[2],p=e[3],y=Math.sin(n),b=Math.cos(n);return t[0]=a*b+p*y,t[1]=u*b+f*y,t[2]=f*b-u*y,t[3]=p*b-a*y,t},Bi.rotateY=function(t,e,n){n*=.5;var a=e[0],u=e[1],f=e[2],p=e[3],y=Math.sin(n),b=Math.cos(n);return t[0]=a*b-f*y,t[1]=u*b+p*y,t[2]=f*b+a*y,t[3]=p*b-u*y,t},Bi.rotateZ=function(t,e,n){n*=.5;var a=e[0],u=e[1],f=e[2],p=e[3],y=Math.sin(n),b=Math.cos(n);return t[0]=a*b+u*y,t[1]=u*b-a*y,t[2]=f*b+p*y,t[3]=p*b-f*y,t},Bi.calculateW=function(t,e){var n=e[0],a=e[1],u=e[2];return t[0]=n,t[1]=a,t[2]=u,t[3]=Math.sqrt(Math.abs(1-n*n-a*a-u*u)),t},Bi.exp=lw,Bi.ln=cw,Bi.pow=function(t,e,n){return cw(t,e),hw(t,t,n),lw(t,t),t},Bi.slerp=Wm,Bi.random=function(t){var e=$u.RANDOM(),n=$u.RANDOM(),a=$u.RANDOM(),u=Math.sqrt(1-e),f=Math.sqrt(e);return t[0]=u*Math.sin(2*Math.PI*n),t[1]=u*Math.cos(2*Math.PI*n),t[2]=f*Math.sin(2*Math.PI*a),t[3]=f*Math.cos(2*Math.PI*a),t},Bi.invert=function(t,e){var n=e[0],a=e[1],u=e[2],f=e[3],p=n*n+a*a+u*u+f*f,y=p?1/p:0;return t[0]=-n*y,t[1]=-a*y,t[2]=-u*y,t[3]=f*y,t},Bi.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Bi.fromMat3=uw,Bi.fromEuler=function(t,e,n,a){var u=.5*Math.PI/180;e*=u,n*=u,a*=u;var f=Math.sin(e),p=Math.cos(e),y=Math.sin(n),b=Math.cos(n),T=Math.sin(a),E=Math.cos(a);return t[0]=f*b*E-p*y*T,t[1]=p*y*E+f*b*T,t[2]=p*b*T-f*y*E,t[3]=p*b*E+f*y*T,t},Bi.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Bi.setAxes=Bi.sqlerp=Bi.rotationTo=Bi.equals=Bi.exactEquals=Bi.normalize=Bi.sqrLen=Bi.squaredLength=Bi.len=Bi.length=Bi.lerp=Bi.dot=Bi.scale=Bi.mul=Bi.add=Bi.set=Bi.copy=Bi.fromValues=Bi.clone=void 0;var $u=qm(io),mD=qm(Dn),ic=qm(ji),Xs=qm(Qi);function ow(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(ow=function(a){return a?n:e})(t)}function qm(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||c0(t)!=="object"&&typeof t!="function")return{default:t};var n=ow(e);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in t)if(f!=="default"&&Object.prototype.hasOwnProperty.call(t,f)){var p=u?Object.getOwnPropertyDescriptor(t,f):null;p&&(p.get||p.set)?Object.defineProperty(a,f,p):a[f]=t[f]}return a.default=t,n&&n.set(t,a),a}function u0(){var t=new $u.ARRAY_TYPE(4);return $u.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function sw(t,e,n){n*=.5;var a=Math.sin(n);return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=Math.cos(n),t}function aw(t,e,n){var a=e[0],u=e[1],f=e[2],p=e[3],y=n[0],b=n[1],T=n[2],E=n[3];return t[0]=a*E+p*y+u*T-f*b,t[1]=u*E+p*b+f*y-a*T,t[2]=f*E+p*T+a*b-u*y,t[3]=p*E-a*y-u*b-f*T,t}function lw(t,e){var n=e[0],a=e[1],u=e[2],f=e[3],p=Math.sqrt(n*n+a*a+u*u),y=Math.exp(f),b=p>0?y*Math.sin(p)/p:0;return t[0]=n*b,t[1]=a*b,t[2]=u*b,t[3]=y*Math.cos(p),t}function cw(t,e){var n=e[0],a=e[1],u=e[2],f=e[3],p=Math.sqrt(n*n+a*a+u*u),y=p>0?Math.atan2(p,f)/p:0;return t[0]=n*y,t[1]=a*y,t[2]=u*y,t[3]=.5*Math.log(n*n+a*a+u*u+f*f),t}function Wm(t,e,n,a){var u,f,p,y,b,T=e[0],E=e[1],I=e[2],k=e[3],O=n[0],z=n[1],N=n[2],j=n[3];return(f=T*O+E*z+I*N+k*j)<0&&(f=-f,O=-O,z=-z,N=-N,j=-j),1-f>$u.EPSILON?(u=Math.acos(f),p=Math.sin(u),y=Math.sin((1-a)*u)/p,b=Math.sin(a*u)/p):(y=1-a,b=a),t[0]=y*T+b*O,t[1]=y*E+b*z,t[2]=y*I+b*N,t[3]=y*k+b*j,t}function uw(t,e){var n,a=e[0]+e[4]+e[8];if(a>0)n=Math.sqrt(a+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var u=0;e[4]>e[0]&&(u=1),e[8]>e[3*u+u]&&(u=2);var f=(u+1)%3,p=(u+2)%3;n=Math.sqrt(e[3*u+u]-e[3*f+f]-e[3*p+p]+1),t[u]=.5*n,t[3]=(e[3*f+p]-e[3*p+f])*(n=.5/n),t[f]=(e[3*f+u]+e[3*u+f])*n,t[p]=(e[3*p+u]+e[3*u+p])*n}return t}Bi.clone=Xs.clone,Bi.fromValues=Xs.fromValues,Bi.copy=Xs.copy,Bi.set=Xs.set,Bi.add=Xs.add,Bi.mul=aw;var hw=Xs.scale;Bi.scale=hw;var dw=Xs.dot;Bi.dot=dw,Bi.lerp=Xs.lerp;var fw=Xs.length;Bi.length=fw,Bi.len=fw;var pw=Xs.squaredLength;Bi.squaredLength=pw,Bi.sqrLen=pw;var h0=Xs.normalize;Bi.normalize=h0,Bi.exactEquals=Xs.exactEquals,Bi.equals=Xs.equals;var za,mw,gw,gD=(za=ic.create(),mw=ic.fromValues(1,0,0),gw=ic.fromValues(0,1,0),function(t,e,n){var a=ic.dot(e,n);return a<-.999999?(ic.cross(za,mw,e),ic.len(za)<1e-6&&ic.cross(za,gw,e),ic.normalize(za,za),sw(t,za,Math.PI),t):a>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(ic.cross(za,e,n),t[0]=za[0],t[1]=za[1],t[2]=za[2],t[3]=1+a,h0(t,t))});Bi.rotationTo=gD;var d0,f0,_D=(d0=u0(),f0=u0(),function(t,e,n,a,u,f){return Wm(d0,e,u,f),Wm(f0,n,a,f),Wm(t,d0,f0,2*f*(1-f)),t});Bi.sqlerp=_D;var Fa,yD=(Fa=mD.create(),function(t,e,n,a){return Fa[0]=n[0],Fa[3]=n[1],Fa[6]=n[2],Fa[1]=a[0],Fa[4]=a[1],Fa[7]=a[2],Fa[2]=-e[0],Fa[5]=-e[1],Fa[8]=-e[2],h0(t,uw(t,Fa))});Bi.setAxes=yD;var rn={};function p0(t){return p0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p0(t)}Object.defineProperty(rn,"__esModule",{value:!0}),rn.create=function(){var t=new _s.ARRAY_TYPE(8);return _s.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},rn.clone=function(t){var e=new _s.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},rn.fromValues=function(t,e,n,a,u,f,p,y){var b=new _s.ARRAY_TYPE(8);return b[0]=t,b[1]=e,b[2]=n,b[3]=a,b[4]=u,b[5]=f,b[6]=p,b[7]=y,b},rn.fromRotationTranslationValues=function(t,e,n,a,u,f,p){var y=new _s.ARRAY_TYPE(8);y[0]=t,y[1]=e,y[2]=n,y[3]=a;var b=.5*u,T=.5*f,E=.5*p;return y[4]=b*a+T*n-E*e,y[5]=T*a+E*t-b*n,y[6]=E*a+b*e-T*t,y[7]=-b*t-T*e-E*n,y},rn.fromRotationTranslation=vw,rn.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},rn.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},rn.fromMat4=function(t,e){var n=nc.create();_w.getRotation(n,e);var a=new _s.ARRAY_TYPE(3);return _w.getTranslation(a,e),vw(t,n,a),t},rn.copy=xw,rn.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},rn.set=function(t,e,n,a,u,f,p,y,b){return t[0]=e,t[1]=n,t[2]=a,t[3]=u,t[4]=f,t[5]=p,t[6]=y,t[7]=b,t},rn.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},rn.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},rn.getTranslation=function(t,e){var n=e[4],a=e[5],u=e[6],f=e[7],p=-e[0],y=-e[1],b=-e[2],T=e[3];return t[0]=2*(n*T+f*p+a*b-u*y),t[1]=2*(a*T+f*y+u*p-n*b),t[2]=2*(u*T+f*b+n*y-a*p),t},rn.translate=function(t,e,n){var a=e[0],u=e[1],f=e[2],p=e[3],y=.5*n[0],b=.5*n[1],T=.5*n[2],E=e[4],I=e[5],k=e[6],O=e[7];return t[0]=a,t[1]=u,t[2]=f,t[3]=p,t[4]=p*y+u*T-f*b+E,t[5]=p*b+f*y-a*T+I,t[6]=p*T+a*b-u*y+k,t[7]=-a*y-u*b-f*T+O,t},rn.rotateX=function(t,e,n){var a=-e[0],u=-e[1],f=-e[2],p=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=y*p+E*a+b*f-T*u,k=b*p+E*u+T*a-y*f,O=T*p+E*f+y*u-b*a,z=E*p-y*a-b*u-T*f;return nc.rotateX(t,e,n),t[4]=I*(p=t[3])+z*(a=t[0])+k*(f=t[2])-O*(u=t[1]),t[5]=k*p+z*u+O*a-I*f,t[6]=O*p+z*f+I*u-k*a,t[7]=z*p-I*a-k*u-O*f,t},rn.rotateY=function(t,e,n){var a=-e[0],u=-e[1],f=-e[2],p=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=y*p+E*a+b*f-T*u,k=b*p+E*u+T*a-y*f,O=T*p+E*f+y*u-b*a,z=E*p-y*a-b*u-T*f;return nc.rotateY(t,e,n),t[4]=I*(p=t[3])+z*(a=t[0])+k*(f=t[2])-O*(u=t[1]),t[5]=k*p+z*u+O*a-I*f,t[6]=O*p+z*f+I*u-k*a,t[7]=z*p-I*a-k*u-O*f,t},rn.rotateZ=function(t,e,n){var a=-e[0],u=-e[1],f=-e[2],p=e[3],y=e[4],b=e[5],T=e[6],E=e[7],I=y*p+E*a+b*f-T*u,k=b*p+E*u+T*a-y*f,O=T*p+E*f+y*u-b*a,z=E*p-y*a-b*u-T*f;return nc.rotateZ(t,e,n),t[4]=I*(p=t[3])+z*(a=t[0])+k*(f=t[2])-O*(u=t[1]),t[5]=k*p+z*u+O*a-I*f,t[6]=O*p+z*f+I*u-k*a,t[7]=z*p-I*a-k*u-O*f,t},rn.rotateByQuatAppend=function(t,e,n){var a=n[0],u=n[1],f=n[2],p=n[3],y=e[0],b=e[1],T=e[2],E=e[3];return t[0]=y*p+E*a+b*f-T*u,t[1]=b*p+E*u+T*a-y*f,t[2]=T*p+E*f+y*u-b*a,t[3]=E*p-y*a-b*u-T*f,t[4]=(y=e[4])*p+(E=e[7])*a+(b=e[5])*f-(T=e[6])*u,t[5]=b*p+E*u+T*a-y*f,t[6]=T*p+E*f+y*u-b*a,t[7]=E*p-y*a-b*u-T*f,t},rn.rotateByQuatPrepend=function(t,e,n){var a=e[0],u=e[1],f=e[2],p=e[3],y=n[0],b=n[1],T=n[2],E=n[3];return t[0]=a*E+p*y+u*T-f*b,t[1]=u*E+p*b+f*y-a*T,t[2]=f*E+p*T+a*b-u*y,t[3]=p*E-a*y-u*b-f*T,t[4]=a*(E=n[7])+p*(y=n[4])+u*(T=n[6])-f*(b=n[5]),t[5]=u*E+p*b+f*y-a*T,t[6]=f*E+p*T+a*b-u*y,t[7]=p*E-a*y-u*b-f*T,t},rn.rotateAroundAxis=function(t,e,n,a){if(Math.abs(a)<_s.EPSILON)return xw(t,e);var u=Math.hypot(n[0],n[1],n[2]);a*=.5;var f=Math.sin(a),p=f*n[0]/u,y=f*n[1]/u,b=f*n[2]/u,T=Math.cos(a),E=e[0],I=e[1],k=e[2],O=e[3];t[0]=E*T+O*p+I*b-k*y,t[1]=I*T+O*y+k*p-E*b,t[2]=k*T+O*b+E*y-I*p,t[3]=O*T-E*p-I*y-k*b;var z=e[4],N=e[5],j=e[6],W=e[7];return t[4]=z*T+W*p+N*b-j*y,t[5]=N*T+W*y+j*p-z*b,t[6]=j*T+W*b+z*y-N*p,t[7]=W*T-z*p-N*y-j*b,t},rn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},rn.multiply=bw,rn.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},rn.lerp=function(t,e,n,a){var u=1-a;return ww(e,n)<0&&(a=-a),t[0]=e[0]*u+n[0]*a,t[1]=e[1]*u+n[1]*a,t[2]=e[2]*u+n[2]*a,t[3]=e[3]*u+n[3]*a,t[4]=e[4]*u+n[4]*a,t[5]=e[5]*u+n[5]*a,t[6]=e[6]*u+n[6]*a,t[7]=e[7]*u+n[7]*a,t},rn.invert=function(t,e){var n=Zm(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},rn.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},rn.normalize=function(t,e){var n=Zm(e);if(n>0){n=Math.sqrt(n);var a=e[0]/n,u=e[1]/n,f=e[2]/n,p=e[3]/n,y=e[4],b=e[5],T=e[6],E=e[7],I=a*y+u*b+f*T+p*E;t[0]=a,t[1]=u,t[2]=f,t[3]=p,t[4]=(y-a*I)/n,t[5]=(b-u*I)/n,t[6]=(T-f*I)/n,t[7]=(E-p*I)/n}return t},rn.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},rn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},rn.equals=function(t,e){var n=t[0],a=t[1],u=t[2],f=t[3],p=t[4],y=t[5],b=t[6],T=t[7],E=e[0],I=e[1],k=e[2],O=e[3],z=e[4],N=e[5],j=e[6],W=e[7];return Math.abs(n-E)<=_s.EPSILON*Math.max(1,Math.abs(n),Math.abs(E))&&Math.abs(a-I)<=_s.EPSILON*Math.max(1,Math.abs(a),Math.abs(I))&&Math.abs(u-k)<=_s.EPSILON*Math.max(1,Math.abs(u),Math.abs(k))&&Math.abs(f-O)<=_s.EPSILON*Math.max(1,Math.abs(f),Math.abs(O))&&Math.abs(p-z)<=_s.EPSILON*Math.max(1,Math.abs(p),Math.abs(z))&&Math.abs(y-N)<=_s.EPSILON*Math.max(1,Math.abs(y),Math.abs(N))&&Math.abs(b-j)<=_s.EPSILON*Math.max(1,Math.abs(b),Math.abs(j))&&Math.abs(T-W)<=_s.EPSILON*Math.max(1,Math.abs(T),Math.abs(W))},rn.sqrLen=rn.squaredLength=rn.len=rn.length=rn.dot=rn.mul=rn.setReal=rn.getReal=void 0;var _s=m0(io),nc=m0(Bi),_w=m0(Hi);function yw(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(yw=function(a){return a?n:e})(t)}function m0(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||p0(t)!=="object"&&typeof t!="function")return{default:t};var n=yw(e);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in t)if(f!=="default"&&Object.prototype.hasOwnProperty.call(t,f)){var p=u?Object.getOwnPropertyDescriptor(t,f):null;p&&(p.get||p.set)?Object.defineProperty(a,f,p):a[f]=t[f]}return a.default=t,n&&n.set(t,a),a}function vw(t,e,n){var a=.5*n[0],u=.5*n[1],f=.5*n[2],p=e[0],y=e[1],b=e[2],T=e[3];return t[0]=p,t[1]=y,t[2]=b,t[3]=T,t[4]=a*T+u*b-f*y,t[5]=u*T+f*p-a*b,t[6]=f*T+a*y-u*p,t[7]=-a*p-u*y-f*b,t}function xw(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function bw(t,e,n){var a=e[0],u=e[1],f=e[2],p=e[3],y=n[4],b=n[5],T=n[6],E=n[7],I=e[4],k=e[5],O=e[6],z=e[7],N=n[0],j=n[1],W=n[2],ie=n[3];return t[0]=a*ie+p*N+u*W-f*j,t[1]=u*ie+p*j+f*N-a*W,t[2]=f*ie+p*W+a*j-u*N,t[3]=p*ie-a*N-u*j-f*W,t[4]=a*E+p*y+u*T-f*b+I*ie+z*N+k*W-O*j,t[5]=u*E+p*b+f*y-a*T+k*ie+z*j+O*N-I*W,t[6]=f*E+p*T+a*b-u*y+O*ie+z*W+I*j-k*N,t[7]=p*E-a*y-u*b-f*T+z*ie-I*N-k*j-O*W,t}rn.getReal=nc.copy,rn.setReal=nc.copy,rn.mul=bw;var ww=nc.dot;rn.dot=ww;var Tw=nc.length;rn.length=Tw,rn.len=Tw;var Zm=nc.squaredLength;rn.squaredLength=Zm,rn.sqrLen=Zm;var Yi={};function g0(t){return g0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g0(t)}Object.defineProperty(Yi,"__esModule",{value:!0}),Yi.create=Mw,Yi.clone=function(t){var e=new Qu.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},Yi.fromValues=function(t,e){var n=new Qu.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},Yi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},Yi.set=function(t,e,n){return t[0]=e,t[1]=n,t},Yi.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},Yi.subtract=Ew,Yi.multiply=Aw,Yi.divide=Iw,Yi.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},Yi.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},Yi.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},Yi.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},Yi.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},Yi.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},Yi.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t},Yi.distance=Cw,Yi.squaredDistance=Pw,Yi.length=kw,Yi.squaredLength=Dw,Yi.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},Yi.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},Yi.normalize=function(t,e){var n=e[0],a=e[1],u=n*n+a*a;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t},Yi.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},Yi.cross=function(t,e,n){var a=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=a,t},Yi.lerp=function(t,e,n,a){var u=e[0],f=e[1];return t[0]=u+a*(n[0]-u),t[1]=f+a*(n[1]-f),t},Yi.random=function(t,e){e=e||1;var n=2*Qu.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},Yi.transformMat2=function(t,e,n){var a=e[0],u=e[1];return t[0]=n[0]*a+n[2]*u,t[1]=n[1]*a+n[3]*u,t},Yi.transformMat2d=function(t,e,n){var a=e[0],u=e[1];return t[0]=n[0]*a+n[2]*u+n[4],t[1]=n[1]*a+n[3]*u+n[5],t},Yi.transformMat3=function(t,e,n){var a=e[0],u=e[1];return t[0]=n[0]*a+n[3]*u+n[6],t[1]=n[1]*a+n[4]*u+n[7],t},Yi.transformMat4=function(t,e,n){var a=e[0],u=e[1];return t[0]=n[0]*a+n[4]*u+n[12],t[1]=n[1]*a+n[5]*u+n[13],t},Yi.rotate=function(t,e,n,a){var u=e[0]-n[0],f=e[1]-n[1],p=Math.sin(a),y=Math.cos(a);return t[0]=u*y-f*p+n[0],t[1]=u*p+f*y+n[1],t},Yi.angle=function(t,e){var n=t[0],a=t[1],u=e[0],f=e[1],p=Math.sqrt(n*n+a*a)*Math.sqrt(u*u+f*f);return Math.acos(Math.min(Math.max(p&&(n*u+a*f)/p,-1),1))},Yi.zero=function(t){return t[0]=0,t[1]=0,t},Yi.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},Yi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Yi.equals=function(t,e){var n=t[0],a=t[1],u=e[0],f=e[1];return Math.abs(n-u)<=Qu.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(a-f)<=Qu.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))},Yi.forEach=Yi.sqrLen=Yi.sqrDist=Yi.dist=Yi.div=Yi.mul=Yi.sub=Yi.len=void 0;var Qu=function(t,e){if(t&&t.__esModule)return t;if(t===null||g0(t)!=="object"&&typeof t!="function")return{default:t};var n=Sw(void 0);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in t)if(f!=="default"&&Object.prototype.hasOwnProperty.call(t,f)){var p=u?Object.getOwnPropertyDescriptor(t,f):null;p&&(p.get||p.set)?Object.defineProperty(a,f,p):a[f]=t[f]}return a.default=t,n&&n.set(t,a),a}(io);function Sw(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Sw=function(a){return a?n:e})(t)}function Mw(){var t=new Qu.ARRAY_TYPE(2);return Qu.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function Ew(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function Aw(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function Iw(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function Cw(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function Pw(t,e){var n=e[0]-t[0],a=e[1]-t[1];return n*n+a*a}function kw(t){return Math.hypot(t[0],t[1])}function Dw(t){var e=t[0],n=t[1];return e*e+n*n}Yi.len=kw,Yi.sub=Ew,Yi.mul=Aw,Yi.div=Iw,Yi.dist=Cw,Yi.sqrDist=Pw,Yi.sqrLen=Dw;var vD=function(){var t=Mw();return function(e,n,a,u,f,p){var y,b;for(n||(n=2),a||(a=0),b=u?Math.min(u*n+a,e.length):e.length,y=a;y<b;y+=n)t[0]=e[y],t[1]=e[y+1],f(t,t,p),e[y]=t[0],e[y+1]=t[1];return e}}();function _0(t){return _0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_0(t)}Yi.forEach=vD,Object.defineProperty(to,"__esModule",{value:!0}),s.e=to.vec4=s.v=to.vec3=to.vec2=to.quat2=s.q=to.quat=s.m=to.mat4=s.bx=to.mat3=to.mat2d=s.h=to.mat2=to.glMatrix=void 0;var xD=ul(io);to.glMatrix=xD;var bD=ul(ur);s.h=to.mat2=bD;var wD=ul(mr);to.mat2d=wD;var TD=ul(Dn);s.bx=to.mat3=TD;var SD=ul(Hi);s.m=to.mat4=SD;var MD=ul(Bi);s.q=to.quat=MD;var ED=ul(rn);to.quat2=ED;var AD=ul(Yi);to.vec2=AD;var ID=ul(ji);s.v=to.vec3=ID;var CD=ul(Qi);function Lw(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Lw=function(a){return a?n:e})(t)}function ul(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||_0(t)!=="object"&&typeof t!="function")return{default:t};var n=Lw(e);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in t)if(f!=="default"&&Object.prototype.hasOwnProperty.call(t,f)){var p=u?Object.getOwnPropertyDescriptor(t,f):null;p&&(p.get||p.set)?Object.defineProperty(a,f,p):a[f]=t[f]}return a.default=t,n&&n.set(t,a),a}s.e=to.vec4=CD;const PD=di([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Xm}=PD,Ow=di([{name:"a_pos_3",components:3,type:"Int16"}]);var zf=di([{name:"a_pos",type:"Int16",components:2}]),Rw={};(function(t,e){(function(n){function a(f,p,y){var b=u(256*f,256*(p=Math.pow(2,y)-p-1),y),T=u(256*(f+1),256*(p+1),y);return b[0]+","+b[1]+","+T[0]+","+T[1]}function u(f,p,y){var b=2*Math.PI*6378137/256/Math.pow(2,y);return[f*b-2*Math.PI*6378137/2,p*b-2*Math.PI*6378137/2]}n.getURL=function(f,p,y,b,T,E){return E=E||{},f+"?"+["bbox="+a(y,b,T),"format="+(E.format||"image/png"),"service="+(E.service||"WMS"),"version="+(E.version||"1.1.1"),"request="+(E.request||"GetMap"),"srs="+(E.srs||"EPSG:3857"),"width="+(E.width||256),"height="+(E.height||256),"layers="+p].join("&")},n.getTileBBox=a,n.getMercCoords=u,Object.defineProperty(n,"__esModule",{value:!0})})(e)})(0,Rw);var kD=Rw;class eh{constructor(e,n,a){this.z=e,this.x=n,this.y=a,this.key=Ff(0,e,e,n,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const a=kD.getTileBBox(this.x,this.y,this.z),u=function(f,p,y){let b,T="";for(let E=f;E>0;E--)b=1<<E-1,T+=(p&b?1:0)+(y&b?2:0);return T}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class zw{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Ff(e,n.z,n.z,n.x,n.y)}}class mo{constructor(e,n,a,u,f){this.overscaledZ=e,this.wrap=n,this.canonical=new eh(a,+u,+f),this.key=n===0&&e===a?this.canonical.key:Ff(n,e,a,u,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new mo(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new mo(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Ff(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Ff(this.wrap*+n,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new mo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new mo(n,this.wrap,n,a,u),new mo(n,this.wrap,n,a+1,u),new mo(n,this.wrap,n,a,u+1),new mo(n,this.wrap,n,a+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new mo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new mo(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new zw(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ff(t,e,n,a,u){const f=1<<Math.min(n,22);let p=f*(u%f)+a%f;return t&&n<22&&(p+=f*f*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*p+n)+(e-n)}const DD=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new mo(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new mo(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new mo(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new mo(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];ri(eh,"CanonicalTileID"),ri(mo,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});class y0{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,a){const u=s.v.dot(n,this.dir);if(Math.abs(u)<1e-6)return!1;const f=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/u;return a[0]=this.pos[0]+this.dir[0]*f,a[1]=this.pos[1]+this.dir[1]*f,a[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,n,a){if(s.v.equals(this.pos,e)||n===0)return a[0]=a[1]=a[2]=0,!1;const[u,f,p]=this.dir,y=this.pos[0]-e[0],b=this.pos[1]-e[1],T=this.pos[2]-e[2],E=u*u+f*f+p*p,I=2*(y*u+b*f+T*p),k=I*I-4*E*(y*y+b*b+T*T-n*n);if(k<0){const O=Math.max(-I/2,0),z=y+u*O,N=b+f*O,j=T+p*O,W=Math.hypot(z,N,j);return a[0]=z*n/W,a[1]=N*n/W,a[2]=j*n/W,!1}{const O=(-I-Math.sqrt(k))/(2*E);if(O<0){const z=Math.hypot(y,b,T);return a[0]=y*n/z,a[1]=b*n/z,a[2]=T*n/z,!1}return a[0]=y+u*O,a[1]=b+f*O,a[2]=T+p*O,!0}}}class v0{constructor(e,n,a,u,f){this.TL=e,this.TR=n,this.BR=a,this.BL=u,this.horizon=f}static fromInvProjectionMatrix(e,n,a){const u=[-1,1,1],f=[1,1,1],p=[1,-1,1],y=[-1,-1,1],b=s.v.transformMat4(u,u,e),T=s.v.transformMat4(f,f,e),E=s.v.transformMat4(p,p,e),I=s.v.transformMat4(y,y,e);return new v0(b,T,E,I,n/a)}}function Bf(t,e,n){let a=1/0,u=-1/0;const f=[];for(const p of t){s.v.sub(f,p,e);const y=s.v.dot(f,n);a=Math.min(a,y),u=Math.max(u,y)}return[a,u]}function Fw(t,e){let n=!0;for(let a=0;a<t.planes.length;a++){const u=t.planes[a];let f=0;for(let p=0;p<e.length;p++)f+=s.v.dot(u,e[p])+u[3]>=0;if(f===0)return 0;f!==e.length&&(n=!1)}return n?2:1}function Bw(t,e){for(const n of t.projections){const a=Bf(e,t.points[0],n.axis);if(n.projection[1]<a[0]||n.projection[0]>a[1])return 0}return 1}function Nw(t,e){let n=0;const a=[0,0,0,0];for(let u=0;u<t.length;u++)a[0]=t[u][0],a[1]=t[u][1],a[2]=t[u][2],a[3]=1,s.e.dot(a,e)>=0&&n++;return n}class x0{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=kr.fromPoints(this.points),this.projections=[],this.frustumEdges=[s.v.sub([],this.points[2],this.points[3]),s.v.sub([],this.points[0],this.points[3]),s.v.sub([],this.points[4],this.points[0]),s.v.sub([],this.points[5],this.points[1]),s.v.sub([],this.points[6],this.points[2]),s.v.sub([],this.points[7],this.points[3])];for(const a of this.frustumEdges){const u=[0,-a[2],a[1]],f=[a[2],0,-a[0]];this.projections.push({axis:u,projection:Bf(this.points,this.points[0],u)}),this.projections.push({axis:f,projection:Bf(this.points,this.points[0],f)})}}static fromInvProjectionMatrix(e,n,a,u){const f=Math.pow(2,a),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const E=s.e.transformMat4([],T,e),I=1/E[3]/n*f;return s.e.mul(E,E,[I,I,u?1/E[3]:I,I])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const E=s.v.sub([],p[T[0]],p[T[1]]),I=s.v.sub([],p[T[2]],p[T[1]]),k=s.v.normalize([],s.v.cross([],E,I)),O=-s.v.dot(k,p[T[1]]);return k.concat(O)}),b=[];for(let T=0;T<p.length;T++)b.push([p[T][0],p[T][1],p[T][2]]);return new x0(b,y)}intersectsPrecise(e,n,a){for(let u=0;u<n.length;u++)if(!Nw(e,n[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!Nw(e,this.planes[u]))return 0;for(const u of a)for(const f of this.frustumEdges){const p=s.v.cross([],u,f),y=s.v.length(p);if(y===0)continue;s.v.scale(p,p,1/y);const b=Bf(this.points,this.points[0],p),T=Bf(e,this.points[0],p);if(b[0]>T[1]||T[0]>b[1])return 0}return 1}}class kr{static fromPoints(e){const n=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const u of e)s.v.min(n,n,u),s.v.max(a,a,u);return new kr(n,a)}static fromTileIdAndHeight(e,n,a){const u=1<<e.canonical.z,f=e.canonical.x,p=e.canonical.y;return new kr([f/u,p/u,n],[(f+1)/u,(p+1)/u,a])}static applyTransform(e,n){const a=e.getCorners();for(let u=0;u<a.length;++u)s.v.transformMat4(a[u],a[u],n);return kr.fromPoints(a)}static projectAabbCorners(e,n){const a=e.getCorners();for(let u=0;u<a.length;++u)s.v.transformMat4(a[u],a[u],n);return a}constructor(e,n){this.min=e,this.max=n,this.center=s.v.scale([],s.v.add([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],a=s.v.clone(this.min),u=s.v.clone(this.max);for(let f=0;f<n.length;f++)a[f]=n[f]?this.min[f]:this.center[f],u[f]=n[f]?this.center[f]:this.max[f];return u[2]=this.max[2],new kr(a,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Fw(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Fw(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?Bw(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?Bw(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}ri(kr,"Aabb");const b0=5,Vw=6,Ys=Lt/Math.PI/2,LD=16383,ad=64,w0=[ad,32,16],da=-Ys,fa=Ys,OD=[new kr([da,da,da],[fa,fa,fa]),new kr([da,da,da],[0,0,fa]),new kr([0,da,da],[fa,0,fa]),new kr([da,0,da],[0,fa,fa]),new kr([0,0,da],[fa,fa,fa])];function Ym(t){return t*Ys/Uf}function Uw(t,e,n,a=!0){const u=s.v.scale([],t._camera.position,t.worldSize),f=[e,n,1,1];s.e.transformMat4(f,f,t.pixelMatrixInverse),s.e.scale(f,f,1/f[3]);const p=s.v.sub([],f,u),y=s.v.normalize([],p),b=t.globeMatrix,T=[b[12],b[13],b[14]],E=s.v.sub([],T,u),I=s.v.length(E),k=s.v.normalize([],E),O=t.worldSize/(2*Math.PI),z=s.v.dot(k,y),N=Math.asin(O/I);if(N<Math.acos(z)){if(!a)return null;const Be=[],ut=[];s.v.scale(Be,y,I/z),s.v.normalize(ut,s.v.sub(ut,Be,E)),s.v.normalize(y,s.v.add(y,E,s.v.scale(y,ut,Math.tan(N)*I)))}const j=[];new y0(u,y).closestPointOnSphere(T,O,j);const W=s.v.normalize([],Jt(b,0)),ie=s.v.normalize([],Jt(b,1)),re=s.v.normalize([],Jt(b,2)),se=s.v.dot(W,j),de=s.v.dot(ie,j),ge=s.v.dot(re,j),Se=mt(Math.asin(-de/O));let ke=mt(Math.atan2(se,ge));ke=t.center.lng+function(Be,ut){const Pt=(ut-Be+180)%360-180;return Pt<-180?Pt+360:Pt}(t.center.lng,ke);const Re=dl(ke),Ze=rt(fl(Se),0,1);return new Po(Re,Ze)}class RD{constructor(e,n,a){this.a=s.v.sub([],e,a),this.b=s.v.sub([],n,a),this.center=a;const u=s.v.normalize([],this.a),f=s.v.normalize([],this.b);this.angle=Math.acos(s.v.dot(u,f))}}function T0(t,e){if(t.angle===0)return null;let n;return n=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(a,u,f,p){const y=Math.sin(f);return a*(Math.sin((1-p)*f)/y)+u*(Math.sin(p*f)/y)}(t.a[e],t.b[e],t.angle,rt(n,0,1))+t.center[e]}function hl(t){if(t.z<=1)return OD[t.z+2*t.y+t.x];const e=S0(Jm(t));return kr.fromPoints(e)}function rc(t,e,n){return s.v.scale(t,t,1-n),s.v.scaleAndAdd(t,t,e,n)}function jw(t,e){const n=oc(e.zoom);if(n===0)return hl(t);const a=Jm(t),u=S0(a),f=dl(a.getWest())*e.worldSize,p=dl(a.getEast())*e.worldSize,y=fl(a.getNorth())*e.worldSize,b=fl(a.getSouth())*e.worldSize,T=[f,y,0],E=[p,y,0],I=[f,b,0],k=[p,b,0],O=s.m.invert([],e.globeMatrix);return s.v.transformMat4(T,T,O),s.v.transformMat4(E,E,O),s.v.transformMat4(I,I,O),s.v.transformMat4(k,k,O),u[0]=rc(u[0],I,n),u[1]=rc(u[1],k,n),u[2]=rc(u[2],E,n),u[3]=rc(u[3],T,n),kr.fromPoints(u)}function Gw(t,e,n){for(const a of t)s.v.transformMat4(a,a,e),s.v.scale(a,a,n)}function Hw(t,e,n,a){const u=e/t.worldSize,f=t.globeMatrix;if(n.z<=1){const Re=hl(n).getCorners();return Gw(Re,f,u),kr.fromPoints(Re)}const p=Jm(n,a),y=S0(p);Gw(y,f,u);const b=Number.MAX_VALUE,T=[-b,-b,-b],E=[b,b,b];if(p.contains(t.center)){for(const Be of y)s.v.min(E,E,Be),s.v.max(T,T,Be);T[2]=0;const Re=t.point,Ze=[Re.x*u,Re.y*u,0];return s.v.min(E,E,Ze),s.v.max(T,T,Ze),new kr(E,T)}const I=[f[12]*u,f[13]*u,f[14]*u],k=p.getCenter(),O=rt(t.center.lat,-Er,Er),z=rt(k.lat,-Er,Er),N=dl(t.center.lng),j=fl(O);let W=N-dl(k.lng);const ie=j-fl(z);W>.5?W-=1:W<-.5&&(W+=1);let re=0;if(Math.abs(W)>Math.abs(ie))re=W>=0?1:3;else{re=ie>=0?0:2;const Re=[f[4]*u,f[5]*u,f[6]*u],Ze=-Math.sin(Xe(ie>=0?p.getSouth():p.getNorth()))*Ys;s.v.scaleAndAdd(I,I,Re,Ze)}const se=y[re],de=y[(re+1)%4],ge=new RD(se,de,I),Se=[T0(ge,0)||se[0],T0(ge,1)||se[1],T0(ge,2)||se[2]],ke=oc(t.zoom);if(ke>0){const Re=function({x:Be,y:ut,z:Pt},st,St,ot,qt){const ii=1/(1<<Pt);let It=Be*ii,Ci=It+ii,si=ut*ii,Vt=si+ii,Pi=0;const fi=(It+Ci)/2-ot;return fi>.5?Pi=-1:fi<-.5&&(Pi=1),It=((It+Pi)*st-(ot*=st))*St+ot,Ci=((Ci+Pi)*st-ot)*St+ot,si=(si*st-(qt*=st))*St+qt,Vt=(Vt*st-qt)*St+qt,[[It,Vt,0],[Ci,Vt,0],[Ci,si,0],[It,si,0]]}(n,e,t._pixelsPerMercatorPixel,N,j);for(let Be=0;Be<y.length;Be++)rc(y[Be],Re[Be],ke);const Ze=s.v.add([],Re[re],Re[(re+1)%4]);s.v.scale(Ze,Ze,.5),rc(Se,Ze,ke)}for(const Re of y)s.v.min(E,E,Re),s.v.max(T,T,Re);return E[2]=Math.min(se[2],de[2]),s.v.min(E,E,Se),s.v.max(T,T,Se),new kr(E,T)}function Jm({x:t,y:e,z:n},a=!1){const u=1/(1<<n),f=new En(Cs(t*u),e===(1<<n)-1&&a?-90:bo((e+1)*u)),p=new En(Cs((t+1)*u),e===0&&a?90:bo(e*u));return new Uc(f,p)}function S0(t){const e=Xe(t.getNorth()),n=Xe(t.getSouth()),a=Math.cos(e),u=Math.cos(n),f=Math.sin(e),p=Math.sin(n),y=t.getWest(),b=t.getEast();return[ld(u,p,y),ld(u,p,b),ld(a,f,b),ld(a,f,y)]}function ld(t,e,n,a=Ys){return n=Xe(n),[t*Math.sin(n)*a,-e*a,t*Math.cos(n)*a]}function th(t,e,n){return ld(Math.cos(Xe(t)),Math.sin(Xe(t)),e,n)}function Nf(t,e,n,a){const u=1<<n.z,f=(t/Lt+n.x)/u;return th(bo((e/Lt+n.y)/u),Cs(f),a)}function Km({min:t,max:e}){return LD/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const qw=new Float64Array(16);function Vf(t){const e=Km(t),n=s.m.fromScaling(qw,[e,e,e]);return s.m.translate(n,n,s.v.negate([],t.min))}function M0(t){const e=s.m.fromTranslation(qw,t.min),n=1/Km(t);return s.m.scale(e,e,[n,n,n])}function E0(t){const e=Lt/(2*Math.PI);return t/(2*Math.PI)/e}function Ww(t,e){return Lt/(512*Math.pow(2,t))*Km(hl(e))}function Zw(t,e,n,a,u){const f=E0(n),p=[t,e,-n/(2*Math.PI)],y=s.m.identity(new Float64Array(16));return s.m.translate(y,y,p),s.m.scale(y,y,[f,f,f]),s.m.rotateX(y,y,Xe(-u)),s.m.rotateY(y,y,Xe(-a)),y}function oc(t){return yt(b0,Vw,t)}function Xw(t,e){const n=th(e.lat,e.lng),a=function(f){const p=th(f._center.lat,f._center.lng),y=s.v.fromValues(0,1,0);let b=s.v.cross([],y,p);const T=s.m.fromRotation([],-f.angle,p);b=s.v.transformMat4(b,b,T),s.m.fromRotation(T,-f._pitch,b);const E=s.v.normalize([],p);return s.v.scale(E,E,Ym(f.cameraToCenterDistance/f.pixelsPerMeter)),s.v.transformMat4(E,E,T),s.v.add([],p,E)}(t),u=s.v.subtract([],a,n);return s.v.angle(u,n)}function A0(t,e){return Xw(t,e)>Math.PI/2*1.01}const Yw=Xe(85),zD=Math.cos(Yw),FD=Math.sin(Yw),Uf=63710088e-1,I0=2*Math.PI*Uf;class Gc{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Gc(Xt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,a=this.lat*n,u=e.lat*n,f=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((e.lng-this.lng)*n);return Uf*Math.acos(Math.min(f,1))}toBounds(e=0){const n=360*e/40075017,a=n/Math.cos(Math.PI/180*this.lat);return new Uc(new Gc(this.lng-a,this.lat-n),new Gc(this.lng+a,this.lat+n))}toEcef(e){const n=Ym(e);return th(this.lat,this.lng,Ys+n)}static convert(e){if(e instanceof Gc)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Gc(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Gc(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var En=Gc;const BD=0,ND=25.5;function C0(t){return I0*Math.cos(t*Math.PI/180)}function dl(t){return(180+t)/360}function fl(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Ko(t,e){return t/C0(e)}function Cs(t){return 360*t-180}function bo(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Jw(t,e){return t*C0(bo(e))}const Er=85.051129;function Kw(t){return Math.cos(Xe(rt(t,-Er,Er)))}function ih(t,e){const n=rt(e,BD,ND),a=Math.pow(2,n);return Kw(t)*I0/(512*a)}function $w(t){return 1/Math.cos(t*Math.PI/180)}function $m(t,e=0){const n=Math.exp(Math.PI*(1-(t.y+e/Lt)/(1<<t.z)*2));return 80150034*n/(n*n+1)/Lt/(1<<t.z)}class Po{constructor(e,n,a=0){this.x=+e,this.y=+n,this.z=+a}static fromLngLat(e,n=0){const a=En.convert(e);return new Po(dl(a.lng),fl(a.lat),Ko(n,a.lat))}toLngLat(){return new En(Cs(this.x),bo(this.y))}toAltitude(){return Jw(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/I0*$w(bo(this.y))}}function P0(t,e,n,a,u,f,p,y,b){const T=(e+a)/2,E=(n+u)/2,I=new we(T,E);y(I),function(k,O,z,N,j,W){const ie=z-j,re=N-W;return Math.abs((N-O)*ie-(z-k)*re)/Math.hypot(ie,re)}(I.x,I.y,f.x,f.y,p.x,p.y)>=b?(P0(t,e,n,T,E,f,I,y,b),P0(t,T,E,a,u,I,p,y,b)):t.push(p)}function Qw(t,e,n){let a=t[0],u=a.x,f=a.y;e(a);const p=[a];for(let y=1;y<t.length;y++){const b=t[y],{x:T,y:E}=b;e(b),P0(p,u,f,T,E,a,b,e,n),u=T,f=E,a=b}return p}function k0(t,e,n,a){if(a(e,n)){const u=e.add(n)._mult(.5);k0(t,e,u,a),k0(t,u,n,a)}else t.push(n)}function VD(t,e){let n=t[0];const a=[n];for(let u=1;u<t.length;u++){const f=t[u];k0(a,n,f,e),n=f}return a}const D0=Math.pow(2,14)-1,eT=-D0-1;function UD(t,e){const n=Math.round(t.x*e),a=Math.round(t.y*e);return t.x=rt(n,eT,D0),t.y=rt(a,eT,D0),(n<t.x||n>t.x+1||a<t.y||a>t.y+1)&&ni("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function pl(t,e,n){const a=t.loadGeometry(),u=t.extent,f=Lt/u;if(e&&n&&n.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:y,x:b,y:T,projection:E}=n,I=k=>{const O=Cs((e.x+k.x/u)/p),z=bo((e.y+k.y/u)/p),N=E.project(O,z);k.x=(N.x*y-b)*u,k.y=(N.y*y-T)*u};for(let k=0;k<a.length;k++)if(t.type!==1)a[k]=Qw(a[k],I,1);else{const O=[];for(const z of a[k])z.x<0||z.x>=u||z.y<0||z.y>=u||(I(z),O.push(z));a[k]=O}}for(const p of a)for(const y of p)UD(y,f);return a}function Hc(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?pl(t):[]}}function Qm(t,e,n,a,u){t.emplaceBack(2*e+(a+1)/2,2*n+(u+1)/2)}function eg(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class L0{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Ni,this.indexArray=new kn,this.segments=new cr,this.programConfigurations=new Vc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,a,u){const f=this.layers[0],p=[];let y=null;f.type==="circle"&&(y=f.layout.get("circle-sort-key"));for(const{feature:T,id:E,index:I,sourceLayerIndex:k}of e){const O=this.layers[0]._featureFilter.needGeometry,z=Hc(T,O);if(!this.layers[0]._featureFilter.filter(new xe(this.zoom),z,a))continue;const N=y?y.evaluate(z,{},a):void 0,j={id:E,properties:T.properties,type:T.type,sourceLayerIndex:k,index:I,geometry:O?z.geometry:pl(T,a,u),patterns:{},sortKey:N};p.push(j)}y&&p.sort((T,E)=>T.sortKey-E.sortKey);let b=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new er,b=u.projection);for(const T of p){const{geometry:E,index:I,sourceLayerIndex:k}=T,O=e[I].feature;this.addFeature(T,E,I,n.availableImages,a,b,n.brightness),n.featureIndex.insert(O,E,I,k,this.index)}}update(e,n,a,u,f){const p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,a,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$k.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Qk.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,a,u,f,p,y){for(const b of n)for(const T of b){const E=T.x,I=T.y;if(E<0||E>=Lt||I<0||I>=Lt)continue;if(p){const z=p.projectTilePoint(E,I,f),N=p.upVector(f,E,I),j=this.globeExtVertexArray;eg(j,z,N),eg(j,z,N),eg(j,z,N),eg(j,z,N)}const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),O=k.vertexLength;Qm(this.layoutVertexArray,E,I,-1,-1),Qm(this.layoutVertexArray,E,I,1,-1),Qm(this.layoutVertexArray,E,I,1,1),Qm(this.layoutVertexArray,E,I,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+2,O+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},u,f,y)}}function tT(t,e){for(let n=0;n<t.length;n++)if(nh(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(nh(t,e[n]))return!0;return!!O0(t,e)}function jD(t,e,n){return!!nh(t,e)||!!R0(e,t,n)}function iT(t,e){if(t.length===1)return rT(e,t[0]);for(let n=0;n<e.length;n++){const a=e[n];for(let u=0;u<a.length;u++)if(nh(t,a[u]))return!0}for(let n=0;n<t.length;n++)if(rT(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(O0(t,e[n]))return!0;return!1}function GD(t,e,n){if(t.length>1){if(O0(t,e))return!0;for(let a=0;a<e.length;a++)if(R0(e[a],t,n))return!0}for(let a=0;a<t.length;a++)if(R0(t[a],e,n))return!0;return!1}function O0(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){const a=t[n],u=t[n+1];for(let f=0;f<e.length-1;f++)if(HD(a,u,e[f],e[f+1]))return!0}return!1}function HD(t,e,n,a){return Ve(t,n,a)!==Ve(e,n,a)&&Ve(t,e,n)!==Ve(t,e,a)}function R0(t,e,n){const a=n*n;if(e.length===1)return t.distSqr(e[0])<a;for(let u=1;u<e.length;u++)if(nT(t,e[u-1],e[u])<a)return!0;return!1}function nT(t,e,n){const a=e.distSqr(n);if(a===0)return t.distSqr(e);const u=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/a;return t.distSqr(u<0?e:u>1?n:n.sub(e)._mult(u)._add(e))}function rT(t,e){let n,a,u,f=!1;for(let p=0;p<t.length;p++){n=t[p];for(let y=0,b=n.length-1;y<n.length;b=y++)a=n[y],u=n[b],a.y>e.y!=u.y>e.y&&e.x<(u.x-a.x)*(e.y-a.y)/(u.y-a.y)+a.x&&(f=!f)}return f}function nh(t,e){let n=!1;for(let a=0,u=t.length-1;a<t.length;u=a++){const f=t[a],p=t[u];f.y>e.y!=p.y>e.y&&e.x<(p.x-f.x)*(e.y-f.y)/(p.y-f.y)+f.x&&(n=!n)}return n}function oT(t,e,n,a,u){for(const p of t)if(e<=p.x&&n<=p.y&&a>=p.x&&u>=p.y)return!0;const f=[new we(e,n),new we(e,u),new we(a,u),new we(a,n)];if(t.length>2){for(const p of f)if(nh(t,p))return!0}for(let p=0;p<t.length-1;p++)if(qD(t[p],t[p+1],f))return!0;return!1}function qD(t,e,n){const a=n[0],u=n[2];if(t.x<a.x&&e.x<a.x||t.x>u.x&&e.x>u.x||t.y<a.y&&e.y<a.y||t.y>u.y&&e.y>u.y)return!1;const f=Ve(t,e,n[0]);return f!==Ve(t,e,n[1])||f!==Ve(t,e,n[2])||f!==Ve(t,e,n[3])}function cd(t,e,n,a,u,f){let p=e.y-t.y,y=t.x-e.x;if(f=f||0){const b=p*p+y*y;if(b===0)return!0;const T=Math.sqrt(b);p/=T,y/=T}return!((n.x-t.x)*p+(n.y-t.y)*y-f<0||(a.x-t.x)*p+(a.y-t.y)*y-f<0||(u.x-t.x)*p+(u.y-t.y)*y-f<0)}function z0(t,e,n,a,u,f,p){return!(cd(t,e,a,u,f,p)||cd(e,n,a,u,f,p)||cd(n,t,a,u,f,p)||cd(a,u,t,e,n,p)||cd(u,f,t,e,n,p)||cd(f,a,t,e,n,p))}function ud(t,e,n){const a=e.paint.get(t).value;return a.kind==="constant"?a.value:n.programConfigurations.get(e.id).getMaxValue(t)}function tg(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function sT(t,e,n,a,u){if(!e[0]&&!e[1])return t;const f=we.convert(e)._mult(u);n==="viewport"&&f._rotate(-a);const p=[];for(let y=0;y<t.length;y++)p.push(t[y].sub(f));return p}function aT(t,e,n,a){const u=we.convert(t)._mult(a);return e==="viewport"&&u._rotate(-n),u}ri(L0,"CircleBucket",{omit:["layers"]});const WD=new _t({"circle-sort-key":new Fe(Ne.layout_circle["circle-sort-key"]),visibility:new me(Ne.layout_circle.visibility)});var ZD={paint:new _t({"circle-radius":new Fe(Ne.paint_circle["circle-radius"]),"circle-color":new Fe(Ne.paint_circle["circle-color"]),"circle-blur":new Fe(Ne.paint_circle["circle-blur"]),"circle-opacity":new Fe(Ne.paint_circle["circle-opacity"]),"circle-translate":new me(Ne.paint_circle["circle-translate"]),"circle-translate-anchor":new me(Ne.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new me(Ne.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new me(Ne.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Fe(Ne.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Fe(Ne.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Fe(Ne.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new me(Ne.paint_circle["circle-emissive-strength"])}),layout:WD};const XD=s.m.create(),lT=t=>{const e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function cT(t,e,n,a,u,f,p,y,b){if(f&&t.queryGeometry.isAboveHorizon)return!1;f&&(b*=t.pixelToTileUnitsFactor);const T=t.tileID.canonical,E=n.projection.upVectorScale(T,n.center.lat,n.worldSize).metersToTile;for(const I of e)for(const k of I){const O=k.add(y),z=u&&n.elevation?n.elevation.exaggeration()*u.getElevationAt(O.x,O.y,!0):0,N=n.projection.projectTilePoint(O.x,O.y,T);if(z>0){const re=n.projection.upVector(T,O.x,O.y);N.x+=re[0]*E*z,N.y+=re[1]*E*z,N.z+=re[2]*E*z}const j=f?O:YD(N.x,N.y,N.z,a),W=f?t.tilespaceRays.map(re=>KD(re,z)):t.queryGeometry.screenGeometry,ie=s.e.transformMat4([],[N.x,N.y,N.z,1],a);if(!p&&f?b*=ie[3]/n.cameraToCenterDistance:p&&!f&&(b*=n.cameraToCenterDistance/ie[3]),f){const re=bo((k.y/Lt+T.y)/(1<<T.z));b/=n.projection.pixelsPerMeter(re,1)/Ko(1,re)}if(jD(W,j,b))return!0}return!1}function YD(t,e,n,a){const u=s.e.transformMat4([],[t,e,n,1],a);return new we(u[0]/u[3],u[1]/u[3])}const uT=s.v.fromValues(0,0,0),JD=s.v.fromValues(0,0,1);function KD(t,e){const n=s.v.create();return uT[2]=e,t.intersectsPlane(uT,JD,n),new we(n[0],n[1])}class hT extends L0{}function dT(t,{width:e,height:n},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*n*a)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*n*a);return t.width=e,t.height=n,t.data=u,t}function fT(t,e,n){const{width:a,height:u}=e;a===t.width&&u===t.height||(F0(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,a),height:Math.min(t.height,u)},n),t.width=a,t.height=u,t.data=e.data)}function F0(t,e,n,a,u,f,p){if(u.width===0||u.height===0)return e;if(u.width>t.width||u.height>t.height||n.x>t.width-u.width||n.y>t.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||a.x>e.width-u.width||a.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const y=t.data,b=e.data,T=f===4&&p;for(let E=0;E<u.height;E++){const I=((n.y+E)*t.width+n.x)*f,k=((a.y+E)*e.width+a.x)*f;if(T)for(let O=0;O<u.width;O++){const z=I+O*f+3,N=k+O*f;b[N+0]=255,b[N+1]=255,b[N+2]=255,b[N+3]=y[z]}else for(let O=0;O<u.width*f;O++)b[k+O]=y[I+O]}return e}ri(hT,"HeatmapBucket",{omit:["layers"]});class sc{constructor(e,n){dT(this,e,1,n)}resize(e){fT(this,new sc(e),1)}clone(){return new sc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,u,f){F0(e,n,a,u,f,1)}}class Js{constructor(e,n){dT(this,e,4,n)}resize(e){fT(this,new Js(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Js({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,u,f,p){F0(e,n,a,u,f,4,p)}}class pT{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}ri(sc,"AlphaImage"),ri(Js,"RGBAImage");const $D=new _t({visibility:new me(Ne.layout_heatmap.visibility)});var QD={paint:new _t({"heatmap-radius":new Fe(Ne.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Fe(Ne.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new me(Ne.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Mt(Ne.paint_heatmap["heatmap-color"]),"heatmap-opacity":new me(Ne.paint_heatmap["heatmap-opacity"])}),layout:$D};function ig(t){const e={},n=t.resolution||256,a=t.clips?t.clips.length:1,u=t.image||new Js({width:n,height:a}),f=(p,y,b)=>{e[t.evaluationKey]=b;const T=t.expression.evaluate(e);T&&(u.data[p+y+0]=Math.floor(255*T.r/T.a),u.data[p+y+1]=Math.floor(255*T.g/T.a),u.data[p+y+2]=Math.floor(255*T.b/T.a),u.data[p+y+3]=Math.floor(255*T.a))};if(t.clips)for(let p=0,y=0;p<a;++p,y+=4*n)for(let b=0,T=0;b<n;b++,T+=4){const E=b/(n-1),{start:I,end:k}=t.clips[p];f(y,T,I*(1-E)+k*E)}else for(let p=0,y=0;p<n;p++,y+=4)f(0,y,p/(n-1));return u}const eL=new _t({visibility:new me(Ne.layout_hillshade.visibility)});var tL={paint:new _t({"hillshade-illumination-direction":new me(Ne.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new me(Ne.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new me(Ne.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new me(Ne.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new me(Ne.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new me(Ne.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new me(Ne.paint_hillshade["hillshade-emissive-strength"])}),layout:eL};const iL=di([{name:"a_pos",components:2,type:"Int16"}],4),{members:nL}=iL;var B0={exports:{}};function ng(t,e,n){n=n||2;var a,u,f,p,y,b,T,E=e&&e.length,I=E?e[0]*n:t.length,k=mT(t,0,I,n,!0),O=[];if(!k||k.next===k.prev)return O;if(E&&(k=function(N,j,W,ie){var re,se,de,ge=[];for(re=0,se=j.length;re<se;re++)(de=mT(N,j[re]*ie,re<se-1?j[re+1]*ie:N.length,ie,!1))===de.next&&(de.steiner=!0),ge.push(hL(de));for(ge.sort(lL),re=0;re<ge.length;re++)W=cL(ge[re],W);return W}(t,e,k,n)),t.length>80*n){a=f=t[0],u=p=t[1];for(var z=n;z<I;z+=n)(y=t[z])<a&&(a=y),(b=t[z+1])<u&&(u=b),y>f&&(f=y),b>p&&(p=b);T=(T=Math.max(f-a,p-u))!==0?32767/T:0}return jf(k,O,n,a,u,T,0),O}function mT(t,e,n,a,u){var f,p;if(u===U0(t,e,n,a)>0)for(f=e;f<n;f+=a)p=yT(f,t[f],t[f+1],p);else for(f=n-a;f>=e;f-=a)p=yT(f,t[f],t[f+1],p);return p&&rg(p,p.next)&&(Hf(p),p=p.next),p}function rh(t,e){if(!t)return t;e||(e=t);var n,a=t;do if(n=!1,a.steiner||!rg(a,a.next)&&Ur(a.prev,a,a.next)!==0)a=a.next;else{if(Hf(a),(a=e=a.prev)===a.next)break;n=!0}while(n||a!==e);return e}function jf(t,e,n,a,u,f,p){if(t){!p&&f&&function(E,I,k,O){var z=E;do z.z===0&&(z.z=N0(z.x,z.y,I,k,O)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==E);z.prevZ.nextZ=null,z.prevZ=null,function(N){var j,W,ie,re,se,de,ge,Se,ke=1;do{for(W=N,N=null,se=null,de=0;W;){for(de++,ie=W,ge=0,j=0;j<ke&&(ge++,ie=ie.nextZ);j++);for(Se=ke;ge>0||Se>0&&ie;)ge!==0&&(Se===0||!ie||W.z<=ie.z)?(re=W,W=W.nextZ,ge--):(re=ie,ie=ie.nextZ,Se--),se?se.nextZ=re:N=re,re.prevZ=se,se=re;W=ie}se.nextZ=null,ke*=2}while(de>1)}(z)}(t,a,u,f);for(var y,b,T=t;t.prev!==t.next;)if(y=t.prev,b=t.next,f?oL(t,a,u,f):rL(t))e.push(y.i/n|0),e.push(t.i/n|0),e.push(b.i/n|0),Hf(t),t=b.next,T=b.next;else if((t=b)===T){p?p===1?jf(t=sL(rh(t),e,n),e,n,a,u,f,2):p===2&&aL(t,e,n,a,u,f):jf(rh(t),e,n,a,u,f,1);break}}}function rL(t){var e=t.prev,n=t,a=t.next;if(Ur(e,n,a)>=0)return!1;for(var u=e.x,f=n.x,p=a.x,y=e.y,b=n.y,T=a.y,E=u<f?u<p?u:p:f<p?f:p,I=y<b?y<T?y:T:b<T?b:T,k=u>f?u>p?u:p:f>p?f:p,O=y>b?y>T?y:T:b>T?b:T,z=a.next;z!==e;){if(z.x>=E&&z.x<=k&&z.y>=I&&z.y<=O&&hd(u,y,f,b,p,T,z.x,z.y)&&Ur(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function oL(t,e,n,a){var u=t.prev,f=t,p=t.next;if(Ur(u,f,p)>=0)return!1;for(var y=u.x,b=f.x,T=p.x,E=u.y,I=f.y,k=p.y,O=y<b?y<T?y:T:b<T?b:T,z=E<I?E<k?E:k:I<k?I:k,N=y>b?y>T?y:T:b>T?b:T,j=E>I?E>k?E:k:I>k?I:k,W=N0(O,z,e,n,a),ie=N0(N,j,e,n,a),re=t.prevZ,se=t.nextZ;re&&re.z>=W&&se&&se.z<=ie;){if(re.x>=O&&re.x<=N&&re.y>=z&&re.y<=j&&re!==u&&re!==p&&hd(y,E,b,I,T,k,re.x,re.y)&&Ur(re.prev,re,re.next)>=0||(re=re.prevZ,se.x>=O&&se.x<=N&&se.y>=z&&se.y<=j&&se!==u&&se!==p&&hd(y,E,b,I,T,k,se.x,se.y)&&Ur(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;re&&re.z>=W;){if(re.x>=O&&re.x<=N&&re.y>=z&&re.y<=j&&re!==u&&re!==p&&hd(y,E,b,I,T,k,re.x,re.y)&&Ur(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;se&&se.z<=ie;){if(se.x>=O&&se.x<=N&&se.y>=z&&se.y<=j&&se!==u&&se!==p&&hd(y,E,b,I,T,k,se.x,se.y)&&Ur(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function sL(t,e,n){var a=t;do{var u=a.prev,f=a.next.next;!rg(u,f)&&gT(u,a,a.next,f)&&Gf(u,f)&&Gf(f,u)&&(e.push(u.i/n|0),e.push(a.i/n|0),e.push(f.i/n|0),Hf(a),Hf(a.next),a=t=f),a=a.next}while(a!==t);return rh(a)}function aL(t,e,n,a,u,f){var p=t;do{for(var y=p.next.next;y!==p.prev;){if(p.i!==y.i&&dL(p,y)){var b=_T(p,y);return p=rh(p,p.next),b=rh(b,b.next),jf(p,e,n,a,u,f,0),void jf(b,e,n,a,u,f,0)}y=y.next}p=p.next}while(p!==t)}function lL(t,e){return t.x-e.x}function cL(t,e){var n=function(u,f){var p,y=f,b=u.x,T=u.y,E=-1/0;do{if(T<=y.y&&T>=y.next.y&&y.next.y!==y.y){var I=y.x+(T-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(I<=b&&I>E&&(E=I,p=y.x<y.next.x?y:y.next,I===b))return p}y=y.next}while(y!==f);if(!p)return null;var k,O=p,z=p.x,N=p.y,j=1/0;y=p;do b>=y.x&&y.x>=z&&b!==y.x&&hd(T<N?b:E,T,z,N,T<N?E:b,T,y.x,y.y)&&(k=Math.abs(T-y.y)/(b-y.x),Gf(y,u)&&(k<j||k===j&&(y.x>p.x||y.x===p.x&&uL(p,y)))&&(p=y,j=k)),y=y.next;while(y!==O);return p}(t,e);if(!n)return e;var a=_T(n,t);return rh(a,a.next),rh(n,n.next)}function uL(t,e){return Ur(t.prev,t,e.prev)<0&&Ur(e.next,t,t.next)<0}function N0(t,e,n,a,u){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function hL(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function hd(t,e,n,a,u,f,p,y){return(u-p)*(e-y)>=(t-p)*(f-y)&&(t-p)*(a-y)>=(n-p)*(e-y)&&(n-p)*(f-y)>=(u-p)*(a-y)}function dL(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,a){var u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==a.i&&u.next.i!==a.i&&gT(u,u.next,n,a))return!0;u=u.next}while(u!==n);return!1}(t,e)&&(Gf(t,e)&&Gf(e,t)&&function(n,a){var u=n,f=!1,p=(n.x+a.x)/2,y=(n.y+a.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&p<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next;while(u!==n);return f}(t,e)&&(Ur(t.prev,t,e.prev)||Ur(t,e.prev,e))||rg(t,e)&&Ur(t.prev,t,t.next)>0&&Ur(e.prev,e,e.next)>0)}function Ur(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function rg(t,e){return t.x===e.x&&t.y===e.y}function gT(t,e,n,a){var u=sg(Ur(t,e,n)),f=sg(Ur(t,e,a)),p=sg(Ur(n,a,t)),y=sg(Ur(n,a,e));return u!==f&&p!==y||!(u!==0||!og(t,n,e))||!(f!==0||!og(t,a,e))||!(p!==0||!og(n,t,a))||!(y!==0||!og(n,e,a))}function og(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function sg(t){return t>0?1:t<0?-1:0}function Gf(t,e){return Ur(t.prev,t,t.next)<0?Ur(t,e,t.next)>=0&&Ur(t,t.prev,e)>=0:Ur(t,e,t.prev)<0||Ur(t,t.next,e)<0}function _T(t,e){var n=new V0(t.i,t.x,t.y),a=new V0(e.i,e.x,e.y),u=t.next,f=e.prev;return t.next=e,e.prev=t,n.next=u,u.prev=n,a.next=n,n.prev=a,f.next=a,a.prev=f,a}function yT(t,e,n,a){var u=new V0(t,e,n);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function Hf(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function V0(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function U0(t,e,n,a){for(var u=0,f=e,p=n-a;f<n;f+=a)u+=(t[p]-t[f])*(t[f+1]+t[p+1]),p=f;return u}B0.exports=ng,B0.exports.default=ng,ng.deviation=function(t,e,n,a){var u=e&&e.length,f=Math.abs(U0(t,0,u?e[0]*n:t.length,n));if(u)for(var p=0,y=e.length;p<y;p++)f-=Math.abs(U0(t,e[p]*n,p<y-1?e[p+1]*n:t.length,n));var b=0;for(p=0;p<a.length;p+=3){var T=a[p]*n,E=a[p+1]*n,I=a[p+2]*n;b+=Math.abs((t[T]-t[I])*(t[E+1]-t[T+1])-(t[T]-t[E])*(t[I+1]-t[T+1]))}return f===0&&b===0?0:Math.abs((b-f)/f)},ng.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},a=0,u=0;u<t.length;u++){for(var f=0;f<t[u].length;f++)for(var p=0;p<e;p++)n.vertices.push(t[u][f][p]);u>0&&n.holes.push(a+=t[u-1].length)}return n};var ag=fe(B0.exports);function j0(t,e){const n=t.length;if(n<=1)return[t];const a=[];let u,f;for(let p=0;p<n;p++){const y=ne(t[p]);y!==0&&(t[p].area=Math.abs(y),f===void 0&&(f=y<0),f===y<0?(u&&a.push(u),u=[t[p]]):u.push(t[p]))}if(u&&a.push(u),e>1)for(let p=0;p<a.length;p++)a[p].length<=e||(zl(a[p],e,1,a[p].length-1,fL),a[p]=a[p].slice(0,e));return a}function fL(t,e){return e.area-t.area}function G0(t,e,n){const a=n.patternDependencies;let u=!1;for(const f of e){const p=f.paint.get(`${t}-pattern`);p.isConstant()||(u=!0);const y=p.constantOr(null);y&&(u=!0,a[y]=!0)}return u}function H0(t,e,n,a,u){const f=u.patternDependencies;for(const p of e){const y=p.paint.get(`${t}-pattern`).value;if(y.kind!=="constant"){let b=y.evaluate({zoom:a},n,{},u.availableImages);b=b&&b.name?b.name:b,f[b]=!0,n.patterns[p.id]=b}}return n}class lg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ni,this.indexArray=new kn,this.indexArray2=new Bo,this.programConfigurations=new Vc(e.layers,e.zoom),this.segments=new cr,this.segments2=new cr,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,a,u){this.hasPattern=G0("fill",this.layers,n);const f=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:y,id:b,index:T,sourceLayerIndex:E}of e){const I=this.layers[0]._featureFilter.needGeometry,k=Hc(y,I);if(!this.layers[0]._featureFilter.filter(new xe(this.zoom),k,a))continue;const O=f?f.evaluate(k,{},a,n.availableImages):void 0,z={id:b,properties:y.properties,type:y.type,sourceLayerIndex:E,index:T,geometry:I?k.geometry:pl(y,a,u),patterns:{},sortKey:O};p.push(z)}f&&p.sort((y,b)=>y.sortKey-b.sortKey);for(const y of p){const{geometry:b,index:T,sourceLayerIndex:E}=y;if(this.hasPattern){const I=H0("fill",this.layers,y,this.zoom,n);this.patternFeatures.push(I)}else this.addFeature(y,b,T,a,{},n.availableImages,n.brightness);n.featureIndex.insert(e[T].feature,b,T,E,this.index)}}update(e,n,a,u,f){const p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,a,u,f)}addFeatures(e,n,a,u,f,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,a,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nL),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,a,u,f,p=[],y){for(const b of j0(n,500)){let T=0;for(const N of b)T+=N.length;const E=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),I=E.vertexLength,k=[],O=[];for(const N of b){if(N.length===0)continue;N!==b[0]&&O.push(k.length/2);const j=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),W=j.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(W+N.length-1,W),k.push(N[0].x),k.push(N[0].y);for(let ie=1;ie<N.length;ie++)this.layoutVertexArray.emplaceBack(N[ie].x,N[ie].y),this.indexArray2.emplaceBack(W+ie-1,W+ie),k.push(N[ie].x),k.push(N[ie].y);j.vertexLength+=N.length,j.primitiveLength+=N.length}const z=ag(k,O);for(let N=0;N<z.length;N+=3)this.indexArray.emplaceBack(I+z[N],I+z[N+1],I+z[N+2]);E.vertexLength+=T,E.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,p,u,y)}}ri(lg,"FillBucket",{omit:["layers","patternFeatures"]});const pL=new _t({"fill-sort-key":new Fe(Ne.layout_fill["fill-sort-key"]),visibility:new me(Ne.layout_fill.visibility)});var mL={paint:new _t({"fill-antialias":new me(Ne.paint_fill["fill-antialias"]),"fill-opacity":new Fe(Ne.paint_fill["fill-opacity"]),"fill-color":new Fe(Ne.paint_fill["fill-color"]),"fill-outline-color":new Fe(Ne.paint_fill["fill-outline-color"]),"fill-translate":new me(Ne.paint_fill["fill-translate"]),"fill-translate-anchor":new me(Ne.paint_fill["fill-translate-anchor"]),"fill-pattern":new Fe(Ne.paint_fill["fill-pattern"]),"fill-emissive-strength":new me(Ne.paint_fill["fill-emissive-strength"])}),layout:pL};const gL=di([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),_L=di([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),yL=di([{name:"a_centroid_pos",components:2,type:"Uint16"}]),vL=di([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),xL=di([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:bL}=gL;var cg={},wL=We,vT=dd;function dd(t,e,n,a,u){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=a,this._values=u,t.readFields(TL,this,e)}function TL(t,e,n){t==1?e.id=n.readVarint():t==2?function(a,u){for(var f=a.readVarint()+a.pos;a.pos<f;){var p=u._keys[a.readVarint()],y=u._values[a.readVarint()];u.properties[p]=y}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function SL(t){for(var e,n,a=0,u=0,f=t.length,p=f-1;u<f;p=u++)a+=((n=t[p]).x-(e=t[u]).x)*(e.y+n.y);return a}dd.types=["Unknown","Point","LineString","Polygon"],dd.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,a=1,u=0,f=0,p=0,y=[];t.pos<n;){if(u<=0){var b=t.readVarint();a=7&b,u=b>>3}if(u--,a===1||a===2)f+=t.readSVarint(),p+=t.readSVarint(),a===1&&(e&&y.push(e),e=[]),e.push(new wL(f,p));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&y.push(e),y},dd.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,a=0,u=0,f=0,p=1/0,y=-1/0,b=1/0,T=-1/0;t.pos<e;){if(a<=0){var E=t.readVarint();n=7&E,a=E>>3}if(a--,n===1||n===2)(u+=t.readSVarint())<p&&(p=u),u>y&&(y=u),(f+=t.readSVarint())<b&&(b=f),f>T&&(T=f);else if(n!==7)throw new Error("unknown command "+n)}return[p,b,y,T]},dd.prototype.toGeoJSON=function(t,e,n){var a,u,f=this.extent*Math.pow(2,n),p=this.extent*t,y=this.extent*e,b=this.loadGeometry(),T=dd.types[this.type];function E(O){for(var z=0;z<O.length;z++){var N=O[z];O[z]=[360*(N.x+p)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(N.y+y)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(a=0;a<b.length;a++)I[a]=b[a][0];E(b=I);break;case 2:for(a=0;a<b.length;a++)E(b[a]);break;case 3:for(b=function(O){var z=O.length;if(z<=1)return[O];for(var N,j,W=[],ie=0;ie<z;ie++){var re=SL(O[ie]);re!==0&&(j===void 0&&(j=re<0),j===re<0?(N&&W.push(N),N=[O[ie]]):N.push(O[ie]))}return N&&W.push(N),W}(b),a=0;a<b.length;a++)for(u=0;u<b[a].length;u++)E(b[a][u])}b.length===1?b=b[0]:T="Multi"+T;var k={type:"Feature",geometry:{type:T,coordinates:b},properties:this.properties};return"id"in this&&(k.id=this.id),k};var ML=vT,xT=bT;function bT(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(EL,this,e),this.length=this._features.length}function EL(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(a){for(var u=null,f=a.readVarint()+a.pos;a.pos<f;){var p=a.readVarint()>>3;u=p===1?a.readString():p===2?a.readFloat():p===3?a.readDouble():p===4?a.readVarint64():p===5?a.readVarint():p===6?a.readSVarint():p===7?a.readBoolean():null}return u}(n))}bT.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new ML(this._pbf,e,this.extent,this._keys,this._values)};var AL=xT;function IL(t,e,n){if(t===3){var a=new AL(n,n.readVarint()+n.pos);a.length&&(e[a.name]=a)}}var q0=cg.VectorTile=function(t,e){this.layers=t.readFields(IL,{},e)},ug=cg.VectorTileFeature=vT;function hg(t,e,n,a){const u=[],f=a===0?(p,y,b,T,E,I)=>{p.push(new we(I,b+(I-y)/(T-y)*(E-b)))}:(p,y,b,T,E,I)=>{p.push(new we(y+(I-b)/(E-b)*(T-y),I))};for(const p of t){const y=[];for(const b of p){if(b.length<=2)continue;const T=[];for(let k=0;k<b.length-1;k++){const O=b[k].x,z=b[k].y,N=b[k+1].x,j=b[k+1].y,W=a===0?O:z,ie=a===0?N:j;W<e?ie>e&&f(T,O,z,N,j,e):W>n?ie<n&&f(T,O,z,N,j,n):T.push(b[k]),ie<e&&W>=e&&f(T,O,z,N,j,e),ie>n&&W<=n&&f(T,O,z,N,j,n)}let E=b[b.length-1];const I=a===0?E.x:E.y;I>=e&&I<=n&&T.push(E),T.length&&(E=T[T.length-1],T[0].x===E.x&&T[0].y===E.y||T.push(T[0]),y.push(T))}y.length&&u.push(y)}return u}cg.VectorTileLayer=xT;class wT{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const a=e[n];this._stringToNumber[a]=n,this._numberToString[n]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var CL={read:function(t,e,n,a,u){var f,p,y=8*u-a-1,b=(1<<y)-1,T=b>>1,E=-7,I=n?u-1:0,k=n?-1:1,O=t[e+I];for(I+=k,f=O&(1<<-E)-1,O>>=-E,E+=y;E>0;f=256*f+t[e+I],I+=k,E-=8);for(p=f&(1<<-E)-1,f>>=-E,E+=a;E>0;p=256*p+t[e+I],I+=k,E-=8);if(f===0)f=1-T;else{if(f===b)return p?NaN:1/0*(O?-1:1);p+=Math.pow(2,a),f-=T}return(O?-1:1)*p*Math.pow(2,f-a)},write:function(t,e,n,a,u,f){var p,y,b,T=8*f-u-1,E=(1<<T)-1,I=E>>1,k=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=a?0:f-1,z=a?1:-1,N=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,p=E):(p=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-p))<1&&(p--,b*=2),(e+=p+I>=1?k/b:k*Math.pow(2,1-I))*b>=2&&(p++,b/=2),p+I>=E?(y=0,p=E):p+I>=1?(y=(e*b-1)*Math.pow(2,u),p+=I):(y=e*Math.pow(2,I-1)*Math.pow(2,u),p=0));u>=8;t[n+O]=255&y,O+=z,y/=256,u-=8);for(p=p<<u|y,T+=u;T>0;t[n+O]=255&p,O+=z,p/=256,T-=8);t[n+O-z]|=128*N}},TT=tr,dg=CL;function tr(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}tr.Varint=0,tr.Fixed64=1,tr.Bytes=2,tr.Fixed32=5;var W0=4294967296,ST=1/W0,MT=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ac(t){return t.type===tr.Bytes?t.readVarint()+t.pos:t.pos+1}function fd(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function ET(t,e,n){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(a);for(var u=n.pos-1;u>=t;u--)n.buf[u+a]=n.buf[u]}function PL(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function kL(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function DL(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function LL(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function OL(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function RL(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function zL(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function FL(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function BL(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function fg(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function pd(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function AT(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}tr.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var a=this.readVarint(),u=a>>3,f=this.pos;this.type=7&a,t(u,e,this),this.pos===f&&this.skip(a)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=fg(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=AT(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=fg(this.buf,this.pos)+fg(this.buf,this.pos+4)*W0;return this.pos+=8,t},readSFixed64:function(){var t=fg(this.buf,this.pos)+AT(this.buf,this.pos+4)*W0;return this.pos+=8,t},readFloat:function(){var t=dg.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=dg.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,a=this.buf;return e=127&(n=a[this.pos++]),n<128?e:(e|=(127&(n=a[this.pos++]))<<7,n<128?e:(e|=(127&(n=a[this.pos++]))<<14,n<128?e:(e|=(127&(n=a[this.pos++]))<<21,n<128?e:function(u,f,p){var y,b,T=p.buf;if(y=(112&(b=T[p.pos++]))>>4,b<128||(y|=(127&(b=T[p.pos++]))<<3,b<128)||(y|=(127&(b=T[p.pos++]))<<10,b<128)||(y|=(127&(b=T[p.pos++]))<<17,b<128)||(y|=(127&(b=T[p.pos++]))<<24,b<128)||(y|=(1&(b=T[p.pos++]))<<31,b<128))return fd(u,y,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=a[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&MT?function(n,a,u){return MT.decode(n.subarray(a,u))}(this.buf,e,t):function(n,a,u){for(var f="",p=a;p<u;){var y,b,T,E=n[p],I=null,k=E>239?4:E>223?3:E>191?2:1;if(p+k>u)break;k===1?E<128&&(I=E):k===2?(192&(y=n[p+1]))==128&&(I=(31&E)<<6|63&y)<=127&&(I=null):k===3?(b=n[p+2],(192&(y=n[p+1]))==128&&(192&b)==128&&((I=(15&E)<<12|(63&y)<<6|63&b)<=2047||I>=55296&&I<=57343)&&(I=null)):k===4&&(b=n[p+2],T=n[p+3],(192&(y=n[p+1]))==128&&(192&b)==128&&(192&T)==128&&((I=(15&E)<<18|(63&y)<<12|(63&b)<<6|63&T)<=65535||I>=1114112)&&(I=null)),I===null?(I=65533,k=1):I>65535&&(I-=65536,f+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),f+=String.fromCharCode(I),p+=k}return f}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==tr.Bytes)return t.push(this.readVarint(e));var n=ac(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==tr.Bytes)return t.push(this.readSVarint());var e=ac(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==tr.Bytes)return t.push(this.readBoolean());var e=ac(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==tr.Bytes)return t.push(this.readFloat());var e=ac(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==tr.Bytes)return t.push(this.readDouble());var e=ac(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==tr.Bytes)return t.push(this.readFixed32());var e=ac(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==tr.Bytes)return t.push(this.readSFixed32());var e=ac(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==tr.Bytes)return t.push(this.readFixed64());var e=ac(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==tr.Bytes)return t.push(this.readSFixed64());var e=ac(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===tr.Varint)for(;this.buf[this.pos++]>127;);else if(e===tr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===tr.Fixed32)this.pos+=4;else{if(e!==tr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),pd(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),pd(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),pd(this.buf,-1&t,this.pos),pd(this.buf,Math.floor(t*ST),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),pd(this.buf,-1&t,this.pos),pd(this.buf,Math.floor(t*ST),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var a,u;if(e>=0?(a=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(f,p,y){y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,y.buf[y.pos]=127&(f>>>=7)}(a,0,n),function(f,p){var y=(7&f)<<4;p.buf[p.pos++]|=y|((f>>>=3)?128:0),f&&(p.buf[p.pos++]=127&f|((f>>>=7)?128:0),f&&(p.buf[p.pos++]=127&f|((f>>>=7)?128:0),f&&(p.buf[p.pos++]=127&f|((f>>>=7)?128:0),f&&(p.buf[p.pos++]=127&f|((f>>>=7)?128:0),f&&(p.buf[p.pos++]=127&f)))))}(u,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(a,u,f){for(var p,y,b=0;b<u.length;b++){if((p=u.charCodeAt(b))>55295&&p<57344){if(!y){p>56319||b+1===u.length?(a[f++]=239,a[f++]=191,a[f++]=189):y=p;continue}if(p<56320){a[f++]=239,a[f++]=191,a[f++]=189,y=p;continue}p=y-55296<<10|p-56320|65536,y=null}else y&&(a[f++]=239,a[f++]=191,a[f++]=189,y=null);p<128?a[f++]=p:(p<2048?a[f++]=p>>6|192:(p<65536?a[f++]=p>>12|224:(a[f++]=p>>18|240,a[f++]=p>>12&63|128),a[f++]=p>>6&63|128),a[f++]=63&p|128)}return f}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&ET(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),dg.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),dg.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var a=this.pos-n;a>=128&&ET(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a},writeMessage:function(t,e,n){this.writeTag(t,tr.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,PL,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,kL,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,OL,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,DL,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,LL,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,RL,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,zL,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,FL,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,BL,e)},writeBytesField:function(t,e){this.writeTag(t,tr.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,tr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,tr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,tr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,tr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,tr.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,tr.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,tr.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,tr.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,tr.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var pg=fe(TT);const NL=["tile","layer","source","sourceLayer","state"];class IT{constructor(e,n,a,u,f){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=a,this._y=u,this.properties=e.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const n of NL)this[n]!==void 0&&(e[n]=this[n]);return e}}class VL{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,a){const u=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},Ye(this.stateChanges[e][u],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const f in this.state[e])f!==u&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const f in this.state[e][u])a[f]||(this.deletedStates[e][u][f]=null)}else for(const f in a)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][f]===null&&delete this.deletedStates[e][u][f]}removeFeatureState(e,n,a){if(this.deletedStates[e]===null)return;const u=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&n!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][a]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(a in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][a]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,n){const a=String(n),u=Ye({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const f=this.deletedStates[e][n];if(f===null)return{};for(const p in f)delete u[p]}return u}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const a={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const f={};for(const p in this.stateChanges[u])this.state[u][p]||(this.state[u][p]={}),Ye(this.state[u][p],this.stateChanges[u][p]),f[p]=this.state[u][p];a[u]=f}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const f={};if(this.deletedStates[u]===null)for(const p in this.state[u])f[p]={},this.state[u][p]={};else for(const p in this.deletedStates[u]){if(this.deletedStates[u][p]===null)this.state[u][p]={};else if(this.state[u][p])for(const y of Object.keys(this.deletedStates[u][p]))delete this.state[u][p][y];f[p]=this.state[u][p]}a[u]=a[u]||{},Ye(a[u],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const u in e)e[u].setFeatureState(a,n)}}class CT{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const a=this.toIdx(e,n);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function PT(t,e,n,a){let u=0,f=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(a[p])<1e-15){if(n[p]<t[p]||n[p]>e[p])return null}else{const y=1/a[p];let b=(t[p]-n[p])*y,T=(e[p]-n[p])*y;if(b>T){const E=b;b=T,T=E}if(b>u&&(u=b),T<f&&(f=T),u>f)return null}return u}function kT(t,e,n,a,u,f,p,y,b,T,E){const I=a-t,k=u-e,O=f-n,z=p-t,N=y-e,j=b-n,W=E[1]*j-E[2]*N,ie=E[2]*z-E[0]*j,re=E[0]*N-E[1]*z,se=I*W+k*ie+O*re;if(Math.abs(se)<1e-15)return null;const de=1/se,ge=T[0]-t,Se=T[1]-e,ke=T[2]-n,Re=(ge*W+Se*ie+ke*re)*de;if(Re<0||Re>1)return null;const Ze=Se*O-ke*k,Be=ke*I-ge*O,ut=ge*k-Se*I,Pt=(E[0]*Ze+E[1]*Be+E[2]*ut)*de;return Pt<0||Re+Pt>1?null:(z*Ze+N*Be+j*ut)*de}function DT(t,e,n){return(t-e)/(n-e)}function LT(t,e,n,a,u,f,p,y,b){const T=1<<n,E=f-a,I=p-u,k=(t+1)/T*E+a,O=(e+0)/T*I+u,z=(e+1)/T*I+u;y[0]=(t+0)/T*E+a,y[1]=O,b[0]=k,b[1]=z}class OT{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(f){const p=Math.ceil(Math.log2(f.dim/8)),y=[];let b=Math.ceil(Math.pow(2,p));const T=1/b,E=(O,z,N,j,W)=>{const ie=j?1:0,re=(O+1)*N-ie,se=z*N,de=(z+1)*N-ie;W[0]=O*N,W[1]=se,W[2]=re,W[3]=de};let I=new CT(b);const k=[];for(let O=0;O<b*b;O++){E(O%b,Math.floor(O/b),T,!1,k);const z=qc(k[0],k[1],f),N=qc(k[2],k[1],f),j=qc(k[2],k[3],f),W=qc(k[0],k[3],f);I.minimums.push(Math.min(z,N,j,W)),I.maximums.push(Math.max(z,N,j,W)),I.leaves.push(1)}for(y.push(I),b/=2;b>=1;b/=2){const O=y[y.length-1];I=new CT(b);for(let z=0;z<b*b;z++){E(z%b,Math.floor(z/b),2,!0,k);const N=O.getElevation(k[0],k[1]),j=O.getElevation(k[2],k[1]),W=O.getElevation(k[2],k[3]),ie=O.getElevation(k[0],k[3]),re=O.isLeaf(k[0],k[1]),se=O.isLeaf(k[2],k[1]),de=O.isLeaf(k[2],k[3]),ge=O.isLeaf(k[0],k[3]),Se=Math.min(N.min,j.min,W.min,ie.min),ke=Math.max(N.max,j.max,W.max,ie.max),Re=re&&se&&de&&ge;I.maximums.push(ke),I.minimums.push(Se),I.leaves.push(ke-Se<=5&&Re?1:0)}y.push(I)}return y}(this.dem),a=n.length-1,u=n[a];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(n,0,0,a,0)}raycastRoot(e,n,a,u,f,p,y=1){return PT([e,n,-100],[a,u,this.maximums[0]*y],f,p)}raycast(e,n,a,u,f,p,y=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,n,a,u,f,p,y);if(b==null)return null;const T=[],E=[],I=[],k=[],O=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;O.length>0;){const{idx:z,t:N,nodex:j,nodey:W,depth:ie}=O.pop();if(this.leaves[z]){LT(j,W,ie,e,n,a,u,I,k);const se=1<<ie,de=(j+0)/se,ge=(j+1)/se,Se=(W+0)/se,ke=(W+1)/se,Re=qc(de,Se,this.dem)*y,Ze=qc(ge,Se,this.dem)*y,Be=qc(ge,ke,this.dem)*y,ut=qc(de,ke,this.dem)*y,Pt=kT(I[0],I[1],Re,k[0],I[1],Ze,k[0],k[1],Be,f,p),st=kT(k[0],k[1],Be,I[0],k[1],ut,I[0],I[1],Re,f,p),St=Math.min(Pt!==null?Pt:Number.MAX_VALUE,st!==null?st:Number.MAX_VALUE);if(St!==Number.MAX_VALUE)return St;{const ot=s.v.scaleAndAdd([],f,p,N);if(RT(Re,Ze,ut,Be,DT(ot[0],I[0],k[0]),DT(ot[1],I[1],k[1]))>=ot[2])return N}continue}let re=0;for(let se=0;se<this._siblingOffset.length;se++){LT((j<<1)+this._siblingOffset[se][0],(W<<1)+this._siblingOffset[se][1],ie+1,e,n,a,u,I,k),I[2]=-100,k[2]=this.maximums[this.childOffsets[z]+se]*y;const de=PT(I,k,f,p);if(de!=null){const ge=de;T[se]=ge;let Se=!1;for(let ke=0;ke<re&&!Se;ke++)ge>=T[E[ke]]&&(E.splice(ke,0,se),Se=!0);Se||(E[re]=se),re++}}for(let se=0;se<re;se++){const de=E[se];O.push({idx:this.childOffsets[z]+de,t:T[de],nodex:(j<<1)+this._siblingOffset[de][0],nodey:(W<<1)+this._siblingOffset[de][1],depth:ie+1})}}return null}_addNode(e,n,a){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,a,u,f){if(e[u].isLeaf(n,a)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const p=u-1,y=e[p];let b=0,T=0;for(let E=0;E<this._siblingOffset.length;E++){const I=2*n+this._siblingOffset[E][0],k=2*a+this._siblingOffset[E][1],O=y.getElevation(I,k),z=y.isLeaf(I,k),N=this._addNode(O.min,O.max,z);z&&(b|=1<<E),T||(T=N)}for(let E=0;E<this._siblingOffset.length;E++)b&1<<E||this._construct(e,2*n+this._siblingOffset[E][0],2*a+this._siblingOffset[E][1],p,T+E)}}function RT(t,e,n,a,u,f){return Wi(Wi(t,n,f),Wi(e,a,f),u)}function qc(t,e,n){const a=n.dim,u=rt(t*a-.5,0,a-1),f=rt(e*a-.5,0,a-1),p=Math.floor(u),y=Math.floor(f),b=Math.min(p+1,a-1),T=Math.min(y+1,a-1);return RT(n.get(p,y),n.get(b,y),n.get(p,T),n.get(b,T),u-p,f-y)}const UL={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function jL(t,e,n){return(256*t*256+256*e+n)/10-1e4}function GL(t,e,n){return 256*t+e+n/256-32768}class mg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,a,u=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return ni(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const f=this.dim=n.height-2,p=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let b=0;b<f;b++)p[this._idx(-1,b)]=p[this._idx(0,b)],p[this._idx(f,b)]=p[this._idx(f-1,b)],p[this._idx(b,-1)]=p[this._idx(b,0)],p[this._idx(b,f)]=p[this._idx(b,f-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(f,-1)]=p[this._idx(f-1,0)],p[this._idx(-1,f)]=p[this._idx(0,f-1)],p[this._idx(f,f)]=p[this._idx(f-1,f-1)]}const y=a==="terrarium"?GL:jL;for(let b=0;b<p.length;++b){const T=4*b;this.floatView[b]=y(this.pixels[T],this.pixels[T+1],this.pixels[T+2])}this._timestamp=uo.now()}_buildQuadTree(){this._tree=new OT(this)}get(e,n,a=!1){a&&(e=rt(e,-1,this.dim),n=rt(n,-1,this.dim));const u=this._idx(e,n);return this.floatView[u]}set(e,n,a){const u=this._idx(e,n),f=this.floatView[u];return this.floatView[u]=a,a-f}static getUnpackVector(e){return UL[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const a=[0,0,0,0],u=mg.getUnpackVector(n);let f=Math.floor((e+u[3])/u[2]);return a[2]=f%256,f=Math.floor(f/256),a[1]=f%256,f=Math.floor(f/256),a[0]=f,a}getPixels(){return new pT({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,f=n*this.dim+this.dim,p=a*this.dim,y=a*this.dim+this.dim;switch(n){case-1:u=f-1;break;case 1:f=u+1}switch(a){case-1:p=y-1;break;case 1:y=p+1}const b=-n*this.dim,T=-a*this.dim;for(let E=p;E<y;E++)for(let I=u;I<f;I++){const k=4*this._idx(I,E),O=4*this._idx(I+b,E+T);this.pixels[k+0]=e.pixels[O+0],this.pixels[k+1]=e.pixels[O+1],this.pixels[k+2]=e.pixels[O+2],this.pixels[k+3]=e.pixels[O+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ri(mg,"DEMData"),ri(OT,"DemMinMaxQuadTree",{omit:["dem"]});class md{constructor(e,n,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=a}static create(e,n,a){const u=a||e.findDEMTileFor(n);if(!u||!u.dem)return;const f=u.dem,p=u.tileID,y=1<<n.canonical.z-p.canonical.z;return new md(u,f.dim/Lt/y,[(n.canonical.x/y-p.canonical.x)*f.dim,(n.canonical.y/y-p.canonical.y)*f.dim])}tileCoordToPixel(e,n){const a=n*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(a);return new we(u,f)}getElevationAt(e,n,a,u){const f=e*this._scale+this._offset[0],p=n*this._scale+this._offset[1],y=Math.floor(f),b=Math.floor(p),T=this._dem;return u=!!u,a?Wi(Wi(T.get(y,b,u),T.get(y,b+1,u),p-b),Wi(T.get(y+1,b,u),T.get(y+1,b+1,u),p-b),f-y):T.get(y,b,u)}getElevationAtPixel(e,n,a){return this._dem.get(e,n,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Ko(1,e)*this._dem.stride}}class Z0{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Bc(Lt,16,0),this.featureIndexArray=new h1,this.promoteId=n}insert(e,n,a,u,f,p=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,f,p);const b=this.grid;for(let T=0;T<n.length;T++){const E=n[T],I=[1/0,1/0,-1/0,-1/0];for(let k=0;k<E.length;k++){const O=E[k];I[0]=Math.min(I[0],O.x),I[1]=Math.min(I[1],O.y),I[2]=Math.max(I[2],O.x),I[3]=Math.max(I[3],O.y)}I[0]<Lt&&I[1]<Lt&&I[2]>=0&&I[3]>=0&&b.insert(y,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new q0(new pg(this.rawTileData)).layers,this.sourceLayerCoder=new wT(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,a,u){this.loadVTLayers();const f=e.params||{},p=ed(f.filter),y=e.tileResult,b=e.transform,T=y.bufferedTilespaceBounds,E=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(z,N,j,W)=>oT(y.bufferedTilespaceGeometry,z,N,j,W));E.sort(HL);let I=null;b.elevation&&E.length>0&&(I=md.create(b.elevation,this.tileID));const k={};let O;for(let z=0;z<E.length;z++){const N=E[z];if(N===O)continue;O=N;const j=this.featureIndexArray.get(N);let W=null;this.loadMatchingFeature(k,j,p,f.layers,f.availableImages,n,a,u,(ie,re,se,de=0)=>(W||(W=pl(ie,this.tileID.canonical,e.tileTransform)),re.queryIntersectsFeature(y,ie,se,W,this.z,e.transform,e.pixelPosMatrix,I,de)))}return k}loadMatchingFeature(e,n,a,u,f,p,y,b,T){const{featureIndex:E,bucketIndex:I,sourceLayerIndex:k,layoutVertexArrayOffset:O}=n,z=this.bucketLayerIDs[I];if(u&&!function(ie,re){for(let se=0;se<ie.length;se++)if(re.indexOf(ie[se])>=0)return!0;return!1}(u,z))return;const N=this.sourceLayerCoder.decode(k),j=this.vtLayers[N].feature(E);if(a.needGeometry){const ie=Hc(j,!0);if(!a.filter(new xe(this.tileID.overscaledZ),ie,this.tileID.canonical))return}else if(!a.filter(new xe(this.tileID.overscaledZ),j))return;const W=this.getId(j,N);for(let ie=0;ie<z.length;ie++){const re=z[ie];if(u&&u.indexOf(re)<0)continue;const se=p[re];if(!se)continue;let de={};W!==void 0&&b&&(de=b.getState(se.sourceLayer||"_geojsonTileLayer",W));const ge=Ye({},y[re]);ge.paint=zT(ge.paint,se.paint,j,de,f),ge.layout=zT(ge.layout,se.layout,j,de,f);const Se=!T||T(j,se,de,O);if(!Se)continue;const ke=new IT(j,this.z,this.x,this.y,W);ke.layer=ge;let Re=e[re];Re===void 0&&(Re=e[re]=[]),Re.push({featureIndex:E,feature:ke,intersectionZ:Se})}}lookupSymbolFeatures(e,n,a,u,f,p,y,b){const T={};this.loadVTLayers();const E=ed(f);for(const I of e)this.loadMatchingFeature(T,{bucketIndex:a,sourceLayerIndex:u,featureIndex:I,layoutVertexArrayOffset:0},E,p,y,b,n);return T}loadFeature(e){const{featureIndex:n,sourceLayerIndex:a}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(a),f=this.vtFeatures[u];if(f[n])return f[n];const p=this.vtLayers[u].feature(n);return f[n]=p,p}hasLayer(e){for(const n of this.bucketLayerIDs)for(const a of n)if(e===a)return!0;return!1}getId(e,n){let a=e.id;if(this.promoteId){const u=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];u!=null&&(a=e.properties[u]),typeof a=="boolean"&&(a=Number(a))}return a}}function zT(t,e,n,a,u){return dr(t,(f,p)=>{const y=e instanceof dt?e.get(p):null;return y&&y.evaluate?y.evaluate(n,a,u):y})}function HL(t,e){return e-t}ri(Z0,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const qL=di([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),WL=di([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),ZL=di([{name:"a_projected_pos",components:4,type:"Float32"}],4);di([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const XL=di([{name:"a_z_offset",components:1,type:"Float32"}],4),YL=di([{name:"a_texb",components:2,type:"Uint16"}]),JL=di([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),KL=di([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);di([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const FT=di([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$L=di([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);di([{name:"triangle",components:3,type:"Uint16"}]),di([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),di([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),di([{type:"Float32",name:"offsetX"}]),di([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var wo=24;const Ba=128;function X0(t,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new xe(t+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:u}=n;let f=0;for(;f<a.length&&a[f]<=t;)f++;f=Math.max(0,f-1);let p=f;for(;p<a.length&&a[p]<t+1;)p++;p=Math.min(a.length-1,p);const y=a[f],b=a[p];return n.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:b,minSize:n.evaluate(new xe(y)),maxSize:n.evaluate(new xe(b)),interpolationType:u}}}function gg(t,{uSize:e,uSizeT:n},{lowerSize:a,upperSize:u}){return t.kind==="source"?a/Ba:t.kind==="composite"?Wi(a/Ba,u/Ba,n):e}function gd(t,e){let n=0,a=0;if(t.kind==="constant")a=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:u,minZoom:f,maxZoom:p}=t,y=u?rt(Zo.interpolationFactor(u,e,f,p),0,1):0;t.kind==="camera"?a=Wi(t.minSize,t.maxSize,y):n=y}return{uSizeT:n,uSize:a}}var QL=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ba,evaluateSizeForFeature:gg,evaluateSizeForZoom:gd,getSizeData:X0});function eO(t,e,n){return t.sections.forEach(a=>{a.text=function(u,f,p){const y=f.layout.get("text-transform").evaluate(p,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),Ee.applyArabicShaping&&(u=Ee.applyArabicShaping(u)),u}(a.text,e,n)}),t}const qf={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function tO(t){return t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""}function iO(t){return t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""}const Y0=3;function nO(t,e,n){e.glyphs=[],t===1&&n.readMessage(rO,e)}function rO(t,e,n){if(t===3){const{id:a,bitmap:u,width:f,height:p,left:y,top:b,advance:T}=n.readMessage(oO,{});e.glyphs.push({id:a,bitmap:new sc({width:f+2*Y0,height:p+2*Y0},u),metrics:{width:f,height:p,left:y,top:b,advance:T}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function oO(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}const BT=Y0,Ks={horizontal:1,vertical:2,horizontalOnly:3},NT=-17;class Wf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const a=new Wf;return a.scale=e||1,a.fontStack=n,a}static forImage(e){const n=new Wf;return n.imageName=e,n}}class _d{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const a=new _d;for(let u=0;u<e.sections.length;u++){const f=e.sections[u];f.image?a.addImageSection(f):a.addTextSection(f,n)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,a){let u="";for(let f=0;f<n.length;f++){const p=n.charCodeAt(f+1)||null,y=n.charCodeAt(f-1)||null;u+=!a&&(p&&B(p)&&!qf[n[f+1]]||y&&B(y)&&!qf[n[f-1]])||!qf[n[f]]?n[f]:qf[n[f]]}return u}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&_g[this.text.charCodeAt(a)];a++)e++;let n=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&_g[this.text.charCodeAt(a)];a--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const a=new _d;return a.text=this.text.substring(e,n),a.sectionIndex=this.sectionIndex.slice(e,n),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Wf.forText(e.scale,e.fontStack||n));const a=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(a)}addImageSection(e){const n=e.image?e.image.namePrimary:"";if(n.length===0)return void ni("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(Wf.forImage(n)),this.sectionIndex.push(this.sections.length-1)):ni("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function J0(t,e,n,a,u,f,p,y,b,T,E,I,k,O,z){const N=_d.fromFeature(t,u);I===Ks.vertical&&N.verticalizePunctuation(k);let j=[];const W=function(ge,Se,ke,Re,Ze,Be){if(!ge)return[];const ut=[],Pt=function(qt,ii,It,Ci,si,Vt){let Pi=0;for(let fi=0;fi<qt.length();fi++){const Ti=qt.getSection(fi);Pi+=VT(qt.getCodePoint(fi),Ti,Ci,si,ii,Vt)}return Pi/Math.max(1,Math.ceil(Pi/It))}(ge,Se,ke,Re,Ze,Be),st=ge.text.indexOf("")>=0;let St=0;for(let qt=0;qt<ge.length();qt++){const ii=ge.getSection(qt),It=ge.getCodePoint(qt);if(_g[It]||(St+=VT(It,ii,Re,Ze,Se,Be)),qt<ge.length()-1){const Ci=!((ot=It)<11904||!(w["Bopomofo Extended"](ot)||w.Bopomofo(ot)||w["CJK Compatibility Forms"](ot)||w["CJK Compatibility Ideographs"](ot)||w["CJK Compatibility"](ot)||w["CJK Radicals Supplement"](ot)||w["CJK Strokes"](ot)||w["CJK Symbols and Punctuation"](ot)||w["CJK Unified Ideographs Extension A"](ot)||w["CJK Unified Ideographs"](ot)||w["Enclosed CJK Letters and Months"](ot)||w["Halfwidth and Fullwidth Forms"](ot)||w.Hiragana(ot)||w["Ideographic Description Characters"](ot)||w["Kangxi Radicals"](ot)||w["Katakana Phonetic Extensions"](ot)||w.Katakana(ot)||w["Vertical Forms"](ot)||w["Yi Radicals"](ot)||w["Yi Syllables"](ot)));(sO[It]||Ci||ii.imageName)&&ut.push(jT(qt+1,St,Pt,ut,aO(It,ge.getCodePoint(qt+1),Ci&&st),!1))}}var ot;return GT(jT(ge.length(),St,Pt,ut,0,!0))}(N,T,f,e,a,O),{processBidirectionalText:ie,processStyledBidirectionalText:re}=Ee;if(ie&&N.sections.length===1){const ge=ie(N.toString(),W);for(const Se of ge){const ke=new _d;ke.text=Se,ke.sections=N.sections;for(let Re=0;Re<Se.length;Re++)ke.sectionIndex.push(0);j.push(ke)}}else if(re){const ge=re(N.text,N.sectionIndex,W);for(const Se of ge){const ke=new _d;ke.text=Se[0],ke.sectionIndex=Se[1],ke.sections=N.sections,j.push(ke)}}else j=function(ge,Se){const ke=[],Re=ge.text;let Ze=0;for(const Be of Se)ke.push(ge.substring(Ze,Be)),Ze=Be;return Ze<Re.length&&ke.push(ge.substring(Ze,Re.length)),ke}(N,W);const se=[],de={positionedLines:se,text:N.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ge,Se,ke,Re,Ze,Be,ut,Pt,st,St,ot,qt){let ii=0,It=0,Ci=0;const si=Pt==="right"?1:Pt==="left"?0:.5;let Vt=!1;for(const on of Ze){const Vi=on.getSections();for(const nn of Vi){if(nn.imageName)continue;const yn=Se[nn.fontStack];if(yn&&(Vt=yn.ascender!==void 0&&yn.descender!==void 0,!Vt))break}if(!Vt)break}let Pi=0;for(const on of Ze){on.trim();const Vi=on.getMaxScale(),nn=(Vi-1)*wo,yn={positionedGlyphs:[],lineOffset:0};ge.positionedLines[Pi]=yn;const qn=yn.positionedGlyphs;let Xi=0;if(!on.length()){It+=Be,++Pi;continue}let ir=0,Wn=0;for(let Pn=0;Pn<on.length();Pn++){const vn=on.getSection(Pn),wr=on.getSectionIndex(Pn),nr=on.getCodePoint(Pn);let Ar=vn.scale,no=null,$o=null,Dr=null,Sr=wo,No=0;const Vo=!(st===Ks.horizontal||!ot&&!R(nr)||ot&&(_g[nr]||(fi=nr,w.Arabic(fi)||w["Arabic Supplement"](fi)||w["Arabic Extended-A"](fi)||w["Arabic Presentation Forms-A"](fi)||w["Arabic Presentation Forms-B"](fi))));if(vn.imageName){const Qo=Re[vn.imageName];if(!Qo)continue;Dr=vn.imageName,ge.iconsInText=ge.iconsInText||!0,$o=Qo.paddedRect;const rr=Qo.displaySize;Ar=Ar*wo/qt,no={width:rr[0],height:rr[1],left:0,top:-BT,advance:Vo?rr[1]:rr[0],localGlyph:!1},No=Vt?-no.height*Ar:NT+Vi*wo-rr[1]*Ar,Sr=no.advance;const ja=(Vo?rr[0]:rr[1])*Ar-wo*Vi;ja>0&&ja>Xi&&(Xi=ja)}else{const Qo=ke[vn.fontStack];if(!Qo)continue;Qo[nr]&&($o=Qo[nr]);const rr=Se[vn.fontStack];if(!rr)continue;const ja=rr.glyphs[nr];if(!ja)continue;if(no=ja.metrics,Sr=nr!==8203?wo:0,Vt){const Sd=rr.ascender!==void 0?Math.abs(rr.ascender):0,uc=rr.descender!==void 0?Math.abs(rr.descender):0,hc=(Sd+uc)*Ar;ir<hc&&(ir=hc,Wn=(Sd-uc)/2*Ar),No=-Sd*Ar}else No=NT+(Vi-Ar)*wo}Vo?(ge.verticalizable=!0,qn.push({glyph:nr,imageName:Dr,x:ii,y:It+No,vertical:Vo,scale:Ar,localGlyph:no.localGlyph,fontStack:vn.fontStack,sectionIndex:wr,metrics:no,rect:$o}),ii+=Sr*Ar+St):(qn.push({glyph:nr,imageName:Dr,x:ii,y:It+No,vertical:Vo,scale:Ar,localGlyph:no.localGlyph,fontStack:vn.fontStack,sectionIndex:wr,metrics:no,rect:$o}),ii+=no.advance*Ar+St)}qn.length!==0&&(Ci=Math.max(ii-St,Ci),Vt?HT(qn,si,Xi,Wn,Be*Vi/2):HT(qn,si,Xi,0,Be/2)),ii=0;const An=Be*Vi+Xi;yn.lineOffset=Math.max(Xi,nn),It+=An,++Pi}var fi;const Ti=It,{horizontalAlign:Rt,verticalAlign:Oi}=K0(ut);(function(on,Vi,nn,yn,qn,Xi){const ir=(Vi-nn)*qn,Wn=-Xi*yn;for(const An of on)for(const Pn of An.positionedGlyphs)Pn.x+=ir,Pn.y+=Wn})(ge.positionedLines,si,Rt,Oi,Ci,Ti),ge.top+=-Oi*Ti,ge.bottom=ge.top+Ti,ge.left+=-Rt*Ci,ge.right=ge.left+Ci,ge.hasBaseline=Vt}(de,e,n,a,j,p,y,b,I,T,k,z),!function(ge){for(const Se of ge)if(Se.positionedGlyphs.length!==0)return!1;return!0}(se)&&de}const _g={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},sO={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function VT(t,e,n,a,u,f){if(e.imageName){const p=a[e.imageName];return p?p.displaySize[0]*e.scale*wo/f+u:0}{const p=n[e.fontStack],y=p&&p.glyphs[t];return y?y.metrics.advance*e.scale+u:0}}function UT(t,e,n,a){const u=Math.pow(t-e,2);return a?t<e?u/2:2*u:u+Math.abs(n)*n}function aO(t,e,n){let a=0;return t===10&&(a-=1e4),n&&(a+=150),t!==40&&t!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function jT(t,e,n,a,u,f){let p=null,y=UT(e,n,u,f);for(const b of a){const T=UT(e-b.x,n,u,f)+b.badness;T<=y&&(p=b,y=T)}return{index:t,x:e,priorBreak:p,badness:y}}function GT(t){return t?GT(t.priorBreak).concat(t.index):[]}function K0(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function HT(t,e,n,a,u){if(!(e||n||a||u))return;const f=t.length-1,p=t[f],y=(p.x+p.metrics.advance*p.scale)*e;for(let b=0;b<=f;b++)t[b].x-=y,t[b].y+=n+a+u}function lO(t,e,n,a){const{horizontalAlign:u,verticalAlign:f}=K0(a),p=n[0]-t.displaySize[0]*u,y=n[1]-t.displaySize[1]*f;return{imagePrimary:t,imageSecondary:e,top:y,bottom:y+t.displaySize[1],left:p,right:p+t.displaySize[0]}}function qT(t,e,n,a,u,f){const p=t.imagePrimary;let y;if(p.content){const j=p.content,W=p.pixelRatio||1;y=[j[0]/W,j[1]/W,p.displaySize[0]-j[2]/W,p.displaySize[1]-j[3]/W]}const b=e.left*f,T=e.right*f;let E,I,k,O;n==="width"||n==="both"?(O=u[0]+b-a[3],I=u[0]+T+a[1]):(O=u[0]+(b+T-p.displaySize[0])/2,I=O+p.displaySize[0]);const z=e.top*f,N=e.bottom*f;return n==="height"||n==="both"?(E=u[1]+z-a[0],k=u[1]+N+a[2]):(E=u[1]+(z+N-p.displaySize[1])/2,k=E+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:E,right:I,bottom:k,left:O,collisionPadding:y}}class lc extends we{constructor(e,n,a,u,f){super(e,n),this.angle=u,this.z=a,f!==void 0&&(this.segment=f)}clone(){return new lc(this.x,this.y,this.z,this.angle,this.segment)}}function WT(t,e,n,a,u){if(e.segment===void 0)return!0;let f=e,p=e.segment+1,y=0;for(;y>-n/2;){if(p--,p<0)return!1;y-=t[p].dist(f),f=t[p]}y+=t[p].dist(t[p+1]),p++;const b=[];let T=0;for(;y<n/2;){const E=t[p],I=t[p+1];if(!I)return!1;let k=t[p-1].angleTo(E)-E.angleTo(I);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:k}),T+=k;y-b[0].distance>a;)T-=b.shift().angleDelta;if(T>u)return!1;p++,y+=E.dist(I)}return!0}function ZT(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function XT(t,e,n){return t?.6*e*n:0}function YT(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function cO(t,e,n,a,u,f){const p=XT(n,u,f),y=YT(n,a)*f;let b=0;const T=ZT(t)/2;for(let E=0;E<t.length-1;E++){const I=t[E],k=t[E+1],O=I.dist(k);if(b+O>T){const z=(T-b)/O,N=Wi(I.x,k.x,z),j=Wi(I.y,k.y,z),W=new lc(N,j,0,k.angleTo(I),E);return!p||WT(t,W,y,p,e)?W:void 0}b+=O}}function uO(t,e,n,a,u,f,p,y,b){const T=XT(a,f,p),E=YT(a,u),I=E*p,k=t[0].x===0||t[0].x===b||t[0].y===0||t[0].y===b;return e-I<e/4&&(e=I+e/4),JT(t,k?e/2*y%e:(E/2+2*f)*p*y%e,e,T,n,I,k,!1,b)}function JT(t,e,n,a,u,f,p,y,b){const T=f/2,E=ZT(t);let I=0,k=e-n,O=[];for(let z=0;z<t.length-1;z++){const N=t[z],j=t[z+1],W=N.dist(j),ie=j.angleTo(N);for(;k+n<I+W;){k+=n;const re=(k-I)/W,se=Wi(N.x,j.x,re),de=Wi(N.y,j.y,re);if(se>=0&&se<b&&de>=0&&de<b&&k-T>=0&&k+T<=E){const ge=new lc(se,de,0,ie,z);a&&!WT(t,ge,f,a,u)||O.push(ge)}}I+=W}return y||O.length||p||(O=JT(t,I/2,n,a,u,f,p,!0,b)),O}function KT(t,e,n,a,u){const f=[];for(let p=0;p<t.length;p++){const y=t[p];let b;for(let T=0;T<y.length-1;T++){let E=y[T],I=y[T+1];E.x<e&&I.x<e||(E.x<e?E=new we(e,E.y+(e-E.x)/(I.x-E.x)*(I.y-E.y))._round():I.x<e&&(I=new we(e,E.y+(e-E.x)/(I.x-E.x)*(I.y-E.y))._round()),E.y<n&&I.y<n||(E.y<n?E=new we(E.x+(n-E.y)/(I.y-E.y)*(I.x-E.x),n)._round():I.y<n&&(I=new we(E.x+(n-E.y)/(I.y-E.y)*(I.x-E.x),n)._round()),E.x>=a&&I.x>=a||(E.x>=a?E=new we(a,E.y+(a-E.x)/(I.x-E.x)*(I.y-E.y))._round():I.x>=a&&(I=new we(a,E.y+(a-E.x)/(I.x-E.x)*(I.y-E.y))._round()),E.y>=u&&I.y>=u||(E.y>=u?E=new we(E.x+(u-E.y)/(I.y-E.y)*(I.x-E.x),u)._round():I.y>=u&&(I=new we(E.x+(u-E.y)/(I.y-E.y)*(I.x-E.x),u)._round()),b&&E.equals(b[b.length-1])||(b=[E],f.push(b)),b.push(I)))))}}return f}function $0(t){let e=0,n=0;for(const p of t)e+=p.w*p.h,n=Math.max(n,p.w);t.sort((p,y)=>y.h-p.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let u=0,f=0;for(const p of t)for(let y=a.length-1;y>=0;y--){const b=a[y];if(!(p.w>b.w||p.h>b.h)){if(p.x=b.x,p.y=b.y,f=Math.max(f,p.y+p.h),u=Math.max(u,p.x+p.w),p.w===b.w&&p.h===b.h){const T=a.pop();y<a.length&&(a[y]=T)}else p.h===b.h?(b.x+=p.w,b.w-=p.w):p.w===b.w?(b.y+=p.h,b.h-=p.h):(a.push({x:b.x+p.w,y:b.y,w:b.w-p.w,h:p.h}),b.y+=p.h,b.h-=p.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}ri(lc,"Anchor");const Ps=1;class Q0{constructor(e,{pixelRatio:n,version:a,stretchX:u,stretchY:f,content:p}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=u,this.stretchY=f,this.content=p,this.version=a}get tl(){return[this.paddedRect.x+Ps,this.paddedRect.y+Ps]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ps,this.paddedRect.y+this.paddedRect.h-Ps]}get displaySize(){return[(this.paddedRect.w-2*Ps)/this.pixelRatio,(this.paddedRect.h-2*Ps)/this.pixelRatio]}}class $T{constructor(e,n){const a={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,a,f),this.addImages(n,u,f);const{w:p,h:y}=$0(f),b=new Js({width:p||1,height:y||1});for(const T in e){const E=e[T],I=a[T].paddedRect;Js.copy(E.data,b,{x:0,y:0},{x:I.x+Ps,y:I.y+Ps},E.data,E.sdf)}for(const T in n){const E=n[T],I=u[T].paddedRect,k=I.x+Ps,O=I.y+Ps,z=E.data.width,N=E.data.height;Js.copy(E.data,b,{x:0,y:0},{x:k,y:O},E.data),Js.copy(E.data,b,{x:0,y:N-1},{x:k,y:O-1},{width:z,height:1}),Js.copy(E.data,b,{x:0,y:0},{x:k,y:O+N},{width:z,height:1}),Js.copy(E.data,b,{x:z-1,y:0},{x:k-1,y:O},{width:1,height:N}),Js.copy(E.data,b,{x:0,y:0},{x:k+z,y:O},{width:1,height:N})}this.image=b,this.iconPositions=a,this.patternPositions=u}addImages(e,n,a){for(const u in e){const f=e[u],p={x:0,y:0,w:f.data.width+2*Ps,h:f.data.height+2*Ps};a.push(p),n[u]=new Q0(p,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,n,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(const u in e.getUpdatedImages(a))this.patchUpdatedImage(this.iconPositions[u],e.getImage(u,a),n),this.patchUpdatedImage(this.patternPositions[u],e.getImage(u,a),n)}patchUpdatedImage(e,n,a){if(!e||!n||e.version===n.version)return;e.version=n.version;const[u,f]=e.tl,p=!!Object.keys(this.patternPositions).length;a.update(n.data,{useMipmap:p},{x:u,y:f})}}ri(Q0,"ImagePosition"),ri($T,"ImageAtlas");const Zf=1e20;function QT(t,e,n,a,u,f,p,y,b){for(let T=e;T<e+a;T++)eS(t,n*f+T,f,u,p,y,b);for(let T=n;T<n+u;T++)eS(t,T*f+e,1,a,p,y,b)}function eS(t,e,n,a,u,f,p){f[0]=0,p[0]=-Zf,p[1]=Zf,u[0]=t[e];for(let y=1,b=0,T=0;y<a;y++){u[y]=t[e+y*n];const E=y*y;do{const I=f[b];T=(u[y]-u[I]+E-I*I)/(y-I)/2}while(T<=p[b]&&--b>-1);b++,f[b]=y,p[b]=T,p[b+1]=Zf}for(let y=0,b=0;y<a;y++){for(;p[b+1]<y;)b++;const T=f[b],E=y-T;t[e+y*n]=u[T]+E*E}}const Na=2,ev={none:0,ideographs:1,all:2};class yd{constructor(e,n,a){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,a){const u=[],f=this.urls[n]||L.GLYPHS_URL;for(const p in e)for(const y of e[p])u.push({stack:p,id:y});kt(u,({stack:p,id:y},b)=>{let T=this.entries[p];T||(T=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=T.glyphs[y];if(E!==void 0)return void b(null,{stack:p,id:y,glyph:E});if(E=this._tinySDF(T,p,y),E)return T.glyphs[y]=E,void b(null,{stack:p,id:y,glyph:E});const I=Math.floor(y/256);if(256*I>65535)return void b(new Error("glyphs > 65535 not supported"));if(T.ranges[I])return void b(null,{stack:p,id:y,glyph:E});let k=T.requests[I];k||(k=T.requests[I]=[],yd.loadGlyphRange(p,I,f,this.requestManager,(O,z)=>{if(z){T.ascender=z.ascender,T.descender=z.descender;for(const N in z.glyphs)this._doesCharSupportLocalGlyph(+N)||(T.glyphs[+N]=z.glyphs[+N]);T.ranges[I]=!0}for(const N of k)N(O,z);delete T.requests[I]})),k.push((O,z)=>{O?b(O):z&&b(null,{stack:p,id:y,glyph:z.glyphs[y]||null})})},(p,y)=>{if(p)a(p);else if(y){const b={};for(const{stack:T,id:E,glyph:I}of y)b[T]===void 0&&(b[T]={}),b[T].glyphs===void 0&&(b[T].glyphs={}),b[T].glyphs[E]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},b[T].ascender=this.entries[T].ascender,b[T].descender=this.entries[T].descender;a(null,b)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==ev.none&&(this.localGlyphMode===ev.all?!!this.localFontFamily:!!this.localFontFamily&&(w["CJK Unified Ideographs"](e)||w["Hangul Syllables"](e)||w.Hiragana(e)||w.Katakana(e)||w["CJK Symbols and Punctuation"](e)||w["CJK Unified Ideographs Extension A"](e)||w["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,a){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let f=e.tinySDF;if(!f){let N="400";/bold/i.test(n)?N="900":/medium/i.test(n)?N="500":/light/i.test(n)&&(N="200"),f=e.tinySDF=new yd.TinySDF({fontFamily:u,fontWeight:N,fontSize:24*Na,buffer:3*Na,radius:8*Na}),f.fontWeight=N}if(this.localGlyphs[f.fontWeight][a])return this.localGlyphs[f.fontWeight][a];const p=String.fromCodePoint(a),{data:y,width:b,height:T,glyphWidth:E,glyphHeight:I,glyphLeft:k,glyphTop:O,glyphAdvance:z}=f.draw(p);return this.localGlyphs[f.fontWeight][a]={id:a,bitmap:new sc({width:b,height:T},y),metrics:{width:E/Na,height:I/Na,left:k/Na,top:O/Na-27,advance:z/Na,localGlyph:!0}}}}yd.loadGlyphRange=function(t,e,n,a,u){const f=256*e,p=f+255,y=a.transformRequest(a.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${f}-${p}`),Gi.Glyphs);Cr(y,(b,T)=>{if(b)u(b);else if(T){const E={},I=function(k){return new pg(k).readFields(nO,{})}(T);for(const k of I.glyphs)E[k.id]=k;u(null,{glyphs:E,ascender:I.ascender,descender:I.descender})}})},yd.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=n;const y=this.size=t+4*e,b=this._createCanvas(y),T=this.ctx=b.getContext("2d",{willReadFrequently:!0});T.font=`${p} ${f} ${t}px ${u}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(t),p=Math.ceil(n),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-u))),b=Math.min(this.size-this.buffer,p+Math.ceil(a)),T=y+2*this.buffer,E=b+2*this.buffer,I=Math.max(T*E,0),k=new Uint8ClampedArray(I),O={data:k,width:T,height:E,glyphWidth:y,glyphHeight:b,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(y===0||b===0)return O;const{ctx:z,buffer:N,gridInner:j,gridOuter:W}=this;z.clearRect(N,N,y,b),z.fillText(t,N,N+p);const ie=z.getImageData(N,N,y,b);W.fill(Zf,0,I),j.fill(0,0,I);for(let re=0;re<b;re++)for(let se=0;se<y;se++){const de=ie.data[4*(re*y+se)+3]/255;if(de===0)continue;const ge=(re+N)*T+se+N;if(de===1)W[ge]=0,j[ge]=Zf;else{const Se=.5-de;W[ge]=Se>0?Se*Se:0,j[ge]=Se<0?Se*Se:0}}QT(W,0,0,T,E,T,this.f,this.v,this.z),QT(j,N,N,y,b,T,this.f,this.v,this.z);for(let re=0;re<I;re++){const se=Math.sqrt(W[re])-Math.sqrt(j[re]);k[re]=Math.round(255-255*(se/this.radius+this.cutoff))}return O}};const Wc=Ps;function tS(t,e,n,a){const u=[],f=t.imagePrimary,p=f.pixelRatio,y=f.paddedRect.w-2*Wc,b=f.paddedRect.h-2*Wc,T=t.right-t.left,E=t.bottom-t.top,I=f.stretchX||[[0,y]],k=f.stretchY||[[0,b]],O=(Be,ut)=>Be+ut[1]-ut[0],z=I.reduce(O,0),N=k.reduce(O,0),j=y-z,W=b-N;let ie=0,re=z,se=0,de=N,ge=0,Se=j,ke=0,Re=W;if(f.content&&a){const Be=f.content;ie=yg(I,0,Be[0]),se=yg(k,0,Be[1]),re=yg(I,Be[0],Be[2]),de=yg(k,Be[1],Be[3]),ge=Be[0]-ie,ke=Be[1]-se,Se=Be[2]-Be[0]-re,Re=Be[3]-Be[1]-de}const Ze=(Be,ut,Pt,st)=>{const St=vg(Be.stretch-ie,re,T,t.left),ot=xg(Be.fixed-ge,Se,Be.stretch,z),qt=vg(ut.stretch-se,de,E,t.top),ii=xg(ut.fixed-ke,Re,ut.stretch,N),It=vg(Pt.stretch-ie,re,T,t.left),Ci=xg(Pt.fixed-ge,Se,Pt.stretch,z),si=vg(st.stretch-se,de,E,t.top),Vt=xg(st.fixed-ke,Re,st.stretch,N),Pi=new we(St,qt),fi=new we(It,qt),Ti=new we(It,si),Rt=new we(St,si),Oi=new we(ot/p,ii/p),on=new we(Ci/p,Vt/p),Vi=e*Math.PI/180;if(Vi){const Wn=Math.sin(Vi),An=Math.cos(Vi),Pn=[An,-Wn,Wn,An];Pi._matMult(Pn),fi._matMult(Pn),Rt._matMult(Pn),Ti._matMult(Pn)}const nn=Be.stretch+Be.fixed,yn=Pt.stretch+Pt.fixed,qn=ut.stretch+ut.fixed,Xi=st.stretch+st.fixed,ir=t.imageSecondary;return{tl:Pi,tr:fi,bl:Rt,br:Ti,texPrimary:{x:f.paddedRect.x+Wc+nn,y:f.paddedRect.y+Wc+qn,w:yn-nn,h:Xi-qn},texSecondary:ir?{x:ir.paddedRect.x+Wc+nn,y:ir.paddedRect.y+Wc+qn,w:yn-nn,h:Xi-qn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Oi,pixelOffsetBR:on,minFontScaleX:Se/p/T,minFontScaleY:Re/p/E,isSDF:n}};if(a&&(f.stretchX||f.stretchY)){const Be=iS(I,j,z),ut=iS(k,W,N);for(let Pt=0;Pt<Be.length-1;Pt++){const st=Be[Pt],St=Be[Pt+1];for(let ot=0;ot<ut.length-1;ot++)u.push(Ze(st,ut[ot],St,ut[ot+1]))}}else u.push(Ze({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:b+1}));return u}function yg(t,e,n){let a=0;for(const u of t)a+=Math.max(e,Math.min(n,u[1]))-Math.max(e,Math.min(n,u[0]));return a}function iS(t,e,n){const a=[{fixed:-Wc,stretch:0}];for(const[u,f]of t){const p=a[a.length-1];a.push({fixed:u-p.stretch,stretch:p.stretch}),a.push({fixed:u-p.stretch,stretch:p.stretch+(f-u)})}return a.push({fixed:e+Wc,stretch:n}),a}function vg(t,e,n,a){return t/e*n+a}function xg(t,e,n,a){return t-e*n/a}function hO(t,e,n,a){const u=e+t.positionedLines[a].lineOffset;return a===0?n+u/2:n+(u+(e+t.positionedLines[a-1].lineOffset))/2}function dO(t,e=1,n=!1){let a=1/0,u=1/0,f=-1/0,p=-1/0;const y=t[0];for(let O=0;O<y.length;O++){const z=y[O];(!O||z.x<a)&&(a=z.x),(!O||z.y<u)&&(u=z.y),(!O||z.x>f)&&(f=z.x),(!O||z.y>p)&&(p=z.y)}const b=Math.min(f-a,p-u);let T=b/2;const E=new Ea([],fO);if(b===0)return new we(a,u);for(let O=a;O<f;O+=b)for(let z=u;z<p;z+=b)E.push(new vd(O+T,z+T,T,t));let I=function(O){let z=0,N=0,j=0;const W=O[0];for(let ie=0,re=W.length,se=re-1;ie<re;se=ie++){const de=W[ie],ge=W[se],Se=de.x*ge.y-ge.x*de.y;N+=(de.x+ge.x)*Se,j+=(de.y+ge.y)*Se,z+=3*Se}return new vd(N/z,j/z,0,O)}(t),k=E.length;for(;E.length;){const O=E.pop();(O.d>I.d||!I.d)&&(I=O,n&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,k)),O.max-I.d<=e||(T=O.h/2,E.push(new vd(O.p.x-T,O.p.y-T,T,t)),E.push(new vd(O.p.x+T,O.p.y-T,T,t)),E.push(new vd(O.p.x-T,O.p.y+T,T,t)),E.push(new vd(O.p.x+T,O.p.y+T,T,t)),k+=4)}return n&&(console.log(`num probes: ${k}`),console.log(`best distance: ${I.d}`)),I.p}function fO(t,e){return e.max-t.max}class vd{constructor(e,n,a,u){this.p=new we(e,n),this.h=a,this.d=function(f,p){let y=!1,b=1/0;for(let T=0;T<p.length;T++){const E=p[T];for(let I=0,k=E.length,O=k-1;I<k;O=I++){const z=E[I],N=E[O];z.y>f.y!=N.y>f.y&&f.x<(N.x-z.x)*(f.y-z.y)/(N.y-z.y)+z.x&&(y=!y),b=Math.min(b,nT(f,z,N))}}return(y?1:-1)*Math.sqrt(b)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const xd=7,tv=Number.POSITIVE_INFINITY,pO=Math.sqrt(2);function nS(t,[e,n]){let a=0,u=0;if(n===tv){e<0&&(e=0);const f=e/pO;switch(t){case"top-right":case"top-left":u=f-xd;break;case"bottom-right":case"bottom-left":u=-f+xd;break;case"bottom":u=-e+xd;break;case"top":u=e-xd}switch(t){case"top-right":case"bottom-right":a=-f;break;case"top-left":case"bottom-left":a=f;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":u=n-xd;break;case"bottom-right":case"bottom-left":case"bottom":u=-n+xd}switch(t){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,u]}function mO(t,e,n,a,u,f,p,y,b,T,E){t.createArrays(),t.tilePixelRatio=Lt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const I=t.layers[0].layout,k=t.layers[0]._unevaluatedLayout._values,O={};if(t.textSizeData.kind==="composite"){const{minZoom:W,maxZoom:ie}=t.textSizeData;O.compositeTextSizes=[k["text-size"].possiblyEvaluate(new xe(W),y),k["text-size"].possiblyEvaluate(new xe(ie),y)]}if(t.iconSizeData.kind==="composite"){const{minZoom:W,maxZoom:ie}=t.iconSizeData;O.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new xe(W),y),k["icon-size"].possiblyEvaluate(new xe(ie),y)]}O.layoutTextSize=k["text-size"].possiblyEvaluate(new xe(b+1),y),O.layoutIconSize=k["icon-size"].possiblyEvaluate(new xe(b+1),y),O.textMaxSize=k["text-size"].possiblyEvaluate(new xe(18),y);const z=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",N=I.get("text-size");let j=!1;for(const W of t.features)if(W.icon&&W.icon.nameSecondary){j=!0;break}for(const W of t.features){const ie=I.get("text-font").evaluate(W,{},y).join(","),re=N.evaluate(W,{},y),se=O.layoutTextSize.evaluate(W,{},y),de=(O.layoutIconSize.evaluate(W,{},y),{horizontal:{},vertical:void 0}),ge=W.text;let Se,ke=[0,0];if(ge){const Be=ge.toString(),ut=I.get("text-letter-spacing").evaluate(W,{},y)*wo,Pt=I.get("text-line-height").evaluate(W,{},y)*wo,st=A(Be)?ut:0,St=I.get("text-anchor").evaluate(W,{},y),ot=I.get("text-variable-anchor");if(!ot){const si=I.get("text-radial-offset").evaluate(W,{},y);ke=si?nS(St,[si*wo,tv]):I.get("text-offset").evaluate(W,{},y).map(Vt=>Vt*wo)}let qt=z?"center":I.get("text-justify").evaluate(W,{},y);const ii=I.get("symbol-placement")==="point",It=ii?I.get("text-max-width").evaluate(W,{},y)*wo:1/0,Ci=si=>{t.allowVerticalPlacement&&S(Be)&&(de.vertical=J0(ge,e,n,u,ie,It,Pt,St,si,st,ke,Ks.vertical,!0,se,re))};if(!z&&ot){const si=qt==="auto"?ot.map(Pi=>iv(Pi)):[qt];let Vt=!1;for(let Pi=0;Pi<si.length;Pi++){const fi=si[Pi];if(!de.horizontal[fi])if(Vt)de.horizontal[fi]=de.horizontal[0];else{const Ti=J0(ge,e,n,u,ie,It,Pt,"center",fi,st,ke,Ks.horizontal,!1,se,re);Ti&&(de.horizontal[fi]=Ti,Vt=Ti.positionedLines.length===1)}}Ci("left")}else{if(qt==="auto"&&(qt=iv(St)),ii||I.get("text-writing-mode").indexOf("horizontal")>=0||!S(Be)){const si=J0(ge,e,n,u,ie,It,Pt,St,qt,st,ke,Ks.horizontal,!1,se,re);si&&(de.horizontal[qt]=si)}Ci(ii?"left":qt)}}let Re=!1;if(W.icon&&W.icon.namePrimary){const Be=a[W.icon.namePrimary];Be&&(Se=lO(u[W.icon.namePrimary],W.icon.nameSecondary?u[W.icon.nameSecondary]:void 0,I.get("icon-offset").evaluate(W,{},y),I.get("icon-anchor").evaluate(W,{},y)),Re=Be.sdf,t.sdfIcons===void 0?t.sdfIcons=Be.sdf:t.sdfIcons!==Be.sdf&&ni("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Be.pixelRatio!==t.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Ze=oS(de.horizontal)||de.vertical;t.iconsInText||(t.iconsInText=!!Ze&&Ze.iconsInText),(Ze||Se)&&gO(t,W,de,Se,a,O,se,0,ke,Re,p,y,T,E,j)}f&&t.generateCollisionDebugBuffers(b,t.collisionBoxArray)}function iv(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function gO(t,e,n,a,u,f,p,y,b,T,E,I,k,O,z){let N=f.textMaxSize.evaluate(e,{},I);N===void 0&&(N=p);const j=t.layers[0].layout,W=j.get("icon-offset").evaluate(e,{},I),ie=oS(n.horizontal)||n.vertical,re=k.name==="globe",se=wo,de=p/se,ge=t.tilePixelRatio*N/se,Se=(St=t.overscaling,t.zoom>18&&St>2&&(St>>=1),Math.max(Lt/(512*St),1)*j.get("symbol-spacing")),ke=j.get("text-padding")*t.tilePixelRatio,Re=j.get("icon-padding")*t.tilePixelRatio,Ze=Xe(j.get("text-max-angle")),Be=j.get("text-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",ut=j.get("icon-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",Pt=j.get("symbol-placement"),st=Se/2;var St;const ot=j.get("icon-text-fit").evaluate(e,{},I),qt=j.get("icon-text-fit-padding").evaluate(e,{},I),ii=ot!=="none";let It;t.hasAnyIconTextFit===!1&&ii&&(t.hasAnyIconTextFit=!0),a&&ii&&(t.allowVerticalPlacement&&n.vertical&&(It=qT(a,n.vertical,ot,qt,W,de)),ie&&(a=qT(a,ie,ot,qt,W,de)));const Ci=(si,Vt,Pi)=>{if(Vt.x<0||Vt.x>=Lt||Vt.y<0||Vt.y>=Lt)return;let fi=null;if(re){const{x:Ti,y:Rt,z:Oi}=k.projectTilePoint(Vt.x,Vt.y,Pi);fi={anchor:new lc(Ti,Rt,Oi,0,void 0),up:k.upVector(Pi,Vt.x,Vt.y)}}(function(Ti,Rt,Oi,on,Vi,nn,yn,qn,Xi,ir,Wn,An,Pn,vn,wr,nr,Ar,no,$o,Dr,Sr,No,Vo,Qo,rr,ja,Sd){const uc=Ti.addToLineVertexArray(Rt,on);let hc,dp,fp,Hg,MM,EM,AM,IM=0,CM=0,PM=0,kM=0,Pv=-1,kv=-1;const _l={};let DM=$y("");const uh=Oi?Oi.anchor:Rt,Dv=Xi.layout.get("icon-text-fit").evaluate(Sr,{},rr)!=="none";let Lv=0,Ov=0;if(Xi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Lv,Ov]=Xi.layout.get("text-offset").evaluate(Sr,{},rr).map(ks=>ks*wo):(Lv=Xi.layout.get("text-radial-offset").evaluate(Sr,{},rr)*wo,Ov=tv),Ti.allowVerticalPlacement&&Vi.vertical){const ks=Vi.vertical;if(wr)EM=nv(ks),qn&&(AM=nv(qn));else{const Ds=Xi.layout.get("text-rotate").evaluate(Sr,{},rr)+90;fp=bg(ir,uh,Rt,Wn,An,Pn,ks,vn,Ds,nr),qn&&(Hg=bg(ir,uh,Rt,Wn,An,Pn,qn,no,Ds))}}if(nn){const ks=Xi.layout.get("icon-rotate").evaluate(Sr,{},rr),Ds=tS(nn,ks,Vo,Dv),Md=qn?tS(qn,ks,Vo,Dv):void 0;dp=bg(ir,uh,Rt,Wn,An,Pn,nn,no,ks),IM=4*Ds.length;const LM=Ti.iconSizeData;let hh=null;LM.kind==="source"?(hh=[Ba*Xi.layout.get("icon-size").evaluate(Sr,{},rr)],hh[0]>Zc&&ni(`${Ti.layerIds[0]}: Value for "icon-size" is >= ${Xf}. Reduce your "icon-size".`)):LM.kind==="composite"&&(hh=[Ba*No.compositeIconSizes[0].evaluate(Sr,{},rr),Ba*No.compositeIconSizes[1].evaluate(Sr,{},rr)],(hh[0]>Zc||hh[1]>Zc)&&ni(`${Ti.layerIds[0]}: Value for "icon-size" is >= ${Xf}. Reduce your "icon-size".`)),Ti.addSymbols(Ti.icon,Ds,hh,Dr,$o,Sr,!1,Oi,Rt,uc.lineStartIndex,uc.lineLength,-1,Qo,rr,ja,Sd),Pv=Ti.icon.placedSymbolArray.length-1,Md&&(CM=4*Md.length,Ti.addSymbols(Ti.icon,Md,hh,Dr,$o,Sr,Ks.vertical,Oi,Rt,uc.lineStartIndex,uc.lineLength,-1,Qo,rr,ja,Sd),kv=Ti.icon.placedSymbolArray.length-1)}for(const ks in Vi.horizontal){const Ds=Vi.horizontal[ks];hc||(DM=$y(Ds.text),wr?MM=nv(Ds):hc=bg(ir,uh,Rt,Wn,An,Pn,Ds,vn,Xi.layout.get("text-rotate").evaluate(Sr,{},rr),nr));const Md=Ds.positionedLines.length===1;if(PM+=rS(Ti,Oi,Rt,Ds,yn,Xi,wr,Sr,nr,uc,Vi.vertical?Ks.horizontal:Ks.horizontalOnly,Md?Object.keys(Vi.horizontal):[ks],_l,Pv,No,Qo,rr,ja),Md)break}Vi.vertical&&(kM+=rS(Ti,Oi,Rt,Vi.vertical,yn,Xi,wr,Sr,nr,uc,Ks.vertical,["vertical"],_l,kv,No,Qo,rr,ja));let tu=-1;const Rv=(ks,Ds)=>ks?Math.max(ks,Ds):Ds;tu=Rv(MM,tu),tu=Rv(EM,tu),tu=Rv(AM,tu);const kR=tu>-1?1:0;Ti.glyphOffsetArray.length>=Qf.MAX_GLYPHS&&ni("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Sr.sortKey!==void 0&&Ti.addToSortKeyRanges(Ti.symbolInstances.length,Sr.sortKey),Ti.symbolInstances.emplaceBack(Rt.x,Rt.y,uh.x,uh.y,uh.z,_l.right>=0?_l.right:-1,_l.center>=0?_l.center:-1,_l.left>=0?_l.left:-1,_l.vertical>=0?_l.vertical:-1,Pv,kv,DM,hc!==void 0?hc:Ti.collisionBoxArray.length,hc!==void 0?hc+1:Ti.collisionBoxArray.length,fp!==void 0?fp:Ti.collisionBoxArray.length,fp!==void 0?fp+1:Ti.collisionBoxArray.length,dp!==void 0?dp:Ti.collisionBoxArray.length,dp!==void 0?dp+1:Ti.collisionBoxArray.length,Hg||Ti.collisionBoxArray.length,Hg?Hg+1:Ti.collisionBoxArray.length,Wn,PM,kM,IM,CM,kR,0,Lv,Ov,tu,0,Dv?1:0)})(t,Vt,fi,si,n,a,u,It,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,ke,Be,b,0,Re,ut,W,e,f,T,E,I,O,z)};if(Pt==="line")for(const si of KT(e.geometry,0,0,Lt,Lt)){const Vt=uO(si,Se,Ze,n.vertical||ie,a,se,ge,t.overscaling,Lt);for(const Pi of Vt)ie&&_O(t,ie.text,st,Pi)||Ci(si,Pi,I)}else if(Pt==="line-center"){for(const si of e.geometry)if(si.length>1){const Vt=cO(si,Ze,n.vertical||ie,a,se,ge);Vt&&Ci(si,Vt,I)}}else if(e.type==="Polygon")for(const si of j0(e.geometry,0)){const Vt=dO(si,16);Ci(si[0],new lc(Vt.x,Vt.y,0,0,void 0),I)}else if(e.type==="LineString")for(const si of e.geometry)Ci(si,new lc(si[0].x,si[0].y,0,0,void 0),I);else if(e.type==="Point")for(const si of e.geometry)for(const Vt of si)Ci([Vt],new lc(Vt.x,Vt.y,0,0,void 0),I)}const Xf=255,Zc=Xf*Ba;function rS(t,e,n,a,u,f,p,y,b,T,E,I,k,O,z,N,j,W){const ie=function(de,ge,Se,ke,Re,Ze,Be,ut){const Pt=[];if(ge.positionedLines.length===0)return Pt;const st=ke.layout.get("text-rotate").evaluate(Ze,{})*Math.PI/180,St=function(Ci){const si=Ci[0],Vt=Ci[1],Pi=si*Vt;return Pi>0?[si,-Vt]:Pi<0?[-si,Vt]:si===0?[Vt,si]:[Vt,-si]}(Se);let ot=Math.abs(ge.top-ge.bottom);for(const Ci of ge.positionedLines)ot-=Ci.lineOffset;const qt=ge.positionedLines.length,ii=ot/qt;let It=ge.top-Se[1];for(let Ci=0;Ci<qt;++Ci){const si=ge.positionedLines[Ci];It=hO(ge,ii,It,Ci);for(const Vt of si.positionedGlyphs){if(!Vt.rect)continue;const Pi=Vt.rect||{};let fi=BT+1,Ti=!0,Rt=1,Oi=0;if(Vt.imageName){const Dr=Be[Vt.imageName];if(!Dr)continue;if(Dr.sdf){ni("SDF images are not supported in formatted text and will be ignored.");continue}Ti=!1,Rt=Dr.pixelRatio,fi=Ps/Rt}const on=(Re||ut)&&Vt.vertical,Vi=Vt.metrics.advance*Vt.scale/2,nn=Vt.metrics,yn=Vt.rect;if(yn===null)continue;ut&&ge.verticalizable&&(Oi=Vt.imageName?Vi-Vt.metrics.width*Vt.scale/2:0);const qn=Re?[Vt.x+Vi,Vt.y]:[0,0];let Xi=[0,0],ir=[0,0],Wn=!1;Re||(on?(ir=[Vt.x+Vi+St[0],Vt.y+St[1]-Oi],Wn=!0):Xi=[Vt.x+Vi+Se[0],Vt.y+Se[1]-Oi]);const An=yn.w*Vt.scale/(Rt*(Vt.localGlyph?Na:1)),Pn=yn.h*Vt.scale/(Rt*(Vt.localGlyph?Na:1));let vn,wr,nr,Ar;if(on){const Dr=Vt.y-It,Sr=new we(-Vi,Vi-Dr),No=-Math.PI/2,Vo=new we(...ir);vn=new we(-Vi+Xi[0],Xi[1]),vn._rotateAround(No,Sr)._add(Vo),vn.x+=-Dr+Vi,vn.y-=(nn.left-fi)*Vt.scale;const Qo=Vt.imageName?nn.advance*Vt.scale:wo*Vt.scale,rr=String.fromCodePoint(Vt.glyph);tO(rr)?vn.x+=(1-fi)*Vt.scale:iO(rr)?vn.x+=Qo-nn.height*Vt.scale+(-fi-1)*Vt.scale:vn.x+=Vt.imageName||nn.width+2*fi===yn.w&&nn.height+2*fi===yn.h?(Qo-Pn)/2:(Qo-(nn.height+2*fi)*Vt.scale)/2,wr=new we(vn.x,vn.y-An),nr=new we(vn.x+Pn,vn.y),Ar=new we(vn.x+Pn,vn.y-An)}else{const Dr=(nn.left-fi)*Vt.scale-Vi+Xi[0],Sr=(-nn.top-fi)*Vt.scale+Xi[1],No=Dr+An,Vo=Sr+Pn;vn=new we(Dr,Sr),wr=new we(No,Sr),nr=new we(Dr,Vo),Ar=new we(No,Vo)}if(st){let Dr;Dr=Re?new we(0,0):Wn?new we(St[0],St[1]):new we(Se[0],Se[1]),vn._rotateAround(st,Dr),wr._rotateAround(st,Dr),nr._rotateAround(st,Dr),Ar._rotateAround(st,Dr)}const no=new we(0,0),$o=new we(0,0);Pt.push({tl:vn,tr:wr,bl:nr,br:Ar,texPrimary:Pi,texSecondary:void 0,writingMode:ge.writingMode,glyphOffset:qn,sectionIndex:Vt.sectionIndex,isSDF:Ti,pixelOffsetTL:no,pixelOffsetBR:$o,minFontScaleX:0,minFontScaleY:0})}}return Pt}(0,a,b,f,p,y,u,t.allowVerticalPlacement),re=t.textSizeData;let se=null;re.kind==="source"?(se=[Ba*f.layout.get("text-size").evaluate(y,{},j)],se[0]>Zc&&ni(`${t.layerIds[0]}: Value for "text-size" is >= ${Xf}. Reduce your "text-size".`)):re.kind==="composite"&&(se=[Ba*z.compositeTextSizes[0].evaluate(y,{},j),Ba*z.compositeTextSizes[1].evaluate(y,{},j)],(se[0]>Zc||se[1]>Zc)&&ni(`${t.layerIds[0]}: Value for "text-size" is >= ${Xf}. Reduce your "text-size".`)),t.addSymbols(t.text,ie,se,b,p,y,E,e,n,T.lineStartIndex,T.lineLength,O,N,j,W,!1);for(const de of I)k[de]=t.text.placedSymbolArray.length-1;return 4*ie.length}function oS(t){for(const e in t)return t[e];return null}function bg(t,e,n,a,u,f,p,y,b,T){let E=p.top,I=p.bottom,k=p.left,O=p.right;const z=p.collisionPadding;if(z&&(k-=z[0],E-=z[1],O+=z[2],I+=z[3]),b){const N=new we(k,E),j=new we(O,E),W=new we(k,I),ie=new we(O,I),re=Xe(b);let se=new we(0,0);T&&(se=new we(T[0],T[1])),N._rotateAround(re,se),j._rotateAround(re,se),W._rotateAround(re,se),ie._rotateAround(re,se),k=Math.min(N.x,j.x,W.x,ie.x),O=Math.max(N.x,j.x,W.x,ie.x),E=Math.min(N.y,j.y,W.y,ie.y),I=Math.max(N.y,j.y,W.y,ie.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,k,E,O,I,y,a,u,f),t.length-1}function nv(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function _O(t,e,n,a){const u=t.compareText;if(e in u){const f=u[e];for(let p=f.length-1;p>=0;p--)if(a.dist(f[p])<n)return!0}else u[e]=[];return u[e].push(a),!1}function sS(t,e){const n=t.fovAboveCenter,a=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,u=(t._camera.position[2]*t.worldSize-a)/Math.cos(t._pitch),f=Math.sin(n)*u/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),p=Math.sin(t._pitch)*f+u;return Math.min(1.01*p,u*(1/t._horizonShift))}function Xc(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const n=Math.pow(2,-t.z),a=t.x*n,u=(t.x+1)*n,f=t.y*n,p=(t.y+1)*n,y=Cs(a),b=Cs(u),T=bo(f),E=bo(p),I=e.project(y,T),k=e.project(b,T),O=e.project(b,E),z=e.project(y,E);let N=Math.min(I.x,k.x,O.x,z.x),j=Math.min(I.y,k.y,O.y,z.y),W=Math.max(I.x,k.x,O.x,z.x),ie=Math.max(I.y,k.y,O.y,z.y);const re=n/16;function se(ge,Se,ke,Re,Ze,Be){const ut=(ke+Ze)/2,Pt=(Re+Be)/2,st=e.project(Cs(ut),bo(Pt)),St=Math.max(0,N-st.x,j-st.y,st.x-W,st.y-ie);N=Math.min(N,st.x),W=Math.max(W,st.x),j=Math.min(j,st.y),ie=Math.max(ie,st.y),St>re&&(se(ge,st,ke,Re,ut,Pt),se(st,Se,ut,Pt,Ze,Be))}se(I,k,a,f,u,f),se(k,O,u,f,u,p),se(O,z,u,p,a,p),se(z,I,a,p,a,f),N-=re,j-=re,W+=re,ie+=re;const de=1/Math.max(W-N,ie-j);return{scale:de,x:N*de,y:j*de,x2:W*de,y2:ie*de,projection:e}}function aS(t,{x:e,y:n},a=0){return new we(((e-a)*t.scale-t.x)*Lt,(n*t.scale-t.y)*Lt)}const yO=s.m.identity(new Float32Array(16));class Yc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new En(0,0)}projectTilePoint(e,n,a){return{x:e,y:n,z:0}}locationPoint(e,n,a=!0){return e._coordinatePoint(e.locationCoordinate(n),a)}pixelsPerMeter(e,n){return Ko(1,e)*n}pixelSpaceConversion(e,n,a){return 1}farthestPixelDistance(e){return sS(e,e.pixelsPerMeter)}pointCoordinate(e,n,a,u){const f=e.horizonLineFromTop(!1),p=new we(n,Math.max(f,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,u))}pointCoordinate3D(e,n,a){const u=new we(n,a);if(e.elevation)return e.elevation.pointCoordinate(u);{const f=this.pointCoordinate(e,u.x,u.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);const a=e.horizonLineFromTop();return n.y<a}createInversionMatrix(e,n){return yO}createTileMatrix(e,n,a){let u,f,p;const y=a.canonical,b=s.m.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const T=Xc(y,this);u=1,f=T.x+a.wrap*T.scale,p=T.y,s.m.scale(b,b,[u/T.scale,u/T.scale,e.pixelsPerMeter/n])}else u=n/e.zoomScale(y.z),f=(y.x+Math.pow(2,y.z)*a.wrap)*u,p=y.y*u;return s.m.translate(b,b,[f,p,0]),s.m.scale(b,b,[u/Lt,u/Lt,1]),b}upVector(e,n,a){return[0,0,1]}upVectorScale(e,n,a){return{metersToTile:1}}}class vO extends Yc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,a]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(Xe(n));this.n=(u+Math.sin(Xe(a)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:a,c:u,r0:f}=this,p=Xe(e-this.center[0]),y=Xe(n),b=Math.sqrt(u-2*a*Math.sin(y))/a;return{x:b*Math.sin(p*a),y:b*Math.cos(p*a)-f,z:0}}unproject(e,n){const{n:a,c:u,r0:f}=this,p=f+n;let y=Math.atan2(e,Math.abs(p))*Math.sign(p);p*a<0&&(y-=Math.PI*Math.sign(e)*Math.sign(p));const b=Xe(this.center[0])*a;y=Xt(y,-Math.PI-b,Math.PI-b);const T=rt(mt(y/a)+this.center[0],-180,180),E=Math.asin(rt((u-(e*e+p*p)*a*a)/(2*a),-1,1)),I=rt(mt(E),-Er,Er);return new En(T,I)}}const Yf=1.340264,Jf=-.081106,Kf=893e-6,$f=.003796,wg=Math.sqrt(3)/2;class xO extends Yc{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(wg*Math.sin(n)),u=a*a,f=u*u*u;return{x:.5*(e*Math.cos(a)/(wg*(Yf+3*Jf*u+f*(7*Kf+9*$f*u)))/Math.PI+.5),y:1-.5*(a*(Yf+Jf*u+f*(Kf+$f*u))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,u=a*a,f=u*u*u;for(let E,I,k,O=0;O<12&&(I=a*(Yf+Jf*u+f*(Kf+$f*u))-n,k=Yf+3*Jf*u+f*(7*Kf+9*$f*u),E=I/k,a=rt(a-E,-Math.PI/3,Math.PI/3),u=a*a,f=u*u*u,!(Math.abs(E)<1e-12));++O);const p=wg*e*(Yf+3*Jf*u+f*(7*Kf+9*$f*u))/Math.cos(a),y=Math.asin(Math.sin(a)/wg),b=rt(180*p/Math.PI,-180,180),T=rt(180*y/Math.PI,-Er,Er);return new En(b,T)}}class bO extends Yc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const a=360*(e-.5),u=rt(360*(.5-n),-Er,Er);return new En(a,u)}}const bd=Math.PI/2;function Tg(t){return Math.tan((bd+t)/2)}class wO extends Yc{constructor(e){super(e),this.center=e.center||[0,30];const[n,a]=this.parallels=e.parallels||[30,30];let u=Xe(n),f=Xe(a);this.southernCenter=u+f<0,this.southernCenter&&(u=-u,f=-f);const p=Math.cos(u),y=Tg(u);this.n=u===f?Math.sin(u):Math.log(p/Math.cos(f))/Math.log(Tg(f)/y),this.f=p*Math.pow(Tg(u),this.n)/this.n}project(e,n){n=Xe(n),this.southernCenter&&(n=-n),e=Xe(e-this.center[0]);const a=1e-6,{n:u,f}=this;f>0?n<-bd+a&&(n=-bd+a):n>bd-a&&(n=bd-a);const p=f/Math.pow(Tg(n),u);let y=p*Math.sin(u*e),b=f-p*Math.cos(u*e);return y=.5*(y/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:y,y:this.southernCenter?b:1-b,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:a,f:u}=this,f=u-n,p=Math.sign(f),y=Math.sign(a)*Math.sqrt(e*e+f*f);let b=Math.atan2(e,Math.abs(f))*p;f*a<0&&(b-=Math.PI*Math.sign(e)*p);const T=rt(mt(b/a)+this.center[0],-180,180),E=rt(mt(2*Math.atan(Math.pow(u/y,1/a))-bd),-Er,Er);return new En(T,this.southernCenter?-E:E)}}class lS extends Yc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:dl(e),y:fl(n),z:0}}unproject(e,n){const a=Cs(e),u=bo(n);return new En(a,u)}}const cS=Xe(Er);class TO extends Yc{project(e,n){const a=(n=Xe(n))*n,u=a*a;return{x:.5*((e=Xe(e))*(.8707-.131979*a+u*(u*(.003971*a-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+a*(.015085+u*(.028874*a-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,u=25,f=0,p=a*a;do{p=a*a;const T=p*p;f=(a*(1.007226+p*(.015085+T*(.028874*p-.044475-.005916*T)))-n)/(1.007226+p*(.045255+T*(.259866*p-.311325-.005916*11*T))),a=rt(a-f,-cS,cS)}while(Math.abs(f)>1e-6&&--u>0);p=a*a;const y=rt(mt(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),b=mt(a);return new En(y,b)}}const uS=Xe(Er);class SO extends Yc{project(e,n){n=Xe(n),e=Xe(e);const a=Math.cos(n),u=2/Math.PI,f=Math.acos(a*Math.cos(e/2)),p=Math.sin(f)/f,y=.5*(e*u+2*a*Math.sin(e/2)/p)||0,b=.5*(n+Math.sin(n)/p)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,n){let a=e=(2*e-.5)*Math.PI,u=n=(2*(1-n)-1)*Math.PI,f=25;const p=1e-6;let y=0,b=0;do{const T=Math.cos(u),E=Math.sin(u),I=2*E*T,k=E*E,O=T*T,z=Math.cos(a/2),N=Math.sin(a/2),j=2*z*N,W=N*N,ie=1-O*z*z,re=ie?1/ie:0,se=ie?Math.acos(T*z)*Math.sqrt(1/ie):0,de=.5*(2*se*T*N+2*a/Math.PI)-e,ge=.5*(se*E+u)-n,Se=.5*re*(O*W+se*T*z*k)+1/Math.PI,ke=re*(j*I/4-se*E*N),Re=.125*re*(I*N-se*E*O*j),Ze=.5*re*(k*z+se*W*T)+.5,Be=ke*Re-Ze*Se;y=(ge*ke-de*Ze)/Be,b=(de*Re-ge*Se)/Be,a=rt(a-y,-Math.PI,Math.PI),u=rt(u-b,-uS,uS)}while((Math.abs(y)>p||Math.abs(b)>p)&&--f>0);return new En(mt(a),mt(u))}}class hS extends Yc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Xe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:a,cosPhi:u}=this;return{x:Xe(e)*u*a+.5,y:-Math.sin(Xe(n))/u*a+.5,z:0}}unproject(e,n){const{scale:a,cosPhi:u}=this,f=-(n-.5)/a,p=rt(mt((e-.5)/a)/u,-180,180),y=Math.asin(rt(f*u,-1,1)),b=rt(mt(y),-Er,Er);return new En(p,b)}}class MO extends lS{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,a){const u=Nf(e,n,a),f=Vf(hl(a));return s.v.transformMat4(u,u,f),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,n){const a=th(n.lat,n.lng),u=s.v.normalize([],a),f=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,p=Ko(1,0)*Lt*f;s.v.scaleAndAdd(a,a,u,p);const y=s.m.identity(new Float64Array(16));return s.m.multiply(y,e.pixelMatrix,e.globeMatrix),s.v.transformMat4(a,a,y),new we(a[0],a[1])}pixelsPerMeter(e,n){return Ko(1,0)*n}pixelSpaceConversion(e,n,a){const u=Ko(1,e)*n,f=Wi(Ko(1,45)*n,u,a);return this.pixelsPerMeter(e,n)/f}createTileMatrix(e,n,a){const u=M0(hl(a.canonical));return s.m.multiply(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,n){const{center:a}=e,u=Vf(hl(n));return s.m.rotateY(u,u,Xe(a.lng)),s.m.rotateX(u,u,Xe(a.lat)),s.m.scale(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,n,a,u){return Uw(e,n,a,!0)||new Po(0,0)}pointCoordinate3D(e,n,a){const u=this.pointCoordinate(e,n,a,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,n){return!Uw(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(u,f){const p=u.cameraToCenterDistance,y=u._centerAltitude*f,b=u._camera,T=u._camera.forward(),E=s.v.add([],s.v.scale([],T,-p),[0,0,y]),I=u.worldSize/(2*Math.PI),k=[0,0,-I],O=u.width/u.height,z=Math.tan(u.fovAboveCenter),N=s.v.scale([],b.up(),z),j=s.v.scale([],b.right(),z*O),W=s.v.normalize([],s.v.add([],s.v.add([],T,N),j)),ie=[];let re;if(new y0(E,W).closestPointOnSphere(k,I,ie)){const se=s.v.add([],ie,k),de=s.v.sub([],se,E);re=Math.cos(u.fovAboveCenter)*s.v.length(de)}else{const se=s.v.sub([],E,k),de=s.v.sub([],k,E);s.v.normalize(de,de);const ge=s.v.length(se)-I;re=Math.sqrt(ge*(ge+2*I));const Se=Math.acos(re/(I+ge))-Math.acos(s.v.dot(T,de));re*=Math.cos(Se)}return 1.01*re}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=oc(e.zoom);if(a>0){const u=sS(e,Ko(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Wi(n,u+f*(1-Math.cos(p)),Math.pow(a,10))}return n}upVector(e,n,a){return Nf(n,a,e,1)}upVectorScale(e){return{metersToTile:Ym(Km(hl(e)))}}}function dS(t){const e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new lS(t);case"equirectangular":return new bO(t);case"naturalEarth":return new TO(t);case"equalEarth":return new xO(t);case"winkelTripel":return new SO(t);case"albers":return n?new hS(t):new vO(t);case"lambertConformalConic":return n?new hS(t):new wO(t);case"globe":return new MO(t)}throw new Error(`Invalid projection name: ${t.name}`)}const EO=new _t({"symbol-placement":new me(Ne.layout_symbol["symbol-placement"]),"symbol-spacing":new me(Ne.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new me(Ne.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Fe(Ne.layout_symbol["symbol-sort-key"]),"symbol-z-order":new me(Ne.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new me(Ne.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new me(Ne.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new me(Ne.layout_symbol["icon-ignore-placement"]),"icon-optional":new me(Ne.layout_symbol["icon-optional"]),"icon-rotation-alignment":new me(Ne.layout_symbol["icon-rotation-alignment"]),"icon-size":new Fe(Ne.layout_symbol["icon-size"]),"icon-text-fit":new Fe(Ne.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Fe(Ne.layout_symbol["icon-text-fit-padding"]),"icon-image":new Fe(Ne.layout_symbol["icon-image"]),"icon-rotate":new Fe(Ne.layout_symbol["icon-rotate"]),"icon-padding":new me(Ne.layout_symbol["icon-padding"]),"icon-keep-upright":new me(Ne.layout_symbol["icon-keep-upright"]),"icon-offset":new Fe(Ne.layout_symbol["icon-offset"]),"icon-anchor":new Fe(Ne.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new me(Ne.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new me(Ne.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new me(Ne.layout_symbol["text-rotation-alignment"]),"text-field":new Fe(Ne.layout_symbol["text-field"]),"text-font":new Fe(Ne.layout_symbol["text-font"]),"text-size":new Fe(Ne.layout_symbol["text-size"]),"text-max-width":new Fe(Ne.layout_symbol["text-max-width"]),"text-line-height":new Fe(Ne.layout_symbol["text-line-height"]),"text-letter-spacing":new Fe(Ne.layout_symbol["text-letter-spacing"]),"text-justify":new Fe(Ne.layout_symbol["text-justify"]),"text-radial-offset":new Fe(Ne.layout_symbol["text-radial-offset"]),"text-variable-anchor":new me(Ne.layout_symbol["text-variable-anchor"]),"text-anchor":new Fe(Ne.layout_symbol["text-anchor"]),"text-max-angle":new me(Ne.layout_symbol["text-max-angle"]),"text-writing-mode":new me(Ne.layout_symbol["text-writing-mode"]),"text-rotate":new Fe(Ne.layout_symbol["text-rotate"]),"text-padding":new me(Ne.layout_symbol["text-padding"]),"text-keep-upright":new me(Ne.layout_symbol["text-keep-upright"]),"text-transform":new Fe(Ne.layout_symbol["text-transform"]),"text-offset":new Fe(Ne.layout_symbol["text-offset"]),"text-allow-overlap":new me(Ne.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new me(Ne.layout_symbol["text-ignore-placement"]),"text-optional":new me(Ne.layout_symbol["text-optional"]),visibility:new me(Ne.layout_symbol.visibility)});var rv={paint:new _t({"icon-opacity":new Fe(Ne.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Fe(Ne.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Fe(Ne.paint_symbol["text-emissive-strength"]),"icon-color":new Fe(Ne.paint_symbol["icon-color"]),"icon-halo-color":new Fe(Ne.paint_symbol["icon-halo-color"]),"icon-halo-width":new Fe(Ne.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Fe(Ne.paint_symbol["icon-halo-blur"]),"icon-translate":new me(Ne.paint_symbol["icon-translate"]),"icon-translate-anchor":new me(Ne.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Fe(Ne.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Fe(Ne.paint_symbol["text-opacity"]),"text-color":new Fe(Ne.paint_symbol["text-color"],{runtimeType:ae,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Fe(Ne.paint_symbol["text-halo-color"]),"text-halo-width":new Fe(Ne.paint_symbol["text-halo-width"]),"text-halo-blur":new Fe(Ne.paint_symbol["text-halo-blur"]),"text-translate":new me(Ne.paint_symbol["text-translate"]),"text-translate-anchor":new me(Ne.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new me(Ne.paint_symbol["icon-color-saturation"])}),layout:EO};class fS{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:wa,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ri(fS,"FormatSectionOverride",{omit:["defaultValue"]});class Sg extends Qt{constructor(e,n,a){super(e,rv,n,a)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const u=[];for(const f of a)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,a,u){const f=this.layout.get(e).evaluate(n,{},a,u),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||Yh(p.value)||!f?f:function(y,b){return b.replace(/{([^{}]+)}/g,(T,E)=>E in y?String(y[E]):"")}(n.properties,f)}createBucket(e){return new Qf(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of rv.paint.overridableProperties){if(!Sg.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),a=new fS(n),u=new bf(a,n.property.specification,this.scope,this.options);let f=null;f=n.value.kind==="constant"||n.value.kind==="source"?new Gu("source",u):new Hu("composite",u,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new Ke(n.property,f,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven())&&Sg.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const a=e.get("text-field"),u=rv.paint.properties[n];let f=!1;const p=y=>{for(const b of y)if(u.overrides&&u.overrides.hasOverride(b))return void(f=!0)};if(a.value.kind==="constant"&&a.value.value instanceof po)p(a.value.value.sections);else if(a.value.kind==="source"){const y=T=>{f||(T instanceof Sa&&Mr(T.value)===Ge?p(T.value.sections):T instanceof Qa?p(T.sections):T.eachChild(y))},b=a.value;b._styleExpression&&y(b._styleExpression.expression)}return f}getProgramIds(){const e=this.paint.get("icon-opacity").constantOr(1)!==0,n=this.paint.get("text-opacity").constantOr(1)!==0,a=[];return e&&a.push("symbolIcon"),n&&a.push("symbolSDF"),a}getDefaultProgramParams(e,n){return{config:new Ku(this,n),overrideFog:!1}}}const AO=ug.types,IO=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Mg(t,e,n,a,u,f,p,y,b,T,E,I,k){const O=y?Math.min(Zc,Math.round(y[0])):0,z=y?Math.min(Zc,Math.round(y[1])):0;t.emplaceBack(e,n,Math.round(32*a),Math.round(32*u),f,p,(O<<1)+(b?1:0),z,16*T,16*E,256*I,256*k)}function Eg(t,e,n){t.emplaceBack(e,n)}function Ag(t,e,n,a,u,f,p){t.emplaceBack(e,n,a,u,f,p)}function Ig(t,e,n,a,u){t.emplaceBack(e,n,a,u),t.emplaceBack(e,n,a,u),t.emplaceBack(e,n,a,u),t.emplaceBack(e,n,a,u)}function CO(t){for(const e of t.sections)if(Z(e.text))return!0;return!1}class ov{constructor(e){this.layoutVertexArray=new eo,this.indexArray=new kn,this.programConfigurations=e,this.segments=new cr,this.dynamicLayoutVertexArray=new Mn,this.opacityVertexArray=new vo,this.placedSymbolArray=new o1,this.iconTransitioningVertexArray=new Bo,this.globeExtVertexArray=new Yn,this.zOffsetVertexArray=new Oa}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,a,u,f){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qL.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,ZL.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,IO,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,YL.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,WL.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||f)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,XL.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}ri(ov,"SymbolBuffers");class sv{constructor(e,n,a){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new a,this.segments=new cr,this.collisionVertexArray=new qs,this.collisionVertexArrayExt=new Mn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,JL.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,KL.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ri(sv,"CollisionBuffers");class Cg{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=s.m.identity([]),this.placementViewportMatrix=s.m.identity([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=X0(this.zoom,n["text-size"]),this.iconSizeData=X0(this.zoom,n["icon-size"]);const a=this.layers[0].layout,u=a.get("symbol-sort-key"),f=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(p=>Ks[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=a.get("symbol-z-elevate")}createArrays(){this.text=new ov(new Vc(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new ov(new Vc(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new l1,this.lineVertexArray=new c1,this.symbolInstances=new a1}calculateGlyphDependencies(e,n,a,u,f){for(let p=0;p<e.length;p++){const y=e.codePointAt(p);if(y===void 0)break;if(n[y]=!0,u&&f&&y<=65535){const b=qf[e.charAt(p)];b&&(n[b.charCodeAt(0)]=!0)}}}populate(e,n,a,u){const f=this.layers[0],p=f.layout,y=this.projection.name==="globe",b=p.get("text-font"),T=p.get("text-field"),E=p.get("icon-image"),I=(T.value.kind!=="constant"||T.value.value instanceof po&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),k=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,O=p.get("symbol-sort-key");if(this.features=[],!I&&!k)return;const z=n.iconDependencies,N=n.glyphDependencies,j=n.availableImages,W=new xe(this.zoom);for(const{feature:ie,id:re,index:se,sourceLayerIndex:de}of e){const ge=f._featureFilter.needGeometry,Se=Hc(ie,ge);if(!f._featureFilter.filter(W,Se,a))continue;if(ge||(Se.geometry=pl(ie,a,u)),y&&ie.type!==1&&a.z<=5){const Be=Se.geometry,ut=.98078528056,Pt=(st,St)=>{const ot=Nf(st.x,st.y,a,1),qt=Nf(St.x,St.y,a,1);return s.v.dot(ot,qt)<ut};for(let st=0;st<Be.length;st++)Be[st]=VD(Be[st],Pt)}let ke,Re;if(I){const Be=f.getValueAndResolveTokens("text-field",Se,a,j),ut=po.factory(Be);CO(ut)&&(this.hasRTLText=!0),(!this.hasRTLText||he()==="unavailable"||this.hasRTLText&&Ee.isParsed())&&(ke=eO(ut,f,Se))}if(k){const Be=f.getValueAndResolveTokens("icon-image",Se,a,j);Re=Be instanceof jo?Be:jo.fromString(Be)}if(!ke&&!Re)continue;const Ze=this.sortFeaturesByKey?O.evaluate(Se,{},a):void 0;if(this.features.push({id:re,text:ke,icon:Re,index:se,sourceLayerIndex:de,geometry:Se.geometry,properties:ie.properties,type:AO[ie.type],sortKey:Ze}),Re&&(z[Re.namePrimary]=!0,Re.nameSecondary&&(z[Re.nameSecondary]=!0)),ke){const Be=b.evaluate(Se,{},a).join(","),ut=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ks.vertical)>=0;for(const Pt of ke.sections)if(Pt.image)z[Pt.image.namePrimary]=!0;else{const st=S(ke.toString()),St=Pt.fontStack||Be,ot=N[St]=N[St]||{};this.calculateGlyphDependencies(Pt.text,ot,ut,this.allowVerticalPlacement,st)}}}p.get("symbol-placement")==="line"&&(this.features=function(ie){const re={},se={},de=[];let ge=0;function Se(Be){de.push(ie[Be]),ge++}function ke(Be,ut,Pt){const st=se[Be];return delete se[Be],se[ut]=st,de[st].geometry[0].pop(),de[st].geometry[0]=de[st].geometry[0].concat(Pt[0]),st}function Re(Be,ut,Pt){const st=re[ut];return delete re[ut],re[Be]=st,de[st].geometry[0].shift(),de[st].geometry[0]=Pt[0].concat(de[st].geometry[0]),st}function Ze(Be,ut,Pt){const st=Pt?ut[0][ut[0].length-1]:ut[0][0];return`${Be}:${st.x}:${st.y}`}for(let Be=0;Be<ie.length;Be++){const ut=ie[Be],Pt=ut.geometry,st=ut.text?ut.text.toString():null;if(!st){Se(Be);continue}const St=Ze(st,Pt),ot=Ze(st,Pt,!0);if(St in se&&ot in re&&se[St]!==re[ot]){const qt=Re(St,ot,Pt),ii=ke(St,ot,de[qt].geometry);delete re[St],delete se[ot],se[Ze(st,de[ii].geometry,!0)]=ii,de[qt].geometry=null}else St in se?ke(St,ot,Pt):ot in re?Re(St,ot,Pt):(Se(Be),re[St]=ge-1,se[ot]=ge-1)}return de.filter(Be=>Be.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ie,re)=>ie.sortKey-re.sortKey)}update(e,n,a,u,f){const p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;const y=p?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,y,a,u,f),this.icon.programConfigurations.updatePaintArrays(e,n,y,a,u,f)}updateZOffset(){const e=(f,p,y)=>{a+=p,a>f.length&&f.resize(a);for(let b=-p;b<0;b++)f.emplace(b+a,y)},n=(f,p,y)=>{u+=p,u>f.length&&f.resize(u);for(let b=-p;b<0;b++)f.emplace(b+u,y)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,u=0;for(let f=0;f<this.symbolInstances.length;f++){const p=this.symbolInstances.get(f),{numHorizontalGlyphVertices:y,numVerticalGlyphVertices:b,numIconVertices:T}=p,E=p.zOffset,I=T>0;if((y>0||b>0)&&(e(this.text.zOffsetVertexArray,y,E),e(this.text.zOffsetVertexArray,b,E)),I){const{placedIconSymbolIndex:k,verticalPlacedIconSymbolIndex:O}=p;k>=0&&n(this.icon.zOffsetVertexArray,T,E),O>=0&&n(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,E)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=dS(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:f}of n)this.lineVertexArray.emplaceBack(u,f);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,n,a,u,f,p,y,b,T,E,I,k,O,z,N,j){const W=e.indexArray,ie=e.layoutVertexArray,re=e.globeExtVertexArray,se=e.segments.prepareSegment(4*n.length,ie,W,this.canOverlap?p.sortKey:void 0),de=this.glyphOffsetArray.length,ge=se.vertexLength,Se=this.allowVerticalPlacement&&y===Ks.vertical?Math.PI/2:0,ke=p.text&&p.text.sections;for(let Ze=0;Ze<n.length;Ze++){const{tl:Be,tr:ut,bl:Pt,br:st,texPrimary:St,texSecondary:ot,pixelOffsetTL:qt,pixelOffsetBR:ii,minFontScaleX:It,minFontScaleY:Ci,glyphOffset:si,isSDF:Vt,sectionIndex:Pi}=n[Ze],fi=se.vertexLength,Ti=si[1];if(Mg(ie,T.x,T.y,Be.x,Ti+Be.y,St.x,St.y,a,Vt,qt.x,qt.y,It,Ci),Mg(ie,T.x,T.y,ut.x,Ti+ut.y,St.x+St.w,St.y,a,Vt,ii.x,qt.y,It,Ci),Mg(ie,T.x,T.y,Pt.x,Ti+Pt.y,St.x,St.y+St.h,a,Vt,qt.x,ii.y,It,Ci),Mg(ie,T.x,T.y,st.x,Ti+st.y,St.x+St.w,St.y+St.h,a,Vt,ii.x,ii.y,It,Ci),b){const{x:Rt,y:Oi,z:on}=b.anchor,[Vi,nn,yn]=b.up;Ag(re,Rt,Oi,on,Vi,nn,yn),Ag(re,Rt,Oi,on,Vi,nn,yn),Ag(re,Rt,Oi,on,Vi,nn,yn),Ag(re,Rt,Oi,on,Vi,nn,yn),Ig(e.dynamicLayoutVertexArray,Rt,Oi,on,Se)}else Ig(e.dynamicLayoutVertexArray,T.x,T.y,T.z,Se);if(j){const Rt=ot||St;Eg(e.iconTransitioningVertexArray,Rt.x,Rt.y),Eg(e.iconTransitioningVertexArray,Rt.x+Rt.w,Rt.y),Eg(e.iconTransitioningVertexArray,Rt.x,Rt.y+Rt.h),Eg(e.iconTransitioningVertexArray,Rt.x+Rt.w,Rt.y+Rt.h)}W.emplaceBack(fi,fi+1,fi+2),W.emplaceBack(fi+1,fi+2,fi+3),se.vertexLength+=4,se.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(si[0]),Ze!==n.length-1&&Pi===n[Ze+1].sectionIndex||e.programConfigurations.populatePaintArrays(ie.length,p,p.index,{},O,z,N,ke&&ke[Pi])}const Re=b?b.anchor:T;e.placedSymbolArray.emplaceBack(Re.x,Re.y,Re.z,T.x,T.y,de,this.glyphOffsetArray.length-de,ge,E,I,T.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],y,0,!1,0,k,0)}_commitLayoutVertex(e,n,a,u,f,p,y){e.emplaceBack(n,a,u,f,p,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,n,a,u,f,p,y){const b=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),T=b.vertexLength,E=y.tileAnchorX,I=y.tileAnchorY;for(let O=0;O<4;O++)a.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,n,e.padding,y.zOffset),this._commitLayoutVertex(a.layoutVertexArray,u,f,p,E,I,new we(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,f,p,E,I,new we(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,f,p,E,I,new we(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,u,f,p,E,I,new we(e.x1,e.y2)),b.vertexLength+=4;const k=a.indexArray;k.emplaceBack(T,T+1),k.emplaceBack(T+1,T+2),k.emplaceBack(T+2,T+3),k.emplaceBack(T+3,T),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,a,u,f,p){for(let y=u;y<f;y++){const b=a.get(y),T=this.getSymbolInstanceTextSize(e,p,n,y);this._addCollisionDebugVertices(b,T,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,n,a,u,f,p){for(let y=u;y<f;y++){const b=a.get(y),T=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._addCollisionDebugVertices(b,T,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new sv(Is,FT.members,Bo),this.iconCollisionBox=new sv(Is,FT.members,Bo);const a=gd(this.iconSizeData,e),u=gd(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const p=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(u,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(u,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,n,a,u){const f=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:u),p=gg(this.textSizeData,e,f)/wo;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,n,a){const u=this.icon.placedSymbolArray.get(a),f=gg(this.iconSizeData,e,u);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,n,a,u){e.emplaceBack(n,-a,-a,u),e.emplaceBack(n,a,-a,u),e.emplaceBack(n,a,a,u),e.emplaceBack(n,-a,a,u)}_updateTextDebugCollisionBoxes(e,n,a,u,f,p){for(let y=u;y<f;y++){const b=a.get(y),T=this.getSymbolInstanceTextSize(e,p,n,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,T,b.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,n,a,u,f,p){for(let y=u;y<f;y++){const b=a.get(y),T=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,T,b.padding,p.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=gd(this.iconSizeData,e),u=gd(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const p=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(u,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(u,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(a,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._updateIconDebugCollisionBoxes(a,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,a,u,f,p,y,b,T){const E={};if(n<a){const{x1:I,y1:k,x2:O,y2:z,padding:N,projectedAnchorX:j,projectedAnchorY:W,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:se,featureIndex:de}=e.get(n);E.textBox={x1:I,y1:k,x2:O,y2:z,padding:N,projectedAnchorX:j,projectedAnchorY:W,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:se},E.textFeatureIndex=de}if(u<f){const{x1:I,y1:k,x2:O,y2:z,padding:N,projectedAnchorX:j,projectedAnchorY:W,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:se,featureIndex:de}=e.get(u);E.verticalTextBox={x1:I,y1:k,x2:O,y2:z,padding:N,projectedAnchorX:j,projectedAnchorY:W,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:se},E.verticalTextFeatureIndex=de}if(p<y){const{x1:I,y1:k,x2:O,y2:z,padding:N,projectedAnchorX:j,projectedAnchorY:W,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:se,featureIndex:de}=e.get(p);E.iconBox={x1:I,y1:k,x2:O,y2:z,padding:N,projectedAnchorX:j,projectedAnchorY:W,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:se},E.iconFeatureIndex=de}if(b<T){const{x1:I,y1:k,x2:O,y2:z,padding:N,projectedAnchorX:j,projectedAnchorY:W,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:se,featureIndex:de}=e.get(b);E.verticalIconBox={x1:I,y1:k,x2:O,y2:z,padding:N,projectedAnchorX:j,projectedAnchorY:W,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:se},E.verticalIconFeatureIndex=de}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){const a=e.placedSymbolArray.get(n),u=a.vertexStartIndex+4*a.numGlyphs;for(let f=a.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),a=Math.cos(e),u=[],f=[],p=[];for(let y=0;y<this.symbolInstances.length;++y){p.push(y);const b=this.symbolInstances.get(y);u.push(0|Math.round(n*b.tileAnchorX+a*b.tileAnchorY)),f.push(b.featureIndex)}return p.sort((y,b)=>u[y]-u[b]||f[b]-f[y]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const a=this.symbolInstances.get(n);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:T}=a;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),f>=0&&f!==u&&this.addIndicesForPlacedSymbol(this.text,f),p>=0&&p!==f&&p!==u&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ri(Cg,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Cg.MAX_GLYPHS=65535,Cg.addDynamicAttributes=Ig;var Qf=Cg;const PO=di([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:kO}=PO,DO=di([{name:"a_packed",components:4,type:"Float32"}]),{members:LO}=DO,OO=ug.types,RO=Math.cos(Math.PI/180*37.5);class Pg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new As,this.layoutVertexArray2=new Mn,this.indexArray=new kn,this.programConfigurations=new Vc(e.layers,e.zoom),this.segments=new cr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,a,u){this.hasPattern=G0("line",this.layers,n);const f=this.layers[0].layout.get("line-sort-key"),p=[];for(const{feature:E,id:I,index:k,sourceLayerIndex:O}of e){const z=this.layers[0]._featureFilter.needGeometry,N=Hc(E,z);if(!this.layers[0]._featureFilter.filter(new xe(this.zoom),N,a))continue;const j=f?f.evaluate(N,{},a):void 0,W={id:I,properties:E.properties,type:E.type,sourceLayerIndex:O,index:k,geometry:z?N.geometry:pl(E,a,u),patterns:{},sortKey:j};p.push(W)}f&&p.sort((E,I)=>E.sortKey-I.sortKey);const{lineAtlas:y,featureIndex:b}=n,T=this.addConstantDashes(y);for(const E of p){const{geometry:I,index:k,sourceLayerIndex:O}=E;if(T&&this.addFeatureDashes(E,y),this.hasPattern){const z=H0("line",this.layers,E,this.zoom,n);this.patternFeatures.push(z)}else this.addFeature(E,I,k,a,y.positions,n.availableImages,n.brightness);b.insert(e[k].feature,I,k,O,this.index)}}addConstantDashes(e){let n=!1;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,f=a.layout.get("line-cap").value;if(u.kind!=="constant"||f.kind!=="constant")n=!0;else{const p=f.value,y=u.value;if(!y)continue;e.addDash(y,p)}}return n}addFeatureDashes(e,n){const a=this.zoom;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,p=u.layout.get("line-cap").value;if(f.kind==="constant"&&p.kind==="constant")continue;let y,b;if(f.kind==="constant"){if(y=f.value,!y)continue}else y=f.evaluate({zoom:a},e);b=p.kind==="constant"?p.value:p.evaluate({zoom:a},e),n.addDash(y,b),e.patterns[u.id]=n.getKey(y,b)}}update(e,n,a,u,f){const p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,a,u,f)}addFeatures(e,n,a,u,f,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,a,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,LO)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,kO),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,a,u,f,p,y){const b=this.layers[0].layout,T=b.get("line-join").evaluate(e,{}),E=b.get("line-cap").evaluate(e,{}),I=b.get("line-miter-limit"),k=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const O of n)this.addLine(O,e,T,E,I,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,p,u,y)}addLine(e,n,a,u,f,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let W=0;W<e.length-1;W++)this.totalDistance+=e[W].dist(e[W+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=OO[n.type]==="Polygon";let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let T=0;for(;T<b-1&&e[T].equals(e[T+1]);)T++;if(b<(y?3:2))return;a==="bevel"&&(f=1.05);const E=this.overscaling<=16?15*Lt/(512*this.overscaling):0,I=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let k,O,z,N,j;this.e1=this.e2=-1,y&&(k=e[b-2],j=e[T].sub(k)._unit()._perp());for(let W=T;W<b;W++){if(z=W===b-1?y?e[T+1]:void 0:e[W+1],z&&e[W].equals(z))continue;j&&(N=j),k&&(O=k),k=e[W],j=z?z.sub(k)._unit()._perp():N,N=N||j;let ie=N.add(j);ie.x===0&&ie.y===0||ie._unit();const re=N.x*j.x+N.y*j.y,se=ie.x*j.x+ie.y*j.y,de=se!==0?1/se:1/0,ge=2*Math.sqrt(2-2*se),Se=se<RO&&O&&z,ke=N.x*j.y-N.y*j.x>0;if(Se&&W>T){const Be=k.dist(O);if(Be>2*E){const ut=k.sub(k.sub(O)._mult(E/Be)._round());this.updateDistance(O,ut),this.addCurrentVertex(ut,N,0,0,I),O=ut}}const Re=O&&z;let Ze=Re?a:y?"butt":u;if(Re&&Ze==="round"&&(de<p?Ze="miter":de<=2&&(Ze="fakeround")),Ze==="miter"&&de>f&&(Ze="bevel"),Ze==="bevel"&&(de>2&&(Ze="flipbevel"),de<f&&(Ze="miter")),O&&this.updateDistance(O,k),Ze==="miter")ie._mult(de),this.addCurrentVertex(k,ie,0,0,I);else if(Ze==="flipbevel"){if(de>100)ie=j.mult(-1);else{const Be=de*N.add(j).mag()/N.sub(j).mag();ie._perp()._mult(Be*(ke?-1:1))}this.addCurrentVertex(k,ie,0,0,I),this.addCurrentVertex(k,ie.mult(-1),0,0,I)}else if(Ze==="bevel"||Ze==="fakeround"){const Be=-Math.sqrt(de*de-1),ut=ke?Be:0,Pt=ke?0:Be;if(O&&this.addCurrentVertex(k,N,ut,Pt,I),Ze==="fakeround"){const st=Math.round(180*ge/Math.PI/20);for(let St=1;St<st;St++){let ot=St/st;if(ot!==.5){const ii=ot-.5;ot+=ot*ii*(ot-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*ii*ii+(.848013+re*(.215638*re-1.06021)))}const qt=j.sub(N)._mult(ot)._add(N)._unit()._mult(ke?-1:1);this.addHalfVertex(k,qt.x,qt.y,!1,ke,0,I)}}z&&this.addCurrentVertex(k,j,-ut,-Pt,I)}else if(Ze==="butt")this.addCurrentVertex(k,ie,0,0,I);else if(Ze==="square"){const Be=O?1:-1;O||this.addCurrentVertex(k,ie,Be,Be,I),this.addCurrentVertex(k,ie,0,0,I),O&&this.addCurrentVertex(k,ie,Be,Be,I)}else Ze==="round"&&(O&&(this.addCurrentVertex(k,N,0,0,I),this.addCurrentVertex(k,N,1,1,I,!0)),z&&(this.addCurrentVertex(k,j,-1,-1,I,!0),this.addCurrentVertex(k,j,0,0,I)));if(Se&&W<b-1){const Be=k.dist(z);if(Be>2*E){const ut=k.add(z.sub(k)._mult(E/Be)._round());this.updateDistance(k,ut),this.addCurrentVertex(ut,j,0,0,I),k=ut}}}}addCurrentVertex(e,n,a,u,f,p=!1){const y=n.y*u-n.x,b=-n.y-n.x*u;this.addHalfVertex(e,n.x+n.y*a,n.y-n.x*a,p,!1,a,f),this.addHalfVertex(e,y,b,p,!0,-u,f)}addHalfVertex({x:e,y:n},a,u,f,p,y,b){this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(n<<1)+(p?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const T=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),b.primitiveLength++),p?this.e2=T:this.e1=T}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}ri(Pg,"LineBucket",{omit:["layers","patternFeatures"]});class cc{constructor(e,n,a,u){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(n,u)}update(e,n,a){const{width:u,height:f}=e,{context:p}=this,{gl:y}=p;if(y.bindTexture(y.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!n||n.premultiply!==!1)),a||this.size&&this.size[0]===u&&this.size[1]===f){const{x:b,y:T}=a||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)y.texSubImage2D(y.TEXTURE_2D,0,b,T,y.RGBA,y.UNSIGNED_BYTE,e);else{let E=this.format,I=y.UNSIGNED_BYTE;this.format===y.R32F&&(E=y.RED,I=y.FLOAT),y.texSubImage2D(y.TEXTURE_2D,0,b,T,u,f,E,I,e.data)}}else if(this.size=[u,f],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let b=this.format;this.format===y.R8&&(b=y.RED),y.texImage2D(y.TEXTURE_2D,0,this.format,b,y.UNSIGNED_BYTE,e)}else{let b=this.format,T=this.format,E=y.UNSIGNED_BYTE;this.format===y.DEPTH_COMPONENT&&(b=y.DEPTH_COMPONENT16,E=y.UNSIGNED_SHORT),this.format===y.R8&&(T=y.RED),this.format===y.R32F&&(E=y.FLOAT,T=y.RED),y.texImage2D(y.TEXTURE_2D,0,b,u,f,0,T,E,e.data)}this.useMipmap=!!(n&&n.useMipmap),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,n,a=!1){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,n),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,a,u){const{context:f}=this,{gl:p}=f;p.bindTexture(p.TEXTURE_2D,this.texture),n!==this.magFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,a),this.wrapS=a),u!==this.wrapT&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,u),this.wrapT=u)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class kg{constructor(e,n){this.context=e,this.texture=n}bind(e,n){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}}const pa=32,ml=33,Jc=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,a=0,u=0,f=0,p=0,y=0;for(1&e?u=f=p=pa:n=a=y=pa;(e>>=1)>1;){const T=n+u>>1,E=a+f>>1;1&e?(u=n,f=a,n=p,a=y):(n=u,a=f,u=p,f=y),p=T,y=E}const b=4*t;Jc[b+0]=n,Jc[b+1]=a,Jc[b+2]=u,Jc[b+3]=f}const gl=new Uint16Array(2178),Kc=new Uint8Array(1089),Dg=new Uint16Array(1089);function pS(t){return t===0?-.03125:t===32?.03125:0}var Lg=di([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const mS={type:2,extent:Lt,loadGeometry:()=>[[new we(0,0),new we(Lt+1,0),new we(Lt+1,Lt+1),new we(0,Lt+1),new we(0,0)]]};class av{constructor(e,n,a,u,f){this.tileID=e,this.uid=vi(),this.uses=0,this.tileSize=n,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,u&&u.style&&(this._lastUpdatedBrightness=u.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<uo.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Xc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,f){const p={};if(!f)return p;for(const y of u){const b=y.layerIds.map(T=>f.getLayer(T)).filter(Boolean);if(b.length!==0){y.layers=b,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(T=>b.filter(E=>E.id===T)[0]));for(const T of b)p[T.fqid]=y}}return p}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const f=this.buckets[u];if(f instanceof Qf){if(this.hasSymbolBuckets=!0,!a)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const f=this.buckets[u];if(f instanceof Qf&&f.hasRTLText){this.hasRTLText=!0,Ee.isLoading()||Ee.isLoaded()||he()!=="deferred"||ve();break}}this.queryPadding=0;for(const u in this.buckets){const f=this.buckets[u],p=n.style.getOwnLayer(u);if(!p)continue;const y=p.queryRadius(f);this.queryPadding=Math.max(this.queryPadding,y)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new Ky}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(const u in this.buckets){const f=this.buckets[u];f.uploadPending()&&f.upload(e)}const n=e.gl,a=this.imageAtlas;if(a&&!a.uploaded){const u=!!Object.keys(a.patternPositions).length;this.imageAtlasTexture=new cc(e,a.image,n.RGBA,{useMipmap:u}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new cc(e,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new cc(e,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(e,n,a){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,a),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const u=n.style.getBrightness();(this._lastUpdatedBrightness||u)&&(this._lastUpdatedBrightness&&u&&Math.abs(this._lastUpdatedBrightness-u)<.001||(this._lastUpdatedBrightness=u,this.updateBuckets(void 0,n)))}queryRenderedFeatures(e,n,a,u,f,p,y,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:y,transform:p,params:f,tileTransform:this.tileTransform},e,n,a):{}}querySourceFeatures(e,n){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const u=a.loadVTLayers(),f=n?n.sourceLayer:"",p=u._geojsonTileLayer||u[f];if(!p)return;const y=ed(n&&n.filter),{z:b,x:T,y:E}=this.tileID.canonical,I={z:b,x:T,y:E};for(let k=0;k<p.length;k++){const O=p.feature(k);if(y.needGeometry){const j=Hc(O,!0);if(!y.filter(new xe(this.tileID.overscaledZ),j,this.tileID.canonical))continue}else if(!y.filter(new xe(this.tileID.overscaledZ),O))continue;const z=a.getId(O,f),N=new IT(O,b,T,E,z);N.tile=I,e.push(N)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const a=xt(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let u=!1;if(this.expirationTime>a)u=!1;else if(n)if(this.expirationTime<n)u=!0;else{const f=this.expirationTime-n;f?this.expirationTime=a+Math.max(f,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&n&&this.updateBuckets(e,n)}updateBuckets(e,n){if(!this.latestFeatureIndex)return;const a=this.latestFeatureIndex.loadVTLayers(),u=n.style.listImages(),f=n.style.getBrightness();for(const p in this.buckets){if(!n.style.hasLayer(p))continue;const y=this.buckets[p],b=y.layers[0].sourceLayer||"_geojsonTileLayer",T=a[b];let E={};if(e&&(E=e[b],!T||!E||Object.keys(E).length===0))continue;if(y.update(E,T,u,this.imageAtlas&&this.imageAtlas.patternPositions||{},f),y instanceof Pg||y instanceof lg){const k=n.style.getOwnSourceCache(y.layers[0].source);n._terrain&&n._terrain.enabled&&k&&y.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(k.id,this.tileID)}const I=n&&n.style&&n.style.getOwnLayer(p);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<uo.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=uo.now()+e}setTexture(e,n){const a=n.context,u=a.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof cc?this.texture.update(e,{useMipmap:!0}):(this.texture=new cc(a,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE))}setDependencies(e,n){const a={};for(const u of n)a[u]=!0;this.dependencies[e]=a}hasDependency(e,n){for(const a of e){const u=this.dependencies[a];if(u){for(const f of n)if(u[f])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const a=pl(mS,this.tileID.canonical,this.tileTransform)[0],u=new Ni,f=new kf;for(let p=0;p<a.length;p++){const{x:y,y:b}=a[p];u.emplaceBack(y,b),f.emplaceBack(p)}f.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(u,zf.members),this._tileDebugSegments=cr.simpleSegment(0,0,u.length,f.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const a=pl(mS,this.tileID.canonical,this.tileTransform)[0];let u,f;if(this.isRaster){const p=function(y,b){const T=Xc(y,b),E=Math.pow(2,y.z);for(let j=0;j<ml;j++)for(let W=0;W<ml;W++){const ie=Cs((y.x+(W+pS(W))/pa)/E),re=bo((y.y+(j+pS(j))/pa)/E),se=b.project(ie,re),de=j*ml+W;gl[2*de+0]=Math.round((se.x*T.scale-T.x)*Lt),gl[2*de+1]=Math.round((se.y*T.scale-T.y)*Lt)}Kc.fill(0),Dg.fill(0);for(let j=2045;j>=0;j--){const W=4*j,ie=Jc[W+0],re=Jc[W+1],se=Jc[W+2],de=Jc[W+3],ge=ie+se>>1,Se=re+de>>1,ke=ge+Se-re,Re=Se+ie-ge,Ze=re*ml+ie,Be=de*ml+se,ut=Se*ml+ge,Pt=Math.hypot((gl[2*Ze+0]+gl[2*Be+0])/2-gl[2*ut+0],(gl[2*Ze+1]+gl[2*Be+1])/2-gl[2*ut+1])>=16;Kc[ut]=Kc[ut]||(Pt?1:0),j<1022&&(Kc[ut]=Kc[ut]||Kc[(re+Re>>1)*ml+(ie+ke>>1)]||Kc[(de+Re>>1)*ml+(se+ke>>1)])}const I=new Cn,k=new kn;let O=0;function z(j,W){const ie=W*ml+j;return Dg[ie]===0&&(I.emplaceBack(gl[2*ie+0],gl[2*ie+1],j*Lt/pa,W*Lt/pa),Dg[ie]=++O),Dg[ie]-1}function N(j,W,ie,re,se,de){const ge=j+ie>>1,Se=W+re>>1;if(Math.abs(j-se)+Math.abs(W-de)>1&&Kc[Se*ml+ge])N(se,de,j,W,ge,Se),N(ie,re,se,de,ge,Se);else{const ke=z(j,W),Re=z(ie,re),Ze=z(se,de);k.emplaceBack(ke,Re,Ze)}}return N(0,0,pa,pa,pa,0),N(pa,pa,0,0,0,pa),{vertices:I,indices:k}}(this.tileID.canonical,n);u=p.vertices,f=p.indices}else{u=new Cn,f=new kn;for(const{x:y,y:b}of a)u.emplaceBack(y,b,0,0);const p=ag(u.int16,void 0,4);for(let y=0;y<p.length;y+=3)f.emplaceBack(p[y],p[y+1],p[y+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,Lg.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(f),this._tileBoundsSegments=cr.simpleSegment(0,0,u.length,f.length)}_makeGlobeTileDebugBuffers(e,n){const a=n.projection;if(!a||a.name!=="globe"||n.freezeTileCoverage)return;const u=this.tileID.canonical,f=Vf(jw(u,n)),p=oc(n.zoom);let y;p>0&&(y=s.m.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,u,n,f,y,p),this._makeGlobeTileDebugTextBuffer(e,u,n,f,y,p)}_globePoint(e,n,a,u,f,p,y){let b=Nf(e,n,a);if(p){const T=1<<a.z,E=dl(u.center.lng),I=fl(u.center.lat),k=(a.x+.5)/T-E;let O=0;k>.5?O=-1:k<-.5&&(O=1);let z=(e/Lt+a.x)/T+O,N=(n/Lt+a.y)/T;z=(z-E)*u._pixelsPerMercatorPixel+E,N=(N-I)*u._pixelsPerMercatorPixel+I;const j=[z*u.worldSize,N*u.worldSize,0];s.v.transformMat4(j,j,p),b=rc(b,j,y)}return s.v.transformMat4(b,b,f)}_makeGlobeTileDebugBorderBuffer(e,n,a,u,f,p){const y=new Ni,b=new kf,T=new Hn,E=(k,O,z,N,j)=>{const W=(z-k)/(j-1),ie=(N-O)/(j-1),re=y.length;for(let se=0;se<j;se++){const de=k+se*W,ge=O+se*ie;y.emplaceBack(de,ge);const Se=this._globePoint(de,ge,n,a,u,f,p);T.emplaceBack(Se[0],Se[1],Se[2]),b.emplaceBack(re+se)}},I=Lt;E(0,0,I,0,16),E(I,0,I,I,16),E(I,I,0,I,16),E(0,I,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(b),this._tileDebugBuffer=e.createVertexBuffer(y,zf.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(T,Ow.members),this._tileDebugSegments=cr.simpleSegment(0,0,y.length,b.length)}_makeGlobeTileDebugTextBuffer(e,n,a,u,f,p){const y=Lt/4,b=new Ni,T=new kn,E=new Hn,I=25;T.reserve(32),b.reserve(I),E.reserve(I);const k=(O,z)=>I*O+z;for(let O=0;O<I;O++){const z=O*y;for(let N=0;N<I;N++){const j=N*y;b.emplaceBack(j,z);const W=this._globePoint(j,z,n,a,u,f,p);E.emplaceBack(W[0],W[1],W[2])}}for(let O=0;O<4;O++)for(let z=0;z<4;z++){const N=k(O,z),j=k(O,z+1),W=k(O+1,z),ie=k(O+1,z+1);T.emplaceBack(N,j,W),T.emplaceBack(W,j,ie)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(T),this._tileDebugTextBuffer=e.createVertexBuffer(b,zf.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(E,Ow.members),this._tileDebugTextSegments=cr.simpleSegment(0,0,I,32)}destroy(e=!1){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof cc&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.latestFeatureIndex=null,this.state="unloaded"}}class zO{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,a){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const f={value:n,timeout:void 0};if(a!==void 0&&(f.timeout=setTimeout(()=>{this.remove(e,f)},a)),this.data[u].push(f),this.order.push(u),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const a=e.wrapped().key,u=n===void 0?0:this.data[a].indexOf(n),f=this.data[a][u];return this.data[a].splice(u,1),f.timeout&&clearTimeout(f.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(f.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const a in this.data)for(const u of this.data[a])e(u.value)||n.push(u);for(const a of n)this.remove(a.value.tileID,a)}}class oh{constructor(e,n,a,u){this.id=oh.uniqueIdxCounter,oh.uniqueIdxCounter++,this.context=e;const f=e.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||u||n.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=oh.uniqueIdxCounter,oh.uniqueIdxCounter++;const n=this.context.gl;this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}oh.uniqueIdxCounter=0;class wd{constructor(e,n,a){this.func=e,this.mask=n,this.range=a}}wd.ReadOnly=!1,wd.ReadWrite=!0,wd.disabled=new wd(519,wd.ReadOnly,[0,1]);const lv=7680;class cv{constructor(e,n,a,u,f,p){this.test=e,this.ref=n,this.mask=a,this.fail=u,this.depthFail=f,this.pass=p}}cv.disabled=new cv({func:519,mask:0},0,0,lv,lv,lv);class ma{constructor(e,n,a,u){this.blendFunction=e,this.blendColor=n,this.mask=a,this.blendEquation=u}}ma.Replace=[1,0,1,0],ma.disabled=new ma(ma.Replace,Bn.transparent,[!1,!1,!1,!1]),ma.unblended=new ma(ma.Replace,Bn.transparent,[!0,!0,!0,!0]),ma.alphaBlended=new ma([1,771,1,771],Bn.transparent,[!0,!0,!0,!0]),ma.multiply=new ma([774,0,774,0],Bn.transparent,[!0,!0,!0,!0]);const uv=1029,hv=2305;class Va{constructor(e,n,a){this.enable=e,this.mode=n,this.frontFace=a}}Va.disabled=new Va(!1,uv,hv),Va.backCCW=new Va(!0,uv,hv),Va.backCW=new Va(!0,uv,2304),Va.frontCW=new Va(!0,1028,2304),Va.frontCCW=new Va(!0,1028,hv);class sh extends fo{constructor(e,n,a){super(),this.id=e,this._onlySymbols=a,n.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new zO(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new VL,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="errored"&&(n.state!=="loaded"||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const a=this._tiles[n];a.upload(e),a.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Ue(this._tiles).map(e=>e.tileID).sort(gS).map(e=>e.key)}getRenderableIds(e,n){const a=[];for(const u in this._tiles)this._isIdRenderable(+u,e,n)&&a.push(this._tiles[u]);return e?a.sort((u,f)=>{const p=u.tileID,y=f.tileID,b=new we(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),T=new we(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-y.overscaledZ||T.y-b.y||T.x-b.x}).map(u=>u.tileID.key):a.map(u=>u.tileID).sort(gS).map(u=>u.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n,a){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())&&(a||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=n),this._loadTile(a,this._tileLoaded.bind(this,a,e,n)))}_tileLoaded(e,n,a,u){if(u)if(e.state="errored",u.status!==404)this._source.fire(new Ro(u,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new Ao("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=uo.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Ao("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let u=0;u<n.length;u++){const f=n[u];if(e.neighboringTiles&&e.neighboringTiles[f]){const p=this.getTileByID(f);a(e,p),a(p,e)}}function a(u,f){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let p=f.tileID.canonical.x-u.tileID.canonical.x;const y=f.tileID.canonical.y-u.tileID.canonical.y,b=Math.pow(2,u.tileID.canonical.z),T=f.tileID.key;p===0&&y===0||Math.abs(y)>1||(Math.abs(p)>1&&(Math.abs(p+b)===1?p+=b:Math.abs(p-b)===1&&(p-=b)),f.dem&&u.dem&&(u.dem.backfillBorder(f.dem,p,y),u.neighboringTiles&&u.neighboringTiles[T]&&(u.neighboringTiles[T].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,a,u){for(const f in this._tiles){let p=this._tiles[f];if(u[f]||!p.hasData()||p.tileID.overscaledZ<=n||p.tileID.overscaledZ>a)continue;let y=p.tileID;for(;p&&p.tileID.overscaledZ>n+1;){const T=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[T.key],p&&p.hasData()&&(y=T)}let b=y;for(;b.overscaledZ>n;)if(b=b.scaledTo(b.overscaledZ-1),e[b.key]){u[y.key]=y;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=e.overscaledZ-1;a>=n;a--){const u=e.scaledTo(a),f=this._getLoadedTile(u);if(f)return f}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const a=Math.ceil(e.width/n)+1,u=Math.ceil(e.height/n)+1,f=Math.floor(a*u*5),p=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,f):f,y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(y)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const a={};for(const u in this._tiles){const f=this._tiles[u];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+n),a[f.tileID.key]=f}this._tiles=a;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,n,a,u){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let f;if(this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(b=>new mo(b.canonical.z,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y)):(f=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(b=>this._source.hasTile(b)))):f=[],f.length>0&&this.castsShadows&&u&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!dv(this._source.type)){const b=e.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!a}),T=Math.min(b,this._source.maxzoom),E=e.extendTileCoverForShadows(f,u,T);for(const I of E)this._shadowCasterTiles[I.key]=!0,f.push(I)}const p=this._updateRetainedTiles(f);if(dv(this._source.type)&&f.length!==0){const b={},T={},E=Object.keys(p);for(const k of E){const O=p[k],z=this._tiles[k];if(!z||z.fadeEndTime&&z.fadeEndTime<=uo.now())continue;const N=this.findLoadedParent(O,Math.max(O.overscaledZ-sh.maxOverzooming,this._source.minzoom));N&&(this._addTile(N.tileID),b[N.tileID.key]=N.tileID),T[k]=O}const I=f[f.length-1].overscaledZ;for(const k in this._tiles){const O=this._tiles[k];if(p[k]||!O.hasData())continue;let z=O.tileID;for(;z.overscaledZ>I;){z=z.scaledTo(z.overscaledZ-1);const N=this._tiles[z.key];if(N&&N.hasData()&&T[z.key]){p[k]=O.tileID;break}}}for(const k in b)p[k]||(this._coveredTiles[k]=!0,p[k]=b[k])}for(const b in p)this._tiles[b].clearFadeHold();const y=function(b,T){const E=[];for(const I in b)I in T||E.push(I);return E}(this._tiles,p);for(const b of y){const T=this._tiles[b];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+b)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(e.length===0)return n;const a={},u=e.reduce((T,E)=>Math.min(T,E.overscaledZ),1/0),f=e[0].overscaledZ,p=Math.max(f-sh.maxOverzooming,this._source.minzoom),y=Math.max(f+sh.maxUnderzooming,this._source.minzoom),b={};for(const T of e){const E=this._addTile(T);n[T.key]=T,E.hasData()||u<this._source.maxzoom&&(b[T.key]=T)}this._retainLoadedChildren(b,u,y,n);for(const T of e){let E=this._tiles[T.key];if(E.hasData())continue;if(T.canonical.z>=this._source.maxzoom){const k=T.children(this._source.maxzoom)[0],O=this.getTile(k);if(O&&O.hasData()){n[k.key]=k;continue}}else{const k=T.children(this._source.maxzoom);if(n[k[0].key]&&n[k[1].key]&&n[k[2].key]&&n[k[3].key])continue}let I=E.wasRequested();for(let k=T.overscaledZ-1;k>=p;--k){const O=T.scaledTo(k);if(a[O.key]||(a[O.key]=!0,E=this.getTile(O),!E&&I&&(E=this._addTile(O)),E&&(n[O.key]=O,I=E.wasRequested(),E.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let a,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){a=this._loadedParentTiles[u.key];break}n.push(u.key);const f=u.scaledTo(u.overscaledZ-1);if(a=this._getLoadedTile(f),a)break;u=f}for(const f of n)this._loadedParentTiles[f]=a}}_addTile(e){let n=this._tiles[e.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const a=!!n;if(!a){const u=this.map?this.map.painter:null;n=new av(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,a||this._source.fire(new Ao("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=n.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,a){const u=[],f=this.transform;if(!f)return u;const p=f.projection.name==="globe",y=dl(f.center.lng);for(const b in this._tiles){const T=this._tiles[b];if(a&&T.clearQueryDebugViz(),T.holdingForFade())continue;let E;if(p){const I=T.tileID.canonical;if(I.z===0){const k=[Math.abs(rt(y,...ep(I,-1))-y),Math.abs(rt(y,...ep(I,1))-y)];E=[0,2*k.indexOf(Math.min(...k))-1]}else{const k=[Math.abs(rt(y,...ep(I,-1))-y),Math.abs(rt(y,...ep(I,0))-y),Math.abs(rt(y,...ep(I,1))-y)];E=[k.indexOf(Math.min(...k))-1]}}else E=[0];for(const I of E){const k=e.containsTile(T,f,n,I);k&&u.push(k)}}return u}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,n){const a=this.getRenderableIds(e,n).map(f=>this._tiles[f].tileID),u=this.transform.projection.name==="globe";for(const f of a)f.projMatrix=this.transform.calculateProjMatrix(f.toUnwrapped()),f.expandedProjMatrix=u?this.transform.calculateProjMatrix(f.toUnwrapped(),!1,!0):f.projMatrix;return a}sortCoordinatesByDistance(e){const n=e.slice(),a=this.transform._camera.position,u=this.transform._camera.forward(),f={};for(const p of n){const y=1/(1<<p.canonical.z);f[p.key]=((p.canonical.x+.5)*y+p.wrap-a[0])*u[0]+((p.canonical.y+.5)*y-a[1])*u[1]-a[2]*u[2]}return n.sort((p,y)=>f[p.key]-f[y.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(dv(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=uo.now())return!0}return!1}setFeatureState(e,n,a){this._state.updateState(e=e||"_geojsonTileLayer",n,a)}removeFeatureState(e,n,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,a)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,a){const u=this._tiles[e];u&&u.setDependencies(n,a)}reloadTilesForDependencies(e,n){for(const a in this._tiles)this._tiles[a].hasDependency(e,n)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){const y=()=>{this._sourceLoaded&&(this._source.off("data",y),this._preloadTiles(e,n))};return void this._source.on("data",y)}const a=new Map,u=Array.isArray(e)?e:[e],f=this.map.painter.terrain,p=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const y of u){const b=y.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const T of b)a.set(T.key,T);this.usedForTerrain&&y.updateElevation(!1)}kt(Array.from(a.values()),(y,b)=>{const T=new av(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(T,E=>{this._source.type==="raster-dem"&&T.dem&&this._backfillDEM(T),b(E,T)})},n)}}function gS(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||a-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function dv(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function ep(t,e){const n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}sh.maxOverzooming=10,sh.maxUnderzooming=3;const FO=di([{name:"a_pos_3f",components:3,type:"Float32"}]),BO=di([{name:"a_color_3f",components:3,type:"Float32"}]),NO=di([{name:"a_color_4f",components:4,type:"Float32"}]),VO=di([{name:"a_uv_2f",components:2,type:"Float32"}]),UO=di([{name:"a_normal_3f",components:3,type:"Float32"}]),jO=di([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),GO=di([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function _S(t,e){const n=Og(t.projection,t.zoom,t.width,t.height),a=function(f,p,y,b,T){const E=new En(y.lng-180*$c,y.lat),I=new En(y.lng+180*$c,y.lat),k=f.project(E.lng,E.lat),O=f.project(I.lng,I.lat),z=-Math.atan2(O.y-k.y,O.x-k.x),N=Po.fromLngLat(y);N.y=rt(N.y,-1+$c,1-$c);const j=N.toLngLat(),W=f.project(j.lng,j.lat),ie=Po.fromLngLat(j);ie.x+=$c;const re=ie.toLngLat(),se=f.project(re.lng,re.lat),de=xS(se.x-W.x,se.y-W.y,z),ge=Po.fromLngLat(j);ge.y+=$c;const Se=ge.toLngLat(),ke=f.project(Se.lng,Se.lat),Re=xS(ke.x-W.x,ke.y-W.y,z),Ze=Math.abs(de.x)/Math.abs(Re.y),Be=s.m.identity([]);s.m.rotateZ(Be,Be,-z*(1-(T?0:b)));const ut=s.m.identity([]);return s.m.scale(ut,ut,[1,1-(1-Ze)*b,1]),ut[4]=-Re.x/Re.y*b,s.m.rotateZ(ut,ut,z),s.m.multiply(ut,Be,ut),ut}(t.projection,0,t.center,n,e),u=yS(t);return s.m.scale(a,a,[u,u,1]),a}function yS(t){const e=t.projection,n=Og(t.projection,t.zoom,t.width,t.height),a=vS(e,t.center),u=vS(e,En.convert(e.center));return Math.pow(2,a*n+(1-n)*u)}function Og(t,e,n,a,u=1/0){const f=t.range;if(!f)return 0;const p=Math.min(u,Math.max(n,a)),y=Math.log(p/1024)/Math.LN2;return yt(f[0]+y,f[1]+y,e)}const $c=1/4e4;function vS(t,e){const n=rt(e.lat,-Er,Er),a=new En(e.lng-180*$c,n),u=new En(e.lng+180*$c,n),f=t.project(a.lng,n),p=t.project(u.lng,n),y=Po.fromLngLat(a),b=Po.fromLngLat(u),T=p.x-f.x,E=p.y-f.y,I=b.x-y.x,k=b.y-y.y,O=Math.sqrt((I*I+k*k)/(T*T+E*E));return Math.log(O)/Math.LN2}function xS(t,e,n){const a=Math.cos(n),u=Math.sin(n);return{x:t*a-e*u,y:t*u+e*a}}function bS(t,e,n){return e*(Lt/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}function wS(t,e,n){s.m.identity(t),s.m.rotateZ(t,t,Xe(e[2])),s.m.rotateX(t,t,Xe(e[0])),s.m.rotateY(t,t,Xe(e[1])),s.m.scale(t,t,n),s.m.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Rg(t,e,n,a,u,f,p,y){const b=[n[0]-e[0],n[1]-e[1],0],T=[a[0]-e[0],a[1]-e[1],0];if(s.v.length(b)<1e-12||s.v.length(T)<1e-12)return s.q.identity(t);const E=s.v.cross([],b,T);s.v.normalize(E,E),s.v.subtract(T,a,e),b[2]=(f-u)*y,T[2]=(p-u)*y;const I=b;return s.v.cross(I,b,T),s.v.normalize(I,I),s.q.rotationTo(t,E,I)}function TS(t,e,n=!1){const a=oc(e.zoom),u=function(f,p,y){const b=p.worldSize,T=[f[12],f[13],f[14]],E=bo(T[1]/b),I=Cs(T[0]/b),k=s.m.identity([]),O=Ko(1,E)*b,z=Ko(1,0)*b*ih(E,p.zoom),N=1/E0(b);let j=z*N;if(y){const se=Og(p.projection,p.zoom,p.width,p.height,1024);j=N*p.projection.pixelSpaceConversion(p.center.lat,b,se)}const W=th(E,I);s.v.add(W,W,s.v.scale([],s.v.normalize([],W),O*j*T[2]));const ie=function(se){const de=[se[0],se[1],se[2]];let ge=[0,1,0];const Se=s.v.cross([],ge,de);return s.v.cross(ge,de,Se),s.v.squaredLength(ge)===0&&(ge=[0,1,0],s.v.cross(Se,de,ge)),s.v.normalize(Se,Se),s.v.normalize(ge,ge),s.v.normalize(de,de),[Se[0],Se[1],Se[2],0,ge[0],ge[1],ge[2],0,de[0],de[1],de[2],0,se[0],se[1],se[2],1]}(W);s.m.scale(k,k,[j,j,j*O]),s.m.translate(k,k,[-T[0],-T[1],-T[2]]);const re=s.m.multiply([],p.globeMatrix,ie);return s.m.multiply(re,re,k),s.m.multiply(re,re,f),re}(t,e,n);if(a>0){const f=function(p,y){const b=y.worldSize,T=Ko(1,0)*b*ih(y.center.lat,y.zoom)/E0(b),E=Ko(1,y.center.lat)*b,I=s.m.identity([]);return s.m.rotateY(I,I,Xe(y.center.lng)),s.m.rotateX(I,I,Xe(y.center.lat)),s.m.translate(I,I,[0,0,Ys]),s.m.scale(I,I,[T,T,T*E]),s.m.translate(I,I,[y.point.x-.5*b,y.point.y-.5*b,0]),s.m.multiply(I,I,p),s.m.multiply(I,y.globeMatrix,I)}(t,e);return function(p,y,b){const T=(z,N,j)=>{const W=s.v.length(z),ie=s.v.length(N),re=rc(z,N,j);return s.v.scale(re,re,1/s.v.length(re)*Wi(W,ie,j))},E=T([p[0],p[1],p[2]],[y[0],y[1],y[2]],b),I=T([p[4],p[5],p[6]],[y[4],y[5],y[6]],b),k=T([p[8],p[9],p[10]],[y[8],y[9],y[10]],b),O=rc([p[12],p[13],p[14]],[y[12],y[13],y[14]],b);return[E[0],E[1],E[2],0,I[0],I[1],I[2],0,k[0],k[1],k[2],0,O[0],O[1],O[2],1]}(u,f,a)}return u}const ah=64,zg={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4};function tp(t,e,n=!1){t.uploaded||(t.gfxTexture=new cc(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function HO(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,FO.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,UO.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,VO.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?BO:NO).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,GO.members,!0)),t.segments=cr.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const a=t.material;a.pbrMetallicRoughness.baseColorTexture&&tp(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&tp(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&tp(a.normalTexture,e),a.occlusionTexture&&tp(a.occlusionTexture,e,n),a.emissionTexture&&tp(a.emissionTexture,e)}function fv(t,e,n){if(t.meshes)for(const a of t.meshes)HO(a,e,n);if(t.children)for(const a of t.children)fv(a,e,n)}function Fg(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)Fg(e)}function Bg(t){if(t.meshes)for(const n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const n of t.children)Bg(n)}class SS{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class MS{constructor(){this.instancedDataArray=new Yy,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class ES{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,n,a,u){this.tileToMeter=$m(a);const f=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:p,id:y,index:b,sourceLayerIndex:T}of e){const E=Hc(p,f);if(!this.layers[0]._featureFilter.filter(new xe(this.zoom),E,a))continue;const I={id:y,sourceLayerIndex:T,index:b,geometry:f?E.geometry:pl(p,a,u),properties:p.properties,type:p.type,patterns:{}},k=this.addFeature(I,I.geometry,E);k&&n.featureIndex.insert(p,I.geometry,b,T,this.index,this.instancesPerModel[k].instancedDataArray.length)}this.lookup=null}update(e,n,a,u){for(const f in this.instancesPerModel){const p=this.instancesPerModel[f];for(const y in e)p.idToFeaturesIndex.hasOwnProperty(y)&&this.evaluate(p.features[p.idToFeaturesIndex[y]],e[y],p,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const n in this.instancesPerModel){const a=this.instancesPerModel[n];for(const u of a.features){const f=this.layers[0],p=u.feature,y=this.canonical,b=f.paint.get("model-rotation").evaluate(p,{},y),T=f.paint.get("model-scale").evaluate(p,{},y),E=f.paint.get("model-translation").evaluate(p,{},y);s.v.exactEquals(u.rotation,b)&&s.v.exactEquals(u.scale,T)&&s.v.exactEquals(u.translation,E)||(this.evaluate(u,u.featureStates,a,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const n in this.instancesPerModel){const a=this.instancesPerModel[n];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,jO.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const n=this.instancesPerModel[e];n.instancedDataArray.length!==0&&n.instancedDataBuffer&&n.instancedDataBuffer.destroy()}}addFeature(e,n,a){const u=this.layers[0],f=u.layout.get("model-id").evaluate(a,{},this.canonical);if(!f)return ni(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),f;this.instancesPerModel[f]||(this.instancesPerModel[f]=new MS);const p=this.instancesPerModel[f],y=p.instancedDataArray,b=new SS(a,y.length);for(const T of n)for(const E of T){if(E.x<0||E.x>=Lt||E.y<0||E.y>=Lt)continue;const I=(this.lookupDim-1)/Lt,k=this.lookupDim*(E.y*I|0)+E.x*I|0;if(this.lookup){if(this.lookup[k]!==0)continue;this.lookup[k]=1}this.instanceCount++;const O=y.length;y.resize(O+1),p.instancesEvaluatedElevation.push(0),y.float32[16*O]=E.x,y.float32[16*O+1]=E.y}return b.instancedDataCount=p.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(b),this.evaluate(b,{},p,!1)),f}evaluate(e,n,a,u){const f=this.layers[0],p=e.feature,y=this.canonical,b=e.rotation=f.paint.get("model-rotation").evaluate(p,n,y),T=e.scale=f.paint.get("model-scale").evaluate(p,n,y),E=e.translation=f.paint.get("model-translation").evaluate(p,n,y),I=f.paint.get("model-color").evaluate(p,n,y);I.a=f.paint.get("model-color-mix-intensity").evaluate(p,n,y);const k=[];this.maxVerticalOffset<E[2]&&(this.maxVerticalOffset=E[2]),this.maxScale=Math.max(Math.max(this.maxScale,T[0]),Math.max(T[1],T[2])),wS(k,b,T);const O=Math.round(100*I.a)+I.b/1.05;for(let z=0;z<e.instancedDataCount;++z){const N=e.instancedDataOffset+z,j=16*N,W=a.instancedDataArray.float32;let ie=0;u&&(ie=W[j+6]-a.instancesEvaluatedElevation[N]);const re=0|W[j+1];W[j]=(0|W[j])+I.r/1.05,W[j+1]=re+I.g/1.05,W[j+2]=O,W[j+3]=1/(y.z>10?this.tileToMeter:$m(y,re)),W[j+4]=E[0],W[j+5]=E[1],W[j+6]=E[2]+ie,W[j+7]=k[0],W[j+8]=k[1],W[j+9]=k[2],W[j+10]=k[4],W[j+11]=k[5],W[j+12]=k[6],W[j+13]=k[8],W[j+14]=k[9],W[j+15]=k[10],a.instancesEvaluatedElevation[N]=E[2]}}}ri(ES,"ModelBucket",{omit:["layers"]}),ri(MS,"PerModelAttributes"),ri(SS,"ModelFeature");const qO=new _t({visibility:new me(Ne.layout_model.visibility),"model-id":new Fe(Ne.layout_model["model-id"])});var WO={paint:new _t({"model-opacity":new me(Ne.paint_model["model-opacity"]),"model-rotation":new Fe(Ne.paint_model["model-rotation"]),"model-scale":new Fe(Ne.paint_model["model-scale"]),"model-translation":new Fe(Ne.paint_model["model-translation"]),"model-color":new Fe(Ne.paint_model["model-color"]),"model-color-mix-intensity":new Fe(Ne.paint_model["model-color-mix-intensity"]),"model-type":new me(Ne.paint_model["model-type"]),"model-cast-shadows":new me(Ne.paint_model["model-cast-shadows"]),"model-receive-shadows":new me(Ne.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new me(Ne.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Fe(Ne.paint_model["model-emissive-strength"]),"model-roughness":new Fe(Ne.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Fe(Ne.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new me(Ne.paint_model["model-cutoff-fade-range"])}),layout:qO};const pv=new Float32Array(262144),lh=new Uint8Array(262144);function AS(t){let e=0;if(t.meshes)for(const n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(const n of t.children)e=Math.max(e,AS(n));return e}const IS=["","wall","door","roof","window","lamp","logo"];class CS{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:AS(e)}}}}class PS{constructor(e,n,a,u){this.nodes=e,this.id=n,this.modelTraits|=zg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=zg.HasMapboxMeshFeatures),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=u,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const a of n){const u=a.node;this.uploaded?this.updatePbrBuffer(u):fv(u,e,!0)}for(const a of n)Fg(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(const a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),n=!0);return n}needsReEvaluation(e,n,a){const u=e.transform.projectionOptions,f=e.style.getBrightness(),p=this.brightness!==f;return!!(!this.uploaded||this.dirty||u.name!==this.projection.name||ip(a.paint.get("model-color").value,p)||ip(a.paint.get("model-color-mix-intensity").value,p)||ip(a.paint.get("model-roughness").value,p)||ip(a.paint.get("model-emissive-strength").value,p)||ip(a.paint.get("model-height-based-emissive-strength-multiplier").value,p))&&(this.projection=u,this.brightness=f,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const a=this.getNodesInfo(),u=this.id.canonical;for(const f of a){const p=f.feature;f.evaluatedScale=n.paint.get("model-scale").evaluate(p,{},u)}}evaluate(e){const n=this.getNodesInfo();for(const a of n){if(!a.node.meshes)continue;const u=a.feature,f=a.node.meshes&&a.node.meshes[0].featureData,p=a.evaluatedColor[2],y=a.evaluatedRMEA[2],b=this.id.canonical;if(a.hasTranslucentParts=!1,f){for(let T=0;T<IS.length;T++){const E=IS[T];E.length&&(u.properties.part=E);const I=e.paint.get("model-color").evaluate(u,{},b),k=e.paint.get("model-color-mix-intensity").evaluate(u,{},b);a.evaluatedColor[T]=[I.r,I.g,I.b,k],a.evaluatedRMEA[T][0]=e.paint.get("model-roughness").evaluate(u,{},b),a.evaluatedRMEA[T][2]=e.paint.get("model-emissive-strength").evaluate(u,{},b),a.evaluatedRMEA[T][3]=I.a,a.emissionHeightBasedParams[T]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(u,{},b),!a.hasTranslucentParts&&I.a<1&&(a.hasTranslucentParts=!0)}delete u.properties.part,XO(a,p!==a.evaluatedColor[2]||y!==a.evaluatedRMEA[2])}else a.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(u,{},b);a.evaluatedScale=e.paint.get("model-scale").evaluate(u,{},b),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,a,u){const f=e.findDEMTileFor(a);if(f&&(f.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(f.dem&&f.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=f.tileID.overscaledZ;const p=md.create(e,a,f);if(!p)return;this.modelTraits&zg.HasMapboxMeshFeatures&&this.updateDEM(e,p,a,u);for(const y of this.getNodesInfo()){const b=y.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;const T=b.footprint.vertices;let E=p.getElevationAt(T[0].x,T[0].y,!0,!0);for(let I=1;I<T.length;I++)E=Math.min(E,p.getElevationAt(T[I].x,T[I].y,!0,!0));b.elevation=E}}this.terrainTile=f.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,a,u){let f=n._dem._modifiedForSources[u];if(f===void 0&&(n._dem._modifiedForSources[u]=[],f=n._dem._modifiedForSources[u]),f.includes(a.canonical))return;const p=n._dem.dim;f.push(a.canonical);let y=!1;for(const b of this.getNodesInfo()){const T=b.node;if(!T.footprint||!T.footprint.grid)continue;const E=T.footprint.grid,I=n.tileCoordToPixel(E.min.x,E.min.y),k=n.tileCoordToPixel(E.max.x,E.max.y),O=Math.min(Math.min(p-k.y,I.x),Math.min(I.y,p-k.x));if(O<0)continue;const z=rt(O,2,5);let N=Math.max(0,I.x-z),j=Math.max(0,I.y-z),W=Math.min(k.x+z,p-1),ie=Math.min(k.y+z,p-1);for(let ge=j;ge<=ie;++ge)for(let Se=N;Se<=W;++Se)lh[ge*p+Se]=255;let re=0,se=0;for(let ge=0;ge<E.cellsY;++ge)for(let Se=0;Se<E.cellsX;++Se){if(!E.cells[ge*E.cellsX+Se])continue;const ke=n.tileCoordToPixel(E.min.x+Se/E.xScale,E.min.y+ge/E.yScale),Re=n.tileCoordToPixel(E.min.x+(Se+1)/E.xScale,E.min.y+(ge+1)/E.yScale);for(let Ze=ke.y;Ze<=Math.min(Re.y+1,p-1);++Ze)for(let Be=ke.x;Be<=Math.min(Re.x+1,p-1);++Be)lh[Ze*p+Be]===255&&(lh[Ze*p+Be]=0,re+=n.getElevationAtPixel(Be,Ze),se++)}const de=re/se;N=Math.max(1,I.x-z),j=Math.max(1,I.y-z),W=Math.min(k.x+z,p-2),ie=Math.min(k.y+z,p-2),y=!0;for(let ge=j;ge<=ie;++ge)for(let Se=N;Se<=W;++Se)lh[ge*p+Se]===0&&(pv[ge*p+Se]=n._dem.set(Se,ge,de));for(let ge=1;ge<z;++ge){N=Math.max(1,I.x-ge),j=Math.max(1,I.y-ge),W=Math.min(k.x+ge,p-2),ie=Math.min(k.y+ge,p-2);for(let Se=j;Se<=ie;++Se)for(let ke=N;ke<=W;++ke){const Re=Se*p+ke;if(lh[Re]===255){let Ze=0,Be=0,ut=-1,Pt=-1;for(let st=-1;st<=1;++st)for(let St=-1;St<=1;++St){const ot=(Se+st)*p+ke+St;if(lh[ot]>=ge)continue;const qt=pv[ot],ii=Math.abs(qt);ii>Be&&(Ze=qt,Be=ii,ut=St,Pt=st)}if(Be>.1){const st=1-(ge+.5*Math.abs(ut*Pt))/z;let St=n._dem.get(ke,Se)+Ze*st;const ot=n._dem.get(ke+ut,Se+Pt),qt=n._dem.get(ke-ut,Se-Pt,!0);(St-ot)*(St-qt)>0&&(St=(ot+qt)/2),pv[Re]=n._dem.set(ke,Se,St),lh[Re]=ge}}}}}y&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=uo.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const e of this.nodes)this.nodesInfo.push(new CS(e));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const e of this.nodes)Bg(e);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const e=this.getNodesInfo();for(const n of e)Fg(n.node),Bg(n.node)}isEmpty(){return!this.nodes.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const a=n.getReplacementRegionsForTile(e.toUnwrapped()),u=this.getNodesInfo();for(let f=0;f<this.nodesInfo.length;f++){const p=u[f].node;u[f].hiddenByReplacement=!!p.footprint&&!a.find(y=>y.footprint===p.footprint)}}getHeightAtTileCoord(e,n){const a=this.getNodesInfo(),u=[];for(let f=0;f<this.nodesInfo.length;f++){const p=a[f],y=p.node.meshes[0];if(e<y.aabb.min[0]||n<y.aabb.min[1]||e>y.aabb.max[0]||n>y.aabb.max[1])continue;const b=(e-y.aabb.min[0])/(y.aabb.max[0]-y.aabb.min[0])*ah|0,T=Math.min(63,(n-y.aabb.min[1])/(y.aabb.max[1]-y.aabb.min[1])*ah|0)*ah+Math.min(63,b);if(!(y.heightmap[T]<0&&p.node.footprint))return p.hiddenByReplacement?void 0:{height:y.heightmap[T],maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};if(p.node.footprint.grid.query(new we(e,n),new we(e,n),u),u.length>0)return{height:void 0,maxHeight:p.feature.properties.height,hidden:p.hiddenByReplacement,verticalScale:p.evaluatedScale[2]}}}}function ip(t,e){return!t.isLightConstant&&e}function ZO(t,e,n,a,u,f,p,y){let b=(61440&e|(61440&e)>>4)>>8,T=(3840&e|(3840&e)>>4)>>4,E=240&e|(240&e)>>4;n[3]>0&&(b=Wi(b,255*n[0],n[3]),T=Wi(T,255*n[1],n[3]),E=Wi(E,255*n[2],n[3]));const I=b<<8|T,k=E<<8|Math.floor(255*a[3]),O=function(ge){const Se=rt(ge,0,2);return Math.min(Math.round(.5*Se*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],z=rt(u[0],0,1),N=rt(u[1],0,1),j=rt(u[2],0,1),W=rt(u[3],0,1);let ie,re,se,de;if(z!==N&&p!==f&&N!==z){const ge=p-f;re=1/(ge*(N-z)),se=-(f+ge*z)/(ge*(N-z));const Se=rt(u[4],-1,1);de=Math.pow(10,Se),ie=255*j<<8|255*W}else ie=65535,re=0,se=1,de=1;if(t.emplaceBack(I,k,O,ie,re,se,de),y){const ge=y.length;y.clear();for(let Se=0;Se<ge;Se++)y.emplaceBack(I,k,O,ie,re,se,de)}}function XO(t,e){const n=t.node;let a=0;for(const u of n.meshes){if(n.lights&&n.lightMeshIndex===a||!u.featureData)continue;u.featureArray=new Um,u.featureArray.reserve(u.featureData.length);let f=e;for(const p of u.featureData){let y;const b=65535&p,T=(15&b)<8?15&b:0,E=p>>16&65535,I=t.evaluatedRMEA[T],k=t.evaluatedColor[T],O=t.emissionHeightBasedParams[T];if(f&&T===2&&n.lights&&(y=new Um,y.resize(10*n.lights.length)),ZO(u.featureArray,E,k,I,O,u.aabb.min[2],u.aabb.max[2],y),y&&f){f=!1;const z=n.meshes[n.lightMeshIndex];z.featureArray=y,z.featureArray._trim()}}u.featureArray._trim(),a++}}function Ng(t,e){return t.x-e.x||t.y-e.y}function kS(t,e){return Ng(t.min,e.min)===0&&Ng(t.max,e.max)===0}function DS(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function LS(t,e,n){const a=1/Lt,u=1/(1<<n.canonical.z),f=(e.x*a+n.canonical.x)*u+n.wrap,p=(e.y*a+n.canonical.y)*u;return{min:new we((t.x*a+n.canonical.x)*u+n.wrap,(t.y*a+n.canonical.y)*u),max:new we(f,p)}}function YO(t,e,n){const a=1<<n.canonical.z,u=((e.x-n.wrap)*a-n.canonical.x)*Lt,f=(e.y*a-n.canonical.y)*Lt;return{min:new we(((t.x-n.wrap)*a-n.canonical.x)*Lt,(t.y*a-n.canonical.y)*Lt),max:new we(u,f)}}function OS(t,e,n,a,u,f,p){const y=t.indices,b=t.vertices,T=[];for(let E=a;E<a+u;E+=3){const I=e[n[E+0]+f],k=e[n[E+1]+f],O=e[n[E+2]+f],z=Math.min(I.x,k.x,O.x),N=Math.max(I.x,k.x,O.x),j=Math.min(I.y,k.y,O.y),W=Math.max(I.y,k.y,O.y);T.length=0,t.grid.query(new we(z,j),new we(N,W),T);for(let ie=0;ie<T.length;ie++){const re=T[ie];if(z0(b[y[3*re+0]],b[y[3*re+1]],b[y[3*re+2]],I,k,O,p))return!0}}return!1}function RS(t,e,n,a){if(!t||!n)return!1;let u=t.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(n.vertices.length<t.vertices.length)return RS(n,a,t,e);const f=e.canonical,p=a.canonical,y=Math.pow(2,p.z-f.z);u=t.vertices.map(b=>new we(b.x*f.x*Lt*y-p.x*Lt,b.y*f.y*Lt*y-p.y*Lt))}return OS(n,u,t.indices,0,t.indices.length,0,0)}ri(PS,"Tiled3dModelBucket",{omit:["layers"]}),ri(CS,"Tiled3dModelFeature");const JO=ug.types,KO=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],$O=["fill-extrusion-flood-light-ground-radius"],QO=Math.pow(2,13),eR=Math.pow(2,15)-1,zS=new we(0,1),Qc=2147483648;function np(t,e,n,a,u,f,p,y){t.emplaceBack((e<<1)+p,(n<<1)+f,(Math.floor(a*QO)<<1)+u,Math.round(y))}function Vg(t,e,n,a,u,f){t.emplaceBack(e.x,e.y,(n.x<<1)+a,(n.y<<1)+u,f)}function rp(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class FS{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class BS{constructor(){this.centroidXY=new we(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new we(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new we(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new we(this.max.x-this.min.x,this.max.y-this.min.y)}}class NS{constructor(){this.acc=new we(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,a){this.accCount++,this.acc._add(n);let u=!!this.borders;n.x<e.min.x?(e.min.x=n.x,u=!0):n.x>e.max.x&&(e.max.x=n.x,u=!0),n.y<e.min.y?(e.min.y=n.y,u=!0):n.y>e.max.y&&(e.max.y=n.y,u=!0),((n.x===0||n.x===Lt)&&n.x===a.x)!=((n.y===0||n.y===Lt)&&n.y===a.y)&&this.processBorderOverlap(n,a),u&&this.checkBorderIntersection(n,a)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,Wi(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Lt!=e.x>Lt&&this.addBorderIntersection(1,Wi(n.y,e.y,(Lt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Wi(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Lt!=e.y>Lt&&this.addBorderIntersection(3,Wi(n.x,e.x,(Lt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];n<a[0]&&(a[0]=n),n>a[1]&&(a[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,n.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,n.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new we(0,0):new we(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function VS(t,e){const n=t.add(e)._unit(),a=rt(t.x*n.x+t.y*n.y,-1,1);var u,f,p;return u=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(u)))/4*eR*((f=t).x*(p=e).y-f.y*p.x<0?-1:1)}const tR=[t=>t.x<0,t=>t.x>Lt,t=>t.y<0,t=>t.y>Lt];function iR(t,e,n,a){const u=[4];if(a===0)return u;n._mult(a);const f=t.sub(n),p=e.sub(n),y=[t,e,f,p];for(let b=0;b<4;b++)for(const T of y)if(tR[b](T)){u.push(b);break}return u}class US{constructor(e){this.vertexArray=new Fo,this.indexArray=new kn,this.programConfigurations=new Vc(e.layers,e.zoom,n=>$O.includes(n)),this._segments=new cr,this.hiddenByLandmarkVertexArray=new Jy,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new cr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,a,u=!1){const f=e.length;if(f>2){let p=Math.max(0,this._segments.get().length-1);const y=this._segments._prepareSegment(4*f,this.vertexArray.length,2*this._segmentToGroundQuads[p].length);let b;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{const T=e[0],E=e[1];b=VS(T.sub(e[f-1])._perp()._unit(),E.sub(T)._perp()._unit())}for(let T=0;T<f;T++){const E=T===f-1?0:T+1,I=e[T],k=e[E],O=e[E===f-1?0:E+1],z=k.sub(I)._perp()._unit(),N=VS(z,O.sub(k)._perp()._unit()),j=b,W=N;if(mv(I,k,n)||u&&HS(I,n)&&HS(k,n)){b=N;continue}const ie=y.vertexLength;Vg(this.vertexArray,I,k,1,1,j),Vg(this.vertexArray,I,k,1,0,j),Vg(this.vertexArray,I,k,0,1,W),Vg(this.vertexArray,I,k,0,0,W),y.vertexLength+=4;const re=iR(I,k,z,a);for(const se of re)this._segmentToGroundQuads[p].push({id:ie,region:se}),this._segmentToRegionTriCounts[p][se]+=2,y.primitiveLength+=2;b=N}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),n=e.length;for(let a=0;a<n;a++)this._segmentToGroundQuads[a].sort((u,f)=>u.region-f.region);for(let a=0;a<n;a++){const u=this._segmentToGroundQuads[a],f=e[a],p=this._segmentToRegionTriCounts[a];p.reduce((b,T)=>b+T,0);let y=0;for(let b=0;b<=4;b++){const T=p[b];if(T!==0){let E=this.regionSegments[b];E||(E=this.regionSegments[b]=new cr);const I={vertexOffset:f.vertexOffset,primitiveOffset:f.primitiveOffset+y,vertexLength:f.vertexLength,primitiveLength:T};E.get().push(I)}y+=T}for(let b=0;b<u.length;b++){const T=u[b].id;this.indexArray.emplaceBack(T,T+1,T+3),this.indexArray.emplaceBack(T,T+3,T+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,a,u,f,p){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,a,u,f,p)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,_L.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,a,u,f,p){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,a,u,f,p)}updateHiddenByLandmark(e){if(!this.hasData())return;const n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const a=e.flags&Qc?1:0;for(let u=e.groundVertexArrayOffset;u<n;++u)this.hiddenByLandmarkVertexArray.emplace(u,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,vL.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const n=this.regionSegments[e];n&&n.destroy()}}}}class op{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new kn,this.footprintVertices=new Ni,this.footprintSegments=[],this.layoutVertexArray=new Cn,this.centroidVertexArray=new d1,this.indexArray=new kn,this.programConfigurations=new Vc(e.layers,e.zoom,n=>KO.includes(n)),this.segments=new cr,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new US(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,n,a,u){this.features=[],this.hasPattern=G0("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=$m(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:f,id:p,index:y,sourceLayerIndex:b}of e){const T=this.layers[0]._featureFilter.needGeometry,E=Hc(f,T);if(!this.layers[0]._featureFilter.filter(new xe(this.zoom),E,a))continue;const I={id:p,sourceLayerIndex:b,index:y,geometry:T?E.geometry:pl(f,a,u),properties:f.properties,type:f.type,patterns:{}},k=this.layoutVertexArray.length;this.hasPattern?this.features.push(H0("fill-extrusion",this.layers,I,this.zoom,n)):this.addFeature(I,I.geometry,y,a,{},n.availableImages,u,n.brightness),n.featureIndex.insert(f,I.geometry,y,b,this.index,k)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,a,u,f,p){for(const y of this.features){const{geometry:b}=y;this.addFeature(y,b,y.index,n,a,u,f,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,a,u,f){const p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;const y=p?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,y,a,u,f),this.groundEffect.update(e,n,y,a,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bL),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,xL.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,yL.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,a,u,f,p,y,b){const T=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,E=[new we(0,0),new we(Lt,Lt)],I=y.projection,k=I.name==="globe",O=JO[e.type]==="Polygon",z=new NS;z.centroidDataIndex=this.centroidData.length;const N=new BS,j=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},u)<=0,W=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},u);N.height=W,N.vertexArrayOffset=this.layoutVertexArray.length,N.groundVertexArrayOffset=this.groundEffect.vertexArray.length,k&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new er);const ie=j0(n,500);for(let ke=ie.length-1;ke>=0;ke--){const Re=ie[ke];(Re.length===0||(re=Re[0]).every(Ze=>Ze.x<=0)||re.every(Ze=>Ze.x>=Lt)||re.every(Ze=>Ze.y<=0)||re.every(Ze=>Ze.y>=Lt))&&ie.splice(ke,1)}var re;let se;if(k)se=XS(ie,E,u);else{se=[];for(const ke of ie)se.push({polygon:ke,bounds:E})}const de=O?this.edgeRadius:0,ge=de>0&&this.zoom<17,Se=(ke,Re)=>{if(ke.length===0)return!1;const Ze=ke[ke.length-1];return Re.x===Ze.x&&Re.y===Ze.y};for(const{polygon:ke,bounds:Re}of se){let Ze=0,Be=0;for(const St of ke)O&&!St[0].equals(St[St.length-1])&&St.push(St[0]),Be+=O?St.length-1:St.length;const ut=this.segments.prepareSegment((O?5:4)*Be,this.layoutVertexArray,this.indexArray);N.footprintSegIdx<0&&(N.footprintSegIdx=this.footprintSegments.length),N.polygonSegIdx<0&&(N.polygonSegIdx=this.polygonSegments.length);const Pt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},st=new FS;if(st.vertexOffset=this.footprintVertices.length,st.indexOffset=3*this.footprintIndices.length,st.ringIndices=[],O){const St=[],ot=[];Ze=ut.vertexLength;for(let ii=0;ii<ke.length;ii++){const It=ke[ii];It.length&&ii!==0&&ot.push(St.length/2);const Ci=[];let si,Vt;si=It[1].sub(It[0])._perp()._unit(),st.ringIndices.push(It.length-1);for(let Pi=1;Pi<It.length;Pi++){const fi=It[Pi],Ti=It[Pi===It.length-1?1:Pi+1],Rt=fi.clone();if(de){Vt=Ti.sub(fi)._perp()._unit();const Oi=si.add(Vt)._unit(),on=de*Math.min(4,1/(si.x*Oi.x+si.y*Oi.y));Rt.x+=on*Oi.x,Rt.y+=on*Oi.y,Rt.x=Math.round(Rt.x),Rt.y=Math.round(Rt.y),si=Vt}!j||de!==0&&!ge||Se(Ci,Rt)||Ci.push(Rt),np(this.layoutVertexArray,Rt.x,Rt.y,0,0,1,1,0),ut.vertexLength++,this.footprintVertices.emplaceBack(fi.x,fi.y),St.push(fi.x,fi.y),k&&rp(this.layoutVertexExtArray,I.projectTilePoint(Rt.x,Rt.y,u),I.upVector(u,Rt.x,Rt.y))}j&&(de===0||ge)&&(Ci.length!==0&&Se(Ci,Ci[0])&&Ci.pop(),this.groundEffect.addData(Ci,Re,T))}const qt=ag(St,ot);for(let ii=0;ii<qt.length;ii+=3)this.footprintIndices.emplaceBack(st.vertexOffset+qt[ii+0],st.vertexOffset+qt[ii+1],st.vertexOffset+qt[ii+2]),this.indexArray.emplaceBack(Ze+qt[ii],Ze+qt[ii+2],Ze+qt[ii+1]),ut.primitiveLength++;st.indexCount+=qt.length,st.vertexCount+=this.footprintVertices.length-st.vertexOffset}for(let St=0;St<ke.length;St++){const ot=ke[St];z.startRing(N,ot[0]);let qt=ot.length>4&&qS(ot[ot.length-2],ot[0],ot[1]),ii=de?nR(ot[ot.length-2],ot[0],ot[1],de):0;const It=[];let Ci,si,Vt;si=ot[1].sub(ot[0])._perp()._unit();let Pi=!0;for(let fi=1,Ti=0;fi<ot.length;fi++){let Rt=ot[fi-1],Oi=ot[fi];const on=ot[fi===ot.length-1?1:fi+1];if(z.appendEdge(N,Oi,Rt),mv(Oi,Rt,Re)){de&&(si=on.sub(Oi)._perp()._unit(),Pi=!Pi);continue}const Vi=Oi.sub(Rt)._perp(),nn=Vi.x/(Math.abs(Vi.x)+Math.abs(Vi.y)),yn=Vi.y>0?1:0,qn=Rt.dist(Oi);if(Ti+qn>32768&&(Ti=0),de){Vt=on.sub(Oi)._perp()._unit();let An=GS(Rt,Oi,on,jS(si,Vt),de);isNaN(An)&&(An=0);const Pn=Oi.sub(Rt)._unit();Rt=Rt.add(Pn.mult(ii))._round(),Oi=Oi.add(Pn.mult(-An))._round(),ii=An,si=Vt,j&&this.zoom>=17&&(Se(It,Rt)||It.push(Rt),Se(It,Oi)||It.push(Oi))}const Xi=ut.vertexLength,ir=ot.length>4&&qS(Rt,Oi,on);let Wn=WS(Ti,qt,Pi);if(np(this.layoutVertexArray,Rt.x,Rt.y,nn,yn,0,0,Wn),np(this.layoutVertexArray,Rt.x,Rt.y,nn,yn,0,1,Wn),Ti+=qn,Wn=WS(Ti,ir,!Pi),qt=ir,np(this.layoutVertexArray,Oi.x,Oi.y,nn,yn,0,0,Wn),np(this.layoutVertexArray,Oi.x,Oi.y,nn,yn,0,1,Wn),ut.vertexLength+=4,this.indexArray.emplaceBack(Xi+0,Xi+1,Xi+2),this.indexArray.emplaceBack(Xi+1,Xi+3,Xi+2),ut.primitiveLength+=2,de){const An=Ze+(fi===1?ot.length-2:fi-2),Pn=fi===1?Ze:An+1;if(this.indexArray.emplaceBack(Xi+1,An,Xi+3),this.indexArray.emplaceBack(An,Pn,Xi+3),ut.primitiveLength+=2,Ci===void 0&&(Ci=Xi),!mv(on,ot[fi],Re)){const vn=fi===ot.length-1?Ci:ut.vertexLength;this.indexArray.emplaceBack(Xi+2,Xi+3,vn),this.indexArray.emplaceBack(Xi+3,vn+1,vn),this.indexArray.emplaceBack(Xi+3,Pn,vn+1),ut.primitiveLength+=3}Pi=!Pi}if(k){const An=this.layoutVertexExtArray,Pn=I.projectTilePoint(Rt.x,Rt.y,u),vn=I.projectTilePoint(Oi.x,Oi.y,u),wr=I.upVector(u,Rt.x,Rt.y),nr=I.upVector(u,Oi.x,Oi.y);rp(An,Pn,wr),rp(An,Pn,wr),rp(An,vn,nr),rp(An,vn,nr)}}O&&(Ze+=ot.length-1),j&&de&&this.zoom>=17&&(It.length!==0&&Se(It,It[0])&&It.pop(),this.groundEffect.addData(It,Re,T,de>0))}this.footprintSegments.push(st),Pt.triangleCount=this.indexArray.length-Pt.triangleArrayOffset,this.polygonSegments.push(Pt),++N.footprintSegLen,++N.polygonSegLen}if(N.vertexCount=this.layoutVertexArray.length-N.vertexArrayOffset,N.groundVertexCount=this.groundEffect.vertexArray.length-N.groundVertexArrayOffset,N.vertexCount!==0){if(N.centroidXY=z.borders?zS:this.encodeCentroid(z,N),this.centroidData.push(N),z.borders){this.featuresOnBorder.push(z);const ke=this.featuresOnBorder.length-1;for(let Re=0;Re<z.borders.length;Re++)z.borders[Re][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Re].push(ke)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,p,u,b),this.groundEffect.addPaintPropertiesData(e,a,f,p,u,b),this.maxHeight=Math.max(this.maxHeight,W)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,a)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){const e=[];for(let y=0;y<this.centroidData.length;y++){const b=this.centroidData[y],T=+(b.min.y+b.max.y>Lt),E=2*T+(+(b.min.x+b.max.x>Lt)^T);for(let I=0;I<b.polygonSegLen;I++){const k=b.polygonSegIdx+I;e.push({centroidIdx:y,subtile:E,polygonSegmentIdx:k,triangleSegmentIdx:this.polygonSegments[k].triangleSegIdx})}}const n=new kn;e.sort((y,b)=>y.triangleSegmentIdx===b.triangleSegmentIdx?y.subtile-b.subtile:y.triangleSegmentIdx-b.triangleSegmentIdx);let a=0,u=0,f=0;for(const y of e){if(y.triangleSegmentIdx!==a)break;f++}const p=e.length;for(;u!==e.length;){a=e[u].triangleSegmentIdx;let y=0,b=u,T=u;for(let E=b;E<f&&e[E].subtile===y;E++)T++;for(;b!==f;){const E=e[b];y=E.subtile;const I=this.centroidData[E.centroidIdx].min.clone(),k=this.centroidData[E.centroidIdx].max.clone(),O={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let z=b;z<T;z++){const N=e[z],j=this.polygonSegments[N.polygonSegmentIdx],W=this.centroidData[N.centroidIdx].min,ie=this.centroidData[N.centroidIdx].max,re=this.indexArray.uint16;for(let se=j.triangleArrayOffset;se<j.triangleArrayOffset+j.triangleCount;se++)n.emplaceBack(re[3*se],re[3*se+1],re[3*se+2]);O.primitiveLength+=j.triangleCount,I.x=Math.min(I.x,W.x),I.y=Math.min(I.y,W.y),k.x=Math.max(k.x,ie.x),k.y=Math.max(k.y,ie.y)}O.primitiveLength>0&&this.triangleSubSegments.push({segment:O,min:I,max:k}),b=T;for(let z=b;z<f&&e[z].subtile===e[b].subtile;z++)T++}u=f;for(let E=u;E<p&&e[E].triangleSegmentIdx===e[u].triangleSegmentIdx;E++)f++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,a){let u=0,f=0;const p=1<<e.canonical.z;if(n){const N=n.getMinMaxForTile(e);N&&(u=N.min,f=N.max)}f+=this.maxHeight;const y=e.toUnwrapped();let b;const T=[y.canonical.x/p+y.wrap,y.canonical.y/p],E=[(y.canonical.x+1)/p+y.wrap,(y.canonical.y+1)/p],I=new cr,k=(N,j,W)=>[N[0]*(1-W[0])+j[0]*W[0],N[1]*(1-W[1])+j[1]*W[1]],O=[],z=[];for(const N of this.triangleSubSegments){O[0]=N.min.x/Lt,O[1]=N.min.y/Lt,z[0]=N.max.x/Lt,z[1]=N.max.y/Lt;const j=k(T,E,O),W=k(T,E,z);if(new kr([j[0],j[1],u],[W[0],W[1],f]).intersectsPrecise(a)===0){b&&(I.segments.push(b),b=void 0);continue}const ie=N.segment;b&&b.vertexOffset!==ie.vertexOffset&&(I.segments.push(b),b=void 0),b?(b.vertexLength+=ie.vertexLength,b.primitiveLength+=ie.primitiveLength):b={vertexOffset:ie.vertexOffset,primitiveLength:ie.primitiveLength,vertexLength:ie.vertexLength,primitiveOffset:ie.primitiveOffset,sortKey:void 0,vaos:{}}}return b&&I.segments.push(b),I}encodeCentroid(e,n){const a=e.centroid(),u=n.span(),f=Math.min(7,Math.round(u.x*this.tileToMeter/10)),p=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new we(rt(a.x,1,Lt-1)<<3|f,rt(a.y,1,Lt-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new we(0,0);const n=e.borders,a=Number.MAX_VALUE;if(n[0][0]!==a||n[1][0]!==a){const u=n[0][0]!==a?0:1;return new we(6|(n[0][0]!==a?0:65528),((n[u][0]+n[u][1])/2|0)<<3|6)}{const u=n[2][0]!==a?2:3;return new we(((n[u][0]+n[u][1])/2|0)<<3|6,6|(n[2][0]!==a?0:65528))}}showCentroid(e){const n=this.centroidData[e.centroidDataIndex];n.flags&=Qc,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const n=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,u=e.flags&Qc?zS:e.centroidXY,f=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==u.y||f!==u.x){for(let p=n;p<a;++p)this.centroidVertexArray.emplace(p,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const a=n.getReplacementRegionsForTile(e.toUnwrapped());if(function(f,p){if(f.length!==p.length)return!1;for(let y=0;y<f.length;y++)if(f[y].sourceId!==p[y].sourceId||!kS(f[y],p[y]))return!1;return!0}(this.activeReplacements,a))return;if(this.activeReplacements=a,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const f of this.centroidData)f.flags&=2147483647;const u=[];for(const f of this.activeReplacements){const p=Math.pow(2,f.footprintTileId.canonical.z-e.canonical.z);for(const y of this.centroidData)if(!(y.flags&Qc||f.min.x>y.max.x||y.min.x>f.max.x||f.min.y>y.max.y||y.min.y>f.max.y))for(let b=0;b<y.footprintSegLen;b++){const T=this.footprintSegments[y.footprintSegIdx+b];if(u.length=0,rR(this.footprintVertices,T.vertexOffset,T.vertexCount,f.footprintTileId.canonical,e.canonical,u),OS(f.footprint,u,this.footprintIndices.uint16,T.indexOffset,T.indexCount,-T.vertexOffset,-p)){y.flags|=Qc;break}}}for(const f of this.centroidData)this.writeCentroidToBuffer(f);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,a){let u=!1;for(let f=0;f<a.footprintSegLen;f++){const p=this.footprintSegments[a.footprintSegIdx+f];let y=0;for(const b of p.ringIndices){for(let T=y,E=b+y-1;T<b+y;E=T++){const I=this.footprintVertices.int16[2*(T+p.vertexOffset)+0],k=this.footprintVertices.int16[2*(T+p.vertexOffset)+1],O=this.footprintVertices.int16[2*(E+p.vertexOffset)+1];k>n!=O>n&&e<(this.footprintVertices.int16[2*(E+p.vertexOffset)+0]-I)*(n-k)/(O-k)+I&&(u=!u)}y=b}}return u}getHeightAtTileCoord(e,n){let a=Number.NEGATIVE_INFINITY,u=!0;const f=4*(e+Lt)*Lt+(n+Lt);if(this.partLookup.hasOwnProperty(f)){const p=this.partLookup[f];return p?{height:p.height,hidden:!!(p.flags&Qc)}:void 0}for(const p of this.centroidData)e>p.max.x||p.min.x>e||n>p.max.y||p.min.y>n||this.footprintContainsPoint(e,n,p)&&p&&p.height>a&&(a=p.height,this.partLookup[f]=p,u=!!(p.flags&Qc));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:u};this.partLookup[f]=void 0}}function jS(t,e){const n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function nR(t,e,n,a){const u=e.sub(t)._perp()._unit(),f=n.sub(e)._perp()._unit();return GS(t,e,n,jS(u,f),a)}function GS(t,e,n,a,u){const f=Math.sqrt(1-a*a);return Math.min(t.dist(e)/3,e.dist(n)/3,u*f/a)}function mv(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function HS(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function qS(t,e,n){if(t.x<0||t.x>=Lt||e.x<0||e.x>=Lt||n.x<0||n.x>=Lt)return!1;const a=n.sub(e),u=a.perp(),f=t.sub(e);return(a.x*f.x+a.y*f.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(f.x*f.x+f.y*f.y))>-.866&&u.x*f.x+u.y*f.y<0}function WS(t,e,n){const a=e?2|t:-3&t;return n?1|a:-2&a}function ZS(){const t=Math.PI/32,e=Math.tan(t),n=Uf;return n*Math.sqrt(1+2*e*e)-n}function XS(t,e,n){const a=1<<n.z,u=Cs(n.x/a),f=Cs((n.x+1)/a),p=bo(n.y/a),y=bo((n.y+1)/a);return function(b,T,E,I,k=0,O){const z=[];if(!b.length||!E||!I)return z;const N=(ge,Se)=>{for(const ke of ge)z.push({polygon:ke,bounds:Se})},j=Math.ceil(Math.log2(E)),W=Math.ceil(Math.log2(I)),ie=j-W,re=[];for(let ge=0;ge<Math.abs(ie);ge++)re.push(ie>0?0:1);for(let ge=0;ge<Math.min(j,W);ge++)re.push(0),re.push(1);let se=b;if(se=hg(se,T[0].y-k,T[1].y+k,1),se=hg(se,T[0].x-k,T[1].x+k,0),!se.length)return z;const de=[];for(re.length?de.push({polygons:se,bounds:T,depth:0}):N(se,T);de.length;){const ge=de.pop(),Se=ge.depth,ke=re[Se],Re=ge.bounds[0],Ze=ge.bounds[1],Be=ke===0?Re.x:Re.y,ut=ke===0?Ze.x:Ze.y,Pt=O?O(ke,Be,ut):.5*(Be+ut),st=hg(ge.polygons,Be-k,Pt+k,ke),St=hg(ge.polygons,Pt-k,ut+k,ke);if(st.length){const ot=[Re,new we(ke===0?Pt:Ze.x,ke===1?Pt:Ze.y)];re.length>Se+1?de.push({polygons:st,bounds:ot,depth:Se+1}):N(st,ot)}if(St.length){const ot=[new we(ke===0?Pt:Re.x,ke===1?Pt:Re.y),Ze];re.length>Se+1?de.push({polygons:St,bounds:ot,depth:Se+1}):N(St,ot)}}return z}(t,e,Math.ceil((f-u)/11.25),Math.ceil((p-y)/11.25),1,(b,T,E)=>{if(b===0)return .5*(T+E);{const I=bo((n.y+T/Lt)/a);return(fl(.5*(bo((n.y+E/Lt)/a)+I))*a-n.y)*Lt}})}function rR(t,e,n,a,u,f){const p=Math.pow(2,a.z-u.z);for(let y=0;y<n;y++){let b=t.int16[2*(y+e)+0],T=t.int16[2*(y+e)+1];b=(b+u.x*Lt)*p-a.x*Lt,T=(T+u.y*Lt)*p-a.y*Lt,f.push(new we(b,T))}}ri(op,"FillExtrusionBucket",{omit:["layers","features"]}),ri(BS,"PartData"),ri(FS,"FootprintSegment"),ri(NS,"BorderCentroidData"),ri(US,"GroundEffect");const oR=new _t({visibility:new me(Ne["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new me(Ne["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var sR={paint:new _t({"fill-extrusion-opacity":new me(Ne["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Fe(Ne["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new me(Ne["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new me(Ne["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Fe(Ne["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Fe(Ne["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Fe(Ne["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new me(Ne["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new me(Ne["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new me(Ne["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new me(Ne["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new me(Ne["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new me(Ne["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new me(Ne["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new me(Ne["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Fe(Ne["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Fe(Ne["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new me(Ne["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new me(Ne["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new me(Ne["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new me(Ne["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new me(Ne["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:oR};class Td extends we{constructor(e,n,a){super(e,n),this.z=a}}function sp(t,e){return t.x*e.x+t.y*e.y}function YS(t,e){if(t.length===1){let n=0;const a=e[n++];let u;for(;!u||a.equals(u);)if(u=e[n++],!u)return 1/0;for(;n<e.length;n++){const f=e[n],p=t[0],y=u.sub(a),b=f.sub(a),T=p.sub(a),E=sp(y,y),I=sp(y,b),k=sp(b,b),O=sp(T,y),z=sp(T,b),N=E*k-I*I,j=(k*O-I*z)/N,W=(E*z-I*O)/N,ie=a.z*(1-j-W)+u.z*j+f.z*W;if(isFinite(ie))return ie}return 1/0}{let n=1/0;for(const a of e)n=Math.min(n,a.z);return n}}function JS(t,e,n,a,u,f,p,y){const b=p*u.getElevationAt(t,e,!0,!0),T=f[0]!==0,E=T?f[1]===0?p*(f[0]/7-450):p*function(I,k,O){const z=Math.floor(k[0]/8),N=Math.floor(k[1]/8),j=10*(k[0]-8*z),W=10*(k[1]-8*N),ie=I.getElevationAt(z,N,!0,!0),re=I.getMeterToDEM(O),se=Math.floor(.5*(j*re-1)),de=Math.floor(.5*(W*re-1)),ge=I.tileCoordToPixel(z,N),Se=2*se+1,ke=2*de+1,Re=function(St,ot,qt,ii,It){return[St.getElevationAtPixel(ot,qt,!0),St.getElevationAtPixel(ot+It,qt,!0),St.getElevationAtPixel(ot,qt+It,!0),St.getElevationAtPixel(ot+ii,qt+It,!0)]}(I,ge.x-se,ge.y-de,Se,ke),Ze=Math.abs(Re[0]-Re[1]),Be=Math.abs(Re[2]-Re[3]),ut=Math.abs(Re[0]-Re[2])+Math.abs(Re[1]-Re[3]),Pt=Math.min(.25,.5*re*(Ze+Be)/Se),st=Math.min(.25,.5*re*ut/ke);return ie+Math.max(Pt*j,st*W)}(u,f,y):b;return{base:b+(n===0)?-1:n,top:T?Math.max(E+a,b+n+2):b+a}}const aR=new _t({"line-cap":new Fe(Ne.layout_line["line-cap"]),"line-join":new Fe(Ne.layout_line["line-join"]),"line-miter-limit":new me(Ne.layout_line["line-miter-limit"]),"line-round-limit":new me(Ne.layout_line["line-round-limit"]),"line-sort-key":new Fe(Ne.layout_line["line-sort-key"]),visibility:new me(Ne.layout_line.visibility)});var KS={paint:new _t({"line-opacity":new Fe(Ne.paint_line["line-opacity"]),"line-color":new Fe(Ne.paint_line["line-color"]),"line-translate":new me(Ne.paint_line["line-translate"]),"line-translate-anchor":new me(Ne.paint_line["line-translate-anchor"]),"line-width":new Fe(Ne.paint_line["line-width"]),"line-gap-width":new Fe(Ne.paint_line["line-gap-width"]),"line-offset":new Fe(Ne.paint_line["line-offset"]),"line-blur":new Fe(Ne.paint_line["line-blur"]),"line-dasharray":new Fe(Ne.paint_line["line-dasharray"]),"line-pattern":new Fe(Ne.paint_line["line-pattern"]),"line-gradient":new Mt(Ne.paint_line["line-gradient"]),"line-trim-offset":new me(Ne.paint_line["line-trim-offset"]),"line-emissive-strength":new me(Ne.paint_line["line-emissive-strength"]),"line-border-width":new Fe(Ne.paint_line["line-border-width"]),"line-border-color":new Fe(Ne.paint_line["line-border-color"])}),layout:aR};function $S(t,e){return 1/bS(t,1,e.tileZoom)}function QS(t,e,n,a){return t.translatePosMatrix(a||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const eM=t=>{const e=[];tM(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const n=t.paint.get("line-trim-offset");return n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER"),e};function tM(t){const e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}const iM=new class extends Fe{possiblyEvaluate(t,e){return e=new xe(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,a){return e=Ye({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,a)}}(KS.paint.properties["line-width"].specification);function nM(t,e){return e>0?e+2*t:t}iM.useIntegerZoom=!0;const lR=new _t({visibility:new me(Ne.layout_background.visibility)});var cR={paint:new _t({"background-color":new me(Ne.paint_background["background-color"]),"background-pattern":new me(Ne.paint_background["background-pattern"]),"background-opacity":new me(Ne.paint_background["background-opacity"]),"background-emissive-strength":new me(Ne.paint_background["background-emissive-strength"])}),layout:lR};const uR=new _t({visibility:new me(Ne.layout_raster.visibility)});var hR={paint:new _t({"raster-opacity":new me(Ne.paint_raster["raster-opacity"]),"raster-color":new Mt(Ne.paint_raster["raster-color"]),"raster-color-mix":new me(Ne.paint_raster["raster-color-mix"]),"raster-color-range":new me(Ne.paint_raster["raster-color-range"]),"raster-hue-rotate":new me(Ne.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new me(Ne.paint_raster["raster-brightness-min"]),"raster-brightness-max":new me(Ne.paint_raster["raster-brightness-max"]),"raster-saturation":new me(Ne.paint_raster["raster-saturation"]),"raster-contrast":new me(Ne.paint_raster["raster-contrast"]),"raster-resampling":new me(Ne.paint_raster["raster-resampling"]),"raster-fade-duration":new me(Ne.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new me(Ne.paint_raster["raster-emissive-strength"]),"raster-array-band":new me(Ne.paint_raster["raster-array-band"]),"raster-elevation":new me(Ne.paint_raster["raster-elevation"])}),layout:uR};function Ug(t,e,n,a,u,f,p,y){const b=[t,e,1,n,a,1,u,f,1],T=[p,y,1],E=s.bx.adjoint([],b),[I,k,O]=s.v.transformMat3(T,T,E);return s.bx.multiply(b,b,[I,0,0,0,k,0,0,0,O])}function rM(t,e,n,a,u,f,p,y){const b=function(T,E,I,k,O,z,N,j){const W=Ug(0,0,1,0,1,1,0,1),ie=Ug(T,E,I,k,O,z,N,j),re=s.bx.adjoint([],W);return s.bx.multiply(ie,ie,re)}(t,e,n,a,u,f,p,y);return[b[2]/b[8]/Lt,b[5]/b[8]/Lt]}function jg(t){return[t[0],Math.min(Math.max(t[1],-Er),Er)]}class oM extends fo{constructor(e,n,a,u){super(),this.id=e,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new Ao("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=ft(this.map._requestManager.transformRequest(this.url,Gi.Image),(a,u)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new Ro(a)):u&&(this.image=u instanceof HTMLImageElement?uo.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new kg(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ao("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof kg||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],a=e[0][1];for(const f of e)f[1]>a&&(a=f[1]),f[1]<n&&(n=f[1]);const u=(a+n)/2;if(u>Er?this.onNorthPole=!0:u<-Er&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const f=e.map(Po.fromLngLat);this.tileID=function(p){let y=1/0,b=1/0,T=-1/0,E=-1/0;for(const N of p)y=Math.min(y,N.x),b=Math.min(b,N.y),T=Math.max(T,N.x),E=Math.max(E,N.y);const I=Math.max(T-y,E-b),k=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),O=Math.pow(2,k);let z=Math.floor((y+T)/2*O);return z>1&&(z-=1),new eh(k,z,Math.floor((b+E)/2*O))}(f),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ao("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const j in this.tiles){const W=this.tiles[j];W.state!=="loaded"&&(W.state="loaded",W.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const n=Xc(new eh(0,0,0),this.map.transform.projection),a=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(j){const W=j[1].x-j[0].x,ie=j[1].y-j[0].y,re=j[2].x-j[1].x,se=j[2].y-j[1].y,de=j[3].x-j[2].x,ge=j[3].y-j[2].y,Se=j[0].x-j[3].x,ke=j[0].y-j[3].y,Re=W*se-re*ie,Ze=re*ge-de*se,Be=de*ke-Se*ge,ut=Se*ie-W*ke;return Re>0&&Ze>0&&Be>0&&ut>0||Re<0&&Ze<0&&Be<0&&ut<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const u=Xc(this.tileID,this.map.transform.projection),[f,p,y,b]=this.coordinates.map(j=>{const W=u.projection.project(j[0],j[1]);return aS(u,W)._round()});this.perspectiveTransform=rM(f.x,f.y,p.x,p.y,y.x,y.y,b.x,b.y);const T=this._boundsArray=new Cn;T.emplaceBack(f.x,f.y,0,0),T.emplaceBack(p.x,p.y,Lt,0),T.emplaceBack(b.x,b.y,0,Lt),T.emplaceBack(y.x,y.y,Lt,Lt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(T,Lg.members),this.boundsSegments=cr.simpleSegment(0,0,4,2);const E=[],I=function(j){return[jg(j[0]),jg(j[1]),jg(j[2]),jg(j[3])]}(this.coordinates),[k,O,z,N]=function(j){let W=j[0][0],ie=W,re=j[0][1],se=re;for(let de=1;de<j.length;de++)j[de][0]<W?W=j[de][0]:j[de][0]>ie&&(ie=j[de][0]),j[de][1]<re?re=j[de][1]:j[de][1]>se&&(se=j[de][1]);return[W,re,ie-W,se-re]}(I);{const j=new Cn,[W,ie,re,se]=function(ot){let qt=ot[0].x,ii=qt,It=ot[0].y,Ci=It;for(let si=1;si<ot.length;si++)ot[si].x<qt?qt=ot[si].x:ot[si].x>ii&&(ii=ot[si].x),ot[si].y<It?It=ot[si].y:ot[si].y>Ci&&(Ci=ot[si].y);return[qt,It,ii-qt,Ci-It]}(a),de=ot=>[(ot.x-W)/re,(ot.y-ie)/se],[ge,Se,ke,Re]=a.map(de),Ze=function(ot,qt,ii,It,Ci,si,Vt,Pi){const fi=Ug(0,0,1,0,1,1,0,1),Ti=Ug(ot,qt,ii,It,Ci,si,Vt,Pi),Rt=s.bx.adjoint([],Ti);return s.bx.multiply(fi,fi,Rt)}(ge[0],ge[1],Se[0],Se[1],ke[0],ke[1],Re[0],Re[1]);this.elevatedGlobePerspectiveTransform=rM(ge[0],ge[1],Se[0],Se[1],ke[0],ke[1],Re[0],Re[1]);const Be=(ot,qt)=>{E.push(ot.lng);const ii=Math.round((ot.lng-k)/z*Lt),It=Math.round((ot.lat-O)/N*Lt),Ci=de(qt),si=s.v.transformMat3([],[Ci[0],Ci[1],1],Ze),Vt=Math.round(si[0]/si[2]*Lt),Pi=Math.round(si[1]/si[2]*Lt);j.emplaceBack(ii,It,Vt,Pi)},ut=a[3].x-a[0].x,Pt=a[3].y-a[0].y,st=a[2].x-a[1].x,St=a[2].y-a[1].y;for(let ot=0;ot<65;ot++){const qt=ot/64,ii=[a[0].x+qt*ut,a[0].y+qt*Pt],It=[a[1].x+qt*st,a[1].y+qt*St],Ci=It[0]-ii[0],si=It[1]-ii[1];for(let Vt=0;Vt<65;Vt++){const Pi=Vt/64,fi={x:ii[0]+Ci*Pi,y:ii[1]+si*Pi,z:0};Be(n.projection.unproject(fi.x,fi.y),fi)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(j,Lg.members)}{this.maxLongitudeTriangleSize=0;let j=[],W=new kn;const ie=(re,se,de)=>{W.emplaceBack(re,se,de);const ge=E[re],Se=E[se],ke=E[de],Re=Math.min(Math.min(ge,Se),ke),Ze=Math.max(Math.max(ge,Se),ke)-Re;Ze>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ze),j.push(Re+Ze/2)};for(let re=0;re<64;re++)for(let se=0;se<64;se++){const de=65*re+se,ge=de+1,Se=de+65,ke=Se+1;ie(de,Se,ge),ie(ge,Se,ke)}[j,W]=function(re,se){const de=Array.from({length:re.length},(ke,Re)=>Re);de.sort((ke,Re)=>re[ke]-re[Re]);const ge=[],Se=new kn;for(let ke=0;ke<de.length;ke++){const Re=de[ke];ge.push(re[Re]);const Ze=3*Re,Be=Ze+1;Se.emplaceBack(se.uint16[Ze],se.uint16[Be],se.uint16[Be+1])}return[ge,Se]}(j,W),this.elevatedGlobeTrianglesCenterLongitudes=j,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(W)}this.elevatedGlobeSegments=cr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,z/Lt,0,N/Lt,0,0,O,k,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const n=this.map.painter.context,a=n.gl;!this._dirty||this.texture instanceof kg||(this.texture?this.texture.update(this.image):(this.texture=new cc(n,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;const a=this.elevatedGlobeTrianglesCenterLongitudes;let u=((E,I)=>E+360*Math.round((I-E)/360))(e+180,a[0]);const f=new cr,p=(E,I)=>{f.segments.push({vertexOffset:0,primitiveOffset:E,vertexLength:n.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-u)<=y){const E=li(a,0,a.length,u+y);return E===a.length||p(E,Tt(a,E+1,a.length,u+360-y)-E),f}u<a[0]&&(u+=360);const b=Tt(a,0,a.length,u-y);if(b===a.length)return p(0,a.length),f;p(0,b-0);const T=li(a,b+1,a.length,u+y);return T!==a.length&&p(T,a.length-T),f}}class dR extends Qt{constructor(e,n){super(e,{},n),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const fR=new _t({visibility:new me(Ne.layout_sky.visibility)});var pR={paint:new _t({"sky-type":new me(Ne.paint_sky["sky-type"]),"sky-atmosphere-sun":new me(Ne.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new me(Ne.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new me(Ne.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new me(Ne.paint_sky["sky-gradient-radius"]),"sky-gradient":new Mt(Ne.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new me(Ne.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new me(Ne.paint_sky["sky-atmosphere-color"]),"sky-opacity":new me(Ne.paint_sky["sky-opacity"])}),layout:fR};function gv(t,e,n){const a=[0,0,1],u=s.q.identity([]);return s.q.rotateY(u,u,n?-Xe(t)+Math.PI:Xe(t)),s.q.rotateX(u,u,-Xe(e)),s.v.transformQuat(a,a,u),s.v.normalize(a,a)}var mR={paint:new _t({})};const gR={circle:class extends Qt{constructor(t,e,n){super(t,ZD,e,n)}createBucket(t){return new L0(t)}queryRadius(t){const e=t;return ud("circle-radius",this,e)+ud("circle-stroke-width",this,e)+tg(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,a,u,f,p,y){const b=aT(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return cT(t,a,f,p,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,T)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){const n=lT(this);return{config:new Ku(this,e),defines:n,overrideFog:!1}}},heatmap:class extends Qt{createBucket(t){return new hT(t)}constructor(t,e,n){super(t,QD,e,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ig({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return ud("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,a,u,f,p,y){const b=this.paint.get("heatmap-radius").evaluate(e,n);return cT(t,a,f,p,y,!0,!0,new we(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new Ku(this,e),overrideFog:!1}:{}}},hillshade:class extends Qt{constructor(t,e,n){super(t,tL,e,n)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends Qt{constructor(t,e,n){super(t,mL,e,n)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e){return{config:new Ku(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new lg(t)}queryRadius(){return tg(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,a,u,f){return!t.queryGeometry.isAboveHorizon&&iT(sT(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends Qt{constructor(t,e,n){super(t,sR,e,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new op(t)}queryRadius(){return tg(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,a,u,f,p,y,b){const T=aT(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),E=this.paint.get("fill-extrusion-height").evaluate(e,n),I=this.paint.get("fill-extrusion-base").evaluate(e,n),k=[0,0],O=y&&f.elevation,z=f.elevation?f.elevation.exaggeration():1,N=t.tile.getBucket(this);if(O&&N instanceof op){const se=N.centroidVertexArray,de=b+1;de<se.length&&(k[0]=se.geta_centroid_pos0(de),k[1]=se.geta_centroid_pos1(de))}if(k[0]===0&&k[1]===1)return!1;f.projection.name==="globe"&&(a=XS([a],[new we(0,0),new we(Lt,Lt)],t.tileID.canonical).map(se=>se.polygon).flat());const j=O?y:null,[W,ie]=function(se,de,ge,Se,ke,Re,Ze,Be,ut,Pt,st){return se.projection.name==="globe"?function(St,ot,qt,ii,It,Ci,si,Vt,Pi,fi,Ti){const Rt=[],Oi=[],on=St.projection.upVectorScale(Ti,St.center.lat,St.worldSize).metersToTile,Vi=[0,0,0,1],nn=[0,0,0,1],yn=(Xi,ir,Wn,An)=>{Xi[0]=ir,Xi[1]=Wn,Xi[2]=An,Xi[3]=1},qn=ZS();qt>0&&(qt+=qn),ii+=qn;for(const Xi of ot){const ir=[],Wn=[];for(const An of Xi){const Pn=An.x+It.x,vn=An.y+It.y,wr=St.projection.projectTilePoint(Pn,vn,Ti),nr=St.projection.upVector(Ti,An.x,An.y);let Ar=qt,no=ii;if(si){const $o=JS(Pn,vn,qt,ii,si,Vt,Pi,fi);Ar+=$o.base,no+=$o.top}qt!==0?yn(Vi,wr.x+nr[0]*on*Ar,wr.y+nr[1]*on*Ar,wr.z+nr[2]*on*Ar):yn(Vi,wr.x,wr.y,wr.z),yn(nn,wr.x+nr[0]*on*no,wr.y+nr[1]*on*no,wr.z+nr[2]*on*no),s.v.transformMat4(Vi,Vi,Ci),s.v.transformMat4(nn,nn,Ci),ir.push(new Td(Vi[0],Vi[1],Vi[2])),Wn.push(new Td(nn[0],nn[1],nn[2]))}Rt.push(ir),Oi.push(Wn)}return[Rt,Oi]}(se,de,ge,Se,ke,Re,Ze,Be,ut,Pt,st):Ze?function(St,ot,qt,ii,It,Ci,si,Vt,Pi){const fi=[],Ti=[],Rt=[0,0,0,1];for(const Oi of St){const on=[],Vi=[];for(const nn of Oi){const yn=nn.x+ii.x,qn=nn.y+ii.y,Xi=JS(yn,qn,ot,qt,Ci,si,Vt,Pi);Rt[0]=yn,Rt[1]=qn,Rt[2]=Xi.base,Rt[3]=1,s.e.transformMat4(Rt,Rt,It),Rt[3]=Math.max(Rt[3],1e-5);const ir=new Td(Rt[0]/Rt[3],Rt[1]/Rt[3],Rt[2]/Rt[3]);Rt[0]=yn,Rt[1]=qn,Rt[2]=Xi.top,Rt[3]=1,s.e.transformMat4(Rt,Rt,It),Rt[3]=Math.max(Rt[3],1e-5);const Wn=new Td(Rt[0]/Rt[3],Rt[1]/Rt[3],Rt[2]/Rt[3]);on.push(ir),Vi.push(Wn)}fi.push(on),Ti.push(Vi)}return[fi,Ti]}(de,ge,Se,ke,Re,Ze,Be,ut,Pt):function(St,ot,qt,ii,It){const Ci=[],si=[],Vt=It[8]*ot,Pi=It[9]*ot,fi=It[10]*ot,Ti=It[11]*ot,Rt=It[8]*qt,Oi=It[9]*qt,on=It[10]*qt,Vi=It[11]*qt;for(const nn of St){const yn=[],qn=[];for(const Xi of nn){const ir=Xi.x+ii.x,Wn=Xi.y+ii.y,An=It[0]*ir+It[4]*Wn+It[12],Pn=It[1]*ir+It[5]*Wn+It[13],vn=It[2]*ir+It[6]*Wn+It[14],wr=It[3]*ir+It[7]*Wn+It[15],nr=An+Vt,Ar=Pn+Pi,no=vn+fi,$o=Math.max(wr+Ti,1e-5),Dr=An+Rt,Sr=Pn+Oi,No=vn+on,Vo=Math.max(wr+Vi,1e-5);yn.push(new Td(nr/$o,Ar/$o,no/$o)),qn.push(new Td(Dr/Vo,Sr/Vo,No/Vo))}Ci.push(yn),si.push(qn)}return[Ci,si]}(de,ge,Se,ke,Re)}(f,a,I,E,T,p,j,k,z,f.center.lat,t.tileID.canonical),re=t.queryGeometry;return function(se,de,ge){let Se=1/0;iT(ge,de)&&(Se=YS(ge,de[0]));for(let ke=0;ke<de.length;ke++){const Re=de[ke],Ze=se[ke];for(let Be=0;Be<Re.length-1;Be++){const ut=Re[Be],Pt=[ut,Re[Be+1],Ze[Be+1],Ze[Be],ut];tT(ge,Pt)&&(Se=Math.min(Se,YS(ge,Pt)))}}return Se!==1/0&&Se}(W,ie,re.isPointQuery()?re.screenBounds:re.screenGeometry)}},line:class extends Qt{constructor(t,e,n){super(t,KS,e,n),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof sa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=iM.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Pg(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){const n=eM(this);return{config:new Ku(this,e),defines:n,overrideFog:!1}}queryRadius(t){const e=t,n=nM(ud("line-width",this,e),ud("line-gap-width",this,e)),a=ud("line-offset",this,e);return n/2+Math.abs(a)+tg(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,a,u,f){if(t.queryGeometry.isAboveHorizon)return!1;const p=sT(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),y=t.pixelToTileUnitsFactor/2*nM(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),b=this.paint.get("line-offset").evaluate(e,n);return b&&(a=function(T,E){const I=[],k=new we(0,0);for(let O=0;O<T.length;O++){const z=T[O],N=[];for(let j=0;j<z.length;j++){const W=z[j],ie=z[j+1],re=j===0?k:W.sub(z[j-1])._unit()._perp(),se=j===z.length-1?k:ie.sub(W)._unit()._perp(),de=re._add(se)._unit();de._mult(1/(de.x*se.x+de.y*se.y)),N.push(de._mult(E)._add(W))}I.push(N)}return I}(a,b*t.pixelToTileUnitsFactor)),function(T,E,I){for(let k=0;k<E.length;k++){const O=E[k];if(T.length>=3){for(let z=0;z<O.length;z++)if(nh(T,O[z]))return!0}if(GD(T,O,I))return!0}return!1}(p,a,y)}isTileClipped(){return!0}},symbol:Sg,background:class extends Qt{constructor(t,e,n){super(t,cR,e,n)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:class extends Qt{constructor(t,e,n){super(t,hR,e,n),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(t){return!(t&&t._source instanceof oM)||!t._source.onNorthPole&&!t._source.onSouthPole&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-color"].value.expression,[e,n]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=ig({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:e,end:n}],resolution:256}),this.colorRampTexture=null}},sky:class extends Qt{constructor(t,e,n){super(t,pR,e,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ig({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),u=!a,f=t.style.light,p=f.properties.get("position");return u&&f.properties.get("anchor")==="viewport"&&ni("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?gv(p.azimuthal,90-p.polar,e):gv(a[0],90-a[1],e)}const n=this.paint.get("sky-gradient-center");return gv(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends Qt{constructor(t,e,n){super(t,mR,e)}},model:class extends Qt{constructor(t,e,n){super(t,WO,e,n)}createBucket(t){return new ES(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Hu}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};class _R{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class yR{constructor(){this.tasks={},this.taskQueue=[],it(["process"],this),this.invoker=new _R(this.process),this.nextId=0}add(e,n){const a=this.nextId++,u=function({type:f,isSymbolTile:p,zoom:y}){return y=y||0,f==="message"?0:f!=="maybePrepare"||p?f!=="parseTile"||p?f==="parseTile"&&p?300-y:f==="maybePrepare"&&p?400-y:500:200-y:100-y}(n);if(u===0){Ie();try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:n,priority:u,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){Ie();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let u=0;u<this.taskQueue.length;u++){const f=this.tasks[this.taskQueue[u]];f.priority<n&&(n=f.priority,e=u)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class sM{constructor(e,n,a){this.target=e,this.parent=n,this.mapId=a,this.callbacks={},this.cancelCallbacks={},it(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new yR}send(e,n,a,u,f=!1,p){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=p,this.callbacks[y]=a);const b=new Set;return this.target.postMessage({id:y,type:e,hasCallback:!!a,targetMapId:u,mustQueue:f,sourceMapId:this.mapId,data:d(n,b)},b),{cancel:()=>{a&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){const n=e.data,a=n.id;if(a&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){const u=this.cancelCallbacks[a];delete this.cancelCallbacks[a],u&&u.cancel()}else if(n.mustQueue||Ie()){const u=this.callbacks[a],f=this.scheduler.add(()=>this.processTask(a,n),u&&u.metadata||{type:"message"});f&&(this.cancelCallbacks[a]=f)}else this.processTask(a,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){const a=this.callbacks[e];delete this.callbacks[e],a&&(n.error?a(v(n.error)):a(null,v(n.data)))}else{const a=new Set,u=n.hasCallback?(p,y)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?d(p):null,data:d(y,a)},a)}:p=>{},f=v(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,f,u);else if(this.parent.getWorkerSource){const p=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,p[0],f.source,f.scope)[p[1]](f,u)}else u(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class ap{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=vi();const a=this.workerPool.acquire(this.id);for(let u=0;u<a.length;u++){const f=new ap.Actor(a[u],n,this.id);f.name=`Worker ${u}`,this.actors.push(f)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,n,a){kt(this.actors,(u,f)=>{u.send(e,n,f)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}ap.Actor=sM;class aM{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new sc({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const a=this.getKey(e,n);return this.positions[a]}trim(){const e=this.width,n=this.height=Li(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,a){const u=[];let f=e.length%2==1?-e[e.length-1]*a:0,p=e[0]*a,y=!0;u.push({left:f,right:p,isDash:y,zeroLength:e[0]===0});let b=e[0];for(let T=1;T<e.length;T++){y=!y;const E=e[T];f=b*a,b+=E,p=b*a,u.push({left:f,right:p,isDash:y,zeroLength:E===0})}return u}addRoundDash(e,n,a){const u=n/2;for(let f=-a;f<=a;f++){const p=this.width*(this.nextRow+a+f);let y=0,b=e[y];for(let T=0;T<this.width;T++){T/b.right>1&&(b=e[++y]);const E=Math.abs(T-b.left),I=Math.abs(T-b.right),k=Math.min(E,I);let O;const z=f/a*(u+1);if(b.isDash){const N=u-Math.abs(z);O=Math.sqrt(k*k+N*N)}else O=u-Math.sqrt(k*k+z*z);this.image.data[p+T]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(e,n){for(let b=e.length-1;b>=0;--b){const T=e[b],E=e[b+1];T.zeroLength?e.splice(b,1):E&&E.isDash===T.isDash&&(E.left=T.left,e.splice(b,1))}const a=e[0],u=e[e.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const f=this.width*this.nextRow;let p=0,y=e[p];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++p]);const T=Math.abs(b-y.left),E=Math.abs(b-y.right),I=Math.min(T,E);this.image.data[f+b]=Math.max(0,Math.min(255,(y.isDash?I:-I)+n+128))}}addDash(e,n){const a=this.getKey(e,n);if(this.positions[a])return this.positions[a];const u=n==="round",f=u?7:0,p=2*f+1;if(this.nextRow+p>this.height)return ni("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let E=0;E<e.length;E++)e[E]<0&&(ni("Negative value is found in line dasharray, replacing values with 0"),e[E]=0),y+=e[E];if(y!==0){const E=this.width/y,I=this.getDashRanges(e,this.width,E);u?this.addRoundDash(I,E,f):this.addRegularDash(I,n==="square"?.5*E:0)}const b=this.nextRow+f;this.nextRow+=p;const T={tl:[b,f],br:[y,0]};return this.positions[a]=T,T}}ri(aM,"LineAtlas");const lM=1*Na;class cM{constructor(e){const n={},a=[];for(const y in e){const b=e[y],T=n[y]={};for(const E in b.glyphs){const I=b.glyphs[+E];if(!I||I.bitmap.width===0||I.bitmap.height===0)continue;const k=I.metrics.localGlyph?lM:1,O={x:0,y:0,w:I.bitmap.width+2*k,h:I.bitmap.height+2*k};a.push(O),T[E]=O}}const{w:u,h:f}=$0(a),p=new sc({width:u||1,height:f||1});for(const y in e){const b=e[y];for(const T in b.glyphs){const E=b.glyphs[+T];if(!E||E.bitmap.width===0||E.bitmap.height===0)continue;const I=n[y][T],k=E.metrics.localGlyph?lM:1;sc.copy(E.bitmap,p,{x:0,y:0},{x:I.x+k,y:I.y+k},E.bitmap)}}this.image=p,this.positions=n}}ri(cM,"GlyphAtlas");class vR{constructor(e){this.tileID=new mo(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Xc(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster}parse(e,n,a,u,f){this.status="parsing",this.data=e,this.collisionBoxArray=new Ky;const p=new wT(Object.keys(e.layers).sort()),y=new Z0(this.tileID,this.promoteId);y.bucketLayerIDs=[];const b={},T=new aM(256,256),E={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:T,availableImages:a,brightness:this.brightness},I=n.familiesBySource[this.source];for(const ie in I){const re=e.layers[ie];if(!re)continue;let se=!1,de=!1,ge=!1;for(const Re of I[ie])Re[0].type==="symbol"?se=!0:de=!0,Re[0].is3D()&&Re[0].type!=="model"&&(ge=!0);if(this.extraShadowCaster&&!ge||this.isSymbolTile===!0&&!se||this.isSymbolTile===!1&&!de)continue;re.version===1&&ni(`Vector tile source "${this.source}" layer "${ie}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Se=p.encode(ie),ke=[];for(let Re=0;Re<re.length;Re++){const Ze=re.feature(Re),Be=y.getId(Ze,ie);ke.push({feature:Ze,id:Be,index:Re,sourceLayerIndex:Se})}for(const Re of I[ie]){const Ze=Re[0];(!this.extraShadowCaster||Ze.is3D()&&Ze.type!=="model")&&(this.isSymbolTile!==void 0&&Ze.type==="symbol"!==this.isSymbolTile||Ze.minzoom&&this.zoom<Math.floor(Ze.minzoom)||Ze.maxzoom&&this.zoom>=Ze.maxzoom||Ze.visibility!=="none"&&(_v(Re,this.zoom,E.brightness,a),(b[Ze.id]=Ze.createBucket({index:y.bucketLayerIDs.length,layers:Re,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Se,sourceID:this.source,projection:this.projection.spec})).populate(ke,E,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(Re.map(Be=>Be.id))))}}let k,O,z,N;T.trim();const j={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},W=()=>{if(k)return this.status="done",f(k);if(this.extraShadowCaster)this.status="done",f(null,{buckets:Ue(b).filter(ie=>!ie.isEmpty()),featureIndex:y,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:E.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(O&&z&&N){const ie=new cM(O),re=new $T(z,N);for(const se in b){const de=b[se];de instanceof Qf?(_v(de.layers,this.zoom,E.brightness,a),mO(de,O,ie.positions,z,re.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):de.hasPattern&&(de instanceof Pg||de instanceof lg||de instanceof op)&&(_v(de.layers,this.zoom,E.brightness,a),de.addFeatures(E,this.tileID.canonical,re.patternPositions,a,this.tileTransform,this.brightness))}this.status="done",f(null,{buckets:Ue(b).filter(se=>!se.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ie.image,lineAtlas:T,imageAtlas:re,brightness:E.brightness})}};if(!this.extraShadowCaster){const ie=dr(E.glyphDependencies,de=>Object.keys(de).map(Number));Object.keys(ie).length?u.send("getGlyphs",{uid:this.uid,stacks:ie,scope:this.scope},(de,ge)=>{k||(k=de,O=ge,W())},void 0,!1,j):O={};const re=Object.keys(E.iconDependencies);re.length?u.send("getImages",{icons:re,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(de,ge)=>{k||(k=de,z=ge,W())},void 0,!1,j):z={};const se=Object.keys(E.patternDependencies);se.length?u.send("getImages",{icons:se,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(de,ge)=>{k||(k=de,N=ge,W())},void 0,!1,j):N={}}W()}}function _v(t,e,n,a){const u=new xe(e,{brightness:n});for(const f of t)f.recalculate(u,a)}class uM{constructor(e){this.entries={},this.scheduler=e}request(e,n,a,u){const f=this.entries[e]=this.entries[e]||{callbacks:[]};if(f.result){const[p,y]=f.result;return this.scheduler?this.scheduler.add(()=>{u(p,y)},n):u(p,y),()=>{}}return f.callbacks.push(u),f.cancel||(f.cancel=a((p,y)=>{f.result=[p,y];for(const b of f.callbacks)this.scheduler?this.scheduler.add(()=>{b(p,y)},n):b(p,y);setTimeout(()=>delete this.entries[e],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(p=>p!==u),f.callbacks.length||(f.cancel(),delete this.entries[e]))}}}function hM(t,e,n){const a=JSON.stringify(t.request);return t.data&&(this.deduped.entries[a]={result:[null,t.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},u=>{const f=Cr(t.request,(p,y,b,T)=>{p?u(p):y&&u(null,{vectorTile:n?void 0:new q0(new pg(y)),rawData:y,cacheControl:b,expires:T})});return()=>{f.cancel(),u()}},e)}var lp={workerUrl:"",workerClass:null,workerParams:void 0};function xR(){return lp.workerClass!=null?new lp.workerClass:new self.Worker(lp.workerUrl,lp.workerParams)}const yv="mapboxgl_preloaded_worker_pool";class cp{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<cp.workerCount;)this.workers.push(new xR);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[yv]}numActive(){return Object.keys(this.active).length}}let up;function vv(){return up||(up=new cp),up}cp.workerCount=2;let Gg,xv,Ua,bv=null;function dM(){return Ie()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:xv||L.DRACO_URL}const wv=5123,Tv=5126,Sv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[wv]:Uint16Array,5125:Uint32Array,[Tv]:Float32Array},bR={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[wv]:"DT_UINT16",5125:"DT_UINT32",[Tv]:"DT_FLOAT32"},Mv={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function fM(t,e,n){const a=n.json.bufferViews.length,u=n.buffers.length;e.bufferView=a,n.json.bufferViews[a]={buffer:u,byteLength:t.byteLength},n.buffers[u]=t}const Ev="KHR_draco_mesh_compression";function wR(t,e){const n=t.extensions&&t.extensions[Ev];if(!n)return;const a=new Ua.Decoder,u=_M(e,n.bufferView),f=new Ua.Mesh;if(!a.DecodeArrayToMesh(u,u.byteLength,f))throw new Error("Failed to decode Draco mesh");const p=e.json.accessors[t.indices],y=Sv[p.componentType],b=p.count*y.BYTES_PER_ELEMENT,T=Ua._malloc(b);y===Uint16Array?a.GetTrianglesUInt16Array(f,b,T):a.GetTrianglesUInt32Array(f,b,T),fM(Ua.memory.buffer.slice(T,T+b),p,e),Ua._free(T);for(const E of Object.keys(n.attributes)){const I=a.GetAttributeByUniqueId(f,n.attributes[E]),k=e.json.accessors[t.attributes[E]],O=bR[k.componentType],z=k.count*Mv[k.type]*Sv[k.componentType].BYTES_PER_ELEMENT,N=Ua._malloc(z);a.GetAttributeDataArrayForAllPoints(f,I,Ua[O],z,N),fM(Ua.memory.buffer.slice(N,N+z),k,e),Ua._free(N)}a.destroy(),f.destroy(),delete t.extensions[Ev]}const pM=1179937895,mM=new TextDecoder("utf8");function gM(t,e){return new URL(t,e).href}function TR(t,e,n,a){return fetch(gM(t.uri,a)).then(u=>u.arrayBuffer()).then(u=>{e.buffers[n]=u})}function _M(t,e){const n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function SR(t,e,n,a){if(t.uri){const u=gM(t.uri,a);return fetch(u).then(f=>f.blob()).then(f=>createImageBitmap(f)).then(f=>{e.images[n]=f})}if(t.bufferView!==void 0){const u=_M(e,t.bufferView),f=new Blob([u],{type:t.mimeType});return createImageBitmap(f).then(p=>{e.images[n]=p})}}function yM(t,e=0,n){const a={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===pM){const T=new Uint32Array(t,e);let E=2;const I=(T[E++]>>2)-3,k=T[E++]>>2;if(E++,a.json=JSON.parse(mM.decode(T.subarray(E,E+k))),E+=k,E<I){const O=T[E++];E++;const z=e+(E<<2);a.buffers[0]=t.slice(z,z+O)}}else a.json=JSON.parse(mM.decode(new Uint8Array(t,e)));const{buffers:u,images:f,meshes:p,extensionsUsed:y}=a.json;let b=Promise.resolve();if(u){const T=[];for(let E=0;E<u.length;E++){const I=u[E];I.uri?T.push(TR(I,a,E,n)):a.buffers[E]||(a.buffers[E]=null)}b=Promise.all(T)}return b.then(()=>{const T=[],E=y&&y.includes(Ev);if(E&&T.push(function(){if(!Ua)return Gg||(Gg=function(I){let k,O=null;function z(){k=new Uint8Array(O.buffer)}function N(){throw new Error("Unexpected Draco error.")}const j={a:{a:N,d:function(W,ie,re){return k.copyWithin(W,ie,ie+re)},c:function(W){const ie=k.length,re=Math.max(W>>>0,Math.ceil(1.2*ie)),se=Math.ceil((re-ie)/65536);try{return O.grow(se),z(),!0}catch{return!1}},b:N}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(I,j):I.then(W=>W.arrayBuffer()).then(W=>WebAssembly.instantiate(W,j))).then(W=>{const{Rb:ie,Qb:re,P:se,T:de,X:ge,Ja:Se,La:ke,Qa:Re,Va:Ze,Wa:Be,eb:ut,jb:Pt,f:st,e:St,yb:ot,zb:qt,Ab:ii,Bb:It,Db:Ci,Gb:si}=W.instance.exports;O=St;const Vt=(()=>{let Pi=0,fi=0,Ti=0,Rt=0;return Oi=>{Ti&&(ie(Rt),ie(Pi),fi+=Ti,Ti=Pi=0),Pi||(fi+=128,Pi=re(fi));const on=Oi.length+7&-8;let Vi=Pi;on>=fi&&(Ti=on,Vi=Rt=re(on));for(let nn=0;nn<Oi.length;nn++)k[Vi+nn]=Oi[nn];return Vi}})();return z(),st(),{memory:St,_free:ie,_malloc:re,Mesh:class{constructor(){this.ptr=se()}destroy(){de(this.ptr)}},Decoder:class{constructor(){this.ptr=Se()}destroy(){Pt(this.ptr)}DecodeArrayToMesh(Pi,fi,Ti){const Rt=Vt(Pi),Oi=ke(this.ptr,Rt,fi,Ti.ptr);return!!ge(Oi)}GetAttributeByUniqueId(Pi,fi){return{ptr:Re(this.ptr,Pi.ptr,fi)}}GetTrianglesUInt16Array(Pi,fi,Ti){Ze(this.ptr,Pi.ptr,fi,Ti)}GetTrianglesUInt32Array(Pi,fi,Ti){Be(this.ptr,Pi.ptr,fi,Ti)}GetAttributeDataArrayForAllPoints(Pi,fi,Ti,Rt,Oi){ut(this.ptr,Pi.ptr,fi.ptr,Ti,Rt,Oi)}},DT_INT8:ot(),DT_UINT8:qt(),DT_INT16:ii(),DT_UINT16:It(),DT_UINT32:Ci(),DT_FLOAT32:si()}})}(fetch(dM())),Gg.then(I=>{Ua=I,Gg=void 0}))}()),f)for(let I=0;I<f.length;I++)T.push(SR(f[I],a,I,n));return(T.length?Promise.all(T):Promise.resolve()).then(()=>{if(E&&p)for(const{primitives:I}of p)for(const k of I)wR(k,a);return a})})}class vM{constructor(e,n,a){if(this.triangleCount=n.length/3,this.min=new we(0,0),this.max=new we(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0||a===0)return;const u=e.map(E=>E.x),f=e.map(E=>E.y);this.min=new we(Math.min(...u),Math.min(...f)),this.max=new we(Math.max(...u),Math.max(...f));const p=this.max.sub(this.min);p.x=Math.max(p.x,1),p.y=Math.max(p.y,1);const y=Math.max(p.x,p.y)/a;this.cellsX=Math.max(1,Math.ceil(p.x/y)),this.cellsY=Math.max(1,Math.ceil(p.y/y)),this.xScale=1/y,this.yScale=1/y;const b=[];for(let E=0;E<this.triangleCount;E++){const I=e[n[3*E+0]].sub(this.min),k=e[n[3*E+1]].sub(this.min),O=e[n[3*E+2]].sub(this.min),z=eu(Math.floor(Math.min(I.x,k.x,O.x)),this.xScale,this.cellsX),N=eu(Math.floor(Math.max(I.x,k.x,O.x)),this.xScale,this.cellsX),j=eu(Math.floor(Math.min(I.y,k.y,O.y)),this.yScale,this.cellsY),W=eu(Math.floor(Math.max(I.y,k.y,O.y)),this.yScale,this.cellsY),ie=new we(0,0),re=new we(0,0),se=new we(0,0),de=new we(0,0);for(let ge=j;ge<=W;++ge){ie.y=re.y=ge*y,se.y=de.y=(ge+1)*y;for(let Se=z;Se<=N;++Se)ie.x=se.x=Se*y,re.x=de.x=(Se+1)*y,(z0(I,k,O,ie,re,de)||z0(I,k,O,ie,de,se))&&b.push({cellIdx:ge*this.cellsX+Se,triIdx:E})}}if(b.length===0)return;b.sort((E,I)=>E.cellIdx-I.cellIdx||E.triIdx-I.triIdx);let T=0;for(;T<b.length;){const E=b[T].cellIdx,I={start:this.payload.length,len:0};for(;T<b.length&&b[T].cellIdx===E;)++I.len,this.payload.push(b[T++].triIdx);this.cells[E]=I}}query(e,n,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let b=0;b<this.lookup.length;b++)this.lookup[b]=0;const u=eu(e.x-this.min.x,this.xScale,this.cellsX),f=eu(n.x-this.min.x,this.xScale,this.cellsX),p=eu(e.y-this.min.y,this.yScale,this.cellsY),y=eu(n.y-this.min.y,this.yScale,this.cellsY);for(let b=p;b<=y;b++)for(let T=u;T<=f;T++){const E=this.cells[b*this.cellsX+T];if(E)for(let I=0;I<E.len;I++){const k=this.payload[E.start+I],O=Math.floor(k/8),z=1<<k%8;if(!(this.lookup[O]&z)&&(this.lookup[O]|=z,a.push(k),a.length===this.triangleCount))return}}}}function eu(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}function ch(t,e){const n=t.json.bufferViews[e.bufferView];return new Sv[e.componentType](t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*Mv[e.type])}function MR(t,e,n){const a=t.indices,u=t.attributes,f={};f.indexArray=new kn;const p=e.json.accessors[a],y=p.count/3;f.indexArray.reserve(y);const b=ch(e,p);for(let k=0;k<y;k++)f.indexArray.emplaceBack(b[3*k],b[3*k+1],b[3*k+2]);f.indexArray._trim(),f.vertexArray=new Yu;const T=e.json.accessors[u.POSITION];f.vertexArray.reserve(T.count);const E=ch(e,T);for(let k=0;k<T.count;k++)f.vertexArray.emplaceBack(E[3*k],E[3*k+1],E[3*k+2]);if(f.vertexArray._trim(),f.aabb=new kr(T.min,T.max),f.centroid=function(k,O){const z=[0,0,0],N=k.length;if(N>0){for(let j=0;j<N;j++){const W=3*k[j];z[0]+=O[W],z[1]+=O[W+1],z[2]+=O[W+2]}z[0]/=N,z[1]/=N,z[2]/=N}return z}(b,E),u.COLOR_0!==void 0){const k=e.json.accessors[u.COLOR_0],O=Mv[k.type];if(k.componentType===Tv){f.colorArray=O===3?new Yu:new Mn,f.colorArray.reserve(k.count);const z=ch(e,k);if(O===3)for(let N=0;N<k.count;N++)f.colorArray.emplaceBack(z[3*N],z[3*N+1],z[3*N+2]);else for(let N=0;N<k.count;N++)f.colorArray.emplaceBack(z[4*N],z[4*N+1],z[4*N+2],z[4*N+3]);f.colorArray._trim()}else if(k.componentType===wv&&O===4){f.colorArray=new Mn,f.colorArray.resize(k.count);const z=ch(e,k),N=1/65535,j=f.colorArray.float32;for(let W=0;W<4*z.length;++W)j[W]=z[W]*N}else ni(`glTF color buffer parsing for accessor ${JSON.stringify(k)} is not supported`)}if(u.NORMAL!==void 0){f.normalArray=new Yu;const k=e.json.accessors[u.NORMAL];f.normalArray.reserve(k.count);const O=ch(e,k);for(let z=0;z<k.count;z++)f.normalArray.emplaceBack(O[3*z],O[3*z+1],O[3*z+2]);f.normalArray._trim()}if(u.TEXCOORD_0!==void 0&&n.length>0){f.texcoordArray=new Df;const k=e.json.accessors[u.TEXCOORD_0];f.texcoordArray.reserve(k.count);const O=ch(e,k);for(let z=0;z<k.count;z++)f.texcoordArray.emplaceBack(O[2*z],O[2*z+1]);f.texcoordArray._trim()}const I=t.material;return f.material=function(k,O){const{emissiveFactor:z=[0,0,0],alphaMode:N="OPAQUE",alphaCutoff:j=.5,normalTexture:W,occlusionTexture:ie,emissiveTexture:re,doubleSided:se}=k,{baseColorFactor:de=[1,1,1,1],metallicFactor:ge=1,roughnessFactor:Se=1,baseColorTexture:ke,metallicRoughnessTexture:Re}=k.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new Bn(...de),metallicFactor:ge,roughnessFactor:Se,baseColorTexture:ke?O[ke.index]:void 0,metallicRoughnessTexture:Re?O[Re.index]:void 0},doubleSided:se,emissiveFactor:z,alphaMode:N,alphaCutoff:j,normalTexture:W?O[W.index]:void 0,occlusionTexture:ie?O[ie.index]:void 0,emissionTexture:re?O[re.index]:void 0,defined:k.defined===void 0}}(I!==void 0?e.json.materials[I]:{defined:!1},n),u._FEATURE_RGBA4444!==void 0&&(f.featureData=new Uint32Array(ch(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer)),f}function xM(t,e,n){const{matrix:a,rotation:u,translation:f,scale:p,mesh:y,extras:b,children:T}=t,E={};if(E.matrix=a||s.m.fromRotationTranslationScale([],u||[0,0,0,1],f||[0,0,0],p||[1,1,1]),y!==void 0){E.meshes=n[y];const I=E.anchor=[0,0];for(const k of E.meshes){const{min:O,max:z}=k.aabb;I[0]+=O[0]+z[0],I[1]+=O[1]+z[1]}I[0]=Math.floor(I[0]/E.meshes.length/2),I[1]=Math.floor(I[1]/E.meshes.length/2)}if(b&&(b.id&&(E.id=b.id),b.lights&&(E.lights=function(I){if(!I.length)return[];const k=function(W){const ie=atob(W),re=new Uint8Array(ie.length);for(let se=0;se<ie.length;se++)re[se]=ie.codePointAt(se);return re}(I),O=[],z=k.length/24,N=new Uint16Array(k.buffer),j=new Float32Array(k.buffer);for(let W=0;W<z;W++){const ie=N[2*W*6]/30,re=N[2*W*6+1]/30,se=N[2*W*6+10]/100,de=j[6*W+1],ge=j[6*W+2],Se=j[6*W+3],ke=j[6*W+4],Re=Se-de,Ze=ke-ge,Be=Math.hypot(Re,Ze);O.push({pos:[de+.5*Re,ge+.5*Ze,re],normal:[Ze/Be,-Re/Be,0],width:Be,height:ie,depth:se,points:[de,ge,Se,ke]})}return O}(b.lights))),T){const I=[];for(const k of T)I.push(xM(e.json.nodes[k],e,n));E.children=I}return E}function ER(t){if(t.vertices.length===0||t.indices.length===0)return null;const[e,n]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let p=1;p<t.vertices.length;++p){const y=t.vertices[p];e.x=Math.min(e.x,y.x),e.y=Math.min(e.y,y.y),n.x=Math.max(n.x,y.x),n.y=Math.max(n.y,y.y)}const a=Math.ceil(Math.max(n.x-e.x,n.y-e.y)/256),u=Math.max(8,a),f=new vM(t.vertices,t.indices,u);return{vertices:t.vertices,indices:t.indices,grid:f,min:e,max:n}}function AR(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;const a=[];for(const p of n){if(!Array.isArray(p)||p.length!==2)continue;const y=p[0],b=p[1];typeof y=="number"&&typeof b=="number"&&a.push(new we(y,b))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let u=0;for(let p=0;p<a.length;p++){const y=a[p],b=a[(p+1)%a.length],T=a[(p+2)%a.length];u+=(y.x-b.x)*(T.y-b.y)-(T.x-b.x)*(y.y-b.y)}u>0&&a.reverse();const f=ag(a.flatMap(p=>[p.x,p.y]),[]);return f.length===0?null:{vertices:a,indices:f}}function IR(t){const e=[],n=[];let a=0;for(const u of t){a=e.length;const f=u.vertexArray.float32,p=u.indexArray.uint16;for(let y=0;y<u.vertexArray.length;y++)e.push(new we(f[3*y+0],f[3*y+1]));for(let y=0;y<3*u.indexArray.length;y++)n.push(p[y]+a)}if(n.length%3!=0)return null;for(let u=0;u<n.length;u+=3){const f=e[n[u+0]],p=e[n[u+1]],y=e[n[u+2]];(f.x-p.x)*(y.y-p.y)-(y.x-p.x)*(f.y-p.y)>0&&([n[u+1],n[u+2]]=[n[u+2],n[u+1]])}return{vertices:e,indices:n}}function bM(t){const e=function(b,T){const E=[],I=WebGL2RenderingContext;if(b.json.textures)for(const k of b.json.textures){const O={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};k.sampler!==void 0&&Object.assign(O,b.json.samplers[k.sampler]),E.push({image:T[k.source],sampler:O,uploaded:!1})}return E}(t,t.images),n=function(b,T){const E=[];for(const I of b.json.meshes){const k=[];for(const O of I.primitives)k.push(MR(O,b,T));E.push(k)}return E}(t,e),{scenes:a,scene:u,nodes:f}=t.json,p=a?a[u||0].nodes:f,y=[];for(const b of p)y.push(xM(f[b],t,n));return function(b,T,E){const I={},k=new Set;for(let O=0;O<b.length;O++){const z=E[T[O]];if(!z.extras)continue;const N=z.extras["mapbox:footprint:version"],j=z.extras["mapbox:footprint:id"];(N||j)&&k.add(O),N==="1.0.0"&&j&&(I[j]=O)}for(let O=0;O<b.length;O++){if(k.has(O))continue;const z=b[O],N=E[T[O]];if(!N.extras)continue;let j=null;z.id in I&&(j=IR(b[I[z.id]].meshes)),j||(j=AR(N)),j&&(z.footprint=ER(j))}if(k.size>0){const O=Array.from(k.values()).sort((z,N)=>z-N);for(let z=O.length-1;z>=0;z--)b.splice(O[z],1)}}(y,p,t.json.nodes),y}function CR(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,n=t.aabb.min[0]-1,a=t.aabb.min[1]-1,u=ah/(t.aabb.max[0]-n+2),f=ah/(t.aabb.max[1]-a+2);for(let p=0;p<e.length;p+=3){const y=e[p+2],b=(e[p+0]-n)*u|0,T=(e[p+1]-a)*f|0;y>t.heightmap[T*ah+b]&&(t.heightmap[T*ah+b]=y)}}function PR(t,e){const n={};n.indexArray=new kn,n.indexArray.reserve(4*t.length),n.vertexArray=new Yu,n.vertexArray.reserve(10*t.length),n.colorArray=new Mn,n.vertexArray.reserve(10*t.length);let a=0;for(const p of t){const y=Math.min(10,Math.max(4,1.3*p.height))*e,b=[-p.normal[1],p.normal[0],0],T=Math.min(.29,.1*p.width/p.depth),E=p.width-2*p.depth*e*(T+.01),I=s.v.scaleAndAdd([],p.pos,b,E/2),k=s.v.scaleAndAdd([],p.pos,b,-E/2),O=[I[0],I[1],I[2]+p.height],z=[k[0],k[1],k[2]+p.height],N=s.v.scaleAndAdd([],p.normal,b,T);s.v.scale(N,N,y);const j=s.v.scaleAndAdd([],p.normal,b,-T);s.v.scale(j,j,y),s.v.add(N,I,N),s.v.add(j,k,j),I[2]+=.1,k[2]+=.1,n.vertexArray.emplaceBack(N[0],N[1],N[2]),n.vertexArray.emplaceBack(j[0],j[1],j[2]),n.vertexArray.emplaceBack(I[0],I[1],I[2]),n.vertexArray.emplaceBack(k[0],k[1],k[2]),n.vertexArray.emplaceBack(O[0],O[1],O[2]),n.vertexArray.emplaceBack(z[0],z[1],z[2]),n.vertexArray.emplaceBack(I[0],I[1],I[2]),n.vertexArray.emplaceBack(k[0],k[1],k[2]),n.vertexArray.emplaceBack(N[0],N[1],N[2]),n.vertexArray.emplaceBack(j[0],j[1],j[2]);const W=E/y/2;n.colorArray.emplaceBack(-W-T,-1,W,.8),n.colorArray.emplaceBack(W+T,-1,W,.8),n.colorArray.emplaceBack(-W,0,W,1.3),n.colorArray.emplaceBack(W,0,W,1.3),n.colorArray.emplaceBack(W+T,-.8,W,.7),n.colorArray.emplaceBack(W+T,-.8,W,.7),n.colorArray.emplaceBack(0,0,W,1.3),n.colorArray.emplaceBack(0,0,W,1.3),n.colorArray.emplaceBack(W+T,-1.2,W,.8),n.colorArray.emplaceBack(W+T,-1.2,W,.8),n.indexArray.emplaceBack(6+a,4+a,8+a),n.indexArray.emplaceBack(7+a,9+a,5+a),n.indexArray.emplaceBack(0+a,1+a,2+a),n.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}const u={defined:!0,emissiveFactor:[0,0,0]},f={};return f.baseColorFactor=Bn.white,u.pbrMetallicRoughness=f,n.material=u,n.aabb=new kr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}ri(vM,"TriangleGridIndex");const wM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Av{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,a]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=a>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const f=wM[15&a];if(!f)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new Av(y,p,f,e)}constructor(e,n=64,a=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=wM.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-y%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${a}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+y+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=n,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Iv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:p,nodeSize:y}=this,b=[0,f.length-1,0],T=[];for(;b.length;){const E=b.pop()||0,I=b.pop()||0,k=b.pop()||0;if(I-k<=y){for(let j=k;j<=I;j++){const W=p[2*j],ie=p[2*j+1];W>=e&&W<=a&&ie>=n&&ie<=u&&T.push(f[j])}continue}const O=k+I>>1,z=p[2*O],N=p[2*O+1];z>=e&&z<=a&&N>=n&&N<=u&&T.push(f[O]),(E===0?e<=z:n<=N)&&(b.push(k),b.push(O-1),b.push(1-E)),(E===0?a>=z:u>=N)&&(b.push(O+1),b.push(I),b.push(1-E))}return T}within(e,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:f,nodeSize:p}=this,y=[0,u.length-1,0],b=[],T=a*a;for(;y.length;){const E=y.pop()||0,I=y.pop()||0,k=y.pop()||0;if(I-k<=p){for(let j=k;j<=I;j++)SM(f[2*j],f[2*j+1],e,n)<=T&&b.push(u[j]);continue}const O=k+I>>1,z=f[2*O],N=f[2*O+1];SM(z,N,e,n)<=T&&b.push(u[O]),(E===0?e-a<=z:n-a<=N)&&(y.push(k),y.push(O-1),y.push(1-E)),(E===0?e+a>=z:n+a>=N)&&(y.push(O+1),y.push(I),y.push(1-E))}return b}}function Iv(t,e,n,a,u,f){if(u-a<=n)return;const p=a+u>>1;TM(t,e,p,a,u,f),Iv(t,e,n,a,p-1,1-f),Iv(t,e,n,p+1,u,1-f)}function TM(t,e,n,a,u,f){for(;u>a;){if(u-a>600){const T=u-a+1,E=n-a+1,I=Math.log(T),k=.5*Math.exp(2*I/3),O=.5*Math.sqrt(I*k*(T-k)/T)*(E-T/2<0?-1:1);TM(t,e,n,Math.max(a,Math.floor(n-E*k/T+O)),Math.min(u,Math.floor(n+(T-E)*k/T+O)),f)}const p=e[2*n+f];let y=a,b=u;for(hp(t,e,a,n),e[2*u+f]>p&&hp(t,e,a,u);y<b;){for(hp(t,e,y,b),y++,b--;e[2*y+f]<p;)y++;for(;e[2*b+f]>p;)b--}e[2*a+f]===p?hp(t,e,a,b):(b++,hp(t,e,b,u)),b<=n&&(a=b+1),n<=b&&(u=b-1)}}function hp(t,e,n,a){Cv(t,n,a),Cv(e,2*n,2*a),Cv(e,2*n+1,2*a+1)}function Cv(t,e,n){const a=t[e];t[e]=t[n],t[n]=a}function SM(t,e,n,a){const u=t-n,f=e-a;return u*u+f*f}s.$=45,s.A=Er,s.B=function(t){const e=s.m.identity(new Float64Array(16));s.m.multiply(e,t.pixelMatrix,t.globeMatrix);const n=[0,da,0],a=[0,fa,0];return s.v.transformMat4(n,n,e),s.v.transformMat4(a,a,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!A0(t,new En(t.center.lat,90)),a[0]>0&&a[0]<=t.width&&a[1]>0&&a[1]<=t.height&&!A0(t,new En(t.center.lat,-90))]},s.C=Bn,s.D=Uc,s.E=dl,s.F=x0,s.G=Vw,s.H=fl,s.I=oh,s.J=Lt,s.K=function(t,e){const{scale:n}=t.tileTransform,a=n*Lt/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return s.h.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},s.L=En,s.M=Po,s.N=Og,s.O=mo,s.P=we,s.Q=_S,s.R=y0,s.S=function(t){const e=_S(t,!0);return s.h.invert([],[e[0],e[1],e[4],e[5]])},s.T=v0,s.U=zw,s.V=function(t){const{x:e,y:n}=t.point,{lng:a,lat:u}=t._center;return Zw(e,n,t.worldSize,a,u)},s.W=Ks,s.X=ni,s.Y=mt,s.Z=b0,s._=function(t){const e=Math.round((t+45+360)%360/90)%4;return Ft[e]},s.a=ma,s.a$=Hm,s.a0=C0,s.a1=function(t,e){return Jr(Ye(t,{type:"json"}),e)},s.a2=Gi,s.a3=ft,s.a4=uo,s.a5=Js,s.a6=fo,s.a7=Ro,s.a8=Ao,s.a9=cc,s.aA=nh,s.aB=Qw,s.aC=Ys,s.aD=uM,s.aE=Yt,s.aF=hM,s.aG=function(t){mi++,mi>cn&&(t.getActor().send("enforceCacheSizeLimit",$t),mi=0)},s.aH=Kn,s.aI=_u,s.aJ=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},s.aK=oM,s.aL=function(t,e){const n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let a=0;a<t.length;a++){const u=document.createElement("source");Mo(t[a])||(n.crossOrigin="Anonymous"),u.src=t[a],n.appendChild(u)}return{cancel:()=>{}}},s.aM=ci,s.aN=kg,s.aO=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>yM(e,0,t))},s.aP=bM,s.aQ=class{constructor(t,e,n,a){this.id=t,this.position=e!=null?new En(e[0],e[1]):new En(0,0),this.orientation=n??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new kr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(s.m.multiply(t.matrix,e,t.matrix),t.meshes)for(const n of t.meshes){const a=kr.applyTransform(n.aabb,t.matrix);this.aabb.encapsulate(a)}if(t.children)for(const n of t.children)this._applyTransformations(n,t.matrix)}computeBoundsAndApplyParent(){const t=s.m.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}_positionModelOnTerrain(t,e){const n=t.elevation;if(!n)return 0;const a=kr.projectAabbCorners(this.aabb,this.matrix),u=Ko(1,this.position.lat)*t.worldSize,f=function(j,W){const ie=[0,0,1],re=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const se of re){const de=j[se.corners[0]],ge=j[se.corners[1]],Se=j[se.corners[2]],ke=[ge[0]-de[0],ge[1]-de[1],W*(ge[2]-de[2])],Re=s.v.cross(ke,ke,[Se[0]-de[0],Se[1]-de[1],W*(Se[2]-de[2])]);s.v.normalize(Re,Re),se.dotProductWithUp=s.v.dot(Re,ie)}return re.sort((se,de)=>se.dotProductWithUp-de.dotProductWithUp),re[0].corners}(a,u),p=a[f[0]],y=a[f[1]],b=a[f[2]],T=a[f[3]],E=n.getAtPointOrZero(new Po(p[0]/t.worldSize,p[1]/t.worldSize),0),I=n.getAtPointOrZero(new Po(y[0]/t.worldSize,y[1]/t.worldSize),0),k=n.getAtPointOrZero(new Po(b[0]/t.worldSize,b[1]/t.worldSize),0),O=n.getAtPointOrZero(new Po(T[0]/t.worldSize,T[1]/t.worldSize),0),z=(E+O)/2,N=(I+k)/2;return z>N?I<k?Rg(e,y,T,p,I,O,E,u):Rg(e,b,p,T,k,E,O,u):E<O?Rg(e,p,y,b,E,I,k,u):Rg(e,T,b,y,O,k,I,u),Math.max(z,N)}computeModelMatrix(t,e,n,a,u,f,p=!1){const y=t.transform,b=y.zoom,T=y.project(this.position),E=ih(this.position.lat,b),I=1/E;s.m.identity(this.matrix),s.m.translate(this.matrix,this.matrix,[T.x+a[0]*I,T.y+a[1]*I,a[2]]);let k=1,O=1;const z=y.worldSize;if(p){if(y.projection.name==="mercator"){let ie=0;y.elevation&&(ie=y.elevation.getAtPointOrZero(new Po(T.x/z,T.y/z),0));const re=s.e.transformMat4([],[T.x,T.y,ie,1],y.projMatrix)[3]/y.cameraToCenterDistance;k=re,O=re*ih(y.center.lat,b)}else if(y.projection.name==="globe"){const ie=TS(this.matrix,y),re=s.m.multiply([],y.projMatrix,ie),se=[0,0,0,1];s.e.transformMat4(se,se,re);const de=se[3]/y.cameraToCenterDistance,ge=oc(b),Se=y.projection.pixelsPerMeter(this.position.lat,z)*ih(this.position.lat,b),ke=y.projection.pixelsPerMeter(y.center.lat,z)*ih(y.center.lat,b);k=de/Wi(Se,Kw(y.center.lat),ge),O=de*E/Se,k*=ke,O*=ke}}else k=I;s.m.scale(this.matrix,this.matrix,[k,k,O]);const N=[...this.matrix],j=this.orientation,W=[];if(wS(W,[j[0]+e[0],j[1]+e[1],j[2]+e[2]],n),s.m.multiply(this.matrix,N,W),u&&y.elevation){let ie=0;const re=[];if(f&&y.elevation){ie=this._positionModelOnTerrain(y,re);const se=s.m.fromQuat([],re),de=s.m.multiply([],se,W);s.m.multiply(this.matrix,N,de)}else ie=y.elevation.getAtPointOrZero(new Po(T.x/z,T.y/z),0);ie!==0&&(this.matrix[14]+=ie)}}upload(t){if(!this.uploaded){for(const e of this.nodes)fv(e,t);for(const e of this.nodes)Fg(e);this.uploaded=!0}}destroy(){for(const t of this.nodes)Bg(t)}},s.aR=it,s.aS=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.aT=KT,s.aU=tT,s.aV=wo,s.aW=nS,s.aX=iv,s.aY=K0,s.aZ=Av,s.a_=Of,s.aa=$0,s.ab=Q0,s.ac=_t,s.ad=me,s.ae=Ne,s.af=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return pe(t.expression.evaluate(e))}interpolate(t,e,n){return{x:Wi(t.x,e.x,n),y:Wi(t.y,e.y,n),z:Wi(t.z,e.z,n),azimuthal:Wi(t.azimuthal,e.azimuthal,n),polar:Wi(t.polar,e.polar,n)}}},s.ag=je,s.ah=t=>Hs(Ef(t)),s.ai=Vm,s.aj=Pf,s.ak=Ye,s.al=xe,s.am=Hu,s.an=yt,s.ao=oc,s.ap=t=>Hs(Cf(t)),s.aq=js,s.ar=dt,s.as=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,a]){const u=pe([1,n,a]);return{x:u.x,y:u.y,z:u.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:Wi(t.x,e.x,n),y:Wi(t.y,e.y,n),z:Wi(t.z,e.z,n)}}},s.at=function(t,e,n=0,a=!0){const u=new we(n,n),f=t.sub(u),p=e.add(u),y=[f,new we(p.x,f.y),p,new we(f.x,p.y)];return a&&y.push(f.clone()),y},s.au=function(t,e){const n=[];for(let a=0;a<t.length;a++){const u=Xt(a-1,-1,t.length-1),f=Xt(a+1,-1,t.length-1),p=t[a],y=t[f],b=t[u].sub(p).unit(),T=y.sub(p).unit(),E=T.angleWithSep(b.x,b.y),I=b.add(T).unit().mult(-1*e/Math.sin(E/2));n.push(p.add(I))}return n},s.av=aS,s.aw=oT,s.ax=function(t,e,n=0){return s.v.fromValues(((e.x-n)*t.scale-t.x)*Lt,(e.y*t.scale-t.y)*Lt,Jw(e.z,e.y))},s.ay=bS,s.az=function(t){let e=1/0,n=1/0,a=-1/0,u=-1/0;for(const f of t)e=Math.min(e,f.x),n=Math.min(n,f.y),a=Math.max(a,f.x),u=Math.max(u,f.y);return{min:new we(e,n),max:new we(a,u)}},s.b=Ko,s.b$=0,s.b0=Ju,s.b1=v1,s.b2=Jo,s.b3=function(t,e,n){const a=Math.sqrt(t*t+e*e+n*n),u=a>0?Math.acos(n/a)*pt:0;let f=t!==0||e!==0?Math.atan2(-e,-t)*pt+90:0;return f<0&&(f+=360),[a,f,u]},s.b4=wd,s.b5=Va,s.b6=cv,s.b7=e0,s.b8=class extends $l{constructor(t){super(t),this.current=oD}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let a=0;a<9;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},s.b9=y1,s.bA=function(t,e){const n=[0,0,0],a=Vf(hl(e.canonical));return s.v.transformMat4(n,n,a),s.v.transformMat4(n,n,t),n},s.bB=t=>({u_camera_to_center_distance:new Jo(t),u_extrude_scale:new t0(t),u_device_pixel_ratio:new Jo(t),u_matrix:new Of(t),u_inv_rot_matrix:new Of(t),u_merc_center:new Ju(t),u_tile_id:new e0(t),u_zoom_transition:new Jo(t),u_up_dir:new e0(t),u_emissive_strength:new Jo(t)}),s.bC=t=>({u_matrix:new Of(t),u_pixels_to_tile_units:new t0(t),u_device_pixel_ratio:new Jo(t),u_units_to_pixels:new Ju(t),u_dash_image:new Hm(t),u_gradient_image:new Hm(t),u_image_height:new Jo(t),u_texsize:new Ju(t),u_tile_units_to_pixels:new Jo(t),u_alpha_discard_threshold:new Jo(t),u_trim_offset:new Ju(t),u_emissive_strength:new Jo(t)}),s.bD=t=>({u_matrix:new Of(t),u_texsize:new Ju(t),u_pixels_to_tile_units:new t0(t),u_device_pixel_ratio:new Jo(t),u_image:new Hm(t),u_units_to_pixels:new Ju(t),u_tile_units_to_pixels:new Jo(t),u_alpha_discard_threshold:new Jo(t)}),s.bE=La,s.bF=$L,s.bG=QL,s.bH=lT,s.bI=(t,e,n,a,u,f)=>{const p=t.transform,y=p.projection.name==="globe";let b;if(f.paint.get("circle-pitch-alignment")==="map")if(y){const E=Ww(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;b=Float32Array.from([E,0,0,E])}else b=p.calculatePixelsToTileUnitsMatrix(n);else b=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);const T={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(p.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:uo.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:XD,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:f.paint.get("circle-emissive-strength")};if(y){T.u_inv_rot_matrix=a,T.u_merc_center=u,T.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],T.u_zoom_transition=oc(p.zoom);const E=u[0]*Lt,I=u[1]*Lt;T.u_up_dir=p.projection.upVector(new eh(0,0,0),E,I)}return T},s.bJ=eM,s.bK=(t,e,n,a,u)=>{const f=t.transform;return{u_matrix:QS(t,e,n,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:f.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_image:0,u_tile_units_to_pixels:$S(e,f),u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}},s.bL=(t,e,n,a,u,f,p)=>{const y=t.transform,b=y.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:QS(t,e,n,a),u_pixels_to_tile_units:b,u_device_pixel_ratio:f,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:tM(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:$S(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:p,u_emissive_strength:n.paint.get("line-emissive-strength")}},s.bM=Li,s.bN=ig,s.bO=ZS,s.bP=DD,s.bQ=op,s.bR=Qc,s.bS=450,s.bT=7,s.bU=jw,s.bV=M0,s.bW=di,s.bX=Yu,s.bY=Xu,s.bZ=1,s.b_=771,s.ba=tt,s.bb=function(t,e,n){const a=oc(n.zoom),u=t.style.map._antialias,f=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return a===0&&!u&&!f},s.bc=function(t){const e=t.pixelsPerMeter,n=e/Ko(1,t.center.lat),a=s.m.identity(new Float64Array(16));return s.m.translate(a,a,[t.point.x,t.point.y,0]),s.m.scale(a,a,[n,n,e]),Float32Array.from(a)},s.bd=ss,s.be=Jm,s.bf=function(t){const e=Er-5;t=rt(t,-e,e)/e*90;const n=Math.pow(Math.abs(Math.sin(Xe(t))),3);return Math.round(n*(w0.length-1))},s.bg=function(t,e,n,a){const u=e.getNorth(),f=e.getSouth(),p=e.getWest(),y=e.getEast(),b=1<<t.z,T=y-p,E=u-f,I=T/ad,k=-E/w0[n],O=[0,I,0,k,0,0,u,p,0];if(t.z>0){const z=180/a;s.bx.multiply(O,O,[z/T+1,0,0,0,z/E+1,0,-.5*z/I,.5*z/k,1])}return O[2]=b,O[5]=t.x,O[8]=t.y,O},s.bh=Vf,s.bi=hl,s.bj=function(t,e,n){const a=s.m.identity(new Float64Array(16)),u=(e/(1<<t)-.5)*Math.PI*2;return s.m.rotateY(a,n.globeMatrix,u),Float32Array.from(a)},s.bk=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const n=e.getSource().maxzoom,a=1<<n,u=Math.floor(t.x),f=Math.floor((t.x-u)*a),p=Math.floor(t.y*a),y=this.findDEMTileFor(new mo(n,u,n,f,p));return!(!y||!y.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||t.y<0||t.y>1)return e;const u=a.getSource().maxzoom,f=1<<u,p=Math.floor(t.x),y=t.x-p,b=new mo(u,p,u,Math.floor(y*f),Math.floor(t.y*f)),T=this.findDEMTileFor(b);if(!T||!T.dem)return e;const E=T.dem,I=1<<T.tileID.canonical.z,k=(y*I-T.tileID.canonical.x)*E.dim,O=(t.y*I-T.tileID.canonical.y)*E.dim,z=Math.floor(k),N=Math.floor(O);return(n?this.exaggeration():1)*Wi(Wi(E.get(z,N),E.get(z,N+1),O-N),Wi(E.get(z+1,N),E.get(z+1,N+1),O-N),k-z)}getAtTileOffset(t,e,n){const a=1<<t.canonical.z;return this.getAtPointOrZero(new Po(t.wrap+(t.canonical.x+e/Lt)/a,(t.canonical.y+n/Lt)/a))}getAtTileOffsetFunc(t,e,n,a){return u=>{const f=this.getAtTileOffset(t,u.x,u.y),p=a.upVector(t.canonical,u.x,u.y),y=a.upVectorScale(t.canonical,e,n).metersToTile;return s.v.scale(p,p,f*y),p}}getForTilePoints(t,e,n,a){if(this.isUsingMockSource())return!1;const u=md.create(this,t,a);return!!u&&(e.forEach(f=>{f[2]=this.exaggeration()*u.getElevationAt(f[0],f[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const n=e.dem.tree,a=e.tileID,u=1<<t.canonical.z-a.canonical.z;let f=t.canonical.x/u-a.canonical.x,p=t.canonical.y/u-a.canonical.y,y=0;for(let b=0;b<t.canonical.z-a.canonical.z&&!n.leaves[y];b++){f*=2,p*=2;const T=2*Math.floor(p)+Math.floor(f);y=n.childOffsets[y]+T,f%=1,p%=1}return{min:this.exaggeration()*n.minimums[y],max:this.exaggeration()*n.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,n=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const u of t){const f=this.getMinMaxForTile(u.tileID);f&&(n=Math.min(n,f.min),a=Math.max(a,f.max),e=!0)}return e?{min:n,max:a}:null}},s.bl=zf,s.bm=cr,s.bn=Ym,s.bo=Ni,s.bp=kn,s.bq=sh,s.br=ap,s.bs=vv,s.bt=av,s.bu=pT,s.bv=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},s.bw=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},s.by=Ww,s.bz=256,s.c=rt,s.c$=M,s.c0=Zy,s.c1=function(t,e,n,a,u){return rt((t-e)/(n-e)*(u-a)+a,a,u)},s.c2=Bu,s.c3=kr,s.c4=ih,s.c5=TS,s.c6=[1,1,1],s.c7=md,s.c8=zg,s.c9=Bo,s.cA=Hr,s.cB=t=>Hs(If(t)),s.cC=oe,s.cD=Jr,s.cE=ei,s.cF=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.cG=ki,s.cH=$w,s.cI=th,s.cJ=function([t,e,n]){const a=Math.hypot(t,e,n),u=Math.atan2(t,n),f=.5*Math.PI-Math.acos(-e/a);return new En(mt(u),mt(f))},s.cK=Cs,s.cL=Uf,s.cM=L,s.cN=A0,s.cO=Xw,s.cP=function(t){const e=[0,0,0],n=s.m.identity(new Float64Array(16));return s.m.multiply(n,t.pixelMatrix,t.globeMatrix),s.v.transformMat4(e,e,n),new we(e[0],e[1])},s.cQ=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!function(n){if(vt==null){const a=n.navigator?n.navigator.userAgent:null;vt=!!n.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return vt}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.cR=vi,s.cS=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ce,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Dt(t))return t;const n=At(t);return n.params.push(`sdk=js-${M}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Dt(t))return t;const n=At(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeModelURL(t,e){if(!Dt(t))return t;const n=At(t);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,a){if(!Dt(t))return t;const u=At(t);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),n&&u.params.push(`language=${n}`),a&&u.params.push(`worldview=${a}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,a){const u=At(t);return Dt(t)?(u.path=`/styles/v1${u.path}/sprite${e}${n}`,this._makeAPIURL(u,this._customAccessToken||a)):(u.path+=`${e}${n}`,zi(u))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Dt(t))return t;const a=At(t);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&a.authority!=="raster"&&n===512?"@2x":""}${F.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${L.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${L.TILE_URL_VERSION}${a.path}`);const u=this._customAccessToken||function(f){for(const p of f){const y=p.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(a.params)||L.ACCESS_TOKEN;return L.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,u)}canonicalizeTileURL(t,e){const n=At(t);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let a="mapbox://";n.path.match(/^\/raster\/v1\//)?a+=`raster/${n.path.replace(`/${L.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${n.path.replace(`/${L.TILE_URL_VERSION}/`,"")}`;let u=n.params;return e&&(u=u.filter(f=>!f.match(/^access_token=/))),u.length&&(a+=`?${u.join("&")}`),a}canonicalizeTileset(t,e){const n=!!e&&Dt(e),a=[];for(const u of t.tiles||[])zt(u)?a.push(this.canonicalizeTileURL(u,n)):a.push(u);return a}_makeAPIURL(t,e){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=At(L.API_URL);if(t.protocol=a.protocol,t.authority=a.authority,t.protocol==="http"){const u=t.params.indexOf("secure");u>=0&&t.params.splice(u,1)}if(a.path!=="/"&&(t.path=`${a.path}${t.path}`),!L.REQUIRE_ACCESS_TOKEN)return zi(t);if(e=e||L.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(u=>u.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),zi(t)}},s.cT=function(t,e){e?Eo.add(t):Eo.delete(t)},s.cU=F,s.cV=sr,s.cW=$r,s.cX=Ct,s.cY=Kr,s.cZ=function(t){Eo.delete(t)},s.c_=kt,s.ca=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){const e=LS(new we(0,0),new we(Lt,Lt),t),n=[];for(const a of this._activeRegions){if(a.hiddenByOverlap||!DS(e,a))continue;const u=YO(a.min,a.max,t);n.push({min:u.min,max:u.max,sourceId:this._sourceIds[a.priority],footprint:a.footprint,footprintTileId:a.tileId})}return n}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const n=[];for(const a of e.cache.getVisibleCoordinates()){const u=e.cache.getTile(a).buckets[e.layer];if(u)for(const f of u.getNodesInfo()){const p=f.node;p.footprint&&n.push({footprint:p.footprint,id:a.toUnwrapped()})}}return n}})))}_addSource(t){const e=t.getFootprints();if(e.length!==0){for(const n of e){if(!n.footprint)continue;const a=LS(n.footprint.min,n.footprint.max,n.id);this._activeRegions.push({min:a.min,max:a.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:n.id,footprint:n.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||Ng(e.min,n.min)||Ng(e.max,n.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,n=0;for(;!t&&e!==this._activeRegions.length;){const a=this._activeRegions[e],u=this._prevRegions[n];t=a.priority!==u.priority||!kS(a,u),++e,++n}}if(t){++this._updateTime;const e=n=>{const a=this._activeRegions;if(n>=a.length)return n;const u=a[n].priority;for(;n<a.length&&a[n].priority===u;)++n;return n};if(this._sourceIds.length>1){let n=0,a=e(n);for(;n!==a;){let u=n;const f=n;for(;u!==a;){const p=this._activeRegions[u];p.hiddenByOverlap=!1;for(let y=0;y<f;y++){const b=this._activeRegions[y];if(!b.hiddenByOverlap&&DS(p,b)&&(p.hiddenByOverlap=RS(p.footprint,p.tileId,b.footprint,b.tileId),p.hiddenByOverlap))break}++u}n=a,a=e(n)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},s.cb=Cn,s.cc=Lg,s.cd=kf,s.ce=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){const n=new Ni,a=new kn,u=[],f=t+1+2,p=e[0]+1,y=e[0]+1+(1+e.length),b=(T,E,I)=>{let k=T===f-1?T-2:T===0?T:T-1;return k+=I?24575:0,[k,E]};for(let T=0;T<f;++T)n.emplaceBack(...b(T,0,!0));for(let T=0;T<p;++T)for(let E=0;E<f;++E)n.emplaceBack(...b(E,T,(E===0||E===f-1)&&!0));for(let T=0;T<e.length;++T){const E=e[T];for(let I=0;I<f;++I)n.emplaceBack(...b(I,E,!0))}for(let T=0;T<e.length;++T){const E=a.length,I=e[T]+1+2,k=new kn;for(let N=0;N<I-1;N++){const j=N===I-2,W=j?f*(y-e.length+T-N):f;for(let ie=0;ie<f-1;ie++){const re=N*f+ie;N===0||j||ie===0||ie===f-2?(k.emplaceBack(re+1,re,re+W),k.emplaceBack(re+W,re+W+1,re+1)):(a.emplaceBack(re+1,re,re+W),a.emplaceBack(re+W,re+W+1,re+1))}}const O=cr.simpleSegment(0,E,n.length,a.length-E);for(let N=0;N<k.uint16.length;N+=3)a.emplaceBack(k.uint16[N],k.uint16[N+1],k.uint16[N+2]);const z=cr.simpleSegment(0,E,n.length,a.length-E);u.push({withoutSkirts:O,withSkirts:z})}return{vertices:n,indices:a,segments:u}}_createGrid(t){const e=this._fillGridMeshWithLods(ad,w0);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,zf.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new kn;for(let p=0;p<=ad;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const n=new Xu,a=new Xu,u=new Xu,f=new Xu;this._poleSegments=[];for(let p=0,y=0;p<b0;p++){const b=360/(1<<p);n.emplaceBack(0,-Ys,0,.5,0),a.emplaceBack(0,-Ys,0,.5,1),u.emplaceBack(0,-Ys,0,.5,.5),f.emplaceBack(0,-Ys,0,.5,.5);for(let T=0;T<=ad;T++){let E=T/ad,I=0;const k=Wi(0,b,E),[O,z,N]=ld(zD,FD,k,Ys);n.emplaceBack(O,z,N,E,I),a.emplaceBack(O,z,N,E,1-I);const j=Xe(k);E=.5+.5*Math.sin(j),I=.5+.5*Math.cos(j),u.emplaceBack(O,z,N,E,I),f.emplaceBack(O,z,N,E,1-I)}this._poleSegments.push(cr.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,Xm,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(a,Xm,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(u,Xm,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(f,Xm,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},s.cf=function(t){return Eo.has(t)},s.cg=$m,s.ch=pe,s.ci=function(t){return t({pluginStatus:$,pluginURL:le}),oe.on("pluginStateChange",t),t},s.cj=yd,s.ck=ev,s.cl=$n,s.cm=_e,s.cn=Dt,s.co=xi,s.cp=function(t,e,n){return t.type==="custom"?new dR(t,e):new gR[t.type](t,e,n)},s.cq=function(t){const e=t.indexOf(oi);return e>=0?t.slice(0,e):t},s.cr=t=>Hs(Bm(t)),s.cs=t=>Hs(zm(t)),s.ct=t=>Hs(Af(t)),s.cu=function(t){return t.indexOf(oi)>=0},s.cv=function(t){const e=t.indexOf(oi);return e>=0?t.slice(e+1):""},s.cw=ju,s.cx=function(t){const e=[],n=t.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},s.cy=t=>Hs(Rm(t)),s.cz=t=>Hs(Mf(t)),s.d=Xe,s.d0=function(t,e){$t=t,cn=e},s.d1=function(t,e,n=!1){if($===K||$===Q||$===te)throw new Error("setRTLTextPlugin cannot be called multiple times.");le=uo.resolveURL(t),$=K,ee=e,ye(),n||ve()},s.d2=he,s.d3=function(){vv().acquire(yv)},s.d4=function(){const t=up;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(yv),up=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.d5=cp,s.d6=function(t){const e=gn();if(!e)return;const n=e.delete(wi);t&&n.catch(t).then(()=>t())},s.d7=lp,s.d8=dM,s.d9=function(t){xv=uo.resolveURL(t),bv||(bv=new ap(vv(),new fo)),bv.broadcast("setDracoUrl",xv)},s.da=Ue,s.db=mg,s.dc=fe,s.dd=ug,s.de=cg,s.df=We,s.dg=TT,s.dh=class extends fo{constructor(t,e,n,a,u,f){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=u||hM,this.loading={},this.loaded={},this.deduped=new uM(t.scheduler),this.isSpriteLoaded=a,this.scheduler=t.scheduler,this.brightness=f}loadTile(t,e){const n=t.uid,a=t&&t.request,u=a&&a.collectResourceTiming,f=this.loading[n]=new vR(t);f.abort=this.loadVectorData(t,(p,y)=>{const b=!this.loading[n];if(delete this.loading[n],b||p||!y)return f.status="done",b||(this.loaded[n]=f),e(p);const T=y.rawData,E={};y.expires&&(E.expires=y.expires),y.cacheControl&&(E.cacheControl=y.cacheControl),f.vectorTile=y.vectorTile||new q0(new pg(T));const I=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(k,O)=>{if(k||!O)return e(k);const z={};if(u){const N=Dl(a);N.length>0&&(z.resourceTiming=JSON.parse(JSON.stringify(N)))}e(null,Ye({rawTileData:T.slice(0)},O,E,z))})};this.isSpriteLoaded?I():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(I,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):I()}),this.loaded=this.loaded||{},this.loaded[n]=f})}reloadTile(t,e){const n=this.loaded,a=t.uid,u=this;if(n&&n[a]){const f=n[a];f.showCollisionBoxes=t.showCollisionBoxes,f.projection=t.projection,f.brightness=t.brightness,f.tileTransform=Xc(t.tileID.canonical,t.projection),f.extraShadowCaster=t.extraShadowCaster;const p=(y,b)=>{const T=f.reloadCallback;T&&(delete f.reloadCallback,f.parse(f.vectorTile,u.layerIndex,this.availableImages,u.actor,T)),e(y,b)};f.status==="parsing"?f.reloadCallback=p:f.status==="done"&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,p):p())}else e(null,void 0)}abortTile(t,e){const n=t.uid,a=this.loading[n];a&&(a.abort&&a.abort(),delete this.loading[n]),e()}removeTile(t,e){const n=this.loaded,a=t.uid;n&&n[a]&&delete n[a],e()}},s.di=Dl,s.dj=Cr,s.dk=Z0,s.dl=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==pM){const n=new Uint32Array(t,0,7),[,,a,u,f,p]=n;e=n.byteLength+u+f+p+f,(a!==t.byteLength||e>=t.byteLength)&&ni("Invalid b3dm header information.")}return yM(t,e)},s.dm=function(t,e){const n=bM(t);for(const a of n){for(const u of a.meshes)CR(u);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(PR(a.lights,e)))}return n},s.dn=PS,s.dp=sM,s.dq=Ee,s.dr=function(t){wn(),dn&&dn.then(e=>{e.keys().then(n=>{for(let a=0;a<n.length-t;a++)e.delete(n[a])})})},s.f=function(t,e){const{x:n,y:a}=t.point,u=Zw(n,a,t.worldSize/t._pixelsPerMercatorPixel,0,0);return s.m.multiply(u,u,M0(hl(e)))},s.g=Jt,s.i=gd,s.j=gg,s.k=Ig,s.l=bo,s.n=Wi,s.o=dS,s.p=function(t,e){const n={};for(let a=0;a<e.length;a++){const u=e[a];u in t&&(n[u]=t[u])}return n},s.r=yS,s.s=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},s.t=eh,s.u=function(t,e,n,a,u){const f=5*e+2;t.float32[f+0]=n,t.float32[f+1]=a,t.float32[f+2]=u},s.w=Xt,s.x=Hw,s.y=function(t,e,n,a,u,f,p,y,b){if(b.name==="globe")return Hw(t,e,new eh(n,a,u),!1);const T=Xc({z:n,x:a,y:u},b);return new kr([(f+T.x/T.scale)*e,e*(T.y/T.scale),p],[(f+T.x2/T.scale)*e,e*(T.y2/T.scale),y])},s.z=function(t,e,n){let a=0;for(let u=0;u<2;++u){const f=n?n[u]:0;t[u]>f&&(a+=(t[u]-f)*(t[u]-f)),e[u]<f&&(a+=(f-e[u])*(f-e[u]))}return a}}),_(["./shared"],function(s){function M(Ve){if(typeof Ve=="number"||typeof Ve=="boolean"||typeof Ve=="string"||Ve==null)return JSON.stringify(Ve);if(Array.isArray(Ve)){let pe="[";for(const Ie of Ve)pe+=`${M(Ie)},`;return`${pe}]`}let ne="{";for(const pe of Object.keys(Ve).sort())ne+=`${pe}:${M(Ve[pe])},`;return`${ne}}`}function P(Ve){let ne="";for(const pe of s.aS)ne+=`/${M(Ve[pe])}`;return ne}class L{constructor(ne){this.keyCache={},this._layers={},this._layerConfigs={},ne&&this.replace(ne)}replace(ne,pe){this._layerConfigs={},this._layers={},this.update(ne,[],pe)}update(ne,pe,Ie){this._options=Ie;for(const vt of ne)this._layerConfigs[vt.id]=vt,(this._layers[vt.id]=s.cp(vt,this.scope,this._options)).compileFilter(),this.keyCache[vt.id]&&delete this.keyCache[vt.id];for(const vt of pe)delete this.keyCache[vt],delete this._layerConfigs[vt],delete this._layers[vt];this.familiesBySource={};const xt=function(vt,Wt){const Jt={};for(let li=0;li<vt.length;li++){const wi=Wt&&Wt[vt[li].id]||P(vt[li]);Wt&&(Wt[vt[li].id]=wi);let $t=Jt[wi];$t||($t=Jt[wi]=[]),$t.push(vt[li])}const Tt=[];for(const li in Jt)Tt.push(Jt[li]);return Tt}(s.da(this._layerConfigs),this.keyCache);for(const vt of xt){const Wt=vt.map(cn=>this._layers[cn.id]),Jt=Wt[0];if(Jt.visibility==="none")continue;const Tt=Jt.source||"";let li=this.familiesBySource[Tt];li||(li=this.familiesBySource[Tt]={});const wi=Jt.sourceLayer||"_geojsonTileLayer";let $t=li[wi];$t||($t=li[wi]=[]),$t.push(Wt)}}}class F{loadTile(ne,pe){const{uid:Ie,encoding:xt,rawImageData:vt,padding:Wt}=ne,Jt=ImageBitmap&&vt instanceof ImageBitmap?this.getImageData(vt,Wt):vt;pe(null,new s.db(Ie,Jt,xt,Wt<1))}getImageData(ne,pe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ne.width,ne.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ne.width,this.offscreenCanvas.height=ne.height,this.offscreenCanvasContext.drawImage(ne,0,0,ne.width,ne.height);const Ie=this.offscreenCanvasContext.getImageData(-pe,-pe,ne.width+2*pe,ne.height+2*pe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Ie}}function V(Ve,ne){if(Ve.length!==0){X(Ve[0],ne);for(var pe=1;pe<Ve.length;pe++)X(Ve[pe],!ne)}}function X(Ve,ne){for(var pe=0,Ie=0,xt=0,vt=Ve.length,Wt=vt-1;xt<vt;Wt=xt++){var Jt=(Ve[xt][0]-Ve[Wt][0])*(Ve[Wt][1]+Ve[xt][1]),Tt=pe+Jt;Ie+=Math.abs(pe)>=Math.abs(Jt)?pe-Tt+Jt:Jt-Tt+pe,pe=Tt}pe+Ie>=0!=!!ne&&Ve.reverse()}var q=s.dc(function Ve(ne,pe){var Ie,xt=ne&&ne.type;if(xt==="FeatureCollection")for(Ie=0;Ie<ne.features.length;Ie++)Ve(ne.features[Ie],pe);else if(xt==="GeometryCollection")for(Ie=0;Ie<ne.geometries.length;Ie++)Ve(ne.geometries[Ie],pe);else if(xt==="Feature")Ve(ne.geometry,pe);else if(xt==="Polygon")V(ne.coordinates,pe);else if(xt==="MultiPolygon")for(Ie=0;Ie<ne.coordinates.length;Ie++)V(ne.coordinates[Ie],pe);return ne});const Y=s.dd.prototype.toGeoJSON;var J={exports:{}},ue=s.df,ce=s.de.VectorTileFeature,fe=Ae;function Ae(Ve,ne){this.options=ne||{},this.features=Ve,this.length=Ve.length}function Ce(Ve,ne){this.id=typeof Ve.id=="number"?Ve.id:void 0,this.type=Ve.type,this.rawGeometry=Ve.type===1?[Ve.geometry]:Ve.geometry,this.properties=Ve.tags,this.extent=ne||4096}Ae.prototype.feature=function(Ve){return new Ce(this.features[Ve],this.options.extent)},Ce.prototype.loadGeometry=function(){var Ve=this.rawGeometry;this.geometry=[];for(var ne=0;ne<Ve.length;ne++){for(var pe=Ve[ne],Ie=[],xt=0;xt<pe.length;xt++)Ie.push(new ue(pe[xt][0],pe[xt][1]));this.geometry.push(Ie)}return this.geometry},Ce.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ve=this.geometry,ne=1/0,pe=-1/0,Ie=1/0,xt=-1/0,vt=0;vt<Ve.length;vt++)for(var Wt=Ve[vt],Jt=0;Jt<Wt.length;Jt++){var Tt=Wt[Jt];ne=Math.min(ne,Tt.x),pe=Math.max(pe,Tt.x),Ie=Math.min(Ie,Tt.y),xt=Math.max(xt,Tt.y)}return[ne,Ie,pe,xt]},Ce.prototype.toGeoJSON=ce.prototype.toGeoJSON;var He=s.dg,We=fe;function nt(Ve){var ne=new He;return function(pe,Ie){for(var xt in pe.layers)Ie.writeMessage(3,we,pe.layers[xt])}(Ve,ne),ne.finish()}function we(Ve,ne){var pe;ne.writeVarintField(15,Ve.version||1),ne.writeStringField(1,Ve.name||""),ne.writeVarintField(5,Ve.extent||4096);var Ie={keys:[],values:[],keycache:{},valuecache:{}};for(pe=0;pe<Ve.length;pe++)Ie.feature=Ve.feature(pe),ne.writeMessage(2,ht,Ie);var xt=Ie.keys;for(pe=0;pe<xt.length;pe++)ne.writeStringField(3,xt[pe]);var vt=Ie.values;for(pe=0;pe<vt.length;pe++)ne.writeMessage(4,tt,vt[pe])}function ht(Ve,ne){var pe=Ve.feature;pe.id!==void 0&&ne.writeVarintField(1,pe.id),ne.writeMessage(2,pt,Ve),ne.writeVarintField(3,pe.type),ne.writeMessage(4,Ft,pe)}function pt(Ve,ne){var pe=Ve.feature,Ie=Ve.keys,xt=Ve.values,vt=Ve.keycache,Wt=Ve.valuecache;for(var Jt in pe.properties){var Tt=pe.properties[Jt],li=vt[Jt];if(Tt!==null){li===void 0&&(Ie.push(Jt),vt[Jt]=li=Ie.length-1),ne.writeVarint(li);var wi=typeof Tt;wi!=="string"&&wi!=="boolean"&&wi!=="number"&&(Tt=JSON.stringify(Tt));var $t=wi+":"+Tt,cn=Wt[$t];cn===void 0&&(xt.push(Tt),Wt[$t]=cn=xt.length-1),ne.writeVarint(cn)}}}function Xe(Ve,ne){return(ne<<3)+(7&Ve)}function mt(Ve){return Ve<<1^Ve>>31}function Ft(Ve,ne){for(var pe=Ve.loadGeometry(),Ie=Ve.type,xt=0,vt=0,Wt=pe.length,Jt=0;Jt<Wt;Jt++){var Tt=pe[Jt],li=1;Ie===1&&(li=Tt.length),ne.writeVarint(Xe(1,li));for(var wi=Ie===3?Tt.length-1:Tt.length,$t=0;$t<wi;$t++){$t===1&&Ie!==1&&ne.writeVarint(Xe(2,wi-1));var cn=Tt[$t].x-xt,dn=Tt[$t].y-vt;ne.writeVarint(mt(cn)),ne.writeVarint(mt(dn)),xt+=cn,vt+=dn}Ie===3&&ne.writeVarint(Xe(7,1))}}function tt(Ve,ne){var pe=typeof Ve;pe==="string"?ne.writeStringField(1,Ve):pe==="boolean"?ne.writeBooleanField(7,Ve):pe==="number"&&(Ve%1!=0?ne.writeDoubleField(3,Ve):Ve<0?ne.writeSVarintField(6,Ve):ne.writeVarintField(5,Ve))}J.exports=nt,J.exports.fromVectorTileJs=nt,J.exports.fromGeojsonVt=function(Ve,ne){ne=ne||{};var pe={};for(var Ie in Ve)pe[Ie]=new We(Ve[Ie].features,ne),pe[Ie].name=Ie,pe[Ie].version=ne.version,pe[Ie].extent=ne.extent;return nt({layers:pe})},J.exports.GeoJSONWrapper=We;var ei=s.dc(J.exports);const ki={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ve=>Ve},rt=Math.fround||(yt=new Float32Array(1),Ve=>(yt[0]=+Ve,yt[0]));var yt;const Xt=3,kt=5,Ue=6;class Ye{constructor(ne){this.options=Object.assign(Object.create(ki),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:pe,minZoom:Ie,maxZoom:xt}=this.options;pe&&console.time("total time");const vt=`prepare ${ne.length} points`;pe&&console.time(vt),this.points=ne;const Wt=[];for(let Tt=0;Tt<ne.length;Tt++){const li=ne[Tt];if(!li.geometry)continue;const[wi,$t]=li.geometry.coordinates,cn=rt(en(wi)),dn=rt(Li($t));Wt.push(cn,dn,1/0,Tt,-1,1),this.options.reduce&&Wt.push(0)}let Jt=this.trees[xt+1]=this._createTree(Wt);pe&&console.timeEnd(vt);for(let Tt=xt;Tt>=Ie;Tt--){const li=+Date.now();Jt=this.trees[Tt]=this._createTree(this._cluster(Jt,Tt)),pe&&console.log("z%d: %d clusters in %dms",Tt,Jt.numItems,+Date.now()-li)}return pe&&console.timeEnd("total time"),this}getClusters(ne,pe){let Ie=((ne[0]+180)%360+360)%360-180;const xt=Math.max(-90,Math.min(90,ne[1]));let vt=ne[2]===180?180:((ne[2]+180)%360+360)%360-180;const Wt=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)Ie=-180,vt=180;else if(Ie>vt){const $t=this.getClusters([Ie,xt,180,Wt],pe),cn=this.getClusters([-180,xt,vt,Wt],pe);return $t.concat(cn)}const Jt=this.trees[this._limitZoom(pe)],Tt=Jt.range(en(Ie),Li(Wt),en(vt),Li(xt)),li=Jt.data,wi=[];for(const $t of Tt){const cn=this.stride*$t;wi.push(li[cn+kt]>1?Kt(li,cn,this.clusterProps):this.points[li[cn+Xt]])}return wi}getChildren(ne){const pe=this._getOriginId(ne),Ie=this._getOriginZoom(ne),xt="No cluster with the specified id.",vt=this.trees[Ie];if(!vt)throw new Error(xt);const Wt=vt.data;if(pe*this.stride>=Wt.length)throw new Error(xt);const Jt=this.options.radius/(this.options.extent*Math.pow(2,Ie-1)),Tt=vt.within(Wt[pe*this.stride],Wt[pe*this.stride+1],Jt),li=[];for(const wi of Tt){const $t=wi*this.stride;Wt[$t+4]===ne&&li.push(Wt[$t+kt]>1?Kt(Wt,$t,this.clusterProps):this.points[Wt[$t+Xt]])}if(li.length===0)throw new Error(xt);return li}getLeaves(ne,pe,Ie){const xt=[];return this._appendLeaves(xt,ne,pe=pe||10,Ie=Ie||0,0),xt}getTile(ne,pe,Ie){const xt=this.trees[this._limitZoom(ne)],vt=Math.pow(2,ne),{extent:Wt,radius:Jt}=this.options,Tt=Jt/Wt,li=(Ie-Tt)/vt,wi=(Ie+1+Tt)/vt,$t={features:[]};return this._addTileFeatures(xt.range((pe-Tt)/vt,li,(pe+1+Tt)/vt,wi),xt.data,pe,Ie,vt,$t),pe===0&&this._addTileFeatures(xt.range(1-Tt/vt,li,1,wi),xt.data,vt,Ie,vt,$t),pe===vt-1&&this._addTileFeatures(xt.range(0,li,Tt/vt,wi),xt.data,-1,Ie,vt,$t),$t.features.length?$t:null}getClusterExpansionZoom(ne){let pe=this._getOriginZoom(ne)-1;for(;pe<=this.options.maxZoom;){const Ie=this.getChildren(ne);if(pe++,Ie.length!==1)break;ne=Ie[0].properties.cluster_id}return pe}_appendLeaves(ne,pe,Ie,xt,vt){const Wt=this.getChildren(pe);for(const Jt of Wt){const Tt=Jt.properties;if(Tt&&Tt.cluster?vt+Tt.point_count<=xt?vt+=Tt.point_count:vt=this._appendLeaves(ne,Tt.cluster_id,Ie,xt,vt):vt<xt?vt++:ne.push(Jt),ne.length===Ie)break}return vt}_createTree(ne){const pe=new s.aZ(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ie=0;Ie<ne.length;Ie+=this.stride)pe.add(ne[Ie],ne[Ie+1]);return pe.finish(),pe.data=ne,pe}_addTileFeatures(ne,pe,Ie,xt,vt,Wt){for(const Jt of ne){const Tt=Jt*this.stride,li=pe[Tt+kt]>1;let wi,$t,cn;if(li)wi=vi(pe,Tt,this.clusterProps),$t=pe[Tt],cn=pe[Tt+1];else{const gn=this.points[pe[Tt+Xt]];wi=gn.properties;const[wn,Je]=gn.geometry.coordinates;$t=en(wn),cn=Li(Je)}const dn={type:1,geometry:[[Math.round(this.options.extent*($t*vt-Ie)),Math.round(this.options.extent*(cn*vt-xt))]],tags:wi};let Fn;Fn=li||this.options.generateId?pe[Tt+Xt]:this.points[pe[Tt+Xt]].id,Fn!==void 0&&(dn.id=Fn),Wt.features.push(dn)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,pe){const{radius:Ie,extent:xt,reduce:vt,minPoints:Wt}=this.options,Jt=Ie/(xt*Math.pow(2,pe)),Tt=ne.data,li=[],wi=this.stride;for(let $t=0;$t<Tt.length;$t+=wi){if(Tt[$t+2]<=pe)continue;Tt[$t+2]=pe;const cn=Tt[$t],dn=Tt[$t+1],Fn=ne.within(Tt[$t],Tt[$t+1],Jt),gn=Tt[$t+kt];let wn=gn;for(const Je of Fn){const mi=Je*wi;Tt[mi+2]>pe&&(wn+=Tt[mi+kt])}if(wn>gn&&wn>=Wt){let Je,mi=cn*gn,Gi=dn*gn,fn=-1;const $n=(($t/wi|0)<<5)+(pe+1)+this.points.length;for(const Jr of Fn){const Cr=Jr*wi;if(Tt[Cr+2]<=pe)continue;Tt[Cr+2]=pe;const Mo=Tt[Cr+kt];mi+=Tt[Cr]*Mo,Gi+=Tt[Cr+1]*Mo,Tt[Cr+4]=$n,vt&&(Je||(Je=this._map(Tt,$t,!0),fn=this.clusterProps.length,this.clusterProps.push(Je)),vt(Je,this._map(Tt,Cr)))}Tt[$t+4]=$n,li.push(mi/wn,Gi/wn,1/0,$n,-1,wn),vt&&li.push(fn)}else{for(let Je=0;Je<wi;Je++)li.push(Tt[$t+Je]);if(wn>1)for(const Je of Fn){const mi=Je*wi;if(!(Tt[mi+2]<=pe)){Tt[mi+2]=pe;for(let Gi=0;Gi<wi;Gi++)li.push(Tt[mi+Gi])}}}}return li}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,pe,Ie){if(ne[pe+kt]>1){const Wt=this.clusterProps[ne[pe+Ue]];return Ie?Object.assign({},Wt):Wt}const xt=this.points[ne[pe+Xt]].properties,vt=this.options.map(xt);return Ie&&vt===xt?Object.assign({},vt):vt}}function Kt(Ve,ne,pe){return{type:"Feature",id:Ve[ne+Xt],properties:vi(Ve,ne,pe),geometry:{type:"Point",coordinates:[(Ie=Ve[ne],360*(Ie-.5)),Zi(Ve[ne+1])]}};var Ie}function vi(Ve,ne,pe){const Ie=Ve[ne+kt],xt=Ie>=1e4?`${Math.round(Ie/1e3)}k`:Ie>=1e3?Math.round(Ie/100)/10+"k":Ie,vt=Ve[ne+Ue],Wt=vt===-1?{}:Object.assign({},pe[vt]);return Object.assign(Wt,{cluster:!0,cluster_id:Ve[ne+Xt],point_count:Ie,point_count_abbreviated:xt})}function en(Ve){return Ve/360+.5}function Li(Ve){const ne=Math.sin(Ve*Math.PI/180),pe=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return pe<0?0:pe>1?1:pe}function Zi(Ve){const ne=(180-360*Ve)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}var it={exports:{}};it.exports=function(){function Ve(lt,ft,Ct,Dt){for(var zt,jt=Dt,Zt=Ct-ft>>1,Bt=Ct-ft,ai=lt[ft],At=lt[ft+1],zi=lt[Ct],mn=lt[Ct+1],gi=ft+3;gi<Ct;gi+=3){var un=ne(lt[gi],lt[gi+1],ai,At,zi,mn);if(un>jt)zt=gi,jt=un;else if(un===jt){var Qn=Math.abs(gi-Zt);Qn<Bt&&(zt=gi,Bt=Qn)}}jt>Dt&&(zt-ft>3&&Ve(lt,ft,zt,Dt),lt[zt+2]=jt,Ct-zt>3&&Ve(lt,zt,Ct,Dt))}function ne(lt,ft,Ct,Dt,zt,jt){var Zt=zt-Ct,Bt=jt-Dt;if(Zt!==0||Bt!==0){var ai=((lt-Ct)*Zt+(ft-Dt)*Bt)/(Zt*Zt+Bt*Bt);ai>1?(Ct=zt,Dt=jt):ai>0&&(Ct+=Zt*ai,Dt+=Bt*ai)}return(Zt=lt-Ct)*Zt+(Bt=ft-Dt)*Bt}function pe(lt,ft,Ct,Dt){var zt={id:lt===void 0?null:lt,type:ft,geometry:Ct,tags:Dt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(jt){var Zt=jt.geometry,Bt=jt.type;if(Bt==="Point"||Bt==="MultiPoint"||Bt==="LineString")Ie(jt,Zt);else if(Bt==="Polygon"||Bt==="MultiLineString")for(var ai=0;ai<Zt.length;ai++)Ie(jt,Zt[ai]);else if(Bt==="MultiPolygon")for(ai=0;ai<Zt.length;ai++)for(var At=0;At<Zt[ai].length;At++)Ie(jt,Zt[ai][At])}(zt),zt}function Ie(lt,ft){for(var Ct=0;Ct<ft.length;Ct+=3)lt.minX=Math.min(lt.minX,ft[Ct]),lt.minY=Math.min(lt.minY,ft[Ct+1]),lt.maxX=Math.max(lt.maxX,ft[Ct]),lt.maxY=Math.max(lt.maxY,ft[Ct+1])}function xt(lt,ft,Ct,Dt){if(ft.geometry){var zt=ft.geometry.coordinates,jt=ft.geometry.type,Zt=Math.pow(Ct.tolerance/((1<<Ct.maxZoom)*Ct.extent),2),Bt=[],ai=ft.id;if(Ct.promoteId?ai=ft.properties[Ct.promoteId]:Ct.generateId&&(ai=Dt||0),jt==="Point")vt(zt,Bt);else if(jt==="MultiPoint")for(var At=0;At<zt.length;At++)vt(zt[At],Bt);else if(jt==="LineString")Wt(zt,Bt,Zt,!1);else if(jt==="MultiLineString"){if(Ct.lineMetrics){for(At=0;At<zt.length;At++)Wt(zt[At],Bt=[],Zt,!1),lt.push(pe(ai,"LineString",Bt,ft.properties));return}Jt(zt,Bt,Zt,!1)}else if(jt==="Polygon")Jt(zt,Bt,Zt,!0);else{if(jt!=="MultiPolygon"){if(jt==="GeometryCollection"){for(At=0;At<ft.geometry.geometries.length;At++)xt(lt,{id:ai,geometry:ft.geometry.geometries[At],properties:ft.properties},Ct,Dt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(At=0;At<zt.length;At++){var zi=[];Jt(zt[At],zi,Zt,!0),Bt.push(zi)}}lt.push(pe(ai,jt,Bt,ft.properties))}}function vt(lt,ft){ft.push(Tt(lt[0])),ft.push(li(lt[1])),ft.push(0)}function Wt(lt,ft,Ct,Dt){for(var zt,jt,Zt=0,Bt=0;Bt<lt.length;Bt++){var ai=Tt(lt[Bt][0]),At=li(lt[Bt][1]);ft.push(ai),ft.push(At),ft.push(0),Bt>0&&(Zt+=Dt?(zt*At-ai*jt)/2:Math.sqrt(Math.pow(ai-zt,2)+Math.pow(At-jt,2))),zt=ai,jt=At}var zi=ft.length-3;ft[2]=1,Ve(ft,0,zi,Ct),ft[zi+2]=1,ft.size=Math.abs(Zt),ft.start=0,ft.end=ft.size}function Jt(lt,ft,Ct,Dt){for(var zt=0;zt<lt.length;zt++){var jt=[];Wt(lt[zt],jt,Ct,Dt),ft.push(jt)}}function Tt(lt){return lt/360+.5}function li(lt){var ft=Math.sin(lt*Math.PI/180),Ct=.5-.25*Math.log((1+ft)/(1-ft))/Math.PI;return Ct<0?0:Ct>1?1:Ct}function wi(lt,ft,Ct,Dt,zt,jt,Zt,Bt){if(Dt/=ft,jt>=(Ct/=ft)&&Zt<Dt)return lt;if(Zt<Ct||jt>=Dt)return null;for(var ai=[],At=0;At<lt.length;At++){var zi=lt[At],mn=zi.geometry,gi=zi.type,un=zt===0?zi.minX:zi.minY,Qn=zt===0?zi.maxX:zi.maxY;if(un>=Ct&&Qn<Dt)ai.push(zi);else if(!(Qn<Ct||un>=Dt)){var Kn=[];if(gi==="Point"||gi==="MultiPoint")$t(mn,Kn,Ct,Dt,zt);else if(gi==="LineString")cn(mn,Kn,Ct,Dt,zt,!1,Bt.lineMetrics);else if(gi==="MultiLineString")Fn(mn,Kn,Ct,Dt,zt,!1);else if(gi==="Polygon")Fn(mn,Kn,Ct,Dt,zt,!0);else if(gi==="MultiPolygon")for(var or=0;or<mn.length;or++){var Kr=[];Fn(mn[or],Kr,Ct,Dt,zt,!0),Kr.length&&Kn.push(Kr)}if(Kn.length){if(Bt.lineMetrics&&gi==="LineString"){for(or=0;or<Kn.length;or++)ai.push(pe(zi.id,gi,Kn[or],zi.tags));continue}gi!=="LineString"&&gi!=="MultiLineString"||(Kn.length===1?(gi="LineString",Kn=Kn[0]):gi="MultiLineString"),gi!=="Point"&&gi!=="MultiPoint"||(gi=Kn.length===3?"Point":"MultiPoint"),ai.push(pe(zi.id,gi,Kn,zi.tags))}}}return ai.length?ai:null}function $t(lt,ft,Ct,Dt,zt){for(var jt=0;jt<lt.length;jt+=3){var Zt=lt[jt+zt];Zt>=Ct&&Zt<=Dt&&(ft.push(lt[jt]),ft.push(lt[jt+1]),ft.push(lt[jt+2]))}}function cn(lt,ft,Ct,Dt,zt,jt,Zt){for(var Bt,ai,At=dn(lt),zi=zt===0?wn:Je,mn=lt.start,gi=0;gi<lt.length-3;gi+=3){var un=lt[gi],Qn=lt[gi+1],Kn=lt[gi+2],or=lt[gi+3],Kr=lt[gi+4],Lo=zt===0?un:Qn,sr=zt===0?or:Kr,Oo=!1;Zt&&(Bt=Math.sqrt(Math.pow(un-or,2)+Math.pow(Qn-Kr,2))),Lo<Ct?sr>Ct&&(ai=zi(At,un,Qn,or,Kr,Ct),Zt&&(At.start=mn+Bt*ai)):Lo>Dt?sr<Dt&&(ai=zi(At,un,Qn,or,Kr,Dt),Zt&&(At.start=mn+Bt*ai)):gn(At,un,Qn,Kn),sr<Ct&&Lo>=Ct&&(ai=zi(At,un,Qn,or,Kr,Ct),Oo=!0),sr>Dt&&Lo<=Dt&&(ai=zi(At,un,Qn,or,Kr,Dt),Oo=!0),!jt&&Oo&&(Zt&&(At.end=mn+Bt*ai),ft.push(At),At=dn(lt)),Zt&&(mn+=Bt)}var $r=lt.length-3;un=lt[$r],Qn=lt[$r+1],Kn=lt[$r+2],(Lo=zt===0?un:Qn)>=Ct&&Lo<=Dt&&gn(At,un,Qn,Kn),$r=At.length-3,jt&&$r>=3&&(At[$r]!==At[0]||At[$r+1]!==At[1])&&gn(At,At[0],At[1],At[2]),At.length&&ft.push(At)}function dn(lt){var ft=[];return ft.size=lt.size,ft.start=lt.start,ft.end=lt.end,ft}function Fn(lt,ft,Ct,Dt,zt,jt){for(var Zt=0;Zt<lt.length;Zt++)cn(lt[Zt],ft,Ct,Dt,zt,jt,!1)}function gn(lt,ft,Ct,Dt){lt.push(ft),lt.push(Ct),lt.push(Dt)}function wn(lt,ft,Ct,Dt,zt,jt){var Zt=(jt-ft)/(Dt-ft);return lt.push(jt),lt.push(Ct+(zt-Ct)*Zt),lt.push(1),Zt}function Je(lt,ft,Ct,Dt,zt,jt){var Zt=(jt-Ct)/(zt-Ct);return lt.push(ft+(Dt-ft)*Zt),lt.push(jt),lt.push(1),Zt}function mi(lt,ft){for(var Ct=[],Dt=0;Dt<lt.length;Dt++){var zt,jt=lt[Dt],Zt=jt.type;if(Zt==="Point"||Zt==="MultiPoint"||Zt==="LineString")zt=Gi(jt.geometry,ft);else if(Zt==="MultiLineString"||Zt==="Polygon"){zt=[];for(var Bt=0;Bt<jt.geometry.length;Bt++)zt.push(Gi(jt.geometry[Bt],ft))}else if(Zt==="MultiPolygon")for(zt=[],Bt=0;Bt<jt.geometry.length;Bt++){for(var ai=[],At=0;At<jt.geometry[Bt].length;At++)ai.push(Gi(jt.geometry[Bt][At],ft));zt.push(ai)}Ct.push(pe(jt.id,Zt,zt,jt.tags))}return Ct}function Gi(lt,ft){var Ct=[];Ct.size=lt.size,lt.start!==void 0&&(Ct.start=lt.start,Ct.end=lt.end);for(var Dt=0;Dt<lt.length;Dt+=3)Ct.push(lt[Dt]+ft,lt[Dt+1],lt[Dt+2]);return Ct}function fn(lt,ft){if(lt.transformed)return lt;var Ct,Dt,zt,jt=1<<lt.z,Zt=lt.x,Bt=lt.y;for(Ct=0;Ct<lt.features.length;Ct++){var ai=lt.features[Ct],At=ai.geometry,zi=ai.type;if(ai.geometry=[],zi===1)for(Dt=0;Dt<At.length;Dt+=2)ai.geometry.push($n(At[Dt],At[Dt+1],ft,jt,Zt,Bt));else for(Dt=0;Dt<At.length;Dt++){var mn=[];for(zt=0;zt<At[Dt].length;zt+=2)mn.push($n(At[Dt][zt],At[Dt][zt+1],ft,jt,Zt,Bt));ai.geometry.push(mn)}}return lt.transformed=!0,lt}function $n(lt,ft,Ct,Dt,zt,jt){return[Math.round(Ct*(lt*Dt-zt)),Math.round(Ct*(ft*Dt-jt))]}function Jr(lt,ft,Ct,Dt,zt){for(var jt=ft===zt.maxZoom?0:zt.tolerance/((1<<ft)*zt.extent),Zt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Ct,y:Dt,z:ft,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Bt=0;Bt<lt.length;Bt++){Zt.numFeatures++,Cr(Zt,lt[Bt],jt,zt);var ai=lt[Bt].minX,At=lt[Bt].minY,zi=lt[Bt].maxX,mn=lt[Bt].maxY;ai<Zt.minX&&(Zt.minX=ai),At<Zt.minY&&(Zt.minY=At),zi>Zt.maxX&&(Zt.maxX=zi),mn>Zt.maxY&&(Zt.maxY=mn)}return Zt}function Cr(lt,ft,Ct,Dt){var zt=ft.geometry,jt=ft.type,Zt=[];if(jt==="Point"||jt==="MultiPoint")for(var Bt=0;Bt<zt.length;Bt+=3)Zt.push(zt[Bt]),Zt.push(zt[Bt+1]),lt.numPoints++,lt.numSimplified++;else if(jt==="LineString")Mo(Zt,zt,lt,Ct,!1,!1);else if(jt==="MultiLineString"||jt==="Polygon")for(Bt=0;Bt<zt.length;Bt++)Mo(Zt,zt[Bt],lt,Ct,jt==="Polygon",Bt===0);else if(jt==="MultiPolygon")for(var ai=0;ai<zt.length;ai++){var At=zt[ai];for(Bt=0;Bt<At.length;Bt++)Mo(Zt,At[Bt],lt,Ct,!0,Bt===0)}if(Zt.length){var zi=ft.tags||null;if(jt==="LineString"&&Dt.lineMetrics){for(var mn in zi={},ft.tags)zi[mn]=ft.tags[mn];zi.mapbox_clip_start=zt.start/zt.size,zi.mapbox_clip_end=zt.end/zt.size}var gi={geometry:Zt,type:jt==="Polygon"||jt==="MultiPolygon"?3:jt==="LineString"||jt==="MultiLineString"?2:1,tags:zi};ft.id!==null&&(gi.id=ft.id),lt.features.push(gi)}}function Mo(lt,ft,Ct,Dt,zt,jt){var Zt=Dt*Dt;if(Dt>0&&ft.size<(zt?Zt:Dt))Ct.numPoints+=ft.length/3;else{for(var Bt=[],ai=0;ai<ft.length;ai+=3)(Dt===0||ft[ai+2]>Zt)&&(Ct.numSimplified++,Bt.push(ft[ai]),Bt.push(ft[ai+1])),Ct.numPoints++;zt&&function(At,zi){for(var mn=0,gi=0,un=At.length,Qn=un-2;gi<un;Qn=gi,gi+=2)mn+=(At[gi]-At[Qn])*(At[gi+1]+At[Qn+1]);if(mn>0===zi)for(gi=0,un=At.length;gi<un/2;gi+=2){var Kn=At[gi],or=At[gi+1];At[gi]=At[un-2-gi],At[gi+1]=At[un-1-gi],At[un-2-gi]=Kn,At[un-1-gi]=or}}(Bt,jt),lt.push(Bt)}}function qr(lt,ft){var Ct=(ft=this.options=function(zt,jt){for(var Zt in jt)zt[Zt]=jt[Zt];return zt}(Object.create(this.options),ft)).debug;if(Ct&&console.time("preprocess data"),ft.maxZoom<0||ft.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ft.promoteId&&ft.generateId)throw new Error("promoteId and generateId cannot be used together.");var Dt=function(zt,jt){var Zt=[];if(zt.type==="FeatureCollection")for(var Bt=0;Bt<zt.features.length;Bt++)xt(Zt,zt.features[Bt],jt,Bt);else xt(Zt,zt.type==="Feature"?zt:{geometry:zt},jt);return Zt}(lt,ft);this.tiles={},this.tileCoords=[],Ct&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ft.indexMaxZoom,ft.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Dt=function(zt,jt){var Zt=jt.buffer/jt.extent,Bt=zt,ai=wi(zt,1,-1-Zt,Zt,0,-1,2,jt),At=wi(zt,1,1-Zt,2+Zt,0,-1,2,jt);return(ai||At)&&(Bt=wi(zt,1,-Zt,1+Zt,0,-1,2,jt)||[],ai&&(Bt=mi(ai,1).concat(Bt)),At&&(Bt=Bt.concat(mi(At,-1)))),Bt}(Dt,ft)).length&&this.splitTile(Dt,0,0,0),Ct&&(Dt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Pr(lt,ft,Ct){return 32*((1<<lt)*Ct+ft)+lt}return qr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},qr.prototype.splitTile=function(lt,ft,Ct,Dt,zt,jt,Zt){for(var Bt=[lt,ft,Ct,Dt],ai=this.options,At=ai.debug;Bt.length;){Dt=Bt.pop(),Ct=Bt.pop(),ft=Bt.pop(),lt=Bt.pop();var zi=1<<ft,mn=Pr(ft,Ct,Dt),gi=this.tiles[mn];if(!gi&&(At>1&&console.time("creation"),gi=this.tiles[mn]=Jr(lt,ft,Ct,Dt,ai),this.tileCoords.push({z:ft,x:Ct,y:Dt}),At)){At>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ft,Ct,Dt,gi.numFeatures,gi.numPoints,gi.numSimplified),console.timeEnd("creation"));var un="z"+ft;this.stats[un]=(this.stats[un]||0)+1,this.total++}if(gi.source=lt,zt){if(ft===ai.maxZoom||ft===zt)continue;var Qn=1<<zt-ft;if(Ct!==Math.floor(jt/Qn)||Dt!==Math.floor(Zt/Qn))continue}else if(ft===ai.indexMaxZoom||gi.numPoints<=ai.indexMaxPoints)continue;if(gi.source=null,lt.length!==0){At>1&&console.time("clipping");var Kn,or,Kr,Lo,sr,Oo,$r=.5*ai.buffer/ai.extent,Eo=.5-$r,ys=.5+$r,Ka=1+$r;Kn=or=Kr=Lo=null,sr=wi(lt,zi,Ct-$r,Ct+ys,0,gi.minX,gi.maxX,ai),Oo=wi(lt,zi,Ct+Eo,Ct+Ka,0,gi.minX,gi.maxX,ai),lt=null,sr&&(Kn=wi(sr,zi,Dt-$r,Dt+ys,1,gi.minY,gi.maxY,ai),or=wi(sr,zi,Dt+Eo,Dt+Ka,1,gi.minY,gi.maxY,ai),sr=null),Oo&&(Kr=wi(Oo,zi,Dt-$r,Dt+ys,1,gi.minY,gi.maxY,ai),Lo=wi(Oo,zi,Dt+Eo,Dt+Ka,1,gi.minY,gi.maxY,ai),Oo=null),At>1&&console.timeEnd("clipping"),Bt.push(Kn||[],ft+1,2*Ct,2*Dt),Bt.push(or||[],ft+1,2*Ct,2*Dt+1),Bt.push(Kr||[],ft+1,2*Ct+1,2*Dt),Bt.push(Lo||[],ft+1,2*Ct+1,2*Dt+1)}}},qr.prototype.getTile=function(lt,ft,Ct){var Dt=this.options,zt=Dt.extent,jt=Dt.debug;if(lt<0||lt>24)return null;var Zt=1<<lt,Bt=Pr(lt,ft=(ft%Zt+Zt)%Zt,Ct);if(this.tiles[Bt])return fn(this.tiles[Bt],zt);jt>1&&console.log("drilling down to z%d-%d-%d",lt,ft,Ct);for(var ai,At=lt,zi=ft,mn=Ct;!ai&&At>0;)At--,zi=Math.floor(zi/2),mn=Math.floor(mn/2),ai=this.tiles[Pr(At,zi,mn)];return ai&&ai.source?(jt>1&&console.log("found parent tile z%d-%d-%d",At,zi,mn),jt>1&&console.time("drilling down"),this.splitTile(ai.source,At,zi,mn,lt,ft,Ct),jt>1&&console.timeEnd("drilling down"),this.tiles[Bt]?fn(this.tiles[Bt],zt):null):null},function(lt,ft){return new qr(lt,ft)}}();var Sn=s.dc(it.exports);function dr(Ve,ne){const pe=Ve.tileID.canonical;if(!this._geoJSONIndex)return ne(null,null);const Ie=this._geoJSONIndex.getTile(pe.z,pe.x,pe.y);if(!Ie)return ne(null,null);const xt=new class{constructor(Wt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.J,this.length=Wt.length,this._features=Wt}feature(Wt){return new class{constructor(Jt){this._feature=Jt,this.extent=s.J,this.type=Jt.type,this.properties=Jt.tags,"id"in Jt&&!isNaN(Jt.id)&&(this.id=parseInt(Jt.id,10))}loadGeometry(){if(this._feature.type===1){const Jt=[];for(const Tt of this._feature.geometry)Jt.push([new s.P(Tt[0],Tt[1])]);return Jt}{const Jt=[];for(const Tt of this._feature.geometry){const li=[];for(const wi of Tt)li.push(new s.P(wi[0],wi[1]));Jt.push(li)}return Jt}}toGeoJSON(Jt,Tt,li){return Y.call(this,Jt,Tt,li)}}(this._features[Wt])}}(Ie.features);let vt=ei(xt);vt.byteOffset===0&&vt.byteLength===vt.buffer.byteLength||(vt=new Uint8Array(vt)),ne(null,{vectorTile:xt,rawData:vt.buffer})}class Hr extends s.dh{constructor(ne,pe,Ie,xt,vt,Wt){super(ne,pe,Ie,xt,dr,Wt),vt&&(this.loadGeoJSON=vt)}loadData(ne,pe){const Ie=ne&&ne.request,xt=Ie&&Ie.collectResourceTiming;this.loadGeoJSON(ne,(vt,Wt)=>{if(vt||!Wt)return pe(vt);if(typeof Wt!="object")return pe(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));{q(Wt,!0);try{if(ne.filter){const Tt=s.cw(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Tt.result==="error")throw new Error(Tt.value.map(wi=>`${wi.key}: ${wi.message}`).join(", "));Wt={type:"FeatureCollection",features:Wt.features.filter(wi=>Tt.value.evaluate({zoom:0},wi))}}this._geoJSONIndex=ne.cluster?new Ye(function({superclusterOptions:Tt,clusterProperties:li}){if(!li||!Tt)return Tt;const wi={},$t={},cn={accumulated:null,zoom:0},dn={properties:null},Fn=Object.keys(li);for(const gn of Fn){const[wn,Je]=li[gn],mi=s.cw(Je),Gi=s.cw(typeof wn=="string"?[wn,["accumulated"],["get",gn]]:wn);wi[gn]=mi.value,$t[gn]=Gi.value}return Tt.map=gn=>{dn.properties=gn;const wn={};for(const Je of Fn)wn[Je]=wi[Je].evaluate(cn,dn);return wn},Tt.reduce=(gn,wn)=>{dn.properties=wn;for(const Je of Fn)cn.accumulated=gn[Je],gn[Je]=$t[Je].evaluate(cn,dn)},Tt}(ne)).load(Wt.features):Sn(Wt,ne.geojsonVtOptions)}catch(Tt){return pe(Tt)}this.loaded={};const Jt={};if(xt){const Tt=s.di(Ie);Tt&&(Jt.resourceTiming={},Jt.resourceTiming[ne.source]=JSON.parse(JSON.stringify(Tt)))}pe(null,Jt)}})}reloadTile(ne,pe){const Ie=this.loaded;return Ie&&Ie[ne.uid]?super.reloadTile(ne,pe):this.loadTile(ne,pe)}loadGeoJSON(ne,pe){if(ne.request)s.a1(ne.request,pe);else{if(typeof ne.data!="string")return pe(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));try{return pe(null,JSON.parse(ne.data))}catch{return pe(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ne,pe){try{pe(null,this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId))}catch(Ie){pe(Ie)}}getClusterChildren(ne,pe){try{pe(null,this._geoJSONIndex.getChildren(ne.clusterId))}catch(Ie){pe(Ie)}}getClusterLeaves(ne,pe){try{pe(null,this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset))}catch(Ie){pe(Ie)}}}class xi{constructor(ne,pe){this.tileID=new s.O(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ne.projection,this.brightness=pe}parse(ne,pe,Ie,xt){this.status="parsing";const vt=new s.O(Ie.tileID.overscaledZ,Ie.tileID.wrap,Ie.tileID.canonical.z,Ie.tileID.canonical.x,Ie.tileID.canonical.y),Wt={},Jt=pe.familiesBySource[Ie.source],Tt=new s.dk(vt,Ie.promoteId);return Tt.bucketLayerIDs=[],s.dl(ne).then(li=>{if(!li)return xt(new Error("Could not parse tile"));const wi=s.dm(li,1/s.cg(Ie.tileID.canonical)),$t=li.json.extensionsUsed&&li.json.extensionsUsed.includes("MAPBOX_mesh_features"),cn=new s.al(this.zoom,{brightness:this.brightness});for(const dn in Jt)for(const Fn of Jt[dn]){const gn=Fn[0],wn=li.json.extensionsUsed;gn.recalculate(cn,[]);const Je=new s.dn(wi,vt,wn&&wn.includes("MAPBOX_mesh_features"),this.brightness);$t||(Je.needsUpload=!0),Wt[gn.fqid]=Je,Je.evaluate(gn)}this.status="done",xt(null,{buckets:Wt,featureIndex:Tt})}).catch(li=>xt(new Error(li.message)))}}class wt{constructor(ne,pe,Ie,xt,vt,Wt){this.actor=ne,this.layerIndex=pe,this.brightness=Wt,this.loading={},this.loaded={}}loadTile(ne,pe){const Ie=ne.uid,xt=this.loading[Ie]=new xi(ne,this.brightness);s.dj(ne.request,(vt,Wt)=>{const Jt=!this.loading[Ie];return delete this.loading[Ie],Jt||vt?(xt.status="done",Jt||(this.loaded[Ie]=xt),pe(vt)):Wt&&Wt.byteLength!==0?void xt.parse(Wt,this.layerIndex,ne,(Tt,li)=>{xt.status="done",this.loaded=this.loaded||{},this.loaded[Ie]=xt,Tt||!li?pe(Tt):pe(null,li)}):(xt.status="done",this.loaded[Ie]=xt,pe())})}reloadTile(ne,pe){const Ie=this.loaded,xt=ne.uid;if(Ie&&Ie[xt]){const vt=Ie[xt];vt.projection=ne.projection,vt.brightness=ne.brightness;const Wt=(Jt,Tt)=>{vt.reloadCallback&&(delete vt.reloadCallback,this.loadTile(ne,pe)),pe(Jt,Tt)};vt.status==="parsing"?vt.reloadCallback=Wt:vt.status==="done"&&this.loadTile(ne,pe)}}abortTile(ne,pe){const Ie=ne.uid;this.loading[Ie]&&delete this.loading[Ie],pe()}removeTile(ne,pe){const Ie=this.loaded,xt=ne.uid;Ie&&Ie[xt]&&delete Ie[xt],pe()}}class ni{constructor(ne){this.self=ne,this.actor=new s.dp(ne,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.o({name:"mercator"}),this.workerSourceTypes={vector:s.dh,geojson:Hr,"batched-model":wt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(pe,Ie)=>{if(this.workerSourceTypes[pe])throw new Error(`Worker source with name "${pe}" already registered.`);this.workerSourceTypes[pe]=Ie},this.self.registerRTLTextPlugin=pe=>{if(s.dq.isParsed())throw new Error("RTL text plugin already registered.");s.dq.applyArabicShaping=pe.applyArabicShaping,s.dq.processBidirectionalText=pe.processBidirectionalText,s.dq.processStyledBidirectionalText=pe.processStyledBidirectionalText}}clearCaches(ne,pe,Ie){delete this.layerIndexes[ne],delete this.availableImages[ne],delete this.workerSources[ne],delete this.demWorkerSources[ne],Ie()}checkIfReady(ne,pe,Ie){Ie()}setReferrer(ne,pe){this.referrer=pe}spriteLoaded(ne,{scope:pe,isLoaded:Ie}){if(this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={}),this.isSpriteLoaded[ne][pe]=Ie,this.workerSources[ne]&&this.workerSources[ne][pe])for(const xt in this.workerSources[ne][pe]){const vt=this.workerSources[ne][pe][xt];for(const Wt in vt)vt[Wt]instanceof s.dh&&(vt[Wt].isSpriteLoaded=Ie,vt[Wt].fire(new s.a8("isSpriteLoaded")))}}setImages(ne,{scope:pe,images:Ie},xt){if(this.availableImages[ne]||(this.availableImages[ne]={}),this.availableImages[ne][pe]=Ie,this.workerSources[ne]&&this.workerSources[ne][pe]){for(const vt in this.workerSources[ne][pe]){const Wt=this.workerSources[ne][pe][vt];for(const Jt in Wt)Wt[Jt].availableImages=Ie}xt()}else xt()}setProjection(ne,pe){this.projections[ne]=s.o(pe)}setBrightness(ne,pe,Ie){this.brightness=pe,Ie()}setLayers(ne,pe,Ie){this.getLayerIndex(ne,pe.scope).replace(pe.layers,pe.options),Ie()}updateLayers(ne,pe,Ie){this.getLayerIndex(ne,pe.scope).update(pe.layers,pe.removedIds,pe.options),Ie()}loadTile(ne,pe,Ie){pe.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,pe.type,pe.source,pe.scope).loadTile(pe,Ie)}loadDEMTile(ne,pe,Ie){this.getDEMWorkerSource(ne,pe.source,pe.scope).loadTile(pe,Ie)}reloadTile(ne,pe,Ie){pe.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,pe.type,pe.source,pe.scope).reloadTile(pe,Ie)}abortTile(ne,pe,Ie){this.getWorkerSource(ne,pe.type,pe.source,pe.scope).abortTile(pe,Ie)}removeTile(ne,pe,Ie){this.getWorkerSource(ne,pe.type,pe.source,pe.scope).removeTile(pe,Ie)}removeSource(ne,pe,Ie){if(!(this.workerSources[ne]&&this.workerSources[ne][pe.scope]&&this.workerSources[ne][pe.scope][pe.type]&&this.workerSources[ne][pe.scope][pe.type][pe.source]))return;const xt=this.workerSources[ne][pe.scope][pe.type][pe.source];delete this.workerSources[ne][pe.scope][pe.type][pe.source],xt.removeSource!==void 0?xt.removeSource(pe,Ie):Ie()}loadWorkerSource(ne,pe,Ie){try{this.self.importScripts(pe.url),Ie()}catch(xt){Ie(xt.toString())}}syncRTLPluginState(ne,pe,Ie){try{s.dq.setState(pe);const xt=s.dq.getPluginURL();if(s.dq.isLoaded()&&!s.dq.isParsed()&&xt!=null){this.self.importScripts(xt);const vt=s.dq.isParsed();Ie(vt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${xt}`),vt)}}catch(xt){Ie(xt.toString())}}setDracoUrl(ne,pe){this.dracoUrl=pe}getAvailableImages(ne,pe){this.availableImages[ne]||(this.availableImages[ne]={});let Ie=this.availableImages[ne][pe];return Ie||(Ie=[]),Ie}getLayerIndex(ne,pe){this.layerIndexes[ne]||(this.layerIndexes[ne]={});let Ie=this.layerIndexes[ne][pe];return Ie||(Ie=this.layerIndexes[ne][pe]=new L,Ie.scope=pe),Ie}getWorkerSource(ne,pe,Ie,xt){if(this.workerSources[ne]||(this.workerSources[ne]={}),this.workerSources[ne][xt]||(this.workerSources[ne][xt]={}),this.workerSources[ne][xt][pe]||(this.workerSources[ne][xt][pe]={}),this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={}),!this.workerSources[ne][xt][pe][Ie]){const vt={send:(Wt,Jt,Tt,li,wi,$t)=>{this.actor.send(Wt,Jt,Tt,ne,wi,$t)},scheduler:this.actor.scheduler};this.workerSources[ne][xt][pe][Ie]=new this.workerSourceTypes[pe](vt,this.getLayerIndex(ne,xt),this.getAvailableImages(ne,xt),this.isSpriteLoaded[ne][xt],void 0,this.brightness)}return this.workerSources[ne][xt][pe][Ie]}getDEMWorkerSource(ne,pe,Ie){return this.demWorkerSources[ne]||(this.demWorkerSources[ne]={}),this.demWorkerSources[ne][Ie]||(this.demWorkerSources[ne][Ie]={}),this.demWorkerSources[ne][Ie][pe]||(this.demWorkerSources[ne][Ie][pe]=new F),this.demWorkerSources[ne][Ie][pe]}enforceCacheSizeLimit(ne,pe){s.dr(pe)}getWorkerPerformanceMetrics(ne,pe,Ie){Ie(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ni(self)),ni}),_(["./shared"],function(s){function M(g,l){if(Array.isArray(g)){if(!Array.isArray(l)||g.length!==l.length)return!1;for(let d=0;d<g.length;d++)if(!M(g[d],l[d]))return!1;return!0}if(typeof g=="object"&&g!==null&&l!==null){if(typeof l!="object"||Object.keys(g).length!==Object.keys(l).length)return!1;for(const d in g)if(!M(g[d],l[d]))return!1;return!0}return g===l}var P=L;function L(g){return!function(l){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,w,S=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(S);try{w=new Worker(A),v=!0}catch{v=!1}return w&&w.terminate(),URL.revokeObjectURL(A),v}()?function(){var v=document.createElement("canvas");v.width=v.height=1;var w=v.getContext("2d");if(!w)return!1;var S=w.getImageData(0,0,1,1);return S&&S.width===v.width}()?(F[d=l&&l.failIfMajorPerformanceCaveat]===void 0&&(F[d]=function(v){var w,S=function(A){var C=document.createElement("canvas"),R=Object.create(L.webGLContextAttributes);return R.failIfMajorPerformanceCaveat=A,C.getContext("webgl2",R)}(v);if(!S)return!1;try{w=S.createShader(S.VERTEX_SHADER)}catch{return!1}return!(!w||S.isContextLost())&&(S.shaderSource(w,"void main() {}"),S.compileShader(w),S.getShaderParameter(w,S.COMPILE_STATUS)===!0)}(d)),F[d]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var d}(g)}var F={};function V(g,l,d){const v=document.createElement(g);return l!=null&&(v.className=l),d&&d.appendChild(v),v}function X(g,l,d){const v=document.createElementNS("http://www.w3.org/2000/svg",g);for(const w of Object.keys(l))v.setAttributeNS(null,w,String(l[w]));return d&&d.appendChild(v),v}L.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const q=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Y=q&&q.userSelect!==void 0?"userSelect":"WebkitUserSelect";let J;function ue(){q&&Y&&(J=q[Y],q[Y]="none")}function ce(){q&&Y&&(q[Y]=J)}function fe(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",fe,!0)}function Ae(){window.addEventListener("click",fe,!0),window.setTimeout(()=>{window.removeEventListener("click",fe,!0)},0)}function Ce(g,l){const d=g.getBoundingClientRect();return nt(g,d,l)}function He(g,l){const d=g.getBoundingClientRect(),v=[];for(let w=0;w<l.length;w++)v.push(nt(g,d,l[w]));return v}function We(g){return window.InstallTrigger!==void 0&&g.button===2&&g.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function nt(g,l,d){const v=g.offsetWidth===l.width?1:g.offsetWidth/l.width;return new s.P((d.clientX-l.left)*v,(d.clientY-l.top)*v)}class we{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(l,d){this._updatedSourceCaches[l]=d,this.setDirty()}discardSourceCacheUpdate(l){delete this._updatedSourceCaches[l]}updateLayer(l){const d=l.scope;this._updatedLayers[d]=this._updatedLayers[d]||new Set,this._updatedLayers[d].add(l.id),this.setDirty()}removeLayer(l){const d=l.scope;this._removedLayers[d]=this._removedLayers[d]||{},this._updatedLayers[d]=this._updatedLayers[d]||new Set,this._removedLayers[d][l.id]=l,this._updatedLayers[d].delete(l.id),this._updatedPaintProps.delete(l.fqid),this.setDirty()}getRemovedLayer(l){return this._removedLayers[l.scope]?this._removedLayers[l.scope][l.id]:null}discardLayerRemoval(l){this._removedLayers[l.scope]&&delete this._removedLayers[l.scope][l.id]}getLayerUpdatesByScope(){const l={};for(const d in this._updatedLayers)l[d]=l[d]||{},l[d].updatedIds=Array.from(this._updatedLayers[d].values());for(const d in this._removedLayers)l[d]=l[d]||{},l[d].removedIds=Object.keys(this._removedLayers[d]);return l}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(l){this._updatedPaintProps.add(l.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(l){this._updatedImages.add(l),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const ht={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class pt{constructor(l,d,v,w,S,A){this.length=d.length,this.attributes=v,this.itemSize=d.bytesPerElement,this.dynamicDraw=w,this.instanceCount=A,this.context=l;const C=l.gl;this.buffer=C.createBuffer(),l.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||S||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,d){for(let v=0;v<this.attributes.length;v++){const w=d.attributes[this.attributes[v].name];w!==void 0&&l.enableVertexAttribArray(w)}}setVertexAttribPointers(l,d,v){for(let w=0;w<this.attributes.length;w++){const S=this.attributes[w],A=d.attributes[S.name];A!==void 0&&l.vertexAttribPointer(A,S.components,l[ht[S.type]],!1,this.itemSize,S.offset+this.itemSize*(v||0))}}setVertexAttribDivisor(l,d,v){for(let w=0;w<this.attributes.length;w++){const S=d.attributes[this.attributes[w].name];S!==void 0&&this.instanceCount&&this.instanceCount>0&&l.vertexAttribDivisor(S,v)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Xe{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class mt extends Xe{getDefault(){return s.C.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Ft extends Xe{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class tt extends Xe{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class ei extends Xe{getDefault(){return[!0,!0,!0,!0]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class ki extends Xe{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class rt extends Xe{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class yt extends Xe{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const d=this.current;(l.func!==d.func||l.ref!==d.ref||l.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class Xt extends Xe{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class kt extends Xe{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=l,this.dirty=!1}}class Ue extends Xe{getDefault(){return[0,1]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class Ye extends Xe{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=l,this.dirty=!1}}class Kt extends Xe{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class vi extends Xe{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.BLEND):d.disable(d.BLEND),this.current=l,this.dirty=!1}}class en extends Xe{getDefault(){const l=this.gl;return[l.ONE,l.ZERO,l.ONE,l.ZERO]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.blendFuncSeparate(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Li extends Xe{getDefault(){return s.C.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Zi extends Xe{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(l,l),this.current=l,this.dirty=!1)}}class it extends Xe{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=l,this.dirty=!1}}class Sn extends Xe{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class dr extends Xe{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}let Hr=class extends Xe{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class xi extends Xe{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class wt extends Xe{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class ni extends Xe{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Ve extends Xe{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class ne extends Xe{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class pe extends Xe{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Ie extends Xe{getDefault(){return null}set(l){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class xt extends Xe{getDefault(){return null}set(l){this.gl&&(l!==this.current||this.dirty)&&(this.gl.bindVertexArray(l),this.current=l,this.dirty=!1)}}class vt extends Xe{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Wt extends Xe{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Jt extends Xe{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Tt extends Xe{constructor(l,d){super(l),this.context=l,this.parent=d}getDefault(){return null}}class li extends Tt{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class wi extends Tt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class $t extends Tt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,this.attachment(),d.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class cn extends wi{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class dn{constructor(l,d,v,w,S){this.context=l,this.width=d,this.height=v;const A=this.framebuffer=l.gl.createFramebuffer();w&&(this.colorAttachment=new li(l,A)),S&&(this.depthAttachmentType=S,this.depthAttachment=S==="renderbuffer"?new wi(l,A):new $t(l,A))}destroy(){const l=this.context.gl;if(this.colorAttachment){const d=this.colorAttachment.get();d&&l.deleteTexture(d)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const d=this.depthAttachment.get();d&&l.deleteRenderbuffer(d)}else{const d=this.depthAttachment.get();d&&l.deleteTexture(d)}l.deleteFramebuffer(this.framebuffer)}}class Fn{constructor(l,d){this.gl=l,this.clearColor=new mt(this),this.clearDepth=new Ft(this),this.clearStencil=new tt(this),this.colorMask=new ei(this),this.depthMask=new ki(this),this.stencilMask=new rt(this),this.stencilFunc=new yt(this),this.stencilOp=new Xt(this),this.stencilTest=new kt(this),this.depthRange=new Ue(this),this.depthTest=new Ye(this),this.depthFunc=new Kt(this),this.blend=new vi(this),this.blendFunc=new en(this),this.blendColor=new Li(this),this.blendEquation=new Zi(this),this.cullFace=new it(this),this.cullFaceSide=new Sn(this),this.frontFace=new dr(this),this.program=new Hr(this),this.activeTexture=new xi(this),this.viewport=new wt(this),this.bindFramebuffer=new ni(this),this.bindRenderbuffer=new Ve(this),this.bindTexture=new ne(this),this.bindVertexBuffer=new pe(this),this.bindElementBuffer=new Ie(this),this.bindVertexArrayOES=new xt(this),this.pixelStoreUnpack=new vt(this),this.pixelStoreUnpackPremultiplyAlpha=new Wt(this),this.pixelStoreUnpackFlipY=new Jt(this),this.options=d?{...d}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=l.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,d,v){return new s.I(this,l,d,v)}createVertexBuffer(l,d,v,w,S){return new pt(this,l,d,v,w,S)}createRenderbuffer(l,d,v){const w=this.gl,S=w.createRenderbuffer();return this.bindRenderbuffer.set(S),w.renderbufferStorage(w.RENDERBUFFER,l,d,v),this.bindRenderbuffer.set(null),S}createFramebuffer(l,d,v,w){return new dn(this,l,d,v,w)}clear({color:l,depth:d,stencil:v,colorMask:w}){const S=this.gl;let A=0;l&&(A|=S.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set(w||[!0,!0,!0,!0])),d!==void 0&&(A|=S.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),v!==void 0&&(A|=S.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),S.clear(A)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){M(l.blendFunction,s.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor),l.blendEquation?this.blendEquation.set(l.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(l.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class gn{constructor(l=0,d=0,v=0,w=0){if(isNaN(l)||l<0||isNaN(d)||d<0||isNaN(v)||v<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=d,this.left=v,this.right=w}interpolate(l,d,v){return d.top!=null&&l.top!=null&&(this.top=s.n(l.top,d.top,v)),d.bottom!=null&&l.bottom!=null&&(this.bottom=s.n(l.bottom,d.bottom,v)),d.left!=null&&l.left!=null&&(this.left=s.n(l.left,d.left,v)),d.right!=null&&l.right!=null&&(this.right=s.n(l.right,d.right,v)),this}getCenter(l,d){const v=s.c((this.left+l-this.right)/2,0,l),w=s.c((this.top+d-this.bottom)/2,0,d);return new s.P(v,w)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new gn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function wn(g,l){const d=s.g(g,3);s.m.fromQuat(g,l),s.s(g,3,d)}function Je(g,l){const d=s.q.identity([]);return s.q.rotateZ(d,d,-l),s.q.rotateX(d,d,-g),d}function mi(g,l){const d=[g[0],g[1],0],v=[l[0],l[1],0];if(s.v.length(d)>=1e-15){const A=s.v.normalize([],d);s.v.scale(v,A,s.v.dot(v,A)),l[0]=v[0],l[1]=v[1]}const w=s.v.cross([],l,g);if(s.v.len(w)<1e-15)return null;const S=Math.atan2(-w[1],w[0]);return Je(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),S)}class Gi{constructor(l,d){this.position=l,this.orientation=d}get position(){return this._position}set position(l){if(l){const d=l instanceof s.M?l:new s.M(l[0],l[1],l[2]);this._renderWorldCopies&&(d.x=s.w(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(l,d){if(this.orientation=null,!this.position)return;const v=this.position,w=this._elevation?this._elevation.getAtPointOrZero(s.M.fromLngLat(l)):0,S=s.M.fromLngLat(l,w),A=[S.x-v.x,S.y-v.y,S.z-v.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=mi(A,d)}setPitchBearing(l,d){this.orientation=Je(s.d(l),s.d(-d))}}class fn{constructor(l,d){this._transform=s.m.identity([]),this.orientation=d,this.position=l}get mercatorPosition(){const l=this.position;return new s.M(l[0],l[1],l[2])}get position(){const l=s.g(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var d;l&&s.s(this._transform,3,[(d=l)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||s.q.identity([]),l&&wn(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,d){this._orientation=Je(l,d),wn(this._transform,this._orientation)}forward(){const l=s.g(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=s.g(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=s.g(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,d){const v=new Float64Array(16);return s.m.invert(v,this.getWorldToCamera(l,d)),v}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(l,d,v){const w=this.position;s.v.scale(w,w,-l);const S=new Float64Array(16);return s.m.fromScaling(S,[v,v,v]),s.m.translate(S,S,w),S[10]*=d,S}getWorldToCamera(l,d){const v=new Float64Array(16),w=new Float64Array(4),S=this.position;return s.q.conjugate(w,this._orientation),s.v.scale(S,S,-l),s.m.fromQuat(v,w),s.m.translate(v,v,S),v[1]*=-1,v[5]*=-1,v[9]*=-1,v[13]*=-1,v[8]*=d,v[9]*=d,v[10]*=d,v[11]*=d,v}getCameraToClipPerspective(l,d,v,w){const S=new Float64Array(16);return s.m.perspective(S,l,d,v,w),S}getCameraToClipOrthographic(l,d,v,w,S,A){const C=new Float64Array(16);return s.m.ortho(C,l,d,v,w,S,A),C}getDistanceToElevation(l,d=!1){const v=l===0?0:s.b(l,d?s.l(this.position[1]):this.position[1]),w=this.forward();return(v-this.position[2])/w[2]}clone(){return new fn([...this.position],[...this.orientation])}}const $n={unknown:0,flipRequired:1,flipNotRequired:2},Jr=Math.tan(85*Math.PI/180);function Cr(g,l,d,v,w,S,A){const C=s.m.create();if(d)if(S.name==="globe"){const R=s.f(w,l);s.m.multiply(C,C,R)}else{const R=s.h.invert([],A);C[0]=R[0],C[1]=R[1],C[4]=R[2],C[5]=R[3],v||s.m.rotateZ(C,C,w.angle)}else s.m.multiply(C,w.labelPlaneMatrix,g);return C}function Mo(g,l,d,v,w,S,A){const C=Cr(g,l,d,v,w,S,A);return S.name==="globe"&&d||(C[2]=C[6]=C[10]=C[14]=0),C}function qr(g,l,d,v,w,S,A){if(d){if(S.name==="globe"){const C=Cr(g,l,d,v,w,S,A);return s.m.invert(C,C),s.m.multiply(C,g,C),C}{const C=s.m.clone(g),R=s.m.identity([]);return R[0]=A[0],R[1]=A[1],R[4]=A[2],R[5]=A[3],s.m.multiply(C,C,R),v||s.m.rotateZ(C,C,-w.angle),C}}return w.glCoordMatrix}function Pr(g,l,d,v){const w=[g,l,d,1];d?s.e.transformMat4(w,w,v):zi(w,w,v);const S=w[3];return w[0]/=S,w[1]/=S,w[2]/=S,w}function lt(g,l){return Math.min(.5+g/l*.5,1.5)}function ft(g,l){const d=g[0]/g[3],v=g[1]/g[3];return d>=-l[0]&&d<=l[0]&&v>=-l[1]&&v<=l[1]}function Ct(g,l,d,v,w,S,A,C,R,B){const U=d.transform,H=v?g.textSizeData:g.iconSizeData,Z=s.i(H,d.transform.zoom),K=U.projection.name==="globe",Q=[256/d.width*2+1,256/d.height*2+1],te=v?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;te.clear();let ee=null;K&&(ee=v?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const $=g.lineVertexArray,le=v?g.text.placedSymbolArray:g.icon.placedSymbolArray,_e=d.transform.width/d.transform.height;let ye,oe=!1;for(let he=0;he<le.length;he++){const ve=le.get(he),{numGlyphs:Ee,writingMode:xe}=ve;if(xe!==s.W.vertical||oe||ye===s.W.horizontal||(oe=!0),ye=xe,(ve.hidden||xe===s.W.vertical)&&!oe){At(Ee,te);continue}oe=!1;const Pe=new s.P(ve.tileAnchorX,ve.tileAnchorY);let{x:ct,y:je,z:et}=U.projection.projectTilePoint(Pe.x,Pe.y,B.canonical);if(R){const[Yt,pi,Qt]=R(Pe);ct+=Yt,je+=pi,et+=Qt}const Le=[ct,je,et,1];if(s.e.transformMat4(Le,Le,l),!ft(Le,Q)){At(Ee,te);continue}const at=Le[3],Ke=lt(d.transform.getCameraToCenterDistance(U.projection),at),dt=s.j(H,Z,ve),me=A?dt/Ke:dt*Ke,Fe=Pr(ct,je,et,w);if(Fe[3]<=0){At(Ee,te);continue}let Mt={};const _t=A?null:R,oi=jt(ve,me,!1,C,l,w,S,g.glyphOffsetArray,$,te,ee,Fe,Pe,Mt,_e,_t,U.projection,B,A);oe=oi.useVertical,_t&&oi.needsFlipping&&(Mt={}),(oi.notEnoughRoom||oe||oi.needsFlipping&&jt(ve,me,!0,C,l,w,S,g.glyphOffsetArray,$,te,ee,Fe,Pe,Mt,_e,_t,U.projection,B,A).notEnoughRoom)&&At(Ee,te)}v?(g.text.dynamicLayoutVertexBuffer.updateData(te),ee&&g.text.globeExtVertexBuffer&&g.text.globeExtVertexBuffer.updateData(ee)):(g.icon.dynamicLayoutVertexBuffer.updateData(te),ee&&g.icon.globeExtVertexBuffer&&g.icon.globeExtVertexBuffer.updateData(ee))}function Dt(g,l,d,v,w,S,A,C,R,B,U,H,Z,K,Q,te){const{lineStartIndex:ee,glyphStartIndex:$,segment:le}=C,_e=$+C.numGlyphs,ye=ee+C.lineLength,oe=l.getoffsetX($),he=l.getoffsetX(_e-1),ve=ai(g*oe,d,v,w,S,A,le,ee,ye,R,B,U,H,Z,!0,K,Q,te);if(!ve)return null;const Ee=ai(g*he,d,v,w,S,A,le,ee,ye,R,B,U,H,Z,!0,K,Q,te);return Ee?{first:ve,last:Ee}:null}function zt(g,l,d,v){return g===s.W.horizontal&&Math.abs(v)>Math.abs(d)?{useVertical:!0}:g===s.W.vertical?v>0?{needsFlipping:!0}:null:l!==$n.unknown&&function(w,S){return w===0||Math.abs(S/w)>Jr}(d,v)?l===$n.flipRequired?{needsFlipping:!0}:null:d<0?{needsFlipping:!0}:null}function jt(g,l,d,v,w,S,A,C,R,B,U,H,Z,K,Q,te,ee,$,le){const _e=l/24,ye=g.lineOffsetX*_e,oe=g.lineOffsetY*_e,{lineStartIndex:he,glyphStartIndex:ve,numGlyphs:Ee,segment:xe,writingMode:Pe,flipState:ct}=g,je=he+g.lineLength,et=Le=>{if(U){const[me,Fe,Mt]=Le.up,_t=B.length;s.u(U,_t+0,me,Fe,Mt),s.u(U,_t+1,me,Fe,Mt),s.u(U,_t+2,me,Fe,Mt),s.u(U,_t+3,me,Fe,Mt)}const[at,Ke,dt]=Le.point;s.k(B,at,Ke,dt,Le.angle)};if(Ee>1){const Le=Dt(_e,C,ye,oe,d,H,Z,g,R,S,K,te,!1,ee,$,le);if(!Le)return{notEnoughRoom:!0};if(v&&!d){let[at,Ke,dt]=Le.first.point,[me,Fe,Mt]=Le.last.point;[at,Ke]=Pr(at,Ke,dt,A),[me,Fe]=Pr(me,Fe,Mt,A);const _t=zt(Pe,ct,(me-at)*Q,Fe-Ke);if(g.flipState=_t&&_t.needsFlipping?$n.flipRequired:$n.flipNotRequired,_t)return _t}et(Le.first);for(let at=ve+1;at<ve+Ee-1;at++){const Ke=ai(_e*C.getoffsetX(at),ye,oe,d,H,Z,xe,he,je,R,S,K,te,!1,!1,ee,$,le);if(!Ke)return B.length-=4*(at-ve),{notEnoughRoom:!0};et(Ke)}et(Le.last)}else{if(v&&!d){const at=Pr(Z.x,Z.y,0,w),Ke=he+xe+1,dt=new s.P(R.getx(Ke),R.gety(Ke)),me=Pr(dt.x,dt.y,0,w),Fe=me[3]>0?me:Bt(Z,dt,at,1,w,void 0,ee,$.canonical),Mt=zt(Pe,ct,(Fe[0]-at[0])*Q,Fe[1]-at[1]);if(g.flipState=Mt&&Mt.needsFlipping?$n.flipRequired:$n.flipNotRequired,Mt)return Mt}const Le=ai(_e*C.getoffsetX(ve),ye,oe,d,H,Z,xe,he,je,R,S,K,te,!1,!1,ee,$,le);if(!Le)return{notEnoughRoom:!0};et(Le)}return{}}function Zt(g,l,d,v,w){const{x:S,y:A,z:C}=v.projectTilePoint(g.x,g.y,l);if(!w)return Pr(S,A,C,d);const[R,B,U]=w(g);return Pr(S+R,A+B,C+U,d)}function Bt(g,l,d,v,w,S,A,C){const R=Zt(g.sub(l)._unit()._add(g),C,w,A,S);return s.v.sub(R,d,R),s.v.normalize(R,R),s.v.scaleAndAdd(R,d,R,v)}function ai(g,l,d,v,w,S,A,C,R,B,U,H,Z,K,Q,te,ee,$){const le=v?g-l:g+l;let _e=le>0?1:-1,ye=0;v&&(_e*=-1,ye=Math.PI),_e<0&&(ye+=Math.PI);let oe=C+A+(_e>0?0:1)|0,he=w,ve=w,Ee=0,xe=0;const Pe=Math.abs(le),ct=[],je=[];let et=S,Le=et;const at=()=>Bt(Le,et,ve,Pe-Ee+1,U,Z,te,ee.canonical);for(;Ee+xe<=Pe;){if(oe+=_e,oe<C||oe>=R)return null;if(ve=he,Le=et,ct.push(ve),K&&je.push(Le),et=new s.P(B.getx(oe),B.gety(oe)),he=H[oe],!he){const pi=Zt(et,ee.canonical,U,te,Z);he=pi[3]>0?H[oe]=pi:at()}Ee+=xe,xe=s.v.distance(ve,he)}Q&&Z&&(H[oe]&&(he=at(),xe=s.v.distance(ve,he)),H[oe]=he);const Ke=(Pe-Ee)/xe,dt=et.sub(Le)._mult(Ke)._add(Le),me=s.v.sub([],he,ve),Fe=s.v.scaleAndAdd([],ve,me,Ke);let Mt=[0,0,1],_t=me[0],oi=me[1];if($&&(Mt=te.upVector(ee.canonical,dt.x,dt.y),Mt[0]!==0||Mt[1]!==0||Mt[2]!==1)){const pi=[Mt[2],0,-Mt[0]],Qt=s.v.cross([],Mt,pi);s.v.normalize(pi,pi),s.v.normalize(Qt,Qt),_t=s.v.dot(me,pi),oi=s.v.dot(me,Qt)}if(d){const pi=s.v.cross([],Mt,me);s.v.normalize(pi,pi),s.v.scaleAndAdd(Fe,Fe,pi,d*_e)}const Yt=ye+Math.atan2(oi,_t);return ct.push(Fe),K&&je.push(dt),{point:Fe,angle:Yt,path:ct,tilePath:je,up:Mt}}function At(g,l){const d=l.length,v=d+4*g;l.resize(v),l.float32.fill(-1/0,4*d,4*v)}function zi(g,l,d){const v=l[0],w=l[1];return g[0]=d[0]*v+d[4]*w+d[12],g[1]=d[1]*v+d[5]*w+d[13],g[3]=d[3]*v+d[7]*w+d[15],g}const mn=(g,l,d)=>(1-d)*g+d*l,gi=g=>g*g*g*g*g;class un{constructor(l,d,v,w,S,A,C){this.tileSize=512,this._renderWorldCopies=S===void 0||S,this._minZoom=l||0,this._maxZoom=d||22,this._minPitch=v??0,this._maxPitch=w??60,this.setProjection(A),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new s.L(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new gn,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new fn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const l=new un(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(l,d=!1){const v=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||v)&&this._updateCameraOnTerrain(),(l||v)&&this._constrainCamera(d),this._calcMatrices()}getProjection(){return s.p(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};const d=this.projection?this.getProjection():void 0;this.projection=s.o(this.projectionOptions);const v=!M(d,this.getProjection());return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setOrthographicProjectionAtLowPitch(l){return this._orthographicProjectionAtLowPitch!==l&&(this._orthographicProjectionAtLowPitch=l,this._calcMatrices(),!0)}setMercatorFromTransition(){const l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.o({name:"mercator"});const d=l!==this.projection.name;return d&&this._calcMatrices(),d}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.b(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.w(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const d=-l*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=s.h.create(),s.h.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const d=s.c(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=s.d(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){const d=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}_updateCameraOnTerrain(){const l=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,d=this.elevation&&l===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||l===Number.NEGATIVE_INFINITY&&(!d||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const v=this._elevation;d||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&v.exaggeration()&&this._centerAltitudeValidForExaggeration!==v.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*v.exaggeration(),this._centerAltitudeValidForExaggeration=v.exaggeration()):(this._centerAltitude=l||0,this._centerAltitudeValidForExaggeration=v.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],v=this.horizonLineFromTop();let w=0,S=0;for(let A=0;A<d.length;A++){const C=new s.P(d[A][0]*this.width,v+d[A][1]*(this.height-v)),R=l.pointCoordinate(C);if(!R)continue;const B=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);w+=R[3]*B,S+=B}return S===0?NaN:w/S}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const l=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),v=this.pixelsPerMeter/this.worldSize*d,w=this._mercatorZfromZoom(l),S=this._mercatorZfromZoom(this._maxZoom),A=Math.max(w-v,S);this._setZoom(this._zoomFromMercatorZ(A))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let v;v=l.z<this._camera.position[2]?[d.x,d.y,d.z]:[l.x,l.y,l.z];const w=s.v.length(s.v.sub([],this._camera.position,v));return s.c(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let d=!1;if(l.orientation&&!s.q.exactEquals(l.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(l.orientation)),l.position){const v=[l.position.x,l.position.y,l.position.z];s.v.exactEquals(v,this._camera.position)||(this._setCameraPosition(v),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,d=new Gi;return d.position=new s.M(l[0],l[1],l[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(l){if(!s.q.length(l))return!1;s.q.normalize(l,l);const d=s.v.transformQuat([],[0,0,-1],l),v=s.v.transformQuat([],[0,-1,0],l);if(v[2]<0)return!1;const w=mi(d,v);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(l){const d=this.zoomScale(this.minZoom)*this.tileSize,v=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;l[2]=s.c(l[2],w/v,w/d),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,d,v){this._unmodified=!1,this._edgeInsets.interpolate(l,d,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const d=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(l){const d=[new s.U(0,l)];if(this.renderWorldCopies){const v=this.pointCoordinate(new s.P(0,0)),w=this.pointCoordinate(new s.P(this.width,0)),S=this.pointCoordinate(new s.P(this.width,this.height)),A=this.pointCoordinate(new s.P(0,this.height)),C=Math.floor(Math.min(v.x,w.x,S.x,A.x)),R=Math.floor(Math.max(v.x,w.x,S.x,A.x)),B=1;for(let U=C-B;U<=R+B;U++)U!==0&&d.push(new s.U(U,l))}return d}isLODDisabled(l){return(!l||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(l,d,v){let w=[];if(d[0]===0&&d[1]===0)return w;for(const A of l){const C=A.canonical,R=A.overscaledZ,B=A.wrap,U=1<<C.z,H=C.x+1<U,Z=C.x>0,K=C.y+1<U,Q=C.y>0,te=A.wrap-(Z?0:1),ee=A.wrap+(H?0:1),$=Z?C.x-1:U-1,le=H?C.x+1:0;d[0]<0?(w.push(new s.O(R,ee,C.z,le,C.y)),d[1]<0&&K&&(w.push(new s.O(R,B,C.z,C.x,C.y+1)),w.push(new s.O(R,ee,C.z,le,C.y+1))),d[1]>0&&Q&&(w.push(new s.O(R,B,C.z,C.x,C.y-1)),w.push(new s.O(R,ee,C.z,le,C.y-1)))):d[0]>0?(w.push(new s.O(R,te,C.z,$,C.y)),d[1]<0&&K&&(w.push(new s.O(R,B,C.z,C.x,C.y+1)),w.push(new s.O(R,te,C.z,$,C.y+1))),d[1]>0&&Q&&(w.push(new s.O(R,B,C.z,C.x,C.y-1)),w.push(new s.O(R,te,C.z,$,C.y-1)))):d[1]<0&&K?w.push(new s.O(R,B,C.z,C.x,C.y+1)):Q&&w.push(new s.O(R,B,C.z,C.x,C.y-1))}if(w.length>1){w.sort((R,B)=>R.overscaledZ-B.overscaledZ||R.wrap-B.wrap||R.canonical.z-B.canonical.z||R.canonical.x-B.canonical.x||R.canonical.y-B.canonical.y);let A=0,C=0;for(;C<w.length;)w[C].equals(w[A])?++C:w[++A]=w[C++];w.length=A+1}const S=[];for(const A of w)w.some(C=>A.isChildOf(C))||S.push(A);return w=S.filter(A=>!l.some(C=>!!(A.overscaledZ<v&&C.isChildOf(A))||A.equals(C)||A.isChildOf(C))),w}coveringTiles(l){let d=this.coveringZoomLevel(l);const v=d,w=this.elevation&&this.elevation.exaggeration(),S=w&&!l.isTerrainDEM,A=this.projection.name==="mercator";if(l.minzoom!==void 0&&d<l.minzoom)return[];l.maxzoom!==void 0&&d>l.maxzoom&&(d=l.maxzoom);const C=this.locationCoordinate(this.center),R=this.center.lat,B=1<<d,U=[B*C.x,B*C.y,0],H=this.projection.name==="globe",Z=!H,K=s.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,Z),Q=H?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),te=B*s.b(1,this.center.lat),ee=this._camera.position[2]/s.b(1,this.center.lat),$=[B*Q.x,B*Q.y,ee*(Z?1:te)],le=H||w,_e=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),ye=this.isLODDisabled(!0)?d:0;let oe;if(this._elevation&&l.isTerrainDEM)oe=1e4*this._elevation.exaggeration();else if(this._elevation){const me=this._elevation.getMinMaxForVisibleTiles();oe=me?me.max:this._centerAltitude}else oe=this._centerAltitude;const he=l.isTerrainDEM?-oe:this._elevation?this._elevation.getMinElevationBelowMSL():0,ve=this.projection.isReprojectedInTileSpace?s.r(this):1,Ee=me=>{const Mt=new s.M(me.x+25e-6,me.y,me.z),_t=new s.M(me.x,me.y+25e-6,me.z),oi=me.toLngLat(),Yt=Mt.toLngLat(),pi=_t.toLngLat(),Qt=this.locationCoordinate(oi),Ai=this.locationCoordinate(Yt),Ii=this.locationCoordinate(pi),ui=Math.hypot(Ai.x-Qt.x,Ai.y-Qt.y),di=Math.hypot(Ii.x-Qt.x,Ii.y-Qt.y);return Math.sqrt(ui*di)*ve/25e-6},xe=me=>{const Fe=oe,Mt=he;return{aabb:s.y(this,B,0,0,0,me,Mt,Fe,this.projection),zoom:0,x:0,y:0,minZ:Mt,maxZ:Fe,wrap:me,fullyVisible:!1}},Pe=[];let ct=[];const je=d,et=l.reparseOverscaled?v:d,Le=me=>me*me,at=Le((ee-this._centerAltitude)*te),Ke=me=>{if(!this._elevation||!me.tileID||!A)return;const Fe=this._elevation.getMinMaxForTile(me.tileID),Mt=me.aabb;Fe?(Mt.min[2]=Fe.min,Mt.max[2]=Fe.max,Mt.center[2]=(Mt.min[2]+Mt.max[2])/2):(me.shouldSplit=dt(me),me.shouldSplit||(Mt.min[2]=Mt.max[2]=Mt.center[2]=this._centerAltitude))},dt=me=>{if(me.zoom<ye)return!0;if(me.zoom===je)return!1;if(me.shouldSplit!=null)return me.shouldSplit;const Fe=me.aabb.distanceX($),Mt=me.aabb.distanceY($);let _t=at,oi=1;if(H){_t=Le(me.aabb.distanceZ($));const Qt=Math.pow(2,me.zoom),Ai=s.l((me.y+1)/Qt),Ii=s.l(me.y/Qt),ui=Math.min(Math.max(R,Ai),Ii),di=s.a0(ui)/s.a0(R);if(oi=ui===R?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,di/this._mercatorScaleRatio),this.zoom<=s.Z&&me.zoom===je-1&&di>=.9)return!0}else if(S&&(_t=Le(me.aabb.distanceZ($)*te)),this.projection.isReprojectedInTileSpace&&v<=5){const Qt=Math.pow(2,me.zoom),Ai=Ee(new s.M((me.x+.5)/Qt,(me.y+.5)/Qt));oi=Ai>.85?1:Ai}const Yt=Fe*Fe+Mt*Mt+_t,pi=Le((1<<je-me.zoom)*_e*oi*((Qt,Ai)=>{if(Ai*Le(.707)<Qt)return 1;const Ii=Math.sqrt(Ai/Qt);return Ii/(1.4144271570014144+(Math.pow(1.1,Ii-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(_t,at),Yt));return Yt<pi};if(this.renderWorldCopies)for(let me=1;me<=3;me++)Pe.push(xe(-me)),Pe.push(xe(me));for(Pe.push(xe(0));Pe.length>0;){const me=Pe.pop(),Fe=me.x,Mt=me.y;let _t=me.fullyVisible;const oi=()=>this.projection.name==="globe"&&(me.y===0||me.y===(1<<me.zoom)-1);if(!_t){let Yt=le?me.aabb.intersects(K):me.aabb.intersectsFlat(K);if(Yt===0&&oi()){const pi=new s.t(me.zoom,Fe,Mt);Yt=s.x(this,B,pi,!0).intersects(K)}if(Yt===0)continue;_t=Yt===2}if(me.zoom!==je&&dt(me))for(let Yt=0;Yt<4;Yt++){const pi=(Fe<<1)+Yt%2,Qt=(Mt<<1)+(Yt>>1),Ai={aabb:A?me.aabb.quadrant(Yt):s.y(this,B,me.zoom+1,pi,Qt,me.wrap,me.minZ,me.maxZ,this.projection),zoom:me.zoom+1,x:pi,y:Qt,wrap:me.wrap,fullyVisible:_t,tileID:void 0,shouldSplit:void 0,minZ:me.minZ,maxZ:me.maxZ};S&&!H&&(Ai.tileID=new s.O(me.zoom+1===je?et:me.zoom+1,me.wrap,me.zoom+1,pi,Qt),Ke(Ai)),Pe.push(Ai)}else{const Yt=me.zoom===je?et:me.zoom;if(l.minzoom&&l.minzoom>Yt)continue;if(!_t){let Ii=le?me.aabb.intersectsPrecise(K):me.aabb.intersectsPreciseFlat(K);if(Ii===0&&oi()){const ui=new s.t(me.zoom,Fe,Mt);Ii=s.x(this,B,ui,!0).intersectsPrecise(K)}if(Ii===0)continue}const pi=U[0]-(.5+Fe+(me.wrap<<me.zoom))*(1<<d-me.zoom),Qt=U[1]-.5-Mt,Ai=me.tileID?me.tileID:new s.O(Yt,me.wrap,me.zoom,Fe,Mt);ct.push({tileID:Ai,distanceSq:pi*pi+Qt*Qt})}}if(this.fogCullDistSq){const me=this.fogCullDistSq,Fe=this.horizonLineFromTop();ct=ct.filter(Mt=>{const _t=[0,0,0,1],oi=[s.J,s.J,0,1],Yt=this.calculateFogTileMatrix(Mt.tileID.toUnwrapped());s.e.transformMat4(_t,_t,Yt),s.e.transformMat4(oi,oi,Yt);const pi=s.e.min([],_t,oi),Qt=s.e.max([],_t,oi),Ai=s.z(pi,Qt);if(Ai===0)return!0;let Ii=!1;const ui=this._elevation;if(ui&&Ai>me&&Fe!==0){const di=this.calculateProjMatrix(Mt.tileID.toUnwrapped());let sn;l.isTerrainDEM||(sn=ui.getMinMaxForTile(Mt.tileID)),sn||(sn={min:he,max:oe});const Ni=s._(this.rotation),Hn=[Ni[0]*s.J,Ni[1]*s.J,sn.max];s.v.transformMat4(Hn,Hn,di),Ii=(1-Hn[1])*this.height*.5<Fe}return Ai<me||Ii})}return ct.sort((me,Fe)=>me.distanceSq-Fe.distanceSq).map(me=>me.tileID)}resize(l,d){this.width=l,this.height=d,this.pixelsToGLUnits=[2/l,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const d=s.c(l.lat,-s.A,s.A),v=this.projection.project(l.lng,d);return new s.P(v.x*this.worldSize,v.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.b(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,d){let v,w;const S=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;v=(d.x-S.x)/C,w=(d.y-S.y)/C}else{const C=this.pointCoordinate(d),R=this.pointCoordinate(S);v=C.x-R.x,w=C.y-R.y}const A=this.locationCoordinate(l);this.setLocation(new s.M(A.x-v,A.y-w))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,d){const v=d?s.b(d,l.lat):void 0,w=this.projection.project(l.lng,l.lat);return new s.M(w.x,w.y,v)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,d){const v=d??this._centerAltitude,w=[l.x,l.y,0,1],S=[l.x,l.y,1,1];s.e.transformMat4(w,w,this.pixelMatrixInverse),s.e.transformMat4(S,S,this.pixelMatrixInverse);const A=S[3];s.e.scale(w,w,1/w[3]),s.e.scale(S,S,1/A);const C=w[2],R=S[2];return{p0:w,p1:S,t:C===R?0:(v-C)/(R-C)}}screenPointToMercatorRay(l){const d=[l.x,l.y,0,1],v=[l.x,l.y,1,1];return s.e.transformMat4(d,d,this.pixelMatrixInverse),s.e.transformMat4(v,v,this.pixelMatrixInverse),s.e.scale(d,d,1/d[3]),s.e.scale(v,v,1/v[3]),d[2]=s.b(d[2],this._center.lat)*this.worldSize,v[2]=s.b(v[2],this._center.lat)*this.worldSize,s.e.scale(d,d,1/this.worldSize),s.e.scale(v,v,1/this.worldSize),new s.R([d[0],d[1],d[2]],s.v.normalize([],s.v.sub([],v,d)))}rayIntersectionCoordinate(l){const{p0:d,p1:v,t:w}=l,S=s.b(d[2],this._center.lat),A=s.b(v[2],this._center.lat);return new s.M(s.n(d[0],v[0],w)/this.worldSize,s.n(d[1],v[1],w)/this.worldSize,s.n(S,A,w))}pointCoordinate(l,d=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,d)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let d=this.projection.pointCoordinate3D(this,l.x,l.y);if(d)return new s.M(d[0],d[1],d[2]);let v=0,w=this.horizonLineFromTop();if(l.y>w)return this.pointCoordinate(l);const S=.02*w,A=l.clone();for(let C=0;C<10&&w-v>S;C++){A.y=s.n(v,w,.66);const R=this.projection.pointCoordinate3D(this,A.x,A.y);R?(w=A.y,d=R):v=A.y}return d?new s.M(d[0],d[1],d[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}isPointOnSurface(l){if(l.y<0||l.y>this.height||l.x<0||l.x>this.width)return!1;if(this.elevation||this.zoom>=s.G)return!this.isPointAboveHorizon(l);const d=this.pointCoordinate(l);return d.y>=0&&d.y<=1}_coordinatePoint(l,d){const v=d&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,w=[l.x*this.worldSize,l.y*this.worldSize,v+l.toAltitude(),1];return s.e.transformMat4(w,w,this.pixelMatrix),w[3]>0?new s.P(w[0]/w[3],w[1]/w[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:l,left:d}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,S=this.pointLocation3D(new s.P(d,l)),A=this.pointLocation3D(new s.P(w,l)),C=this.pointLocation3D(new s.P(w,v)),R=this.pointLocation3D(new s.P(d,v));let B=Math.min(S.lng,A.lng,C.lng,R.lng),U=Math.max(S.lng,A.lng,C.lng,R.lng),H=Math.min(S.lat,A.lat,C.lat,R.lat),Z=Math.max(S.lat,A.lat,C.lat,R.lat);const K=Math.pow(2,-this.zoom)/16*270,Q=this.projection.name==="globe"?1:4,te=(ee,$,le,_e,ye)=>{const oe=(ee+le)/2,he=($+_e)/2,ve=new s.P(oe,he),{lng:Ee,lat:xe}=this.pointLocation3D(ve),Pe=Math.max(0,B-Ee,H-xe,Ee-U,xe-Z);B=Math.min(B,Ee),U=Math.max(U,Ee),H=Math.min(H,xe),Z=Math.max(Z,xe),(ye<Q||Pe>K)&&(te(ee,$,oe,he,ye+1),te(oe,he,le,_e,ye+1))};if(te(d,l,w,l,1),te(w,l,w,v,1),te(w,v,d,v,1),te(d,v,d,l,1),this.projection.name==="globe"){const[ee,$]=s.B(this);ee?(Z=90,U=180,B=-180):$&&(H=-90,U=180,B=-180)}return new s.D(new s.L(B,H),new s.L(U,Z))}_getBoundsRectangular(l,d){const{top:v,left:w}=this._edgeInsets,S=this.height-this._edgeInsets.bottom,A=this.width-this._edgeInsets.right,C=new s.P(w,v),R=new s.P(A,v),B=new s.P(A,S),U=new s.P(w,S);let H=this.pointCoordinate(C,l),Z=this.pointCoordinate(R,l);const K=this.pointCoordinate(B,d),Q=this.pointCoordinate(U,d),te=(ee,$)=>($.y-ee.y)/($.x-ee.x);return H.y>1&&Z.y>=0?H=new s.M((1-Q.y)/te(Q,H)+Q.x,1):H.y<0&&Z.y<=1&&(H=new s.M(-Q.y/te(Q,H)+Q.x,0)),Z.y>1&&H.y>=0?Z=new s.M((1-K.y)/te(K,Z)+K.x,1):Z.y<0&&H.y<=1&&(Z=new s.M(-K.y/te(K,Z)+K.x,0)),new s.D().extend(this.coordinateLocation(H)).extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(K))}_getBoundsRectangularTerrain(){const l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);const d=l.visibleDemTiles.reduce((v,w)=>{if(w.dem){const S=w.dem.tree;v.min=Math.min(v.min,S.minimums[0]),v.max=Math.max(v.max,S.maximums[0])}return v},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(d.min*l.exaggeration(),d.max*l.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,v=this.height/2-d*(1-this._horizonShift);return l?Math.max(0,v):v}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-s.A,this.maxLat=s.A,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.E(this.minLng)*this.tileSize,this.worldMaxX=s.E(this.maxLng)*this.tileSize,this.worldMinY=s.H(this.maxLat)*this.tileSize,this.worldMaxY=s.H(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,d){return this.projection.createTileMatrix(this,d,l)}calculateDistanceTileData(l){const d=l.key,v=this._distanceTileDataCache;if(v[d])return v[d];const w=l.canonical,S=1/this.height,A=this.cameraWorldSize,C=A/this.zoomScale(w.z),R=(w.x+Math.pow(2,w.z)*l.wrap)*C,B=w.y*C,U=this.point;U.x*=A/this.worldSize,U.y*=A/this.worldSize;const H=this.angle,Z=Math.sin(-H),K=-Math.cos(-H);return v[d]={bearing:[Z,K],center:[(U.x-R)*S,(U.y-B)*S],scale:C/s.J*S},v[d]}calculateFogTileMatrix(l){const d=l.key,v=this._fogTileMatrixCache;if(v[d])return v[d];const w=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return s.m.multiply(w,this.worldToFogMatrix,w),v[d]=new Float32Array(w),v[d]}calculateProjMatrix(l,d=!1,v=!1){const w=l.key;let S;if(S=v?this._expandedProjMatrixCache:d?this._alignedProjMatrixCache:this._projMatrixCache,S[w])return S[w];const A=this.calculatePosMatrix(l,this.worldSize);let C;return C=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:v?this.expandedFarZProjMatrix:d?this.alignedProjMatrix:this.projMatrix,s.m.multiply(A,C,A),S[w]=new Float32Array(A),S[w]}calculatePixelsToTileUnitsMatrix(l){const d=l.tileID.key,v=this._pixelsToTileUnitsCache;if(v[d])return v[d];const w=s.K(l,this);return v[d]=w,v[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const l=1/this.worldSize,d=s.m.fromScaling([],[l,l,l]);return s.m.multiply(d,d,this.globeMatrix),d}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const l=this._elevation;this._updateCameraState();const d=s.b(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(d),w=this._camera.forward(),S=s.b(1,this._center.lat);v[2]/=S,w[2]/=S,s.v.normalize(w,w);const A=l.raycast(v,w,l.exaggeration());if(A){const C=s.v.scaleAndAdd([],v,w,A),R=new s.M(C[0],C[1],s.b(C[2],s.l(C[1]))),B=(R.z+s.v.length([R.x-v[0],R.y-v[1],R.z-v[2]*S]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(B),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;const d=this._elevation,v=s.b(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(v),S=d.getAtPointOrZero(new s.M(...w)),A=this.pixelsPerMeter/this.worldSize*S,C=this._minimumHeightOverTerrain(),R=w[2]-A;if(R<=C)if(R<0||l){const B=this.locationCoordinate(this._center,this._centerAltitude),U=[w[0],w[1],B.z-w[2]],H=s.v.length(U);U[2]-=(C-R)/this._pixelsPerMercatorPixel;const Z=s.v.length(U);if(Z===0)return;s.v.scale(U,U,H/Z*this._pixelsPerMercatorPixel),this._camera.position=[w[0],w[1],B.z*this._pixelsPerMercatorPixel-U[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){const Z=this.center;return Z.lat=s.c(Z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(Z.lng=s.c(Z.lng,this.minLng,this.maxLng)),this.center=Z,void(this._constraining=!1)}const d=this._unmodified,{x:v,y:w}=this.point;let S=0,A=v,C=w;const R=this.width/2,B=this.height/2,U=this.worldMinY*this.scale,H=this.worldMaxY*this.scale;if(w-B<U&&(C=U+B),w+B>H&&(C=H-B),H-U<this.height&&(S=Math.max(S,this.height/(H-U)),C=(H+U)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Z=this.worldMinX*this.scale,K=this.worldMaxX*this.scale,Q=this.worldSize/2-(Z+K)/2;A=(v+Q+this.worldSize)%this.worldSize-Q,A-R<Z&&(A=Z+R),A+R>K&&(A=K-R),K-Z<this.width&&(S=Math.max(S,this.width/(K-Z)),A=(K+Z)/2)}A===v&&C===w||(this.center=this.unproject(new s.P(A,C))),S&&(this.zoom+=this.scaleZoom(S)),this._constrainCamera(),this._unmodified=d,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,d=this.projection.name==="globe",v=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.b(1,this.center.lat)/s.b(1,s.$));const w=s.N(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,w),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const S=this.projection.zAxisUnit==="meters"?v:1,A=this._camera.getWorldToCamera(this.worldSize,S);let C;const R=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(R[8]=2*-l.x/this.width,R[9]=2*l.y/this.height,this.isOrthographic){let xe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Pe=xe*this.aspect,ct=-Pe,je=-xe;Pe-=l.x,ct-=l.x,xe+=l.y,je+=l.y,C=this._camera.getCameraToClipOrthographic(ct,Pe,je,xe,this._nearZ,this._farZ),((et,Le,at,Ke)=>{for(let dt=0;dt<16;dt++)et[dt]=mn(Le[dt],at[dt],Ke)})(C,C,R,gi(this.pitch>=15?1:this.pitch/15))}else C=R;const B=s.m.mul([],R,A);let U=s.m.mul([],C,A);if(this.projection.isReprojectedInTileSpace){const xe=this.locationCoordinate(this.center),Pe=s.m.identity([]);s.m.translate(Pe,Pe,[xe.x*this.worldSize,xe.y*this.worldSize,0]),s.m.multiply(Pe,Pe,s.Q(this)),s.m.translate(Pe,Pe,[-xe.x*this.worldSize,-xe.y*this.worldSize,0]),s.m.multiply(U,U,Pe),s.m.multiply(B,B,Pe),this.inverseAdjustmentMatrix=s.S(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.m.scale([],U,[this.worldSize,this.worldSize,this.worldSize/S,1]),this.projMatrix=U,this.invProjMatrix=s.m.invert(new Float64Array(16),this.projMatrix),d){const xe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);xe[8]=2*-l.x/this.width,xe[9]=2*l.y/this.height,this.expandedFarZProjMatrix=s.m.mul([],xe,A)}else this.expandedFarZProjMatrix=this.projMatrix;const H=s.m.invert([],C);this.frustumCorners=s.T.fromInvProjectionMatrix(H,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!d);const Z=new Float32Array(16);s.m.identity(Z),s.m.scale(Z,Z,[1,-1,1]),s.m.rotateX(Z,Z,this._pitch),s.m.rotateZ(Z,Z,this.angle);const K=s.m.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.m.clone(K);const Q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;K[8]=2*-l.x/this.width,K[9]=2*(l.y+Q)/this.height,this.skyboxMatrix=s.m.multiply(Z,K,Z);const te=this.point,ee=te.x,$=te.y,le=this.width%2/2,_e=this.height%2/2,ye=Math.cos(this.angle),oe=Math.sin(this.angle),he=ee-Math.round(ee)+ye*le+oe*_e,ve=$-Math.round($)+ye*_e+oe*le,Ee=new Float64Array(U);if(s.m.translate(Ee,Ee,[he>.5?he-1:he,ve>.5?ve-1:ve,0]),this.alignedProjMatrix=Ee,U=s.m.create(),s.m.scale(U,U,[this.width/2,-this.height/2,1]),s.m.translate(U,U,[1,-1,0]),this.labelPlaneMatrix=U,U=s.m.create(),s.m.scale(U,U,[1,-1,1]),s.m.translate(U,U,[-1,-1,0]),s.m.scale(U,U,[2/this.width,2/this.height,1]),this.glCoordMatrix=U,this.pixelMatrix=s.m.multiply(new Float64Array(16),this.labelPlaneMatrix,B),this._calcFogMatrices(),this._distanceTileDataCache={},U=s.m.invert(new Float64Array(16),this.pixelMatrix),!U)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=U,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.V(this);const xe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.v.transformMat4(xe,xe,A),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=U;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSizeForFog,d=this.cameraPixelsPerMeter,v=this._camera.position,w=1/this.height/this._pixelsPerMercatorPixel,S=[l,l,d];s.v.scale(S,S,w),s.v.scale(v,v,-1),s.v.multiply(v,v,S);const A=s.m.create();s.m.translate(A,A,v),s.m.scale(A,A,S),this.mercatorFogMatrix=A,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,d,w)}_computeCameraPosition(l){const d=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,v=this._camera.forward(),w=this.point,S=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-l/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-v[0]*S,w.y/this.worldSize-v[1]*S,l/this.worldSize*this._centerAltitude-v[2]*S]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),v=this._camera.position[2],w=l[2];let S=1;this.projection.wrap&&(this.center=this.center.wrap()),w>0&&(S=Math.min((d-v)/w,1)),this._camera.position=s.v.scaleAndAdd([],this._camera.position,l,S),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,d=this._camera.forward(),{pitch:v,bearing:w}=this._camera.getPitchBearing(),S=s.b(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,A=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.d(this._maxPitch)),C=Math.max((l[2]-S)/Math.cos(v),A),R=this._zoomFromMercatorZ(C);s.v.scaleAndAdd(l,l,d,C),this._pitch=s.c(v,s.d(this.minPitch),s.d(this.maxPitch)),this.angle=s.w(w,-Math.PI,Math.PI),this._setZoom(s.c(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.M(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){let d=0,v=s.G,w=0,S=1/0;for(;v-d>1e-6&&v>d;){const A=d+.5*(v-d),C=this.tileSize*Math.pow(2,A),R=this.getCameraToCenterDistance(this.projection,A,C),B=this.scaleZoom(R/(l*this.tileSize)),U=Math.abs(A-B);U<S&&(S=U,w=A),A<B?d=A:v=A}return w}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.X("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,d){const v=Math.min(l.x,d.x),w=Math.max(l.x,d.x),S=Math.min(l.y,d.y),A=Math.max(l.y,d.y);if(S<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new s.P(v,S),new s.P(w,A),new s.P(v,A),new s.P(w,S)],R=this.renderWorldCopies?-3:0,B=this.renderWorldCopies?4:1;for(const U of C){const H=this.pointRayIntersection(U);if(H.t<0)return!0;const Z=this.rayIntersectionCoordinate(H);if(Z.x<R||Z.y<0||Z.x>B||Z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.Y(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(l,d){const v=s.v.length(s.v.sub([],this._camera.position,l)),w=this._zoomFromMercatorZ(v)+d;return v-this._mercatorZfromZoom(w)}getCameraPoint(){if(this.projection.name==="globe"){const l=function([d,v,w],S){const A=[d,v,w,1];s.e.transformMat4(A,A,S);const C=A[3]=Math.max(A[3],1e-6);return A[0]/=C,A[1]/=C,A[2]/=C,A}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(l[0],l[1])}{const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,l))}}getCameraToCenterDistance(l,d=this.zoom,v=this.worldSize){const w=s.N(l,d,this.width,this.height,1024),S=l.pixelSpaceConversion(this.center.lat,v,w);let A=.5/Math.tan(.5*this._fov)*this.height*S;return this.isOrthographic&&(A=mn(1,A,gi(this.pitch>=15?1:this.pitch/15))),A}getWorldToCameraMatrix(){const l=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.m.multiply(l,l,this.globeMatrix),l}getFrustum(l){return s.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,this.projection.zAxisUnit==="meters")}}function Qn(g){const{userImage:l}=g;return!!(l&&l.render&&l.render())&&(g.data.replace(new Uint8Array(l.data.buffer)),!0)}class Kn extends s.a6{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(l){this.images[l]={},this.loaded[l]=!1,this.updatedImages[l]={},this.patterns[l]={},this.callbackDispatchedThisFrame[l]={},this.atlasImage[l]=new s.a5({width:1,height:1})}isLoaded(){for(const l in this.loaded)if(!this.loaded[l])return!1;return!0}setLoaded(l,d){if(this.loaded[d]!==l&&(this.loaded[d]=l,l)){for(const{ids:v,callback:w}of this.requestors)this._notify(v,d,w);this.requestors=[]}}hasImage(l,d){return!!this.getImage(l,d)}getImage(l,d){return this.images[d][l]}addImage(l,d,v){this._validate(l,v)&&(this.images[d][l]=v)}_validate(l,d){let v=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new s.a7(new Error(`Image "${l}" has invalid "stretchX" value`))),v=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new s.a7(new Error(`Image "${l}" has invalid "stretchY" value`))),v=!1),this._validateContent(d.content,d)||(this.fire(new s.a7(new Error(`Image "${l}" has invalid "content" value`))),v=!1),v}_validateStretch(l,d){if(!l)return!0;let v=0;for(const w of l){if(w[0]<v||w[1]<w[0]||d<w[1])return!1;v=w[1]}return!0}_validateContent(l,d){return!(l&&(l.length!==4||l[0]<0||d.data.width<l[0]||l[1]<0||d.data.height<l[1]||l[2]<0||d.data.width<l[2]||l[3]<0||d.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,d,v){v.version=this.images[d][l].version+1,this.images[d][l]=v,this.updatedImages[d][l]=!0}removeImage(l,d){const v=this.images[d][l];delete this.images[d][l],delete this.patterns[d][l],v.userImage&&v.userImage.onRemove&&v.userImage.onRemove()}listImages(l){return Object.keys(this.images[l])}getImages(l,d,v){let w=!0;const S=!!this.loaded[d];if(!S)for(const A of l)this.images[d][A]||(w=!1);S||w?this._notify(l,d,v):this.requestors.push({ids:l,scope:d,callback:v})}getUpdatedImages(l){return this.updatedImages[l]}_notify(l,d,v){const w={};for(const S of l){this.images[d][S]||this.fire(new s.a8("styleimagemissing",{id:S}));const A=this.images[d][S];A?w[S]={data:A.data.clone(),pixelRatio:A.pixelRatio,sdf:A.sdf,version:A.version,stretchX:A.stretchX,stretchY:A.stretchY,content:A.content,hasRenderCallback:!!(A.userImage&&A.userImage.render)}:s.X(`Image "${S}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}v(null,w)}getPixelSize(l){const{width:d,height:v}=this.atlasImage[l];return{width:d,height:v}}getPattern(l,d){const v=this.patterns[d][l],w=this.getImage(l,d);if(!w)return null;if(v&&v.position.version===w.version)return v.position;if(v)v.position.version=w.version;else{const S={w:w.data.width+2,h:w.data.height+2,x:0,y:0},A=new s.ab(S,w);this.patterns[d][l]={bin:S,position:A}}return this._updatePatternAtlas(d),this.patterns[d][l].position}bind(l,d){const v=l.gl;let w=this.atlasTexture[d];w?this.dirty&&(w.update(this.atlasImage[d]),this.dirty=!1):(w=new s.a9(l,this.atlasImage[d],v.RGBA),this.atlasTexture[d]=w),w.bind(v.LINEAR,v.CLAMP_TO_EDGE)}_updatePatternAtlas(l){const d=[];for(const A in this.patterns[l])d.push(this.patterns[l][A].bin);const{w:v,h:w}=s.aa(d),S=this.atlasImage[l];S.resize({width:v||1,height:w||1});for(const A in this.patterns[l]){const{bin:C}=this.patterns[l][A],R=C.x+1,B=C.y+1,U=this.images[l][A].data,H=U.width,Z=U.height;s.a5.copy(U,S,{x:0,y:0},{x:R,y:B},{width:H,height:Z}),s.a5.copy(U,S,{x:0,y:Z-1},{x:R,y:B-1},{width:H,height:1}),s.a5.copy(U,S,{x:0,y:0},{x:R,y:B+Z},{width:H,height:1}),s.a5.copy(U,S,{x:H-1,y:0},{x:R-1,y:B},{width:1,height:Z}),s.a5.copy(U,S,{x:0,y:0},{x:R+H,y:B},{width:1,height:Z})}this.dirty=!0}beginFrame(){for(const l in this.images)this.callbackDispatchedThisFrame[l]={}}dispatchRenderCallbacks(l,d){for(const v of l){if(this.callbackDispatchedThisFrame[d][v])continue;this.callbackDispatchedThisFrame[d][v]=!0;const w=this.images[d][v];Qn(w)&&this.updateImage(v,d,w)}}}const or=new s.ac({anchor:new s.ad(s.ae.light.anchor),position:new s.af(s.ae.light.position),color:new s.ad(s.ae.light.color),intensity:new s.ad(s.ae.light.intensity)});class Kr extends s.a6{constructor(l,d="flat"){super(),this._transitionable=new s.ag(or),this.setLight(l,d),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,d,v={}){this._validate(s.ah,l,v)||(this._transitionable.setTransitionOrValue(l),this.id=d)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,v){return(!v||v.validate!==!1)&&s.ai(this,l.call(s.aj,s.ak({value:d,style:{glyphs:!0,sprite:!0},styleSpec:s.ae})))}}const Lo=new s.ac({source:new s.ad(s.ae.terrain.source),exaggeration:new s.ad(s.ae.terrain.exaggeration)});let sr=class extends s.a6{constructor(g,l,d,v){super(),this.scope=d,this._transitionable=new s.ag(Lo,d,v),this._transitionable.setTransitionOrValue(g,v),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(g,l){this._transitionable.setTransitionOrValue(g,l)}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}getExaggeration(g){return this._transitioning.possiblyEvaluate(new s.al(g)).get("exaggeration")}isZoomDependent(){const g=this._transitionable._values.exaggeration;return g!=null&&g.value!=null&&g.value.expression!=null&&g.value.expression instanceof s.am}};const Oo=45,$r=65,Eo=.05;function ys(g,l,d,v){const w=s.an(Oo,$r,d),[S,A]=Ka(g,v);let C=1-Math.min(1,Math.exp((l-S)/(A-S)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*w*g.alpha}function Ka(g,l){const d=.5/Math.tan(.5*l);return[g.range[0]+d,g.range[1]+d]}function Dl(g,l,d,v,w){const S=s.v.transformMat4([],[l,d,v],w.mercatorFogMatrix);return ys(g,s.v.length(S),w.pitch,w._fov)}function Ec(g,l,d,v,w,S,A){const C=[[d,v,0],[w,v,0],[w,S,0],[d,S,0]];let R=Number.MAX_VALUE,B=-Number.MAX_VALUE;for(const U of C){const H=s.v.transformMat4([],U,l),Z=s.v.length(H);R=Math.min(R,Z),B=Math.max(B,Z)}return[ys(g,R,A.pitch,A._fov),ys(g,B,A.pitch,A._fov)]}const xa=new s.ac({range:new s.ad(s.ae.fog.range),color:new s.ad(s.ae.fog.color),"high-color":new s.ad(s.ae.fog["high-color"]),"space-color":new s.ad(s.ae.fog["space-color"]),"horizon-blend":new s.ad(s.ae.fog["horizon-blend"]),"star-intensity":new s.ad(s.ae.fog["star-intensity"]),"vertical-range":new s.ad(s.ae.fog["vertical-range"])});class Ll extends s.a6{constructor(l,d){super(),this._transitionable=new s.ag(xa),this.set(l),this._transitioning=this._transitionable.untransitioned(),this._transform=d}get state(){const l=this._transform,d=l.projection.name==="globe",v=s.ao(l.zoom),w=this.properties.get("range"),S=[.5,3];return{range:d?[s.n(S[0],w[0],v),s.n(S[1],w[1],v)]:w,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,d={}){if(this._validate(s.ap,l,d))return;const v=s.ak({},l);for(const w of Object.keys(s.ae.fog))v[w]===void 0&&(v[w]=s.ae.fog[w].default);this._transitionable.setTransitionOrValue(v)}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.an(Oo,$r,l))*d.a}getOpacityAtLatLng(l,d){return this._transform.projection.supportsFog?function(v,w,S){const A=s.M.fromLngLat(w),C=S.elevation?S.elevation.getAtPointOrZero(A):0;return Dl(v,A.x,A.y,C,S)}(this.state,l,d):0}getOpacityForTile(l){if(!this._transform.projection.supportsFog)return[1,1];const d=this._transform.calculateFogTileMatrix(l.toUnwrapped());return Ec(this.state,d,0,0,s.J,s.J,this._transform)}getOpacityForBounds(l,d,v,w,S){return this._transform.projection.supportsFog?Ec(this.state,l,d,v,w,S,this._transform):[1,1]}getFovAdjustedRange(l){return this._transform.projection.supportsFog?Ka(this.state,l):[0,1]}isVisibleOnFrustum(l){if(!this._transform.projection.supportsFog)return!1;const d=[4,5,6,7];for(const v of d){const w=l.points[v];let S;if(w[2]>=0)S=w;else{const A=l.points[v-4];S=s.aq(A,w,A[2]/(A[2]-w[2]))}if(Dl(this.state,S[0],S[1],0,this._transform)>=Eo)return!0}return!1}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,v){return(!v||v.validate!==!1)&&s.ai(this,l.call(s.aj,s.ak({value:d,style:{glyphs:!0,sprite:!0},styleSpec:s.ae})))}}class ba extends s.a6{constructor(l,d,v,w){super(),this.scope=v,this._options=l,this.properties=new s.ar(d),this._transitionable=new s.ag(d,v,new Map(w)),this._transitionable.setTransitionOrValue(l.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(l){this._transitionable.setTransitionOrValue(this._options.properties,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(l,d){this._options=l,this._transitionable.setTransitionOrValue(l.properties,d)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const fr=new s.ac({color:new s.ad(s.ae.properties_light_ambient.color),intensity:new s.ad(s.ae.properties_light_ambient.intensity)}),_u=new s.ac({direction:new s.as(s.ae.properties_light_directional.direction),color:new s.ad(s.ae.properties_light_directional.color),intensity:new s.ad(s.ae.properties_light_directional.intensity),"cast-shadows":new s.ad(s.ae.properties_light_directional["cast-shadows"]),"shadow-intensity":new s.ad(s.ae.properties_light_directional["shadow-intensity"])});class uo{constructor(l,d,v,w){this.screenBounds=l,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=v,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,w)}static createFromScreenPoints(l,d){let v,w;if(l instanceof s.P||typeof l[0]=="number"){const S=s.P.convert(l);v=[S],w=d.isPointAboveHorizon(S)}else{const S=s.P.convert(l[0]),A=s.P.convert(l[1]);v=[S,A],w=s.at(S,A).every(C=>d.isPointAboveHorizon(C))}return new uo(v,d.getCameraPoint(),w,d)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(l){return s.at(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const d=this.screenBounds[0],v=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],w=s.at(d,v,0,!1);return this.cameraPoint.y>v.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<v.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=v.x?w[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(w[3]=this.cameraPoint)),s.au(w,l)}bufferedCameraGeometryGlobe(l){const d=this.screenBounds[0],v=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],w=s.at(d,v,l),S=this.cameraPoint.clone();switch(3*((S.y>d.y)+(S.y>v.y))+((S.x>d.x)+(S.x>v.x))){case 0:w[0]=S,w[4]=S.clone();break;case 1:w.splice(1,0,S);break;case 2:w[1]=S;break;case 3:w.splice(4,0,S);break;case 5:w.splice(2,0,S);break;case 6:w[3]=S;break;case 7:w.splice(3,0,S);break;case 8:w[2]=S}return w}containsTile(l,d,v,w=0){const S=l.queryPadding/d._pixelsPerMercatorPixel+1,A=v?this._bufferedCameraMercator(S,d):this._bufferedScreenMercator(S,d);let C=l.tileID.wrap+(A.unwrapped?w:0);const R=A.polygon.map(ee=>s.av(l.tileTransform,ee,C));if(!s.aw(R,0,0,s.J,s.J))return;C=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?w:0);const B=this.screenGeometryMercator.polygon.map(ee=>s.ax(l.tileTransform,ee,C)),U=B.map(ee=>new s.P(ee[0],ee[1])),H=d.getFreeCameraOptions().position||new s.M(0,0,0),Z=s.ax(l.tileTransform,H,C),K=B.map(ee=>{const $=s.v.sub(ee,ee,Z);return s.v.normalize($,$),new s.R(Z,$)}),Q=s.ay(l,1,d.zoom)*d._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:U,tilespaceRays:K,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(te=s.az(R),te.min.x=s.c(te.min.x,0,s.J),te.min.y=s.c(te.min.y,0,s.J),te.max.x=s.c(te.max.x,0,s.J),te.max.y=s.c(te.max.y,0,s.J),te),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:Q};var te}_bufferedScreenMercator(l,d){const v=Ao(l);if(this._screenRaycastCache[v])return this._screenRaycastCache[v];{let w;return w=d.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(l),d):{polygon:this.bufferedScreenGeometry(l).map(S=>d.pointCoordinate3D(S)),unwrapped:!0},this._screenRaycastCache[v]=w,w}}_bufferedCameraMercator(l,d){const v=Ao(l);if(this._cameraRaycastCache[v])return this._cameraRaycastCache[v];{let w;return w=d.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),d):{polygon:this.bufferedCameraGeometry(l).map(S=>d.pointCoordinate3D(S)),unwrapped:!0},this._cameraRaycastCache[v]=w,w}}_projectAndResample(l,d){const v=function(S,A){const C=s.m.multiply([],A.pixelMatrix,A.globeMatrix),R=[0,-s.aC,0,1],B=[0,s.aC,0,1],U=[0,0,0,1];s.e.transformMat4(R,R,C),s.e.transformMat4(B,B,C),s.e.transformMat4(U,U,C);const H=new s.P(R[0]/R[3],R[1]/R[3]),Z=new s.P(B[0]/B[3],B[1]/B[3]),K=s.aA(S,H)&&R[3]<U[3],Q=s.aA(S,Z)&&B[3]<U[3];if(!K&&!Q)return null;const te=function(ve,Ee,xe){for(let Pe=1;Pe<ve.length;Pe++){const ct=ho(Ee.pointCoordinate3D(ve[Pe-1]).x),je=ho(Ee.pointCoordinate3D(ve[Pe]).x);if(xe<0){if(ct<je)return{idx:Pe,t:-ct/(je-1-ct)}}else if(je<ct)return{idx:Pe,t:(1-ct)/(je+1-ct)}}return null}(S,A,K?-1:1);if(!te)return null;const{idx:ee,t:$}=te;let le=ee>1?os(S.slice(0,ee),A):[],_e=ee<S.length?os(S.slice(ee),A):[];le=le.map(ve=>new s.P(ho(ve.x),ve.y)),_e=_e.map(ve=>new s.P(ho(ve.x),ve.y));const ye=[...le];ye.length===0&&ye.push(_e[_e.length-1]);const oe=s.n(ye[ye.length-1].y,(_e.length===0?le[0]:_e[0]).y,$);let he;return he=K?[new s.P(0,oe),new s.P(0,0),new s.P(1,0),new s.P(1,oe)]:[new s.P(1,oe),new s.P(1,1),new s.P(0,1),new s.P(0,oe)],ye.push(...he),_e.length===0?ye.push(le[0]):ye.push(..._e),{polygon:ye.map(ve=>new s.M(ve.x,ve.y)),unwrapped:!1}}(l,d);if(v)return v;const w=function(S,A){let C=!1,R=-1/0,B=0;for(let H=0;H<S.length-1;H++)S[H].x>R&&(R=S[H].x,B=H);for(let H=0;H<S.length-1;H++){const Z=(B+H)%(S.length-1),K=S[Z],Q=S[Z+1];Math.abs(K.x-Q.x)>.5&&(K.x<Q.x?(K.x+=1,Z===0&&(S[S.length-1].x+=1)):(Q.x+=1,Z+1===S.length-1&&(S[0].x+=1)),C=!0)}const U=s.E(A.center.lng);return C&&U<Math.abs(U-1)&&S.forEach(H=>{H.x-=1}),{polygon:S,unwrapped:C}}(os(l,d).map(S=>new s.P(ho(S.x),S.y)),d);return{polygon:w.polygon.map(S=>new s.M(S.x,S.y)),unwrapped:w.unwrapped}}}function os(g,l){return s.aB(g,d=>{const v=l.pointCoordinate3D(d);d.x=v.x,d.y=v.y},1/256)}function ho(g){return g<0?1+g%1:g%1}function Ao(g){return 100*g|0}function Ro(g,l,d,v,w){const S=function(A,C){if(A)return w(A);if(C){g.url&&C.tiles&&g.tiles&&delete g.tiles;const R=s.p(s.ak(C,g),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(R.vectorLayers=C.vector_layers,R.vectorLayerIds=R.vectorLayers.map(B=>B.id)),R.tiles=l.canonicalizeTileset(R,g.url),w(null,R)}};return g.url?s.a1(l.transformRequest(l.normalizeSourceURL(g.url,null,d,v),s.a2.Source),S):s.a4.frame(()=>S(null,g))}class fo{constructor(l,d,v){this.bounds=s.D.convert(this.validateBounds(l)),this.minzoom=d||0,this.maxzoom=v||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const d=Math.pow(2,l.z),v=Math.floor(s.E(this.bounds.getWest())*d),w=Math.floor(s.H(this.bounds.getNorth())*d),S=Math.ceil(s.E(this.bounds.getEast())*d),A=Math.ceil(s.H(this.bounds.getSouth())*d);return l.x>=v&&l.x<S&&l.y>=w&&l.y<A}}class Ne extends s.a6{constructor(l,d,v,w){if(super(),this.id=l,this.dispatcher=v,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.ak(this,s.p(d,["url","scheme","tileSize","promoteId"])),this._options=s.ak({type:"vector"},d),this._collectResourceTiming=!!d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w),this._tileWorkers={},this._deduped=new s.aD}load(l){this._loaded=!1,this.fire(new s.a8("dataloading",{dataType:"source"}));const d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,v=this.map._worldview;this._tileJSONRequest=Ro(this._options,this.map._requestManager,d,v,(w,S)=>{this._tileJSONRequest=null,this._loaded=!0,w?(d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),v&&v.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${v}`),this.fire(new s.a7(w))):S&&(s.ak(this,S),S.bounds&&(this.tileBounds=new fo(S.bounds,this.minzoom,this.maxzoom)),s.aH(S.tiles,this.map._requestManager._customAccessToken),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))),l&&l(w)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=s.aE(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.ak({},this._options)}loadTile(l,d){const v=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(v,s.a2.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.a4.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:l.isExtraShadowCaster};if(w.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired")l.state==="loading"?l.reloadCallback=d:l.request=l.actor.send("reloadTile",w,S.bind(this));else if(l.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",w,S.bind(this),void 0,!0);else{const A=s.aF.call({deduped:this._deduped},w,(C,R)=>{C||!R?S.call(this,C):(w.data={cacheControl:R.cacheControl,expires:R.expires,rawData:R.rawData.slice(0)},l.actor&&l.actor.send("loadTile",w,S.bind(this),void 0,!0))},!0);l.request={cancel:A}}function S(A,C){return delete l.request,l.aborted?d(null):A&&A.status!==404?d(A):(C&&C.resourceTiming&&(l.resourceTiming=C.resourceTiming),this.map._refreshExpiredTiles&&C&&l.setExpiryData(C),l.loadVectorData(C,this.map.painter),s.aG(this.dispatcher),d(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(l){l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ci extends s.a6{constructor(l,d,v,w){super(),this.id=l,this.dispatcher=v,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.ak({type:"raster"},d),s.ak(this,s.p(d,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new s.a8("dataloading",{dataType:"source"})),this._tileJSONRequest=Ro(this._options,this.map._requestManager,null,null,(d,v)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new s.a7(d)):v&&(s.ak(this,v),v.bounds&&(this.tileBounds=new fo(v.bounds,this.minzoom,this.maxzoom)),s.aH(v.tiles),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))),l&&l(d)})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=s.aE(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.ak({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,d){const v=s.a4.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),v,this.tileSize);l.request=s.a3(this.map._requestManager.transformRequest(w,s.a2.Tile),(S,A,C,R)=>(delete l.request,l.aborted?(l.state="unloaded",d(null)):S?(l.state="errored",d(S)):A?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:C,expires:R}),l.setTexture(A,this.map.painter),l.state="loaded",s.aG(this.dispatcher),void d(null)):d(null)))}abortTile(l,d){l.request&&(l.request.cancel(),delete l.request),d()}unloadTile(l,d){l.texture&&l.texture instanceof s.a9?(l.destroy(!0),l.texture&&l.texture instanceof s.a9&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),d()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const vs={vector:Ne,raster:ci,"raster-dem":class extends ci{constructor(g,l,d,v){super(g,l,d,v),this.type="raster-dem",this.maxzoom=22,this._options=s.ak({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(g,l){const d=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function v(w,S){w&&(g.state="errored",l(w)),S&&(g.dem=S,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",l(null))}g.request=s.a3(this.map._requestManager.transformRequest(d,s.a2.Tile),(function(w,S,A,C){if(delete g.request,g.aborted)g.state="unloaded",l(null);else if(w)g.state="errored",l(w);else if(S){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:A,expires:C});const R=ImageBitmap&&S instanceof ImageBitmap&&s.aI(),B=1-(S.width-s.aJ(S.width))/2;B<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const U=R?S:s.a4.getImageData(S,B),H={uid:g.uid,coord:g.tileID,source:this.id,scope:this.scope,rawImageData:U,encoding:this.encoding,padding:B};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",H,v.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(g){const l=g.canonical,d=Math.pow(2,l.z),v=(l.x-1+d)%d,w=l.x===0?g.wrap-1:g.wrap,S=(l.x+1+d)%d,A=l.x+1===d?g.wrap+1:g.wrap,C={};return C[new s.O(g.overscaledZ,w,l.z,v,l.y).key]={backfilled:!1},C[new s.O(g.overscaledZ,A,l.z,S,l.y).key]={backfilled:!1},l.y>0&&(C[new s.O(g.overscaledZ,w,l.z,v,l.y-1).key]={backfilled:!1},C[new s.O(g.overscaledZ,g.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},C[new s.O(g.overscaledZ,A,l.z,S,l.y-1).key]={backfilled:!1}),l.y+1<d&&(C[new s.O(g.overscaledZ,w,l.z,v,l.y+1).key]={backfilled:!1},C[new s.O(g.overscaledZ,g.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},C[new s.O(g.overscaledZ,A,l.z,S,l.y+1).key]={backfilled:!1}),C}},geojson:class extends s.a6{constructor(g,l,d,v){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(v),this._data=l.data,this._options=s.ak({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const w=s.J/this.tileSize;this.workerOptions=s.ak({source:this.id,scope:this.scope,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*w,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*w,extent:s.J,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:s.J,radius:(l.clusterRadius!==void 0?l.clusterRadius:50)*w,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}getClusterExpansionZoom(g,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id,scope:this.scope},l),this}getClusterChildren(g,l){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id,scope:this.scope},l),this}getClusterLeaves(g,l,d,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:g,limit:l,offset:d},v),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.a8("dataloading",{dataType:"source"})),this._loaded=!1;const g=s.ak({},this.workerOptions);g.scope=this.scope;const l=this._data;typeof l=="string"?(g.request=this.map._requestManager.transformRequest(s.a4.resolveURL(l),s.a2.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,g,(d,v)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new s.a7(d));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(w.resourceTiming=v.resourceTiming[this.id]),this.fire(new s.a8("data",w)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,l){const d=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const v={type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:s.a4.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};g.request=this.actor.send(d,v,(w,S)=>(delete g.request,g.destroy(),g.aborted?l(null):w?l(w):(g.loadVectorData(S,this.map.painter,d==="reloadTile"),l(null))),void 0,d==="loadTile")}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id,scope:this.scope}),g.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.ak({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aK{constructor(g,l,d,v){super(g,l,d,v),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const l of g.urls)this.urls.push(this.map._requestManager.transformRequest(l,s.a2.Source).url);s.aL(this.urls,(l,d)=>{this._loaded=!0,l?this.fire(new s.a7(l)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const l=this.video.seekable;g<l.start(0)||g>l.end(0)?this.fire(new s.a7(new s.aM(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,l=g.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new s.a9(g,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aK,model:class extends s.a6{constructor(g,l,d,v){super(),this.id=g,this.type="model",this.models=[],this._loaded=!1,this._options=l}load(){const g=[];for(const l in this._options.models){const d=this._options.models[l],v=s.aO(this.map._requestManager.transformRequest(d.uri,s.a2.Model).url).then(w=>{if(!w)return;const S=s.aP(w),A=new s.aQ(l,d.position,d.orientation,S);A.computeBoundsAndApplyParent(),this.models.push(A)}).catch(w=>{this.fire(new s.a7(new Error(`Could not load model ${l} from ${d.uri}: ${w.message}`)))});g.push(v)}return Promise.allSettled(g).then(()=>{this._loaded=!0,this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(l=>{this.fire(new s.a7(new Error(`Could not load models: ${l.message}`)))})}onAdd(g){this.map=g,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(g,l){}serialize(){return{type:"model"}}},"batched-model":class extends s.a6{constructor(g,l,d,v){super(),this.type="batched-model",this.id=g,this.tileSize=512,this._options=l,this.tiles=this._options.tiles,this.maxzoom=l.maxzoom||19,this.minzoom=l.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=d,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(v)}onAdd(g){this.map=g,this.load()}load(g){this._loaded=!1,this.fire(new s.a8("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map._worldview;this._tileJSONRequest=Ro(this._options,this.map._requestManager,l,d,(v,w)=>{this._tileJSONRequest=null,this._loaded=!0,v?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),d&&d.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new s.a7(v))):w&&(s.ak(this,w),w.bounds&&(this.tileBounds=new fo(w.bounds,this.minzoom,this.maxzoom)),s.aH(w.tiles,this.map._requestManager._customAccessToken),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))),g&&g(v)})}hasTransition(){return!1}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loaded(){return this._loaded}loadTile(g,l){const d=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),v={request:this.map._requestManager.transformRequest(d,s.a2.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:g.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(g.actor&&g.state!=="expired")if(g.state==="loading")g.reloadCallback=l;else{if(g.buckets){const S=Object.values(g.buckets);for(const A of S)A.dirty=!0;return void(g.state="loaded")}g.request=g.actor.send("reloadTile",v,w.bind(this))}else g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",v,w.bind(this),void 0,!0);function w(S,A){return g.aborted?l(null):S&&S.status!==404?l(S):(A&&(A.resourceTiming&&(g.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&g.setExpiryData(A),g.buckets={...g.buckets,...A.buckets}),g.state="loaded",void l(null))}}serialize(){return s.ak({},this._options)}},canvas:class extends s.aK{constructor(g,l,d,v){super(g,l,d,v),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(w=>!Array.isArray(w)||w.length!==2||w.some(S=>typeof S!="number"))||this.fire(new s.a7(new s.aM(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.a7(new s.aM(`sources.${g}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new s.a7(new s.aM(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new s.a7(new s.aM(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.a7(new s.aM(`sources.${g}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.a7(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const l=this.map.painter.context;this.texture?!g&&!this._playing||this.texture instanceof s.aN||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.a9(l,this.canvas,l.gl.RGBA,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends s.a6{constructor(g,l,d,v){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=l,this.setEventedParent(v),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.a7(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.a7(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new fo(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),s.ak(this,s.p(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.p(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this._map=g,this._loaded=!1,this.fire(new s.a8("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:l,y:d,z:v}=g.canonical;return this._implementation.hasTile({x:l,y:d,z:v})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,l){const{x:d,y:v,z:w}=g.tileID.canonical,S=new AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:d,y:v,z:w},{signal:S.signal})).then((function(A){return delete g.request,g.aborted?(g.state="unloaded",l(null)):A===void 0?(g.state="errored",l(null)):A===null?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",l(null)):function(C){return C instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof ImageBitmap||C instanceof HTMLImageElement}(A)?(this.loadTileData(g,A),g.state="loaded",void l(null)):(g.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(A=>{A.code!==20&&(g.state="errored",l(A))}),g.request.cancel=()=>S.abort()}loadTileData(g,l){g.setTexture(l,this._map.painter)}unloadTile(g,l){if(g.texture&&g.texture instanceof s.a9?(g.destroy(!0),g.texture&&g.texture instanceof s.a9&&this._map.painter.saveTileTexture(g.texture)):g.destroy(),this._implementation.unloadTile){const{x:d,y:v,z:w}=g.tileID.canonical;this._implementation.unloadTile({x:d,y:v,z:w})}l()}abortTile(g,l){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),l()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){const g=s.aE(this.id,this.scope);this._map.style.clearSource(g)}_update(){this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))}}},ss=function(g,l,d,v){const w=new vs[l.type](g,l,d,v);if(w.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${w.id}`);return s.aR(["load","abort","unload","serialize","prepare"],w),w};function vr(g,l){const d=s.m.identity([]);return s.m.scale(d,d,[.5*g.width,.5*-g.height,1]),s.m.translate(d,d,[1,-1,0]),s.m.multiply(d,d,g.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(d)}function as(g,l,d,v,w,S,A,C=!1){const R=g.tilesIn(v,A,C);R.sort(Uo);const B=[];for(const H of R)B.push({wrappedTileID:H.tile.tileID.wrapped().key,queryResults:H.tile.queryRenderedFeatures(l,d,g._state,H,w,S,vr(g.transform,H.tile.tileID),C)});const U=function(H){const Z={},K={};for(const Q of H){const te=Q.queryResults,ee=Q.wrappedTileID,$=K[ee]=K[ee]||{};for(const le in te){const _e=te[le],ye=$[le]=$[le]||{},oe=Z[le]=Z[le]||[];for(const he of _e)ye[he.featureIndex]||(ye[he.featureIndex]=!0,oe.push(he))}}return Z}(B);for(const H in U)U[H].forEach(Z=>{const K=Z.feature,Q=K.layer;Q&&Q.type!=="background"&&Q.type!=="sky"&&Q.type!=="slot"&&(K.source=Q.source,Q["source-layer"]&&(K.sourceLayer=Q["source-layer"]),K.state=K.id!==void 0?g.getFeatureState(Q["source-layer"],K.id):{})});return U}function Uh(g,l){const d=g.getRenderableIds().map(S=>g.getTileByID(S)),v=[],w={};for(let S=0;S<d.length;S++){const A=d[S],C=A.tileID.canonical.key;w[C]||(w[C]=!0,A.querySourceFeatures(v,l))}return v}function Uo(g,l){const d=g.tileID,v=l.tileID;return d.overscaledZ-v.overscaledZ||d.canonical.y-v.canonical.y||d.wrap-v.wrap||d.canonical.x-v.canonical.x}class yu{constructor(l){this.style=l}processLayersChanged(){this.layers=[];for(const l in this.style._mergedLayers){const d=this.style._mergedLayers[l];if(d.type==="fill-extrusion")this.layers.push(d);else if(d.type==="model"){const v=this.style.getLayerSource(d);v&&v.type==="batched-model"&&this.layers.push(d)}}}updateZOffset(l,d){this.currentBuildingBuckets=[];for(let w=0;w<this.layers.length;++w){const S=this.layers[w],A=this.style.getLayerSourceCache(S);let C=1;S.type==="fill-extrusion"&&(C=S.paint.get("fill-extrusion-opacity")>0?S.paint.get("fill-extrusion-vertical-scale"):0);let R=A?A.getTile(d):null;if(!R&&A&&d.canonical.z>A.getSource().minzoom){let B=d.scaledTo(Math.min(A.getSource().maxzoom,d.overscaledZ-1));for(;B.overscaledZ>=A.getSource().minzoom&&(R=A.getTile(B),!R&&B.overscaledZ!==0);)B=B.scaledTo(B.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:R?R.getBucket(S):null,tileID:R?R.tileID:d,verticalScale:C})}l.hasAnyZOffset=!1;let v=!1;for(let w=0;w<l.symbolInstances.length;w++){const S=l.symbolInstances.get(w),A=S.zOffset,C=this._getHeightAtTileOffset(d,S.tileAnchorX,S.tileAnchorY);S.zOffset=C!==-1?C:A,v||A===S.zOffset||(v=!0),l.hasAnyZOffset||S.zOffset===0||(l.hasAnyZOffset=!0)}v&&(l.zOffsetBuffersNeedUpload=!0,l.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(l,d,v,w){let S=d,A=v;if(l.canonical.z!==w.canonical.z){const C=w.canonical,R=1/(1<<l.canonical.z-C.z);S=(d+l.canonical.x*s.J)*R-C.x*s.J|0,A=(v+l.canonical.y*s.J)*R-C.y*s.J|0}return{tileX:S,tileY:A}}_getHeightAtTileOffset(l,d,v){let w,S;for(let A=0;A<this.layers.length;++A){if(this.layers[A].type!=="fill-extrusion")continue;const{bucket:C,tileID:R,verticalScale:B}=this.currentBuildingBuckets[A];if(!C)continue;const{tileX:U,tileY:H}=this._mapCoordToOverlappingTile(l,d,v,R),Z=C.getHeightAtTileCoord(U,H);Z&&Z.height!==void 0&&(Z.hidden?w=Z.height:S=Math.max(Z.height*B,S||0))}if(S!==void 0)return S;for(let A=0;A<this.layers.length;++A){if(this.layers[A].type!=="model")continue;const{bucket:C,tileID:R}=this.currentBuildingBuckets[A];if(!C)continue;const{tileX:B,tileY:U}=this._mapCoordToOverlappingTile(l,d,v,R),H=C.getHeightAtTileCoord(B,U);if(H&&!H.hidden)return H.height===void 0&&w!==void 0?Math.min(H.maxHeight,w)*H.verticalScale:(H.height||0)*H.verticalScale}return-1}}function af(g,l){const d={};for(const v in g)v!=="ref"&&(d[v]=g[v]);return s.aS.forEach(v=>{v in l&&(d[v]=l[v])}),d}function wa(g){g=g.slice();const l=Object.create(null);for(let d=0;d<g.length;d++)l[g[d].id]=g[d];for(let d=0;d<g.length;d++)"ref"in g[d]&&(g[d]=af(g[d],l[g[d].ref]));return g}const gt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function D(g,l,d){d.push({command:gt.addSource,args:[g,l[g]]})}function G(g,l,d){l.push({command:gt.removeSource,args:[g]}),d[g]=!0}function ae(g,l,d,v){G(g,d,v),D(g,l,d)}function Te(g,l,d){let v;for(v in g[d])if(g[d].hasOwnProperty(v)&&v!=="data"&&!M(g[d][v],l[d][v]))return!1;for(v in l[d])if(l[d].hasOwnProperty(v)&&v!=="data"&&!M(g[d][v],l[d][v]))return!1;return!0}function Me(g,l,d,v,w,S){let A;for(A in l=l||{},g=g||{})g.hasOwnProperty(A)&&(M(g[A],l[A])||d.push({command:S,args:[v,A,l[A],w]}));for(A in l)l.hasOwnProperty(A)&&!g.hasOwnProperty(A)&&(M(g[A],l[A])||d.push({command:S,args:[v,A,l[A],w]}))}function Oe(g){return g.id}function Ge(g,l){return g[l.id]=l,g}class Gt{constructor(l,d){this.reset(l,d)}reset(l,d){this.points=l||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=s.c(l,0,1);let d=1,v=this._distances[d];const w=l*this.paddedLength+this.padding;for(;v<w&&d<this._distances.length;)v=this._distances[++d];const S=d-1,A=this._distances[S],C=v-A,R=C>0?(w-A)/C:0;return this.points[S].mult(1-R).add(this.points[d].mult(R))}}class Ht{constructor(l,d,v){const w=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(l/v),this.yCellCount=Math.ceil(d/v);for(let A=0;A<this.xCellCount*this.yCellCount;A++)w.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=d,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,d,v,w,S){this._forEachCell(d,v,w,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(d),this.bboxes.push(v),this.bboxes.push(w),this.bboxes.push(S)}insertCircle(l,d,v,w){this._forEachCell(d-w,v-w,d+w,v+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(d),this.circles.push(v),this.circles.push(w)}_insertBoxCell(l,d,v,w,S,A){this.boxCells[S].push(A)}_insertCircleCell(l,d,v,w,S,A){this.circleCells[S].push(A)}_query(l,d,v,w,S,A){if(v<0||l>this.width||w<0||d>this.height)return!S&&[];const C=[];if(l<=0&&d<=0&&this.width<=v&&this.height<=w){if(S)return!0;for(let R=0;R<this.boxKeys.length;R++)C.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const B=this.circles[3*R],U=this.circles[3*R+1],H=this.circles[3*R+2];C.push({key:this.circleKeys[R],x1:B-H,y1:U-H,x2:B+H,y2:U+H})}return A?C.filter(A):C}return this._forEachCell(l,d,v,w,this._queryCell,C,{hitTest:S,seenUids:{box:{},circle:{}}},A),S?C.length>0:C}_queryCircle(l,d,v,w,S){const A=l-v,C=l+v,R=d-v,B=d+v;if(C<0||A>this.width||B<0||R>this.height)return!w&&[];const U=[];return this._forEachCell(A,R,C,B,this._queryCellCircle,U,{hitTest:w,circle:{x:l,y:d,radius:v},seenUids:{box:{},circle:{}}},S),w?U.length>0:U}query(l,d,v,w,S){return this._query(l,d,v,w,!1,S)}hitTest(l,d,v,w,S){return this._query(l,d,v,w,!0,S)}hitTestCircle(l,d,v,w){return this._queryCircle(l,d,v,!0,w)}_queryCell(l,d,v,w,S,A,C,R){const B=C.seenUids,U=this.boxCells[S];if(U!==null){const Z=this.bboxes;for(const K of U)if(!B.box[K]){B.box[K]=!0;const Q=4*K;if(l<=Z[Q+2]&&d<=Z[Q+3]&&v>=Z[Q+0]&&w>=Z[Q+1]&&(!R||R(this.boxKeys[K]))){if(C.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[K],x1:Z[Q],y1:Z[Q+1],x2:Z[Q+2],y2:Z[Q+3]})}}}const H=this.circleCells[S];if(H!==null){const Z=this.circles;for(const K of H)if(!B.circle[K]){B.circle[K]=!0;const Q=3*K;if(this._circleAndRectCollide(Z[Q],Z[Q+1],Z[Q+2],l,d,v,w)&&(!R||R(this.circleKeys[K]))){if(C.hitTest)return A.push(!0),!0;{const te=Z[Q],ee=Z[Q+1],$=Z[Q+2];A.push({key:this.circleKeys[K],x1:te-$,y1:ee-$,x2:te+$,y2:ee+$})}}}}}_queryCellCircle(l,d,v,w,S,A,C,R){const B=C.circle,U=C.seenUids,H=this.boxCells[S];if(H!==null){const K=this.bboxes;for(const Q of H)if(!U.box[Q]){U.box[Q]=!0;const te=4*Q;if(this._circleAndRectCollide(B.x,B.y,B.radius,K[te+0],K[te+1],K[te+2],K[te+3])&&(!R||R(this.boxKeys[Q])))return A.push(!0),!0}}const Z=this.circleCells[S];if(Z!==null){const K=this.circles;for(const Q of Z)if(!U.circle[Q]){U.circle[Q]=!0;const te=3*Q;if(this._circlesCollide(K[te],K[te+1],K[te+2],B.x,B.y,B.radius)&&(!R||R(this.circleKeys[Q])))return A.push(!0),!0}}}_forEachCell(l,d,v,w,S,A,C,R){const B=this._convertToXCellCoord(l),U=this._convertToYCellCoord(d),H=this._convertToXCellCoord(v),Z=this._convertToYCellCoord(w);for(let K=B;K<=H;K++)for(let Q=U;Q<=Z;Q++)if(S.call(this,l,d,v,w,this.xCellCount*Q+K,A,C,R))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,d,v,w,S,A){const C=w-l,R=S-d,B=v+A;return B*B>C*C+R*R}_circleAndRectCollide(l,d,v,w,S,A,C){const R=(A-w)/2,B=Math.abs(l-(w+R));if(B>R+v)return!1;const U=(C-S)/2,H=Math.abs(d-(S+U));if(H>U+v)return!1;if(B<=R||H<=U)return!0;const Z=B-R,K=H-U;return Z*Z+K*K<=v*v}}const Nt=100;class _i{constructor(l,d,v=new Ht(l.width+200,l.height+200,25),w=new Ht(l.width+200,l.height+200,25)){this.transform=l,this.grid=v,this.ignoredGrid=w,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Nt,this.screenBottomBoundary=l.height+Nt,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=d}placeCollisionBox(l,d,v,w,S,A,C,R){let B=v.projectedAnchorX,U=v.projectedAnchorY,H=v.projectedAnchorZ;const Z=v.elevation,K=v.tileID,Q=l.getProjection();if(Z&&K){const[he,ve,Ee]=Q.upVector(K.canonical,v.tileAnchorX,v.tileAnchorY),xe=Q.upVectorScale(K.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;B+=he*Z*xe,U+=ve*Z*xe,H+=Ee*Z*xe}const te=this.projectAndGetPerspectiveRatio(C,B,U,H,v.tileID,Q.name==="globe"||!!Z||this.transform.pitch>0,Q),ee=A*te.perspectiveRatio,$=(v.x1*d+w.x-v.padding)*ee+te.point.x,le=(v.y1*d+w.y-v.padding)*ee+te.point.y,_e=(v.x2*d+w.x+v.padding)*ee+te.point.x,ye=(v.y2*d+w.y+v.padding)*ee+te.point.y,oe=te.perspectiveRatio<=.55||te.occluded;return!this.isInsideGrid($,le,_e,ye)||!S&&this.grid.hitTest($,le,_e,ye,R)||oe?{box:[],offscreen:!1,occluded:te.occluded}:{box:[$,le,_e,ye],offscreen:this.isOffscreen($,le,_e,ye),occluded:!1}}placeCollisionCircles(l,d,v,w,S,A,C,R,B,U,H,Z,K,Q,te){const ee=[],$=this.transform.elevation,le=l.getProjection(),_e=$?$.getAtTileOffsetFunc(te,this.transform.center.lat,this.transform.worldSize,le):null,ye=new s.P(v.tileAnchorX,v.tileAnchorY);let{x:oe,y:he,z:ve}=le.projectTilePoint(ye.x,ye.y,te.canonical);if(_e){const[dt,me,Fe]=_e(ye);oe+=dt,he+=me,ve+=Fe}const Ee=le.name==="globe",xe=this.projectAndGetPerspectiveRatio(C,oe,he,ve,te,Ee||!!$||this.transform.pitch>0,le),{perspectiveRatio:Pe}=xe,ct=(H?A/Pe:A*Pe)/s.aV,je=Pr(oe,he,ve,R),et=xe.signedDistanceFromCamera>0?Dt(ct,S,v.lineOffsetX*ct,v.lineOffsetY*ct,!1,je,ye,v,w,R,{},$&&!H?_e:null,H&&!!$,le,te,H):null;let Le=!1,at=!1,Ke=!0;if(et&&!xe.occluded){const dt=.5*K*Pe+Q,me=new s.P(-100,-100),Fe=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Mt=new Gt,{first:_t,last:oi}=et,Yt=_t.path.length;let pi=[];for(let Ii=Yt-1;Ii>=1;Ii--)pi.push(_t.path[Ii]);for(let Ii=1;Ii<oi.path.length;Ii++)pi.push(oi.path[Ii]);const Qt=2.5*dt;B&&(pi=pi.map(([Ii,ui,di],sn)=>(_e&&!Ee&&(di=_e(sn<Yt-1?_t.tilePath[Yt-1-sn]:oi.tilePath[sn-Yt+2])[2]),Pr(Ii,ui,di,B))),pi.some(Ii=>Ii[3]<=0)&&(pi=[]));let Ai=[];if(pi.length>0){let Ii=1/0,ui=-1/0,di=1/0,sn=-1/0;for(const Ni of pi)Ii=Math.min(Ii,Ni[0]),di=Math.min(di,Ni[1]),ui=Math.max(ui,Ni[0]),sn=Math.max(sn,Ni[1]);ui>=me.x&&Ii<=Fe.x&&sn>=me.y&&di<=Fe.y&&(Ai=[pi.map(Ni=>new s.P(Ni[0],Ni[1]))],(Ii<me.x||ui>Fe.x||di<me.y||sn>Fe.y)&&(Ai=s.aT(Ai,me.x,me.y,Fe.x,Fe.y)))}for(const Ii of Ai){Mt.reset(Ii,.25*dt);let ui=0;ui=Mt.length<=.5*dt?1:Math.ceil(Mt.paddedLength/Qt)+1;for(let di=0;di<ui;di++){const sn=di/Math.max(ui-1,1),Ni=Mt.lerp(sn),Hn=Ni.x+Nt,Cn=Ni.y+Nt;ee.push(Hn,Cn,dt,0);const Fo=Hn-dt,As=Cn-dt,Mn=Hn+dt,hn=Cn+dt;if(Ke=Ke&&this.isOffscreen(Fo,As,Mn,hn),at=at||this.isInsideGrid(Fo,As,Mn,hn),!d&&this.grid.hitTestCircle(Hn,Cn,dt,Z)&&(Le=!0,!U))return{circles:[],offscreen:!1,collisionDetected:Le,occluded:!1}}}}return{circles:!U&&Le||!at?[]:ee,offscreen:Ke,collisionDetected:Le,occluded:xe.occluded}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let v=1/0,w=1/0,S=-1/0,A=-1/0;for(const U of l){const H=new s.P(U.x+Nt,U.y+Nt);v=Math.min(v,H.x),w=Math.min(w,H.y),S=Math.max(S,H.x),A=Math.max(A,H.y),d.push(H)}const C=this.grid.query(v,w,S,A).concat(this.ignoredGrid.query(v,w,S,A)),R={},B={};for(const U of C){const H=U.key;if(R[H.bucketInstanceId]===void 0&&(R[H.bucketInstanceId]={}),R[H.bucketInstanceId][H.featureIndex])continue;const Z=[new s.P(U.x1,U.y1),new s.P(U.x2,U.y1),new s.P(U.x2,U.y2),new s.P(U.x1,U.y2)];s.aU(d,Z)&&(R[H.bucketInstanceId][H.featureIndex]=!0,B[H.bucketInstanceId]===void 0&&(B[H.bucketInstanceId]=[]),B[H.bucketInstanceId].push(H.featureIndex))}return B}insertCollisionBox(l,d,v,w,S){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:w,collisionGroupID:S},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,d,v,w,S){const A=d?this.ignoredGrid:this.grid,C={bucketInstanceId:v,featureIndex:w,collisionGroupID:S};for(let R=0;R<l.length;R+=4)A.insertCircle(C,l[R],l[R+1],l[R+2])}projectAndGetPerspectiveRatio(l,d,v,w,S,A,C){const R=[d,v,w,1];let B=!1;w||this.transform.pitch>0?(s.e.transformMat4(R,R,l),this.fogState&&S&&C.name!=="globe"&&(B=function(Z,K,Q,te,ee,$){const le=$.calculateFogTileMatrix(ee),_e=[K,Q,te];return s.v.transformMat4(_e,_e,le),ys(Z,s.v.length(_e),$.pitch,$._fov)}(this.fogState,d,v,w,S.toUnwrapped(),this.transform)>.9)):zi(R,R,l);const U=R[3];return{point:new s.P((R[0]/U+1)/2*this.transform.width+Nt,(-R[1]/U+1)/2*this.transform.height+Nt),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/U*.5,1.5),signedDistanceFromCamera:U,occluded:A&&R[2]>U||B}}isOffscreen(l,d,v,w){return v<Nt||l>=this.screenRightBoundary||w<Nt||d>this.screenBottomBoundary}isInsideGrid(l,d,v,w){return v>=0&&l<this.gridRightBoundary&&w>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const l=s.m.identity([]);return s.m.translate(l,l,[-100,-100,0]),l}}function ti(g,l,d){const v=l.createTileMatrix(g,g.worldSize,d.toUnwrapped());return s.m.multiply(new Float32Array(16),g.projMatrix,v)}function Ji(g,l,d){if(l.projection.name===d.projection.name)return g.projMatrix;const v=d.clone();return v.setProjection(l.projection),ti(v,l.getProjection(),g)}function Xn(g,l,d){return l.name===d.projection.name?g.projMatrix:ti(d,l,g)}class tn{constructor(l,d,v,w){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?d:-d))):w&&v?1:0,this.placed=v}isHidden(){return this.opacity===0&&!this.placed}}class pr{constructor(l,d,v,w,S,A=!1){this.text=new tn(l?l.text:null,d,v,S),this.icon=new tn(l?l.icon:null,d,w,S),this.clipped=A}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ot{constructor(l,d,v,w=!1){this.text=l,this.icon=d,this.skipFade=v,this.clipped=w}}class Di{constructor(){this.invProjMatrix=s.m.create(),this.viewportMatrix=s.m.create(),this.circles=[]}}class Ln{constructor(l,d,v,w,S){this.bucketInstanceId=l,this.featureIndex=d,this.sourceLayerIndex=v,this.bucketIndex=w,this.tileID=S}}class Fr{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const d=++this.maxGroupID;this.collisionGroups[l]={ID:d,predicate:v=>v.collisionGroupID===d}}return this.collisionGroups[l]}}function In(g,l,d,v,w){const{horizontalAlign:S,verticalAlign:A}=s.aY(g),C=-(S-.5)*l,R=-(A-.5)*d,B=s.aW(g,v);return new s.P(C+B[0]*w,R+B[1]*w)}function Bn(g,l,d,v,w){const S=new s.P(g,l);return d&&S._rotate(v?w:-w),S}class vu{constructor(l,d,v,w,S,A){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new _i(this.transform,S),this.buildingIndex=A,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Fr(v),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,d,v,w){const S=v.getBucket(d),A=v.latestFeatureIndex;if(!S||!A||d.fqid!==S.layerIds[0])return;const C=S.layers[0].layout,R=v.collisionBoxArray,B=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),U=v.tileSize/s.J,H=v.tileID.toUnwrapped();this.transform.setProjection(S.projection);const Z=(K=v.tileID,Q=S.getProjection(),te=this.transform,Q.name===this.projection?te.calculateProjMatrix(K.toUnwrapped()):ti(te,Q,K));var K,Q,te;const ee=C.get("text-pitch-alignment")==="map",$=C.get("text-rotation-alignment")==="map";d.compileFilter();const le=d.dynamicFilter(),_e=d.dynamicFilterNeedsFeature(),ye=this.transform.calculatePixelsToTileUnitsMatrix(v),oe=Mo(Z,v.tileID.canonical,ee,$,this.transform,S.getProjection(),ye);let he=null;if(ee){const xe=qr(Z,v.tileID.canonical,ee,$,this.transform,S.getProjection(),ye);he=s.m.multiply([],this.transform.labelPlaneMatrix,xe)}let ve=null;le&&v.latestFeatureIndex&&(ve={unwrappedTileID:H,dynamicFilter:le,dynamicFilterNeedsFeature:_e,featureIndex:v.latestFeatureIndex}),this.retainedQueryData[S.bucketInstanceId]=new Ln(S.bucketInstanceId,A,S.sourceLayerIndex,S.index,v.tileID);const Ee={bucket:S,layout:C,posMatrix:Z,textLabelPlaneMatrix:oe,labelToScreenMatrix:he,clippingData:ve,scale:B,textPixelRatio:U,holdingForFade:v.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:s.i(S.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.i(S.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(w)for(const xe of S.sortKeyRanges){const{sortKey:Pe,symbolInstanceStart:ct,symbolInstanceEnd:je}=xe;l.push({sortKey:Pe,symbolInstanceStart:ct,symbolInstanceEnd:je,parameters:Ee})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:Ee})}attemptAnchorPlacement(l,d,v,w,S,A,C,R,B,U,H,Z,K,Q,te,ee,$,le){const{textOffset0:_e,textOffset1:ye,crossTileID:oe}=Z,he=[_e,ye],ve=In(l,v,w,he,S),Ee=this.collisionIndex.placeCollisionBox(Q,S,d,Bn(ve.x,ve.y,A,C,this.transform.angle),H,R,B,U.predicate);if(ee){const xe=Q.getSymbolInstanceIconSize(le,this.transform.zoom,Z.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Q,xe,ee,Bn(ve.x,ve.y,A,C,this.transform.angle),H,R,B,U.predicate).box.length===0)return}if(Ee.box.length>0){let xe;return this.prevPlacement&&this.prevPlacement.variableOffsets[oe]&&this.prevPlacement.placements[oe]&&this.prevPlacement.placements[oe].text&&(xe=this.prevPlacement.variableOffsets[oe].anchor),this.variableOffsets[oe]={textOffset:he,width:v,height:w,anchor:l,textScale:S,prevAnchor:xe},this.markUsedJustification(Q,l,Z,te),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,te,Z),this.placedOrientations[oe]=te),{shift:ve,placedGlyphBoxes:Ee}}}placeLayerBucketPart(l,d,v,w){const{bucket:S,layout:A,posMatrix:C,textLabelPlaneMatrix:R,labelToScreenMatrix:B,clippingData:U,textPixelRatio:H,holdingForFade:Z,collisionBoxArray:K,partiallyEvaluatedTextSize:Q,partiallyEvaluatedIconSize:te,collisionGroup:ee}=l.parameters,$=A.get("text-optional"),le=A.get("icon-optional"),_e=A.get("text-allow-overlap"),ye=A.get("icon-allow-overlap"),oe=A.get("text-rotation-alignment")==="map",he=A.get("text-pitch-alignment")==="map",ve=A.get("symbol-z-order")==="viewport-y",Ee=A.get("symbol-z-elevate");this.transform.setProjection(S.projection);let xe=_e&&(ye||!S.hasIconData()||le),Pe=ye&&(_e||!S.hasTextData()||$);!S.collisionArrays&&K&&S.deserializeCollisionBoxes(K),v&&w&&S.updateCollisionDebugBuffers(this.transform.zoom,K);const ct=(je,et,Le)=>{const{crossTileID:at,numVerticalGlyphVertices:Ke}=je;if(U){const Mn={zoom:this.transform.zoom,pitch:this.transform.pitch};let hn=null;if(U.dynamicFilterNeedsFeature){const _n=this.retainedQueryData[S.bucketInstanceId];hn=U.featureIndex.loadFeature({featureIndex:je.featureIndex,bucketIndex:_n.bucketIndex,sourceLayerIndex:_n.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,U.dynamicFilter)(Mn,hn,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new s.P(je.tileAnchorX,je.tileAnchorY),this.transform.calculateDistanceTileData(U.unwrappedTileID)))return this.placements[at]=new Ot(!1,!1,!1,!0),void d.add(at)}if(d.has(at))return;if(Z)return void(this.placements[at]=new Ot(!1,!1,!1));let dt=!1,me=!1,Fe=!0,Mt=!1,_t=!1,oi=null,Yt={box:null,offscreen:null,occluded:null},pi={box:null,offscreen:null,occluded:null},Qt=null,Ai=null,Ii=null,ui=0,di=0,sn=0;Le.textFeatureIndex?ui=Le.textFeatureIndex:je.useRuntimeCollisionCircles&&(ui=je.featureIndex),Le.verticalTextFeatureIndex&&(di=Le.verticalTextFeatureIndex);const Ni=Mn=>{Mn.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const hn=this.transform.elevation;Mn.elevation=je.zOffset+(hn?hn.getAtTileOffset(Mn.tileID,Mn.tileAnchorX,Mn.tileAnchorY):0)},Hn=Le.textBox;if(Hn){Ni(Hn);const Mn=_n=>{let er=s.W.horizontal;if(S.allowVerticalPlacement&&!_n&&this.prevPlacement){const eo=this.prevPlacement.placedOrientations[at];eo&&(this.placedOrientations[at]=eo,er=eo,this.markUsedOrientation(S,er,je))}return er},hn=(_n,er)=>{if(S.allowVerticalPlacement&&Ke>0&&Le.verticalTextBox){for(const eo of S.writingModes)if(eo===s.W.vertical?(Yt=er(),pi=Yt):Yt=_n(),Yt&&Yt.box&&Yt.box.length)break}else Yt=_n()};if(A.get("text-variable-anchor")){let _n=A.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[at]){const Yn=this.prevPlacement.variableOffsets[at];_n.indexOf(Yn.anchor)>0&&(_n=_n.filter(vo=>vo!==Yn.anchor),_n.unshift(Yn.anchor))}const er=(Yn,vo,Bo)=>{const xo=S.getSymbolInstanceTextSize(Q,je,this.transform.zoom,et),Is=(Yn.x2-Yn.x1)*xo+2*Yn.padding,La=(Yn.y2-Yn.y1)*xo+2*Yn.padding,qs=je.hasIconTextFit&&!ye?vo:null;qs&&Ni(qs);let kn={box:[],offscreen:!1,occluded:!1};const Ws=_e?2*_n.length:_n.length;for(let ua=0;ua<Ws;++ua){const Oa=this.attemptAnchorPlacement(_n[ua%_n.length],Yn,Is,La,xo,oe,he,H,C,ee,ua>=_n.length,je,et,S,Bo,qs,Q,te);if(Oa&&(kn=Oa.placedGlyphBoxes,kn&&kn.box&&kn.box.length)){dt=!0,oi=Oa.shift;break}}return kn};hn(()=>er(Hn,Le.iconBox,s.W.horizontal),()=>{const Yn=Le.verticalTextBox;return Yn&&Ni(Yn),S.allowVerticalPlacement&&!(Yt&&Yt.box&&Yt.box.length)&&Ke>0&&Yn?er(Yn,Le.verticalIconBox,s.W.vertical):{box:null,offscreen:null,occluded:null}}),Yt&&(dt=Yt.box,Fe=Yt.offscreen,Mt=Yt.occluded);const eo=Mn(!(!Yt||!Yt.box));if(!dt&&this.prevPlacement){const Yn=this.prevPlacement.variableOffsets[at];Yn&&(this.variableOffsets[at]=Yn,this.markUsedJustification(S,Yn.anchor,je,eo))}}else{const _n=(er,eo)=>{const Yn=S.getSymbolInstanceTextSize(Q,je,this.transform.zoom,et),vo=this.collisionIndex.placeCollisionBox(S,Yn,er,new s.P(0,0),_e,H,C,ee.predicate);return vo&&vo.box&&vo.box.length&&(this.markUsedOrientation(S,eo,je),this.placedOrientations[at]=eo),vo};hn(()=>_n(Hn,s.W.horizontal),()=>{const er=Le.verticalTextBox;return S.allowVerticalPlacement&&Ke>0&&er?(Ni(er),_n(er,s.W.vertical)):{box:null,offscreen:null,occluded:null}}),Mn(!!(Yt&&Yt.box&&Yt.box.length))}}if(Qt=Yt,dt=Qt&&Qt.box&&Qt.box.length>0,Fe=Qt&&Qt.offscreen,Mt=Qt&&Qt.occluded,je.useRuntimeCollisionCircles){const Mn=S.text.placedSymbolArray.get(je.centerJustifiedTextSymbolIndex>=0?je.centerJustifiedTextSymbolIndex:je.verticalPlacedTextSymbolIndex),hn=s.j(S.textSizeData,Q,Mn),_n=A.get("text-padding");Ai=this.collisionIndex.placeCollisionCircles(S,_e,Mn,S.lineVertexArray,S.glyphOffsetArray,hn,C,R,B,v,he,ee.predicate,je.collisionCircleDiameter*hn/s.aV,_n,this.retainedQueryData[S.bucketInstanceId].tileID),dt=_e||Ai.circles.length>0&&!Ai.collisionDetected,Fe=Fe&&Ai.offscreen,Mt=Ai.occluded}if(Le.iconFeatureIndex&&(sn=Le.iconFeatureIndex),Le.iconBox){const Mn=hn=>{Ni(hn);const _n=je.hasIconTextFit&&oi?Bn(oi.x,oi.y,oe,he,this.transform.angle):new s.P(0,0),er=S.getSymbolInstanceIconSize(te,this.transform.zoom,je.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,er,hn,_n,ye,H,C,ee.predicate)};pi&&pi.box&&pi.box.length&&Le.verticalIconBox?(Ii=Mn(Le.verticalIconBox),me=Ii.box.length>0):(Ii=Mn(Le.iconBox),me=Ii.box.length>0),Fe=Fe&&Ii.offscreen,_t=Ii.occluded}const Cn=$||je.numHorizontalGlyphVertices===0&&Ke===0,Fo=le||je.numIconVertices===0;if(Cn||Fo?Fo?Cn||(me=me&&dt):dt=me&&dt:me=dt=me&&dt,dt&&Qt&&Qt.box&&this.collisionIndex.insertCollisionBox(Qt.box,A.get("text-ignore-placement"),S.bucketInstanceId,pi&&pi.box&&di?di:ui,ee.ID),me&&Ii&&this.collisionIndex.insertCollisionBox(Ii.box,A.get("icon-ignore-placement"),S.bucketInstanceId,sn,ee.ID),Ai&&(dt&&this.collisionIndex.insertCollisionCircles(Ai.circles,A.get("text-ignore-placement"),S.bucketInstanceId,ui,ee.ID),v)){const Mn=S.bucketInstanceId;let hn=this.collisionCircleArrays[Mn];hn===void 0&&(hn=this.collisionCircleArrays[Mn]=new Di);for(let _n=0;_n<Ai.circles.length;_n+=4)hn.circles.push(Ai.circles[_n+0]),hn.circles.push(Ai.circles[_n+1]),hn.circles.push(Ai.circles[_n+2]),hn.circles.push(Ai.collisionDetected?1:0)}const As=S.projection.name!=="globe";xe=xe&&(As||!Mt),Pe=Pe&&(As||!_t),this.placements[at]=new Ot(dt||xe,me||Pe,Fe||S.justReloaded),d.add(at)};if(Ee&&this.buildingIndex&&(this.buildingIndex.updateZOffset(S,this.retainedQueryData[S.bucketInstanceId].tileID),S.updateZOffset()),ve){const je=S.getSortedSymbolIndexes(this.transform.angle);for(let et=je.length-1;et>=0;--et){const Le=je[et];ct(S.symbolInstances.get(Le),Le,S.collisionArrays[Le])}S.hasAnyZOffset&&s.X(`${S.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(S.hasAnyZOffset){const je=S.getSortedIndexesByZOffset();for(let et=0;et<je.length;++et){const Le=je[et];ct(S.symbolInstances.get(Le),Le,S.collisionArrays[Le])}}else for(let je=l.symbolInstanceStart;je<l.symbolInstanceEnd;je++)ct(S.symbolInstances.get(je),je,S.collisionArrays[je]);if(v&&S.bucketInstanceId in this.collisionCircleArrays){const je=this.collisionCircleArrays[S.bucketInstanceId];s.m.invert(je.invProjMatrix,C),je.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(l,d,v,w){const{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:R,crossTileID:B}=v,U=s.aX(d),H=w===s.W.vertical?R:U==="left"?S:U==="center"?A:U==="right"?C:-1;S>=0&&(l.text.placedSymbolArray.get(S).crossTileID=H>=0&&S!==H?0:B),A>=0&&(l.text.placedSymbolArray.get(A).crossTileID=H>=0&&A!==H?0:B),C>=0&&(l.text.placedSymbolArray.get(C).crossTileID=H>=0&&C!==H?0:B),R>=0&&(l.text.placedSymbolArray.get(R).crossTileID=H>=0&&R!==H?0:B)}markUsedOrientation(l,d,v){const w=d===s.W.horizontal||d===s.W.horizontalOnly?d:0,S=d===s.W.vertical?d:0,{leftJustifiedTextSymbolIndex:A,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:B}=v,U=l.text.placedSymbolArray;A>=0&&(U.get(A).placedOrientation=w),C>=0&&(U.get(C).placedOrientation=w),R>=0&&(U.get(R).placedOrientation=w),B>=0&&(U.get(B).placedOrientation=S)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let v=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const w=d?d.symbolFadeChange(l):1,S=d?d.opacities:{},A=d?d.variableOffsets:{},C=d?d.placedOrientations:{};for(const R in this.placements){const B=this.placements[R],U=S[R];U?(this.opacities[R]=new pr(U,w,B.text,B.icon,null,B.clipped),v=v||B.text!==U.text.placed||B.icon!==U.icon.placed):(this.opacities[R]=new pr(null,w,B.text,B.icon,B.skipFade,B.clipped),v=v||B.text||B.icon)}for(const R in S){const B=S[R];if(!this.opacities[R]){const U=new pr(B,w,!1,!1);U.isHidden()||(this.opacities[R]=U,v=v||B.text.placed||B.icon.placed)}}for(const R in A)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=A[R]);for(const R in C)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=C[R]);v?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:l)}updateLayerOpacities(l,d){const v=new Set;for(const w of d){const S=w.getBucket(l);S&&w.latestFeatureIndex&&l.fqid===S.layerIds[0]&&(this.updateBucketOpacities(S,v,w.collisionBoxArray),S.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(S,w.tileID),S.updateZOffset()))}}updateBucketOpacities(l,d,v){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const w=l.layers[0].layout,S=!!l.layers[0].dynamicFilter(),A=new pr(null,0,!1,!1,!0),C=w.get("text-allow-overlap"),R=w.get("icon-allow-overlap"),B=w.get("text-variable-anchor"),U=w.get("text-rotation-alignment")==="map",H=w.get("text-pitch-alignment")==="map",Z=new pr(null,0,C&&(R||!l.hasIconData()||w.get("icon-optional")),R&&(C||!l.hasTextData()||w.get("text-optional")),!0);!l.collisionArrays&&v&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(v);const K=(te,ee,$)=>{for(let le=0;le<ee/4;le++)te.opacityVertexArray.emplaceBack($)};let Q=0;for(let te=0;te<l.symbolInstances.length;te++){const ee=l.symbolInstances.get(te),{numHorizontalGlyphVertices:$,numVerticalGlyphVertices:le,crossTileID:_e,numIconVertices:ye}=ee,oe=d.has(_e);let he=this.opacities[_e];oe?he=A:he||(he=Z,this.opacities[_e]=he),d.add(_e);const ve=$>0||le>0,Ee=ye>0,xe=this.placedOrientations[_e],Pe=xe===s.W.vertical,ct=xe===s.W.horizontal||xe===s.W.horizontalOnly;if(!ve&&!Ee||he.isHidden()||Q++,ve){const je=Sa(he.text);K(l.text,$,Pe?xr:je),K(l.text,le,ct?xr:je);const et=he.text.isHidden(),{leftJustifiedTextSymbolIndex:Le,centerJustifiedTextSymbolIndex:at,rightJustifiedTextSymbolIndex:Ke,verticalPlacedTextSymbolIndex:dt}=ee,me=l.text.placedSymbolArray,Fe=et||Pe?1:0;Le>=0&&(me.get(Le).hidden=Fe),at>=0&&(me.get(at).hidden=Fe),Ke>=0&&(me.get(Ke).hidden=Fe),dt>=0&&(me.get(dt).hidden=et||ct?1:0);const Mt=this.variableOffsets[_e];Mt&&this.markUsedJustification(l,Mt.anchor,ee,xe);const _t=this.placedOrientations[_e];_t&&(this.markUsedJustification(l,"left",ee,_t),this.markUsedOrientation(l,_t,ee))}if(Ee){const je=Sa(he.icon),{placedIconSymbolIndex:et,verticalPlacedIconSymbolIndex:Le}=ee,at=l.icon.placedSymbolArray,Ke=he.icon.isHidden()?1:0;et>=0&&(K(l.icon,ye,Pe?xr:je),at.get(et).hidden=Ke),Le>=0&&(K(l.icon,ee.numVerticalIconVertices,ct?xr:je),at.get(Le).hidden=Ke)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const je=l.collisionArrays[te];if(je){let et=new s.P(0,0),Le=!0;if(je.textBox||je.verticalTextBox){if(B){const Ke=this.variableOffsets[_e];Ke?(et=In(Ke.anchor,Ke.width,Ke.height,Ke.textOffset,Ke.textScale),U&&et._rotate(H?this.transform.angle:-this.transform.angle)):Le=!1}S&&(Le=!he.clipped),je.textBox&&Nn(l.textCollisionBox.collisionVertexArray,he.text.placed,!Le||Pe,et.x,et.y),je.verticalTextBox&&Nn(l.textCollisionBox.collisionVertexArray,he.text.placed,!Le||ct,et.x,et.y)}const at=Le&&!!(!ct&&je.verticalIconBox);je.iconBox&&Nn(l.iconCollisionBox.collisionVertexArray,he.icon.placed,at,ee.hasIconTextFit?et.x:0,ee.hasIconTextFit?et.y:0),je.verticalIconBox&&Nn(l.iconCollisionBox.collisionVertexArray,he.icon.placed,!at,ee.hasIconTextFit?et.x:0,ee.hasIconTextFit?et.y:0)}}}if(l.fullyClipped=Q===0,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const te=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=te.invProjMatrix,l.placementViewportMatrix=te.viewportMatrix,l.collisionCircleArray=te.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,d){const v=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*v>l}setStale(){this.stale=!0}}function Nn(g,l,d,v,w){g.emplaceBack(l?1:0,d?1:0,v||0,w||0),g.emplaceBack(l?1:0,d?1:0,v||0,w||0),g.emplaceBack(l?1:0,d?1:0,v||0,w||0),g.emplaceBack(l?1:0,d?1:0,v||0,w||0)}const po=Math.pow(2,25),jo=Math.pow(2,24),xs=Math.pow(2,17),Ta=Math.pow(2,16),Mr=Math.pow(2,9),$a=Math.pow(2,8),Ol=Math.pow(2,1);function Sa(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const l=g.placed?1:0,d=Math.floor(127*g.opacity);return d*po+l*jo+d*xs+l*Ta+d*Mr+l*$a+d*Ol+l}const xr=0;class xu{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(l,d,v,w,S){const A=this._bucketParts;for(;this._currentTileIndex<l.length;)if(d.getBucketParts(A,w,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((C,R)=>C.sortKey-R.sortKey));this._currentPartIndex<A.length;){const C=A[this._currentPartIndex];if(d.placeLayerBucketPart(C,this._seenCrossTileIDs,v,C.symbolInstanceStart===0),this._currentPartIndex++,S())return!0}return!1}}class bu{constructor(l,d,v,w,S,A,C,R,B){this.placement=new vu(l,S,A,C,R,B),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(l,d,v,w){const S=s.a4.now(),A=()=>{const C=s.a4.now()-S;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=d[l[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=R)&&(!C.maxzoom||C.maxzoom>R)){const B=C,U=B.layout.get("symbol-z-elevate"),H=this._inProgressLayer=this._inProgressLayer||new xu(B),Z=s.aE(C.source,C.scope);if(H.continuePlacement(U?w[Z]:v[Z],this.placement,this._showCollisionBoxes,C,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const ls=512/s.J/2;class Qa{constructor(l,d,v){this.tileID=l,this.bucketInstanceId=v,this.index=new s.aZ(d.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const w=l.canonical.x*s.J,S=l.canonical.y*s.J;for(let A=0;A<d.length;A++){const{key:C,crossTileID:R,tileAnchorX:B,tileAnchorY:U}=d.get(A),H=Math.floor((w+B)*ls),Z=Math.floor((S+U)*ls);this.index.add(H,Z),this.keys.push(C),this.crossTileIDs.push(R)}this.index.finish()}findMatches(l,d,v){const w=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),S=ls/Math.pow(2,d.canonical.z-this.tileID.canonical.z),A=d.canonical.x*s.J,C=d.canonical.y*s.J;for(let R=0;R<l.length;R++){const B=l.get(R);if(B.crossTileID)continue;const{key:U,tileAnchorX:H,tileAnchorY:Z}=B,K=Math.floor((A+H)*S),Q=Math.floor((C+Z)*S),te=this.index.range(K-w,Q-w,K+w,Q+w);for(const ee of te){const $=this.crossTileIDs[ee];if(this.keys[ee]===U&&!v.has($)){v.add($),B.crossTileID=$;break}}}}}class el{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class pn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const d=Math.round((l-this.lng)/360);if(d!==0)for(const v in this.indexes){const w=this.indexes[v],S={};for(const A in w){const C=w[A];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+d),S[C.tileID.key]=C}this.indexes[v]=S}this.lng=l}addBucket(l,d,v){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let S=0;S<d.symbolInstances.length;S++)d.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]=new Set);const w=this.usedCrossTileIDs[l.overscaledZ];for(const S in this.indexes){const A=this.indexes[S];if(Number(S)>l.overscaledZ)for(const C in A){const R=A[C];R.tileID.isChildOf(l)&&R.findMatches(d.symbolInstances,l,w)}else{const C=A[l.scaledTo(Number(S)).key];C&&C.findMatches(d.symbolInstances,l,w)}}for(let S=0;S<d.symbolInstances.length;S++){const A=d.symbolInstances.get(S);A.crossTileID||(A.crossTileID=v.generate(),w.add(A.crossTileID))}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Qa(l,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(l,d){for(const v of d.crossTileIDs)this.usedCrossTileIDs[l].delete(v)}removeStaleBuckets(l){let d=!1;for(const v in this.indexes){const w=this.indexes[v];for(const S in w)l[w[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,w[S]),delete w[S],d=!0)}return d}}class lf{constructor(){this.layerIndexes={},this.crossTileIDs=new el,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,d,v,w){let S=this.layerIndexes[l.fqid];S===void 0&&(S=this.layerIndexes[l.fqid]=new pn);let A=!1;const C={};w.name!=="globe"&&S.handleWrapJump(v);for(const R of d){const B=R.getBucket(l);B&&l.fqid===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),S.addBucket(R.tileID,B,this.crossTileIDs)&&(A=!0),C[B.bucketInstanceId]=!0)}return S.removeStaleBuckets(C)&&(A=!0),A}pruneUnusedLayers(l){const d={};l.forEach(v=>{d[v]=!0});for(const v in this.layerIndexes)d[v]||delete this.layerIndexes[v]}}var Ac=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,cs=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,Ic=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Cc="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Qr=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,wu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Go=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Rl=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);vec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return (texCoord.xxyy+vec2(1.5,0.5).xyxy)/texResolution.xxyy;}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image0,c.yz),texture(u_image0,c.xz),texture(u_image0,c.yw),texture(u_image0,c.xw)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image1,c.yz),texture(u_image1,c.xz),texture(u_image1,c.yw),texture(u_image1,c.xw)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texture(u_image0,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texture(u_image1,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Pc=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,zl=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Fl=[];Fs(Ac,Fl),Fs(Ic,Fl),Fs(cs,Fl);const zs={"_prelude_fog.vertex.glsl":wu,"_prelude_terrain.vertex.glsl":Qr,"_prelude_shadow.vertex.glsl":Pc,"_prelude_fog.fragment.glsl":Go,"_prelude_shadow.fragment.glsl":zl,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Rl},ia={};Ki("",Qr),Ki(Go,wu),Ki(zl,Pc),Ki(Rl,"");const na=Ki(cs,Ic),ra=Ac;var Tu={background:Ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ki("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ki(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ki(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ki("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ki("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ki("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ki(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ki(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ki(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;HANDLE_WIREFRAME_DEBUG;
#endif
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ki(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),symbolIcon:Ki(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:Ki(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Ki(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Ki("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ki(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Cc),skyboxGradient:Ki(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Cc),skyboxCapture:Ki(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ki(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ki(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ki(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function Fs(g,l){const d=g.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let v of d)if(v=v.trim(),v[0]==="#"&&v.includes("if")&&!v.includes("endif")){v=v.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const w=v.split(" ");for(const S of w)l.includes(S)||l.push(S)}}function Ki(g,l){const d=/#include\s+"([^"]+)"/g,v=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let w=l.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);w&&(w=w.map(B=>{const U=B.split(" ");return U[U.length-1]}),w=[...new Set(w)]);const S={},A=[],C=[];if(g=g.replace(d,(B,U)=>(C.push(U),"")),(l=l.replace(d,(B,U)=>(A.push(U),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let R=[...Fl];Fs(g,R),Fs(l,R);for(const B of[...A,...C])zs[B]||console.error(`Undefined include: ${B}`),ia[B]||(ia[B]=[],Fs(zs[B],ia[B])),R=[...R,...ia[B]];return{fragmentSource:g=g.replace(v,(B,U,H,Z,K)=>(S[K]=!0,U==="define"?`
#ifndef HAS_UNIFORM_u_${K}
in ${H} ${Z} ${K};
#else
uniform ${H} ${Z} u_${K};
#endif
`:U==="initialize"?`
#ifdef HAS_UNIFORM_u_${K}
    ${H} ${Z} ${K} = u_${K};
#endif
`:U==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    in ${H} ${Z} ${K};
#endif
`:U==="initialize-attribute"?"":void 0)),vertexSource:l=l.replace(v,(B,U,H,Z,K)=>{const Q=Z==="float"?"vec2":Z,te=K.match(/color/)?"color":Q;return U==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${K}
in ${H} ${Z} a_${K};
#endif
`:S[K]?U==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
in ${H} ${Q} a_${K};
out ${H} ${Z} ${K};
#else
uniform ${H} ${Z} u_${K};
#endif
`:U==="initialize"?te==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = a_${K};
#else
    ${H} ${Z} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = unpack_mix_${te}(a_${K}, u_${K}_t);
#else
    ${H} ${Z} ${K} = u_${K};
#endif
`:U==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    in ${H} ${Z} a_${K};
    out ${H} ${Z} ${K};
#endif
`:U==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    ${K} = a_${K};
#endif
`:void 0:U==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
in ${H} ${Q} a_${K};
#else
uniform ${H} ${Z} u_${K};
#endif
`:U==="define-instanced"?te==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${K}0;
in vec4 a_${K}1;
in vec4 a_${K}2;
in vec4 a_${K}3;
#else
uniform ${H} ${Z} u_${K};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${H} ${Q} a_${K};
#else
uniform ${H} ${Z} u_${K};
#endif
`:U==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    ${H} ${Z} ${K} = a_${K};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${H} ${Z} ${K} = a_${K};
#else
    ${H} ${Z} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${H} ${Z} ${K} = unpack_mix_${te}(a_${K}, u_${K}_t);
#else
    ${H} ${Z} ${K} = u_${K};
#endif
`}),staticAttributes:w,usedDefines:R,vertexIncludes:A,fragmentIncludes:C}}class Bl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,d,v,w,S,A,C,R){this.context=l;let B=this.boundPaintVertexBuffers.length!==w.length;for(let H=0;!B&&H<w.length;H++)this.boundPaintVertexBuffers[H]!==w[H]&&(B=!0);let U=this.boundDynamicVertexBuffers.length!==C.length;for(let H=0;!U&&H<C.length;H++)this.boundDynamicVertexBuffers[H]!==C[H]&&(U=!0);if(!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==v||B||U||this.boundIndexBuffer!==S||this.boundVertexOffset!==A)this.freshBind(d,v,w,S,A,C,R);else{l.bindVertexArrayOES.set(this.vao);for(const H of C)H&&(H.bind(),R&&H.instanceCount&&H.setVertexAttribDivisor(l.gl,d,R));S&&S.dynamicDraw&&S.bind()}}freshBind(l,d,v,w,S,A,C){const R=l.numAttributes,B=this.context,U=B.gl;this.vao&&this.destroy(),this.vao=B.gl.createVertexArray(),B.bindVertexArrayOES.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=w,this.boundVertexOffset=S,this.boundDynamicVertexBuffers=A,d.enableAttributes(U,l),d.bind(),d.setVertexAttribPointers(U,l,S);for(const H of v)H.enableAttributes(U,l),H.bind(),H.setVertexAttribPointers(U,l,S);for(const H of A)H&&(H.enableAttributes(U,l),H.bind(),H.setVertexAttribPointers(U,l,S),C&&H.instanceCount&&H.setVertexAttribDivisor(U,l,C));w&&w.bind(),B.currentNumAttributes=R}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Su(g,l){const d=Math.pow(2,l.canonical.z),v=l.canonical.y;return[new s.M(0,v/d).toLngLat().lat,new s.M(0,(v+1)/d).toLngLat().lat]}function Mu(g,l,d,v,w,S,A){const C=g.context,R=C.gl,B=d.hillshadeFBO;if(!B)return;g.prepareDrawTile();const U=g.isTileAffectedByFog(l),H=g.getOrCreateProgram("hillshade",{overrideFog:U});C.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,B.colorAttachment.get());const Z=((ee,$,le,_e)=>{const ye=le.paint.get("hillshade-shadow-color"),oe=le.paint.get("hillshade-highlight-color"),he=le.paint.get("hillshade-accent-color"),ve=le.paint.get("hillshade-emissive-strength");let Ee=s.d(le.paint.get("hillshade-illumination-direction"));if(le.paint.get("hillshade-illumination-anchor")==="viewport")Ee-=ee.transform.angle;else if(ee.style&&ee.style.enable3dLights()&&ee.style.directionalLight){const Pe=ee.style.directionalLight.properties.get("direction"),ct=s.b3(Pe.x,Pe.y,Pe.z);Ee=s.d(ct[1])}const xe=!ee.options.moving;return{u_matrix:_e||ee.transform.calculateProjMatrix($.tileID.toUnwrapped(),xe),u_image:0,u_latrange:Su(0,$.tileID),u_light:[le.paint.get("hillshade-exaggeration"),Ee],u_shadow:ye,u_highlight:oe,u_emissive_strength:ve,u_accent:he}})(g,d,v,g.terrain?l.projMatrix:null);g.uploadCommonUniforms(C,H,l.toUnwrapped());const{tileBoundsBuffer:K,tileBoundsIndexBuffer:Q,tileBoundsSegments:te}=g.getTileBoundsBuffers(d);H.draw(g,R.TRIANGLES,w,S,A,s.b5.disabled,Z,v.id,K,Q,te)}function Nl(g,l,d){if(!l.needsDEMTextureUpload)return;const v=g.context,w=v.gl;v.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||g.getTileTexture(d.stride);const S=d.getPixels();l.demTexture?l.demTexture.update(S,{premultiply:!1}):l.demTexture=new s.a9(v,S,w.R32F,{premultiply:!1}),l.needsDEMTextureUpload=!1}function Vl(g,l,d){const v=g.context,w=v.gl;if(!l.dem)return;const S=l.dem;if(v.activeTexture.set(w.TEXTURE1),Nl(g,l,S),!l.demTexture)return;l.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);const A=S.dim;v.activeTexture.set(w.TEXTURE0);let C=l.hillshadeFBO;if(!C){const Z=new s.a9(v,{width:A,height:A,data:null},w.RGBA);Z.bind(w.LINEAR,w.CLAMP_TO_EDGE),C=l.hillshadeFBO=v.createFramebuffer(A,A,!0,"renderbuffer"),C.colorAttachment.set(Z.texture)}v.bindFramebuffer.set(C.framebuffer),v.viewport.set([0,0,A,A]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:B,tileBoundsSegments:U}=g.getMercatorTileBoundsBuffers(),H=[];g.linearFloatFilteringSupported()&&H.push("TERRAIN_DEM_FLOAT_FORMAT"),g.getOrCreateProgram("hillshadePrepare",{defines:H}).draw(g,w.TRIANGLES,s.b4.disabled,s.b6.disabled,s.a.unblended,s.b5.disabled,((Z,K)=>{const Q=K.stride,te=s.m.create();return s.m.ortho(te,0,s.J,-s.J,0,0,1),s.m.translate(te,te,[0,-s.J,0]),{u_matrix:te,u_image:1,u_dimension:[Q,Q],u_zoom:Z.overscaledZ}})(l.tileID,S),d.id,R,B,U),l.needsHillshadePrepare=!1}const kc=g=>({u_matrix:new s.a_(g),u_image0:new s.a$(g),u_skirt_height:new s.b2(g),u_ground_shadow_factor:new s.b7(g)}),Eu=(g,l,d)=>({u_matrix:g,u_image0:0,u_skirt_height:l,u_ground_shadow_factor:d}),Au=(g,l,d,v,w,S,A,C,R,B,U,H,Z,K,Q)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(v),u_merc_matrix:d,u_zoom_transition:w,u_merc_center:S,u_image0:0,u_frustum_tl:A,u_frustum_tr:C,u_frustum_br:R,u_frustum_bl:B,u_globe_pos:U,u_globe_radius:H,u_viewport:Z,u_grid_matrix:Q?Float32Array.from(Q):new Float32Array(9),u_skirt_height:K}),Ma=(g,l)=>{if(l>0&&g.terrain&&s.X("Cutoff is currently disabled on terrain"),l<=0||g.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const d=g.transform,v=Math.max(Math.abs(d._zoom-(g.minCutoffZoom-1)),1),w=d.isLODDisabled(!1)?s.an(60,45,d.pitch):s.an(30,15,d.pitch),S=d._farZ-d._nearZ,A=l*d.height,C=((1-(R=w))*d.cameraToCenterDistance+R*(d._farZ+A))*v;var R;return{shouldRenderCutoff:w<1,uniformValues:{u_cutoff_params:[d._nearZ,d._farZ,(C-d._nearZ)/S,(C-A-d._nearZ)/S]}}};function Iu(g,l){return g!=null&&l!=null&&!(!g.hasData()||!l.hasData())&&g.demTexture!=null&&l.demTexture!=null&&g.tileID.key!==l.tileID.key}const us=new class{constructor(){this.operations={}}newMorphing(g,l,d,v,w){if(g in this.operations){const S=this.operations[g];S.to.tileID.key!==d.tileID.key&&(S.queued=d)}else this.operations[g]={startTime:v,phase:0,duration:w,from:l,to:d,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const l=this.operations[g];return{from:l.from,to:l.to,phase:l.phase}}update(g){for(const l in this.operations){const d=this.operations[l];for(d.phase=(g-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,g)){delete this.operations[l];break}}}_nextOp(g,l){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=l,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},tl={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Bs(g,l,d){if(l===0)return 0;const v=l<1&&d===514?.25/l:1;return 6*Math.pow(1.5,22-g)*Math.max(l,1)*v}function hs(g,l){const d=1<<g.z;return!l&&(g.x===0||g.x===d-1)||g.y===0||g.y===d-1}const bs=g=>({u_matrix:g});function Ea(g,l,d,v,w){if(w>0){const S=s.a4.now(),A=(S-g.timeAdded)/w,C=l?(S-l.timeAdded)/w:-1,R=d.getSource(),B=v.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),U=!l||Math.abs(l.tileID.overscaledZ-B)>Math.abs(g.tileID.overscaledZ-B),H=U&&g.refreshedUponExpiration?1:s.c(U?A:1-C,0,1);return g.refreshedUponExpiration&&A>=1&&(g.refreshedUponExpiration=!1),l?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}class Lt extends s.bq{constructor(l){const d={type:"raster-dem",maxzoom:l.transform.maxZoom},v=new s.br(s.bs(),null),w=ss("mock-dem",d,v,l.style);super("mock-dem",w,!1),w.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,d){l.state="loaded",d(null)}}class jh extends s.bq{constructor(l){const d=ss("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new s.br(s.bs(),null),l.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,d,v){if(l.freezeTileCoverage)return;this.transform=l;const w=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((S,A)=>{if(S[A.key]="",!this._tiles[A.key]){const C=new s.bt(A,this._source.tileSize*A.overscaleFactor(),l.tileZoom);C.state="loaded",this._tiles[A.key]=C}return S},{});for(const S in this._tiles)S in w||(this.freeFBO(S),this._tiles[S].unloadVectorData(),delete this._tiles[S])}freeFBO(l){const d=this.proxyCachedFBO[l];if(d!==void 0){const v=Object.values(d);this.renderCachePool.push(...v),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Aa extends s.O{constructor(l,d,v){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=d,this.projMatrix=v}}class Ia extends s.bk{constructor(l,d){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},l.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[v,w,S]=function(R){const B=new s.bo,U=new s.bp,H=131;B.reserve(17161),U.reserve(33800);const Z=s.J/128,K=s.J+Z/2,Q=K+Z;for(let ee=-Z;ee<Q;ee+=Z)for(let $=-Z;$<Q;$+=Z){const le=$<0||$>K||ee<0||ee>K?24575:0,_e=s.c(Math.round($),0,s.J),ye=s.c(Math.round(ee),0,s.J);B.emplaceBack(_e+le,ye)}const te=(ee,$)=>{const le=$*H+ee;U.emplaceBack(le+1,le,le+H),U.emplaceBack(le+H,le+H+1,le+1)};for(let ee=1;ee<129;ee++)for(let $=1;$<129;$++)te($,ee);return[0,129].forEach(ee=>{for(let $=0;$<130;$++)te($,ee),te(ee,$)}),[B,U,32768]}(),A=l.context;this.gridBuffer=A.createVertexBuffer(v,s.bl.members),this.gridIndexBuffer=A.createIndexBuffer(w),this.gridSegments=s.bm.simpleSegment(0,0,v.length,w.length),this.gridNoSkirtSegments=s.bm.simpleSegment(0,0,v.length,S),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new jh(d.map),this.orthoMatrix=s.m.create(),s.m.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.J,0,s.J,0,1);const C=A.gl;this._overlapStencilMode=new s.b6({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Lt(d.map),this._pendingGroundEffectLayers=[]}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),this._style=l,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(l,d,v){if(l&&l.terrain){this._style!==l&&(this.style=l,this._evaluationZoom=void 0);const w=l.terrain.properties,S=l.terrain.drapeRenderMode===0,A=l.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.a4.now();const C=l.terrain&&l.terrain.scope,R=w.get("source"),B=S?this._mockSourceCache:l.getSourceCache(R,C);if(!B)return void s.X(`Couldn't find terrain source "${R}".`);if(this.sourceCache=B,this._exaggeration=A?this.calculateExaggeration(d):w.get("exaggeration"),!d.projection.requiresDraping&&A&&this._exaggeration===0)return void this._disable();this.enabled=!0;const U=()=>{this.sourceCache.used&&s.X(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const H=this.getScaledDemTileSize();this.sourceCache.update(d,H,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,U(),this._initializing=!0),U(),d.updateElevation(!0,v),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0,this._previousZoom=d.zoom}else this._disable()}calculateExaggeration(l){const d=this._previousCameraAltitude,v=l.getFreeCameraOptions().position.z/l.pixelsPerMeter*l.worldSize;this._previousCameraAltitude=v;const w=d!=null?v-d:Number.MAX_VALUE;if(Math.abs(w)<2)return this._exaggeration;const S=l.zoom,A=this._style.terrain;if(!this._previousUpdateTimestamp)return A.getExaggeration(S);let C=S-this._previousZoom;const R=this._previousUpdateTimestamp;let B=S;this._evaluationZoom!=null&&(B=this._evaluationZoom,Math.abs(S-B)>.5&&(C=.5*(S-B+C)),C*w<0&&(B+=C)),this._evaluationZoom=B;const U=A.getExaggeration(B),H=U===A.getExaggeration(Math.max(0,B-.1));if(H&&Math.abs(U-this._exaggeration)<.01)return U;let Z=Math.min(.1,.00375*(this._updateTimestamp-R));return(H||U<.1||Math.abs(C)<1e-4)&&(Z=Math.min(.2,4*Z)),s.n(this._exaggeration,U,Z)}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(l){l.coord&&l.dataType==="source"?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):l.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._mergedSourceCaches)this._style._mergedSourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,v=this.painter.transform;this._initializing&&(this._initializing=v._centerAltitude===0&&this.getAtPointOrZero(s.M.fromLngLat(v.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=d.getIds().map(R=>{const B=d.getTileByID(R).tileID;return B.projMatrix=v.calculateProjMatrix(B.toUnwrapped()),B});(function(R,B){const U=B.transform.pointCoordinate(B.transform.getCameraPoint()),H=new s.P(U.x,U.y);R.sort((Z,K)=>{if(K.overscaledZ-Z.overscaledZ)return K.overscaledZ-Z.overscaledZ;const Q=new s.P(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),te=new s.P(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),ee=H.mult(1<<Z.canonical.z);return ee.x-=.5,ee.y-=.5,ee.distSqr(Q)-ee.distSqr(te)})})(w,this.painter);const S=this.proxyToSource||{};this.proxyToSource={},w.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const A=this._style._mergedSourceCaches;for(const R in A){const B=A[R];if(!B.used||(B!==this.sourceCache&&this.resetTileLookupCache(B.id),this._setupProxiedCoordsForOrtho(B,l[R],S),B.usedForTerrain))continue;const U=l[R];B.getSource().reparseOverscaled&&this._assignTerrainTiles(U)}this.proxiedCoords[d.id]=w.map(R=>new Aa(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(S),this.renderingToTexture=!1;const C={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const B=this.terrainTileForTile[R.key];if(!B)continue;const U=B.tileID.key;U in C||(this._visibleDemTiles.push(B),C[U]=U)}}_assignTerrainTiles(l){this._initializing||l.forEach(d=>{if(this.terrainTileForTile[d.key])return;const v=this._findTileCoveringTileID(d,this.sourceCache);v&&(this.terrainTileForTile[d.key]=v)})}_prepareDEMTextures(){const l=this.painter.context,d=l.gl;for(const v in this.terrainTileForTile){const w=this.terrainTileForTile[v],S=w.dem;!S||w.demTexture&&!w.needsDEMTextureUpload||(l.activeTexture.set(d.TEXTURE1),Nl(this.painter,w,S))}}_prepareDemTileUniforms(l,d,v,w){if(!d||d.demTexture==null)return!1;const S=l.tileID.canonical,A=Math.pow(2,d.tileID.canonical.z-S.z),C=w||"";return v[`u_dem_tl${C}`]=[S.x*A%1,S.y*A%1],v[`u_dem_scale${C}`]=A,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const l=this.painter.context,d=l.gl;if(!this._emptyDepthBufferTexture){const v=new s.a5({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.a9(l,v,d.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let l=0;const d=this._visibleDemTiles.reduce((v,w)=>{if(!w.dem)return v;const S=w.dem.tree.minimums[0];return S>0&&l++,v+S},0);return l?d/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,d=l.gl;l.activeTexture.set(d.TEXTURE2);const v=this._getLoadedAreaMinimum(),[w,S]=(()=>{const C=new s.bu({width:1,height:1},new Float32Array([v]));return[d.R32F,C]})();this._emptyDEMTextureDirty=!1;let A=this._emptyDEMTexture;return A?A.update(S,{premultiply:!1}):A=this._emptyDEMTexture=new s.a9(l,S,w,{premultiply:!1}),A}setupElevationDraw(l,d,v){const w=this.painter.context,S=w.gl,A={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};A.u_exaggeration=this.exaggeration();let C=null,R=null,B=1;if(v&&v.morphing&&this._useVertexMorphing){const Z=v.morphing.srcDemTile,K=v.morphing.dstDemTile;B=v.morphing.phase,Z&&K&&(this._prepareDemTileUniforms(l,Z,A,"_prev")&&(R=Z),this._prepareDemTileUniforms(l,K,A)&&(C=K))}const U=Z=>Z&&Z.demTexture&&this.painter.linearFloatFilteringSupported()?S.LINEAR:S.NEAREST,H=Z=>{A.u_dem_size=Z.size[0]===1?1:Z.size[0]-2};if(R&&C)w.activeTexture.set(S.TEXTURE2),C.demTexture.bind(U(C),S.CLAMP_TO_EDGE),w.activeTexture.set(S.TEXTURE4),R.demTexture.bind(U(R),S.CLAMP_TO_EDGE),C.demTexture&&H(C.demTexture),A.u_dem_lerp=B;else{C=this.terrainTileForTile[l.tileID.key],w.activeTexture.set(S.TEXTURE2);const Z=this._prepareDemTileUniforms(l,C,A)?C.demTexture:this.emptyDEMTexture;Z.bind(U(C),S.CLAMP_TO_EDGE),H(Z)}if(w.activeTexture.set(S.TEXTURE3),v&&v.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),this._depthFBO&&(A.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),A.u_depth_size_inv=[1,1]),v&&v.useMeterToDem&&C){const Z=(1<<C.tileID.canonical.z)*s.b(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;A.u_meter_to_dem=Z}if(v&&v.labelPlaneMatrixInv&&(A.u_label_plane_matrix_inv=v.labelPlaneMatrixInv),d.setTerrainUniformValues(w,A),this.painter.transform.projection.name==="globe"){const Z=this.globeUniformValues(this.painter.transform,l.tileID.canonical,v&&v.useDenormalizedUpVectorScale);d.setGlobeUniformValues(w,Z)}}globeUniformValues(l,d,v){const w=l.projection;return{u_tile_tl_up:w.upVector(d,0,0),u_tile_tr_up:w.upVector(d,s.J,0),u_tile_br_up:w.upVector(d,s.J,s.J),u_tile_bl_up:w.upVector(d,0,s.J),u_tile_up_scale:v?s.bn(1):w.upVectorScale(d,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){const d=this.painter,v=this.painter.context;l.length!==0&&(v.bindFramebuffer.set(null),v.viewport.set([0,0,d.width,d.height]),d.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(w,S,A,C,R){if(w.transform.projection.name==="globe")(function(B,U,H,Z,K){const Q=B.context,te=Q.gl;let ee,$;const le=B.transform,_e=s.bb(B,Q,le),ye=(et,Le)=>{if($===Le)return;const at=[tl[Le],"PROJECTION_GLOBE_VIEW"];_e&&at.push("CUSTOM_ANTIALIASING");const Ke=B.isTileAffectedByFog(et);ee=B.getOrCreateProgram("globeRaster",{defines:at,overrideFog:Ke}),$=Le},oe=B.colorModeForRenderPass(),he=new s.b4(te.LEQUAL,s.b4.ReadWrite,B.depthRangeFor3D);us.update(K);const ve=s.bc(le),Ee=[s.E(le.center.lng),s.H(le.center.lat)],xe=B.globeSharedBuffers,Pe=[le.width*s.a4.devicePixelRatio,le.height*s.a4.devicePixelRatio],ct=Float32Array.from(le.globeMatrix),je={useDenormalizedUpVectorScale:!0};{const et=B.transform,Le=Bs(et.zoom,U.exaggeration(),U.sourceCache._source.tileSize);$=-1;const at=te.TRIANGLES;for(const Ke of Z){const dt=H.getTile(Ke),me=s.b6.disabled,Fe=U.prevTerrainTileForTile[Ke.key],Mt=U.terrainTileForTile[Ke.key];Iu(Fe,Mt)&&us.newMorphing(Ke.key,Fe,Mt,K,250),Q.activeTexture.set(te.TEXTURE0),dt.texture&&dt.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE);const _t=us.getMorphValuesForProxy(Ke.key),oi=_t?1:0;_t&&s.bd(je,{morphing:{srcDemTile:_t.from,dstDemTile:_t.to,phase:s.ba(_t.phase)}});const Yt=s.be(Ke.canonical),pi=s.bf(Yt.getCenter().lat),Qt=s.bg(Ke.canonical,Yt,pi,et.worldSize/et._pixelsPerMercatorPixel),Ai=s.bh(s.bi(Ke.canonical)),Ii=Au(et.expandedFarZProjMatrix,ct,ve,Ai,s.ao(et.zoom),Ee,et.frustumCorners.TL,et.frustumCorners.TR,et.frustumCorners.BR,et.frustumCorners.BL,et.globeCenterInViewSpace,et.globeRadius,Pe,Le,Qt);if(ye(Ke,oi),ee&&(U.setupElevationDraw(dt,ee,je),B.uploadCommonUniforms(Q,ee,Ke.toUnwrapped()),xe)){const[ui,di,sn]=xe.getGridBuffers(pi,Le!==0);ee.draw(B,at,he,me,oe,s.b5.backCCW,Ii,"globe_raster",ui,di,sn)}}}if(xe&&(B.renderDefaultNorthPole||B.renderDefaultSouthPole)){const et=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];_e&&et.push("CUSTOM_ANTIALIASING"),ee=B.getOrCreateProgram("globeRaster",{defines:et});for(const Le of Z){const{x:at,y:Ke,z:dt}=Le.canonical,me=Ke===0,Fe=Ke===(1<<dt)-1,[Mt,_t,oi,Yt]=xe.getPoleBuffers(dt,!1);if(Yt&&(me||Fe)){const pi=H.getTile(Le);Q.activeTexture.set(te.TEXTURE0),pi.texture&&pi.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE);let Qt=s.bj(dt,at,le);const Ai=s.bh(s.bi(Le.canonical)),Ii=(ui,di)=>ui.draw(B,te.TRIANGLES,he,s.b6.disabled,oe,s.b5.disabled,Au(le.expandedFarZProjMatrix,Qt,Qt,Ai,0,Ee,le.frustumCorners.TL,le.frustumCorners.TR,le.frustumCorners.BR,le.frustumCorners.BL,le.globeCenterInViewSpace,le.globeRadius,Pe,0),"globe_pole_raster",di,oi,Yt);U.setupElevationDraw(pi,ee,je),B.uploadCommonUniforms(Q,ee,Le.toUnwrapped()),me&&B.renderDefaultNorthPole&&Ii(ee,Mt),Fe&&B.renderDefaultSouthPole&&(Qt=s.m.scale(s.m.create(),Qt,[1,-1,1]),Ii(ee,_t))}}}})(w,S,A,C,R);else{const B=w.context,U=B.gl;let H,Z;const K=w.shadowRenderer,Q=Ma(w,w.longestCutoffRange),te=oe=>{if(Z===oe)return;const he=[];he.push(tl[oe]),Q.shouldRenderCutoff&&he.push("RENDER_CUTOFF"),H=w.getOrCreateProgram("terrainRaster",{defines:he}),Z=oe},ee=w.colorModeForRenderPass(),$=new s.b4(U.LEQUAL,s.b4.ReadWrite,w.depthRangeFor3D);us.update(R);const le=w.transform,_e=Bs(le.zoom,S.exaggeration(),S.sourceCache._source.tileSize);let ye=[0,0,0];if(K){const oe=w.style.directionalLight,he=w.style.ambientLight;oe&&he&&(ye=Wh(oe,he))}{Z=-1;const oe=U.TRIANGLES,[he,ve]=[S.gridIndexBuffer,S.gridSegments];for(const Ee of C){const xe=A.getTile(Ee),Pe=s.b6.disabled,ct=S.prevTerrainTileForTile[Ee.key],je=S.terrainTileForTile[Ee.key];Iu(ct,je)&&us.newMorphing(Ee.key,ct,je,R,250),B.activeTexture.set(U.TEXTURE0),xe.texture&&xe.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const et=us.getMorphValuesForProxy(Ee.key),Le=et?1:0;let at;et&&(at={morphing:{srcDemTile:et.from,dstDemTile:et.to,phase:s.ba(et.phase)}});const Ke=Eu(Ee.projMatrix,hs(Ee.canonical,le.renderWorldCopies)?_e/10:_e,ye);if(te(Le),!H)continue;S.setupElevationDraw(xe,H,at);const dt=Ee.toUnwrapped();K&&K.setupShadows(dt,H),w.uploadCommonUniforms(B,H,dt,null,Q),H.draw(w,oe,$,Pe,ee,s.b5.backCCW,Ke,"terrain_raster",S.gridBuffer,he,ve)}}}}(d,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,d.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(this._drapedRenderBatches.length===0)return l+1;this.renderingToTexture=!0;const d=this.painter,v=this.painter.context,w=this.proxySourceCache,S=this.proxiedCoords[w.id],A=this._drapedRenderBatches.shift(),C=d.style.order,R=[];let B=0;for(const U of S){const H=w.getTileByID(U.proxyTileKey),Z=w.proxyCachedFBO[U.key]?w.proxyCachedFBO[U.key][l]:void 0,K=Z!==void 0?w.renderCache[Z]:this.pool[B++],Q=Z!==void 0;if(H.texture=K.tex,Q&&!K.dirty){R.push(H.tileID);continue}let te;v.bindFramebuffer.set(K.fb.framebuffer),this.renderedToTile=!1,K.dirty&&(v.clear({color:s.C.transparent,stencil:0}),K.dirty=!1);for(let ee=A.start;ee<=A.end;++ee){const $=d.style._mergedLayers[C[ee]];if($.isHidden(d.transform.zoom))continue;const le=d.style.getLayerSourceCache($),_e=le?this.proxyToSource[U.key][le.id]:[U];if(!_e)continue;const ye=_e;v.viewport.set([0,0,K.fb.width,K.fb.height]),te!==(le?le.id:null)&&(this._setupStencil(K,_e,$,le),te=le?le.id:null),d.renderLayer(d,le,$,ye)}if(this._drapedRenderBatches.length===0)for(const ee of this._pendingGroundEffectLayers){const $=d.style._mergedLayers[C[ee]];if($.isHidden(d.transform.zoom))continue;const le=d.style.getLayerSourceCache($),_e=le?this.proxyToSource[U.key][le.id]:[U];if(!_e)continue;const ye=_e;v.viewport.set([0,0,K.fb.width,K.fb.height]),te!==(le?le.id:null)&&(this._setupStencil(K,_e,$,le),te=le?le.id:null),d.renderLayer(d,le,$,ye)}this.renderedToTile?(K.dirty=!0,R.push(H.tileID)):Q||--B,B===5&&(B=0,this.renderToBackBuffer(R))}return this.renderToBackBuffer(R),this.renderingToTexture=!1,v.bindFramebuffer.set(null),v.viewport.set([0,0,d.width,d.height]),A.end+1}postRender(){}isLayerOrderingCorrect(l){const d=l.order.length;let v=-1,w=d;for(let S=0;S<d;++S)this._style.isLayerDraped(l._mergedLayers[l.order[S]])?v=Math.max(v,S):w=Math.min(w,S);return w>v}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{l=Math.min(l,d.dem.tree.minimums[0])}),l===0?l:(l-30)*this._exaggeration}raycast(l,d,v){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(S=>S.dem).map(S=>{const A=S.tileID,C=1<<A.overscaledZ,{x:R,y:B}=A.canonical,U=R/C,H=(R+1)/C,Z=B/C,K=(B+1)/C;return{minx:U,miny:Z,maxx:H,maxy:K,t:S.dem.tree.raycastRoot(U,Z,H,K,l,d,v),tile:S}});w.sort((S,A)=>(S.t!==null?S.t:Number.MAX_VALUE)-(A.t!==null?A.t:Number.MAX_VALUE));for(const S of w){if(S.t==null)return null;const A=S.tile.dem.tree.raycast(S.minx,S.miny,S.maxx,S.maxy,l,d,v);if(A!=null)return A}return null}_createFBO(){const l=this.painter.context,d=l.gl,v=this.drapeBufferSize;l.activeTexture.set(d.TEXTURE0);const w=new s.a9(l,{width:v[0],height:v[1],data:null},d.RGBA);w.bind(d.LINEAR,d.CLAMP_TO_EDGE);const S=l.createFramebuffer(v[0],v[1],!0,null);return S.colorAttachment.set(w.texture),S.depthAttachment=new cn(l,S.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,v[0],v[1]),this._stencilRef=0,S.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):S.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&d.texParameterf(d.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:S,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const l in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const d=this._style._mergedLayers[l],v=d.isHidden(this.painter.transform.zoom);return d.type==="custom"?!v&&d.shouldRedrape():!v&&d.hasTransition()})}_clearLineLayersFromRenderCache(){let l=!1;for(const v of this._style.getSources())if(v instanceof Ne){l=!0;break}if(!l)return;const d={};for(let v=0;v<this._style.order.length;++v){const w=this._style._mergedLayers[this._style.order[v]],S=this._style.getLayerSourceCache(w);if(S&&!d[S.id]&&!w.isHidden(this.painter.transform.zoom)&&w.type==="line"&&w.widthExpression()instanceof s.am){d[S.id]=!0;for(const A of this.proxyCoords){const C=this.proxyToSource[A.key][S.id];if(C)for(const R of C)this._clearRenderCacheForTile(S.id,R)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(const v in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[v]._source instanceof ci){l=!0;break}if(!l)return;const d={};for(let v=0;v<this._style.order.length;++v){const w=this._style._mergedLayers[this._style.order[v]],S=this._style.getLayerSourceCache(w);if(!S||d[S.id]||w.isHidden(this.painter.transform.zoom)||w.type!=="raster")continue;const A=w.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const R=this.proxyToSource[C.key][S.id];if(R)for(const B of R){const U=Ea(S.getTile(B),S.findLoadedParent(B,0),S,this.painter.transform,A);(U.opacity!==1||U.mix!==0)&&this._clearRenderCacheForTile(S.id,B)}}}}_setupDrapedRenderBatches(){const l=this._style.order,d=l.length;if(d===0)return;const v=[];this._pendingGroundEffectLayers=[];let w,S=0,A=this._style._mergedLayers[l[S]];for(;!this._style.isLayerDraped(A)&&A.isHidden(this.painter.transform.zoom)&&++S<d;)A=this._style._mergedLayers[l[S]];for(;S<d;++S){const C=this._style._mergedLayers[l[S]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?w===void 0&&(w=S):(C.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(S),w!==void 0&&(v.push({start:w,end:S-1}),w=void 0)))}if(w!==void 0&&v.push({start:w,end:S-1}),v.length!==0){const C=v[v.length-1];this._pendingGroundEffectLayers.every(R=>R>C.end)||s.X("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=v}_setupRenderCache(l){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const A=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let C=0;C<A.length;++C){const R=Object.values(A[C]);d.renderCachePool.push(...R)}}return}this._clearRasterLayersFromRenderCache();const v=this.proxyCoords,w=this._tilesDirty;for(let A=v.length-1;A>=0;A--){const C=v[A];if(d.getTileByID(C.key),d.proxyCachedFBO[C.key]!==void 0){const R=l[C.key],B=this.proxyToSource[C.key];let U=0;for(const H in B){const Z=B[H],K=R[H];if(!K||K.length!==Z.length||Z.some((Q,te)=>Q!==K[te]||w[H]&&w[H].hasOwnProperty(Q.key))){U=-1;break}++U}for(const H in d.proxyCachedFBO[C.key])d.renderCache[d.proxyCachedFBO[C.key][H]].dirty=U<0||U!==Object.values(R).length}}const S=[...this._drapedRenderBatches];S.sort((A,C)=>C.end-C.start-(A.end-A.start));for(const A of S)for(const C of v){if(d.proxyCachedFBO[C.key])continue;let R=d.renderCachePool.pop();R===void 0&&d.renderCache.length<50&&(R=d.renderCache.length,d.renderCache.push(this._createFBO())),R!==void 0&&(d.proxyCachedFBO[C.key]={},d.proxyCachedFBO[C.key][A.start]=R,d.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(l,d,v,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const S=this.painter.context,A=S.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let C;if(v.isTileClipped())C=d.length,this._overlapStencilMode.test={func:A.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:A.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(S.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,v.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):s.b6.disabled}_renderTileClippingMasks(l,d){const v=this.painter,w=this.painter.context,S=w.gl;v._tileClippingMaskIDs={},w.setColorMode(s.a.disabled),w.setDepthMode(s.b4.disabled);const A=v.getOrCreateProgram("clippingMask");for(const C of l){const R=v._tileClippingMaskIDs[C.key]=--d;A.draw(v,S.TRIANGLES,s.b4.disabled,new s.b6({func:S.ALWAYS,mask:0},R,255,S.KEEP,S.KEEP,S.REPLACE),s.a.disabled,s.b5.disabled,bs(C.projMatrix),"$clipping",v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}pointCoordinate(l){const d=this.painter.transform;if(l.x<0||l.x>d.width||l.y<0||l.y>d.height)return null;const v=[l.x,l.y,1,1];s.e.transformMat4(v,v,d.pixelMatrixInverse),s.e.scale(v,v,1/v[3]),v[0]/=d.worldSize,v[1]/=d.worldSize;const w=d._camera.position,S=s.b(1,d.center.lat),A=[w[0],w[1],w[2]/S,0],C=s.v.subtract([],v.slice(0,3),A);s.v.normalize(C,C);const R=this.raycast(A,C,this._exaggeration);return R!==null&&R?(s.v.scaleAndAdd(A,A,C,R),A[3]=A[2],A[2]*=S,A):null}drawDepth(){const l=this.painter,d=l.context,v=this.proxySourceCache,w=Math.ceil(l.width),S=Math.ceil(l.height);if(!this._depthFBO||this._depthFBO.width===w&&this._depthFBO.height===S||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const A=d.gl,C=d.createFramebuffer(w,S,!0,"renderbuffer");d.activeTexture.set(A.TEXTURE0);const R=new s.a9(d,{width:w,height:S,data:null},A.RGBA);R.bind(A.NEAREST,A.CLAMP_TO_EDGE),C.colorAttachment.set(R.texture);const B=d.createRenderbuffer(d.gl.DEPTH_COMPONENT16,w,S);C.depthAttachment.set(B),this._depthFBO=C,this._depthTexture=R}d.bindFramebuffer.set(this._depthFBO.framebuffer),d.viewport.set([0,0,w,S]),function(A,C,R,B){if(A.transform.projection.name==="globe")return;const U=A.context,H=U.gl;U.clear({depth:1});const Z=A.getOrCreateProgram("terrainDepth"),K=new s.b4(H.LESS,s.b4.ReadWrite,A.depthRangeFor3D);for(const Q of B){const te=R.getTile(Q),ee=Eu(Q.projMatrix,0,[0,0,0]);C.setupElevationDraw(te,Z),Z.draw(A,H.TRIANGLES,K,s.b6.disabled,s.a.unblended,s.b5.backCCW,ee,"terrain_depth",C.gridBuffer,C.gridIndexBuffer,C.gridNoSkirtSegments)}}(l,this,v,this.proxyCoords)}_setupProxiedCoordsForOrtho(l,d,v){if(l.getSource()instanceof s.aK)return this._setupProxiedCoordsForImageSource(l,d,v);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const w=this.proxiedCoords[l.id]=[],S=this.proxyCoords;for(let R=0;R<S.length;R++){const B=S[R],U=this._findTileCoveringTileID(B,l);if(U){const H=this._createProxiedId(B,U,v[B.key]&&v[B.key][l.id]);w.push(H),this.proxyToSource[B.key][l.id]=[H]}}let A=!1;const C=new Set;for(let R=0;R<d.length;R++){const B=l.getTile(d[R]);if(!B||!B.hasData())continue;const U=this._findTileCoveringTileID(B.tileID,this.proxySourceCache);if(U&&U.tileID.canonical.z!==B.tileID.canonical.z){const H=this.proxyToSource[U.tileID.key][l.id],Z=this._createProxiedId(U.tileID,B,v[U.tileID.key]&&v[U.tileID.key][l.id]);H?H.splice(H.length-1,0,Z):this.proxyToSource[U.tileID.key][l.id]=[Z];const K=this.proxyToSource[U.tileID.key][l.id];C.has(K)||C.add(K),w.push(Z),A=!0}}if(this._sourceTilesOverlap[l.id]=A,A&&this._debugParams.sortTilesHiZFirst)for(const R of C)R.sort((B,U)=>U.overscaledZ-B.overscaledZ)}_setupProxiedCoordsForImageSource(l,d,v){if(!l.getSource().loaded())return;const w=this.proxiedCoords[l.id]=[],S=this.proxyCoords,A=l.getSource(),C=A.tileID;if(!C)return;const R=new s.P(C.x,C.y)._div(1<<C.z),B=A.coordinates.map(s.M.fromLngLat).reduce((H,Z)=>(H.min.x=Math.min(H.min.x,Z.x-R.x),H.min.y=Math.min(H.min.y,Z.y-R.y),H.max.x=Math.max(H.max.x,Z.x-R.x),H.max.y=Math.max(H.max.y,Z.y-R.y),H),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),U=(H,Z)=>{const K=H.wrap+H.canonical.x/(1<<H.canonical.z),Q=H.canonical.y/(1<<H.canonical.z),te=s.J/(1<<H.canonical.z),ee=Z.wrap+Z.canonical.x/(1<<Z.canonical.z),$=Z.canonical.y/(1<<Z.canonical.z);return K+te<ee+B.min.x||K>ee+B.max.x||Q+te<$+B.min.y||Q>$+B.max.y};for(let H=0;H<S.length;H++){const Z=S[H];for(let K=0;K<d.length;K++){const Q=l.getTile(d[K]);if(!Q||!Q.hasData()||U(Z,Q.tileID))continue;const te=this._createProxiedId(Z,Q,v[Z.key]&&v[Z.key][l.id]),ee=this.proxyToSource[Z.key][l.id];ee?ee.push(te):this.proxyToSource[Z.key][l.id]=[te],w.push(te)}}}_createProxiedId(l,d,v){let w=this.orthoMatrix;if(v){const S=v.find(A=>A.key===d.tileID.key);if(S)return S}if(d.tileID.key!==l.key){const S=l.canonical.z-d.tileID.canonical.z;let A,C,R;w=s.m.create();const B=d.tileID.wrap-l.wrap<<l.overscaledZ;S>0?(A=s.J>>S,C=A*((d.tileID.canonical.x<<S)-l.canonical.x+B),R=A*((d.tileID.canonical.y<<S)-l.canonical.y)):(A=s.J<<-S,C=s.J*(d.tileID.canonical.x-(l.canonical.x+B<<-S)),R=s.J*(d.tileID.canonical.y-(l.canonical.y<<-S))),s.m.ortho(w,0,A,0,A,0,1),s.m.translate(w,w,[C,R,0])}return new Aa(d.tileID,l.key,w)}_findTileCoveringTileID(l,d){let v=d.getTile(l);if(v&&v.hasData())return v;const w=this._findCoveringTileCache[d.id],S=w[l.key];if(v=S?d.getTileByID(S):null,v&&v.hasData()||S===null)return v;let A=v?v.tileID:l,C=A.overscaledZ;const R=d.getSource().minzoom,B=[];if(!S){const H=d.getSource().maxzoom;if(l.canonical.z>=H){const Z=l.canonical.z-H;d.getSource().reparseOverscaled?(C=Math.max(l.canonical.z+2,d.transform.tileZoom),A=new s.O(C,l.wrap,H,l.canonical.x>>Z,l.canonical.y>>Z)):Z!==0&&(C=H,A=new s.O(C,l.wrap,H,l.canonical.x>>Z,l.canonical.y>>Z))}A.key!==l.key&&(B.push(A.key),v=d.getTile(A))}const U=H=>{B.forEach(Z=>{w[Z]=H}),B.length=0};for(C-=1;C>=R&&(!v||!v.hasData());C--){v&&U(v.tileID.key);const H=A.calculateScaledKey(C);if(v=d.getTileByID(H),v&&v.hasData())break;const Z=w[H];if(Z===null)break;Z===void 0?B.push(H):v=d.getTileByID(Z)}return U(v?v.tileID.key:null),v&&v.hasData()?v:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,d){let v=this._tilesDirty[l];v||(v=this._tilesDirty[l]={}),v[d.key]=!0}}function Cu(g,l,d){const v=function(C,R,B){const U=s.v.dot(R,C),H=s.v.dot(B,[.2126,.7152,.0722]),Z=(Q,te,ee)=>(1-ee)*Q+ee*te,K=Z(1-.3*Math.min(H,1),1,Math.min(U+1,1));return Z(.92,1,Math.asin(s.c(R[2],-1,1))/Math.PI+.5)*K}(g,[0,0,1],l),w=[0,0,0];s.v.scale(w,d.slice(0,3),v);const S=[0,0,0];s.v.scale(S,l.slice(0,3),g[2]);const A=[0,0,0];return s.v.add(A,w,S),s.bw(A)}const Ul=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Ns=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Dc{static cacheKey(l,d,v,w){let S=`${d}${w?w.cacheKey:""}`;for(const A of v)l.usedDefines.includes(A)&&(S+=`/${A}`);return S}constructor(l,d,v,w,S,A){const C=l.gl;this.program=C.createProgram(),this.configuration=w,this.name=d,this.fixedDefines=[...A];const R=w?w.getBinderAttributes():[],B=(v.staticAttributes||[]).concat(R);let U=w?w.defines():[];U=U.concat(A.map(ee=>`#define ${ee}`));const H=`#version 300 es
`;let Z=H+U.concat("precision mediump float;",ra,na.fragmentSource).join(`
`);for(const ee of v.fragmentIncludes)Z+=`
${zs[ee]}`;Z+=`
${v.fragmentSource}`;let K=H+U.concat("precision highp float;",ra,na.vertexSource).join(`
`);for(const ee of v.vertexIncludes)K+=`
${zs[ee]}`;K+=`
${v.vertexSource}`;const Q=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(Q,Z),C.compileShader(Q),C.attachShader(this.program,Q);const te=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(te,K),C.compileShader(te),C.attachShader(this.program,te),this.attributes={},this.numAttributes=B.length;for(let ee=0;ee<this.numAttributes;ee++)if(B[ee]){const $=B[ee].startsWith("a_")?B[ee]:`a_${B[ee]}`;C.bindAttribLocation(this.program,ee,$),this.attributes[$]=ee}C.linkProgram(this.program),C.deleteShader(te),C.deleteShader(Q),this.fixedUniforms=S(l),this.binderUniforms=w?w.getUniforms(l):[],A.includes("TERRAIN")&&(this.terrainUniforms=(ee=>({u_dem:new s.a$(ee),u_dem_prev:new s.a$(ee),u_dem_tl:new s.b0(ee),u_dem_scale:new s.b2(ee),u_dem_tl_prev:new s.b0(ee),u_dem_scale_prev:new s.b2(ee),u_dem_size:new s.b2(ee),u_dem_lerp:new s.b2(ee),u_exaggeration:new s.b2(ee),u_depth:new s.a$(ee),u_depth_size_inv:new s.b0(ee),u_meter_to_dem:new s.b2(ee),u_label_plane_matrix_inv:new s.a_(ee)}))(l)),A.includes("GLOBE")&&(this.globeUniforms=(ee=>({u_tile_tl_up:new s.b7(ee),u_tile_tr_up:new s.b7(ee),u_tile_br_up:new s.b7(ee),u_tile_bl_up:new s.b7(ee),u_tile_up_scale:new s.b2(ee)}))(l)),A.includes("FOG")&&(this.fogUniforms=(ee=>({u_fog_matrix:new s.a_(ee),u_fog_range:new s.b0(ee),u_fog_color:new s.b9(ee),u_fog_horizon_blend:new s.b2(ee),u_fog_vertical_limit:new s.b0(ee),u_fog_temporal_offset:new s.b2(ee),u_frustum_tl:new s.b7(ee),u_frustum_tr:new s.b7(ee),u_frustum_br:new s.b7(ee),u_frustum_bl:new s.b7(ee),u_globe_pos:new s.b7(ee),u_globe_radius:new s.b2(ee),u_globe_transition:new s.b2(ee),u_is_globe:new s.a$(ee),u_viewport:new s.b0(ee)}))(l)),A.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ee=>({u_cutoff_params:new s.b9(ee)}))(l)),A.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ee=>({u_lighting_ambient_color:new s.b7(ee),u_lighting_directional_dir:new s.b7(ee),u_lighting_directional_color:new s.b7(ee),u_ground_radiance:new s.b7(ee)}))(l)),A.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ee=>({u_light_matrix_0:new s.a_(ee),u_light_matrix_1:new s.a_(ee),u_fade_range:new s.b0(ee),u_shadow_normal_offset:new s.b7(ee),u_shadow_intensity:new s.b2(ee),u_shadow_texel_size:new s.b2(ee),u_shadow_map_resolution:new s.b2(ee),u_shadow_direction:new s.b7(ee),u_shadow_bias:new s.b7(ee),u_shadowmap_0:new s.a$(ee),u_shadowmap_1:new s.a$(ee)}))(l))}}setTerrainUniformValues(l,d){if(!this.terrainUniforms)return;const v=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const w in d)v[w]&&v[w].set(this.program,w,d[w])}}setGlobeUniformValues(l,d){if(!this.globeUniforms)return;const v=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const w in d)v[w]&&v[w].set(this.program,w,d[w])}}setFogUniformValues(l,d){if(!this.fogUniforms)return;const v=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const w in d)v[w].set(this.program,w,d[w])}}setCutoffUniformValues(l,d){if(!this.cutoffUniforms)return;const v=this.cutoffUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const w in d)v[w].set(this.program,w,d[w])}}setLightsUniformValues(l,d){if(!this.lightsUniforms)return;const v=this.lightsUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const w in d)v[w].set(this.program,w,d[w])}}setShadowUniformValues(l,d){if(this.failedToCreate||!this.shadowUniforms)return;const v=this.shadowUniforms;l.program.set(this.program);for(const w in d)v[w].set(this.program,w,d[w])}_drawDebugWireframe(l,d,v,w,S,A,C,R,B,U){const H=l.options.wireframe;if(H.terrain===!1&&H.layers2D===!1&&H.layers3D===!1)return;const Z=l.context;if(!(!(!H.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!H.layers2D||l._terrain&&l._terrain.renderingToTexture||!Ul.includes(this.name))||!(!H.layers3D||!Ns.includes(this.name))))return;const K=Z.gl,Q=l.wireframeDebugCache.getLinesFromTrianglesBuffer(l.frameCounter,S,Z);if(!Q)return;const te=[...this.fixedDefines];te.push("DEBUG_WIREFRAME");const ee=l.getOrCreateProgram(this.name,{config:this.configuration,defines:te});Z.program.set(ee.program);const $=(ye,oe,he)=>{if(oe[ye]&&he[ye])for(const ve in oe[ye])he[ye][ve]&&he[ye][ve].set(he.program,ve,oe[ye][ve].current)};B&&B.setUniforms(ee.program,Z,ee.binderUniforms,C,{zoom:R}),$("fixedUniforms",this,ee),$("terrainUniforms",this,ee),$("globeUniforms",this,ee),$("fogUniforms",this,ee),$("lightsUniforms",this,ee),$("shadowUniforms",this,ee),Q.bind(),Z.setColorMode(new s.a([K.ONE,K.ONE_MINUS_SRC_ALPHA,K.ZERO,K.ONE],s.C.transparent,[!0,!0,!0,!1])),Z.setDepthMode(new s.b4(d.func===K.LESS?K.LEQUAL:d.func,s.b4.ReadOnly,d.range)),Z.setStencilMode(s.b6.disabled);const le=3*A.primitiveLength*2,_e=3*A.primitiveOffset*2*2;U&&U>1?K.drawElementsInstanced(K.LINES,le,K.UNSIGNED_SHORT,_e,U):K.drawElements(K.LINES,le,K.UNSIGNED_SHORT,_e),S.bind(),Z.program.set(this.program),Z.setDepthMode(d),Z.setStencilMode(v),Z.setColorMode(w)}draw(l,d,v,w,S,A,C,R,B,U,H,Z,K,Q,te,ee){const $=l.context,le=$.gl;if(this.failedToCreate)return;$.program.set(this.program),$.setDepthMode(v),$.setStencilMode(w),$.setColorMode(S),$.setCullFace(A);for(const oe of Object.keys(this.fixedUniforms))this.fixedUniforms[oe].set(this.program,oe,C[oe]);Q&&Q.setUniforms(this.program,$,this.binderUniforms,Z,{zoom:K});const _e={[le.LINES]:2,[le.TRIANGLES]:3,[le.LINE_STRIP]:1}[d],ye=ee&&ee>0?1:void 0;for(const oe of H.get()){const he=oe.vaos||(oe.vaos={});(he[R]||(he[R]=new Bl)).bind($,this,B,Q?Q.getPaintVertexBuffers():[],U,oe.vertexOffset,te||[],ye),ee&&ee>1?le.drawElementsInstanced(d,oe.primitiveLength*_e,le.UNSIGNED_SHORT,oe.primitiveOffset*_e*2,ee):le.drawElements(d,oe.primitiveLength*_e,le.UNSIGNED_SHORT,oe.primitiveOffset*_e*2),d===le.TRIANGLES&&this._drawDebugWireframe(l,v,w,S,U,oe,Z,K,Q,ee)}}}function Vs(g,l){const d=Math.pow(2,l.tileID.overscaledZ),v=l.tileSize*Math.pow(2,g.transform.tileZoom)/d,w=v*(l.tileID.canonical.x+l.tileID.wrap*d),S=v*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture?l.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ay(l,1,g.transform.tileZoom),u_pixel_coord_upper:[w>>16,S>>16],u_pixel_coord_lower:[65535&w,65535&S]}}const jl=s.m.create(),ws=(g,l,d,v,w,S,A,C,R,B,U,H,Z,K,Q,te)=>{const ee=l.style.light,$=ee.properties.get("position"),le=[$.x,$.y,$.z],_e=s.bx.create();ee.properties.get("anchor")==="viewport"&&(s.bx.fromRotation(_e,-l.transform.angle),s.v.transformMat3(le,le,_e));const ye=ee.properties.get("color"),oe=l.transform,he={u_matrix:g,u_lightpos:le,u_lightintensity:ee.properties.get("intensity"),u_lightcolor:[ye.r,ye.g,ye.b],u_vertical_gradient:+d,u_opacity:v,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:jl,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:w,u_edge_radius:S,u_flood_light_color:H,u_vertical_scale:Z,u_flood_light_intensity:K,u_ground_shadow_factor:Q,u_emissive_strength:te};return oe.projection.name==="globe"&&(he.u_tile_id=[A.canonical.x,A.canonical.y,1<<A.canonical.z],he.u_zoom_transition=R,he.u_inv_rot_matrix=U,he.u_merc_center=B,he.u_up_dir=oe.projection.upVector(new s.t(0,0,0),B[0]*s.J,B[1]*s.J),he.u_height_lift=C),he},oa=(g,l,d)=>({u_matrix:g,u_edge_radius:l,u_vertical_scale:d}),cf=(g,l,d,v,w,S,A,C,R,B,U,H,Z,K)=>{const Q=ws(g,l,d,v,w,S,A,R,B,U,H,Z,K,1,[0,0,0],0),te={u_height_factor:-Math.pow(2,A.overscaledZ)/C.tileSize/8};return s.ak(Q,Vs(l,C),te)},Ts=(g,l)=>({u_matrix:g,u_emissive_strength:l}),Pu=(g,l,d,v)=>s.ak(Ts(g,l),Vs(d,v)),Us=(g,l,d)=>({u_matrix:g,u_world:d,u_emissive_strength:l}),Gh=(g,l,d,v,w)=>s.ak(Pu(g,l,d,v),{u_world:w}),uf=(g,l,d,v)=>{const w=s.J/d.tileSize;return{u_matrix:g,u_camera_to_center_distance:l.getCameraToCenterDistance(v),u_extrude_scale:[l.pixelsToGLUnits[0]/w,l.pixelsToGLUnits[1]/w]}},Gl=(g,l,d=1)=>({u_matrix:g,u_color:l,u_overlay:0,u_overlay_scale:d}),ku=s.m.create(),Du=(g,l,d,v,w,S,A)=>{const C=g.transform,R=C.projection.name==="globe",B=R?s.by(C.zoom,l.canonical)*C._pixelsPerMercatorPixel:s.ay(d,1,S),U={u_matrix:l.projMatrix,u_extrude_scale:B,u_intensity:A,u_inv_rot_matrix:ku,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){U.u_inv_rot_matrix=v,U.u_merc_center=w,U.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],U.u_zoom_transition=s.ao(C.zoom);const H=w[0]*s.J,Z=w[1]*s.J;U.u_up_dir=C.projection.upVector(new s.t(0,0,0),H,Z)}return U},Lu=(g,l,d,v,w,S,A,C,R,B,U,H,Z,K,Q,te,ee,$,le,_e,ye)=>{return{u_matrix:g,u_normalize_matrix:l,u_globe_matrix:d,u_merc_matrix:v,u_grid_matrix:w,u_tl_parent:S,u_scale_parent:B,u_fade_t:U.mix,u_opacity:U.opacity*H.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:H.paint.get("raster-brightness-min"),u_brightness_high:H.paint.get("raster-brightness-max"),u_saturation_factor:(he=H.paint.get("raster-saturation"),he>0?1-1/(1.001-he):-he),u_contrast_factor:(oe=H.paint.get("raster-contrast"),oe>0?1/(1-oe):1+oe),u_spin_weights:Hl(H.paint.get("raster-hue-rotate")),u_perspective_transform:Z,u_raster_elevation:K,u_zoom_transition:A,u_merc_center:C,u_cutoff_params:R,u_colorization_mix:ql(te,$),u_colorization_offset:Ou(ee,$),u_color_ramp:Q,u_texture_offset:[_e/(le+2*_e),le/(le+2*_e)],u_texture_res:[le+2*_e,le+2*_e],u_emissive_strength:ye};var oe,he};function Hl(g){g*=Math.PI/180;const l=Math.sin(g),d=Math.cos(g);return[(2*d+1)/3,(-Math.sqrt(3)*l-d+1)/3,(Math.sqrt(3)*l-d+1)/3]}function ql([g,l,d,v],[w,S]){if(w===S)return[0,0,0,0];const A=(s.bz+3)/(s.bz+1)/(S-w);return[g*A,l*A,d*A,v*A]}function Ou(g,[l,d]){return l===d?0:((g-l)/(d-l)*(s.bz+3)-1)/(s.bz+1)}const Lc=s.m.create(),qe=(g,l,d,v,w,S,A,C,R,B,U,H,Z,K,Q,te,ee,$)=>{const le=w.transform,_e={u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:le.getCameraToCenterDistance(te),u_rotate_symbol:+d,u_aspect_ratio:le.width/le.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:A,u_coord_matrix:C,u_is_text:+R,u_pitch_with_map:+v,u_texsize:B,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Lc,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Lc,u_up_vector:[0,-1,0],u_icon_transition:$||0,u_icon_saturation:ee};return te.name==="globe"&&(_e.u_tile_id=[U.canonical.x,U.canonical.y,1<<U.canonical.z],_e.u_zoom_transition=H,_e.u_inv_rot_matrix=K,_e.u_merc_center=Z,_e.u_camera_forward=le._camera.forward(),_e.u_ecef_origin=s.bA(le.globeMatrix,U.toUnwrapped()),_e.u_tile_matrix=Float32Array.from(le.globeMatrix),_e.u_up_vector=Q),_e},bt=(g,l,d,v,w,S,A,C,R,B,U,H,Z,K,Q,te,ee)=>s.ak(qe(g,l,d,v,w,S,A,C,R,B,H,Z,K,Q,te,ee,1),{u_gamma_scale:v?w.transform.getCameraToCenterDistance(ee)*Math.cos(w.terrain?0:w.transform._pitch):1,u_device_pixel_ratio:s.a4.devicePixelRatio,u_is_halo:+U,undefined:void 0}),hi=(g,l,d,v,w,S,A,C,R,B,U,H,Z,K,Q,te)=>s.ak(bt(g,l,d,v,w,S,A,C,!0,R,!0,U,H,Z,K,Q,te),{u_texsize_icon:B,u_texture_icon:1}),Ri=(g,l,d,v)=>({u_matrix:g,u_emissive_strength:l,u_opacity:d,u_color:v}),jn=(g,l,d,v,w,S,A)=>s.ak(function(C,R,B,U){const H=B.imageManager.getPattern(C.toString(),R),{width:Z,height:K}=B.imageManager.getPixelSize(R),Q=Math.pow(2,U.tileID.overscaledZ),te=U.tileSize*Math.pow(2,B.transform.tileZoom)/Q,ee=te*(U.tileID.canonical.x+U.tileID.wrap*Q),$=te*U.tileID.canonical.y;return{u_image:0,u_pattern_tl:H.tl,u_pattern_br:H.br,u_texsize:[Z,K],u_pattern_size:H.displaySize,u_tile_units_to_pixels:1/s.ay(U,1,B.transform.tileZoom),u_pixel_coord_upper:[ee>>16,$>>16],u_pixel_coord_lower:[65535&ee,65535&$]}}(w,S,v,A),{u_matrix:g,u_emissive_strength:l,u_opacity:d}),qi={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},ar=(g,l,d,v,w,S,A,C,R,B,U,H,Z=[0,0,0])=>{const K=v.style.light,Q=K.properties.get("position"),te=[-Q.x,-Q.y,Q.z],ee=s.bx.create();K.properties.get("anchor")==="viewport"&&(s.bx.fromRotation(ee,-v.transform.angle),s.v.transformMat3(te,te,ee));const $=B.alphaMode==="MASK",le=K.properties.get("color"),_e=H.paint.get("model-ambient-occlusion-intensity"),ye=H.paint.get("model-color").constantOr(s.C.white),oe=H.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:g,u_lighting_matrix:l,u_normal_matrix:d,u_lightpos:te,u_lightintensity:K.properties.get("intensity"),u_lightcolor:[le.r,le.g,le.b],u_camera_pos:Z,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+$,u_alphaCutoff:B.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[A[0],A[1],A[2],1],u_metallicFactor:C,u_roughnessFactor:R,u_baseColorTexture:qi.BaseColor,u_metallicRoughnessTexture:qi.MetallicRoughness,u_normalTexture:qi.Normal,u_occlusionTexture:qi.Occlusion,u_emissionTexture:qi.Emission,u_color_mix:[ye.r,ye.g,ye.b,oe],u_aoIntensity:_e,u_emissive_strength:U}},lr=new Float32Array(16),Io=(g,l=lr,d=lr)=>({u_matrix:g,u_instance:l,u_node_matrix:d}),Br={fillExtrusion:g=>({u_matrix:new s.a_(g),u_lightpos:new s.b7(g),u_lightintensity:new s.b2(g),u_lightcolor:new s.b7(g),u_vertical_gradient:new s.b2(g),u_opacity:new s.b2(g),u_edge_radius:new s.b2(g),u_ao:new s.b0(g),u_tile_id:new s.b7(g),u_zoom_transition:new s.b2(g),u_inv_rot_matrix:new s.a_(g),u_merc_center:new s.b0(g),u_up_dir:new s.b7(g),u_height_lift:new s.b2(g),u_flood_light_color:new s.b7(g),u_vertical_scale:new s.b2(g),u_flood_light_intensity:new s.b2(g),u_ground_shadow_factor:new s.b7(g),u_emissive_strength:new s.b2(g)}),fillExtrusionDepth:g=>({u_matrix:new s.a_(g),u_edge_radius:new s.b2(g),u_vertical_scale:new s.b2(g)}),fillExtrusionPattern:g=>({u_matrix:new s.a_(g),u_lightpos:new s.b7(g),u_lightintensity:new s.b2(g),u_lightcolor:new s.b7(g),u_vertical_gradient:new s.b2(g),u_height_factor:new s.b2(g),u_edge_radius:new s.b2(g),u_ao:new s.b0(g),u_tile_id:new s.b7(g),u_zoom_transition:new s.b2(g),u_inv_rot_matrix:new s.a_(g),u_merc_center:new s.b0(g),u_up_dir:new s.b7(g),u_height_lift:new s.b2(g),u_image:new s.a$(g),u_texsize:new s.b0(g),u_pixel_coord_upper:new s.b0(g),u_pixel_coord_lower:new s.b0(g),u_tile_units_to_pixels:new s.b2(g),u_opacity:new s.b2(g)}),fillExtrusionGroundEffect:g=>({u_matrix:new s.a_(g),u_opacity:new s.b2(g),u_ao_pass:new s.b2(g),u_meter_to_tile:new s.b2(g),u_ao:new s.b0(g),u_flood_light_intensity:new s.b2(g),u_flood_light_color:new s.b7(g),u_attenuation:new s.b2(g),u_edge_radius:new s.b2(g),u_fb:new s.a$(g),u_fb_size:new s.b2(g)}),fill:g=>({u_matrix:new s.a_(g),u_emissive_strength:new s.b2(g)}),fillPattern:g=>({u_matrix:new s.a_(g),u_emissive_strength:new s.b2(g),u_image:new s.a$(g),u_texsize:new s.b0(g),u_pixel_coord_upper:new s.b0(g),u_pixel_coord_lower:new s.b0(g),u_tile_units_to_pixels:new s.b2(g)}),fillOutline:g=>({u_matrix:new s.a_(g),u_emissive_strength:new s.b2(g),u_world:new s.b0(g)}),fillOutlinePattern:g=>({u_matrix:new s.a_(g),u_emissive_strength:new s.b2(g),u_world:new s.b0(g),u_image:new s.a$(g),u_texsize:new s.b0(g),u_pixel_coord_upper:new s.b0(g),u_pixel_coord_lower:new s.b0(g),u_tile_units_to_pixels:new s.b2(g)}),circle:s.bB,collisionBox:g=>({u_matrix:new s.a_(g),u_camera_to_center_distance:new s.b2(g),u_extrude_scale:new s.b0(g)}),collisionCircle:g=>({u_matrix:new s.a_(g),u_inv_matrix:new s.a_(g),u_camera_to_center_distance:new s.b2(g),u_viewport_size:new s.b0(g)}),debug:g=>({u_color:new s.b1(g),u_matrix:new s.a_(g),u_overlay:new s.a$(g),u_overlay_scale:new s.b2(g)}),clippingMask:g=>({u_matrix:new s.a_(g)}),heatmap:g=>({u_extrude_scale:new s.b2(g),u_intensity:new s.b2(g),u_matrix:new s.a_(g),u_inv_rot_matrix:new s.a_(g),u_merc_center:new s.b0(g),u_tile_id:new s.b7(g),u_zoom_transition:new s.b2(g),u_up_dir:new s.b7(g)}),heatmapTexture:g=>({u_image:new s.a$(g),u_color_ramp:new s.a$(g),u_opacity:new s.b2(g)}),hillshade:g=>({u_matrix:new s.a_(g),u_image:new s.a$(g),u_latrange:new s.b0(g),u_light:new s.b0(g),u_shadow:new s.b1(g),u_highlight:new s.b1(g),u_emissive_strength:new s.b2(g),u_accent:new s.b1(g)}),hillshadePrepare:g=>({u_matrix:new s.a_(g),u_image:new s.a$(g),u_dimension:new s.b0(g),u_zoom:new s.b2(g)}),line:s.bC,linePattern:s.bD,raster:g=>({u_matrix:new s.a_(g),u_normalize_matrix:new s.a_(g),u_globe_matrix:new s.a_(g),u_merc_matrix:new s.a_(g),u_grid_matrix:new s.b8(g),u_tl_parent:new s.b0(g),u_scale_parent:new s.b2(g),u_fade_t:new s.b2(g),u_opacity:new s.b2(g),u_image0:new s.a$(g),u_image1:new s.a$(g),u_brightness_low:new s.b2(g),u_brightness_high:new s.b2(g),u_saturation_factor:new s.b2(g),u_contrast_factor:new s.b2(g),u_spin_weights:new s.b7(g),u_perspective_transform:new s.b0(g),u_raster_elevation:new s.b2(g),u_zoom_transition:new s.b2(g),u_merc_center:new s.b0(g),u_cutoff_params:new s.b9(g),u_colorization_mix:new s.b9(g),u_colorization_offset:new s.b2(g),u_color_ramp:new s.a$(g),u_texture_offset:new s.b0(g),u_texture_res:new s.b0(g),u_emissive_strength:new s.b2(g)}),symbolIcon:g=>({u_is_size_zoom_constant:new s.a$(g),u_is_size_feature_constant:new s.a$(g),u_size_t:new s.b2(g),u_size:new s.b2(g),u_camera_to_center_distance:new s.b2(g),u_rotate_symbol:new s.a$(g),u_aspect_ratio:new s.b2(g),u_fade_change:new s.b2(g),u_matrix:new s.a_(g),u_label_plane_matrix:new s.a_(g),u_coord_matrix:new s.a_(g),u_is_text:new s.a$(g),u_pitch_with_map:new s.a$(g),u_texsize:new s.b0(g),u_tile_id:new s.b7(g),u_zoom_transition:new s.b2(g),u_inv_rot_matrix:new s.a_(g),u_merc_center:new s.b0(g),u_camera_forward:new s.b7(g),u_tile_matrix:new s.a_(g),u_up_vector:new s.b7(g),u_ecef_origin:new s.b7(g),u_texture:new s.a$(g),u_icon_transition:new s.b2(g),u_icon_saturation:new s.b2(g)}),symbolSDF:g=>({u_is_size_zoom_constant:new s.a$(g),u_is_size_feature_constant:new s.a$(g),u_size_t:new s.b2(g),u_size:new s.b2(g),u_camera_to_center_distance:new s.b2(g),u_rotate_symbol:new s.a$(g),u_aspect_ratio:new s.b2(g),u_fade_change:new s.b2(g),u_matrix:new s.a_(g),u_label_plane_matrix:new s.a_(g),u_coord_matrix:new s.a_(g),u_is_text:new s.a$(g),u_pitch_with_map:new s.a$(g),u_texsize:new s.b0(g),u_texture:new s.a$(g),u_gamma_scale:new s.b2(g),u_device_pixel_ratio:new s.b2(g),u_tile_id:new s.b7(g),u_zoom_transition:new s.b2(g),u_inv_rot_matrix:new s.a_(g),u_merc_center:new s.b0(g),u_camera_forward:new s.b7(g),u_tile_matrix:new s.a_(g),u_up_vector:new s.b7(g),u_ecef_origin:new s.b7(g),u_is_halo:new s.a$(g)}),symbolTextAndIcon:g=>({u_is_size_zoom_constant:new s.a$(g),u_is_size_feature_constant:new s.a$(g),u_size_t:new s.b2(g),u_size:new s.b2(g),u_camera_to_center_distance:new s.b2(g),u_rotate_symbol:new s.a$(g),u_aspect_ratio:new s.b2(g),u_fade_change:new s.b2(g),u_matrix:new s.a_(g),u_label_plane_matrix:new s.a_(g),u_coord_matrix:new s.a_(g),u_is_text:new s.a$(g),u_pitch_with_map:new s.a$(g),u_texsize:new s.b0(g),u_texsize_icon:new s.b0(g),u_texture:new s.a$(g),u_texture_icon:new s.a$(g),u_gamma_scale:new s.b2(g),u_device_pixel_ratio:new s.b2(g),u_is_halo:new s.a$(g)}),background:g=>({u_matrix:new s.a_(g),u_emissive_strength:new s.b2(g),u_opacity:new s.b2(g),u_color:new s.b1(g)}),backgroundPattern:g=>({u_matrix:new s.a_(g),u_emissive_strength:new s.b2(g),u_opacity:new s.b2(g),u_image:new s.a$(g),u_pattern_tl:new s.b0(g),u_pattern_br:new s.b0(g),u_texsize:new s.b0(g),u_pattern_size:new s.b0(g),u_pixel_coord_upper:new s.b0(g),u_pixel_coord_lower:new s.b0(g),u_tile_units_to_pixels:new s.b2(g)}),terrainRaster:kc,terrainDepth:kc,skybox:g=>({u_matrix:new s.a_(g),u_sun_direction:new s.b7(g),u_cubemap:new s.a$(g),u_opacity:new s.b2(g),u_temporal_offset:new s.b2(g)}),skyboxGradient:g=>({u_matrix:new s.a_(g),u_color_ramp:new s.a$(g),u_center_direction:new s.b7(g),u_radius:new s.b2(g),u_opacity:new s.b2(g),u_temporal_offset:new s.b2(g)}),skyboxCapture:g=>({u_matrix_3f:new s.b8(g),u_sun_direction:new s.b7(g),u_sun_intensity:new s.b2(g),u_color_tint_r:new s.b9(g),u_color_tint_m:new s.b9(g),u_luminance:new s.b2(g)}),globeRaster:g=>({u_proj_matrix:new s.a_(g),u_globe_matrix:new s.a_(g),u_normalize_matrix:new s.a_(g),u_merc_matrix:new s.a_(g),u_zoom_transition:new s.b2(g),u_merc_center:new s.b0(g),u_image0:new s.a$(g),u_grid_matrix:new s.b8(g),u_skirt_height:new s.b2(g),u_frustum_tl:new s.b7(g),u_frustum_tr:new s.b7(g),u_frustum_br:new s.b7(g),u_frustum_bl:new s.b7(g),u_globe_pos:new s.b7(g),u_globe_radius:new s.b2(g),u_viewport:new s.b0(g)}),globeAtmosphere:g=>({u_frustum_tl:new s.b7(g),u_frustum_tr:new s.b7(g),u_frustum_br:new s.b7(g),u_frustum_bl:new s.b7(g),u_horizon:new s.b2(g),u_transition:new s.b2(g),u_fadeout_range:new s.b2(g),u_color:new s.b9(g),u_high_color:new s.b9(g),u_space_color:new s.b9(g),u_temporal_offset:new s.b2(g),u_horizon_angle:new s.b2(g)}),model:g=>({u_matrix:new s.a_(g),u_lighting_matrix:new s.a_(g),u_normal_matrix:new s.a_(g),u_lightpos:new s.b7(g),u_lightintensity:new s.b2(g),u_lightcolor:new s.b7(g),u_camera_pos:new s.b7(g),u_opacity:new s.b2(g),u_baseColorFactor:new s.b9(g),u_emissiveFactor:new s.b9(g),u_metallicFactor:new s.b2(g),u_roughnessFactor:new s.b2(g),u_baseTextureIsAlpha:new s.a$(g),u_alphaMask:new s.a$(g),u_alphaCutoff:new s.b2(g),u_baseColorTexture:new s.a$(g),u_metallicRoughnessTexture:new s.a$(g),u_normalTexture:new s.a$(g),u_occlusionTexture:new s.a$(g),u_emissionTexture:new s.a$(g),u_color_mix:new s.b9(g),u_aoIntensity:new s.b2(g),u_emissive_strength:new s.b2(g)}),modelDepth:g=>({u_matrix:new s.a_(g),u_instance:new s.a_(g),u_node_matrix:new s.a_(g)}),groundShadow:g=>({u_matrix:new s.a_(g),u_ground_shadow_factor:new s.b7(g)}),stars:g=>({u_matrix:new s.a_(g),u_up:new s.b7(g),u_right:new s.b7(g),u_intensity_multiplier:new s.b2(g)})};let br;function Ho(g,l,d,v,w,S,A){const C=g.context,R=C.gl,B=g.transform,U=g.getOrCreateProgram("collisionBox"),H=[];let Z=0,K=0;for(let ye=0;ye<v.length;ye++){const oe=v[ye],he=l.getTile(oe),ve=he.getBucket(d);if(!ve)continue;const Ee=Ji(oe,ve,B);let xe=Ee;w[0]===0&&w[1]===0||(xe=g.translatePosMatrix(Ee,he,w,S));const Pe=A?ve.textCollisionBox:ve.iconCollisionBox,ct=ve.collisionCircleArray;if(ct.length>0){const je=s.m.create(),et=xe;s.m.mul(je,ve.placementInvProjMatrix,B.glCoordMatrix),s.m.mul(je,je,ve.placementViewportMatrix),H.push({circleArray:ct,circleOffset:K,transform:et,invTransform:je,projection:ve.getProjection()}),Z+=ct.length/4,K=Z}Pe&&(g.terrain&&g.terrain.setupElevationDraw(he,U),U.draw(g,R.LINES,s.b4.disabled,s.b6.disabled,g.colorModeForRenderPass(),s.b5.disabled,uf(xe,B,he,ve.getProjection()),d.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,null,B.zoom,null,[Pe.collisionVertexBuffer,Pe.collisionVertexBufferExt]))}if(!A||!H.length)return;const Q=g.getOrCreateProgram("collisionCircle"),te=new s.bE;te.resize(4*Z),te._trim();let ee=0;for(const ye of H)for(let oe=0;oe<ye.circleArray.length/4;oe++){const he=4*oe,ve=ye.circleArray[he+0],Ee=ye.circleArray[he+1],xe=ye.circleArray[he+2],Pe=ye.circleArray[he+3];te.emplace(ee++,ve,Ee,xe,Pe,0),te.emplace(ee++,ve,Ee,xe,Pe,1),te.emplace(ee++,ve,Ee,xe,Pe,2),te.emplace(ee++,ve,Ee,xe,Pe,3)}(!br||br.length<2*Z)&&(br=function(ye){const oe=2*ye,he=new s.bp;he.resize(oe),he._trim();for(let ve=0;ve<oe;ve++){const Ee=6*ve;he.uint16[Ee+0]=4*ve+0,he.uint16[Ee+1]=4*ve+1,he.uint16[Ee+2]=4*ve+2,he.uint16[Ee+3]=4*ve+2,he.uint16[Ee+4]=4*ve+3,he.uint16[Ee+5]=4*ve+0}return he}(Z));const $=C.createIndexBuffer(br,!0),le=C.createVertexBuffer(te,s.bF.members,!0);for(const ye of H){const oe={u_matrix:ye.transform,u_inv_matrix:ye.invTransform,u_camera_to_center_distance:(_e=B).getCameraToCenterDistance(ye.projection),u_viewport_size:[_e.width,_e.height]};Q.draw(g,R.TRIANGLES,s.b4.disabled,s.b6.disabled,g.colorModeForRenderPass(),s.b5.disabled,oe,d.id,le,$,s.bm.simpleSegment(0,2*ye.circleOffset,ye.circleArray.length,ye.circleArray.length/2),null,B.zoom)}var _e;le.destroy(),$.destroy()}const qo=s.m.create();function Wr({width:g,height:l,anchor:d,textOffset:v,textScale:w},S){const{horizontalAlign:A,verticalAlign:C}=s.aY(d),R=-(A-.5)*g,B=-(C-.5)*l,U=s.aW(d,v);return new s.P((R/w+U[0])*S,(B/w+U[1])*S)}function ds(g,l,d,v,w,S,A,C,R,B,U){const H=g.text.placedSymbolArray,Z=g.text.dynamicLayoutVertexArray,K=g.icon.dynamicLayoutVertexArray,Q={},te=g.getProjection(),ee=Xn(C,te,S),$=S.elevation,le=te.upVectorScale(C.canonical,S.center.lat,S.worldSize).metersToTile;Z.clear();for(let _e=0;_e<H.length;_e++){const ye=H.get(_e),{tileAnchorX:oe,tileAnchorY:he,numGlyphs:ve}=ye,Ee=ye.hidden||!ye.crossTileID||g.allowVerticalPlacement&&!ye.placedOrientation?null:v[ye.crossTileID];if(Ee){let xe=0,Pe=0,ct=0;if($){const Mt=$?$.getAtTileOffset(C,oe,he):0,[_t,oi,Yt]=te.upVector(C.canonical,oe,he);xe=Mt*_t*le,Pe=Mt*oi*le,ct=Mt*Yt*le}let[je,et,Le,at]=Pr(ye.projectedAnchorX+xe,ye.projectedAnchorY+Pe,ye.projectedAnchorZ+ct,d?ee:A);const Ke=lt(S.getCameraToCenterDistance(te),at);let dt=w.evaluateSizeForFeature(g.textSizeData,B,ye)*Ke/s.aV;d&&(dt*=g.tilePixelRatio/R);const me=Wr(Ee,dt);d?({x:je,y:et,z:Le}=te.projectTilePoint(oe+me.x,he+me.y,C.canonical),[je,et,Le]=Pr(je+xe,et+Pe,Le+ct,A)):(l&&me._rotate(-S.angle),je+=me.x,et+=me.y,Le=0);const Fe=g.allowVerticalPlacement&&ye.placedOrientation===s.W.vertical?Math.PI/2:0;for(let Mt=0;Mt<ve;Mt++)s.k(Z,je,et,Le,Fe);U&&ye.associatedIconIndex>=0&&(Q[ye.associatedIconIndex]={x:je,y:et,z:Le,angle:Fe})}else At(ve,Z)}if(U){K.clear();const _e=g.icon.placedSymbolArray;for(let ye=0;ye<_e.length;ye++){const oe=_e.get(ye),{numGlyphs:he}=oe,ve=Q[ye];if(oe.hidden||!ve)At(he,K);else{const{x:Ee,y:xe,z:Pe,angle:ct}=ve;for(let je=0;je<he;je++)s.k(K,Ee,xe,Pe,ct)}}g.icon.dynamicLayoutVertexBuffer.updateData(K)}g.text.dynamicLayoutVertexBuffer.updateData(Z)}function sa(g,l,d){return d.iconsInText&&l?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function Wi(g,l,d,v,w,S,A,C,R,B,U,H,Z){const K=g.context,Q=K.gl,te=g.transform,ee=C==="map",$=R==="map",le=ee&&d.layout.get("symbol-placement")!=="point",_e=ee&&!$&&!le,ye=d.layout.get("symbol-sort-key").constantOr(1)!==void 0;let oe=!1;const he=g.depthModeForSublayer(0,s.b4.ReadOnly),ve=[s.E(te.center.lng),s.H(te.center.lat)],Ee=d.layout.get("text-variable-anchor"),xe=te.projection.name==="globe",Pe=[],ct=[0,-1,0];let je=ct;!xe&&!te.mercatorFromTransition||ee||(je=function(et){const Le=et._camera.getWorldToCamera(et.worldSize,1),at=s.m.multiply([],Le,et.globeMatrix);s.m.invert(at,at);const Ke=[0,0,0],dt=[0,1,0,0];return s.e.transformMat4(dt,dt,at),Ke[0]=dt[0],Ke[1]=dt[1],Ke[2]=dt[2],s.v.normalize(Ke,Ke),Ke}(te));for(const et of v){const Le=l.getTile(et),at=Le.getBucket(d);if(!at||at.projection.name==="mercator"&&xe)continue;const Ke=w?at.text:at.icon;if(!Ke||at.fullyClipped||!Ke.segments.get().length)continue;const dt=Ke.programConfigurations.get(d.id),me=w||at.sdfIcons,Fe=w?at.textSizeData:at.iconSizeData,Mt=$||te.pitch!==0,_t=s.i(Fe,te.zoom);let oi,Yt,pi,Qt,Ai=[0,0],Ii=null;if(w)Yt=Le.glyphAtlasTexture?Le.glyphAtlasTexture:null,pi=Q.LINEAR,oi=Le.glyphAtlasTexture?Le.glyphAtlasTexture.size:[0,0],at.iconsInText&&(Ai=Le.imageAtlasTexture?Le.imageAtlasTexture.size:[0,0],Ii=Le.imageAtlasTexture?Le.imageAtlasTexture:null,Qt=Mt||g.options.rotating||g.options.zooming||Fe.kind==="composite"||Fe.kind==="camera"?Q.LINEAR:Q.NEAREST);else{const kn=d.layout.get("icon-size").constantOr(0)!==1||at.iconsNeedLinear;Yt=Le.imageAtlasTexture?Le.imageAtlasTexture:null,pi=me||g.options.rotating||g.options.zooming||kn||Mt?Q.LINEAR:Q.NEAREST,oi=Le.imageAtlasTexture?Le.imageAtlasTexture.size:[0,0]}const ui=at.projection.name==="globe",di=ui?je:ct,sn=ui?s.ao(te.zoom):0,Ni=Xn(et,at.getProjection(),te),Hn=te.calculatePixelsToTileUnitsMatrix(Le),Cn=Cr(Ni,Le.tileID.canonical,$,ee,te,at.getProjection(),Hn),Fo=g.terrain&&$&&le?s.m.invert(s.m.create(),Cn):qo,As=qr(Ni,Le.tileID.canonical,$,ee,te,at.getProjection(),Hn),Mn=Ee&&at.hasTextData(),hn=at.hasIconTextFit()&&Mn&&at.hasIconData();if(le){const kn=te.elevation,Ws=kn?kn.getAtTileOffsetFunc(et,te.center.lat,te.worldSize,at.getProjection()):null,ua=Mo(Ni,Le.tileID.canonical,$,ee,te,at.getProjection(),Hn);Ct(at,Ni,g,w,ua,As,$,B,Ws,et)}const _n=le||w&&Ee||hn,er=g.translatePosMatrix(Ni,Le,S,A),eo=_n?qo:Cn,Yn=g.translatePosMatrix(As,Le,S,A,!0),vo=at.getProjection().createInversionMatrix(te,et.canonical),Bo=d.paint.get("icon-image-cross-fade").constantOr(0),xo=[];g.terrainRenderModeElevated()&&$&&xo.push("PITCH_WITH_MAP_TERRAIN"),ui&&(xo.push("PROJECTION_GLOBE_VIEW"),_n&&xo.push("PROJECTED_POS_ON_VIEWPORT")),Bo>0&&xo.push("ICON_TRANSITION"),Ke.zOffsetVertexBuffer&&xo.push("Z_OFFSET");const Is=me&&d.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let La;me?La=at.iconsInText?hi(Fe.kind,_t,_e,$,g,er,eo,Yn,oi,Ai,et,sn,ve,vo,di,at.getProjection()):bt(Fe.kind,_t,_e,$,g,er,eo,Yn,w,oi,!0,et,sn,ve,vo,di,at.getProjection()):(U<1&&xo.push("SATURATION"),La=qe(Fe.kind,_t,_e,$,g,er,eo,Yn,w,oi,et,sn,ve,vo,di,at.getProjection(),U,Bo));const qs={program:g.getOrCreateProgram(sa(me,w,at),{config:dt,defines:xo}),buffers:Ke,uniformValues:La,atlasTexture:Yt,atlasTextureIcon:Ii,atlasInterpolation:pi,atlasInterpolationIcon:Qt,isSDF:me,hasHalo:Is,tile:Le,labelPlaneMatrixInv:Fo};if(ye&&at.canOverlap){oe=!0;const kn=Ke.segments.get();for(const Ws of kn)Pe.push({segments:new s.bm([Ws]),sortKey:Ws.sortKey,state:qs})}else Pe.push({segments:Ke.segments,sortKey:0,state:qs})}oe&&Pe.sort((et,Le)=>et.sortKey-Le.sortKey);for(const et of Pe){const Le=et.state;if(g.terrain&&g.terrain.setupElevationDraw(Le.tile,Le.program,{useDepthForOcclusion:te.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Le.labelPlaneMatrixInv}),K.activeTexture.set(Q.TEXTURE0),Le.atlasTexture&&Le.atlasTexture.bind(Le.atlasInterpolation,Q.CLAMP_TO_EDGE,!0),Le.atlasTextureIcon&&(K.activeTexture.set(Q.TEXTURE1),Le.atlasTextureIcon&&Le.atlasTextureIcon.bind(Le.atlasInterpolationIcon,Q.CLAMP_TO_EDGE,!0)),g.uploadCommonLightUniforms(g.context,Le.program),Le.hasHalo){const at=Le.uniformValues;at.u_is_halo=1,js(Le.buffers,et.segments,d,g,Le.program,he,H,Z,at,2),at.u_is_halo=0}else{if(Le.isSDF){const at=Le.uniformValues;Le.hasHalo&&(at.u_is_halo=1,js(Le.buffers,et.segments,d,g,Le.program,he,H,Z,at,1)),at.u_is_halo=0}js(Le.buffers,et.segments,d,g,Le.program,he,H,Z,Le.uniformValues,1)}}}function js(g,l,d,v,w,S,A,C,R,B){const U=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.iconTransitioningVertexBuffer,g.globeExtVertexBuffer,g.zOffsetVertexBuffer];w.draw(v,v.context.gl.TRIANGLES,S,A,C,s.b5.disabled,R,d.id,g.layoutVertexBuffer,g.indexBuffer,l,d.paint,v.transform.zoom,g.programConfigurations.get(d.id),U,B)}function Gs(g,l,d,v,w,S,A){const C=g.context.gl,R=d.paint.get("fill-pattern"),B=R&&R.constantOr(1);let U,H,Z,K,Q;A?(H=B&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=C.LINES):(H=B?"fillPattern":"fill",U=C.TRIANGLES);for(const te of v){const ee=l.getTile(te);if(B&&!ee.patternsLoaded())continue;const $=ee.getBucket(d);if(!$)continue;g.prepareDrawTile();const le=$.programConfigurations.get(d.id),_e=g.isTileAffectedByFog(te),ye=g.getOrCreateProgram(H,{config:le,overrideFog:_e});B&&(g.context.activeTexture.set(C.TEXTURE0),ee.imageAtlasTexture&&ee.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),le.updatePaintBuffers());const oe=R.constantOr(null);if(oe&&ee.imageAtlas){const Ee=ee.imageAtlas.patternPositions[oe.toString()];Ee&&le.setConstantPatternPositions(Ee)}const he=g.translatePosMatrix(te.projMatrix,ee,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor")),ve=d.paint.get("fill-emissive-strength");if(A){K=$.indexBuffer2,Q=$.segments2;const Ee=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];Z=H==="fillOutlinePattern"&&B?Gh(he,ve,g,ee,Ee):Us(he,ve,Ee)}else K=$.indexBuffer,Q=$.segments,Z=B?Pu(he,ve,g,ee):Ts(he,ve);g.uploadCommonUniforms(g.context,ye,te.toUnwrapped()),ye.draw(g,U,w,g.stencilModeForClipping(te),S,s.b5.disabled,Z,d.id,$.layoutVertexBuffer,K,Q,d.paint,g.transform.zoom,le,void 0)}}function il(g,l,d,v,w,S,A,C){d.resetLayerRenderingStats();const R=g.context,B=R.gl,U=g.transform,H=d.paint.get("fill-extrusion-pattern"),Z=H.constantOr(1),K=d.paint.get("fill-extrusion-opacity"),Q=g.style.enable3dLights(),te=d.paint.get(Q&&!Z?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ee=[d.paint.get("fill-extrusion-ambient-occlusion-intensity"),te],$=d.layout.get("fill-extrusion-edge-radius"),le=$>0&&!d.paint.get("fill-extrusion-rounded-roof"),_e=le?0:$,ye=U.projection.name==="globe"?s.bO():0,oe=U.projection.name==="globe",he=oe?s.ao(U.zoom):0,ve=[s.E(U.center.lng),s.H(U.center.lat)],Ee=d.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),xe=d.paint.get("fill-extrusion-flood-light-intensity"),Pe=d.paint.get("fill-extrusion-vertical-scale"),ct=Ma(g,d.paint.get("fill-extrusion-cutoff-fade-range")),je=d.paint.get("fill-extrusion-emissive-strength"),et=[];let Le;oe&&et.push("PROJECTION_GLOBE_VIEW"),ee[0]>0&&et.push("FAUX_AO"),le&&et.push("ZERO_ROOF_RADIUS"),C&&et.push("HAS_CENTROID"),xe>0&&et.push("FLOOD_LIGHT"),ct.shouldRenderCutoff&&et.push("RENDER_CUTOFF");const at=g.renderPass==="shadow",Ke=g.shadowRenderer,dt=at&&!!Ke;g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0);let me=[0,0,0];if(Ke){const _t=g.style.directionalLight,oi=g.style.ambientLight;_t&&oi&&(me=Wh(_t,oi)),Le=et.concat(["SHADOWS_SINGLE_CASCADE"])}const Fe=dt?"fillExtrusionDepth":Z?"fillExtrusionPattern":"fillExtrusion",Mt=d.getLayerRenderingStats();for(const _t of v){const oi=l.getTile(_t),Yt=oi.getBucket(d);if(!Yt||Yt.projection.name!==U.projection.name)continue;let pi=!1;Ke&&(pi=Ke.getMaxCascadeForTile(_t.toUnwrapped())===0);const Qt=g.isTileAffectedByFog(_t),Ai=Yt.programConfigurations.get(d.id),Ii=g.getOrCreateProgram(Fe,{config:Ai,defines:pi?Le:et,overrideFog:Qt});if(g.terrain&&g.terrain.setupElevationDraw(oi,Ii,{useMeterToDem:!0}),!Yt.centroidVertexBuffer){const Cn=Ii.attributes.a_centroid_pos;Cn!==void 0&&B.vertexAttrib2f(Cn,0,0)}!at&&Ke&&Ke.setupShadows(oi.tileID.toUnwrapped(),Ii,"vector-tile",oi.tileID.overscaledZ),Z&&(g.context.activeTexture.set(B.TEXTURE0),oi.imageAtlasTexture&&oi.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Ai.updatePaintBuffers());const ui=H.constantOr(null);if(ui&&oi.imageAtlas){const Cn=oi.imageAtlas.patternPositions[ui.toString()];Cn&&Ai.setConstantPatternPositions(Cn)}const di=d.paint.get("fill-extrusion-vertical-gradient");let sn;if(at&&Ke){if(aa(oi.tileID,Yt,g))continue;const Cn=Ke.calculateShadowPassMatrixFromTile(oi.tileID.toUnwrapped());sn=oa(Cn,_e,Pe)}else{const Cn=g.translatePosMatrix(_t.expandedProjMatrix,oi,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Fo=U.projection.createInversionMatrix(U,_t.canonical);sn=Z?cf(Cn,g,di,K,ee,_e,_t,oi,ye,he,ve,Fo,Ee,Pe):ws(Cn,g,di,K,ee,_e,_t,ye,he,ve,Fo,Ee,Pe,xe,me,je)}g.uploadCommonUniforms(R,Ii,_t.toUnwrapped(),null,ct);let Ni=Yt.segments;if(U.projection.name==="mercator"&&!at&&(Ni=Yt.getVisibleSegments(oi.tileID,g.terrain,g.transform.getFrustum(0)),!Ni.get().length))continue;if(Mt)if(at)for(const Cn of Ni.get())Mt.numRenderedVerticesInShadowPass+=Cn.primitiveLength;else for(const Cn of Ni.get())Mt.numRenderedVerticesInTransparentPass+=Cn.primitiveLength;const Hn=[];(g.terrain||C)&&Hn.push(Yt.centroidVertexBuffer),oe&&Hn.push(Yt.layoutVertexExtBuffer),Ii.draw(g,R.gl.TRIANGLES,w,S,A,s.b5.backCCW,sn,d.id,Yt.layoutVertexBuffer,Yt.indexBuffer,Ni,d.paint,g.transform.zoom,Ai,Hn)}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1)}function Ca(g,l,d,v,w,S,A,C,R,B,U,H,Z,K,Q,te,ee,$,le){const _e=g.context,ye=_e.gl,oe=g.transform,he=g.transform.zoom,ve=[],Ee=Ma(g,d.paint.get("fill-extrusion-cutoff-fade-range"));B==="clear"?(ve.push("CLEAR_SUBPASS"),le&&(ve.push("CLEAR_FROM_TEXTURE"),_e.activeTexture.set(ye.TEXTURE0),le.bind(ye.LINEAR,ye.CLAMP_TO_EDGE))):B==="sdf"&&ve.push("SDF_SUBPASS"),ee&&ve.push("HAS_CENTROID"),Ee.shouldRenderCutoff&&ve.push("RENDER_CUTOFF");const xe=d.layout.get("fill-extrusion-edge-radius"),Pe=(ct,je,et,Le,at)=>{const Ke=je.programConfigurations.get(d.id),dt=g.isTileAffectedByFog(ct),me=g.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ke,defines:ve,overrideFog:dt}),Fe=((_t,oi,Yt,pi,Qt,Ai,Ii,ui,di,sn,Ni)=>({u_matrix:oi,u_opacity:Yt,u_ao_pass:pi?1:0,u_meter_to_tile:Qt,u_ao:Ai,u_flood_light_intensity:Ii,u_flood_light_color:ui,u_attenuation:di,u_edge_radius:sn,u_fb:0,u_fb_size:Ni}))(0,Le,U,R,at,[H,Z*at],K,Q,te,he>=17?0:xe*at,le?le.size[0]:0),Mt=[];ee&&Mt.push(je.hiddenByLandmarkVertexBuffer),g.uploadCommonUniforms(_e,me,ct.toUnwrapped(),null,Ee),me.draw(g,_e.gl.TRIANGLES,w,S,A,C,Fe,d.id,je.vertexBuffer,je.indexBuffer,et,d.paint,he,Ke,Mt)};for(const ct of v){const je=l.getTile(ct),et=je.getBucket(d);if(!et||et.projection.name!==oe.projection.name||!et.groundEffect||et.groundEffect&&!et.groundEffect.hasData())continue;const Le=et.groundEffect,at=1/et.tileToMeter;{const Ke=g.translatePosMatrix(ct.projMatrix,je,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),dt=Le.getDefaultSegment();Pe(ct,Le,dt,Ke,at)}if($)for(let Ke=0;Ke<4;Ke++){const dt=s.bP[Ke](ct),me=l.getTile(dt);if(!me)continue;const Fe=me.getBucket(d);if(!Fe||Fe.projection.name!==oe.projection.name||!Fe.groundEffect||Fe.groundEffect&&!Fe.groundEffect.hasData())continue;const Mt=Fe.groundEffect;let _t,oi;Ke===0?(_t=[-s.J,0,0],oi=1):Ke===1?(_t=[s.J,0,0],oi=0):Ke===2?(_t=[0,-s.J,0],oi=3):(_t=[0,s.J,0],oi=2);const Yt=Mt.regionSegments[oi];if(!Yt)continue;const pi=new Float32Array(16);s.m.translate(pi,ct.projMatrix,_t),Pe(ct,Mt,Yt,g.translatePosMatrix(pi,je,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),at)}}}function Hh(g,l,d,v,w,S,A){v.centroidVertexArray.length===0&&v.createCentroidsBuffer();const C=S?S.findDEMTileFor(d):null;if(!(C&&C.dem||A))return;const R=$=>new s.P(Math.ceil(($+s.bS)*s.bT),0),B=$=>{const le=l.getSource().minzoom,_e=oe=>{const he=l.getTileByID(oe);if(he&&he.hasData())return he.getBucket(w)},ye=[0,-1,1];for(const oe of ye){if($.overscaledZ+oe<le)continue;const he=_e($.calculateScaledKey($.overscaledZ+oe));if(he)return he}},U=[0,0,0],H=($,le)=>(U[0]=Math.min($.min.y,le.min.y),U[1]=Math.max($.max.y,le.max.y),U[2]=s.J-le.min.x>$.max.x?le.min.x-s.J:$.max.x,U),Z=($,le)=>(U[0]=Math.min($.min.x,le.min.x),U[1]=Math.max($.max.x,le.max.x),U[2]=s.J-le.min.y>$.max.y?le.min.y-s.J:$.max.y,U),K=[($,le)=>H($,le),($,le)=>H(le,$),($,le)=>Z($,le),($,le)=>Z(le,$)],Q=($,le,_e,ye,oe,he,ve)=>{if(!S)return 0;const Ee=[[he?_e:$,he?$:_e,0],[he?_e:le,he?le:_e,0]],xe=ve<0?s.J+ve:ve,Pe=[he?xe:($+le)/2,he?($+le)/2:xe,0];return _e===0&&ve<0||_e!==0&&ve>0?S.getForTilePoints(oe,[Pe],!0,ye):Ee.push(Pe),S.getForTilePoints(d,Ee,!0,C),Math.max(Ee[0][2],Ee[1][2],Pe[2])/S.exaggeration()};for(let $=0;$<4;$++){const le=v.borderFeatureIndices[$];if(le.length===0)continue;const _e=s.bP[$](d),ye=B(_e);if(!(ye&&ye instanceof s.bQ)||v.borderDoneWithNeighborZ[$]===ye.canonical.z)continue;ye.centroidVertexArray.length===0&&ye.createCentroidsBuffer();const oe=S?S.findDEMTileFor(_e):null;if(!(oe&&oe.dem||A))continue;const he=($<2?1:5)-$,ve=ye.borderDoneWithNeighborZ[he]!==v.canonical.z,Ee=ye.borderFeatureIndices[he];let xe=0;if(v.canonical.z!==ye.canonical.z){for(const Pe of le)v.showCentroid(v.featuresOnBorder[Pe]);if(ve)for(const Pe of Ee)ye.showCentroid(ye.featuresOnBorder[Pe]);v.borderDoneWithNeighborZ[$]=ye.canonical.z,ye.borderDoneWithNeighborZ[he]=v.canonical.z}for(const Pe of le){const ct=v.featuresOnBorder[Pe],je=v.centroidData[ct.centroidDataIndex],et=ct.borders[$];let Le;for(;xe<Ee.length;){Le=ye.featuresOnBorder[Ee[xe]];const at=Le.borders[he];if(at[1]>et[0]+3||at[0]>et[0]-3)break;ye.showCentroid(Le),xe++}if(Le&&xe<Ee.length){const at=xe;let Ke=0;for(;!(Le.borders[he][0]>et[1]-3)&&(Ke++,++xe!==Ee.length);)Le=ye.featuresOnBorder[Ee[xe]];if(Le=ye.featuresOnBorder[Ee[at]],Ke>1){const Fe=Le.borders[he];Math.abs(et[0]-Fe[0])<3&&Math.abs(et[1]-Fe[1])<3&&(Ke=1,xe=at+1)}else if(Ke===0){v.showCentroid(ct);continue}const dt=ye.centroidData[Le.centroidDataIndex];A&&Ke===1&&(((te=je).flags|(ee=dt).flags)&s.bR?(te.flags|=s.bR,ee.flags|=s.bR):(te.flags&=~s.bR,ee.flags&=~s.bR));const me=ct.intersectsCount()>1||Le.intersectsCount()>1;if(Ke>1)xe=at,je.centroidXY=dt.centroidXY=new s.P(0,0);else if(oe&&oe.dem&&!me){const Fe=K[$](je,dt),Mt=$%2?s.J-1:0,_t=Q(Fe[0],Math.min(s.J-1,Fe[1]),Mt,oe,_e,$<2,Fe[2]);je.centroidXY=dt.centroidXY=R(_t)}else me?je.centroidXY=dt.centroidXY=new s.P(0,0):(je.centroidXY=v.encodeBorderCentroid(ct),dt.centroidXY=ye.encodeBorderCentroid(Le));v.writeCentroidToBuffer(je),ye.writeCentroidToBuffer(dt)}else v.showCentroid(ct)}v.borderDoneWithNeighborZ[$]=ye.canonical.z,ye.borderDoneWithNeighborZ[he]=v.canonical.z}var te,ee;(v.needsCentroidUpdate||!v.centroidVertexBuffer&&v.centroidVertexArray.length!==0)&&v.uploadCentroid(g)}const On=[1,0,0],Gn=[0,1,0],Oc=[0,0,1];function aa(g,l,d){const v=d.transform,w=d.shadowRenderer;if(!w)return!0;const S=g.toUnwrapped(),A=v.tileSize*w._cascades[d.currentShadowCascade].scale;let C=l.maxHeight;if(v.elevation){const te=v.elevation.getMinMaxForTile(g);te&&(C+=te.max)}const R=[...w.shadowDirection];R[2]=-R[2];const B=w.computeSimplifiedTileShadowVolume(S,C,A,R);if(!B)return!1;const U=[On,Gn,Oc,R,[R[0],0,R[2]],[0,R[1],R[2]]],H=v.projection.name==="globe",Z=v.scaleZoom(A),K=s.F.fromInvProjectionMatrix(v.invProjMatrix,v.worldSize,Z,!H),Q=w.getCurrentCascadeFrustum();return K.intersectsPrecise(B.vertices,B.planes,U)===0||Q.intersectsPrecise(B.vertices,B.planes,U)===0}function Ru(g){const l=g._nearZ,d=g.projection.farthestPixelDistance(g),v=d-l,w=.2*g.height,S=l+w;return[l,d,(S-w-l)/v,(S-l)/v]}const Co=new s.C(1,0,0,1),fs=new s.C(0,1,0,1),Ss=new s.C(0,0,1,1),Pa=new s.C(1,0,1,1),Wl=new s.C(0,1,1,1);function Wo(g,l,d,v,w,S){const A=g.context,C=g.transform,R=A.gl,B=C.projection.name==="globe",U=B?["PROJECTION_GLOBE_VIEW"]:[];let H=s.m.clone(d.projMatrix);if(B&&s.ao(C.zoom)>0){const Le=s.bU(d.canonical,C),at=s.bV(Le);H=s.m.multiply(new Float32Array(16),C.globeMatrix,at),s.m.multiply(H,C.projMatrix,H)}const Z=s.m.create();Z[12]+=2*w/(s.a4.devicePixelRatio*C.width),Z[13]+=2*S/(s.a4.devicePixelRatio*C.height),s.m.multiply(H,Z,H);const K=g.getOrCreateProgram("debug",{defines:U}),Q=l.getTileByID(d.key);g.terrain&&g.terrain.setupElevationDraw(Q,K);const te=s.b4.disabled,ee=s.b6.disabled,$=g.colorModeForRenderPass(),le="$debug";A.activeTexture.set(R.TEXTURE0),g.emptyTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),B?Q._makeGlobeTileDebugBuffers(g.context,C):Q._makeDebugTileBoundsBuffers(g.context,C.projection);const _e=Q._tileDebugBuffer||g.debugBuffer,ye=Q._tileDebugIndexBuffer||g.debugIndexBuffer,oe=Q._tileDebugSegments||g.debugSegments;K.draw(g,R.LINE_STRIP,te,ee,$,s.b5.disabled,Gl(H,v),le,_e,ye,oe,null,null,null,[Q._globeTileDebugBorderBuffer]);const he=Q.latestRawTileData,ve=Math.floor((he&&he.byteLength||0)/1024),Ee=l.getTile(d).tileSize,xe=512/Math.min(Ee,512)*(d.overscaledZ/C.zoom)*.5;let Pe=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(Pe+=` => ${d.overscaledZ}`),Pe+=` ${ve}kb`,function(Le,at){Le.initDebugOverlayCanvas();const Ke=Le.debugOverlayCanvas,dt=Le.context.gl,me=Le.debugOverlayCanvas.getContext("2d");me.clearRect(0,0,Ke.width,Ke.height),me.shadowColor="white",me.shadowBlur=2,me.lineWidth=1.5,me.strokeStyle="white",me.textBaseline="top",me.font="bold 36px Open Sans, sans-serif",me.fillText(at,5,5),me.strokeText(at,5,5),Le.debugOverlayTexture.update(Ke),Le.debugOverlayTexture.bind(dt.LINEAR,dt.CLAMP_TO_EDGE)}(g,Pe);const ct=Q._tileDebugTextBuffer||g.debugBuffer,je=Q._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,et=Q._tileDebugTextSegments||g.debugSegments;K.draw(g,R.TRIANGLES,te,ee,s.a.alphaBlended,s.b5.disabled,Gl(H,s.C.transparent,xe),le,ct,je,et,null,null,null,[Q._globeTileDebugTextBuffer])}function la(g,l,d,v){ps(g,0,l+d/2,g.transform.width,d,v)}function ka(g,l,d,v){ps(g,l-d/2,0,d,g.transform.height,v)}function ps(g,l,d,v,w,S){const A=g.context,C=A.gl;C.enable(C.SCISSOR_TEST),C.scissor(l*s.a4.devicePixelRatio,d*s.a4.devicePixelRatio,v*s.a4.devicePixelRatio,w*s.a4.devicePixelRatio),A.clear({color:S}),C.disable(C.SCISSOR_TEST)}const Rc=s.bW([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Da}=Rc;function zo(g,l,d,v){g.emplaceBack(l,d,v)}class Zo{constructor(l){this.vertexArray=new s.bX,this.indices=new s.bp,zo(this.vertexArray,-1,-1,1),zo(this.vertexArray,1,-1,1),zo(this.vertexArray,-1,1,1),zo(this.vertexArray,1,1,1),zo(this.vertexArray,-1,-1,-1),zo(this.vertexArray,1,-1,-1),zo(this.vertexArray,-1,1,-1),zo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,Da),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=s.bm.simpleSegment(0,0,36,12)}}function ms(g,l,d,v,w,S){const A=g.context.gl,C=l.paint.get("sky-atmosphere-color"),R=l.paint.get("sky-atmosphere-halo-color"),B=l.paint.get("sky-atmosphere-sun-intensity"),U=((H,Z,K,Q,te)=>({u_matrix_3f:H,u_sun_direction:Z,u_sun_intensity:K,u_color_tint_r:[Q.r,Q.g,Q.b,Q.a],u_color_tint_m:[te.r,te.g,te.b,te.a],u_luminance:5e-5}))(s.bx.fromMat4(s.bx.create(),v),w,B,C,R);A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_CUBE_MAP_POSITIVE_X+S,l.skyboxTexture,0),d.draw(g,A.TRIANGLES,s.b4.disabled,s.b6.disabled,s.a.unblended,s.b5.frontCW,U,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const Zl=s.bW([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class hf{constructor(l){const d=new s.bY;d.emplaceBack(-1,1,1,0,0),d.emplaceBack(1,1,1,1,0),d.emplaceBack(1,-1,1,1,1),d.emplaceBack(-1,-1,1,0,1);const v=new s.bp;v.emplaceBack(0,1,2),v.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(d,Zl.members),this.indexBuffer=l.createIndexBuffer(v),this.segments=s.bm.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const mm=s.bW([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class df{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15}}class Ly{constructor(l){this.colorModeAlphaBlendedWriteRGB=new s.a([s.bZ,s.b_,s.bZ,s.b_],s.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new s.a([s.bZ,s.b$,s.bZ,s.b$],s.C.transparent,[!1,!1,!1,!0]),this.params=new df,this.allocatedStarsCount=0,l.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1}),l.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01})}update(l){const d=l.context;if(!this.atmosphereBuffer||this.allocatedStarsCount!==this.params.starsCount){this.atmosphereBuffer=new hf(d),this.allocatedStarsCount=this.params.starsCount;const v=100,w=200,S=function(U){const H=s.c2(30),Z=[];for(let K=0;K<U;++K){const Q=2*Math.PI*H(),te=Math.acos(1-2*H())-.5*Math.PI;Z.push(s.v.fromValues(Math.cos(te)*Math.cos(Q),Math.cos(te)*Math.sin(Q),Math.sin(te)))}return Z}(this.allocatedStarsCount),A=s.c2(300),C=new s.c0,R=new s.bp;let B=0;for(let U=0;U<S.length;++U){const H=s.v.scale([],S[U],200),Z=Math.max(0,1+.01*v*(1*A()-.5)),K=Math.max(0,1+.01*w*(1*A()-.5));C.emplaceBack(H[0],H[1],H[2],-1,-1,Z,K),C.emplaceBack(H[0],H[1],H[2],1,-1,Z,K),C.emplaceBack(H[0],H[1],H[2],1,1,Z,K),C.emplaceBack(H[0],H[1],H[2],-1,1,Z,K),R.emplaceBack(B+0,B+1,B+2),R.emplaceBack(B+0,B+2,B+3),B+=4}this.starsVx=d.createVertexBuffer(C,mm.members),this.starsIdx=d.createIndexBuffer(R),this.starsSegments=s.bm.simpleSegment(0,0,C.length,R.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(l,d){const v=l.context,w=v.gl,S=l.transform,A=new s.b4(w.LEQUAL,s.b4.ReadOnly,[0,1]),C=s.ao(S.zoom),R=d.properties.get("color").toArray01(),B=d.properties.get("high-color").toArray01(),U=d.properties.get("space-color").toArray01PremultipliedAlpha(),H=5e-4,Z=s.c1(d.properties.get("horizon-blend"),0,1,H,.25),K=s.bb(l,v,S)&&Z===H?S.worldSize/(2*Math.PI*1.025)-1:S.globeRadius,Q=l.frameCounter/1e3%1,te=s.v.length(S.globeCenterInViewSpace),ee=Math.sqrt(Math.pow(te,2)-Math.pow(K,2)),$=Math.acos(ee/te),le=_e=>{const ye=S.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];_e&&ye.push("ALPHA_PASS");const oe=l.getOrCreateProgram("globeAtmosphere",{defines:ye}),he=((Ee,xe,Pe,ct,je,et,Le,at,Ke,dt,me,Fe)=>({u_frustum_tl:Ee,u_frustum_tr:xe,u_frustum_br:Pe,u_frustum_bl:ct,u_horizon:je,u_transition:et,u_fadeout_range:Le,u_color:at,u_high_color:Ke,u_space_color:dt,u_temporal_offset:me,u_horizon_angle:Fe}))(S.frustumCorners.TL,S.frustumCorners.TR,S.frustumCorners.BR,S.frustumCorners.BL,S.frustumCorners.horizon,C,Z,R,B,U,Q,$);l.uploadCommonUniforms(v,oe);const ve=this.atmosphereBuffer;ve&&oe.draw(l,w.TRIANGLES,A,s.b6.disabled,_e?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,s.b5.backCW,he,_e?"atmosphere_glow_alpha":"atmosphere_glow",ve.vertexBuffer,ve.indexBuffer,ve.segments)};le(!1),le(!0)}drawStars(l,d){const v=s.c(d.properties.get("star-intensity"),0,1);if(v===0)return;const w=l.context,S=w.gl,A=l.transform,C=l.getOrCreateProgram("stars"),R=s.q.identity([]);s.q.rotateX(R,R,-A._pitch),s.q.rotateZ(R,R,-A.angle),s.q.rotateX(R,R,s.d(A._center.lat)),s.q.rotateY(R,R,-s.d(A._center.lng));const B=s.m.fromQuat(new Float32Array(16),R),U=s.m.multiply([],A.starsProjMatrix,B),H=s.bx.fromMat4([],B),Z=s.bx.invert([],H),K=[0,1,0];s.v.transformMat3(K,K,Z),s.v.scale(K,K,this.params.sizeMultiplier);const Q=[1,0,0];s.v.transformMat3(Q,Q,Z),s.v.scale(Q,Q,this.params.sizeMultiplier);const te=(ee=K,$=Q,le=v,{u_matrix:Float32Array.from(U),u_up:ee,u_right:$,u_intensity_multiplier:le});var ee,$,le;l.uploadCommonUniforms(w,C),this.starsVx&&this.starsIdx&&C.draw(l,S.TRIANGLES,s.b4.disabled,s.b6.disabled,this.colorModeAlphaBlendedWriteRGB,s.b5.disabled,te,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function qh(g,l){const d=[...g],v=l.cameraWorldSizeForFog/l.worldSize,w=s.m.identity([]);return s.m.scale(w,w,[v,v,1]),s.m.multiply(d,w,d),s.m.multiply(d,l.worldToFogMatrix,d),d}function ff(g,l,d,v){const w=d.material,S=v.context,{baseColorTexture:A,metallicRoughnessTexture:C}=w.pbrMetallicRoughness,{normalTexture:R,occlusionTexture:B,emissionTexture:U}=w;function H(Z,K,Q){if(Z&&(g.push(K),S.activeTexture.set(S.gl.TEXTURE0+Q),Z.gfxTexture)){const{minFilter:te,magFilter:ee,wrapS:$,wrapT:le}=Z.sampler;Z.gfxTexture.bindExtraParam(te,ee,$,le)}}H(A,"HAS_TEXTURE_u_baseColorTexture",qi.BaseColor),H(C,"HAS_TEXTURE_u_metallicRoughnessTexture",qi.MetallicRoughness),H(R,"HAS_TEXTURE_u_normalTexture",qi.Normal),H(B,"HAS_TEXTURE_u_occlusionTexture",qi.Occlusion),H(U,"HAS_TEXTURE_u_emissionTexture",qi.Emission),d.texcoordBuffer&&(g.push("HAS_ATTRIBUTE_a_uv_2f"),l.push(d.texcoordBuffer)),d.colorBuffer&&(g.push(d.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),l.push(d.colorBuffer)),d.normalBuffer&&(g.push("HAS_ATTRIBUTE_a_normal_3f"),l.push(d.normalBuffer)),d.pbrBuffer&&(g.push("HAS_ATTRIBUTE_a_pbr"),g.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),l.push(d.pbrBuffer)),w.alphaMode!=="OPAQUE"&&w.alphaMode!=="MASK"||g.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||g.push("DIFFUSE_SHADED"),g.push("USE_STANDARD_DERIVATIVES")}function Xl(g,l,d,v,w,S){const A=d.paint.get("model-opacity"),C=l.context,R=new s.b4(l.context.gl.LEQUAL,s.b4.ReadWrite,l.depthRangeFor3D),B=l.transform,U=g.mesh,H=U.material,Z=H.pbrMetallicRoughness,K=l.style.fog;let Q;Q=l.transform.projection.zAxisUnit==="pixels"?[...g.nodeModelMatrix]:s.m.multiply([],v.zScaleMatrix,g.nodeModelMatrix),s.m.multiply(Q,v.negCameraPosMatrix,Q);const te=s.m.invert([],Q);s.m.transpose(te,te);const ee=d.paint.get("model-emissive-strength").constantOr(0),$=ar(new Float32Array(g.worldViewProjection),new Float32Array(Q),new Float32Array(te),l,A,Z.baseColorFactor,H.emissiveFactor,Z.metallicFactor,Z.roughnessFactor,H,ee,d),le={defines:[]},_e=[];ff(le.defines,_e,U,l);const ye=l.shadowRenderer;ye&&(ye.useNormalOffset=!1);let oe=null;if(K){const Ee=qh(g.nodeModelMatrix,l.transform);if(oe=new Float32Array(Ee),B.projection.name!=="globe"){const xe=U.aabb.min,Pe=U.aabb.max,[ct,je]=K.getOpacityForBounds(Ee,xe[0],xe[1],Pe[0],Pe[1]);le.overrideFog=ct>=Eo||je>=Eo}}const he=Ma(l,d.paint.get("model-cutoff-fade-range"));he.shouldRenderCutoff&&le.defines.push("RENDER_CUTOFF");const ve=l.getOrCreateProgram("model",le);l.uploadCommonUniforms(C,ve,null,oe,he),l.renderPass!=="shadow"&&ye&&ye.setupShadowsFromMatrix(g.nodeModelMatrix,ve),ve.draw(l,C.gl.TRIANGLES,R,w,S,U.material.doubleSided?s.b5.disabled:s.b5.backCCW,$,d.id,U.vertexBuffer,U.indexBuffer,U.segments,d.paint,l.transform.zoom,void 0,_e)}function gm(g,l,d,v,w,S,A){let C;C=g.projection.name==="globe"?s.c5(d,g):[...d],s.m.multiply(C,C,l.matrix);const R=s.m.multiply([],v,C);if(l.meshes)for(const B of l.meshes){if(B.material.alphaMode!=="BLEND"){A.push({mesh:B,depth:0,modelIndex:w,worldViewProjection:R,nodeModelMatrix:C});continue}const U=s.v.transformMat4([],B.centroid,R);U[2]>0&&S.push({mesh:B,depth:U[2],modelIndex:w,worldViewProjection:R,nodeModelMatrix:C})}if(l.children)for(const B of l.children)gm(g,B,d,v,w,S,A)}function zu(g,l,d,v){const w=d.shadowRenderer;if(!w)return;const S=w.getShadowPassDepthMode(),A=w.getShadowPassColorMode(),C=w.calculateShadowPassMatrixFromMatrix(l),R=Io(C);d.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(d,d.context.gl.TRIANGLES,S,s.b6.disabled,A,s.b5.backCCW,R,v.id,g.vertexBuffer,g.indexBuffer,g.segments,v.paint,d.transform.zoom,void 0,void 0)}function Oy(g,l,d){const v=l.updateZoomBasedPaintProperties(),w=function(S,A,C){let R,B,U,H=S.terrain?S.terrain.exaggeration():0;if(S.terrain&&H>0){const Z=S.terrain,K=Z.findDEMTileFor(C);K&&K.dem?R=s.c7.create(Z,C,K):H=0}if(H===0&&(A.terrainElevationMin=0,A.terrainElevationMax=0),H===A.validForExaggeration&&(H===0||R&&R._demTile&&R._demTile.tileID===A.validForDEMTile.id&&R._dem._timestamp===A.validForDEMTile.timestamp))return!1;for(const Z in A.instancesPerModel){const K=A.instancesPerModel[Z];for(let Q=0;Q<K.instancedDataArray.length;++Q){const te=(R?H*R.getElevationAt(0|K.instancedDataArray.float32[16*Q],0|K.instancedDataArray.float32[16*Q+1],!0,!0):0)+K.instancesEvaluatedElevation[Q];K.instancedDataArray.float32[16*Q+6]=te,B=B?Math.min(A.terrainElevationMin,te):te,U=U?Math.max(A.terrainElevationMax,te):te}}return A.terrainElevationMin=B||0,A.terrainElevationMax=U||0,A.validForExaggeration=H,A.validForDEMTile=R&&R._demTile?{id:R._demTile.tileID,timestamp:R._dem._timestamp}:{id:void 0,timestamp:0},!0}(g,l,d);(v||w)&&(l.uploaded=!1,l.upload(g.context))}const Ms={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.c3([0,0,0],[s.J,s.J,0])};function Ry(g,l){const d=1<<g.canonical.z,v=l.getFreeCameraOptions().position,w=l.elevation,S=g.canonical.x/d,A=(g.canonical.x+1)/d,C=g.canonical.y/d,R=(g.canonical.y+1)/d;let B=l._centerAltitude;if(w){const K=w.getMinMaxForTile(g);K&&K.max>B&&(B=K.max)}const U=s.c(v.x,S,A)-v.x,H=s.c(v.y,C,R)-v.y,Z=s.b(B,l.center.lat)-v.z;return l._zoomFromMercatorZ(Math.sqrt(U*U+H*H+Z*Z))}function Fu(g,l,d,v,w,S,A){const C=g.context,R=g.renderPass==="shadow",B=g.shadowRenderer,U=R&&B?B.getShadowPassDepthMode():new s.b4(C.gl.LEQUAL,s.b4.ReadWrite,g.depthRangeFor3D),H=g.isTileAffectedByFog(S);if(d.meshes)for(const Z of d.meshes){const K=["MODEL_POSITION_ON_GPU"],Q=[];let te,ee,$;v.instancedDataArray.length>20&&K.push("INSTANCED_ARRAYS");const le=Ma(g,l.paint.get("model-cutoff-fade-range"));if(le.shouldRenderCutoff&&K.push("RENDER_CUTOFF"),R&&B)te=g.getOrCreateProgram("modelDepth",{defines:K}),ee=Io(A.shadowTileMatrix,A.shadowTileMatrix,Float32Array.from(d.matrix)),$=B.getShadowPassColorMode();else{ff(K,Q,Z,g),te=g.getOrCreateProgram("model",{defines:K,overrideFog:H});const ye=Z.material,oe=ye.pbrMetallicRoughness,he=l.paint.get("model-opacity"),ve=l.paint.get("model-emissive-strength").constantOr(0);ee=ar(S.expandedProjMatrix,Float32Array.from(d.matrix),new Float32Array(16),g,he,oe.baseColorFactor,ye.emissiveFactor,oe.metallicFactor,oe.roughnessFactor,ye,ve,l,w),B&&(A.shadowUniformsInitialized?te.setShadowUniformValues(C,B.getShadowUniformValues()):(B.setupShadows(S.toUnwrapped(),te,"model-tile",S.overscaledZ),A.shadowUniformsInitialized=!0)),$=le.shouldRenderCutoff||he<1||ye.alphaMode!=="OPAQUE"?s.a.alphaBlended:s.a.unblended}g.uploadCommonUniforms(C,te,S.toUnwrapped(),null,le);const _e=Z.material.doubleSided?s.b5.disabled:s.b5.backCCW;if(v.instancedDataArray.length>20)Q.push(v.instancedDataBuffer),te.draw(g,C.gl.TRIANGLES,U,s.b6.disabled,$,_e,ee,l.id,Z.vertexBuffer,Z.indexBuffer,Z.segments,l.paint,g.transform.zoom,void 0,Q,v.instancedDataArray.length);else{const ye=R?"u_instance":"u_normal_matrix";for(let oe=0;oe<v.instancedDataArray.length;++oe)ee[ye]=new Float32Array(v.instancedDataArray.arrayBuffer,64*oe,16),te.draw(g,C.gl.TRIANGLES,U,s.b6.disabled,$,_e,ee,l.id,Z.vertexBuffer,Z.indexBuffer,Z.segments,l.paint,g.transform.zoom,void 0,Q)}}if(d.children)for(const Z of d.children)Fu(g,l,Z,v,w,S,A)}const zy=[1,-1,1];function _m(g,l,d,v){if(!d.modelManager)return!0;const w=d.modelManager;if(!d.shadowRenderer)return!0;const S=d.shadowRenderer,A=l.aabb;let C=!0,R=g.maxHeight;if(R===0){let U=0;for(const H in g.instancesPerModel){const Z=w.getModel(H,v);Z?U=Math.max(U,Math.max(Math.max(Z.aabb.max[0],Z.aabb.max[1]),Z.aabb.max[2])):C=!1}R=g.maxScale*U*1.41+g.maxVerticalOffset,C&&(g.maxHeight=R)}A.max[2]=R,A.min[2]+=g.terrainElevationMin,A.max[2]+=g.terrainElevationMax,s.v.transformMat4(A.min,A.min,l.tileMatrix),s.v.transformMat4(A.max,A.max,l.tileMatrix);const B=A.intersects(S.getCurrentCascadeFrustum());return d.currentShadowCascade===0&&(g.isInsideFirstShadowMapFrustum=B===2),B===0}class ym{}class zc{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(l,d,v){{const H=this._storage.get(d.id);if(H)return H.lastUsedFrameIdx=l,H.buf}const w=v.gl,S=w.getBufferParameter(w.ELEMENT_ARRAY_BUFFER,w.BUFFER_SIZE),A=new ArrayBuffer(S),C=new Int16Array(A);w.getBufferSubData(w.ELEMENT_ARRAY_BUFFER,0,new Int16Array(A));const R=new s.c9;for(let H=0;H<S/2;H+=3){const Z=C[H],K=C[H+1],Q=C[H+2];R.emplaceBack(Z,K),R.emplaceBack(K,Q),R.emplaceBack(Q,Z)}const B=v.bindVertexArrayOES.current,U=new ym;return U.buf=new s.I(v,R),U.lastUsedFrameIdx=l,this._storage.set(d.id,U),v.bindVertexArrayOES.set(B),U.buf}update(l){for(const[d,v]of this._storage)l-v.lastUsedFrameIdx>30&&(v.buf.destroy(),this._storage.delete(d))}destroy(){for(const[l,d]of this._storage)d.buf.destroy(),this._storage.delete(l)}}class vm{registerParameter(l,d,v,w,S){}registerButton(l,d,v){}}const pf={symbol:function(g,l,d,v,w){if(g.renderPass!=="translucent")return;const S=s.b6.disabled,A=g.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(C,R,B,U,H,Z,K){const Q=R.transform,te=H==="map",ee=Z==="map";for(const $ of C){const le=U.getTile($),_e=le.getBucket(B);if(!_e||!_e.text||!_e.text.segments.get().length)continue;const ye=s.i(_e.textSizeData,Q.zoom),oe=Xn($,_e.getProjection(),Q),he=Q.calculatePixelsToTileUnitsMatrix(le),ve=Cr(oe,le.tileID.canonical,ee,te,Q,_e.getProjection(),he),Ee=_e.hasIconTextFit()&&_e.hasIconData();if(ye){const xe=Math.pow(2,Q.zoom-le.tileID.overscaledZ);ds(_e,te,ee,K,s.bG,Q,ve,$,xe,ye,Ee)}}}(v,g,d,l,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),w),d.paint.get("icon-opacity").constantOr(1)!==0&&Wi(g,l,d,v,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),d.paint.get("icon-color-saturation"),S,A),d.paint.get("text-opacity").constantOr(1)!==0&&Wi(g,l,d,v,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),d.paint.get("icon-color-saturation"),S,A),l.map.showCollisionBoxes&&(Ho(g,l,d,v,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),Ho(g,l,d,v,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(g,l,d,v){if(g.renderPass!=="translucent")return;const w=d.paint.get("circle-opacity"),S=d.paint.get("circle-stroke-width"),A=d.paint.get("circle-stroke-opacity"),C=d.layout.get("circle-sort-key").constantOr(1)!==void 0,R=d.paint.get("circle-emissive-strength");if(w.constantOr(1)===0&&(S.constantOr(1)===0||A.constantOr(1)===0))return;const B=g.context,U=B.gl,H=g.transform,Z=g.depthModeForSublayer(0,s.b4.ReadOnly),K=s.b6.disabled,Q=g.colorModeForDrapableLayerRenderPass(R),te=H.projection.name==="globe",ee=[s.E(H.center.lng),s.H(H.center.lat)],$=[];for(let _e=0;_e<v.length;_e++){const ye=v[_e],oe=l.getTile(ye),he=oe.getBucket(d);if(!he||he.projection.name!==H.projection.name)continue;const ve=he.programConfigurations.get(d.id),Ee=s.bH(d),xe=g.isTileAffectedByFog(ye);te&&Ee.push("PROJECTION_GLOBE_VIEW");const Pe=g.getOrCreateProgram("circle",{config:ve,defines:Ee,overrideFog:xe}),ct=he.layoutVertexBuffer,je=he.globeExtVertexBuffer,et=he.indexBuffer,Le=H.projection.createInversionMatrix(H,ye.canonical),at={programConfiguration:ve,program:Pe,layoutVertexBuffer:ct,globeExtVertexBuffer:je,indexBuffer:et,uniformValues:s.bI(g,ye,oe,Le,ee,d),tile:oe};if(C){const Ke=he.segments.get();for(const dt of Ke)$.push({segments:new s.bm([dt]),sortKey:dt.sortKey,state:at})}else $.push({segments:he.segments,sortKey:0,state:at})}C&&$.sort((_e,ye)=>_e.sortKey-ye.sortKey);const le={useDepthForOcclusion:H.depthOcclusionForSymbolsAndCircles};for(const _e of $){const{programConfiguration:ye,program:oe,layoutVertexBuffer:he,globeExtVertexBuffer:ve,indexBuffer:Ee,uniformValues:xe,tile:Pe}=_e.state,ct=_e.segments;g.terrain&&g.terrain.setupElevationDraw(Pe,oe,le),g.uploadCommonUniforms(B,oe,Pe.tileID.toUnwrapped()),oe.draw(g,U.TRIANGLES,Z,K,Q,s.b5.disabled,xe,d.id,he,Ee,ct,d.paint,H.zoom,ye,[ve])}},heatmap:function(g,l,d,v){if(d.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const w=g.context,S=w.gl,A=s.b6.disabled,C=new s.a([S.ONE,S.ONE,S.ONE,S.ONE],s.C.transparent,[!0,!0,!0,!0]);(function(K,Q,te,ee){const $=K.gl,le=Q.width*ee,_e=Q.height*ee;K.activeTexture.set($.TEXTURE1),K.viewport.set([0,0,le,_e]);let ye=te.heatmapFbo;if(!ye||ye&&(ye.width!==le||ye.height!==_e)){ye&&ye.destroy();const oe=$.createTexture();$.bindTexture($.TEXTURE_2D,oe),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.LINEAR),ye=te.heatmapFbo=K.createFramebuffer(le,_e,!0,null),function(he,ve,Ee,xe,Pe,ct){const je=he.gl;je.texImage2D(je.TEXTURE_2D,0,he.extRenderToTextureHalfFloat?je.RGBA16F:je.RGBA,Pe,ct,0,je.RGBA,he.extRenderToTextureHalfFloat?je.HALF_FLOAT:je.UNSIGNED_BYTE,null),xe.colorAttachment.set(Ee)}(K,0,oe,ye,le,_e)}else $.bindTexture($.TEXTURE_2D,ye.colorAttachment.get()),K.bindFramebuffer.set(ye.framebuffer)})(w,g,d,g.transform.projection.name==="globe"?.5:.25),w.clear({color:s.C.transparent});const R=g.transform,B=R.projection.name==="globe",U=B?["PROJECTION_GLOBE_VIEW"]:[],H=B?s.b5.frontCCW:s.b5.disabled,Z=[s.E(R.center.lng),s.H(R.center.lat)];for(let K=0;K<v.length;K++){const Q=v[K];if(l.hasRenderableParent(Q))continue;const te=l.getTile(Q),ee=te.getBucket(d);if(!ee||ee.projection.name!==R.projection.name)continue;const $=g.isTileAffectedByFog(Q),le=ee.programConfigurations.get(d.id),_e=g.getOrCreateProgram("heatmap",{config:le,defines:U,overrideFog:$}),{zoom:ye}=g.transform;g.terrain&&g.terrain.setupElevationDraw(te,_e),g.uploadCommonUniforms(w,_e,Q.toUnwrapped());const oe=R.projection.createInversionMatrix(R,Q.canonical);_e.draw(g,S.TRIANGLES,s.b4.disabled,A,C,H,Du(g,Q,te,oe,Z,ye,d.paint.get("heatmap-intensity")),d.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,d.paint,g.transform.zoom,le,B?[ee.globeExtVertexBuffer]:null)}w.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(w,S){const A=w.context,C=A.gl,R=S.heatmapFbo;if(!R)return;A.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,R.colorAttachment.get()),A.activeTexture.set(C.TEXTURE1);let B=S.colorRampTexture;B||(B=S.colorRampTexture=new s.a9(A,S.colorRamp,C.RGBA)),B.bind(C.LINEAR,C.CLAMP_TO_EDGE),w.getOrCreateProgram("heatmapTexture").draw(w,C.TRIANGLES,s.b4.disabled,s.b6.disabled,w.colorModeForRenderPass(),s.b5.disabled,((U,H,Z,K)=>({u_image:0,u_color_ramp:1,u_opacity:H.paint.get("heatmap-opacity")}))(0,S),S.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,S.paint,w.transform.zoom)}(g,d))},line:function(g,l,d,v){if(g.renderPass!=="translucent")return;const w=d.paint.get("line-opacity"),S=d.paint.get("line-width");if(w.constantOr(1)===0||S.constantOr(1)===0)return;const A=d.paint.get("line-emissive-strength"),C=g.depthModeForSublayer(0,s.b4.ReadOnly),R=g.colorModeForDrapableLayerRenderPass(A),B=g.terrain&&g.terrain.renderingToTexture?1:s.a4.devicePixelRatio,U=d.paint.get("line-dasharray"),H=U.constantOr(1),Z=d.layout.get("line-cap"),K=d.paint.get("line-pattern"),Q=K.constantOr(1),te=d.paint.get("line-pattern").constantOr(1),ee=d.paint.get("line-opacity").constantOr(1)!==1;let $=!te&&ee;const le=d.paint.get("line-gradient"),_e=Q?"linePattern":"line",ye=g.context,oe=ye.gl,he=s.bJ(d);g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&($=!1);for(const ve of v){const Ee=l.getTile(ve);if(Q&&!Ee.patternsLoaded())continue;const xe=Ee.getBucket(d);if(!xe)continue;g.prepareDrawTile();const Pe=xe.programConfigurations.get(d.id),ct=g.isTileAffectedByFog(ve),je=g.getOrCreateProgram(_e,{config:Pe,defines:he,overrideFog:ct}),et=K.constantOr(null);if(et&&Ee.imageAtlas){const _t=Ee.imageAtlas.patternPositions[et.toString()];_t&&Pe.setConstantPatternPositions(_t)}const Le=U.constantOr(null),at=Z.constantOr(null);if(!Q&&Le&&at&&Ee.lineAtlas){const _t=Ee.lineAtlas.getDash(Le,at);_t&&Pe.setConstantPatternPositions(_t)}let[Ke,dt]=d.paint.get("line-trim-offset");(at==="round"||at==="square")&&Ke!==dt&&(Ke===0&&(Ke-=1),dt===1&&(dt+=1));const me=g.terrain?ve.projMatrix:null,Fe=Q?s.bK(g,Ee,d,me,B):s.bL(g,Ee,d,me,xe.lineClipsArray.length,B,[Ke,dt]);if(le){const _t=xe.gradients[d.id];let oi=_t.texture;if(d.gradientVersion!==_t.version){let Yt=256;if(d.stepInterpolant){const pi=l.getSource().maxzoom,Qt=ve.canonical.z===pi?Math.ceil(1<<g.transform.maxZoom-ve.canonical.z):1;Yt=s.c(s.bM(xe.maxLineLength/s.J*1024*Qt),256,ye.maxTextureSize)}_t.gradient=s.bN({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:Yt,image:_t.gradient||void 0,clips:xe.lineClipsArray}),_t.texture?_t.texture.update(_t.gradient):_t.texture=new s.a9(ye,_t.gradient,oe.RGBA),_t.version=d.gradientVersion,oi=_t.texture}ye.activeTexture.set(oe.TEXTURE1),oi.bind(d.stepInterpolant?oe.NEAREST:oe.LINEAR,oe.CLAMP_TO_EDGE)}H&&(ye.activeTexture.set(oe.TEXTURE0),Ee.lineAtlasTexture&&Ee.lineAtlasTexture.bind(oe.LINEAR,oe.REPEAT),Pe.updatePaintBuffers()),Q&&(ye.activeTexture.set(oe.TEXTURE0),Ee.imageAtlasTexture&&Ee.imageAtlasTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE),Pe.updatePaintBuffers()),g.uploadCommonUniforms(ye,je,ve.toUnwrapped());const Mt=_t=>{je.draw(g,oe.TRIANGLES,C,_t,R,s.b5.disabled,Fe,d.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,d.paint,g.transform.zoom,Pe,[xe.layoutVertexBuffer2])};if($){const _t=g.stencilModeForClipping(ve).ref;_t===0&&g.terrain&&ye.clear({stencil:0});const oi={func:oe.EQUAL,mask:255};Fe.u_alpha_discard_threshold=.8,Mt(new s.b6(oi,_t,255,oe.KEEP,oe.KEEP,oe.INVERT)),Fe.u_alpha_discard_threshold=0,Mt(new s.b6(oi,_t,255,oe.KEEP,oe.KEEP,oe.KEEP))}else Mt(g.stencilModeForClipping(ve))}$&&(g.resetStencilClippingMasks(),g.terrain&&ye.clear({stencil:0}))},fill:function(g,l,d,v){const w=d.paint.get("fill-color"),S=d.paint.get("fill-opacity");if(S.constantOr(1)===0)return;const A=d.paint.get("fill-emissive-strength"),C=g.colorModeForDrapableLayerRenderPass(A),R=d.paint.get("fill-pattern"),B=g.opaquePassEnabledForLayer()&&!R.constantOr(1)&&w.constantOr(s.C.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===B){const U=g.depthModeForSublayer(1,g.renderPass==="opaque"?s.b4.ReadWrite:s.b4.ReadOnly);Gs(g,l,d,v,U,C,!1)}if(g.renderPass==="translucent"&&d.paint.get("fill-antialias")){const U=g.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,s.b4.ReadOnly);Gs(g,l,d,v,U,C,!0)}},"fill-extrusion":function(g,l,d,v){const w=d.paint.get("fill-extrusion-opacity"),S=g.context,A=S.gl,C=g.terrain,R=C&&C.renderingToTexture;if(w===0)return;const B=g.conflationActive&&g.layerUsedInConflation(d,l.getSource());if(B&&function(U,H,Z,K){for(const Q of K){const te=H.getTile(Q).getBucket(Z);te&&(te.updateReplacement(Q,U.replacementSource),te.uploadCentroid(U.context))}}(g,l,d,v),C||B)for(const U of v){const H=l.getTile(U).getBucket(d);H&&Hh(g.context,l,U,H,d,C,B)}if(g.renderPass==="shadow"&&g.shadowRenderer){const U=g.shadowRenderer;if(C&&w<.65&&d._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.am)return;const H=U.getShadowPassDepthMode(),Z=U.getShadowPassColorMode();il(g,l,d,v,H,s.b6.disabled,Z,B)}else if(g.renderPass==="translucent"){const U=!d.paint.get("fill-extrusion-pattern").constantOr(1),H=d.paint.get("fill-extrusion-color").constantOr(s.C.white);if(!R&&H.a!==0){const Z=new s.b4(g.context.gl.LEQUAL,s.b4.ReadWrite,g.depthRangeFor3D);w===1&&U?il(g,l,d,v,Z,s.b6.disabled,s.a.unblended,B):(il(g,l,d,v,Z,s.b6.disabled,s.a.disabled,B),il(g,l,d,v,Z,g.stencilModeFor3D(),g.colorModeForRenderPass(),B),g.resetStencilClippingMasks())}if(g.style.enable3dLights()&&U&&(!C&&g.transform.projection.name!=="globe"||R)){const Z=d.paint.get("fill-extrusion-opacity"),K=d.paint.get("fill-extrusion-ambient-occlusion-intensity"),Q=d.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),te=d.paint.get("fill-extrusion-flood-light-intensity"),ee=d.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),$=K>0&&Q>0,le=te>0,_e=(oe,he,ve)=>(1-ve)*oe+ve*he,ye=oe=>{const he=g.depthModeForSublayer(1,s.b4.ReadOnly,A.LEQUAL,!0),ve=d.paint.get(oe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ee=_e(.1,3,ve),xe=g._showOverdrawInspector;if(!xe){const Pe=new s.b6({func:A.ALWAYS,mask:255},255,255,A.KEEP,A.KEEP,A.REPLACE),ct=new s.a([A.ONE,A.ONE,A.ONE,A.ONE],s.C.transparent,[!1,!1,!1,!0],A.MIN);Ca(g,l,d,v,he,Pe,ct,s.b5.disabled,oe,"sdf",Z,K,Q,te,ee,Ee,B,!1)}{const Pe=xe?s.b6.disabled:new s.b6({func:A.EQUAL,mask:255},255,255,A.KEEP,A.DECR,A.DECR),ct=xe?g.colorModeForRenderPass():new s.a([A.ONE_MINUS_DST_ALPHA,A.DST_ALPHA,A.ONE,A.ONE],s.C.transparent,[!0,!0,!0,!0]);Ca(g,l,d,v,he,Pe,ct,s.b5.disabled,oe,"color",Z,K,Q,te,ee,Ee,B,!1)}};if(R){const oe=(he,ve,Ee)=>{const xe=g.depthModeForSublayer(1,s.b4.ReadOnly,A.LEQUAL,!1),Pe=d.paint.get(he?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ct=_e(.1,3,Pe);{const je=new s.a([A.ONE,A.ONE,A.ONE,A.ONE],s.C.transparent,[!1,!1,!1,!0]);Ca(g,l,d,v,xe,s.b6.disabled,je,s.b5.disabled,he,"clear",Z,K,Q,te,ee,ct,B,ve)}{const je=new s.b6({func:A.ALWAYS,mask:255},255,255,A.KEEP,A.KEEP,A.REPLACE),et=new s.a([A.ONE,A.ONE,A.ONE,A.ONE],s.C.transparent,[!1,!1,!1,!0],A.MIN);Ca(g,l,d,v,xe,je,et,s.b5.disabled,he,"sdf",Z,K,Q,te,ee,ct,B,ve)}{const je=he?A.ZERO:A.ONE_MINUS_DST_ALPHA,et=new s.b6({func:A.EQUAL,mask:255},255,255,A.KEEP,A.DECR,A.DECR),Le=new s.a([je,A.DST_ALPHA,A.ONE_MINUS_DST_ALPHA,A.ZERO],s.C.transparent,[!0,!0,!0,!0]);Ca(g,l,d,v,xe,et,Le,s.b5.disabled,he,"color",Z,K,Q,te,ee,ct,B,ve)}{const je=new s.a([A.ONE,A.ONE,A.ONE,he?A.ZERO:A.ONE],s.C.transparent,[!1,!1,!1,!0],he?A.FUNC_ADD:A.MAX);Ca(g,l,d,v,xe,s.b6.disabled,je,s.b5.disabled,he,"clear",Z,K,Q,te,ee,ct,B,ve,Ee)}};if($||le){let he;if(g.prepareDrawTile(),C){const ve=C.drapeBufferSize[0],Ee=C.drapeBufferSize[1];he=C.framebufferCopyTexture,he&&(!he||he.size[0]===ve&&he.size[1]===Ee)||(he&&he.destroy(),he=C.framebufferCopyTexture=new s.a9(S,new s.a5({width:ve,height:Ee}),A.RGBA)),he.bind(A.LINEAR,A.CLAMP_TO_EDGE),A.copyTexImage2D(A.TEXTURE_2D,0,A.RGBA,0,0,ve,Ee,0)}$&&oe(!0,!1,he),le&&oe(!1,!0,he)}}else $&&ye(!0),le&&ye(!1)}}},hillshade:function(g,l,d,v){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent"||g.style.disableElevatedTerrain)return;const w=g.context,S=g.terrain&&g.terrain.renderingToTexture,[A,C]=g.renderPass!=="translucent"||S?[{},v]:g.stencilConfigForOverlap(v);for(const R of C){const B=l.getTile(R);if(B.needsHillshadePrepare&&g.renderPass==="offscreen")Vl(g,B,d);else if(g.renderPass==="translucent"){const U=g.depthModeForSublayer(0,s.b4.ReadOnly),H=d.paint.get("hillshade-emissive-strength"),Z=g.colorModeForDrapableLayerRenderPass(H),K=S&&g.terrain?g.terrain.stencilModeForRTTOverlap(R):A[R.overscaledZ];Mu(g,R,B,d,U,K,Z)}}w.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,l,d,v,w,S){if(g.renderPass!=="translucent"||d.paint.get("raster-opacity")===0)return;const A=g.context,C=A.gl,R=l.getSource(),B=function(ve,Ee,xe){const Pe=ve.paint.get("raster-color"),ct=[],je=ve.paint.get("raster-resampling"),et=ve.paint.get("raster-color-mix"),Le=ve.paint.get("raster-color-range"),at=[et[0],et[1],et[2],0],Ke=et[3],dt=je==="nearest"?xe.NEAREST:xe.LINEAR;if(Pe&&ct.push("RASTER_COLOR"),Pe){Ee.activeTexture.set(xe.TEXTURE2);let me=ve.colorRampTexture;me||(me=ve.colorRampTexture=new s.a9(Ee,ve.colorRamp,xe.RGBA)),me.bind(xe.LINEAR,xe.CLAMP_TO_EDGE)}return{mix:at,range:Le,offset:Ke,defines:ct,resampling:dt}}(d,A,C),U=B.defines,H=g.transform.projection.name==="globe";let Z=!1;if(R instanceof s.aK&&!v.length){if(!H)return;if(R.onNorthPole)Z=!0,U.push("GLOBE_POLES");else{if(!R.onSouthPole)return;Z=!0,U.push("GLOBE_POLES")}}const K=d.paint.get("raster-emissive-strength"),Q=g.colorModeForDrapableLayerRenderPass(K),te=g.terrain&&g.terrain.renderingToTexture,ee=R instanceof s.aK&&d.paint.get("raster-elevation")!==0,$=!g.options.moving,le=d.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;if(Z){const ve=l.getSource();if(!(ve instanceof s.aK))return;const Ee=ve.texture;if(!Ee)return;const xe=g.globeSharedBuffers;if(!xe)return;const Pe=new s.b4(C.LEQUAL,s.b4.ReadWrite,g.depthRangeFor3D),ct=Float32Array.from(g.transform.expandedFarZProjMatrix);let je=s.bj(0,0,g.transform);const et=Float32Array.from(s.bh(s.bi(new s.t(0,0,0)))),Le={opacity:1,mix:0};g.terrain&&g.terrain.prepareDrawTile(),A.activeTexture.set(C.TEXTURE0),Ee.bind(le,C.CLAMP_TO_EDGE),A.activeTexture.set(C.TEXTURE1),Ee.bind(le,C.CLAMP_TO_EDGE),Ee.useMipmap&&A.extTextureFilterAnisotropic&&g.transform.pitch>20&&C.texParameterf(C.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);const[at,Ke,dt,me]=xe.getPoleBuffers(0,!0);let Fe;ve.onNorthPole?(Fe=at,g.renderDefaultNorthPole=!1):(je=s.m.scale(s.m.create(),je,[1,-1,1]),Fe=Ke,g.renderDefaultSouthPole=!1);const Mt=((oi,Yt,pi,Qt,Ai,Ii,ui,di,sn,Ni,Hn,Cn)=>Lu(oi,Yt,pi,new Float32Array(16),new Float32Array(9),[0,0],0,[0,0],[0,0,0,0],1,Qt,Ai,[0,0],ui,2,sn,Ni,Hn,1,0,Cn))(ct,et,je,Le,d,0,d.paint.get("raster-elevation"),0,B.mix,B.offset,B.range,K),_t=g.getOrCreateProgram("raster",{defines:B.defines});return g.uploadCommonUniforms(A,_t,null),void _t.draw(g,C.TRIANGLES,Pe,s.b6.disabled,Q,s.b5.disabled,Mt,d.id,Fe,dt,me)}if(!v.length)return;const[_e,ye]=R instanceof s.aK||te?[{},v]:g.stencilConfigForOverlap(v),oe=ye[ye.length-1].overscaledZ,he=ee&&H;he&&B.defines.push("PROJECTION_GLOBE_VIEW"),ee&&B.defines.push("RENDER_CUTOFF");for(const ve of ye){const Ee=ve.toUnwrapped(),xe=l.getTile(ve);if(te&&(!xe||!xe.hasData())||!xe.texture)continue;let Pe,ct;te?(Pe=s.b4.disabled,ct=ve.projMatrix):ee?(Pe=new s.b4(C.LEQUAL,s.b4.ReadWrite,g.depthRangeFor3D),ct=H?Float32Array.from(g.transform.expandedFarZProjMatrix):g.transform.calculateProjMatrix(Ee,$)):(Pe=g.depthModeForSublayer(ve.overscaledZ-oe,d.paint.get("raster-opacity")===1?s.b4.ReadWrite:s.b4.ReadOnly,C.LESS),ct=g.transform.calculateProjMatrix(Ee,$));const je=g.terrain&&te?g.terrain.stencilModeForRTTOverlap(ve):_e[ve.overscaledZ],et=S?0:d.paint.get("raster-fade-duration");xe.registerFadeDuration(et);const Le=l.findLoadedParent(ve,0),at=Ea(xe,Le,l,g.transform,et);let Ke,dt;g.terrain&&g.terrain.prepareDrawTile(),A.activeTexture.set(C.TEXTURE0),xe.texture&&xe.texture.bind(le,C.CLAMP_TO_EDGE),A.activeTexture.set(C.TEXTURE1),Le?(Le.texture&&Le.texture.bind(le,C.CLAMP_TO_EDGE),Ke=Math.pow(2,Le.tileID.overscaledZ-xe.tileID.overscaledZ),dt=[xe.tileID.canonical.x*Ke%1,xe.tileID.canonical.y*Ke%1]):xe.texture&&xe.texture.bind(le,C.CLAMP_TO_EDGE),xe.texture&&xe.texture.useMipmap&&A.extTextureFilterAnisotropic&&g.transform.pitch>20&&C.texParameterf(C.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);const me=g.transform;let Fe;const Mt=ee?Ru(me):[0,0,0,0];let _t,oi,Yt,pi,Qt;he&&R instanceof s.aK&&R.coordinates.length>3?(_t=Float32Array.from(s.bh(s.bi(new s.t(0,0,0)))),oi=Float32Array.from(me.globeMatrix),Yt=Float32Array.from(s.bc(me)),pi=[s.E(me.center.lng),s.H(me.center.lat)],Fe=R.elevatedGlobePerspectiveTransform,Qt=R.elevatedGlobeGridMatrix||new Float32Array(9)):(Fe=R instanceof s.aK?R.perspectiveTransform:[0,0],_t=new Float32Array(16),oi=new Float32Array(9),Yt=new Float32Array(16),pi=[0,0],Qt=new Float32Array(9));const Ai=Lu(ct,_t,oi,Yt,Qt,dt||[0,0],s.ao(g.transform.zoom),pi,Mt,Ke||1,at,d,Fe,ee?d.paint.get("raster-elevation"):0,2,B.mix,B.offset,B.range,1,0,K),Ii=g.isTileAffectedByFog(ve),ui=g.getOrCreateProgram("raster",{defines:B.defines,overrideFog:Ii});if(g.uploadCommonUniforms(A,ui,Ee),R instanceof s.aK){const di=R.elevatedGlobeVertexBuffer,sn=R.elevatedGlobeIndexBuffer;if(te||!H)R.boundsBuffer&&R.boundsSegments&&ui.draw(g,C.TRIANGLES,Pe,s.b6.disabled,Q,s.b5.disabled,Ai,d.id,R.boundsBuffer,g.quadTriangleIndexBuffer,R.boundsSegments);else if(di&&sn){const Ni=me.zoom<=s.Z?R.elevatedGlobeSegments:R.getSegmentsForLongitude(me.center.lng);Ni&&(ui.draw(g,C.TRIANGLES,Pe,s.b6.disabled,Q,s.b5.backCW,Ai,d.id,di,sn,Ni),ui.draw(g,C.TRIANGLES,Pe,s.b6.disabled,Q,s.b5.frontCW,Ai,d.id,di,sn,Ni))}}else{const{tileBoundsBuffer:di,tileBoundsIndexBuffer:sn,tileBoundsSegments:Ni}=g.getTileBoundsBuffers(xe);ui.draw(g,C.TRIANGLES,Pe,je,Q,s.b5.disabled,Ai,d.id,di,sn,Ni)}}g.resetStencilClippingMasks()},background:function(g,l,d,v){const w=d.paint.get("background-color"),S=d.paint.get("background-opacity"),A=d.paint.get("background-emissive-strength");if(S===0)return;const C=g.context,R=C.gl,B=g.transform,U=B.tileSize,H=d.paint.get("background-pattern");if(g.isPatternMissing(H,d.scope))return;const Z=!H&&w.a===1&&S===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==Z)return;const K=s.b6.disabled,Q=g.depthModeForSublayer(0,Z==="opaque"?s.b4.ReadWrite:s.b4.ReadOnly),te=g.colorModeForDrapableLayerRenderPass(A),ee=H?"backgroundPattern":"background";let $,le=v;le||($=g.getBackgroundTiles(),le=Object.values($).map(_e=>_e.tileID)),H&&(C.activeTexture.set(R.TEXTURE0),g.imageManager.bind(g.context,d.scope));for(const _e of le){const ye=g.isTileAffectedByFog(_e),oe=g.getOrCreateProgram(ee,{overrideFog:ye}),he=_e.toUnwrapped(),ve=v?_e.projMatrix:g.transform.calculateProjMatrix(he);g.prepareDrawTile();const Ee=l?l.getTile(_e):$?$[_e.key]:new s.bt(_e,U,B.zoom,g),xe=H?jn(ve,A,S,g,H,d.scope,{tileID:_e,tileSize:U}):Ri(ve,A,S,w);g.uploadCommonUniforms(C,oe,he);const{tileBoundsBuffer:Pe,tileBoundsIndexBuffer:ct,tileBoundsSegments:je}=g.getTileBoundsBuffers(Ee);oe.draw(g,R.TRIANGLES,Q,K,te,s.b5.disabled,xe,d.id,Pe,ct,je)}},sky:function(g,l,d){const v=g._atmosphere?s.ao(g.transform.zoom):1,w=d.paint.get("sky-opacity")*v;if(w===0)return;const S=g.context,A=d.paint.get("sky-type"),C=new s.b4(S.gl.LEQUAL,s.b4.ReadOnly,[0,1]),R=g.frameCounter/1e3%1;A==="atmosphere"?g.renderPass==="offscreen"?d.needsSkyboxCapture(g)&&(function(B,U,H,Z){const K=B.context,Q=K.gl;let te=U.skyboxFbo;if(!te){te=U.skyboxFbo=K.createFramebuffer(32,32,!0,null),U.skyboxGeometry=new Zo(K),U.skyboxTexture=K.gl.createTexture(),Q.bindTexture(Q.TEXTURE_CUBE_MAP,U.skyboxTexture),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MAG_FILTER,Q.LINEAR);for(let _e=0;_e<6;++_e)Q.texImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0,Q.RGBA,32,32,0,Q.RGBA,Q.UNSIGNED_BYTE,null)}K.bindFramebuffer.set(te.framebuffer),K.viewport.set([0,0,32,32]);const ee=U.getCenter(B,!0),$=B.getOrCreateProgram("skyboxCapture"),le=new Float64Array(16);s.m.identity(le),s.m.rotateY(le,le,.5*-Math.PI),ms(B,U,$,le,ee,0),s.m.identity(le),s.m.rotateY(le,le,.5*Math.PI),ms(B,U,$,le,ee,1),s.m.identity(le),s.m.rotateX(le,le,.5*-Math.PI),ms(B,U,$,le,ee,2),s.m.identity(le),s.m.rotateX(le,le,.5*Math.PI),ms(B,U,$,le,ee,3),s.m.identity(le),ms(B,U,$,le,ee,4),s.m.identity(le),s.m.rotateY(le,le,Math.PI),ms(B,U,$,le,ee,5),K.viewport.set([0,0,B.width,B.height])}(g,d),d.markSkyboxValid(g)):g.renderPass==="sky"&&function(B,U,H,Z,K){const Q=B.context,te=Q.gl,ee=B.transform,$=B.getOrCreateProgram("skybox");Q.activeTexture.set(te.TEXTURE0),te.bindTexture(te.TEXTURE_CUBE_MAP,U.skyboxTexture);const le=((_e,ye,oe,he,ve)=>({u_matrix:_e,u_sun_direction:ye,u_cubemap:0,u_opacity:he,u_temporal_offset:ve}))(ee.skyboxMatrix,U.getCenter(B,!1),0,Z,K);B.uploadCommonUniforms(Q,$),$.draw(B,te.TRIANGLES,H,s.b6.disabled,B.colorModeForRenderPass(),s.b5.backCW,le,"skybox",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(g,d,C,w,R):A==="gradient"&&g.renderPass==="sky"&&function(B,U,H,Z,K){const Q=B.context,te=Q.gl,ee=B.transform,$=B.getOrCreateProgram("skyboxGradient");U.skyboxGeometry||(U.skyboxGeometry=new Zo(Q)),Q.activeTexture.set(te.TEXTURE0);let le=U.colorRampTexture;le||(le=U.colorRampTexture=new s.a9(Q,U.colorRamp,te.RGBA)),le.bind(te.LINEAR,te.CLAMP_TO_EDGE);const _e=((ye,oe,he,ve,Ee)=>({u_matrix:ye,u_color_ramp:0,u_center_direction:oe,u_radius:s.d(he),u_opacity:ve,u_temporal_offset:Ee}))(ee.skyboxMatrix,U.getCenter(B,!1),U.paint.get("sky-gradient-radius"),Z,K);B.uploadCommonUniforms(Q,$),$.draw(B,te.TRIANGLES,H,s.b6.disabled,B.colorModeForRenderPass(),s.b5.backCW,_e,"skyboxGradient",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(g,d,C,w,R)},debug:function(g,l,d,v,w){for(let S=0;S<d.length;S++)if(w){const R=new s.C(v.r*.8,v.g*.8,v.b*.8,1);Wo(g,l,d[S],v,-1,-1),Wo(g,l,d[S],v,-1,1),Wo(g,l,d[S],v,1,1),Wo(g,l,d[S],v,1,-1),Wo(g,l,d[S],R,0,0)}else Wo(g,l,d[S],v,0,0)},custom:function(g,l,d,v){const w=g.context,S=d.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||g.renderPass==="offscreen")&&d.isLayerDraped(l)){if(g.renderPass==="offscreen"){const A=S.prerender;if(A){if(g.setCustomLayerDefaults(),w.setColorMode(g.colorModeForRenderPass()),g.transform.projection.name==="globe"){const C=g.transform.pointMerc;A.call(S,w.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),s.ao(g.transform.zoom),[C.x,C.y],g.transform.pixelsPerMeterRatio)}else A.call(S,w.gl,g.transform.customLayerMatrix());w.setDirty(),g.setBaseState()}}else if(g.renderPass==="translucent"){if(g.terrain&&g.terrain.renderingToTexture){const C=S.renderToTile;if(C){const R=v[0].canonical,B=new s.M(R.x+v[0].wrap*(1<<R.z),R.y,R.z);w.setDepthMode(s.b4.disabled),w.setStencilMode(s.b6.disabled),w.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),C.call(S,w.gl,B),w.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),w.setColorMode(g.colorModeForRenderPass()),w.setStencilMode(s.b6.disabled);const A=S.renderingMode==="3d"?new s.b4(g.context.gl.LEQUAL,s.b4.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,s.b4.ReadOnly);if(w.setDepthMode(A),g.transform.projection.name==="globe"){const C=g.transform.pointMerc;S.render(w.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),s.ao(g.transform.zoom),[C.x,C.y],g.transform.pixelsPerMeterRatio)}else S.render(w.gl,g.transform.customLayerMatrix());w.setDirty(),g.setBaseState(),w.bindFramebuffer.set(null)}}else s.X("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(g,l,d,v){if(g.renderPass==="opaque")return;const w=d.paint.get("model-opacity");if(w===0)return;const S=d.paint.get("model-cast-shadows");if(g.renderPass==="shadow"&&(!S||g.terrain&&w<.65&&d._transitionablePaint._values["model-opacity"].value.expression instanceof s.am))return;const A=g.shadowRenderer,C=d.paint.get("model-receive-shadows");A&&(A.useNormalOffset=!0,C||(A.enabled=!1));const R=()=>{A&&(A.useNormalOffset=!0,C||(A.enabled=!0))},B=l.getSource();if(g.renderPass==="light-beam"&&B.type!=="batched-model")return;if(B.type==="vector"||B.type==="geojson")return function($,le,_e,ye){const oe=$.transform;if(oe.projection.name!=="mercator")return void s.X(`Drawing 3D models for ${oe.projection.name} projection is not yet implemented`);const he=oe.getFreeCameraOptions().position;if(!$.modelManager)return;const ve=$.modelManager,Ee=$.shadowRenderer;if(!_e._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const xe=_e._unevaluatedLayout._values["model-id"],Pe={..._e.layout.get("model-id").parameters};for(const ct of ye){const je=le.getTile(ct).getBucket(_e);if(!je||je.projection.name!==oe.projection.name)continue;const et=Ry(ct,oe);Pe.zoom=et;const Le=xe.possiblyEvaluate(Pe);if(Oy($,je,ct),Ms.shadowUniformsInitialized=!1,Ms.useSingleShadowCascade=!!Ee&&Ee.getMaxCascadeForTile(ct.toUnwrapped())===0,$.renderPass==="shadow"&&Ee){if($.currentShadowCascade===1&&je.isInsideFirstShadowMapFrustum)continue;const dt=oe.calculatePosMatrix(ct.toUnwrapped(),oe.worldSize);if(Ms.tileMatrix.set(dt),Ms.shadowTileMatrix=Float32Array.from(Ee.calculateShadowPassMatrixFromMatrix(dt)),Ms.aabb.min.fill(0),Ms.aabb.max[0]=Ms.aabb.max[1]=s.J,Ms.aabb.max[2]=0,_m(je,Ms,$,_e.scope))continue}const at=1<<ct.canonical.z,Ke=[((he.x-ct.wrap)*at-ct.canonical.x)*s.J,(he.y*at-ct.canonical.y)*s.J,he.z*at*s.J];for(let dt in je.instancesPerModel){const me=je.instancesPerModel[dt];me.features.length>0&&(dt=Le.evaluate(me.features[0].feature,{}));const Fe=ve.getModel(dt,_e.scope);if(Fe&&Fe.uploaded)for(const Mt of Fe.nodes)Fu($,_e,Mt,me,Ke,ct,Ms)}}}(g,l,d,v),void R();if(!B.loaded())return;if(B.type==="batched-model")return function($,le,_e,ye){const oe=$.context,he=$.transform,ve=$.style.fog,Ee=$.shadowRenderer;if(he.projection.name!=="mercator")return void s.X(`Drawing 3D landmark models for ${he.projection.name} projection is not yet implemented`);const xe=$.transform.getFreeCameraOptions().position,Pe=s.v.scale([],[xe.x,xe.y,xe.z],$.transform.worldSize);s.v.negate(Pe,Pe);const ct=s.m.identity([]),je=s.c4(he.center.lat,he.zoom),et=s.m.fromScaling([],[1,1,1/je]);s.m.translate(ct,ct,Pe);const Le=_e.paint.get("model-opacity"),at=new s.b4(oe.gl.LEQUAL,s.b4.ReadWrite,$.depthRangeFor3D),Ke=new s.b4(oe.gl.LEQUAL,s.b4.ReadOnly,$.depthRangeFor3D),dt=function(me,Fe){for(const Mt of ye){const _t=le.getTile(Mt).getBucket(_e);if(!_t||!_t.uploaded)continue;let oi=!1;Ee&&(oi=Ee.getMaxCascadeForTile(Mt.toUnwrapped())===0);const Yt=he.calculatePosMatrix(Mt.toUnwrapped(),he.worldSize),pi=_t.modelTraits;for(const Qt of _t.getNodesInfo()){if(Qt.hiddenByReplacement||!Qt.node.meshes)continue;const Ai=Qt.node,Ii=$.renderPass==="light-beam",ui=[...Yt],di=Qt.evaluatedScale;let sn=0;$.terrain&&Ai.elevation&&(sn=Ai.elevation*$.terrain.exaggeration()),s.m.translate(ui,ui,[(Ai.anchor?Ai.anchor[0]:0)*(di[0]-1),(Ai.anchor?Ai.anchor[1]:0)*(di[1]-1),sn]),di!==s.c6&&s.m.scale(ui,ui,di),s.m.multiply(ui,ui,Ai.matrix);const Ni=s.m.multiply([],et,ui);s.m.multiply(Ni,ct,Ni);const Hn=s.m.invert([],Ni);s.m.transpose(Hn,Hn),s.m.scale(Hn,Hn,zy);const Cn=s.m.multiply([],he.expandedFarZProjMatrix,ui),Fo=pi&s.c8.HasMapboxMeshFeatures,As=Fo?0:Qt.evaluatedRMEA[0][2];for(let Mn=0;Mn<Ai.meshes.length;++Mn){const hn=Ai.meshes[Mn],_n=Mn===Ai.lightMeshIndex;if(_n){if(!Ii&&!$.terrain&&$.shadowRenderer){$.currentLayer<$.firstLightBeamLayer&&($.firstLightBeamLayer=$.currentLayer);continue}}else if(Ii)continue;const er={defines:[]},eo=[];ff(er.defines,eo,hn,$),Fo||er.defines.push("DIFFUSE_SHADED"),oi&&er.defines.push("SHADOWS_SINGLE_CASCADE");const Yn=$.renderPass==="shadow";if(Yn){zu(hn,ui,$,_e);continue}let vo=null;if(ve){const qs=qh(ui,$.transform);if(vo=new Float32Array(qs),he.projection.name!=="globe"){const kn=hn.aabb.min,Ws=hn.aabb.max,[ua,Oa]=ve.getOpacityForBounds(qs,kn[0],kn[1],Ws[0],Ws[1]);er.overrideFog=ua>=Eo||Oa>=Eo}}const Bo=$.getOrCreateProgram("model",er);!Yn&&Ee&&(Ee.useNormalOffset=!!hn.normalBuffer,Ee.setupShadowsFromMatrix(ui,Bo,Ee.useNormalOffset)),$.uploadCommonUniforms(oe,Bo,Mt.toUnwrapped(),vo);const xo=hn.material,Is=xo.pbrMetallicRoughness;Is.metallicFactor=.9,Is.roughnessFactor=.5;const La=ar(new Float32Array(Cn),new Float32Array(Ni),new Float32Array(Hn),$,Le,Is.baseColorFactor,xo.emissiveFactor,Is.metallicFactor,Is.roughnessFactor,xo,As,_e);Bo.draw($,oe.gl.TRIANGLES,Fe&&!_n?at:Ke,s.b6.disabled,me?_n||Le<1||Qt.hasTranslucentParts?s.a.alphaBlended:s.a.unblended:s.a.disabled,s.b5.backCCW,La,_e.id,hn.vertexBuffer,hn.indexBuffer,hn.segments,_e.paint,$.transform.zoom,void 0,eo)}}}};(function(me,Fe,Mt,_t){const oi=me.terrain?me.terrain.exaggeration():0,Yt=me.transform.zoom;for(const pi of _t){const Qt=Fe.getTile(pi).getBucket(Mt);Qt&&(me.conflationActive&&Qt.updateReplacement(pi,me.replacementSource),Qt.evaluateScale(me,Mt),me.terrain&&oi>0&&Qt.elevationUpdate(me.terrain,oi,pi,Mt.source),Qt.needsReEvaluation(me,Yt,Mt)&&Qt.evaluate(Mt))}})($,le,_e,ye),Le===1?dt(!0,!0):(dt(!1,!0),dt(!0,!1))}(g,l,d,v),void R();const U=B.getModels(),H=[],Z=g.transform.getFreeCameraOptions().position,K=s.v.scale([],[Z.x,Z.y,Z.z],g.transform.worldSize);s.v.negate(K,K);const Q=[],te=[];let ee=0;for(const $ of U){const le=d.paint.get("model-rotation").constantOr(null),_e=d.paint.get("model-scale").constantOr(null),ye=d.paint.get("model-translation").constantOr(null);$.computeModelMatrix(g,le,_e,ye,!0,!0,!1);const oe=s.m.identity([]),he=s.c4($.position.lat,g.transform.zoom),ve=s.m.fromScaling([],[1,1,1/he]);s.m.translate(oe,oe,K),H.push({zScaleMatrix:ve,negCameraPosMatrix:oe});for(const Ee of $.nodes)gm(g.transform,Ee,$.matrix,g.transform.expandedFarZProjMatrix,ee,Q,te);ee++}if(Q.sort(($,le)=>le.depth-$.depth),g.renderPass!=="shadow"){if(w===1)for(const $ of te)Xl($,g,d,H[$.modelIndex],s.b6.disabled,g.colorModeForRenderPass());else{for(const $ of te)Xl($,g,d,H[$.modelIndex],s.b6.disabled,s.a.disabled);for(const $ of te)Xl($,g,d,H[$.modelIndex],g.stencilModeFor3D(),g.colorModeForRenderPass());g.resetStencilClippingMasks()}for(const $ of Q)Xl($,g,d,H[$.modelIndex],s.b6.disabled,g.colorModeForRenderPass());R()}else{for(const $ of te)zu($.mesh,$.nodeModelMatrix,g,d);for(const $ of Q)zu($.mesh,$.nodeModelMatrix,g,d);R()}}},xm={modelUpload:function(g,l,d){const v=l.getSource();if(!v.loaded())return;if(v.type==="vector"||v.type==="geojson")return void(g.modelManager&&g.modelManager.upload(g,d));if(v.type==="batched-model")return;const w=v.getModels();for(const S of w)S.upload(g.context)}};class Fy{constructor(l,d,v,w){this.context=new Fn(l,d),this.transform=v,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=w,this._debugParams={showTerrainProxyTiles:!1},w.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=s.bq.maxUnderzooming+s.bq.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.ca,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new gf(this),this._wireframeDebugCache=new zc,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(l,d){const v=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(v||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ia(this,l));const w=this._terrain;this.transform.elevation=v?w:null,w.update(l,this.transform,d),this.transform.elevation&&!w.enabled&&(this.transform.elevation=null)}_updateFog(l){const d=l.fog;if(!d||this.transform.projection.name==="globe"||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[v,w]=d.getFovAdjustedRange(this.transform._fov);if(v>w)return void(this.transform.fogCullDistSq=null);const S=v+.78*(w-v);this.transform.fogCullDistSq=S*S}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(l,d){if(this.width=l*s.a4.devicePixelRatio,this.height=d*s.a4.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style.order)this.style._mergedLayers[v].resize()}setup(){const l=this.context,d=new s.bo;d.emplaceBack(0,0),d.emplaceBack(s.J,0),d.emplaceBack(0,s.J),d.emplaceBack(s.J,s.J),this.tileExtentBuffer=l.createVertexBuffer(d,s.bl.members),this.tileExtentSegments=s.bm.simpleSegment(0,0,4,2);const v=new s.bo;v.emplaceBack(0,0),v.emplaceBack(s.J,0),v.emplaceBack(0,s.J),v.emplaceBack(s.J,s.J),this.debugBuffer=l.createVertexBuffer(v,s.bl.members),this.debugSegments=s.bm.simpleSegment(0,0,4,5);const w=new s.bo;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(w,s.bl.members),this.viewportSegments=s.bm.simpleSegment(0,0,4,2);const S=new s.cb;S.emplaceBack(0,0,0,0),S.emplaceBack(s.J,0,s.J,0),S.emplaceBack(0,s.J,0,s.J),S.emplaceBack(s.J,s.J,s.J,s.J),this.mercatorBoundsBuffer=l.createVertexBuffer(S,s.cc.members),this.mercatorBoundsSegments=s.bm.simpleSegment(0,0,4,2);const A=new s.bp;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(A);const C=new s.cd;for(const B of[0,1,3,2,0])C.emplaceBack(B);this.debugIndexBuffer=l.createIndexBuffer(C),this.emptyTexture=new s.a9(l,new s.a5({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA),this.identityMat=s.m.create();const R=this.context.gl;this.stencilClearMode=new s.b6({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,l.TRIANGLES,s.b4.disabled,this.stencilClearMode,s.a.disabled,s.b5.disabled,bs(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,d,v){if(!d||this.currentStencilSource===d.id||!l.isTileClipped()||!v||v.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const R of v)if(this._tileClippingMaskIDs[R.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=d.id;const w=this.context,S=w.gl;this.nextStencilID+v.length>256&&this.clearStencil(),w.setColorMode(s.a.disabled),w.setDepthMode(s.b4.disabled);const A=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of v){const R=d.getTile(C),B=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:U,tileBoundsIndexBuffer:H,tileBoundsSegments:Z}=this.getTileBoundsBuffers(R);A.draw(this,S.TRIANGLES,s.b4.disabled,new s.b6({func:S.ALWAYS,mask:0},B,255,S.KEEP,S.KEEP,S.REPLACE),s.a.disabled,s.b5.disabled,bs(C.projMatrix),"$clipping",U,H,Z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,d=this.context.gl;return new s.b6({func:d.NOTEQUAL,mask:255},l,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const d=this.context.gl;return new s.b6({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(l){const d=this.context.gl,v=l.sort((A,C)=>C.overscaledZ-A.overscaledZ),w=v[v.length-1].overscaledZ,S=v[0].overscaledZ-w+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const A={};for(let C=0;C<S;C++)A[C+w]=new s.b6({func:d.GEQUAL,mask:255},C+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=S,[A,v]}return[{[w]:s.b6.disabled},v]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new s.a([l.CONSTANT_COLOR,l.ONE,l.CONSTANT_COLOR,l.ONE],new s.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.a.unblended:s.a.alphaBlended}colorModeForDrapableLayerRenderPass(l){const d=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new s.a([d.ONE,d.ONE_MINUS_SRC_ALPHA,d.CONSTANT_ALPHA,d.ONE_MINUS_SRC_ALPHA],new s.C(0,0,0,l===void 0?0:l),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(l,d,v,w=!1){if(!this.opaquePassEnabledForLayer()&&!w)return s.b4.disabled;const S=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new s.b4(v||this.context.gl.LEQUAL,d,[S,S])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,d){this._wireframeDebugCache.update(this.frameCounter),this.style=l,this.options=d;const v=this.style._mergedLayers,w=this.style.order,S=w.map(oe=>v[oe]),A=this.style._mergedSourceCaches;this.imageManager=l.imageManager,this.modelManager=l.modelManager,this.symbolFadeChange=l.placement.symbolFadeChange(s.a4.now()),this.imageManager.beginFrame();let C=0,R=!1;for(const oe in A){const he=A[oe];he.used&&(he.prepare(this.context),he.getSource().usedInConflation&&++C)}const B={},U={},H={},Z={},K={};for(const oe in A){const he=A[oe];B[oe]=he.getVisibleCoordinates(),U[oe]=B[oe].slice().reverse(),H[oe]=he.getVisibleCoordinates(!0).reverse(),Z[oe]=he.getShadowCasterCoordinates(),K[oe]=he.sortCoordinatesByDistance(B[oe])}const Q=oe=>{const he=this.style.getLayerSourceCache(oe);return he&&he.used?he.getSource():null};if(C){const oe=[];for(const he of S)this.layerUsedInConflation(he,Q(he))&&oe.push(he);if(oe&&oe.length>1){const he=[];for(const ve of oe){const Ee=this.style.getLayerSourceCache(ve);Ee&&Ee.used&&Ee.getSource().usedInConflation&&he.push({layer:ve.fqid,cache:Ee})}this.replacementSource.setSources(he),R=!0}}R||this.replacementSource.clear(),this.conflationActive=R,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const oe of S){const he=oe.cutoffRange();if(this.longestCutoffRange=Math.max(he,this.longestCutoffRange),he>0){const ve=Q(oe);ve&&(this.minCutoffZoom=Math.max(ve.minzoom,this.minCutoffZoom)),oe.minzoom&&(this.minCutoffZoom=Math.max(oe.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let oe=0;oe<S.length;oe++)if(S[oe].is3D()){this.opaquePassCutoff=oe;break}const te=this.style&&this.style.fog;te?(this._fogVisible=te.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=te.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(H),this.opaquePassCutoff=0);const ee=this._shadowRenderer;if(ee){ee.updateShadowParameters(this.transform,this.style.directionalLight);for(const oe in A)for(const he of B[oe]){let ve={min:0,max:0};this.terrain&&(ve=this.terrain.getMinMaxForTile(he)||ve),ee.addShadowReceiver(he.toUnwrapped(),ve.min,ve.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.ce(this.context));for(const oe of S){if(oe.isHidden(this.transform.zoom))continue;const he=l.getLayerSourceCache(oe);this.uploadLayer(this,oe,he)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ly(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!s.cf(this.context.gl))return;this.renderPass="offscreen";for(const oe of S){const he=l.getLayerSourceCache(oe);if(!oe.hasOffscreenPass()||oe.isHidden(this.transform.zoom))continue;const ve=he?U[he.id]:void 0;(oe.type==="custom"||oe.type==="raster"||oe.isSky()||ve&&ve.length)&&this.renderLayer(this,he,oe,ve)}this.depthRangeFor3D=[0,1-(S.length+2)*this.numSublayers*this.depthEpsilon];const $=this.terrain;$&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&$.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Z)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const le=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),_e=(()=>{if(d.showOverdrawInspector)return s.C.black;if(this.style.fog&&this.transform.projection.supportsFog&&!le){const oe=this.style.fog.properties.get("color").toArray01();return new s.C(...oe)}if(this.style.fog&&this.transform.projection.supportsFog&&le){const oe=this.style.fog.properties.get("space-color").toArray01();return new s.C(...oe)}return s.C.transparent})();if(this.context.clear({color:_e,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&le&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const oe=S[this.currentLayer],he=l.getLayerSourceCache(oe);if(oe.isSky())continue;const ve=he?(oe.is3D()?K:U)[he.id]:void 0;this._renderTileClippingMasks(oe,he,ve),this.renderLayer(this,he,oe,ve)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&le&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.ao(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const oe=S[this.currentLayer],he=l.getLayerSourceCache(oe);oe.isSky()&&this.renderLayer(this,he,oe,he?U[he.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ye=0;for(ee&&(ye=ee.getShadowCastingLayerCount());this.currentLayer<w.length;){const oe=S[this.currentLayer],he=l.getLayerSourceCache(oe);if(oe.isSky()){++this.currentLayer;continue}if($&&this.style.isLayerDraped(oe)){if(oe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=$.renderBatch(this.currentLayer);continue}let ve;if(he&&(ve=(oe.type==="symbol"?H:oe.is3D()?K:U)[he.id]),this._renderTileClippingMasks(oe,he,he?B[he.id]:void 0),this.renderLayer(this,he,oe,ve),!$&&ee&&ye>0&&oe.hasShadowPass()&&--ye==0&&(ee.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Ee=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ee;this.currentLayer++){const xe=S[this.currentLayer];if(!xe.hasLightBeamPass())continue;const Pe=l.getLayerSourceCache(xe);this.renderLayer(this,Pe,xe,Pe?U[Pe.id]:void 0)}this.currentLayer=Ee,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let oe=null;S.forEach(he=>{const ve=l.getLayerSourceCache(he);ve&&!he.isHidden(this.transform.zoom)&&ve.getVisibleCoordinates().length&&(!oe||oe.getSource().maxzoom<ve.getSource().maxzoom)&&(oe=ve)}),oe&&this.options.showTileBoundaries&&pf.debug(this,oe,oe.getVisibleCoordinates(),s.C.red,!1)}this.terrain&&this._debugParams.showTerrainProxyTiles&&pf.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.C(1,.8,.1,1),!0),this.options.showPadding&&function(oe){const he=oe.transform.padding;la(oe,oe.transform.height-(he.top||0),3,Co),la(oe,he.bottom||0,3,fs),ka(oe,he.left||0,3,Ss),ka(oe,oe.transform.width-(he.right||0),3,Pa);const ve=oe.transform.centerPoint;(function(Ee,xe,Pe,ct){ps(Ee,xe-1,Pe-10,2,20,ct),ps(Ee,xe-10,Pe-1,20,2,ct)})(oe,ve.x,oe.transform.height-ve.y,Wl)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),R||(this.conflationActive=!1)}uploadLayer(l,d,v){this.gpuTimingStart(d),(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes(d.type)||l.terrain&&d.type==="custom")&&xm[`${d.type}Upload`]&&xm[`${d.type}Upload`](l,v,d.scope),this.gpuTimingEnd()}renderLayer(l,d,v,w){v.isHidden(this.transform.zoom)||(v.type==="background"||v.type==="sky"||v.type==="custom"||v.type==="model"||v.type==="raster"||w&&w.length)&&(this.id=v.id,this.gpuTimingStart(v),(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes(v.type)||l.terrain&&v.type==="custom")&&pf[v.type](l,d,v,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery,v=this.context.gl;let w=this.gpuTimers[l.id];w||(w=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:v.createQuery()}),w.calls++,v.beginQuery(d.TIME_ELAPSED_EXT,w.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const l=this.context.extTimerQuery,d=this.context.gl,v=d.createQuery();this.deferredRenderGpuTimeQueries.push(v),d.beginQuery(l.TIME_ELAPSED_EXT,v)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){const l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){const d={};for(const v in l){const w=l[v],S=this.context.extTimerQuery,A=S.getQueryParameter(w.query,this.context.gl.QUERY_RESULT)/1e6;S.deleteQueryEXT(w.query),d[v]=A}return d}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;const d=this.context.extTimerQuery,v=this.context.gl;let w=0;for(const S of l)w+=d.getQueryParameter(S,v.QUERY_RESULT)/1e6,d.deleteQueryEXT(S);return w}translatePosMatrix(l,d,v,w,S){if(!v[0]&&!v[1])return l;const A=S?w==="map"?this.transform.angle:0:w==="viewport"?-this.transform.angle:0;if(A){const B=Math.sin(A),U=Math.cos(A);v=[v[0]*U-v[1]*B,v[0]*B+v[1]*U]}const C=[S?v[0]:s.ay(d,v[0],this.transform.zoom),S?v[1]:s.ay(d,v[1],this.transform.zoom),0],R=new Float32Array(16);return s.m.translate(R,l,C),R}saveTileTexture(l){const d=l.size[0],v=this._tileTextures[d];v?v.push(l):this._tileTextures[d]=[l]}getTileTexture(l){const d=this._tileTextures[l];return d&&d.length>0?d.pop():null}isPatternMissing(l,d){return l===null||l!==void 0&&!this.imageManager.getPattern(l.toString(),d)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(l,d,v){const w=v===void 0?this.terrain&&this.terrain.renderingToTexture:v,S=this.terrain&&this.terrain.exaggeration()===0,A=[];return this.style&&this.style.enable3dLights()&&(l==="globeRaster"||l==="terrainRaster"?(A.push("LIGHTING_3D_MODE"),A.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):w||A.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||A.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?A.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):A.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(A.push("TERRAIN"),this.linearFloatFilteringSupported()&&A.push("TERRAIN_DEM_FLOAT_FORMAT"),S&&A.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&A.push("GLOBE"),!this._fogVisible||w||d!==void 0&&!d||A.push("FOG","FOG_DITHERING"),w&&A.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&A.push("OVERDRAW_INSPECTOR"),A}getOrCreateProgram(l,d){this.cache=this.cache||{};const v=d&&d.defines||[],w=d&&d.config,S=this.currentGlobalDefines(l,d&&d.overrideFog,d&&d.overrideRtt).concat(v),A=Dc.cacheKey(Tu[l],l,S,w);return this.cache[A]||(this.cache[A]=new Dc(this.context,l,Tu[l],w,Br[l],S)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.a9(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(l,d){if(this.style.enable3dLights()){const v=this.style.directionalLight,w=this.style.ambientLight;if(v&&w){const S=((A,C)=>{const R=A.properties.get("direction"),B=A.properties.get("color").toArray01(),U=A.properties.get("intensity"),H=C.properties.get("color").toArray01(),Z=C.properties.get("intensity"),K=[R.x,R.y,R.z],Q=s.bv(H,Z),te=s.bv(B,U);return{u_lighting_ambient_color:Q,u_lighting_directional_dir:K,u_lighting_directional_color:te,u_ground_radiance:Cu(K,te,Q)}})(v,w);d.setLightsUniformValues(l,S)}}}uploadCommonUniforms(l,d,v,w,S){if(this.uploadCommonLightUniforms(l,d),this.terrain&&this.terrain.renderingToTexture)return;const A=this.style.fog;if(A){const C=A.getOpacity(this.transform.pitch),R=((B,U,H,Z,K,Q,te,ee,$,le,_e,ye)=>{const oe=B.transform,he=U.properties.get("color").toArray01();he[3]=Z;const ve=B.frameCounter/1e3%1,[Ee,xe]=U.properties.get("vertical-range");return{u_fog_matrix:H?oe.calculateFogTileMatrix(H):ye||B.identityMat,u_fog_range:U.getFovAdjustedRange(oe._fov),u_fog_color:he,u_fog_horizon_blend:U.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ee,xe),xe],u_fog_temporal_offset:ve,u_frustum_tl:K,u_frustum_tr:Q,u_frustum_br:te,u_frustum_bl:ee,u_globe_pos:$,u_globe_radius:le,u_viewport:_e,u_globe_transition:s.ao(oe.zoom),u_is_globe:+(oe.projection.name==="globe")}})(this,A,v,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.a4.devicePixelRatio,this.transform.height*s.a4.devicePixelRatio],w);d.setFogUniformValues(l,R)}S&&d.setCutoffUniformValues(l,S.uniformValues)}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){const l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){const l=this.context.gl,d=l.createTexture();return l.bindTexture(l.TEXTURE_2D,d),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&l.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const l=this._backgroundTiles,d=this._backgroundTiles={},v=this.transform.coveringTiles({tileSize:512});for(const w of v)d[w.key]=l[w.key]||new s.bt(w,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(l,d){return!(!l.is3D()||l.minzoom&&l.minzoom>this.transform.zoom||l.sourceLayer!=="building"&&(!d||d.type!=="batched-model"))}isTileAffectedByFog(l){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let d=this._cachedTileFogOpacities[l.key];return d||(this._cachedTileFogOpacities[l.key]=d=this.style.fog.getOpacityForTile(l)),d[0]>=Eo||d[1]>=Eo}}const Xo={cascadeCount:2,shadowMapResolution:2048};class By{constructor(l,d){this.aabb=l,this.lastCascade=d}}class mf{add(l,d){const v=this.receivers[l.key];v!==void 0?(v.aabb.min[0]=Math.min(v.aabb.min[0],d.min[0]),v.aabb.min[1]=Math.min(v.aabb.min[1],d.min[1]),v.aabb.min[2]=Math.min(v.aabb.min[2],d.min[2]),v.aabb.max[0]=Math.max(v.aabb.max[0],d.max[0]),v.aabb.max[1]=Math.max(v.aabb.max[1],d.max[1]),v.aabb.max[2]=Math.max(v.aabb.max[2],d.max[2])):this.receivers[l.key]=new By(d,null)}clear(){this.receivers={}}get(l){return this.receivers[l.key]}computeRequiredCascades(l,d,v){const w=s.c3.fromPoints(l.points);let S=0;for(const A in this.receivers){const C=this.receivers[A];if(!C||!w.intersectsAabb(C.aabb))continue;C.aabb.min=w.closestPoint(C.aabb.min),C.aabb.max=w.closestPoint(C.aabb.max);const R=C.aabb.getCorners();for(let B=0;B<v.length;B++){let U=!0;for(const H of R){const Z=[H[0]*d,H[1]*d,H[2]];if(s.v.transformMat4(Z,Z,v[B].matrix),Z[0]<-1||Z[0]>1||Z[1]<-1||Z[1]>1){U=!1;break}}if(C.lastCascade=B,S=Math.max(S,B),U)break}}return S+1}}class gf{constructor(l){this.painter=l,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new mf,this._depthMode=new s.b4(l.context.gl.LEQUAL,s.b4.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,l.tp.registerParameter(Xo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),l.tp.registerParameter(Xo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(const l of this._cascades)l.texture.destroy(),l.framebuffer.destroy();this._cascades=[]}updateShadowParameters(l,d){const v=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!d||!d.properties)return;const w=d.properties.get("shadow-intensity");if(!d.shadowsEnabled()||w<=0||(this._shadowLayerCount=v.style.order.reduce((Q,te)=>{const ee=v.style._mergedLayers[te];return Q+(ee.hasShadowPass()&&!ee.isHidden(l.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const S=v.context,A=Xo.shadowMapResolution,C=Xo.shadowMapResolution;if(this._cascades.length===0||Xo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Q=0;Q<Xo.cascadeCount;++Q){const te=v._shadowMapDebug,ee=S.gl,$=S.createFramebuffer(A,C,te,"texture"),le=new s.a9(S,{width:A,height:C,data:null},ee.DEPTH_COMPONENT);if($.depthAttachment.set(le.texture),te){const _e=new s.a9(S,{width:A,height:C,data:null},ee.RGBA);$.colorAttachment.set(_e.texture)}this._cascades.push({framebuffer:$,texture:le,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.F,scale:0})}}this.shadowDirection=_f(d);let R=0;if(l.elevation){const Q=l.elevation,te=[1e4,-1e4];Q.visibleDemTiles.filter(ee=>ee.dem).forEach(ee=>{const $=ee.dem.tree;te[0]=Math.min(te[0],$.minimums[0]),te[1]=Math.max(te[1],$.maximums[0])}),te[0]!==1e4&&(R=(te[1]-te[0])*Q.exaggeration())}const B=1.5*l.cameraToCenterDistance,U=3*B,H=new Float64Array(16);for(let Q=0;Q<this._cascades.length;++Q){const te=this._cascades[Q];let ee=l.height/50,$=1;Xo.cascadeCount===1?$=U:Q===0?$=B:(ee=B,$=U);const[le,_e]=bm(l,this.shadowDirection,ee,$,Xo.shadowMapResolution,R);te.scale=l.scale,te.matrix=le,te.boundingSphereRadius=_e,s.m.invert(H,te.matrix),te.frustum=s.F.fromInvProjectionMatrix(H,1,0,!0),te.far=$}const Z=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[Z].far,this._cascades[Z].far],this._uniformValues.u_shadow_intensity=w,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Xo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Xo.shadowMapResolution,this._uniformValues.u_shadowmap_0=qi.ShadowMap0,this._uniformValues.u_shadowmap_1=qi.ShadowMap0+1,this._groundShadowTiles=v.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const K=v.transform.elevation;for(const Q of this._groundShadowTiles){let te={min:0,max:0};if(K){const ee=K.getMinMaxForTile(Q);ee&&(te=ee)}this.addShadowReceiver(Q.toUnwrapped(),te.min,te.max)}}get enabled(){return this._enabled}set enabled(l){this._enabled=l}drawShadowPass(l,d){if(!this._enabled)return;const v=this.painter,w=v.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(v.transform.getFrustum(0),v.transform.worldSize,this._cascades),w.viewport.set([0,0,Xo.shadowMapResolution,Xo.shadowMapResolution]);for(let S=0;S<this._numCascadesToRender;++S){v.currentShadowCascade=S,w.bindFramebuffer.set(this._cascades[S].framebuffer.framebuffer),w.clear({color:s.C.white,depth:1});for(const A of l.order){const C=l._mergedLayers[A];if(!C.hasShadowPass()||C.isHidden(v.transform.zoom))continue;const R=l.getLayerSourceCache(C),B=R?d[R.id]:void 0;(C.type==="model"||B&&B.length)&&v.renderLayer(v,R,C,B)}}v.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const l=this.painter,d=l.style,v=l.context,w=d.directionalLight,S=d.ambientLight;if(!w||!S)return;const A=[],C=Ma(l,l.longestCutoffRange);C.shouldRenderCutoff&&A.push("RENDER_CUTOFF");const R=Wh(w,S),B=new s.b4(v.gl.LEQUAL,s.b4.ReadOnly,l.depthRangeFor3D);for(const U of this._groundShadowTiles){const H=U.toUnwrapped(),Z=l.isTileAffectedByFog(U),K=l.getOrCreateProgram("groundShadow",{defines:A,overrideFog:Z});this.setupShadows(H,K),l.uploadCommonUniforms(v,K,H,null,C);const Q={u_matrix:l.transform.calculateProjMatrix(H),u_ground_shadow_factor:R};K.draw(l,v.gl.TRIANGLES,B,s.b6.disabled,s.a.multiply,s.b5.disabled,Q,"ground_shadow",l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments,{},l.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?s.a.unblended:s.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(l){const d=this.painter.transform,v=d.calculatePosMatrix(l,d.worldSize);return s.m.multiply(v,this._cascades[this.painter.currentShadowCascade].matrix,v),Float32Array.from(v)}calculateShadowPassMatrixFromMatrix(l){return s.m.multiply(l,this._cascades[this.painter.currentShadowCascade].matrix,l),Float32Array.from(l)}setupShadows(l,d,v,w=0){if(!this._enabled)return;const S=this.painter.transform,A=this.painter.context,C=A.gl,R=this._uniformValues,B=new Float64Array(16),U=S.calculatePosMatrix(l,S.worldSize);for(let H=0;H<this._cascades.length;H++)s.m.multiply(B,this._cascades[H].matrix,U),R[H===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(B),A.activeTexture.set(C.TEXTURE0+qi.ShadowMap0+H),this._cascades[H].texture.bind(C.NEAREST,C.CLAMP_TO_EDGE);if(this.useNormalOffset=!!v,this.useNormalOffset){const H=s.cg(l.canonical),Z=2/S.tileSize*s.J/Xo.shadowMapResolution,K=Z*this._cascades[0].boundingSphereRadius,Q=Z*this._cascades[this._cascades.length-1].boundingSphereRadius,te=(v==="vector-tile"?1:3)/Math.pow(2,w-l.canonical.z-(1-S.zoom+Math.floor(S.zoom)));R.u_shadow_normal_offset=[H,K*te,Q*te],R.u_shadow_bias=[6e-5,.0012,.012]}else R.u_shadow_bias=[36e-5,.0012,.012];d.setShadowUniformValues(A,R)}setupShadowsFromMatrix(l,d,v=!1){if(!this._enabled)return;const w=this.painter.context,S=w.gl,A=this._uniformValues,C=new Float64Array(16);for(let R=0;R<Xo.cascadeCount;R++)s.m.multiply(C,this._cascades[R].matrix,l),A[R===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),w.activeTexture.set(S.TEXTURE0+qi.ShadowMap0+R),this._cascades[R].texture.bind(S.NEAREST,S.CLAMP_TO_EDGE);this.useNormalOffset=v,v?(A.u_shadow_normal_offset=[1,5,5],A.u_shadow_bias=[6e-5,.0012,.012]):A.u_shadow_bias=[36e-5,.0012,.012],d.setShadowUniformValues(w,A)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(l,d,v,w){if(w[2]>=0)return{};const S=function(R,B,U){const H=U/(1<<R.canonical.z);return new s.c3([R.canonical.x*H+R.wrap*U,R.canonical.y*H+R.wrap*U,0],[(R.canonical.x+1)*H+R.wrap*U,(R.canonical.y+1)*H+R.wrap*U,B])}(l,d,v).getCorners(),A=d/-w[2];w[0]<0?(s.v.add(S[0],S[0],[w[0]*A,0,0]),s.v.add(S[3],S[3],[w[0]*A,0,0])):w[0]>0&&(s.v.add(S[1],S[1],[w[0]*A,0,0]),s.v.add(S[2],S[2],[w[0]*A,0,0])),w[1]<0?(s.v.add(S[0],S[0],[0,w[1]*A,0]),s.v.add(S[1],S[1],[0,w[1]*A,0])):w[1]>0&&(s.v.add(S[2],S[2],[0,w[1]*A,0]),s.v.add(S[3],S[3],[0,w[1]*A,0]));const C={};return C.vertices=S,C.planes=[Bu(S[1],S[0],S[4]),Bu(S[2],S[1],S[5]),Bu(S[3],S[2],S[6]),Bu(S[0],S[3],S[7])],C}addShadowReceiver(l,d,v){this._receivers.add(l,s.c3.fromTileIdAndHeight(l,d,v))}getMaxCascadeForTile(l){const d=this._receivers.get(l);return d&&d.lastCascade?d.lastCascade:0}}function Bu(g,l,d){const v=s.v.sub([],d,l),w=s.v.sub([],g,l),S=s.v.cross([],v,w),A=s.v.length(S);return A===0?[0,0,1,0]:(s.v.scale(S,S,1/A),[S[0],S[1],S[2],-s.v.dot(S,l)])}function _f(g){const l=g.properties.get("direction"),d=s.b3(l.x,l.y,l.z);d[2]=s.c(d[2],0,75);const v=s.ch([d[0],d[1],d[2]]);return s.v.fromValues(v.x,v.y,v.z)}function Wh(g,l){const d=g.properties.get("color"),v=g.properties.get("intensity"),w=g.properties.get("direction"),S=[w.x,w.y,w.z],A=l.properties.get("color"),C=l.properties.get("intensity"),R=Math.max(s.v.dot([0,0,1],S),0),B=[0,0,0];s.v.scale(B,A.toArray01Linear().slice(0,3),C);const U=[0,0,0];return s.v.scale(U,d.toArray01Linear().slice(0,3),R*v),s.bw([B[0]>0?B[0]/(B[0]+U[0]):0,B[1]>0?B[1]/(B[1]+U[1]):0,B[2]>0?B[2]/(B[2]+U[2]):0])}function bm(g,l,d,v,w,S){const A=g.zoom,C=g.scale,R=g.worldSize,B=1/R,U=g.aspect,H=Math.sqrt(1+U*U)*Math.tan(.5*g.fovX),Z=H*H,K=v-d,Q=v+d;let te,ee;Z>K/Q?(te=v,ee=v*H):(te=.5*Q*(1+Z),ee=.5*Math.sqrt(K*K+2*(v*v+d*d)*Z+Q*Q*Z*Z));const $=g.projection.pixelsPerMeter(g.center.lat,R),le=g._camera.getCameraToWorldMercator(),_e=[0,0,-te*B];s.v.transformMat4(_e,_e,le);let ye=ee*B;const oe=g._edgeInsets;if(!(oe.left===0&&oe.top===0&&oe.right===0&&oe.bottom===0||oe.left===oe.right&&oe.top===oe.bottom)){const _t=g._camera.getWorldToCamera(g.worldSize,g.projection.zAxisUnit==="meters"?$:1),oi=g._camera.getCameraToClipPerspective(g._fov,g.width/g.height,d,v);oi[8]=2*-g.centerOffset.x/g.width,oi[9]=2*g.centerOffset.y/g.height;const Yt=new Float64Array(16);s.m.mul(Yt,oi,_t);const pi=new Float64Array(16);s.m.invert(pi,Yt);const Qt=s.F.fromInvProjectionMatrix(pi,R,A,!0);for(const Ai of Qt.points){const Ii=((he=Ai)[0]/=C,he[1]/=C,he[2]=s.b(he[2],g._center.lat),he);ye=Math.max(ye,s.v.len(s.v.subtract([],_e,Ii)))}}var he;ye*=w/(w-1);const ve=Math.acos(l[2]),Ee=Math.atan2(-l[0],-l[1]),xe=new fn;xe.position=_e,xe.setPitchBearing(ve,Ee);const Pe=xe.getWorldToCamera(R,$),ct=ye*R,je=Math.min(g._mercatorZfromZoom(17)*R*-2,-2*ct),et=xe.getCameraToClipOrthographic(-ct,ct,-ct,ct,je,(ct+S*$)/l[2]),Le=new Float64Array(16);s.m.multiply(Le,et,Pe);const at=s.v.fromValues(Math.floor(1e6*_e[0])/1e6*R,Math.floor(1e6*_e[1])/1e6*R,0),Ke=.5*w,dt=[0,0,0];s.v.transformMat4(dt,at,Le),s.v.scale(dt,dt,Ke);const me=[Math.floor(dt[0]),Math.floor(dt[1]),Math.floor(dt[2])],Fe=[0,0,0];s.v.sub(Fe,dt,me),s.v.scale(Fe,Fe,-1/Ke);const Mt=new Float64Array(16);return s.m.identity(Mt),s.m.translate(Mt,Mt,Fe),s.m.multiply(Le,Mt,Le),[Le,ct]}class wm extends s.a6{constructor(l){super(),this.requestManager=l,this.models={"":{}},this.numModelsLoading={}}loadModel(l,d){return s.aO(this.requestManager.transformRequest(d,s.a2.Model).url).then(v=>{if(!v)return;const w=s.aP(v),S=new s.aQ(l,void 0,void 0,w);return S.computeBoundsAndApplyParent(),S}).catch(v=>{this.fire(new s.a7(new Error(`Could not load model ${l} from ${d}: ${v.message}`)))})}load(l,d){this.models[d]||(this.models[d]={});const v=Object.keys(l);this.numModelsLoading[d]=(this.numModelsLoading[d]||0)+v.length;const w=[];for(const S of v)w.push(this.loadModel(S,l[S]));Promise.allSettled(w).then(S=>{for(let A=0;A<S.length;A++){const{status:C,value:R}=S[A];C==="fulfilled"&&R&&(this.models[d][v[A]]=R)}this.numModelsLoading[d]-=v.length,this.fire(new s.a8("data",{dataType:"style"}))}).catch(S=>{this.fire(new s.a7(new Error(`Could not load models: ${S.message}`)))})}isLoaded(){for(const l in this.numModelsLoading)if(this.numModelsLoading[l]>0)return!1;return!0}hasModel(l,d){return!!this.getModel(l,d)}getModel(l,d){return this.models[d]||(this.models[d]={}),this.models[d][l]}addModel(l,d,v){this.models[v]||(this.models[v]={}),this.hasModel(l,v)&&this.removeModel(l,v),this.load({[l]:this.requestManager.normalizeModelURL(d)},v)}addModels(l,d){const v={};for(const w in l)v[w]=this.requestManager.normalizeModelURL(l[w]);this.load(v,d)}removeModel(l,d){this.models[d]||(this.models[d]={});const v=this.models[d][l];delete this.models[d][l],v.destroy()}listModels(l){return this.models[l]||(this.models[l]={}),Object.keys(this.models[l])}upload(l,d){this.models[d]||(this.models[d]={});for(const v in this.models[d])this.models[d][v].upload(l.context)}}const Yl=(g,l)=>s.ai(g,l&&l.filter(d=>d.identifier!=="source.canvas")),Tm=s.p(gt,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),Sm=s.p(gt,["setCenter","setZoom","setBearing","setPitch"]),yf={version:8,layers:[],sources:{}},nl={duration:300,delay:0},Nu=new Set(["fill","line","background","hillshade","raster"]);class Es extends s.a6{constructor(l,d={}){super(),this.map=l,this.scope=d.scope||"",this.fragments=[],this.importDepth=d.importDepth||0,this.importsCache=d.importsCache||new Map,this.resolvedImports=d.resolvedImports||new Set,this.transition=s.ak({},nl),this._buildingIndex=new yu(this),this.crossTileSymbolIndex=new lf,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=d.styleChanges||new we,this.dispatcher=d.dispatcher?d.dispatcher:new s.br(s.bs(),this),d.imageManager?this.imageManager=d.imageManager:(this.imageManager=new Kn,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=d.glyphManager?d.glyphManager:new s.cj(l._requestManager,d.localFontFamily?s.ck.all:d.localIdeographFontFamily?s.ck.ideographs:s.ck.none,d.localFontFamily||d.localIdeographFontFamily),d.modelManager?this.modelManager=d.modelManager:(this.modelManager=new wm(l._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=d.configOptions?d.configOptions:new Map,this._configDependentLayers=d.configDependentLayers?d.configDependentLayers:new Set,this._config=d.config,this.dispatcher.broadcast("setReferrer",s.cl());const v=this;this._rtlTextPluginCallback=Es.registerForPluginStateChange(w=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(S,A)=>{if(s.cm(S),A&&A.every(C=>C))for(const C in v._sourceCaches){const R=v._sourceCaches[C],B=R.getSource().type;B!=="vector"&&B!=="geojson"||R.reload()}})}),this.on("data",w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const S=this.getOwnSource(w.sourceId);if(S&&S.vectorLayerIds)for(const A in this._layers){const C=this._layers[A];C.source===S.id&&this._validateLayer(C)}})}loadURL(l,d={}){this.fire(new s.a8("dataloading",{dataType:"style"}));const v=typeof d.validate=="boolean"?d.validate:!s.cn(l);l=this.map._requestManager.normalizeStyleURL(l,d.accessToken),this.resolvedImports.add(l);const w=this.importsCache.get(l);if(w)return this._load(w,v);const S=this.map._requestManager.transformRequest(l,s.a2.Style);this._request=s.a1(S,(A,C)=>{if(this._request=null,A)this.fire(new s.a7(A));else if(C)return this.importsCache.set(l,C),this._load(C,v)})}loadJSON(l,d={}){this.fire(new s.a8("dataloading",{dataType:"style"})),this._request=s.a4.frame(()=>{this._request=null,this._load(l,d.validate!==!1)})}loadEmpty(){this.fire(new s.a8("dataloading",{dataType:"style"})),this._load(yf,!1)}_loadImports(l,d){if(this.importDepth>=4)return s.X("Style doesn't support nesting deeper than 5"),Promise.resolve();const v=[];for(const w of l){const S=this._createFragmentStyle(w),A=new Promise(R=>{S.once("style.import.load",R),S.once("error",R)}).then(()=>this.mergeAll());if(v.push(A),this.resolvedImports.has(w.url)){S.loadEmpty();continue}const C=w.data||this.importsCache.get(w.url);C?S.loadJSON(C,{validate:d}):w.url?S.loadURL(w.url,{validate:d}):S.loadEmpty(),this.fragments.push({style:S,id:w.id,config:w.config})}return Promise.allSettled(v)}_createFragmentStyle(l){const d=this.scope?s.aE(l.id,this.scope):l.id,v=new Es(this.map,{scope:d,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:l.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const l=this.isRootStyle();this._shouldPrecompile=l,this.fire(new s.a8(l?"style.load":"style.import.load"))}_load(l,d){const v=l.schema;if(this.isRootStyle()&&(l.fragment||v&&l.fragment!==!1)){const A=s.ak({},yf,{imports:[{id:"basemap",data:l,url:""}]});return void this._load(A,d)}if(this.setConfig(this._config,v),d&&Yl(this,s.aj(l)))return;this._loaded=!0,this.stylesheet=s.co(l);for(const A in l.sources)this.addSource(A,l.sources[A],{validate:!1,isInitialLoad:!0});l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(l.glyphs,this.scope);const w=wa(this.stylesheet.layers);if(this._order=w.map(A=>A.id),this.stylesheet.light&&s.X("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const A=this.stylesheet.lights[0];this.light=new Kr(A.properties,A.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Kr(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const A of w){const C=s.cp(A,this.scope,this.options);C.isConfigDependent&&this._configDependentLayers.add(C.fqid),C.setEventedParent(this,{layer:{id:C.id}}),this._layers[C.id]=C,this._serializedLayers[C.id]=C.serialize();const R=this.getOwnLayerSourceCache(C),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();R&&C.canCastShadows()&&B&&(R.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const S=this.stylesheet.terrain;S&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.a4.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?s.X("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(S,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.a8("data",{dataType:"style"})),l.imports?this._loadImports(l.imports,d).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let l,d,v,w,S,A,C,R;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(B=>{if(B.stylesheet){if(B.light!=null&&(l=B.light),B.stylesheet.lights)for(const U of B.stylesheet.lights)U.type==="ambient"&&B.ambientLight!=null&&(d=B.ambientLight),U.type==="directional"&&B.directionalLight!=null&&(v=B.directionalLight);w=this._prioritizeTerrain(w,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(S=B.fog),B.stylesheet.camera!=null&&(R=B.stylesheet.camera),B.stylesheet.projection!=null&&(A=B.stylesheet.projection),B.stylesheet.transition!=null&&(C=B.stylesheet.transition)}}),this.light=l,this.ambientLight=d,this.directionalLight=v,this.fog=S,w===null?delete this.terrain:this.terrain=w,this.camera=R||{"camera-projection":"perspective"},this.projection=A||{name:"mercator"},this.transition=s.ak({},nl,C),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(l){const d=v=>{for(const w of v.fragments)d(w.style);l(v)};d(this)}_prioritizeTerrain(l,d,v){const w=l&&l.drapeRenderMode===0;return v===null?d&&d.drapeRenderMode===0?d:w?l:null:d!=null&&(!l||w||d&&d.drapeRenderMode===1)?d:l}mergeTerrain(){let l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(d=>{l=this._prioritizeTerrain(l,d.terrain,d.stylesheet.terrain)}),l===null?delete this.terrain:this.terrain=l}mergeProjection(){let l;this.forEachFragmentStyle(d=>{d.stylesheet.projection!=null&&(l=d.stylesheet.projection)}),this.projection=l||{name:"mercator"}}mergeSources(){const l={},d={},v={};this.forEachFragmentStyle(w=>{for(const S in w._sourceCaches){const A=s.aE(S,w.scope);l[A]=w._sourceCaches[S]}for(const S in w._otherSourceCaches){const A=s.aE(S,w.scope);d[A]=w._otherSourceCaches[S]}for(const S in w._symbolSourceCaches){const A=s.aE(S,w.scope);v[A]=w._symbolSourceCaches[S]}}),this._mergedSourceCaches=l,this._mergedOtherSourceCaches=d,this._mergedSymbolSourceCaches=v}mergeLayers(){const l={},d=[],v={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(S=>{for(const A of S._order){const C=S._layers[A];if(C.type==="slot"){const R=s.cq(A);if(l[R])continue;l[R]=[]}C.slot&&l[C.slot]?l[C.slot].push(C):d.push(C)}}),this._mergedOrder=[];const w=(S=[])=>{for(const A of S)if(A.type==="slot"){const C=s.cq(A.id);l[C]&&w(l[C])}else{const C=s.aE(A.id,A.scope);this._mergedOrder.push(C),v[C]=A,A.is3D()&&(this._has3DLayers=!0),A.type==="circle"&&(this._hasCircleLayers=!0),A.type==="symbol"&&(this._hasSymbolLayers=!0)}};w(d),this._mergedLayers=v,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(l){return this.stylesheet.camera=s.ak({},this.stylesheet.camera,l),this.camera=this.stylesheet.camera,this}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(l){this._spriteRequest=function(d,v,w){let S,A,C;const R=s.a4.devicePixelRatio>1?"@2x":"";let B=s.a1(v.transformRequest(v.normalizeSpriteURL(d,R,".json"),s.a2.SpriteJSON),(Z,K)=>{B=null,C||(C=Z,S=K,H())}),U=s.a3(v.transformRequest(v.normalizeSpriteURL(d,R,".png"),s.a2.SpriteImage),(Z,K)=>{U=null,C||(C=Z,A=K,H())});function H(){if(C)w(C);else if(S&&A){const Z=s.a4.getImageData(A),K={};for(const Q in S){const{width:te,height:ee,x:$,y:le,sdf:_e,pixelRatio:ye,stretchX:oe,stretchY:he,content:ve}=S[Q],Ee=new s.a5({width:te,height:ee});s.a5.copy(Z,Ee,{x:$,y:le},{x:0,y:0},{width:te,height:ee}),K[Q]={data:Ee,pixelRatio:ye,sdf:_e,stretchX:oe,stretchY:he,content:ve}}w(null,K)}}return{cancel(){B&&(B.cancel(),B=null),U&&(U.cancel(),U=null)}}}(l,this.map._requestManager,(d,v)=>{if(this._spriteRequest=null,d)this.fire(new s.a7(d));else if(v)for(const w in v)this.imageManager.addImage(w,this.scope,v[w]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.a8("data",{dataType:"style"}))})}_validateLayer(l){const d=this.getOwnSource(l.source);if(!d)return;const v=l.sourceLayer;v&&(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(v)===-1)&&this.fire(new s.a7(new Error(`Source layer "${v}" does not exist on source "${d.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:l}of this.fragments)if(!l.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((l,d)=>{const v=this.fragments[d];return v&&v.style&&(l.data=v.style.serialize()),l})}_serializeSources(){const l={};for(const d in this._sourceCaches){const v=this._sourceCaches[d].getSource();l[v.id]||(l[v.id]=v.serialize())}return l}_serializeLayers(l){const d=[];for(const v of l){const w=this._layers[v];w&&w.type!=="custom"&&d.push(w.serialize())}return d}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(l){return!!this.terrain&&(typeof l.isLayerDraped=="function"?l.isLayerDraped(this.getLayerSourceCache(l)):Nu.has(l.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(l){const d=this.getOwnLayer(l);if(d)return d;this.fire(new s.a7(new Error(`The layer '${l}' does not exist in the map's style.`)))}_checkSource(l){const d=this.getOwnSource(l);if(d)return d;this.fire(new s.a7(new Error(`The source '${l}' does not exist in the map's style.`)))}update(l){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(l),this.directionalLight&&this.directionalLight.recalculate(l);const d=this.calculateLightsBrightness();l.brightness=d||0,d!==this._brightness&&(this._brightness=d,this.dispatcher.broadcast("setBrightness",d));const v=this._changes.isDirty();if(this._changes.isDirty()){const S=this._changes.getLayerUpdatesByScope();for(const A in S){const{updatedIds:C,removedIds:R}=S[A];(C||R)&&this._updateWorkerLayers(A,C,R)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(l),this.light&&this.light.updateTransitions(l),this.ambientLight&&this.ambientLight.updateTransitions(l),this.directionalLight&&this.directionalLight.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._changes.reset()}const w={};for(const S in this._mergedSourceCaches){const A=this._mergedSourceCaches[S];w[S]=A.used,A.used=!1}for(const S of this._mergedOrder){const A=this._mergedLayers[S];if(A.recalculate(l,this._availableImages),!A.isHidden(l.zoom)){const C=this.getLayerSourceCache(A);C&&(C.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let C=A.minzoom||0;C<(A.maxzoom||25.5);C++){const R=this.map.painter;if(R){const B=A.getProgramIds();if(!B)continue;for(const U of B){const H=A.getDefaultProgramParams(U,l.zoom);H&&(R.style=this,this.fog&&(R._fogVisible=!0,H.overrideFog=!0,R.getOrCreateProgram(U,H)),R._fogVisible=!1,H.overrideFog=!1,R.getOrCreateProgram(U,H),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(H.overrideRtt=!0,R.getOrCreateProgram(U,H)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const S in w){const A=this._mergedSourceCaches[S];w[S]!==A.used&&A.getSource().fire(new s.a8("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light&&this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),v&&this.fire(new s.a8("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=this._changes.getUpdatedImages();if(l.length){for(const d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],l);this._changes.resetUpdatedImages()}}_updateWorkerLayers(l,d,v){const w=this.getFragmentStyle(l);w&&this.dispatcher.broadcast("updateLayers",{layers:d?w._serializeLayers(d):[],scope:l,removedIds:v||[],options:w.options})}setState(l){if(this._checkLoaded(),Yl(this,s.aj(l)))return!1;(l=s.co(l)).layers=wa(l.layers);const d=function(w,S){if(!w)return[{command:gt.setStyle,args:[S]}];let A=[];try{if(!M(w.version,S.version))return[{command:gt.setStyle,args:[S]}];M(w.center,S.center)||A.push({command:gt.setCenter,args:[S.center]}),M(w.zoom,S.zoom)||A.push({command:gt.setZoom,args:[S.zoom]}),M(w.bearing,S.bearing)||A.push({command:gt.setBearing,args:[S.bearing]}),M(w.pitch,S.pitch)||A.push({command:gt.setPitch,args:[S.pitch]}),M(w.sprite,S.sprite)||A.push({command:gt.setSprite,args:[S.sprite]}),M(w.glyphs,S.glyphs)||A.push({command:gt.setGlyphs,args:[S.glyphs]}),M(w.imports,S.imports)||function(H=[],Z=[],K){Z=Z||[];const Q=(H=H||[]).map(Oe),te=Z.map(Oe),ee=H.reduce(Ge,{}),$=Z.reduce(Ge,{}),le=Q.slice();let _e,ye,oe,he;for(_e=0,ye=0;_e<Q.length;_e++)oe=Q[_e],$.hasOwnProperty(oe)?ye++:(K.push({command:gt.removeImport,args:[oe]}),le.splice(le.indexOf(oe,ye),1));for(_e=0,ye=0;_e<te.length;_e++)oe=te[te.length-1-_e],le[le.length-1-_e]!==oe&&(ee.hasOwnProperty(oe)?(K.push({command:gt.removeImport,args:[oe]}),le.splice(le.lastIndexOf(oe,le.length-ye),1)):ye++,he=le[le.length-_e],K.push({command:gt.addImport,args:[$[oe],he]}),le.splice(le.length-_e,0,oe));for(const ve of Z){const Ee=ee[ve.id];if(!Ee||M(Ee,ve))continue;M(Ee.config,ve.config)||K.push({command:gt.setImportConfig,args:[ve.id,ve.config]}),M(Ee.url,ve.url)||K.push({command:gt.setImportUrl,args:[ve.id,ve.url]});const xe=ve.data;M(Ee&&Ee.data,xe)||K.push({command:gt.setImportData,args:[ve.id,xe]})}}(w.imports,S.imports,A),M(w.transition,S.transition)||A.push({command:gt.setTransition,args:[S.transition]}),M(w.light,S.light)||A.push({command:gt.setLight,args:[S.light]}),M(w.fog,S.fog)||A.push({command:gt.setFog,args:[S.fog]}),M(w.projection,S.projection)||A.push({command:gt.setProjection,args:[S.projection]}),M(w.lights,S.lights)||A.push({command:gt.setLights,args:[S.lights]}),M(w.camera,S.camera)||A.push({command:gt.setCamera,args:[S.camera]});const C={},R=[];(function(H,Z,K,Q){let te;for(te in Z=Z||{},H=H||{})H.hasOwnProperty(te)&&(Z.hasOwnProperty(te)||G(te,K,Q));for(te in Z){if(!Z.hasOwnProperty(te))continue;const ee=Z[te];H.hasOwnProperty(te)?M(H[te],ee)||(H[te].type==="geojson"&&ee.type==="geojson"&&Te(H,Z,te)?K.push({command:gt.setGeoJSONSourceData,args:[te,ee.data]}):ae(te,Z,K,Q)):D(te,Z,K)}})(w.sources,S.sources,R,C);const B=[];w.layers&&w.layers.forEach(H=>{H.source&&C[H.source]?A.push({command:gt.removeLayer,args:[H.id]}):B.push(H)});let U=w.terrain;U&&C[U.source]&&(A.push({command:gt.setTerrain,args:[void 0]}),U=void 0),A=A.concat(R),M(U,S.terrain)||A.push({command:gt.setTerrain,args:[S.terrain]}),function(H,Z,K){Z=Z||[];const Q=(H=H||[]).map(Oe),te=Z.map(Oe),ee=H.reduce(Ge,{}),$=Z.reduce(Ge,{}),le=Q.slice(),_e=Object.create(null);let ye,oe,he,ve,Ee,xe,Pe;for(ye=0,oe=0;ye<Q.length;ye++)he=Q[ye],$.hasOwnProperty(he)?oe++:(K.push({command:gt.removeLayer,args:[he]}),le.splice(le.indexOf(he,oe),1));for(ye=0,oe=0;ye<te.length;ye++)he=te[te.length-1-ye],le[le.length-1-ye]!==he&&(ee.hasOwnProperty(he)?(K.push({command:gt.removeLayer,args:[he]}),le.splice(le.lastIndexOf(he,le.length-oe),1)):oe++,xe=le[le.length-ye],K.push({command:gt.addLayer,args:[$[he],xe]}),le.splice(le.length-ye,0,he),_e[he]=!0);for(ye=0;ye<te.length;ye++)if(he=te[ye],ve=ee[he],Ee=$[he],!_e[he]&&!M(ve,Ee))if(M(ve.source,Ee.source)&&M(ve["source-layer"],Ee["source-layer"])&&M(ve.type,Ee.type)){for(Pe in Me(ve.layout,Ee.layout,K,he,null,gt.setLayoutProperty),Me(ve.paint,Ee.paint,K,he,null,gt.setPaintProperty),M(ve.slot,Ee.slot)||K.push({command:gt.setSlot,args:[he,Ee.slot]}),M(ve.filter,Ee.filter)||K.push({command:gt.setFilter,args:[he,Ee.filter]}),M(ve.minzoom,Ee.minzoom)&&M(ve.maxzoom,Ee.maxzoom)||K.push({command:gt.setLayerZoomRange,args:[he,Ee.minzoom,Ee.maxzoom]}),ve)ve.hasOwnProperty(Pe)&&Pe!=="layout"&&Pe!=="paint"&&Pe!=="filter"&&Pe!=="metadata"&&Pe!=="minzoom"&&Pe!=="maxzoom"&&Pe!=="slot"&&(Pe.indexOf("paint.")===0?Me(ve[Pe],Ee[Pe],K,he,Pe.slice(6),gt.setPaintProperty):M(ve[Pe],Ee[Pe])||K.push({command:gt.setLayerProperty,args:[he,Pe,Ee[Pe]]}));for(Pe in Ee)Ee.hasOwnProperty(Pe)&&!ve.hasOwnProperty(Pe)&&Pe!=="layout"&&Pe!=="paint"&&Pe!=="filter"&&Pe!=="metadata"&&Pe!=="minzoom"&&Pe!=="maxzoom"&&Pe!=="slot"&&(Pe.indexOf("paint.")===0?Me(ve[Pe],Ee[Pe],K,he,Pe.slice(6),gt.setPaintProperty):M(ve[Pe],Ee[Pe])||K.push({command:gt.setLayerProperty,args:[he,Pe,Ee[Pe]]}))}else K.push({command:gt.removeLayer,args:[he]}),xe=le[le.lastIndexOf(he)+1],K.push({command:gt.addLayer,args:[Ee,xe]})}(B,S.layers,A)}catch(C){console.warn("Unable to compute style diff:",C),A=[{command:gt.setStyle,args:[S]}]}return A}(this.serialize(),l).filter(w=>!(w.command in Sm));if(d.length===0)return!1;const v=d.filter(w=>!(w.command in Tm));if(v.length>0)throw new Error(`Unimplemented: ${v.map(w=>w.command).join(", ")}.`);return d.forEach(w=>{this[w.command].apply(this,w.args)}),this.stylesheet=l,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(l,d){return this.getImage(l)?this.fire(new s.a7(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,this.scope,d),this._afterImageUpdated(l),this)}updateImage(l,d){this.imageManager.updateImage(l,this.scope,d)}getImage(l){return this.imageManager.getImage(l,this.scope)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l,this.scope),this._afterImageUpdated(l),this):this.fire(new s.a7(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(l),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new s.a8("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(l,d,v={}){return this._checkLoaded(),this._validate(s.cr,`models.${l}`,d,null,v)||(this.modelManager.addModel(l,d,this.scope),this._changes.setDirty()),this}hasModel(l){return this.modelManager.hasModel(l,this.scope)}removeModel(l){return this.hasModel(l)?(this.modelManager.removeModel(l,this.scope),this):this.fire(new s.a7(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(l,d,v={}){if(this._checkLoaded(),this.getOwnSource(l)!==void 0)throw new Error(`There is already a source with ID "${l}".`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(s.cs,`sources.${l}`,d,null,v))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const w=ss(l,d,this.dispatcher,this);w.scope=this.scope,w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(w.id),source:w.serialize(),sourceId:w.id}));const S=A=>{const C=(A?"symbol:":"other:")+w.id,R=s.aE(C,this.scope),B=this._sourceCaches[C]=new s.bq(R,w,A);(A?this._symbolSourceCaches:this._otherSourceCaches)[w.id]=B,B.onAdd(this.map)};S(!1),d.type!=="vector"&&d.type!=="geojson"||S(!0),w.onAdd&&w.onAdd(this.map),v.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(l){this._checkLoaded();const d=this.getOwnSource(l);if(!d)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===l)return this.fire(new s.a7(new Error(`Source "${l}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===l)return this.fire(new s.a7(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));const v=this.getOwnSourceCaches(l);for(const w of v){const S=s.cq(w.id);delete this._sourceCaches[S],this._changes.discardSourceCacheUpdate(w.id),w.fire(new s.a8("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles()}return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],this.mergeSources(),d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(l,d){this._checkLoaded(),this.getOwnSource(l).setData(d),this._changes.setDirty()}getOwnSource(l){const d=this.getOwnSourceCache(l);return d&&d.getSource()}getOwnSources(){const l=[];for(const d in this._otherSourceCaches){const v=this.getOwnSourceCache(d);v&&l.push(v.getSource())}return l}areTilesLoaded(){const l=this._mergedSourceCaches;for(const d in l){const v=l[d]._tiles;for(const w in v){const S=v[w];if(S.state!=="loaded"&&S.state!=="errored")return!1}}return!0}setLights(l){if(this._checkLoaded(),!l)return delete this.ambientLight,void delete this.directionalLight;const d=this._getTransitionParameters();for(const w of l){if(this._validate(s.ct,"lights",w))return;switch(w.type){case"ambient":if(this.ambientLight){const S=this.ambientLight;S.set(w),S.updateTransitions(d)}else this.ambientLight=new ba(w,fr,this.scope,this.options);break;case"directional":if(this.directionalLight){const S=this.directionalLight;S.set(w),S.updateTransitions(d)}else this.directionalLight=new ba(w,_u,this.scope,this.options)}}const v=new s.al(this.z||0,d);this.ambientLight&&this.ambientLight.recalculate(v),this.directionalLight&&this.directionalLight.recalculate(v),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const l=this.directionalLight,d=this.ambientLight;if(!l||!d)return;const v=H=>.2126*(H[0]<=.03928?H[0]/12.92:Math.pow((H[0]+.055)/1.055,2.4))+.7152*(H[1]<=.03928?H[1]/12.92:Math.pow((H[1]+.055)/1.055,2.4))+.0722*(H[2]<=.03928?H[2]/12.92:Math.pow((H[2]+.055)/1.055,2.4)),w=l.properties.get("color").toArray01(),S=l.properties.get("intensity"),A=l.properties.get("direction"),C=1-s.b3(A.x,A.y,A.z)[2]/90,R=v(w)*S*C,B=d.properties.get("color").toArray01(),U=d.properties.get("intensity");return(R+v(B)*U)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const l=[];return this.directionalLight&&l.push(this.directionalLight.get()),this.ambientLight&&l.push(this.ambientLight.get()),l}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(l){if(!l)return this;if(s.cu(l)){const d=s.cv(l),v=this.fragments.find(({id:S})=>S===d);if(!v)throw new Error(`Style import not found: ${l}`);const w=s.cq(l);return v.style.getFragmentStyle(w)}{const d=this.fragments.find(({id:v})=>v===l);if(!d)throw new Error(`Style import not found: ${l}`);return d.style}}getConfigProperty(l,d){const v=this.getFragmentStyle(l);if(!v)return null;const w=s.aE(d,v.scope),S=v.options.get(w),A=S?S.value||S.default:null;return A?A.serialize():null}setConfigProperty(l,d,v){const w=s.cw(v);if(w.result!=="success")return void Yl(this,w.value);const S=w.value.expression,A=this.getFragmentStyle(l);if(!A)return;const C=s.aE(d,A.scope),R=A.options.get(C);R&&(this.options.set(C,{...R,value:S}),this.updateConfigDependencies())}setConfig(l,d){if(this._config=l,l||d)if(d)for(const v in d){let w,S;const A=s.cw(d[v].default);if(A.result==="success"&&(w=A.value.expression),l&&l[v]!==void 0){const Z=s.cw(l[v]);Z.result==="success"&&(S=Z.value.expression)}const{minValue:C,maxValue:R,stepValue:B,type:U,values:H}=d[v];if(w){const Z=s.aE(v,this.scope);this.options.set(Z,{default:w,value:S,minValue:C,maxValue:R,stepValue:B,type:U,values:H})}else this.fire(new s.a7(new Error(`No schema defined for config option "${v}".`)))}else this.fire(new s.a7(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const l of this._configDependentLayers){const d=this.getLayer(l);d&&(d.possiblyEvaluateVisibility(),this._updateLayer(d))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this._changes.setDirty()}addLayer(l,d,v={}){this._checkLoaded();const w=l.id;if(this._layers[w])return void this.fire(new s.a7(new Error(`Layer with id "${w}" already exists on this map`)));let S;if(l.type==="custom"){if(Yl(this,s.cx(l)))return;S=s.cp(l,this.scope,this.options)}else{if(typeof l.source=="object"&&(this.addSource(w,l.source),l=s.co(l),l=s.ak(l,{source:w})),this._validate(s.cy,`layers.${w}`,l,{arrayIndex:-1},v))return;S=s.cp(l,this.scope,this.options),this._validateLayer(S),S.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[S.id]=S.serialize()}S.isConfigDependent&&this._configDependentLayers.add(S.fqid);let A=this._order.length;if(d){const U=this._order.indexOf(d);if(U===-1)return void this.fire(new s.a7(new Error(`Layer with id "${d}" does not exist on this map.`)));S.slot===this._layers[d].slot?A=U:s.X(`Layer with id "${d}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(A,0,w),this._layerOrderChanged=!0,this._layers[w]=S;const C=this.getOwnLayerSourceCache(S),R=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&S.canCastShadows()&&R&&(C.castsShadows=!0);const B=this._changes.getRemovedLayer(S);if(B&&S.source&&C&&S.type!=="custom"){this._changes.discardLayerRemoval(S);const U=s.aE(S.source,S.scope);B.type!==S.type?this._changes.updateSourceCache(U,"clear"):(this._changes.updateSourceCache(U,"reload"),C.pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map),S.scope=this.scope,this.mergeLayers()}moveLayer(l,d){this._checkLoaded();const v=this._checkLayer(l);if(!v||l===d)return;const w=this._order.indexOf(l);this._order.splice(w,1);let S=this._order.length;if(d){const A=this._order.indexOf(d);if(A===-1)return void this.fire(new s.a7(new Error(`Layer with id "${d}" does not exist on this map.`)));v.slot===this._layers[d].slot?S=A:s.X(`Layer with id "${d}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,l),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(l){this._checkLoaded();const d=this._checkLayer(l);if(!d)return;d.setEventedParent(null);const v=this._order.indexOf(l);this._order.splice(v,1),delete this._layers[l],delete this._serializedLayers[l],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(d.fqid),this._changes.removeLayer(d);const w=this.getOwnLayerSourceCache(d);if(w&&w.castsShadows){let S=!1;for(const A in this._layers)if(this._layers[A].source===d.source&&this._layers[A].canCastShadows()){S=!0;break}w.castsShadows=S}d.onRemove&&d.onRemove(this.map),this.mergeLayers()}getOwnLayer(l){return this._layers[l]}hasLayer(l){return l in this._mergedLayers}hasLayerType(l){for(const d in this._layers)if(this._layers[d].type===l)return!0;return!1}setLayerZoomRange(l,d,v){this._checkLoaded();const w=this._checkLayer(l);w&&(w.minzoom===d&&w.maxzoom===v||(d!=null&&(w.minzoom=d),v!=null&&(w.maxzoom=v),this._updateLayer(w)))}setSlot(l,d){this._checkLoaded();const v=this._checkLayer(l);v&&v.slot!==d&&(v.slot=d,this._updateLayer(v))}setFilter(l,d,v={}){this._checkLoaded();const w=this._checkLayer(l);if(w&&!M(w.filter,d))return d==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(s.cz,`layers.${w.id}.filter`,d,{layerType:w.type},v)||(w.filter=s.co(d),this._updateLayer(w)))}getFilter(l){const d=this._checkLayer(l);if(d)return s.co(d.filter)}setLayoutProperty(l,d,v,w={}){this._checkLoaded();const S=this._checkLayer(l);S&&(M(S.getLayoutProperty(d),v)||(S.setLayoutProperty(d,v,w),S.isConfigDependent&&this._configDependentLayers.add(S.fqid),this._updateLayer(S)))}getLayoutProperty(l,d){const v=this._checkLayer(l);if(v)return v.getLayoutProperty(d)}setPaintProperty(l,d,v,w={}){this._checkLoaded();const S=this._checkLayer(l);if(!S||M(S.getPaintProperty(d),v))return;const A=S.setPaintProperty(d,v,w);S.isConfigDependent&&this._configDependentLayers.add(S.fqid),A&&this._updateLayer(S),this._changes.updatePaintProperties(S)}getPaintProperty(l,d){const v=this._checkLayer(l);if(v)return v.getPaintProperty(d)}setFeatureState(l,d){this._checkLoaded();const v=l.source,w=l.sourceLayer,S=this._checkSource(v);if(!S)return;const A=S.type;if(A==="geojson"&&w)return void this.fire(new s.a7(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(A==="vector"&&!w)return void this.fire(new s.a7(new Error("The sourceLayer parameter must be provided for vector source types.")));l.id===void 0&&this.fire(new s.a7(new Error("The feature id parameter must be provided.")));const C=this.getOwnSourceCaches(v);for(const R of C)R.setFeatureState(w,l.id,d)}removeFeatureState(l,d){this._checkLoaded();const v=l.source,w=this._checkSource(v);if(!w)return;const S=w.type,A=S==="vector"?l.sourceLayer:void 0;if(S==="vector"&&!A)return void this.fire(new s.a7(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&typeof l.id!="string"&&typeof l.id!="number")return void this.fire(new s.a7(new Error("A feature id is required to remove its specific state property.")));const C=this.getOwnSourceCaches(v);for(const R of C)R.removeFeatureState(A,l.id,d)}getFeatureState(l){this._checkLoaded();const d=l.source,v=l.sourceLayer,w=this._checkSource(d);if(w){if(w.type!=="vector"||v)return l.id===void 0&&this.fire(new s.a7(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(d)[0].getFeatureState(v,l.id);this.fire(new s.a7(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(l){return this.stylesheet.transition=s.ak({},this.stylesheet.transition,l),this.transition=this.stylesheet.transition,this}getTransition(){return s.ak({},this.stylesheet.transition)}serialize(){this._checkLoaded();const l=this.getTerrain(),d=l&&this.terrain&&this.terrain.scope===this.scope?l:this.stylesheet.terrain;return s.cA({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:d,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},v=>v!==void 0)}_updateLayer(l){this._changes.updateLayer(l);const d=this.getLayerSourceCache(l),v=s.aE(l.source,l.scope),w=this._changes.getUpdatedSourceCaches();l.source&&!w[v]&&d&&d.getSource().type!=="raster"&&(this._changes.updateSourceCache(v,"reload"),d.pause()),l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const d=C=>this._mergedLayers[C].type==="fill-extrusion",v=this.order,w={},S=[];for(let C=v.length-1;C>=0;C--){const R=v[C];if(d(R)){w[R]=C;for(const B of l){const U=B[R];if(U)for(const H of U)S.push(H)}}}S.sort((C,R)=>R.intersectionZ-C.intersectionZ);const A=[];for(let C=v.length-1;C>=0;C--){const R=v[C];if(d(R))for(let B=S.length-1;B>=0;B--){const U=S[B].feature;if(w[U.layer.id]<C)break;A.push(U),S.pop()}else for(const B of l){const U=B[R];if(U)for(const H of U)A.push(H.feature)}}return A}queryRenderedFeatures(l,d,v){d&&d.filter&&this._validate(s.cz,"queryRenderedFeatures.filter",d.filter,null,d),d.scope=this.scope,d.availableImages=this._availableImages,d.serializedLayers=this._serializedLayers;const w={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new s.a7(new Error("parameters.layers must be an Array."))),[];for(const B of d.layers){const U=this._mergedLayers[B];if(!U)return this.fire(new s.a7(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];w[U.source]=!0}}const S=[],A=d.serializedLayers||{},C=d&&d.layers?d.layers.some(B=>{const U=this.getLayer(B);return U&&U.is3D()}):this.has3DLayers(),R=uo.createFromScreenPoints(l,v);for(const B in this._mergedSourceCaches){const U=this._mergedSourceCaches[B].getSource();if(!U||U.scope!==d.scope)continue;const H=this._mergedSourceCaches[B].getSource().id;d.layers&&!w[H]||S.push(as(this._mergedSourceCaches[B],this._mergedLayers,A,R,d,v,C,!!this.map._showQueryGeometry))}return this.placement&&S.push(function(B,U,H,Z,K,Q,te){const ee={},$=Q.queryRenderedSymbols(Z),le=[];for(const _e of Object.keys($).map(Number))le.push(te[_e]);le.sort(Uo);for(const _e of le){const ye=_e.featureIndex.lookupSymbolFeatures($[_e.bucketInstanceId],U,_e.bucketIndex,_e.sourceLayerIndex,K.filter,K.layers,K.availableImages,B);for(const oe in ye){const he=ee[oe]=ee[oe]||[],ve=ye[oe];ve.sort((Ee,xe)=>{const Pe=_e.featureSortOrder;if(Pe){const ct=Pe.indexOf(Ee.featureIndex);return Pe.indexOf(xe.featureIndex)-ct}return xe.featureIndex-Ee.featureIndex});for(const Ee of ve)he.push(Ee)}}for(const _e in ee)ee[_e].forEach(ye=>{const oe=ye.feature,he=H(B[_e]);if(!he)return;const ve=he.getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=ve});return ee}(this._mergedLayers,A,this.getLayerSourceCache.bind(this),R.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(l,d){d&&d.filter&&this._validate(s.cz,"querySourceFeatures.filter",d.filter,null,d);const v=this.getOwnSourceCaches(l);let w=[];for(const S of v)w=w.concat(Uh(S,d));return w}addSourceType(l,d,v){return Es.getSourceType(l)?v(new Error(`A source type called "${l}" already exists.`)):(Es.setSourceType(l,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:d.workerSourceURL},v):v(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(l,d,v={}){this._checkLoaded();const w=this.light.getLight();let S=!1;for(const C in l)if(!M(l[C],w[C])){S=!0;break}if(!S)return;const A=this._getTransitionParameters();this.light.setLight(l,d,v),this.light.updateTransitions(A)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(l,d=1){if(this._checkLoaded(),!l)return delete this.terrain,l===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let v=l;const w=l.source==null;if(d===1){if(typeof v.source=="object"){const C="terrain-dem-src";this.addSource(C,v.source),v=s.co(v),v=s.ak(v,{source:C})}const S=s.ak({},v),A={};if(this.terrain&&w){S.source=this.terrain.get().source;const C=this.terrain?this.getFragmentStyle(this.terrain.scope):null;C&&(A.style=C.serialize())}if(this._validate(s.cB,"terrain",S,A))return}if(!this.terrain||this.terrain.scope!==this.scope&&!w||this.terrain&&d!==this.terrain.drapeRenderMode){if(!v)return;this._createTerrain(v,d),this.fire(new s.a8("data",{dataType:"style"}))}else{const S=this.terrain,A=S.get();for(const C of Object.keys(s.ae.terrain))!v.hasOwnProperty(C)&&s.ae.terrain[C].default&&(v[C]=s.ae.terrain[C].default);for(const C in l)if(!M(l[C],A[C])){S.set(l,this.options),this.stylesheet.terrain=l;const R=this._getTransitionParameters({duration:0});S.updateTransitions(R),this.fire(new s.a8("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const d=this.fog=new Ll(l,this.map.transform);this.stylesheet.fog=d.get();const v=this._getTransitionParameters({duration:0});d.updateTransitions(v)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog;if(!M(d.get(),l)){d.set(l),this.stylesheet.fog=d.get();const v=this._getTransitionParameters({duration:0});d.updateTransitions(v)}}else this._createFog(l);this._markersNeedUpdate=!0}_getTransitionParameters(l){return{now:s.a4.now(),transition:s.ak(this.transition,l)}}updateDrapeFirstLayers(){if(!this.terrain)return;const l=[],d=[];for(const v in this._mergedLayers)this.isLayerDraped(this._mergedLayers[v])?l.push(v):d.push(v);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...d)}_createTerrain(l,d){const v=this.terrain=new sr(l,d,this.scope,this.options);d===1&&(this.stylesheet.terrain=l),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const w=this._getTransitionParameters({duration:0});v.updateTransitions(w)}_force3DLayerUpdate(){for(const l in this._layers){const d=this._layers[l];d.type==="fill-extrusion"&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const d=this._layers[l];d.type==="symbol"&&this._updateLayer(d)}}_validate(l,d,v,w,S={}){if(S&&S.validate===!1)return!1;const A=s.ak({},this.serialize());return Yl(this,l.call(s.aj,s.ak({key:d,style:A,value:v,styleSpec:s.ae},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.cC.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._mergedLayers)this._mergedLayers[l].setEventedParent(null);for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles(),this._mergedSourceCaches[l].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(l){const d=this.getSourceCaches(l);for(const v of d)v.clearTiles()}clearSources(){for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles()}reloadSource(l){const d=this.getSourceCaches(l);for(const v of d)v.resume(),v.reload()}reloadSources(){for(const l of this.getSources())l.reload&&l.reload()}updateSources(l){let d;this.directionalLight&&(d=_f(this.directionalLight));for(const v in this._mergedSourceCaches)this._mergedSourceCaches[v].update(l,void 0,void 0,d)}_generateCollisionBoxes(){for(const l in this._sourceCaches){const d=this._sourceCaches[l];d.resume(),d.reload()}}_updatePlacement(l,d,v,w,S=!1){let A=!1,C=!1;const R={},B={};for(const U of this._mergedOrder){const H=this._mergedLayers[U];if(H.type!=="symbol")continue;const Z=s.aE(H.source,H.scope);let K=R[Z];if(!K){const te=this.getLayerSourceCache(H);if(!te)continue;const ee=te.getRenderableIds(!0).map($=>te.getTileByID($));B[Z]=ee.slice(),K=R[Z]=ee.sort(($,le)=>le.tileID.overscaledZ-$.tileID.overscaledZ||($.tileID.isLessThan(le.tileID)?-1:1))}const Q=this.crossTileSymbolIndex.addLayer(H,K,l.center.lng,l.projection);A=A||Q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),S=S||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new s.a8("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.a4.now(),l.zoom))&&(this.pauseablePlacement=new bu(l,this._mergedOrder,S,d,v,w,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,R,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.a4.now()),C=!0),A&&this.pauseablePlacement.placement.setStale()),C||A)for(const U of this._mergedOrder){const H=this._mergedLayers[U];H.type==="symbol"&&this.placement.updateLayerOpacities(H,R[s.aE(H.source,H.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.a4.now())}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}addImport(l){this._checkLoaded();const d=this.stylesheet.imports=this.stylesheet.imports||[];return d.findIndex(({id:v})=>v===l.id)!==-1?this.fire(new s.a7(new Error(`Import with id '${l.id}' already exists in the map's style.`))):(d.push(l),this._loadImports([l],!0),this)}setImportUrl(l,d){this._checkLoaded();const v=this.stylesheet.imports||[],w=this.getImportIndex(l);if(w===-1)return this;v[w].url=d;const S=this.fragments[w];return S.style=this._createFragmentStyle(v[w]),S.style.on("style.import.load",()=>this.mergeAll()),S.style.loadURL(d),this}setImportData(l,d){this._checkLoaded();const v=this.getImportIndex(l),w=this.stylesheet.imports||[];return v===-1?this:d?(this.fragments[v].style.setState(d),this._reloadImports(),this):(delete w[v].data,this.setImportUrl(l,w[v].url))}setImportConfig(l,d){this._checkLoaded();const v=this.getImportIndex(l),w=this.stylesheet.imports||[];if(v===-1)return this;d?w[v].config=d:delete w[v].config;const S=this.fragments[v],A=S.style.stylesheet&&S.style.stylesheet.schema;return S.config=d,S.style.setConfig(d,A),this.updateConfigDependencies(),this}removeImport(l){this._checkLoaded();const d=this.stylesheet.imports||[],v=this.getImportIndex(l);return v===-1||(d.splice(v,1),this.fragments[v].style._remove(),this.fragments.splice(v,1),this._reloadImports()),this}getImportIndex(l){const d=(this.stylesheet.imports||[]).findIndex(v=>v.id===l);return d===-1&&this.fire(new s.a7(new Error(`Import '${l}' does not exist in the map's style and cannot be updated.`))),d}getLayer(l){return this._mergedLayers[l]}getSources(){const l=[];for(const d in this._mergedOtherSourceCaches){const v=this._mergedOtherSourceCaches[d];v&&l.push(v.getSource())}return l}getSource(l,d){const v=this.getSourceCache(l,d);return v&&v.getSource()}getLayerSource(l){const d=this.getLayerSourceCache(l);return d&&d.getSource()}getSourceCache(l,d){const v=s.aE(l,d);return this._mergedOtherSourceCaches[v]}getLayerSourceCache(l){const d=s.aE(l.source,l.scope);return l.type==="symbol"?this._mergedSymbolSourceCaches[d]:this._mergedOtherSourceCaches[d]}getSourceCaches(l){const d=[];return this._mergedOtherSourceCaches[l]&&d.push(this._mergedOtherSourceCaches[l]),this._mergedSymbolSourceCaches[l]&&d.push(this._mergedSymbolSourceCaches[l]),d}updateSourceCaches(){const l=this._changes.getUpdatedSourceCaches();for(const d in l){const v=l[d];v==="reload"?this.reloadSource(d):v==="clear"&&this.clearSource(d)}}updateLayers(l){const d=this._changes.getUpdatedPaintProperties();for(const v of d){const w=this.getLayer(v);w&&w.updateTransitions(l)}}getImages(l,d,v){this.imageManager.getImages(d.icons,d.scope,v),this._updateTilesForChangedImages();const w=S=>{S&&S.setDependencies(d.tileID.key,d.type,d.icons)};w(this._otherSourceCaches[d.source]),w(this._symbolSourceCaches[d.source])}getGlyphs(l,d,v){this.glyphManager.getGlyphs(d.stacks,d.scope,v)}getResource(l,d,v){return s.cD(d,v)}getOwnSourceCache(l){return this._otherSourceCaches[l]}getOwnLayerSourceCache(l){return l.type==="symbol"?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}getOwnSourceCaches(l){const d=[];return this._otherSourceCaches[l]&&d.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&d.push(this._symbolSourceCaches[l]),d}_isSourceCacheLoaded(l){const d=this.getOwnSourceCaches(l);return d.length===0?(this.fire(new s.a7(new Error(`There is no source with ID '${l}'`))),!1):d.every(v=>v.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function rl(g,l){let d=!1,v=null;const w=()=>{v=null,d&&(g(),v=setTimeout(w,l),d=!1)};return()=>(d=!0,v||w(),v)}Es.getSourceType=function(g){return vs[g]},Es.setSourceType=function(g,l){vs[g]=l},Es.registerForPluginStateChange=s.ci;class Mm{constructor(l){this._hashName=l&&encodeURIComponent(l),s.aR(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=rl(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const l=this._map;if(!l)return"";const d=ol(l);if(this._hashName){const v=this._hashName;let w=!1;const S=location.hash.slice(1).split("&").map(A=>{const C=A.split("=")[0];return C===v?(w=!0,`${C}=${d}`):A}).filter(A=>A);return w||S.push(`${v}=${d}`),`#${S.join("&")}`}return`#${d}`}_getCurrentHash(){const l=location.hash.replace("#","");if(this._hashName){let d;return l.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(d=v)}),(d&&d[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._map;if(!l)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some(v=>isNaN(v))){const v=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(d[3]||0):l.getBearing();return l.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:v,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function ol(g,l){const d=g.getCenter(),v=Math.round(100*g.getZoom())/100,w=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,w),A=Math.round(d.lng*S)/S,C=Math.round(d.lat*S)/S,R=g.getBearing(),B=g.getPitch();let U=l?`/${A}/${C}/${v}`:`${v}/${C}/${A}`;return(R||B)&&(U+="/"+Math.round(10*R)/10),B&&(U+=`/${Math.round(B)}`),U}const Vu={linearity:.3,easing:s.cE(0,0,.3,1)},vf=s.ak({deceleration:2500,maxSpeed:1400},Vu),xf=s.ak({deceleration:20,maxSpeed:1400},Vu),Zh=s.ak({deceleration:1e3,maxSpeed:360},Vu),Ny=s.ak({deceleration:1e3,maxSpeed:90},Vu);class Em{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.a4.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,d=s.a4.now();for(;l.length>0&&d-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const d={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)d.zoom+=S.zoomDelta||0,d.bearing+=S.bearingDelta||0,d.pitch+=S.pitchDelta||0,S.panDelta&&d.pan._add(S.panDelta),S.around&&(d.around=S.around),S.pinchAround&&(d.pinchAround=S.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(d.pan.mag()){const S=Xh(d.pan.mag(),v,s.ak({},vf,l||{}));w.offset=d.pan.mult(S.amount/d.pan.mag()),w.center=this._map.transform.center,sl(w,S)}if(d.zoom){const S=Xh(d.zoom,v,xf);w.zoom=this._map.transform.zoom+S.amount,sl(w,S)}if(d.bearing){const S=Xh(d.bearing,v,Zh);w.bearing=this._map.transform.bearing+s.c(S.amount,-179,179),sl(w,S)}if(d.pitch){const S=Xh(d.pitch,v,Ny);w.pitch=this._map.transform.pitch+S.amount,sl(w,S)}if(w.zoom||w.bearing){const S=d.pinchAround===void 0?d.around:d.pinchAround;w.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function sl(g,l){(!g.duration||g.duration<l.duration)&&(g.duration=l.duration,g.easing=l.easing)}function Xh(g,l,d){const{maxSpeed:v,linearity:w,deceleration:S}=d,A=s.c(g*w/(l/1e3),-v,v),C=Math.abs(A)/(S*w);return{easing:d.easing,duration:1e3*C,amount:A*(C/2)}}class gs extends s.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,v,w={}){const S=Ce(d.getCanvasContainer(),v),A=d.unproject(S);super(l,s.ak({point:S,lngLat:A,originalEvent:v},w)),this._defaultPrevented=!1,this.target=d}}class Uu extends s.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,v){const w=l==="touchend"?v.changedTouches:v.touches,S=He(d.getCanvasContainer(),w),A=S.map(R=>d.unproject(R)),C=S.reduce((R,B,U,H)=>R.add(B.div(H.length)),new s.P(0,0));super(l,{points:S,point:C,lngLats:A,lngLat:d.unproject(C),originalEvent:v}),this._defaultPrevented=!1}}class Vy extends s.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,v){super(l,{originalEvent:v}),this._defaultPrevented=!1}}class bf{constructor(l,d){this._map=l,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new Vy(l.type,this._map,l))}mousedown(l,d){return this._mousedownPos=d,this._firePreventable(new gs(l.type,this._map,l))}mouseup(l){this._map.fire(new gs(l.type,this._map,l))}preclick(l){const d=s.ak({},l);d.type="preclick",this._map.fire(new gs(d.type,this._map,d))}click(l,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(l),this._map.fire(new gs(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new gs(l.type,this._map,l))}mouseover(l){this._map.fire(new gs(l.type,this._map,l))}mouseout(l){this._map.fire(new gs(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Uu(l.type,this._map,l))}touchmove(l){this._map.fire(new Uu(l.type,this._map,l))}touchend(l){this._map.fire(new Uu(l.type,this._map,l))}touchcancel(l){this._map.fire(new Uu(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yh{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new gs(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new gs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new gs(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ju{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,d){this.isEnabled()&&l.shiftKey&&l.button===0&&(ue(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(l,d){if(!this._active)return;const v=d,w=this._startPos,S=this._lastPos;if(!w||!S||S.equals(v)||!this._box&&v.dist(w)<this._clickTolerance)return;this._lastPos=v,this._box||(this._box=V("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const A=Math.min(w.x,v.x),C=Math.max(w.x,v.x),R=Math.min(w.y,v.y),B=Math.max(w.y,v.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${A}px,${R}px)`,this._box.style.width=C-A+"px",this._box.style.height=B-R+"px")})}mouseupWindow(l,d){if(!this._active)return;const v=this._startPos,w=d;if(v&&l.button===0){if(this.reset(),Ae(),v.x!==w.x||v.y!==w.y)return this._map.fire(new s.a8("boxzoomend",{originalEvent:l})),{cameraAnimation:S=>S.fitScreenCoordinates(v,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ce(),delete this._startPos,delete this._lastPos}_fireEvent(l,d){return this._map.fire(new s.a8(l,{originalEvent:d}))}}function Gu(g,l){const d={};for(let v=0;v<g.length;v++)d[g[v].identifier]=l[v];return d}class Hu{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,d,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=l.timeStamp),v.length===this.numTouches&&(this.centroid=function(w){const S=new s.P(0,0);for(const A of w)S._add(A);return S.div(w.length)}(d),this.touches=Gu(v,d)))}touchmove(l,d,v){if(this.aborted||!this.centroid)return;const w=Gu(v,d);for(const S in this.touches){const A=w[S];(!A||A.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(l,d,v){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),v.length===0){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class qu{constructor(l){this.singleTap=new Hu(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,d,v){this.singleTap.touchstart(l,d,v)}touchmove(l,d,v){this.singleTap.touchmove(l,d,v)}touchend(l,d,v){const w=this.singleTap.touchend(l,d,v);if(w){const S=l.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(w)<30;if(S&&A||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class Jh{constructor(){this._zoomIn=new qu({numTouches:1,numTaps:2}),this._zoomOut=new qu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,d,v){this._zoomIn.touchstart(l,d,v),this._zoomOut.touchstart(l,d,v)}touchmove(l,d,v){this._zoomIn.touchmove(l,d,v),this._zoomOut.touchmove(l,d,v)}touchend(l,d,v){const w=this._zoomIn.touchend(l,d,v),S=this._zoomOut.touchend(l,d,v);return w?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()+1,around:A.unproject(w)},{originalEvent:l})}):S?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()-1,around:A.unproject(S)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Kh={0:1,2:2};class Yo{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,d){return!1}_move(l,d){return{}}mousedown(l,d){if(this._lastPoint)return;const v=We(l);this._correctButton(l,v)&&(this._lastPoint=d,this._eventButton=v)}mousemoveWindow(l,d){const v=this._lastPoint;if(v){if(l.preventDefault(),this._eventButton!=null&&function(w,S){const A=Kh[S];return w.buttons===void 0||(w.buttons&A)!==A}(l,this._eventButton))this.reset();else if(this._moved||!(d.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(v,d)}}mouseupWindow(l){this._lastPoint&&We(l)===this._eventButton&&(this._moved&&Ae(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Am extends Yo{mousedown(l,d){super.mousedown(l,d),this._lastPoint&&(this._active=!0)}_correctButton(l,d){return d===0&&!l.ctrlKey}_move(l,d){return{around:d,panDelta:d.sub(l)}}}class wf extends Yo{_correctButton(l,d){return d===0&&l.ctrlKey||d===2}_move(l,d){const v=.8*(d.x-l.x);if(v)return this._active=!0,{bearingDelta:v}}contextmenu(l){l.preventDefault()}}class Tf extends Yo{_correctButton(l,d){return d===0&&l.ctrlKey||d===2}_move(l,d){const v=-.5*(d.y-l.y);if(v)return this._active=!0,{pitchDelta:v}}contextmenu(l){l.preventDefault()}}class Jl{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),s.aR(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(l,d,v){return this._calculateTransform(l,d,v)}touchmove(l,d,v){if(this._active&&!(v.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(v.length===1&&!s.cF())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,d,v)}}touchend(l,d,v){this._calculateTransform(l,d,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,d,v){v.length>0&&(this._active=!0);const w=Gu(v,d),S=new s.P(0,0),A=new s.P(0,0);let C=0;for(const B in w){const U=w[B],H=this._touches[B];H&&(S._add(U),A._add(U.sub(H)),C++,w[B]=U)}if(this._touches=w,C<this._minTouches||!A.mag())return;const R=A.div(C);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(C),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=V("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class $h{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,d,v){return{}}touchstart(l,d,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([d[0],d[1]]))}touchmove(l,d,v){const w=this._firstTwoTouches;if(!w)return;l.preventDefault();const[S,A]=w,C=Kl(v,d,S),R=Kl(v,d,A);if(!C||!R)return;const B=this._aroundCenter?null:C.add(R).div(2);return this._move([C,R],B,l)}touchend(l,d,v){if(!this._firstTwoTouches)return;const[w,S]=this._firstTwoTouches,A=Kl(v,d,w),C=Kl(v,d,S);A&&C||(this._active&&Ae(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Kl(g,l,d){for(let v=0;v<g.length;v++)if(g[v].identifier===d)return l[v]}function Qh(g,l){return Math.log(g/l)/Math.LN2}class ed extends $h{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,d){const v=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Qh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Qh(this._distance,v),pinchAround:d}}}function Sf(g,l){return 180*g.angleWith(l)/Math.PI}class Im extends $h{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,d){const v=this._vector;if(this._vector=l[0].sub(l[1]),v&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Sf(this._vector,v),pinchAround:d}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const d=25/(Math.PI*this._minDiameter)*360,v=this._startVector;if(!v)return!1;const w=Sf(l,v);return Math.abs(w)<d}}function al(g){return Math.abs(g.y)>Math.abs(g.x)}class Uy extends $h{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,al(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,d,v){const w=this._lastPoints;if(!w)return;const S=l[0].sub(w[0]),A=l[1].sub(w[1]);return this._map._cooperativeGestures&&!s.cF()&&v.touches.length<3||(this._valid=this.gestureBeginsVertically(S,A,v.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(S.y+A.y)/2*-.5})}gestureBeginsVertically(l,d,v){if(this._valid!==void 0)return this._valid;const w=l.mag()>=2,S=d.mag()>=2;if(!w&&!S)return;if(!w||!S)return this._firstMove==null&&(this._firstMove=v),v-this._firstMove<100&&void 0;const A=l.y>0==d.y>0;return al(l)&&al(d)&&A}}const jy={panStep:100,bearingStep:15,pitchStep:10};class Cm{constructor(){const l=jy;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let d=0,v=0,w=0,S=0,A=0;switch(l.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:l.shiftKey?v=-1:(l.preventDefault(),S=-1);break;case 39:l.shiftKey?v=1:(l.preventDefault(),S=1);break;case 38:l.shiftKey?w=1:(l.preventDefault(),A=-1);break;case 40:l.shiftKey?w=-1:(l.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(v=0,w=0),{cameraAnimation:C=>{const R=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:td,zoom:d?Math.round(R)+d*(l.shiftKey?2:1):R,bearing:C.getBearing()+v*this._bearingStep,pitch:C.getPitch()+w*this._pitchStep,offset:[-S*this._panStep,-A*this._panStep],center:C.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function td(g){return g*(2-g)}const id=4.000244140625;class Pm{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._handler=d,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.aR(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||s.cF()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const v=s.a4.now(),w=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,d!==0&&d%id==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(w*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),l.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=l,this._delta-=d,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=Ce(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;this._type==="wheel"&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const d=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(this._delta!==0){const B=this._type==="wheel"&&Math.abs(this._delta)>id?this._wheelZoomRate:this._defaultZoomRate;let U=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&U!==0&&(U=1/U);const H=d(),Z=Math.pow(2,H),K=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):Z;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(K*U))),this._type==="wheel"&&(this._startZoom=H,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const v=typeof this._targetZoom=="number"?this._targetZoom:d(),w=this._startZoom,S=this._easing;let A,C=!1;if(this._type==="wheel"&&w&&S){const B=Math.min((s.a4.now()-this._lastWheelEventTime)/200,1),U=S(B);A=s.n(w,v,U),B<1?this._frameId||(this._frameId=!0):C=!0}else A=v,C=!0;this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let R=A-d();return R*this._lastDelta<0&&(R=0),{noInertia:!0,needsRenderFrame:!C,zoomDelta:R,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let d=s.cG;if(this._prevEase){const v=this._prevEase,w=(s.a4.now()-v.start)/v.duration,S=v.easing(w+.01)-v.easing(w),A=.27/Math.sqrt(S*S+1e-4)*.01,C=Math.sqrt(.0729-A*A);d=s.cE(A,C,.25,1)}return this._prevEase={start:s.a4.now(),duration:l,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=V("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class km{constructor(l,d){this._clickZoom=l,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class nd{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,d){return l.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:v.getZoom()+(l.shiftKey?-1:1),around:v.unproject(d)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mf{constructor(){this._tap=new qu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,d,v){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=d[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(l,d,v))}touchmove(l,d,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const w=d[0],S=w.y-this._swipePoint.y;return this._swipePoint=w,l.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(l,d,v)}touchend(l,d,v){this._tapTime?this._swipePoint&&v.length===0&&this.reset():this._tap.touchend(l,d,v)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dm{constructor(l,d,v){this._el=l,this._mousePan=d,this._touchPan=v}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Lm{constructor(l,d,v){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=d,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Om{constructor(l,d,v,w){this._el=l,this._touchZoom=d,this._touchRotate=v,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Wu=g=>g.zoom||g.drag||g.pitch||g.rotate;class Rm extends s.a8{}class Fc{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,d){const v=s.v.sub([],d,l);this.radius=s.v.length(v[2]<0?s.v.div([],v,this.constants):[v[0],v[1],0])}projectRay(l){s.v.div(l,l,this.constants),s.v.normalize(l,l),s.v.mul(l,l,this.constants);const d=s.v.scale([],l,this.radius);if(d[2]>0){const v=s.v.scale([],[0,0,1],s.v.dot(d,[0,0,1])),w=s.v.scale([],s.v.normalize([],[d[0],d[1],0]),this.radius),S=s.v.add([],d,s.v.scale([],s.v.sub([],s.v.add([],w,v),d),2));d[0]=S[0],d[1]=S[1]}return d}}function Zu(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class zm{constructor(l,d){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Em(l),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Fc,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),s.aR(["handleEvent","handleWindowEvent"],this);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[window,"blur",void 0]];for(const[w,S,A]of this._listeners){const C=w===document?this.handleWindowEvent:this.handleEvent;w.addEventListener(S,C,A)}}destroy(){for(const[l,d,v]of this._listeners){const w=l===document?this.handleWindowEvent:this.handleEvent;l.removeEventListener(d,w,v)}}_addDefaultHandlers(l){const d=this._map,v=d.getCanvasContainer();this._add("mapEvent",new bf(d,l));const w=d.boxZoom=new ju(d,l);this._add("boxZoom",w);const S=new Jh,A=new nd;d.doubleClickZoom=new km(A,S),this._add("tapZoom",S),this._add("clickZoom",A);const C=new Mf;this._add("tapDragZoom",C);const R=d.touchPitch=new Uy(d);this._add("touchPitch",R);const B=new wf(l),U=new Tf(l);d.dragRotate=new Lm(l,B,U),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",U,["mouseRotate"]);const H=new Am(l),Z=new Jl(d,l);d.dragPan=new Dm(v,H,Z),this._add("mousePan",H),this._add("touchPan",Z,["touchZoom","touchRotate"]);const K=new Im,Q=new ed;d.touchZoomRotate=new Om(v,Q,K,C),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Yh(d));const te=d.scrollZoom=new Pm(d,this);this._add("scrollZoom",te,["mousePan"]);const ee=d.keyboard=new Cm;this._add("keyboard",ee);for(const $ of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[$]&&d[$].enable(l[$])}_add(l,d,v){this._handlers.push({handlerName:l,handler:d,allowed:v}),this._handlersById[l]=d}stop(l){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Wu(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,d,v){for(const w in l)if(w!==v&&(!d||d.indexOf(w)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const d=[];for(const v of l)this._el.contains(v.target)&&d.push(v);return d}handleEvent(l,d){this._updatingCamera=!0;const v=l.type==="renderFrame",w=v?void 0:l,S={needsRenderFrame:!1},A={},C={},R=l.touches?this._getMapTouches(l.touches):void 0,B=R?He(this._el,R):v?void 0:Ce(this._el,l);for(const{handlerName:Z,handler:K,allowed:Q}of this._handlers){if(!K.isEnabled())continue;let te;this._blockedByActive(C,Q,Z)?K.reset():K[d||l.type]&&(te=K[d||l.type](l,B,R),this.mergeHandlerResult(S,A,te,Z,w),te&&te.needsRenderFrame&&this._triggerRenderFrame()),(te||K.isActive())&&(C[Z]=K)}const U={};for(const Z in this._previousActiveHandlers)C[Z]||(U[Z]=w);this._previousActiveHandlers=C,(Object.keys(U).length||Zu(S))&&(this._changes.push([S,A,U]),this._triggerRenderFrame()),(Object.keys(C).length||Zu(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=S;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))}mergeHandlerResult(l,d,v,w,S){if(!v)return;s.ak(l,v);const A={handlerName:w,originalEvent:v.originalEvent||S};v.zoomDelta!==void 0&&(d.zoom=A),v.panDelta!==void 0&&(d.drag=A),v.pitchDelta!==void 0&&(d.pitch=A),v.bearingDelta!==void 0&&(d.rotate=A)}_applyChanges(){const l={},d={},v={};for(const[w,S,A]of this._changes)w.panDelta&&(l.panDelta=(l.panDelta||new s.P(0,0))._add(w.panDelta)),w.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+w.pitchDelta),w.around!==void 0&&(l.around=w.around),w.aroundCoord!==void 0&&(l.aroundCoord=w.aroundCoord),w.pinchAround!==void 0&&(l.pinchAround=w.pinchAround),w.noInertia&&(l.noInertia=w.noInertia),s.ak(d,S),s.ak(v,A);this._updateMapTransform(l,d,v),this._changes=[]}_updateMapTransform(l,d,v){const w=this._map,S=w.transform,A=le=>[le.x,le.y,le.z];if((le=>{const _e=this._eventsInProgress.drag;return _e&&!this._handlersById[_e.handlerName].isActive()})()&&!Zu(l)){const le=S.zoom;S.cameraElevationReference="sea",this._originalZoom!=null&&S._orthographicProjectionAtLowPitch&&S.projection.name!=="globe"&&S.pitch===0?(S.cameraElevationReference="ground",S.zoom=this._originalZoom):(S.recenterOnTerrain(),S.cameraElevationReference="ground"),le!==S.zoom&&this._map._update(!0)}if(S._isCameraConstrained&&w._stop(!0),!Zu(l))return void this._fireEvents(d,v,!0);let{panDelta:C,zoomDelta:R,bearingDelta:B,pitchDelta:U,around:H,aroundCoord:Z,pinchAround:K}=l;S._isCameraConstrained&&(R>0&&(R=0),S._isCameraConstrained=!1),K!==void 0&&(H=K),(R||(le=>d[le]&&!this._eventsInProgress[le])("drag"))&&H&&(this._dragOrigin=A(S.pointCoordinate3D(H)),this._originalZoom=S.zoom,this._trackingEllipsoid.setup(S._camera.position,this._dragOrigin)),S.cameraElevationReference="sea",w._stop(!0),H=H||w.transform.centerPoint,B&&(S.bearing+=B),U&&(S.pitch+=U),S._updateCameraState();const Q=[0,0,0];if(C)if(S.projection.name==="mercator"){const le=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(H).dir),_e=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(H.sub(C)).dir);Q[0]=_e[0]-le[0],Q[1]=_e[1]-le[1]}else{const le=S.pointCoordinate(H);if(S.projection.name==="globe"){C=C.rotate(-S.angle);const _e=S._pixelsPerMercatorPixel/S.worldSize;Q[0]=-C.x*s.cH(s.l(le.y))*_e,Q[1]=-C.y*s.cH(S.center.lat)*_e}else{const _e=S.pointCoordinate(H.sub(C));le&&_e&&(Q[0]=_e.x-le.x,Q[1]=_e.y-le.y)}}const te=S.zoom,ee=[0,0,0];if(R){const le=A(Z||S.pointCoordinate3D(H)),_e={dir:s.v.normalize([],s.v.sub([],le,S._camera.position))};if(_e.dir[2]<0){const ye=S.zoomDeltaToMovement(le,R);s.v.scale(ee,_e.dir,ye)}}const $=s.v.add(Q,Q,ee);S._translateCameraConstrained($),R&&Math.abs(S.zoom-te)>1e-4&&S.recenterOnTerrain(),S.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(d,v,!0)}_fireEvents(l,d,v){const w=Wu(this._eventsInProgress),S=Wu(l),A={};for(const U in l){const{originalEvent:H}=l[U];this._eventsInProgress[U]||(A[`${U}start`]=H),this._eventsInProgress[U]=l[U]}!w&&S&&this._fireEvent("movestart",S.originalEvent);for(const U in A)this._fireEvent(U,A[U]);S&&this._fireEvent("move",S.originalEvent);for(const U in l){const{originalEvent:H}=l[U];this._fireEvent(U,H)}const C={};let R;for(const U in this._eventsInProgress){const{handlerName:H,originalEvent:Z}=this._eventsInProgress[U];this._handlersById[H].isActive()||(delete this._eventsInProgress[U],R=d[H]||Z,C[`${U}end`]=R)}for(const U in C)this._fireEvent(U,C[U]);const B=Wu(this._eventsInProgress);if(v&&(w||S)&&!B){this._updatingCamera=!0;const U=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;U?(H(U.bearing||this._map.getBearing())&&(U.bearing=0),this._map.easeTo(U,{originalEvent:R})):(this._map.fire(new s.a8("moveend",{originalEvent:R})),H(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,d){this._map.fire(new s.a8(l,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new Rm("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Fm="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Bm extends s.a6{constructor(l,d){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=d.bearingSnap,this._respectPrefersReducedMotion=d.respectPrefersReducedMotion!==!1,s.aR(["_renderFrameCallback"],this)}getCenter(){return new s.L(this.transform.center.lng,this.transform.center.lat)}setCenter(l,d){return this.jumpTo({center:l},d)}panBy(l,d,v){return l=s.P.convert(l).mult(-1),this.panTo(this.transform.center,s.ak({offset:l},d),v)}panTo(l,d,v){return this.easeTo(s.ak({center:l},d),v)}getZoom(){return this.transform.zoom}setZoom(l,d){return this.jumpTo({zoom:l},d),this}zoomTo(l,d,v){return this.easeTo(s.ak({zoom:l},d),v)}zoomIn(l,d){return this.zoomTo(this.getZoom()+1,l,d),this}zoomOut(l,d){return this.zoomTo(this.getZoom()-1,l,d),this}getBearing(){return this.transform.bearing}setBearing(l,d){return this.jumpTo({bearing:l},d),this}getPadding(){return this.transform.padding}setPadding(l,d){return this.jumpTo({padding:l},d),this}rotateTo(l,d,v){return this.easeTo(s.ak({bearing:l},d),v)}resetNorth(l,d){return this.rotateTo(0,s.ak({duration:1e3},l),d),this}resetNorthPitch(l,d){return this.easeTo(s.ak({bearing:0,pitch:0,duration:1e3},l),d),this}snapToNorth(l,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,d):this}getPitch(){return this.transform.pitch}setPitch(l,d){return this.jumpTo({pitch:l},d),this}cameraForBounds(l,d){l=s.D.convert(l);const v=d&&d.bearing||0,w=d&&d.pitch||0,S=l.getNorthWest(),A=l.getSouthEast();return this._cameraForBounds(this.transform,S,A,v,w,d)}_extendCameraOptions(l){const d={top:0,bottom:0,right:0,left:0};if(typeof(l=s.ak({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=="number"){const v=l.padding;l.padding={top:v,bottom:v,right:v,left:v}}return l.padding=s.ak(d,l.padding),l}_minimumAABBFrustumDistance(l,d){const v=d.max[0]-d.min[0],w=d.max[1]-d.min[1];return v/w>l.aspect?v/(2*Math.tan(.5*l.fovX)*l.aspect):w/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,d,v,w,S,A){const C=l.clone(),R=this._extendCameraOptions(A);C.bearing=w,C.pitch=S;const B=s.L.convert(d),U=s.L.convert(v),H=.5*(B.lat+U.lat),Z=.5*(B.lng+U.lng),K=s.cI(H,Z),Q=s.v.normalize([],K),te=s.v.normalize([],s.v.cross([],Q,[0,1,0])),ee=s.v.cross([],te,Q),$=[te[0],te[1],te[2],0,ee[0],ee[1],ee[2],0,Q[0],Q[1],Q[2],0,0,0,0,1],le=[K,s.cI(B.lat,B.lng),s.cI(U.lat,B.lng),s.cI(U.lat,U.lng),s.cI(B.lat,U.lng),s.cI(H,B.lng),s.cI(H,U.lng),s.cI(B.lat,Z),s.cI(U.lat,Z)];let _e=s.c3.fromPoints(le.map(Fe=>[s.v.dot(te,Fe),s.v.dot(ee,Fe),s.v.dot(Q,Fe)]));const ye=s.v.transformMat4([],_e.center,$);s.v.squaredLength(ye)===0&&s.v.set(ye,0,0,1),s.v.normalize(ye,ye),s.v.scale(ye,ye,s.aC),C.center=s.cJ(ye);const oe=C.getWorldToCameraMatrix(),he=s.m.invert(new Float64Array(16),oe);_e=s.c3.applyTransform(_e,s.m.multiply([],oe,$)),s.v.transformMat4(ye,ye,oe);const ve=.5*(_e.max[2]-_e.min[2]),Ee=this._minimumAABBFrustumDistance(C,_e),xe=s.v.scale([],[0,0,1],ve),Pe=s.v.add(xe,ye,xe),ct=Ee+(C.pitch===0?0:s.v.distance(ye,Pe)),je=C.globeCenterInViewSpace,et=s.v.sub([],ye,[je[0],je[1],je[2]]);s.v.normalize(et,et),s.v.scale(et,et,ct);const Le=s.v.add([],ye,et);s.v.transformMat4(Le,Le,he);const at=s.cL/s.aC,Ke=s.v.length(Le),dt=s.b(Math.max(Ke*at-s.cL,Number.EPSILON),0),me=Math.min(C.zoomFromMercatorZAdjusted(dt),R.maxZoom);return me>.5*(s.Z+s.G)?(C.setProjection({name:"mercator"}),C.zoom=me,this._cameraForBounds(C,d,v,w,S,A)):{center:C.center,zoom:me,bearing:w,pitch:S}}queryTerrainElevation(l,d){const v=this.transform.elevation;return v?(d=s.ak({},{exaggerated:!0},d),v.getAtPoint(s.M.fromLngLat(l),null,d.exaggerated)):null}_cameraForBounds(l,d,v,w,S,A){if(l.projection.name==="globe")return this._cameraForBoundsOnGlobe(l,d,v,w,S,A);const C=l.clone(),R=this._extendCameraOptions(A),B=C.padding;C.bearing=w,C.pitch=S;const U=s.L.convert(d),H=s.L.convert(v),Z=new s.L(U.lng,H.lat),K=new s.L(H.lng,U.lat),Q=C.project(U),te=C.project(H),ee=this.queryTerrainElevation(U),$=this.queryTerrainElevation(H),le=this.queryTerrainElevation(Z),_e=this.queryTerrainElevation(K),ye=[[Q.x,Q.y,Math.min(ee||0,$||0,le||0,_e||0)],[te.x,te.y,Math.max(ee||0,$||0,le||0,_e||0)]];let oe=s.c3.fromPoints(ye);const he=C.getWorldToCameraMatrix(),ve=s.m.invert(new Float64Array(16),he);oe=s.c3.applyTransform(oe,he);const Ee=s.v.sub([],oe.max,oe.min),xe=B.left||0,Pe=B.right||0,ct=B.bottom||0,je=B.top||0,{left:et,right:Le,top:at,bottom:Ke}=R.padding,dt=.5*(xe+Pe),me=.5*(je+ct),Fe=Math.min(C.scaleZoom(C.scale*Math.min((C.width-(xe+Pe+et+Le))/Ee[0],(C.height-(ct+je+Ke+at))/Ee[1])),R.maxZoom),Mt=C.scale/C.zoomScale(Fe);oe=new s.c3([oe.min[0]-(et+dt)*Mt,oe.min[1]-(Ke+me)*Mt,oe.min[2]],[oe.max[0]+(Le+dt)*Mt,oe.max[1]+(at+me)*Mt,oe.max[2]]);const _t=.5*Ee[2],oi=this._minimumAABBFrustumDistance(C,oe),Yt=[0,0,1,0];s.e.transformMat4(Yt,Yt,he),s.e.normalize(Yt,Yt);const pi=s.v.scale([],Yt,oi+_t),Qt=s.v.add([],oe.center,pi),Ai=(typeof R.offset.x=="number"&&typeof R.offset.y=="number"?new s.P(R.offset.x,R.offset.y):s.P.convert(R.offset)).rotate(-s.d(w));oe.center[0]-=Ai.x*Mt,oe.center[1]+=Ai.y*Mt,s.v.transformMat4(oe.center,oe.center,ve),s.v.transformMat4(Qt,Qt,ve);const Ii=[oe.center[0],oe.center[1],Qt[2]*C.pixelsPerMeter];s.v.scale(Ii,Ii,1/C.worldSize);const ui=s.cK(Ii[0]),di=s.l(Ii[1]),sn=Math.min(C._zoomFromMercatorZ(Ii[2]),R.maxZoom),Ni=new s.L(ui,di);return C.mercatorFromTransition&&sn<.5*(s.Z+s.G)?(C.setProjection({name:"globe"}),C.zoom=sn,this._cameraForBounds(C,d,v,w,S,A)):{center:Ni,zoom:sn,bearing:w,pitch:S}}fitBounds(l,d,v){const w=this.cameraForBounds(l,d);return this._fitInternal(w,d,v)}fitScreenCoordinates(l,d,v,w,S){const A=s.P.convert(l),C=s.P.convert(d),R=new s.P(Math.min(A.x,C.x),Math.min(A.y,C.y)),B=new s.P(Math.max(A.x,C.x),Math.max(A.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(A,C))return this;const U=this.transform.pointLocation3D(R),H=this.transform.pointLocation3D(B),Z=this.transform.pointLocation3D(new s.P(R.x,B.y)),K=this.transform.pointLocation3D(new s.P(B.x,R.y)),Q=[Math.min(U.lng,H.lng,Z.lng,K.lng),Math.min(U.lat,H.lat,Z.lat,K.lat)],te=[Math.max(U.lng,H.lng,Z.lng,K.lng),Math.max(U.lat,H.lat,Z.lat,K.lat)],ee=w&&w.pitch?w.pitch:this.getPitch(),$=this._cameraForBounds(this.transform,Q,te,v,ee,w);return this._fitInternal($,w,S)}_fitInternal(l,d,v){return l?(delete(d=s.ak(l,d)).padding,d.linear?this.easeTo(d,v):this.flyTo(d,v)):this}jumpTo(l,d){this.stop();const v=l.preloadOnly?this.transform.clone():this.transform;let w=!1,S=!1,A=!1;return"zoom"in l&&v.zoom!==+l.zoom&&(w=!0,v.zoom=+l.zoom),l.center!==void 0&&(v.center=s.L.convert(l.center)),"bearing"in l&&v.bearing!==+l.bearing&&(S=!0,v.bearing=+l.bearing),"pitch"in l&&v.pitch!==+l.pitch&&(A=!0,v.pitch=+l.pitch),l.padding==null||v.isPaddingEqual(l.padding)||(v.padding=l.padding),l.preloadOnly?(this._preloadTiles(v),this):(this.fire(new s.a8("movestart",d)).fire(new s.a8("move",d)),w&&this.fire(new s.a8("zoomstart",d)).fire(new s.a8("zoom",d)).fire(new s.a8("zoomend",d)),S&&this.fire(new s.a8("rotatestart",d)).fire(new s.a8("rotate",d)).fire(new s.a8("rotateend",d)),A&&this.fire(new s.a8("pitchstart",d)).fire(new s.a8("pitch",d)).fire(new s.a8("pitchend",d)),this.fire(new s.a8("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.X(Fm),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,d){const v=this.transform;if(!v.projection.supportsFreeCamera)return s.X(Fm),this;this.stop();const w=v.zoom,S=v.pitch,A=v.bearing;v.setFreeCameraOptions(l);const C=w!==v.zoom,R=S!==v.pitch,B=A!==v.bearing;return this.fire(new s.a8("movestart",d)).fire(new s.a8("move",d)),C&&this.fire(new s.a8("zoomstart",d)).fire(new s.a8("zoom",d)).fire(new s.a8("zoomend",d)),B&&this.fire(new s.a8("rotatestart",d)).fire(new s.a8("rotate",d)).fire(new s.a8("rotateend",d)),R&&this.fire(new s.a8("pitchstart",d)).fire(new s.a8("pitch",d)).fire(new s.a8("pitchend",d)),this.fire(new s.a8("moveend",d)),this}easeTo(l,d){this._stop(!1,l.easeId),((l=s.ak({offset:[0,0],duration:500,easing:s.cG},l)).animate===!1||this._prefersReducedMotion(l))&&(l.duration=0);const v=this.transform,w=this.getZoom(),S=this.getBearing(),A=this.getPitch(),C=this.getPadding(),R="zoom"in l?+l.zoom:w,B="bearing"in l?this._normalizeBearing(l.bearing,S):S,U="pitch"in l?+l.pitch:A,H="padding"in l?l.padding:v.padding,Z=s.P.convert(l.offset);let K,Q,te;if(v.projection.name==="globe"){const xe=s.M.fromLngLat(v.center),Pe=Z.rotate(-v.angle);xe.x+=Pe.x/v.worldSize,xe.y+=Pe.y/v.worldSize;const ct=xe.toLngLat(),je=s.L.convert(l.center||ct);this._normalizeCenter(je),K=v.centerPoint.add(Pe),Q=new s.P(xe.x,xe.y).mult(v.worldSize),te=new s.P(s.E(je.lng),s.H(je.lat)).mult(v.worldSize).sub(Q)}else{K=v.centerPoint.add(Z);const xe=v.pointLocation(K),Pe=s.L.convert(l.center||xe);this._normalizeCenter(Pe),Q=v.project(xe),te=v.project(Pe).sub(Q)}const ee=v.zoomScale(R-w);let $,le;l.around&&($=s.L.convert(l.around),le=v.locationPoint($));const _e=this._zooming||R!==w,ye=this._rotating||S!==B,oe=this._pitching||U!==A,he=!v.isPaddingEqual(H),ve=xe=>Pe=>{if(_e&&(xe.zoom=s.n(w,R,Pe)),ye&&(xe.bearing=s.n(S,B,Pe)),oe&&(xe.pitch=s.n(A,U,Pe)),he&&(xe.interpolatePadding(C,H,Pe),K=xe.centerPoint.add(Z)),$)xe.setLocationAtPoint($,le);else{const ct=xe.zoomScale(xe.zoom-w),je=R>w?Math.min(2,ee):Math.max(.5,ee),et=Math.pow(je,1-Pe),Le=xe.unproject(Q.add(te.mult(Pe*et)).mult(ct));xe.setLocationAtPoint(xe.renderWorldCopies?Le.wrap():Le,K)}return l.preloadOnly||this._fireMoveEvents(d),xe};if(l.preloadOnly){const xe=this._emulate(ve,l.duration,v);return this._preloadTiles(xe),this}const Ee={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=_e,this._rotating=ye,this._pitching=oe,this._easeId=l.easeId,this._prepareEase(d,l.noMoveStart,Ee),this._ease(ve(v),xe=>{v.cameraElevationReference==="sea"&&v.recenterOnTerrain(),this._afterEase(d,xe)},l),this}_prepareEase(l,d,v={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),d||v.moving||this.fire(new s.a8("movestart",l)),this._zooming&&!v.zooming&&this.fire(new s.a8("zoomstart",l)),this._rotating&&!v.rotating&&this.fire(new s.a8("rotatestart",l)),this._pitching&&!v.pitching&&this.fire(new s.a8("pitchstart",l))}_fireMoveEvents(l){this.fire(new s.a8("move",l)),this._zooming&&this.fire(new s.a8("zoom",l)),this._rotating&&this.fire(new s.a8("rotate",l)),this._pitching&&this.fire(new s.a8("pitch",l))}_afterEase(l,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const v=this._zooming,w=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,v&&this.fire(new s.a8("zoomend",l)),w&&this.fire(new s.a8("rotateend",l)),S&&this.fire(new s.a8("pitchend",l)),this.fire(new s.a8("moveend",l))}flyTo(l,d){if(this._prefersReducedMotion(l)){const Ke=s.p(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ke,d)}this.stop(),l=s.ak({offset:[0,0],speed:1.2,curve:1.42,easing:s.cG},l);const v=this.transform,w=this.getZoom(),S=this.getBearing(),A=this.getPitch(),C="zoom"in l?s.c(+l.zoom,v.minZoom,v.maxZoom):w,R="bearing"in l?this._normalizeBearing(l.bearing,S):S,B="pitch"in l?+l.pitch:A,U=v.zoomScale(C-w),H=s.P.convert(l.offset),Z=v.centerPoint.add(H),K=v.pointLocation(Z);let Q=l.center;if(Q&&l.padding){const Ke=this._cameraForBounds(this.transform,Q,Q,R,B,l);Ke&&(Q=Ke.center)}Q=s.L.convert(Q||K),this._normalizeCenter(Q);const te=v.project(K),ee=v.project(Q).sub(te);let $=l.curve;const le=Math.max(v.width,v.height),_e=le/U,ye=ee.mag();if("minZoom"in l){const Ke=s.c(Math.min(l.minZoom,w,C),v.minZoom,v.maxZoom),dt=le/v.zoomScale(Ke-w);$=Math.sqrt(dt/ye*2)}const oe=$*$;function he(Ke){const dt=(_e*_e-le*le+(Ke?-1:1)*oe*oe*ye*ye)/(2*(Ke?_e:le)*oe*ye);return Math.log(Math.sqrt(dt*dt+1)-dt)}function ve(Ke){return(Math.exp(Ke)-Math.exp(-Ke))/2}function Ee(Ke){return(Math.exp(Ke)+Math.exp(-Ke))/2}const xe=he(0);let Pe=function(Ke){return Ee(xe)/Ee(xe+$*Ke)},ct=function(Ke){return le*((Ee(xe)*(ve(dt=xe+$*Ke)/Ee(dt))-ve(xe))/oe)/ye;var dt},je=(he(1)-xe)/$;if(Math.abs(ye)<1e-6||!isFinite(je)){if(Math.abs(le-_e)<1e-6)return this.easeTo(l,d);const Ke=_e<le?-1:1;je=Math.abs(Math.log(_e/le))/$,ct=function(){return 0},Pe=function(dt){return Math.exp(Ke*$*dt)}}l.duration="duration"in l?+l.duration:1e3*je/("screenSpeed"in l?+l.screenSpeed/$:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const et=S!==R,Le=B!==A,at=Ke=>dt=>{const me=dt*je,Fe=1/Pe(me);Ke.zoom=dt===1?C:w+Ke.scaleZoom(Fe),et&&(Ke.bearing=s.n(S,R,dt)),Le&&(Ke.pitch=s.n(A,B,dt));const Mt=dt===1?Q:Ke.unproject(te.add(ee.mult(ct(me))).mult(Fe));return Ke.setLocationAtPoint(Ke.renderWorldCopies?Mt.wrap():Mt,Z),Ke._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(d),Ke};if(l.preloadOnly){const Ke=this._emulate(at,l.duration,v);return this._preloadTiles(Ke),this}return this._zooming=!0,this._rotating=et,this._pitching=Le,this._prepareEase(d,!1),this._ease(at(v),()=>this._afterEase(d),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const v=this._onEaseEnd;this._onEaseEnd=void 0,v.call(this,d)}if(!l){const v=this.handlers;v&&v.stop(!1)}return this}_ease(l,d,v){v.animate===!1||v.duration===0?(l(1),d()):(this._easeStart=s.a4.now(),this._easeOptions=v,this._onEaseFrame=l,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((s.a4.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,d){l=s.w(l,-180,180);const v=Math.abs(l-d);return Math.abs(l-360-d)<v&&(l-=360),Math.abs(l+360-d)<v&&(l+=360),l}_normalizeCenter(l){const d=this.transform;if(d.maxBounds||d.projection.name!=="globe"&&!d.renderWorldCopies)return;const v=l.lng-d.center.lng;l.lng+=v>180?-360:v<-180?360:0}_prefersReducedMotion(l){return this._respectPrefersReducedMotion&&s.a4.prefersReducedMotion&&!(l&&l.essential)}_emulate(l,d,v){const w=Math.ceil(15*d/1e3),S=[],A=l(v.clone());for(let C=0;C<=w;C++){const R=A(C/w);S.push(R.clone())}return S}}class Ef{constructor(l={}){this.options=l,s.aR(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const d=this.options&&this.options.compact;return this._map=l,this._container=V("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=V("button","mapboxgl-ctrl-attrib-button",this._container),V("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V("div","mapboxgl-ctrl-attrib-inner",this._container),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(l,d){const v=this._map._getUIString(`AttributionControl.${d}`);l.removeAttribute("title"),l.firstElementChild&&l.firstElementChild.setAttribute("title",v)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.cM.ACCESS_TOKEN}];if(l){const v=d.reduce((w,S,A)=>(S.value&&(w+=`${S.key}=${S.value}${A<d.length-1?"&":""}`),w),"?");l.href=`${s.cM.FEEDBACK_URL}/${v}#${ol(this._map,!0)}`,l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}}_updateData(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const d=this._map.style._mergedSourceCaches;for(const w in d){const S=d[w];if(S.used){const A=S.getSource();A.attribution&&l.indexOf(A.attribution)<0&&l.push(A.attribution)}}l.sort((w,S)=>w.length-S.length),l=l.filter((w,S)=>{for(let A=S+1;A<l.length;A++)if(l[A].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const v=l.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,l.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Af{constructor(){s.aR(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=V("div","mapboxgl-ctrl");const d=V("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(Object.entries(l).length===0)return!0;for(const d in l){const v=l[d].getSource();if(v.hasOwnProperty("mapbox_logo")&&!v.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const d=l[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class If{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const d=++this._id;return this._queue.push({callback:l,id:d,cancelled:!1}),d}remove(l){const d=this._currentlyRunning,v=d?this._queue.concat(d):this._queue;for(const w of v)if(w.id===l)return void(w.cancelled=!0)}run(l=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const v of d)if(!v.cancelled&&(v.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Cf(g,l,d){if(g=new s.L(g.lng,g.lat),l){const v=new s.L(g.lng-360,g.lat),w=new s.L(g.lng+360,g.lat),S=360*Math.ceil(Math.abs(g.lng-d.center.lng)/360),A=d.locationPoint(g).distSqr(l),C=l.x<0||l.y<0||l.x>d.width||l.y>d.height;d.locationPoint(v).distSqr(l)<A&&(C||Math.abs(v.lng-d.center.lng)<S)?g=v:d.locationPoint(w).distSqr(l)<A&&(C||Math.abs(w.lng-d.center.lng)<S)&&(g=w)}for(;Math.abs(g.lng-d.center.lng)>180;){const v=d.locationPoint(g);if(v.x>=0&&v.y>=0&&v.x<=d.width&&v.y<=d.height)break;g.lng>d.center.lng?g.lng-=360:g.lng+=360}return g}const rd={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Vr extends s.a6{constructor(l,d){if(super(),(l instanceof HTMLElement||d)&&(l=s.ak({element:l},d)),s.aR(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=s.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=V("div");const S=41,A=27,C=X("svg",{display:"block",height:S*this._scale+"px",width:A*this._scale+"px",viewBox:`0 0 ${A} ${S}`},this._element),R=X("radialGradient",{id:"shadowGradient"},X("defs",{},C));X("stop",{offset:"10%","stop-opacity":.4},R),X("stop",{offset:"100%","stop-opacity":.05},R),X("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),X("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),X("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),X("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=s.P.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",S=>{S.preventDefault()}),this._element.addEventListener("mousedown",S=>{S.preventDefault()});const v=this._element.classList;for(const S in rd)v.remove(`mapboxgl-marker-anchor-${S}`);v.add(`mapboxgl-marker-anchor-${this._anchor}`);const w=l&&l.className?l.className.trim().split(/\s+/):[];v.add(...w),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){const l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=s.L.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(38.1-13.5+w)],"bottom-right":[-w,-1*(38.1-13.5+w)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const d=l.code,v=l.charCode||l.keyCode;d!=="Space"&&d!=="Enter"&&v!==32&&v!==13||this.togglePopup()}_onMapClick(l){const d=l.originalEvent.target,v=this._element;this._popup&&(d===v||v.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const l=this._map,d=this._pos;if(!l||!d)return!1;const v=l.unproject(d),w=l.getFreeCameraOptions();if(!w.position)return!1;const S=w.position.toLngLat();return S.distanceTo(v)<.9*S.distanceTo(this._lngLat)}_evaluateOpacity(){const l=this._map;if(!l)return;const d=this._pos;if(!d||d.x<0||d.x>l.transform.width||d.y<0||d.y>l.transform.height)return void this._clearFadeTimer();const v=l.unproject(d);let w;l._showingGlobe()&&s.cN(l.transform,this._lngLat)?w=0:(w=1-l._queryFogOpacity(v),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(w*=this._occludedOpacity)),this._element.style.opacity=`${w}`,this._element.style.pointerEvents=w>0?"auto":"none",this._popup&&this._popup._setOpacity(w),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const l=this._pos;if(!l||!this._map)return;const d=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${l.x}px,${l.y}px)
            ${rd[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${d.x}px,${d.y}px)
        `}_calculateXYTransform(){const l=this._pos,d=this._map,v=this.getPitchAlignment();if(!d||!l||v!=="map")return"";if(!d._showingGlobe()){const R=d.getPitch();return R?`rotateX(${R}deg)`:""}const w=s.Y(s.cO(d.transform,this._lngLat)),S=l.sub(s.cP(d.transform)),A=Math.abs(S.x)+Math.abs(S.y);if(A===0)return"";const C=w/A;return`rotateX(${-S.y*C}deg) rotateY(${S.x*C}deg)`}_calculateZTransform(){const l=this._pos,d=this._map;if(!d||!l)return"";let v=0;const w=this.getRotationAlignment();if(w==="map")if(d._showingGlobe()){const S=d.project(new s.L(this._lngLat.lng,this._lngLat.lat+.001)),A=d.project(new s.L(this._lngLat.lng,this._lngLat.lat-.001)).sub(S);v=s.Y(Math.atan2(A.y,A.x))-90}else v=-d.getBearing();else if(w==="horizon"){const S=s.an(4,6,d.getZoom()),A=s.cP(d.transform);A.y+=S*d.transform.height;const C=l.sub(A),R=s.Y(Math.atan2(C.y,C.x));v=(R>90?R-270:R+90)*(1-S)}return v+=this._rotation,v?`rotateZ(${v}deg)`:""}_update(l){cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=Cf(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat),l===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(d._showingGlobe()||d.getTerrain()||d.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=s.P.convert(l),this._update(),this}addClassName(l){return this._element.classList.add(l),this}removeClassName(l){return this._element.classList.remove(l),this}toggleClassName(l){return this._element.classList.toggle(l)}_onMove(l){const d=this._map;if(!d)return;const v=this._pointerdownPos,w=this._positionDelta;if(v&&w){if(!this._isDragging){const S=this._clickTolerance||d._clickTolerance;if(l.point.dist(v)<S)return;this._isDragging=!0}this._pos=l.point.sub(w),this._lngLat=d.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.a8("dragstart"))),this.fire(new s.a8("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.a8("dragend")),this._state="inactive"}_addDragHandler(l){const d=this._map,v=this._pos;d&&v&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(v),this._pointerdownPos=l.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;const d=this._map;return d&&(l?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Gy={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Nm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Pf(g=new s.P(0,0),l="bottom"){if(typeof g=="number"){const d=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(l){case"top":return new s.P(0,g);case"top-left":return new s.P(d,d);case"top-right":return new s.P(-d,d);case"bottom":return new s.P(0,-g);case"bottom-left":return new s.P(d,-d);case"bottom-right":return new s.P(-d,-d);case"left":return new s.P(g,0);case"right":return new s.P(-g,0)}return new s.P(0,0)}return g instanceof s.P||Array.isArray(g)?s.P.convert(g):s.P.convert(g[l]||[0,0])}class Hy{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const d=s.ba((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,d,v){this._start=this.getValue(d),this._end=l,this._startTime=d,this._endTime=d+v}}const qy={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Hs={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class Vm{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.continuousRedraw=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}const Wy={showCompass:!0,showZoom:!0,visualizePitch:!1};class ll{constructor(l,d,v=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new wf({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,v&&(this.mousePitch=new Tf({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),s.aR(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(l,d){this.mouseRotate.mousedown(l,d),this.mousePitch&&this.mousePitch.mousedown(l,d),ue()}move(l,d){const v=this.map,w=this.mouseRotate.mousemoveWindow(l,d),S=w&&w.bearingDelta;if(S&&v.setBearing(v.getBearing()+S),this.mousePitch){const A=this.mousePitch.mousemoveWindow(l,d),C=A&&A.pitchDelta;C&&v.setPitch(v.getPitch()+C)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ce(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(s.ak({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),Ce(this.element,l)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,Ce(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=He(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){l.targetTouches.length!==1?this.reset():(this._lastPos=He(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ca={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Bc={maxWidth:100,unit:"metric"},od={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:s.c$,supported:P,setRTLTextPlugin:s.d1,getRTLTextPluginStatus:s.d2,Map:class extends Bm{constructor(g){const l=g;if((g=s.ak({},Hs,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&s.cQ(window)&&(g.antialias=!1,s.X("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new un(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._repaint=!1,this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new If,this._domRenderTaskQueue=new If,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.cR(),this._locale=s.ak({},qy,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Hy(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.cS(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,this._contextCreateOptions=g.contextCreateOptions?{...g.contextCreateOptions}:{},typeof g.container=="string"){const d=document.getElementById(g.container);if(!d)throw new Error(`Container '${g.container.toString()}' not found.`);this._container=d}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&s.X("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),s.aR(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new Vm,this._tp=g.devtools?new vm(this):new vm,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,d=>{this.repaint=d}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new zm(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,(g.style||!g.testMode)&&this.setStyle(g.style||s.cM.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),g.hash&&(this._hash=new Mm(typeof g.hash=="string"&&g.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){l.center==null&&l.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch});const d=g.bounds;d&&(this.resize(),this.fitBounds(d,s.ak({},g.fitBoundsOptions,{duration:0})))}this.resize(),g.attributionControl&&this.addControl(new Ef({customAttribution:g.customAttribution})),this._logoControl=new Af,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",d=>{this._update(d.dataType==="style"),this.fire(new s.a8(`${d.dataType}data`,d))}),this.on("dataloading",d=>{this.fire(new s.a8(`${d.dataType}dataloading`,d))})}_getMapId(){return this._mapId}addControl(g,l){if(l===void 0&&(l=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new s.a7(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=g.onAdd(this);this._controls.push(g);const v=this._controlPositions[l];return l.indexOf("bottom")!==-1?v.insertBefore(d,v.firstChild):v.appendChild(d),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new s.a7(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(g);return l>-1&&this._controls.splice(l,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new s.a8("movestart",g)).fire(new s.a8("move",g)),this.fire(new s.a8("resize",g)),l&&this.fire(new s.a8("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(s.D.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new s.a8("zoomstart")).fire(new s.a8("zoom")).fire(new s.a8("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new s.a8("zoomstart")).fire(new s.a8("zoom")).fire(new s.a8("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new s.a8("pitchstart")).fire(new s.a8("pitch")).fire(new s.a8("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new s.a8("pitchstart")).fire(new s.a8("pitch")).fire(new s.a8("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return g==="auto"?navigator.language:Array.isArray(g)?g.length===0?void 0:g.map(l=>l==="auto"?navigator.language:l):g}setLanguage(g){const l=this._parseLanguage(g);if(!this.style||l===this._language)return this;this._language=l,this.style.reloadSources();for(const d of this._controls)d._setLanguage&&d._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(g){return this._lazyInitEmptyStyle(),g?typeof g=="string"&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const g=this.transform,l=g.projection.name;let d;l==="globe"&&g.zoom>=s.G?(g.setMercatorFromTransition(),d=!0):l==="mercator"&&g.zoom<s.G&&(g.setProjection({name:"globe"}),d=!0),d&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,l){return this._updateProjection(g||l||{name:"mercator"})}_updateProjection(g){let l;return l=g.name==="globe"&&this.transform.zoom>=s.G?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),l&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(g){return this.transform.locationPoint3D(s.L.convert(g))}unproject(g){return this.transform.pointLocation3D(s.P.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,l,d){if(g==="mouseenter"||g==="mouseover"){let v=!1;const w=A=>{const C=l.filter(B=>this.getLayer(B)),R=C.length?this.queryRenderedFeatures(A.point,{layers:C}):[];R.length?v||(v=!0,d.call(this,new gs(g,this,A.originalEvent,{features:R}))):v=!1},S=()=>{v=!1};return{layers:new Set(l),listener:d,delegates:{mousemove:w,mouseout:S}}}if(g==="mouseleave"||g==="mouseout"){let v=!1;const w=A=>{const C=l.filter(R=>this.getLayer(R));(C.length?this.queryRenderedFeatures(A.point,{layers:C}):[]).length?v=!0:v&&(v=!1,d.call(this,new gs(g,this,A.originalEvent)))},S=A=>{v&&(v=!1,d.call(this,new gs(g,this,A.originalEvent)))};return{layers:new Set(l),listener:d,delegates:{mousemove:w,mouseout:S}}}{const v=w=>{const S=l.filter(C=>this.getLayer(C)),A=S.length?this.queryRenderedFeatures(w.point,{layers:S}):[];A.length&&(w.features=A,d.call(this,w),delete w.features)};return{layers:new Set(l),listener:d,delegates:{[g]:v}}}}on(g,l,d){if(d===void 0)return super.on(g,l);if(Array.isArray(l)||(l=[l]),l){for(const w of l)if(!this._isValidId(w))return this}const v=this._createDelegatedListener(g,l,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(v);for(const w in v.delegates)this.on(w,v.delegates[w]);return this}once(g,l,d){if(d===void 0)return super.once(g,l);if(Array.isArray(l)||(l=[l]),l){for(const w of l)if(!this._isValidId(w))return this}const v=this._createDelegatedListener(g,l,d);for(const w in v.delegates)this.once(w,v.delegates[w]);return this}off(g,l,d){if(d===void 0)return super.off(g,l);l=new Set(Array.isArray(l)?l:[l]);for(const S of l)if(!this._isValidId(S))return this;const v=(S,A)=>{if(S.size!==A.size)return!1;for(const C of S)if(!A.has(C))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[g]:void 0;return w&&(S=>{for(let A=0;A<S.length;A++){const C=S[A];if(C.listener===d&&v(C.layers,l)){for(const R in C.delegates)this.off(R,C.delegates[R]);return S.splice(A,1),this}}})(w),this}queryRenderedFeatures(g,l){if(!this.style)return[];if(l!==void 0||g===void 0||g instanceof s.P||Array.isArray(g)||(l=g,g=void 0),g=g||[[0,0],[this.transform.width,this.transform.height]],(l=l||{}).layers&&Array.isArray(l.layers)){for(const d of l.layers)if(!this._isValidId(d))return[]}return this.style.queryRenderedFeatures(g,l,this.transform)}querySourceFeatures(g,l){return this._isValidId(g)?this.style.querySourceFeatures(g,l):[]}isPointOnSurface(g){const{name:l}=this.transform.projection;return l!=="globe"&&l!=="mercator"&&s.X(`${l} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(g))}setStyle(g,l){return(l=s.ak({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&l.localFontFamily===this._localFontFamily&&this.style&&g?(this._diffStyle(g,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(g,l))}_getUIString(g){const l=this._locale[g];if(l==null)throw new Error(`Missing UI string '${g}'`);return l}_updateStyle(g,l){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g&&(this.style=new Es(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Es(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,l){if(typeof g=="string"){const d=this._requestManager.normalizeStyleURL(g),v=this._requestManager.transformRequest(d,s.a2.Style);s.a1(v,(w,S)=>{w?this.fire(new s.a7(w)):S&&this._updateDiff(S,l)})}else typeof g=="object"&&this._updateDiff(g,l)}_updateDiff(g,l){try{this.style.setState(g)&&this._update(!0)}catch(d){s.X(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(g,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.X("There is no style added to the map."),!1)}_isValidId(g){return g==null?(this.fire(new s.a7(new Error("IDs can't be empty."))),!1):!s.cu(g)||(this.fire(new s.a7(new Error(`IDs can't contain special symbols: "${g}".`))),!1)}addSource(g,l){return this._isValidId(g)?(this._lazyInitEmptyStyle(),this.style.addSource(g,l),this._update(!0)):this}isSourceLoaded(g){return!!this._isValidId(g)&&!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(g,l,d){this._lazyInitEmptyStyle(),this.style.addSourceType(g,l,d)}removeSource(g){return this._isValidId(g)?(this.style.removeSource(g),this._updateTerrain(),this._update(!0)):this}getSource(g){return this._isValidId(g)?this.style.getOwnSource(g):null}addImage(g,l,{pixelRatio:d=1,sdf:v=!1,stretchX:w,stretchY:S,content:A}={}){if(this._lazyInitEmptyStyle(),l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap){const{width:C,height:R,data:B}=s.a4.getImageData(l);this.style.addImage(g,{data:new s.a5({width:C,height:R},B),pixelRatio:d,stretchX:w,stretchY:S,content:A,sdf:v,version:0})}else if(l.width===void 0||l.height===void 0)this.fire(new s.a7(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:R}=l,B=l;this.style.addImage(g,{data:new s.a5({width:C,height:R},new Uint8Array(B.data)),pixelRatio:d,stretchX:w,stretchY:S,content:A,sdf:v,version:0,userImage:B}),B.onAdd&&B.onAdd(this,g)}}updateImage(g,l){this._lazyInitEmptyStyle();const d=this.style.getImage(g);if(!d)return void this.fire(new s.a7(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap?s.a4.getImageData(l):l,{width:w,height:S}=v,A=v.data;if(w===void 0||S===void 0)return void this.fire(new s.a7(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(w!==d.data.width||S!==d.data.height)return void this.fire(new s.a7(new Error(`The width and height of the updated image (${w}, ${S})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`)));const C=!(l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap);d.data.replace(A,C),this.style.updateImage(g,d)}hasImage(g){return g?!!this.style&&!!this.style.getImage(g):(this.fire(new s.a7(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,l){s.a3(this._requestManager.transformRequest(g,s.a2.Image),(d,v)=>{l(d,v instanceof HTMLImageElement?s.a4.getImageData(v):v)})}listImages(){return this.style.listImages()}addModel(g,l){this._lazyInitEmptyStyle(),this.style.addModel(g,l)}hasModel(g){return g?this.style.hasModel(g):(this.fire(new s.a7(new Error("Missing required model id"))),!1)}removeModel(g){this.style.removeModel(g)}listModels(){return this.style.listModels()}addLayer(g,l){return this._isValidId(g.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(g,l),this._update(!0)):this}moveLayer(g,l){return this._isValidId(g)?(this.style.moveLayer(g,l),this._update(!0)):this}removeLayer(g){return this._isValidId(g)?(this.style.removeLayer(g),this._update(!0)):this}getLayer(g){return this._isValidId(g)?this.style.getOwnLayer(g):null}setLayerZoomRange(g,l,d){return this._isValidId(g)?(this.style.setLayerZoomRange(g,l,d),this._update(!0)):this}setFilter(g,l,d={}){return this._isValidId(g)?(this.style.setFilter(g,l,d),this._update(!0)):this}getFilter(g){return this._isValidId(g)?this.style.getFilter(g):null}setPaintProperty(g,l,d,v={}){return this._isValidId(g)?(this.style.setPaintProperty(g,l,d,v),this._update(!0)):this}getPaintProperty(g,l){return this._isValidId(g)?this.style.getPaintProperty(g,l):null}setLayoutProperty(g,l,d,v={}){return this._isValidId(g)?(this.style.setLayoutProperty(g,l,d,v),this._update(!0)):this}getLayoutProperty(g,l){return this._isValidId(g)?this.style.getLayoutProperty(g,l):null}getConfigProperty(g,l){return this.style.getConfigProperty(g,l)}setConfigProperty(g,l,d){return this.style.setConfigProperty(g,l,d),this._update(!0)}setLights(g){if(this._lazyInitEmptyStyle(),g&&g.length===1&&g[0].type==="flat"){const l=g[0];l.properties?this.style.setFlatLight(l.properties,l.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(g),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const g=this.style.getLights()||[];return g.length===0&&g.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),g}setLight(g,l={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:g}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(g){return this.style.setCamera(g),this._triggerCameraUpdate(g)}_triggerCameraUpdate(g){return this._update(this.transform.setOrthographicProjectionAtLowPitch(g["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.L.convert(g),this.transform):0}setFeatureState(g,l){return this._isValidId(g.source)?(this.style.setFeatureState(g,l),this._update()):this}removeFeatureState(g,l){return this._isValidId(g.source)?(this.style.removeFeatureState(g,l),this._update()):this}getFeatureState(g){return this._isValidId(g.source)?this.style.getFeatureState(g):null}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let d,v,w,S=this._container;for(;S&&(!v||!w);){const A=window.getComputedStyle(S).transform;A&&A!=="none"&&(d=A.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&d[0]!=="0"&&d[0]!=="1"&&(v=d[0]),d[3]&&d[3]!=="0"&&d[3]!=="1"&&(w=d[3])),S=S.parentElement}this._containerWidth=v?Math.abs(g/v):g,this._containerHeight=w?Math.abs(l/w):l}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.X("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=V("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=V("div","mapboxgl-canvas-container",g);this._canvas=V("canvas","mapboxgl-canvas",l),this._interactive&&(l.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=V("div","mapboxgl-control-container",g),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{v[w]=V("div",`mapboxgl-ctrl-${w}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,l){const d=s.a4.devicePixelRatio||1;this._canvas.width=d*Math.ceil(g),this._canvas.height=d*Math.ceil(l),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${l}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const l=this._markers.indexOf(g);l!==-1&&this._markers.splice(l,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const l=this._popups.indexOf(g);l!==-1&&this._popups.splice(l,1)}_setupPainter(){const g=s.ak({},P.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._canvas.getContext("webgl2",g);l?(s.cT(l,!0),this.painter=new Fy(l,this._contextCreateOptions,this.transform,this._tp),this.on("data",d=>{d.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.cU.testSupport(l)):this.fire(new s.a7(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.a8("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new s.a8("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let l;this.fire(new s.a8("renderstart"));const d=this.painter.context.extTimerQuery,v=s.a4.now(),w=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(l=w.createQuery(),w.beginQuery(d.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const S=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,B=this.transform.pitch,U=s.a4.now(),H=new s.al(R,{now:U,fadeDuration:S,pitch:B,transition:this.style.transition});this.style.update(H)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let A=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),A=this._updateAverageElevation(v),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):A=this._updateAverageElevation(v),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,S,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:S,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.a8("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.a8("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){const R=s.a4.now()-v;w.endQuery(d.TIME_ELAPSED_EXT),setTimeout(()=>{const B=w.getQueryParameter(l,w.QUERY_RESULT)/1e6;w.deleteQuery(l),this.fire(new s.a8("gpu-timing-frame",{cpuTime:R,gpuTime:B}))},50)}if(this.listens("gpu-timing-layer")){const R=this.painter.collectGpuTimers();setTimeout(()=>{const B=this.painter.queryGpuTimers(R);this.fire(new s.a8("gpu-timing-layer",{layerTimes:B}))},50)}if(this.listens("gpu-timing-deferred-render")){const R=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const B=this.painter.queryGpuTimeDeferredRender(R);this.fire(new s.a8("gpu-timing-deferred-render",{gpuTime:B}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||A;if(C||this._repaint)this.triggerRepaint();else{const R=!this.isMoving()&&this.loaded();if(R&&(A=this._updateAverageElevation(v,!0)),A)this.triggerRepaint();else if(this._triggerFrame(!1),R&&(this.fire(new s.a8("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const B=this._calculateSpeedIndex();this.fire(new s.a8("speedindexcompleted",{speedIndex:B})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,this._performanceMetricsCollection&&s.cV(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const l of this._markers)g&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(const l of this._popups)!g||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(g,l=!1){const d=w=>(this.transform.averageElevation=w,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&d(0);const v=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(v||(l||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const w=this.transform.averageElevation;let S=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(S)?S=0:this._averageElevationLastSampledAt=g;const A=Math.abs(w-S);if(A>1){if(this._isInitialLoad||v)return this._averageElevation.jumpTo(S),d(S);this._averageElevation.easeTo(S,g,300)}else if(A>1e-4)return this._averageElevation.jumpTo(S),d(S)}return!!this._averageElevation.isEasing(g)&&d(this._averageElevation.getValue(g))}_authenticate(){s.cW(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===s.cX||g.status===401)){const l=this.painter.context.gl;s.cT(l,!1),this._logoControl instanceof Af&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.a7(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.cY(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const d=this.painter.context.gl,v=d.createFramebuffer();function w(S){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,S,0);const A=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,A),A}return d.bindFramebuffer(d.FRAMEBUFFER,v),this._canvasPixelComparison(w(g),l.canvasCopies.map(w),l.timeStamps)}_canvasPixelComparison(g,l,d){let v=d[1]-d[0];const w=g.length/4;for(let S=0;S<l.length;S++){const A=l[S];let C=0;for(let R=0;R<A.length;R+=4)A[R]===g[R]&&A[R+1]===g[R+1]&&A[R+2]===g[R+2]&&A[R+3]===g[R+3]&&(C+=1);v+=(d[S+2]-d[S+1])*(1-C/w)}return v}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.cZ(this.painter.context.gl),this._removed=!0,this.fire(new s.a8("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=s.a4.frame(l=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(l)}))}_preloadTiles(g){const l=this.style?Object.values(this.style._sourceCaches):[];return s.c_(l,(d,v)=>d._preloadTiles(g,v),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(g){this._showLayers2DWireframe!==g&&(this._showLayers2DWireframe=g,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(g){this._showLayers3DWireframe!==g&&(this._showLayers3DWireframe=g,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,g&&this._update())}_setCacheLimits(g,l){s.d0(g,l)}get version(){return s.c$}},NavigationControl:class{constructor(g){this.options=s.ak({},Wy,g),this._container=V("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(s.aR(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),V("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),V("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aR(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:l}):d.resetNorth({},{originalEvent:l}))}),this._compassIcon=V("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const l=g.getZoom(),d=l===g.getMaxZoom(),v=l===g.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=v,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",v.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ll(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,l){const d=V("button",g,this._container);return d.type="button",d.addEventListener("click",l),d}_setButtonTitle(g,l){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${l}`);g.setAttribute("aria-label",d),g.firstElementChild&&g.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends s.a6{constructor(g){super();const l=navigator.geolocation;this.options=s.ak({geolocation:l},ca,g),s.aR(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=rl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=V("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const l=(d=!!this.options.geolocation)=>{this._supportsGeolocation=d,g(d)};this._supportsGeolocation!==void 0?g(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(d=>l(d.state!=="denied")).catch(()=>l()):l()}_isOutOfMapMaxBounds(g){const l=this._map.getMaxBounds(),d=g.coords;return!!l&&(d.longitude<l.getWest()||d.longitude>l.getEast()||d.latitude<l.getSouth()||d.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new s.a8("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.a8("geolocate",g)),this._finish()}}_updateCamera(g){const l=new s.L(g.coords.longitude,g.coords.latitude),d=g.coords.accuracy,v=this._map.getBearing(),w=s.ak({bearing:v},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(d),w,{geolocateSource:!0})}_updateMarker(g){if(g){const l=new s.L(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,l=s.b(1,g._center.lat)*g.worldSize,d=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.a8("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=V("button","mapboxgl-ctrl-geolocate",this._container),V("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",g===!1){s.X("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V("div","mapboxgl-user-location"),this._dotElement.appendChild(V("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(V("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Vr({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=V("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Vr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.a8("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:g.absolute===!0&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.X("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.a8("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.a8("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.a8("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(l=>{l==="granted"&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ef,ScaleControl:class{constructor(g){this.options=s.ak({},Bc,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aR(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,l=this._map,d=l._containerHeight/2,v=l._containerWidth/2-g/2,w=l.unproject([v,d]),S=l.unproject([v+g,d]),A=w.distanceTo(S);if(this.options.unit==="imperial"){const C=3.2808*A;C>5280?this._setScale(g,C/5280,"mile"):this._setScale(g,C,"foot")}else this.options.unit==="nautical"?this._setScale(g,A/1852,"nautical-mile"):A>=1e3?this._setScale(g,A/1e3,"kilometer"):this._setScale(g,A,"meter")}_setScale(g,l,d){this._map._requestDomTask(()=>{const v=function(S){const A=Math.pow(10,`${Math.floor(S)}`.length-1);let C=S/A;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(R){const B=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*B)/B}(C),A*C}(l),w=v/l;this._container.innerHTML=this._isNumberFormatSupported&&d!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:d}).format(v):`${v}&nbsp;${od[d]}`,this._container.style.width=g*w+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=V("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g){this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:s.X("Full screen control 'container' must be a DOM element.")),s.aR(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=V("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.X("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=V("button","mapboxgl-ctrl-fullscreen",this._controlContainer);V("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.a6{constructor(g){super(),this.options=s.ak(Object.create(Gy),g),s.aR(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new s.a8("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new s.a8("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=s.L.convert(g),this._pos=null,this._trackPointer=!1,this._update();const l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const l=document.createDocumentFragment(),d=document.createElement("body");let v;for(d.innerHTML=g;v=d.firstChild,v;)l.appendChild(v);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=V("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(g),this.options.closeButton){const d=this._closeButton=V("button","mapboxgl-popup-close-button",l);d.type="button",d.setAttribute("aria-label","Close popup"),d.setAttribute("aria-hidden","true"),d.innerHTML="&#215;",d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let l;return this._classList.delete(g)?l=!1:(this._classList.add(g),l=!0),this._updateClassList(),l}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const l=this._map,d=this._container,v=this._pos;if(!l||!d||!v)return"bottom";const w=d.offsetWidth,S=d.offsetHeight,A=v.x<w/2,C=v.x>l.transform.width-w/2;if(v.y+g<S)return A?"top-left":C?"top-right":"top";if(v.y>l.transform.height-S){if(A)return"bottom-left";if(C)return"bottom-right"}return A?"left":C?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),g.className=l.join(" ")}_update(g){const l=this._map,d=this._content;if(!l||!this._lngLat&&!this._trackPointer||!d)return;let v=this._container;if(v||(v=this._container=V("div","mapboxgl-popup",l.getContainer()),this._tip=V("div","mapboxgl-popup-tip",v),v.appendChild(d)),this.options.maxWidth&&v.style.maxWidth!==this.options.maxWidth&&(v.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Cf(this._lngLat,this._pos,l.transform)),!this._trackPointer||g){const w=this._pos=this._trackPointer&&g?g:l.project(this._lngLat),S=Pf(this.options.offset),A=this._anchor=this._getAnchor(S.y),C=Pf(this.options.offset,A),R=w.add(C).round();l._requestDomTask(()=>{this._container&&A&&(this._container.style.transform=`${rd[A]} translate(${R.x}px,${R.y}px)`)})}if(!this._marker&&l._showingGlobe()){const w=s.cN(l.transform,this._lngLat)?0:1;this._setOpacity(w)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(Nm);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:Vr,Style:Es,LngLat:s.L,LngLatBounds:s.D,Point:s.P,MercatorCoordinate:s.M,FreeCameraOptions:Gi,Evented:s.a6,config:s.cM,prewarm:s.d3,clearPrewarmedResources:s.d4,get accessToken(){return s.cM.ACCESS_TOKEN},set accessToken(g){s.cM.ACCESS_TOKEN=g},get baseApiUrl(){return s.cM.API_URL},set baseApiUrl(g){s.cM.API_URL=g},get workerCount(){return s.d5.workerCount},set workerCount(g){s.d5.workerCount=g},get maxParallelImageRequests(){return s.cM.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){s.cM.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){s.d6(g)},get workerUrl(){return s.d7.workerUrl},set workerUrl(g){s.d7.workerUrl=g},get workerClass(){return s.d7.workerClass},set workerClass(g){s.d7.workerClass=g},get workerParams(){return s.d7.workerParams},set workerParams(g){s.d7.workerParams=g},get dracoUrl(){return s.d8()},set dracoUrl(g){s.d9(g)},setNow:s.a4.setNow,restoreNow:s.a4.restoreNow}});var x=m;return x})})(TC);var YR=TC.exports;const kd=wC(YR);function MC(r,i){return function(){return r.apply(i,arguments)}}const{toString:JR}=Object.prototype,{getPrototypeOf:_b}=Object,vy=(r=>i=>{const o=JR.call(i);return r[o]||(r[o]=o.slice(8,-1).toLowerCase())})(Object.create(null)),Pl=r=>(r=r.toLowerCase(),i=>vy(i)===r),xy=r=>i=>typeof i===r,{isArray:nf}=Array,qp=xy("undefined");function KR(r){return r!==null&&!qp(r)&&r.constructor!==null&&!qp(r.constructor)&&va(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const EC=Pl("ArrayBuffer");function $R(r){let i;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?i=ArrayBuffer.isView(r):i=r&&r.buffer&&EC(r.buffer),i}const QR=xy("string"),va=xy("function"),AC=xy("number"),by=r=>r!==null&&typeof r=="object",e3=r=>r===!0||r===!1,g_=r=>{if(vy(r)!=="object")return!1;const i=_b(r);return(i===null||i===Object.prototype||Object.getPrototypeOf(i)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},t3=Pl("Date"),i3=Pl("File"),n3=Pl("Blob"),r3=Pl("FileList"),o3=r=>by(r)&&va(r.pipe),s3=r=>{let i;return r&&(typeof FormData=="function"&&r instanceof FormData||va(r.append)&&((i=vy(r))==="formdata"||i==="object"&&va(r.toString)&&r.toString()==="[object FormData]"))},a3=Pl("URLSearchParams"),l3=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function sm(r,i,{allOwnKeys:o=!1}={}){if(r===null||typeof r>"u")return;let c,h;if(typeof r!="object"&&(r=[r]),nf(r))for(c=0,h=r.length;c<h;c++)i.call(null,r[c],c,r);else{const m=o?Object.getOwnPropertyNames(r):Object.keys(r),_=m.length;let x;for(c=0;c<_;c++)x=m[c],i.call(null,r[x],x,r)}}function IC(r,i){i=i.toLowerCase();const o=Object.keys(r);let c=o.length,h;for(;c-- >0;)if(h=o[c],i===h.toLowerCase())return h;return null}const CC=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,PC=r=>!qp(r)&&r!==CC;function xx(){const{caseless:r}=PC(this)&&this||{},i={},o=(c,h)=>{const m=r&&IC(i,h)||h;g_(i[m])&&g_(c)?i[m]=xx(i[m],c):g_(c)?i[m]=xx({},c):nf(c)?i[m]=c.slice():i[m]=c};for(let c=0,h=arguments.length;c<h;c++)arguments[c]&&sm(arguments[c],o);return i}const c3=(r,i,o,{allOwnKeys:c}={})=>(sm(i,(h,m)=>{o&&va(h)?r[m]=MC(h,o):r[m]=h},{allOwnKeys:c}),r),u3=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),h3=(r,i,o,c)=>{r.prototype=Object.create(i.prototype,c),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:i.prototype}),o&&Object.assign(r.prototype,o)},d3=(r,i,o,c)=>{let h,m,_;const x={};if(i=i||{},r==null)return i;do{for(h=Object.getOwnPropertyNames(r),m=h.length;m-- >0;)_=h[m],(!c||c(_,r,i))&&!x[_]&&(i[_]=r[_],x[_]=!0);r=o!==!1&&_b(r)}while(r&&(!o||o(r,i))&&r!==Object.prototype);return i},f3=(r,i,o)=>{r=String(r),(o===void 0||o>r.length)&&(o=r.length),o-=i.length;const c=r.indexOf(i,o);return c!==-1&&c===o},p3=r=>{if(!r)return null;if(nf(r))return r;let i=r.length;if(!AC(i))return null;const o=new Array(i);for(;i-- >0;)o[i]=r[i];return o},m3=(r=>i=>r&&i instanceof r)(typeof Uint8Array<"u"&&_b(Uint8Array)),g3=(r,i)=>{const c=(r&&r[Symbol.iterator]).call(r);let h;for(;(h=c.next())&&!h.done;){const m=h.value;i.call(r,m[0],m[1])}},_3=(r,i)=>{let o;const c=[];for(;(o=r.exec(i))!==null;)c.push(o);return c},y3=Pl("HTMLFormElement"),v3=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(o,c,h){return c.toUpperCase()+h}),zM=(({hasOwnProperty:r})=>(i,o)=>r.call(i,o))(Object.prototype),x3=Pl("RegExp"),kC=(r,i)=>{const o=Object.getOwnPropertyDescriptors(r),c={};sm(o,(h,m)=>{let _;(_=i(h,m,r))!==!1&&(c[m]=_||h)}),Object.defineProperties(r,c)},b3=r=>{kC(r,(i,o)=>{if(va(r)&&["arguments","caller","callee"].indexOf(o)!==-1)return!1;const c=r[o];if(va(c)){if(i.enumerable=!1,"writable"in i){i.writable=!1;return}i.set||(i.set=()=>{throw Error("Can not rewrite read-only method '"+o+"'")})}})},w3=(r,i)=>{const o={},c=h=>{h.forEach(m=>{o[m]=!0})};return nf(r)?c(r):c(String(r).split(i)),o},T3=()=>{},S3=(r,i)=>(r=+r,Number.isFinite(r)?r:i),zv="abcdefghijklmnopqrstuvwxyz",FM="0123456789",DC={DIGIT:FM,ALPHA:zv,ALPHA_DIGIT:zv+zv.toUpperCase()+FM},M3=(r=16,i=DC.ALPHA_DIGIT)=>{let o="";const{length:c}=i;for(;r--;)o+=i[Math.random()*c|0];return o};function E3(r){return!!(r&&va(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}const A3=r=>{const i=new Array(10),o=(c,h)=>{if(by(c)){if(i.indexOf(c)>=0)return;if(!("toJSON"in c)){i[h]=c;const m=nf(c)?[]:{};return sm(c,(_,x)=>{const s=o(_,h+1);!qp(s)&&(m[x]=s)}),i[h]=void 0,m}}return c};return o(r,0)},I3=Pl("AsyncFunction"),C3=r=>r&&(by(r)||va(r))&&va(r.then)&&va(r.catch),Ut={isArray:nf,isArrayBuffer:EC,isBuffer:KR,isFormData:s3,isArrayBufferView:$R,isString:QR,isNumber:AC,isBoolean:e3,isObject:by,isPlainObject:g_,isUndefined:qp,isDate:t3,isFile:i3,isBlob:n3,isRegExp:x3,isFunction:va,isStream:o3,isURLSearchParams:a3,isTypedArray:m3,isFileList:r3,forEach:sm,merge:xx,extend:c3,trim:l3,stripBOM:u3,inherits:h3,toFlatObject:d3,kindOf:vy,kindOfTest:Pl,endsWith:f3,toArray:p3,forEachEntry:g3,matchAll:_3,isHTMLForm:y3,hasOwnProperty:zM,hasOwnProp:zM,reduceDescriptors:kC,freezeMethods:b3,toObjectSet:w3,toCamelCase:v3,noop:T3,toFiniteNumber:S3,findKey:IC,global:CC,isContextDefined:PC,ALPHABET:DC,generateString:M3,isSpecCompliantForm:E3,toJSONObject:A3,isAsyncFn:I3,isThenable:C3};function Zn(r,i,o,c,h){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",i&&(this.code=i),o&&(this.config=o),c&&(this.request=c),h&&(this.response=h)}Ut.inherits(Zn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ut.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const LC=Zn.prototype,OC={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{OC[r]={value:r}});Object.defineProperties(Zn,OC);Object.defineProperty(LC,"isAxiosError",{value:!0});Zn.from=(r,i,o,c,h,m)=>{const _=Object.create(LC);return Ut.toFlatObject(r,_,function(s){return s!==Error.prototype},x=>x!=="isAxiosError"),Zn.call(_,r.message,i,o,c,h),_.cause=r,_.name=r.name,m&&Object.assign(_,m),_};const P3=null;function bx(r){return Ut.isPlainObject(r)||Ut.isArray(r)}function RC(r){return Ut.endsWith(r,"[]")?r.slice(0,-2):r}function BM(r,i,o){return r?r.concat(i).map(function(h,m){return h=RC(h),!o&&m?"["+h+"]":h}).join(o?".":""):i}function k3(r){return Ut.isArray(r)&&!r.some(bx)}const D3=Ut.toFlatObject(Ut,{},null,function(i){return/^is[A-Z]/.test(i)});function wy(r,i,o){if(!Ut.isObject(r))throw new TypeError("target must be an object");i=i||new FormData,o=Ut.toFlatObject(o,{metaTokens:!0,dots:!1,indexes:!1},!1,function(q,Y){return!Ut.isUndefined(Y[q])});const c=o.metaTokens,h=o.visitor||P,m=o.dots,_=o.indexes,s=(o.Blob||typeof Blob<"u"&&Blob)&&Ut.isSpecCompliantForm(i);if(!Ut.isFunction(h))throw new TypeError("visitor must be a function");function M(X){if(X===null)return"";if(Ut.isDate(X))return X.toISOString();if(!s&&Ut.isBlob(X))throw new Zn("Blob is not supported. Use a Buffer instead.");return Ut.isArrayBuffer(X)||Ut.isTypedArray(X)?s&&typeof Blob=="function"?new Blob([X]):Buffer.from(X):X}function P(X,q,Y){let J=X;if(X&&!Y&&typeof X=="object"){if(Ut.endsWith(q,"{}"))q=c?q:q.slice(0,-2),X=JSON.stringify(X);else if(Ut.isArray(X)&&k3(X)||(Ut.isFileList(X)||Ut.endsWith(q,"[]"))&&(J=Ut.toArray(X)))return q=RC(q),J.forEach(function(ce,fe){!(Ut.isUndefined(ce)||ce===null)&&i.append(_===!0?BM([q],fe,m):_===null?q:q+"[]",M(ce))}),!1}return bx(X)?!0:(i.append(BM(Y,q,m),M(X)),!1)}const L=[],F=Object.assign(D3,{defaultVisitor:P,convertValue:M,isVisitable:bx});function V(X,q){if(!Ut.isUndefined(X)){if(L.indexOf(X)!==-1)throw Error("Circular reference detected in "+q.join("."));L.push(X),Ut.forEach(X,function(J,ue){(!(Ut.isUndefined(J)||J===null)&&h.call(i,J,Ut.isString(ue)?ue.trim():ue,q,F))===!0&&V(J,q?q.concat(ue):[ue])}),L.pop()}}if(!Ut.isObject(r))throw new TypeError("data must be an object");return V(r),i}function NM(r){const i={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(c){return i[c]})}function yb(r,i){this._pairs=[],r&&wy(r,this,i)}const zC=yb.prototype;zC.append=function(i,o){this._pairs.push([i,o])};zC.toString=function(i){const o=i?function(c){return i.call(this,c,NM)}:NM;return this._pairs.map(function(h){return o(h[0])+"="+o(h[1])},"").join("&")};function L3(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function FC(r,i,o){if(!i)return r;const c=o&&o.encode||L3,h=o&&o.serialize;let m;if(h?m=h(i,o):m=Ut.isURLSearchParams(i)?i.toString():new yb(i,o).toString(c),m){const _=r.indexOf("#");_!==-1&&(r=r.slice(0,_)),r+=(r.indexOf("?")===-1?"?":"&")+m}return r}class VM{constructor(){this.handlers=[]}use(i,o,c){return this.handlers.push({fulfilled:i,rejected:o,synchronous:c?c.synchronous:!1,runWhen:c?c.runWhen:null}),this.handlers.length-1}eject(i){this.handlers[i]&&(this.handlers[i]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(i){Ut.forEach(this.handlers,function(c){c!==null&&i(c)})}}const BC={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},O3=typeof URLSearchParams<"u"?URLSearchParams:yb,R3=typeof FormData<"u"?FormData:null,z3=typeof Blob<"u"?Blob:null,F3={isBrowser:!0,classes:{URLSearchParams:O3,FormData:R3,Blob:z3},protocols:["http","https","file","blob","url","data"]},NC=typeof window<"u"&&typeof document<"u",B3=(r=>NC&&["ReactNative","NativeScript","NS"].indexOf(r)<0)(typeof navigator<"u"&&navigator.product),N3=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",V3=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:NC,hasStandardBrowserEnv:B3,hasStandardBrowserWebWorkerEnv:N3},Symbol.toStringTag,{value:"Module"})),Ml={...V3,...F3};function U3(r,i){return wy(r,new Ml.classes.URLSearchParams,Object.assign({visitor:function(o,c,h,m){return Ml.isNode&&Ut.isBuffer(o)?(this.append(c,o.toString("base64")),!1):m.defaultVisitor.apply(this,arguments)}},i))}function j3(r){return Ut.matchAll(/\w+|\[(\w*)]/g,r).map(i=>i[0]==="[]"?"":i[1]||i[0])}function G3(r){const i={},o=Object.keys(r);let c;const h=o.length;let m;for(c=0;c<h;c++)m=o[c],i[m]=r[m];return i}function VC(r){function i(o,c,h,m){let _=o[m++];if(_==="__proto__")return!0;const x=Number.isFinite(+_),s=m>=o.length;return _=!_&&Ut.isArray(h)?h.length:_,s?(Ut.hasOwnProp(h,_)?h[_]=[h[_],c]:h[_]=c,!x):((!h[_]||!Ut.isObject(h[_]))&&(h[_]=[]),i(o,c,h[_],m)&&Ut.isArray(h[_])&&(h[_]=G3(h[_])),!x)}if(Ut.isFormData(r)&&Ut.isFunction(r.entries)){const o={};return Ut.forEachEntry(r,(c,h)=>{i(j3(c),h,o,0)}),o}return null}function H3(r,i,o){if(Ut.isString(r))try{return(i||JSON.parse)(r),Ut.trim(r)}catch(c){if(c.name!=="SyntaxError")throw c}return(o||JSON.stringify)(r)}const vb={transitional:BC,adapter:["xhr","http"],transformRequest:[function(i,o){const c=o.getContentType()||"",h=c.indexOf("application/json")>-1,m=Ut.isObject(i);if(m&&Ut.isHTMLForm(i)&&(i=new FormData(i)),Ut.isFormData(i))return h?JSON.stringify(VC(i)):i;if(Ut.isArrayBuffer(i)||Ut.isBuffer(i)||Ut.isStream(i)||Ut.isFile(i)||Ut.isBlob(i))return i;if(Ut.isArrayBufferView(i))return i.buffer;if(Ut.isURLSearchParams(i))return o.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),i.toString();let x;if(m){if(c.indexOf("application/x-www-form-urlencoded")>-1)return U3(i,this.formSerializer).toString();if((x=Ut.isFileList(i))||c.indexOf("multipart/form-data")>-1){const s=this.env&&this.env.FormData;return wy(x?{"files[]":i}:i,s&&new s,this.formSerializer)}}return m||h?(o.setContentType("application/json",!1),H3(i)):i}],transformResponse:[function(i){const o=this.transitional||vb.transitional,c=o&&o.forcedJSONParsing,h=this.responseType==="json";if(i&&Ut.isString(i)&&(c&&!this.responseType||h)){const _=!(o&&o.silentJSONParsing)&&h;try{return JSON.parse(i)}catch(x){if(_)throw x.name==="SyntaxError"?Zn.from(x,Zn.ERR_BAD_RESPONSE,this,null,this.response):x}}return i}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ml.classes.FormData,Blob:Ml.classes.Blob},validateStatus:function(i){return i>=200&&i<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ut.forEach(["delete","get","head","post","put","patch"],r=>{vb.headers[r]={}});const xb=vb,q3=Ut.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),W3=r=>{const i={};let o,c,h;return r&&r.split(`
`).forEach(function(_){h=_.indexOf(":"),o=_.substring(0,h).trim().toLowerCase(),c=_.substring(h+1).trim(),!(!o||i[o]&&q3[o])&&(o==="set-cookie"?i[o]?i[o].push(c):i[o]=[c]:i[o]=i[o]?i[o]+", "+c:c)}),i},UM=Symbol("internals");function pp(r){return r&&String(r).trim().toLowerCase()}function __(r){return r===!1||r==null?r:Ut.isArray(r)?r.map(__):String(r)}function Z3(r){const i=Object.create(null),o=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let c;for(;c=o.exec(r);)i[c[1]]=c[2];return i}const X3=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function Fv(r,i,o,c,h){if(Ut.isFunction(c))return c.call(this,i,o);if(h&&(i=o),!!Ut.isString(i)){if(Ut.isString(c))return i.indexOf(c)!==-1;if(Ut.isRegExp(c))return c.test(i)}}function Y3(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(i,o,c)=>o.toUpperCase()+c)}function J3(r,i){const o=Ut.toCamelCase(" "+i);["get","set","has"].forEach(c=>{Object.defineProperty(r,c+o,{value:function(h,m,_){return this[c].call(this,i,h,m,_)},configurable:!0})})}class Ty{constructor(i){i&&this.set(i)}set(i,o,c){const h=this;function m(x,s,M){const P=pp(s);if(!P)throw new Error("header name must be a non-empty string");const L=Ut.findKey(h,P);(!L||h[L]===void 0||M===!0||M===void 0&&h[L]!==!1)&&(h[L||s]=__(x))}const _=(x,s)=>Ut.forEach(x,(M,P)=>m(M,P,s));return Ut.isPlainObject(i)||i instanceof this.constructor?_(i,o):Ut.isString(i)&&(i=i.trim())&&!X3(i)?_(W3(i),o):i!=null&&m(o,i,c),this}get(i,o){if(i=pp(i),i){const c=Ut.findKey(this,i);if(c){const h=this[c];if(!o)return h;if(o===!0)return Z3(h);if(Ut.isFunction(o))return o.call(this,h,c);if(Ut.isRegExp(o))return o.exec(h);throw new TypeError("parser must be boolean|regexp|function")}}}has(i,o){if(i=pp(i),i){const c=Ut.findKey(this,i);return!!(c&&this[c]!==void 0&&(!o||Fv(this,this[c],c,o)))}return!1}delete(i,o){const c=this;let h=!1;function m(_){if(_=pp(_),_){const x=Ut.findKey(c,_);x&&(!o||Fv(c,c[x],x,o))&&(delete c[x],h=!0)}}return Ut.isArray(i)?i.forEach(m):m(i),h}clear(i){const o=Object.keys(this);let c=o.length,h=!1;for(;c--;){const m=o[c];(!i||Fv(this,this[m],m,i,!0))&&(delete this[m],h=!0)}return h}normalize(i){const o=this,c={};return Ut.forEach(this,(h,m)=>{const _=Ut.findKey(c,m);if(_){o[_]=__(h),delete o[m];return}const x=i?Y3(m):String(m).trim();x!==m&&delete o[m],o[x]=__(h),c[x]=!0}),this}concat(...i){return this.constructor.concat(this,...i)}toJSON(i){const o=Object.create(null);return Ut.forEach(this,(c,h)=>{c!=null&&c!==!1&&(o[h]=i&&Ut.isArray(c)?c.join(", "):c)}),o}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([i,o])=>i+": "+o).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(i){return i instanceof this?i:new this(i)}static concat(i,...o){const c=new this(i);return o.forEach(h=>c.set(h)),c}static accessor(i){const c=(this[UM]=this[UM]={accessors:{}}).accessors,h=this.prototype;function m(_){const x=pp(_);c[x]||(J3(h,_),c[x]=!0)}return Ut.isArray(i)?i.forEach(m):m(i),this}}Ty.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ut.reduceDescriptors(Ty.prototype,({value:r},i)=>{let o=i[0].toUpperCase()+i.slice(1);return{get:()=>r,set(c){this[o]=c}}});Ut.freezeMethods(Ty);const Tc=Ty;function Bv(r,i){const o=this||xb,c=i||o,h=Tc.from(c.headers);let m=c.data;return Ut.forEach(r,function(x){m=x.call(o,m,h.normalize(),i?i.status:void 0)}),h.normalize(),m}function UC(r){return!!(r&&r.__CANCEL__)}function am(r,i,o){Zn.call(this,r??"canceled",Zn.ERR_CANCELED,i,o),this.name="CanceledError"}Ut.inherits(am,Zn,{__CANCEL__:!0});function K3(r,i,o){const c=o.config.validateStatus;!o.status||!c||c(o.status)?r(o):i(new Zn("Request failed with status code "+o.status,[Zn.ERR_BAD_REQUEST,Zn.ERR_BAD_RESPONSE][Math.floor(o.status/100)-4],o.config,o.request,o))}const $3=Ml.hasStandardBrowserEnv?{write(r,i,o,c,h,m){const _=[r+"="+encodeURIComponent(i)];Ut.isNumber(o)&&_.push("expires="+new Date(o).toGMTString()),Ut.isString(c)&&_.push("path="+c),Ut.isString(h)&&_.push("domain="+h),m===!0&&_.push("secure"),document.cookie=_.join("; ")},read(r){const i=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Q3(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function ez(r,i){return i?r.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):r}function jC(r,i){return r&&!Q3(i)?ez(r,i):i}const tz=Ml.hasStandardBrowserEnv?function(){const i=/(msie|trident)/i.test(navigator.userAgent),o=document.createElement("a");let c;function h(m){let _=m;return i&&(o.setAttribute("href",_),_=o.href),o.setAttribute("href",_),{href:o.href,protocol:o.protocol?o.protocol.replace(/:$/,""):"",host:o.host,search:o.search?o.search.replace(/^\?/,""):"",hash:o.hash?o.hash.replace(/^#/,""):"",hostname:o.hostname,port:o.port,pathname:o.pathname.charAt(0)==="/"?o.pathname:"/"+o.pathname}}return c=h(window.location.href),function(_){const x=Ut.isString(_)?h(_):_;return x.protocol===c.protocol&&x.host===c.host}}():function(){return function(){return!0}}();function iz(r){const i=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return i&&i[1]||""}function nz(r,i){r=r||10;const o=new Array(r),c=new Array(r);let h=0,m=0,_;return i=i!==void 0?i:1e3,function(s){const M=Date.now(),P=c[m];_||(_=M),o[h]=s,c[h]=M;let L=m,F=0;for(;L!==h;)F+=o[L++],L=L%r;if(h=(h+1)%r,h===m&&(m=(m+1)%r),M-_<i)return;const V=P&&M-P;return V?Math.round(F*1e3/V):void 0}}function jM(r,i){let o=0;const c=nz(50,250);return h=>{const m=h.loaded,_=h.lengthComputable?h.total:void 0,x=m-o,s=c(x),M=m<=_;o=m;const P={loaded:m,total:_,progress:_?m/_:void 0,bytes:x,rate:s||void 0,estimated:s&&_&&M?(_-m)/s:void 0,event:h};P[i?"download":"upload"]=!0,r(P)}}const rz=typeof XMLHttpRequest<"u",oz=rz&&function(r){return new Promise(function(o,c){let h=r.data;const m=Tc.from(r.headers).normalize();let{responseType:_,withXSRFToken:x}=r,s;function M(){r.cancelToken&&r.cancelToken.unsubscribe(s),r.signal&&r.signal.removeEventListener("abort",s)}let P;if(Ut.isFormData(h)){if(Ml.hasStandardBrowserEnv||Ml.hasStandardBrowserWebWorkerEnv)m.setContentType(!1);else if((P=m.getContentType())!==!1){const[q,...Y]=P?P.split(";").map(J=>J.trim()).filter(Boolean):[];m.setContentType([q||"multipart/form-data",...Y].join("; "))}}let L=new XMLHttpRequest;if(r.auth){const q=r.auth.username||"",Y=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";m.set("Authorization","Basic "+btoa(q+":"+Y))}const F=jC(r.baseURL,r.url);L.open(r.method.toUpperCase(),FC(F,r.params,r.paramsSerializer),!0),L.timeout=r.timeout;function V(){if(!L)return;const q=Tc.from("getAllResponseHeaders"in L&&L.getAllResponseHeaders()),J={data:!_||_==="text"||_==="json"?L.responseText:L.response,status:L.status,statusText:L.statusText,headers:q,config:r,request:L};K3(function(ce){o(ce),M()},function(ce){c(ce),M()},J),L=null}if("onloadend"in L?L.onloadend=V:L.onreadystatechange=function(){!L||L.readyState!==4||L.status===0&&!(L.responseURL&&L.responseURL.indexOf("file:")===0)||setTimeout(V)},L.onabort=function(){L&&(c(new Zn("Request aborted",Zn.ECONNABORTED,r,L)),L=null)},L.onerror=function(){c(new Zn("Network Error",Zn.ERR_NETWORK,r,L)),L=null},L.ontimeout=function(){let Y=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const J=r.transitional||BC;r.timeoutErrorMessage&&(Y=r.timeoutErrorMessage),c(new Zn(Y,J.clarifyTimeoutError?Zn.ETIMEDOUT:Zn.ECONNABORTED,r,L)),L=null},Ml.hasStandardBrowserEnv&&(x&&Ut.isFunction(x)&&(x=x(r)),x||x!==!1&&tz(F))){const q=r.xsrfHeaderName&&r.xsrfCookieName&&$3.read(r.xsrfCookieName);q&&m.set(r.xsrfHeaderName,q)}h===void 0&&m.setContentType(null),"setRequestHeader"in L&&Ut.forEach(m.toJSON(),function(Y,J){L.setRequestHeader(J,Y)}),Ut.isUndefined(r.withCredentials)||(L.withCredentials=!!r.withCredentials),_&&_!=="json"&&(L.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&L.addEventListener("progress",jM(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&L.upload&&L.upload.addEventListener("progress",jM(r.onUploadProgress)),(r.cancelToken||r.signal)&&(s=q=>{L&&(c(!q||q.type?new am(null,r,L):q),L.abort(),L=null)},r.cancelToken&&r.cancelToken.subscribe(s),r.signal&&(r.signal.aborted?s():r.signal.addEventListener("abort",s)));const X=iz(F);if(X&&Ml.protocols.indexOf(X)===-1){c(new Zn("Unsupported protocol "+X+":",Zn.ERR_BAD_REQUEST,r));return}L.send(h||null)})},wx={http:P3,xhr:oz};Ut.forEach(wx,(r,i)=>{if(r){try{Object.defineProperty(r,"name",{value:i})}catch{}Object.defineProperty(r,"adapterName",{value:i})}});const GM=r=>`- ${r}`,sz=r=>Ut.isFunction(r)||r===null||r===!1,GC={getAdapter:r=>{r=Ut.isArray(r)?r:[r];const{length:i}=r;let o,c;const h={};for(let m=0;m<i;m++){o=r[m];let _;if(c=o,!sz(o)&&(c=wx[(_=String(o)).toLowerCase()],c===void 0))throw new Zn(`Unknown adapter '${_}'`);if(c)break;h[_||"#"+m]=c}if(!c){const m=Object.entries(h).map(([x,s])=>`adapter ${x} `+(s===!1?"is not supported by the environment":"is not available in the build"));let _=i?m.length>1?`since :
`+m.map(GM).join(`
`):" "+GM(m[0]):"as no adapter specified";throw new Zn("There is no suitable adapter to dispatch the request "+_,"ERR_NOT_SUPPORT")}return c},adapters:wx};function Nv(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new am(null,r)}function HM(r){return Nv(r),r.headers=Tc.from(r.headers),r.data=Bv.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),GC.getAdapter(r.adapter||xb.adapter)(r).then(function(c){return Nv(r),c.data=Bv.call(r,r.transformResponse,c),c.headers=Tc.from(c.headers),c},function(c){return UC(c)||(Nv(r),c&&c.response&&(c.response.data=Bv.call(r,r.transformResponse,c.response),c.response.headers=Tc.from(c.response.headers))),Promise.reject(c)})}const qM=r=>r instanceof Tc?r.toJSON():r;function jd(r,i){i=i||{};const o={};function c(M,P,L){return Ut.isPlainObject(M)&&Ut.isPlainObject(P)?Ut.merge.call({caseless:L},M,P):Ut.isPlainObject(P)?Ut.merge({},P):Ut.isArray(P)?P.slice():P}function h(M,P,L){if(Ut.isUndefined(P)){if(!Ut.isUndefined(M))return c(void 0,M,L)}else return c(M,P,L)}function m(M,P){if(!Ut.isUndefined(P))return c(void 0,P)}function _(M,P){if(Ut.isUndefined(P)){if(!Ut.isUndefined(M))return c(void 0,M)}else return c(void 0,P)}function x(M,P,L){if(L in i)return c(M,P);if(L in r)return c(void 0,M)}const s={url:m,method:m,data:m,baseURL:_,transformRequest:_,transformResponse:_,paramsSerializer:_,timeout:_,timeoutMessage:_,withCredentials:_,withXSRFToken:_,adapter:_,responseType:_,xsrfCookieName:_,xsrfHeaderName:_,onUploadProgress:_,onDownloadProgress:_,decompress:_,maxContentLength:_,maxBodyLength:_,beforeRedirect:_,transport:_,httpAgent:_,httpsAgent:_,cancelToken:_,socketPath:_,responseEncoding:_,validateStatus:x,headers:(M,P)=>h(qM(M),qM(P),!0)};return Ut.forEach(Object.keys(Object.assign({},r,i)),function(P){const L=s[P]||h,F=L(r[P],i[P],P);Ut.isUndefined(F)&&L!==x||(o[P]=F)}),o}const HC="1.6.7",bb={};["object","boolean","number","function","string","symbol"].forEach((r,i)=>{bb[r]=function(c){return typeof c===r||"a"+(i<1?"n ":" ")+r}});const WM={};bb.transitional=function(i,o,c){function h(m,_){return"[Axios v"+HC+"] Transitional option '"+m+"'"+_+(c?". "+c:"")}return(m,_,x)=>{if(i===!1)throw new Zn(h(_," has been removed"+(o?" in "+o:"")),Zn.ERR_DEPRECATED);return o&&!WM[_]&&(WM[_]=!0,console.warn(h(_," has been deprecated since v"+o+" and will be removed in the near future"))),i?i(m,_,x):!0}};function az(r,i,o){if(typeof r!="object")throw new Zn("options must be an object",Zn.ERR_BAD_OPTION_VALUE);const c=Object.keys(r);let h=c.length;for(;h-- >0;){const m=c[h],_=i[m];if(_){const x=r[m],s=x===void 0||_(x,m,r);if(s!==!0)throw new Zn("option "+m+" must be "+s,Zn.ERR_BAD_OPTION_VALUE);continue}if(o!==!0)throw new Zn("Unknown option "+m,Zn.ERR_BAD_OPTION)}}const Tx={assertOptions:az,validators:bb},iu=Tx.validators;class U_{constructor(i){this.defaults=i,this.interceptors={request:new VM,response:new VM}}async request(i,o){try{return await this._request(i,o)}catch(c){if(c instanceof Error){let h;Error.captureStackTrace?Error.captureStackTrace(h={}):h=new Error;const m=h.stack?h.stack.replace(/^.+\n/,""):"";c.stack?m&&!String(c.stack).endsWith(m.replace(/^.+\n.+\n/,""))&&(c.stack+=`
`+m):c.stack=m}throw c}}_request(i,o){typeof i=="string"?(o=o||{},o.url=i):o=i||{},o=jd(this.defaults,o);const{transitional:c,paramsSerializer:h,headers:m}=o;c!==void 0&&Tx.assertOptions(c,{silentJSONParsing:iu.transitional(iu.boolean),forcedJSONParsing:iu.transitional(iu.boolean),clarifyTimeoutError:iu.transitional(iu.boolean)},!1),h!=null&&(Ut.isFunction(h)?o.paramsSerializer={serialize:h}:Tx.assertOptions(h,{encode:iu.function,serialize:iu.function},!0)),o.method=(o.method||this.defaults.method||"get").toLowerCase();let _=m&&Ut.merge(m.common,m[o.method]);m&&Ut.forEach(["delete","get","head","post","put","patch","common"],X=>{delete m[X]}),o.headers=Tc.concat(_,m);const x=[];let s=!0;this.interceptors.request.forEach(function(q){typeof q.runWhen=="function"&&q.runWhen(o)===!1||(s=s&&q.synchronous,x.unshift(q.fulfilled,q.rejected))});const M=[];this.interceptors.response.forEach(function(q){M.push(q.fulfilled,q.rejected)});let P,L=0,F;if(!s){const X=[HM.bind(this),void 0];for(X.unshift.apply(X,x),X.push.apply(X,M),F=X.length,P=Promise.resolve(o);L<F;)P=P.then(X[L++],X[L++]);return P}F=x.length;let V=o;for(L=0;L<F;){const X=x[L++],q=x[L++];try{V=X(V)}catch(Y){q.call(this,Y);break}}try{P=HM.call(this,V)}catch(X){return Promise.reject(X)}for(L=0,F=M.length;L<F;)P=P.then(M[L++],M[L++]);return P}getUri(i){i=jd(this.defaults,i);const o=jC(i.baseURL,i.url);return FC(o,i.params,i.paramsSerializer)}}Ut.forEach(["delete","get","head","options"],function(i){U_.prototype[i]=function(o,c){return this.request(jd(c||{},{method:i,url:o,data:(c||{}).data}))}});Ut.forEach(["post","put","patch"],function(i){function o(c){return function(m,_,x){return this.request(jd(x||{},{method:i,headers:c?{"Content-Type":"multipart/form-data"}:{},url:m,data:_}))}}U_.prototype[i]=o(),U_.prototype[i+"Form"]=o(!0)});const y_=U_;class wb{constructor(i){if(typeof i!="function")throw new TypeError("executor must be a function.");let o;this.promise=new Promise(function(m){o=m});const c=this;this.promise.then(h=>{if(!c._listeners)return;let m=c._listeners.length;for(;m-- >0;)c._listeners[m](h);c._listeners=null}),this.promise.then=h=>{let m;const _=new Promise(x=>{c.subscribe(x),m=x}).then(h);return _.cancel=function(){c.unsubscribe(m)},_},i(function(m,_,x){c.reason||(c.reason=new am(m,_,x),o(c.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(i){if(this.reason){i(this.reason);return}this._listeners?this._listeners.push(i):this._listeners=[i]}unsubscribe(i){if(!this._listeners)return;const o=this._listeners.indexOf(i);o!==-1&&this._listeners.splice(o,1)}static source(){let i;return{token:new wb(function(h){i=h}),cancel:i}}}const lz=wb;function cz(r){return function(o){return r.apply(null,o)}}function uz(r){return Ut.isObject(r)&&r.isAxiosError===!0}const Sx={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Sx).forEach(([r,i])=>{Sx[i]=r});const hz=Sx;function qC(r){const i=new y_(r),o=MC(y_.prototype.request,i);return Ut.extend(o,y_.prototype,i,{allOwnKeys:!0}),Ut.extend(o,i,null,{allOwnKeys:!0}),o.create=function(h){return qC(jd(r,h))},o}const Gr=qC(xb);Gr.Axios=y_;Gr.CanceledError=am;Gr.CancelToken=lz;Gr.isCancel=UC;Gr.VERSION=HC;Gr.toFormData=wy;Gr.AxiosError=Zn;Gr.Cancel=Gr.CanceledError;Gr.all=function(i){return Promise.all(i)};Gr.spread=cz;Gr.isAxiosError=uz;Gr.mergeConfig=jd;Gr.AxiosHeaders=Tc;Gr.formToJSON=r=>VC(Ut.isHTMLForm(r)?new FormData(r):r);Gr.getAdapter=GC.getAdapter;Gr.HttpStatusCode=hz;Gr.default=Gr;var dz=Error,fz=EvalError,pz=RangeError,mz=ReferenceError,WC=SyntaxError,lm=TypeError,gz=URIError,_z=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var i={},o=Symbol("test"),c=Object(o);if(typeof o=="string"||Object.prototype.toString.call(o)!=="[object Symbol]"||Object.prototype.toString.call(c)!=="[object Symbol]")return!1;var h=42;i[o]=h;for(o in i)return!1;if(typeof Object.keys=="function"&&Object.keys(i).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(i).length!==0)return!1;var m=Object.getOwnPropertySymbols(i);if(m.length!==1||m[0]!==o||!Object.prototype.propertyIsEnumerable.call(i,o))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var _=Object.getOwnPropertyDescriptor(i,o);if(_.value!==h||_.enumerable!==!0)return!1}return!0},ZM=typeof Symbol<"u"&&Symbol,yz=_z,vz=function(){return typeof ZM!="function"||typeof Symbol!="function"||typeof ZM("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:yz()},Vv={__proto__:null,foo:{}},xz=Object,bz=function(){return{__proto__:Vv}.foo===Vv.foo&&!(Vv instanceof xz)},wz="Function.prototype.bind called on incompatible ",Tz=Object.prototype.toString,Sz=Math.max,Mz="[object Function]",XM=function(i,o){for(var c=[],h=0;h<i.length;h+=1)c[h]=i[h];for(var m=0;m<o.length;m+=1)c[m+i.length]=o[m];return c},Ez=function(i,o){for(var c=[],h=o||0,m=0;h<i.length;h+=1,m+=1)c[m]=i[h];return c},Az=function(r,i){for(var o="",c=0;c<r.length;c+=1)o+=r[c],c+1<r.length&&(o+=i);return o},Iz=function(i){var o=this;if(typeof o!="function"||Tz.apply(o)!==Mz)throw new TypeError(wz+o);for(var c=Ez(arguments,1),h,m=function(){if(this instanceof h){var P=o.apply(this,XM(c,arguments));return Object(P)===P?P:this}return o.apply(i,XM(c,arguments))},_=Sz(0,o.length-c.length),x=[],s=0;s<_;s++)x[s]="$"+s;if(h=Function("binder","return function ("+Az(x,",")+"){ return binder.apply(this,arguments); }")(m),o.prototype){var M=function(){};M.prototype=o.prototype,h.prototype=new M,M.prototype=null}return h},Cz=Iz,Tb=Function.prototype.bind||Cz,Pz=Function.prototype.call,kz=Object.prototype.hasOwnProperty,Dz=Tb,Lz=Dz.call(Pz,kz),Rn,Oz=dz,Rz=fz,zz=pz,Fz=mz,Gd=WC,zd=lm,Bz=gz,ZC=Function,Uv=function(r){try{return ZC('"use strict"; return ('+r+").constructor;")()}catch{}},Eh=Object.getOwnPropertyDescriptor;if(Eh)try{Eh({},"")}catch{Eh=null}var jv=function(){throw new zd},Nz=Eh?function(){try{return arguments.callee,jv}catch{try{return Eh(arguments,"callee").get}catch{return jv}}}():jv,Ad=vz(),Vz=bz(),ko=Object.getPrototypeOf||(Vz?function(r){return r.__proto__}:null),Dd={},Uz=typeof Uint8Array>"u"||!ko?Rn:ko(Uint8Array),Ah={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Rn:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Rn:ArrayBuffer,"%ArrayIteratorPrototype%":Ad&&ko?ko([][Symbol.iterator]()):Rn,"%AsyncFromSyncIteratorPrototype%":Rn,"%AsyncFunction%":Dd,"%AsyncGenerator%":Dd,"%AsyncGeneratorFunction%":Dd,"%AsyncIteratorPrototype%":Dd,"%Atomics%":typeof Atomics>"u"?Rn:Atomics,"%BigInt%":typeof BigInt>"u"?Rn:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Rn:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Rn:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Rn:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Oz,"%eval%":eval,"%EvalError%":Rz,"%Float32Array%":typeof Float32Array>"u"?Rn:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Rn:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Rn:FinalizationRegistry,"%Function%":ZC,"%GeneratorFunction%":Dd,"%Int8Array%":typeof Int8Array>"u"?Rn:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Rn:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Rn:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Ad&&ko?ko(ko([][Symbol.iterator]())):Rn,"%JSON%":typeof JSON=="object"?JSON:Rn,"%Map%":typeof Map>"u"?Rn:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Ad||!ko?Rn:ko(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Rn:Promise,"%Proxy%":typeof Proxy>"u"?Rn:Proxy,"%RangeError%":zz,"%ReferenceError%":Fz,"%Reflect%":typeof Reflect>"u"?Rn:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Rn:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Ad||!ko?Rn:ko(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Rn:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Ad&&ko?ko(""[Symbol.iterator]()):Rn,"%Symbol%":Ad?Symbol:Rn,"%SyntaxError%":Gd,"%ThrowTypeError%":Nz,"%TypedArray%":Uz,"%TypeError%":zd,"%Uint8Array%":typeof Uint8Array>"u"?Rn:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Rn:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Rn:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Rn:Uint32Array,"%URIError%":Bz,"%WeakMap%":typeof WeakMap>"u"?Rn:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Rn:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Rn:WeakSet};if(ko)try{null.error}catch(r){var jz=ko(ko(r));Ah["%Error.prototype%"]=jz}var Gz=function r(i){var o;if(i==="%AsyncFunction%")o=Uv("async function () {}");else if(i==="%GeneratorFunction%")o=Uv("function* () {}");else if(i==="%AsyncGeneratorFunction%")o=Uv("async function* () {}");else if(i==="%AsyncGenerator%"){var c=r("%AsyncGeneratorFunction%");c&&(o=c.prototype)}else if(i==="%AsyncIteratorPrototype%"){var h=r("%AsyncGenerator%");h&&ko&&(o=ko(h.prototype))}return Ah[i]=o,o},YM={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},cm=Tb,j_=Lz,Hz=cm.call(Function.call,Array.prototype.concat),qz=cm.call(Function.apply,Array.prototype.splice),JM=cm.call(Function.call,String.prototype.replace),G_=cm.call(Function.call,String.prototype.slice),Wz=cm.call(Function.call,RegExp.prototype.exec),Zz=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Xz=/\\(\\)?/g,Yz=function(i){var o=G_(i,0,1),c=G_(i,-1);if(o==="%"&&c!=="%")throw new Gd("invalid intrinsic syntax, expected closing `%`");if(c==="%"&&o!=="%")throw new Gd("invalid intrinsic syntax, expected opening `%`");var h=[];return JM(i,Zz,function(m,_,x,s){h[h.length]=x?JM(s,Xz,"$1"):_||m}),h},Jz=function(i,o){var c=i,h;if(j_(YM,c)&&(h=YM[c],c="%"+h[0]+"%"),j_(Ah,c)){var m=Ah[c];if(m===Dd&&(m=Gz(c)),typeof m>"u"&&!o)throw new zd("intrinsic "+i+" exists, but is not available. Please file an issue!");return{alias:h,name:c,value:m}}throw new Gd("intrinsic "+i+" does not exist!")},rf=function(i,o){if(typeof i!="string"||i.length===0)throw new zd("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof o!="boolean")throw new zd('"allowMissing" argument must be a boolean');if(Wz(/^%?[^%]*%?$/,i)===null)throw new Gd("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var c=Yz(i),h=c.length>0?c[0]:"",m=Jz("%"+h+"%",o),_=m.name,x=m.value,s=!1,M=m.alias;M&&(h=M[0],qz(c,Hz([0,1],M)));for(var P=1,L=!0;P<c.length;P+=1){var F=c[P],V=G_(F,0,1),X=G_(F,-1);if((V==='"'||V==="'"||V==="`"||X==='"'||X==="'"||X==="`")&&V!==X)throw new Gd("property names with quotes must have matching quotes");if((F==="constructor"||!L)&&(s=!0),h+="."+F,_="%"+h+"%",j_(Ah,_))x=Ah[_];else if(x!=null){if(!(F in x)){if(!o)throw new zd("base intrinsic for "+i+" exists, but the property is not available.");return}if(Eh&&P+1>=c.length){var q=Eh(x,F);L=!!q,L&&"get"in q&&!("originalValue"in q.get)?x=q.get:x=x[F]}else L=j_(x,F),x=x[F];L&&!s&&(Ah[_]=x)}}return x},XC={exports:{}},Gv,KM;function Sb(){if(KM)return Gv;KM=1;var r=rf,i=r("%Object.defineProperty%",!0)||!1;if(i)try{i({},"a",{value:1})}catch{i=!1}return Gv=i,Gv}var Kz=rf,v_=Kz("%Object.getOwnPropertyDescriptor%",!0);if(v_)try{v_([],"length")}catch{v_=null}var YC=v_,$M=Sb(),$z=WC,Id=lm,QM=YC,Qz=function(i,o,c){if(!i||typeof i!="object"&&typeof i!="function")throw new Id("`obj` must be an object or a function`");if(typeof o!="string"&&typeof o!="symbol")throw new Id("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Id("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Id("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Id("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Id("`loose`, if provided, must be a boolean");var h=arguments.length>3?arguments[3]:null,m=arguments.length>4?arguments[4]:null,_=arguments.length>5?arguments[5]:null,x=arguments.length>6?arguments[6]:!1,s=!!QM&&QM(i,o);if($M)$M(i,o,{configurable:_===null&&s?s.configurable:!_,enumerable:h===null&&s?s.enumerable:!h,value:c,writable:m===null&&s?s.writable:!m});else if(x||!h&&!m&&!_)i[o]=c;else throw new $z("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Mx=Sb(),JC=function(){return!!Mx};JC.hasArrayLengthDefineBug=function(){if(!Mx)return null;try{return Mx([],"length",{value:1}).length!==1}catch{return!0}};var eF=JC,tF=rf,eE=Qz,iF=eF(),tE=YC,iE=lm,nF=tF("%Math.floor%"),rF=function(i,o){if(typeof i!="function")throw new iE("`fn` is not a function");if(typeof o!="number"||o<0||o>4294967295||nF(o)!==o)throw new iE("`length` must be a positive 32-bit integer");var c=arguments.length>2&&!!arguments[2],h=!0,m=!0;if("length"in i&&tE){var _=tE(i,"length");_&&!_.configurable&&(h=!1),_&&!_.writable&&(m=!1)}return(h||m||!c)&&(iF?eE(i,"length",o,!0,!0):eE(i,"length",o)),i};(function(r){var i=Tb,o=rf,c=rF,h=lm,m=o("%Function.prototype.apply%"),_=o("%Function.prototype.call%"),x=o("%Reflect.apply%",!0)||i.call(_,m),s=Sb(),M=o("%Math.max%");r.exports=function(F){if(typeof F!="function")throw new h("a function is required");var V=x(i,_,arguments);return c(V,1+M(0,F.length-(arguments.length-1)),!0)};var P=function(){return x(i,m,arguments)};s?s(r.exports,"apply",{value:P}):r.exports.apply=P})(XC);var oF=XC.exports,KC=rf,$C=oF,sF=$C(KC("String.prototype.indexOf")),aF=function(i,o){var c=KC(i,!!o);return typeof c=="function"&&sF(i,".prototype.")>-1?$C(c):c};const lF={},cF=Object.freeze(Object.defineProperty({__proto__:null,default:lF},Symbol.toStringTag,{value:"Module"})),uF=XR(cF);var Mb=typeof Map=="function"&&Map.prototype,Hv=Object.getOwnPropertyDescriptor&&Mb?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,H_=Mb&&Hv&&typeof Hv.get=="function"?Hv.get:null,nE=Mb&&Map.prototype.forEach,Eb=typeof Set=="function"&&Set.prototype,qv=Object.getOwnPropertyDescriptor&&Eb?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,q_=Eb&&qv&&typeof qv.get=="function"?qv.get:null,rE=Eb&&Set.prototype.forEach,hF=typeof WeakMap=="function"&&WeakMap.prototype,zp=hF?WeakMap.prototype.has:null,dF=typeof WeakSet=="function"&&WeakSet.prototype,Fp=dF?WeakSet.prototype.has:null,fF=typeof WeakRef=="function"&&WeakRef.prototype,oE=fF?WeakRef.prototype.deref:null,pF=Boolean.prototype.valueOf,mF=Object.prototype.toString,gF=Function.prototype.toString,_F=String.prototype.match,Ab=String.prototype.slice,su=String.prototype.replace,yF=String.prototype.toUpperCase,sE=String.prototype.toLowerCase,QC=RegExp.prototype.test,aE=Array.prototype.concat,Tl=Array.prototype.join,vF=Array.prototype.slice,lE=Math.floor,Ex=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Wv=Object.getOwnPropertySymbols,Ax=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Hd=typeof Symbol=="function"&&typeof Symbol.iterator=="object",is=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Hd||!0)?Symbol.toStringTag:null,eP=Object.prototype.propertyIsEnumerable,cE=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__}:null);function uE(r,i){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||QC.call(/e/,i))return i;var o=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r=="number"){var c=r<0?-lE(-r):lE(r);if(c!==r){var h=String(c),m=Ab.call(i,h.length+1);return su.call(h,o,"$&_")+"."+su.call(su.call(m,/([0-9]{3})/g,"$&_"),/_$/,"")}}return su.call(i,o,"$&_")}var Ix=uF,hE=Ix.custom,dE=iP(hE)?hE:null,xF=function r(i,o,c,h){var m=o||{};if(ou(m,"quoteStyle")&&m.quoteStyle!=="single"&&m.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(ou(m,"maxStringLength")&&(typeof m.maxStringLength=="number"?m.maxStringLength<0&&m.maxStringLength!==1/0:m.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var _=ou(m,"customInspect")?m.customInspect:!0;if(typeof _!="boolean"&&_!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(ou(m,"indent")&&m.indent!==null&&m.indent!=="	"&&!(parseInt(m.indent,10)===m.indent&&m.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(ou(m,"numericSeparator")&&typeof m.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var x=m.numericSeparator;if(typeof i>"u")return"undefined";if(i===null)return"null";if(typeof i=="boolean")return i?"true":"false";if(typeof i=="string")return rP(i,m);if(typeof i=="number"){if(i===0)return 1/0/i>0?"0":"-0";var s=String(i);return x?uE(i,s):s}if(typeof i=="bigint"){var M=String(i)+"n";return x?uE(i,M):M}var P=typeof m.depth>"u"?5:m.depth;if(typeof c>"u"&&(c=0),c>=P&&P>0&&typeof i=="object")return Cx(i)?"[Array]":"[Object]";var L=BF(m,c);if(typeof h>"u")h=[];else if(nP(h,i)>=0)return"[Circular]";function F(Xe,mt,Ft){if(mt&&(h=vF.call(h),h.push(mt)),Ft){var tt={depth:m.depth};return ou(m,"quoteStyle")&&(tt.quoteStyle=m.quoteStyle),r(Xe,tt,c+1,h)}return r(Xe,m,c+1,h)}if(typeof i=="function"&&!fE(i)){var V=CF(i),X=Wg(i,F);return"[Function"+(V?": "+V:" (anonymous)")+"]"+(X.length>0?" { "+Tl.call(X,", ")+" }":"")}if(iP(i)){var q=Hd?su.call(String(i),/^(Symbol\(.*\))_[^)]*$/,"$1"):Ax.call(i);return typeof i=="object"&&!Hd?mp(q):q}if(RF(i)){for(var Y="<"+sE.call(String(i.nodeName)),J=i.attributes||[],ue=0;ue<J.length;ue++)Y+=" "+J[ue].name+"="+tP(bF(J[ue].value),"double",m);return Y+=">",i.childNodes&&i.childNodes.length&&(Y+="..."),Y+="</"+sE.call(String(i.nodeName))+">",Y}if(Cx(i)){if(i.length===0)return"[]";var ce=Wg(i,F);return L&&!FF(ce)?"["+Px(ce,L)+"]":"[ "+Tl.call(ce,", ")+" ]"}if(TF(i)){var fe=Wg(i,F);return!("cause"in Error.prototype)&&"cause"in i&&!eP.call(i,"cause")?"{ ["+String(i)+"] "+Tl.call(aE.call("[cause]: "+F(i.cause),fe),", ")+" }":fe.length===0?"["+String(i)+"]":"{ ["+String(i)+"] "+Tl.call(fe,", ")+" }"}if(typeof i=="object"&&_){if(dE&&typeof i[dE]=="function"&&Ix)return Ix(i,{depth:P-c});if(_!=="symbol"&&typeof i.inspect=="function")return i.inspect()}if(PF(i)){var Ae=[];return nE&&nE.call(i,function(Xe,mt){Ae.push(F(mt,i,!0)+" => "+F(Xe,i))}),pE("Map",H_.call(i),Ae,L)}if(LF(i)){var Ce=[];return rE&&rE.call(i,function(Xe){Ce.push(F(Xe,i))}),pE("Set",q_.call(i),Ce,L)}if(kF(i))return Zv("WeakMap");if(OF(i))return Zv("WeakSet");if(DF(i))return Zv("WeakRef");if(MF(i))return mp(F(Number(i)));if(AF(i))return mp(F(Ex.call(i)));if(EF(i))return mp(pF.call(i));if(SF(i))return mp(F(String(i)));if(typeof window<"u"&&i===window)return"{ [object Window] }";if(i===xh)return"{ [object globalThis] }";if(!wF(i)&&!fE(i)){var He=Wg(i,F),We=cE?cE(i)===Object.prototype:i instanceof Object||i.constructor===Object,nt=i instanceof Object?"":"null prototype",we=!We&&is&&Object(i)===i&&is in i?Ab.call(mu(i),8,-1):nt?"Object":"",ht=We||typeof i.constructor!="function"?"":i.constructor.name?i.constructor.name+" ":"",pt=ht+(we||nt?"["+Tl.call(aE.call([],we||[],nt||[]),": ")+"] ":"");return He.length===0?pt+"{}":L?pt+"{"+Px(He,L)+"}":pt+"{ "+Tl.call(He,", ")+" }"}return String(i)};function tP(r,i,o){var c=(o.quoteStyle||i)==="double"?'"':"'";return c+r+c}function bF(r){return su.call(String(r),/"/g,"&quot;")}function Cx(r){return mu(r)==="[object Array]"&&(!is||!(typeof r=="object"&&is in r))}function wF(r){return mu(r)==="[object Date]"&&(!is||!(typeof r=="object"&&is in r))}function fE(r){return mu(r)==="[object RegExp]"&&(!is||!(typeof r=="object"&&is in r))}function TF(r){return mu(r)==="[object Error]"&&(!is||!(typeof r=="object"&&is in r))}function SF(r){return mu(r)==="[object String]"&&(!is||!(typeof r=="object"&&is in r))}function MF(r){return mu(r)==="[object Number]"&&(!is||!(typeof r=="object"&&is in r))}function EF(r){return mu(r)==="[object Boolean]"&&(!is||!(typeof r=="object"&&is in r))}function iP(r){if(Hd)return r&&typeof r=="object"&&r instanceof Symbol;if(typeof r=="symbol")return!0;if(!r||typeof r!="object"||!Ax)return!1;try{return Ax.call(r),!0}catch{}return!1}function AF(r){if(!r||typeof r!="object"||!Ex)return!1;try{return Ex.call(r),!0}catch{}return!1}var IF=Object.prototype.hasOwnProperty||function(r){return r in this};function ou(r,i){return IF.call(r,i)}function mu(r){return mF.call(r)}function CF(r){if(r.name)return r.name;var i=_F.call(gF.call(r),/^function\s*([\w$]+)/);return i?i[1]:null}function nP(r,i){if(r.indexOf)return r.indexOf(i);for(var o=0,c=r.length;o<c;o++)if(r[o]===i)return o;return-1}function PF(r){if(!H_||!r||typeof r!="object")return!1;try{H_.call(r);try{q_.call(r)}catch{return!0}return r instanceof Map}catch{}return!1}function kF(r){if(!zp||!r||typeof r!="object")return!1;try{zp.call(r,zp);try{Fp.call(r,Fp)}catch{return!0}return r instanceof WeakMap}catch{}return!1}function DF(r){if(!oE||!r||typeof r!="object")return!1;try{return oE.call(r),!0}catch{}return!1}function LF(r){if(!q_||!r||typeof r!="object")return!1;try{q_.call(r);try{H_.call(r)}catch{return!0}return r instanceof Set}catch{}return!1}function OF(r){if(!Fp||!r||typeof r!="object")return!1;try{Fp.call(r,Fp);try{zp.call(r,zp)}catch{return!0}return r instanceof WeakSet}catch{}return!1}function RF(r){return!r||typeof r!="object"?!1:typeof HTMLElement<"u"&&r instanceof HTMLElement?!0:typeof r.nodeName=="string"&&typeof r.getAttribute=="function"}function rP(r,i){if(r.length>i.maxStringLength){var o=r.length-i.maxStringLength,c="... "+o+" more character"+(o>1?"s":"");return rP(Ab.call(r,0,i.maxStringLength),i)+c}var h=su.call(su.call(r,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,zF);return tP(h,"single",i)}function zF(r){var i=r.charCodeAt(0),o={8:"b",9:"t",10:"n",12:"f",13:"r"}[i];return o?"\\"+o:"\\x"+(i<16?"0":"")+yF.call(i.toString(16))}function mp(r){return"Object("+r+")"}function Zv(r){return r+" { ? }"}function pE(r,i,o,c){var h=c?Px(o,c):Tl.call(o,", ");return r+" ("+i+") {"+h+"}"}function FF(r){for(var i=0;i<r.length;i++)if(nP(r[i],`
`)>=0)return!1;return!0}function BF(r,i){var o;if(r.indent==="	")o="	";else if(typeof r.indent=="number"&&r.indent>0)o=Tl.call(Array(r.indent+1)," ");else return null;return{base:o,prev:Tl.call(Array(i+1),o)}}function Px(r,i){if(r.length===0)return"";var o=`
`+i.prev+i.base;return o+Tl.call(r,","+o)+`
`+i.prev}function Wg(r,i){var o=Cx(r),c=[];if(o){c.length=r.length;for(var h=0;h<r.length;h++)c[h]=ou(r,h)?i(r[h],r):""}var m=typeof Wv=="function"?Wv(r):[],_;if(Hd){_={};for(var x=0;x<m.length;x++)_["$"+m[x]]=m[x]}for(var s in r)ou(r,s)&&(o&&String(Number(s))===s&&s<r.length||Hd&&_["$"+s]instanceof Symbol||(QC.call(/[^\w$]/,s)?c.push(i(s,r)+": "+i(r[s],r)):c.push(s+": "+i(r[s],r))));if(typeof Wv=="function")for(var M=0;M<m.length;M++)eP.call(r,m[M])&&c.push("["+i(m[M])+"]: "+i(r[m[M]],r));return c}var oP=rf,of=aF,NF=xF,VF=lm,Zg=oP("%WeakMap%",!0),Xg=oP("%Map%",!0),UF=of("WeakMap.prototype.get",!0),jF=of("WeakMap.prototype.set",!0),GF=of("WeakMap.prototype.has",!0),HF=of("Map.prototype.get",!0),qF=of("Map.prototype.set",!0),WF=of("Map.prototype.has",!0),Ib=function(r,i){for(var o=r,c;(c=o.next)!==null;o=c)if(c.key===i)return o.next=c.next,c.next=r.next,r.next=c,c},ZF=function(r,i){var o=Ib(r,i);return o&&o.value},XF=function(r,i,o){var c=Ib(r,i);c?c.value=o:r.next={key:i,next:r.next,value:o}},YF=function(r,i){return!!Ib(r,i)},JF=function(){var i,o,c,h={assert:function(m){if(!h.has(m))throw new VF("Side channel does not contain "+NF(m))},get:function(m){if(Zg&&m&&(typeof m=="object"||typeof m=="function")){if(i)return UF(i,m)}else if(Xg){if(o)return HF(o,m)}else if(c)return ZF(c,m)},has:function(m){if(Zg&&m&&(typeof m=="object"||typeof m=="function")){if(i)return GF(i,m)}else if(Xg){if(o)return WF(o,m)}else if(c)return YF(c,m);return!1},set:function(m,_){Zg&&m&&(typeof m=="object"||typeof m=="function")?(i||(i=new Zg),jF(i,m,_)):Xg?(o||(o=new Xg),qF(o,m,_)):(c||(c={key:{},next:null}),XF(c,m,_))}};return h},KF=String.prototype.replace,$F=/%20/g,Xv={RFC1738:"RFC1738",RFC3986:"RFC3986"},Cb={default:Xv.RFC3986,formatters:{RFC1738:function(r){return KF.call(r,$F,"+")},RFC3986:function(r){return String(r)}},RFC1738:Xv.RFC1738,RFC3986:Xv.RFC3986},QF=Cb,Yv=Object.prototype.hasOwnProperty,bh=Array.isArray,yl=function(){for(var r=[],i=0;i<256;++i)r.push("%"+((i<16?"0":"")+i.toString(16)).toUpperCase());return r}(),e4=function(i){for(;i.length>1;){var o=i.pop(),c=o.obj[o.prop];if(bh(c)){for(var h=[],m=0;m<c.length;++m)typeof c[m]<"u"&&h.push(c[m]);o.obj[o.prop]=h}}},sP=function(i,o){for(var c=o&&o.plainObjects?Object.create(null):{},h=0;h<i.length;++h)typeof i[h]<"u"&&(c[h]=i[h]);return c},t4=function r(i,o,c){if(!o)return i;if(typeof o!="object"){if(bh(i))i.push(o);else if(i&&typeof i=="object")(c&&(c.plainObjects||c.allowPrototypes)||!Yv.call(Object.prototype,o))&&(i[o]=!0);else return[i,o];return i}if(!i||typeof i!="object")return[i].concat(o);var h=i;return bh(i)&&!bh(o)&&(h=sP(i,c)),bh(i)&&bh(o)?(o.forEach(function(m,_){if(Yv.call(i,_)){var x=i[_];x&&typeof x=="object"&&m&&typeof m=="object"?i[_]=r(x,m,c):i.push(m)}else i[_]=m}),i):Object.keys(o).reduce(function(m,_){var x=o[_];return Yv.call(m,_)?m[_]=r(m[_],x,c):m[_]=x,m},h)},i4=function(i,o){return Object.keys(o).reduce(function(c,h){return c[h]=o[h],c},i)},n4=function(r,i,o){var c=r.replace(/\+/g," ");if(o==="iso-8859-1")return c.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(c)}catch{return c}},r4=function(i,o,c,h,m){if(i.length===0)return i;var _=i;if(typeof i=="symbol"?_=Symbol.prototype.toString.call(i):typeof i!="string"&&(_=String(i)),c==="iso-8859-1")return escape(_).replace(/%u[0-9a-f]{4}/gi,function(P){return"%26%23"+parseInt(P.slice(2),16)+"%3B"});for(var x="",s=0;s<_.length;++s){var M=_.charCodeAt(s);if(M===45||M===46||M===95||M===126||M>=48&&M<=57||M>=65&&M<=90||M>=97&&M<=122||m===QF.RFC1738&&(M===40||M===41)){x+=_.charAt(s);continue}if(M<128){x=x+yl[M];continue}if(M<2048){x=x+(yl[192|M>>6]+yl[128|M&63]);continue}if(M<55296||M>=57344){x=x+(yl[224|M>>12]+yl[128|M>>6&63]+yl[128|M&63]);continue}s+=1,M=65536+((M&1023)<<10|_.charCodeAt(s)&1023),x+=yl[240|M>>18]+yl[128|M>>12&63]+yl[128|M>>6&63]+yl[128|M&63]}return x},o4=function(i){for(var o=[{obj:{o:i},prop:"o"}],c=[],h=0;h<o.length;++h)for(var m=o[h],_=m.obj[m.prop],x=Object.keys(_),s=0;s<x.length;++s){var M=x[s],P=_[M];typeof P=="object"&&P!==null&&c.indexOf(P)===-1&&(o.push({obj:_,prop:M}),c.push(P))}return e4(o),i},s4=function(i){return Object.prototype.toString.call(i)==="[object RegExp]"},a4=function(i){return!i||typeof i!="object"?!1:!!(i.constructor&&i.constructor.isBuffer&&i.constructor.isBuffer(i))},l4=function(i,o){return[].concat(i,o)},c4=function(i,o){if(bh(i)){for(var c=[],h=0;h<i.length;h+=1)c.push(o(i[h]));return c}return o(i)},aP={arrayToObject:sP,assign:i4,combine:l4,compact:o4,decode:n4,encode:r4,isBuffer:a4,isRegExp:s4,maybeMap:c4,merge:t4},lP=JF,x_=aP,Bp=Cb,u4=Object.prototype.hasOwnProperty,cP={brackets:function(i){return i+"[]"},comma:"comma",indices:function(i,o){return i+"["+o+"]"},repeat:function(i){return i}},bl=Array.isArray,h4=Array.prototype.push,uP=function(r,i){h4.apply(r,bl(i)?i:[i])},d4=Date.prototype.toISOString,mE=Bp.default,To={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:x_.encode,encodeValuesOnly:!1,format:mE,formatter:Bp.formatters[mE],indices:!1,serializeDate:function(i){return d4.call(i)},skipNulls:!1,strictNullHandling:!1},f4=function(i){return typeof i=="string"||typeof i=="number"||typeof i=="boolean"||typeof i=="symbol"||typeof i=="bigint"},Jv={},p4=function r(i,o,c,h,m,_,x,s,M,P,L,F,V,X,q,Y,J,ue){for(var ce=i,fe=ue,Ae=0,Ce=!1;(fe=fe.get(Jv))!==void 0&&!Ce;){var He=fe.get(i);if(Ae+=1,typeof He<"u"){if(He===Ae)throw new RangeError("Cyclic object value");Ce=!0}typeof fe.get(Jv)>"u"&&(Ae=0)}if(typeof P=="function"?ce=P(o,ce):ce instanceof Date?ce=V(ce):c==="comma"&&bl(ce)&&(ce=x_.maybeMap(ce,function(yt){return yt instanceof Date?V(yt):yt})),ce===null){if(_)return M&&!Y?M(o,To.encoder,J,"key",X):o;ce=""}if(f4(ce)||x_.isBuffer(ce)){if(M){var We=Y?o:M(o,To.encoder,J,"key",X);return[q(We)+"="+q(M(ce,To.encoder,J,"value",X))]}return[q(o)+"="+q(String(ce))]}var nt=[];if(typeof ce>"u")return nt;var we;if(c==="comma"&&bl(ce))Y&&M&&(ce=x_.maybeMap(ce,M)),we=[{value:ce.length>0?ce.join(",")||null:void 0}];else if(bl(P))we=P;else{var ht=Object.keys(ce);we=L?ht.sort(L):ht}var pt=s?o.replace(/\./g,"%2E"):o,Xe=h&&bl(ce)&&ce.length===1?pt+"[]":pt;if(m&&bl(ce)&&ce.length===0)return Xe+"[]";for(var mt=0;mt<we.length;++mt){var Ft=we[mt],tt=typeof Ft=="object"&&typeof Ft.value<"u"?Ft.value:ce[Ft];if(!(x&&tt===null)){var ei=F&&s?Ft.replace(/\./g,"%2E"):Ft,ki=bl(ce)?typeof c=="function"?c(Xe,ei):Xe:Xe+(F?"."+ei:"["+ei+"]");ue.set(i,Ae);var rt=lP();rt.set(Jv,ue),uP(nt,r(tt,ki,c,h,m,_,x,s,c==="comma"&&Y&&bl(ce)?null:M,P,L,F,V,X,q,Y,J,rt))}}return nt},m4=function(i){if(!i)return To;if(typeof i.allowEmptyArrays<"u"&&typeof i.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof i.encodeDotInKeys<"u"&&typeof i.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(i.encoder!==null&&typeof i.encoder<"u"&&typeof i.encoder!="function")throw new TypeError("Encoder has to be a function.");var o=i.charset||To.charset;if(typeof i.charset<"u"&&i.charset!=="utf-8"&&i.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var c=Bp.default;if(typeof i.format<"u"){if(!u4.call(Bp.formatters,i.format))throw new TypeError("Unknown format option provided.");c=i.format}var h=Bp.formatters[c],m=To.filter;(typeof i.filter=="function"||bl(i.filter))&&(m=i.filter);var _;if(i.arrayFormat in cP?_=i.arrayFormat:"indices"in i?_=i.indices?"indices":"repeat":_=To.arrayFormat,"commaRoundTrip"in i&&typeof i.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var x=typeof i.allowDots>"u"?i.encodeDotInKeys===!0?!0:To.allowDots:!!i.allowDots;return{addQueryPrefix:typeof i.addQueryPrefix=="boolean"?i.addQueryPrefix:To.addQueryPrefix,allowDots:x,allowEmptyArrays:typeof i.allowEmptyArrays=="boolean"?!!i.allowEmptyArrays:To.allowEmptyArrays,arrayFormat:_,charset:o,charsetSentinel:typeof i.charsetSentinel=="boolean"?i.charsetSentinel:To.charsetSentinel,commaRoundTrip:i.commaRoundTrip,delimiter:typeof i.delimiter>"u"?To.delimiter:i.delimiter,encode:typeof i.encode=="boolean"?i.encode:To.encode,encodeDotInKeys:typeof i.encodeDotInKeys=="boolean"?i.encodeDotInKeys:To.encodeDotInKeys,encoder:typeof i.encoder=="function"?i.encoder:To.encoder,encodeValuesOnly:typeof i.encodeValuesOnly=="boolean"?i.encodeValuesOnly:To.encodeValuesOnly,filter:m,format:c,formatter:h,serializeDate:typeof i.serializeDate=="function"?i.serializeDate:To.serializeDate,skipNulls:typeof i.skipNulls=="boolean"?i.skipNulls:To.skipNulls,sort:typeof i.sort=="function"?i.sort:null,strictNullHandling:typeof i.strictNullHandling=="boolean"?i.strictNullHandling:To.strictNullHandling}},g4=function(r,i){var o=r,c=m4(i),h,m;typeof c.filter=="function"?(m=c.filter,o=m("",o)):bl(c.filter)&&(m=c.filter,h=m);var _=[];if(typeof o!="object"||o===null)return"";var x=cP[c.arrayFormat],s=x==="comma"&&c.commaRoundTrip;h||(h=Object.keys(o)),c.sort&&h.sort(c.sort);for(var M=lP(),P=0;P<h.length;++P){var L=h[P];c.skipNulls&&o[L]===null||uP(_,p4(o[L],L,x,s,c.allowEmptyArrays,c.strictNullHandling,c.skipNulls,c.encodeDotInKeys,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.format,c.formatter,c.encodeValuesOnly,c.charset,M))}var F=_.join(c.delimiter),V=c.addQueryPrefix===!0?"?":"";return c.charsetSentinel&&(c.charset==="iso-8859-1"?V+="utf8=%26%2310003%3B&":V+="utf8=%E2%9C%93&"),F.length>0?V+F:""},qd=aP,kx=Object.prototype.hasOwnProperty,_4=Array.isArray,ro={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!0,decoder:qd.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},y4=function(r){return r.replace(/&#(\d+);/g,function(i,o){return String.fromCharCode(parseInt(o,10))})},hP=function(r,i){return r&&typeof r=="string"&&i.comma&&r.indexOf(",")>-1?r.split(","):r},v4="utf8=%26%2310003%3B",x4="utf8=%E2%9C%93",b4=function(i,o){var c={__proto__:null},h=o.ignoreQueryPrefix?i.replace(/^\?/,""):i,m=o.parameterLimit===1/0?void 0:o.parameterLimit,_=h.split(o.delimiter,m),x=-1,s,M=o.charset;if(o.charsetSentinel)for(s=0;s<_.length;++s)_[s].indexOf("utf8=")===0&&(_[s]===x4?M="utf-8":_[s]===v4&&(M="iso-8859-1"),x=s,s=_.length);for(s=0;s<_.length;++s)if(s!==x){var P=_[s],L=P.indexOf("]="),F=L===-1?P.indexOf("="):L+1,V,X;F===-1?(V=o.decoder(P,ro.decoder,M,"key"),X=o.strictNullHandling?null:""):(V=o.decoder(P.slice(0,F),ro.decoder,M,"key"),X=qd.maybeMap(hP(P.slice(F+1),o),function(Y){return o.decoder(Y,ro.decoder,M,"value")})),X&&o.interpretNumericEntities&&M==="iso-8859-1"&&(X=y4(X)),P.indexOf("[]=")>-1&&(X=_4(X)?[X]:X);var q=kx.call(c,V);q&&o.duplicates==="combine"?c[V]=qd.combine(c[V],X):(!q||o.duplicates==="last")&&(c[V]=X)}return c},w4=function(r,i,o,c){for(var h=c?i:hP(i,o),m=r.length-1;m>=0;--m){var _,x=r[m];if(x==="[]"&&o.parseArrays)_=o.allowEmptyArrays&&h===""?[]:[].concat(h);else{_=o.plainObjects?Object.create(null):{};var s=x.charAt(0)==="["&&x.charAt(x.length-1)==="]"?x.slice(1,-1):x,M=o.decodeDotInKeys?s.replace(/%2E/g,"."):s,P=parseInt(M,10);!o.parseArrays&&M===""?_={0:h}:!isNaN(P)&&x!==M&&String(P)===M&&P>=0&&o.parseArrays&&P<=o.arrayLimit?(_=[],_[P]=h):M!=="__proto__"&&(_[M]=h)}h=_}return h},T4=function(i,o,c,h){if(i){var m=c.allowDots?i.replace(/\.([^.[]+)/g,"[$1]"):i,_=/(\[[^[\]]*])/,x=/(\[[^[\]]*])/g,s=c.depth>0&&_.exec(m),M=s?m.slice(0,s.index):m,P=[];if(M){if(!c.plainObjects&&kx.call(Object.prototype,M)&&!c.allowPrototypes)return;P.push(M)}for(var L=0;c.depth>0&&(s=x.exec(m))!==null&&L<c.depth;){if(L+=1,!c.plainObjects&&kx.call(Object.prototype,s[1].slice(1,-1))&&!c.allowPrototypes)return;P.push(s[1])}return s&&P.push("["+m.slice(s.index)+"]"),w4(P,o,c,h)}},S4=function(i){if(!i)return ro;if(typeof i.allowEmptyArrays<"u"&&typeof i.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof i.decodeDotInKeys<"u"&&typeof i.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(i.decoder!==null&&typeof i.decoder<"u"&&typeof i.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof i.charset<"u"&&i.charset!=="utf-8"&&i.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var o=typeof i.charset>"u"?ro.charset:i.charset,c=typeof i.duplicates>"u"?ro.duplicates:i.duplicates;if(c!=="combine"&&c!=="first"&&c!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var h=typeof i.allowDots>"u"?i.decodeDotInKeys===!0?!0:ro.allowDots:!!i.allowDots;return{allowDots:h,allowEmptyArrays:typeof i.allowEmptyArrays=="boolean"?!!i.allowEmptyArrays:ro.allowEmptyArrays,allowPrototypes:typeof i.allowPrototypes=="boolean"?i.allowPrototypes:ro.allowPrototypes,allowSparse:typeof i.allowSparse=="boolean"?i.allowSparse:ro.allowSparse,arrayLimit:typeof i.arrayLimit=="number"?i.arrayLimit:ro.arrayLimit,charset:o,charsetSentinel:typeof i.charsetSentinel=="boolean"?i.charsetSentinel:ro.charsetSentinel,comma:typeof i.comma=="boolean"?i.comma:ro.comma,decodeDotInKeys:typeof i.decodeDotInKeys=="boolean"?i.decodeDotInKeys:ro.decodeDotInKeys,decoder:typeof i.decoder=="function"?i.decoder:ro.decoder,delimiter:typeof i.delimiter=="string"||qd.isRegExp(i.delimiter)?i.delimiter:ro.delimiter,depth:typeof i.depth=="number"||i.depth===!1?+i.depth:ro.depth,duplicates:c,ignoreQueryPrefix:i.ignoreQueryPrefix===!0,interpretNumericEntities:typeof i.interpretNumericEntities=="boolean"?i.interpretNumericEntities:ro.interpretNumericEntities,parameterLimit:typeof i.parameterLimit=="number"?i.parameterLimit:ro.parameterLimit,parseArrays:i.parseArrays!==!1,plainObjects:typeof i.plainObjects=="boolean"?i.plainObjects:ro.plainObjects,strictNullHandling:typeof i.strictNullHandling=="boolean"?i.strictNullHandling:ro.strictNullHandling}},M4=function(r,i){var o=S4(i);if(r===""||r===null||typeof r>"u")return o.plainObjects?Object.create(null):{};for(var c=typeof r=="string"?b4(r,o):r,h=o.plainObjects?Object.create(null):{},m=Object.keys(c),_=0;_<m.length;++_){var x=m[_],s=T4(x,c[x],o,typeof r=="string");h=qd.merge(h,s,o)}return o.allowSparse===!0?h:qd.compact(h)},E4=g4,A4=M4,I4=Cb,C4={formats:I4,parse:A4,stringify:E4};const P4=wC(C4);/*!
 * @kurkle/color v0.3.2
 * https://github.com/kurkle/color#readme
 * (c) 2023 Jukka Kurkela
 * Released under the MIT License
 */function um(r){return r+.5|0}const au=(r,i,o)=>Math.max(Math.min(r,o),i);function Mp(r){return au(um(r*2.55),0,255)}function hu(r){return au(um(r*255),0,255)}function _c(r){return au(um(r/2.55)/100,0,1)}function gE(r){return au(um(r*100),0,100)}const ga={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Dx=[..."0123456789ABCDEF"],k4=r=>Dx[r&15],D4=r=>Dx[(r&240)>>4]+Dx[r&15],Yg=r=>(r&240)>>4===(r&15),L4=r=>Yg(r.r)&&Yg(r.g)&&Yg(r.b)&&Yg(r.a);function O4(r){var i=r.length,o;return r[0]==="#"&&(i===4||i===5?o={r:255&ga[r[1]]*17,g:255&ga[r[2]]*17,b:255&ga[r[3]]*17,a:i===5?ga[r[4]]*17:255}:(i===7||i===9)&&(o={r:ga[r[1]]<<4|ga[r[2]],g:ga[r[3]]<<4|ga[r[4]],b:ga[r[5]]<<4|ga[r[6]],a:i===9?ga[r[7]]<<4|ga[r[8]]:255})),o}const R4=(r,i)=>r<255?i(r):"";function z4(r){var i=L4(r)?k4:D4;return r?"#"+i(r.r)+i(r.g)+i(r.b)+R4(r.a,i):void 0}const F4=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function dP(r,i,o){const c=i*Math.min(o,1-o),h=(m,_=(m+r/30)%12)=>o-c*Math.max(Math.min(_-3,9-_,1),-1);return[h(0),h(8),h(4)]}function B4(r,i,o){const c=(h,m=(h+r/60)%6)=>o-o*i*Math.max(Math.min(m,4-m,1),0);return[c(5),c(3),c(1)]}function N4(r,i,o){const c=dP(r,1,.5);let h;for(i+o>1&&(h=1/(i+o),i*=h,o*=h),h=0;h<3;h++)c[h]*=1-i-o,c[h]+=i;return c}function V4(r,i,o,c,h){return r===h?(i-o)/c+(i<o?6:0):i===h?(o-r)/c+2:(r-i)/c+4}function Pb(r){const o=r.r/255,c=r.g/255,h=r.b/255,m=Math.max(o,c,h),_=Math.min(o,c,h),x=(m+_)/2;let s,M,P;return m!==_&&(P=m-_,M=x>.5?P/(2-m-_):P/(m+_),s=V4(o,c,h,P,m),s=s*60+.5),[s|0,M||0,x]}function kb(r,i,o,c){return(Array.isArray(i)?r(i[0],i[1],i[2]):r(i,o,c)).map(hu)}function Db(r,i,o){return kb(dP,r,i,o)}function U4(r,i,o){return kb(N4,r,i,o)}function j4(r,i,o){return kb(B4,r,i,o)}function fP(r){return(r%360+360)%360}function G4(r){const i=F4.exec(r);let o=255,c;if(!i)return;i[5]!==c&&(o=i[6]?Mp(+i[5]):hu(+i[5]));const h=fP(+i[2]),m=+i[3]/100,_=+i[4]/100;return i[1]==="hwb"?c=U4(h,m,_):i[1]==="hsv"?c=j4(h,m,_):c=Db(h,m,_),{r:c[0],g:c[1],b:c[2],a:o}}function H4(r,i){var o=Pb(r);o[0]=fP(o[0]+i),o=Db(o),r.r=o[0],r.g=o[1],r.b=o[2]}function q4(r){if(!r)return;const i=Pb(r),o=i[0],c=gE(i[1]),h=gE(i[2]);return r.a<255?`hsla(${o}, ${c}%, ${h}%, ${_c(r.a)})`:`hsl(${o}, ${c}%, ${h}%)`}const _E={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},yE={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function W4(){const r={},i=Object.keys(yE),o=Object.keys(_E);let c,h,m,_,x;for(c=0;c<i.length;c++){for(_=x=i[c],h=0;h<o.length;h++)m=o[h],x=x.replace(m,_E[m]);m=parseInt(yE[_],16),r[x]=[m>>16&255,m>>8&255,m&255]}return r}let Jg;function Z4(r){Jg||(Jg=W4(),Jg.transparent=[0,0,0,0]);const i=Jg[r.toLowerCase()];return i&&{r:i[0],g:i[1],b:i[2],a:i.length===4?i[3]:255}}const X4=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function Y4(r){const i=X4.exec(r);let o=255,c,h,m;if(i){if(i[7]!==c){const _=+i[7];o=i[8]?Mp(_):au(_*255,0,255)}return c=+i[1],h=+i[3],m=+i[5],c=255&(i[2]?Mp(c):au(c,0,255)),h=255&(i[4]?Mp(h):au(h,0,255)),m=255&(i[6]?Mp(m):au(m,0,255)),{r:c,g:h,b:m,a:o}}}function J4(r){return r&&(r.a<255?`rgba(${r.r}, ${r.g}, ${r.b}, ${_c(r.a)})`:`rgb(${r.r}, ${r.g}, ${r.b})`)}const Kv=r=>r<=.0031308?r*12.92:Math.pow(r,1/2.4)*1.055-.055,Cd=r=>r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4);function K4(r,i,o){const c=Cd(_c(r.r)),h=Cd(_c(r.g)),m=Cd(_c(r.b));return{r:hu(Kv(c+o*(Cd(_c(i.r))-c))),g:hu(Kv(h+o*(Cd(_c(i.g))-h))),b:hu(Kv(m+o*(Cd(_c(i.b))-m))),a:r.a+o*(i.a-r.a)}}function Kg(r,i,o){if(r){let c=Pb(r);c[i]=Math.max(0,Math.min(c[i]+c[i]*o,i===0?360:1)),c=Db(c),r.r=c[0],r.g=c[1],r.b=c[2]}}function pP(r,i){return r&&Object.assign(i||{},r)}function vE(r){var i={r:0,g:0,b:0,a:255};return Array.isArray(r)?r.length>=3&&(i={r:r[0],g:r[1],b:r[2],a:255},r.length>3&&(i.a=hu(r[3]))):(i=pP(r,{r:0,g:0,b:0,a:1}),i.a=hu(i.a)),i}function $4(r){return r.charAt(0)==="r"?Y4(r):G4(r)}let mP=class Lx{constructor(i){if(i instanceof Lx)return i;const o=typeof i;let c;o==="object"?c=vE(i):o==="string"&&(c=O4(i)||Z4(i)||$4(i)),this._rgb=c,this._valid=!!c}get valid(){return this._valid}get rgb(){var i=pP(this._rgb);return i&&(i.a=_c(i.a)),i}set rgb(i){this._rgb=vE(i)}rgbString(){return this._valid?J4(this._rgb):void 0}hexString(){return this._valid?z4(this._rgb):void 0}hslString(){return this._valid?q4(this._rgb):void 0}mix(i,o){if(i){const c=this.rgb,h=i.rgb;let m;const _=o===m?.5:o,x=2*_-1,s=c.a-h.a,M=((x*s===-1?x:(x+s)/(1+x*s))+1)/2;m=1-M,c.r=255&M*c.r+m*h.r+.5,c.g=255&M*c.g+m*h.g+.5,c.b=255&M*c.b+m*h.b+.5,c.a=_*c.a+(1-_)*h.a,this.rgb=c}return this}interpolate(i,o){return i&&(this._rgb=K4(this._rgb,i._rgb,o)),this}clone(){return new Lx(this.rgb)}alpha(i){return this._rgb.a=hu(i),this}clearer(i){const o=this._rgb;return o.a*=1-i,this}greyscale(){const i=this._rgb,o=um(i.r*.3+i.g*.59+i.b*.11);return i.r=i.g=i.b=o,this}opaquer(i){const o=this._rgb;return o.a*=1+i,this}negate(){const i=this._rgb;return i.r=255-i.r,i.g=255-i.g,i.b=255-i.b,this}lighten(i){return Kg(this._rgb,2,i),this}darken(i){return Kg(this._rgb,2,-i),this}saturate(i){return Kg(this._rgb,1,i),this}desaturate(i){return Kg(this._rgb,1,-i),this}rotate(i){return H4(this._rgb,i),this}};/*!
 * Chart.js v4.4.2
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */function dc(){}const Q4=(()=>{let r=0;return()=>r++})();function Jn(r){return r===null||typeof r>"u"}function Or(r){if(Array.isArray&&Array.isArray(r))return!0;const i=Object.prototype.toString.call(r);return i.slice(0,7)==="[object"&&i.slice(-6)==="Array]"}function zn(r){return r!==null&&Object.prototype.toString.call(r)==="[object Object]"}function Xr(r){return(typeof r=="number"||r instanceof Number)&&isFinite(+r)}function $s(r,i){return Xr(r)?r:i}function bn(r,i){return typeof r>"u"?i:r}const e5=(r,i)=>typeof r=="string"&&r.endsWith("%")?parseFloat(r)/100:+r/i,gP=(r,i)=>typeof r=="string"&&r.endsWith("%")?parseFloat(r)/100*i:+r;function Ir(r,i,o){if(r&&typeof r.call=="function")return r.apply(o,i)}function gr(r,i,o,c){let h,m,_;if(Or(r))if(m=r.length,c)for(h=m-1;h>=0;h--)i.call(o,r[h],h);else for(h=0;h<m;h++)i.call(o,r[h],h);else if(zn(r))for(_=Object.keys(r),m=_.length,h=0;h<m;h++)i.call(o,r[_[h]],_[h])}function W_(r,i){let o,c,h,m;if(!r||!i||r.length!==i.length)return!1;for(o=0,c=r.length;o<c;++o)if(h=r[o],m=i[o],h.datasetIndex!==m.datasetIndex||h.index!==m.index)return!1;return!0}function Z_(r){if(Or(r))return r.map(Z_);if(zn(r)){const i=Object.create(null),o=Object.keys(r),c=o.length;let h=0;for(;h<c;++h)i[o[h]]=Z_(r[o[h]]);return i}return r}function _P(r){return["__proto__","prototype","constructor"].indexOf(r)===-1}function t5(r,i,o,c){if(!_P(r))return;const h=i[r],m=o[r];zn(h)&&zn(m)?Wp(h,m,c):i[r]=Z_(m)}function Wp(r,i,o){const c=Or(i)?i:[i],h=c.length;if(!zn(r))return r;o=o||{};const m=o.merger||t5;let _;for(let x=0;x<h;++x){if(_=c[x],!zn(_))continue;const s=Object.keys(_);for(let M=0,P=s.length;M<P;++M)m(s[M],r,_,o)}return r}function Np(r,i){return Wp(r,i,{merger:i5})}function i5(r,i,o){if(!_P(r))return;const c=i[r],h=o[r];zn(c)&&zn(h)?Np(c,h):Object.prototype.hasOwnProperty.call(i,r)||(i[r]=Z_(h))}const xE={"":r=>r,x:r=>r.x,y:r=>r.y};function n5(r){const i=r.split("."),o=[];let c="";for(const h of i)c+=h,c.endsWith("\\")?c=c.slice(0,-1)+".":(o.push(c),c="");return o}function r5(r){const i=n5(r);return o=>{for(const c of i){if(c==="")break;o=o&&o[c]}return o}}function fu(r,i){return(xE[i]||(xE[i]=r5(i)))(r)}function Lb(r){return r.charAt(0).toUpperCase()+r.slice(1)}const Zp=r=>typeof r<"u",pu=r=>typeof r=="function",bE=(r,i)=>{if(r.size!==i.size)return!1;for(const o of r)if(!i.has(o))return!1;return!0};function o5(r){return r.type==="mouseup"||r.type==="click"||r.type==="contextmenu"}const zr=Math.PI,Rr=2*zr,s5=Rr+zr,X_=Number.POSITIVE_INFINITY,a5=zr/180,co=zr/2,dh=zr/4,wE=zr*2/3,lu=Math.log10,Al=Math.sign;function Vp(r,i,o){return Math.abs(r-i)<o}function TE(r){const i=Math.round(r);r=Vp(r,i,r/1e3)?i:r;const o=Math.pow(10,Math.floor(lu(r))),c=r/o;return(c<=1?1:c<=2?2:c<=5?5:10)*o}function l5(r){const i=[],o=Math.sqrt(r);let c;for(c=1;c<o;c++)r%c===0&&(i.push(c),i.push(r/c));return o===(o|0)&&i.push(o),i.sort((h,m)=>h-m).pop(),i}function Wd(r){return!isNaN(parseFloat(r))&&isFinite(r)}function c5(r,i){const o=Math.round(r);return o-i<=r&&o+i>=r}function yP(r,i,o){let c,h,m;for(c=0,h=r.length;c<h;c++)m=r[c][o],isNaN(m)||(i.min=Math.min(i.min,m),i.max=Math.max(i.max,m))}function Za(r){return r*(zr/180)}function Ob(r){return r*(180/zr)}function SE(r){if(!Xr(r))return;let i=1,o=0;for(;Math.round(r*i)/i!==r;)i*=10,o++;return o}function vP(r,i){const o=i.x-r.x,c=i.y-r.y,h=Math.sqrt(o*o+c*c);let m=Math.atan2(c,o);return m<-.5*zr&&(m+=Rr),{angle:m,distance:h}}function Ox(r,i){return Math.sqrt(Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2))}function u5(r,i){return(r-i+s5)%Rr-zr}function Qs(r){return(r%Rr+Rr)%Rr}function Xp(r,i,o,c){const h=Qs(r),m=Qs(i),_=Qs(o),x=Qs(m-h),s=Qs(_-h),M=Qs(h-m),P=Qs(h-_);return h===m||h===_||c&&m===_||x>s&&M<P}function Do(r,i,o){return Math.max(i,Math.min(o,r))}function h5(r){return Do(r,-32768,32767)}function xc(r,i,o,c=1e-6){return r>=Math.min(i,o)-c&&r<=Math.max(i,o)+c}function Rb(r,i,o){o=o||(_=>r[_]<i);let c=r.length-1,h=0,m;for(;c-h>1;)m=h+c>>1,o(m)?h=m:c=m;return{lo:h,hi:c}}const bc=(r,i,o,c)=>Rb(r,o,c?h=>{const m=r[h][i];return m<o||m===o&&r[h+1][i]===o}:h=>r[h][i]<o),d5=(r,i,o)=>Rb(r,o,c=>r[c][i]>=o);function f5(r,i,o){let c=0,h=r.length;for(;c<h&&r[c]<i;)c++;for(;h>c&&r[h-1]>o;)h--;return c>0||h<r.length?r.slice(c,h):r}const xP=["push","pop","shift","splice","unshift"];function p5(r,i){if(r._chartjs){r._chartjs.listeners.push(i);return}Object.defineProperty(r,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[i]}}),xP.forEach(o=>{const c="_onData"+Lb(o),h=r[o];Object.defineProperty(r,o,{configurable:!0,enumerable:!1,value(...m){const _=h.apply(this,m);return r._chartjs.listeners.forEach(x=>{typeof x[c]=="function"&&x[c](...m)}),_}})})}function ME(r,i){const o=r._chartjs;if(!o)return;const c=o.listeners,h=c.indexOf(i);h!==-1&&c.splice(h,1),!(c.length>0)&&(xP.forEach(m=>{delete r[m]}),delete r._chartjs)}function bP(r){const i=new Set(r);return i.size===r.length?r:Array.from(i)}const wP=function(){return typeof window>"u"?function(r){return r()}:window.requestAnimationFrame}();function TP(r,i){let o=[],c=!1;return function(...h){o=h,c||(c=!0,wP.call(window,()=>{c=!1,r.apply(i,o)}))}}function m5(r,i){let o;return function(...c){return i?(clearTimeout(o),o=setTimeout(r,i,c)):r.apply(this,c),i}}const zb=r=>r==="start"?"left":r==="end"?"right":"center",es=(r,i,o)=>r==="start"?i:r==="end"?o:(i+o)/2,g5=(r,i,o,c)=>r===(c?"left":"right")?o:r==="center"?(i+o)/2:i;function SP(r,i,o){const c=i.length;let h=0,m=c;if(r._sorted){const{iScale:_,_parsed:x}=r,s=_.axis,{min:M,max:P,minDefined:L,maxDefined:F}=_.getUserBounds();L&&(h=Do(Math.min(bc(x,s,M).lo,o?c:bc(i,s,_.getPixelForValue(M)).lo),0,c-1)),F?m=Do(Math.max(bc(x,_.axis,P,!0).hi+1,o?0:bc(i,s,_.getPixelForValue(P),!0).hi+1),h,c)-h:m=c-h}return{start:h,count:m}}function MP(r){const{xScale:i,yScale:o,_scaleRanges:c}=r,h={xmin:i.min,xmax:i.max,ymin:o.min,ymax:o.max};if(!c)return r._scaleRanges=h,!0;const m=c.xmin!==i.min||c.xmax!==i.max||c.ymin!==o.min||c.ymax!==o.max;return Object.assign(c,h),m}const $g=r=>r===0||r===1,EE=(r,i,o)=>-(Math.pow(2,10*(r-=1))*Math.sin((r-i)*Rr/o)),AE=(r,i,o)=>Math.pow(2,-10*r)*Math.sin((r-i)*Rr/o)+1,Up={linear:r=>r,easeInQuad:r=>r*r,easeOutQuad:r=>-r*(r-2),easeInOutQuad:r=>(r/=.5)<1?.5*r*r:-.5*(--r*(r-2)-1),easeInCubic:r=>r*r*r,easeOutCubic:r=>(r-=1)*r*r+1,easeInOutCubic:r=>(r/=.5)<1?.5*r*r*r:.5*((r-=2)*r*r+2),easeInQuart:r=>r*r*r*r,easeOutQuart:r=>-((r-=1)*r*r*r-1),easeInOutQuart:r=>(r/=.5)<1?.5*r*r*r*r:-.5*((r-=2)*r*r*r-2),easeInQuint:r=>r*r*r*r*r,easeOutQuint:r=>(r-=1)*r*r*r*r+1,easeInOutQuint:r=>(r/=.5)<1?.5*r*r*r*r*r:.5*((r-=2)*r*r*r*r+2),easeInSine:r=>-Math.cos(r*co)+1,easeOutSine:r=>Math.sin(r*co),easeInOutSine:r=>-.5*(Math.cos(zr*r)-1),easeInExpo:r=>r===0?0:Math.pow(2,10*(r-1)),easeOutExpo:r=>r===1?1:-Math.pow(2,-10*r)+1,easeInOutExpo:r=>$g(r)?r:r<.5?.5*Math.pow(2,10*(r*2-1)):.5*(-Math.pow(2,-10*(r*2-1))+2),easeInCirc:r=>r>=1?r:-(Math.sqrt(1-r*r)-1),easeOutCirc:r=>Math.sqrt(1-(r-=1)*r),easeInOutCirc:r=>(r/=.5)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1),easeInElastic:r=>$g(r)?r:EE(r,.075,.3),easeOutElastic:r=>$g(r)?r:AE(r,.075,.3),easeInOutElastic(r){return $g(r)?r:r<.5?.5*EE(r*2,.1125,.45):.5+.5*AE(r*2-1,.1125,.45)},easeInBack(r){return r*r*((1.70158+1)*r-1.70158)},easeOutBack(r){return(r-=1)*r*((1.70158+1)*r+1.70158)+1},easeInOutBack(r){let i=1.70158;return(r/=.5)<1?.5*(r*r*(((i*=1.525)+1)*r-i)):.5*((r-=2)*r*(((i*=1.525)+1)*r+i)+2)},easeInBounce:r=>1-Up.easeOutBounce(1-r),easeOutBounce(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375},easeInOutBounce:r=>r<.5?Up.easeInBounce(r*2)*.5:Up.easeOutBounce(r*2-1)*.5+.5};function Fb(r){if(r&&typeof r=="object"){const i=r.toString();return i==="[object CanvasPattern]"||i==="[object CanvasGradient]"}return!1}function IE(r){return Fb(r)?r:new mP(r)}function $v(r){return Fb(r)?r:new mP(r).saturate(.5).darken(.1).hexString()}const _5=["x","y","borderWidth","radius","tension"],y5=["color","borderColor","backgroundColor"];function v5(r){r.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),r.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:i=>i!=="onProgress"&&i!=="onComplete"&&i!=="fn"}),r.set("animations",{colors:{type:"color",properties:y5},numbers:{type:"number",properties:_5}}),r.describe("animations",{_fallback:"animation"}),r.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:i=>i|0}}}})}function x5(r){r.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const CE=new Map;function b5(r,i){i=i||{};const o=r+JSON.stringify(i);let c=CE.get(o);return c||(c=new Intl.NumberFormat(r,i),CE.set(o,c)),c}function hm(r,i,o){return b5(i,o).format(r)}const EP={values(r){return Or(r)?r:""+r},numeric(r,i,o){if(r===0)return"0";const c=this.chart.options.locale;let h,m=r;if(o.length>1){const M=Math.max(Math.abs(o[0].value),Math.abs(o[o.length-1].value));(M<1e-4||M>1e15)&&(h="scientific"),m=w5(r,o)}const _=lu(Math.abs(m)),x=isNaN(_)?1:Math.max(Math.min(-1*Math.floor(_),20),0),s={notation:h,minimumFractionDigits:x,maximumFractionDigits:x};return Object.assign(s,this.options.ticks.format),hm(r,c,s)},logarithmic(r,i,o){if(r===0)return"0";const c=o[i].significand||r/Math.pow(10,Math.floor(lu(r)));return[1,2,3,5,10,15].includes(c)||i>.8*o.length?EP.numeric.call(this,r,i,o):""}};function w5(r,i){let o=i.length>3?i[2].value-i[1].value:i[1].value-i[0].value;return Math.abs(o)>=1&&r!==Math.floor(r)&&(o=r-Math.floor(r)),o}var Sy={formatters:EP};function T5(r){r.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(i,o)=>o.lineWidth,tickColor:(i,o)=>o.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Sy.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),r.route("scale.ticks","color","","color"),r.route("scale.grid","color","","borderColor"),r.route("scale.border","color","","borderColor"),r.route("scale.title","color","","color"),r.describe("scale",{_fallback:!1,_scriptable:i=>!i.startsWith("before")&&!i.startsWith("after")&&i!=="callback"&&i!=="parser",_indexable:i=>i!=="borderDash"&&i!=="tickBorderDash"&&i!=="dash"}),r.describe("scales",{_fallback:"scale"}),r.describe("scale.ticks",{_scriptable:i=>i!=="backdropPadding"&&i!=="callback",_indexable:i=>i!=="backdropPadding"})}const zh=Object.create(null),Rx=Object.create(null);function jp(r,i){if(!i)return r;const o=i.split(".");for(let c=0,h=o.length;c<h;++c){const m=o[c];r=r[m]||(r[m]=Object.create(null))}return r}function Qv(r,i,o){return typeof i=="string"?Wp(jp(r,i),o):Wp(jp(r,""),i)}class S5{constructor(i,o){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=c=>c.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(c,h)=>$v(h.backgroundColor),this.hoverBorderColor=(c,h)=>$v(h.borderColor),this.hoverColor=(c,h)=>$v(h.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(i),this.apply(o)}set(i,o){return Qv(this,i,o)}get(i){return jp(this,i)}describe(i,o){return Qv(Rx,i,o)}override(i,o){return Qv(zh,i,o)}route(i,o,c,h){const m=jp(this,i),_=jp(this,c),x="_"+o;Object.defineProperties(m,{[x]:{value:m[o],writable:!0},[o]:{enumerable:!0,get(){const s=this[x],M=_[h];return zn(s)?Object.assign({},M,s):bn(s,M)},set(s){this[x]=s}}})}apply(i){i.forEach(o=>o(this))}}var Yr=new S5({_scriptable:r=>!r.startsWith("on"),_indexable:r=>r!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[v5,x5,T5]);function M5(r){return!r||Jn(r.size)||Jn(r.family)?null:(r.style?r.style+" ":"")+(r.weight?r.weight+" ":"")+r.size+"px "+r.family}function Y_(r,i,o,c,h){let m=i[h];return m||(m=i[h]=r.measureText(h).width,o.push(h)),m>c&&(c=m),c}function E5(r,i,o,c){c=c||{};let h=c.data=c.data||{},m=c.garbageCollect=c.garbageCollect||[];c.font!==i&&(h=c.data={},m=c.garbageCollect=[],c.font=i),r.save(),r.font=i;let _=0;const x=o.length;let s,M,P,L,F;for(s=0;s<x;s++)if(L=o[s],L!=null&&!Or(L))_=Y_(r,h,m,_,L);else if(Or(L))for(M=0,P=L.length;M<P;M++)F=L[M],F!=null&&!Or(F)&&(_=Y_(r,h,m,_,F));r.restore();const V=m.length/2;if(V>o.length){for(s=0;s<V;s++)delete h[m[s]];m.splice(0,V)}return _}function fh(r,i,o){const c=r.currentDevicePixelRatio,h=o!==0?Math.max(o/2,.5):0;return Math.round((i-h)*c)/c+h}function PE(r,i){i=i||r.getContext("2d"),i.save(),i.resetTransform(),i.clearRect(0,0,r.width,r.height),i.restore()}function zx(r,i,o,c){AP(r,i,o,c,null)}function AP(r,i,o,c,h){let m,_,x,s,M,P,L,F;const V=i.pointStyle,X=i.rotation,q=i.radius;let Y=(X||0)*a5;if(V&&typeof V=="object"&&(m=V.toString(),m==="[object HTMLImageElement]"||m==="[object HTMLCanvasElement]")){r.save(),r.translate(o,c),r.rotate(Y),r.drawImage(V,-V.width/2,-V.height/2,V.width,V.height),r.restore();return}if(!(isNaN(q)||q<=0)){switch(r.beginPath(),V){default:h?r.ellipse(o,c,h/2,q,0,0,Rr):r.arc(o,c,q,0,Rr),r.closePath();break;case"triangle":P=h?h/2:q,r.moveTo(o+Math.sin(Y)*P,c-Math.cos(Y)*q),Y+=wE,r.lineTo(o+Math.sin(Y)*P,c-Math.cos(Y)*q),Y+=wE,r.lineTo(o+Math.sin(Y)*P,c-Math.cos(Y)*q),r.closePath();break;case"rectRounded":M=q*.516,s=q-M,_=Math.cos(Y+dh)*s,L=Math.cos(Y+dh)*(h?h/2-M:s),x=Math.sin(Y+dh)*s,F=Math.sin(Y+dh)*(h?h/2-M:s),r.arc(o-L,c-x,M,Y-zr,Y-co),r.arc(o+F,c-_,M,Y-co,Y),r.arc(o+L,c+x,M,Y,Y+co),r.arc(o-F,c+_,M,Y+co,Y+zr),r.closePath();break;case"rect":if(!X){s=Math.SQRT1_2*q,P=h?h/2:s,r.rect(o-P,c-s,2*P,2*s);break}Y+=dh;case"rectRot":L=Math.cos(Y)*(h?h/2:q),_=Math.cos(Y)*q,x=Math.sin(Y)*q,F=Math.sin(Y)*(h?h/2:q),r.moveTo(o-L,c-x),r.lineTo(o+F,c-_),r.lineTo(o+L,c+x),r.lineTo(o-F,c+_),r.closePath();break;case"crossRot":Y+=dh;case"cross":L=Math.cos(Y)*(h?h/2:q),_=Math.cos(Y)*q,x=Math.sin(Y)*q,F=Math.sin(Y)*(h?h/2:q),r.moveTo(o-L,c-x),r.lineTo(o+L,c+x),r.moveTo(o+F,c-_),r.lineTo(o-F,c+_);break;case"star":L=Math.cos(Y)*(h?h/2:q),_=Math.cos(Y)*q,x=Math.sin(Y)*q,F=Math.sin(Y)*(h?h/2:q),r.moveTo(o-L,c-x),r.lineTo(o+L,c+x),r.moveTo(o+F,c-_),r.lineTo(o-F,c+_),Y+=dh,L=Math.cos(Y)*(h?h/2:q),_=Math.cos(Y)*q,x=Math.sin(Y)*q,F=Math.sin(Y)*(h?h/2:q),r.moveTo(o-L,c-x),r.lineTo(o+L,c+x),r.moveTo(o+F,c-_),r.lineTo(o-F,c+_);break;case"line":_=h?h/2:Math.cos(Y)*q,x=Math.sin(Y)*q,r.moveTo(o-_,c-x),r.lineTo(o+_,c+x);break;case"dash":r.moveTo(o,c),r.lineTo(o+Math.cos(Y)*(h?h/2:q),c+Math.sin(Y)*q);break;case!1:r.closePath();break}r.fill(),i.borderWidth>0&&r.stroke()}}function wc(r,i,o){return o=o||.5,!i||r&&r.x>i.left-o&&r.x<i.right+o&&r.y>i.top-o&&r.y<i.bottom+o}function My(r,i){r.save(),r.beginPath(),r.rect(i.left,i.top,i.right-i.left,i.bottom-i.top),r.clip()}function Ey(r){r.restore()}function A5(r,i,o,c,h){if(!i)return r.lineTo(o.x,o.y);if(h==="middle"){const m=(i.x+o.x)/2;r.lineTo(m,i.y),r.lineTo(m,o.y)}else h==="after"!=!!c?r.lineTo(i.x,o.y):r.lineTo(o.x,i.y);r.lineTo(o.x,o.y)}function I5(r,i,o,c){if(!i)return r.lineTo(o.x,o.y);r.bezierCurveTo(c?i.cp1x:i.cp2x,c?i.cp1y:i.cp2y,c?o.cp2x:o.cp1x,c?o.cp2y:o.cp1y,o.x,o.y)}function C5(r,i){i.translation&&r.translate(i.translation[0],i.translation[1]),Jn(i.rotation)||r.rotate(i.rotation),i.color&&(r.fillStyle=i.color),i.textAlign&&(r.textAlign=i.textAlign),i.textBaseline&&(r.textBaseline=i.textBaseline)}function P5(r,i,o,c,h){if(h.strikethrough||h.underline){const m=r.measureText(c),_=i-m.actualBoundingBoxLeft,x=i+m.actualBoundingBoxRight,s=o-m.actualBoundingBoxAscent,M=o+m.actualBoundingBoxDescent,P=h.strikethrough?(s+M)/2:M;r.strokeStyle=r.fillStyle,r.beginPath(),r.lineWidth=h.decorationWidth||2,r.moveTo(_,P),r.lineTo(x,P),r.stroke()}}function k5(r,i){const o=r.fillStyle;r.fillStyle=i.color,r.fillRect(i.left,i.top,i.width,i.height),r.fillStyle=o}function Fh(r,i,o,c,h,m={}){const _=Or(i)?i:[i],x=m.strokeWidth>0&&m.strokeColor!=="";let s,M;for(r.save(),r.font=h.string,C5(r,m),s=0;s<_.length;++s)M=_[s],m.backdrop&&k5(r,m.backdrop),x&&(m.strokeColor&&(r.strokeStyle=m.strokeColor),Jn(m.strokeWidth)||(r.lineWidth=m.strokeWidth),r.strokeText(M,o,c,m.maxWidth)),r.fillText(M,o,c,m.maxWidth),P5(r,o,c,M,m),c+=Number(h.lineHeight);r.restore()}function Yp(r,i){const{x:o,y:c,w:h,h:m,radius:_}=i;r.arc(o+_.topLeft,c+_.topLeft,_.topLeft,1.5*zr,zr,!0),r.lineTo(o,c+m-_.bottomLeft),r.arc(o+_.bottomLeft,c+m-_.bottomLeft,_.bottomLeft,zr,co,!0),r.lineTo(o+h-_.bottomRight,c+m),r.arc(o+h-_.bottomRight,c+m-_.bottomRight,_.bottomRight,co,0,!0),r.lineTo(o+h,c+_.topRight),r.arc(o+h-_.topRight,c+_.topRight,_.topRight,0,-co,!0),r.lineTo(o+_.topLeft,c)}const D5=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,L5=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function O5(r,i){const o=(""+r).match(D5);if(!o||o[1]==="normal")return i*1.2;switch(r=+o[2],o[3]){case"px":return r;case"%":r/=100;break}return i*r}const R5=r=>+r||0;function Bb(r,i){const o={},c=zn(i),h=c?Object.keys(i):i,m=zn(r)?c?_=>bn(r[_],r[i[_]]):_=>r[_]:()=>r;for(const _ of h)o[_]=R5(m(_));return o}function IP(r){return Bb(r,{top:"y",right:"x",bottom:"y",left:"x"})}function Ih(r){return Bb(r,["topLeft","topRight","bottomLeft","bottomRight"])}function ns(r){const i=IP(r);return i.width=i.left+i.right,i.height=i.top+i.bottom,i}function So(r,i){r=r||{},i=i||Yr.font;let o=bn(r.size,i.size);typeof o=="string"&&(o=parseInt(o,10));let c=bn(r.style,i.style);c&&!(""+c).match(L5)&&(console.warn('Invalid font style specified: "'+c+'"'),c=void 0);const h={family:bn(r.family,i.family),lineHeight:O5(bn(r.lineHeight,i.lineHeight),o),size:o,style:c,weight:bn(r.weight,i.weight),string:""};return h.string=M5(h),h}function Ep(r,i,o,c){let h=!0,m,_,x;for(m=0,_=r.length;m<_;++m)if(x=r[m],x!==void 0&&(i!==void 0&&typeof x=="function"&&(x=x(i),h=!1),o!==void 0&&Or(x)&&(x=x[o%x.length],h=!1),x!==void 0))return c&&!h&&(c.cacheable=!1),x}function z5(r,i,o){const{min:c,max:h}=r,m=gP(i,(h-c)/2),_=(x,s)=>o&&x===0?0:x+s;return{min:_(c,-Math.abs(m)),max:_(h,m)}}function gu(r,i){return Object.assign(Object.create(r),i)}function Nb(r,i=[""],o,c,h=()=>r[0]){const m=o||r;typeof c>"u"&&(c=DP("_fallback",r));const _={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:r,_rootScopes:m,_fallback:c,_getTarget:h,override:x=>Nb([x,...r],i,m,c)};return new Proxy(_,{deleteProperty(x,s){return delete x[s],delete x._keys,delete r[0][s],!0},get(x,s){return PP(x,s,()=>H5(s,i,r,x))},getOwnPropertyDescriptor(x,s){return Reflect.getOwnPropertyDescriptor(x._scopes[0],s)},getPrototypeOf(){return Reflect.getPrototypeOf(r[0])},has(x,s){return DE(x).includes(s)},ownKeys(x){return DE(x)},set(x,s,M){const P=x._storage||(x._storage=h());return x[s]=P[s]=M,delete x._keys,!0}})}function Zd(r,i,o,c){const h={_cacheable:!1,_proxy:r,_context:i,_subProxy:o,_stack:new Set,_descriptors:CP(r,c),setContext:m=>Zd(r,m,o,c),override:m=>Zd(r.override(m),i,o,c)};return new Proxy(h,{deleteProperty(m,_){return delete m[_],delete r[_],!0},get(m,_,x){return PP(m,_,()=>B5(m,_,x))},getOwnPropertyDescriptor(m,_){return m._descriptors.allKeys?Reflect.has(r,_)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(r,_)},getPrototypeOf(){return Reflect.getPrototypeOf(r)},has(m,_){return Reflect.has(r,_)},ownKeys(){return Reflect.ownKeys(r)},set(m,_,x){return r[_]=x,delete m[_],!0}})}function CP(r,i={scriptable:!0,indexable:!0}){const{_scriptable:o=i.scriptable,_indexable:c=i.indexable,_allKeys:h=i.allKeys}=r;return{allKeys:h,scriptable:o,indexable:c,isScriptable:pu(o)?o:()=>o,isIndexable:pu(c)?c:()=>c}}const F5=(r,i)=>r?r+Lb(i):i,Vb=(r,i)=>zn(i)&&r!=="adapters"&&(Object.getPrototypeOf(i)===null||i.constructor===Object);function PP(r,i,o){if(Object.prototype.hasOwnProperty.call(r,i))return r[i];const c=o();return r[i]=c,c}function B5(r,i,o){const{_proxy:c,_context:h,_subProxy:m,_descriptors:_}=r;let x=c[i];return pu(x)&&_.isScriptable(i)&&(x=N5(i,x,r,o)),Or(x)&&x.length&&(x=V5(i,x,r,_.isIndexable)),Vb(i,x)&&(x=Zd(x,h,m&&m[i],_)),x}function N5(r,i,o,c){const{_proxy:h,_context:m,_subProxy:_,_stack:x}=o;if(x.has(r))throw new Error("Recursion detected: "+Array.from(x).join("->")+"->"+r);x.add(r);let s=i(m,_||c);return x.delete(r),Vb(r,s)&&(s=Ub(h._scopes,h,r,s)),s}function V5(r,i,o,c){const{_proxy:h,_context:m,_subProxy:_,_descriptors:x}=o;if(typeof m.index<"u"&&c(r))return i[m.index%i.length];if(zn(i[0])){const s=i,M=h._scopes.filter(P=>P!==s);i=[];for(const P of s){const L=Ub(M,h,r,P);i.push(Zd(L,m,_&&_[r],x))}}return i}function kP(r,i,o){return pu(r)?r(i,o):r}const U5=(r,i)=>r===!0?i:typeof r=="string"?fu(i,r):void 0;function j5(r,i,o,c,h){for(const m of i){const _=U5(o,m);if(_){r.add(_);const x=kP(_._fallback,o,h);if(typeof x<"u"&&x!==o&&x!==c)return x}else if(_===!1&&typeof c<"u"&&o!==c)return null}return!1}function Ub(r,i,o,c){const h=i._rootScopes,m=kP(i._fallback,o,c),_=[...r,...h],x=new Set;x.add(c);let s=kE(x,_,o,m||o,c);return s===null||typeof m<"u"&&m!==o&&(s=kE(x,_,m,s,c),s===null)?!1:Nb(Array.from(x),[""],h,m,()=>G5(i,o,c))}function kE(r,i,o,c,h){for(;o;)o=j5(r,i,o,c,h);return o}function G5(r,i,o){const c=r._getTarget();i in c||(c[i]={});const h=c[i];return Or(h)&&zn(o)?o:h||{}}function H5(r,i,o,c){let h;for(const m of i)if(h=DP(F5(m,r),o),typeof h<"u")return Vb(r,h)?Ub(o,c,r,h):h}function DP(r,i){for(const o of i){if(!o)continue;const c=o[r];if(typeof c<"u")return c}}function DE(r){let i=r._keys;return i||(i=r._keys=q5(r._scopes)),i}function q5(r){const i=new Set;for(const o of r)for(const c of Object.keys(o).filter(h=>!h.startsWith("_")))i.add(c);return Array.from(i)}function LP(r,i,o,c){const{iScale:h}=r,{key:m="r"}=this._parsing,_=new Array(c);let x,s,M,P;for(x=0,s=c;x<s;++x)M=x+o,P=i[M],_[x]={r:h.parse(fu(P,m),M)};return _}const W5=Number.EPSILON||1e-14,Xd=(r,i)=>i<r.length&&!r[i].skip&&r[i],OP=r=>r==="x"?"y":"x";function Z5(r,i,o,c){const h=r.skip?i:r,m=i,_=o.skip?i:o,x=Ox(m,h),s=Ox(_,m);let M=x/(x+s),P=s/(x+s);M=isNaN(M)?0:M,P=isNaN(P)?0:P;const L=c*M,F=c*P;return{previous:{x:m.x-L*(_.x-h.x),y:m.y-L*(_.y-h.y)},next:{x:m.x+F*(_.x-h.x),y:m.y+F*(_.y-h.y)}}}function X5(r,i,o){const c=r.length;let h,m,_,x,s,M=Xd(r,0);for(let P=0;P<c-1;++P)if(s=M,M=Xd(r,P+1),!(!s||!M)){if(Vp(i[P],0,W5)){o[P]=o[P+1]=0;continue}h=o[P]/i[P],m=o[P+1]/i[P],x=Math.pow(h,2)+Math.pow(m,2),!(x<=9)&&(_=3/Math.sqrt(x),o[P]=h*_*i[P],o[P+1]=m*_*i[P])}}function Y5(r,i,o="x"){const c=OP(o),h=r.length;let m,_,x,s=Xd(r,0);for(let M=0;M<h;++M){if(_=x,x=s,s=Xd(r,M+1),!x)continue;const P=x[o],L=x[c];_&&(m=(P-_[o])/3,x[`cp1${o}`]=P-m,x[`cp1${c}`]=L-m*i[M]),s&&(m=(s[o]-P)/3,x[`cp2${o}`]=P+m,x[`cp2${c}`]=L+m*i[M])}}function J5(r,i="x"){const o=OP(i),c=r.length,h=Array(c).fill(0),m=Array(c);let _,x,s,M=Xd(r,0);for(_=0;_<c;++_)if(x=s,s=M,M=Xd(r,_+1),!!s){if(M){const P=M[i]-s[i];h[_]=P!==0?(M[o]-s[o])/P:0}m[_]=x?M?Al(h[_-1])!==Al(h[_])?0:(h[_-1]+h[_])/2:h[_-1]:h[_]}X5(r,h,m),Y5(r,m,i)}function Qg(r,i,o){return Math.max(Math.min(r,o),i)}function K5(r,i){let o,c,h,m,_,x=wc(r[0],i);for(o=0,c=r.length;o<c;++o)_=m,m=x,x=o<c-1&&wc(r[o+1],i),m&&(h=r[o],_&&(h.cp1x=Qg(h.cp1x,i.left,i.right),h.cp1y=Qg(h.cp1y,i.top,i.bottom)),x&&(h.cp2x=Qg(h.cp2x,i.left,i.right),h.cp2y=Qg(h.cp2y,i.top,i.bottom)))}function $5(r,i,o,c,h){let m,_,x,s;if(i.spanGaps&&(r=r.filter(M=>!M.skip)),i.cubicInterpolationMode==="monotone")J5(r,h);else{let M=c?r[r.length-1]:r[0];for(m=0,_=r.length;m<_;++m)x=r[m],s=Z5(M,x,r[Math.min(m+1,_-(c?0:1))%_],i.tension),x.cp1x=s.previous.x,x.cp1y=s.previous.y,x.cp2x=s.next.x,x.cp2y=s.next.y,M=x}i.capBezierPoints&&K5(r,o)}function jb(){return typeof window<"u"&&typeof document<"u"}function Gb(r){let i=r.parentNode;return i&&i.toString()==="[object ShadowRoot]"&&(i=i.host),i}function J_(r,i,o){let c;return typeof r=="string"?(c=parseInt(r,10),r.indexOf("%")!==-1&&(c=c/100*i.parentNode[o])):c=r,c}const Ay=r=>r.ownerDocument.defaultView.getComputedStyle(r,null);function Q5(r,i){return Ay(r).getPropertyValue(i)}const eB=["top","right","bottom","left"];function Ch(r,i,o){const c={};o=o?"-"+o:"";for(let h=0;h<4;h++){const m=eB[h];c[m]=parseFloat(r[i+"-"+m+o])||0}return c.width=c.left+c.right,c.height=c.top+c.bottom,c}const tB=(r,i,o)=>(r>0||i>0)&&(!o||!o.shadowRoot);function iB(r,i){const o=r.touches,c=o&&o.length?o[0]:r,{offsetX:h,offsetY:m}=c;let _=!1,x,s;if(tB(h,m,r.target))x=h,s=m;else{const M=i.getBoundingClientRect();x=c.clientX-M.left,s=c.clientY-M.top,_=!0}return{x,y:s,box:_}}function _h(r,i){if("native"in r)return r;const{canvas:o,currentDevicePixelRatio:c}=i,h=Ay(o),m=h.boxSizing==="border-box",_=Ch(h,"padding"),x=Ch(h,"border","width"),{x:s,y:M,box:P}=iB(r,o),L=_.left+(P&&x.left),F=_.top+(P&&x.top);let{width:V,height:X}=i;return m&&(V-=_.width+x.width,X-=_.height+x.height),{x:Math.round((s-L)/V*o.width/c),y:Math.round((M-F)/X*o.height/c)}}function nB(r,i,o){let c,h;if(i===void 0||o===void 0){const m=Gb(r);if(!m)i=r.clientWidth,o=r.clientHeight;else{const _=m.getBoundingClientRect(),x=Ay(m),s=Ch(x,"border","width"),M=Ch(x,"padding");i=_.width-M.width-s.width,o=_.height-M.height-s.height,c=J_(x.maxWidth,m,"clientWidth"),h=J_(x.maxHeight,m,"clientHeight")}}return{width:i,height:o,maxWidth:c||X_,maxHeight:h||X_}}const e_=r=>Math.round(r*10)/10;function rB(r,i,o,c){const h=Ay(r),m=Ch(h,"margin"),_=J_(h.maxWidth,r,"clientWidth")||X_,x=J_(h.maxHeight,r,"clientHeight")||X_,s=nB(r,i,o);let{width:M,height:P}=s;if(h.boxSizing==="content-box"){const F=Ch(h,"border","width"),V=Ch(h,"padding");M-=V.width+F.width,P-=V.height+F.height}return M=Math.max(0,M-m.width),P=Math.max(0,c?M/c:P-m.height),M=e_(Math.min(M,_,s.maxWidth)),P=e_(Math.min(P,x,s.maxHeight)),M&&!P&&(P=e_(M/2)),(i!==void 0||o!==void 0)&&c&&s.height&&P>s.height&&(P=s.height,M=e_(Math.floor(P*c))),{width:M,height:P}}function LE(r,i,o){const c=i||1,h=Math.floor(r.height*c),m=Math.floor(r.width*c);r.height=Math.floor(r.height),r.width=Math.floor(r.width);const _=r.canvas;return _.style&&(o||!_.style.height&&!_.style.width)&&(_.style.height=`${r.height}px`,_.style.width=`${r.width}px`),r.currentDevicePixelRatio!==c||_.height!==h||_.width!==m?(r.currentDevicePixelRatio=c,_.height=h,_.width=m,r.ctx.setTransform(c,0,0,c,0,0),!0):!1}const oB=function(){let r=!1;try{const i={get passive(){return r=!0,!1}};jb()&&(window.addEventListener("test",null,i),window.removeEventListener("test",null,i))}catch{}return r}();function OE(r,i){const o=Q5(r,i),c=o&&o.match(/^(\d+)(\.\d+)?px$/);return c?+c[1]:void 0}function yh(r,i,o,c){return{x:r.x+o*(i.x-r.x),y:r.y+o*(i.y-r.y)}}function sB(r,i,o,c){return{x:r.x+o*(i.x-r.x),y:c==="middle"?o<.5?r.y:i.y:c==="after"?o<1?r.y:i.y:o>0?i.y:r.y}}function aB(r,i,o,c){const h={x:r.cp2x,y:r.cp2y},m={x:i.cp1x,y:i.cp1y},_=yh(r,h,o),x=yh(h,m,o),s=yh(m,i,o),M=yh(_,x,o),P=yh(x,s,o);return yh(M,P,o)}const lB=function(r,i){return{x(o){return r+r+i-o},setWidth(o){i=o},textAlign(o){return o==="center"?o:o==="right"?"left":"right"},xPlus(o,c){return o-c},leftForLtr(o,c){return o-c}}},cB=function(){return{x(r){return r},setWidth(r){},textAlign(r){return r},xPlus(r,i){return r+i},leftForLtr(r,i){return r}}};function Fd(r,i,o){return r?lB(i,o):cB()}function RP(r,i){let o,c;(i==="ltr"||i==="rtl")&&(o=r.canvas.style,c=[o.getPropertyValue("direction"),o.getPropertyPriority("direction")],o.setProperty("direction",i,"important"),r.prevTextDirection=c)}function zP(r,i){i!==void 0&&(delete r.prevTextDirection,r.canvas.style.setProperty("direction",i[0],i[1]))}function FP(r){return r==="angle"?{between:Xp,compare:u5,normalize:Qs}:{between:xc,compare:(i,o)=>i-o,normalize:i=>i}}function RE({start:r,end:i,count:o,loop:c,style:h}){return{start:r%o,end:i%o,loop:c&&(i-r+1)%o===0,style:h}}function uB(r,i,o){const{property:c,start:h,end:m}=o,{between:_,normalize:x}=FP(c),s=i.length;let{start:M,end:P,loop:L}=r,F,V;if(L){for(M+=s,P+=s,F=0,V=s;F<V&&_(x(i[M%s][c]),h,m);++F)M--,P--;M%=s,P%=s}return P<M&&(P+=s),{start:M,end:P,loop:L,style:r.style}}function BP(r,i,o){if(!o)return[r];const{property:c,start:h,end:m}=o,_=i.length,{compare:x,between:s,normalize:M}=FP(c),{start:P,end:L,loop:F,style:V}=uB(r,i,o),X=[];let q=!1,Y=null,J,ue,ce;const fe=()=>s(h,ce,J)&&x(h,ce)!==0,Ae=()=>x(m,J)===0||s(m,ce,J),Ce=()=>q||fe(),He=()=>!q||Ae();for(let We=P,nt=P;We<=L;++We)ue=i[We%_],!ue.skip&&(J=M(ue[c]),J!==ce&&(q=s(J,h,m),Y===null&&Ce()&&(Y=x(J,h)===0?We:nt),Y!==null&&He()&&(X.push(RE({start:Y,end:We,loop:F,count:_,style:V})),Y=null),nt=We,ce=J));return Y!==null&&X.push(RE({start:Y,end:L,loop:F,count:_,style:V})),X}function NP(r,i){const o=[],c=r.segments;for(let h=0;h<c.length;h++){const m=BP(c[h],r.points,i);m.length&&o.push(...m)}return o}function hB(r,i,o,c){let h=0,m=i-1;if(o&&!c)for(;h<i&&!r[h].skip;)h++;for(;h<i&&r[h].skip;)h++;for(h%=i,o&&(m+=h);m>h&&r[m%i].skip;)m--;return m%=i,{start:h,end:m}}function dB(r,i,o,c){const h=r.length,m=[];let _=i,x=r[i],s;for(s=i+1;s<=o;++s){const M=r[s%h];M.skip||M.stop?x.skip||(c=!1,m.push({start:i%h,end:(s-1)%h,loop:c}),i=_=M.stop?s:null):(_=s,x.skip&&(i=s)),x=M}return _!==null&&m.push({start:i%h,end:_%h,loop:c}),m}function fB(r,i){const o=r.points,c=r.options.spanGaps,h=o.length;if(!h)return[];const m=!!r._loop,{start:_,end:x}=hB(o,h,m,c);if(c===!0)return zE(r,[{start:_,end:x,loop:m}],o,i);const s=x<_?x+h:x,M=!!r._fullLoop&&_===0&&x===h-1;return zE(r,dB(o,_,s,M),o,i)}function zE(r,i,o,c){return!c||!c.setContext||!o?i:pB(r,i,o,c)}function pB(r,i,o,c){const h=r._chart.getContext(),m=FE(r.options),{_datasetIndex:_,options:{spanGaps:x}}=r,s=o.length,M=[];let P=m,L=i[0].start,F=L;function V(X,q,Y,J){const ue=x?-1:1;if(X!==q){for(X+=s;o[X%s].skip;)X-=ue;for(;o[q%s].skip;)q+=ue;X%s!==q%s&&(M.push({start:X%s,end:q%s,loop:Y,style:J}),P=J,L=q%s)}}for(const X of i){L=x?L:X.start;let q=o[L%s],Y;for(F=L+1;F<=X.end;F++){const J=o[F%s];Y=FE(c.setContext(gu(h,{type:"segment",p0:q,p1:J,p0DataIndex:(F-1)%s,p1DataIndex:F%s,datasetIndex:_}))),mB(Y,P)&&V(L,F-1,X.loop,P),q=J,P=Y}L<F-1&&V(L,F-1,X.loop,P)}return M}function FE(r){return{backgroundColor:r.backgroundColor,borderCapStyle:r.borderCapStyle,borderDash:r.borderDash,borderDashOffset:r.borderDashOffset,borderJoinStyle:r.borderJoinStyle,borderWidth:r.borderWidth,borderColor:r.borderColor}}function mB(r,i){if(!i)return!1;const o=[],c=function(h,m){return Fb(m)?(o.includes(m)||o.push(m),o.indexOf(m)):m};return JSON.stringify(r,c)!==JSON.stringify(i,c)}/*!
 * Chart.js v4.4.2
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */class gB{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(i,o,c,h){const m=o.listeners[h],_=o.duration;m.forEach(x=>x({chart:i,initial:o.initial,numSteps:_,currentStep:Math.min(c-o.start,_)}))}_refresh(){this._request||(this._running=!0,this._request=wP.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(i=Date.now()){let o=0;this._charts.forEach((c,h)=>{if(!c.running||!c.items.length)return;const m=c.items;let _=m.length-1,x=!1,s;for(;_>=0;--_)s=m[_],s._active?(s._total>c.duration&&(c.duration=s._total),s.tick(i),x=!0):(m[_]=m[m.length-1],m.pop());x&&(h.draw(),this._notify(h,c,i,"progress")),m.length||(c.running=!1,this._notify(h,c,i,"complete"),c.initial=!1),o+=m.length}),this._lastDate=i,o===0&&(this._running=!1)}_getAnims(i){const o=this._charts;let c=o.get(i);return c||(c={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},o.set(i,c)),c}listen(i,o,c){this._getAnims(i).listeners[o].push(c)}add(i,o){!o||!o.length||this._getAnims(i).items.push(...o)}has(i){return this._getAnims(i).items.length>0}start(i){const o=this._charts.get(i);o&&(o.running=!0,o.start=Date.now(),o.duration=o.items.reduce((c,h)=>Math.max(c,h._duration),0),this._refresh())}running(i){if(!this._running)return!1;const o=this._charts.get(i);return!(!o||!o.running||!o.items.length)}stop(i){const o=this._charts.get(i);if(!o||!o.items.length)return;const c=o.items;let h=c.length-1;for(;h>=0;--h)c[h].cancel();o.items=[],this._notify(i,o,Date.now(),"complete")}remove(i){return this._charts.delete(i)}}var mc=new gB;const BE="transparent",_B={boolean(r,i,o){return o>.5?i:r},color(r,i,o){const c=IE(r||BE),h=c.valid&&IE(i||BE);return h&&h.valid?h.mix(c,o).hexString():i},number(r,i,o){return r+(i-r)*o}};class yB{constructor(i,o,c,h){const m=o[c];h=Ep([i.to,h,m,i.from]);const _=Ep([i.from,m,h]);this._active=!0,this._fn=i.fn||_B[i.type||typeof _],this._easing=Up[i.easing]||Up.linear,this._start=Math.floor(Date.now()+(i.delay||0)),this._duration=this._total=Math.floor(i.duration),this._loop=!!i.loop,this._target=o,this._prop=c,this._from=_,this._to=h,this._promises=void 0}active(){return this._active}update(i,o,c){if(this._active){this._notify(!1);const h=this._target[this._prop],m=c-this._start,_=this._duration-m;this._start=c,this._duration=Math.floor(Math.max(_,i.duration)),this._total+=m,this._loop=!!i.loop,this._to=Ep([i.to,o,h,i.from]),this._from=Ep([i.from,h,o])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(i){const o=i-this._start,c=this._duration,h=this._prop,m=this._from,_=this._loop,x=this._to;let s;if(this._active=m!==x&&(_||o<c),!this._active){this._target[h]=x,this._notify(!0);return}if(o<0){this._target[h]=m;return}s=o/c%2,s=_&&s>1?2-s:s,s=this._easing(Math.min(1,Math.max(0,s))),this._target[h]=this._fn(m,x,s)}wait(){const i=this._promises||(this._promises=[]);return new Promise((o,c)=>{i.push({res:o,rej:c})})}_notify(i){const o=i?"res":"rej",c=this._promises||[];for(let h=0;h<c.length;h++)c[h][o]()}}class VP{constructor(i,o){this._chart=i,this._properties=new Map,this.configure(o)}configure(i){if(!zn(i))return;const o=Object.keys(Yr.animation),c=this._properties;Object.getOwnPropertyNames(i).forEach(h=>{const m=i[h];if(!zn(m))return;const _={};for(const x of o)_[x]=m[x];(Or(m.properties)&&m.properties||[h]).forEach(x=>{(x===h||!c.has(x))&&c.set(x,_)})})}_animateOptions(i,o){const c=o.options,h=xB(i,c);if(!h)return[];const m=this._createAnimations(h,c);return c.$shared&&vB(i.options.$animations,c).then(()=>{i.options=c},()=>{}),m}_createAnimations(i,o){const c=this._properties,h=[],m=i.$animations||(i.$animations={}),_=Object.keys(o),x=Date.now();let s;for(s=_.length-1;s>=0;--s){const M=_[s];if(M.charAt(0)==="$")continue;if(M==="options"){h.push(...this._animateOptions(i,o));continue}const P=o[M];let L=m[M];const F=c.get(M);if(L)if(F&&L.active()){L.update(F,P,x);continue}else L.cancel();if(!F||!F.duration){i[M]=P;continue}m[M]=L=new yB(F,i,M,P),h.push(L)}return h}update(i,o){if(this._properties.size===0){Object.assign(i,o);return}const c=this._createAnimations(i,o);if(c.length)return mc.add(this._chart,c),!0}}function vB(r,i){const o=[],c=Object.keys(i);for(let h=0;h<c.length;h++){const m=r[c[h]];m&&m.active()&&o.push(m.wait())}return Promise.all(o)}function xB(r,i){if(!i)return;let o=r.options;if(!o){r.options=i;return}return o.$shared&&(r.options=o=Object.assign({},o,{$shared:!1,$animations:{}})),o}function NE(r,i){const o=r&&r.options||{},c=o.reverse,h=o.min===void 0?i:0,m=o.max===void 0?i:0;return{start:c?m:h,end:c?h:m}}function bB(r,i,o){if(o===!1)return!1;const c=NE(r,o),h=NE(i,o);return{top:h.end,right:c.end,bottom:h.start,left:c.start}}function wB(r){let i,o,c,h;return zn(r)?(i=r.top,o=r.right,c=r.bottom,h=r.left):i=o=c=h=r,{top:i,right:o,bottom:c,left:h,disabled:r===!1}}function UP(r,i){const o=[],c=r._getSortedDatasetMetas(i);let h,m;for(h=0,m=c.length;h<m;++h)o.push(c[h].index);return o}function VE(r,i,o,c={}){const h=r.keys,m=c.mode==="single";let _,x,s,M;if(i!==null){for(_=0,x=h.length;_<x;++_){if(s=+h[_],s===o){if(c.all)continue;break}M=r.values[s],Xr(M)&&(m||i===0||Al(i)===Al(M))&&(i+=M)}return i}}function TB(r){const i=Object.keys(r),o=new Array(i.length);let c,h,m;for(c=0,h=i.length;c<h;++c)m=i[c],o[c]={x:m,y:r[m]};return o}function UE(r,i){const o=r&&r.options.stacked;return o||o===void 0&&i.stack!==void 0}function SB(r,i,o){return`${r.id}.${i.id}.${o.stack||o.type}`}function MB(r){const{min:i,max:o,minDefined:c,maxDefined:h}=r.getUserBounds();return{min:c?i:Number.NEGATIVE_INFINITY,max:h?o:Number.POSITIVE_INFINITY}}function EB(r,i,o){const c=r[i]||(r[i]={});return c[o]||(c[o]={})}function jE(r,i,o,c){for(const h of i.getMatchingVisibleMetas(c).reverse()){const m=r[h.index];if(o&&m>0||!o&&m<0)return h.index}return null}function GE(r,i){const{chart:o,_cachedMeta:c}=r,h=o._stacks||(o._stacks={}),{iScale:m,vScale:_,index:x}=c,s=m.axis,M=_.axis,P=SB(m,_,c),L=i.length;let F;for(let V=0;V<L;++V){const X=i[V],{[s]:q,[M]:Y}=X,J=X._stacks||(X._stacks={});F=J[M]=EB(h,P,q),F[x]=Y,F._top=jE(F,_,!0,c.type),F._bottom=jE(F,_,!1,c.type);const ue=F._visualValues||(F._visualValues={});ue[x]=Y}}function ex(r,i){const o=r.scales;return Object.keys(o).filter(c=>o[c].axis===i).shift()}function AB(r,i){return gu(r,{active:!1,dataset:void 0,datasetIndex:i,index:i,mode:"default",type:"dataset"})}function IB(r,i,o){return gu(r,{active:!1,dataIndex:i,parsed:void 0,raw:void 0,element:o,index:i,mode:"default",type:"data"})}function gp(r,i){const o=r.controller.index,c=r.vScale&&r.vScale.axis;if(c){i=i||r._parsed;for(const h of i){const m=h._stacks;if(!m||m[c]===void 0||m[c][o]===void 0)return;delete m[c][o],m[c]._visualValues!==void 0&&m[c]._visualValues[o]!==void 0&&delete m[c]._visualValues[o]}}}const tx=r=>r==="reset"||r==="none",HE=(r,i)=>i?r:Object.assign({},r),CB=(r,i,o)=>r&&!i.hidden&&i._stacked&&{keys:UP(o,!0),values:null};class Xa{constructor(i,o){this.chart=i,this._ctx=i.ctx,this.index=o,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const i=this._cachedMeta;this.configure(),this.linkScales(),i._stacked=UE(i.vScale,i),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(i){this.index!==i&&gp(this._cachedMeta),this.index=i}linkScales(){const i=this.chart,o=this._cachedMeta,c=this.getDataset(),h=(L,F,V,X)=>L==="x"?F:L==="r"?X:V,m=o.xAxisID=bn(c.xAxisID,ex(i,"x")),_=o.yAxisID=bn(c.yAxisID,ex(i,"y")),x=o.rAxisID=bn(c.rAxisID,ex(i,"r")),s=o.indexAxis,M=o.iAxisID=h(s,m,_,x),P=o.vAxisID=h(s,_,m,x);o.xScale=this.getScaleForId(m),o.yScale=this.getScaleForId(_),o.rScale=this.getScaleForId(x),o.iScale=this.getScaleForId(M),o.vScale=this.getScaleForId(P)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(i){return this.chart.scales[i]}_getOtherScale(i){const o=this._cachedMeta;return i===o.iScale?o.vScale:o.iScale}reset(){this._update("reset")}_destroy(){const i=this._cachedMeta;this._data&&ME(this._data,this),i._stacked&&gp(i)}_dataCheck(){const i=this.getDataset(),o=i.data||(i.data=[]),c=this._data;if(zn(o))this._data=TB(o);else if(c!==o){if(c){ME(c,this);const h=this._cachedMeta;gp(h),h._parsed=[]}o&&Object.isExtensible(o)&&p5(o,this),this._syncList=[],this._data=o}}addElements(){const i=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(i.dataset=new this.datasetElementType)}buildOrUpdateElements(i){const o=this._cachedMeta,c=this.getDataset();let h=!1;this._dataCheck();const m=o._stacked;o._stacked=UE(o.vScale,o),o.stack!==c.stack&&(h=!0,gp(o),o.stack=c.stack),this._resyncElements(i),(h||m!==o._stacked)&&GE(this,o._parsed)}configure(){const i=this.chart.config,o=i.datasetScopeKeys(this._type),c=i.getOptionScopes(this.getDataset(),o,!0);this.options=i.createResolver(c,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(i,o){const{_cachedMeta:c,_data:h}=this,{iScale:m,_stacked:_}=c,x=m.axis;let s=i===0&&o===h.length?!0:c._sorted,M=i>0&&c._parsed[i-1],P,L,F;if(this._parsing===!1)c._parsed=h,c._sorted=!0,F=h;else{Or(h[i])?F=this.parseArrayData(c,h,i,o):zn(h[i])?F=this.parseObjectData(c,h,i,o):F=this.parsePrimitiveData(c,h,i,o);const V=()=>L[x]===null||M&&L[x]<M[x];for(P=0;P<o;++P)c._parsed[P+i]=L=F[P],s&&(V()&&(s=!1),M=L);c._sorted=s}_&&GE(this,F)}parsePrimitiveData(i,o,c,h){const{iScale:m,vScale:_}=i,x=m.axis,s=_.axis,M=m.getLabels(),P=m===_,L=new Array(h);let F,V,X;for(F=0,V=h;F<V;++F)X=F+c,L[F]={[x]:P||m.parse(M[X],X),[s]:_.parse(o[X],X)};return L}parseArrayData(i,o,c,h){const{xScale:m,yScale:_}=i,x=new Array(h);let s,M,P,L;for(s=0,M=h;s<M;++s)P=s+c,L=o[P],x[s]={x:m.parse(L[0],P),y:_.parse(L[1],P)};return x}parseObjectData(i,o,c,h){const{xScale:m,yScale:_}=i,{xAxisKey:x="x",yAxisKey:s="y"}=this._parsing,M=new Array(h);let P,L,F,V;for(P=0,L=h;P<L;++P)F=P+c,V=o[F],M[P]={x:m.parse(fu(V,x),F),y:_.parse(fu(V,s),F)};return M}getParsed(i){return this._cachedMeta._parsed[i]}getDataElement(i){return this._cachedMeta.data[i]}applyStack(i,o,c){const h=this.chart,m=this._cachedMeta,_=o[i.axis],x={keys:UP(h,!0),values:o._stacks[i.axis]._visualValues};return VE(x,_,m.index,{mode:c})}updateRangeFromParsed(i,o,c,h){const m=c[o.axis];let _=m===null?NaN:m;const x=h&&c._stacks[o.axis];h&&x&&(h.values=x,_=VE(h,m,this._cachedMeta.index)),i.min=Math.min(i.min,_),i.max=Math.max(i.max,_)}getMinMax(i,o){const c=this._cachedMeta,h=c._parsed,m=c._sorted&&i===c.iScale,_=h.length,x=this._getOtherScale(i),s=CB(o,c,this.chart),M={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:P,max:L}=MB(x);let F,V;function X(){V=h[F];const q=V[x.axis];return!Xr(V[i.axis])||P>q||L<q}for(F=0;F<_&&!(!X()&&(this.updateRangeFromParsed(M,i,V,s),m));++F);if(m){for(F=_-1;F>=0;--F)if(!X()){this.updateRangeFromParsed(M,i,V,s);break}}return M}getAllParsedValues(i){const o=this._cachedMeta._parsed,c=[];let h,m,_;for(h=0,m=o.length;h<m;++h)_=o[h][i.axis],Xr(_)&&c.push(_);return c}getMaxOverflow(){return!1}getLabelAndValue(i){const o=this._cachedMeta,c=o.iScale,h=o.vScale,m=this.getParsed(i);return{label:c?""+c.getLabelForValue(m[c.axis]):"",value:h?""+h.getLabelForValue(m[h.axis]):""}}_update(i){const o=this._cachedMeta;this.update(i||"default"),o._clip=wB(bn(this.options.clip,bB(o.xScale,o.yScale,this.getMaxOverflow())))}update(i){}draw(){const i=this._ctx,o=this.chart,c=this._cachedMeta,h=c.data||[],m=o.chartArea,_=[],x=this._drawStart||0,s=this._drawCount||h.length-x,M=this.options.drawActiveElementsOnTop;let P;for(c.dataset&&c.dataset.draw(i,m,x,s),P=x;P<x+s;++P){const L=h[P];L.hidden||(L.active&&M?_.push(L):L.draw(i,m))}for(P=0;P<_.length;++P)_[P].draw(i,m)}getStyle(i,o){const c=o?"active":"default";return i===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(c):this.resolveDataElementOptions(i||0,c)}getContext(i,o,c){const h=this.getDataset();let m;if(i>=0&&i<this._cachedMeta.data.length){const _=this._cachedMeta.data[i];m=_.$context||(_.$context=IB(this.getContext(),i,_)),m.parsed=this.getParsed(i),m.raw=h.data[i],m.index=m.dataIndex=i}else m=this.$context||(this.$context=AB(this.chart.getContext(),this.index)),m.dataset=h,m.index=m.datasetIndex=this.index;return m.active=!!o,m.mode=c,m}resolveDatasetElementOptions(i){return this._resolveElementOptions(this.datasetElementType.id,i)}resolveDataElementOptions(i,o){return this._resolveElementOptions(this.dataElementType.id,o,i)}_resolveElementOptions(i,o="default",c){const h=o==="active",m=this._cachedDataOpts,_=i+"-"+o,x=m[_],s=this.enableOptionSharing&&Zp(c);if(x)return HE(x,s);const M=this.chart.config,P=M.datasetElementScopeKeys(this._type,i),L=h?[`${i}Hover`,"hover",i,""]:[i,""],F=M.getOptionScopes(this.getDataset(),P),V=Object.keys(Yr.elements[i]),X=()=>this.getContext(c,h,o),q=M.resolveNamedOptions(F,V,X,L);return q.$shared&&(q.$shared=s,m[_]=Object.freeze(HE(q,s))),q}_resolveAnimations(i,o,c){const h=this.chart,m=this._cachedDataOpts,_=`animation-${o}`,x=m[_];if(x)return x;let s;if(h.options.animation!==!1){const P=this.chart.config,L=P.datasetAnimationScopeKeys(this._type,o),F=P.getOptionScopes(this.getDataset(),L);s=P.createResolver(F,this.getContext(i,c,o))}const M=new VP(h,s&&s.animations);return s&&s._cacheable&&(m[_]=Object.freeze(M)),M}getSharedOptions(i){if(i.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},i))}includeOptions(i,o){return!o||tx(i)||this.chart._animationsDisabled}_getSharedOptions(i,o){const c=this.resolveDataElementOptions(i,o),h=this._sharedOptions,m=this.getSharedOptions(c),_=this.includeOptions(o,m)||m!==h;return this.updateSharedOptions(m,o,c),{sharedOptions:m,includeOptions:_}}updateElement(i,o,c,h){tx(h)?Object.assign(i,c):this._resolveAnimations(o,h).update(i,c)}updateSharedOptions(i,o,c){i&&!tx(o)&&this._resolveAnimations(void 0,o).update(i,c)}_setStyle(i,o,c,h){i.active=h;const m=this.getStyle(o,h);this._resolveAnimations(o,c,h).update(i,{options:!h&&this.getSharedOptions(m)||m})}removeHoverStyle(i,o,c){this._setStyle(i,c,"active",!1)}setHoverStyle(i,o,c){this._setStyle(i,c,"active",!0)}_removeDatasetHoverStyle(){const i=this._cachedMeta.dataset;i&&this._setStyle(i,void 0,"active",!1)}_setDatasetHoverStyle(){const i=this._cachedMeta.dataset;i&&this._setStyle(i,void 0,"active",!0)}_resyncElements(i){const o=this._data,c=this._cachedMeta.data;for(const[x,s,M]of this._syncList)this[x](s,M);this._syncList=[];const h=c.length,m=o.length,_=Math.min(m,h);_&&this.parse(0,_),m>h?this._insertElements(h,m-h,i):m<h&&this._removeElements(m,h-m)}_insertElements(i,o,c=!0){const h=this._cachedMeta,m=h.data,_=i+o;let x;const s=M=>{for(M.length+=o,x=M.length-1;x>=_;x--)M[x]=M[x-o]};for(s(m),x=i;x<_;++x)m[x]=new this.dataElementType;this._parsing&&s(h._parsed),this.parse(i,o),c&&this.updateElements(m,i,o,"reset")}updateElements(i,o,c,h){}_removeElements(i,o){const c=this._cachedMeta;if(this._parsing){const h=c._parsed.splice(i,o);c._stacked&&gp(c,h)}c.data.splice(i,o)}_sync(i){if(this._parsing)this._syncList.push(i);else{const[o,c,h]=i;this[o](c,h)}this.chart._dataChanges.push([this.index,...i])}_onDataPush(){const i=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-i,i])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(i,o){o&&this._sync(["_removeElements",i,o]);const c=arguments.length-2;c&&this._sync(["_insertElements",i,c])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}bi(Xa,"defaults",{}),bi(Xa,"datasetElementType",null),bi(Xa,"dataElementType",null);function PB(r,i){if(!r._cache.$bar){const o=r.getMatchingVisibleMetas(i);let c=[];for(let h=0,m=o.length;h<m;h++)c=c.concat(o[h].controller.getAllParsedValues(r));r._cache.$bar=bP(c.sort((h,m)=>h-m))}return r._cache.$bar}function kB(r){const i=r.iScale,o=PB(i,r.type);let c=i._length,h,m,_,x;const s=()=>{_===32767||_===-32768||(Zp(x)&&(c=Math.min(c,Math.abs(_-x)||c)),x=_)};for(h=0,m=o.length;h<m;++h)_=i.getPixelForValue(o[h]),s();for(x=void 0,h=0,m=i.ticks.length;h<m;++h)_=i.getPixelForTick(h),s();return c}function DB(r,i,o,c){const h=o.barThickness;let m,_;return Jn(h)?(m=i.min*o.categoryPercentage,_=o.barPercentage):(m=h*c,_=1),{chunk:m/c,ratio:_,start:i.pixels[r]-m/2}}function LB(r,i,o,c){const h=i.pixels,m=h[r];let _=r>0?h[r-1]:null,x=r<h.length-1?h[r+1]:null;const s=o.categoryPercentage;_===null&&(_=m-(x===null?i.end-i.start:x-m)),x===null&&(x=m+m-_);const M=m-(m-Math.min(_,x))/2*s;return{chunk:Math.abs(x-_)/2*s/c,ratio:o.barPercentage,start:M}}function OB(r,i,o,c){const h=o.parse(r[0],c),m=o.parse(r[1],c),_=Math.min(h,m),x=Math.max(h,m);let s=_,M=x;Math.abs(_)>Math.abs(x)&&(s=x,M=_),i[o.axis]=M,i._custom={barStart:s,barEnd:M,start:h,end:m,min:_,max:x}}function jP(r,i,o,c){return Or(r)?OB(r,i,o,c):i[o.axis]=o.parse(r,c),i}function qE(r,i,o,c){const h=r.iScale,m=r.vScale,_=h.getLabels(),x=h===m,s=[];let M,P,L,F;for(M=o,P=o+c;M<P;++M)F=i[M],L={},L[h.axis]=x||h.parse(_[M],M),s.push(jP(F,L,m,M));return s}function ix(r){return r&&r.barStart!==void 0&&r.barEnd!==void 0}function RB(r,i,o){return r!==0?Al(r):(i.isHorizontal()?1:-1)*(i.min>=o?1:-1)}function zB(r){let i,o,c,h,m;return r.horizontal?(i=r.base>r.x,o="left",c="right"):(i=r.base<r.y,o="bottom",c="top"),i?(h="end",m="start"):(h="start",m="end"),{start:o,end:c,reverse:i,top:h,bottom:m}}function FB(r,i,o,c){let h=i.borderSkipped;const m={};if(!h){r.borderSkipped=m;return}if(h===!0){r.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:_,end:x,reverse:s,top:M,bottom:P}=zB(r);h==="middle"&&o&&(r.enableBorderRadius=!0,(o._top||0)===c?h=M:(o._bottom||0)===c?h=P:(m[WE(P,_,x,s)]=!0,h=M)),m[WE(h,_,x,s)]=!0,r.borderSkipped=m}function WE(r,i,o,c){return c?(r=BB(r,i,o),r=ZE(r,o,i)):r=ZE(r,i,o),r}function BB(r,i,o){return r===i?o:r===o?i:r}function ZE(r,i,o){return r==="start"?i:r==="end"?o:r}function NB(r,{inflateAmount:i},o){r.inflateAmount=i==="auto"?o===1?.33:0:i}class b_ extends Xa{parsePrimitiveData(i,o,c,h){return qE(i,o,c,h)}parseArrayData(i,o,c,h){return qE(i,o,c,h)}parseObjectData(i,o,c,h){const{iScale:m,vScale:_}=i,{xAxisKey:x="x",yAxisKey:s="y"}=this._parsing,M=m.axis==="x"?x:s,P=_.axis==="x"?x:s,L=[];let F,V,X,q;for(F=c,V=c+h;F<V;++F)q=o[F],X={},X[m.axis]=m.parse(fu(q,M),F),L.push(jP(fu(q,P),X,_,F));return L}updateRangeFromParsed(i,o,c,h){super.updateRangeFromParsed(i,o,c,h);const m=c._custom;m&&o===this._cachedMeta.vScale&&(i.min=Math.min(i.min,m.min),i.max=Math.max(i.max,m.max))}getMaxOverflow(){return 0}getLabelAndValue(i){const o=this._cachedMeta,{iScale:c,vScale:h}=o,m=this.getParsed(i),_=m._custom,x=ix(_)?"["+_.start+", "+_.end+"]":""+h.getLabelForValue(m[h.axis]);return{label:""+c.getLabelForValue(m[c.axis]),value:x}}initialize(){this.enableOptionSharing=!0,super.initialize();const i=this._cachedMeta;i.stack=this.getDataset().stack}update(i){const o=this._cachedMeta;this.updateElements(o.data,0,o.data.length,i)}updateElements(i,o,c,h){const m=h==="reset",{index:_,_cachedMeta:{vScale:x}}=this,s=x.getBasePixel(),M=x.isHorizontal(),P=this._getRuler(),{sharedOptions:L,includeOptions:F}=this._getSharedOptions(o,h);for(let V=o;V<o+c;V++){const X=this.getParsed(V),q=m||Jn(X[x.axis])?{base:s,head:s}:this._calculateBarValuePixels(V),Y=this._calculateBarIndexPixels(V,P),J=(X._stacks||{})[x.axis],ue={horizontal:M,base:q.base,enableBorderRadius:!J||ix(X._custom)||_===J._top||_===J._bottom,x:M?q.head:Y.center,y:M?Y.center:q.head,height:M?Y.size:Math.abs(q.size),width:M?Math.abs(q.size):Y.size};F&&(ue.options=L||this.resolveDataElementOptions(V,i[V].active?"active":h));const ce=ue.options||i[V].options;FB(ue,ce,J,_),NB(ue,ce,P.ratio),this.updateElement(i[V],V,ue,h)}}_getStacks(i,o){const{iScale:c}=this._cachedMeta,h=c.getMatchingVisibleMetas(this._type).filter(s=>s.controller.options.grouped),m=c.options.stacked,_=[],x=s=>{const M=s.controller.getParsed(o),P=M&&M[s.vScale.axis];if(Jn(P)||isNaN(P))return!0};for(const s of h)if(!(o!==void 0&&x(s))&&((m===!1||_.indexOf(s.stack)===-1||m===void 0&&s.stack===void 0)&&_.push(s.stack),s.index===i))break;return _.length||_.push(void 0),_}_getStackCount(i){return this._getStacks(void 0,i).length}_getStackIndex(i,o,c){const h=this._getStacks(i,c),m=o!==void 0?h.indexOf(o):-1;return m===-1?h.length-1:m}_getRuler(){const i=this.options,o=this._cachedMeta,c=o.iScale,h=[];let m,_;for(m=0,_=o.data.length;m<_;++m)h.push(c.getPixelForValue(this.getParsed(m)[c.axis],m));const x=i.barThickness;return{min:x||kB(o),pixels:h,start:c._startPixel,end:c._endPixel,stackCount:this._getStackCount(),scale:c,grouped:i.grouped,ratio:x?1:i.categoryPercentage*i.barPercentage}}_calculateBarValuePixels(i){const{_cachedMeta:{vScale:o,_stacked:c,index:h},options:{base:m,minBarLength:_}}=this,x=m||0,s=this.getParsed(i),M=s._custom,P=ix(M);let L=s[o.axis],F=0,V=c?this.applyStack(o,s,c):L,X,q;V!==L&&(F=V-L,V=L),P&&(L=M.barStart,V=M.barEnd-M.barStart,L!==0&&Al(L)!==Al(M.barEnd)&&(F=0),F+=L);const Y=!Jn(m)&&!P?m:F;let J=o.getPixelForValue(Y);if(this.chart.getDataVisibility(i)?X=o.getPixelForValue(F+V):X=J,q=X-J,Math.abs(q)<_){q=RB(q,o,x)*_,L===x&&(J-=q/2);const ue=o.getPixelForDecimal(0),ce=o.getPixelForDecimal(1),fe=Math.min(ue,ce),Ae=Math.max(ue,ce);J=Math.max(Math.min(J,Ae),fe),X=J+q,c&&!P&&(s._stacks[o.axis]._visualValues[h]=o.getValueForPixel(X)-o.getValueForPixel(J))}if(J===o.getPixelForValue(x)){const ue=Al(q)*o.getLineWidthForValue(x)/2;J+=ue,q-=ue}return{size:q,base:J,head:X,center:X+q/2}}_calculateBarIndexPixels(i,o){const c=o.scale,h=this.options,m=h.skipNull,_=bn(h.maxBarThickness,1/0);let x,s;if(o.grouped){const M=m?this._getStackCount(i):o.stackCount,P=h.barThickness==="flex"?LB(i,o,h,M):DB(i,o,h,M),L=this._getStackIndex(this.index,this._cachedMeta.stack,m?i:void 0);x=P.start+P.chunk*L+P.chunk/2,s=Math.min(_,P.chunk*P.ratio)}else x=c.getPixelForValue(this.getParsed(i)[c.axis],i),s=Math.min(_,o.min*o.ratio);return{base:x-s/2,head:x+s/2,center:x,size:s}}draw(){const i=this._cachedMeta,o=i.vScale,c=i.data,h=c.length;let m=0;for(;m<h;++m)this.getParsed(m)[o.axis]!==null&&c[m].draw(this._ctx)}}bi(b_,"id","bar"),bi(b_,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),bi(b_,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class w_ extends Xa{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(i,o,c,h){const m=super.parsePrimitiveData(i,o,c,h);for(let _=0;_<m.length;_++)m[_]._custom=this.resolveDataElementOptions(_+c).radius;return m}parseArrayData(i,o,c,h){const m=super.parseArrayData(i,o,c,h);for(let _=0;_<m.length;_++){const x=o[c+_];m[_]._custom=bn(x[2],this.resolveDataElementOptions(_+c).radius)}return m}parseObjectData(i,o,c,h){const m=super.parseObjectData(i,o,c,h);for(let _=0;_<m.length;_++){const x=o[c+_];m[_]._custom=bn(x&&x.r&&+x.r,this.resolveDataElementOptions(_+c).radius)}return m}getMaxOverflow(){const i=this._cachedMeta.data;let o=0;for(let c=i.length-1;c>=0;--c)o=Math.max(o,i[c].size(this.resolveDataElementOptions(c))/2);return o>0&&o}getLabelAndValue(i){const o=this._cachedMeta,c=this.chart.data.labels||[],{xScale:h,yScale:m}=o,_=this.getParsed(i),x=h.getLabelForValue(_.x),s=m.getLabelForValue(_.y),M=_._custom;return{label:c[i]||"",value:"("+x+", "+s+(M?", "+M:"")+")"}}update(i){const o=this._cachedMeta.data;this.updateElements(o,0,o.length,i)}updateElements(i,o,c,h){const m=h==="reset",{iScale:_,vScale:x}=this._cachedMeta,{sharedOptions:s,includeOptions:M}=this._getSharedOptions(o,h),P=_.axis,L=x.axis;for(let F=o;F<o+c;F++){const V=i[F],X=!m&&this.getParsed(F),q={},Y=q[P]=m?_.getPixelForDecimal(.5):_.getPixelForValue(X[P]),J=q[L]=m?x.getBasePixel():x.getPixelForValue(X[L]);q.skip=isNaN(Y)||isNaN(J),M&&(q.options=s||this.resolveDataElementOptions(F,V.active?"active":h),m&&(q.options.radius=0)),this.updateElement(V,F,q,h)}}resolveDataElementOptions(i,o){const c=this.getParsed(i);let h=super.resolveDataElementOptions(i,o);h.$shared&&(h=Object.assign({},h,{$shared:!1}));const m=h.radius;return o!=="active"&&(h.radius=0),h.radius+=bn(c&&c._custom,m),h}}bi(w_,"id","bubble"),bi(w_,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),bi(w_,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function VB(r,i,o){let c=1,h=1,m=0,_=0;if(i<Rr){const x=r,s=x+i,M=Math.cos(x),P=Math.sin(x),L=Math.cos(s),F=Math.sin(s),V=(ce,fe,Ae)=>Xp(ce,x,s,!0)?1:Math.max(fe,fe*o,Ae,Ae*o),X=(ce,fe,Ae)=>Xp(ce,x,s,!0)?-1:Math.min(fe,fe*o,Ae,Ae*o),q=V(0,M,L),Y=V(co,P,F),J=X(zr,M,L),ue=X(zr+co,P,F);c=(q-J)/2,h=(Y-ue)/2,m=-(q+J)/2,_=-(Y+ue)/2}return{ratioX:c,ratioY:h,offsetX:m,offsetY:_}}class Th extends Xa{constructor(i,o){super(i,o),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(i,o){const c=this.getDataset().data,h=this._cachedMeta;if(this._parsing===!1)h._parsed=c;else{let m=s=>+c[s];if(zn(c[i])){const{key:s="value"}=this._parsing;m=M=>+fu(c[M],s)}let _,x;for(_=i,x=i+o;_<x;++_)h._parsed[_]=m(_)}}_getRotation(){return Za(this.options.rotation-90)}_getCircumference(){return Za(this.options.circumference)}_getRotationExtents(){let i=Rr,o=-Rr;for(let c=0;c<this.chart.data.datasets.length;++c)if(this.chart.isDatasetVisible(c)&&this.chart.getDatasetMeta(c).type===this._type){const h=this.chart.getDatasetMeta(c).controller,m=h._getRotation(),_=h._getCircumference();i=Math.min(i,m),o=Math.max(o,m+_)}return{rotation:i,circumference:o-i}}update(i){const o=this.chart,{chartArea:c}=o,h=this._cachedMeta,m=h.data,_=this.getMaxBorderWidth()+this.getMaxOffset(m)+this.options.spacing,x=Math.max((Math.min(c.width,c.height)-_)/2,0),s=Math.min(e5(this.options.cutout,x),1),M=this._getRingWeight(this.index),{circumference:P,rotation:L}=this._getRotationExtents(),{ratioX:F,ratioY:V,offsetX:X,offsetY:q}=VB(L,P,s),Y=(c.width-_)/F,J=(c.height-_)/V,ue=Math.max(Math.min(Y,J)/2,0),ce=gP(this.options.radius,ue),fe=Math.max(ce*s,0),Ae=(ce-fe)/this._getVisibleDatasetWeightTotal();this.offsetX=X*ce,this.offsetY=q*ce,h.total=this.calculateTotal(),this.outerRadius=ce-Ae*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-Ae*M,0),this.updateElements(m,0,m.length,i)}_circumference(i,o){const c=this.options,h=this._cachedMeta,m=this._getCircumference();return o&&c.animation.animateRotate||!this.chart.getDataVisibility(i)||h._parsed[i]===null||h.data[i].hidden?0:this.calculateCircumference(h._parsed[i]*m/Rr)}updateElements(i,o,c,h){const m=h==="reset",_=this.chart,x=_.chartArea,M=_.options.animation,P=(x.left+x.right)/2,L=(x.top+x.bottom)/2,F=m&&M.animateScale,V=F?0:this.innerRadius,X=F?0:this.outerRadius,{sharedOptions:q,includeOptions:Y}=this._getSharedOptions(o,h);let J=this._getRotation(),ue;for(ue=0;ue<o;++ue)J+=this._circumference(ue,m);for(ue=o;ue<o+c;++ue){const ce=this._circumference(ue,m),fe=i[ue],Ae={x:P+this.offsetX,y:L+this.offsetY,startAngle:J,endAngle:J+ce,circumference:ce,outerRadius:X,innerRadius:V};Y&&(Ae.options=q||this.resolveDataElementOptions(ue,fe.active?"active":h)),J+=ce,this.updateElement(fe,ue,Ae,h)}}calculateTotal(){const i=this._cachedMeta,o=i.data;let c=0,h;for(h=0;h<o.length;h++){const m=i._parsed[h];m!==null&&!isNaN(m)&&this.chart.getDataVisibility(h)&&!o[h].hidden&&(c+=Math.abs(m))}return c}calculateCircumference(i){const o=this._cachedMeta.total;return o>0&&!isNaN(i)?Rr*(Math.abs(i)/o):0}getLabelAndValue(i){const o=this._cachedMeta,c=this.chart,h=c.data.labels||[],m=hm(o._parsed[i],c.options.locale);return{label:h[i]||"",value:m}}getMaxBorderWidth(i){let o=0;const c=this.chart;let h,m,_,x,s;if(!i){for(h=0,m=c.data.datasets.length;h<m;++h)if(c.isDatasetVisible(h)){_=c.getDatasetMeta(h),i=_.data,x=_.controller;break}}if(!i)return 0;for(h=0,m=i.length;h<m;++h)s=x.resolveDataElementOptions(h),s.borderAlign!=="inner"&&(o=Math.max(o,s.borderWidth||0,s.hoverBorderWidth||0));return o}getMaxOffset(i){let o=0;for(let c=0,h=i.length;c<h;++c){const m=this.resolveDataElementOptions(c);o=Math.max(o,m.offset||0,m.hoverOffset||0)}return o}_getRingWeightOffset(i){let o=0;for(let c=0;c<i;++c)this.chart.isDatasetVisible(c)&&(o+=this._getRingWeight(c));return o}_getRingWeight(i){return Math.max(bn(this.chart.data.datasets[i].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}bi(Th,"id","doughnut"),bi(Th,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),bi(Th,"descriptors",{_scriptable:i=>i!=="spacing",_indexable:i=>i!=="spacing"&&!i.startsWith("borderDash")&&!i.startsWith("hoverBorderDash")}),bi(Th,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(i){const o=i.data;if(o.labels.length&&o.datasets.length){const{labels:{pointStyle:c,color:h}}=i.legend.options;return o.labels.map((m,_)=>{const s=i.getDatasetMeta(0).controller.getStyle(_);return{text:m,fillStyle:s.backgroundColor,strokeStyle:s.borderColor,fontColor:h,lineWidth:s.borderWidth,pointStyle:c,hidden:!i.getDataVisibility(_),index:_}})}return[]}},onClick(i,o,c){c.chart.toggleDataVisibility(o.index),c.chart.update()}}}});class T_ extends Xa{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(i){const o=this._cachedMeta,{dataset:c,data:h=[],_dataset:m}=o,_=this.chart._animationsDisabled;let{start:x,count:s}=SP(o,h,_);this._drawStart=x,this._drawCount=s,MP(o)&&(x=0,s=h.length),c._chart=this.chart,c._datasetIndex=this.index,c._decimated=!!m._decimated,c.points=h;const M=this.resolveDatasetElementOptions(i);this.options.showLine||(M.borderWidth=0),M.segment=this.options.segment,this.updateElement(c,void 0,{animated:!_,options:M},i),this.updateElements(h,x,s,i)}updateElements(i,o,c,h){const m=h==="reset",{iScale:_,vScale:x,_stacked:s,_dataset:M}=this._cachedMeta,{sharedOptions:P,includeOptions:L}=this._getSharedOptions(o,h),F=_.axis,V=x.axis,{spanGaps:X,segment:q}=this.options,Y=Wd(X)?X:Number.POSITIVE_INFINITY,J=this.chart._animationsDisabled||m||h==="none",ue=o+c,ce=i.length;let fe=o>0&&this.getParsed(o-1);for(let Ae=0;Ae<ce;++Ae){const Ce=i[Ae],He=J?Ce:{};if(Ae<o||Ae>=ue){He.skip=!0;continue}const We=this.getParsed(Ae),nt=Jn(We[V]),we=He[F]=_.getPixelForValue(We[F],Ae),ht=He[V]=m||nt?x.getBasePixel():x.getPixelForValue(s?this.applyStack(x,We,s):We[V],Ae);He.skip=isNaN(we)||isNaN(ht)||nt,He.stop=Ae>0&&Math.abs(We[F]-fe[F])>Y,q&&(He.parsed=We,He.raw=M.data[Ae]),L&&(He.options=P||this.resolveDataElementOptions(Ae,Ce.active?"active":h)),J||this.updateElement(Ce,Ae,He,h),fe=We}}getMaxOverflow(){const i=this._cachedMeta,o=i.dataset,c=o.options&&o.options.borderWidth||0,h=i.data||[];if(!h.length)return c;const m=h[0].size(this.resolveDataElementOptions(0)),_=h[h.length-1].size(this.resolveDataElementOptions(h.length-1));return Math.max(c,m,_)/2}draw(){const i=this._cachedMeta;i.dataset.updateControlPoints(this.chart.chartArea,i.iScale.axis),super.draw()}}bi(T_,"id","line"),bi(T_,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),bi(T_,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class Gp extends Xa{constructor(i,o){super(i,o),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(i){const o=this._cachedMeta,c=this.chart,h=c.data.labels||[],m=hm(o._parsed[i].r,c.options.locale);return{label:h[i]||"",value:m}}parseObjectData(i,o,c,h){return LP.bind(this)(i,o,c,h)}update(i){const o=this._cachedMeta.data;this._updateRadius(),this.updateElements(o,0,o.length,i)}getMinMax(){const i=this._cachedMeta,o={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return i.data.forEach((c,h)=>{const m=this.getParsed(h).r;!isNaN(m)&&this.chart.getDataVisibility(h)&&(m<o.min&&(o.min=m),m>o.max&&(o.max=m))}),o}_updateRadius(){const i=this.chart,o=i.chartArea,c=i.options,h=Math.min(o.right-o.left,o.bottom-o.top),m=Math.max(h/2,0),_=Math.max(c.cutoutPercentage?m/100*c.cutoutPercentage:1,0),x=(m-_)/i.getVisibleDatasetCount();this.outerRadius=m-x*this.index,this.innerRadius=this.outerRadius-x}updateElements(i,o,c,h){const m=h==="reset",_=this.chart,s=_.options.animation,M=this._cachedMeta.rScale,P=M.xCenter,L=M.yCenter,F=M.getIndexAngle(0)-.5*zr;let V=F,X;const q=360/this.countVisibleElements();for(X=0;X<o;++X)V+=this._computeAngle(X,h,q);for(X=o;X<o+c;X++){const Y=i[X];let J=V,ue=V+this._computeAngle(X,h,q),ce=_.getDataVisibility(X)?M.getDistanceFromCenterForValue(this.getParsed(X).r):0;V=ue,m&&(s.animateScale&&(ce=0),s.animateRotate&&(J=ue=F));const fe={x:P,y:L,innerRadius:0,outerRadius:ce,startAngle:J,endAngle:ue,options:this.resolveDataElementOptions(X,Y.active?"active":h)};this.updateElement(Y,X,fe,h)}}countVisibleElements(){const i=this._cachedMeta;let o=0;return i.data.forEach((c,h)=>{!isNaN(this.getParsed(h).r)&&this.chart.getDataVisibility(h)&&o++}),o}_computeAngle(i,o,c){return this.chart.getDataVisibility(i)?Za(this.resolveDataElementOptions(i,o).angle||c):0}}bi(Gp,"id","polarArea"),bi(Gp,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),bi(Gp,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(i){const o=i.data;if(o.labels.length&&o.datasets.length){const{labels:{pointStyle:c,color:h}}=i.legend.options;return o.labels.map((m,_)=>{const s=i.getDatasetMeta(0).controller.getStyle(_);return{text:m,fillStyle:s.backgroundColor,strokeStyle:s.borderColor,fontColor:h,lineWidth:s.borderWidth,pointStyle:c,hidden:!i.getDataVisibility(_),index:_}})}return[]}},onClick(i,o,c){c.chart.toggleDataVisibility(o.index),c.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class Fx extends Th{}bi(Fx,"id","pie"),bi(Fx,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class S_ extends Xa{getLabelAndValue(i){const o=this._cachedMeta.vScale,c=this.getParsed(i);return{label:o.getLabels()[i],value:""+o.getLabelForValue(c[o.axis])}}parseObjectData(i,o,c,h){return LP.bind(this)(i,o,c,h)}update(i){const o=this._cachedMeta,c=o.dataset,h=o.data||[],m=o.iScale.getLabels();if(c.points=h,i!=="resize"){const _=this.resolveDatasetElementOptions(i);this.options.showLine||(_.borderWidth=0);const x={_loop:!0,_fullLoop:m.length===h.length,options:_};this.updateElement(c,void 0,x,i)}this.updateElements(h,0,h.length,i)}updateElements(i,o,c,h){const m=this._cachedMeta.rScale,_=h==="reset";for(let x=o;x<o+c;x++){const s=i[x],M=this.resolveDataElementOptions(x,s.active?"active":h),P=m.getPointPositionForValue(x,this.getParsed(x).r),L=_?m.xCenter:P.x,F=_?m.yCenter:P.y,V={x:L,y:F,angle:P.angle,skip:isNaN(L)||isNaN(F),options:M};this.updateElement(s,x,V,h)}}}bi(S_,"id","radar"),bi(S_,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),bi(S_,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class M_ extends Xa{getLabelAndValue(i){const o=this._cachedMeta,c=this.chart.data.labels||[],{xScale:h,yScale:m}=o,_=this.getParsed(i),x=h.getLabelForValue(_.x),s=m.getLabelForValue(_.y);return{label:c[i]||"",value:"("+x+", "+s+")"}}update(i){const o=this._cachedMeta,{data:c=[]}=o,h=this.chart._animationsDisabled;let{start:m,count:_}=SP(o,c,h);if(this._drawStart=m,this._drawCount=_,MP(o)&&(m=0,_=c.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:x,_dataset:s}=o;x._chart=this.chart,x._datasetIndex=this.index,x._decimated=!!s._decimated,x.points=c;const M=this.resolveDatasetElementOptions(i);M.segment=this.options.segment,this.updateElement(x,void 0,{animated:!h,options:M},i)}else this.datasetElementType&&(delete o.dataset,this.datasetElementType=!1);this.updateElements(c,m,_,i)}addElements(){const{showLine:i}=this.options;!this.datasetElementType&&i&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(i,o,c,h){const m=h==="reset",{iScale:_,vScale:x,_stacked:s,_dataset:M}=this._cachedMeta,P=this.resolveDataElementOptions(o,h),L=this.getSharedOptions(P),F=this.includeOptions(h,L),V=_.axis,X=x.axis,{spanGaps:q,segment:Y}=this.options,J=Wd(q)?q:Number.POSITIVE_INFINITY,ue=this.chart._animationsDisabled||m||h==="none";let ce=o>0&&this.getParsed(o-1);for(let fe=o;fe<o+c;++fe){const Ae=i[fe],Ce=this.getParsed(fe),He=ue?Ae:{},We=Jn(Ce[X]),nt=He[V]=_.getPixelForValue(Ce[V],fe),we=He[X]=m||We?x.getBasePixel():x.getPixelForValue(s?this.applyStack(x,Ce,s):Ce[X],fe);He.skip=isNaN(nt)||isNaN(we)||We,He.stop=fe>0&&Math.abs(Ce[V]-ce[V])>J,Y&&(He.parsed=Ce,He.raw=M.data[fe]),F&&(He.options=L||this.resolveDataElementOptions(fe,Ae.active?"active":h)),ue||this.updateElement(Ae,fe,He,h),ce=Ce}this.updateSharedOptions(L,h,P)}getMaxOverflow(){const i=this._cachedMeta,o=i.data||[];if(!this.options.showLine){let x=0;for(let s=o.length-1;s>=0;--s)x=Math.max(x,o[s].size(this.resolveDataElementOptions(s))/2);return x>0&&x}const c=i.dataset,h=c.options&&c.options.borderWidth||0;if(!o.length)return h;const m=o[0].size(this.resolveDataElementOptions(0)),_=o[o.length-1].size(this.resolveDataElementOptions(o.length-1));return Math.max(h,m,_)/2}}bi(M_,"id","scatter"),bi(M_,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),bi(M_,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var UB=Object.freeze({__proto__:null,BarController:b_,BubbleController:w_,DoughnutController:Th,LineController:T_,PieController:Fx,PolarAreaController:Gp,RadarController:S_,ScatterController:M_});function ph(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Hb{constructor(i){bi(this,"options");this.options=i||{}}static override(i){Object.assign(Hb.prototype,i)}init(){}formats(){return ph()}parse(){return ph()}format(){return ph()}add(){return ph()}diff(){return ph()}startOf(){return ph()}endOf(){return ph()}}var jB={_date:Hb};function GB(r,i,o,c){const{controller:h,data:m,_sorted:_}=r,x=h._cachedMeta.iScale;if(x&&i===x.axis&&i!=="r"&&_&&m.length){const s=x._reversePixels?d5:bc;if(c){if(h._sharedOptions){const M=m[0],P=typeof M.getRange=="function"&&M.getRange(i);if(P){const L=s(m,i,o-P),F=s(m,i,o+P);return{lo:L.lo,hi:F.hi}}}}else return s(m,i,o)}return{lo:0,hi:m.length-1}}function dm(r,i,o,c,h){const m=r.getSortedVisibleDatasetMetas(),_=o[i];for(let x=0,s=m.length;x<s;++x){const{index:M,data:P}=m[x],{lo:L,hi:F}=GB(m[x],i,_,h);for(let V=L;V<=F;++V){const X=P[V];X.skip||c(X,M,V)}}}function HB(r){const i=r.indexOf("x")!==-1,o=r.indexOf("y")!==-1;return function(c,h){const m=i?Math.abs(c.x-h.x):0,_=o?Math.abs(c.y-h.y):0;return Math.sqrt(Math.pow(m,2)+Math.pow(_,2))}}function nx(r,i,o,c,h){const m=[];return!h&&!r.isPointInArea(i)||dm(r,o,i,function(x,s,M){!h&&!wc(x,r.chartArea,0)||x.inRange(i.x,i.y,c)&&m.push({element:x,datasetIndex:s,index:M})},!0),m}function qB(r,i,o,c){let h=[];function m(_,x,s){const{startAngle:M,endAngle:P}=_.getProps(["startAngle","endAngle"],c),{angle:L}=vP(_,{x:i.x,y:i.y});Xp(L,M,P)&&h.push({element:_,datasetIndex:x,index:s})}return dm(r,o,i,m),h}function WB(r,i,o,c,h,m){let _=[];const x=HB(o);let s=Number.POSITIVE_INFINITY;function M(P,L,F){const V=P.inRange(i.x,i.y,h);if(c&&!V)return;const X=P.getCenterPoint(h);if(!(!!m||r.isPointInArea(X))&&!V)return;const Y=x(i,X);Y<s?(_=[{element:P,datasetIndex:L,index:F}],s=Y):Y===s&&_.push({element:P,datasetIndex:L,index:F})}return dm(r,o,i,M),_}function rx(r,i,o,c,h,m){return!m&&!r.isPointInArea(i)?[]:o==="r"&&!c?qB(r,i,o,h):WB(r,i,o,c,h,m)}function XE(r,i,o,c,h){const m=[],_=o==="x"?"inXRange":"inYRange";let x=!1;return dm(r,o,i,(s,M,P)=>{s[_](i[o],h)&&(m.push({element:s,datasetIndex:M,index:P}),x=x||s.inRange(i.x,i.y,h))}),c&&!x?[]:m}var ZB={evaluateInteractionItems:dm,modes:{index(r,i,o,c){const h=_h(i,r),m=o.axis||"x",_=o.includeInvisible||!1,x=o.intersect?nx(r,h,m,c,_):rx(r,h,m,!1,c,_),s=[];return x.length?(r.getSortedVisibleDatasetMetas().forEach(M=>{const P=x[0].index,L=M.data[P];L&&!L.skip&&s.push({element:L,datasetIndex:M.index,index:P})}),s):[]},dataset(r,i,o,c){const h=_h(i,r),m=o.axis||"xy",_=o.includeInvisible||!1;let x=o.intersect?nx(r,h,m,c,_):rx(r,h,m,!1,c,_);if(x.length>0){const s=x[0].datasetIndex,M=r.getDatasetMeta(s).data;x=[];for(let P=0;P<M.length;++P)x.push({element:M[P],datasetIndex:s,index:P})}return x},point(r,i,o,c){const h=_h(i,r),m=o.axis||"xy",_=o.includeInvisible||!1;return nx(r,h,m,c,_)},nearest(r,i,o,c){const h=_h(i,r),m=o.axis||"xy",_=o.includeInvisible||!1;return rx(r,h,m,o.intersect,c,_)},x(r,i,o,c){const h=_h(i,r);return XE(r,h,"x",o.intersect,c)},y(r,i,o,c){const h=_h(i,r);return XE(r,h,"y",o.intersect,c)}}};const GP=["left","top","right","bottom"];function _p(r,i){return r.filter(o=>o.pos===i)}function YE(r,i){return r.filter(o=>GP.indexOf(o.pos)===-1&&o.box.axis===i)}function yp(r,i){return r.sort((o,c)=>{const h=i?c:o,m=i?o:c;return h.weight===m.weight?h.index-m.index:h.weight-m.weight})}function XB(r){const i=[];let o,c,h,m,_,x;for(o=0,c=(r||[]).length;o<c;++o)h=r[o],{position:m,options:{stack:_,stackWeight:x=1}}=h,i.push({index:o,box:h,pos:m,horizontal:h.isHorizontal(),weight:h.weight,stack:_&&m+_,stackWeight:x});return i}function YB(r){const i={};for(const o of r){const{stack:c,pos:h,stackWeight:m}=o;if(!c||!GP.includes(h))continue;const _=i[c]||(i[c]={count:0,placed:0,weight:0,size:0});_.count++,_.weight+=m}return i}function JB(r,i){const o=YB(r),{vBoxMaxWidth:c,hBoxMaxHeight:h}=i;let m,_,x;for(m=0,_=r.length;m<_;++m){x=r[m];const{fullSize:s}=x.box,M=o[x.stack],P=M&&x.stackWeight/M.weight;x.horizontal?(x.width=P?P*c:s&&i.availableWidth,x.height=h):(x.width=c,x.height=P?P*h:s&&i.availableHeight)}return o}function KB(r){const i=XB(r),o=yp(i.filter(M=>M.box.fullSize),!0),c=yp(_p(i,"left"),!0),h=yp(_p(i,"right")),m=yp(_p(i,"top"),!0),_=yp(_p(i,"bottom")),x=YE(i,"x"),s=YE(i,"y");return{fullSize:o,leftAndTop:c.concat(m),rightAndBottom:h.concat(s).concat(_).concat(x),chartArea:_p(i,"chartArea"),vertical:c.concat(h).concat(s),horizontal:m.concat(_).concat(x)}}function JE(r,i,o,c){return Math.max(r[o],i[o])+Math.max(r[c],i[c])}function HP(r,i){r.top=Math.max(r.top,i.top),r.left=Math.max(r.left,i.left),r.bottom=Math.max(r.bottom,i.bottom),r.right=Math.max(r.right,i.right)}function $B(r,i,o,c){const{pos:h,box:m}=o,_=r.maxPadding;if(!zn(h)){o.size&&(r[h]-=o.size);const L=c[o.stack]||{size:0,count:1};L.size=Math.max(L.size,o.horizontal?m.height:m.width),o.size=L.size/L.count,r[h]+=o.size}m.getPadding&&HP(_,m.getPadding());const x=Math.max(0,i.outerWidth-JE(_,r,"left","right")),s=Math.max(0,i.outerHeight-JE(_,r,"top","bottom")),M=x!==r.w,P=s!==r.h;return r.w=x,r.h=s,o.horizontal?{same:M,other:P}:{same:P,other:M}}function QB(r){const i=r.maxPadding;function o(c){const h=Math.max(i[c]-r[c],0);return r[c]+=h,h}r.y+=o("top"),r.x+=o("left"),o("right"),o("bottom")}function eN(r,i){const o=i.maxPadding;function c(h){const m={left:0,top:0,right:0,bottom:0};return h.forEach(_=>{m[_]=Math.max(i[_],o[_])}),m}return c(r?["left","right"]:["top","bottom"])}function Ap(r,i,o,c){const h=[];let m,_,x,s,M,P;for(m=0,_=r.length,M=0;m<_;++m){x=r[m],s=x.box,s.update(x.width||i.w,x.height||i.h,eN(x.horizontal,i));const{same:L,other:F}=$B(i,o,x,c);M|=L&&h.length,P=P||F,s.fullSize||h.push(x)}return M&&Ap(h,i,o,c)||P}function t_(r,i,o,c,h){r.top=o,r.left=i,r.right=i+c,r.bottom=o+h,r.width=c,r.height=h}function KE(r,i,o,c){const h=o.padding;let{x:m,y:_}=i;for(const x of r){const s=x.box,M=c[x.stack]||{count:1,placed:0,weight:1},P=x.stackWeight/M.weight||1;if(x.horizontal){const L=i.w*P,F=M.size||s.height;Zp(M.start)&&(_=M.start),s.fullSize?t_(s,h.left,_,o.outerWidth-h.right-h.left,F):t_(s,i.left+M.placed,_,L,F),M.start=_,M.placed+=L,_=s.bottom}else{const L=i.h*P,F=M.size||s.width;Zp(M.start)&&(m=M.start),s.fullSize?t_(s,m,h.top,F,o.outerHeight-h.bottom-h.top):t_(s,m,i.top+M.placed,F,L),M.start=m,M.placed+=L,m=s.right}}i.x=m,i.y=_}var ts={addBox(r,i){r.boxes||(r.boxes=[]),i.fullSize=i.fullSize||!1,i.position=i.position||"top",i.weight=i.weight||0,i._layers=i._layers||function(){return[{z:0,draw(o){i.draw(o)}}]},r.boxes.push(i)},removeBox(r,i){const o=r.boxes?r.boxes.indexOf(i):-1;o!==-1&&r.boxes.splice(o,1)},configure(r,i,o){i.fullSize=o.fullSize,i.position=o.position,i.weight=o.weight},update(r,i,o,c){if(!r)return;const h=ns(r.options.layout.padding),m=Math.max(i-h.width,0),_=Math.max(o-h.height,0),x=KB(r.boxes),s=x.vertical,M=x.horizontal;gr(r.boxes,q=>{typeof q.beforeLayout=="function"&&q.beforeLayout()});const P=s.reduce((q,Y)=>Y.box.options&&Y.box.options.display===!1?q:q+1,0)||1,L=Object.freeze({outerWidth:i,outerHeight:o,padding:h,availableWidth:m,availableHeight:_,vBoxMaxWidth:m/2/P,hBoxMaxHeight:_/2}),F=Object.assign({},h);HP(F,ns(c));const V=Object.assign({maxPadding:F,w:m,h:_,x:h.left,y:h.top},h),X=JB(s.concat(M),L);Ap(x.fullSize,V,L,X),Ap(s,V,L,X),Ap(M,V,L,X)&&Ap(s,V,L,X),QB(V),KE(x.leftAndTop,V,L,X),V.x+=V.w,V.y+=V.h,KE(x.rightAndBottom,V,L,X),r.chartArea={left:V.left,top:V.top,right:V.left+V.w,bottom:V.top+V.h,height:V.h,width:V.w},gr(x.chartArea,q=>{const Y=q.box;Object.assign(Y,r.chartArea),Y.update(V.w,V.h,{left:0,top:0,right:0,bottom:0})})}};class qP{acquireContext(i,o){}releaseContext(i){return!1}addEventListener(i,o,c){}removeEventListener(i,o,c){}getDevicePixelRatio(){return 1}getMaximumSize(i,o,c,h){return o=Math.max(0,o||i.width),c=c||i.height,{width:o,height:Math.max(0,h?Math.floor(o/h):c)}}isAttached(i){return!0}updateConfig(i){}}class tN extends qP{acquireContext(i){return i&&i.getContext&&i.getContext("2d")||null}updateConfig(i){i.options.animation=!1}}const E_="$chartjs",iN={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},$E=r=>r===null||r==="";function nN(r,i){const o=r.style,c=r.getAttribute("height"),h=r.getAttribute("width");if(r[E_]={initial:{height:c,width:h,style:{display:o.display,height:o.height,width:o.width}}},o.display=o.display||"block",o.boxSizing=o.boxSizing||"border-box",$E(h)){const m=OE(r,"width");m!==void 0&&(r.width=m)}if($E(c))if(r.style.height==="")r.height=r.width/(i||2);else{const m=OE(r,"height");m!==void 0&&(r.height=m)}return r}const WP=oB?{passive:!0}:!1;function rN(r,i,o){r&&r.addEventListener(i,o,WP)}function oN(r,i,o){r&&r.canvas&&r.canvas.removeEventListener(i,o,WP)}function sN(r,i){const o=iN[r.type]||r.type,{x:c,y:h}=_h(r,i);return{type:o,chart:i,native:r,x:c!==void 0?c:null,y:h!==void 0?h:null}}function K_(r,i){for(const o of r)if(o===i||o.contains(i))return!0}function aN(r,i,o){const c=r.canvas,h=new MutationObserver(m=>{let _=!1;for(const x of m)_=_||K_(x.addedNodes,c),_=_&&!K_(x.removedNodes,c);_&&o()});return h.observe(document,{childList:!0,subtree:!0}),h}function lN(r,i,o){const c=r.canvas,h=new MutationObserver(m=>{let _=!1;for(const x of m)_=_||K_(x.removedNodes,c),_=_&&!K_(x.addedNodes,c);_&&o()});return h.observe(document,{childList:!0,subtree:!0}),h}const Jp=new Map;let QE=0;function ZP(){const r=window.devicePixelRatio;r!==QE&&(QE=r,Jp.forEach((i,o)=>{o.currentDevicePixelRatio!==r&&i()}))}function cN(r,i){Jp.size||window.addEventListener("resize",ZP),Jp.set(r,i)}function uN(r){Jp.delete(r),Jp.size||window.removeEventListener("resize",ZP)}function hN(r,i,o){const c=r.canvas,h=c&&Gb(c);if(!h)return;const m=TP((x,s)=>{const M=h.clientWidth;o(x,s),M<h.clientWidth&&o()},window),_=new ResizeObserver(x=>{const s=x[0],M=s.contentRect.width,P=s.contentRect.height;M===0&&P===0||m(M,P)});return _.observe(h),cN(r,m),_}function ox(r,i,o){o&&o.disconnect(),i==="resize"&&uN(r)}function dN(r,i,o){const c=r.canvas,h=TP(m=>{r.ctx!==null&&o(sN(m,r))},r);return rN(c,i,h),h}class fN extends qP{acquireContext(i,o){const c=i&&i.getContext&&i.getContext("2d");return c&&c.canvas===i?(nN(i,o),c):null}releaseContext(i){const o=i.canvas;if(!o[E_])return!1;const c=o[E_].initial;["height","width"].forEach(m=>{const _=c[m];Jn(_)?o.removeAttribute(m):o.setAttribute(m,_)});const h=c.style||{};return Object.keys(h).forEach(m=>{o.style[m]=h[m]}),o.width=o.width,delete o[E_],!0}addEventListener(i,o,c){this.removeEventListener(i,o);const h=i.$proxies||(i.$proxies={}),_={attach:aN,detach:lN,resize:hN}[o]||dN;h[o]=_(i,o,c)}removeEventListener(i,o){const c=i.$proxies||(i.$proxies={}),h=c[o];if(!h)return;({attach:ox,detach:ox,resize:ox}[o]||oN)(i,o,h),c[o]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(i,o,c,h){return rB(i,o,c,h)}isAttached(i){const o=Gb(i);return!!(o&&o.isConnected)}}function pN(r){return!jb()||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas?tN:fN}class Ya{constructor(){bi(this,"x");bi(this,"y");bi(this,"active",!1);bi(this,"options");bi(this,"$animations")}tooltipPosition(i){const{x:o,y:c}=this.getProps(["x","y"],i);return{x:o,y:c}}hasValue(){return Wd(this.x)&&Wd(this.y)}getProps(i,o){const c=this.$animations;if(!o||!c)return this;const h={};return i.forEach(m=>{h[m]=c[m]&&c[m].active()?c[m]._to:this[m]}),h}}bi(Ya,"defaults",{}),bi(Ya,"defaultRoutes");function mN(r,i){const o=r.options.ticks,c=gN(r),h=Math.min(o.maxTicksLimit||c,c),m=o.major.enabled?yN(i):[],_=m.length,x=m[0],s=m[_-1],M=[];if(_>h)return vN(i,M,m,_/h),M;const P=_N(m,i,h);if(_>0){let L,F;const V=_>1?Math.round((s-x)/(_-1)):null;for(i_(i,M,P,Jn(V)?0:x-V,x),L=0,F=_-1;L<F;L++)i_(i,M,P,m[L],m[L+1]);return i_(i,M,P,s,Jn(V)?i.length:s+V),M}return i_(i,M,P),M}function gN(r){const i=r.options.offset,o=r._tickSize(),c=r._length/o+(i?0:1),h=r._maxLength/o;return Math.floor(Math.min(c,h))}function _N(r,i,o){const c=xN(r),h=i.length/o;if(!c)return Math.max(h,1);const m=l5(c);for(let _=0,x=m.length-1;_<x;_++){const s=m[_];if(s>h)return s}return Math.max(h,1)}function yN(r){const i=[];let o,c;for(o=0,c=r.length;o<c;o++)r[o].major&&i.push(o);return i}function vN(r,i,o,c){let h=0,m=o[0],_;for(c=Math.ceil(c),_=0;_<r.length;_++)_===m&&(i.push(r[_]),h++,m=o[h*c])}function i_(r,i,o,c,h){const m=bn(c,0),_=Math.min(bn(h,r.length),r.length);let x=0,s,M,P;for(o=Math.ceil(o),h&&(s=h-c,o=s/Math.floor(s/o)),P=m;P<0;)x++,P=Math.round(m+x*o);for(M=Math.max(m,0);M<_;M++)M===P&&(i.push(r[M]),x++,P=Math.round(m+x*o))}function xN(r){const i=r.length;let o,c;if(i<2)return!1;for(c=r[0],o=1;o<i;++o)if(r[o]-r[o-1]!==c)return!1;return c}const bN=r=>r==="left"?"right":r==="right"?"left":r,eA=(r,i,o)=>i==="top"||i==="left"?r[i]+o:r[i]-o,tA=(r,i)=>Math.min(i||r,r);function iA(r,i){const o=[],c=r.length/i,h=r.length;let m=0;for(;m<h;m+=c)o.push(r[Math.floor(m)]);return o}function wN(r,i,o){const c=r.ticks.length,h=Math.min(i,c-1),m=r._startPixel,_=r._endPixel,x=1e-6;let s=r.getPixelForTick(h),M;if(!(o&&(c===1?M=Math.max(s-m,_-s):i===0?M=(r.getPixelForTick(1)-s)/2:M=(s-r.getPixelForTick(h-1))/2,s+=h<i?M:-M,s<m-x||s>_+x)))return s}function TN(r,i){gr(r,o=>{const c=o.gc,h=c.length/2;let m;if(h>i){for(m=0;m<h;++m)delete o.data[c[m]];c.splice(0,h)}})}function vp(r){return r.drawTicks?r.tickLength:0}function nA(r,i){if(!r.display)return 0;const o=So(r.font,i),c=ns(r.padding);return(Or(r.text)?r.text.length:1)*o.lineHeight+c.height}function SN(r,i){return gu(r,{scale:i,type:"scale"})}function MN(r,i,o){return gu(r,{tick:o,index:i,type:"tick"})}function EN(r,i,o){let c=zb(r);return(o&&i!=="right"||!o&&i==="right")&&(c=bN(c)),c}function AN(r,i,o,c){const{top:h,left:m,bottom:_,right:x,chart:s}=r,{chartArea:M,scales:P}=s;let L=0,F,V,X;const q=_-h,Y=x-m;if(r.isHorizontal()){if(V=es(c,m,x),zn(o)){const J=Object.keys(o)[0],ue=o[J];X=P[J].getPixelForValue(ue)+q-i}else o==="center"?X=(M.bottom+M.top)/2+q-i:X=eA(r,o,i);F=x-m}else{if(zn(o)){const J=Object.keys(o)[0],ue=o[J];V=P[J].getPixelForValue(ue)-Y+i}else o==="center"?V=(M.left+M.right)/2-Y+i:V=eA(r,o,i);X=es(c,_,h),L=o==="left"?-co:co}return{titleX:V,titleY:X,maxWidth:F,rotation:L}}class Vh extends Ya{constructor(i){super(),this.id=i.id,this.type=i.type,this.options=void 0,this.ctx=i.ctx,this.chart=i.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(i){this.options=i.setContext(this.getContext()),this.axis=i.axis,this._userMin=this.parse(i.min),this._userMax=this.parse(i.max),this._suggestedMin=this.parse(i.suggestedMin),this._suggestedMax=this.parse(i.suggestedMax)}parse(i,o){return i}getUserBounds(){let{_userMin:i,_userMax:o,_suggestedMin:c,_suggestedMax:h}=this;return i=$s(i,Number.POSITIVE_INFINITY),o=$s(o,Number.NEGATIVE_INFINITY),c=$s(c,Number.POSITIVE_INFINITY),h=$s(h,Number.NEGATIVE_INFINITY),{min:$s(i,c),max:$s(o,h),minDefined:Xr(i),maxDefined:Xr(o)}}getMinMax(i){let{min:o,max:c,minDefined:h,maxDefined:m}=this.getUserBounds(),_;if(h&&m)return{min:o,max:c};const x=this.getMatchingVisibleMetas();for(let s=0,M=x.length;s<M;++s)_=x[s].controller.getMinMax(this,i),h||(o=Math.min(o,_.min)),m||(c=Math.max(c,_.max));return o=m&&o>c?c:o,c=h&&o>c?o:c,{min:$s(o,$s(c,o)),max:$s(c,$s(o,c))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const i=this.chart.data;return this.options.labels||(this.isHorizontal()?i.xLabels:i.yLabels)||i.labels||[]}getLabelItems(i=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(i))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Ir(this.options.beforeUpdate,[this])}update(i,o,c){const{beginAtZero:h,grace:m,ticks:_}=this.options,x=_.sampleSize;this.beforeUpdate(),this.maxWidth=i,this.maxHeight=o,this._margins=c=Object.assign({left:0,right:0,top:0,bottom:0},c),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+c.left+c.right:this.height+c.top+c.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=z5(this,m,h),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const s=x<this.ticks.length;this._convertTicksToLabels(s?iA(this.ticks,x):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),_.display&&(_.autoSkip||_.source==="auto")&&(this.ticks=mN(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),s&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let i=this.options.reverse,o,c;this.isHorizontal()?(o=this.left,c=this.right):(o=this.top,c=this.bottom,i=!i),this._startPixel=o,this._endPixel=c,this._reversePixels=i,this._length=c-o,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Ir(this.options.afterUpdate,[this])}beforeSetDimensions(){Ir(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Ir(this.options.afterSetDimensions,[this])}_callHooks(i){this.chart.notifyPlugins(i,this.getContext()),Ir(this.options[i],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Ir(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(i){const o=this.options.ticks;let c,h,m;for(c=0,h=i.length;c<h;c++)m=i[c],m.label=Ir(o.callback,[m.value,c,i],this)}afterTickToLabelConversion(){Ir(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Ir(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const i=this.options,o=i.ticks,c=tA(this.ticks.length,i.ticks.maxTicksLimit),h=o.minRotation||0,m=o.maxRotation;let _=h,x,s,M;if(!this._isVisible()||!o.display||h>=m||c<=1||!this.isHorizontal()){this.labelRotation=h;return}const P=this._getLabelSizes(),L=P.widest.width,F=P.highest.height,V=Do(this.chart.width-L,0,this.maxWidth);x=i.offset?this.maxWidth/c:V/(c-1),L+6>x&&(x=V/(c-(i.offset?.5:1)),s=this.maxHeight-vp(i.grid)-o.padding-nA(i.title,this.chart.options.font),M=Math.sqrt(L*L+F*F),_=Ob(Math.min(Math.asin(Do((P.highest.height+6)/x,-1,1)),Math.asin(Do(s/M,-1,1))-Math.asin(Do(F/M,-1,1)))),_=Math.max(h,Math.min(m,_))),this.labelRotation=_}afterCalculateLabelRotation(){Ir(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Ir(this.options.beforeFit,[this])}fit(){const i={width:0,height:0},{chart:o,options:{ticks:c,title:h,grid:m}}=this,_=this._isVisible(),x=this.isHorizontal();if(_){const s=nA(h,o.options.font);if(x?(i.width=this.maxWidth,i.height=vp(m)+s):(i.height=this.maxHeight,i.width=vp(m)+s),c.display&&this.ticks.length){const{first:M,last:P,widest:L,highest:F}=this._getLabelSizes(),V=c.padding*2,X=Za(this.labelRotation),q=Math.cos(X),Y=Math.sin(X);if(x){const J=c.mirror?0:Y*L.width+q*F.height;i.height=Math.min(this.maxHeight,i.height+J+V)}else{const J=c.mirror?0:q*L.width+Y*F.height;i.width=Math.min(this.maxWidth,i.width+J+V)}this._calculatePadding(M,P,Y,q)}}this._handleMargins(),x?(this.width=this._length=o.width-this._margins.left-this._margins.right,this.height=i.height):(this.width=i.width,this.height=this._length=o.height-this._margins.top-this._margins.bottom)}_calculatePadding(i,o,c,h){const{ticks:{align:m,padding:_},position:x}=this.options,s=this.labelRotation!==0,M=x!=="top"&&this.axis==="x";if(this.isHorizontal()){const P=this.getPixelForTick(0)-this.left,L=this.right-this.getPixelForTick(this.ticks.length-1);let F=0,V=0;s?M?(F=h*i.width,V=c*o.height):(F=c*i.height,V=h*o.width):m==="start"?V=o.width:m==="end"?F=i.width:m!=="inner"&&(F=i.width/2,V=o.width/2),this.paddingLeft=Math.max((F-P+_)*this.width/(this.width-P),0),this.paddingRight=Math.max((V-L+_)*this.width/(this.width-L),0)}else{let P=o.height/2,L=i.height/2;m==="start"?(P=0,L=i.height):m==="end"&&(P=o.height,L=0),this.paddingTop=P+_,this.paddingBottom=L+_}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Ir(this.options.afterFit,[this])}isHorizontal(){const{axis:i,position:o}=this.options;return o==="top"||o==="bottom"||i==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(i){this.beforeTickToLabelConversion(),this.generateTickLabels(i);let o,c;for(o=0,c=i.length;o<c;o++)Jn(i[o].label)&&(i.splice(o,1),c--,o--);this.afterTickToLabelConversion()}_getLabelSizes(){let i=this._labelSizes;if(!i){const o=this.options.ticks.sampleSize;let c=this.ticks;o<c.length&&(c=iA(c,o)),this._labelSizes=i=this._computeLabelSizes(c,c.length,this.options.ticks.maxTicksLimit)}return i}_computeLabelSizes(i,o,c){const{ctx:h,_longestTextCache:m}=this,_=[],x=[],s=Math.floor(o/tA(o,c));let M=0,P=0,L,F,V,X,q,Y,J,ue,ce,fe,Ae;for(L=0;L<o;L+=s){if(X=i[L].label,q=this._resolveTickFontOptions(L),h.font=Y=q.string,J=m[Y]=m[Y]||{data:{},gc:[]},ue=q.lineHeight,ce=fe=0,!Jn(X)&&!Or(X))ce=Y_(h,J.data,J.gc,ce,X),fe=ue;else if(Or(X))for(F=0,V=X.length;F<V;++F)Ae=X[F],!Jn(Ae)&&!Or(Ae)&&(ce=Y_(h,J.data,J.gc,ce,Ae),fe+=ue);_.push(ce),x.push(fe),M=Math.max(ce,M),P=Math.max(fe,P)}TN(m,o);const Ce=_.indexOf(M),He=x.indexOf(P),We=nt=>({width:_[nt]||0,height:x[nt]||0});return{first:We(0),last:We(o-1),widest:We(Ce),highest:We(He),widths:_,heights:x}}getLabelForValue(i){return i}getPixelForValue(i,o){return NaN}getValueForPixel(i){}getPixelForTick(i){const o=this.ticks;return i<0||i>o.length-1?null:this.getPixelForValue(o[i].value)}getPixelForDecimal(i){this._reversePixels&&(i=1-i);const o=this._startPixel+i*this._length;return h5(this._alignToPixels?fh(this.chart,o,0):o)}getDecimalForPixel(i){const o=(i-this._startPixel)/this._length;return this._reversePixels?1-o:o}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:i,max:o}=this;return i<0&&o<0?o:i>0&&o>0?i:0}getContext(i){const o=this.ticks||[];if(i>=0&&i<o.length){const c=o[i];return c.$context||(c.$context=MN(this.getContext(),i,c))}return this.$context||(this.$context=SN(this.chart.getContext(),this))}_tickSize(){const i=this.options.ticks,o=Za(this.labelRotation),c=Math.abs(Math.cos(o)),h=Math.abs(Math.sin(o)),m=this._getLabelSizes(),_=i.autoSkipPadding||0,x=m?m.widest.width+_:0,s=m?m.highest.height+_:0;return this.isHorizontal()?s*c>x*h?x/c:s/h:s*h<x*c?s/c:x/h}_isVisible(){const i=this.options.display;return i!=="auto"?!!i:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(i){const o=this.axis,c=this.chart,h=this.options,{grid:m,position:_,border:x}=h,s=m.offset,M=this.isHorizontal(),L=this.ticks.length+(s?1:0),F=vp(m),V=[],X=x.setContext(this.getContext()),q=X.display?X.width:0,Y=q/2,J=function(tt){return fh(c,tt,q)};let ue,ce,fe,Ae,Ce,He,We,nt,we,ht,pt,Xe;if(_==="top")ue=J(this.bottom),He=this.bottom-F,nt=ue-Y,ht=J(i.top)+Y,Xe=i.bottom;else if(_==="bottom")ue=J(this.top),ht=i.top,Xe=J(i.bottom)-Y,He=ue+Y,nt=this.top+F;else if(_==="left")ue=J(this.right),Ce=this.right-F,We=ue-Y,we=J(i.left)+Y,pt=i.right;else if(_==="right")ue=J(this.left),we=i.left,pt=J(i.right)-Y,Ce=ue+Y,We=this.left+F;else if(o==="x"){if(_==="center")ue=J((i.top+i.bottom)/2+.5);else if(zn(_)){const tt=Object.keys(_)[0],ei=_[tt];ue=J(this.chart.scales[tt].getPixelForValue(ei))}ht=i.top,Xe=i.bottom,He=ue+Y,nt=He+F}else if(o==="y"){if(_==="center")ue=J((i.left+i.right)/2);else if(zn(_)){const tt=Object.keys(_)[0],ei=_[tt];ue=J(this.chart.scales[tt].getPixelForValue(ei))}Ce=ue-Y,We=Ce-F,we=i.left,pt=i.right}const mt=bn(h.ticks.maxTicksLimit,L),Ft=Math.max(1,Math.ceil(L/mt));for(ce=0;ce<L;ce+=Ft){const tt=this.getContext(ce),ei=m.setContext(tt),ki=x.setContext(tt),rt=ei.lineWidth,yt=ei.color,Xt=ki.dash||[],kt=ki.dashOffset,Ue=ei.tickWidth,Ye=ei.tickColor,Kt=ei.tickBorderDash||[],vi=ei.tickBorderDashOffset;fe=wN(this,ce,s),fe!==void 0&&(Ae=fh(c,fe,rt),M?Ce=We=we=pt=Ae:He=nt=ht=Xe=Ae,V.push({tx1:Ce,ty1:He,tx2:We,ty2:nt,x1:we,y1:ht,x2:pt,y2:Xe,width:rt,color:yt,borderDash:Xt,borderDashOffset:kt,tickWidth:Ue,tickColor:Ye,tickBorderDash:Kt,tickBorderDashOffset:vi}))}return this._ticksLength=L,this._borderValue=ue,V}_computeLabelItems(i){const o=this.axis,c=this.options,{position:h,ticks:m}=c,_=this.isHorizontal(),x=this.ticks,{align:s,crossAlign:M,padding:P,mirror:L}=m,F=vp(c.grid),V=F+P,X=L?-P:V,q=-Za(this.labelRotation),Y=[];let J,ue,ce,fe,Ae,Ce,He,We,nt,we,ht,pt,Xe="middle";if(h==="top")Ce=this.bottom-X,He=this._getXAxisLabelAlignment();else if(h==="bottom")Ce=this.top+X,He=this._getXAxisLabelAlignment();else if(h==="left"){const Ft=this._getYAxisLabelAlignment(F);He=Ft.textAlign,Ae=Ft.x}else if(h==="right"){const Ft=this._getYAxisLabelAlignment(F);He=Ft.textAlign,Ae=Ft.x}else if(o==="x"){if(h==="center")Ce=(i.top+i.bottom)/2+V;else if(zn(h)){const Ft=Object.keys(h)[0],tt=h[Ft];Ce=this.chart.scales[Ft].getPixelForValue(tt)+V}He=this._getXAxisLabelAlignment()}else if(o==="y"){if(h==="center")Ae=(i.left+i.right)/2-V;else if(zn(h)){const Ft=Object.keys(h)[0],tt=h[Ft];Ae=this.chart.scales[Ft].getPixelForValue(tt)}He=this._getYAxisLabelAlignment(F).textAlign}o==="y"&&(s==="start"?Xe="top":s==="end"&&(Xe="bottom"));const mt=this._getLabelSizes();for(J=0,ue=x.length;J<ue;++J){ce=x[J],fe=ce.label;const Ft=m.setContext(this.getContext(J));We=this.getPixelForTick(J)+m.labelOffset,nt=this._resolveTickFontOptions(J),we=nt.lineHeight,ht=Or(fe)?fe.length:1;const tt=ht/2,ei=Ft.color,ki=Ft.textStrokeColor,rt=Ft.textStrokeWidth;let yt=He;_?(Ae=We,He==="inner"&&(J===ue-1?yt=this.options.reverse?"left":"right":J===0?yt=this.options.reverse?"right":"left":yt="center"),h==="top"?M==="near"||q!==0?pt=-ht*we+we/2:M==="center"?pt=-mt.highest.height/2-tt*we+we:pt=-mt.highest.height+we/2:M==="near"||q!==0?pt=we/2:M==="center"?pt=mt.highest.height/2-tt*we:pt=mt.highest.height-ht*we,L&&(pt*=-1),q!==0&&!Ft.showLabelBackdrop&&(Ae+=we/2*Math.sin(q))):(Ce=We,pt=(1-ht)*we/2);let Xt;if(Ft.showLabelBackdrop){const kt=ns(Ft.backdropPadding),Ue=mt.heights[J],Ye=mt.widths[J];let Kt=pt-kt.top,vi=0-kt.left;switch(Xe){case"middle":Kt-=Ue/2;break;case"bottom":Kt-=Ue;break}switch(He){case"center":vi-=Ye/2;break;case"right":vi-=Ye;break;case"inner":J===ue-1?vi-=Ye:J>0&&(vi-=Ye/2);break}Xt={left:vi,top:Kt,width:Ye+kt.width,height:Ue+kt.height,color:Ft.backdropColor}}Y.push({label:fe,font:nt,textOffset:pt,options:{rotation:q,color:ei,strokeColor:ki,strokeWidth:rt,textAlign:yt,textBaseline:Xe,translation:[Ae,Ce],backdrop:Xt}})}return Y}_getXAxisLabelAlignment(){const{position:i,ticks:o}=this.options;if(-Za(this.labelRotation))return i==="top"?"left":"right";let h="center";return o.align==="start"?h="left":o.align==="end"?h="right":o.align==="inner"&&(h="inner"),h}_getYAxisLabelAlignment(i){const{position:o,ticks:{crossAlign:c,mirror:h,padding:m}}=this.options,_=this._getLabelSizes(),x=i+m,s=_.widest.width;let M,P;return o==="left"?h?(P=this.right+m,c==="near"?M="left":c==="center"?(M="center",P+=s/2):(M="right",P+=s)):(P=this.right-x,c==="near"?M="right":c==="center"?(M="center",P-=s/2):(M="left",P=this.left)):o==="right"?h?(P=this.left+m,c==="near"?M="right":c==="center"?(M="center",P-=s/2):(M="left",P-=s)):(P=this.left+x,c==="near"?M="left":c==="center"?(M="center",P+=s/2):(M="right",P=this.right)):M="right",{textAlign:M,x:P}}_computeLabelArea(){if(this.options.ticks.mirror)return;const i=this.chart,o=this.options.position;if(o==="left"||o==="right")return{top:0,left:this.left,bottom:i.height,right:this.right};if(o==="top"||o==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:i.width}}drawBackground(){const{ctx:i,options:{backgroundColor:o},left:c,top:h,width:m,height:_}=this;o&&(i.save(),i.fillStyle=o,i.fillRect(c,h,m,_),i.restore())}getLineWidthForValue(i){const o=this.options.grid;if(!this._isVisible()||!o.display)return 0;const h=this.ticks.findIndex(m=>m.value===i);return h>=0?o.setContext(this.getContext(h)).lineWidth:0}drawGrid(i){const o=this.options.grid,c=this.ctx,h=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(i));let m,_;const x=(s,M,P)=>{!P.width||!P.color||(c.save(),c.lineWidth=P.width,c.strokeStyle=P.color,c.setLineDash(P.borderDash||[]),c.lineDashOffset=P.borderDashOffset,c.beginPath(),c.moveTo(s.x,s.y),c.lineTo(M.x,M.y),c.stroke(),c.restore())};if(o.display)for(m=0,_=h.length;m<_;++m){const s=h[m];o.drawOnChartArea&&x({x:s.x1,y:s.y1},{x:s.x2,y:s.y2},s),o.drawTicks&&x({x:s.tx1,y:s.ty1},{x:s.tx2,y:s.ty2},{color:s.tickColor,width:s.tickWidth,borderDash:s.tickBorderDash,borderDashOffset:s.tickBorderDashOffset})}}drawBorder(){const{chart:i,ctx:o,options:{border:c,grid:h}}=this,m=c.setContext(this.getContext()),_=c.display?m.width:0;if(!_)return;const x=h.setContext(this.getContext(0)).lineWidth,s=this._borderValue;let M,P,L,F;this.isHorizontal()?(M=fh(i,this.left,_)-_/2,P=fh(i,this.right,x)+x/2,L=F=s):(L=fh(i,this.top,_)-_/2,F=fh(i,this.bottom,x)+x/2,M=P=s),o.save(),o.lineWidth=m.width,o.strokeStyle=m.color,o.beginPath(),o.moveTo(M,L),o.lineTo(P,F),o.stroke(),o.restore()}drawLabels(i){if(!this.options.ticks.display)return;const c=this.ctx,h=this._computeLabelArea();h&&My(c,h);const m=this.getLabelItems(i);for(const _ of m){const x=_.options,s=_.font,M=_.label,P=_.textOffset;Fh(c,M,0,P,s,x)}h&&Ey(c)}drawTitle(){const{ctx:i,options:{position:o,title:c,reverse:h}}=this;if(!c.display)return;const m=So(c.font),_=ns(c.padding),x=c.align;let s=m.lineHeight/2;o==="bottom"||o==="center"||zn(o)?(s+=_.bottom,Or(c.text)&&(s+=m.lineHeight*(c.text.length-1))):s+=_.top;const{titleX:M,titleY:P,maxWidth:L,rotation:F}=AN(this,s,o,x);Fh(i,c.text,0,0,m,{color:c.color,maxWidth:L,rotation:F,textAlign:EN(x,o,h),textBaseline:"middle",translation:[M,P]})}draw(i){this._isVisible()&&(this.drawBackground(),this.drawGrid(i),this.drawBorder(),this.drawTitle(),this.drawLabels(i))}_layers(){const i=this.options,o=i.ticks&&i.ticks.z||0,c=bn(i.grid&&i.grid.z,-1),h=bn(i.border&&i.border.z,0);return!this._isVisible()||this.draw!==Vh.prototype.draw?[{z:o,draw:m=>{this.draw(m)}}]:[{z:c,draw:m=>{this.drawBackground(),this.drawGrid(m),this.drawTitle()}},{z:h,draw:()=>{this.drawBorder()}},{z:o,draw:m=>{this.drawLabels(m)}}]}getMatchingVisibleMetas(i){const o=this.chart.getSortedVisibleDatasetMetas(),c=this.axis+"AxisID",h=[];let m,_;for(m=0,_=o.length;m<_;++m){const x=o[m];x[c]===this.id&&(!i||x.type===i)&&h.push(x)}return h}_resolveTickFontOptions(i){const o=this.options.ticks.setContext(this.getContext(i));return So(o.font)}_maxDigits(){const i=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/i}}class n_{constructor(i,o,c){this.type=i,this.scope=o,this.override=c,this.items=Object.create(null)}isForType(i){return Object.prototype.isPrototypeOf.call(this.type.prototype,i.prototype)}register(i){const o=Object.getPrototypeOf(i);let c;PN(o)&&(c=this.register(o));const h=this.items,m=i.id,_=this.scope+"."+m;if(!m)throw new Error("class does not have id: "+i);return m in h||(h[m]=i,IN(i,_,c),this.override&&Yr.override(i.id,i.overrides)),_}get(i){return this.items[i]}unregister(i){const o=this.items,c=i.id,h=this.scope;c in o&&delete o[c],h&&c in Yr[h]&&(delete Yr[h][c],this.override&&delete zh[c])}}function IN(r,i,o){const c=Wp(Object.create(null),[o?Yr.get(o):{},Yr.get(i),r.defaults]);Yr.set(i,c),r.defaultRoutes&&CN(i,r.defaultRoutes),r.descriptors&&Yr.describe(i,r.descriptors)}function CN(r,i){Object.keys(i).forEach(o=>{const c=o.split("."),h=c.pop(),m=[r].concat(c).join("."),_=i[o].split("."),x=_.pop(),s=_.join(".");Yr.route(m,h,s,x)})}function PN(r){return"id"in r&&"defaults"in r}class kN{constructor(){this.controllers=new n_(Xa,"datasets",!0),this.elements=new n_(Ya,"elements"),this.plugins=new n_(Object,"plugins"),this.scales=new n_(Vh,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...i){this._each("register",i)}remove(...i){this._each("unregister",i)}addControllers(...i){this._each("register",i,this.controllers)}addElements(...i){this._each("register",i,this.elements)}addPlugins(...i){this._each("register",i,this.plugins)}addScales(...i){this._each("register",i,this.scales)}getController(i){return this._get(i,this.controllers,"controller")}getElement(i){return this._get(i,this.elements,"element")}getPlugin(i){return this._get(i,this.plugins,"plugin")}getScale(i){return this._get(i,this.scales,"scale")}removeControllers(...i){this._each("unregister",i,this.controllers)}removeElements(...i){this._each("unregister",i,this.elements)}removePlugins(...i){this._each("unregister",i,this.plugins)}removeScales(...i){this._each("unregister",i,this.scales)}_each(i,o,c){[...o].forEach(h=>{const m=c||this._getRegistryForType(h);c||m.isForType(h)||m===this.plugins&&h.id?this._exec(i,m,h):gr(h,_=>{const x=c||this._getRegistryForType(_);this._exec(i,x,_)})})}_exec(i,o,c){const h=Lb(i);Ir(c["before"+h],[],c),o[i](c),Ir(c["after"+h],[],c)}_getRegistryForType(i){for(let o=0;o<this._typedRegistries.length;o++){const c=this._typedRegistries[o];if(c.isForType(i))return c}return this.plugins}_get(i,o,c){const h=o.get(i);if(h===void 0)throw new Error('"'+i+'" is not a registered '+c+".");return h}}var xl=new kN;class DN{constructor(){this._init=[]}notify(i,o,c,h){o==="beforeInit"&&(this._init=this._createDescriptors(i,!0),this._notify(this._init,i,"install"));const m=h?this._descriptors(i).filter(h):this._descriptors(i),_=this._notify(m,i,o,c);return o==="afterDestroy"&&(this._notify(m,i,"stop"),this._notify(this._init,i,"uninstall")),_}_notify(i,o,c,h){h=h||{};for(const m of i){const _=m.plugin,x=_[c],s=[o,h,m.options];if(Ir(x,s,_)===!1&&h.cancelable)return!1}return!0}invalidate(){Jn(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(i){if(this._cache)return this._cache;const o=this._cache=this._createDescriptors(i);return this._notifyStateChanges(i),o}_createDescriptors(i,o){const c=i&&i.config,h=bn(c.options&&c.options.plugins,{}),m=LN(c);return h===!1&&!o?[]:RN(i,m,h,o)}_notifyStateChanges(i){const o=this._oldCache||[],c=this._cache,h=(m,_)=>m.filter(x=>!_.some(s=>x.plugin.id===s.plugin.id));this._notify(h(o,c),i,"stop"),this._notify(h(c,o),i,"start")}}function LN(r){const i={},o=[],c=Object.keys(xl.plugins.items);for(let m=0;m<c.length;m++)o.push(xl.getPlugin(c[m]));const h=r.plugins||[];for(let m=0;m<h.length;m++){const _=h[m];o.indexOf(_)===-1&&(o.push(_),i[_.id]=!0)}return{plugins:o,localIds:i}}function ON(r,i){return!i&&r===!1?null:r===!0?{}:r}function RN(r,{plugins:i,localIds:o},c,h){const m=[],_=r.getContext();for(const x of i){const s=x.id,M=ON(c[s],h);M!==null&&m.push({plugin:x,options:zN(r.config,{plugin:x,local:o[s]},M,_)})}return m}function zN(r,{plugin:i,local:o},c,h){const m=r.pluginScopeKeys(i),_=r.getOptionScopes(c,m);return o&&i.defaults&&_.push(i.defaults),r.createResolver(_,h,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Bx(r,i){const o=Yr.datasets[r]||{};return((i.datasets||{})[r]||{}).indexAxis||i.indexAxis||o.indexAxis||"x"}function FN(r,i){let o=r;return r==="_index_"?o=i:r==="_value_"&&(o=i==="x"?"y":"x"),o}function BN(r,i){return r===i?"_index_":"_value_"}function rA(r){if(r==="x"||r==="y"||r==="r")return r}function NN(r){if(r==="top"||r==="bottom")return"x";if(r==="left"||r==="right")return"y"}function Nx(r,...i){if(rA(r))return r;for(const o of i){const c=o.axis||NN(o.position)||r.length>1&&rA(r[0].toLowerCase());if(c)return c}throw new Error(`Cannot determine type of '${r}' axis. Please provide 'axis' or 'position' option.`)}function oA(r,i,o){if(o[i+"AxisID"]===r)return{axis:i}}function VN(r,i){if(i.data&&i.data.datasets){const o=i.data.datasets.filter(c=>c.xAxisID===r||c.yAxisID===r);if(o.length)return oA(r,"x",o[0])||oA(r,"y",o[0])}return{}}function UN(r,i){const o=zh[r.type]||{scales:{}},c=i.scales||{},h=Bx(r.type,i),m=Object.create(null);return Object.keys(c).forEach(_=>{const x=c[_];if(!zn(x))return console.error(`Invalid scale configuration for scale: ${_}`);if(x._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${_}`);const s=Nx(_,x,VN(_,r),Yr.scales[x.type]),M=BN(s,h),P=o.scales||{};m[_]=Np(Object.create(null),[{axis:s},x,P[s],P[M]])}),r.data.datasets.forEach(_=>{const x=_.type||r.type,s=_.indexAxis||Bx(x,i),P=(zh[x]||{}).scales||{};Object.keys(P).forEach(L=>{const F=FN(L,s),V=_[F+"AxisID"]||F;m[V]=m[V]||Object.create(null),Np(m[V],[{axis:F},c[V],P[L]])})}),Object.keys(m).forEach(_=>{const x=m[_];Np(x,[Yr.scales[x.type],Yr.scale])}),m}function XP(r){const i=r.options||(r.options={});i.plugins=bn(i.plugins,{}),i.scales=UN(r,i)}function YP(r){return r=r||{},r.datasets=r.datasets||[],r.labels=r.labels||[],r}function jN(r){return r=r||{},r.data=YP(r.data),XP(r),r}const sA=new Map,JP=new Set;function r_(r,i){let o=sA.get(r);return o||(o=i(),sA.set(r,o),JP.add(o)),o}const xp=(r,i,o)=>{const c=fu(i,o);c!==void 0&&r.add(c)};class GN{constructor(i){this._config=jN(i),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(i){this._config.type=i}get data(){return this._config.data}set data(i){this._config.data=YP(i)}get options(){return this._config.options}set options(i){this._config.options=i}get plugins(){return this._config.plugins}update(){const i=this._config;this.clearCache(),XP(i)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(i){return r_(i,()=>[[`datasets.${i}`,""]])}datasetAnimationScopeKeys(i,o){return r_(`${i}.transition.${o}`,()=>[[`datasets.${i}.transitions.${o}`,`transitions.${o}`],[`datasets.${i}`,""]])}datasetElementScopeKeys(i,o){return r_(`${i}-${o}`,()=>[[`datasets.${i}.elements.${o}`,`datasets.${i}`,`elements.${o}`,""]])}pluginScopeKeys(i){const o=i.id,c=this.type;return r_(`${c}-plugin-${o}`,()=>[[`plugins.${o}`,...i.additionalOptionScopes||[]]])}_cachedScopes(i,o){const c=this._scopeCache;let h=c.get(i);return(!h||o)&&(h=new Map,c.set(i,h)),h}getOptionScopes(i,o,c){const{options:h,type:m}=this,_=this._cachedScopes(i,c),x=_.get(o);if(x)return x;const s=new Set;o.forEach(P=>{i&&(s.add(i),P.forEach(L=>xp(s,i,L))),P.forEach(L=>xp(s,h,L)),P.forEach(L=>xp(s,zh[m]||{},L)),P.forEach(L=>xp(s,Yr,L)),P.forEach(L=>xp(s,Rx,L))});const M=Array.from(s);return M.length===0&&M.push(Object.create(null)),JP.has(o)&&_.set(o,M),M}chartOptionScopes(){const{options:i,type:o}=this;return[i,zh[o]||{},Yr.datasets[o]||{},{type:o},Yr,Rx]}resolveNamedOptions(i,o,c,h=[""]){const m={$shared:!0},{resolver:_,subPrefixes:x}=aA(this._resolverCache,i,h);let s=_;if(qN(_,o)){m.$shared=!1,c=pu(c)?c():c;const M=this.createResolver(i,c,x);s=Zd(_,c,M)}for(const M of o)m[M]=s[M];return m}createResolver(i,o,c=[""],h){const{resolver:m}=aA(this._resolverCache,i,c);return zn(o)?Zd(m,o,void 0,h):m}}function aA(r,i,o){let c=r.get(i);c||(c=new Map,r.set(i,c));const h=o.join();let m=c.get(h);return m||(m={resolver:Nb(i,o),subPrefixes:o.filter(x=>!x.toLowerCase().includes("hover"))},c.set(h,m)),m}const HN=r=>zn(r)&&Object.getOwnPropertyNames(r).some(i=>pu(r[i]));function qN(r,i){const{isScriptable:o,isIndexable:c}=CP(r);for(const h of i){const m=o(h),_=c(h),x=(_||m)&&r[h];if(m&&(pu(x)||HN(x))||_&&Or(x))return!0}return!1}var WN="4.4.2";const ZN=["top","bottom","left","right","chartArea"];function lA(r,i){return r==="top"||r==="bottom"||ZN.indexOf(r)===-1&&i==="x"}function cA(r,i){return function(o,c){return o[r]===c[r]?o[i]-c[i]:o[r]-c[r]}}function uA(r){const i=r.chart,o=i.options.animation;i.notifyPlugins("afterRender"),Ir(o&&o.onComplete,[r],i)}function XN(r){const i=r.chart,o=i.options.animation;Ir(o&&o.onProgress,[r],i)}function KP(r){return jb()&&typeof r=="string"?r=document.getElementById(r):r&&r.length&&(r=r[0]),r&&r.canvas&&(r=r.canvas),r}const A_={},hA=r=>{const i=KP(r);return Object.values(A_).filter(o=>o.canvas===i).pop()};function YN(r,i,o){const c=Object.keys(r);for(const h of c){const m=+h;if(m>=i){const _=r[h];delete r[h],(o>0||m>i)&&(r[m+o]=_)}}}function JN(r,i,o,c){return!o||r.type==="mouseout"?null:c?i:r}function o_(r,i,o){return r.options.clip?r[o]:i[o]}function KN(r,i){const{xScale:o,yScale:c}=r;return o&&c?{left:o_(o,i,"left"),right:o_(o,i,"right"),top:o_(c,i,"top"),bottom:o_(c,i,"bottom")}:i}class Sl{static register(...i){xl.add(...i),dA()}static unregister(...i){xl.remove(...i),dA()}constructor(i,o){const c=this.config=new GN(o),h=KP(i),m=hA(h);if(m)throw new Error("Canvas is already in use. Chart with ID '"+m.id+"' must be destroyed before the canvas with ID '"+m.canvas.id+"' can be reused.");const _=c.createResolver(c.chartOptionScopes(),this.getContext());this.platform=new(c.platform||pN(h)),this.platform.updateConfig(c);const x=this.platform.acquireContext(h,_.aspectRatio),s=x&&x.canvas,M=s&&s.height,P=s&&s.width;if(this.id=Q4(),this.ctx=x,this.canvas=s,this.width=P,this.height=M,this._options=_,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new DN,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=m5(L=>this.update(L),_.resizeDelay||0),this._dataChanges=[],A_[this.id]=this,!x||!s){console.error("Failed to create chart: can't acquire context from the given item");return}mc.listen(this,"complete",uA),mc.listen(this,"progress",XN),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:i,maintainAspectRatio:o},width:c,height:h,_aspectRatio:m}=this;return Jn(i)?o&&m?m:h?c/h:null:i}get data(){return this.config.data}set data(i){this.config.data=i}get options(){return this._options}set options(i){this.config.options=i}get registry(){return xl}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():LE(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return PE(this.canvas,this.ctx),this}stop(){return mc.stop(this),this}resize(i,o){mc.running(this)?this._resizeBeforeDraw={width:i,height:o}:this._resize(i,o)}_resize(i,o){const c=this.options,h=this.canvas,m=c.maintainAspectRatio&&this.aspectRatio,_=this.platform.getMaximumSize(h,i,o,m),x=c.devicePixelRatio||this.platform.getDevicePixelRatio(),s=this.width?"resize":"attach";this.width=_.width,this.height=_.height,this._aspectRatio=this.aspectRatio,LE(this,x,!0)&&(this.notifyPlugins("resize",{size:_}),Ir(c.onResize,[this,_],this),this.attached&&this._doResize(s)&&this.render())}ensureScalesHaveIDs(){const o=this.options.scales||{};gr(o,(c,h)=>{c.id=h})}buildOrUpdateScales(){const i=this.options,o=i.scales,c=this.scales,h=Object.keys(c).reduce((_,x)=>(_[x]=!1,_),{});let m=[];o&&(m=m.concat(Object.keys(o).map(_=>{const x=o[_],s=Nx(_,x),M=s==="r",P=s==="x";return{options:x,dposition:M?"chartArea":P?"bottom":"left",dtype:M?"radialLinear":P?"category":"linear"}}))),gr(m,_=>{const x=_.options,s=x.id,M=Nx(s,x),P=bn(x.type,_.dtype);(x.position===void 0||lA(x.position,M)!==lA(_.dposition))&&(x.position=_.dposition),h[s]=!0;let L=null;if(s in c&&c[s].type===P)L=c[s];else{const F=xl.getScale(P);L=new F({id:s,type:P,ctx:this.ctx,chart:this}),c[L.id]=L}L.init(x,i)}),gr(h,(_,x)=>{_||delete c[x]}),gr(c,_=>{ts.configure(this,_,_.options),ts.addBox(this,_)})}_updateMetasets(){const i=this._metasets,o=this.data.datasets.length,c=i.length;if(i.sort((h,m)=>h.index-m.index),c>o){for(let h=o;h<c;++h)this._destroyDatasetMeta(h);i.splice(o,c-o)}this._sortedMetasets=i.slice(0).sort(cA("order","index"))}_removeUnreferencedMetasets(){const{_metasets:i,data:{datasets:o}}=this;i.length>o.length&&delete this._stacks,i.forEach((c,h)=>{o.filter(m=>m===c._dataset).length===0&&this._destroyDatasetMeta(h)})}buildOrUpdateControllers(){const i=[],o=this.data.datasets;let c,h;for(this._removeUnreferencedMetasets(),c=0,h=o.length;c<h;c++){const m=o[c];let _=this.getDatasetMeta(c);const x=m.type||this.config.type;if(_.type&&_.type!==x&&(this._destroyDatasetMeta(c),_=this.getDatasetMeta(c)),_.type=x,_.indexAxis=m.indexAxis||Bx(x,this.options),_.order=m.order||0,_.index=c,_.label=""+m.label,_.visible=this.isDatasetVisible(c),_.controller)_.controller.updateIndex(c),_.controller.linkScales();else{const s=xl.getController(x),{datasetElementType:M,dataElementType:P}=Yr.datasets[x];Object.assign(s,{dataElementType:xl.getElement(P),datasetElementType:M&&xl.getElement(M)}),_.controller=new s(this,c),i.push(_.controller)}}return this._updateMetasets(),i}_resetElements(){gr(this.data.datasets,(i,o)=>{this.getDatasetMeta(o).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(i){const o=this.config;o.update();const c=this._options=o.createResolver(o.chartOptionScopes(),this.getContext()),h=this._animationsDisabled=!c.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:i,cancelable:!0})===!1)return;const m=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let _=0;for(let M=0,P=this.data.datasets.length;M<P;M++){const{controller:L}=this.getDatasetMeta(M),F=!h&&m.indexOf(L)===-1;L.buildOrUpdateElements(F),_=Math.max(+L.getMaxOverflow(),_)}_=this._minPadding=c.layout.autoPadding?_:0,this._updateLayout(_),h||gr(m,M=>{M.reset()}),this._updateDatasets(i),this.notifyPlugins("afterUpdate",{mode:i}),this._layers.sort(cA("z","_idx"));const{_active:x,_lastEvent:s}=this;s?this._eventHandler(s,!0):x.length&&this._updateHoverStyles(x,x,!0),this.render()}_updateScales(){gr(this.scales,i=>{ts.removeBox(this,i)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const i=this.options,o=new Set(Object.keys(this._listeners)),c=new Set(i.events);(!bE(o,c)||!!this._responsiveListeners!==i.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:i}=this,o=this._getUniformDataChanges()||[];for(const{method:c,start:h,count:m}of o){const _=c==="_removeElements"?-m:m;YN(i,h,_)}}_getUniformDataChanges(){const i=this._dataChanges;if(!i||!i.length)return;this._dataChanges=[];const o=this.data.datasets.length,c=m=>new Set(i.filter(_=>_[0]===m).map((_,x)=>x+","+_.splice(1).join(","))),h=c(0);for(let m=1;m<o;m++)if(!bE(h,c(m)))return;return Array.from(h).map(m=>m.split(",")).map(m=>({method:m[1],start:+m[2],count:+m[3]}))}_updateLayout(i){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;ts.update(this,this.width,this.height,i);const o=this.chartArea,c=o.width<=0||o.height<=0;this._layers=[],gr(this.boxes,h=>{c&&h.position==="chartArea"||(h.configure&&h.configure(),this._layers.push(...h._layers()))},this),this._layers.forEach((h,m)=>{h._idx=m}),this.notifyPlugins("afterLayout")}_updateDatasets(i){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:i,cancelable:!0})!==!1){for(let o=0,c=this.data.datasets.length;o<c;++o)this.getDatasetMeta(o).controller.configure();for(let o=0,c=this.data.datasets.length;o<c;++o)this._updateDataset(o,pu(i)?i({datasetIndex:o}):i);this.notifyPlugins("afterDatasetsUpdate",{mode:i})}}_updateDataset(i,o){const c=this.getDatasetMeta(i),h={meta:c,index:i,mode:o,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",h)!==!1&&(c.controller._update(o),h.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",h))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(mc.has(this)?this.attached&&!mc.running(this)&&mc.start(this):(this.draw(),uA({chart:this})))}draw(){let i;if(this._resizeBeforeDraw){const{width:c,height:h}=this._resizeBeforeDraw;this._resize(c,h),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const o=this._layers;for(i=0;i<o.length&&o[i].z<=0;++i)o[i].draw(this.chartArea);for(this._drawDatasets();i<o.length;++i)o[i].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(i){const o=this._sortedMetasets,c=[];let h,m;for(h=0,m=o.length;h<m;++h){const _=o[h];(!i||_.visible)&&c.push(_)}return c}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const i=this.getSortedVisibleDatasetMetas();for(let o=i.length-1;o>=0;--o)this._drawDataset(i[o]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(i){const o=this.ctx,c=i._clip,h=!c.disabled,m=KN(i,this.chartArea),_={meta:i,index:i.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",_)!==!1&&(h&&My(o,{left:c.left===!1?0:m.left-c.left,right:c.right===!1?this.width:m.right+c.right,top:c.top===!1?0:m.top-c.top,bottom:c.bottom===!1?this.height:m.bottom+c.bottom}),i.controller.draw(),h&&Ey(o),_.cancelable=!1,this.notifyPlugins("afterDatasetDraw",_))}isPointInArea(i){return wc(i,this.chartArea,this._minPadding)}getElementsAtEventForMode(i,o,c,h){const m=ZB.modes[o];return typeof m=="function"?m(this,i,c,h):[]}getDatasetMeta(i){const o=this.data.datasets[i],c=this._metasets;let h=c.filter(m=>m&&m._dataset===o).pop();return h||(h={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:o&&o.order||0,index:i,_dataset:o,_parsed:[],_sorted:!1},c.push(h)),h}getContext(){return this.$context||(this.$context=gu(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(i){const o=this.data.datasets[i];if(!o)return!1;const c=this.getDatasetMeta(i);return typeof c.hidden=="boolean"?!c.hidden:!o.hidden}setDatasetVisibility(i,o){const c=this.getDatasetMeta(i);c.hidden=!o}toggleDataVisibility(i){this._hiddenIndices[i]=!this._hiddenIndices[i]}getDataVisibility(i){return!this._hiddenIndices[i]}_updateVisibility(i,o,c){const h=c?"show":"hide",m=this.getDatasetMeta(i),_=m.controller._resolveAnimations(void 0,h);Zp(o)?(m.data[o].hidden=!c,this.update()):(this.setDatasetVisibility(i,c),_.update(m,{visible:c}),this.update(x=>x.datasetIndex===i?h:void 0))}hide(i,o){this._updateVisibility(i,o,!1)}show(i,o){this._updateVisibility(i,o,!0)}_destroyDatasetMeta(i){const o=this._metasets[i];o&&o.controller&&o.controller._destroy(),delete this._metasets[i]}_stop(){let i,o;for(this.stop(),mc.remove(this),i=0,o=this.data.datasets.length;i<o;++i)this._destroyDatasetMeta(i)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:i,ctx:o}=this;this._stop(),this.config.clearCache(),i&&(this.unbindEvents(),PE(i,o),this.platform.releaseContext(o),this.canvas=null,this.ctx=null),delete A_[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...i){return this.canvas.toDataURL(...i)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const i=this._listeners,o=this.platform,c=(m,_)=>{o.addEventListener(this,m,_),i[m]=_},h=(m,_,x)=>{m.offsetX=_,m.offsetY=x,this._eventHandler(m)};gr(this.options.events,m=>c(m,h))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const i=this._responsiveListeners,o=this.platform,c=(s,M)=>{o.addEventListener(this,s,M),i[s]=M},h=(s,M)=>{i[s]&&(o.removeEventListener(this,s,M),delete i[s])},m=(s,M)=>{this.canvas&&this.resize(s,M)};let _;const x=()=>{h("attach",x),this.attached=!0,this.resize(),c("resize",m),c("detach",_)};_=()=>{this.attached=!1,h("resize",m),this._stop(),this._resize(0,0),c("attach",x)},o.isAttached(this.canvas)?x():_()}unbindEvents(){gr(this._listeners,(i,o)=>{this.platform.removeEventListener(this,o,i)}),this._listeners={},gr(this._responsiveListeners,(i,o)=>{this.platform.removeEventListener(this,o,i)}),this._responsiveListeners=void 0}updateHoverStyle(i,o,c){const h=c?"set":"remove";let m,_,x,s;for(o==="dataset"&&(m=this.getDatasetMeta(i[0].datasetIndex),m.controller["_"+h+"DatasetHoverStyle"]()),x=0,s=i.length;x<s;++x){_=i[x];const M=_&&this.getDatasetMeta(_.datasetIndex).controller;M&&M[h+"HoverStyle"](_.element,_.datasetIndex,_.index)}}getActiveElements(){return this._active||[]}setActiveElements(i){const o=this._active||[],c=i.map(({datasetIndex:m,index:_})=>{const x=this.getDatasetMeta(m);if(!x)throw new Error("No dataset found at index "+m);return{datasetIndex:m,element:x.data[_],index:_}});!W_(c,o)&&(this._active=c,this._lastEvent=null,this._updateHoverStyles(c,o))}notifyPlugins(i,o,c){return this._plugins.notify(this,i,o,c)}isPluginEnabled(i){return this._plugins._cache.filter(o=>o.plugin.id===i).length===1}_updateHoverStyles(i,o,c){const h=this.options.hover,m=(s,M)=>s.filter(P=>!M.some(L=>P.datasetIndex===L.datasetIndex&&P.index===L.index)),_=m(o,i),x=c?i:m(i,o);_.length&&this.updateHoverStyle(_,h.mode,!1),x.length&&h.mode&&this.updateHoverStyle(x,h.mode,!0)}_eventHandler(i,o){const c={event:i,replay:o,cancelable:!0,inChartArea:this.isPointInArea(i)},h=_=>(_.options.events||this.options.events).includes(i.native.type);if(this.notifyPlugins("beforeEvent",c,h)===!1)return;const m=this._handleEvent(i,o,c.inChartArea);return c.cancelable=!1,this.notifyPlugins("afterEvent",c,h),(m||c.changed)&&this.render(),this}_handleEvent(i,o,c){const{_active:h=[],options:m}=this,_=o,x=this._getActiveElements(i,h,c,_),s=o5(i),M=JN(i,this._lastEvent,c,s);c&&(this._lastEvent=null,Ir(m.onHover,[i,x,this],this),s&&Ir(m.onClick,[i,x,this],this));const P=!W_(x,h);return(P||o)&&(this._active=x,this._updateHoverStyles(x,h,o)),this._lastEvent=M,P}_getActiveElements(i,o,c,h){if(i.type==="mouseout")return[];if(!c)return o;const m=this.options.hover;return this.getElementsAtEventForMode(i,m.mode,m,h)}}bi(Sl,"defaults",Yr),bi(Sl,"instances",A_),bi(Sl,"overrides",zh),bi(Sl,"registry",xl),bi(Sl,"version",WN),bi(Sl,"getChart",hA);function dA(){return gr(Sl.instances,r=>r._plugins.invalidate())}function $N(r,i,o){const{startAngle:c,pixelMargin:h,x:m,y:_,outerRadius:x,innerRadius:s}=i;let M=h/x;r.beginPath(),r.arc(m,_,x,c-M,o+M),s>h?(M=h/s,r.arc(m,_,s,o+M,c-M,!0)):r.arc(m,_,h,o+co,c-co),r.closePath(),r.clip()}function QN(r){return Bb(r,["outerStart","outerEnd","innerStart","innerEnd"])}function e6(r,i,o,c){const h=QN(r.options.borderRadius),m=(o-i)/2,_=Math.min(m,c*i/2),x=s=>{const M=(o-Math.min(m,s))*c/2;return Do(s,0,Math.min(m,M))};return{outerStart:x(h.outerStart),outerEnd:x(h.outerEnd),innerStart:Do(h.innerStart,0,_),innerEnd:Do(h.innerEnd,0,_)}}function Pd(r,i,o,c){return{x:o+r*Math.cos(i),y:c+r*Math.sin(i)}}function $_(r,i,o,c,h,m){const{x:_,y:x,startAngle:s,pixelMargin:M,innerRadius:P}=i,L=Math.max(i.outerRadius+c+o-M,0),F=P>0?P+c+o+M:0;let V=0;const X=h-s;if(c){const Ft=P>0?P-c:0,tt=L>0?L-c:0,ei=(Ft+tt)/2,ki=ei!==0?X*ei/(ei+c):X;V=(X-ki)/2}const q=Math.max(.001,X*L-o/zr)/L,Y=(X-q)/2,J=s+Y+V,ue=h-Y-V,{outerStart:ce,outerEnd:fe,innerStart:Ae,innerEnd:Ce}=e6(i,F,L,ue-J),He=L-ce,We=L-fe,nt=J+ce/He,we=ue-fe/We,ht=F+Ae,pt=F+Ce,Xe=J+Ae/ht,mt=ue-Ce/pt;if(r.beginPath(),m){const Ft=(nt+we)/2;if(r.arc(_,x,L,nt,Ft),r.arc(_,x,L,Ft,we),fe>0){const rt=Pd(We,we,_,x);r.arc(rt.x,rt.y,fe,we,ue+co)}const tt=Pd(pt,ue,_,x);if(r.lineTo(tt.x,tt.y),Ce>0){const rt=Pd(pt,mt,_,x);r.arc(rt.x,rt.y,Ce,ue+co,mt+Math.PI)}const ei=(ue-Ce/F+(J+Ae/F))/2;if(r.arc(_,x,F,ue-Ce/F,ei,!0),r.arc(_,x,F,ei,J+Ae/F,!0),Ae>0){const rt=Pd(ht,Xe,_,x);r.arc(rt.x,rt.y,Ae,Xe+Math.PI,J-co)}const ki=Pd(He,J,_,x);if(r.lineTo(ki.x,ki.y),ce>0){const rt=Pd(He,nt,_,x);r.arc(rt.x,rt.y,ce,J-co,nt)}}else{r.moveTo(_,x);const Ft=Math.cos(nt)*L+_,tt=Math.sin(nt)*L+x;r.lineTo(Ft,tt);const ei=Math.cos(we)*L+_,ki=Math.sin(we)*L+x;r.lineTo(ei,ki)}r.closePath()}function t6(r,i,o,c,h){const{fullCircles:m,startAngle:_,circumference:x}=i;let s=i.endAngle;if(m){$_(r,i,o,c,s,h);for(let M=0;M<m;++M)r.fill();isNaN(x)||(s=_+(x%Rr||Rr))}return $_(r,i,o,c,s,h),r.fill(),s}function i6(r,i,o,c,h){const{fullCircles:m,startAngle:_,circumference:x,options:s}=i,{borderWidth:M,borderJoinStyle:P,borderDash:L,borderDashOffset:F}=s,V=s.borderAlign==="inner";if(!M)return;r.setLineDash(L||[]),r.lineDashOffset=F,V?(r.lineWidth=M*2,r.lineJoin=P||"round"):(r.lineWidth=M,r.lineJoin=P||"bevel");let X=i.endAngle;if(m){$_(r,i,o,c,X,h);for(let q=0;q<m;++q)r.stroke();isNaN(x)||(X=_+(x%Rr||Rr))}V&&$N(r,i,X),m||($_(r,i,o,c,X,h),r.stroke())}class Ip extends Ya{constructor(o){super();bi(this,"circumference");bi(this,"endAngle");bi(this,"fullCircles");bi(this,"innerRadius");bi(this,"outerRadius");bi(this,"pixelMargin");bi(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,o&&Object.assign(this,o)}inRange(o,c,h){const m=this.getProps(["x","y"],h),{angle:_,distance:x}=vP(m,{x:o,y:c}),{startAngle:s,endAngle:M,innerRadius:P,outerRadius:L,circumference:F}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],h),V=(this.options.spacing+this.options.borderWidth)/2,q=bn(F,M-s)>=Rr||Xp(_,s,M),Y=xc(x,P+V,L+V);return q&&Y}getCenterPoint(o){const{x:c,y:h,startAngle:m,endAngle:_,innerRadius:x,outerRadius:s}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],o),{offset:M,spacing:P}=this.options,L=(m+_)/2,F=(x+s+P+M)/2;return{x:c+Math.cos(L)*F,y:h+Math.sin(L)*F}}tooltipPosition(o){return this.getCenterPoint(o)}draw(o){const{options:c,circumference:h}=this,m=(c.offset||0)/4,_=(c.spacing||0)/2,x=c.circular;if(this.pixelMargin=c.borderAlign==="inner"?.33:0,this.fullCircles=h>Rr?Math.floor(h/Rr):0,h===0||this.innerRadius<0||this.outerRadius<0)return;o.save();const s=(this.startAngle+this.endAngle)/2;o.translate(Math.cos(s)*m,Math.sin(s)*m);const M=1-Math.sin(Math.min(zr,h||0)),P=m*M;o.fillStyle=c.backgroundColor,o.strokeStyle=c.borderColor,t6(o,this,P,_,x),i6(o,this,P,_,x),o.restore()}}bi(Ip,"id","arc"),bi(Ip,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),bi(Ip,"defaultRoutes",{backgroundColor:"backgroundColor"}),bi(Ip,"descriptors",{_scriptable:!0,_indexable:o=>o!=="borderDash"});function $P(r,i,o=i){r.lineCap=bn(o.borderCapStyle,i.borderCapStyle),r.setLineDash(bn(o.borderDash,i.borderDash)),r.lineDashOffset=bn(o.borderDashOffset,i.borderDashOffset),r.lineJoin=bn(o.borderJoinStyle,i.borderJoinStyle),r.lineWidth=bn(o.borderWidth,i.borderWidth),r.strokeStyle=bn(o.borderColor,i.borderColor)}function n6(r,i,o){r.lineTo(o.x,o.y)}function r6(r){return r.stepped?A5:r.tension||r.cubicInterpolationMode==="monotone"?I5:n6}function QP(r,i,o={}){const c=r.length,{start:h=0,end:m=c-1}=o,{start:_,end:x}=i,s=Math.max(h,_),M=Math.min(m,x),P=h<_&&m<_||h>x&&m>x;return{count:c,start:s,loop:i.loop,ilen:M<s&&!P?c+M-s:M-s}}function o6(r,i,o,c){const{points:h,options:m}=i,{count:_,start:x,loop:s,ilen:M}=QP(h,o,c),P=r6(m);let{move:L=!0,reverse:F}=c||{},V,X,q;for(V=0;V<=M;++V)X=h[(x+(F?M-V:V))%_],!X.skip&&(L?(r.moveTo(X.x,X.y),L=!1):P(r,q,X,F,m.stepped),q=X);return s&&(X=h[(x+(F?M:0))%_],P(r,q,X,F,m.stepped)),!!s}function s6(r,i,o,c){const h=i.points,{count:m,start:_,ilen:x}=QP(h,o,c),{move:s=!0,reverse:M}=c||{};let P=0,L=0,F,V,X,q,Y,J;const ue=fe=>(_+(M?x-fe:fe))%m,ce=()=>{q!==Y&&(r.lineTo(P,Y),r.lineTo(P,q),r.lineTo(P,J))};for(s&&(V=h[ue(0)],r.moveTo(V.x,V.y)),F=0;F<=x;++F){if(V=h[ue(F)],V.skip)continue;const fe=V.x,Ae=V.y,Ce=fe|0;Ce===X?(Ae<q?q=Ae:Ae>Y&&(Y=Ae),P=(L*P+fe)/++L):(ce(),r.lineTo(fe,Ae),X=Ce,L=0,q=Y=Ae),J=Ae}ce()}function Vx(r){const i=r.options,o=i.borderDash&&i.borderDash.length;return!r._decimated&&!r._loop&&!i.tension&&i.cubicInterpolationMode!=="monotone"&&!i.stepped&&!o?s6:o6}function a6(r){return r.stepped?sB:r.tension||r.cubicInterpolationMode==="monotone"?aB:yh}function l6(r,i,o,c){let h=i._path;h||(h=i._path=new Path2D,i.path(h,o,c)&&h.closePath()),$P(r,i.options),r.stroke(h)}function c6(r,i,o,c){const{segments:h,options:m}=i,_=Vx(i);for(const x of h)$P(r,m,x.style),r.beginPath(),_(r,i,x,{start:o,end:o+c-1})&&r.closePath(),r.stroke()}const u6=typeof Path2D=="function";function h6(r,i,o,c){u6&&!i.options.segment?l6(r,i,o,c):c6(r,i,o,c)}class cu extends Ya{constructor(i){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,i&&Object.assign(this,i)}updateControlPoints(i,o){const c=this.options;if((c.tension||c.cubicInterpolationMode==="monotone")&&!c.stepped&&!this._pointsUpdated){const h=c.spanGaps?this._loop:this._fullLoop;$5(this._points,c,i,h,o),this._pointsUpdated=!0}}set points(i){this._points=i,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=fB(this,this.options.segment))}first(){const i=this.segments,o=this.points;return i.length&&o[i[0].start]}last(){const i=this.segments,o=this.points,c=i.length;return c&&o[i[c-1].end]}interpolate(i,o){const c=this.options,h=i[o],m=this.points,_=NP(this,{property:o,start:h,end:h});if(!_.length)return;const x=[],s=a6(c);let M,P;for(M=0,P=_.length;M<P;++M){const{start:L,end:F}=_[M],V=m[L],X=m[F];if(V===X){x.push(V);continue}const q=Math.abs((h-V[o])/(X[o]-V[o])),Y=s(V,X,q,c.stepped);Y[o]=i[o],x.push(Y)}return x.length===1?x[0]:x}pathSegment(i,o,c){return Vx(this)(i,this,o,c)}path(i,o,c){const h=this.segments,m=Vx(this);let _=this._loop;o=o||0,c=c||this.points.length-o;for(const x of h)_&=m(i,this,x,{start:o,end:o+c-1});return!!_}draw(i,o,c,h){const m=this.options||{};(this.points||[]).length&&m.borderWidth&&(i.save(),h6(i,this,c,h),i.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}bi(cu,"id","line"),bi(cu,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),bi(cu,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),bi(cu,"descriptors",{_scriptable:!0,_indexable:i=>i!=="borderDash"&&i!=="fill"});function fA(r,i,o,c){const h=r.options,{[o]:m}=r.getProps([o],c);return Math.abs(i-m)<h.radius+h.hitRadius}class I_ extends Ya{constructor(o){super();bi(this,"parsed");bi(this,"skip");bi(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,o&&Object.assign(this,o)}inRange(o,c,h){const m=this.options,{x:_,y:x}=this.getProps(["x","y"],h);return Math.pow(o-_,2)+Math.pow(c-x,2)<Math.pow(m.hitRadius+m.radius,2)}inXRange(o,c){return fA(this,o,"x",c)}inYRange(o,c){return fA(this,o,"y",c)}getCenterPoint(o){const{x:c,y:h}=this.getProps(["x","y"],o);return{x:c,y:h}}size(o){o=o||this.options||{};let c=o.radius||0;c=Math.max(c,c&&o.hoverRadius||0);const h=c&&o.borderWidth||0;return(c+h)*2}draw(o,c){const h=this.options;this.skip||h.radius<.1||!wc(this,c,this.size(h)/2)||(o.strokeStyle=h.borderColor,o.lineWidth=h.borderWidth,o.fillStyle=h.backgroundColor,zx(o,h,this.x,this.y))}getRange(){const o=this.options||{};return o.radius+o.hitRadius}}bi(I_,"id","point"),bi(I_,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),bi(I_,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function ek(r,i){const{x:o,y:c,base:h,width:m,height:_}=r.getProps(["x","y","base","width","height"],i);let x,s,M,P,L;return r.horizontal?(L=_/2,x=Math.min(o,h),s=Math.max(o,h),M=c-L,P=c+L):(L=m/2,x=o-L,s=o+L,M=Math.min(c,h),P=Math.max(c,h)),{left:x,top:M,right:s,bottom:P}}function uu(r,i,o,c){return r?0:Do(i,o,c)}function d6(r,i,o){const c=r.options.borderWidth,h=r.borderSkipped,m=IP(c);return{t:uu(h.top,m.top,0,o),r:uu(h.right,m.right,0,i),b:uu(h.bottom,m.bottom,0,o),l:uu(h.left,m.left,0,i)}}function f6(r,i,o){const{enableBorderRadius:c}=r.getProps(["enableBorderRadius"]),h=r.options.borderRadius,m=Ih(h),_=Math.min(i,o),x=r.borderSkipped,s=c||zn(h);return{topLeft:uu(!s||x.top||x.left,m.topLeft,0,_),topRight:uu(!s||x.top||x.right,m.topRight,0,_),bottomLeft:uu(!s||x.bottom||x.left,m.bottomLeft,0,_),bottomRight:uu(!s||x.bottom||x.right,m.bottomRight,0,_)}}function p6(r){const i=ek(r),o=i.right-i.left,c=i.bottom-i.top,h=d6(r,o/2,c/2),m=f6(r,o/2,c/2);return{outer:{x:i.left,y:i.top,w:o,h:c,radius:m},inner:{x:i.left+h.l,y:i.top+h.t,w:o-h.l-h.r,h:c-h.t-h.b,radius:{topLeft:Math.max(0,m.topLeft-Math.max(h.t,h.l)),topRight:Math.max(0,m.topRight-Math.max(h.t,h.r)),bottomLeft:Math.max(0,m.bottomLeft-Math.max(h.b,h.l)),bottomRight:Math.max(0,m.bottomRight-Math.max(h.b,h.r))}}}}function sx(r,i,o,c){const h=i===null,m=o===null,x=r&&!(h&&m)&&ek(r,c);return x&&(h||xc(i,x.left,x.right))&&(m||xc(o,x.top,x.bottom))}function m6(r){return r.topLeft||r.topRight||r.bottomLeft||r.bottomRight}function g6(r,i){r.rect(i.x,i.y,i.w,i.h)}function ax(r,i,o={}){const c=r.x!==o.x?-i:0,h=r.y!==o.y?-i:0,m=(r.x+r.w!==o.x+o.w?i:0)-c,_=(r.y+r.h!==o.y+o.h?i:0)-h;return{x:r.x+c,y:r.y+h,w:r.w+m,h:r.h+_,radius:r.radius}}class C_ extends Ya{constructor(i){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,i&&Object.assign(this,i)}draw(i){const{inflateAmount:o,options:{borderColor:c,backgroundColor:h}}=this,{inner:m,outer:_}=p6(this),x=m6(_.radius)?Yp:g6;i.save(),(_.w!==m.w||_.h!==m.h)&&(i.beginPath(),x(i,ax(_,o,m)),i.clip(),x(i,ax(m,-o,_)),i.fillStyle=c,i.fill("evenodd")),i.beginPath(),x(i,ax(m,o)),i.fillStyle=h,i.fill(),i.restore()}inRange(i,o,c){return sx(this,i,o,c)}inXRange(i,o){return sx(this,i,null,o)}inYRange(i,o){return sx(this,null,i,o)}getCenterPoint(i){const{x:o,y:c,base:h,horizontal:m}=this.getProps(["x","y","base","horizontal"],i);return{x:m?(o+h)/2:o,y:m?c:(c+h)/2}}getRange(i){return i==="x"?this.width/2:this.height/2}}bi(C_,"id","bar"),bi(C_,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),bi(C_,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var _6=Object.freeze({__proto__:null,ArcElement:Ip,BarElement:C_,LineElement:cu,PointElement:I_});const Ux=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],pA=Ux.map(r=>r.replace("rgb(","rgba(").replace(")",", 0.5)"));function tk(r){return Ux[r%Ux.length]}function ik(r){return pA[r%pA.length]}function y6(r,i){return r.borderColor=tk(i),r.backgroundColor=ik(i),++i}function v6(r,i){return r.backgroundColor=r.data.map(()=>tk(i++)),i}function x6(r,i){return r.backgroundColor=r.data.map(()=>ik(i++)),i}function b6(r){let i=0;return(o,c)=>{const h=r.getDatasetMeta(c).controller;h instanceof Th?i=v6(o,i):h instanceof Gp?i=x6(o,i):h&&(i=y6(o,i))}}function mA(r){let i;for(i in r)if(r[i].borderColor||r[i].backgroundColor)return!0;return!1}function w6(r){return r&&(r.borderColor||r.backgroundColor)}var T6={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(r,i,o){if(!o.enabled)return;const{data:{datasets:c},options:h}=r.config,{elements:m}=h;if(!o.forceOverride&&(mA(c)||w6(h)||m&&mA(m)))return;const _=b6(r);c.forEach(_)}};function S6(r,i,o,c,h){const m=h.samples||c;if(m>=o)return r.slice(i,i+o);const _=[],x=(o-2)/(m-2);let s=0;const M=i+o-1;let P=i,L,F,V,X,q;for(_[s++]=r[P],L=0;L<m-2;L++){let Y=0,J=0,ue;const ce=Math.floor((L+1)*x)+1+i,fe=Math.min(Math.floor((L+2)*x)+1,o)+i,Ae=fe-ce;for(ue=ce;ue<fe;ue++)Y+=r[ue].x,J+=r[ue].y;Y/=Ae,J/=Ae;const Ce=Math.floor(L*x)+1+i,He=Math.min(Math.floor((L+1)*x)+1,o)+i,{x:We,y:nt}=r[P];for(V=X=-1,ue=Ce;ue<He;ue++)X=.5*Math.abs((We-Y)*(r[ue].y-nt)-(We-r[ue].x)*(J-nt)),X>V&&(V=X,F=r[ue],q=ue);_[s++]=F,P=q}return _[s++]=r[M],_}function M6(r,i,o,c){let h=0,m=0,_,x,s,M,P,L,F,V,X,q;const Y=[],J=i+o-1,ue=r[i].x,fe=r[J].x-ue;for(_=i;_<i+o;++_){x=r[_],s=(x.x-ue)/fe*c,M=x.y;const Ae=s|0;if(Ae===P)M<X?(X=M,L=_):M>q&&(q=M,F=_),h=(m*h+x.x)/++m;else{const Ce=_-1;if(!Jn(L)&&!Jn(F)){const He=Math.min(L,F),We=Math.max(L,F);He!==V&&He!==Ce&&Y.push({...r[He],x:h}),We!==V&&We!==Ce&&Y.push({...r[We],x:h})}_>0&&Ce!==V&&Y.push(r[Ce]),Y.push(x),P=Ae,m=0,X=q=M,L=F=V=_}}return Y}function nk(r){if(r._decimated){const i=r._data;delete r._decimated,delete r._data,Object.defineProperty(r,"data",{configurable:!0,enumerable:!0,writable:!0,value:i})}}function gA(r){r.data.datasets.forEach(i=>{nk(i)})}function E6(r,i){const o=i.length;let c=0,h;const{iScale:m}=r,{min:_,max:x,minDefined:s,maxDefined:M}=m.getUserBounds();return s&&(c=Do(bc(i,m.axis,_).lo,0,o-1)),M?h=Do(bc(i,m.axis,x).hi+1,c,o)-c:h=o-c,{start:c,count:h}}var A6={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(r,i,o)=>{if(!o.enabled){gA(r);return}const c=r.width;r.data.datasets.forEach((h,m)=>{const{_data:_,indexAxis:x}=h,s=r.getDatasetMeta(m),M=_||h.data;if(Ep([x,r.options.indexAxis])==="y"||!s.controller.supportsDecimation)return;const P=r.scales[s.xAxisID];if(P.type!=="linear"&&P.type!=="time"||r.options.parsing)return;let{start:L,count:F}=E6(s,M);const V=o.threshold||4*c;if(F<=V){nk(h);return}Jn(_)&&(h._data=M,delete h.data,Object.defineProperty(h,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(q){this._data=q}}));let X;switch(o.algorithm){case"lttb":X=S6(M,L,F,c,o);break;case"min-max":X=M6(M,L,F,c);break;default:throw new Error(`Unsupported decimation algorithm '${o.algorithm}'`)}h._decimated=X})},destroy(r){gA(r)}};function I6(r,i,o){const c=r.segments,h=r.points,m=i.points,_=[];for(const x of c){let{start:s,end:M}=x;M=qb(s,M,h);const P=jx(o,h[s],h[M],x.loop);if(!i.segments){_.push({source:x,target:P,start:h[s],end:h[M]});continue}const L=NP(i,P);for(const F of L){const V=jx(o,m[F.start],m[F.end],F.loop),X=BP(x,h,V);for(const q of X)_.push({source:q,target:F,start:{[o]:_A(P,V,"start",Math.max)},end:{[o]:_A(P,V,"end",Math.min)}})}}return _}function jx(r,i,o,c){if(c)return;let h=i[r],m=o[r];return r==="angle"&&(h=Qs(h),m=Qs(m)),{property:r,start:h,end:m}}function C6(r,i){const{x:o=null,y:c=null}=r||{},h=i.points,m=[];return i.segments.forEach(({start:_,end:x})=>{x=qb(_,x,h);const s=h[_],M=h[x];c!==null?(m.push({x:s.x,y:c}),m.push({x:M.x,y:c})):o!==null&&(m.push({x:o,y:s.y}),m.push({x:o,y:M.y}))}),m}function qb(r,i,o){for(;i>r;i--){const c=o[i];if(!isNaN(c.x)&&!isNaN(c.y))break}return i}function _A(r,i,o,c){return r&&i?c(r[o],i[o]):r?r[o]:i?i[o]:0}function rk(r,i){let o=[],c=!1;return Or(r)?(c=!0,o=r):o=C6(r,i),o.length?new cu({points:o,options:{tension:0},_loop:c,_fullLoop:c}):null}function yA(r){return r&&r.fill!==!1}function P6(r,i,o){let h=r[i].fill;const m=[i];let _;if(!o)return h;for(;h!==!1&&m.indexOf(h)===-1;){if(!Xr(h))return h;if(_=r[h],!_)return!1;if(_.visible)return h;m.push(h),h=_.fill}return!1}function k6(r,i,o){const c=R6(r);if(zn(c))return isNaN(c.value)?!1:c;let h=parseFloat(c);return Xr(h)&&Math.floor(h)===h?D6(c[0],i,h,o):["origin","start","end","stack","shape"].indexOf(c)>=0&&c}function D6(r,i,o,c){return(r==="-"||r==="+")&&(o=i+o),o===i||o<0||o>=c?!1:o}function L6(r,i){let o=null;return r==="start"?o=i.bottom:r==="end"?o=i.top:zn(r)?o=i.getPixelForValue(r.value):i.getBasePixel&&(o=i.getBasePixel()),o}function O6(r,i,o){let c;return r==="start"?c=o:r==="end"?c=i.options.reverse?i.min:i.max:zn(r)?c=r.value:c=i.getBaseValue(),c}function R6(r){const i=r.options,o=i.fill;let c=bn(o&&o.target,o);return c===void 0&&(c=!!i.backgroundColor),c===!1||c===null?!1:c===!0?"origin":c}function z6(r){const{scale:i,index:o,line:c}=r,h=[],m=c.segments,_=c.points,x=F6(i,o);x.push(rk({x:null,y:i.bottom},c));for(let s=0;s<m.length;s++){const M=m[s];for(let P=M.start;P<=M.end;P++)B6(h,_[P],x)}return new cu({points:h,options:{}})}function F6(r,i){const o=[],c=r.getMatchingVisibleMetas("line");for(let h=0;h<c.length;h++){const m=c[h];if(m.index===i)break;m.hidden||o.unshift(m.dataset)}return o}function B6(r,i,o){const c=[];for(let h=0;h<o.length;h++){const m=o[h],{first:_,last:x,point:s}=N6(m,i,"x");if(!(!s||_&&x)){if(_)c.unshift(s);else if(r.push(s),!x)break}}r.push(...c)}function N6(r,i,o){const c=r.interpolate(i,o);if(!c)return{};const h=c[o],m=r.segments,_=r.points;let x=!1,s=!1;for(let M=0;M<m.length;M++){const P=m[M],L=_[P.start][o],F=_[P.end][o];if(xc(h,L,F)){x=h===L,s=h===F;break}}return{first:x,last:s,point:c}}class ok{constructor(i){this.x=i.x,this.y=i.y,this.radius=i.radius}pathSegment(i,o,c){const{x:h,y:m,radius:_}=this;return o=o||{start:0,end:Rr},i.arc(h,m,_,o.end,o.start,!0),!c.bounds}interpolate(i){const{x:o,y:c,radius:h}=this,m=i.angle;return{x:o+Math.cos(m)*h,y:c+Math.sin(m)*h,angle:m}}}function V6(r){const{chart:i,fill:o,line:c}=r;if(Xr(o))return U6(i,o);if(o==="stack")return z6(r);if(o==="shape")return!0;const h=j6(r);return h instanceof ok?h:rk(h,c)}function U6(r,i){const o=r.getDatasetMeta(i);return o&&r.isDatasetVisible(i)?o.dataset:null}function j6(r){return(r.scale||{}).getPointPositionForValue?H6(r):G6(r)}function G6(r){const{scale:i={},fill:o}=r,c=L6(o,i);if(Xr(c)){const h=i.isHorizontal();return{x:h?c:null,y:h?null:c}}return null}function H6(r){const{scale:i,fill:o}=r,c=i.options,h=i.getLabels().length,m=c.reverse?i.max:i.min,_=O6(o,i,m),x=[];if(c.grid.circular){const s=i.getPointPositionForValue(0,m);return new ok({x:s.x,y:s.y,radius:i.getDistanceFromCenterForValue(_)})}for(let s=0;s<h;++s)x.push(i.getPointPositionForValue(s,_));return x}function lx(r,i,o){const c=V6(i),{line:h,scale:m,axis:_}=i,x=h.options,s=x.fill,M=x.backgroundColor,{above:P=M,below:L=M}=s||{};c&&h.points.length&&(My(r,o),q6(r,{line:h,target:c,above:P,below:L,area:o,scale:m,axis:_}),Ey(r))}function q6(r,i){const{line:o,target:c,above:h,below:m,area:_,scale:x}=i,s=o._loop?"angle":i.axis;r.save(),s==="x"&&m!==h&&(vA(r,c,_.top),xA(r,{line:o,target:c,color:h,scale:x,property:s}),r.restore(),r.save(),vA(r,c,_.bottom)),xA(r,{line:o,target:c,color:m,scale:x,property:s}),r.restore()}function vA(r,i,o){const{segments:c,points:h}=i;let m=!0,_=!1;r.beginPath();for(const x of c){const{start:s,end:M}=x,P=h[s],L=h[qb(s,M,h)];m?(r.moveTo(P.x,P.y),m=!1):(r.lineTo(P.x,o),r.lineTo(P.x,P.y)),_=!!i.pathSegment(r,x,{move:_}),_?r.closePath():r.lineTo(L.x,o)}r.lineTo(i.first().x,o),r.closePath(),r.clip()}function xA(r,i){const{line:o,target:c,property:h,color:m,scale:_}=i,x=I6(o,c,h);for(const{source:s,target:M,start:P,end:L}of x){const{style:{backgroundColor:F=m}={}}=s,V=c!==!0;r.save(),r.fillStyle=F,W6(r,_,V&&jx(h,P,L)),r.beginPath();const X=!!o.pathSegment(r,s);let q;if(V){X?r.closePath():bA(r,c,L,h);const Y=!!c.pathSegment(r,M,{move:X,reverse:!0});q=X&&Y,q||bA(r,c,P,h)}r.closePath(),r.fill(q?"evenodd":"nonzero"),r.restore()}}function W6(r,i,o){const{top:c,bottom:h}=i.chart.chartArea,{property:m,start:_,end:x}=o||{};m==="x"&&(r.beginPath(),r.rect(_,c,x-_,h-c),r.clip())}function bA(r,i,o,c){const h=i.interpolate(o,c);h&&r.lineTo(h.x,h.y)}var Z6={id:"filler",afterDatasetsUpdate(r,i,o){const c=(r.data.datasets||[]).length,h=[];let m,_,x,s;for(_=0;_<c;++_)m=r.getDatasetMeta(_),x=m.dataset,s=null,x&&x.options&&x instanceof cu&&(s={visible:r.isDatasetVisible(_),index:_,fill:k6(x,_,c),chart:r,axis:m.controller.options.indexAxis,scale:m.vScale,line:x}),m.$filler=s,h.push(s);for(_=0;_<c;++_)s=h[_],!(!s||s.fill===!1)&&(s.fill=P6(h,_,o.propagate))},beforeDraw(r,i,o){const c=o.drawTime==="beforeDraw",h=r.getSortedVisibleDatasetMetas(),m=r.chartArea;for(let _=h.length-1;_>=0;--_){const x=h[_].$filler;x&&(x.line.updateControlPoints(m,x.axis),c&&x.fill&&lx(r.ctx,x,m))}},beforeDatasetsDraw(r,i,o){if(o.drawTime!=="beforeDatasetsDraw")return;const c=r.getSortedVisibleDatasetMetas();for(let h=c.length-1;h>=0;--h){const m=c[h].$filler;yA(m)&&lx(r.ctx,m,r.chartArea)}},beforeDatasetDraw(r,i,o){const c=i.meta.$filler;!yA(c)||o.drawTime!=="beforeDatasetDraw"||lx(r.ctx,c,r.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const wA=(r,i)=>{let{boxHeight:o=i,boxWidth:c=i}=r;return r.usePointStyle&&(o=Math.min(o,i),c=r.pointStyleWidth||Math.min(c,i)),{boxWidth:c,boxHeight:o,itemHeight:Math.max(i,o)}},X6=(r,i)=>r!==null&&i!==null&&r.datasetIndex===i.datasetIndex&&r.index===i.index;class TA extends Ya{constructor(i){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=i.chart,this.options=i.options,this.ctx=i.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(i,o,c){this.maxWidth=i,this.maxHeight=o,this._margins=c,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const i=this.options.labels||{};let o=Ir(i.generateLabels,[this.chart],this)||[];i.filter&&(o=o.filter(c=>i.filter(c,this.chart.data))),i.sort&&(o=o.sort((c,h)=>i.sort(c,h,this.chart.data))),this.options.reverse&&o.reverse(),this.legendItems=o}fit(){const{options:i,ctx:o}=this;if(!i.display){this.width=this.height=0;return}const c=i.labels,h=So(c.font),m=h.size,_=this._computeTitleHeight(),{boxWidth:x,itemHeight:s}=wA(c,m);let M,P;o.font=h.string,this.isHorizontal()?(M=this.maxWidth,P=this._fitRows(_,m,x,s)+10):(P=this.maxHeight,M=this._fitCols(_,h,x,s)+10),this.width=Math.min(M,i.maxWidth||this.maxWidth),this.height=Math.min(P,i.maxHeight||this.maxHeight)}_fitRows(i,o,c,h){const{ctx:m,maxWidth:_,options:{labels:{padding:x}}}=this,s=this.legendHitBoxes=[],M=this.lineWidths=[0],P=h+x;let L=i;m.textAlign="left",m.textBaseline="middle";let F=-1,V=-P;return this.legendItems.forEach((X,q)=>{const Y=c+o/2+m.measureText(X.text).width;(q===0||M[M.length-1]+Y+2*x>_)&&(L+=P,M[M.length-(q>0?0:1)]=0,V+=P,F++),s[q]={left:0,top:V,row:F,width:Y,height:h},M[M.length-1]+=Y+x}),L}_fitCols(i,o,c,h){const{ctx:m,maxHeight:_,options:{labels:{padding:x}}}=this,s=this.legendHitBoxes=[],M=this.columnSizes=[],P=_-i;let L=x,F=0,V=0,X=0,q=0;return this.legendItems.forEach((Y,J)=>{const{itemWidth:ue,itemHeight:ce}=Y6(c,o,m,Y,h);J>0&&V+ce+2*x>P&&(L+=F+x,M.push({width:F,height:V}),X+=F+x,q++,F=V=0),s[J]={left:X,top:V,col:q,width:ue,height:ce},F=Math.max(F,ue),V+=ce+x}),L+=F,M.push({width:F,height:V}),L}adjustHitBoxes(){if(!this.options.display)return;const i=this._computeTitleHeight(),{legendHitBoxes:o,options:{align:c,labels:{padding:h},rtl:m}}=this,_=Fd(m,this.left,this.width);if(this.isHorizontal()){let x=0,s=es(c,this.left+h,this.right-this.lineWidths[x]);for(const M of o)x!==M.row&&(x=M.row,s=es(c,this.left+h,this.right-this.lineWidths[x])),M.top+=this.top+i+h,M.left=_.leftForLtr(_.x(s),M.width),s+=M.width+h}else{let x=0,s=es(c,this.top+i+h,this.bottom-this.columnSizes[x].height);for(const M of o)M.col!==x&&(x=M.col,s=es(c,this.top+i+h,this.bottom-this.columnSizes[x].height)),M.top=s,M.left+=this.left+h,M.left=_.leftForLtr(_.x(M.left),M.width),s+=M.height+h}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const i=this.ctx;My(i,this),this._draw(),Ey(i)}}_draw(){const{options:i,columnSizes:o,lineWidths:c,ctx:h}=this,{align:m,labels:_}=i,x=Yr.color,s=Fd(i.rtl,this.left,this.width),M=So(_.font),{padding:P}=_,L=M.size,F=L/2;let V;this.drawTitle(),h.textAlign=s.textAlign("left"),h.textBaseline="middle",h.lineWidth=.5,h.font=M.string;const{boxWidth:X,boxHeight:q,itemHeight:Y}=wA(_,L),J=function(Ce,He,We){if(isNaN(X)||X<=0||isNaN(q)||q<0)return;h.save();const nt=bn(We.lineWidth,1);if(h.fillStyle=bn(We.fillStyle,x),h.lineCap=bn(We.lineCap,"butt"),h.lineDashOffset=bn(We.lineDashOffset,0),h.lineJoin=bn(We.lineJoin,"miter"),h.lineWidth=nt,h.strokeStyle=bn(We.strokeStyle,x),h.setLineDash(bn(We.lineDash,[])),_.usePointStyle){const we={radius:q*Math.SQRT2/2,pointStyle:We.pointStyle,rotation:We.rotation,borderWidth:nt},ht=s.xPlus(Ce,X/2),pt=He+F;AP(h,we,ht,pt,_.pointStyleWidth&&X)}else{const we=He+Math.max((L-q)/2,0),ht=s.leftForLtr(Ce,X),pt=Ih(We.borderRadius);h.beginPath(),Object.values(pt).some(Xe=>Xe!==0)?Yp(h,{x:ht,y:we,w:X,h:q,radius:pt}):h.rect(ht,we,X,q),h.fill(),nt!==0&&h.stroke()}h.restore()},ue=function(Ce,He,We){Fh(h,We.text,Ce,He+Y/2,M,{strikethrough:We.hidden,textAlign:s.textAlign(We.textAlign)})},ce=this.isHorizontal(),fe=this._computeTitleHeight();ce?V={x:es(m,this.left+P,this.right-c[0]),y:this.top+P+fe,line:0}:V={x:this.left+P,y:es(m,this.top+fe+P,this.bottom-o[0].height),line:0},RP(this.ctx,i.textDirection);const Ae=Y+P;this.legendItems.forEach((Ce,He)=>{h.strokeStyle=Ce.fontColor,h.fillStyle=Ce.fontColor;const We=h.measureText(Ce.text).width,nt=s.textAlign(Ce.textAlign||(Ce.textAlign=_.textAlign)),we=X+F+We;let ht=V.x,pt=V.y;s.setWidth(this.width),ce?He>0&&ht+we+P>this.right&&(pt=V.y+=Ae,V.line++,ht=V.x=es(m,this.left+P,this.right-c[V.line])):He>0&&pt+Ae>this.bottom&&(ht=V.x=ht+o[V.line].width+P,V.line++,pt=V.y=es(m,this.top+fe+P,this.bottom-o[V.line].height));const Xe=s.x(ht);if(J(Xe,pt,Ce),ht=g5(nt,ht+X+F,ce?ht+we:this.right,i.rtl),ue(s.x(ht),pt,Ce),ce)V.x+=we+P;else if(typeof Ce.text!="string"){const mt=M.lineHeight;V.y+=sk(Ce,mt)+P}else V.y+=Ae}),zP(this.ctx,i.textDirection)}drawTitle(){const i=this.options,o=i.title,c=So(o.font),h=ns(o.padding);if(!o.display)return;const m=Fd(i.rtl,this.left,this.width),_=this.ctx,x=o.position,s=c.size/2,M=h.top+s;let P,L=this.left,F=this.width;if(this.isHorizontal())F=Math.max(...this.lineWidths),P=this.top+M,L=es(i.align,L,this.right-F);else{const X=this.columnSizes.reduce((q,Y)=>Math.max(q,Y.height),0);P=M+es(i.align,this.top,this.bottom-X-i.labels.padding-this._computeTitleHeight())}const V=es(x,L,L+F);_.textAlign=m.textAlign(zb(x)),_.textBaseline="middle",_.strokeStyle=o.color,_.fillStyle=o.color,_.font=c.string,Fh(_,o.text,V,P,c)}_computeTitleHeight(){const i=this.options.title,o=So(i.font),c=ns(i.padding);return i.display?o.lineHeight+c.height:0}_getLegendItemAt(i,o){let c,h,m;if(xc(i,this.left,this.right)&&xc(o,this.top,this.bottom)){for(m=this.legendHitBoxes,c=0;c<m.length;++c)if(h=m[c],xc(i,h.left,h.left+h.width)&&xc(o,h.top,h.top+h.height))return this.legendItems[c]}return null}handleEvent(i){const o=this.options;if(!$6(i.type,o))return;const c=this._getLegendItemAt(i.x,i.y);if(i.type==="mousemove"||i.type==="mouseout"){const h=this._hoveredItem,m=X6(h,c);h&&!m&&Ir(o.onLeave,[i,h,this],this),this._hoveredItem=c,c&&!m&&Ir(o.onHover,[i,c,this],this)}else c&&Ir(o.onClick,[i,c,this],this)}}function Y6(r,i,o,c,h){const m=J6(c,r,i,o),_=K6(h,c,i.lineHeight);return{itemWidth:m,itemHeight:_}}function J6(r,i,o,c){let h=r.text;return h&&typeof h!="string"&&(h=h.reduce((m,_)=>m.length>_.length?m:_)),i+o.size/2+c.measureText(h).width}function K6(r,i,o){let c=r;return typeof i.text!="string"&&(c=sk(i,o)),c}function sk(r,i){const o=r.text?r.text.length:0;return i*o}function $6(r,i){return!!((r==="mousemove"||r==="mouseout")&&(i.onHover||i.onLeave)||i.onClick&&(r==="click"||r==="mouseup"))}var Q6={id:"legend",_element:TA,start(r,i,o){const c=r.legend=new TA({ctx:r.ctx,options:o,chart:r});ts.configure(r,c,o),ts.addBox(r,c)},stop(r){ts.removeBox(r,r.legend),delete r.legend},beforeUpdate(r,i,o){const c=r.legend;ts.configure(r,c,o),c.options=o},afterUpdate(r){const i=r.legend;i.buildLabels(),i.adjustHitBoxes()},afterEvent(r,i){i.replay||r.legend.handleEvent(i.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(r,i,o){const c=i.datasetIndex,h=o.chart;h.isDatasetVisible(c)?(h.hide(c),i.hidden=!0):(h.show(c),i.hidden=!1)},onHover:null,onLeave:null,labels:{color:r=>r.chart.options.color,boxWidth:40,padding:10,generateLabels(r){const i=r.data.datasets,{labels:{usePointStyle:o,pointStyle:c,textAlign:h,color:m,useBorderRadius:_,borderRadius:x}}=r.legend.options;return r._getSortedDatasetMetas().map(s=>{const M=s.controller.getStyle(o?0:void 0),P=ns(M.borderWidth);return{text:i[s.index].label,fillStyle:M.backgroundColor,fontColor:m,hidden:!s.visible,lineCap:M.borderCapStyle,lineDash:M.borderDash,lineDashOffset:M.borderDashOffset,lineJoin:M.borderJoinStyle,lineWidth:(P.width+P.height)/4,strokeStyle:M.borderColor,pointStyle:c||M.pointStyle,rotation:M.rotation,textAlign:h||M.textAlign,borderRadius:_&&(x||M.borderRadius),datasetIndex:s.index}},this)}},title:{color:r=>r.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:r=>!r.startsWith("on"),labels:{_scriptable:r=>!["generateLabels","filter","sort"].includes(r)}}};class Wb extends Ya{constructor(i){super(),this.chart=i.chart,this.options=i.options,this.ctx=i.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(i,o){const c=this.options;if(this.left=0,this.top=0,!c.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=i,this.height=this.bottom=o;const h=Or(c.text)?c.text.length:1;this._padding=ns(c.padding);const m=h*So(c.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=m:this.width=m}isHorizontal(){const i=this.options.position;return i==="top"||i==="bottom"}_drawArgs(i){const{top:o,left:c,bottom:h,right:m,options:_}=this,x=_.align;let s=0,M,P,L;return this.isHorizontal()?(P=es(x,c,m),L=o+i,M=m-c):(_.position==="left"?(P=c+i,L=es(x,h,o),s=zr*-.5):(P=m-i,L=es(x,o,h),s=zr*.5),M=h-o),{titleX:P,titleY:L,maxWidth:M,rotation:s}}draw(){const i=this.ctx,o=this.options;if(!o.display)return;const c=So(o.font),m=c.lineHeight/2+this._padding.top,{titleX:_,titleY:x,maxWidth:s,rotation:M}=this._drawArgs(m);Fh(i,o.text,0,0,c,{color:o.color,maxWidth:s,rotation:M,textAlign:zb(o.align),textBaseline:"middle",translation:[_,x]})}}function eV(r,i){const o=new Wb({ctx:r.ctx,options:i,chart:r});ts.configure(r,o,i),ts.addBox(r,o),r.titleBlock=o}var tV={id:"title",_element:Wb,start(r,i,o){eV(r,o)},stop(r){const i=r.titleBlock;ts.removeBox(r,i),delete r.titleBlock},beforeUpdate(r,i,o){const c=r.titleBlock;ts.configure(r,c,o),c.options=o},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const s_=new WeakMap;var iV={id:"subtitle",start(r,i,o){const c=new Wb({ctx:r.ctx,options:o,chart:r});ts.configure(r,c,o),ts.addBox(r,c),s_.set(r,c)},stop(r){ts.removeBox(r,s_.get(r)),s_.delete(r)},beforeUpdate(r,i,o){const c=s_.get(r);ts.configure(r,c,o),c.options=o},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Cp={average(r){if(!r.length)return!1;let i,o,c=new Set,h=0,m=0;for(i=0,o=r.length;i<o;++i){const x=r[i].element;if(x&&x.hasValue()){const s=x.tooltipPosition();c.add(s.x),h+=s.y,++m}}return{x:[...c].reduce((x,s)=>x+s)/c.size,y:h/m}},nearest(r,i){if(!r.length)return!1;let o=i.x,c=i.y,h=Number.POSITIVE_INFINITY,m,_,x;for(m=0,_=r.length;m<_;++m){const s=r[m].element;if(s&&s.hasValue()){const M=s.getCenterPoint(),P=Ox(i,M);P<h&&(h=P,x=s)}}if(x){const s=x.tooltipPosition();o=s.x,c=s.y}return{x:o,y:c}}};function vl(r,i){return i&&(Or(i)?Array.prototype.push.apply(r,i):r.push(i)),r}function gc(r){return(typeof r=="string"||r instanceof String)&&r.indexOf(`
`)>-1?r.split(`
`):r}function nV(r,i){const{element:o,datasetIndex:c,index:h}=i,m=r.getDatasetMeta(c).controller,{label:_,value:x}=m.getLabelAndValue(h);return{chart:r,label:_,parsed:m.getParsed(h),raw:r.data.datasets[c].data[h],formattedValue:x,dataset:m.getDataset(),dataIndex:h,datasetIndex:c,element:o}}function SA(r,i){const o=r.chart.ctx,{body:c,footer:h,title:m}=r,{boxWidth:_,boxHeight:x}=i,s=So(i.bodyFont),M=So(i.titleFont),P=So(i.footerFont),L=m.length,F=h.length,V=c.length,X=ns(i.padding);let q=X.height,Y=0,J=c.reduce((fe,Ae)=>fe+Ae.before.length+Ae.lines.length+Ae.after.length,0);if(J+=r.beforeBody.length+r.afterBody.length,L&&(q+=L*M.lineHeight+(L-1)*i.titleSpacing+i.titleMarginBottom),J){const fe=i.displayColors?Math.max(x,s.lineHeight):s.lineHeight;q+=V*fe+(J-V)*s.lineHeight+(J-1)*i.bodySpacing}F&&(q+=i.footerMarginTop+F*P.lineHeight+(F-1)*i.footerSpacing);let ue=0;const ce=function(fe){Y=Math.max(Y,o.measureText(fe).width+ue)};return o.save(),o.font=M.string,gr(r.title,ce),o.font=s.string,gr(r.beforeBody.concat(r.afterBody),ce),ue=i.displayColors?_+2+i.boxPadding:0,gr(c,fe=>{gr(fe.before,ce),gr(fe.lines,ce),gr(fe.after,ce)}),ue=0,o.font=P.string,gr(r.footer,ce),o.restore(),Y+=X.width,{width:Y,height:q}}function rV(r,i){const{y:o,height:c}=i;return o<c/2?"top":o>r.height-c/2?"bottom":"center"}function oV(r,i,o,c){const{x:h,width:m}=c,_=o.caretSize+o.caretPadding;if(r==="left"&&h+m+_>i.width||r==="right"&&h-m-_<0)return!0}function sV(r,i,o,c){const{x:h,width:m}=o,{width:_,chartArea:{left:x,right:s}}=r;let M="center";return c==="center"?M=h<=(x+s)/2?"left":"right":h<=m/2?M="left":h>=_-m/2&&(M="right"),oV(M,r,i,o)&&(M="center"),M}function MA(r,i,o){const c=o.yAlign||i.yAlign||rV(r,o);return{xAlign:o.xAlign||i.xAlign||sV(r,i,o,c),yAlign:c}}function aV(r,i){let{x:o,width:c}=r;return i==="right"?o-=c:i==="center"&&(o-=c/2),o}function lV(r,i,o){let{y:c,height:h}=r;return i==="top"?c+=o:i==="bottom"?c-=h+o:c-=h/2,c}function EA(r,i,o,c){const{caretSize:h,caretPadding:m,cornerRadius:_}=r,{xAlign:x,yAlign:s}=o,M=h+m,{topLeft:P,topRight:L,bottomLeft:F,bottomRight:V}=Ih(_);let X=aV(i,x);const q=lV(i,s,M);return s==="center"?x==="left"?X+=M:x==="right"&&(X-=M):x==="left"?X-=Math.max(P,F)+h:x==="right"&&(X+=Math.max(L,V)+h),{x:Do(X,0,c.width-i.width),y:Do(q,0,c.height-i.height)}}function a_(r,i,o){const c=ns(o.padding);return i==="center"?r.x+r.width/2:i==="right"?r.x+r.width-c.right:r.x+c.left}function AA(r){return vl([],gc(r))}function cV(r,i,o){return gu(r,{tooltip:i,tooltipItems:o,type:"tooltip"})}function IA(r,i){const o=i&&i.dataset&&i.dataset.tooltip&&i.dataset.tooltip.callbacks;return o?r.override(o):r}const ak={beforeTitle:dc,title(r){if(r.length>0){const i=r[0],o=i.chart.data.labels,c=o?o.length:0;if(this&&this.options&&this.options.mode==="dataset")return i.dataset.label||"";if(i.label)return i.label;if(c>0&&i.dataIndex<c)return o[i.dataIndex]}return""},afterTitle:dc,beforeBody:dc,beforeLabel:dc,label(r){if(this&&this.options&&this.options.mode==="dataset")return r.label+": "+r.formattedValue||r.formattedValue;let i=r.dataset.label||"";i&&(i+=": ");const o=r.formattedValue;return Jn(o)||(i+=o),i},labelColor(r){const o=r.chart.getDatasetMeta(r.datasetIndex).controller.getStyle(r.dataIndex);return{borderColor:o.borderColor,backgroundColor:o.backgroundColor,borderWidth:o.borderWidth,borderDash:o.borderDash,borderDashOffset:o.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(r){const o=r.chart.getDatasetMeta(r.datasetIndex).controller.getStyle(r.dataIndex);return{pointStyle:o.pointStyle,rotation:o.rotation}},afterLabel:dc,afterBody:dc,beforeFooter:dc,footer:dc,afterFooter:dc};function Ls(r,i,o,c){const h=r[i].call(o,c);return typeof h>"u"?ak[i].call(o,c):h}class Gx extends Ya{constructor(i){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=i.chart,this.options=i.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(i){this.options=i,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const i=this._cachedAnimations;if(i)return i;const o=this.chart,c=this.options.setContext(this.getContext()),h=c.enabled&&o.options.animation&&c.animations,m=new VP(this.chart,h);return h._cacheable&&(this._cachedAnimations=Object.freeze(m)),m}getContext(){return this.$context||(this.$context=cV(this.chart.getContext(),this,this._tooltipItems))}getTitle(i,o){const{callbacks:c}=o,h=Ls(c,"beforeTitle",this,i),m=Ls(c,"title",this,i),_=Ls(c,"afterTitle",this,i);let x=[];return x=vl(x,gc(h)),x=vl(x,gc(m)),x=vl(x,gc(_)),x}getBeforeBody(i,o){return AA(Ls(o.callbacks,"beforeBody",this,i))}getBody(i,o){const{callbacks:c}=o,h=[];return gr(i,m=>{const _={before:[],lines:[],after:[]},x=IA(c,m);vl(_.before,gc(Ls(x,"beforeLabel",this,m))),vl(_.lines,Ls(x,"label",this,m)),vl(_.after,gc(Ls(x,"afterLabel",this,m))),h.push(_)}),h}getAfterBody(i,o){return AA(Ls(o.callbacks,"afterBody",this,i))}getFooter(i,o){const{callbacks:c}=o,h=Ls(c,"beforeFooter",this,i),m=Ls(c,"footer",this,i),_=Ls(c,"afterFooter",this,i);let x=[];return x=vl(x,gc(h)),x=vl(x,gc(m)),x=vl(x,gc(_)),x}_createItems(i){const o=this._active,c=this.chart.data,h=[],m=[],_=[];let x=[],s,M;for(s=0,M=o.length;s<M;++s)x.push(nV(this.chart,o[s]));return i.filter&&(x=x.filter((P,L,F)=>i.filter(P,L,F,c))),i.itemSort&&(x=x.sort((P,L)=>i.itemSort(P,L,c))),gr(x,P=>{const L=IA(i.callbacks,P);h.push(Ls(L,"labelColor",this,P)),m.push(Ls(L,"labelPointStyle",this,P)),_.push(Ls(L,"labelTextColor",this,P))}),this.labelColors=h,this.labelPointStyles=m,this.labelTextColors=_,this.dataPoints=x,x}update(i,o){const c=this.options.setContext(this.getContext()),h=this._active;let m,_=[];if(!h.length)this.opacity!==0&&(m={opacity:0});else{const x=Cp[c.position].call(this,h,this._eventPosition);_=this._createItems(c),this.title=this.getTitle(_,c),this.beforeBody=this.getBeforeBody(_,c),this.body=this.getBody(_,c),this.afterBody=this.getAfterBody(_,c),this.footer=this.getFooter(_,c);const s=this._size=SA(this,c),M=Object.assign({},x,s),P=MA(this.chart,c,M),L=EA(c,M,P,this.chart);this.xAlign=P.xAlign,this.yAlign=P.yAlign,m={opacity:1,x:L.x,y:L.y,width:s.width,height:s.height,caretX:x.x,caretY:x.y}}this._tooltipItems=_,this.$context=void 0,m&&this._resolveAnimations().update(this,m),i&&c.external&&c.external.call(this,{chart:this.chart,tooltip:this,replay:o})}drawCaret(i,o,c,h){const m=this.getCaretPosition(i,c,h);o.lineTo(m.x1,m.y1),o.lineTo(m.x2,m.y2),o.lineTo(m.x3,m.y3)}getCaretPosition(i,o,c){const{xAlign:h,yAlign:m}=this,{caretSize:_,cornerRadius:x}=c,{topLeft:s,topRight:M,bottomLeft:P,bottomRight:L}=Ih(x),{x:F,y:V}=i,{width:X,height:q}=o;let Y,J,ue,ce,fe,Ae;return m==="center"?(fe=V+q/2,h==="left"?(Y=F,J=Y-_,ce=fe+_,Ae=fe-_):(Y=F+X,J=Y+_,ce=fe-_,Ae=fe+_),ue=Y):(h==="left"?J=F+Math.max(s,P)+_:h==="right"?J=F+X-Math.max(M,L)-_:J=this.caretX,m==="top"?(ce=V,fe=ce-_,Y=J-_,ue=J+_):(ce=V+q,fe=ce+_,Y=J+_,ue=J-_),Ae=ce),{x1:Y,x2:J,x3:ue,y1:ce,y2:fe,y3:Ae}}drawTitle(i,o,c){const h=this.title,m=h.length;let _,x,s;if(m){const M=Fd(c.rtl,this.x,this.width);for(i.x=a_(this,c.titleAlign,c),o.textAlign=M.textAlign(c.titleAlign),o.textBaseline="middle",_=So(c.titleFont),x=c.titleSpacing,o.fillStyle=c.titleColor,o.font=_.string,s=0;s<m;++s)o.fillText(h[s],M.x(i.x),i.y+_.lineHeight/2),i.y+=_.lineHeight+x,s+1===m&&(i.y+=c.titleMarginBottom-x)}}_drawColorBox(i,o,c,h,m){const _=this.labelColors[c],x=this.labelPointStyles[c],{boxHeight:s,boxWidth:M}=m,P=So(m.bodyFont),L=a_(this,"left",m),F=h.x(L),V=s<P.lineHeight?(P.lineHeight-s)/2:0,X=o.y+V;if(m.usePointStyle){const q={radius:Math.min(M,s)/2,pointStyle:x.pointStyle,rotation:x.rotation,borderWidth:1},Y=h.leftForLtr(F,M)+M/2,J=X+s/2;i.strokeStyle=m.multiKeyBackground,i.fillStyle=m.multiKeyBackground,zx(i,q,Y,J),i.strokeStyle=_.borderColor,i.fillStyle=_.backgroundColor,zx(i,q,Y,J)}else{i.lineWidth=zn(_.borderWidth)?Math.max(...Object.values(_.borderWidth)):_.borderWidth||1,i.strokeStyle=_.borderColor,i.setLineDash(_.borderDash||[]),i.lineDashOffset=_.borderDashOffset||0;const q=h.leftForLtr(F,M),Y=h.leftForLtr(h.xPlus(F,1),M-2),J=Ih(_.borderRadius);Object.values(J).some(ue=>ue!==0)?(i.beginPath(),i.fillStyle=m.multiKeyBackground,Yp(i,{x:q,y:X,w:M,h:s,radius:J}),i.fill(),i.stroke(),i.fillStyle=_.backgroundColor,i.beginPath(),Yp(i,{x:Y,y:X+1,w:M-2,h:s-2,radius:J}),i.fill()):(i.fillStyle=m.multiKeyBackground,i.fillRect(q,X,M,s),i.strokeRect(q,X,M,s),i.fillStyle=_.backgroundColor,i.fillRect(Y,X+1,M-2,s-2))}i.fillStyle=this.labelTextColors[c]}drawBody(i,o,c){const{body:h}=this,{bodySpacing:m,bodyAlign:_,displayColors:x,boxHeight:s,boxWidth:M,boxPadding:P}=c,L=So(c.bodyFont);let F=L.lineHeight,V=0;const X=Fd(c.rtl,this.x,this.width),q=function(We){o.fillText(We,X.x(i.x+V),i.y+F/2),i.y+=F+m},Y=X.textAlign(_);let J,ue,ce,fe,Ae,Ce,He;for(o.textAlign=_,o.textBaseline="middle",o.font=L.string,i.x=a_(this,Y,c),o.fillStyle=c.bodyColor,gr(this.beforeBody,q),V=x&&Y!=="right"?_==="center"?M/2+P:M+2+P:0,fe=0,Ce=h.length;fe<Ce;++fe){for(J=h[fe],ue=this.labelTextColors[fe],o.fillStyle=ue,gr(J.before,q),ce=J.lines,x&&ce.length&&(this._drawColorBox(o,i,fe,X,c),F=Math.max(L.lineHeight,s)),Ae=0,He=ce.length;Ae<He;++Ae)q(ce[Ae]),F=L.lineHeight;gr(J.after,q)}V=0,F=L.lineHeight,gr(this.afterBody,q),i.y-=m}drawFooter(i,o,c){const h=this.footer,m=h.length;let _,x;if(m){const s=Fd(c.rtl,this.x,this.width);for(i.x=a_(this,c.footerAlign,c),i.y+=c.footerMarginTop,o.textAlign=s.textAlign(c.footerAlign),o.textBaseline="middle",_=So(c.footerFont),o.fillStyle=c.footerColor,o.font=_.string,x=0;x<m;++x)o.fillText(h[x],s.x(i.x),i.y+_.lineHeight/2),i.y+=_.lineHeight+c.footerSpacing}}drawBackground(i,o,c,h){const{xAlign:m,yAlign:_}=this,{x,y:s}=i,{width:M,height:P}=c,{topLeft:L,topRight:F,bottomLeft:V,bottomRight:X}=Ih(h.cornerRadius);o.fillStyle=h.backgroundColor,o.strokeStyle=h.borderColor,o.lineWidth=h.borderWidth,o.beginPath(),o.moveTo(x+L,s),_==="top"&&this.drawCaret(i,o,c,h),o.lineTo(x+M-F,s),o.quadraticCurveTo(x+M,s,x+M,s+F),_==="center"&&m==="right"&&this.drawCaret(i,o,c,h),o.lineTo(x+M,s+P-X),o.quadraticCurveTo(x+M,s+P,x+M-X,s+P),_==="bottom"&&this.drawCaret(i,o,c,h),o.lineTo(x+V,s+P),o.quadraticCurveTo(x,s+P,x,s+P-V),_==="center"&&m==="left"&&this.drawCaret(i,o,c,h),o.lineTo(x,s+L),o.quadraticCurveTo(x,s,x+L,s),o.closePath(),o.fill(),h.borderWidth>0&&o.stroke()}_updateAnimationTarget(i){const o=this.chart,c=this.$animations,h=c&&c.x,m=c&&c.y;if(h||m){const _=Cp[i.position].call(this,this._active,this._eventPosition);if(!_)return;const x=this._size=SA(this,i),s=Object.assign({},_,this._size),M=MA(o,i,s),P=EA(i,s,M,o);(h._to!==P.x||m._to!==P.y)&&(this.xAlign=M.xAlign,this.yAlign=M.yAlign,this.width=x.width,this.height=x.height,this.caretX=_.x,this.caretY=_.y,this._resolveAnimations().update(this,P))}}_willRender(){return!!this.opacity}draw(i){const o=this.options.setContext(this.getContext());let c=this.opacity;if(!c)return;this._updateAnimationTarget(o);const h={width:this.width,height:this.height},m={x:this.x,y:this.y};c=Math.abs(c)<.001?0:c;const _=ns(o.padding),x=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;o.enabled&&x&&(i.save(),i.globalAlpha=c,this.drawBackground(m,i,h,o),RP(i,o.textDirection),m.y+=_.top,this.drawTitle(m,i,o),this.drawBody(m,i,o),this.drawFooter(m,i,o),zP(i,o.textDirection),i.restore())}getActiveElements(){return this._active||[]}setActiveElements(i,o){const c=this._active,h=i.map(({datasetIndex:x,index:s})=>{const M=this.chart.getDatasetMeta(x);if(!M)throw new Error("Cannot find a dataset at index "+x);return{datasetIndex:x,element:M.data[s],index:s}}),m=!W_(c,h),_=this._positionChanged(h,o);(m||_)&&(this._active=h,this._eventPosition=o,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(i,o,c=!0){if(o&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const h=this.options,m=this._active||[],_=this._getActiveElements(i,m,o,c),x=this._positionChanged(_,i),s=o||!W_(_,m)||x;return s&&(this._active=_,(h.enabled||h.external)&&(this._eventPosition={x:i.x,y:i.y},this.update(!0,o))),s}_getActiveElements(i,o,c,h){const m=this.options;if(i.type==="mouseout")return[];if(!h)return o.filter(x=>this.chart.data.datasets[x.datasetIndex]&&this.chart.getDatasetMeta(x.datasetIndex).controller.getParsed(x.index)!==void 0);const _=this.chart.getElementsAtEventForMode(i,m.mode,m,c);return m.reverse&&_.reverse(),_}_positionChanged(i,o){const{caretX:c,caretY:h,options:m}=this,_=Cp[m.position].call(this,i,o);return _!==!1&&(c!==_.x||h!==_.y)}}bi(Gx,"positioners",Cp);var uV={id:"tooltip",_element:Gx,positioners:Cp,afterInit(r,i,o){o&&(r.tooltip=new Gx({chart:r,options:o}))},beforeUpdate(r,i,o){r.tooltip&&r.tooltip.initialize(o)},reset(r,i,o){r.tooltip&&r.tooltip.initialize(o)},afterDraw(r){const i=r.tooltip;if(i&&i._willRender()){const o={tooltip:i};if(r.notifyPlugins("beforeTooltipDraw",{...o,cancelable:!0})===!1)return;i.draw(r.ctx),r.notifyPlugins("afterTooltipDraw",o)}},afterEvent(r,i){if(r.tooltip){const o=i.replay;r.tooltip.handleEvent(i.event,o,i.inChartArea)&&(i.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(r,i)=>i.bodyFont.size,boxWidth:(r,i)=>i.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:ak},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:r=>r!=="filter"&&r!=="itemSort"&&r!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},hV=Object.freeze({__proto__:null,Colors:T6,Decimation:A6,Filler:Z6,Legend:Q6,SubTitle:iV,Title:tV,Tooltip:uV});const dV=(r,i,o,c)=>(typeof i=="string"?(o=r.push(i)-1,c.unshift({index:o,label:i})):isNaN(i)&&(o=null),o);function fV(r,i,o,c){const h=r.indexOf(i);if(h===-1)return dV(r,i,o,c);const m=r.lastIndexOf(i);return h!==m?o:h}const pV=(r,i)=>r===null?null:Do(Math.round(r),0,i);function CA(r){const i=this.getLabels();return r>=0&&r<i.length?i[r]:r}class Hx extends Vh{constructor(i){super(i),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(i){const o=this._addedLabels;if(o.length){const c=this.getLabels();for(const{index:h,label:m}of o)c[h]===m&&c.splice(h,1);this._addedLabels=[]}super.init(i)}parse(i,o){if(Jn(i))return null;const c=this.getLabels();return o=isFinite(o)&&c[o]===i?o:fV(c,i,bn(o,i),this._addedLabels),pV(o,c.length-1)}determineDataLimits(){const{minDefined:i,maxDefined:o}=this.getUserBounds();let{min:c,max:h}=this.getMinMax(!0);this.options.bounds==="ticks"&&(i||(c=0),o||(h=this.getLabels().length-1)),this.min=c,this.max=h}buildTicks(){const i=this.min,o=this.max,c=this.options.offset,h=[];let m=this.getLabels();m=i===0&&o===m.length-1?m:m.slice(i,o+1),this._valueRange=Math.max(m.length-(c?0:1),1),this._startValue=this.min-(c?.5:0);for(let _=i;_<=o;_++)h.push({value:_});return h}getLabelForValue(i){return CA.call(this,i)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(i){return typeof i!="number"&&(i=this.parse(i)),i===null?NaN:this.getPixelForDecimal((i-this._startValue)/this._valueRange)}getPixelForTick(i){const o=this.ticks;return i<0||i>o.length-1?null:this.getPixelForValue(o[i].value)}getValueForPixel(i){return Math.round(this._startValue+this.getDecimalForPixel(i)*this._valueRange)}getBasePixel(){return this.bottom}}bi(Hx,"id","category"),bi(Hx,"defaults",{ticks:{callback:CA}});function mV(r,i){const o=[],{bounds:h,step:m,min:_,max:x,precision:s,count:M,maxTicks:P,maxDigits:L,includeBounds:F}=r,V=m||1,X=P-1,{min:q,max:Y}=i,J=!Jn(_),ue=!Jn(x),ce=!Jn(M),fe=(Y-q)/(L+1);let Ae=TE((Y-q)/X/V)*V,Ce,He,We,nt;if(Ae<1e-14&&!J&&!ue)return[{value:q},{value:Y}];nt=Math.ceil(Y/Ae)-Math.floor(q/Ae),nt>X&&(Ae=TE(nt*Ae/X/V)*V),Jn(s)||(Ce=Math.pow(10,s),Ae=Math.ceil(Ae*Ce)/Ce),h==="ticks"?(He=Math.floor(q/Ae)*Ae,We=Math.ceil(Y/Ae)*Ae):(He=q,We=Y),J&&ue&&m&&c5((x-_)/m,Ae/1e3)?(nt=Math.round(Math.min((x-_)/Ae,P)),Ae=(x-_)/nt,He=_,We=x):ce?(He=J?_:He,We=ue?x:We,nt=M-1,Ae=(We-He)/nt):(nt=(We-He)/Ae,Vp(nt,Math.round(nt),Ae/1e3)?nt=Math.round(nt):nt=Math.ceil(nt));const we=Math.max(SE(Ae),SE(He));Ce=Math.pow(10,Jn(s)?we:s),He=Math.round(He*Ce)/Ce,We=Math.round(We*Ce)/Ce;let ht=0;for(J&&(F&&He!==_?(o.push({value:_}),He<_&&ht++,Vp(Math.round((He+ht*Ae)*Ce)/Ce,_,PA(_,fe,r))&&ht++):He<_&&ht++);ht<nt;++ht){const pt=Math.round((He+ht*Ae)*Ce)/Ce;if(ue&&pt>x)break;o.push({value:pt})}return ue&&F&&We!==x?o.length&&Vp(o[o.length-1].value,x,PA(x,fe,r))?o[o.length-1].value=x:o.push({value:x}):(!ue||We===x)&&o.push({value:We}),o}function PA(r,i,{horizontal:o,minRotation:c}){const h=Za(c),m=(o?Math.sin(h):Math.cos(h))||.001,_=.75*i*(""+r).length;return Math.min(i/m,_)}class Q_ extends Vh{constructor(i){super(i),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(i,o){return Jn(i)||(typeof i=="number"||i instanceof Number)&&!isFinite(+i)?null:+i}handleTickRangeOptions(){const{beginAtZero:i}=this.options,{minDefined:o,maxDefined:c}=this.getUserBounds();let{min:h,max:m}=this;const _=s=>h=o?h:s,x=s=>m=c?m:s;if(i){const s=Al(h),M=Al(m);s<0&&M<0?x(0):s>0&&M>0&&_(0)}if(h===m){let s=m===0?1:Math.abs(m*.05);x(m+s),i||_(h-s)}this.min=h,this.max=m}getTickLimit(){const i=this.options.ticks;let{maxTicksLimit:o,stepSize:c}=i,h;return c?(h=Math.ceil(this.max/c)-Math.floor(this.min/c)+1,h>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${c} would result generating up to ${h} ticks. Limiting to 1000.`),h=1e3)):(h=this.computeTickLimit(),o=o||11),o&&(h=Math.min(o,h)),h}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const i=this.options,o=i.ticks;let c=this.getTickLimit();c=Math.max(2,c);const h={maxTicks:c,bounds:i.bounds,min:i.min,max:i.max,precision:o.precision,step:o.stepSize,count:o.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:o.minRotation||0,includeBounds:o.includeBounds!==!1},m=this._range||this,_=mV(h,m);return i.bounds==="ticks"&&yP(_,this,"value"),i.reverse?(_.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),_}configure(){const i=this.ticks;let o=this.min,c=this.max;if(super.configure(),this.options.offset&&i.length){const h=(c-o)/Math.max(i.length-1,1)/2;o-=h,c+=h}this._startValue=o,this._endValue=c,this._valueRange=c-o}getLabelForValue(i){return hm(i,this.chart.options.locale,this.options.ticks.format)}}class qx extends Q_{determineDataLimits(){const{min:i,max:o}=this.getMinMax(!0);this.min=Xr(i)?i:0,this.max=Xr(o)?o:1,this.handleTickRangeOptions()}computeTickLimit(){const i=this.isHorizontal(),o=i?this.width:this.height,c=Za(this.options.ticks.minRotation),h=(i?Math.sin(c):Math.cos(c))||.001,m=this._resolveTickFontOptions(0);return Math.ceil(o/Math.min(40,m.lineHeight/h))}getPixelForValue(i){return i===null?NaN:this.getPixelForDecimal((i-this._startValue)/this._valueRange)}getValueForPixel(i){return this._startValue+this.getDecimalForPixel(i)*this._valueRange}}bi(qx,"id","linear"),bi(qx,"defaults",{ticks:{callback:Sy.formatters.numeric}});const Kp=r=>Math.floor(lu(r)),mh=(r,i)=>Math.pow(10,Kp(r)+i);function kA(r){return r/Math.pow(10,Kp(r))===1}function DA(r,i,o){const c=Math.pow(10,o),h=Math.floor(r/c);return Math.ceil(i/c)-h}function gV(r,i){const o=i-r;let c=Kp(o);for(;DA(r,i,c)>10;)c++;for(;DA(r,i,c)<10;)c--;return Math.min(c,Kp(r))}function _V(r,{min:i,max:o}){i=$s(r.min,i);const c=[],h=Kp(i);let m=gV(i,o),_=m<0?Math.pow(10,Math.abs(m)):1;const x=Math.pow(10,m),s=h>m?Math.pow(10,h):0,M=Math.round((i-s)*_)/_,P=Math.floor((i-s)/x/10)*x*10;let L=Math.floor((M-P)/Math.pow(10,m)),F=$s(r.min,Math.round((s+P+L*Math.pow(10,m))*_)/_);for(;F<o;)c.push({value:F,major:kA(F),significand:L}),L>=10?L=L<15?15:20:L++,L>=20&&(m++,L=2,_=m>=0?1:_),F=Math.round((s+P+L*Math.pow(10,m))*_)/_;const V=$s(r.max,F);return c.push({value:V,major:kA(V),significand:L}),c}class Wx extends Vh{constructor(i){super(i),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(i,o){const c=Q_.prototype.parse.apply(this,[i,o]);if(c===0){this._zero=!0;return}return Xr(c)&&c>0?c:null}determineDataLimits(){const{min:i,max:o}=this.getMinMax(!0);this.min=Xr(i)?Math.max(0,i):null,this.max=Xr(o)?Math.max(0,o):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Xr(this._userMin)&&(this.min=i===mh(this.min,0)?mh(this.min,-1):mh(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:i,maxDefined:o}=this.getUserBounds();let c=this.min,h=this.max;const m=x=>c=i?c:x,_=x=>h=o?h:x;c===h&&(c<=0?(m(1),_(10)):(m(mh(c,-1)),_(mh(h,1)))),c<=0&&m(mh(h,-1)),h<=0&&_(mh(c,1)),this.min=c,this.max=h}buildTicks(){const i=this.options,o={min:this._userMin,max:this._userMax},c=_V(o,this);return i.bounds==="ticks"&&yP(c,this,"value"),i.reverse?(c.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),c}getLabelForValue(i){return i===void 0?"0":hm(i,this.chart.options.locale,this.options.ticks.format)}configure(){const i=this.min;super.configure(),this._startValue=lu(i),this._valueRange=lu(this.max)-lu(i)}getPixelForValue(i){return(i===void 0||i===0)&&(i=this.min),i===null||isNaN(i)?NaN:this.getPixelForDecimal(i===this.min?0:(lu(i)-this._startValue)/this._valueRange)}getValueForPixel(i){const o=this.getDecimalForPixel(i);return Math.pow(10,this._startValue+o*this._valueRange)}}bi(Wx,"id","logarithmic"),bi(Wx,"defaults",{ticks:{callback:Sy.formatters.logarithmic,major:{enabled:!0}}});function Zx(r){const i=r.ticks;if(i.display&&r.display){const o=ns(i.backdropPadding);return bn(i.font&&i.font.size,Yr.font.size)+o.height}return 0}function yV(r,i,o){return o=Or(o)?o:[o],{w:E5(r,i.string,o),h:o.length*i.lineHeight}}function LA(r,i,o,c,h){return r===c||r===h?{start:i-o/2,end:i+o/2}:r<c||r>h?{start:i-o,end:i}:{start:i,end:i+o}}function vV(r){const i={l:r.left+r._padding.left,r:r.right-r._padding.right,t:r.top+r._padding.top,b:r.bottom-r._padding.bottom},o=Object.assign({},i),c=[],h=[],m=r._pointLabels.length,_=r.options.pointLabels,x=_.centerPointLabels?zr/m:0;for(let s=0;s<m;s++){const M=_.setContext(r.getPointLabelContext(s));h[s]=M.padding;const P=r.getPointPosition(s,r.drawingArea+h[s],x),L=So(M.font),F=yV(r.ctx,L,r._pointLabels[s]);c[s]=F;const V=Qs(r.getIndexAngle(s)+x),X=Math.round(Ob(V)),q=LA(X,P.x,F.w,0,180),Y=LA(X,P.y,F.h,90,270);xV(o,i,V,q,Y)}r.setCenterPoint(i.l-o.l,o.r-i.r,i.t-o.t,o.b-i.b),r._pointLabelItems=TV(r,c,h)}function xV(r,i,o,c,h){const m=Math.abs(Math.sin(o)),_=Math.abs(Math.cos(o));let x=0,s=0;c.start<i.l?(x=(i.l-c.start)/m,r.l=Math.min(r.l,i.l-x)):c.end>i.r&&(x=(c.end-i.r)/m,r.r=Math.max(r.r,i.r+x)),h.start<i.t?(s=(i.t-h.start)/_,r.t=Math.min(r.t,i.t-s)):h.end>i.b&&(s=(h.end-i.b)/_,r.b=Math.max(r.b,i.b+s))}function bV(r,i,o){const c=r.drawingArea,{extra:h,additionalAngle:m,padding:_,size:x}=o,s=r.getPointPosition(i,c+h+_,m),M=Math.round(Ob(Qs(s.angle+co))),P=EV(s.y,x.h,M),L=SV(M),F=MV(s.x,x.w,L);return{visible:!0,x:s.x,y:P,textAlign:L,left:F,top:P,right:F+x.w,bottom:P+x.h}}function wV(r,i){if(!i)return!0;const{left:o,top:c,right:h,bottom:m}=r;return!(wc({x:o,y:c},i)||wc({x:o,y:m},i)||wc({x:h,y:c},i)||wc({x:h,y:m},i))}function TV(r,i,o){const c=[],h=r._pointLabels.length,m=r.options,{centerPointLabels:_,display:x}=m.pointLabels,s={extra:Zx(m)/2,additionalAngle:_?zr/h:0};let M;for(let P=0;P<h;P++){s.padding=o[P],s.size=i[P];const L=bV(r,P,s);c.push(L),x==="auto"&&(L.visible=wV(L,M),L.visible&&(M=L))}return c}function SV(r){return r===0||r===180?"center":r<180?"left":"right"}function MV(r,i,o){return o==="right"?r-=i:o==="center"&&(r-=i/2),r}function EV(r,i,o){return o===90||o===270?r-=i/2:(o>270||o<90)&&(r-=i),r}function AV(r,i,o){const{left:c,top:h,right:m,bottom:_}=o,{backdropColor:x}=i;if(!Jn(x)){const s=Ih(i.borderRadius),M=ns(i.backdropPadding);r.fillStyle=x;const P=c-M.left,L=h-M.top,F=m-c+M.width,V=_-h+M.height;Object.values(s).some(X=>X!==0)?(r.beginPath(),Yp(r,{x:P,y:L,w:F,h:V,radius:s}),r.fill()):r.fillRect(P,L,F,V)}}function IV(r,i){const{ctx:o,options:{pointLabels:c}}=r;for(let h=i-1;h>=0;h--){const m=r._pointLabelItems[h];if(!m.visible)continue;const _=c.setContext(r.getPointLabelContext(h));AV(o,_,m);const x=So(_.font),{x:s,y:M,textAlign:P}=m;Fh(o,r._pointLabels[h],s,M+x.lineHeight/2,x,{color:_.color,textAlign:P,textBaseline:"middle"})}}function lk(r,i,o,c){const{ctx:h}=r;if(o)h.arc(r.xCenter,r.yCenter,i,0,Rr);else{let m=r.getPointPosition(0,i);h.moveTo(m.x,m.y);for(let _=1;_<c;_++)m=r.getPointPosition(_,i),h.lineTo(m.x,m.y)}}function CV(r,i,o,c,h){const m=r.ctx,_=i.circular,{color:x,lineWidth:s}=i;!_&&!c||!x||!s||o<0||(m.save(),m.strokeStyle=x,m.lineWidth=s,m.setLineDash(h.dash),m.lineDashOffset=h.dashOffset,m.beginPath(),lk(r,o,_,c),m.closePath(),m.stroke(),m.restore())}function PV(r,i,o){return gu(r,{label:o,index:i,type:"pointLabel"})}class Pp extends Q_{constructor(i){super(i),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const i=this._padding=ns(Zx(this.options)/2),o=this.width=this.maxWidth-i.width,c=this.height=this.maxHeight-i.height;this.xCenter=Math.floor(this.left+o/2+i.left),this.yCenter=Math.floor(this.top+c/2+i.top),this.drawingArea=Math.floor(Math.min(o,c)/2)}determineDataLimits(){const{min:i,max:o}=this.getMinMax(!1);this.min=Xr(i)&&!isNaN(i)?i:0,this.max=Xr(o)&&!isNaN(o)?o:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Zx(this.options))}generateTickLabels(i){Q_.prototype.generateTickLabels.call(this,i),this._pointLabels=this.getLabels().map((o,c)=>{const h=Ir(this.options.pointLabels.callback,[o,c],this);return h||h===0?h:""}).filter((o,c)=>this.chart.getDataVisibility(c))}fit(){const i=this.options;i.display&&i.pointLabels.display?vV(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(i,o,c,h){this.xCenter+=Math.floor((i-o)/2),this.yCenter+=Math.floor((c-h)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(i,o,c,h))}getIndexAngle(i){const o=Rr/(this._pointLabels.length||1),c=this.options.startAngle||0;return Qs(i*o+Za(c))}getDistanceFromCenterForValue(i){if(Jn(i))return NaN;const o=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-i)*o:(i-this.min)*o}getValueForDistanceFromCenter(i){if(Jn(i))return NaN;const o=i/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-o:this.min+o}getPointLabelContext(i){const o=this._pointLabels||[];if(i>=0&&i<o.length){const c=o[i];return PV(this.getContext(),i,c)}}getPointPosition(i,o,c=0){const h=this.getIndexAngle(i)-co+c;return{x:Math.cos(h)*o+this.xCenter,y:Math.sin(h)*o+this.yCenter,angle:h}}getPointPositionForValue(i,o){return this.getPointPosition(i,this.getDistanceFromCenterForValue(o))}getBasePosition(i){return this.getPointPositionForValue(i||0,this.getBaseValue())}getPointLabelPosition(i){const{left:o,top:c,right:h,bottom:m}=this._pointLabelItems[i];return{left:o,top:c,right:h,bottom:m}}drawBackground(){const{backgroundColor:i,grid:{circular:o}}=this.options;if(i){const c=this.ctx;c.save(),c.beginPath(),lk(this,this.getDistanceFromCenterForValue(this._endValue),o,this._pointLabels.length),c.closePath(),c.fillStyle=i,c.fill(),c.restore()}}drawGrid(){const i=this.ctx,o=this.options,{angleLines:c,grid:h,border:m}=o,_=this._pointLabels.length;let x,s,M;if(o.pointLabels.display&&IV(this,_),h.display&&this.ticks.forEach((P,L)=>{if(L!==0||L===0&&this.min<0){s=this.getDistanceFromCenterForValue(P.value);const F=this.getContext(L),V=h.setContext(F),X=m.setContext(F);CV(this,V,s,_,X)}}),c.display){for(i.save(),x=_-1;x>=0;x--){const P=c.setContext(this.getPointLabelContext(x)),{color:L,lineWidth:F}=P;!F||!L||(i.lineWidth=F,i.strokeStyle=L,i.setLineDash(P.borderDash),i.lineDashOffset=P.borderDashOffset,s=this.getDistanceFromCenterForValue(o.ticks.reverse?this.min:this.max),M=this.getPointPosition(x,s),i.beginPath(),i.moveTo(this.xCenter,this.yCenter),i.lineTo(M.x,M.y),i.stroke())}i.restore()}}drawBorder(){}drawLabels(){const i=this.ctx,o=this.options,c=o.ticks;if(!c.display)return;const h=this.getIndexAngle(0);let m,_;i.save(),i.translate(this.xCenter,this.yCenter),i.rotate(h),i.textAlign="center",i.textBaseline="middle",this.ticks.forEach((x,s)=>{if(s===0&&this.min>=0&&!o.reverse)return;const M=c.setContext(this.getContext(s)),P=So(M.font);if(m=this.getDistanceFromCenterForValue(this.ticks[s].value),M.showLabelBackdrop){i.font=P.string,_=i.measureText(x.label).width,i.fillStyle=M.backdropColor;const L=ns(M.backdropPadding);i.fillRect(-_/2-L.left,-m-P.size/2-L.top,_+L.width,P.size+L.height)}Fh(i,x.label,0,-m,P,{color:M.color,strokeColor:M.textStrokeColor,strokeWidth:M.textStrokeWidth})}),i.restore()}drawTitle(){}}bi(Pp,"id","radialLinear"),bi(Pp,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Sy.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(i){return i},padding:5,centerPointLabels:!1}}),bi(Pp,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),bi(Pp,"descriptors",{angleLines:{_fallback:"grid"}});const Iy={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Os=Object.keys(Iy);function OA(r,i){return r-i}function RA(r,i){if(Jn(i))return null;const o=r._adapter,{parser:c,round:h,isoWeekday:m}=r._parseOpts;let _=i;return typeof c=="function"&&(_=c(_)),Xr(_)||(_=typeof c=="string"?o.parse(_,c):o.parse(_)),_===null?null:(h&&(_=h==="week"&&(Wd(m)||m===!0)?o.startOf(_,"isoWeek",m):o.startOf(_,h)),+_)}function zA(r,i,o,c){const h=Os.length;for(let m=Os.indexOf(r);m<h-1;++m){const _=Iy[Os[m]],x=_.steps?_.steps:Number.MAX_SAFE_INTEGER;if(_.common&&Math.ceil((o-i)/(x*_.size))<=c)return Os[m]}return Os[h-1]}function kV(r,i,o,c,h){for(let m=Os.length-1;m>=Os.indexOf(o);m--){const _=Os[m];if(Iy[_].common&&r._adapter.diff(h,c,_)>=i-1)return _}return Os[o?Os.indexOf(o):0]}function DV(r){for(let i=Os.indexOf(r)+1,o=Os.length;i<o;++i)if(Iy[Os[i]].common)return Os[i]}function FA(r,i,o){if(!o)r[i]=!0;else if(o.length){const{lo:c,hi:h}=Rb(o,i),m=o[c]>=i?o[c]:o[h];r[m]=!0}}function LV(r,i,o,c){const h=r._adapter,m=+h.startOf(i[0].value,c),_=i[i.length-1].value;let x,s;for(x=m;x<=_;x=+h.add(x,1,c))s=o[x],s>=0&&(i[s].major=!0);return i}function BA(r,i,o){const c=[],h={},m=i.length;let _,x;for(_=0;_<m;++_)x=i[_],h[x]=_,c.push({value:x,major:!1});return m===0||!o?c:LV(r,c,h,o)}class $p extends Vh{constructor(i){super(i),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(i,o={}){const c=i.time||(i.time={}),h=this._adapter=new jB._date(i.adapters.date);h.init(o),Np(c.displayFormats,h.formats()),this._parseOpts={parser:c.parser,round:c.round,isoWeekday:c.isoWeekday},super.init(i),this._normalized=o.normalized}parse(i,o){return i===void 0?null:RA(this,i)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const i=this.options,o=this._adapter,c=i.time.unit||"day";let{min:h,max:m,minDefined:_,maxDefined:x}=this.getUserBounds();function s(M){!_&&!isNaN(M.min)&&(h=Math.min(h,M.min)),!x&&!isNaN(M.max)&&(m=Math.max(m,M.max))}(!_||!x)&&(s(this._getLabelBounds()),(i.bounds!=="ticks"||i.ticks.source!=="labels")&&s(this.getMinMax(!1))),h=Xr(h)&&!isNaN(h)?h:+o.startOf(Date.now(),c),m=Xr(m)&&!isNaN(m)?m:+o.endOf(Date.now(),c)+1,this.min=Math.min(h,m-1),this.max=Math.max(h+1,m)}_getLabelBounds(){const i=this.getLabelTimestamps();let o=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;return i.length&&(o=i[0],c=i[i.length-1]),{min:o,max:c}}buildTicks(){const i=this.options,o=i.time,c=i.ticks,h=c.source==="labels"?this.getLabelTimestamps():this._generate();i.bounds==="ticks"&&h.length&&(this.min=this._userMin||h[0],this.max=this._userMax||h[h.length-1]);const m=this.min,_=this.max,x=f5(h,m,_);return this._unit=o.unit||(c.autoSkip?zA(o.minUnit,this.min,this.max,this._getLabelCapacity(m)):kV(this,x.length,o.minUnit,this.min,this.max)),this._majorUnit=!c.major.enabled||this._unit==="year"?void 0:DV(this._unit),this.initOffsets(h),i.reverse&&x.reverse(),BA(this,x,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(i=>+i.value))}initOffsets(i=[]){let o=0,c=0,h,m;this.options.offset&&i.length&&(h=this.getDecimalForValue(i[0]),i.length===1?o=1-h:o=(this.getDecimalForValue(i[1])-h)/2,m=this.getDecimalForValue(i[i.length-1]),i.length===1?c=m:c=(m-this.getDecimalForValue(i[i.length-2]))/2);const _=i.length<3?.5:.25;o=Do(o,0,_),c=Do(c,0,_),this._offsets={start:o,end:c,factor:1/(o+1+c)}}_generate(){const i=this._adapter,o=this.min,c=this.max,h=this.options,m=h.time,_=m.unit||zA(m.minUnit,o,c,this._getLabelCapacity(o)),x=bn(h.ticks.stepSize,1),s=_==="week"?m.isoWeekday:!1,M=Wd(s)||s===!0,P={};let L=o,F,V;if(M&&(L=+i.startOf(L,"isoWeek",s)),L=+i.startOf(L,M?"day":_),i.diff(c,o,_)>1e5*x)throw new Error(o+" and "+c+" are too far apart with stepSize of "+x+" "+_);const X=h.ticks.source==="data"&&this.getDataTimestamps();for(F=L,V=0;F<c;F=+i.add(F,x,_),V++)FA(P,F,X);return(F===c||h.bounds==="ticks"||V===1)&&FA(P,F,X),Object.keys(P).sort(OA).map(q=>+q)}getLabelForValue(i){const o=this._adapter,c=this.options.time;return c.tooltipFormat?o.format(i,c.tooltipFormat):o.format(i,c.displayFormats.datetime)}format(i,o){const h=this.options.time.displayFormats,m=this._unit,_=o||h[m];return this._adapter.format(i,_)}_tickFormatFunction(i,o,c,h){const m=this.options,_=m.ticks.callback;if(_)return Ir(_,[i,o,c],this);const x=m.time.displayFormats,s=this._unit,M=this._majorUnit,P=s&&x[s],L=M&&x[M],F=c[o],V=M&&L&&F&&F.major;return this._adapter.format(i,h||(V?L:P))}generateTickLabels(i){let o,c,h;for(o=0,c=i.length;o<c;++o)h=i[o],h.label=this._tickFormatFunction(h.value,o,i)}getDecimalForValue(i){return i===null?NaN:(i-this.min)/(this.max-this.min)}getPixelForValue(i){const o=this._offsets,c=this.getDecimalForValue(i);return this.getPixelForDecimal((o.start+c)*o.factor)}getValueForPixel(i){const o=this._offsets,c=this.getDecimalForPixel(i)/o.factor-o.end;return this.min+c*(this.max-this.min)}_getLabelSize(i){const o=this.options.ticks,c=this.ctx.measureText(i).width,h=Za(this.isHorizontal()?o.maxRotation:o.minRotation),m=Math.cos(h),_=Math.sin(h),x=this._resolveTickFontOptions(0).size;return{w:c*m+x*_,h:c*_+x*m}}_getLabelCapacity(i){const o=this.options.time,c=o.displayFormats,h=c[o.unit]||c.millisecond,m=this._tickFormatFunction(i,0,BA(this,[i],this._majorUnit),h),_=this._getLabelSize(m),x=Math.floor(this.isHorizontal()?this.width/_.w:this.height/_.h)-1;return x>0?x:1}getDataTimestamps(){let i=this._cache.data||[],o,c;if(i.length)return i;const h=this.getMatchingVisibleMetas();if(this._normalized&&h.length)return this._cache.data=h[0].controller.getAllParsedValues(this);for(o=0,c=h.length;o<c;++o)i=i.concat(h[o].controller.getAllParsedValues(this));return this._cache.data=this.normalize(i)}getLabelTimestamps(){const i=this._cache.labels||[];let o,c;if(i.length)return i;const h=this.getLabels();for(o=0,c=h.length;o<c;++o)i.push(RA(this,h[o]));return this._cache.labels=this._normalized?i:this.normalize(i)}normalize(i){return bP(i.sort(OA))}}bi($p,"id","time"),bi($p,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function l_(r,i,o){let c=0,h=r.length-1,m,_,x,s;o?(i>=r[c].pos&&i<=r[h].pos&&({lo:c,hi:h}=bc(r,"pos",i)),{pos:m,time:x}=r[c],{pos:_,time:s}=r[h]):(i>=r[c].time&&i<=r[h].time&&({lo:c,hi:h}=bc(r,"time",i)),{time:m,pos:x}=r[c],{time:_,pos:s}=r[h]);const M=_-m;return M?x+(s-x)*(i-m)/M:x}class Xx extends $p{constructor(i){super(i),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const i=this._getTimestampsForTable(),o=this._table=this.buildLookupTable(i);this._minPos=l_(o,this.min),this._tableRange=l_(o,this.max)-this._minPos,super.initOffsets(i)}buildLookupTable(i){const{min:o,max:c}=this,h=[],m=[];let _,x,s,M,P;for(_=0,x=i.length;_<x;++_)M=i[_],M>=o&&M<=c&&h.push(M);if(h.length<2)return[{time:o,pos:0},{time:c,pos:1}];for(_=0,x=h.length;_<x;++_)P=h[_+1],s=h[_-1],M=h[_],Math.round((P+s)/2)!==M&&m.push({time:M,pos:_/(x-1)});return m}_generate(){const i=this.min,o=this.max;let c=super.getDataTimestamps();return(!c.includes(i)||!c.length)&&c.splice(0,0,i),(!c.includes(o)||c.length===1)&&c.push(o),c.sort((h,m)=>h-m)}_getTimestampsForTable(){let i=this._cache.all||[];if(i.length)return i;const o=this.getDataTimestamps(),c=this.getLabelTimestamps();return o.length&&c.length?i=this.normalize(o.concat(c)):i=o.length?o:c,i=this._cache.all=i,i}getDecimalForValue(i){return(l_(this._table,i)-this._minPos)/this._tableRange}getValueForPixel(i){const o=this._offsets,c=this.getDecimalForPixel(i)/o.factor-o.end;return l_(this._table,c*this._tableRange+this._minPos,!0)}}bi(Xx,"id","timeseries"),bi(Xx,"defaults",$p.defaults);var OV=Object.freeze({__proto__:null,CategoryScale:Hx,LinearScale:qx,LogarithmicScale:Wx,RadialLinearScale:Pp,TimeScale:$p,TimeSeriesScale:Xx});const RV=[UB,_6,hV,OV];Sl.register(...RV);var zV={exports:{}};(function(r,i){(function(o,c){r.exports=c()})(xh,function(){var o=function(D,G){var ae={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},Te={on:function(Oe,Ge,Gt){if(ae[Oe]===void 0)throw new Error("Invalid event type: "+Oe);ae[Oe].push({selector:Ge,fn:Gt})},render:function(Oe){G.store.featureChanged(Oe)}},Me=function(Oe,Ge){for(var Gt=ae[Oe],Ht=Gt.length;Ht--;){var Nt=Gt[Ht];if(Nt.selector(Ge)){Nt.fn.call(Te,Ge)||G.store.render(),G.ui.updateMapClasses();break}}};return D.start.call(Te),{render:D.render,stop:function(){D.stop&&D.stop()},trash:function(){D.trash&&(D.trash(),G.store.render())},combineFeatures:function(){D.combineFeatures&&D.combineFeatures()},uncombineFeatures:function(){D.uncombineFeatures&&D.uncombineFeatures()},drag:function(Oe){Me("drag",Oe)},click:function(Oe){Me("click",Oe)},mousemove:function(Oe){Me("mousemove",Oe)},mousedown:function(Oe){Me("mousedown",Oe)},mouseup:function(Oe){Me("mouseup",Oe)},mouseout:function(Oe){Me("mouseout",Oe)},keydown:function(Oe){Me("keydown",Oe)},keyup:function(Oe){Me("keyup",Oe)},touchstart:function(Oe){Me("touchstart",Oe)},touchmove:function(Oe){Me("touchmove",Oe)},touchend:function(Oe){Me("touchend",Oe)},tap:function(Oe){Me("tap",Oe)}}};function c(D){return D&&D.__esModule&&Object.prototype.hasOwnProperty.call(D,"default")?D.default:D}function h(D){if(D.__esModule)return D;var G=D.default;if(typeof G=="function"){var ae=function Te(){if(this instanceof Te){var Me=[null];Me.push.apply(Me,arguments);var Oe=Function.bind.apply(G,Me);return new Oe}return G.apply(this,arguments)};ae.prototype=G.prototype}else ae={};return Object.defineProperty(ae,"__esModule",{value:!0}),Object.keys(D).forEach(function(Te){var Me=Object.getOwnPropertyDescriptor(D,Te);Object.defineProperty(ae,Te,Me.get?Me:{enumerable:!0,get:function(){return D[Te]}})}),ae}var m={},_={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},x=_;function s(D){var G=0;if(D&&D.length>0){G+=Math.abs(M(D[0]));for(var ae=1;ae<D.length;ae++)G-=Math.abs(M(D[ae]))}return G}function M(D){var G,ae,Te,Me,Oe,Ge,Gt=0,Ht=D.length;if(Ht>2){for(Ge=0;Ge<Ht;Ge++)Ge===Ht-2?(Te=Ht-2,Me=Ht-1,Oe=0):Ge===Ht-1?(Te=Ht-1,Me=0,Oe=1):(Te=Ge,Me=Ge+1,Oe=Ge+2),G=D[Te],ae=D[Me],Gt+=(P(D[Oe][0])-P(G[0]))*Math.sin(P(ae[1]));Gt=Gt*x.RADIUS*x.RADIUS/2}return Gt}function P(D){return D*Math.PI/180}m.geometry=function D(G){var ae,Te=0;switch(G.type){case"Polygon":return s(G.coordinates);case"MultiPolygon":for(ae=0;ae<G.coordinates.length;ae++)Te+=s(G.coordinates[ae]);return Te;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(ae=0;ae<G.geometries.length;ae++)Te+=D(G.geometries[ae]);return Te}},m.ring=M;var L={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},F={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},V={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},X={POLYGON:"polygon",LINE:"line_string",POINT:"point"},q={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},Y={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},J={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},ue={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},ce={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},fe={ACTIVE:"true",INACTIVE:"false"},Ae=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Ce=-85,He=Object.freeze({__proto__:null,classes:L,sources:F,cursors:V,types:X,geojsonTypes:q,modes:Y,events:J,updateActions:ue,meta:ce,activeStates:fe,interactions:Ae,LAT_MIN:-90,LAT_RENDERED_MIN:Ce,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),We={Point:0,LineString:1,MultiLineString:1,Polygon:2};function nt(D,G){var ae=We[D.geometry.type]-We[G.geometry.type];return ae===0&&D.geometry.type===q.POLYGON?D.area-G.area:ae}function we(D){return D.map(function(G){return G.geometry.type===q.POLYGON&&(G.area=m.geometry({type:q.FEATURE,property:{},geometry:G.geometry})),G}).sort(nt).map(function(G){return delete G.area,G})}function ht(D,G){return G===void 0&&(G=0),[[D.point.x-G,D.point.y-G],[D.point.x+G,D.point.y+G]]}function pt(D){if(this._items={},this._nums={},this._length=D?D.length:0,D)for(var G=0,ae=D.length;G<ae;G++)this.add(D[G]),D[G]!==void 0&&(typeof D[G]=="string"?this._items[D[G]]=G:this._nums[D[G]]=G)}pt.prototype.add=function(D){return this.has(D)||(this._length++,typeof D=="string"?this._items[D]=this._length:this._nums[D]=this._length),this},pt.prototype.delete=function(D){return this.has(D)===!1||(this._length--,delete this._items[D],delete this._nums[D]),this},pt.prototype.has=function(D){return(typeof D=="string"||typeof D=="number")&&(this._items[D]!==void 0||this._nums[D]!==void 0)},pt.prototype.values=function(){var D=this,G=[];return Object.keys(this._items).forEach(function(ae){G.push({k:ae,v:D._items[ae]})}),Object.keys(this._nums).forEach(function(ae){G.push({k:JSON.parse(ae),v:D._nums[ae]})}),G.sort(function(ae,Te){return ae.v-Te.v}).map(function(ae){return ae.k})},pt.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Xe=[ce.FEATURE,ce.MIDPOINT,ce.VERTEX],mt={click:function(D,G,ae){return Ft(D,G,ae,ae.options.clickBuffer)},touch:function(D,G,ae){return Ft(D,G,ae,ae.options.touchBuffer)}};function Ft(D,G,ae,Te){if(ae.map===null)return[];var Me=D?ht(D,Te):G,Oe={};ae.options.styles&&(Oe.layers=ae.options.styles.map(function(Nt){return Nt.id}).filter(function(Nt){return ae.map.getLayer(Nt)!=null}));var Ge=ae.map.queryRenderedFeatures(Me,Oe).filter(function(Nt){return Xe.indexOf(Nt.properties.meta)!==-1}),Gt=new pt,Ht=[];return Ge.forEach(function(Nt){var _i=Nt.properties.id;Gt.has(_i)||(Gt.add(_i),Ht.push(Nt))}),we(Ht)}function tt(D,G){var ae=mt.click(D,null,G),Te={mouse:V.NONE};return ae[0]&&(Te.mouse=ae[0].properties.active===fe.ACTIVE?V.MOVE:V.POINTER,Te.feature=ae[0].properties.meta),G.events.currentModeName().indexOf("draw")!==-1&&(Te.mouse=V.ADD),G.ui.queueMapClasses(Te),G.ui.updateMapClasses(),ae[0]}function ei(D,G){var ae=D.x-G.x,Te=D.y-G.y;return Math.sqrt(ae*ae+Te*Te)}function ki(D,G,ae){ae===void 0&&(ae={});var Te=ae.fineTolerance!=null?ae.fineTolerance:4,Me=ae.grossTolerance!=null?ae.grossTolerance:12,Oe=ae.interval!=null?ae.interval:500;D.point=D.point||G.point,D.time=D.time||G.time;var Ge=ei(D.point,G.point);return Ge<Te||Ge<Me&&G.time-D.time<Oe}function rt(D,G,ae){ae===void 0&&(ae={});var Te=ae.tolerance!=null?ae.tolerance:25,Me=ae.interval!=null?ae.interval:250;return D.point=D.point||G.point,D.time=D.time||G.time,ei(D.point,G.point)<Te&&G.time-D.time<Me}var yt={exports:{}},Xt=yt.exports=function(D,G){if(G||(G=16),D===void 0&&(D=128),D<=0)return"0";for(var ae=Math.log(Math.pow(2,D))/Math.log(G),Te=2;ae===1/0;Te*=2)ae=Math.log(Math.pow(2,D/Te))/Math.log(G)*Te;var Me=ae-Math.floor(ae),Oe="";for(Te=0;Te<Math.floor(ae);Te++)Oe=Math.floor(Math.random()*G).toString(G)+Oe;if(Me){var Ge=Math.pow(G,Me);Oe=Math.floor(Math.random()*Ge).toString(G)+Oe}var Gt=parseInt(Oe,G);return Gt!==1/0&&Gt>=Math.pow(2,D)?Xt(D,G):Oe};Xt.rack=function(D,G,ae){var Te=function(Oe){var Ge=0;do{if(Ge++>10){if(!ae)throw new Error("too many ID collisions, use more bits");D+=ae}var Gt=Xt(D,G)}while(Object.hasOwnProperty.call(Me,Gt));return Me[Gt]=Oe,Gt},Me=Te.hats={};return Te.get=function(Oe){return Te.hats[Oe]},Te.set=function(Oe,Ge){return Te.hats[Oe]=Ge,Te},Te.bits=D||128,Te.base=G||16,Te};var kt=c(yt.exports),Ue=function(D,G){this.ctx=D,this.properties=G.properties||{},this.coordinates=G.geometry.coordinates,this.id=G.id||kt(),this.type=G.geometry.type};Ue.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},Ue.prototype.incomingCoords=function(D){this.setCoordinates(D)},Ue.prototype.setCoordinates=function(D){this.coordinates=D,this.changed()},Ue.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},Ue.prototype.setProperty=function(D,G){this.properties[D]=G},Ue.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:q.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},Ue.prototype.internal=function(D){var G={id:this.id,meta:ce.FEATURE,"meta:type":this.type,active:fe.INACTIVE,mode:D};if(this.ctx.options.userProperties)for(var ae in this.properties)G["user_"+ae]=this.properties[ae];return{type:q.FEATURE,properties:G,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var Ye=function(D,G){Ue.call(this,D,G)};(Ye.prototype=Object.create(Ue.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},Ye.prototype.updateCoordinate=function(D,G,ae){this.coordinates=arguments.length===3?[G,ae]:[D,G],this.changed()},Ye.prototype.getCoordinate=function(){return this.getCoordinates()};var Kt=function(D,G){Ue.call(this,D,G)};(Kt.prototype=Object.create(Ue.prototype)).isValid=function(){return this.coordinates.length>1},Kt.prototype.addCoordinate=function(D,G,ae){this.changed();var Te=parseInt(D,10);this.coordinates.splice(Te,0,[G,ae])},Kt.prototype.getCoordinate=function(D){var G=parseInt(D,10);return JSON.parse(JSON.stringify(this.coordinates[G]))},Kt.prototype.removeCoordinate=function(D){this.changed(),this.coordinates.splice(parseInt(D,10),1)},Kt.prototype.updateCoordinate=function(D,G,ae){var Te=parseInt(D,10);this.coordinates[Te]=[G,ae],this.changed()};var vi=function(D,G){Ue.call(this,D,G),this.coordinates=this.coordinates.map(function(ae){return ae.slice(0,-1)})};(vi.prototype=Object.create(Ue.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(D){return D.length>2})},vi.prototype.incomingCoords=function(D){this.coordinates=D.map(function(G){return G.slice(0,-1)}),this.changed()},vi.prototype.setCoordinates=function(D){this.coordinates=D,this.changed()},vi.prototype.addCoordinate=function(D,G,ae){this.changed();var Te=D.split(".").map(function(Me){return parseInt(Me,10)});this.coordinates[Te[0]].splice(Te[1],0,[G,ae])},vi.prototype.removeCoordinate=function(D){this.changed();var G=D.split(".").map(function(Te){return parseInt(Te,10)}),ae=this.coordinates[G[0]];ae&&(ae.splice(G[1],1),ae.length<3&&this.coordinates.splice(G[0],1))},vi.prototype.getCoordinate=function(D){var G=D.split(".").map(function(Te){return parseInt(Te,10)}),ae=this.coordinates[G[0]];return JSON.parse(JSON.stringify(ae[G[1]]))},vi.prototype.getCoordinates=function(){return this.coordinates.map(function(D){return D.concat([D[0]])})},vi.prototype.updateCoordinate=function(D,G,ae){this.changed();var Te=D.split("."),Me=parseInt(Te[0],10),Oe=parseInt(Te[1],10);this.coordinates[Me]===void 0&&(this.coordinates[Me]=[]),this.coordinates[Me][Oe]=[G,ae]};var en={MultiPoint:Ye,MultiLineString:Kt,MultiPolygon:vi},Li=function(D,G,ae,Te,Me){var Oe=ae.split("."),Ge=parseInt(Oe[0],10),Gt=Oe[1]?Oe.slice(1).join("."):null;return D[Ge][G](Gt,Te,Me)},Zi=function(D,G){if(Ue.call(this,D,G),delete this.coordinates,this.model=en[G.geometry.type],this.model===void 0)throw new TypeError(G.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(G.geometry.coordinates)};function it(D){this.map=D.map,this.drawConfig=JSON.parse(JSON.stringify(D.options||{})),this._ctx=D}(Zi.prototype=Object.create(Ue.prototype))._coordinatesToFeatures=function(D){var G=this,ae=this.model.bind(this);return D.map(function(Te){return new ae(G.ctx,{id:kt(),type:q.FEATURE,properties:{},geometry:{coordinates:Te,type:G.type.replace("Multi","")}})})},Zi.prototype.isValid=function(){return this.features.every(function(D){return D.isValid()})},Zi.prototype.setCoordinates=function(D){this.features=this._coordinatesToFeatures(D),this.changed()},Zi.prototype.getCoordinate=function(D){return Li(this.features,"getCoordinate",D)},Zi.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(D){return D.type===q.POLYGON?D.getCoordinates():D.coordinates})))},Zi.prototype.updateCoordinate=function(D,G,ae){Li(this.features,"updateCoordinate",D,G,ae),this.changed()},Zi.prototype.addCoordinate=function(D,G,ae){Li(this.features,"addCoordinate",D,G,ae),this.changed()},Zi.prototype.removeCoordinate=function(D){Li(this.features,"removeCoordinate",D),this.changed()},Zi.prototype.getFeatures=function(){return this.features},it.prototype.setSelected=function(D){return this._ctx.store.setSelected(D)},it.prototype.setSelectedCoordinates=function(D){var G=this;this._ctx.store.setSelectedCoordinates(D),D.reduce(function(ae,Te){return ae[Te.feature_id]===void 0&&(ae[Te.feature_id]=!0,G._ctx.store.get(Te.feature_id).changed()),ae},{})},it.prototype.getSelected=function(){return this._ctx.store.getSelected()},it.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},it.prototype.isSelected=function(D){return this._ctx.store.isSelected(D)},it.prototype.getFeature=function(D){return this._ctx.store.get(D)},it.prototype.select=function(D){return this._ctx.store.select(D)},it.prototype.deselect=function(D){return this._ctx.store.deselect(D)},it.prototype.deleteFeature=function(D,G){return G===void 0&&(G={}),this._ctx.store.delete(D,G)},it.prototype.addFeature=function(D){return this._ctx.store.add(D)},it.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},it.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},it.prototype.setActionableState=function(D){D===void 0&&(D={});var G={trash:D.trash||!1,combineFeatures:D.combineFeatures||!1,uncombineFeatures:D.uncombineFeatures||!1};return this._ctx.events.actionable(G)},it.prototype.changeMode=function(D,G,ae){return G===void 0&&(G={}),ae===void 0&&(ae={}),this._ctx.events.changeMode(D,G,ae)},it.prototype.updateUIClasses=function(D){return this._ctx.ui.queueMapClasses(D)},it.prototype.activateUIButton=function(D){return this._ctx.ui.setActiveButton(D)},it.prototype.featuresAt=function(D,G,ae){if(ae===void 0&&(ae="click"),ae!=="click"&&ae!=="touch")throw new Error("invalid buffer type");return mt[ae](D,G,this._ctx)},it.prototype.newFeature=function(D){var G=D.geometry.type;return G===q.POINT?new Ye(this._ctx,D):G===q.LINE_STRING?new Kt(this._ctx,D):G===q.POLYGON?new vi(this._ctx,D):new Zi(this._ctx,D)},it.prototype.isInstanceOf=function(D,G){if(D===q.POINT)return G instanceof Ye;if(D===q.LINE_STRING)return G instanceof Kt;if(D===q.POLYGON)return G instanceof vi;if(D==="MultiFeature")return G instanceof Zi;throw new Error("Unknown feature class: "+D)},it.prototype.doRender=function(D){return this._ctx.store.featureChanged(D)},it.prototype.onSetup=function(){},it.prototype.onDrag=function(){},it.prototype.onClick=function(){},it.prototype.onMouseMove=function(){},it.prototype.onMouseDown=function(){},it.prototype.onMouseUp=function(){},it.prototype.onMouseOut=function(){},it.prototype.onKeyUp=function(){},it.prototype.onKeyDown=function(){},it.prototype.onTouchStart=function(){},it.prototype.onTouchMove=function(){},it.prototype.onTouchEnd=function(){},it.prototype.onTap=function(){},it.prototype.onStop=function(){},it.prototype.onTrash=function(){},it.prototype.onCombineFeature=function(){},it.prototype.onUncombineFeature=function(){},it.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Sn={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},dr=Object.keys(Sn);function Hr(D){var G=Object.keys(D);return function(ae,Te){Te===void 0&&(Te={});var Me={},Oe=G.reduce(function(Ge,Gt){return Ge[Gt]=D[Gt],Ge},new it(ae));return{start:function(){var Ge=this;Me=Oe.onSetup(Te),dr.forEach(function(Gt){var Ht,Nt=Sn[Gt],_i=function(){return!1};D[Nt]&&(_i=function(){return!0}),Ge.on(Gt,_i,(Ht=Nt,function(ti){return Oe[Ht](Me,ti)}))})},stop:function(){Oe.onStop(Me)},trash:function(){Oe.onTrash(Me)},combineFeatures:function(){Oe.onCombineFeatures(Me)},uncombineFeatures:function(){Oe.onUncombineFeatures(Me)},render:function(Ge,Gt){Oe.toDisplayFeatures(Me,Ge,Gt)}}}}function xi(D){return[].concat(D).filter(function(G){return G!==void 0})}function wt(){var D=this;if(!(D.ctx.map&&D.ctx.map.getSource(F.HOT)!==void 0))return Ht();var G=D.ctx.events.currentModeName();D.ctx.ui.queueMapClasses({mode:G});var ae=[],Te=[];D.isDirty?Te=D.getAllIds():(ae=D.getChangedIds().filter(function(Nt){return D.get(Nt)!==void 0}),Te=D.sources.hot.filter(function(Nt){return Nt.properties.id&&ae.indexOf(Nt.properties.id)===-1&&D.get(Nt.properties.id)!==void 0}).map(function(Nt){return Nt.properties.id})),D.sources.hot=[];var Me=D.sources.cold.length;D.sources.cold=D.isDirty?[]:D.sources.cold.filter(function(Nt){var _i=Nt.properties.id||Nt.properties.parent;return ae.indexOf(_i)===-1});var Oe=Me!==D.sources.cold.length||Te.length>0;function Ge(Nt,_i){var ti=D.get(Nt).internal(G);D.ctx.events.currentModeRender(ti,function(Ji){D.sources[_i].push(Ji)})}if(ae.forEach(function(Nt){return Ge(Nt,"hot")}),Te.forEach(function(Nt){return Ge(Nt,"cold")}),Oe&&D.ctx.map.getSource(F.COLD).setData({type:q.FEATURE_COLLECTION,features:D.sources.cold}),D.ctx.map.getSource(F.HOT).setData({type:q.FEATURE_COLLECTION,features:D.sources.hot}),D._emitSelectionChange&&(D.ctx.map.fire(J.SELECTION_CHANGE,{features:D.getSelected().map(function(Nt){return Nt.toGeoJSON()}),points:D.getSelectedCoordinates().map(function(Nt){return{type:q.FEATURE,properties:{},geometry:{type:q.POINT,coordinates:Nt.coordinates}}})}),D._emitSelectionChange=!1),D._deletedFeaturesToEmit.length){var Gt=D._deletedFeaturesToEmit.map(function(Nt){return Nt.toGeoJSON()});D._deletedFeaturesToEmit=[],D.ctx.map.fire(J.DELETE,{features:Gt})}function Ht(){D.isDirty=!1,D.clearChangedIds()}Ht(),D.ctx.map.fire(J.RENDER,{})}function ni(D){var G,ae=this;this._features={},this._featureIds=new pt,this._selectedFeatureIds=new pt,this._selectedCoordinates=[],this._changedFeatureIds=new pt,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=D,this.sources={hot:[],cold:[]},this.render=function(){G||(G=requestAnimationFrame(function(){G=null,wt.call(ae)}))},this.isDirty=!1}function Ve(D,G){var ae=D._selectedCoordinates.filter(function(Te){return D._selectedFeatureIds.has(Te.feature_id)});D._selectedCoordinates.length===ae.length||G.silent||(D._emitSelectionChange=!0),D._selectedCoordinates=ae}ni.prototype.createRenderBatch=function(){var D=this,G=this.render,ae=0;return this.render=function(){ae++},function(){D.render=G,ae>0&&D.render()}},ni.prototype.setDirty=function(){return this.isDirty=!0,this},ni.prototype.featureChanged=function(D){return this._changedFeatureIds.add(D),this},ni.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},ni.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},ni.prototype.getAllIds=function(){return this._featureIds.values()},ni.prototype.add=function(D){return this.featureChanged(D.id),this._features[D.id]=D,this._featureIds.add(D.id),this},ni.prototype.delete=function(D,G){var ae=this;return G===void 0&&(G={}),xi(D).forEach(function(Te){ae._featureIds.has(Te)&&(ae._featureIds.delete(Te),ae._selectedFeatureIds.delete(Te),G.silent||ae._deletedFeaturesToEmit.indexOf(ae._features[Te])===-1&&ae._deletedFeaturesToEmit.push(ae._features[Te]),delete ae._features[Te],ae.isDirty=!0)}),Ve(this,G),this},ni.prototype.get=function(D){return this._features[D]},ni.prototype.getAll=function(){var D=this;return Object.keys(this._features).map(function(G){return D._features[G]})},ni.prototype.select=function(D,G){var ae=this;return G===void 0&&(G={}),xi(D).forEach(function(Te){ae._selectedFeatureIds.has(Te)||(ae._selectedFeatureIds.add(Te),ae._changedFeatureIds.add(Te),G.silent||(ae._emitSelectionChange=!0))}),this},ni.prototype.deselect=function(D,G){var ae=this;return G===void 0&&(G={}),xi(D).forEach(function(Te){ae._selectedFeatureIds.has(Te)&&(ae._selectedFeatureIds.delete(Te),ae._changedFeatureIds.add(Te),G.silent||(ae._emitSelectionChange=!0))}),Ve(this,G),this},ni.prototype.clearSelected=function(D){return D===void 0&&(D={}),this.deselect(this._selectedFeatureIds.values(),{silent:D.silent}),this},ni.prototype.setSelected=function(D,G){var ae=this;return G===void 0&&(G={}),D=xi(D),this.deselect(this._selectedFeatureIds.values().filter(function(Te){return D.indexOf(Te)===-1}),{silent:G.silent}),this.select(D.filter(function(Te){return!ae._selectedFeatureIds.has(Te)}),{silent:G.silent}),this},ni.prototype.setSelectedCoordinates=function(D){return this._selectedCoordinates=D,this._emitSelectionChange=!0,this},ni.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},ni.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},ni.prototype.getSelected=function(){var D=this;return this._selectedFeatureIds.values().map(function(G){return D.get(G)})},ni.prototype.getSelectedCoordinates=function(){var D=this;return this._selectedCoordinates.map(function(G){return{coordinates:D.get(G.feature_id).getCoordinate(G.coord_path)}})},ni.prototype.isSelected=function(D){return this._selectedFeatureIds.has(D)},ni.prototype.setFeatureProperty=function(D,G,ae){this.get(D).setProperty(G,ae),this.featureChanged(D)},ni.prototype.storeMapConfig=function(){var D=this;Ae.forEach(function(G){D.ctx.map[G]&&(D._mapInitialConfig[G]=D.ctx.map[G].isEnabled())})},ni.prototype.restoreMapConfig=function(){var D=this;Object.keys(this._mapInitialConfig).forEach(function(G){D._mapInitialConfig[G]?D.ctx.map[G].enable():D.ctx.map[G].disable()})},ni.prototype.getInitialConfigValue=function(D){return this._mapInitialConfig[D]===void 0||this._mapInitialConfig[D]};var ne=function(){for(var D=arguments,G={},ae=0;ae<arguments.length;ae++){var Te=D[ae];for(var Me in Te)pe.call(Te,Me)&&(G[Me]=Te[Me])}return G},pe=Object.prototype.hasOwnProperty,Ie=c(ne),xt=["mode","feature","mouse"];function vt(D){var G=null,ae=null,Te={onRemove:function(){return D.map.off("load",Te.connect),clearInterval(ae),Te.removeLayers(),D.store.restoreMapConfig(),D.ui.removeButtons(),D.events.removeEventListeners(),D.ui.clearMapClasses(),D.boxZoomInitial&&D.map.boxZoom.enable(),D.map=null,D.container=null,D.store=null,G&&G.parentNode&&G.parentNode.removeChild(G),G=null,this},connect:function(){D.map.off("load",Te.connect),clearInterval(ae),Te.addLayers(),D.store.storeMapConfig(),D.events.addEventListeners()},onAdd:function(Me){var Oe=Me.fire;return Me.fire=function(Ge,Gt){var Ht=arguments;return Oe.length===1&&arguments.length!==1&&(Ht=[Ie({},{type:Ge},Gt)]),Oe.apply(Me,Ht)},D.map=Me,D.events=function(Ge){var Gt=Object.keys(Ge.options.modes).reduce(function(Ot,Di){return Ot[Di]=Hr(Ge.options.modes[Di]),Ot},{}),Ht={},Nt={},_i={},ti=null,Ji=null;_i.drag=function(Ot,Di){Di({point:Ot.point,time:new Date().getTime()})?(Ge.ui.queueMapClasses({mouse:V.DRAG}),Ji.drag(Ot)):Ot.originalEvent.stopPropagation()},_i.mousedrag=function(Ot){_i.drag(Ot,function(Di){return!ki(Ht,Di)})},_i.touchdrag=function(Ot){_i.drag(Ot,function(Di){return!rt(Nt,Di)})},_i.mousemove=function(Ot){if((Ot.originalEvent.buttons!==void 0?Ot.originalEvent.buttons:Ot.originalEvent.which)===1)return _i.mousedrag(Ot);var Di=tt(Ot,Ge);Ot.featureTarget=Di,Ji.mousemove(Ot)},_i.mousedown=function(Ot){Ht={time:new Date().getTime(),point:Ot.point};var Di=tt(Ot,Ge);Ot.featureTarget=Di,Ji.mousedown(Ot)},_i.mouseup=function(Ot){var Di=tt(Ot,Ge);Ot.featureTarget=Di,ki(Ht,{point:Ot.point,time:new Date().getTime()})?Ji.click(Ot):Ji.mouseup(Ot)},_i.mouseout=function(Ot){Ji.mouseout(Ot)},_i.touchstart=function(Ot){if(Ge.options.touchEnabled){Nt={time:new Date().getTime(),point:Ot.point};var Di=mt.touch(Ot,null,Ge)[0];Ot.featureTarget=Di,Ji.touchstart(Ot)}},_i.touchmove=function(Ot){if(Ge.options.touchEnabled)return Ji.touchmove(Ot),_i.touchdrag(Ot)},_i.touchend=function(Ot){if(Ot.originalEvent.preventDefault(),Ge.options.touchEnabled){var Di=mt.touch(Ot,null,Ge)[0];Ot.featureTarget=Di,rt(Nt,{time:new Date().getTime(),point:Ot.point})?Ji.tap(Ot):Ji.touchend(Ot)}};var Xn=function(Ot){return!(Ot===8||Ot===46||Ot>=48&&Ot<=57)};function tn(Ot,Di,Ln){Ln===void 0&&(Ln={}),Ji.stop();var Fr=Gt[Ot];if(Fr===void 0)throw new Error(Ot+" is not valid");ti=Ot;var In=Fr(Ge,Di);Ji=o(In,Ge),Ln.silent||Ge.map.fire(J.MODE_CHANGE,{mode:Ot}),Ge.store.setDirty(),Ge.store.render()}_i.keydown=function(Ot){(Ot.srcElement||Ot.target).classList.contains("mapboxgl-canvas")&&(Ot.keyCode!==8&&Ot.keyCode!==46||!Ge.options.controls.trash?Xn(Ot.keyCode)?Ji.keydown(Ot):Ot.keyCode===49&&Ge.options.controls.point?tn(Y.DRAW_POINT):Ot.keyCode===50&&Ge.options.controls.line_string?tn(Y.DRAW_LINE_STRING):Ot.keyCode===51&&Ge.options.controls.polygon&&tn(Y.DRAW_POLYGON):(Ot.preventDefault(),Ji.trash()))},_i.keyup=function(Ot){Xn(Ot.keyCode)&&Ji.keyup(Ot)},_i.zoomend=function(){Ge.store.changeZoom()},_i.data=function(Ot){if(Ot.dataType==="style"){var Di=Ge.setup,Ln=Ge.map,Fr=Ge.options,In=Ge.store;Fr.styles.some(function(Bn){return Ln.getLayer(Bn.id)})||(Di.addLayers(),In.setDirty(),In.render())}};var pr={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){ti=Ge.options.defaultMode,Ji=o(Gt[ti](Ge),Ge)},changeMode:tn,actionable:function(Ot){var Di=!1;Object.keys(Ot).forEach(function(Ln){if(pr[Ln]===void 0)throw new Error("Invalid action type");pr[Ln]!==Ot[Ln]&&(Di=!0),pr[Ln]=Ot[Ln]}),Di&&Ge.map.fire(J.ACTIONABLE,{actions:pr})},currentModeName:function(){return ti},currentModeRender:function(Ot,Di){return Ji.render(Ot,Di)},fire:function(Ot,Di){_i[Ot]&&_i[Ot](Di)},addEventListeners:function(){Ge.map.on("mousemove",_i.mousemove),Ge.map.on("mousedown",_i.mousedown),Ge.map.on("mouseup",_i.mouseup),Ge.map.on("data",_i.data),Ge.map.on("touchmove",_i.touchmove),Ge.map.on("touchstart",_i.touchstart),Ge.map.on("touchend",_i.touchend),Ge.container.addEventListener("mouseout",_i.mouseout),Ge.options.keybindings&&(Ge.container.addEventListener("keydown",_i.keydown),Ge.container.addEventListener("keyup",_i.keyup))},removeEventListeners:function(){Ge.map.off("mousemove",_i.mousemove),Ge.map.off("mousedown",_i.mousedown),Ge.map.off("mouseup",_i.mouseup),Ge.map.off("data",_i.data),Ge.map.off("touchmove",_i.touchmove),Ge.map.off("touchstart",_i.touchstart),Ge.map.off("touchend",_i.touchend),Ge.container.removeEventListener("mouseout",_i.mouseout),Ge.options.keybindings&&(Ge.container.removeEventListener("keydown",_i.keydown),Ge.container.removeEventListener("keyup",_i.keyup))},trash:function(Ot){Ji.trash(Ot)},combineFeatures:function(){Ji.combineFeatures()},uncombineFeatures:function(){Ji.uncombineFeatures()},getMode:function(){return ti}}}(D),D.ui=function(Ge){var Gt={},Ht=null,Nt={mode:null,feature:null,mouse:null},_i={mode:null,feature:null,mouse:null};function ti(Ot){_i=Ie(_i,Ot)}function Ji(){var Ot,Di;if(Ge.container){var Ln=[],Fr=[];xt.forEach(function(In){_i[In]!==Nt[In]&&(Ln.push(In+"-"+Nt[In]),_i[In]!==null&&Fr.push(In+"-"+_i[In]))}),Ln.length>0&&(Ot=Ge.container.classList).remove.apply(Ot,Ln),Fr.length>0&&(Di=Ge.container.classList).add.apply(Di,Fr),Nt=Ie(Nt,_i)}}function Xn(Ot,Di){Di===void 0&&(Di={});var Ln=document.createElement("button");return Ln.className=L.CONTROL_BUTTON+" "+Di.className,Ln.setAttribute("title",Di.title),Di.container.appendChild(Ln),Ln.addEventListener("click",function(Fr){if(Fr.preventDefault(),Fr.stopPropagation(),Fr.target===Ht)return tn(),void Di.onDeactivate();pr(Ot),Di.onActivate()},!0),Ln}function tn(){Ht&&(Ht.classList.remove(L.ACTIVE_BUTTON),Ht=null)}function pr(Ot){tn();var Di=Gt[Ot];Di&&Di&&Ot!=="trash"&&(Di.classList.add(L.ACTIVE_BUTTON),Ht=Di)}return{setActiveButton:pr,queueMapClasses:ti,updateMapClasses:Ji,clearMapClasses:function(){ti({mode:null,feature:null,mouse:null}),Ji()},addButtons:function(){var Ot=Ge.options.controls,Di=document.createElement("div");return Di.className=L.CONTROL_GROUP+" "+L.CONTROL_BASE,Ot&&(Ot[X.LINE]&&(Gt[X.LINE]=Xn(X.LINE,{container:Di,className:L.CONTROL_BUTTON_LINE,title:"LineString tool "+(Ge.options.keybindings?"(l)":""),onActivate:function(){return Ge.events.changeMode(Y.DRAW_LINE_STRING)},onDeactivate:function(){return Ge.events.trash()}})),Ot[X.POLYGON]&&(Gt[X.POLYGON]=Xn(X.POLYGON,{container:Di,className:L.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(Ge.options.keybindings?"(p)":""),onActivate:function(){return Ge.events.changeMode(Y.DRAW_POLYGON)},onDeactivate:function(){return Ge.events.trash()}})),Ot[X.POINT]&&(Gt[X.POINT]=Xn(X.POINT,{container:Di,className:L.CONTROL_BUTTON_POINT,title:"Marker tool "+(Ge.options.keybindings?"(m)":""),onActivate:function(){return Ge.events.changeMode(Y.DRAW_POINT)},onDeactivate:function(){return Ge.events.trash()}})),Ot.trash&&(Gt.trash=Xn("trash",{container:Di,className:L.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){Ge.events.trash()}})),Ot.combine_features&&(Gt.combine_features=Xn("combineFeatures",{container:Di,className:L.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){Ge.events.combineFeatures()}})),Ot.uncombine_features&&(Gt.uncombine_features=Xn("uncombineFeatures",{container:Di,className:L.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){Ge.events.uncombineFeatures()}}))),Di},removeButtons:function(){Object.keys(Gt).forEach(function(Ot){var Di=Gt[Ot];Di.parentNode&&Di.parentNode.removeChild(Di),delete Gt[Ot]})}}}(D),D.container=Me.getContainer(),D.store=new ni(D),G=D.ui.addButtons(),D.options.boxSelect&&(D.boxZoomInitial=Me.boxZoom.isEnabled(),Me.boxZoom.disable(),Me.dragPan.disable(),Me.dragPan.enable()),Me.loaded()?Te.connect():(Me.on("load",Te.connect),ae=setInterval(function(){Me.loaded()&&Te.connect()},16)),D.events.start(),G},addLayers:function(){D.map.addSource(F.COLD,{data:{type:q.FEATURE_COLLECTION,features:[]},type:"geojson"}),D.map.addSource(F.HOT,{data:{type:q.FEATURE_COLLECTION,features:[]},type:"geojson"}),D.options.styles.forEach(function(Me){D.map.addLayer(Me)}),D.store.setDirty(!0),D.store.render()},removeLayers:function(){D.options.styles.forEach(function(Me){D.map.getLayer(Me.id)&&D.map.removeLayer(Me.id)}),D.map.getSource(F.COLD)&&D.map.removeSource(F.COLD),D.map.getSource(F.HOT)&&D.map.removeSource(F.HOT)}};return D.setup=Te,Te}var Wt=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function Jt(D){return function(G){var ae=G.featureTarget;return!!ae&&!!ae.properties&&ae.properties.meta===D}}function Tt(D){return!!D.originalEvent&&!!D.originalEvent.shiftKey&&D.originalEvent.button===0}function li(D){return!!D.featureTarget&&!!D.featureTarget.properties&&D.featureTarget.properties.active===fe.ACTIVE&&D.featureTarget.properties.meta===ce.FEATURE}function wi(D){return!!D.featureTarget&&!!D.featureTarget.properties&&D.featureTarget.properties.active===fe.INACTIVE&&D.featureTarget.properties.meta===ce.FEATURE}function $t(D){return D.featureTarget===void 0}function cn(D){return!!D.featureTarget&&!!D.featureTarget.properties&&D.featureTarget.properties.meta===ce.FEATURE}function dn(D){var G=D.featureTarget;return!!G&&!!G.properties&&G.properties.meta===ce.VERTEX}function Fn(D){return!!D.originalEvent&&D.originalEvent.shiftKey===!0}function gn(D){return D.keyCode===27}function wn(D){return D.keyCode===13}var Je=Object.freeze({__proto__:null,isOfMetaType:Jt,isShiftMousedown:Tt,isActiveFeature:li,isInactiveFeature:wi,noTarget:$t,isFeature:cn,isVertex:dn,isShiftDown:Fn,isEscapeKey:gn,isEnterKey:wn,isTrue:function(){return!0}}),mi=Gi;function Gi(D,G){this.x=D,this.y=G}Gi.prototype={clone:function(){return new Gi(this.x,this.y)},add:function(D){return this.clone()._add(D)},sub:function(D){return this.clone()._sub(D)},multByPoint:function(D){return this.clone()._multByPoint(D)},divByPoint:function(D){return this.clone()._divByPoint(D)},mult:function(D){return this.clone()._mult(D)},div:function(D){return this.clone()._div(D)},rotate:function(D){return this.clone()._rotate(D)},rotateAround:function(D,G){return this.clone()._rotateAround(D,G)},matMult:function(D){return this.clone()._matMult(D)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(D){return this.x===D.x&&this.y===D.y},dist:function(D){return Math.sqrt(this.distSqr(D))},distSqr:function(D){var G=D.x-this.x,ae=D.y-this.y;return G*G+ae*ae},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(D){return Math.atan2(this.y-D.y,this.x-D.x)},angleWith:function(D){return this.angleWithSep(D.x,D.y)},angleWithSep:function(D,G){return Math.atan2(this.x*G-this.y*D,this.x*D+this.y*G)},_matMult:function(D){var G=D[0]*this.x+D[1]*this.y,ae=D[2]*this.x+D[3]*this.y;return this.x=G,this.y=ae,this},_add:function(D){return this.x+=D.x,this.y+=D.y,this},_sub:function(D){return this.x-=D.x,this.y-=D.y,this},_mult:function(D){return this.x*=D,this.y*=D,this},_div:function(D){return this.x/=D,this.y/=D,this},_multByPoint:function(D){return this.x*=D.x,this.y*=D.y,this},_divByPoint:function(D){return this.x/=D.x,this.y/=D.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var D=this.y;return this.y=this.x,this.x=-D,this},_rotate:function(D){var G=Math.cos(D),ae=Math.sin(D),Te=G*this.x-ae*this.y,Me=ae*this.x+G*this.y;return this.x=Te,this.y=Me,this},_rotateAround:function(D,G){var ae=Math.cos(D),Te=Math.sin(D),Me=G.x+ae*(this.x-G.x)-Te*(this.y-G.y),Oe=G.y+Te*(this.x-G.x)+ae*(this.y-G.y);return this.x=Me,this.y=Oe,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Gi.convert=function(D){return D instanceof Gi?D:Array.isArray(D)?new Gi(D[0],D[1]):D};var fn=c(mi);function $n(D,G){var ae=G.getBoundingClientRect();return new fn(D.clientX-ae.left-(G.clientLeft||0),D.clientY-ae.top-(G.clientTop||0))}function Jr(D,G,ae,Te){return{type:q.FEATURE,properties:{meta:ce.VERTEX,parent:D,coord_path:ae,active:Te?fe.ACTIVE:fe.INACTIVE},geometry:{type:q.POINT,coordinates:G}}}function Cr(D,G,ae){var Te=G.geometry.coordinates,Me=ae.geometry.coordinates;if(Te[1]>85||Te[1]<Ce||Me[1]>85||Me[1]<Ce)return null;var Oe={lng:(Te[0]+Me[0])/2,lat:(Te[1]+Me[1])/2};return{type:q.FEATURE,properties:{meta:ce.MIDPOINT,parent:D,lng:Oe.lng,lat:Oe.lat,coord_path:ae.properties.coord_path},geometry:{type:q.POINT,coordinates:[Oe.lng,Oe.lat]}}}function Mo(D,G,ae){G===void 0&&(G={}),ae===void 0&&(ae=null);var Te,Me=D.geometry,Oe=Me.type,Ge=Me.coordinates,Gt=D.properties&&D.properties.id,Ht=[];function Nt(ti,Ji){var Xn="",tn=null;ti.forEach(function(pr,Ot){var Di=Ji!=null?Ji+"."+Ot:String(Ot),Ln=Jr(Gt,pr,Di,_i(Di));if(G.midpoints&&tn){var Fr=Cr(Gt,tn,Ln);Fr&&Ht.push(Fr)}tn=Ln;var In=JSON.stringify(pr);Xn!==In&&Ht.push(Ln),Ot===0&&(Xn=In)})}function _i(ti){return!!G.selectedPaths&&G.selectedPaths.indexOf(ti)!==-1}return Oe===q.POINT?Ht.push(Jr(Gt,Ge,ae,_i(ae))):Oe===q.POLYGON?Ge.forEach(function(ti,Ji){Nt(ti,ae!==null?ae+"."+Ji:String(Ji))}):Oe===q.LINE_STRING?Nt(Ge,ae):Oe.indexOf(q.MULTI_PREFIX)===0&&(Te=Oe.replace(q.MULTI_PREFIX,""),Ge.forEach(function(ti,Ji){var Xn={type:q.FEATURE,properties:D.properties,geometry:{type:Te,coordinates:ti}};Ht=Ht.concat(Mo(Xn,G,Ji))})),Ht}var qr={enable:function(D){setTimeout(function(){D.map&&D.map.doubleClickZoom&&D._ctx&&D._ctx.store&&D._ctx.store.getInitialConfigValue&&D._ctx.store.getInitialConfigValue("doubleClickZoom")&&D.map.doubleClickZoom.enable()},0)},disable:function(D){setTimeout(function(){D.map&&D.map.doubleClickZoom&&D.map.doubleClickZoom.disable()},0)}},Pr={exports:{}},lt=function(D){if(!D||!D.type)return null;var G=ft[D.type];if(!G)return null;if(G==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:D}]};if(G==="feature")return{type:"FeatureCollection",features:[D]};if(G==="featurecollection")return D},ft={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Ct=c(lt),Dt=Object.freeze({__proto__:null,default:function D(G){switch(G&&G.type||null){case"FeatureCollection":return G.features=G.features.reduce(function(ae,Te){return ae.concat(D(Te))},[]),G;case"Feature":return G.geometry?D(G.geometry).map(function(ae){var Te={type:"Feature",properties:JSON.parse(JSON.stringify(G.properties)),geometry:ae};return G.id!==void 0&&(Te.id=G.id),Te}):[G];case"MultiPoint":return G.coordinates.map(function(ae){return{type:"Point",coordinates:ae}});case"MultiPolygon":return G.coordinates.map(function(ae){return{type:"Polygon",coordinates:ae}});case"MultiLineString":return G.coordinates.map(function(ae){return{type:"LineString",coordinates:ae}});case"GeometryCollection":return G.geometries.map(D).reduce(function(ae,Te){return ae.concat(Te)},[]);case"Point":case"Polygon":case"LineString":return[G]}}}),zt=lt,jt=h(Dt),Zt=function(D){return function G(ae){return Array.isArray(ae)&&ae.length&&typeof ae[0]=="number"?[ae]:ae.reduce(function(Te,Me){return Array.isArray(Me)&&Array.isArray(Me[0])?Te.concat(G(Me)):(Te.push(Me),Te)},[])}(D)};jt instanceof Function||(jt=jt.default);var Bt={exports:{}},ai=Bt.exports=function(D){return new At(D)};function At(D){this.value=D}function zi(D,G,ae){var Te=[],Me=[],Oe=!0;return function Ge(Gt){var Ht=ae?mn(Gt):Gt,Nt={},_i=!0,ti={node:Ht,node_:Gt,path:[].concat(Te),parent:Me[Me.length-1],parents:Me,key:Te.slice(-1)[0],isRoot:Te.length===0,level:Te.length,circular:null,update:function(tn,pr){ti.isRoot||(ti.parent.node[ti.key]=tn),ti.node=tn,pr&&(_i=!1)},delete:function(tn){delete ti.parent.node[ti.key],tn&&(_i=!1)},remove:function(tn){Qn(ti.parent.node)?ti.parent.node.splice(ti.key,1):delete ti.parent.node[ti.key],tn&&(_i=!1)},keys:null,before:function(tn){Nt.before=tn},after:function(tn){Nt.after=tn},pre:function(tn){Nt.pre=tn},post:function(tn){Nt.post=tn},stop:function(){Oe=!1},block:function(){_i=!1}};if(!Oe)return ti;function Ji(){if(typeof ti.node=="object"&&ti.node!==null){ti.keys&&ti.node_===ti.node||(ti.keys=gi(ti.node)),ti.isLeaf=ti.keys.length==0;for(var tn=0;tn<Me.length;tn++)if(Me[tn].node_===Gt){ti.circular=Me[tn];break}}else ti.isLeaf=!0,ti.keys=null;ti.notLeaf=!ti.isLeaf,ti.notRoot=!ti.isRoot}Ji();var Xn=G.call(ti,ti.node);return Xn!==void 0&&ti.update&&ti.update(Xn),Nt.before&&Nt.before.call(ti,ti.node),_i&&(typeof ti.node!="object"||ti.node===null||ti.circular||(Me.push(ti),Ji(),Kn(ti.keys,function(tn,pr){Te.push(tn),Nt.pre&&Nt.pre.call(ti,ti.node[tn],tn);var Ot=Ge(ti.node[tn]);ae&&or.call(ti.node,tn)&&(ti.node[tn]=Ot.node),Ot.isLast=pr==ti.keys.length-1,Ot.isFirst=pr==0,Nt.post&&Nt.post.call(ti,Ot),Te.pop()}),Me.pop()),Nt.after&&Nt.after.call(ti,ti.node)),ti}(D).node}function mn(D){if(typeof D=="object"&&D!==null){var G;if(Qn(D))G=[];else if(un(D)==="[object Date]")G=new Date(D.getTime?D.getTime():D);else if(function(Me){return un(Me)==="[object RegExp]"}(D))G=new RegExp(D);else if(function(Me){return un(Me)==="[object Error]"}(D))G={message:D.message};else if(function(Me){return un(Me)==="[object Boolean]"}(D))G=new Boolean(D);else if(function(Me){return un(Me)==="[object Number]"}(D))G=new Number(D);else if(function(Me){return un(Me)==="[object String]"}(D))G=new String(D);else if(Object.create&&Object.getPrototypeOf)G=Object.create(Object.getPrototypeOf(D));else if(D.constructor===Object)G={};else{var ae=D.constructor&&D.constructor.prototype||D.__proto__||{},Te=function(){};Te.prototype=ae,G=new Te}return Kn(gi(D),function(Me){G[Me]=D[Me]}),G}return D}At.prototype.get=function(D){for(var G=this.value,ae=0;ae<D.length;ae++){var Te=D[ae];if(!G||!or.call(G,Te)){G=void 0;break}G=G[Te]}return G},At.prototype.has=function(D){for(var G=this.value,ae=0;ae<D.length;ae++){var Te=D[ae];if(!G||!or.call(G,Te))return!1;G=G[Te]}return!0},At.prototype.set=function(D,G){for(var ae=this.value,Te=0;Te<D.length-1;Te++){var Me=D[Te];or.call(ae,Me)||(ae[Me]={}),ae=ae[Me]}return ae[D[Te]]=G,G},At.prototype.map=function(D){return zi(this.value,D,!0)},At.prototype.forEach=function(D){return this.value=zi(this.value,D,!1),this.value},At.prototype.reduce=function(D,G){var ae=arguments.length===1,Te=ae?this.value:G;return this.forEach(function(Me){this.isRoot&&ae||(Te=D.call(this,Te,Me))}),Te},At.prototype.paths=function(){var D=[];return this.forEach(function(G){D.push(this.path)}),D},At.prototype.nodes=function(){var D=[];return this.forEach(function(G){D.push(this.node)}),D},At.prototype.clone=function(){var D=[],G=[];return function ae(Te){for(var Me=0;Me<D.length;Me++)if(D[Me]===Te)return G[Me];if(typeof Te=="object"&&Te!==null){var Oe=mn(Te);return D.push(Te),G.push(Oe),Kn(gi(Te),function(Ge){Oe[Ge]=ae(Te[Ge])}),D.pop(),G.pop(),Oe}return Te}(this.value)};var gi=Object.keys||function(D){var G=[];for(var ae in D)G.push(ae);return G};function un(D){return Object.prototype.toString.call(D)}var Qn=Array.isArray||function(D){return Object.prototype.toString.call(D)==="[object Array]"},Kn=function(D,G){if(D.forEach)return D.forEach(G);for(var ae=0;ae<D.length;ae++)G(D[ae],ae,D)};Kn(gi(At.prototype),function(D){ai[D]=function(G){var ae=[].slice.call(arguments,1),Te=new At(G);return Te[D].apply(Te,ae)}});var or=Object.hasOwnProperty||function(D,G){return G in D},Kr=Bt.exports,Lo=sr;function sr(D){if(!(this instanceof sr))return new sr(D);this._bbox=D||[1/0,1/0,-1/0,-1/0],this._valid=!!D}sr.prototype.include=function(D){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],D[0]),this._bbox[1]=Math.min(this._bbox[1],D[1]),this._bbox[2]=Math.max(this._bbox[2],D[0]),this._bbox[3]=Math.max(this._bbox[3],D[1]),this},sr.prototype.equals=function(D){var G;return G=D instanceof sr?D.bbox():D,this._bbox[0]==G[0]&&this._bbox[1]==G[1]&&this._bbox[2]==G[2]&&this._bbox[3]==G[3]},sr.prototype.center=function(D){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},sr.prototype.union=function(D){var G;return this._valid=!0,G=D instanceof sr?D.bbox():D,this._bbox[0]=Math.min(this._bbox[0],G[0]),this._bbox[1]=Math.min(this._bbox[1],G[1]),this._bbox[2]=Math.max(this._bbox[2],G[2]),this._bbox[3]=Math.max(this._bbox[3],G[3]),this},sr.prototype.bbox=function(){return this._valid?this._bbox:null},sr.prototype.contains=function(D){if(!D)return this._fastContains();if(!this._valid)return null;var G=D[0],ae=D[1];return this._bbox[0]<=G&&this._bbox[1]<=ae&&this._bbox[2]>=G&&this._bbox[3]>=ae},sr.prototype.intersect=function(D){return this._valid?(G=D instanceof sr?D.bbox():D,!(this._bbox[0]>G[2]||this._bbox[2]<G[0]||this._bbox[3]<G[1]||this._bbox[1]>G[3])):null;var G},sr.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var D="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",D)},sr.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Oo=function(D){if(!D)return[];var G=jt(zt(D)),ae=[];return G.features.forEach(function(Te){Te.geometry&&(ae=ae.concat(Zt(Te.geometry.coordinates)))}),ae},$r=Kr,Eo=Lo,ys={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Ka=Object.keys(ys);function Dl(D){for(var G=Eo(),ae=Oo(D),Te=0;Te<ae.length;Te++)G.include(ae[Te]);return G}Pr.exports=function(D){return Dl(D).bbox()},Pr.exports.polygon=function(D){return Dl(D).polygon()},Pr.exports.bboxify=function(D){return $r(D).map(function(G){G&&Ka.some(function(ae){return!!G[ae]&&ys[ae].indexOf(G.type)!==-1})&&(G.bbox=Dl(G).bbox(),this.update(G))})};var Ec=c(Pr.exports),xa=-90;function Ll(D,G){var ae=xa,Te=90,Me=xa,Oe=90,Ge=270,Gt=-270;D.forEach(function(Nt){var _i=Ec(Nt),ti=_i[1],Ji=_i[3],Xn=_i[0],tn=_i[2];ti>ae&&(ae=ti),Ji<Te&&(Te=Ji),Ji>Me&&(Me=Ji),ti<Oe&&(Oe=ti),Xn<Ge&&(Ge=Xn),tn>Gt&&(Gt=tn)});var Ht=G;return ae+Ht.lat>85&&(Ht.lat=85-ae),Me+Ht.lat>90&&(Ht.lat=90-Me),Te+Ht.lat<-85&&(Ht.lat=-85-Te),Oe+Ht.lat<xa&&(Ht.lat=xa-Oe),Ge+Ht.lng<=-270&&(Ht.lng+=360*Math.ceil(Math.abs(Ht.lng)/360)),Gt+Ht.lng>=270&&(Ht.lng-=360*Math.ceil(Math.abs(Ht.lng)/360)),Ht}function ba(D,G){var ae=Ll(D.map(function(Te){return Te.toGeoJSON()}),G);D.forEach(function(Te){var Me,Oe=Te.getCoordinates(),Ge=function(Ht){var Nt={lng:Ht[0]+ae.lng,lat:Ht[1]+ae.lat};return[Nt.lng,Nt.lat]},Gt=function(Ht){return Ht.map(function(Nt){return Ge(Nt)})};Te.type===q.POINT?Me=Ge(Oe):Te.type===q.LINE_STRING||Te.type===q.MULTI_POINT?Me=Oe.map(Ge):Te.type===q.POLYGON||Te.type===q.MULTI_LINE_STRING?Me=Oe.map(Gt):Te.type===q.MULTI_POLYGON&&(Me=Oe.map(function(Ht){return Ht.map(function(Nt){return Gt(Nt)})})),Te.incomingCoords(Me)})}var fr={onSetup:function(D){var G=this,ae={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:D.featureIds||[]};return this.setSelected(ae.initiallySelectedFeatureIds.filter(function(Te){return G.getFeature(Te)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),ae},fireUpdate:function(){this.map.fire(J.UPDATE,{action:ue.MOVE,features:this.getSelected().map(function(D){return D.toGeoJSON()})})},fireActionable:function(){var D=this,G=this.getSelected(),ae=G.filter(function(Gt){return D.isInstanceOf("MultiFeature",Gt)}),Te=!1;if(G.length>1){Te=!0;var Me=G[0].type.replace("Multi","");G.forEach(function(Gt){Gt.type.replace("Multi","")!==Me&&(Te=!1)})}var Oe=ae.length>0,Ge=G.length>0;this.setActionableState({combineFeatures:Te,uncombineFeatures:Oe,trash:Ge})},getUniqueIds:function(D){return D.length?D.map(function(G){return G.properties.id}).filter(function(G){return G!==void 0}).reduce(function(G,ae){return G.add(ae),G},new pt).values():[]},stopExtendedInteractions:function(D){D.boxSelectElement&&(D.boxSelectElement.parentNode&&D.boxSelectElement.parentNode.removeChild(D.boxSelectElement),D.boxSelectElement=null),this.map.dragPan.enable(),D.boxSelecting=!1,D.canBoxSelect=!1,D.dragMoving=!1,D.canDragMove=!1},onStop:function(){qr.enable(this)},onMouseMove:function(D,G){return cn(G)&&D.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(D),!0},onMouseOut:function(D){return!D.dragMoving||this.fireUpdate()}};fr.onTap=fr.onClick=function(D,G){return $t(G)?this.clickAnywhere(D,G):Jt(ce.VERTEX)(G)?this.clickOnVertex(D,G):cn(G)?this.clickOnFeature(D,G):void 0},fr.clickAnywhere=function(D){var G=this,ae=this.getSelectedIds();ae.length&&(this.clearSelectedFeatures(),ae.forEach(function(Te){return G.doRender(Te)})),qr.enable(this),this.stopExtendedInteractions(D)},fr.clickOnVertex=function(D,G){this.changeMode(Y.DIRECT_SELECT,{featureId:G.featureTarget.properties.parent,coordPath:G.featureTarget.properties.coord_path,startPos:G.lngLat}),this.updateUIClasses({mouse:V.MOVE})},fr.startOnActiveFeature=function(D,G){this.stopExtendedInteractions(D),this.map.dragPan.disable(),this.doRender(G.featureTarget.properties.id),D.canDragMove=!0,D.dragMoveLocation=G.lngLat},fr.clickOnFeature=function(D,G){var ae=this;qr.disable(this),this.stopExtendedInteractions(D);var Te=Fn(G),Me=this.getSelectedIds(),Oe=G.featureTarget.properties.id,Ge=this.isSelected(Oe);if(!Te&&Ge&&this.getFeature(Oe).type!==q.POINT)return this.changeMode(Y.DIRECT_SELECT,{featureId:Oe});Ge&&Te?(this.deselect(Oe),this.updateUIClasses({mouse:V.POINTER}),Me.length===1&&qr.enable(this)):!Ge&&Te?(this.select(Oe),this.updateUIClasses({mouse:V.MOVE})):Ge||Te||(Me.forEach(function(Gt){return ae.doRender(Gt)}),this.setSelected(Oe),this.updateUIClasses({mouse:V.MOVE})),this.doRender(Oe)},fr.onMouseDown=function(D,G){return li(G)?this.startOnActiveFeature(D,G):this.drawConfig.boxSelect&&Tt(G)?this.startBoxSelect(D,G):void 0},fr.startBoxSelect=function(D,G){this.stopExtendedInteractions(D),this.map.dragPan.disable(),D.boxSelectStartLocation=$n(G.originalEvent,this.map.getContainer()),D.canBoxSelect=!0},fr.onTouchStart=function(D,G){if(li(G))return this.startOnActiveFeature(D,G)},fr.onDrag=function(D,G){return D.canDragMove?this.dragMove(D,G):this.drawConfig.boxSelect&&D.canBoxSelect?this.whileBoxSelect(D,G):void 0},fr.whileBoxSelect=function(D,G){D.boxSelecting=!0,this.updateUIClasses({mouse:V.ADD}),D.boxSelectElement||(D.boxSelectElement=document.createElement("div"),D.boxSelectElement.classList.add(L.BOX_SELECT),this.map.getContainer().appendChild(D.boxSelectElement));var ae=$n(G.originalEvent,this.map.getContainer()),Te=Math.min(D.boxSelectStartLocation.x,ae.x),Me=Math.max(D.boxSelectStartLocation.x,ae.x),Oe=Math.min(D.boxSelectStartLocation.y,ae.y),Ge=Math.max(D.boxSelectStartLocation.y,ae.y),Gt="translate("+Te+"px, "+Oe+"px)";D.boxSelectElement.style.transform=Gt,D.boxSelectElement.style.WebkitTransform=Gt,D.boxSelectElement.style.width=Me-Te+"px",D.boxSelectElement.style.height=Ge-Oe+"px"},fr.dragMove=function(D,G){D.dragMoving=!0,G.originalEvent.stopPropagation();var ae={lng:G.lngLat.lng-D.dragMoveLocation.lng,lat:G.lngLat.lat-D.dragMoveLocation.lat};ba(this.getSelected(),ae),D.dragMoveLocation=G.lngLat},fr.onTouchEnd=fr.onMouseUp=function(D,G){var ae=this;if(D.dragMoving)this.fireUpdate();else if(D.boxSelecting){var Te=[D.boxSelectStartLocation,$n(G.originalEvent,this.map.getContainer())],Me=this.featuresAt(null,Te,"click"),Oe=this.getUniqueIds(Me).filter(function(Ge){return!ae.isSelected(Ge)});Oe.length&&(this.select(Oe),Oe.forEach(function(Ge){return ae.doRender(Ge)}),this.updateUIClasses({mouse:V.MOVE}))}this.stopExtendedInteractions(D)},fr.toDisplayFeatures=function(D,G,ae){G.properties.active=this.isSelected(G.properties.id)?fe.ACTIVE:fe.INACTIVE,ae(G),this.fireActionable(),G.properties.active===fe.ACTIVE&&G.geometry.type!==q.POINT&&Mo(G).forEach(ae)},fr.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},fr.onCombineFeatures=function(){var D=this.getSelected();if(!(D.length===0||D.length<2)){for(var G=[],ae=[],Te=D[0].type.replace("Multi",""),Me=0;Me<D.length;Me++){var Oe=D[Me];if(Oe.type.replace("Multi","")!==Te)return;Oe.type.includes("Multi")?Oe.getCoordinates().forEach(function(Gt){G.push(Gt)}):G.push(Oe.getCoordinates()),ae.push(Oe.toGeoJSON())}if(ae.length>1){var Ge=this.newFeature({type:q.FEATURE,properties:ae[0].properties,geometry:{type:"Multi"+Te,coordinates:G}});this.addFeature(Ge),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([Ge.id]),this.map.fire(J.COMBINE_FEATURES,{createdFeatures:[Ge.toGeoJSON()],deletedFeatures:ae})}this.fireActionable()}},fr.onUncombineFeatures=function(){var D=this,G=this.getSelected();if(G.length!==0){for(var ae=[],Te=[],Me=function(Ge){var Gt=G[Ge];D.isInstanceOf("MultiFeature",Gt)&&(Gt.getFeatures().forEach(function(Ht){D.addFeature(Ht),Ht.properties=Gt.properties,ae.push(Ht.toGeoJSON()),D.select([Ht.id])}),D.deleteFeature(Gt.id,{silent:!0}),Te.push(Gt.toGeoJSON()))},Oe=0;Oe<G.length;Oe++)Me(Oe);ae.length>1&&this.map.fire(J.UNCOMBINE_FEATURES,{createdFeatures:ae,deletedFeatures:Te}),this.fireActionable()}};var _u=Jt(ce.VERTEX),uo=Jt(ce.MIDPOINT),os={fireUpdate:function(){this.map.fire(J.UPDATE,{action:ue.CHANGE_COORDINATES,features:this.getSelected().map(function(D){return D.toGeoJSON()})})},fireActionable:function(D){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:D.selectedCoordPaths.length>0})},startDragging:function(D,G){this.map.dragPan.disable(),D.canDragMove=!0,D.dragMoveLocation=G.lngLat},stopDragging:function(D){this.map.dragPan.enable(),D.dragMoving=!1,D.canDragMove=!1,D.dragMoveLocation=null},onVertex:function(D,G){this.startDragging(D,G);var ae=G.featureTarget.properties,Te=D.selectedCoordPaths.indexOf(ae.coord_path);Fn(G)||Te!==-1?Fn(G)&&Te===-1&&D.selectedCoordPaths.push(ae.coord_path):D.selectedCoordPaths=[ae.coord_path];var Me=this.pathsToCoordinates(D.featureId,D.selectedCoordPaths);this.setSelectedCoordinates(Me)},onMidpoint:function(D,G){this.startDragging(D,G);var ae=G.featureTarget.properties;D.feature.addCoordinate(ae.coord_path,ae.lng,ae.lat),this.fireUpdate(),D.selectedCoordPaths=[ae.coord_path]},pathsToCoordinates:function(D,G){return G.map(function(ae){return{feature_id:D,coord_path:ae}})},onFeature:function(D,G){D.selectedCoordPaths.length===0?this.startDragging(D,G):this.stopDragging(D)},dragFeature:function(D,G,ae){ba(this.getSelected(),ae),D.dragMoveLocation=G.lngLat},dragVertex:function(D,G,ae){for(var Te=D.selectedCoordPaths.map(function(Gt){return D.feature.getCoordinate(Gt)}),Me=Ll(Te.map(function(Gt){return{type:q.FEATURE,properties:{},geometry:{type:q.POINT,coordinates:Gt}}}),ae),Oe=0;Oe<Te.length;Oe++){var Ge=Te[Oe];D.feature.updateCoordinate(D.selectedCoordPaths[Oe],Ge[0]+Me.lng,Ge[1]+Me.lat)}},clickNoTarget:function(){this.changeMode(Y.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(Y.SIMPLE_SELECT)},clickActiveFeature:function(D){D.selectedCoordPaths=[],this.clearSelectedCoordinates(),D.feature.changed()},onSetup:function(D){var G=D.featureId,ae=this.getFeature(G);if(!ae)throw new Error("You must provide a featureId to enter direct_select mode");if(ae.type===q.POINT)throw new TypeError("direct_select mode doesn't handle point features");var Te={featureId:G,feature:ae,dragMoveLocation:D.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:D.coordPath?[D.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(G,Te.selectedCoordPaths)),this.setSelected(G),qr.disable(this),this.setActionableState({trash:!0}),Te},onStop:function(){qr.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(D,G,ae){D.featureId===G.properties.id?(G.properties.active=fe.ACTIVE,ae(G),Mo(G,{map:this.map,midpoints:!0,selectedPaths:D.selectedCoordPaths}).forEach(ae)):(G.properties.active=fe.INACTIVE,ae(G)),this.fireActionable(D)},onTrash:function(D){D.selectedCoordPaths.sort(function(G,ae){return ae.localeCompare(G,"en",{numeric:!0})}).forEach(function(G){return D.feature.removeCoordinate(G)}),this.fireUpdate(),D.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(D),D.feature.isValid()===!1&&(this.deleteFeature([D.featureId]),this.changeMode(Y.SIMPLE_SELECT,{}))},onMouseMove:function(D,G){var ae=li(G),Te=_u(G),Me=uo(G),Oe=D.selectedCoordPaths.length===0;return ae&&Oe||Te&&!Oe?this.updateUIClasses({mouse:V.MOVE}):this.updateUIClasses({mouse:V.NONE}),(Te||ae||Me)&&D.dragMoving&&this.fireUpdate(),this.stopDragging(D),!0},onMouseOut:function(D){return D.dragMoving&&this.fireUpdate(),!0}};os.onTouchStart=os.onMouseDown=function(D,G){return _u(G)?this.onVertex(D,G):li(G)?this.onFeature(D,G):uo(G)?this.onMidpoint(D,G):void 0},os.onDrag=function(D,G){if(D.canDragMove===!0){D.dragMoving=!0,G.originalEvent.stopPropagation();var ae={lng:G.lngLat.lng-D.dragMoveLocation.lng,lat:G.lngLat.lat-D.dragMoveLocation.lat};D.selectedCoordPaths.length>0?this.dragVertex(D,G,ae):this.dragFeature(D,G,ae),D.dragMoveLocation=G.lngLat}},os.onClick=function(D,G){return $t(G)?this.clickNoTarget(D,G):li(G)?this.clickActiveFeature(D,G):wi(G)?this.clickInactive(D,G):void this.stopDragging(D)},os.onTap=function(D,G){return $t(G)?this.clickNoTarget(D,G):li(G)?this.clickActiveFeature(D,G):wi(G)?this.clickInactive(D,G):void 0},os.onTouchEnd=os.onMouseUp=function(D){D.dragMoving&&this.fireUpdate(),this.stopDragging(D)};var ho={};function Ao(D,G){return!!D.lngLat&&D.lngLat.lng===G[0]&&D.lngLat.lat===G[1]}ho.onSetup=function(){var D=this.newFeature({type:q.FEATURE,properties:{},geometry:{type:q.POINT,coordinates:[]}});return this.addFeature(D),this.clearSelectedFeatures(),this.updateUIClasses({mouse:V.ADD}),this.activateUIButton(X.POINT),this.setActionableState({trash:!0}),{point:D}},ho.stopDrawingAndRemove=function(D){this.deleteFeature([D.point.id],{silent:!0}),this.changeMode(Y.SIMPLE_SELECT)},ho.onTap=ho.onClick=function(D,G){this.updateUIClasses({mouse:V.MOVE}),D.point.updateCoordinate("",G.lngLat.lng,G.lngLat.lat),this.map.fire(J.CREATE,{features:[D.point.toGeoJSON()]}),this.changeMode(Y.SIMPLE_SELECT,{featureIds:[D.point.id]})},ho.onStop=function(D){this.activateUIButton(),D.point.getCoordinate().length||this.deleteFeature([D.point.id],{silent:!0})},ho.toDisplayFeatures=function(D,G,ae){var Te=G.properties.id===D.point.id;if(G.properties.active=Te?fe.ACTIVE:fe.INACTIVE,!Te)return ae(G)},ho.onTrash=ho.stopDrawingAndRemove,ho.onKeyUp=function(D,G){if(gn(G)||wn(G))return this.stopDrawingAndRemove(D,G)};var Ro={onSetup:function(){var D=this.newFeature({type:q.FEATURE,properties:{},geometry:{type:q.POLYGON,coordinates:[[]]}});return this.addFeature(D),this.clearSelectedFeatures(),qr.disable(this),this.updateUIClasses({mouse:V.ADD}),this.activateUIButton(X.POLYGON),this.setActionableState({trash:!0}),{polygon:D,currentVertexPosition:0}},clickAnywhere:function(D,G){if(D.currentVertexPosition>0&&Ao(G,D.polygon.coordinates[0][D.currentVertexPosition-1]))return this.changeMode(Y.SIMPLE_SELECT,{featureIds:[D.polygon.id]});this.updateUIClasses({mouse:V.ADD}),D.polygon.updateCoordinate("0."+D.currentVertexPosition,G.lngLat.lng,G.lngLat.lat),D.currentVertexPosition++,D.polygon.updateCoordinate("0."+D.currentVertexPosition,G.lngLat.lng,G.lngLat.lat)},clickOnVertex:function(D){return this.changeMode(Y.SIMPLE_SELECT,{featureIds:[D.polygon.id]})},onMouseMove:function(D,G){D.polygon.updateCoordinate("0."+D.currentVertexPosition,G.lngLat.lng,G.lngLat.lat),dn(G)&&this.updateUIClasses({mouse:V.POINTER})}};Ro.onTap=Ro.onClick=function(D,G){return dn(G)?this.clickOnVertex(D,G):this.clickAnywhere(D,G)},Ro.onKeyUp=function(D,G){gn(G)?(this.deleteFeature([D.polygon.id],{silent:!0}),this.changeMode(Y.SIMPLE_SELECT)):wn(G)&&this.changeMode(Y.SIMPLE_SELECT,{featureIds:[D.polygon.id]})},Ro.onStop=function(D){this.updateUIClasses({mouse:V.NONE}),qr.enable(this),this.activateUIButton(),this.getFeature(D.polygon.id)!==void 0&&(D.polygon.removeCoordinate("0."+D.currentVertexPosition),D.polygon.isValid()?this.map.fire(J.CREATE,{features:[D.polygon.toGeoJSON()]}):(this.deleteFeature([D.polygon.id],{silent:!0}),this.changeMode(Y.SIMPLE_SELECT,{},{silent:!0})))},Ro.toDisplayFeatures=function(D,G,ae){var Te=G.properties.id===D.polygon.id;if(G.properties.active=Te?fe.ACTIVE:fe.INACTIVE,!Te)return ae(G);if(G.geometry.coordinates.length!==0){var Me=G.geometry.coordinates[0].length;if(!(Me<3)){if(G.properties.meta=ce.FEATURE,ae(Jr(D.polygon.id,G.geometry.coordinates[0][0],"0.0",!1)),Me>3){var Oe=G.geometry.coordinates[0].length-3;ae(Jr(D.polygon.id,G.geometry.coordinates[0][Oe],"0."+Oe,!1))}if(Me<=4){var Ge=[[G.geometry.coordinates[0][0][0],G.geometry.coordinates[0][0][1]],[G.geometry.coordinates[0][1][0],G.geometry.coordinates[0][1][1]]];if(ae({type:q.FEATURE,properties:G.properties,geometry:{coordinates:Ge,type:q.LINE_STRING}}),Me===3)return}return ae(G)}}},Ro.onTrash=function(D){this.deleteFeature([D.polygon.id],{silent:!0}),this.changeMode(Y.SIMPLE_SELECT)};var fo={onSetup:function(D){var G,ae,Te=(D=D||{}).featureId,Me="forward";if(Te){if(!(G=this.getFeature(Te)))throw new Error("Could not find a feature with the provided featureId");var Oe=D.from;if(Oe&&Oe.type==="Feature"&&Oe.geometry&&Oe.geometry.type==="Point"&&(Oe=Oe.geometry),Oe&&Oe.type==="Point"&&Oe.coordinates&&Oe.coordinates.length===2&&(Oe=Oe.coordinates),!Oe||!Array.isArray(Oe))throw new Error("Please use the `from` property to indicate which point to continue the line from");var Ge=G.coordinates.length-1;if(G.coordinates[Ge][0]===Oe[0]&&G.coordinates[Ge][1]===Oe[1])ae=Ge+1,G.addCoordinate.apply(G,[ae].concat(G.coordinates[Ge]));else{if(G.coordinates[0][0]!==Oe[0]||G.coordinates[0][1]!==Oe[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");Me="backwards",ae=0,G.addCoordinate.apply(G,[ae].concat(G.coordinates[0]))}}else G=this.newFeature({type:q.FEATURE,properties:{},geometry:{type:q.LINE_STRING,coordinates:[]}}),ae=0,this.addFeature(G);return this.clearSelectedFeatures(),qr.disable(this),this.updateUIClasses({mouse:V.ADD}),this.activateUIButton(X.LINE),this.setActionableState({trash:!0}),{line:G,currentVertexPosition:ae,direction:Me}},clickAnywhere:function(D,G){if(D.currentVertexPosition>0&&Ao(G,D.line.coordinates[D.currentVertexPosition-1])||D.direction==="backwards"&&Ao(G,D.line.coordinates[D.currentVertexPosition+1]))return this.changeMode(Y.SIMPLE_SELECT,{featureIds:[D.line.id]});this.updateUIClasses({mouse:V.ADD}),D.line.updateCoordinate(D.currentVertexPosition,G.lngLat.lng,G.lngLat.lat),D.direction==="forward"?(D.currentVertexPosition++,D.line.updateCoordinate(D.currentVertexPosition,G.lngLat.lng,G.lngLat.lat)):D.line.addCoordinate(0,G.lngLat.lng,G.lngLat.lat)},clickOnVertex:function(D){return this.changeMode(Y.SIMPLE_SELECT,{featureIds:[D.line.id]})},onMouseMove:function(D,G){D.line.updateCoordinate(D.currentVertexPosition,G.lngLat.lng,G.lngLat.lat),dn(G)&&this.updateUIClasses({mouse:V.POINTER})}};fo.onTap=fo.onClick=function(D,G){if(dn(G))return this.clickOnVertex(D,G);this.clickAnywhere(D,G)},fo.onKeyUp=function(D,G){wn(G)?this.changeMode(Y.SIMPLE_SELECT,{featureIds:[D.line.id]}):gn(G)&&(this.deleteFeature([D.line.id],{silent:!0}),this.changeMode(Y.SIMPLE_SELECT))},fo.onStop=function(D){qr.enable(this),this.activateUIButton(),this.getFeature(D.line.id)!==void 0&&(D.line.removeCoordinate(""+D.currentVertexPosition),D.line.isValid()?this.map.fire(J.CREATE,{features:[D.line.toGeoJSON()]}):(this.deleteFeature([D.line.id],{silent:!0}),this.changeMode(Y.SIMPLE_SELECT,{},{silent:!0})))},fo.onTrash=function(D){this.deleteFeature([D.line.id],{silent:!0}),this.changeMode(Y.SIMPLE_SELECT)},fo.toDisplayFeatures=function(D,G,ae){var Te=G.properties.id===D.line.id;if(G.properties.active=Te?fe.ACTIVE:fe.INACTIVE,!Te)return ae(G);G.geometry.coordinates.length<2||(G.properties.meta=ce.FEATURE,ae(Jr(D.line.id,G.geometry.coordinates[D.direction==="forward"?G.geometry.coordinates.length-2:1],""+(D.direction==="forward"?G.geometry.coordinates.length-2:1),!1)),ae(G))};var Ne={simple_select:fr,direct_select:os,draw_point:ho,draw_polygon:Ro,draw_line_string:fo},ci={defaultMode:Y.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Wt,modes:Ne,controls:{},userProperties:!1},vs={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},ss={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function vr(D,G){return D.map(function(ae){return ae.source?ae:Ie(ae,{id:ae.id+"."+G,source:G==="hot"?F.HOT:F.COLD})})}var as={exports:{}};(function(D,G){var ae="__lodash_hash_undefined__",Te=9007199254740991,Me="[object Arguments]",Oe="[object Array]",Ge="[object Boolean]",Gt="[object Date]",Ht="[object Error]",Nt="[object Function]",_i="[object Map]",ti="[object Number]",Ji="[object Object]",Xn="[object Promise]",tn="[object RegExp]",pr="[object Set]",Ot="[object String]",Di="[object Symbol]",Ln="[object WeakMap]",Fr="[object ArrayBuffer]",In="[object DataView]",Bn=/^\[object .+?Constructor\]$/,vu=/^(?:0|[1-9]\d*)$/,Nn={};Nn["[object Float32Array]"]=Nn["[object Float64Array]"]=Nn["[object Int8Array]"]=Nn["[object Int16Array]"]=Nn["[object Int32Array]"]=Nn["[object Uint8Array]"]=Nn["[object Uint8ClampedArray]"]=Nn["[object Uint16Array]"]=Nn["[object Uint32Array]"]=!0,Nn[Me]=Nn[Oe]=Nn[Fr]=Nn[Ge]=Nn[In]=Nn[Gt]=Nn[Ht]=Nn[Nt]=Nn[_i]=Nn[ti]=Nn[Ji]=Nn[tn]=Nn[pr]=Nn[Ot]=Nn[Ln]=!1;var po=typeof xh=="object"&&xh&&xh.Object===Object&&xh,jo=typeof self=="object"&&self&&self.Object===Object&&self,xs=po||jo||Function("return this")(),Ta=G&&!G.nodeType&&G,Mr=Ta&&D&&!D.nodeType&&D,$a=Mr&&Mr.exports===Ta,Ol=$a&&po.process,Sa=function(){try{return Ol&&Ol.binding&&Ol.binding("util")}catch{}}(),xr=Sa&&Sa.isTypedArray;function xu(qe,bt){for(var hi=-1,Ri=qe==null?0:qe.length;++hi<Ri;)if(bt(qe[hi],hi,qe))return!0;return!1}function bu(qe){var bt=-1,hi=Array(qe.size);return qe.forEach(function(Ri,jn){hi[++bt]=[jn,Ri]}),hi}function ls(qe){var bt=-1,hi=Array(qe.size);return qe.forEach(function(Ri){hi[++bt]=Ri}),hi}var Qa,el,pn,lf=Array.prototype,Ac=Function.prototype,cs=Object.prototype,Ic=xs["__core-js_shared__"],Cc=Ac.toString,Qr=cs.hasOwnProperty,wu=(Qa=/[^.]+$/.exec(Ic&&Ic.keys&&Ic.keys.IE_PROTO||""))?"Symbol(src)_1."+Qa:"",Go=cs.toString,Rl=RegExp("^"+Cc.call(Qr).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Pc=$a?xs.Buffer:void 0,zl=xs.Symbol,Fl=xs.Uint8Array,zs=cs.propertyIsEnumerable,ia=lf.splice,na=zl?zl.toStringTag:void 0,ra=Object.getOwnPropertySymbols,Tu=Pc?Pc.isBuffer:void 0,Fs=(el=Object.keys,pn=Object,function(qe){return el(pn(qe))}),Ki=oa(xs,"DataView"),Bl=oa(xs,"Map"),Su=oa(xs,"Promise"),Mu=oa(xs,"Set"),Nl=oa(xs,"WeakMap"),Vl=oa(Object,"create"),kc=Us(Ki),Eu=Us(Bl),Au=Us(Su),Ma=Us(Mu),Iu=Us(Nl),us=zl?zl.prototype:void 0,tl=us?us.valueOf:void 0;function Bs(qe){var bt=-1,hi=qe==null?0:qe.length;for(this.clear();++bt<hi;){var Ri=qe[bt];this.set(Ri[0],Ri[1])}}function hs(qe){var bt=-1,hi=qe==null?0:qe.length;for(this.clear();++bt<hi;){var Ri=qe[bt];this.set(Ri[0],Ri[1])}}function bs(qe){var bt=-1,hi=qe==null?0:qe.length;for(this.clear();++bt<hi;){var Ri=qe[bt];this.set(Ri[0],Ri[1])}}function Ea(qe){var bt=-1,hi=qe==null?0:qe.length;for(this.__data__=new bs;++bt<hi;)this.add(qe[bt])}function Lt(qe){var bt=this.__data__=new hs(qe);this.size=bt.size}function jh(qe,bt){var hi=Gl(qe),Ri=!hi&&uf(qe),jn=!hi&&!Ri&&ku(qe),qi=!hi&&!Ri&&!jn&&Ou(qe),ar=hi||Ri||jn||qi,lr=ar?function(br,Ho){for(var qo=-1,Wr=Array(br);++qo<br;)Wr[qo]=Ho(qo);return Wr}(qe.length,String):[],Io=lr.length;for(var Br in qe)!bt&&!Qr.call(qe,Br)||ar&&(Br=="length"||jn&&(Br=="offset"||Br=="parent")||qi&&(Br=="buffer"||Br=="byteLength"||Br=="byteOffset")||Pu(Br,Io))||lr.push(Br);return lr}function Aa(qe,bt){for(var hi=qe.length;hi--;)if(Gh(qe[hi][0],bt))return hi;return-1}function Ia(qe){return qe==null?qe===void 0?"[object Undefined]":"[object Null]":na&&na in Object(qe)?function(bt){var hi=Qr.call(bt,na),Ri=bt[na];try{bt[na]=void 0;var jn=!0}catch{}var qi=Go.call(bt);return jn&&(hi?bt[na]=Ri:delete bt[na]),qi}(qe):function(bt){return Go.call(bt)}(qe)}function Cu(qe){return ql(qe)&&Ia(qe)==Me}function Ul(qe,bt,hi,Ri,jn){return qe===bt||(qe==null||bt==null||!ql(qe)&&!ql(bt)?qe!=qe&&bt!=bt:function(qi,ar,lr,Io,Br,br){var Ho=Gl(qi),qo=Gl(ar),Wr=Ho?Oe:Ts(qi),ds=qo?Oe:Ts(ar),sa=(Wr=Wr==Me?Ji:Wr)==Ji,Wi=(ds=ds==Me?Ji:ds)==Ji,js=Wr==ds;if(js&&ku(qi)){if(!ku(ar))return!1;Ho=!0,sa=!1}if(js&&!sa)return br||(br=new Lt),Ho||Ou(qi)?Vs(qi,ar,lr,Io,Br,br):function(On,Gn,Oc,aa,Ru,Co,fs){switch(Oc){case In:if(On.byteLength!=Gn.byteLength||On.byteOffset!=Gn.byteOffset)return!1;On=On.buffer,Gn=Gn.buffer;case Fr:return!(On.byteLength!=Gn.byteLength||!Co(new Fl(On),new Fl(Gn)));case Ge:case Gt:case ti:return Gh(+On,+Gn);case Ht:return On.name==Gn.name&&On.message==Gn.message;case tn:case Ot:return On==Gn+"";case _i:var Ss=bu;case pr:var Pa=1&aa;if(Ss||(Ss=ls),On.size!=Gn.size&&!Pa)return!1;var Wl=fs.get(On);if(Wl)return Wl==Gn;aa|=2,fs.set(On,Gn);var Wo=Vs(Ss(On),Ss(Gn),aa,Ru,Co,fs);return fs.delete(On),Wo;case Di:if(tl)return tl.call(On)==tl.call(Gn)}return!1}(qi,ar,Wr,lr,Io,Br,br);if(!(1&lr)){var Gs=sa&&Qr.call(qi,"__wrapped__"),il=Wi&&Qr.call(ar,"__wrapped__");if(Gs||il){var Ca=Gs?qi.value():qi,Hh=il?ar.value():ar;return br||(br=new Lt),Br(Ca,Hh,lr,Io,br)}}return js?(br||(br=new Lt),function(On,Gn,Oc,aa,Ru,Co){var fs=1&Oc,Ss=jl(On),Pa=Ss.length,Wl=jl(Gn).length;if(Pa!=Wl&&!fs)return!1;for(var Wo=Pa;Wo--;){var la=Ss[Wo];if(!(fs?la in Gn:Qr.call(Gn,la)))return!1}var ka=Co.get(On);if(ka&&Co.get(Gn))return ka==Gn;var ps=!0;Co.set(On,Gn),Co.set(Gn,On);for(var Rc=fs;++Wo<Pa;){var Da=On[la=Ss[Wo]],zo=Gn[la];if(aa)var Zo=fs?aa(zo,Da,la,Gn,On,Co):aa(Da,zo,la,On,Gn,Co);if(!(Zo===void 0?Da===zo||Ru(Da,zo,Oc,aa,Co):Zo)){ps=!1;break}Rc||(Rc=la=="constructor")}if(ps&&!Rc){var ms=On.constructor,Zl=Gn.constructor;ms==Zl||!("constructor"in On)||!("constructor"in Gn)||typeof ms=="function"&&ms instanceof ms&&typeof Zl=="function"&&Zl instanceof Zl||(ps=!1)}return Co.delete(On),Co.delete(Gn),ps}(qi,ar,lr,Io,Br,br)):!1}(qe,bt,hi,Ri,Ul,jn))}function Ns(qe){return!(!Hl(qe)||function(bt){return!!wu&&wu in bt}(qe))&&(Du(qe)?Rl:Bn).test(Us(qe))}function Dc(qe){if(hi=(bt=qe)&&bt.constructor,Ri=typeof hi=="function"&&hi.prototype||cs,bt!==Ri)return Fs(qe);var bt,hi,Ri,jn=[];for(var qi in Object(qe))Qr.call(qe,qi)&&qi!="constructor"&&jn.push(qi);return jn}function Vs(qe,bt,hi,Ri,jn,qi){var ar=1&hi,lr=qe.length,Io=bt.length;if(lr!=Io&&!(ar&&Io>lr))return!1;var Br=qi.get(qe);if(Br&&qi.get(bt))return Br==bt;var br=-1,Ho=!0,qo=2&hi?new Ea:void 0;for(qi.set(qe,bt),qi.set(bt,qe);++br<lr;){var Wr=qe[br],ds=bt[br];if(Ri)var sa=ar?Ri(ds,Wr,br,bt,qe,qi):Ri(Wr,ds,br,qe,bt,qi);if(sa!==void 0){if(sa)continue;Ho=!1;break}if(qo){if(!xu(bt,function(Wi,js){if(Gs=js,!qo.has(Gs)&&(Wr===Wi||jn(Wr,Wi,hi,Ri,qi)))return qo.push(js);var Gs})){Ho=!1;break}}else if(Wr!==ds&&!jn(Wr,ds,hi,Ri,qi)){Ho=!1;break}}return qi.delete(qe),qi.delete(bt),Ho}function jl(qe){return function(bt,hi,Ri){var jn=hi(bt);return Gl(bt)?jn:function(qi,ar){for(var lr=-1,Io=ar.length,Br=qi.length;++lr<Io;)qi[Br+lr]=ar[lr];return qi}(jn,Ri(bt))}(qe,Lc,cf)}function ws(qe,bt){var hi,Ri,jn=qe.__data__;return((Ri=typeof(hi=bt))=="string"||Ri=="number"||Ri=="symbol"||Ri=="boolean"?hi!=="__proto__":hi===null)?jn[typeof bt=="string"?"string":"hash"]:jn.map}function oa(qe,bt){var hi=function(Ri,jn){return Ri==null?void 0:Ri[jn]}(qe,bt);return Ns(hi)?hi:void 0}Bs.prototype.clear=function(){this.__data__=Vl?Vl(null):{},this.size=0},Bs.prototype.delete=function(qe){var bt=this.has(qe)&&delete this.__data__[qe];return this.size-=bt?1:0,bt},Bs.prototype.get=function(qe){var bt=this.__data__;if(Vl){var hi=bt[qe];return hi===ae?void 0:hi}return Qr.call(bt,qe)?bt[qe]:void 0},Bs.prototype.has=function(qe){var bt=this.__data__;return Vl?bt[qe]!==void 0:Qr.call(bt,qe)},Bs.prototype.set=function(qe,bt){var hi=this.__data__;return this.size+=this.has(qe)?0:1,hi[qe]=Vl&&bt===void 0?ae:bt,this},hs.prototype.clear=function(){this.__data__=[],this.size=0},hs.prototype.delete=function(qe){var bt=this.__data__,hi=Aa(bt,qe);return!(hi<0)&&(hi==bt.length-1?bt.pop():ia.call(bt,hi,1),--this.size,!0)},hs.prototype.get=function(qe){var bt=this.__data__,hi=Aa(bt,qe);return hi<0?void 0:bt[hi][1]},hs.prototype.has=function(qe){return Aa(this.__data__,qe)>-1},hs.prototype.set=function(qe,bt){var hi=this.__data__,Ri=Aa(hi,qe);return Ri<0?(++this.size,hi.push([qe,bt])):hi[Ri][1]=bt,this},bs.prototype.clear=function(){this.size=0,this.__data__={hash:new Bs,map:new(Bl||hs),string:new Bs}},bs.prototype.delete=function(qe){var bt=ws(this,qe).delete(qe);return this.size-=bt?1:0,bt},bs.prototype.get=function(qe){return ws(this,qe).get(qe)},bs.prototype.has=function(qe){return ws(this,qe).has(qe)},bs.prototype.set=function(qe,bt){var hi=ws(this,qe),Ri=hi.size;return hi.set(qe,bt),this.size+=hi.size==Ri?0:1,this},Ea.prototype.add=Ea.prototype.push=function(qe){return this.__data__.set(qe,ae),this},Ea.prototype.has=function(qe){return this.__data__.has(qe)},Lt.prototype.clear=function(){this.__data__=new hs,this.size=0},Lt.prototype.delete=function(qe){var bt=this.__data__,hi=bt.delete(qe);return this.size=bt.size,hi},Lt.prototype.get=function(qe){return this.__data__.get(qe)},Lt.prototype.has=function(qe){return this.__data__.has(qe)},Lt.prototype.set=function(qe,bt){var hi=this.__data__;if(hi instanceof hs){var Ri=hi.__data__;if(!Bl||Ri.length<199)return Ri.push([qe,bt]),this.size=++hi.size,this;hi=this.__data__=new bs(Ri)}return hi.set(qe,bt),this.size=hi.size,this};var cf=ra?function(qe){return qe==null?[]:(qe=Object(qe),function(bt,hi){for(var Ri=-1,jn=bt==null?0:bt.length,qi=0,ar=[];++Ri<jn;){var lr=bt[Ri];hi(lr,Ri,bt)&&(ar[qi++]=lr)}return ar}(ra(qe),function(bt){return zs.call(qe,bt)}))}:function(){return[]},Ts=Ia;function Pu(qe,bt){return!!(bt=bt??Te)&&(typeof qe=="number"||vu.test(qe))&&qe>-1&&qe%1==0&&qe<bt}function Us(qe){if(qe!=null){try{return Cc.call(qe)}catch{}try{return qe+""}catch{}}return""}function Gh(qe,bt){return qe===bt||qe!=qe&&bt!=bt}(Ki&&Ts(new Ki(new ArrayBuffer(1)))!=In||Bl&&Ts(new Bl)!=_i||Su&&Ts(Su.resolve())!=Xn||Mu&&Ts(new Mu)!=pr||Nl&&Ts(new Nl)!=Ln)&&(Ts=function(qe){var bt=Ia(qe),hi=bt==Ji?qe.constructor:void 0,Ri=hi?Us(hi):"";if(Ri)switch(Ri){case kc:return In;case Eu:return _i;case Au:return Xn;case Ma:return pr;case Iu:return Ln}return bt});var uf=Cu(function(){return arguments}())?Cu:function(qe){return ql(qe)&&Qr.call(qe,"callee")&&!zs.call(qe,"callee")},Gl=Array.isArray,ku=Tu||function(){return!1};function Du(qe){if(!Hl(qe))return!1;var bt=Ia(qe);return bt==Nt||bt=="[object GeneratorFunction]"||bt=="[object AsyncFunction]"||bt=="[object Proxy]"}function Lu(qe){return typeof qe=="number"&&qe>-1&&qe%1==0&&qe<=Te}function Hl(qe){var bt=typeof qe;return qe!=null&&(bt=="object"||bt=="function")}function ql(qe){return qe!=null&&typeof qe=="object"}var Ou=xr?function(qe){return function(bt){return qe(bt)}}(xr):function(qe){return ql(qe)&&Lu(qe.length)&&!!Nn[Ia(qe)]};function Lc(qe){return(bt=qe)!=null&&Lu(bt.length)&&!Du(bt)?jh(qe):Dc(qe);var bt}D.exports=function(qe,bt){return Ul(qe,bt)}})(as,as.exports);var Uh=c(as.exports);function Uo(D,G){return D.length===G.length&&JSON.stringify(D.map(function(ae){return ae}).sort())===JSON.stringify(G.map(function(ae){return ae}).sort())}var yu={Polygon:vi,LineString:Kt,Point:Ye,MultiPolygon:Zi,MultiLineString:Zi,MultiPoint:Zi},af=Object.freeze({__proto__:null,CommonSelectors:Je,constrainFeatureMovement:Ll,createMidPoint:Cr,createSupplementaryPoints:Mo,createVertex:Jr,doubleClickZoom:qr,euclideanDistance:ei,featuresAt:mt,getFeatureAtAndSetCursors:tt,isClick:ki,isEventAtCoordinates:Ao,isTap:rt,mapEventToBoundingBox:ht,ModeHandler:o,moveFeatures:ba,sortFeatures:we,stringSetsAreEqual:Uo,StringSet:pt,theme:Wt,toDenseArray:xi}),wa=function(D,G){var ae={options:D=function(Me){Me===void 0&&(Me={});var Oe=Ie(Me);return Me.controls||(Oe.controls={}),Me.displayControlsDefault===!1?Oe.controls=Ie(ss,Me.controls):Oe.controls=Ie(vs,Me.controls),(Oe=Ie(ci,Oe)).styles=vr(Oe.styles,"cold").concat(vr(Oe.styles,"hot")),Oe}(D)};G=function(Me,Oe){return Oe.modes=Y,Oe.getFeatureIdsAt=function(Ge){return mt.click({point:Ge},null,Me).map(function(Gt){return Gt.properties.id})},Oe.getSelectedIds=function(){return Me.store.getSelectedIds()},Oe.getSelected=function(){return{type:q.FEATURE_COLLECTION,features:Me.store.getSelectedIds().map(function(Ge){return Me.store.get(Ge)}).map(function(Ge){return Ge.toGeoJSON()})}},Oe.getSelectedPoints=function(){return{type:q.FEATURE_COLLECTION,features:Me.store.getSelectedCoordinates().map(function(Ge){return{type:q.FEATURE,properties:{},geometry:{type:q.POINT,coordinates:Ge.coordinates}}})}},Oe.set=function(Ge){if(Ge.type===void 0||Ge.type!==q.FEATURE_COLLECTION||!Array.isArray(Ge.features))throw new Error("Invalid FeatureCollection");var Gt=Me.store.createRenderBatch(),Ht=Me.store.getAllIds().slice(),Nt=Oe.add(Ge),_i=new pt(Nt);return(Ht=Ht.filter(function(ti){return!_i.has(ti)})).length&&Oe.delete(Ht),Gt(),Nt},Oe.add=function(Ge){var Gt=JSON.parse(JSON.stringify(Ct(Ge))).features.map(function(Ht){if(Ht.id=Ht.id||kt(),Ht.geometry===null)throw new Error("Invalid geometry: null");if(Me.store.get(Ht.id)===void 0||Me.store.get(Ht.id).type!==Ht.geometry.type){var Nt=yu[Ht.geometry.type];if(Nt===void 0)throw new Error("Invalid geometry type: "+Ht.geometry.type+".");var _i=new Nt(Me,Ht);Me.store.add(_i)}else{var ti=Me.store.get(Ht.id);ti.properties=Ht.properties,Uh(ti.properties,Ht.properties)||Me.store.featureChanged(ti.id),Uh(ti.getCoordinates(),Ht.geometry.coordinates)||ti.incomingCoords(Ht.geometry.coordinates)}return Ht.id});return Me.store.render(),Gt},Oe.get=function(Ge){var Gt=Me.store.get(Ge);if(Gt)return Gt.toGeoJSON()},Oe.getAll=function(){return{type:q.FEATURE_COLLECTION,features:Me.store.getAll().map(function(Ge){return Ge.toGeoJSON()})}},Oe.delete=function(Ge){return Me.store.delete(Ge,{silent:!0}),Oe.getMode()!==Y.DIRECT_SELECT||Me.store.getSelectedIds().length?Me.store.render():Me.events.changeMode(Y.SIMPLE_SELECT,void 0,{silent:!0}),Oe},Oe.deleteAll=function(){return Me.store.delete(Me.store.getAllIds(),{silent:!0}),Oe.getMode()===Y.DIRECT_SELECT?Me.events.changeMode(Y.SIMPLE_SELECT,void 0,{silent:!0}):Me.store.render(),Oe},Oe.changeMode=function(Ge,Gt){return Gt===void 0&&(Gt={}),Ge===Y.SIMPLE_SELECT&&Oe.getMode()===Y.SIMPLE_SELECT?(Uo(Gt.featureIds||[],Me.store.getSelectedIds())||(Me.store.setSelected(Gt.featureIds,{silent:!0}),Me.store.render()),Oe):(Ge===Y.DIRECT_SELECT&&Oe.getMode()===Y.DIRECT_SELECT&&Gt.featureId===Me.store.getSelectedIds()[0]||Me.events.changeMode(Ge,Gt,{silent:!0}),Oe)},Oe.getMode=function(){return Me.events.getMode()},Oe.trash=function(){return Me.events.trash({silent:!0}),Oe},Oe.combineFeatures=function(){return Me.events.combineFeatures({silent:!0}),Oe},Oe.uncombineFeatures=function(){return Me.events.uncombineFeatures({silent:!0}),Oe},Oe.setFeatureProperty=function(Ge,Gt,Ht){return Me.store.setFeatureProperty(Ge,Gt,Ht),Oe},Oe}(ae,G),ae.api=G;var Te=vt(ae);return G.onAdd=Te.onAdd,G.onRemove=Te.onRemove,G.types=X,G.options=D,G};function gt(D){wa(D,this)}return gt.modes=Ne,gt.constants=He,gt.lib=af,gt})})(zV);const FV={},ey=yr(""),ty=yr(""),Cy=yr(""),gh=yr(""),Yx=yr(""),P_=yr(""),kp=yr(""),Jx=yr(!1),vh=yr(""),Qp=yr(""),k_=yr(""),cx=yr(""),em=yr(""),Ph=yr(!1),tm=yr(!1),Hp=yr(!1),Yd=yr(!1),Jd=yr(!1),Kx=yr(""),$x=yr(""),Sc=yr(!1),du=yr(!1),Qx=yr(""),eb=yr(""),NA=yr(""),c_=yr([{value:"BC_DNN_PM25",name:"PM2.5"}]);function wh(r,i){r.getLayer(i)&&r.removeLayer(i)}function Dp(r,i){r.getSource(i)&&r.removeSource(i)}function BV(r,i,o){wh(r,"station-point"),wh(r,"marker-text"),Dp(r,"station-data"),r.addSource("station-data",{type:"geojson",data:o,cluster:!1}),r.addLayer({id:"station-point",type:"circle",source:"station-data",paint:{"circle-color":["get","color_class"],"circle-radius":10,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}),r.addLayer({id:"marker-text",type:"symbol",source:"station-data",layout:{"text-field":["get","pm25"],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12}}),r.setLayerZoomRange("station-point",2,22),r.setLayerZoomRange("marker-text",2,22),r.on("click","station-point",c=>{const h=c.features[0].geometry.coordinates.slice();for(console.log(c.features[0].properties.name);Math.abs(c.lngLat.lng-h[0])>180;)h[0]+=c.lngLat.lng>h[0]?360:-360;new i.Popup().setLngLat(h).setHTML('<div class="point-popup-val">'+c.features[0].properties.name+"</div>").addTo(r)}),r.on("mouseenter","clusters",()=>{r.getCanvas().style.cursor="pointer"}),r.on("mouseleave","clusters",()=>{r.getCanvas().style.cursor=""})}function NV(r){for(var i={type:"FeatureCollection",features:[]},o=0;o<r.length;o++){var c=r[o].rid;let h=r[o].station_id,m=r[o].latest_data,_=r[o].lon,x=r[o].lat,s=r[o].pm25,M=r[o].name,P=r[o].aqi,L=r[o].aqi_level,F="#000000";s>80?F="#DE544D":s<=80&&s>60?F="#F2A63B":s<=60&&s>40?F="#FFFF54":s<=40&&s>20?F="#9FCE62":s<=20&&(F="#6ACAFA");let V={id:c,stationsID:h,latest_data:m,lon:_,lat:x,pm25:s,name:M,aqi:P,aqi_level:L,color_class:F};i.features.push({type:"Feature",properties:V,geometry:{type:"Point",coordinates:[_,x]}})}return i}function VV(r){let i,o='<canvas id="mapcanvas" class="relative w-full h-screen"></canvas>',c,h;return{c(){i=$e("div"),i.innerHTML=o,c=Si(),h=$e("div"),this.h()},l(m){i=Qe(m,"DIV",{class:!0,"data-svelte-h":!0}),xn(i)!=="svelte-lapt2t"&&(i.innerHTML=o),c=Mi(m),h=Qe(m,"DIV",{id:!0,class:!0}),Et(h).forEach(ze),this.h()},h(){be(i,"class","wind-map-container"),be(h,"id","map-container"),be(h,"class","relative w-full h-screen")},m(m,_){yi(m,i,_),yi(m,c,_),yi(m,h,_),r[16](h)},p:_r,i:_r,o:_r,d(m){m&&(ze(i),ze(c),ze(h)),r[16](null)}}}function UV(r){const i=r.getCanvas(),o=r.getBounds();return{width:i.width,height:i.height,north:o.getNorth(),south:o.getSouth(),west:o.getWest(),east:o.getEast(),zoomLevel:r.getZoom()}}function jV(r,i,o){let c,h,m,_,x,s,M,P,L,F,V,X,q,Y;Fi(r,vh,yt=>o(5,c=yt)),Fi(r,Qp,yt=>o(6,h=yt)),Fi(r,tm,yt=>o(7,m=yt)),Fi(r,Ph,yt=>o(8,_=yt)),Fi(r,Hp,yt=>o(9,x=yt)),Fi(r,em,yt=>o(10,s=yt)),Fi(r,kp,yt=>o(11,M=yt)),Fi(r,Cy,yt=>o(12,P=yt)),Fi(r,k_,yt=>o(13,L=yt)),Fi(r,ty,yt=>o(14,F=yt)),Fi(r,ey,yt=>o(15,V=yt)),Fi(r,$x,yt=>o(25,X=yt)),Fi(r,Kx,yt=>o(26,q=yt)),Fi(r,gh,yt=>o(27,Y=yt));let{map:J}=i,{Draw:ue}=i,ce,fe,Ae,Ce,He,We,nt,we=[],ht="";OR(FV,{getMap:()=>J,getMapBoxDraw:()=>ue}),kd.accessToken="pk.eyJ1Ijoic2VydmlybWVrb25nIiwiYSI6ImNrYWMzenhldDFvNG4yeXBtam1xMTVseGoifQ.Wr-FBcvcircZ0qyItQTq9g",fe=105.224518,Ae=11.113995,Ce=4;function pt(){Ce=J.getZoom(),fe=J.getCenter().lng,Ae=J.getCenter().lat}function Xe(yt,Xt){console.log("addTileMap"),console.log(h),console.log(c),console.log(L),setTimeout(()=>{wh(J,"wms-layer"),Dp(J,"wms-source");const kt=P.replace("-","").replace("-","");console.log("Initialization Date",kt),yt==="pm25"&&(Xt==="geos"?an(gh,Y=`${Ed}/ServirData/${c}/${kt}.nc?service=WMS
					&request=GetMap
					&layers=${L}
					&styles=default-scalar%2Fpm25
					&format=image%2Fpng
					&transparent=true
					&version=1.3.0
					&time=${V}T${F.replace("h","")}:30:00Z
					&colorscalerange=0%2C200
					&abovemaxcolor=extend
					&belowmincolor=extend
					&width=256
					&height=256
					&crs=EPSG:3857
					&bbox={bbox-epsg-3857}`,Y):Xt==="geos5"&&an(gh,Y=`${Ed}/ServirData/${c}/20230507.nc?service=WMS
					&request=GetMap
					&layers=${L}
					&styles=default-scalar%2Fpm25
					&format=image/png;mode=32bit
					&transparent=true
					&version=1.3.0
					&time=2023-05-7T${F.replace("h","")}:30:00Z
					&colorscalerange=0%2C200
					&abovemaxcolor=extend
					&belowmincolor=extend
					&width=256
					&height=256
					&crs=EPSG:3857
					&bbox={bbox-epsg-3857}`,Y)),yt==="no2"&&an(gh,Y=`${Ed}/ServirData/${c}/GEMS_NO2_20240228_0645_FC_SERVIRSEA.nc?service=WMS
				&request=GetMap
				&layers=${h}
				&styles=default-scalar%2Fno2
				&format=image%2Fpng
				&transparent=true
				&version=1.3.0
				&colorscalerange=0%2C5
				&abovemaxcolor=extend
				&belowmincolor=extend
				&width=256&height=256
				&crs=EPSG:3857
				&bbox={bbox-epsg-3857}`,Y),J.addSource("wms-source",{type:"raster",tiles:[Y],tileSize:256}),J.addLayer({id:"wms-layer",name:"wms-layer",type:"raster",source:"wms-source",paint:{}},"building"),J.setPaintProperty("wms-layer","raster-opacity",.7),J.getStyle().layers.map(Kt=>Kt.id).includes("fire-wms-layer")&&(console.log("fire layer active"),J.moveLayer("wms-layer","fire-wms-layer"))},200)}function mt(yt){o(4,ht=yt),setTimeout(()=>{wh(J,"fire-wms-layer"),Dp(J,"fire-wms-source");const Xt=P.replace("-","").replace("-","");console.log("Initialization Date",Xt);let kt="https://firms.modaps.eosdis.nasa.gov/mapserve/wms/fires/37601af187a7c4054759a42043b19adc/?REQUEST=GetMap&layers=fires_viirs_24&WIDTH=512&HEIGHT=512&bbox={bbox-epsg-3857}0&SRS=EPSG:3857";yt==="fires_viirs_24"?kt=`https://firms.modaps.eosdis.nasa.gov/mapserver/wms/fires/37601af187a7c4054759a42043b19adc/?REQUEST=GetMap&layers=${yt}&WIDTH=512&HEIGHT=512&bbox={bbox-epsg-3857}0&SRS=EPSG:3857`:yt==="fires_viirs_48"?kt=`https://firms.modaps.eosdis.nasa.gov/mapserver/wms/fires/37601af187a7c4054759a42043b19adc/?REQUEST=GetMap&layers=${yt}&WIDTH=512&HEIGHT=512&bbox={bbox-epsg-3857}0&SRS=EPSG:3857`:yt==="fires_viirs_time"&&(kt=`https://firms.modaps.eosdis.nasa.gov/mapserver/wms/fires/37601af187a7c4054759a42043b19adc/?REQUEST=GetMap&layers=fires_viirs&TIME=${V}&WIDTH=512&HEIGHT=512&bbox={bbox-epsg-3857}0&SRS=EPSG:3857`),J.addSource("fire-wms-source",{type:"raster",tiles:[kt],tileSize:512}),J.addLayer({id:"fire-wms-layer",type:"raster",source:"fire-wms-source",paint:{}},"building"),J.setPaintProperty("fire-wms-layer","raster-opacity",.8)},200)}function Ft(yt,Xt){console.log("updateTileMap"),setTimeout(()=>{const kt=P.replace("-","").replace("-","");yt==="pm25"&&(Xt==="geos"?an(gh,Y=`${Ed}/ServirData/${c}/${kt}.nc?service=WMS
					&request=GetMap
					&layers=${L}
					&styles=default-scalar%2Fpm25
					&format=image%2Fpng
					&transparent=true
					&version=1.3.0
					&time=${V}T${F.replace("h","")}:30:00Z
					&colorscalerange=0%2C200
					&abovemaxcolor=extend
					&belowmincolor=extend
					&width=256
					&height=256
					&crs=EPSG:3857
					&bbox={bbox-epsg-3857}`,Y):Xt==="geos5"&&an(gh,Y=`${Ed}/ServirData/${c}/20230507.nc?service=WMS
					&request=GetMap
					&layers=${L}
					&styles=default-scalar%2Fpm25
					&format=image/png;mode=32bit
					&transparent=true
					&version=1.3.0
					&time=2023-05-7T${F.replace("h","")}:30:00Z
					&colorscalerange=0%2C200
					&abovemaxcolor=extend
					&belowmincolor=extend
					&width=256
					&height=256
					&crs=EPSG:3857
					&bbox={bbox-epsg-3857}`,Y)),yt==="no2"&&an(gh,Y=`${Ed}/ServirData/${c}/GEMS_NO2_20240228_0645_FC_SERVIRSEA.nc?service=WMS
				&request=GetMap
				&layers=${L}
				&styles=default-scalar%2Fno2
				&format=image%2Fpng
				&transparent=true
				&version=1.3.0
				&colorscalerange=0%2C5
				&abovemaxcolor=extend
				&belowmincolor=extend
				&width=256&height=256
				&crs=EPSG:3857
				&bbox={bbox-epsg-3857}`,Y),J.getSource("wms-source").setTiles([Y])},200)}function tt(){const yt=ue.getAll();var Xt=[];const kt=yt.features[yt.features.length-1].id;yt.features.forEach(Ue=>{Ue.id!==kt&&Xt.push(Ue.id)}),ue.delete(Xt)}function ei(yt){const Xt=UV(yt),{zoomLevel:kt,north:Ue,south:Ye,west:Kt,east:vi,width:en,height:Li}=Xt;mapcanvas.style.display="none",We&&We.stop(),nt&&clearTimeout(nt),nt=setTimeout(function(){let Zi=3;kt>2&&(Zi=4),kt>3&&(Zi=4.5),kt>4&&(Zi=4.7),kt>5&&(Zi=4.8),kt>6&&(Zi=5),mapcanvas.style.display="initial",mapcanvas.width=en,mapcanvas.height=Li,We.start([[0,0],[en,Li]],en,Li,[[Kt,Ye],[vi,Ue]],{particleLineWidth:Zi,zoomLevel:kt})},500)}mb(()=>{const yt={lng:fe,lat:Ae,zoom:Ce};o(1,J=new kd.Map({container:ce,style:"mapbox://styles/servirmekong/cltiptdlg004y01ph1rm84xru",zoom:yt.zoom,center:[yt.lng,yt.lat],maxBounds:[[-180,-60],[180,70]]}));const Xt={showCompass:!1};J.addControl(new kd.NavigationControl(Xt),"bottom-right"),J.on("click","wms-layer",kt=>{if(we.length>0)we.forEach(Kt=>Kt.remove()),we=[];else{we.forEach(Zi=>Zi.remove()),we=[];let Kt=kt.lngLat;const vi=[Kt.lng.toFixed(3),Kt.lat.toFixed(3)];an(Kx,q=vi.toString(),q),an($x,X="Point",X),He=new kd.Popup({offset:5,className:"mapboxgl-popup-close-button"}).setText("Lat: "+Kt.lat.toFixed(3)+" Lon: "+Kt.lng.toFixed(3));const en=document.createElement("div");en.id="marker";const Li=new kd.Marker(en).setLngLat([Kt.lng,Kt.lat]).setPopup(He).addTo(J).togglePopup();we.push(Li)}let Ue=document.querySelectorAll(".mapboxgl-popup-close-button");Array.from(Ue)[0].addEventListener("click",function(Kt){He.remove(),we.forEach(vi=>vi.remove()),we=[]})}),J.on("draw.modechange",kt=>{tt()}),J.on("draw.update",function(kt){}),J.on("draw.delete",function(kt){console.log("delete")}),J.on("move",()=>{pt(),ei(J)}),J.on("resize",kt=>{ei(J)}),fetch(ZR).then(kt=>kt.json()).then(kt=>{console.log(kt),We=new Windy({canvas:mapcanvas,data:kt}),ei(J)})});function ki(){return J}function rt(yt){Zr[yt?"unshift":"push"](()=>{ce=yt,o(0,ce)})}return r.$$set=yt=>{"map"in yt&&o(1,J=yt.map),"Draw"in yt&&o(2,ue=yt.Draw)},r.$$.update=()=>{if(r.$$.dirty[0]&4192&&P!==""&&Xe(h,c),r.$$.dirty[0]&53346&&V!==""&&F!==""&&P!==""&&J.getLayer("wms-layer")&&Ft(h,c),r.$$.dirty[0]&12386&&L&&P!==""&&J.getLayer("wms-layer")&&Ft(h,c),r.$$.dirty[0]&3170&&M!==""){let Xt=J.getStyle().layers.map(kt=>kt.id);J.setStyle("mapbox://styles/servirmekong/"+M),setTimeout(()=>{Xt.includes("wms-layer")&&Xe(h,c),Xt.includes("fire-wms-layer")&&mt(s)},50)}r.$$.dirty[0]&514&&J&&x==!1&&J.getLayer("fire-wms-layer")&&(wh(J,"fire-wms-layer"),Dp(J,"fire-wms-source")),r.$$.dirty[0]&1538&&J&&x==!0&&!J.getLayer("fire-wms-layer")&&mt(s),r.$$.dirty[0]&1554&&s!==ht&&J&&x==!0&&mt(s),r.$$.dirty[0]&514&&J&&x==!0&&J.getLayer("fire-wms-layer")&&J.setPaintProperty("fire-wms-layer","raster-opacity",.9),r.$$.dirty[0]&258&&J&&_==!1&&(wh(J,"station-point"),wh(J,"marker-text"),Dp(J,"station-data")),r.$$.dirty[0]&130&&J&&m==!1&&J.setPaintProperty("wms-layer","raster-opacity",0),r.$$.dirty[0]&226&&J&&m==!0&&J.getLayer("wms-layer")&&(console.log("ShowPollutant ture",h,c),J.setPaintProperty("wms-layer","raster-opacity",.7))},[ce,J,ue,ki,ht,c,h,m,_,x,s,M,P,L,F,V,rt]}class GV extends _o{constructor(i){super(),yo(this,i,jV,VV,go,{map:1,Draw:2,getMap:3},null,[-1,-1])}get getMap(){return this.$$.ctx[3]}}function VA(r){return Object.prototype.toString.call(r)==="[object Date]"}function tb(r,i,o,c){if(typeof o=="number"||VA(o)){const h=c-o,m=(o-i)/(r.dt||1/60),_=r.opts.stiffness*h,x=r.opts.damping*m,s=(_-x)*r.inv_mass,M=(m+s)*r.dt;return Math.abs(M)<r.opts.precision&&Math.abs(h)<r.opts.precision?c:(r.settled=!1,VA(o)?new Date(o.getTime()+M):o+M)}else{if(Array.isArray(o))return o.map((h,m)=>tb(r,i[m],o[m],c[m]));if(typeof o=="object"){const h={};for(const m in o)h[m]=tb(r,i[m],o[m],c[m]);return h}else throw new Error(`Cannot spring ${typeof o} values`)}}function HV(r,i={}){const o=yr(r),{stiffness:c=.15,damping:h=.8,precision:m=.01}=i;let _,x,s,M=r,P=r,L=1,F=0,V=!1;function X(Y,J={}){P=Y;const ue=s={};return r==null||J.hard||q.stiffness>=1&&q.damping>=1?(V=!0,_=RM(),M=Y,o.set(r=P),Promise.resolve()):(J.soft&&(F=1/((J.soft===!0?.5:+J.soft)*60),L=0),x||(_=RM(),V=!1,x=jR(ce=>{if(V)return V=!1,x=null,!1;L=Math.min(L+F,1);const fe={inv_mass:L,opts:q,settled:!0,dt:(ce-_)*60/1e3},Ae=tb(fe,M,r,P);return _=ce,M=r,o.set(r=Ae),fe.settled&&(x=null),!fe.settled})),new Promise(ce=>{x.promise.then(()=>{ue===s&&ce()})}))}const q={set:X,update:(Y,J)=>X(Y(P,r),J),subscribe:o.subscribe,stiffness:c,damping:h,precision:m};return q}function ck(r){return r<.5?4*r*r*r:.5*Math.pow(2*r-2,3)+1}function uk(r){const i=r-1;return i*i*i+1}function hk(r){const i=Math.cos(r*Math.PI*.5);return Math.abs(i)<1e-14?1:1-i}function UA(r,i,o){const c=r.slice();return c[37]=i[o],c[39]=o,c}function jA(r){let i,o,c,h,m=(r[6]==="label"||r[7]==="label")&&GA(r);return{c(){i=$e("span"),m&&m.c(),this.h()},l(_){i=Qe(_,"SPAN",{class:!0,style:!0});var x=Et(i);m&&m.l(x),x.forEach(ze),this.h()},h(){be(i,"class","pip first"),be(i,"style",o=r[14]+": 0%;"),Ui(i,"selected",r[18](r[0])),Ui(i,"in-range",r[17](r[0]))},m(_,x){yi(_,i,x),m&&m.m(i,null),c||(h=[Ei(i,"pointerdown",r[30]),Ei(i,"pointerup",r[31])],c=!0)},p(_,x){_[6]==="label"||_[7]==="label"?m?m.p(_,x):(m=GA(_),m.c(),m.m(i,null)):m&&(m.d(1),m=null),x[0]&16384&&o!==(o=_[14]+": 0%;")&&be(i,"style",o),x[0]&262145&&Ui(i,"selected",_[18](_[0])),x[0]&131073&&Ui(i,"in-range",_[17](_[0]))},d(_){_&&ze(i),m&&m.d(),c=!1,rs(h)}}}function GA(r){let i,o,c,h=r[12](r[16](r[0]),0,0)+"",m,_=r[10]&&HA(r),x=r[11]&&qA(r);return{c(){i=$e("span"),_&&_.c(),o=hr(),c=new py(!1),m=hr(),x&&x.c(),this.h()},l(s){i=Qe(s,"SPAN",{class:!0});var M=Et(i);_&&_.l(M),o=hr(),c=my(M,!1),m=hr(),x&&x.l(M),M.forEach(ze),this.h()},h(){c.a=m,be(i,"class","pipVal")},m(s,M){yi(s,i,M),_&&_.m(i,null),De(i,o),c.m(h,i),De(i,m),x&&x.m(i,null)},p(s,M){s[10]?_?_.p(s,M):(_=HA(s),_.c(),_.m(i,o)):_&&(_.d(1),_=null),M[0]&69633&&h!==(h=s[12](s[16](s[0]),0,0)+"")&&c.p(h),s[11]?x?x.p(s,M):(x=qA(s),x.c(),x.m(i,null)):x&&(x.d(1),x=null)},d(s){s&&ze(i),_&&_.d(),x&&x.d()}}}function HA(r){let i,o;return{c(){i=$e("span"),o=Vn(r[10]),this.h()},l(c){i=Qe(c,"SPAN",{class:!0});var h=Et(i);o=Un(h,r[10]),h.forEach(ze),this.h()},h(){be(i,"class","pipVal-prefix")},m(c,h){yi(c,i,h),De(i,o)},p(c,h){h[0]&1024&&jr(o,c[10])},d(c){c&&ze(i)}}}function qA(r){let i,o;return{c(){i=$e("span"),o=Vn(r[11]),this.h()},l(c){i=Qe(c,"SPAN",{class:!0});var h=Et(i);o=Un(h,r[11]),h.forEach(ze),this.h()},h(){be(i,"class","pipVal-suffix")},m(c,h){yi(c,i,h),De(i,o)},p(c,h){h[0]&2048&&jr(o,c[11])},d(c){c&&ze(i)}}}function WA(r){let i,o=Nr(Array(r[20]+1)),c=[];for(let h=0;h<o.length;h+=1)c[h]=KA(UA(r,o,h));return{c(){for(let h=0;h<c.length;h+=1)c[h].c();i=hr()},l(h){for(let m=0;m<c.length;m+=1)c[m].l(h);i=hr()},m(h,m){for(let _=0;_<c.length;_+=1)c[_]&&c[_].m(h,m);yi(h,i,m)},p(h,m){if(m[0]&8314435){o=Nr(Array(h[20]+1));let _;for(_=0;_<o.length;_+=1){const x=UA(h,o,_);c[_]?c[_].p(x,m):(c[_]=KA(x),c[_].c(),c[_].m(i.parentNode,i))}for(;_<c.length;_+=1)c[_].d(1);c.length=o.length}},d(h){h&&ze(i),_a(c,h)}}}function ZA(r){let i,o,c,h,m,_=(r[6]==="label"||r[9]==="label")&&XA(r);function x(...s){return r[33](r[39],...s)}return{c(){i=$e("span"),_&&_.c(),o=Si(),this.h()},l(s){i=Qe(s,"SPAN",{class:!0,style:!0});var M=Et(i);_&&_.l(M),o=Mi(M),M.forEach(ze),this.h()},h(){be(i,"class","pip"),be(i,"style",c=r[14]+": "+r[15](r[19](r[39]))+"%;"),Ui(i,"selected",r[18](r[19](r[39]))),Ui(i,"in-range",r[17](r[19](r[39])))},m(s,M){yi(s,i,M),_&&_.m(i,null),De(i,o),h||(m=[Ei(i,"pointerdown",r[32]),Ei(i,"pointerup",x)],h=!0)},p(s,M){r=s,r[6]==="label"||r[9]==="label"?_?_.p(r,M):(_=XA(r),_.c(),_.m(i,o)):_&&(_.d(1),_=null),M[0]&573440&&c!==(c=r[14]+": "+r[15](r[19](r[39]))+"%;")&&be(i,"style",c),M[0]&786432&&Ui(i,"selected",r[18](r[19](r[39]))),M[0]&655360&&Ui(i,"in-range",r[17](r[19](r[39])))},d(s){s&&ze(i),_&&_.d(),h=!1,rs(m)}}}function XA(r){let i,o,c,h=r[12](r[19](r[39]),r[39],r[15](r[19](r[39])))+"",m,_=r[10]&&YA(r),x=r[11]&&JA(r);return{c(){i=$e("span"),_&&_.c(),o=hr(),c=new py(!1),m=hr(),x&&x.c(),this.h()},l(s){i=Qe(s,"SPAN",{class:!0});var M=Et(i);_&&_.l(M),o=hr(),c=my(M,!1),m=hr(),x&&x.l(M),M.forEach(ze),this.h()},h(){c.a=m,be(i,"class","pipVal")},m(s,M){yi(s,i,M),_&&_.m(i,null),De(i,o),c.m(h,i),De(i,m),x&&x.m(i,null)},p(s,M){s[10]?_?_.p(s,M):(_=YA(s),_.c(),_.m(i,o)):_&&(_.d(1),_=null),M[0]&561152&&h!==(h=s[12](s[19](s[39]),s[39],s[15](s[19](s[39])))+"")&&c.p(h),s[11]?x?x.p(s,M):(x=JA(s),x.c(),x.m(i,null)):x&&(x.d(1),x=null)},d(s){s&&ze(i),_&&_.d(),x&&x.d()}}}function YA(r){let i,o;return{c(){i=$e("span"),o=Vn(r[10]),this.h()},l(c){i=Qe(c,"SPAN",{class:!0});var h=Et(i);o=Un(h,r[10]),h.forEach(ze),this.h()},h(){be(i,"class","pipVal-prefix")},m(c,h){yi(c,i,h),De(i,o)},p(c,h){h[0]&1024&&jr(o,c[10])},d(c){c&&ze(i)}}}function JA(r){let i,o;return{c(){i=$e("span"),o=Vn(r[11]),this.h()},l(c){i=Qe(c,"SPAN",{class:!0});var h=Et(i);o=Un(h,r[11]),h.forEach(ze),this.h()},h(){be(i,"class","pipVal-suffix")},m(c,h){yi(c,i,h),De(i,o)},p(c,h){h[0]&2048&&jr(o,c[11])},d(c){c&&ze(i)}}}function KA(r){let i=r[19](r[39])!==r[0]&&r[19](r[39])!==r[1],o,c=i&&ZA(r);return{c(){c&&c.c(),o=hr()},l(h){c&&c.l(h),o=hr()},m(h,m){c&&c.m(h,m),yi(h,o,m)},p(h,m){m[0]&524291&&(i=h[19](h[39])!==h[0]&&h[19](h[39])!==h[1]),i?c?c.p(h,m):(c=ZA(h),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null)},d(h){h&&ze(o),c&&c.d(h)}}}function $A(r){let i,o,c,h,m=(r[6]==="label"||r[8]==="label")&&QA(r);return{c(){i=$e("span"),m&&m.c(),this.h()},l(_){i=Qe(_,"SPAN",{class:!0,style:!0});var x=Et(i);m&&m.l(x),x.forEach(ze),this.h()},h(){be(i,"class","pip last"),be(i,"style",o=r[14]+": 100%;"),Ui(i,"selected",r[18](r[1])),Ui(i,"in-range",r[17](r[1]))},m(_,x){yi(_,i,x),m&&m.m(i,null),c||(h=[Ei(i,"pointerdown",r[34]),Ei(i,"pointerup",r[35])],c=!0)},p(_,x){_[6]==="label"||_[8]==="label"?m?m.p(_,x):(m=QA(_),m.c(),m.m(i,null)):m&&(m.d(1),m=null),x[0]&16384&&o!==(o=_[14]+": 100%;")&&be(i,"style",o),x[0]&262146&&Ui(i,"selected",_[18](_[1])),x[0]&131074&&Ui(i,"in-range",_[17](_[1]))},d(_){_&&ze(i),m&&m.d(),c=!1,rs(h)}}}function QA(r){let i,o,c,h=r[12](r[16](r[1]),r[20],100)+"",m,_=r[10]&&eI(r),x=r[11]&&tI(r);return{c(){i=$e("span"),_&&_.c(),o=hr(),c=new py(!1),m=hr(),x&&x.c(),this.h()},l(s){i=Qe(s,"SPAN",{class:!0});var M=Et(i);_&&_.l(M),o=hr(),c=my(M,!1),m=hr(),x&&x.l(M),M.forEach(ze),this.h()},h(){c.a=m,be(i,"class","pipVal")},m(s,M){yi(s,i,M),_&&_.m(i,null),De(i,o),c.m(h,i),De(i,m),x&&x.m(i,null)},p(s,M){s[10]?_?_.p(s,M):(_=eI(s),_.c(),_.m(i,o)):_&&(_.d(1),_=null),M[0]&1118210&&h!==(h=s[12](s[16](s[1]),s[20],100)+"")&&c.p(h),s[11]?x?x.p(s,M):(x=tI(s),x.c(),x.m(i,null)):x&&(x.d(1),x=null)},d(s){s&&ze(i),_&&_.d(),x&&x.d()}}}function eI(r){let i,o;return{c(){i=$e("span"),o=Vn(r[10]),this.h()},l(c){i=Qe(c,"SPAN",{class:!0});var h=Et(i);o=Un(h,r[10]),h.forEach(ze),this.h()},h(){be(i,"class","pipVal-prefix")},m(c,h){yi(c,i,h),De(i,o)},p(c,h){h[0]&1024&&jr(o,c[10])},d(c){c&&ze(i)}}}function tI(r){let i,o;return{c(){i=$e("span"),o=Vn(r[11]),this.h()},l(c){i=Qe(c,"SPAN",{class:!0});var h=Et(i);o=Un(h,r[11]),h.forEach(ze),this.h()},h(){be(i,"class","pipVal-suffix")},m(c,h){yi(c,i,h),De(i,o)},p(c,h){h[0]&2048&&jr(o,c[11])},d(c){c&&ze(i)}}}function qV(r){let i,o,c,h=(r[6]&&r[7]!==!1||r[7])&&jA(r),m=(r[6]&&r[9]!==!1||r[9])&&WA(r),_=(r[6]&&r[8]!==!1||r[8])&&$A(r);return{c(){i=$e("div"),h&&h.c(),o=Si(),m&&m.c(),c=Si(),_&&_.c(),this.h()},l(x){i=Qe(x,"DIV",{class:!0});var s=Et(i);h&&h.l(s),o=Mi(s),m&&m.l(s),c=Mi(s),_&&_.l(s),s.forEach(ze),this.h()},h(){be(i,"class","rangePips"),Ui(i,"disabled",r[5]),Ui(i,"hoverable",r[4]),Ui(i,"vertical",r[2]),Ui(i,"reversed",r[3]),Ui(i,"focus",r[13])},m(x,s){yi(x,i,s),h&&h.m(i,null),De(i,o),m&&m.m(i,null),De(i,c),_&&_.m(i,null)},p(x,s){x[6]&&x[7]!==!1||x[7]?h?h.p(x,s):(h=jA(x),h.c(),h.m(i,o)):h&&(h.d(1),h=null),x[6]&&x[9]!==!1||x[9]?m?m.p(x,s):(m=WA(x),m.c(),m.m(i,c)):m&&(m.d(1),m=null),x[6]&&x[8]!==!1||x[8]?_?_.p(x,s):(_=$A(x),_.c(),_.m(i,null)):_&&(_.d(1),_=null),s[0]&32&&Ui(i,"disabled",x[5]),s[0]&16&&Ui(i,"hoverable",x[4]),s[0]&4&&Ui(i,"vertical",x[2]),s[0]&8&&Ui(i,"reversed",x[3]),s[0]&8192&&Ui(i,"focus",x[13])},i:_r,o:_r,d(x){x&&ze(i),h&&h.d(),m&&m.d(),_&&_.d()}}}function WV(r,i,o){let c,h,m,_,x,{range:s=!1}=i,{min:M=0}=i,{max:P=100}=i,{step:L=1}=i,{values:F=[(P+M)/2]}=i,{vertical:V=!1}=i,{reversed:X=!1}=i,{hoverable:q=!0}=i,{disabled:Y=!1}=i,{pipstep:J=void 0}=i,{all:ue=!0}=i,{first:ce=void 0}=i,{last:fe=void 0}=i,{rest:Ae=void 0}=i,{prefix:Ce=""}=i,{suffix:He=""}=i,{formatter:We=(Ye,Kt,vi)=>Ye}=i,{focus:nt=void 0}=i,{orientationStart:we=void 0}=i,{percentOf:ht=void 0}=i,{moveHandle:pt=void 0}=i,{fixFloat:Xe=void 0}=i,{normalisedClient:mt=void 0}=i,Ft;function tt(Ye){Ye=mt(Ye),Ft={x:Ye.clientX,y:Ye.clientY}}function ei(Ye,Kt){if(Kt=mt(Kt),!Y){const vi=Math.sqrt(Math.pow(Ft.x-Kt.clientX,2)+Math.pow(Ft.y-Kt.clientY,2));Ft&&vi<=5&&pt(void 0,Ye)}}const ki=Ye=>{tt(Ye)},rt=Ye=>{ei(M,Ye)},yt=Ye=>{tt(Ye)},Xt=(Ye,Kt)=>{ei(m(Ye),Kt)},kt=Ye=>{tt(Ye)},Ue=Ye=>{ei(P,Ye)};return r.$$set=Ye=>{"range"in Ye&&o(23,s=Ye.range),"min"in Ye&&o(0,M=Ye.min),"max"in Ye&&o(1,P=Ye.max),"step"in Ye&&o(24,L=Ye.step),"values"in Ye&&o(25,F=Ye.values),"vertical"in Ye&&o(2,V=Ye.vertical),"reversed"in Ye&&o(3,X=Ye.reversed),"hoverable"in Ye&&o(4,q=Ye.hoverable),"disabled"in Ye&&o(5,Y=Ye.disabled),"pipstep"in Ye&&o(26,J=Ye.pipstep),"all"in Ye&&o(6,ue=Ye.all),"first"in Ye&&o(7,ce=Ye.first),"last"in Ye&&o(8,fe=Ye.last),"rest"in Ye&&o(9,Ae=Ye.rest),"prefix"in Ye&&o(10,Ce=Ye.prefix),"suffix"in Ye&&o(11,He=Ye.suffix),"formatter"in Ye&&o(12,We=Ye.formatter),"focus"in Ye&&o(13,nt=Ye.focus),"orientationStart"in Ye&&o(14,we=Ye.orientationStart),"percentOf"in Ye&&o(15,ht=Ye.percentOf),"moveHandle"in Ye&&o(27,pt=Ye.moveHandle),"fixFloat"in Ye&&o(16,Xe=Ye.fixFloat),"normalisedClient"in Ye&&o(28,mt=Ye.normalisedClient)},r.$$.update=()=>{r.$$.dirty[0]&83886087&&o(29,c=J||((P-M)/L>=(V?50:100)?(P-M)/(V?10:20):1)),r.$$.dirty[0]&553648131&&o(20,h=parseInt((P-M)/(L*c),10)),r.$$.dirty[0]&553713665&&o(19,m=function(Ye){return Xe(M+Ye*L*c)}),r.$$.dirty[0]&33619968&&o(18,_=function(Ye){return F.some(Kt=>Xe(Kt)===Xe(Ye))}),r.$$.dirty[0]&41943040&&o(17,x=function(Ye){if(s==="min")return F[0]>Ye;if(s==="max")return F[0]<Ye;if(s)return F[0]<Ye&&F[1]>Ye})},[M,P,V,X,q,Y,ue,ce,fe,Ae,Ce,He,We,nt,we,ht,Xe,x,_,m,h,tt,ei,s,L,F,J,pt,mt,c,ki,rt,yt,Xt,kt,Ue]}class ZV extends _o{constructor(i){super(),yo(this,i,WV,qV,go,{range:23,min:0,max:1,step:24,values:25,vertical:2,reversed:3,hoverable:4,disabled:5,pipstep:26,all:6,first:7,last:8,rest:9,prefix:10,suffix:11,formatter:12,focus:13,orientationStart:14,percentOf:15,moveHandle:27,fixFloat:16,normalisedClient:28},null,[-1,-1])}}function iI(r,i,o){const c=r.slice();return c[65]=i[o],c[67]=o,c}function nI(r){let i,o,c,h=r[21](r[65],r[67],r[24](r[65]))+"",m,_=r[18]&&rI(r),x=r[19]&&oI(r);return{c(){i=$e("span"),_&&_.c(),o=hr(),c=new py(!1),m=hr(),x&&x.c(),this.h()},l(s){i=Qe(s,"SPAN",{class:!0});var M=Et(i);_&&_.l(M),o=hr(),c=my(M,!1),m=hr(),x&&x.l(M),M.forEach(ze),this.h()},h(){c.a=m,be(i,"class","rangeFloat")},m(s,M){yi(s,i,M),_&&_.m(i,null),De(i,o),c.m(h,i),De(i,m),x&&x.m(i,null)},p(s,M){s[18]?_?_.p(s,M):(_=rI(s),_.c(),_.m(i,o)):_&&(_.d(1),_=null),M[0]&18874369&&h!==(h=s[21](s[65],s[67],s[24](s[65]))+"")&&c.p(h),s[19]?x?x.p(s,M):(x=oI(s),x.c(),x.m(i,null)):x&&(x.d(1),x=null)},d(s){s&&ze(i),_&&_.d(),x&&x.d()}}}function rI(r){let i,o;return{c(){i=$e("span"),o=Vn(r[18]),this.h()},l(c){i=Qe(c,"SPAN",{class:!0});var h=Et(i);o=Un(h,r[18]),h.forEach(ze),this.h()},h(){be(i,"class","rangeFloat-prefix")},m(c,h){yi(c,i,h),De(i,o)},p(c,h){h[0]&262144&&jr(o,c[18])},d(c){c&&ze(i)}}}function oI(r){let i,o;return{c(){i=$e("span"),o=Vn(r[19]),this.h()},l(c){i=Qe(c,"SPAN",{class:!0});var h=Et(i);o=Un(h,r[19]),h.forEach(ze),this.h()},h(){be(i,"class","rangeFloat-suffix")},m(c,h){yi(c,i,h),De(i,o)},p(c,h){h[0]&524288&&jr(o,c[19])},d(c){c&&ze(i)}}}function sI(r){let i,o,c,h,m,_,x,s,M,P,L,F,V,X=r[7]&&nI(r);return{c(){i=$e("span"),o=$e("span"),c=Si(),X&&X.c(),this.h()},l(q){i=Qe(q,"SPAN",{role:!0,class:!0,"data-handle":!0,style:!0,"aria-label":!0,"aria-valuemin":!0,"aria-valuemax":!0,"aria-valuenow":!0,"aria-valuetext":!0,"aria-orientation":!0,"aria-disabled":!0,disabled:!0,tabindex:!0});var Y=Et(i);o=Qe(Y,"SPAN",{class:!0}),Et(o).forEach(ze),c=Mi(Y),X&&X.l(Y),Y.forEach(ze),this.h()},h(){be(o,"class","rangeNub"),be(i,"role","slider"),be(i,"class","rangeHandle"),be(i,"data-handle",r[67]),be(i,"style",h=r[29]+": "+r[30][r[67]]+"%; z-index: "+(r[27]===r[67]?3:2)+";"),be(i,"aria-label",m=r[22][r[67]]),be(i,"aria-valuemin",_=r[2]===!0&&r[67]===1?r[0][0]:r[3]),be(i,"aria-valuemax",x=r[2]===!0&&r[67]===0?r[0][1]:r[4]),be(i,"aria-valuenow",s=r[65]),be(i,"aria-valuetext",M=""+(r[18]+uI(r[21](r[65],r[67],r[24](r[65])))+r[19])),be(i,"aria-orientation",P=r[6]?"vertical":"horizontal"),be(i,"aria-disabled",r[10]),be(i,"disabled",r[10]),be(i,"tabindex",L=r[10]?-1:0),Ui(i,"active",r[25]&&r[27]===r[67]),Ui(i,"press",r[26]&&r[27]===r[67])},m(q,Y){yi(q,i,Y),De(i,o),De(i,c),X&&X.m(i,null),F||(V=[Ei(i,"blur",r[35]),Ei(i,"focus",r[36]),Ei(i,"keydown",r[37])],F=!0)},p(q,Y){q[7]?X?X.p(q,Y):(X=nI(q),X.c(),X.m(i,null)):X&&(X.d(1),X=null),Y[0]&1744830464&&h!==(h=q[29]+": "+q[30][q[67]]+"%; z-index: "+(q[27]===q[67]?3:2)+";")&&be(i,"style",h),Y[0]&4194304&&m!==(m=q[22][q[67]])&&be(i,"aria-label",m),Y[0]&13&&_!==(_=q[2]===!0&&q[67]===1?q[0][0]:q[3])&&be(i,"aria-valuemin",_),Y[0]&21&&x!==(x=q[2]===!0&&q[67]===0?q[0][1]:q[4])&&be(i,"aria-valuemax",x),Y[0]&1&&s!==(s=q[65])&&be(i,"aria-valuenow",s),Y[0]&19660801&&M!==(M=""+(q[18]+uI(q[21](q[65],q[67],q[24](q[65])))+q[19]))&&be(i,"aria-valuetext",M),Y[0]&64&&P!==(P=q[6]?"vertical":"horizontal")&&be(i,"aria-orientation",P),Y[0]&1024&&be(i,"aria-disabled",q[10]),Y[0]&1024&&be(i,"disabled",q[10]),Y[0]&1024&&L!==(L=q[10]?-1:0)&&be(i,"tabindex",L),Y[0]&167772160&&Ui(i,"active",q[25]&&q[27]===q[67]),Y[0]&201326592&&Ui(i,"press",q[26]&&q[27]===q[67])},d(q){q&&ze(i),X&&X.d(),F=!1,rs(V)}}}function aI(r){let i,o;return{c(){i=$e("span"),this.h()},l(c){i=Qe(c,"SPAN",{class:!0,style:!0}),Et(i).forEach(ze),this.h()},h(){be(i,"class","rangeBar"),be(i,"style",o=r[29]+": "+r[33](r[30])+"%; "+r[28]+": "+r[34](r[30])+"%;")},m(c,h){yi(c,i,h)},p(c,h){h[0]&1879048192&&o!==(o=c[29]+": "+c[33](c[30])+"%; "+c[28]+": "+c[34](c[30])+"%;")&&be(i,"style",o)},d(c){c&&ze(i)}}}function lI(r){let i,o;return i=new ZV({props:{values:r[0],min:r[3],max:r[4],step:r[5],range:r[2],vertical:r[6],reversed:r[8],orientationStart:r[29],hoverable:r[9],disabled:r[10],all:r[13],first:r[14],last:r[15],rest:r[16],pipstep:r[12],prefix:r[18],suffix:r[19],formatter:r[20],focus:r[25],percentOf:r[24],moveHandle:r[32],fixFloat:r[31],normalisedClient:D_}}),{c(){oo(i.$$.fragment)},l(c){so(i.$$.fragment,c)},m(c,h){ao(i,c,h),o=!0},p(c,h){const m={};h[0]&1&&(m.values=c[0]),h[0]&8&&(m.min=c[3]),h[0]&16&&(m.max=c[4]),h[0]&32&&(m.step=c[5]),h[0]&4&&(m.range=c[2]),h[0]&64&&(m.vertical=c[6]),h[0]&256&&(m.reversed=c[8]),h[0]&536870912&&(m.orientationStart=c[29]),h[0]&512&&(m.hoverable=c[9]),h[0]&1024&&(m.disabled=c[10]),h[0]&8192&&(m.all=c[13]),h[0]&16384&&(m.first=c[14]),h[0]&32768&&(m.last=c[15]),h[0]&65536&&(m.rest=c[16]),h[0]&4096&&(m.pipstep=c[12]),h[0]&262144&&(m.prefix=c[18]),h[0]&524288&&(m.suffix=c[19]),h[0]&1048576&&(m.formatter=c[20]),h[0]&33554432&&(m.focus=c[25]),h[0]&16777216&&(m.percentOf=c[24]),i.$set(m)},i(c){o||($i(i.$$.fragment,c),o=!0)},o(c){ln(i.$$.fragment,c),o=!1},d(c){lo(i,c)}}}function XV(r){let i,o,c,h,m,_,x=Nr(r[0]),s=[];for(let L=0;L<x.length;L+=1)s[L]=sI(iI(r,x,L));let M=r[2]&&aI(r),P=r[11]&&lI(r);return{c(){i=$e("div");for(let L=0;L<s.length;L+=1)s[L].c();o=Si(),M&&M.c(),c=Si(),P&&P.c(),this.h()},l(L){i=Qe(L,"DIV",{id:!0,role:!0,class:!0});var F=Et(i);for(let V=0;V<s.length;V+=1)s[V].l(F);o=Mi(F),M&&M.l(F),c=Mi(F),P&&P.l(F),F.forEach(ze),this.h()},h(){be(i,"id",r[17]),be(i,"role","none"),be(i,"class","rangeSlider"),Ui(i,"range",r[2]),Ui(i,"disabled",r[10]),Ui(i,"hoverable",r[9]),Ui(i,"vertical",r[6]),Ui(i,"reversed",r[8]),Ui(i,"focus",r[25]),Ui(i,"min",r[2]==="min"),Ui(i,"max",r[2]==="max"),Ui(i,"pips",r[11]),Ui(i,"pip-labels",r[13]==="label"||r[14]==="label"||r[15]==="label"||r[16]==="label")},m(L,F){yi(L,i,F);for(let V=0;V<s.length;V+=1)s[V]&&s[V].m(i,null);De(i,o),M&&M.m(i,null),De(i,c),P&&P.m(i,null),r[51](i),h=!0,m||(_=[Ei(window,"mousedown",r[40]),Ei(window,"touchstart",r[40]),Ei(window,"mousemove",r[41]),Ei(window,"touchmove",r[41]),Ei(window,"mouseup",r[42]),Ei(window,"touchend",r[43]),Ei(window,"keydown",r[44]),Ei(i,"mousedown",r[38]),Ei(i,"mouseup",r[39]),Ei(i,"touchstart",OM(r[38])),Ei(i,"touchend",OM(r[39]))],m=!0)},p(L,F){if(F[0]&1869350109|F[1]&112){x=Nr(L[0]);let V;for(V=0;V<x.length;V+=1){const X=iI(L,x,V);s[V]?s[V].p(X,F):(s[V]=sI(X),s[V].c(),s[V].m(i,o))}for(;V<s.length;V+=1)s[V].d(1);s.length=x.length}L[2]?M?M.p(L,F):(M=aI(L),M.c(),M.m(i,c)):M&&(M.d(1),M=null),L[11]?P?(P.p(L,F),F[0]&2048&&$i(P,1)):(P=lI(L),P.c(),$i(P,1),P.m(i,null)):P&&(yc(),ln(P,1,1,()=>{P=null}),vc()),(!h||F[0]&131072)&&be(i,"id",L[17]),(!h||F[0]&4)&&Ui(i,"range",L[2]),(!h||F[0]&1024)&&Ui(i,"disabled",L[10]),(!h||F[0]&512)&&Ui(i,"hoverable",L[9]),(!h||F[0]&64)&&Ui(i,"vertical",L[6]),(!h||F[0]&256)&&Ui(i,"reversed",L[8]),(!h||F[0]&33554432)&&Ui(i,"focus",L[25]),(!h||F[0]&4)&&Ui(i,"min",L[2]==="min"),(!h||F[0]&4)&&Ui(i,"max",L[2]==="max"),(!h||F[0]&2048)&&Ui(i,"pips",L[11]),(!h||F[0]&122880)&&Ui(i,"pip-labels",L[13]==="label"||L[14]==="label"||L[15]==="label"||L[16]==="label")},i(L){h||($i(P),h=!0)},o(L){ln(P),h=!1},d(L){L&&ze(i),_a(s,L),M&&M.d(),P&&P.d(),r[51](null),m=!1,rs(_)}}}function cI(r){if(!r)return-1;for(var i=0;r=r.previousElementSibling;)i++;return i}function D_(r){return r.type.includes("touch")?r.touches[0]||r.changedTouches[0]:r}function uI(r){return`${r}`.replace(/<[^>]*>/g,"")}function YV(r,i,o){let c,h,m,_,x,s,M=_r,P=()=>(M(),M=RR(it,Je=>o(30,s=Je)),it);r.$$.on_destroy.push(()=>M());let{slider:L=void 0}=i,{range:F=!1}=i,{pushy:V=!1}=i,{min:X=0}=i,{max:q=100}=i,{step:Y=1}=i,{values:J=[(q+X)/2]}=i,{vertical:ue=!1}=i,{float:ce=!1}=i,{reversed:fe=!1}=i,{hoverable:Ae=!0}=i,{disabled:Ce=!1}=i,{pips:He=!1}=i,{pipstep:We=void 0}=i,{all:nt=void 0}=i,{first:we=void 0}=i,{last:ht=void 0}=i,{rest:pt=void 0}=i,{id:Xe=void 0}=i,{prefix:mt=""}=i,{suffix:Ft=""}=i,{formatter:tt=(Je,mi,Gi)=>Je}=i,{handleFormatter:ei=tt}=i,{ariaLabels:ki=[]}=i,{precision:rt=2}=i,{springValues:yt={stiffness:.15,damping:.4}}=i;const Xt=gb();let kt=0,Ue=!1,Ye=!1,Kt=!1,vi=!1,en=J.length-1,Li,Zi,it;const Sn=Je=>parseFloat((+Je).toFixed(rt));function dr(Je){const mi=L.querySelectorAll(".handle"),Gi=Array.prototype.includes.call(mi,Je),fn=Array.prototype.some.call(mi,$n=>$n.contains(Je));return Gi||fn}function Hr(Je){return F==="min"||F==="max"?Je.slice(0,1):F?Je.slice(0,2):Je}function xi(){return L.getBoundingClientRect()}function wt(Je){const mi=xi();let Gi=0,fn=0,$n=0;ue?(Gi=Je.clientY-mi.top,fn=Gi/mi.height*100,fn=fe?fn:100-fn):(Gi=Je.clientX-mi.left,fn=Gi/mi.width*100,fn=fe?100-fn:fn),$n=(q-X)/100*fn+X;let Jr;return F===!0&&J[0]===J[1]?$n>J[1]?1:0:(Jr=J.indexOf([...J].sort((Cr,Mo)=>Math.abs($n-Cr)-Math.abs($n-Mo))[0]),Jr)}function ni(Je){const mi=xi();let Gi=0,fn=0,$n=0;ue?(Gi=Je.clientY-mi.top,fn=Gi/mi.height*100,fn=fe?fn:100-fn):(Gi=Je.clientX-mi.left,fn=Gi/mi.width*100,fn=fe?100-fn:fn),$n=(q-X)/100*fn+X,Ve(en,$n)}function Ve(Je,mi){return mi=m(mi),typeof Je>"u"&&(Je=en),F&&(Je===0&&mi>J[1]?V?o(0,J[1]=mi,J):mi=J[1]:Je===1&&mi<J[0]&&(V?o(0,J[0]=mi,J):mi=J[0])),J[Je]!==mi&&o(0,J[Je]=mi,J),Zi!==mi&&(gn(),Zi=mi),mi}function ne(Je){return F==="min"?0:Je[0]}function pe(Je){return F==="max"?0:F==="min"?100-Je[0]:100-Je[1]}function Ie(Je){vi&&(o(25,Ue=!1),Ye=!1,o(26,Kt=!1))}function xt(Je){Ce||(o(27,en=cI(Je.target)),o(25,Ue=!0))}function vt(Je){if(!Ce){const mi=cI(Je.target);let Gi=Je.ctrlKey||Je.metaKey||Je.shiftKey?Y*10:Y,fn=!1;switch(Je.key){case"PageDown":Gi*=10;case"ArrowRight":case"ArrowUp":Ve(mi,J[mi]+Gi),fn=!0;break;case"PageUp":Gi*=10;case"ArrowLeft":case"ArrowDown":Ve(mi,J[mi]-Gi),fn=!0;break;case"Home":Ve(mi,X),fn=!0;break;case"End":Ve(mi,q),fn=!0;break}fn&&(Je.preventDefault(),Je.stopPropagation())}}function Wt(Je){if(!Ce){const mi=Je.target,Gi=D_(Je);o(25,Ue=!0),Ye=!0,o(26,Kt=!0),o(27,en=wt(Gi)),Li=Zi=m(J[en]),dn(),Je.type==="touchstart"&&!mi.matches(".pipVal")&&ni(Gi)}}function Jt(Je){Je.type==="touchend"&&Fn(),o(26,Kt=!1)}function Tt(Je){vi=!1,Ue&&Je.target!==L&&!L.contains(Je.target)&&o(25,Ue=!1)}function li(Je){Ce||Ye&&ni(D_(Je))}function wi(Je){if(!Ce){const mi=Je.target;Ye&&((mi===L||L.contains(mi))&&(o(25,Ue=!0),!dr(mi)&&!mi.matches(".pipVal")&&ni(D_(Je))),Fn())}Ye=!1,o(26,Kt=!1)}function $t(Je){Ye=!1,o(26,Kt=!1)}function cn(Je){Ce||(Je.target===L||L.contains(Je.target))&&(vi=!0)}function dn(){!Ce&&Xt("start",{activeHandle:en,value:Li,values:J.map(Je=>m(Je))})}function Fn(){!Ce&&Xt("stop",{activeHandle:en,startValue:Li,value:J[en],values:J.map(Je=>m(Je))})}function gn(){!Ce&&Xt("change",{activeHandle:en,startValue:Li,previousValue:typeof Zi>"u"?Li:Zi,value:J[en],values:J.map(Je=>m(Je))})}function wn(Je){Zr[Je?"unshift":"push"](()=>{L=Je,o(1,L)})}return r.$$set=Je=>{"slider"in Je&&o(1,L=Je.slider),"range"in Je&&o(2,F=Je.range),"pushy"in Je&&o(45,V=Je.pushy),"min"in Je&&o(3,X=Je.min),"max"in Je&&o(4,q=Je.max),"step"in Je&&o(5,Y=Je.step),"values"in Je&&o(0,J=Je.values),"vertical"in Je&&o(6,ue=Je.vertical),"float"in Je&&o(7,ce=Je.float),"reversed"in Je&&o(8,fe=Je.reversed),"hoverable"in Je&&o(9,Ae=Je.hoverable),"disabled"in Je&&o(10,Ce=Je.disabled),"pips"in Je&&o(11,He=Je.pips),"pipstep"in Je&&o(12,We=Je.pipstep),"all"in Je&&o(13,nt=Je.all),"first"in Je&&o(14,we=Je.first),"last"in Je&&o(15,ht=Je.last),"rest"in Je&&o(16,pt=Je.rest),"id"in Je&&o(17,Xe=Je.id),"prefix"in Je&&o(18,mt=Je.prefix),"suffix"in Je&&o(19,Ft=Je.suffix),"formatter"in Je&&o(20,tt=Je.formatter),"handleFormatter"in Je&&o(21,ei=Je.handleFormatter),"ariaLabels"in Je&&o(22,ki=Je.ariaLabels),"precision"in Je&&o(46,rt=Je.precision),"springValues"in Je&&o(47,yt=Je.springValues)},r.$$.update=()=>{if(r.$$.dirty[0]&24&&o(50,h=function(Je){return Je<=X?X:Je>=q?q:Je}),r.$$.dirty[0]&56|r.$$.dirty[1]&524288&&o(49,m=function(Je){if(Je<=X)return Sn(X);if(Je>=q)return Sn(q);Je=Sn(Je);let mi=(Je-X)%Y,Gi=Je-mi;return Math.abs(mi)*2>=Y&&(Gi+=mi>0?Y:-Y),Gi=h(Gi),Sn(Gi)}),r.$$.dirty[0]&24&&o(24,c=function(Je){let mi=(Je-X)/(q-X)*100;return isNaN(mi)||mi<=0?0:mi>=100?100:Sn(mi)}),r.$$.dirty[0]&29360153|r.$$.dirty[1]&458752){Array.isArray(J)||(o(0,J=[(q+X)/2]),console.error("'values' prop should be an Array (https://github.com/simeydotme/svelte-range-slider-pips#slider-props)"));const Je=Hr(J.map(mi=>m(mi)));(J.length!==Je.length||!J.every((mi,Gi)=>Sn(mi)===Je[Gi]))&&o(0,J=Je),kt!==J.length?P(o(23,it=HV(J.map(mi=>c(mi)),yt))):it.set(J.map(mi=>c(mi))),o(48,kt=J.length),J.length>1&&!Array.isArray(ki)&&console.warn("'ariaLabels' prop should be an Array (https://github.com/simeydotme/svelte-range-slider-pips#slider-props)")}r.$$.dirty[0]&320&&o(29,_=ue?fe?"top":"bottom":fe?"right":"left"),r.$$.dirty[0]&320&&o(28,x=ue?fe?"bottom":"top":fe?"left":"right")},[J,L,F,X,q,Y,ue,ce,fe,Ae,Ce,He,We,nt,we,ht,pt,Xe,mt,Ft,tt,ei,ki,it,c,Ue,Kt,en,x,_,s,Sn,Ve,ne,pe,Ie,xt,vt,Wt,Jt,Tt,li,wi,$t,cn,V,rt,yt,kt,m,h,wn]}class JV extends _o{constructor(i){super(),yo(this,i,YV,XV,go,{slider:1,range:2,pushy:45,min:3,max:4,step:5,values:0,vertical:6,float:7,reversed:8,hoverable:9,disabled:10,pips:11,pipstep:12,all:13,first:14,last:15,rest:16,id:17,prefix:18,suffix:19,formatter:20,handleFormatter:21,ariaLabels:22,precision:46,springValues:47},null,[-1,-1,-1])}}function hI(r){let i,o,c=("00"+r[0].getHours()).slice(-2)+"",h,m,_,x=("00"+r[0].getMinutes()).slice(-2)+"",s,M,P,L,F=r[1]!=="minute"&&dI(r);return{c(){i=$e("div"),o=$e("span"),h=Vn(c),m=Vn(`:
		`),_=$e("span"),s=Vn(x),M=Si(),F&&F.c(),this.h()},l(V){i=Qe(V,"DIV",{class:!0,role:!0});var X=Et(i);o=Qe(X,"SPAN",{role:!0,"aria-label":!0,tabindex:!0,contenteditable:!0,inputmode:!0,class:!0});var q=Et(o);h=Un(q,c),q.forEach(ze),m=Un(X,`:
		`),_=Qe(X,"SPAN",{role:!0,"aria-label":!0,tabindex:!0,contenteditable:!0,inputmode:!0,class:!0});var Y=Et(_);s=Un(Y,x),Y.forEach(ze),M=Mi(X),F&&F.l(X),X.forEach(ze),this.h()},h(){be(o,"role","spinbutton"),be(o,"aria-label","Hours"),be(o,"tabindex","0"),be(o,"contenteditable",""),be(o,"inputmode","numeric"),be(o,"class","svelte-132npca"),be(_,"role","spinbutton"),be(_,"aria-label","Minutes"),be(_,"tabindex","0"),be(_,"contenteditable",""),be(_,"inputmode","numeric"),be(_,"class","svelte-132npca"),be(i,"class","time-picker svelte-132npca"),be(i,"role","none")},m(V,X){yi(V,i,X),De(i,o),De(o,h),r[6](o),De(i,m),De(i,_),De(_,s),r[7](_),De(i,M),F&&F.m(i,null),P||(L=[Ei(o,"keydown",r[3]),Ei(o,"input",r[4]),Ei(o,"focus",iy),Ei(_,"keydown",r[3]),Ei(_,"input",r[4]),Ei(_,"focus",iy),Ei(i,"mousedown",r[10])],P=!0)},p(V,X){X&1&&c!==(c=("00"+V[0].getHours()).slice(-2)+"")&&N_(h,c),X&1&&x!==(x=("00"+V[0].getMinutes()).slice(-2)+"")&&N_(s,x),V[1]!=="minute"?F?F.p(V,X):(F=dI(V),F.c(),F.m(i,null)):F&&(F.d(1),F=null)},d(V){V&&ze(i),r[6](null),r[7](null),F&&F.d(),P=!1,rs(L)}}}function dI(r){let i,o,c=("00"+r[0].getSeconds()).slice(-2)+"",h,m,_,x,s,M=r[1]!=="second"&&fI(r);return{c(){i=Vn(":"),o=$e("span"),h=Vn(c),m=Si(),M&&M.c(),_=hr(),this.h()},l(P){i=Un(P,":"),o=Qe(P,"SPAN",{role:!0,"aria-label":!0,tabindex:!0,contenteditable:!0,inputmode:!0,class:!0});var L=Et(o);h=Un(L,c),L.forEach(ze),m=Mi(P),M&&M.l(P),_=hr(),this.h()},h(){be(o,"role","spinbutton"),be(o,"aria-label","Seconds"),be(o,"tabindex","0"),be(o,"contenteditable",""),be(o,"inputmode","numeric"),be(o,"class","svelte-132npca")},m(P,L){yi(P,i,L),yi(P,o,L),De(o,h),r[8](o),yi(P,m,L),M&&M.m(P,L),yi(P,_,L),x||(s=[Ei(o,"keydown",r[3]),Ei(o,"input",r[4]),Ei(o,"focus",iy)],x=!0)},p(P,L){L&1&&c!==(c=("00"+P[0].getSeconds()).slice(-2)+"")&&N_(h,c),P[1]!=="second"?M?M.p(P,L):(M=fI(P),M.c(),M.m(_.parentNode,_)):M&&(M.d(1),M=null)},d(P){P&&(ze(i),ze(o),ze(m),ze(_)),r[8](null),M&&M.d(P),x=!1,rs(s)}}}function fI(r){let i,o,c=("000"+r[0].getMilliseconds()).slice(-3)+"",h,m,_;return{c(){i=Vn("."),o=$e("span"),h=Vn(c),this.h()},l(x){i=Un(x,"."),o=Qe(x,"SPAN",{role:!0,"aria-label":!0,tabindex:!0,contenteditable:!0,inputmode:!0,class:!0});var s=Et(o);h=Un(s,c),s.forEach(ze),this.h()},h(){be(o,"role","spinbutton"),be(o,"aria-label","Milliseconds"),be(o,"tabindex","0"),be(o,"contenteditable",""),be(o,"inputmode","numeric"),be(o,"class","svelte-132npca")},m(x,s){yi(x,i,s),yi(x,o,s),De(o,h),r[9](o),m||(_=[Ei(o,"keydown",r[3]),Ei(o,"input",r[4]),Ei(o,"focus",iy)],m=!0)},p(x,s){s&1&&c!==(c=("000"+x[0].getMilliseconds()).slice(-3)+"")&&N_(h,c)},d(x){x&&(ze(i),ze(o)),r[9](null),m=!1,rs(_)}}}function KV(r){let i,o=r[1]&&hI(r);return{c(){o&&o.c(),i=hr()},l(c){o&&o.l(c),i=hr()},m(c,h){o&&o.m(c,h),yi(c,i,h)},p(c,[h]){c[1]?o?o.p(c,h):(o=hI(c),o.c(),o.m(i.parentNode,i)):o&&(o.d(1),o=null)},i:_r,o:_r,d(c){c&&ze(i),o&&o.d(c)}}}function L_(r){const i=window.getSelection(),o=document.createRange();o.selectNodeContents(r),i==null||i.removeAllRanges(),i==null||i.addRange(o)}function $V(r,i,o){return o&&r<0?i:o&&r>i?0:Math.max(0,Math.min(i,r))}function ux(r){const i=r.getAttribute("aria-label");if(i==="Hours")return{label:i,len:2,max:23};if(i==="Minutes")return{label:i,len:2,max:59};if(i==="Seconds")return{label:i,len:2,max:59};if(i==="Milliseconds")return{label:i,len:3,max:999};throw new Error("Invalid label "+i)}function hx(r,i){return parseInt(r.replace(/[^\d]/g,"").slice(-i))}function iy(r){L_(r.currentTarget)}function QV(r,i,o){let{browseDate:c}=i,{timePrecision:h}=i,{setTime:m}=i,_=[];function x(J){if(J.key==="ArrowUp"||J.key==="ArrowDown"){const ue=s(J.currentTarget),ce=J.key==="ArrowUp"?1:-1;P(J.currentTarget,ue+ce,!0),J.preventDefault(),L_(J.currentTarget)}else if(J.key==="ArrowLeft"||J.key==="ArrowRight"||":;-,.".includes(J.key)){const ue=_.indexOf(J.currentTarget),ce=J.key==="ArrowLeft"?-1:1,fe=_[ue+ce];J.preventDefault(),fe&&(fe.focus(),L_(fe))}}function s(J){const ue=ux(J).label;return ue==="Hours"?c.getHours():ue==="Minutes"?c.getMinutes():ue==="Seconds"?c.getSeconds():c.getMilliseconds()}function M(J){const ue=("00"+J.getHours()).slice(-2),ce=("00"+J.getMinutes()).slice(-2),fe=("00"+J.getSeconds()).slice(-2),Ae=("000"+J.getMilliseconds()).slice(-3);_[0]&&_[0].innerText!==ue&&o(2,_[0].innerText=ue,_),_[1]&&_[1].innerText!==ce&&o(2,_[1].innerText=ce,_),_[2]&&_[2].innerText!==fe&&o(2,_[2].innerText=fe,_),_[3]&&_[3].innerText!==Ae&&o(2,_[3].innerText=Ae,_)}function P(J,ue,ce=!1){const fe=ux(J);ue=$V(ue,fe.max,ce),fe.label==="Hours"?c.setHours(ue):fe.label==="Minutes"?c.setMinutes(ue):fe.label==="Seconds"?c.setSeconds(ue):fe.label==="Milliseconds"&&c.setMilliseconds(ue),o(0,c=m(c)),M(c)}function L(J){const ue=J,ce=ux(ue.currentTarget);let fe;if(ue.inputType==="insertText"){const Ae="000"+s(ue.currentTarget);fe=hx(Ae+ue.currentTarget.innerText,ce.len),fe>ce.max&&ue.data&&(fe=hx(ue.data,ce.len))}else fe=hx("000"+ue.currentTarget.innerText,ce.len);P(ue.currentTarget,fe),L_(ue.currentTarget)}function F(J){Zr[J?"unshift":"push"](()=>{_[0]=J,o(2,_)})}function V(J){Zr[J?"unshift":"push"](()=>{_[1]=J,o(2,_)})}function X(J){Zr[J?"unshift":"push"](()=>{_[2]=J,o(2,_)})}function q(J){Zr[J?"unshift":"push"](()=>{_[3]=J,o(2,_)})}const Y=J=>{J.target instanceof HTMLElement&&J.target.tagName==="SPAN"&&(J.target.focus(),J.preventDefault())};return r.$$set=J=>{"browseDate"in J&&o(0,c=J.browseDate),"timePrecision"in J&&o(1,h=J.timePrecision),"setTime"in J&&o(5,m=J.setTime)},r.$$.update=()=>{r.$$.dirty&1&&M(c)},[c,h,_,x,L,m,F,V,X,q,Y]}class eU extends _o{constructor(i){super(),yo(this,i,QV,KV,go,{browseDate:0,timePrecision:1,setTime:5})}}function tU(r){return r%4===0&&r%100!==0||r%400===0}function im(r,i){return[31,tU(r)?29:28,31,30,31,30,31,31,30,31,30,31][i]}function pI(r,i){let o="";if(r)for(const c of i)typeof c=="string"?o+=c:o+=c.toString(r);return o}function dx(r,i){const o=im(r,i),c=[];for(let h=0;h<o;h++)c.push({year:r,month:i,number:h+1});return c}function iU(r,i){const o=r.getFullYear(),c=r.getMonth(),h=new Date(o,c,1).getDay();let m=[];const _=(h-i+7)%7;if(_>0){let P=c-1,L=o;P===-1&&(P=11,L=o-1),m=dx(L,P).slice(-_)}m=m.concat(dx(o,c));let x=c+1,s=o;x===12&&(x=0,s=o+1);const M=42-m.length;return m=m.concat(dx(s,x).slice(0,M)),m}function nU(){return{weekdays:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekStartsOn:1}}function rU(r={}){const i=nU();return typeof r.weekStartsOn=="number"&&(i.weekStartsOn=r.weekStartsOn),r.months&&(i.months=r.months),r.weekdays&&(i.weekdays=r.weekdays),i}function mI(r,i,o){const c=r.slice();return c[36]=i[o],c[38]=o,c}function gI(r,i,o){const c=r.slice();return c[39]=i[o],c}function _I(r,i,o){const c=r.slice();return c[36]=i[o],c[43]=o,c}function yI(r,i,o){const c=r.slice();return c[44]=i[o],c}function vI(r,i,o){const c=r.slice();return c[44]=i[o],c}function xI(r,i,o){const c=r.slice();return c[49]=i[o],c[43]=o,c}function bI(r,i,o){const c=r.slice();return c[49]=i[o],c[43]=o,c}function wI(r){let i,o=r[49]+"",c,h;return{c(){i=$e("option"),c=Vn(o),this.h()},l(m){i=Qe(m,"OPTION",{});var _=Et(i);c=Un(_,o),_.forEach(ze),this.h()},h(){i.disabled=h=new Date(r[9],r[43],im(r[9],r[43]),23,59,59,999)<r[2]||new Date(r[9],r[43])>r[3],i.__value=r[43],ea(i,i.__value)},m(m,_){yi(m,i,_),De(i,c)},p(m,_){_[0]&32&&o!==(o=m[49]+"")&&jr(c,o),_[0]&588&&h!==(h=new Date(m[9],m[43],im(m[9],m[43]),23,59,59,999)<m[2]||new Date(m[9],m[43])>m[3])&&(i.disabled=h)},d(m){m&&ze(i)}}}function TI(r){let i,o=r[49]+"",c,h;return{c(){i=$e("option"),c=Vn(o),this.h()},l(m){i=Qe(m,"OPTION",{});var _=Et(i);c=Un(_,o),_.forEach(ze),this.h()},h(){i.__value=r[43],ea(i,i.__value),i.selected=h=r[43]===r[8]},m(m,_){yi(m,i,_),De(i,c)},p(m,_){_[0]&32&&o!==(o=m[49]+"")&&jr(c,o),_[0]&256&&h!==(h=m[43]===m[8])&&(i.selected=h)},d(m){m&&ze(i)}}}function SI(r){let i,o=r[44]+"",c,h;return{c(){i=$e("option"),c=Vn(o),this.h()},l(m){i=Qe(m,"OPTION",{});var _=Et(i);c=Un(_,o),_.forEach(ze),this.h()},h(){i.__value=h=r[44],ea(i,i.__value)},m(m,_){yi(m,i,_),De(i,c)},p(m,_){_[0]&64&&o!==(o=m[44]+"")&&jr(c,o),_[0]&64&&h!==(h=m[44])&&(i.__value=h,ea(i,i.__value))},d(m){m&&ze(i)}}}function MI(r){let i,o=r[44]+"",c,h,m;return{c(){i=$e("option"),c=Vn(o),this.h()},l(_){i=Qe(_,"OPTION",{});var x=Et(i);c=Un(x,o),x.forEach(ze),this.h()},h(){i.__value=h=r[44],ea(i,i.__value),i.selected=m=r[44]===r[4].getFullYear()},m(_,x){yi(_,i,x),De(i,c)},p(_,x){x[0]&64&&o!==(o=_[44]+"")&&jr(c,o),x[0]&64&&h!==(h=_[44])&&(i.__value=h,ea(i,i.__value)),x[0]&80&&m!==(m=_[44]===_[4].getFullYear())&&(i.selected=m)},d(_){_&&ze(i)}}}function oU(r){let i,o=r[5].weekdays[r[5].weekStartsOn+r[43]-7]+"",c;return{c(){i=$e("div"),c=Vn(o),this.h()},l(h){i=Qe(h,"DIV",{class:!0});var m=Et(i);c=Un(m,o),m.forEach(ze),this.h()},h(){be(i,"class","header-cell svelte-go79cf")},m(h,m){yi(h,i,m),De(i,c)},p(h,m){m[0]&32&&o!==(o=h[5].weekdays[h[5].weekStartsOn+h[43]-7]+"")&&jr(c,o)},d(h){h&&ze(i)}}}function sU(r){let i,o=r[5].weekdays[r[5].weekStartsOn+r[43]]+"",c;return{c(){i=$e("div"),c=Vn(o),this.h()},l(h){i=Qe(h,"DIV",{class:!0});var m=Et(i);c=Un(m,o),m.forEach(ze),this.h()},h(){be(i,"class","header-cell svelte-go79cf")},m(h,m){yi(h,i,m),De(i,c)},p(h,m){m[0]&32&&o!==(o=h[5].weekdays[h[5].weekStartsOn+h[43]]+"")&&jr(c,o)},d(h){h&&ze(i)}}}function EI(r){let i;function o(m,_){return m[43]+m[5].weekStartsOn<7?sU:oU}let c=o(r),h=c(r);return{c(){h.c(),i=hr()},l(m){h.l(m),i=hr()},m(m,_){h.m(m,_),yi(m,i,_)},p(m,_){c===(c=o(m))&&h?h.p(m,_):(h.d(1),h=c(m),h&&(h.c(),h.m(i.parentNode,i)))},d(m){m&&ze(i),h.d(m)}}}function AI(r){let i,o,c=r[39].number+"",h,m,_;function x(){return r[27](r[39])}return{c(){i=$e("div"),o=$e("span"),h=Vn(c),this.h()},l(s){i=Qe(s,"DIV",{class:!0});var M=Et(i);o=Qe(M,"SPAN",{class:!0});var P=Et(o);h=Un(P,c),P.forEach(ze),M.forEach(ze),this.h()},h(){be(o,"class","svelte-go79cf"),be(i,"class","cell svelte-go79cf"),Ui(i,"disabled",!ib(r[39],r[2],r[3])),Ui(i,"selected",r[0]&&r[39].year===r[0].getFullYear()&&r[39].month===r[0].getMonth()&&r[39].number===r[0].getDate()),Ui(i,"today",r[39].year===r[11].getFullYear()&&r[39].month===r[11].getMonth()&&r[39].number===r[11].getDate()),Ui(i,"other-month",r[39].month!==r[8])},m(s,M){yi(s,i,M),De(i,o),De(o,h),m||(_=Ei(i,"click",x),m=!0)},p(s,M){r=s,M[0]&128&&c!==(c=r[39].number+"")&&jr(h,c),M[0]&140&&Ui(i,"disabled",!ib(r[39],r[2],r[3])),M[0]&129&&Ui(i,"selected",r[0]&&r[39].year===r[0].getFullYear()&&r[39].month===r[0].getMonth()&&r[39].number===r[0].getDate()),M[0]&2176&&Ui(i,"today",r[39].year===r[11].getFullYear()&&r[39].month===r[11].getMonth()&&r[39].number===r[11].getDate()),M[0]&384&&Ui(i,"other-month",r[39].month!==r[8])},d(s){s&&ze(i),m=!1,_()}}}function II(r){let i,o=Nr(r[7].slice(r[38]*7,r[38]*7+7)),c=[];for(let h=0;h<o.length;h+=1)c[h]=AI(gI(r,o,h));return{c(){i=$e("div");for(let h=0;h<c.length;h+=1)c[h].c();this.h()},l(h){i=Qe(h,"DIV",{class:!0});var m=Et(i);for(let _=0;_<c.length;_+=1)c[_].l(m);m.forEach(ze),this.h()},h(){be(i,"class","week svelte-go79cf")},m(h,m){yi(h,i,m);for(let _=0;_<c.length;_+=1)c[_]&&c[_].m(i,null)},p(h,m){if(m[0]&18829){o=Nr(h[7].slice(h[38]*7,h[38]*7+7));let _;for(_=0;_<o.length;_+=1){const x=gI(h,o,_);c[_]?c[_].p(x,m):(c[_]=AI(x),c[_].c(),c[_].m(i,null))}for(;_<c.length;_+=1)c[_].d(1);c.length=o.length}},d(h){h&&ze(i),_a(c,h)}}}function aU(r){let i,o,c,h,m='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="svelte-go79cf"><path d="M5 3l3.057-3 11.943 12-11.943 12-3.057-3 9-9z" transform="rotate(180, 12, 12)"></path></svg>',_,x,s,M,P,L,F,V,X,q,Y,J,ue,ce,fe,Ae,Ce,He,We='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="svelte-go79cf"><path d="M5 3l3.057-3 11.943 12-11.943 12-3.057-3 9-9z"></path></svg>',nt,we,ht,pt,Xe,mt,Ft,tt,ei,ki,rt=Nr(r[5].months),yt=[];for(let wt=0;wt<rt.length;wt+=1)yt[wt]=wI(bI(r,rt,wt));let Xt=Nr(r[5].months),kt=[];for(let wt=0;wt<Xt.length;wt+=1)kt[wt]=TI(xI(r,Xt,wt));let Ue=Nr(r[6]),Ye=[];for(let wt=0;wt<Ue.length;wt+=1)Ye[wt]=SI(vI(r,Ue,wt));let Kt=Nr(r[6]),vi=[];for(let wt=0;wt<Kt.length;wt+=1)vi[wt]=MI(yI(r,Kt,wt));let en=Nr(Array(7)),Li=[];for(let wt=0;wt<en.length;wt+=1)Li[wt]=EI(_I(r,en,wt));let Zi=Nr(Array(6)),it=[];for(let wt=0;wt<Zi.length;wt+=1)it[wt]=II(mI(r,Zi,wt));function Sn(wt){r[28](wt)}let dr={timePrecision:r[1],setTime:r[10]};r[4]!==void 0&&(dr.browseDate=r[4]),Xe=new eU({props:dr}),Zr.push(()=>Wa(Xe,"browseDate",Sn));const Hr=r[21].default,xi=Dh(Hr,r,r[20],null);return{c(){i=$e("div"),o=$e("div"),c=$e("div"),h=$e("button"),h.innerHTML=m,_=Si(),x=$e("div"),s=$e("select");for(let wt=0;wt<yt.length;wt+=1)yt[wt].c();M=Si(),P=$e("select");for(let wt=0;wt<kt.length;wt+=1)kt[wt].c();L=Si(),F=Ld("svg"),V=Ld("path"),X=Si(),q=$e("div"),Y=$e("select");for(let wt=0;wt<Ye.length;wt+=1)Ye[wt].c();J=Si(),ue=$e("select");for(let wt=0;wt<vi.length;wt+=1)vi[wt].c();ce=Si(),fe=Ld("svg"),Ae=Ld("path"),Ce=Si(),He=$e("button"),He.innerHTML=We,nt=Si(),we=$e("div");for(let wt=0;wt<Li.length;wt+=1)Li[wt].c();ht=Si();for(let wt=0;wt<it.length;wt+=1)it[wt].c();pt=Si(),oo(Xe.$$.fragment),Ft=Si(),xi&&xi.c(),this.h()},l(wt){i=Qe(wt,"DIV",{class:!0,tabindex:!0});var ni=Et(i);o=Qe(ni,"DIV",{class:!0,tabindex:!0});var Ve=Et(o);c=Qe(Ve,"DIV",{class:!0});var ne=Et(c);h=Qe(ne,"BUTTON",{type:!0,class:!0,tabindex:!0,"data-svelte-h":!0}),xn(h)!=="svelte-t4cock"&&(h.innerHTML=m),_=Mi(ne),x=Qe(ne,"DIV",{class:!0});var pe=Et(x);s=Qe(pe,"SELECT",{class:!0});var Ie=Et(s);for(let $t=0;$t<yt.length;$t+=1)yt[$t].l(Ie);Ie.forEach(ze),M=Mi(pe),P=Qe(pe,"SELECT",{class:!0,tabindex:!0});var xt=Et(P);for(let $t=0;$t<kt.length;$t+=1)kt[$t].l(xt);xt.forEach(ze),L=Mi(pe),F=Od(pe,"svg",{xmlns:!0,width:!0,height:!0,viewBox:!0,class:!0});var vt=Et(F);V=Od(vt,"path",{d:!0,transform:!0}),Et(V).forEach(ze),vt.forEach(ze),pe.forEach(ze),X=Mi(ne),q=Qe(ne,"DIV",{class:!0});var Wt=Et(q);Y=Qe(Wt,"SELECT",{class:!0});var Jt=Et(Y);for(let $t=0;$t<Ye.length;$t+=1)Ye[$t].l(Jt);Jt.forEach(ze),J=Mi(Wt),ue=Qe(Wt,"SELECT",{class:!0,tabindex:!0});var Tt=Et(ue);for(let $t=0;$t<vi.length;$t+=1)vi[$t].l(Tt);Tt.forEach(ze),ce=Mi(Wt),fe=Od(Wt,"svg",{xmlns:!0,width:!0,height:!0,viewBox:!0,class:!0});var li=Et(fe);Ae=Od(li,"path",{d:!0,transform:!0}),Et(Ae).forEach(ze),li.forEach(ze),Wt.forEach(ze),Ce=Mi(ne),He=Qe(ne,"BUTTON",{type:!0,class:!0,tabindex:!0,"data-svelte-h":!0}),xn(He)!=="svelte-1a006lp"&&(He.innerHTML=We),ne.forEach(ze),nt=Mi(Ve),we=Qe(Ve,"DIV",{class:!0});var wi=Et(we);for(let $t=0;$t<Li.length;$t+=1)Li[$t].l(wi);wi.forEach(ze),ht=Mi(Ve);for(let $t=0;$t<it.length;$t+=1)it[$t].l(Ve);pt=Mi(Ve),so(Xe.$$.fragment,Ve),Ft=Mi(Ve),xi&&xi.l(Ve),Ve.forEach(ze),ni.forEach(ze),this.h()},h(){be(h,"type","button"),be(h,"class","page-button svelte-go79cf"),be(h,"tabindex","-1"),be(s,"class","svelte-go79cf"),be(P,"class","dummy-select svelte-go79cf"),be(P,"tabindex","-1"),be(V,"d","M6 0l12 12-12 12z"),be(V,"transform","rotate(90, 12, 12)"),be(F,"xmlns","http://www.w3.org/2000/svg"),be(F,"width","24"),be(F,"height","24"),be(F,"viewBox","0 0 24 24"),be(F,"class","svelte-go79cf"),be(x,"class","dropdown month svelte-go79cf"),be(Y,"class","svelte-go79cf"),be(ue,"class","dummy-select svelte-go79cf"),be(ue,"tabindex","-1"),be(Ae,"d","M6 0l12 12-12 12z"),be(Ae,"transform","rotate(90, 12, 12)"),be(fe,"xmlns","http://www.w3.org/2000/svg"),be(fe,"width","24"),be(fe,"height","24"),be(fe,"viewBox","0 0 24 24"),be(fe,"class","svelte-go79cf"),be(q,"class","dropdown year svelte-go79cf"),be(He,"type","button"),be(He,"class","page-button svelte-go79cf"),be(He,"tabindex","-1"),be(c,"class","top svelte-go79cf"),be(we,"class","header svelte-go79cf"),be(o,"class","tab-container svelte-go79cf"),be(o,"tabindex","-1"),be(i,"class","date-time-picker svelte-go79cf"),be(i,"tabindex","0")},m(wt,ni){yi(wt,i,ni),De(i,o),De(o,c),De(c,h),De(c,_),De(c,x),De(x,s);for(let Ve=0;Ve<yt.length;Ve+=1)yt[Ve]&&yt[Ve].m(s,null);ya(s,r[8]),De(x,M),De(x,P);for(let Ve=0;Ve<kt.length;Ve+=1)kt[Ve]&&kt[Ve].m(P,null);De(x,L),De(x,F),De(F,V),De(c,X),De(c,q),De(q,Y);for(let Ve=0;Ve<Ye.length;Ve+=1)Ye[Ve]&&Ye[Ve].m(Y,null);ya(Y,r[9]),De(q,J),De(q,ue);for(let Ve=0;Ve<vi.length;Ve+=1)vi[Ve]&&vi[Ve].m(ue,null);De(q,ce),De(q,fe),De(fe,Ae),De(c,Ce),De(c,He),De(o,nt),De(o,we);for(let Ve=0;Ve<Li.length;Ve+=1)Li[Ve]&&Li[Ve].m(we,null);De(o,ht);for(let Ve=0;Ve<it.length;Ve+=1)it[Ve]&&it[Ve].m(o,null);De(o,pt),ao(Xe,o,null),De(o,Ft),xi&&xi.m(o,null),tt=!0,ei||(ki=[Ei(h,"click",r[23]),Ei(s,"keydown",r[16]),Ei(s,"input",r[24]),Ei(Y,"input",r[25]),Ei(Y,"keydown",r[15]),Ei(He,"click",r[26]),Ei(i,"focusout",r[22]),Ei(i,"keydown",r[17])],ei=!0)},p(wt,ni){if(ni[0]&556){rt=Nr(wt[5].months);let ne;for(ne=0;ne<rt.length;ne+=1){const pe=bI(wt,rt,ne);yt[ne]?yt[ne].p(pe,ni):(yt[ne]=wI(pe),yt[ne].c(),yt[ne].m(s,null))}for(;ne<yt.length;ne+=1)yt[ne].d(1);yt.length=rt.length}if((!tt||ni[0]&256)&&ya(s,wt[8]),ni[0]&288){Xt=Nr(wt[5].months);let ne;for(ne=0;ne<Xt.length;ne+=1){const pe=xI(wt,Xt,ne);kt[ne]?kt[ne].p(pe,ni):(kt[ne]=TI(pe),kt[ne].c(),kt[ne].m(P,null))}for(;ne<kt.length;ne+=1)kt[ne].d(1);kt.length=Xt.length}if(ni[0]&64){Ue=Nr(wt[6]);let ne;for(ne=0;ne<Ue.length;ne+=1){const pe=vI(wt,Ue,ne);Ye[ne]?Ye[ne].p(pe,ni):(Ye[ne]=SI(pe),Ye[ne].c(),Ye[ne].m(Y,null))}for(;ne<Ye.length;ne+=1)Ye[ne].d(1);Ye.length=Ue.length}if((!tt||ni[0]&576)&&ya(Y,wt[9]),ni[0]&80){Kt=Nr(wt[6]);let ne;for(ne=0;ne<Kt.length;ne+=1){const pe=yI(wt,Kt,ne);vi[ne]?vi[ne].p(pe,ni):(vi[ne]=MI(pe),vi[ne].c(),vi[ne].m(ue,null))}for(;ne<vi.length;ne+=1)vi[ne].d(1);vi.length=Kt.length}if(ni[0]&32){en=Nr(Array(7));let ne;for(ne=0;ne<en.length;ne+=1){const pe=_I(wt,en,ne);Li[ne]?Li[ne].p(pe,ni):(Li[ne]=EI(pe),Li[ne].c(),Li[ne].m(we,null))}for(;ne<Li.length;ne+=1)Li[ne].d(1);Li.length=en.length}if(ni[0]&18829){Zi=Nr(Array(6));let ne;for(ne=0;ne<Zi.length;ne+=1){const pe=mI(wt,Zi,ne);it[ne]?it[ne].p(pe,ni):(it[ne]=II(pe),it[ne].c(),it[ne].m(o,pt))}for(;ne<it.length;ne+=1)it[ne].d(1);it.length=Zi.length}const Ve={};ni[0]&2&&(Ve.timePrecision=wt[1]),!mt&&ni[0]&16&&(mt=!0,Ve.browseDate=wt[4],qa(()=>mt=!1)),Xe.$set(Ve),xi&&xi.p&&(!tt||ni[0]&1048576)&&Lh(xi,Hr,wt,wt[20],tt?Rh(Hr,wt[20],ni,null):Oh(wt[20]),null)},i(wt){tt||($i(Xe.$$.fragment,wt),$i(xi,wt),tt=!0)},o(wt){ln(Xe.$$.fragment,wt),ln(xi,wt),tt=!1},d(wt){wt&&ze(i),_a(yt,wt),_a(kt,wt),_a(Ye,wt),_a(vi,wt),_a(Li,wt),_a(it,wt),lo(Xe),xi&&xi.d(wt),ei=!1,rs(ki)}}}function wl(r){return new Date(r.getTime())}function ny(r,i,o){return r>o?wl(o):r<i?wl(i):wl(r)}function fx(r,i,o){const c=ny(r,i,o);return c.getTime()!==r.getTime()&&(r=new Date(c.getFullYear(),c.getMonth(),c.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()),r=ny(r,i,o)),r}function CI(r,i){let o=[];for(let c=r.getFullYear();c<=i.getFullYear();c++)o.push(c);return o}function ib(r,i,o){const c=new Date(r.year,r.month,r.number),h=new Date(i.getFullYear(),i.getMonth(),i.getDate()),m=new Date(o.getFullYear(),o.getMonth(),o.getDate());return c>=h&&c<=m}function lU(r,i,o){let c,h,m,_,{$$slots:x={},$$scope:s}=i;const M=gb();let{value:P=null}=i;function L(Ue){Ue.getTime()!==(P==null?void 0:P.getTime())&&(o(4,fe=ny(Ue,ue,ce)),o(0,P=wl(fe)))}function F(Ue){Ue.getTime()!==(P==null?void 0:P.getTime())&&(o(4,fe=fx(Ue,ue,ce)),o(0,P=wl(fe)))}function V(Ue){o(4,fe=fx(Ue,ue,ce)),!We&&P&&L(fe)}function X(Ue){return o(4,fe=ny(Ue,ue,ce)),P&&L(fe),fe}const q=new Date,Y=new Date;let{timePrecision:J=null}=i,{min:ue=new Date(Y.getFullYear()-20,0,1)}=i,{max:ce=new Date(Y.getFullYear(),11,31,23,59,59,999)}=i,fe=wl(P||fx(Y,ue,ce));function Ae(Ue){fe.getTime()!==(Ue==null?void 0:Ue.getTime())&&o(4,fe=Ue?wl(Ue):fe)}let Ce=CI(ue,ce),{locale:He={}}=i,{browseWithoutSelecting:We=!1}=i;function nt(Ue){fe.setFullYear(Ue),V(fe)}function we(Ue){let Ye=fe.getFullYear();Ue===12?(Ue=0,Ye++):Ue===-1&&(Ue=11,Ye--);const Kt=im(Ye,Ue),vi=Math.min(fe.getDate(),Kt);V(new Date(Ye,Ue,vi,fe.getHours(),fe.getMinutes(),fe.getSeconds(),fe.getMilliseconds()))}function ht(Ue){ib(Ue,ue,ce)&&(fe.setFullYear(0),fe.setMonth(0),fe.setDate(1),fe.setFullYear(Ue.year),fe.setMonth(Ue.month),fe.setDate(Ue.number),F(fe),M("select",wl(fe)))}function pt(Ue){if(Ue.shiftKey&&Ue.key==="ArrowUp")nt(fe.getFullYear()-1);else if(Ue.shiftKey&&Ue.key==="ArrowDown")nt(fe.getFullYear()+1);else if(Ue.shiftKey&&Ue.key==="ArrowLeft")we(fe.getMonth()-1);else if(Ue.shiftKey&&Ue.key==="ArrowRight")we(fe.getMonth()+1);else return!1;return Ue.preventDefault(),!0}function Xe(Ue){if(Ue.shiftKey||Ue.altKey){pt(Ue);return}else if(Ue.key==="ArrowUp")nt(fe.getFullYear()-1);else if(Ue.key==="ArrowDown")nt(fe.getFullYear()+1);else if(Ue.key==="ArrowLeft")we(fe.getMonth()-1);else if(Ue.key==="ArrowRight")we(fe.getMonth()+1);else{pt(Ue);return}Ue.preventDefault()}function mt(Ue){if(Ue.shiftKey||Ue.altKey){pt(Ue);return}else if(Ue.key==="ArrowUp"||Ue.key==="ArrowLeft")we(fe.getMonth()-1);else if(Ue.key==="ArrowDown"||Ue.key==="ArrowRight")we(fe.getMonth()+1);else{pt(Ue);return}Ue.preventDefault()}function Ft(Ue){var Kt,vi;let Ye=Ue.shiftKey||Ue.altKey;if(!(((Kt=Ue.target)==null?void 0:Kt.tagName)==="SELECT"||((vi=Ue.target)==null?void 0:vi.tagName)==="SPAN")){if(Ye){pt(Ue);return}else if(Ue.key==="ArrowUp")fe.setDate(fe.getDate()-7),F(fe);else if(Ue.key==="ArrowDown")fe.setDate(fe.getDate()+7),F(fe);else if(Ue.key==="ArrowLeft")fe.setDate(fe.getDate()-1),F(fe);else if(Ue.key==="ArrowRight")fe.setDate(fe.getDate()+1),F(fe);else if(Ue.key==="Enter")L(fe),M("select",wl(fe));else return;Ue.preventDefault()}}function tt(Ue){gy.call(this,r,Ue)}const ei=()=>we(fe.getMonth()-1),ki=Ue=>we(parseInt(Ue.currentTarget.value)),rt=Ue=>nt(parseInt(Ue.currentTarget.value)),yt=()=>we(fe.getMonth()+1),Xt=Ue=>ht(Ue);function kt(Ue){fe=Ue,o(4,fe)}return r.$$set=Ue=>{"value"in Ue&&o(0,P=Ue.value),"timePrecision"in Ue&&o(1,J=Ue.timePrecision),"min"in Ue&&o(2,ue=Ue.min),"max"in Ue&&o(3,ce=Ue.max),"locale"in Ue&&o(18,He=Ue.locale),"browseWithoutSelecting"in Ue&&o(19,We=Ue.browseWithoutSelecting),"$$scope"in Ue&&o(20,s=Ue.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&13&&(P&&P>ce?L(ce):P&&P<ue&&L(ue)),r.$$.dirty[0]&1&&Ae(P),r.$$.dirty[0]&12&&o(6,Ce=CI(ue,ce)),r.$$.dirty[0]&262144&&o(5,c=rU(He)),r.$$.dirty[0]&16&&o(9,h=fe.getFullYear()),r.$$.dirty[0]&16&&o(8,m=fe.getMonth()),r.$$.dirty[0]&48&&o(7,_=iU(fe,c.weekStartsOn))},[P,J,ue,ce,fe,c,Ce,_,m,h,X,q,nt,we,ht,Xe,mt,Ft,He,We,s,x,tt,ei,ki,rt,yt,Xt,kt]}class cU extends _o{constructor(i){super(),yo(this,i,lU,aU,go,{value:0,timePrecision:1,min:2,max:3,locale:18,browseWithoutSelecting:19},null,[-1,-1])}}function uU(r,{delay:i=0,duration:o=400,easing:c=ck,amount:h=5,opacity:m=0}={}){const _=getComputedStyle(r),x=+_.opacity,s=_.filter==="none"?"":_.filter,M=x*(1-m),[P,L]=yx(h);return{delay:i,duration:o,easing:c,css:(F,V)=>`opacity: ${x-M*V}; filter: ${s} blur(${V*P}${L});`}}function hU(r,{delay:i=0,duration:o=400,easing:c=zR}={}){const h=+getComputedStyle(r).opacity;return{delay:i,duration:o,easing:c,css:m=>`opacity: ${m*h}`}}function dk(r,{delay:i=0,duration:o=400,easing:c=uk,x:h=0,y:m=0,opacity:_=0}={}){const x=getComputedStyle(r),s=+x.opacity,M=x.transform==="none"?"":x.transform,P=s*(1-_),[L,F]=yx(h),[V,X]=yx(m);return{delay:i,duration:o,easing:c,css:(q,Y)=>`
			transform: ${M} translate(${(1-q)*L}${F}, ${(1-q)*V}${X});
			opacity: ${s-P*Y}`}}function dU(r,{delay:i=0,duration:o=400,easing:c=uk,axis:h="y"}={}){const m=getComputedStyle(r),_=+m.opacity,x=h==="y"?"height":"width",s=parseFloat(m[x]),M=h==="y"?["top","bottom"]:["left","right"],P=M.map(J=>`${J[0].toUpperCase()}${J.slice(1)}`),L=parseFloat(m[`padding${P[0]}`]),F=parseFloat(m[`padding${P[1]}`]),V=parseFloat(m[`margin${P[0]}`]),X=parseFloat(m[`margin${P[1]}`]),q=parseFloat(m[`border${P[0]}Width`]),Y=parseFloat(m[`border${P[1]}Width`]);return{delay:i,duration:o,easing:c,css:J=>`overflow: hidden;opacity: ${Math.min(J*20,1)*_};${x}: ${J*s}px;padding-${M[0]}: ${J*L}px;padding-${M[1]}: ${J*F}px;margin-${M[0]}: ${J*V}px;margin-${M[1]}: ${J*X}px;border-${M[0]}-width: ${J*q}px;border-${M[1]}-width: ${J*Y}px;`}}function PI(r,i,o){let c="",h=!0;o=o||new Date(2020,0,1,0,0,0,0);let m=o.getFullYear(),_=o.getMonth(),x=o.getDate(),s=o.getHours(),M=o.getMinutes(),P=o.getSeconds();const L=o.getMilliseconds();function F(Y){for(let J=0;J<Y.length;J++)if(r.startsWith(Y[J]))r=r.slice(1);else{h=!1,r.length===0&&(c=Y.slice(J));return}}function V(Y,J,ue){const ce=r.match(Y);if(ce!=null&&ce[0]){r=r.slice(ce[0].length);const fe=parseInt(ce[0]);return fe>ue||fe<J?(h=!1,null):fe}else return h=!1,null}function X(Y){if(typeof Y=="string")F(Y);else if(Y.id==="yy"){const J=V(/^[0-9]{2}/,0,99);J!==null&&(m=2e3+J)}else if(Y.id==="yyyy"){const J=V(/^[0-9]{4}/,0,9999);J!==null&&(m=J)}else if(Y.id==="MM"){const J=V(/^[0-9]{2}/,1,12);J!==null&&(_=J-1)}else if(Y.id==="dd"){const J=V(/^[0-9]{2}/,1,31);J!==null&&(x=J)}else if(Y.id==="HH"){const J=V(/^[0-9]{2}/,0,23);J!==null&&(s=J)}else if(Y.id==="mm"){const J=V(/^[0-9]{2}/,0,59);J!==null&&(M=J)}else if(Y.id==="ss"){const J=V(/^[0-9]{2}/,0,59);J!==null&&(P=J)}}for(const Y of i)if(X(Y),!h)break;const q=im(m,_);return x>q&&(h=!1),{date:h?new Date(m,_,x,s,M,P,L):null,missingPunctuation:c}}function bp(r){return("0"+r.toString()).slice(-2)}const fU=[{id:"yyyy",toString:r=>r.getFullYear().toString()},{id:"yy",toString:r=>r.getFullYear().toString().slice(-2)},{id:"MM",toString:r=>bp(r.getMonth()+1)},{id:"dd",toString:r=>bp(r.getDate())},{id:"HH",toString:r=>bp(r.getHours())},{id:"mm",toString:r=>bp(r.getMinutes())},{id:"ss",toString:r=>bp(r.getSeconds())}];function pU(r){for(const i of fU)if(r.startsWith(i.id))return i}function kI(r){const i=[];for(;r.length>0;){const o=pU(r);o?(i.push(o),r=r.slice(o.id.length)):typeof i[i.length-1]=="string"?(i[i.length-1]+=r[0],r=r.slice(1)):(i.push(r[0]),r=r.slice(1))}return i}function DI(r){let i,o,c,h,m=`${r[18]}px`,_;function x(M){r[34](M)}let s={min:r[3],max:r[4],locale:r[10],browseWithoutSelecting:r[11],timePrecision:r[12],$$slots:{default:[mU]},$$scope:{ctx:r}};return r[14]!==void 0&&(s.value=r[14]),o=new cU({props:s}),Zr.push(()=>Wa(o,"value",x)),o.$on("focusout",r[21]),o.$on("select",r[23]),{c(){i=$e("div"),oo(o.$$.fragment),this.h()},l(M){i=Qe(M,"DIV",{class:!0});var P=Et(i);so(o.$$.fragment,P),P.forEach(ze),this.h()},h(){be(i,"class","picker svelte-1vabmef"),Ui(i,"visible",r[2]),Ui(i,"above",r[17]),El(i,"--picker-left-position",m)},m(M,P){yi(M,i,P),ao(o,i,null),r[35](i),_=!0},p(M,P){const L={};P[0]&8&&(L.min=M[3]),P[0]&16&&(L.max=M[4]),P[0]&1024&&(L.locale=M[10]),P[0]&2048&&(L.browseWithoutSelecting=M[11]),P[0]&4096&&(L.timePrecision=M[12]),P[1]&32&&(L.$$scope={dirty:P,ctx:M}),!c&&P[0]&16384&&(c=!0,L.value=M[14],qa(()=>c=!1)),o.$set(L),(!_||P[0]&4)&&Ui(i,"visible",M[2]),(!_||P[0]&131072)&&Ui(i,"above",M[17]),P[0]&262144&&m!==(m=`${M[18]}px`)&&El(i,"--picker-left-position",m)},i(M){_||($i(o.$$.fragment,M),M&&tf(()=>{_&&(h||(h=V_(i,r[24],{},!0)),h.run(1))}),_=!0)},o(M){ln(o.$$.fragment,M),M&&(h||(h=V_(i,r[24],{},!1)),h.run(0)),_=!1},d(M){M&&ze(i),lo(o),r[35](null),M&&h&&h.end()}}}function mU(r){let i;const o=r[29].default,c=Dh(o,r,r[36],null);return{c(){c&&c.c()},l(h){c&&c.l(h)},m(h,m){c&&c.m(h,m),i=!0},p(h,m){c&&c.p&&(!i||m[1]&32)&&Lh(c,o,h,h[36],i?Rh(o,h[36],m,null):Oh(h[36]),null)},i(h){i||($i(c,h),i=!0)},o(h){ln(c,h),i=!1},d(h){c&&c.d(h)}}}function gU(r){let i,o,c,h,m,_,x,s=r[2]&&!r[7]&&DI(r);return{c(){i=$e("div"),o=$e("input"),c=Si(),s&&s.c(),this.h()},l(M){i=Qe(M,"DIV",{class:!0});var P=Et(i);o=Qe(P,"INPUT",{type:!0,id:!0,placeholder:!0,class:!0}),c=Mi(P),s&&s.l(P),P.forEach(ze),this.h()},h(){be(o,"type","text"),o.value=r[0],be(o,"id",r[5]),be(o,"placeholder",r[6]),o.disabled=r[7],o.required=r[8],be(o,"class","svelte-1vabmef"),Ui(o,"invalid",!r[1]),be(i,"class",h="date-time-field "+r[9]+" svelte-1vabmef")},m(M,P){yi(M,i,P),De(i,o),r[30](o),De(i,c),s&&s.m(i,null),m=!0,_||(x=[Ei(o,"focus",r[31]),Ei(o,"mousedown",r[32]),Ei(o,"input",r[33]),Ei(i,"focusout",r[21]),Ei(i,"keydown",r[22])],_=!0)},p(M,P){(!m||P[0]&1&&o.value!==M[0])&&(o.value=M[0]),(!m||P[0]&32)&&be(o,"id",M[5]),(!m||P[0]&64)&&be(o,"placeholder",M[6]),(!m||P[0]&128)&&(o.disabled=M[7]),(!m||P[0]&256)&&(o.required=M[8]),(!m||P[0]&2)&&Ui(o,"invalid",!M[1]),M[2]&&!M[7]?s?(s.p(M,P),P[0]&132&&$i(s,1)):(s=DI(M),s.c(),$i(s,1),s.m(i,null)):s&&(yc(),ln(s,1,1,()=>{s=null}),vc()),(!m||P[0]&512&&h!==(h="date-time-field "+M[9]+" svelte-1vabmef"))&&be(i,"class",h)},i(M){m||($i(s),m=!0)},o(M){ln(s),m=!1},d(M){M&&ze(i),r[30](null),s&&s.d(),_=!1,rs(x)}}}function _U(r,i,o){let c,h,{$$slots:m={},$$scope:_}=i;const x=gb(),s=new Date,M=yr(null);Fi(r,M,it=>o(37,h=it));const P={subscribe:M.subscribe,set:it=>{it==null?(M.set(null),o(25,L=it)):it.getTime()!==(h==null?void 0:h.getTime())&&(M.set(it),o(25,L=it))}};Fi(r,P,it=>o(14,c=it));let{value:L=null}=i,{min:F=new Date(s.getFullYear()-20,0,1)}=i,{max:V=new Date(s.getFullYear(),11,31,23,59,59,999)}=i,{id:X=null}=i,{placeholder:q="2020-12-31 23:00:00"}=i,{valid:Y=!0}=i,{disabled:J=!1}=i,{required:ue=!1}=i,{class:ce=""}=i,{format:fe="yyyy-MM-dd HH:mm:ss"}=i,Ae=kI(fe),{locale:Ce={}}=i;function He(it,Sn){o(0,We=pI(it,Sn))}let{text:We=pI(c,Ae)}=i;function nt(it,Sn){if(it.length){const dr=PI(it,Sn,c);dr.date!==null?(o(1,Y=!0),P.set(dr.date)):o(1,Y=!1)}else o(1,Y=!0),L&&(o(25,L=null),P.set(null))}let{visible:we=!1}=i,{closeOnSelection:ht=!1}=i,{browseWithoutSelecting:pt=!1}=i,{timePrecision:Xe=null}=i;function mt(it){(it==null?void 0:it.currentTarget)instanceof HTMLElement&&it.relatedTarget&&it.relatedTarget instanceof Node&&it.currentTarget.contains(it.relatedTarget)||o(2,we=!1)}function Ft(it){it.key==="Escape"&&we?(o(2,we=!1),it.preventDefault(),it.stopPropagation()):it.key==="Enter"&&(o(2,we=!we),it.preventDefault())}function tt(it){x("select",it.detail),ht&&o(2,we=!1)}let{dynamicPositioning:ei=!1}=i,ki,rt,yt=!1,Xt=null;function kt(){if(o(17,yt=!1),o(18,Xt=null),we&&rt&&ei){const it=ki.getBoundingClientRect(),Sn=rt.offsetWidth-it.width,dr=it.bottom+rt.offsetHeight+5,Hr=it.left+rt.offsetWidth+5;if(dr>window.innerHeight&&o(17,yt=!0),Hr>window.innerWidth&&(o(18,Xt=-Sn),it.left<Sn+5)){const wt=window.innerWidth/2-rt.offsetWidth/2;o(18,Xt=wt-it.left)}}}function Ue(it){return kt(),dk(it,{duration:200,easing:ck,y:yt?5:-5})}function Ye(it){Zr[it?"unshift":"push"](()=>{ki=it,o(15,ki)})}const Kt=()=>o(2,we=!0),vi=()=>o(2,we=!0),en=it=>{if(it instanceof InputEvent&&it.inputType==="insertText"&&typeof it.data=="string"&&it.currentTarget.value===We+it.data){let Sn=PI(We,Ae,c);if(Sn.missingPunctuation!==""&&!Sn.missingPunctuation.startsWith(it.data)){o(0,We=We+Sn.missingPunctuation+it.data);return}}o(0,We=it.currentTarget.value)};function Li(it){c=it,P.set(c)}function Zi(it){Zr[it?"unshift":"push"](()=>{rt=it,o(16,rt)})}return r.$$set=it=>{"value"in it&&o(25,L=it.value),"min"in it&&o(3,F=it.min),"max"in it&&o(4,V=it.max),"id"in it&&o(5,X=it.id),"placeholder"in it&&o(6,q=it.placeholder),"valid"in it&&o(1,Y=it.valid),"disabled"in it&&o(7,J=it.disabled),"required"in it&&o(8,ue=it.required),"class"in it&&o(9,ce=it.class),"format"in it&&o(26,fe=it.format),"locale"in it&&o(10,Ce=it.locale),"text"in it&&o(0,We=it.text),"visible"in it&&o(2,we=it.visible),"closeOnSelection"in it&&o(27,ht=it.closeOnSelection),"browseWithoutSelecting"in it&&o(11,pt=it.browseWithoutSelecting),"timePrecision"in it&&o(12,Xe=it.timePrecision),"dynamicPositioning"in it&&o(28,ei=it.dynamicPositioning),"$$scope"in it&&o(36,_=it.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&33554432&&P.set(L),r.$$.dirty[0]&67108864&&o(13,Ae=kI(fe)),r.$$.dirty[0]&24576&&He(c,Ae),r.$$.dirty[0]&8193&&nt(We,Ae)},[We,Y,we,F,V,X,q,J,ue,ce,Ce,pt,Xe,Ae,c,ki,rt,yt,Xt,M,P,mt,Ft,tt,Ue,L,fe,ht,ei,m,Ye,Kt,vi,en,Li,Zi,_]}class yU extends _o{constructor(i){super(),yo(this,i,_U,gU,go,{value:25,min:3,max:4,id:5,placeholder:6,valid:1,disabled:7,required:8,class:9,format:26,locale:10,text:0,visible:2,closeOnSelection:27,browseWithoutSelecting:11,timePrecision:12,dynamicPositioning:28},null,[-1,-1])}}function vU(r){let i,o,c,h,m,_,x,s,M,P,L,F,V,X,q,Y,J,ue,ce,fe,Ae,Ce,He,We='<div class=""><div id="timeslider-btn" class="flex"></div></div>',nt;function we(Ft){r[7](Ft)}let ht={dynamicPositioning:"true",closeOnSelection:!0,format:"yyyy-MM-dd",placeholder:""};r[0]!==void 0&&(ht.value=r[0]),X=new yU({props:ht}),Zr.push(()=>Wa(X,"value",we));function pt(Ft){r[9](Ft)}function Xe(Ft){r[10](Ft)}let mt={id:"time-range",formatter:r[8],max:r[5].length-1,range:"min",suffix:"h",pushy:!0,pips:!0,all:"label",float:!0};return r[2]!==void 0&&(mt.pipstep=r[2]),r[1]!==void 0&&(mt.values=r[1]),ce=new JV({props:mt}),Zr.push(()=>Wa(ce,"pipstep",pt)),Zr.push(()=>Wa(ce,"values",Xe)),ce.$on("change",r[11]),{c(){i=$e("div"),o=$e("div"),c=$e("div"),h=$e("div"),m=$e("p"),_=Vn(r[4]),x=Si(),s=$e("p"),M=Vn(r[3]),P=Vn(":00:00"),L=Si(),F=$e("div"),V=$e("div"),oo(X.$$.fragment),Y=Si(),J=$e("div"),ue=$e("div"),oo(ce.$$.fragment),Ce=Si(),He=$e("div"),He.innerHTML=We,this.h()},l(Ft){i=Qe(Ft,"DIV",{class:!0});var tt=Et(i);o=Qe(tt,"DIV",{id:!0,class:!0});var ei=Et(o);c=Qe(ei,"DIV",{class:!0});var ki=Et(c);h=Qe(ki,"DIV",{class:!0});var rt=Et(h);m=Qe(rt,"P",{class:!0});var yt=Et(m);_=Un(yt,r[4]),yt.forEach(ze),x=Mi(rt),s=Qe(rt,"P",{class:!0});var Xt=Et(s);M=Un(Xt,r[3]),P=Un(Xt,":00:00"),Xt.forEach(ze),rt.forEach(ze),ki.forEach(ze),L=Mi(ei),F=Qe(ei,"DIV",{class:!0});var kt=Et(F);V=Qe(kt,"DIV",{class:!0});var Ue=Et(V);so(X.$$.fragment,Ue),Ue.forEach(ze),kt.forEach(ze),Y=Mi(ei),J=Qe(ei,"DIV",{class:!0,style:!0});var Ye=Et(J);ue=Qe(Ye,"DIV",{class:!0,style:!0});var Kt=Et(ue);so(ce.$$.fragment,Kt),Kt.forEach(ze),Ye.forEach(ze),Ce=Mi(ei),He=Qe(ei,"DIV",{class:!0,"data-svelte-h":!0}),xn(He)!=="svelte-3gz9hj"&&(He.innerHTML=We),ei.forEach(ze),tt.forEach(ze),this.h()},h(){be(m,"class","font-bold text-purple-900 mb-0"),be(s,"class","mb-0"),be(h,"class","text-center"),be(c,"class","flex p-2 border-end border-start svelte-qkqnwo"),be(V,"class",""),be(F,"class","flex p-2 border-end svelte-qkqnwo"),be(ue,"class","p-2"),El(ue,"width","-webkit-fill-available"),be(J,"class","basis-1/2"),El(J,"width","-webkit-fill-available"),be(He,"class","flex p-2 border-end border-start svelte-qkqnwo"),be(o,"id","timeslider"),be(o,"class","flex justify-center items-center svelte-qkqnwo"),be(i,"class","timeslider-class svelte-qkqnwo")},m(Ft,tt){yi(Ft,i,tt),De(i,o),De(o,c),De(c,h),De(h,m),De(m,_),De(h,x),De(h,s),De(s,M),De(s,P),De(o,L),De(o,F),De(F,V),ao(X,V,null),De(o,Y),De(o,J),De(J,ue),ao(ce,ue,null),De(o,Ce),De(o,He),nt=!0},p(Ft,[tt]){(!nt||tt&16)&&jr(_,Ft[4]),(!nt||tt&8)&&jr(M,Ft[3]);const ei={};!q&&tt&1&&(q=!0,ei.value=Ft[0],qa(()=>q=!1)),X.$set(ei);const ki={};!fe&&tt&4&&(fe=!0,ki.pipstep=Ft[2],qa(()=>fe=!1)),!Ae&&tt&2&&(Ae=!0,ki.values=Ft[1],qa(()=>Ae=!1)),ce.$set(ki)},i(Ft){nt||($i(X.$$.fragment,Ft),$i(ce.$$.fragment,Ft),nt=!0)},o(Ft){ln(X.$$.fragment,Ft),ln(ce.$$.fragment,Ft),nt=!1},d(Ft){Ft&&ze(i),lo(X),lo(ce)}}}function LI(r){let i=""+(r.getMonth()+1),o=""+r.getDate(),c=r.getFullYear();return i.length<2&&(i="0"+i),o.length<2&&(o="0"+o),[c,i,o].join("-")}function xU(r,i,o){let c,h;Fi(r,P_,Ce=>o(3,c=Ce)),Fi(r,Yx,Ce=>o(4,h=Ce));let m=new Date,_=new Date,x=[10],s=1,M=[];const P=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],L=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];let F=LI(new Date);function V(Ce,He,We){let nt=moment(`2017-08-30T${Ce}:00`),we=moment(`2017-08-30T${He}:00`).subtract(We,"hours"),ht=[];for(ht.push(nt.format("HH")),M.push(nt.format("H"));ht[ht.length-1]<we.format("HH");)ht.push(nt.add(We,"hours").format("HH")),M.push(nt.format("H"));return ht}let X=V("01:00","24:00",3);s=1;async function q(Ce,He){let We="/api/mapclient/",nt={action:"get-latest-date",dataset:"geos"};await Gr.get(We,{params:nt,headers:{Authorization:"admin.KRg06uWinwXAL5SRRCBSmH2HON4tZKdpCItHpbZh7HghJFFH6mIizlNM01"}}).then(we=>{let ht=we.data.slice(0,4)+"-"+we.data.substr(4,2)+"-"+we.data.substr(6,2);Cy.set(ht),ty.set(Ce),ey.set(He)}).catch(we=>{throw console.error(we),we})}function Y(Ce){ty.set(X[Ce.detail.value]),an(P_,c=X[Ce.detail.value],c)}mb(async()=>{let Ce=m.getHours(),He=M.reduce(function(nt,we){return Math.abs(we-Ce)<Math.abs(nt-Ce)?we:nt}),We=M.findIndex(nt=>nt===He);o(1,x=[We]),an(P_,c=X[We],c),q(X[We],F)});function J(Ce){_=Ce,o(0,_)}const ue=Ce=>X[Ce];function ce(Ce){s=Ce,o(2,s)}function fe(Ce){x=Ce,o(1,x)}const Ae=Ce=>Y(Ce);return r.$$.update=()=>{if(r.$$.dirty&1&&_){let Ce=_.getFullYear(),He=_.getMonth(),We=_.getDate(),nt=_.getDay();an(Yx,h=P[nt]+" "+L[He]+" "+We+" "+Ce,h),ey.set(LI(_))}},[_,x,s,c,h,X,Y,J,ue,ce,fe,Ae]}class bU extends _o{constructor(i){super(),yo(this,i,xU,vU,go,{})}}const wU=r=>({}),OI=r=>({});function TU(r){let i,o,c,h="x",m,_,x,s,M,P,L;const F=r[3].header,V=Dh(F,r,r[2],OI),X=r[3].default,q=Dh(X,r,r[2],null);return{c(){i=$e("dialog"),o=$e("div"),c=$e("button"),c.textContent=h,m=Si(),V&&V.c(),_=Si(),q&&q.c(),x=Si(),s=$e("br"),this.h()},l(Y){i=Qe(Y,"DIALOG",{class:!0});var J=Et(i);o=Qe(J,"DIV",{class:!0});var ue=Et(o);c=Qe(ue,"BUTTON",{class:!0,"data-svelte-h":!0}),xn(c)!=="svelte-vbf0fn"&&(c.textContent=h),m=Mi(ue),V&&V.l(ue),_=Mi(ue),q&&q.l(ue),x=Mi(ue),s=Qe(ue,"BR",{}),ue.forEach(ze),J.forEach(ze),this.h()},h(){be(c,"class","modal-close-button svelte-1ao7csy"),be(o,"class","svelte-1ao7csy"),be(i,"class","svelte-1ao7csy")},m(Y,J){yi(Y,i,J),De(i,o),De(o,c),De(o,m),V&&V.m(o,null),De(o,_),q&&q.m(o,null),De(o,x),De(o,s),r[6](i),M=!0,P||(L=[Ei(c,"click",r[5]),Ei(o,"click",FR(r[4])),Ei(i,"close",r[7]),Ei(i,"click",BR(r[8]))],P=!0)},p(Y,[J]){V&&V.p&&(!M||J&4)&&Lh(V,F,Y,Y[2],M?Rh(F,Y[2],J,wU):Oh(Y[2]),OI),q&&q.p&&(!M||J&4)&&Lh(q,X,Y,Y[2],M?Rh(X,Y[2],J,null):Oh(Y[2]),null)},i(Y){M||($i(V,Y),$i(q,Y),M=!0)},o(Y){ln(V,Y),ln(q,Y),M=!1},d(Y){Y&&ze(i),V&&V.d(Y),q&&q.d(Y),r[6](null),P=!1,rs(L)}}}function SU(r,i,o){let{$$slots:c={},$$scope:h}=i,{showModal:m}=i,_;NR(()=>console.log("modal was destroyed!"));function x(F){gy.call(this,r,F)}const s=()=>_.close();function M(F){Zr[F?"unshift":"push"](()=>{_=F,o(1,_)})}const P=()=>o(0,m=!1),L=()=>_.close();return r.$$set=F=>{"showModal"in F&&o(0,m=F.showModal),"$$scope"in F&&o(2,h=F.$$scope)},r.$$.update=()=>{r.$$.dirty&3&&_&&m&&_.showModal()},[m,_,h,c,x,s,M,P,L]}class MU extends _o{constructor(i){super(),yo(this,i,SU,TU,go,{showModal:0})}}function EU(r){let i,o,c='<a class="btn-tool d-block"><p class="icon d-flex align-items-center justify-content-center rounded-circle mx-auto"><img class="d-block" src="assets/img/icon/icon-tool-1.svg" alt=""/></p> <p class="text d-block text-sm text-center mb-0"><span class="d-block">Air</span> Quality</p></a>',h,m,_='<a class="btn-tool d-block"><p class="icon d-flex align-items-center justify-content-center rounded-circle mx-auto"><img class="d-block" src="assets/img/icon/icon-tool-2.svg" alt=""/></p> <p class="text d-block text-sm text-center mb-0"><span class="d-block">Ground</span> Station</p></a>',x,s,M='<a class="btn-tool d-block"><p class="icon d-flex align-items-center justify-content-center rounded-circle mx-auto"><img class="d-block" src="assets/img/icon/icon-tool-3.svg" alt=""/></p> <p class="text d-block text-sm text-center mb-0"><span class="d-block">Fire</span> Product</p></a>',P,L,F='<a class="btn-tool d-block"><p class="icon d-flex align-items-center justify-content-center rounded-circle mx-auto"><img class="d-block" src="assets/img/icon/icon-tool-4.svg" alt=""/></p> <p class="text d-block text-sm text-center mb-0"><span class="d-block">Statistics</span> Report</p></a>',V,X,q='<a class="btn-tool d-block"><p class="icon d-flex align-items-center justify-content-center rounded-circle mx-auto"><img class="d-block" src="assets/img/icon/icon-tool-5.svg" alt=""/></p> <p class="text d-block text-sm text-center mb-0"><span class="d-block">Base</span> Map</p></a>',Y,J;return{c(){i=$e("div"),o=$e("div"),o.innerHTML=c,h=Si(),m=$e("div"),m.innerHTML=_,x=Si(),s=$e("div"),s.innerHTML=M,P=Si(),L=$e("div"),L.innerHTML=F,V=Si(),X=$e("div"),X.innerHTML=q,this.h()},l(ue){i=Qe(ue,"DIV",{class:!0});var ce=Et(i);o=Qe(ce,"DIV",{class:!0,"data-svelte-h":!0}),xn(o)!=="svelte-1lqf13n"&&(o.innerHTML=c),h=Mi(ce),m=Qe(ce,"DIV",{class:!0,"data-svelte-h":!0}),xn(m)!=="svelte-j6j13u"&&(m.innerHTML=_),x=Mi(ce),s=Qe(ce,"DIV",{class:!0,"data-svelte-h":!0}),xn(s)!=="svelte-1ph61d1"&&(s.innerHTML=M),P=Mi(ce),L=Qe(ce,"DIV",{class:!0,"data-svelte-h":!0}),xn(L)!=="svelte-9oc9vu"&&(L.innerHTML=F),V=Mi(ce),X=Qe(ce,"DIV",{class:!0,"data-svelte-h":!0}),xn(X)!=="svelte-191qql3"&&(X.innerHTML=q),ce.forEach(ze),this.h()},h(){be(o,"class","air-quality"),be(m,"class","ground-station"),be(s,"class","fire-product"),be(L,"class","statistics-map"),be(X,"class","base-map"),be(i,"class","detail")},m(ue,ce){yi(ue,i,ce),De(i,o),De(i,h),De(i,m),De(i,x),De(i,s),De(i,P),De(i,L),De(i,V),De(i,X),Y||(J=[Ei(o,"click",r[4]),Ei(o,"keydown",r[4]),Ei(m,"click",r[5]),Ei(m,"keydown",r[6]),Ei(s,"click",r[7]),Ei(s,"keydown",r[8]),Ei(L,"click",r[9]),Ei(L,"keydown",r[10]),Ei(X,"click",r[3])],Y=!0)},p:_r,i:_r,o:_r,d(ue){ue&&ze(i),Y=!1,rs(J)}}}function AU(r,i,o){let c,h,m,_,x;Fi(r,Jd,Y=>o(11,c=Y)),Fi(r,Yd,Y=>o(12,h=Y)),Fi(r,Ph,Y=>o(0,m=Y)),Fi(r,Hp,Y=>o(1,_=Y)),Fi(r,Sc,Y=>o(2,x=Y));function s(){an(Yd,h=!h,h),h&&setTimeout(()=>{document.querySelectorAll("#mapsettingPanel").forEach(Y=>Y.style.display="block")},5)}function M(){an(Jd,c=!c,c),c&&setTimeout(()=>{document.querySelectorAll("#select_air_pollutant").forEach(Y=>Y.style.display="block")},5)}return[m,_,x,s,M,()=>an(Ph,m=!m,m),()=>an(Ph,m=!m,m),()=>an(Hp,_=!_,_),()=>an(Hp,_=!_,_),()=>an(Sc,x=!x,x),()=>an(Sc,x=!x,x)]}class IU extends _o{constructor(i){super(),yo(this,i,AU,EU,go,{})}}function O_(r,i){return r==null||i==null?NaN:r<i?-1:r>i?1:r>=i?0:NaN}function CU(r,i){return r==null||i==null?NaN:i<r?-1:i>r?1:i>=r?0:NaN}function fk(r){let i,o,c;r.length!==2?(i=O_,o=(x,s)=>O_(r(x),s),c=(x,s)=>r(x)-s):(i=r===O_||r===CU?r:PU,o=r,c=r);function h(x,s,M=0,P=x.length){if(M<P){if(i(s,s)!==0)return P;do{const L=M+P>>>1;o(x[L],s)<0?M=L+1:P=L}while(M<P)}return M}function m(x,s,M=0,P=x.length){if(M<P){if(i(s,s)!==0)return P;do{const L=M+P>>>1;o(x[L],s)<=0?M=L+1:P=L}while(M<P)}return M}function _(x,s,M=0,P=x.length){const L=h(x,s,M,P-1);return L>M&&c(x[L-1],s)>-c(x[L],s)?L-1:L}return{left:h,center:_,right:m}}function PU(){return 0}function kU(r){return r===null?NaN:+r}const DU=fk(O_),LU=DU.right;fk(kU).center;const OU=Math.sqrt(50),RU=Math.sqrt(10),zU=Math.sqrt(2);function ry(r,i,o){const c=(i-r)/Math.max(0,o),h=Math.floor(Math.log10(c)),m=c/Math.pow(10,h),_=m>=OU?10:m>=RU?5:m>=zU?2:1;let x,s,M;return h<0?(M=Math.pow(10,-h)/_,x=Math.round(r*M),s=Math.round(i*M),x/M<r&&++x,s/M>i&&--s,M=-M):(M=Math.pow(10,h)*_,x=Math.round(r/M),s=Math.round(i/M),x*M<r&&++x,s*M>i&&--s),s<x&&.5<=o&&o<2?ry(r,i,o*2):[x,s,M]}function FU(r,i,o){if(i=+i,r=+r,o=+o,!(o>0))return[];if(r===i)return[r];const c=i<r,[h,m,_]=c?ry(i,r,o):ry(r,i,o);if(!(m>=h))return[];const x=m-h+1,s=new Array(x);if(c)if(_<0)for(let M=0;M<x;++M)s[M]=(m-M)/-_;else for(let M=0;M<x;++M)s[M]=(m-M)*_;else if(_<0)for(let M=0;M<x;++M)s[M]=(h+M)/-_;else for(let M=0;M<x;++M)s[M]=(h+M)*_;return s}function nb(r,i,o){return i=+i,r=+r,o=+o,ry(r,i,o)[2]}function BU(r,i,o){i=+i,r=+r,o=+o;const c=i<r,h=c?nb(i,r,o):nb(r,i,o);return(c?-1:1)*(h<0?1/-h:h)}function NU(r){return r}var px=1,mx=2,rb=3,u_=4,RI=1e-6;function VU(r){return"translate("+r+",0)"}function UU(r){return"translate(0,"+r+")"}function jU(r){return i=>+r(i)}function GU(r,i){return i=Math.max(0,r.bandwidth()-i*2)/2,r.round()&&(i=Math.round(i)),o=>+r(o)+i}function HU(){return!this.__axis}function qU(r,i){var o=[],c=null,h=null,m=6,_=6,x=3,s=typeof window<"u"&&window.devicePixelRatio>1?0:.5,M=r===px||r===u_?-1:1,P=r===u_||r===mx?"x":"y",L=r===px||r===rb?VU:UU;function F(V){var X=c??(i.ticks?i.ticks.apply(i,o):i.domain()),q=h??(i.tickFormat?i.tickFormat.apply(i,o):NU),Y=Math.max(m,0)+x,J=i.range(),ue=+J[0]+s,ce=+J[J.length-1]+s,fe=(i.bandwidth?GU:jU)(i.copy(),s),Ae=V.selection?V.selection():V,Ce=Ae.selectAll(".domain").data([null]),He=Ae.selectAll(".tick").data(X,i).order(),We=He.exit(),nt=He.enter().append("g").attr("class","tick"),we=He.select("line"),ht=He.select("text");Ce=Ce.merge(Ce.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),He=He.merge(nt),we=we.merge(nt.append("line").attr("stroke","currentColor").attr(P+"2",M*m)),ht=ht.merge(nt.append("text").attr("fill","currentColor").attr(P,M*Y).attr("dy",r===px?"0em":r===rb?"0.71em":"0.32em")),V!==Ae&&(Ce=Ce.transition(V),He=He.transition(V),we=we.transition(V),ht=ht.transition(V),We=We.transition(V).attr("opacity",RI).attr("transform",function(pt){return isFinite(pt=fe(pt))?L(pt+s):this.getAttribute("transform")}),nt.attr("opacity",RI).attr("transform",function(pt){var Xe=this.parentNode.__axis;return L((Xe&&isFinite(Xe=Xe(pt))?Xe:fe(pt))+s)})),We.remove(),Ce.attr("d",r===u_||r===mx?_?"M"+M*_+","+ue+"H"+s+"V"+ce+"H"+M*_:"M"+s+","+ue+"V"+ce:_?"M"+ue+","+M*_+"V"+s+"H"+ce+"V"+M*_:"M"+ue+","+s+"H"+ce),He.attr("opacity",1).attr("transform",function(pt){return L(fe(pt)+s)}),we.attr(P+"2",M*m),ht.attr(P,M*Y).text(q),Ae.filter(HU).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",r===mx?"start":r===u_?"end":"middle"),Ae.each(function(){this.__axis=fe})}return F.scale=function(V){return arguments.length?(i=V,F):i},F.ticks=function(){return o=Array.from(arguments),F},F.tickArguments=function(V){return arguments.length?(o=V==null?[]:Array.from(V),F):o.slice()},F.tickValues=function(V){return arguments.length?(c=V==null?null:Array.from(V),F):c&&c.slice()},F.tickFormat=function(V){return arguments.length?(h=V,F):h},F.tickSize=function(V){return arguments.length?(m=_=+V,F):m},F.tickSizeInner=function(V){return arguments.length?(m=+V,F):m},F.tickSizeOuter=function(V){return arguments.length?(_=+V,F):_},F.tickPadding=function(V){return arguments.length?(x=+V,F):x},F.offset=function(V){return arguments.length?(s=+V,F):s},F}function WU(r){return qU(rb,r)}var ZU={value:()=>{}};function pk(){for(var r=0,i=arguments.length,o={},c;r<i;++r){if(!(c=arguments[r]+"")||c in o||/[\s.]/.test(c))throw new Error("illegal type: "+c);o[c]=[]}return new R_(o)}function R_(r){this._=r}function XU(r,i){return r.trim().split(/^|\s+/).map(function(o){var c="",h=o.indexOf(".");if(h>=0&&(c=o.slice(h+1),o=o.slice(0,h)),o&&!i.hasOwnProperty(o))throw new Error("unknown type: "+o);return{type:o,name:c}})}R_.prototype=pk.prototype={constructor:R_,on:function(r,i){var o=this._,c=XU(r+"",o),h,m=-1,_=c.length;if(arguments.length<2){for(;++m<_;)if((h=(r=c[m]).type)&&(h=YU(o[h],r.name)))return h;return}if(i!=null&&typeof i!="function")throw new Error("invalid callback: "+i);for(;++m<_;)if(h=(r=c[m]).type)o[h]=zI(o[h],r.name,i);else if(i==null)for(h in o)o[h]=zI(o[h],r.name,null);return this},copy:function(){var r={},i=this._;for(var o in i)r[o]=i[o].slice();return new R_(r)},call:function(r,i){if((h=arguments.length-2)>0)for(var o=new Array(h),c=0,h,m;c<h;++c)o[c]=arguments[c+2];if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(m=this._[r],c=0,h=m.length;c<h;++c)m[c].value.apply(i,o)},apply:function(r,i,o){if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(var c=this._[r],h=0,m=c.length;h<m;++h)c[h].value.apply(i,o)}};function YU(r,i){for(var o=0,c=r.length,h;o<c;++o)if((h=r[o]).name===i)return h.value}function zI(r,i,o){for(var c=0,h=r.length;c<h;++c)if(r[c].name===i){r[c]=ZU,r=r.slice(0,c).concat(r.slice(c+1));break}return o!=null&&r.push({name:i,value:o}),r}var ob="http://www.w3.org/1999/xhtml";const FI={svg:"http://www.w3.org/2000/svg",xhtml:ob,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Py(r){var i=r+="",o=i.indexOf(":");return o>=0&&(i=r.slice(0,o))!=="xmlns"&&(r=r.slice(o+1)),FI.hasOwnProperty(i)?{space:FI[i],local:r}:r}function JU(r){return function(){var i=this.ownerDocument,o=this.namespaceURI;return o===ob&&i.documentElement.namespaceURI===ob?i.createElement(r):i.createElementNS(o,r)}}function KU(r){return function(){return this.ownerDocument.createElementNS(r.space,r.local)}}function mk(r){var i=Py(r);return(i.local?KU:JU)(i)}function $U(){}function Zb(r){return r==null?$U:function(){return this.querySelector(r)}}function QU(r){typeof r!="function"&&(r=Zb(r));for(var i=this._groups,o=i.length,c=new Array(o),h=0;h<o;++h)for(var m=i[h],_=m.length,x=c[h]=new Array(_),s,M,P=0;P<_;++P)(s=m[P])&&(M=r.call(s,s.__data__,P,m))&&("__data__"in s&&(M.__data__=s.__data__),x[P]=M);return new ta(c,this._parents)}function ej(r){return r==null?[]:Array.isArray(r)?r:Array.from(r)}function tj(){return[]}function gk(r){return r==null?tj:function(){return this.querySelectorAll(r)}}function ij(r){return function(){return ej(r.apply(this,arguments))}}function nj(r){typeof r=="function"?r=ij(r):r=gk(r);for(var i=this._groups,o=i.length,c=[],h=[],m=0;m<o;++m)for(var _=i[m],x=_.length,s,M=0;M<x;++M)(s=_[M])&&(c.push(r.call(s,s.__data__,M,_)),h.push(s));return new ta(c,h)}function _k(r){return function(){return this.matches(r)}}function yk(r){return function(i){return i.matches(r)}}var rj=Array.prototype.find;function oj(r){return function(){return rj.call(this.children,r)}}function sj(){return this.firstElementChild}function aj(r){return this.select(r==null?sj:oj(typeof r=="function"?r:yk(r)))}var lj=Array.prototype.filter;function cj(){return Array.from(this.children)}function uj(r){return function(){return lj.call(this.children,r)}}function hj(r){return this.selectAll(r==null?cj:uj(typeof r=="function"?r:yk(r)))}function dj(r){typeof r!="function"&&(r=_k(r));for(var i=this._groups,o=i.length,c=new Array(o),h=0;h<o;++h)for(var m=i[h],_=m.length,x=c[h]=[],s,M=0;M<_;++M)(s=m[M])&&r.call(s,s.__data__,M,m)&&x.push(s);return new ta(c,this._parents)}function vk(r){return new Array(r.length)}function fj(){return new ta(this._enter||this._groups.map(vk),this._parents)}function oy(r,i){this.ownerDocument=r.ownerDocument,this.namespaceURI=r.namespaceURI,this._next=null,this._parent=r,this.__data__=i}oy.prototype={constructor:oy,appendChild:function(r){return this._parent.insertBefore(r,this._next)},insertBefore:function(r,i){return this._parent.insertBefore(r,i)},querySelector:function(r){return this._parent.querySelector(r)},querySelectorAll:function(r){return this._parent.querySelectorAll(r)}};function pj(r){return function(){return r}}function mj(r,i,o,c,h,m){for(var _=0,x,s=i.length,M=m.length;_<M;++_)(x=i[_])?(x.__data__=m[_],c[_]=x):o[_]=new oy(r,m[_]);for(;_<s;++_)(x=i[_])&&(h[_]=x)}function gj(r,i,o,c,h,m,_){var x,s,M=new Map,P=i.length,L=m.length,F=new Array(P),V;for(x=0;x<P;++x)(s=i[x])&&(F[x]=V=_.call(s,s.__data__,x,i)+"",M.has(V)?h[x]=s:M.set(V,s));for(x=0;x<L;++x)V=_.call(r,m[x],x,m)+"",(s=M.get(V))?(c[x]=s,s.__data__=m[x],M.delete(V)):o[x]=new oy(r,m[x]);for(x=0;x<P;++x)(s=i[x])&&M.get(F[x])===s&&(h[x]=s)}function _j(r){return r.__data__}function yj(r,i){if(!arguments.length)return Array.from(this,_j);var o=i?gj:mj,c=this._parents,h=this._groups;typeof r!="function"&&(r=pj(r));for(var m=h.length,_=new Array(m),x=new Array(m),s=new Array(m),M=0;M<m;++M){var P=c[M],L=h[M],F=L.length,V=vj(r.call(P,P&&P.__data__,M,c)),X=V.length,q=x[M]=new Array(X),Y=_[M]=new Array(X),J=s[M]=new Array(F);o(P,L,q,Y,J,V,i);for(var ue=0,ce=0,fe,Ae;ue<X;++ue)if(fe=q[ue]){for(ue>=ce&&(ce=ue+1);!(Ae=Y[ce])&&++ce<X;);fe._next=Ae||null}}return _=new ta(_,c),_._enter=x,_._exit=s,_}function vj(r){return typeof r=="object"&&"length"in r?r:Array.from(r)}function xj(){return new ta(this._exit||this._groups.map(vk),this._parents)}function bj(r,i,o){var c=this.enter(),h=this,m=this.exit();return typeof r=="function"?(c=r(c),c&&(c=c.selection())):c=c.append(r+""),i!=null&&(h=i(h),h&&(h=h.selection())),o==null?m.remove():o(m),c&&h?c.merge(h).order():h}function wj(r){for(var i=r.selection?r.selection():r,o=this._groups,c=i._groups,h=o.length,m=c.length,_=Math.min(h,m),x=new Array(h),s=0;s<_;++s)for(var M=o[s],P=c[s],L=M.length,F=x[s]=new Array(L),V,X=0;X<L;++X)(V=M[X]||P[X])&&(F[X]=V);for(;s<h;++s)x[s]=o[s];return new ta(x,this._parents)}function Tj(){for(var r=this._groups,i=-1,o=r.length;++i<o;)for(var c=r[i],h=c.length-1,m=c[h],_;--h>=0;)(_=c[h])&&(m&&_.compareDocumentPosition(m)^4&&m.parentNode.insertBefore(_,m),m=_);return this}function Sj(r){r||(r=Mj);function i(L,F){return L&&F?r(L.__data__,F.__data__):!L-!F}for(var o=this._groups,c=o.length,h=new Array(c),m=0;m<c;++m){for(var _=o[m],x=_.length,s=h[m]=new Array(x),M,P=0;P<x;++P)(M=_[P])&&(s[P]=M);s.sort(i)}return new ta(h,this._parents).order()}function Mj(r,i){return r<i?-1:r>i?1:r>=i?0:NaN}function Ej(){var r=arguments[0];return arguments[0]=this,r.apply(null,arguments),this}function Aj(){return Array.from(this)}function Ij(){for(var r=this._groups,i=0,o=r.length;i<o;++i)for(var c=r[i],h=0,m=c.length;h<m;++h){var _=c[h];if(_)return _}return null}function Cj(){let r=0;for(const i of this)++r;return r}function Pj(){return!this.node()}function kj(r){for(var i=this._groups,o=0,c=i.length;o<c;++o)for(var h=i[o],m=0,_=h.length,x;m<_;++m)(x=h[m])&&r.call(x,x.__data__,m,h);return this}function Dj(r){return function(){this.removeAttribute(r)}}function Lj(r){return function(){this.removeAttributeNS(r.space,r.local)}}function Oj(r,i){return function(){this.setAttribute(r,i)}}function Rj(r,i){return function(){this.setAttributeNS(r.space,r.local,i)}}function zj(r,i){return function(){var o=i.apply(this,arguments);o==null?this.removeAttribute(r):this.setAttribute(r,o)}}function Fj(r,i){return function(){var o=i.apply(this,arguments);o==null?this.removeAttributeNS(r.space,r.local):this.setAttributeNS(r.space,r.local,o)}}function Bj(r,i){var o=Py(r);if(arguments.length<2){var c=this.node();return o.local?c.getAttributeNS(o.space,o.local):c.getAttribute(o)}return this.each((i==null?o.local?Lj:Dj:typeof i=="function"?o.local?Fj:zj:o.local?Rj:Oj)(o,i))}function xk(r){return r.ownerDocument&&r.ownerDocument.defaultView||r.document&&r||r.defaultView}function Nj(r){return function(){this.style.removeProperty(r)}}function Vj(r,i,o){return function(){this.style.setProperty(r,i,o)}}function Uj(r,i,o){return function(){var c=i.apply(this,arguments);c==null?this.style.removeProperty(r):this.style.setProperty(r,c,o)}}function jj(r,i,o){return arguments.length>1?this.each((i==null?Nj:typeof i=="function"?Uj:Vj)(r,i,o??"")):Kd(this.node(),r)}function Kd(r,i){return r.style.getPropertyValue(i)||xk(r).getComputedStyle(r,null).getPropertyValue(i)}function Gj(r){return function(){delete this[r]}}function Hj(r,i){return function(){this[r]=i}}function qj(r,i){return function(){var o=i.apply(this,arguments);o==null?delete this[r]:this[r]=o}}function Wj(r,i){return arguments.length>1?this.each((i==null?Gj:typeof i=="function"?qj:Hj)(r,i)):this.node()[r]}function bk(r){return r.trim().split(/^|\s+/)}function Xb(r){return r.classList||new wk(r)}function wk(r){this._node=r,this._names=bk(r.getAttribute("class")||"")}wk.prototype={add:function(r){var i=this._names.indexOf(r);i<0&&(this._names.push(r),this._node.setAttribute("class",this._names.join(" ")))},remove:function(r){var i=this._names.indexOf(r);i>=0&&(this._names.splice(i,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(r){return this._names.indexOf(r)>=0}};function Tk(r,i){for(var o=Xb(r),c=-1,h=i.length;++c<h;)o.add(i[c])}function Sk(r,i){for(var o=Xb(r),c=-1,h=i.length;++c<h;)o.remove(i[c])}function Zj(r){return function(){Tk(this,r)}}function Xj(r){return function(){Sk(this,r)}}function Yj(r,i){return function(){(i.apply(this,arguments)?Tk:Sk)(this,r)}}function Jj(r,i){var o=bk(r+"");if(arguments.length<2){for(var c=Xb(this.node()),h=-1,m=o.length;++h<m;)if(!c.contains(o[h]))return!1;return!0}return this.each((typeof i=="function"?Yj:i?Zj:Xj)(o,i))}function Kj(){this.textContent=""}function $j(r){return function(){this.textContent=r}}function Qj(r){return function(){var i=r.apply(this,arguments);this.textContent=i??""}}function e8(r){return arguments.length?this.each(r==null?Kj:(typeof r=="function"?Qj:$j)(r)):this.node().textContent}function t8(){this.innerHTML=""}function i8(r){return function(){this.innerHTML=r}}function n8(r){return function(){var i=r.apply(this,arguments);this.innerHTML=i??""}}function r8(r){return arguments.length?this.each(r==null?t8:(typeof r=="function"?n8:i8)(r)):this.node().innerHTML}function o8(){this.nextSibling&&this.parentNode.appendChild(this)}function s8(){return this.each(o8)}function a8(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function l8(){return this.each(a8)}function c8(r){var i=typeof r=="function"?r:mk(r);return this.select(function(){return this.appendChild(i.apply(this,arguments))})}function u8(){return null}function h8(r,i){var o=typeof r=="function"?r:mk(r),c=i==null?u8:typeof i=="function"?i:Zb(i);return this.select(function(){return this.insertBefore(o.apply(this,arguments),c.apply(this,arguments)||null)})}function d8(){var r=this.parentNode;r&&r.removeChild(this)}function f8(){return this.each(d8)}function p8(){var r=this.cloneNode(!1),i=this.parentNode;return i?i.insertBefore(r,this.nextSibling):r}function m8(){var r=this.cloneNode(!0),i=this.parentNode;return i?i.insertBefore(r,this.nextSibling):r}function g8(r){return this.select(r?m8:p8)}function _8(r){return arguments.length?this.property("__data__",r):this.node().__data__}function y8(r){return function(i){r.call(this,i,this.__data__)}}function v8(r){return r.trim().split(/^|\s+/).map(function(i){var o="",c=i.indexOf(".");return c>=0&&(o=i.slice(c+1),i=i.slice(0,c)),{type:i,name:o}})}function x8(r){return function(){var i=this.__on;if(i){for(var o=0,c=-1,h=i.length,m;o<h;++o)m=i[o],(!r.type||m.type===r.type)&&m.name===r.name?this.removeEventListener(m.type,m.listener,m.options):i[++c]=m;++c?i.length=c:delete this.__on}}}function b8(r,i,o){return function(){var c=this.__on,h,m=y8(i);if(c){for(var _=0,x=c.length;_<x;++_)if((h=c[_]).type===r.type&&h.name===r.name){this.removeEventListener(h.type,h.listener,h.options),this.addEventListener(h.type,h.listener=m,h.options=o),h.value=i;return}}this.addEventListener(r.type,m,o),h={type:r.type,name:r.name,value:i,listener:m,options:o},c?c.push(h):this.__on=[h]}}function w8(r,i,o){var c=v8(r+""),h,m=c.length,_;if(arguments.length<2){var x=this.node().__on;if(x){for(var s=0,M=x.length,P;s<M;++s)for(h=0,P=x[s];h<m;++h)if((_=c[h]).type===P.type&&_.name===P.name)return P.value}return}for(x=i?b8:x8,h=0;h<m;++h)this.each(x(c[h],i,o));return this}function Mk(r,i,o){var c=xk(r),h=c.CustomEvent;typeof h=="function"?h=new h(i,o):(h=c.document.createEvent("Event"),o?(h.initEvent(i,o.bubbles,o.cancelable),h.detail=o.detail):h.initEvent(i,!1,!1)),r.dispatchEvent(h)}function T8(r,i){return function(){return Mk(this,r,i)}}function S8(r,i){return function(){return Mk(this,r,i.apply(this,arguments))}}function M8(r,i){return this.each((typeof i=="function"?S8:T8)(r,i))}function*E8(){for(var r=this._groups,i=0,o=r.length;i<o;++i)for(var c=r[i],h=0,m=c.length,_;h<m;++h)(_=c[h])&&(yield _)}var Ek=[null];function ta(r,i){this._groups=r,this._parents=i}function fm(){return new ta([[document.documentElement]],Ek)}function A8(){return this}ta.prototype=fm.prototype={constructor:ta,select:QU,selectAll:nj,selectChild:aj,selectChildren:hj,filter:dj,data:yj,enter:fj,exit:xj,join:bj,merge:wj,selection:A8,order:Tj,sort:Sj,call:Ej,nodes:Aj,node:Ij,size:Cj,empty:Pj,each:kj,attr:Bj,style:jj,property:Wj,classed:Jj,text:e8,html:r8,raise:s8,lower:l8,append:c8,insert:h8,remove:f8,clone:g8,datum:_8,on:w8,dispatch:M8,[Symbol.iterator]:E8};function I8(r){return typeof r=="string"?new ta([[document.querySelector(r)]],[document.documentElement]):new ta([[r]],Ek)}function Yb(r,i,o){r.prototype=i.prototype=o,o.constructor=r}function Ak(r,i){var o=Object.create(r.prototype);for(var c in i)o[c]=i[c];return o}function pm(){}var nm=.7,sy=1/nm,Bd="\\s*([+-]?\\d+)\\s*",rm="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Il="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",C8=/^#([0-9a-f]{3,8})$/,P8=new RegExp(`^rgb\\(${Bd},${Bd},${Bd}\\)$`),k8=new RegExp(`^rgb\\(${Il},${Il},${Il}\\)$`),D8=new RegExp(`^rgba\\(${Bd},${Bd},${Bd},${rm}\\)$`),L8=new RegExp(`^rgba\\(${Il},${Il},${Il},${rm}\\)$`),O8=new RegExp(`^hsl\\(${rm},${Il},${Il}\\)$`),R8=new RegExp(`^hsla\\(${rm},${Il},${Il},${rm}\\)$`),BI={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Yb(pm,Bh,{copy(r){return Object.assign(new this.constructor,this,r)},displayable(){return this.rgb().displayable()},hex:NI,formatHex:NI,formatHex8:z8,formatHsl:F8,formatRgb:VI,toString:VI});function NI(){return this.rgb().formatHex()}function z8(){return this.rgb().formatHex8()}function F8(){return Ik(this).formatHsl()}function VI(){return this.rgb().formatRgb()}function Bh(r){var i,o;return r=(r+"").trim().toLowerCase(),(i=C8.exec(r))?(o=i[1].length,i=parseInt(i[1],16),o===6?UI(i):o===3?new Rs(i>>8&15|i>>4&240,i>>4&15|i&240,(i&15)<<4|i&15,1):o===8?h_(i>>24&255,i>>16&255,i>>8&255,(i&255)/255):o===4?h_(i>>12&15|i>>8&240,i>>8&15|i>>4&240,i>>4&15|i&240,((i&15)<<4|i&15)/255):null):(i=P8.exec(r))?new Rs(i[1],i[2],i[3],1):(i=k8.exec(r))?new Rs(i[1]*255/100,i[2]*255/100,i[3]*255/100,1):(i=D8.exec(r))?h_(i[1],i[2],i[3],i[4]):(i=L8.exec(r))?h_(i[1]*255/100,i[2]*255/100,i[3]*255/100,i[4]):(i=O8.exec(r))?HI(i[1],i[2]/100,i[3]/100,1):(i=R8.exec(r))?HI(i[1],i[2]/100,i[3]/100,i[4]):BI.hasOwnProperty(r)?UI(BI[r]):r==="transparent"?new Rs(NaN,NaN,NaN,0):null}function UI(r){return new Rs(r>>16&255,r>>8&255,r&255,1)}function h_(r,i,o,c){return c<=0&&(r=i=o=NaN),new Rs(r,i,o,c)}function B8(r){return r instanceof pm||(r=Bh(r)),r?(r=r.rgb(),new Rs(r.r,r.g,r.b,r.opacity)):new Rs}function sb(r,i,o,c){return arguments.length===1?B8(r):new Rs(r,i,o,c??1)}function Rs(r,i,o,c){this.r=+r,this.g=+i,this.b=+o,this.opacity=+c}Yb(Rs,sb,Ak(pm,{brighter(r){return r=r==null?sy:Math.pow(sy,r),new Rs(this.r*r,this.g*r,this.b*r,this.opacity)},darker(r){return r=r==null?nm:Math.pow(nm,r),new Rs(this.r*r,this.g*r,this.b*r,this.opacity)},rgb(){return this},clamp(){return new Rs(kh(this.r),kh(this.g),kh(this.b),ay(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:jI,formatHex:jI,formatHex8:N8,formatRgb:GI,toString:GI}));function jI(){return`#${Sh(this.r)}${Sh(this.g)}${Sh(this.b)}`}function N8(){return`#${Sh(this.r)}${Sh(this.g)}${Sh(this.b)}${Sh((isNaN(this.opacity)?1:this.opacity)*255)}`}function GI(){const r=ay(this.opacity);return`${r===1?"rgb(":"rgba("}${kh(this.r)}, ${kh(this.g)}, ${kh(this.b)}${r===1?")":`, ${r})`}`}function ay(r){return isNaN(r)?1:Math.max(0,Math.min(1,r))}function kh(r){return Math.max(0,Math.min(255,Math.round(r)||0))}function Sh(r){return r=kh(r),(r<16?"0":"")+r.toString(16)}function HI(r,i,o,c){return c<=0?r=i=o=NaN:o<=0||o>=1?r=i=NaN:i<=0&&(r=NaN),new Ha(r,i,o,c)}function Ik(r){if(r instanceof Ha)return new Ha(r.h,r.s,r.l,r.opacity);if(r instanceof pm||(r=Bh(r)),!r)return new Ha;if(r instanceof Ha)return r;r=r.rgb();var i=r.r/255,o=r.g/255,c=r.b/255,h=Math.min(i,o,c),m=Math.max(i,o,c),_=NaN,x=m-h,s=(m+h)/2;return x?(i===m?_=(o-c)/x+(o<c)*6:o===m?_=(c-i)/x+2:_=(i-o)/x+4,x/=s<.5?m+h:2-m-h,_*=60):x=s>0&&s<1?0:_,new Ha(_,x,s,r.opacity)}function V8(r,i,o,c){return arguments.length===1?Ik(r):new Ha(r,i,o,c??1)}function Ha(r,i,o,c){this.h=+r,this.s=+i,this.l=+o,this.opacity=+c}Yb(Ha,V8,Ak(pm,{brighter(r){return r=r==null?sy:Math.pow(sy,r),new Ha(this.h,this.s,this.l*r,this.opacity)},darker(r){return r=r==null?nm:Math.pow(nm,r),new Ha(this.h,this.s,this.l*r,this.opacity)},rgb(){var r=this.h%360+(this.h<0)*360,i=isNaN(r)||isNaN(this.s)?0:this.s,o=this.l,c=o+(o<.5?o:1-o)*i,h=2*o-c;return new Rs(gx(r>=240?r-240:r+120,h,c),gx(r,h,c),gx(r<120?r+240:r-120,h,c),this.opacity)},clamp(){return new Ha(qI(this.h),d_(this.s),d_(this.l),ay(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const r=ay(this.opacity);return`${r===1?"hsl(":"hsla("}${qI(this.h)}, ${d_(this.s)*100}%, ${d_(this.l)*100}%${r===1?")":`, ${r})`}`}}));function qI(r){return r=(r||0)%360,r<0?r+360:r}function d_(r){return Math.max(0,Math.min(1,r||0))}function gx(r,i,o){return(r<60?i+(o-i)*r/60:r<180?o:r<240?i+(o-i)*(240-r)/60:i)*255}const Jb=r=>()=>r;function U8(r,i){return function(o){return r+o*i}}function j8(r,i,o){return r=Math.pow(r,o),i=Math.pow(i,o)-r,o=1/o,function(c){return Math.pow(r+c*i,o)}}function G8(r){return(r=+r)==1?Ck:function(i,o){return o-i?j8(i,o,r):Jb(isNaN(i)?o:i)}}function Ck(r,i){var o=i-r;return o?U8(r,o):Jb(isNaN(r)?i:r)}const ly=function r(i){var o=G8(i);function c(h,m){var _=o((h=sb(h)).r,(m=sb(m)).r),x=o(h.g,m.g),s=o(h.b,m.b),M=Ck(h.opacity,m.opacity);return function(P){return h.r=_(P),h.g=x(P),h.b=s(P),h.opacity=M(P),h+""}}return c.gamma=r,c}(1);function H8(r,i){i||(i=[]);var o=r?Math.min(i.length,r.length):0,c=i.slice(),h;return function(m){for(h=0;h<o;++h)c[h]=r[h]*(1-m)+i[h]*m;return c}}function q8(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function W8(r,i){var o=i?i.length:0,c=r?Math.min(o,r.length):0,h=new Array(c),m=new Array(o),_;for(_=0;_<c;++_)h[_]=Kb(r[_],i[_]);for(;_<o;++_)m[_]=i[_];return function(x){for(_=0;_<c;++_)m[_]=h[_](x);return m}}function Z8(r,i){var o=new Date;return r=+r,i=+i,function(c){return o.setTime(r*(1-c)+i*c),o}}function Ga(r,i){return r=+r,i=+i,function(o){return r*(1-o)+i*o}}function X8(r,i){var o={},c={},h;(r===null||typeof r!="object")&&(r={}),(i===null||typeof i!="object")&&(i={});for(h in i)h in r?o[h]=Kb(r[h],i[h]):c[h]=i[h];return function(m){for(h in o)c[h]=o[h](m);return c}}var ab=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,_x=new RegExp(ab.source,"g");function Y8(r){return function(){return r}}function J8(r){return function(i){return r(i)+""}}function Pk(r,i){var o=ab.lastIndex=_x.lastIndex=0,c,h,m,_=-1,x=[],s=[];for(r=r+"",i=i+"";(c=ab.exec(r))&&(h=_x.exec(i));)(m=h.index)>o&&(m=i.slice(o,m),x[_]?x[_]+=m:x[++_]=m),(c=c[0])===(h=h[0])?x[_]?x[_]+=h:x[++_]=h:(x[++_]=null,s.push({i:_,x:Ga(c,h)})),o=_x.lastIndex;return o<i.length&&(m=i.slice(o),x[_]?x[_]+=m:x[++_]=m),x.length<2?s[0]?J8(s[0].x):Y8(i):(i=s.length,function(M){for(var P=0,L;P<i;++P)x[(L=s[P]).i]=L.x(M);return x.join("")})}function Kb(r,i){var o=typeof i,c;return i==null||o==="boolean"?Jb(i):(o==="number"?Ga:o==="string"?(c=Bh(i))?(i=c,ly):Pk:i instanceof Bh?ly:i instanceof Date?Z8:q8(i)?H8:Array.isArray(i)?W8:typeof i.valueOf!="function"&&typeof i.toString!="function"||isNaN(i)?X8:Ga)(r,i)}function K8(r,i){return r=+r,i=+i,function(o){return Math.round(r*(1-o)+i*o)}}var WI=180/Math.PI,lb={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function kk(r,i,o,c,h,m){var _,x,s;return(_=Math.sqrt(r*r+i*i))&&(r/=_,i/=_),(s=r*o+i*c)&&(o-=r*s,c-=i*s),(x=Math.sqrt(o*o+c*c))&&(o/=x,c/=x,s/=x),r*c<i*o&&(r=-r,i=-i,s=-s,_=-_),{translateX:h,translateY:m,rotate:Math.atan2(i,r)*WI,skewX:Math.atan(s)*WI,scaleX:_,scaleY:x}}var f_;function $8(r){const i=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(r+"");return i.isIdentity?lb:kk(i.a,i.b,i.c,i.d,i.e,i.f)}function Q8(r){return r==null||(f_||(f_=document.createElementNS("http://www.w3.org/2000/svg","g")),f_.setAttribute("transform",r),!(r=f_.transform.baseVal.consolidate()))?lb:(r=r.matrix,kk(r.a,r.b,r.c,r.d,r.e,r.f))}function Dk(r,i,o,c){function h(M){return M.length?M.pop()+" ":""}function m(M,P,L,F,V,X){if(M!==L||P!==F){var q=V.push("translate(",null,i,null,o);X.push({i:q-4,x:Ga(M,L)},{i:q-2,x:Ga(P,F)})}else(L||F)&&V.push("translate("+L+i+F+o)}function _(M,P,L,F){M!==P?(M-P>180?P+=360:P-M>180&&(M+=360),F.push({i:L.push(h(L)+"rotate(",null,c)-2,x:Ga(M,P)})):P&&L.push(h(L)+"rotate("+P+c)}function x(M,P,L,F){M!==P?F.push({i:L.push(h(L)+"skewX(",null,c)-2,x:Ga(M,P)}):P&&L.push(h(L)+"skewX("+P+c)}function s(M,P,L,F,V,X){if(M!==L||P!==F){var q=V.push(h(V)+"scale(",null,",",null,")");X.push({i:q-4,x:Ga(M,L)},{i:q-2,x:Ga(P,F)})}else(L!==1||F!==1)&&V.push(h(V)+"scale("+L+","+F+")")}return function(M,P){var L=[],F=[];return M=r(M),P=r(P),m(M.translateX,M.translateY,P.translateX,P.translateY,L,F),_(M.rotate,P.rotate,L,F),x(M.skewX,P.skewX,L,F),s(M.scaleX,M.scaleY,P.scaleX,P.scaleY,L,F),M=P=null,function(V){for(var X=-1,q=F.length,Y;++X<q;)L[(Y=F[X]).i]=Y.x(V);return L.join("")}}}var eG=Dk($8,"px, ","px)","deg)"),tG=Dk(Q8,", ",")",")"),$d=0,Lp=0,wp=0,Lk=1e3,cy,Op,uy=0,Nh=0,ky=0,om=typeof performance=="object"&&performance.now?performance:Date,Ok=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(r){setTimeout(r,17)};function $b(){return Nh||(Ok(iG),Nh=om.now()+ky)}function iG(){Nh=0}function hy(){this._call=this._time=this._next=null}hy.prototype=Rk.prototype={constructor:hy,restart:function(r,i,o){if(typeof r!="function")throw new TypeError("callback is not a function");o=(o==null?$b():+o)+(i==null?0:+i),!this._next&&Op!==this&&(Op?Op._next=this:cy=this,Op=this),this._call=r,this._time=o,cb()},stop:function(){this._call&&(this._call=null,this._time=1/0,cb())}};function Rk(r,i,o){var c=new hy;return c.restart(r,i,o),c}function nG(){$b(),++$d;for(var r=cy,i;r;)(i=Nh-r._time)>=0&&r._call.call(void 0,i),r=r._next;--$d}function ZI(){Nh=(uy=om.now())+ky,$d=Lp=0;try{nG()}finally{$d=0,oG(),Nh=0}}function rG(){var r=om.now(),i=r-uy;i>Lk&&(ky-=i,uy=r)}function oG(){for(var r,i=cy,o,c=1/0;i;)i._call?(c>i._time&&(c=i._time),r=i,i=i._next):(o=i._next,i._next=null,i=r?r._next=o:cy=o);Op=r,cb(c)}function cb(r){if(!$d){Lp&&(Lp=clearTimeout(Lp));var i=r-Nh;i>24?(r<1/0&&(Lp=setTimeout(ZI,r-om.now()-ky)),wp&&(wp=clearInterval(wp))):(wp||(uy=om.now(),wp=setInterval(rG,Lk)),$d=1,Ok(ZI))}}function XI(r,i,o){var c=new hy;return i=i==null?0:+i,c.restart(h=>{c.stop(),r(h+i)},i,o),c}var sG=pk("start","end","cancel","interrupt"),aG=[],zk=0,YI=1,ub=2,z_=3,JI=4,hb=5,F_=6;function Dy(r,i,o,c,h,m){var _=r.__transition;if(!_)r.__transition={};else if(o in _)return;lG(r,o,{name:i,index:c,group:h,on:sG,tween:aG,time:m.time,delay:m.delay,duration:m.duration,ease:m.ease,timer:null,state:zk})}function Qb(r,i){var o=Ja(r,i);if(o.state>zk)throw new Error("too late; already scheduled");return o}function kl(r,i){var o=Ja(r,i);if(o.state>z_)throw new Error("too late; already running");return o}function Ja(r,i){var o=r.__transition;if(!o||!(o=o[i]))throw new Error("transition not found");return o}function lG(r,i,o){var c=r.__transition,h;c[i]=o,o.timer=Rk(m,0,o.time);function m(M){o.state=YI,o.timer.restart(_,o.delay,o.time),o.delay<=M&&_(M-o.delay)}function _(M){var P,L,F,V;if(o.state!==YI)return s();for(P in c)if(V=c[P],V.name===o.name){if(V.state===z_)return XI(_);V.state===JI?(V.state=F_,V.timer.stop(),V.on.call("interrupt",r,r.__data__,V.index,V.group),delete c[P]):+P<i&&(V.state=F_,V.timer.stop(),V.on.call("cancel",r,r.__data__,V.index,V.group),delete c[P])}if(XI(function(){o.state===z_&&(o.state=JI,o.timer.restart(x,o.delay,o.time),x(M))}),o.state=ub,o.on.call("start",r,r.__data__,o.index,o.group),o.state===ub){for(o.state=z_,h=new Array(F=o.tween.length),P=0,L=-1;P<F;++P)(V=o.tween[P].value.call(r,r.__data__,o.index,o.group))&&(h[++L]=V);h.length=L+1}}function x(M){for(var P=M<o.duration?o.ease.call(null,M/o.duration):(o.timer.restart(s),o.state=hb,1),L=-1,F=h.length;++L<F;)h[L].call(r,P);o.state===hb&&(o.on.call("end",r,r.__data__,o.index,o.group),s())}function s(){o.state=F_,o.timer.stop(),delete c[i];for(var M in c)return;delete r.__transition}}function cG(r,i){var o=r.__transition,c,h,m=!0,_;if(o){i=i==null?null:i+"";for(_ in o){if((c=o[_]).name!==i){m=!1;continue}h=c.state>ub&&c.state<hb,c.state=F_,c.timer.stop(),c.on.call(h?"interrupt":"cancel",r,r.__data__,c.index,c.group),delete o[_]}m&&delete r.__transition}}function uG(r){return this.each(function(){cG(this,r)})}function hG(r,i){var o,c;return function(){var h=kl(this,r),m=h.tween;if(m!==o){c=o=m;for(var _=0,x=c.length;_<x;++_)if(c[_].name===i){c=c.slice(),c.splice(_,1);break}}h.tween=c}}function dG(r,i,o){var c,h;if(typeof o!="function")throw new Error;return function(){var m=kl(this,r),_=m.tween;if(_!==c){h=(c=_).slice();for(var x={name:i,value:o},s=0,M=h.length;s<M;++s)if(h[s].name===i){h[s]=x;break}s===M&&h.push(x)}m.tween=h}}function fG(r,i){var o=this._id;if(r+="",arguments.length<2){for(var c=Ja(this.node(),o).tween,h=0,m=c.length,_;h<m;++h)if((_=c[h]).name===r)return _.value;return null}return this.each((i==null?hG:dG)(o,r,i))}function e1(r,i,o){var c=r._id;return r.each(function(){var h=kl(this,c);(h.value||(h.value={}))[i]=o.apply(this,arguments)}),function(h){return Ja(h,c).value[i]}}function Fk(r,i){var o;return(typeof i=="number"?Ga:i instanceof Bh?ly:(o=Bh(i))?(i=o,ly):Pk)(r,i)}function pG(r){return function(){this.removeAttribute(r)}}function mG(r){return function(){this.removeAttributeNS(r.space,r.local)}}function gG(r,i,o){var c,h=o+"",m;return function(){var _=this.getAttribute(r);return _===h?null:_===c?m:m=i(c=_,o)}}function _G(r,i,o){var c,h=o+"",m;return function(){var _=this.getAttributeNS(r.space,r.local);return _===h?null:_===c?m:m=i(c=_,o)}}function yG(r,i,o){var c,h,m;return function(){var _,x=o(this),s;return x==null?void this.removeAttribute(r):(_=this.getAttribute(r),s=x+"",_===s?null:_===c&&s===h?m:(h=s,m=i(c=_,x)))}}function vG(r,i,o){var c,h,m;return function(){var _,x=o(this),s;return x==null?void this.removeAttributeNS(r.space,r.local):(_=this.getAttributeNS(r.space,r.local),s=x+"",_===s?null:_===c&&s===h?m:(h=s,m=i(c=_,x)))}}function xG(r,i){var o=Py(r),c=o==="transform"?tG:Fk;return this.attrTween(r,typeof i=="function"?(o.local?vG:yG)(o,c,e1(this,"attr."+r,i)):i==null?(o.local?mG:pG)(o):(o.local?_G:gG)(o,c,i))}function bG(r,i){return function(o){this.setAttribute(r,i.call(this,o))}}function wG(r,i){return function(o){this.setAttributeNS(r.space,r.local,i.call(this,o))}}function TG(r,i){var o,c;function h(){var m=i.apply(this,arguments);return m!==c&&(o=(c=m)&&wG(r,m)),o}return h._value=i,h}function SG(r,i){var o,c;function h(){var m=i.apply(this,arguments);return m!==c&&(o=(c=m)&&bG(r,m)),o}return h._value=i,h}function MG(r,i){var o="attr."+r;if(arguments.length<2)return(o=this.tween(o))&&o._value;if(i==null)return this.tween(o,null);if(typeof i!="function")throw new Error;var c=Py(r);return this.tween(o,(c.local?TG:SG)(c,i))}function EG(r,i){return function(){Qb(this,r).delay=+i.apply(this,arguments)}}function AG(r,i){return i=+i,function(){Qb(this,r).delay=i}}function IG(r){var i=this._id;return arguments.length?this.each((typeof r=="function"?EG:AG)(i,r)):Ja(this.node(),i).delay}function CG(r,i){return function(){kl(this,r).duration=+i.apply(this,arguments)}}function PG(r,i){return i=+i,function(){kl(this,r).duration=i}}function kG(r){var i=this._id;return arguments.length?this.each((typeof r=="function"?CG:PG)(i,r)):Ja(this.node(),i).duration}function DG(r,i){if(typeof i!="function")throw new Error;return function(){kl(this,r).ease=i}}function LG(r){var i=this._id;return arguments.length?this.each(DG(i,r)):Ja(this.node(),i).ease}function OG(r,i){return function(){var o=i.apply(this,arguments);if(typeof o!="function")throw new Error;kl(this,r).ease=o}}function RG(r){if(typeof r!="function")throw new Error;return this.each(OG(this._id,r))}function zG(r){typeof r!="function"&&(r=_k(r));for(var i=this._groups,o=i.length,c=new Array(o),h=0;h<o;++h)for(var m=i[h],_=m.length,x=c[h]=[],s,M=0;M<_;++M)(s=m[M])&&r.call(s,s.__data__,M,m)&&x.push(s);return new Mc(c,this._parents,this._name,this._id)}function FG(r){if(r._id!==this._id)throw new Error;for(var i=this._groups,o=r._groups,c=i.length,h=o.length,m=Math.min(c,h),_=new Array(c),x=0;x<m;++x)for(var s=i[x],M=o[x],P=s.length,L=_[x]=new Array(P),F,V=0;V<P;++V)(F=s[V]||M[V])&&(L[V]=F);for(;x<c;++x)_[x]=i[x];return new Mc(_,this._parents,this._name,this._id)}function BG(r){return(r+"").trim().split(/^|\s+/).every(function(i){var o=i.indexOf(".");return o>=0&&(i=i.slice(0,o)),!i||i==="start"})}function NG(r,i,o){var c,h,m=BG(i)?Qb:kl;return function(){var _=m(this,r),x=_.on;x!==c&&(h=(c=x).copy()).on(i,o),_.on=h}}function VG(r,i){var o=this._id;return arguments.length<2?Ja(this.node(),o).on.on(r):this.each(NG(o,r,i))}function UG(r){return function(){var i=this.parentNode;for(var o in this.__transition)if(+o!==r)return;i&&i.removeChild(this)}}function jG(){return this.on("end.remove",UG(this._id))}function GG(r){var i=this._name,o=this._id;typeof r!="function"&&(r=Zb(r));for(var c=this._groups,h=c.length,m=new Array(h),_=0;_<h;++_)for(var x=c[_],s=x.length,M=m[_]=new Array(s),P,L,F=0;F<s;++F)(P=x[F])&&(L=r.call(P,P.__data__,F,x))&&("__data__"in P&&(L.__data__=P.__data__),M[F]=L,Dy(M[F],i,o,F,M,Ja(P,o)));return new Mc(m,this._parents,i,o)}function HG(r){var i=this._name,o=this._id;typeof r!="function"&&(r=gk(r));for(var c=this._groups,h=c.length,m=[],_=[],x=0;x<h;++x)for(var s=c[x],M=s.length,P,L=0;L<M;++L)if(P=s[L]){for(var F=r.call(P,P.__data__,L,s),V,X=Ja(P,o),q=0,Y=F.length;q<Y;++q)(V=F[q])&&Dy(V,i,o,q,F,X);m.push(F),_.push(P)}return new Mc(m,_,i,o)}var qG=fm.prototype.constructor;function WG(){return new qG(this._groups,this._parents)}function ZG(r,i){var o,c,h;return function(){var m=Kd(this,r),_=(this.style.removeProperty(r),Kd(this,r));return m===_?null:m===o&&_===c?h:h=i(o=m,c=_)}}function Bk(r){return function(){this.style.removeProperty(r)}}function XG(r,i,o){var c,h=o+"",m;return function(){var _=Kd(this,r);return _===h?null:_===c?m:m=i(c=_,o)}}function YG(r,i,o){var c,h,m;return function(){var _=Kd(this,r),x=o(this),s=x+"";return x==null&&(s=x=(this.style.removeProperty(r),Kd(this,r))),_===s?null:_===c&&s===h?m:(h=s,m=i(c=_,x))}}function JG(r,i){var o,c,h,m="style."+i,_="end."+m,x;return function(){var s=kl(this,r),M=s.on,P=s.value[m]==null?x||(x=Bk(i)):void 0;(M!==o||h!==P)&&(c=(o=M).copy()).on(_,h=P),s.on=c}}function KG(r,i,o){var c=(r+="")=="transform"?eG:Fk;return i==null?this.styleTween(r,ZG(r,c)).on("end.style."+r,Bk(r)):typeof i=="function"?this.styleTween(r,YG(r,c,e1(this,"style."+r,i))).each(JG(this._id,r)):this.styleTween(r,XG(r,c,i),o).on("end.style."+r,null)}function $G(r,i,o){return function(c){this.style.setProperty(r,i.call(this,c),o)}}function QG(r,i,o){var c,h;function m(){var _=i.apply(this,arguments);return _!==h&&(c=(h=_)&&$G(r,_,o)),c}return m._value=i,m}function e7(r,i,o){var c="style."+(r+="");if(arguments.length<2)return(c=this.tween(c))&&c._value;if(i==null)return this.tween(c,null);if(typeof i!="function")throw new Error;return this.tween(c,QG(r,i,o??""))}function t7(r){return function(){this.textContent=r}}function i7(r){return function(){var i=r(this);this.textContent=i??""}}function n7(r){return this.tween("text",typeof r=="function"?i7(e1(this,"text",r)):t7(r==null?"":r+""))}function r7(r){return function(i){this.textContent=r.call(this,i)}}function o7(r){var i,o;function c(){var h=r.apply(this,arguments);return h!==o&&(i=(o=h)&&r7(h)),i}return c._value=r,c}function s7(r){var i="text";if(arguments.length<1)return(i=this.tween(i))&&i._value;if(r==null)return this.tween(i,null);if(typeof r!="function")throw new Error;return this.tween(i,o7(r))}function a7(){for(var r=this._name,i=this._id,o=Nk(),c=this._groups,h=c.length,m=0;m<h;++m)for(var _=c[m],x=_.length,s,M=0;M<x;++M)if(s=_[M]){var P=Ja(s,i);Dy(s,r,o,M,_,{time:P.time+P.delay+P.duration,delay:0,duration:P.duration,ease:P.ease})}return new Mc(c,this._parents,r,o)}function l7(){var r,i,o=this,c=o._id,h=o.size();return new Promise(function(m,_){var x={value:_},s={value:function(){--h===0&&m()}};o.each(function(){var M=kl(this,c),P=M.on;P!==r&&(i=(r=P).copy(),i._.cancel.push(x),i._.interrupt.push(x),i._.end.push(s)),M.on=i}),h===0&&m()})}var c7=0;function Mc(r,i,o,c){this._groups=r,this._parents=i,this._name=o,this._id=c}function Nk(){return++c7}var fc=fm.prototype;Mc.prototype={constructor:Mc,select:GG,selectAll:HG,selectChild:fc.selectChild,selectChildren:fc.selectChildren,filter:zG,merge:FG,selection:WG,transition:a7,call:fc.call,nodes:fc.nodes,node:fc.node,size:fc.size,empty:fc.empty,each:fc.each,on:VG,attr:xG,attrTween:MG,style:KG,styleTween:e7,text:n7,textTween:s7,remove:jG,tween:fG,delay:IG,duration:kG,ease:LG,easeVarying:RG,end:l7,[Symbol.iterator]:fc[Symbol.iterator]};function u7(r){return((r*=2)<=1?r*r*r:(r-=2)*r*r+2)/2}var h7={time:null,delay:0,duration:250,ease:u7};function d7(r,i){for(var o;!(o=r.__transition)||!(o=o[i]);)if(!(r=r.parentNode))throw new Error(`transition ${i} not found`);return o}function f7(r){var i,o;r instanceof Mc?(i=r._id,r=r._name):(i=Nk(),(o=h7).time=$b(),r=r==null?null:r+"");for(var c=this._groups,h=c.length,m=0;m<h;++m)for(var _=c[m],x=_.length,s,M=0;M<x;++M)(s=_[M])&&Dy(s,r,i,M,_,o||d7(s,i));return new Mc(c,this._parents,r,i)}fm.prototype.interrupt=uG;fm.prototype.transition=f7;function p7(r){return Math.abs(r=Math.round(r))>=1e21?r.toLocaleString("en").replace(/,/g,""):r.toString(10)}function dy(r,i){if((o=(r=i?r.toExponential(i-1):r.toExponential()).indexOf("e"))<0)return null;var o,c=r.slice(0,o);return[c.length>1?c[0]+c.slice(2):c,+r.slice(o+1)]}function Qd(r){return r=dy(Math.abs(r)),r?r[1]:NaN}function m7(r,i){return function(o,c){for(var h=o.length,m=[],_=0,x=r[0],s=0;h>0&&x>0&&(s+x+1>c&&(x=Math.max(1,c-s)),m.push(o.substring(h-=x,h+x)),!((s+=x+1)>c));)x=r[_=(_+1)%r.length];return m.reverse().join(i)}}function g7(r){return function(i){return i.replace(/[0-9]/g,function(o){return r[+o]})}}var _7=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function fy(r){if(!(i=_7.exec(r)))throw new Error("invalid format: "+r);var i;return new t1({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}fy.prototype=t1.prototype;function t1(r){this.fill=r.fill===void 0?" ":r.fill+"",this.align=r.align===void 0?">":r.align+"",this.sign=r.sign===void 0?"-":r.sign+"",this.symbol=r.symbol===void 0?"":r.symbol+"",this.zero=!!r.zero,this.width=r.width===void 0?void 0:+r.width,this.comma=!!r.comma,this.precision=r.precision===void 0?void 0:+r.precision,this.trim=!!r.trim,this.type=r.type===void 0?"":r.type+""}t1.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function y7(r){e:for(var i=r.length,o=1,c=-1,h;o<i;++o)switch(r[o]){case".":c=h=o;break;case"0":c===0&&(c=o),h=o;break;default:if(!+r[o])break e;c>0&&(c=0);break}return c>0?r.slice(0,c)+r.slice(h+1):r}var Vk;function v7(r,i){var o=dy(r,i);if(!o)return r+"";var c=o[0],h=o[1],m=h-(Vk=Math.max(-8,Math.min(8,Math.floor(h/3)))*3)+1,_=c.length;return m===_?c:m>_?c+new Array(m-_+1).join("0"):m>0?c.slice(0,m)+"."+c.slice(m):"0."+new Array(1-m).join("0")+dy(r,Math.max(0,i+m-1))[0]}function KI(r,i){var o=dy(r,i);if(!o)return r+"";var c=o[0],h=o[1];return h<0?"0."+new Array(-h).join("0")+c:c.length>h+1?c.slice(0,h+1)+"."+c.slice(h+1):c+new Array(h-c.length+2).join("0")}const $I={"%":(r,i)=>(r*100).toFixed(i),b:r=>Math.round(r).toString(2),c:r=>r+"",d:p7,e:(r,i)=>r.toExponential(i),f:(r,i)=>r.toFixed(i),g:(r,i)=>r.toPrecision(i),o:r=>Math.round(r).toString(8),p:(r,i)=>KI(r*100,i),r:KI,s:v7,X:r=>Math.round(r).toString(16).toUpperCase(),x:r=>Math.round(r).toString(16)};function QI(r){return r}var eC=Array.prototype.map,tC=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function x7(r){var i=r.grouping===void 0||r.thousands===void 0?QI:m7(eC.call(r.grouping,Number),r.thousands+""),o=r.currency===void 0?"":r.currency[0]+"",c=r.currency===void 0?"":r.currency[1]+"",h=r.decimal===void 0?".":r.decimal+"",m=r.numerals===void 0?QI:g7(eC.call(r.numerals,String)),_=r.percent===void 0?"%":r.percent+"",x=r.minus===void 0?"":r.minus+"",s=r.nan===void 0?"NaN":r.nan+"";function M(L){L=fy(L);var F=L.fill,V=L.align,X=L.sign,q=L.symbol,Y=L.zero,J=L.width,ue=L.comma,ce=L.precision,fe=L.trim,Ae=L.type;Ae==="n"?(ue=!0,Ae="g"):$I[Ae]||(ce===void 0&&(ce=12),fe=!0,Ae="g"),(Y||F==="0"&&V==="=")&&(Y=!0,F="0",V="=");var Ce=q==="$"?o:q==="#"&&/[boxX]/.test(Ae)?"0"+Ae.toLowerCase():"",He=q==="$"?c:/[%p]/.test(Ae)?_:"",We=$I[Ae],nt=/[defgprs%]/.test(Ae);ce=ce===void 0?6:/[gprs]/.test(Ae)?Math.max(1,Math.min(21,ce)):Math.max(0,Math.min(20,ce));function we(ht){var pt=Ce,Xe=He,mt,Ft,tt;if(Ae==="c")Xe=We(ht)+Xe,ht="";else{ht=+ht;var ei=ht<0||1/ht<0;if(ht=isNaN(ht)?s:We(Math.abs(ht),ce),fe&&(ht=y7(ht)),ei&&+ht==0&&X!=="+"&&(ei=!1),pt=(ei?X==="("?X:x:X==="-"||X==="("?"":X)+pt,Xe=(Ae==="s"?tC[8+Vk/3]:"")+Xe+(ei&&X==="("?")":""),nt){for(mt=-1,Ft=ht.length;++mt<Ft;)if(tt=ht.charCodeAt(mt),48>tt||tt>57){Xe=(tt===46?h+ht.slice(mt+1):ht.slice(mt))+Xe,ht=ht.slice(0,mt);break}}}ue&&!Y&&(ht=i(ht,1/0));var ki=pt.length+ht.length+Xe.length,rt=ki<J?new Array(J-ki+1).join(F):"";switch(ue&&Y&&(ht=i(rt+ht,rt.length?J-Xe.length:1/0),rt=""),V){case"<":ht=pt+ht+Xe+rt;break;case"=":ht=pt+rt+ht+Xe;break;case"^":ht=rt.slice(0,ki=rt.length>>1)+pt+ht+Xe+rt.slice(ki);break;default:ht=rt+pt+ht+Xe;break}return m(ht)}return we.toString=function(){return L+""},we}function P(L,F){var V=M((L=fy(L),L.type="f",L)),X=Math.max(-8,Math.min(8,Math.floor(Qd(F)/3)))*3,q=Math.pow(10,-X),Y=tC[8+X/3];return function(J){return V(q*J)+Y}}return{format:M,formatPrefix:P}}var p_,Uk,jk;b7({thousands:",",grouping:[3],currency:["$",""]});function b7(r){return p_=x7(r),Uk=p_.format,jk=p_.formatPrefix,p_}function w7(r){return Math.max(0,-Qd(Math.abs(r)))}function T7(r,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Qd(i)/3)))*3-Qd(Math.abs(r)))}function S7(r,i){return r=Math.abs(r),i=Math.abs(i)-r,Math.max(0,Qd(i)-Qd(r))+1}function M7(r,i){switch(arguments.length){case 0:break;case 1:this.range(r);break;default:this.range(i).domain(r);break}return this}function E7(r){return function(){return r}}function A7(r){return+r}var iC=[0,1];function Rd(r){return r}function db(r,i){return(i-=r=+r)?function(o){return(o-r)/i}:E7(isNaN(i)?NaN:.5)}function I7(r,i){var o;return r>i&&(o=r,r=i,i=o),function(c){return Math.max(r,Math.min(i,c))}}function C7(r,i,o){var c=r[0],h=r[1],m=i[0],_=i[1];return h<c?(c=db(h,c),m=o(_,m)):(c=db(c,h),m=o(m,_)),function(x){return m(c(x))}}function P7(r,i,o){var c=Math.min(r.length,i.length)-1,h=new Array(c),m=new Array(c),_=-1;for(r[c]<r[0]&&(r=r.slice().reverse(),i=i.slice().reverse());++_<c;)h[_]=db(r[_],r[_+1]),m[_]=o(i[_],i[_+1]);return function(x){var s=LU(r,x,1,c)-1;return m[s](h[s](x))}}function k7(r,i){return i.domain(r.domain()).range(r.range()).interpolate(r.interpolate()).clamp(r.clamp()).unknown(r.unknown())}function D7(){var r=iC,i=iC,o=Kb,c,h,m,_=Rd,x,s,M;function P(){var F=Math.min(r.length,i.length);return _!==Rd&&(_=I7(r[0],r[F-1])),x=F>2?P7:C7,s=M=null,L}function L(F){return F==null||isNaN(F=+F)?m:(s||(s=x(r.map(c),i,o)))(c(_(F)))}return L.invert=function(F){return _(h((M||(M=x(i,r.map(c),Ga)))(F)))},L.domain=function(F){return arguments.length?(r=Array.from(F,A7),P()):r.slice()},L.range=function(F){return arguments.length?(i=Array.from(F),P()):i.slice()},L.rangeRound=function(F){return i=Array.from(F),o=K8,P()},L.clamp=function(F){return arguments.length?(_=F?!0:Rd,P()):_!==Rd},L.interpolate=function(F){return arguments.length?(o=F,P()):o},L.unknown=function(F){return arguments.length?(m=F,L):m},function(F,V){return c=F,h=V,P()}}function L7(){return D7()(Rd,Rd)}function O7(r,i,o,c){var h=BU(r,i,o),m;switch(c=fy(c??",f"),c.type){case"s":{var _=Math.max(Math.abs(r),Math.abs(i));return c.precision==null&&!isNaN(m=T7(h,_))&&(c.precision=m),jk(c,_)}case"":case"e":case"g":case"p":case"r":{c.precision==null&&!isNaN(m=S7(h,Math.max(Math.abs(r),Math.abs(i))))&&(c.precision=m-(c.type==="e"));break}case"f":case"%":{c.precision==null&&!isNaN(m=w7(h))&&(c.precision=m-(c.type==="%")*2);break}}return Uk(c)}function R7(r){var i=r.domain;return r.ticks=function(o){var c=i();return FU(c[0],c[c.length-1],o??10)},r.tickFormat=function(o,c){var h=i();return O7(h[0],h[h.length-1],o??10,c)},r.nice=function(o){o==null&&(o=10);var c=i(),h=0,m=c.length-1,_=c[h],x=c[m],s,M,P=10;for(x<_&&(M=_,_=x,x=M,M=h,h=m,m=M);P-- >0;){if(M=nb(_,x,o),M===s)return c[h]=_,c[m]=x,i(c);if(M>0)_=Math.floor(_/M)*M,x=Math.ceil(x/M)*M;else if(M<0)_=Math.ceil(_*M)/M,x=Math.floor(x*M)/M;else break;s=M}return r},r}function fb(){var r=L7();return r.copy=function(){return k7(r,fb())},M7.apply(r,arguments),R7(r)}function Rp(r,i,o){this.k=r,this.x=i,this.y=o}Rp.prototype={constructor:Rp,scale:function(r){return r===1?this:new Rp(this.k*r,this.x,this.y)},translate:function(r,i){return r===0&i===0?this:new Rp(this.k,this.x+this.k*r,this.y+this.k*i)},apply:function(r){return[r[0]*this.k+this.x,r[1]*this.k+this.y]},applyX:function(r){return r*this.k+this.x},applyY:function(r){return r*this.k+this.y},invert:function(r){return[(r[0]-this.x)/this.k,(r[1]-this.y)/this.k]},invertX:function(r){return(r-this.x)/this.k},invertY:function(r){return(r-this.y)/this.k},rescaleX:function(r){return r.copy().domain(r.range().map(this.invertX,this).map(r.invert,r))},rescaleY:function(r){return r.copy().domain(r.range().map(this.invertY,this).map(r.invert,r))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Rp.prototype;function z7(r,i,o,c){let h=fb().domain(i).range(r),m=I8(c).append("svg").attr("width",270),x=m.append("defs").append("linearGradient").attr("id","linear-gradient");x.attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%"),x.selectAll("stop").data([{offset:"0%",color:r[0]},{offset:"10%",color:r[1]},{offset:"20%",color:r[2]},{offset:"30%",color:r[3]},{offset:"40%",color:r[4]},{offset:"50%",color:r[5]},{offset:"60%",color:r[6]},{offset:"70%",color:r[7]},{offset:"80%",color:r[8]},{offset:"90%",color:r[9]},{offset:"100%",color:r[10]}]).enter().append("stop").attr("offset",function(P){return P.offset}).attr("stop-color",function(P){return P.color}),m.append("rect").attr("x",10).attr("y",10).attr("width",250).attr("height",10).style("fill","url(#linear-gradient)");let s=fb().domain(o).range([10,250]),M=WU(s).tickValues(h.domain());m.attr("class","axis").append("g").attr("transform","translate(0, 15)").call(M)}function nC(r,i,o){const c=r.slice();return c[11]=i[o],c}function rC(r){let i,o=r[11].name+"",c,h;return{c(){i=$e("option"),c=Vn(o),this.h()},l(m){i=Qe(m,"OPTION",{});var _=Et(i);c=Un(_,o),_.forEach(ze),this.h()},h(){i.__value=h=r[11].value,ea(i,i.__value)},m(m,_){yi(m,i,_),De(i,c)},p(m,_){_&2&&o!==(o=m[11].name+"")&&jr(c,o),_&2&&h!==(h=m[11].value)&&(i.__value=h,ea(i,i.__value))},d(m){m&&ze(i)}}}function F7(r){let i,o,c,h='<p class="text blue-600 text-sm mb-0">Surface PM 2.5 (ugm-3)</p> <p class="cursor-pointer icon ms-15 mb-0"><img class="d-block" style="height: 15px;" src="/assets/img/icon/head-information.svg" alt=""/></p>',m,_,x,s='<div id="legend" class="map-legend"></div>',M,P,L,F='<p class="icon mb-0"><img class="d-block w-100" src="/assets/img/icon/icon-ugm-2.svg" alt=""/></p>',V,X,q,Y,J,ue=Nr(r[1]),ce=[];for(let fe=0;fe<ue.length;fe+=1)ce[fe]=rC(nC(r,ue,fe));return{c(){i=$e("div"),o=$e("div"),c=$e("div"),c.innerHTML=h,m=Si(),_=$e("div"),x=$e("div"),x.innerHTML=s,M=Si(),P=$e("div"),L=$e("div"),L.innerHTML=F,V=Si(),X=$e("div"),q=$e("select");for(let fe=0;fe<ce.length;fe+=1)ce[fe].c();this.h()},l(fe){i=Qe(fe,"DIV",{class:!0});var Ae=Et(i);o=Qe(Ae,"DIV",{class:!0});var Ce=Et(o);c=Qe(Ce,"DIV",{class:!0,"data-svelte-h":!0}),xn(c)!=="svelte-12x23ds"&&(c.innerHTML=h),m=Mi(Ce),_=Qe(Ce,"DIV",{class:!0});var He=Et(_);x=Qe(He,"DIV",{class:!0,"data-svelte-h":!0}),xn(x)!=="svelte-a75pea"&&(x.innerHTML=s),M=Mi(He),P=Qe(He,"DIV",{class:!0});var We=Et(P);L=Qe(We,"DIV",{class:!0,"data-svelte-h":!0}),xn(L)!=="svelte-1al5iwn"&&(L.innerHTML=F),V=Mi(We),X=Qe(We,"DIV",{class:!0});var nt=Et(X);q=Qe(nt,"SELECT",{id:!0,class:!0});var we=Et(q);for(let ht=0;ht<ce.length;ht+=1)ce[ht].l(we);we.forEach(ze),nt.forEach(ze),We.forEach(ze),He.forEach(ze),Ce.forEach(ze),Ae.forEach(ze),this.h()},h(){be(c,"class","head border-bottom border-green d-flex align-items-center justify-content-between mb-1 pb-05 w-100"),be(x,"class","box__color mb-05"),be(L,"class","col-2"),be(q,"id","select2_satellite"),be(q,"class","nice-select wide selectize"),r[0]===void 0&&tf(()=>r[5].call(q)),be(X,"class","col"),be(P,"class","row no-gutters align-items-center"),be(_,"class","box__description"),be(o,"class","info bg-white mb-2 p-15 rounded"),be(i,"class","item svelte-1lbf8na")},m(fe,Ae){yi(fe,i,Ae),De(i,o),De(o,c),De(o,m),De(o,_),De(_,x),De(_,M),De(_,P),De(P,L),De(P,V),De(P,X),De(X,q);for(let Ce=0;Ce<ce.length;Ce+=1)ce[Ce]&&ce[Ce].m(q,null);ya(q,r[0],!0),Y||(J=Ei(q,"change",r[5]),Y=!0)},p(fe,[Ae]){if(Ae&2){ue=Nr(fe[1]);let Ce;for(Ce=0;Ce<ue.length;Ce+=1){const He=nC(fe,ue,Ce);ce[Ce]?ce[Ce].p(He,Ae):(ce[Ce]=rC(He),ce[Ce].c(),ce[Ce].m(q,null))}for(;Ce<ce.length;Ce+=1)ce[Ce].d(1);ce.length=ue.length}Ae&3&&ya(q,fe[0])},i:_r,o:_r,d(fe){fe&&ze(i),_a(ce,fe),Y=!1,J()}}}function B7(r,i,o){let c,h,m,_,x;Fi(r,vh,F=>o(0,c=F)),Fi(r,Qp,F=>o(4,h=F)),Fi(r,k_,F=>o(6,m=F)),Fi(r,tm,F=>o(7,_=F)),Fi(r,c_,F=>o(1,x=F)),vh.set("geos5"),Qp.set("pm25"),k_.set("BC_DNN_PM25");let{hiddenDrawer:s=!0}=i;an(tm,_=!0,_);let M=[],P={pm25:{geos:"BC_MLPM25",geos5:"BC_DNN_PM25"},no2:{gems:"ColumnAmountNO2Trop"}};mb(()=>{z7(["#FFFFFF","#E0EFF4","#84A8CB","#7985BB","#8B6EA4","#B47C9E","#EA9394","#FCC495","#F8D19C","#FBEAC2","#FDECC7"],[0,50,100,150,200],[0,200],"#legend")});function L(){c=_y(this),vh.set(c)}return r.$$set=F=>{"hiddenDrawer"in F&&o(2,s=F.hiddenDrawer)},r.$$.update=()=>{r.$$.dirty&24&&h==="no2"&&(o(3,M=[{value:"gems",name:"GEMS"},{value:"sentinel5p",name:"Sentinel 5P"}]),an(c_,x=M,x),an(vh,c="gems",c)),r.$$.dirty&24&&h==="pm25"&&(o(3,M=[{value:"geos",name:"GEOS-ML 25x25km"},{value:"geos5",name:"GEOS-ML 5x5km"}]),an(c_,x=M,x),an(vh,c="geos5",c)),r.$$.dirty&24&&h==="pm10"&&(o(3,M=[{value:"geos",name:"GEOS-ML 25x25km"}]),an(c_,x=M,x),an(vh,c="geos",c)),r.$$.dirty&17&&c!==""&&an(k_,m=P[h][c],m)},[c,x,s,M,h,L]}class N7 extends _o{constructor(i){super(),yo(this,i,B7,F7,go,{hiddenDrawer:2})}}function V7(r){let i,o,c,h='<p class="text blue-600 text-sm mb-0">Ground Stations</p> <p class="cursor-pointer icon ms-15 mb-0"><img class="d-block" style="height: 15px;" src="assets/img/icon/head-information.svg" alt=""/></p>',m,_,x,s,M='<p class="icon mb-0"><img class="d-block w-100" src="assets/img/icon/icon-ugm-3.svg" alt=""/></p>',P,L,F,V,X="Pollution Control Department",q,Y="Aeronet",J,ue="Embassy",ce,fe;return{c(){i=$e("div"),o=$e("div"),c=$e("div"),c.innerHTML=h,m=Si(),_=$e("div"),x=$e("div"),s=$e("div"),s.innerHTML=M,P=Si(),L=$e("div"),F=$e("select"),V=$e("option"),V.textContent=X,q=$e("option"),q.textContent=Y,J=$e("option"),J.textContent=ue,this.h()},l(Ae){i=Qe(Ae,"DIV",{class:!0});var Ce=Et(i);o=Qe(Ce,"DIV",{class:!0});var He=Et(o);c=Qe(He,"DIV",{class:!0,"data-svelte-h":!0}),xn(c)!=="svelte-17pg3bs"&&(c.innerHTML=h),m=Mi(He),_=Qe(He,"DIV",{class:!0});var We=Et(_);x=Qe(We,"DIV",{class:!0});var nt=Et(x);s=Qe(nt,"DIV",{class:!0,"data-svelte-h":!0}),xn(s)!=="svelte-glq2g4"&&(s.innerHTML=M),P=Mi(nt),L=Qe(nt,"DIV",{class:!0});var we=Et(L);F=Qe(we,"SELECT",{id:!0,class:!0});var ht=Et(F);V=Qe(ht,"OPTION",{"data-svelte-h":!0}),xn(V)!=="svelte-19fdb44"&&(V.textContent=X),q=Qe(ht,"OPTION",{"data-svelte-h":!0}),xn(q)!=="svelte-usgr3e"&&(q.textContent=Y),J=Qe(ht,"OPTION",{"data-svelte-h":!0}),xn(J)!=="svelte-tzjcwq"&&(J.textContent=ue),ht.forEach(ze),we.forEach(ze),nt.forEach(ze),We.forEach(ze),He.forEach(ze),Ce.forEach(ze),this.h()},h(){be(c,"class","head border-bottom border-green d-flex align-items-center justify-content-between mb-1 pb-05 w-100"),be(s,"class","col-2"),V.__value="pcd",ea(V,V.__value),q.__value="aeronet",ea(q,q.__value),J.__value="embassy",ea(J,J.__value),be(F,"id","select2-station"),be(F,"class","nice-select wide selectize"),r[0]===void 0&&tf(()=>r[1].call(F)),be(L,"class","col"),be(x,"class","row no-gutters align-items-center"),be(_,"class","box__description"),be(o,"class","info bg-white mb-2 p-15 rounded"),be(i,"class","item")},m(Ae,Ce){yi(Ae,i,Ce),De(i,o),De(o,c),De(o,m),De(o,_),De(_,x),De(x,s),De(x,P),De(x,L),De(L,F),De(F,V),De(F,q),De(F,J),ya(F,r[0],!0),ce||(fe=Ei(F,"change",r[1]),ce=!0)},p(Ae,[Ce]){Ce&1&&ya(F,Ae[0])},i:_r,o:_r,d(Ae){Ae&&ze(i),ce=!1,fe()}}}function U7(r,i,o){let c,h,m;Fi(r,Jx,x=>o(2,c=x)),Fi(r,cx,x=>o(0,h=x)),Fi(r,Ph,x=>o(3,m=x)),an(cx,h="pcd",h),an(Ph,m=!0,m),setTimeout(()=>{NiceSelect.bind(document.querySelector("#select2-station"))},100);function _(){h=_y(this),cx.set(h)}return r.$$.update=()=>{r.$$.dirty&1&&h==="pcd"&&an(Jx,c=!0,c)},[h,_]}class j7 extends _o{constructor(i){super(),yo(this,i,U7,V7,go,{})}}function oC(r,i,o){const c=r.slice();return c[3]=i[o],c}function sC(r){let i,o=r[3].name+"",c;return{c(){i=$e("option"),c=Vn(o),this.h()},l(h){i=Qe(h,"OPTION",{});var m=Et(i);c=Un(m,o),m.forEach(ze),this.h()},h(){i.__value=r[3].value,ea(i,i.__value)},m(h,m){yi(h,i,m),De(i,c)},p:_r,d(h){h&&ze(i)}}}function G7(r){let i,o,c,h='<p class="text blue-600 text-sm mb-0">Fire Product</p> <p class="cursor-pointer icon ms-15 mb-0"><img class="d-block" style="height: 15px;" src="assets/img/icon/head-information.svg" alt=""/></p>',m,_,x,s,M='<p class="icon mb-0"><img class="d-block w-100" src="assets/img/icon/icon-ugm-1.svg" alt=""/></p>',P,L,F,V,X,q=Nr(r[1]),Y=[];for(let J=0;J<q.length;J+=1)Y[J]=sC(oC(r,q,J));return{c(){i=$e("div"),o=$e("div"),c=$e("div"),c.innerHTML=h,m=Si(),_=$e("div"),x=$e("div"),s=$e("div"),s.innerHTML=M,P=Si(),L=$e("div"),F=$e("select");for(let J=0;J<Y.length;J+=1)Y[J].c();this.h()},l(J){i=Qe(J,"DIV",{class:!0});var ue=Et(i);o=Qe(ue,"DIV",{class:!0});var ce=Et(o);c=Qe(ce,"DIV",{class:!0,"data-svelte-h":!0}),xn(c)!=="svelte-zptitx"&&(c.innerHTML=h),m=Mi(ce),_=Qe(ce,"DIV",{class:!0});var fe=Et(_);x=Qe(fe,"DIV",{class:!0});var Ae=Et(x);s=Qe(Ae,"DIV",{class:!0,"data-svelte-h":!0}),xn(s)!=="svelte-1lzl765"&&(s.innerHTML=M),P=Mi(Ae),L=Qe(Ae,"DIV",{class:!0});var Ce=Et(L);F=Qe(Ce,"SELECT",{id:!0,class:!0});var He=Et(F);for(let We=0;We<Y.length;We+=1)Y[We].l(He);He.forEach(ze),Ce.forEach(ze),Ae.forEach(ze),fe.forEach(ze),ce.forEach(ze),ue.forEach(ze),this.h()},h(){be(c,"class","head border-bottom border-green d-flex align-items-center justify-content-between mb-1 pb-05 w-100"),be(s,"class","col-2"),be(F,"id","select2-fire"),be(F,"class","nice-select wide selectize"),r[0]===void 0&&tf(()=>r[2].call(F)),be(L,"class","col"),be(x,"class","row no-gutters align-items-center"),be(_,"class","box__description"),be(o,"class","info bg-white mb-2 p-15 rounded"),be(i,"class","item")},m(J,ue){yi(J,i,ue),De(i,o),De(o,c),De(o,m),De(o,_),De(_,x),De(x,s),De(x,P),De(x,L),De(L,F);for(let ce=0;ce<Y.length;ce+=1)Y[ce]&&Y[ce].m(F,null);ya(F,r[0],!0),V||(X=Ei(F,"change",r[2]),V=!0)},p(J,[ue]){if(ue&2){q=Nr(J[1]);let ce;for(ce=0;ce<q.length;ce+=1){const fe=oC(J,q,ce);Y[ce]?Y[ce].p(fe,ue):(Y[ce]=sC(fe),Y[ce].c(),Y[ce].m(F,null))}for(;ce<Y.length;ce+=1)Y[ce].d(1);Y.length=q.length}ue&3&&ya(F,J[0])},i:_r,o:_r,d(J){J&&ze(i),_a(Y,J),V=!1,X()}}}function H7(r,i,o){let c;Fi(r,em,_=>o(0,c=_));let h=[{value:"vfei",name:"VIIRS-based Fire Emission Inventory (VFEI)"},{value:"fires_viirs_24",name:"VIIRS active fire last 24 hours"},{value:"fires_viirs_48",name:"VIIRS active fire last 48 hours"},{value:"fires_viirs_time",name:"VIIRS active fire for a single day"}];setTimeout(()=>{NiceSelect.bind(document.querySelector("#select2-fire"))},100);function m(){c=_y(this),em.set(c),o(1,h)}return[c,h,m]}class q7 extends _o{constructor(i){super(),yo(this,i,H7,G7,go,{})}}const i1="-";function W7(r){const i=X7(r),{conflictingClassGroups:o,conflictingClassGroupModifiers:c}=r;function h(_){const x=_.split(i1);return x[0]===""&&x.length!==1&&x.shift(),Gk(x,i)||Z7(_)}function m(_,x){const s=o[_]||[];return x&&c[_]?[...s,...c[_]]:s}return{getClassGroupId:h,getConflictingClassGroupIds:m}}function Gk(r,i){var _;if(r.length===0)return i.classGroupId;const o=r[0],c=i.nextPart.get(o),h=c?Gk(r.slice(1),c):void 0;if(h)return h;if(i.validators.length===0)return;const m=r.join(i1);return(_=i.validators.find(({validator:x})=>x(m)))==null?void 0:_.classGroupId}const aC=/^\[(.+)\]$/;function Z7(r){if(aC.test(r)){const i=aC.exec(r)[1],o=i==null?void 0:i.substring(0,i.indexOf(":"));if(o)return"arbitrary.."+o}}function X7(r){const{theme:i,prefix:o}=r,c={nextPart:new Map,validators:[]};return J7(Object.entries(r.classGroups),o).forEach(([m,_])=>{pb(_,c,m,i)}),c}function pb(r,i,o,c){r.forEach(h=>{if(typeof h=="string"){const m=h===""?i:lC(i,h);m.classGroupId=o;return}if(typeof h=="function"){if(Y7(h)){pb(h(c),i,o,c);return}i.validators.push({validator:h,classGroupId:o});return}Object.entries(h).forEach(([m,_])=>{pb(_,lC(i,m),o,c)})})}function lC(r,i){let o=r;return i.split(i1).forEach(c=>{o.nextPart.has(c)||o.nextPart.set(c,{nextPart:new Map,validators:[]}),o=o.nextPart.get(c)}),o}function Y7(r){return r.isThemeGetter}function J7(r,i){return i?r.map(([o,c])=>{const h=c.map(m=>typeof m=="string"?i+m:typeof m=="object"?Object.fromEntries(Object.entries(m).map(([_,x])=>[i+_,x])):m);return[o,h]}):r}function K7(r){if(r<1)return{get:()=>{},set:()=>{}};let i=0,o=new Map,c=new Map;function h(m,_){o.set(m,_),i++,i>r&&(i=0,c=o,o=new Map)}return{get(m){let _=o.get(m);if(_!==void 0)return _;if((_=c.get(m))!==void 0)return h(m,_),_},set(m,_){o.has(m)?o.set(m,_):h(m,_)}}}const Hk="!";function $7(r){const i=r.separator,o=i.length===1,c=i[0],h=i.length;return function(_){const x=[];let s=0,M=0,P;for(let q=0;q<_.length;q++){let Y=_[q];if(s===0){if(Y===c&&(o||_.slice(q,q+h)===i)){x.push(_.slice(M,q)),M=q+h;continue}if(Y==="/"){P=q;continue}}Y==="["?s++:Y==="]"&&s--}const L=x.length===0?_:_.substring(M),F=L.startsWith(Hk),V=F?L.substring(1):L,X=P&&P>M?P-M:void 0;return{modifiers:x,hasImportantModifier:F,baseClassName:V,maybePostfixModifierPosition:X}}}function Q7(r){if(r.length<=1)return r;const i=[];let o=[];return r.forEach(c=>{c[0]==="["?(i.push(...o.sort(),c),o=[]):o.push(c)}),i.push(...o.sort()),i}function e9(r){return{cache:K7(r.cacheSize),splitModifiers:$7(r),...W7(r)}}const t9=/\s+/;function i9(r,i){const{splitModifiers:o,getClassGroupId:c,getConflictingClassGroupIds:h}=i,m=new Set;return r.trim().split(t9).map(_=>{const{modifiers:x,hasImportantModifier:s,baseClassName:M,maybePostfixModifierPosition:P}=o(_);let L=c(P?M.substring(0,P):M),F=!!P;if(!L){if(!P)return{isTailwindClass:!1,originalClassName:_};if(L=c(M),!L)return{isTailwindClass:!1,originalClassName:_};F=!1}const V=Q7(x).join(":");return{isTailwindClass:!0,modifierId:s?V+Hk:V,classGroupId:L,originalClassName:_,hasPostfixModifier:F}}).reverse().filter(_=>{if(!_.isTailwindClass)return!0;const{modifierId:x,classGroupId:s,hasPostfixModifier:M}=_,P=x+s;return m.has(P)?!1:(m.add(P),h(s,M).forEach(L=>m.add(x+L)),!0)}).reverse().map(_=>_.originalClassName).join(" ")}function n9(){let r=0,i,o,c="";for(;r<arguments.length;)(i=arguments[r++])&&(o=qk(i))&&(c&&(c+=" "),c+=o);return c}function qk(r){if(typeof r=="string")return r;let i,o="";for(let c=0;c<r.length;c++)r[c]&&(i=qk(r[c]))&&(o&&(o+=" "),o+=i);return o}function r9(r,...i){let o,c,h,m=_;function _(s){const M=i.reduce((P,L)=>L(P),r());return o=e9(M),c=o.cache.get,h=o.cache.set,m=x,x(s)}function x(s){const M=c(s);if(M)return M;const P=i9(s,o);return h(s,P),P}return function(){return m(n9.apply(null,arguments))}}function Lr(r){const i=o=>o[r]||[];return i.isThemeGetter=!0,i}const Wk=/^\[(?:([a-z-]+):)?(.+)\]$/i,o9=/^\d+\/\d+$/,s9=new Set(["px","full","screen"]),a9=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,l9=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,c9=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,u9=/^-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,h9=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/;function pc(r){return Mh(r)||s9.has(r)||o9.test(r)}function nu(r){return sf(r,"length",v9)}function Mh(r){return!!r&&!Number.isNaN(Number(r))}function m_(r){return sf(r,"number",Mh)}function Tp(r){return!!r&&Number.isInteger(Number(r))}function d9(r){return r.endsWith("%")&&Mh(r.slice(0,-1))}function Tn(r){return Wk.test(r)}function ru(r){return a9.test(r)}const f9=new Set(["length","size","percentage"]);function p9(r){return sf(r,f9,Zk)}function m9(r){return sf(r,"position",Zk)}const g9=new Set(["image","url"]);function _9(r){return sf(r,g9,b9)}function y9(r){return sf(r,"",x9)}function Sp(){return!0}function sf(r,i,o){const c=Wk.exec(r);return c?c[1]?typeof i=="string"?c[1]===i:i.has(c[1]):o(c[2]):!1}function v9(r){return l9.test(r)&&!c9.test(r)}function Zk(){return!1}function x9(r){return u9.test(r)}function b9(r){return h9.test(r)}function w9(){const r=Lr("colors"),i=Lr("spacing"),o=Lr("blur"),c=Lr("brightness"),h=Lr("borderColor"),m=Lr("borderRadius"),_=Lr("borderSpacing"),x=Lr("borderWidth"),s=Lr("contrast"),M=Lr("grayscale"),P=Lr("hueRotate"),L=Lr("invert"),F=Lr("gap"),V=Lr("gradientColorStops"),X=Lr("gradientColorStopPositions"),q=Lr("inset"),Y=Lr("margin"),J=Lr("opacity"),ue=Lr("padding"),ce=Lr("saturate"),fe=Lr("scale"),Ae=Lr("sepia"),Ce=Lr("skew"),He=Lr("space"),We=Lr("translate"),nt=()=>["auto","contain","none"],we=()=>["auto","hidden","clip","visible","scroll"],ht=()=>["auto",Tn,i],pt=()=>[Tn,i],Xe=()=>["",pc,nu],mt=()=>["auto",Mh,Tn],Ft=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],tt=()=>["solid","dashed","dotted","double","none"],ei=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter"],ki=()=>["start","end","center","between","around","evenly","stretch"],rt=()=>["","0",Tn],yt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Xt=()=>[Mh,m_],kt=()=>[Mh,Tn];return{cacheSize:500,separator:":",theme:{colors:[Sp],spacing:[pc,nu],blur:["none","",ru,Tn],brightness:Xt(),borderColor:[r],borderRadius:["none","","full",ru,Tn],borderSpacing:pt(),borderWidth:Xe(),contrast:Xt(),grayscale:rt(),hueRotate:kt(),invert:rt(),gap:pt(),gradientColorStops:[r],gradientColorStopPositions:[d9,nu],inset:ht(),margin:ht(),opacity:Xt(),padding:pt(),saturate:Xt(),scale:Xt(),sepia:rt(),skew:kt(),space:pt(),translate:pt()},classGroups:{aspect:[{aspect:["auto","square","video",Tn]}],container:["container"],columns:[{columns:[ru]}],"break-after":[{"break-after":yt()}],"break-before":[{"break-before":yt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Ft(),Tn]}],overflow:[{overflow:we()}],"overflow-x":[{"overflow-x":we()}],"overflow-y":[{"overflow-y":we()}],overscroll:[{overscroll:nt()}],"overscroll-x":[{"overscroll-x":nt()}],"overscroll-y":[{"overscroll-y":nt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[q]}],"inset-x":[{"inset-x":[q]}],"inset-y":[{"inset-y":[q]}],start:[{start:[q]}],end:[{end:[q]}],top:[{top:[q]}],right:[{right:[q]}],bottom:[{bottom:[q]}],left:[{left:[q]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Tp,Tn]}],basis:[{basis:ht()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Tn]}],grow:[{grow:rt()}],shrink:[{shrink:rt()}],order:[{order:["first","last","none",Tp,Tn]}],"grid-cols":[{"grid-cols":[Sp]}],"col-start-end":[{col:["auto",{span:["full",Tp,Tn]},Tn]}],"col-start":[{"col-start":mt()}],"col-end":[{"col-end":mt()}],"grid-rows":[{"grid-rows":[Sp]}],"row-start-end":[{row:["auto",{span:[Tp,Tn]},Tn]}],"row-start":[{"row-start":mt()}],"row-end":[{"row-end":mt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Tn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Tn]}],gap:[{gap:[F]}],"gap-x":[{"gap-x":[F]}],"gap-y":[{"gap-y":[F]}],"justify-content":[{justify:["normal",...ki()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...ki(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...ki(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[ue]}],px:[{px:[ue]}],py:[{py:[ue]}],ps:[{ps:[ue]}],pe:[{pe:[ue]}],pt:[{pt:[ue]}],pr:[{pr:[ue]}],pb:[{pb:[ue]}],pl:[{pl:[ue]}],m:[{m:[Y]}],mx:[{mx:[Y]}],my:[{my:[Y]}],ms:[{ms:[Y]}],me:[{me:[Y]}],mt:[{mt:[Y]}],mr:[{mr:[Y]}],mb:[{mb:[Y]}],ml:[{ml:[Y]}],"space-x":[{"space-x":[He]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[He]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Tn,i]}],"min-w":[{"min-w":[Tn,i,"min","max","fit"]}],"max-w":[{"max-w":[Tn,i,"none","full","min","max","fit","prose",{screen:[ru]},ru]}],h:[{h:[Tn,i,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Tn,i,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Tn,i,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Tn,i,"auto","min","max","fit"]}],"font-size":[{text:["base",ru,nu]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",m_]}],"font-family":[{font:[Sp]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Tn]}],"line-clamp":[{"line-clamp":["none",Mh,m_]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",pc,Tn]}],"list-image":[{"list-image":["none",Tn]}],"list-style-type":[{list:["none","disc","decimal",Tn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[r]}],"placeholder-opacity":[{"placeholder-opacity":[J]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[r]}],"text-opacity":[{"text-opacity":[J]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...tt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",pc,nu]}],"underline-offset":[{"underline-offset":["auto",pc,Tn]}],"text-decoration-color":[{decoration:[r]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:pt()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Tn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Tn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[J]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Ft(),m9]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",p9]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},_9]}],"bg-color":[{bg:[r]}],"gradient-from-pos":[{from:[X]}],"gradient-via-pos":[{via:[X]}],"gradient-to-pos":[{to:[X]}],"gradient-from":[{from:[V]}],"gradient-via":[{via:[V]}],"gradient-to":[{to:[V]}],rounded:[{rounded:[m]}],"rounded-s":[{"rounded-s":[m]}],"rounded-e":[{"rounded-e":[m]}],"rounded-t":[{"rounded-t":[m]}],"rounded-r":[{"rounded-r":[m]}],"rounded-b":[{"rounded-b":[m]}],"rounded-l":[{"rounded-l":[m]}],"rounded-ss":[{"rounded-ss":[m]}],"rounded-se":[{"rounded-se":[m]}],"rounded-ee":[{"rounded-ee":[m]}],"rounded-es":[{"rounded-es":[m]}],"rounded-tl":[{"rounded-tl":[m]}],"rounded-tr":[{"rounded-tr":[m]}],"rounded-br":[{"rounded-br":[m]}],"rounded-bl":[{"rounded-bl":[m]}],"border-w":[{border:[x]}],"border-w-x":[{"border-x":[x]}],"border-w-y":[{"border-y":[x]}],"border-w-s":[{"border-s":[x]}],"border-w-e":[{"border-e":[x]}],"border-w-t":[{"border-t":[x]}],"border-w-r":[{"border-r":[x]}],"border-w-b":[{"border-b":[x]}],"border-w-l":[{"border-l":[x]}],"border-opacity":[{"border-opacity":[J]}],"border-style":[{border:[...tt(),"hidden"]}],"divide-x":[{"divide-x":[x]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[x]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[J]}],"divide-style":[{divide:tt()}],"border-color":[{border:[h]}],"border-color-x":[{"border-x":[h]}],"border-color-y":[{"border-y":[h]}],"border-color-t":[{"border-t":[h]}],"border-color-r":[{"border-r":[h]}],"border-color-b":[{"border-b":[h]}],"border-color-l":[{"border-l":[h]}],"divide-color":[{divide:[h]}],"outline-style":[{outline:["",...tt()]}],"outline-offset":[{"outline-offset":[pc,Tn]}],"outline-w":[{outline:[pc,nu]}],"outline-color":[{outline:[r]}],"ring-w":[{ring:Xe()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[r]}],"ring-opacity":[{"ring-opacity":[J]}],"ring-offset-w":[{"ring-offset":[pc,nu]}],"ring-offset-color":[{"ring-offset":[r]}],shadow:[{shadow:["","inner","none",ru,y9]}],"shadow-color":[{shadow:[Sp]}],opacity:[{opacity:[J]}],"mix-blend":[{"mix-blend":ei()}],"bg-blend":[{"bg-blend":ei()}],filter:[{filter:["","none"]}],blur:[{blur:[o]}],brightness:[{brightness:[c]}],contrast:[{contrast:[s]}],"drop-shadow":[{"drop-shadow":["","none",ru,Tn]}],grayscale:[{grayscale:[M]}],"hue-rotate":[{"hue-rotate":[P]}],invert:[{invert:[L]}],saturate:[{saturate:[ce]}],sepia:[{sepia:[Ae]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[o]}],"backdrop-brightness":[{"backdrop-brightness":[c]}],"backdrop-contrast":[{"backdrop-contrast":[s]}],"backdrop-grayscale":[{"backdrop-grayscale":[M]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[P]}],"backdrop-invert":[{"backdrop-invert":[L]}],"backdrop-opacity":[{"backdrop-opacity":[J]}],"backdrop-saturate":[{"backdrop-saturate":[ce]}],"backdrop-sepia":[{"backdrop-sepia":[Ae]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[_]}],"border-spacing-x":[{"border-spacing-x":[_]}],"border-spacing-y":[{"border-spacing-y":[_]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Tn]}],duration:[{duration:kt()}],ease:[{ease:["linear","in","out","in-out",Tn]}],delay:[{delay:kt()}],animate:[{animate:["none","spin","ping","pulse","bounce",Tn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[fe]}],"scale-x":[{"scale-x":[fe]}],"scale-y":[{"scale-y":[fe]}],rotate:[{rotate:[Tp,Tn]}],"translate-x":[{"translate-x":[We]}],"translate-y":[{"translate-y":[We]}],"skew-x":[{"skew-x":[Ce]}],"skew-y":[{"skew-y":[Ce]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Tn]}],accent:[{accent:["auto",r]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Tn]}],"caret-color":[{caret:[r]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":pt()}],"scroll-mx":[{"scroll-mx":pt()}],"scroll-my":[{"scroll-my":pt()}],"scroll-ms":[{"scroll-ms":pt()}],"scroll-me":[{"scroll-me":pt()}],"scroll-mt":[{"scroll-mt":pt()}],"scroll-mr":[{"scroll-mr":pt()}],"scroll-mb":[{"scroll-mb":pt()}],"scroll-ml":[{"scroll-ml":pt()}],"scroll-p":[{"scroll-p":pt()}],"scroll-px":[{"scroll-px":pt()}],"scroll-py":[{"scroll-py":pt()}],"scroll-ps":[{"scroll-ps":pt()}],"scroll-pe":[{"scroll-pe":pt()}],"scroll-pt":[{"scroll-pt":pt()}],"scroll-pr":[{"scroll-pr":pt()}],"scroll-pb":[{"scroll-pb":pt()}],"scroll-pl":[{"scroll-pl":pt()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Tn]}],fill:[{fill:[r,"none"]}],"stroke-w":[{stroke:[pc,nu,m_]}],stroke:[{stroke:[r,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}}const ef=r9(w9),T9=r=>({svgSize:r&4}),cC=r=>({svgSize:r[5][r[2]]}),S9=r=>({svgSize:r&4}),uC=r=>({svgSize:r[5][r[2]]});function M9(r){let i,o,c,h,m,_,x=r[0]&&hC(r);const s=r[9].default,M=Dh(s,r,r[8],cC);let P=[{type:"button"},r[6],{class:r[4]},{"aria-label":c=r[1]??r[0]}],L={};for(let F=0;F<P.length;F+=1)L=Cl(L,P[F]);return{c(){i=$e("button"),x&&x.c(),o=Si(),M&&M.c(),this.h()},l(F){i=Qe(F,"BUTTON",{type:!0,class:!0,"aria-label":!0});var V=Et(i);x&&x.l(V),o=Mi(V),M&&M.l(V),V.forEach(ze),this.h()},h(){Ud(i,L)},m(F,V){yi(F,i,V),x&&x.m(i,null),De(i,o),M&&M.m(i,null),i.autofocus&&i.focus(),h=!0,m||(_=Ei(i,"click",r[10]),m=!0)},p(F,V){F[0]?x?x.p(F,V):(x=hC(F),x.c(),x.m(i,o)):x&&(x.d(1),x=null),M&&M.p&&(!h||V&260)&&Lh(M,s,F,F[8],h?Rh(s,F[8],V,T9):Oh(F[8]),cC),Ud(i,L=yy(P,[{type:"button"},V&64&&F[6],(!h||V&16)&&{class:F[4]},(!h||V&3&&c!==(c=F[1]??F[0]))&&{"aria-label":c}]))},i(F){h||($i(M,F),h=!0)},o(F){ln(M,F),h=!1},d(F){F&&ze(i),x&&x.d(),M&&M.d(F),m=!1,_()}}}function E9(r){let i,o,c,h,m=r[0]&&dC(r);const _=r[9].default,x=Dh(_,r,r[8],uC);let s=[{href:r[3]},r[6],{class:r[4]},{"aria-label":c=r[1]??r[0]}],M={};for(let P=0;P<s.length;P+=1)M=Cl(M,s[P]);return{c(){i=$e("a"),m&&m.c(),o=Si(),x&&x.c(),this.h()},l(P){i=Qe(P,"A",{href:!0,class:!0,"aria-label":!0});var L=Et(i);m&&m.l(L),o=Mi(L),x&&x.l(L),L.forEach(ze),this.h()},h(){Ud(i,M)},m(P,L){yi(P,i,L),m&&m.m(i,null),De(i,o),x&&x.m(i,null),h=!0},p(P,L){P[0]?m?m.p(P,L):(m=dC(P),m.c(),m.m(i,o)):m&&(m.d(1),m=null),x&&x.p&&(!h||L&260)&&Lh(x,_,P,P[8],h?Rh(_,P[8],L,S9):Oh(P[8]),uC),Ud(i,M=yy(s,[(!h||L&8)&&{href:P[3]},L&64&&P[6],(!h||L&16)&&{class:P[4]},(!h||L&3&&c!==(c=P[1]??P[0]))&&{"aria-label":c}]))},i(P){h||($i(x,P),h=!0)},o(P){ln(x,P),h=!1},d(P){P&&ze(i),m&&m.d(),x&&x.d(P)}}}function hC(r){let i,o;return{c(){i=$e("span"),o=Vn(r[0]),this.h()},l(c){i=Qe(c,"SPAN",{class:!0});var h=Et(i);o=Un(h,r[0]),h.forEach(ze),this.h()},h(){be(i,"class","sr-only")},m(c,h){yi(c,i,h),De(i,o)},p(c,h){h&1&&jr(o,c[0])},d(c){c&&ze(i)}}}function dC(r){let i,o;return{c(){i=$e("span"),o=Vn(r[0]),this.h()},l(c){i=Qe(c,"SPAN",{class:!0});var h=Et(i);o=Un(h,r[0]),h.forEach(ze),this.h()},h(){be(i,"class","sr-only")},m(c,h){yi(c,i,h),De(i,o)},p(c,h){h&1&&jr(o,c[0])},d(c){c&&ze(i)}}}function A9(r){let i,o,c,h;const m=[E9,M9],_=[];function x(s,M){return s[3]?0:1}return i=x(r),o=_[i]=m[i](r),{c(){o.c(),c=hr()},l(s){o.l(s),c=hr()},m(s,M){_[i].m(s,M),yi(s,c,M),h=!0},p(s,[M]){let P=i;i=x(s),i===P?_[i].p(s,M):(yc(),ln(_[P],1,1,()=>{_[P]=null}),vc(),o=_[i],o?o.p(s,M):(o=_[i]=m[i](s),o.c()),$i(o,1),o.m(c.parentNode,c))},i(s){h||($i(o),h=!0)},o(s){ln(o),h=!1},d(s){s&&ze(c),_[i].d(s)}}}function I9(r,i,o){const c=["color","name","ariaLabel","size","href"];let h=Nd(i,c),{$$slots:m={},$$scope:_}=i;const x=VR("background");let{color:s="default"}=i,{name:M=void 0}=i,{ariaLabel:P=void 0}=i,{size:L="md"}=i,{href:F=void 0}=i;const V={dark:"text-gray-500 hover:text-gray-900 hover:bg-gray-200 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-600",gray:"text-gray-500 focus:ring-gray-400 hover:bg-gray-200 dark:hover:bg-gray-800 dark:hover:text-gray-300",red:"text-red-500 focus:ring-red-400 hover:bg-red-200 dark:hover:bg-red-800 dark:hover:text-red-300",yellow:"text-yellow-500 focus:ring-yellow-400 hover:bg-yellow-200 dark:hover:bg-yellow-800 dark:hover:text-yellow-300",green:"text-green-500 focus:ring-green-400 hover:bg-green-200 dark:hover:bg-green-800 dark:hover:text-green-300",indigo:"text-indigo-500 focus:ring-indigo-400 hover:bg-indigo-200 dark:hover:bg-indigo-800 dark:hover:text-indigo-300",purple:"text-purple-500 focus:ring-purple-400 hover:bg-purple-200 dark:hover:bg-purple-800 dark:hover:text-purple-300",pink:"text-pink-500 focus:ring-pink-400 hover:bg-pink-200 dark:hover:bg-pink-800 dark:hover:text-pink-300",blue:"text-blue-500 focus:ring-blue-400 hover:bg-blue-200 dark:hover:bg-blue-800 dark:hover:text-blue-300",primary:"text-primary-500 focus:ring-primary-400 hover:bg-primary-200 dark:hover:bg-primary-800 dark:hover:text-primary-300",default:"focus:ring-gray-400"},X={xs:"m-0.5 rounded-sm focus:ring-1 p-0.5",sm:"m-0.5 rounded focus:ring-1 p-0.5",md:"m-0.5 rounded-lg focus:ring-2 p-1.5",lg:"m-0.5 rounded-lg focus:ring-2 p-2.5"};let q;const Y={xs:"w-3 h-3",sm:"w-3.5 h-3.5",md:"w-5 h-5",lg:"w-5 h-5"};function J(ue){gy.call(this,r,ue)}return r.$$set=ue=>{o(14,i=Cl(Cl({},i),Vd(ue))),o(6,h=Nd(i,c)),"color"in ue&&o(7,s=ue.color),"name"in ue&&o(0,M=ue.name),"ariaLabel"in ue&&o(1,P=ue.ariaLabel),"size"in ue&&o(2,L=ue.size),"href"in ue&&o(3,F=ue.href),"$$scope"in ue&&o(8,_=ue.$$scope)},r.$$.update=()=>{o(4,q=ef("focus:outline-none whitespace-normal",X[L],V[s],s==="default"&&(x?"hover:bg-gray-100 dark:hover:bg-gray-600":"hover:bg-gray-100 dark:hover:bg-gray-700"),i.class))},i=Vd(i),[M,P,L,F,q,Y,h,s,_,m,J]}class C9 extends _o{constructor(i){super(),yo(this,i,I9,A9,go,{color:7,name:0,ariaLabel:1,size:2,href:3})}}function P9(r){let i,o,c;return{c(){i=Ld("svg"),o=Ld("path"),this.h()},l(h){i=Od(h,"svg",{class:!0,fill:!0,viewBox:!0,xmlns:!0});var m=Et(i);o=Od(m,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),Et(o).forEach(ze),m.forEach(ze),this.h()},h(){be(o,"fill-rule","evenodd"),be(o,"d","M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"),be(o,"clip-rule","evenodd"),be(i,"class",c=r[4]),be(i,"fill","currentColor"),be(i,"viewBox","0 0 20 20"),be(i,"xmlns","http://www.w3.org/2000/svg")},m(h,m){yi(h,i,m),De(i,o)},p(h,m){m&16&&c!==(c=h[4])&&be(i,"class",c)},d(h){h&&ze(i)}}}function k9(r){let i,o;const c=[{name:r[0]},r[1],{class:ef("ms-auto",r[2].class)}];let h={$$slots:{default:[P9,({svgSize:m})=>({4:m}),({svgSize:m})=>m?16:0]},$$scope:{ctx:r}};for(let m=0;m<c.length;m+=1)h=Cl(h,c[m]);return i=new C9({props:h}),i.$on("click",r[3]),{c(){oo(i.$$.fragment)},l(m){so(i.$$.fragment,m)},m(m,_){ao(i,m,_),o=!0},p(m,[_]){const x=_&7?yy(c,[_&1&&{name:m[0]},_&2&&GR(m[1]),_&4&&{class:ef("ms-auto",m[2].class)}]):{};_&48&&(x.$$scope={dirty:_,ctx:m}),i.$set(x)},i(m){o||($i(i.$$.fragment,m),o=!0)},o(m){ln(i.$$.fragment,m),o=!1},d(m){lo(i,m)}}}function D9(r,i,o){const c=["name"];let h=Nd(i,c),{name:m="Close"}=i;function _(x){gy.call(this,r,x)}return r.$$set=x=>{o(2,i=Cl(Cl({},i),Vd(x))),o(1,h=Nd(i,c)),"name"in x&&o(0,m=x.name)},i=Vd(i),[m,h,i,_]}class Xk extends _o{constructor(i){super(),yo(this,i,D9,k9,go,{name:0})}}const L9=(r,i)=>{const o=c=>{c!=null&&c.target&&r&&!r.contains(c.target)&&!c.defaultPrevented&&i()};return document.addEventListener("click",o,!0),{destroy(){document.removeEventListener("click",o,!0)}}},O9=r=>({hidden:r&1}),fC=r=>({hidden:r[0]});function pC(r){let i,o,c,h,m,_,x;function s(q,Y){if(q[4]&&q[1])return z9;if(q[4]&&!q[1])return R9}let M=s(r),P=M&&M(r);const L=r[25].default,F=Dh(L,r,r[24],fC);let V=[{id:r[6]},r[15],{class:c=ef(r[7],r[3],r[2],r[10][r[5]],r[16].class)},{tabindex:"-1"},{"aria-controls":r[6]},{"aria-labelledby":r[6]}],X={};for(let q=0;q<V.length;q+=1)X=Cl(X,V[q]);return{c(){P&&P.c(),i=Si(),o=$e("div"),F&&F.c(),this.h()},l(q){P&&P.l(q),i=Mi(q),o=Qe(q,"DIV",{id:!0,class:!0,tabindex:!0,"aria-controls":!0,"aria-labelledby":!0});var Y=Et(o);F&&F.l(Y),Y.forEach(ze),this.h()},h(){Ud(o,X)},m(q,Y){P&&P.m(q,Y),yi(q,i,Y),yi(q,o,Y),F&&F.m(o,null),m=!0,_||(x=UR(r[14].call(null,o,r[12])),_=!0)},p(q,Y){r=q,M===(M=s(r))&&P?P.p(r,Y):(P&&P.d(1),P=M&&M(r),P&&(P.c(),P.m(i.parentNode,i))),F&&F.p&&(!m||Y&16777217)&&Lh(F,L,r,r[24],m?Rh(L,r[24],Y,O9):Oh(r[24]),fC),Ud(o,X=yy(V,[(!m||Y&64)&&{id:r[6]},Y&32768&&r[15],(!m||Y&65708&&c!==(c=ef(r[7],r[3],r[2],r[10][r[5]],r[16].class)))&&{class:c},{tabindex:"-1"},(!m||Y&64)&&{"aria-controls":r[6]},(!m||Y&64)&&{"aria-labelledby":r[6]}]))},i(q){m||($i(F,q),q&&tf(()=>{m&&(h||(h=V_(o,r[9],r[8],!0)),h.run(1))}),m=!0)},o(q){ln(F,q),q&&(h||(h=V_(o,r[9],r[8],!1)),h.run(0)),m=!1},d(q){q&&(ze(i),ze(o)),P&&P.d(q),F&&F.d(q),q&&h&&h.end(),_=!1,x()}}}function R9(r){let i;return{c(){i=$e("div"),this.h()},l(o){i=Qe(o,"DIV",{role:!0,class:!0}),Et(i).forEach(ze),this.h()},h(){be(i,"role","presentation"),be(i,"class",r[13])},m(o,c){yi(o,i,c)},p:_r,d(o){o&&ze(i)}}}function z9(r){let i,o,c;return{c(){i=$e("div"),this.h()},l(h){i=Qe(h,"DIV",{role:!0,class:!0}),Et(i).forEach(ze),this.h()},h(){be(i,"role","presentation"),be(i,"class",r[13])},m(h,m){yi(h,i,m),o||(c=Ei(i,"click",r[26]),o=!0)},p:_r,d(h){h&&ze(i),o=!1,c()}}}function F9(r){let i,o,c=!r[0]&&pC(r);return{c(){c&&c.c(),i=hr()},l(h){c&&c.l(h),i=hr()},m(h,m){c&&c.m(h,m),yi(h,i,m),o=!0},p(h,[m]){h[0]?c&&(yc(),ln(c,1,1,()=>{c=null}),vc()):c?(c.p(h,m),m&1&&$i(c,1)):(c=pC(h),c.c(),$i(c,1),c.m(i.parentNode,i))},i(h){o||($i(c),o=!0)},o(h){ln(c),o=!1},d(h){h&&ze(i),c&&c.d(h)}}}function B9(r,i,o){const c=["activateClickOutside","hidden","position","leftOffset","rightOffset","topOffset","bottomOffset","width","backdrop","bgColor","bgOpacity","placement","id","divClass","transitionParams","transitionType"];let h=Nd(i,c),{$$slots:m={},$$scope:_}=i,{activateClickOutside:x=!0}=i,{hidden:s=!0}=i,{position:M="fixed"}=i,{leftOffset:P="inset-y-0 start-0"}=i,{rightOffset:L="inset-y-0 end-0"}=i,{topOffset:F="inset-x-0 top-0"}=i,{bottomOffset:V="inset-x-0 bottom-0"}=i,{width:X="w-80"}=i,{backdrop:q=!0}=i,{bgColor:Y="bg-gray-900"}=i,{bgOpacity:J="bg-opacity-75"}=i,{placement:ue="left"}=i,{id:ce="drawer-example"}=i,{divClass:fe="overflow-y-auto z-50 p-4 bg-white dark:bg-gray-800"}=i,{transitionParams:Ae={}}=i,{transitionType:Ce="fly"}=i;function He(mt,Ft){switch(Ce){case"slide":return dU(mt,Ft);case"blur":return uU(mt,Ft);case"fade":return hU(mt,Ft);default:return dk(mt,Ft)}}const We={left:P,right:L,top:F,bottom:V},nt=()=>{o(0,s=!s)},we=()=>x&&!s&&nt();let ht=ef("fixed top-0 start-0 z-50 w-full h-full",q&&Y,q&&J);function pt(mt,Ft){return x?L9(mt,Ft):void 0}const Xe=()=>!s&&nt();return r.$$set=mt=>{o(16,i=Cl(Cl({},i),Vd(mt))),o(15,h=Nd(i,c)),"activateClickOutside"in mt&&o(1,x=mt.activateClickOutside),"hidden"in mt&&o(0,s=mt.hidden),"position"in mt&&o(2,M=mt.position),"leftOffset"in mt&&o(17,P=mt.leftOffset),"rightOffset"in mt&&o(18,L=mt.rightOffset),"topOffset"in mt&&o(19,F=mt.topOffset),"bottomOffset"in mt&&o(20,V=mt.bottomOffset),"width"in mt&&o(3,X=mt.width),"backdrop"in mt&&o(4,q=mt.backdrop),"bgColor"in mt&&o(21,Y=mt.bgColor),"bgOpacity"in mt&&o(22,J=mt.bgOpacity),"placement"in mt&&o(5,ue=mt.placement),"id"in mt&&o(6,ce=mt.id),"divClass"in mt&&o(7,fe=mt.divClass),"transitionParams"in mt&&o(8,Ae=mt.transitionParams),"transitionType"in mt&&o(23,Ce=mt.transitionType),"$$scope"in mt&&o(24,_=mt.$$scope)},i=Vd(i),[s,x,M,X,q,ue,ce,fe,Ae,He,We,nt,we,ht,pt,h,i,P,L,F,V,Y,J,Ce,_,m,Xe]}class Yk extends _o{constructor(i){super(),yo(this,i,B9,F9,go,{activateClickOutside:1,hidden:0,position:2,leftOffset:17,rightOffset:18,topOffset:19,bottomOffset:20,width:3,backdrop:4,bgColor:21,bgOpacity:22,placement:5,id:6,divClass:7,transitionParams:8,transitionType:23})}}function N9(r){let i,o,c='<img class="d-block" src="assets/img/icon/close.svg" alt=""/>',h,m,_='<p class="icon me-15 mb-0"><img style="height: 25px;" src="assets/img/icon/base-map.svg" alt=""/></p> <p class="text blue-600 text-2lg font-bold mb-0">Base Map</p>',x,s,M,P,L,F,V,X,q,Y,J,ue,ce='<p class="text-sm mb-0">Light</p> <p class="text-xs">Displays a map in light theme</p>',fe,Ae,Ce,He,We,nt,we,ht,pt,Xe='<p class="text-sm mb-0">Dark</p> <p class="text-xs">Displays a map in dark theme</p>',mt,Ft,tt,ei,ki,rt,yt,Xt,kt,Ue='<p class="text-sm mb-0">Classic</p> <p class="text-xs">Displays the default road map view</p>',Ye,Kt,vi,en,Li,Zi,it,Sn,dr,Hr='<p class="text-sm mb-0">Wind</p> <p class="text-xs">wind forecast data (6 hourly from NOAA)</p>',xi,wt;return{c(){i=$e("div"),o=$e("a"),o.innerHTML=c,h=Si(),m=$e("div"),m.innerHTML=_,x=Si(),s=$e("div"),M=$e("div"),P=$e("div"),L=$e("a"),F=$e("div"),V=$e("div"),X=$e("p"),q=$e("img"),J=Si(),ue=$e("div"),ue.innerHTML=ce,fe=Si(),Ae=$e("a"),Ce=$e("div"),He=$e("div"),We=$e("p"),nt=$e("img"),ht=Si(),pt=$e("div"),pt.innerHTML=Xe,mt=Si(),Ft=$e("a"),tt=$e("div"),ei=$e("div"),ki=$e("p"),rt=$e("img"),Xt=Si(),kt=$e("div"),kt.innerHTML=Ue,Ye=Si(),Kt=$e("a"),vi=$e("div"),en=$e("div"),Li=$e("p"),Zi=$e("img"),Sn=Si(),dr=$e("div"),dr.innerHTML=Hr,this.h()},l(ni){i=Qe(ni,"DIV",{id:!0,class:!0});var Ve=Et(i);o=Qe(Ve,"A",{class:!0,"data-svelte-h":!0}),xn(o)!=="svelte-1fsuvn8"&&(o.innerHTML=c),h=Mi(Ve),m=Qe(Ve,"DIV",{class:!0,"data-svelte-h":!0}),xn(m)!=="svelte-m2t4hp"&&(m.innerHTML=_),x=Mi(Ve),s=Qe(Ve,"DIV",{class:!0});var ne=Et(s);M=Qe(ne,"DIV",{class:!0});var pe=Et(M);P=Qe(pe,"DIV",{class:!0});var Ie=Et(P);L=Qe(Ie,"A",{class:!0});var xt=Et(L);F=Qe(xt,"DIV",{class:!0});var vt=Et(F);V=Qe(vt,"DIV",{class:!0});var Wt=Et(V);X=Qe(Wt,"P",{class:!0});var Jt=Et(X);q=Qe(Jt,"IMG",{class:!0,src:!0,alt:!0}),Jt.forEach(ze),Wt.forEach(ze),J=Mi(vt),ue=Qe(vt,"DIV",{class:!0,"data-svelte-h":!0}),xn(ue)!=="svelte-th25ga"&&(ue.innerHTML=ce),vt.forEach(ze),xt.forEach(ze),fe=Mi(Ie),Ae=Qe(Ie,"A",{class:!0});var Tt=Et(Ae);Ce=Qe(Tt,"DIV",{class:!0});var li=Et(Ce);He=Qe(li,"DIV",{class:!0});var wi=Et(He);We=Qe(wi,"P",{class:!0});var $t=Et(We);nt=Qe($t,"IMG",{class:!0,src:!0,alt:!0}),$t.forEach(ze),wi.forEach(ze),ht=Mi(li),pt=Qe(li,"DIV",{class:!0,"data-svelte-h":!0}),xn(pt)!=="svelte-174u9f6"&&(pt.innerHTML=Xe),li.forEach(ze),Tt.forEach(ze),mt=Mi(Ie),Ft=Qe(Ie,"A",{class:!0});var cn=Et(Ft);tt=Qe(cn,"DIV",{class:!0});var dn=Et(tt);ei=Qe(dn,"DIV",{class:!0});var Fn=Et(ei);ki=Qe(Fn,"P",{class:!0});var gn=Et(ki);rt=Qe(gn,"IMG",{class:!0,src:!0,alt:!0}),gn.forEach(ze),Fn.forEach(ze),Xt=Mi(dn),kt=Qe(dn,"DIV",{class:!0,"data-svelte-h":!0}),xn(kt)!=="svelte-11gc5uy"&&(kt.innerHTML=Ue),dn.forEach(ze),cn.forEach(ze),Ye=Mi(Ie),Kt=Qe(Ie,"A",{class:!0});var wn=Et(Kt);vi=Qe(wn,"DIV",{class:!0});var Je=Et(vi);en=Qe(Je,"DIV",{class:!0});var mi=Et(en);Li=Qe(mi,"P",{class:!0});var Gi=Et(Li);Zi=Qe(Gi,"IMG",{class:!0,src:!0,alt:!0}),Gi.forEach(ze),mi.forEach(ze),Sn=Mi(Je),dr=Qe(Je,"DIV",{class:!0,"data-svelte-h":!0}),xn(dr)!=="svelte-e8401g"&&(dr.innerHTML=Hr),Je.forEach(ze),wn.forEach(ze),Ie.forEach(ze),pe.forEach(ze),ne.forEach(ze),Ve.forEach(ze),this.h()},h(){be(o,"class","btn-close border-0 d-flex align-items-center justify-content-center"),be(m,"class","head border-bottom border-green d-flex align-items-center mb-1 pb-1 w-100"),be(q,"class","d-block w-100"),qg(q.src,Y=U9)||be(q,"src",Y),be(q,"alt",""),be(X,"class","pic mb-0 me-1"),be(V,"class","col-auto"),be(ue,"class","col"),be(F,"class","row no-gutters align-items-center"),be(L,"class","d-block item mb-1 p-1"),be(nt,"class","d-block w-100"),qg(nt.src,we=j9)||be(nt,"src",we),be(nt,"alt",""),be(We,"class","pic mb-0 me-1"),be(He,"class","col-auto"),be(pt,"class","col"),be(Ce,"class","row no-gutters align-items-center"),be(Ae,"class","d-block item mb-1 p-1"),be(rt,"class","d-block w-100"),qg(rt.src,yt=V9)||be(rt,"src",yt),be(rt,"alt",""),be(ki,"class","pic mb-0 me-1"),be(ei,"class","col-auto"),be(kt,"class","col"),be(tt,"class","row no-gutters align-items-center"),be(Ft,"class","d-block item mb-1 p-1"),be(Zi,"class","d-block w-100"),qg(Zi.src,it=G9)||be(Zi,"src",it),be(Zi,"alt",""),be(Li,"class","pic mb-0 me-1"),be(en,"class","col-auto"),be(dr,"class","col"),be(vi,"class","row no-gutters align-items-center"),be(Kt,"class","d-block item mb-1 p-1 active"),be(P,"class","list__info"),be(M,"class","box__overflow pe-1"),be(s,"class","box__description"),be(i,"id","mapsettingPanel"),be(i,"class","box__info-base-map p-2 rounded")},m(ni,Ve){yi(ni,i,Ve),De(i,o),De(i,h),De(i,m),De(i,x),De(i,s),De(s,M),De(M,P),De(P,L),De(L,F),De(F,V),De(V,X),De(X,q),De(F,J),De(F,ue),De(P,fe),De(P,Ae),De(Ae,Ce),De(Ce,He),De(He,We),De(We,nt),De(Ce,ht),De(Ce,pt),De(P,mt),De(P,Ft),De(Ft,tt),De(tt,ei),De(ei,ki),De(ki,rt),De(tt,Xt),De(tt,kt),De(P,Ye),De(P,Kt),De(Kt,vi),De(vi,en),De(en,Li),De(Li,Zi),De(vi,Sn),De(vi,dr),xi||(wt=[Ei(o,"click",r[2]),Ei(L,"click",r[3]),Ei(Ae,"click",r[4]),Ei(Ft,"click",r[5]),Ei(Kt,"click",H9)],xi=!0)},p:_r,i:_r,o:_r,d(ni){ni&&ze(i),xi=!1,rs(wt)}}}const V9="/assets/img/classic-basemap.png",U9="/assets/img/light-basemap.png",j9="/assets/img/dark-basemap.png",G9="/assets/img/wind-basemap.png";function H9(){console.log("toggle wind");const r=document.querySelector(".wind-map-container");r.style.display=r.style.display==="none"?"block":"none"}function q9(r,i,o){let c,h;return Fi(r,Yd,M=>o(0,c=M)),Fi(r,kp,M=>o(1,h=M)),[c,h,()=>an(Yd,c=!1,c),()=>an(kp,h="cltinohfj002101pc7cut13aj",h),()=>an(kp,h="cltiptdlg004y01ph1rm84xru",h),()=>an(kp,h="ckb2mbm240t2s1itc1dtmk5pf",h)]}class W9 extends _o{constructor(i){super(),yo(this,i,q9,N9,go,{})}}function Z9(r){let i,o,c="Mekong PM2.5 Ranking",h,m,_,x,s,M,P,L,F,V,X,q,Y='<div class="d-flex justify-content-start"><div class="p-2 width10  svelte-27zeta">#</div> <div class="p-2 width70 svelte-27zeta">Major city</div> <div class="p-2 width20 svelte-27zeta"></div></div>',J,ue,ce='<div class="d-flex justify-content-start"><div class="p-2 width10 svelte-27zeta">1</div> <div class="p-2 width70 flex svelte-27zeta"><div class="mr-1"></div> <div>Thailand, Bangkok</div></div> <div class="p-2 width20 svelte-27zeta"><span class="badge rounded-pill bg-success svelte-27zeta">234</span></div></div>',fe,Ae,Ce='<div class="d-flex justify-content-start"><div class="p-2 width10 svelte-27zeta">1</div> <div class="p-2 width70 flex svelte-27zeta"><div class="mr-1"></div> <div>Thailand, Bangkok</div></div> <div class="p-2 width20 svelte-27zeta"><span class="badge rounded-pill bg-success svelte-27zeta">12</span></div></div>',He,We,nt='<div class="d-flex justify-content-start"><div class="p-2 width10 svelte-27zeta">1</div> <div class="p-2 flex width70 svelte-27zeta"><div class="mr-1"></div> <div>Laos, Bangkok</div></div> <div class="p-2 width20 svelte-27zeta"><span class="badge rounded-pill bg-success svelte-27zeta">32</span></div></div>',we,ht,pt='<div class="d-flex justify-content-start"><div class="p-2 width10 svelte-27zeta">1</div> <div class="p-2 width70 flex svelte-27zeta"><div class="mr-1"></div> <div>Thailand, Bangkok</div></div> <div class="p-2 width20 svelte-27zeta"><span class="badge rounded-pill bg-success svelte-27zeta">234</span></div></div>',Xe,mt,Ft='<div class="d-flex justify-content-start"><div class="p-2 width10 svelte-27zeta">1</div> <div class="p-2 width70 flex svelte-27zeta"><div class="mr-1"></div> <div>Thailand, Bangkok</div></div> <div class="p-2 width20 svelte-27zeta"><span class="badge rounded-pill bg-success svelte-27zeta">64</span></div></div>',tt,ei,ki;return m=new Xk({props:{class:"mb-4 dark:text-white"}}),m.$on("click",r[5]),{c(){i=$e("div"),o=$e("h5"),o.textContent=c,h=Si(),oo(m.$$.fragment),_=Si(),x=$e("p"),s=Vn(r[1]),M=Vn(":00:00"),P=Si(),L=$e("p"),F=Vn(r[2]),V=Si(),X=$e("ul"),q=$e("li"),q.innerHTML=Y,J=Si(),ue=$e("li"),ue.innerHTML=ce,fe=Si(),Ae=$e("li"),Ae.innerHTML=Ce,He=Si(),We=$e("li"),We.innerHTML=nt,we=Si(),ht=$e("li"),ht.innerHTML=pt,Xe=Si(),mt=$e("li"),mt.innerHTML=Ft,this.h()},l(rt){i=Qe(rt,"DIV",{class:!0});var yt=Et(i);o=Qe(yt,"H5",{id:!0,class:!0,"data-svelte-h":!0}),xn(o)!=="svelte-1huxu54"&&(o.textContent=c),h=Mi(yt),so(m.$$.fragment,yt),yt.forEach(ze),_=Mi(rt),x=Qe(rt,"P",{class:!0});var Xt=Et(x);s=Un(Xt,r[1]),M=Un(Xt,":00:00"),Xt.forEach(ze),P=Mi(rt),L=Qe(rt,"P",{class:!0});var kt=Et(L);F=Un(kt,r[2]),kt.forEach(ze),V=Mi(rt),X=Qe(rt,"UL",{class:!0});var Ue=Et(X);q=Qe(Ue,"LI",{class:!0,"data-svelte-h":!0}),xn(q)!=="svelte-1okprzs"&&(q.innerHTML=Y),J=Mi(Ue),ue=Qe(Ue,"LI",{class:!0,"data-svelte-h":!0}),xn(ue)!=="svelte-3m399m"&&(ue.innerHTML=ce),fe=Mi(Ue),Ae=Qe(Ue,"LI",{class:!0,"data-svelte-h":!0}),xn(Ae)!=="svelte-hpbjqw"&&(Ae.innerHTML=Ce),He=Mi(Ue),We=Qe(Ue,"LI",{class:!0,"data-svelte-h":!0}),xn(We)!=="svelte-1eufhda"&&(We.innerHTML=nt),we=Mi(Ue),ht=Qe(Ue,"LI",{class:!0,"data-svelte-h":!0}),xn(ht)!=="svelte-1wr7g18"&&(ht.innerHTML=pt),Xe=Mi(Ue),mt=Qe(Ue,"LI",{class:!0,"data-svelte-h":!0}),xn(mt)!=="svelte-1pczod"&&(mt.innerHTML=Ft),Ue.forEach(ze),this.h()},h(){be(o,"id","drawer-label"),be(o,"class","inline-flex items-center mb-4 text-base font-semibold text-gray-800 dark:text-gray-400"),be(i,"class","flex items-center"),be(x,"class","text-sm text-gray-500 dark:text-gray-400 float-right"),be(L,"class","text-sm text-gray-500 dark:text-gray-400 mb-2"),be(q,"class","list-group-item"),be(ue,"class","list-group-item text-xs"),be(Ae,"class","list-group-item text-xs"),be(We,"class","list-group-item text-xs"),be(ht,"class","list-group-item text-xs"),be(mt,"class","list-group-item text-xs"),be(X,"class","list-group text-sm")},m(rt,yt){yi(rt,i,yt),De(i,o),De(i,h),ao(m,i,null),yi(rt,_,yt),yi(rt,x,yt),De(x,s),De(x,M),yi(rt,P,yt),yi(rt,L,yt),De(L,F),yi(rt,V,yt),yi(rt,X,yt),De(X,q),De(X,J),De(X,ue),De(X,fe),De(X,Ae),De(X,He),De(X,We),De(X,we),De(X,ht),De(X,Xe),De(X,mt),tt=!0,ei||(ki=[Ei(ue,"click",r[6]),Ei(Ae,"click",r[7]),Ei(We,"click",r[8]),Ei(ht,"click",r[9]),Ei(mt,"click",r[10])],ei=!0)},p(rt,yt){(!tt||yt&2)&&jr(s,rt[1]),(!tt||yt&4)&&jr(F,rt[2])},i(rt){tt||($i(m.$$.fragment,rt),tt=!0)},o(rt){ln(m.$$.fragment,rt),tt=!1},d(rt){rt&&(ze(i),ze(_),ze(x),ze(P),ze(L),ze(V),ze(X)),lo(m),ei=!1,rs(ki)}}}function X9(r){let i,o,c;function h(_){r[11](_)}let m={activateClickOutside:Y9,backdrop:J9,rightOffset:"top-14 h-screen end-0",placement:"right",transitionType:"fly",transitionParams:r[3],id:"sidebar6",$$slots:{default:[Z9]},$$scope:{ctx:r}};return r[0]!==void 0&&(m.hidden=r[0]),i=new Yk({props:m}),Zr.push(()=>Wa(i,"hidden",h)),{c(){oo(i.$$.fragment)},l(_){so(i.$$.fragment,_)},m(_,x){ao(i,_,x),c=!0},p(_,[x]){const s={};x&65543&&(s.$$scope={dirty:x,ctx:_}),!o&&x&1&&(o=!0,s.hidden=_[0],qa(()=>o=!1)),i.$set(s)},i(_){c||($i(i.$$.fragment,_),c=!0)},o(_){ln(i.$$.fragment,_),c=!1},d(_){lo(i,_)}}}let Y9=!1,J9=!1;function K9(r,i,o){let c,h,m,_,x,s,M;Fi(r,NA,ce=>o(12,c=ce)),Fi(r,eb,ce=>o(13,h=ce)),Fi(r,Qx,ce=>o(14,m=ce)),Fi(r,du,ce=>o(15,_=ce)),Fi(r,Sc,ce=>o(0,x=ce)),Fi(r,P_,ce=>o(1,s=ce)),Fi(r,Yx,ce=>o(2,M=ce));let P={x:320,duration:200,easing:hk};function L(ce,fe,Ae){an(du,_=!1,_),an(Qx,m=ce,m),an(eb,h=fe,h),an(NA,c=Ae,c)}const F=()=>an(Sc,x=!0,x),V=()=>L(11.2,100.2,"Thailand, Bangkok"),X=()=>L(11.2,100.2,"Thailand, Bangkok"),q=()=>L(11.2,100.2,"Thailand, Bangkok"),Y=()=>L(11.2,100.2,"Thailand, Bangkok"),J=()=>L(11.2,100.2,"Thailand, Bangkok");function ue(ce){x=ce,Sc.set(x)}return[x,s,M,P,L,F,V,X,q,Y,J,ue]}class $9 extends _o{constructor(i){super(),yo(this,i,K9,X9,go,{})}}function mC(r,i,o){const c=r.slice();return c[5]=i[o],c}function gC(r){let i,o=r[5].name+"",c;return{c(){i=$e("option"),c=Vn(o),this.h()},l(h){i=Qe(h,"OPTION",{});var m=Et(i);c=Un(m,o),m.forEach(ze),this.h()},h(){i.__value=r[5].value,ea(i,i.__value)},m(h,m){yi(h,i,m),De(i,c)},p:_r,d(h){h&&ze(i)}}}function Q9(r){let i,o,c='<img class="d-block" src="assets/img/icon/close.svg" alt=""/>',h,m,_='<p class="icon me-15 mb-0"><img style="height: 25px;" src="assets/img/icon/head-air-quality.svg" alt=""/></p> <p class="text blue-600 text-2lg font-bold mb-0">Air Pollutant</p>',x,s,M,P="Select air pollutant",L,F,V,X,q=Nr(r[2]),Y=[];for(let J=0;J<q.length;J+=1)Y[J]=gC(mC(r,q,J));return{c(){i=$e("div"),o=$e("a"),o.innerHTML=c,h=Si(),m=$e("div"),m.innerHTML=_,x=Si(),s=$e("div"),M=$e("p"),M.textContent=P,L=Si(),F=$e("select");for(let J=0;J<Y.length;J+=1)Y[J].c();this.h()},l(J){i=Qe(J,"DIV",{id:!0,class:!0});var ue=Et(i);o=Qe(ue,"A",{class:!0,"data-svelte-h":!0}),xn(o)!=="svelte-1w7gzh6"&&(o.innerHTML=c),h=Mi(ue),m=Qe(ue,"DIV",{class:!0,"data-svelte-h":!0}),xn(m)!=="svelte-12jx70m"&&(m.innerHTML=_),x=Mi(ue),s=Qe(ue,"DIV",{class:!0});var ce=Et(s);M=Qe(ce,"P",{class:!0,"data-svelte-h":!0}),xn(M)!=="svelte-1cqawmn"&&(M.textContent=P),L=Mi(ce),F=Qe(ce,"SELECT",{class:!0,id:!0});var fe=Et(F);for(let Ae=0;Ae<Y.length;Ae+=1)Y[Ae].l(fe);fe.forEach(ze),ce.forEach(ze),ue.forEach(ze),this.h()},h(){be(o,"class","btn-close border-0 d-flex align-items-center justify-content-center"),be(m,"class","head border-bottom border-green d-flex align-items-center mb-1 pb-1 w-100"),be(M,"class","blue-600"),be(F,"class","nice-select wide selectize"),be(F,"id","select-pollutant"),r[1]===void 0&&tf(()=>r[4].call(F)),be(s,"class","box__description"),be(i,"id","select_air_pollutant"),be(i,"class","box__info-air-quality p-2 rounded")},m(J,ue){yi(J,i,ue),De(i,o),De(i,h),De(i,m),De(i,x),De(i,s),De(s,M),De(s,L),De(s,F);for(let ce=0;ce<Y.length;ce+=1)Y[ce]&&Y[ce].m(F,null);ya(F,r[1],!0),V||(X=[Ei(o,"click",r[3]),Ei(F,"change",r[4])],V=!0)},p(J,[ue]){if(ue&4){q=Nr(J[2]);let ce;for(ce=0;ce<q.length;ce+=1){const fe=mC(J,q,ce);Y[ce]?Y[ce].p(fe,ue):(Y[ce]=gC(fe),Y[ce].c(),Y[ce].m(F,null))}for(;ce<Y.length;ce+=1)Y[ce].d(1);Y.length=q.length}ue&6&&ya(F,J[1])},i:_r,o:_r,d(J){J&&ze(i),_a(Y,J),V=!1,rs(X)}}}function eH(r,i,o){let c,h;Fi(r,Jd,s=>o(0,c=s)),Fi(r,Qp,s=>o(1,h=s));let m=[{value:"pm25",name:"PM2.5"},{value:"no2",name:"Nitrogen dioxide (NO2)"}];setTimeout(()=>{NiceSelect.bind(document.querySelector("#select-pollutant"))},50);const _=()=>an(Jd,c=!1,c);function x(){h=_y(this),Qp.set(h),o(2,m)}return[c,h,m,_,x]}class tH extends _o{constructor(i){super(),yo(this,i,eH,Q9,go,{})}}function Jk(r,i,o,c){r.data.labels=i,r.data.datasets[0].data=o,r.update()}function Kk(r){r.data.labels=[],r.data.datasets[0].data=[],r.update()}function iH(r){let i,o,c="PM 2.5 forecast of Thailand, Bangkok",h,m,_,x,s=`<div><p class="max-w-lg mb-6 text-sm text-gray-500 dark:text-gray-400">GEOS Air Quality Forecasts bias-corrected using machine learning algorithm</p></div> <div class="float-right"><div class="flex"><div class="mr-2"><span class="badge rounded-pill bg-success svelte-1925r2e">Min 234
						<p class="svelte-1925r2e">2024-01-01 01:00:00</p></span></div> <div class=""><span class="badge rounded-pill bg-warning svelte-1925r2e">Max 234
						<p class="svelte-1925r2e">2024-01-01 01:00:00</p></span></div></div></div>`,M,P,L,F;return m=new Xk({props:{class:"mb-4 dark:text-white"}}),m.$on("click",r[5]),{c(){i=$e("div"),o=$e("h5"),o.textContent=c,h=Si(),oo(m.$$.fragment),_=Si(),x=$e("div"),x.innerHTML=s,M=Si(),P=$e("div"),L=$e("canvas"),this.h()},l(V){i=Qe(V,"DIV",{class:!0});var X=Et(i);o=Qe(X,"H5",{id:!0,class:!0,"data-svelte-h":!0}),xn(o)!=="svelte-ntawnk"&&(o.textContent=c),h=Mi(X),so(m.$$.fragment,X),X.forEach(ze),_=Mi(V),x=Qe(V,"DIV",{class:!0,"data-svelte-h":!0}),xn(x)!=="svelte-1eugj9f"&&(x.innerHTML=s),M=Mi(V),P=Qe(V,"DIV",{class:!0,style:!0});var q=Et(P);L=Qe(q,"CANVAS",{id:!0}),Et(L).forEach(ze),q.forEach(ze),this.h()},h(){be(o,"id","drawer-label"),be(o,"class","inline-flex items-center mb-4 text-base font-semibold text-gray-500 dark:text-gray-400"),be(i,"class","flex items-center"),be(x,"class","flex justify-between"),be(L,"id","myChart2"),be(P,"class","chart-container"),El(P,"position","relative"),El(P,"height","15vh"),El(P,"width","90vw")},m(V,X){yi(V,i,X),De(i,o),De(i,h),ao(m,i,null),yi(V,_,X),yi(V,x,X),yi(V,M,X),yi(V,P,X),De(P,L),r[6](L),F=!0},p:_r,i(V){F||($i(m.$$.fragment,V),F=!0)},o(V){ln(m.$$.fragment,V),F=!1},d(V){V&&(ze(i),ze(_),ze(x),ze(M),ze(P)),lo(m),r[6](null)}}}function nH(r){let i,o,c;function h(_){r[7](_)}let m={activateClickOutside:rH,backdrop:oH,placement:"bottom",width:"w-full",transitionType:"fly",transitionParams:r[2],id:"sidebar8",class:"shadow-lg",$$slots:{default:[iH]},$$scope:{ctx:r}};return r[0]!==void 0&&(m.hidden=r[0]),i=new Yk({props:m}),Zr.push(()=>Wa(i,"hidden",h)),{c(){oo(i.$$.fragment)},l(_){so(i.$$.fragment,_)},m(_,x){ao(i,_,x),c=!0},p(_,[x]){const s={};x&4099&&(s.$$scope={dirty:x,ctx:_}),!o&&x&1&&(o=!0,s.hidden=_[0],qa(()=>o=!1)),i.$set(s)},i(_){c||($i(i.$$.fragment,_),c=!0)},o(_){ln(i.$$.fragment,_),c=!1},d(_){lo(i,_)}}}let rH=!1,oH=!1;function sH(r,i,o){let c,h,m,_;Fi(r,Qx,q=>o(3,c=q)),Fi(r,eb,q=>o(4,h=q)),Fi(r,du,q=>o(0,m=q)),Fi(r,Cy,q=>o(10,_=q));let x,s,M,P={y:320,duration:200,easing:hk};async function L(q,Y){let J=vx+"/mapclient";const ue=_.replace("-","").replace("-","");console.log(q);let ce={action:"get-chartData",freq_chart:"3dayrecent",geom_data:q,interaction:Y,run_date_chart:ue+".nc",run_type_chart:"geos",variable:"BC_MLPM25"};const fe=await Gr.get(J,{params:ce,headers:{Authorization:"admin.KRg06uWinwXAL5SRRCBSmH2HON4tZKdpCItHpbZh7HghJFFH6mIizlNM01"}});if(fe.data){let Ce=fe.data.data.plot,He=Ce.map(nt=>new Date(nt[0]).toLocaleString("en-GB",{hour12:!1}));Ce.map(function(nt){return nt[1]<20?"#8b81ba":nt[1]<40?"#6ca7cc":nt[1]<60?"#91d2bd":nt[1]<80?"#fbfbcf":nt[1]<100?"#b44674":"#ddd"});let We=Ce.map(nt=>nt[1]);x=s.getContext("2d"),M=new Sl(x,{type:"line",options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},filler:{propagate:!1}},scales:{x:{ticks:{font:{size:10},type:"time",autoSkip:!0,maxTicksLimit:3,autoSkipPadding:10},gridLines:{display:!1}},y:{ticks:{font:{size:10}},title:{display:!0,text:"PM 2.5",font:{size:10}}}}},data:{labels:[],datasets:[{label:"PM2.5",backgroundColor:"rgb(255, 165, 0, 0.2)",borderColor:"rgb(255, 165, 0, 0.2)",data:[],lineTension:.3,fill:{target:"origin",above:"rgba(255, 165, 0, 0.2)",below:"rgba(255, 165, 0, 0.2)"}}]}}),Kk(M),Jk(M,He,We)}}const F=()=>an(du,m=!0,m);function V(q){Zr[q?"unshift":"push"](()=>{s=q,o(1,s)})}function X(q){m=q,du.set(m)}return r.$$.update=()=>{if(r.$$.dirty&25&&m===!1){let q=h.toString()+","+c.toString();L(q,"Point")}},[m,s,P,c,h,F,V,X]}class aH extends _o{constructor(i){super(),yo(this,i,sH,nH,go,{})}}const B_=yr(!1);B_.subscribe,B_.set,B_.update;function _C(r){let i,o;return i=new N7({}),{c(){oo(i.$$.fragment)},l(c){so(i.$$.fragment,c)},m(c,h){ao(i,c,h),o=!0},i(c){o||($i(i.$$.fragment,c),o=!0)},o(c){ln(i.$$.fragment,c),o=!1},d(c){lo(i,c)}}}function yC(r){let i,o;return i=new j7({}),{c(){oo(i.$$.fragment)},l(c){so(i.$$.fragment,c)},m(c,h){ao(i,c,h),o=!0},i(c){o||($i(i.$$.fragment,c),o=!0)},o(c){ln(i.$$.fragment,c),o=!1},d(c){lo(i,c)}}}function vC(r){let i,o;return i=new q7({}),{c(){oo(i.$$.fragment)},l(c){so(i.$$.fragment,c)},m(c,h){ao(i,c,h),o=!0},i(c){o||($i(i.$$.fragment,c),o=!0)},o(c){ln(i.$$.fragment,c),o=!1},d(c){lo(i,c)}}}function xC(r){let i,o;return i=new tH({}),{c(){oo(i.$$.fragment)},l(c){so(i.$$.fragment,c)},m(c,h){ao(i,c,h),o=!0},i(c){o||($i(i.$$.fragment,c),o=!0)},o(c){ln(i.$$.fragment,c),o=!1},d(c){lo(i,c)}}}function bC(r){let i,o;return i=new W9({}),{c(){oo(i.$$.fragment)},l(c){so(i.$$.fragment,c)},m(c,h){ao(i,c,h),o=!0},i(c){o||($i(i.$$.fragment,c),o=!0)},o(c){ln(i.$$.fragment,c),o=!1},d(c){lo(i,c)}}}function lH(r){let i,o="Air quality monitoring";return{c(){i=$e("h2"),i.textContent=o,this.h()},l(c){i=Qe(c,"H2",{class:!0,"data-svelte-h":!0}),xn(i)!=="svelte-bf0pzk"&&(i.textContent=o),this.h()},h(){be(i,"class","font-meduim text-lg text-slate-700 mb-0")},m(c,h){yi(c,i,h)},p:_r,d(c){c&&ze(i)}}}function cH(r){let i,o,c,h,m,_;return{c(){i=$e("p"),o=Vn("Location: "),c=Vn(r[1]),h=Si(),m=$e("div"),_=$e("canvas"),this.h()},l(x){i=Qe(x,"P",{class:!0});var s=Et(i);o=Un(s,"Location: "),c=Un(s,r[1]),s.forEach(ze),h=Mi(x),m=Qe(x,"DIV",{class:!0,style:!0});var M=Et(m);_=Qe(M,"CANVAS",{id:!0}),Et(_).forEach(ze),M.forEach(ze),this.h()},h(){be(i,"class","mt-0 font-light text-xs text-slate-500"),be(_,"id","myChart"),be(m,"class","chart-container"),El(m,"position","relative"),El(m,"height","15vh"),El(m,"width","40vw")},m(x,s){yi(x,i,s),De(i,o),De(i,c),yi(x,h,s),yi(x,m,s),De(m,_),r[19](_)},p(x,s){s&2&&jr(c,x[1])},d(x){x&&(ze(i),ze(h),ze(m)),r[19](null)}}}function uH(r){let i,o="Air quality monitoring";return{c(){i=$e("h2"),i.textContent=o,this.h()},l(c){i=Qe(c,"H2",{slot:!0,class:!0,"data-svelte-h":!0}),xn(i)!=="svelte-cd3bw0"&&(i.textContent=o),this.h()},h(){be(i,"slot","header"),be(i,"class","font-meduim text-lg text-slate-700 mb-0")},m(c,h){yi(c,i,h)},p:_r,d(c){c&&ze(i)}}}function hH(r){let i,o,c,h,m,_,x,s,M,P,L,F,V,X='<img src="assets/img/icon/icon-plus.svg" alt=""/>',q,Y,J='<img src="assets/img/icon/icon-minus.svg" alt=""/>',ue,ce,fe,Ae,Ce,He,We,nt,we,ht,pt,Xe,mt,Ft,tt,ei,ki,rt,yt,Xt=r[8]&&_C(),kt=r[9]&&yC(),Ue=r[10]&&vC();s=new IU({});let Ye=r[6]&&xC(),Kt=r[7]&&bC();function vi(xi){r[16](xi)}let en={};r[2]!==void 0&&(en.map=r[2]),fe=new GV({props:en}),Zr.push(()=>Wa(fe,"map",vi)),We=new bU({});function Li(xi){r[17](xi)}let Zi={};r[0]!==void 0&&(Zi.hiddenDrawer=r[0]),we=new $9({props:Zi}),Zr.push(()=>Wa(we,"hiddenDrawer",Li));function it(xi){r[18](xi)}let Sn={$$slots:{default:[lH]},$$scope:{ctx:r}};r[5]!==void 0&&(Sn.hiddenDrawer=r[5]),Xe=new aH({props:Sn}),Zr.push(()=>Wa(Xe,"hiddenDrawer",it));function dr(xi){r[20](xi)}let Hr={$$slots:{header:[uH],default:[cH]},$$scope:{ctx:r}};return r[3]!==void 0&&(Hr.showModal=r[3]),tt=new MU({props:Hr}),Zr.push(()=>Wa(tt,"showModal",dr)),{c(){i=$e("div"),o=$e("div"),c=$e("div"),Xt&&Xt.c(),h=Si(),kt&&kt.c(),m=Si(),Ue&&Ue.c(),_=Si(),x=$e("div"),oo(s.$$.fragment),M=Si(),Ye&&Ye.c(),P=Si(),Kt&&Kt.c(),L=Si(),F=$e("div"),V=$e("a"),V.innerHTML=X,q=Si(),Y=$e("a"),Y.innerHTML=J,ue=Si(),ce=$e("div"),oo(fe.$$.fragment),Ce=Si(),He=$e("div"),oo(We.$$.fragment),nt=Si(),oo(we.$$.fragment),pt=Si(),oo(Xe.$$.fragment),Ft=Si(),oo(tt.$$.fragment),this.h()},l(xi){i=Qe(xi,"DIV",{id:!0});var wt=Et(i);o=Qe(wt,"DIV",{class:!0});var ni=Et(o);c=Qe(ni,"DIV",{class:!0});var Ve=Et(c);Xt&&Xt.l(Ve),h=Mi(Ve),kt&&kt.l(Ve),m=Mi(Ve),Ue&&Ue.l(Ve),Ve.forEach(ze),ni.forEach(ze),_=Mi(wt),x=Qe(wt,"DIV",{id:!0,class:!0});var ne=Et(x);so(s.$$.fragment,ne),M=Mi(ne),Ye&&Ye.l(ne),P=Mi(ne),Kt&&Kt.l(ne),ne.forEach(ze),L=Mi(wt),F=Qe(wt,"DIV",{class:!0});var pe=Et(F);V=Qe(pe,"A",{class:!0,"data-svelte-h":!0}),xn(V)!=="svelte-1kv41tv"&&(V.innerHTML=X),q=Mi(pe),Y=Qe(pe,"A",{class:!0,"data-svelte-h":!0}),xn(Y)!=="svelte-15v47jt"&&(Y.innerHTML=J),pe.forEach(ze),ue=Mi(wt),ce=Qe(wt,"DIV",{class:!0});var Ie=Et(ce);so(fe.$$.fragment,Ie),Ie.forEach(ze),Ce=Mi(wt),He=Qe(wt,"DIV",{class:!0});var xt=Et(He);so(We.$$.fragment,xt),xt.forEach(ze),nt=Mi(wt),so(we.$$.fragment,wt),pt=Mi(wt),so(Xe.$$.fragment,wt),Ft=Mi(wt),so(tt.$$.fragment,wt),wt.forEach(ze),this.h()},h(){be(c,"class","slider"),be(o,"class","box__info-ugm"),be(x,"id","right-component"),be(x,"class","box__tool bg-white py-2 rounded"),be(V,"class","btn-plus d-flex align-items-center justify-content-center mb-1"),be(Y,"class","btn-minus d-flex align-items-center justify-content-center"),be(F,"class","box__zoom-map"),be(ce,"class","map overflow-hidden"),be(He,"class","absolute dateTime-position w-full flex justify-center items-stretch svelte-1mxola6"),be(i,"id","box__home")},m(xi,wt){yi(xi,i,wt),De(i,o),De(o,c),Xt&&Xt.m(c,null),De(c,h),kt&&kt.m(c,null),De(c,m),Ue&&Ue.m(c,null),De(i,_),De(i,x),ao(s,x,null),De(x,M),Ye&&Ye.m(x,null),De(x,P),Kt&&Kt.m(x,null),De(i,L),De(i,F),De(F,V),De(F,q),De(F,Y),De(i,ue),De(i,ce),ao(fe,ce,null),De(i,Ce),De(i,He),ao(We,He,null),De(i,nt),ao(we,i,null),De(i,pt),ao(Xe,i,null),De(i,Ft),ao(tt,i,null),ki=!0,rt||(yt=[Ei(V,"click",r[11]),Ei(Y,"click",r[12])],rt=!0)},p(xi,[wt]){xi[8]?Xt?wt&256&&$i(Xt,1):(Xt=_C(),Xt.c(),$i(Xt,1),Xt.m(c,h)):Xt&&(yc(),ln(Xt,1,1,()=>{Xt=null}),vc()),xi[9]?kt?wt&512&&$i(kt,1):(kt=yC(),kt.c(),$i(kt,1),kt.m(c,m)):kt&&(yc(),ln(kt,1,1,()=>{kt=null}),vc()),xi[10]?Ue?wt&1024&&$i(Ue,1):(Ue=vC(),Ue.c(),$i(Ue,1),Ue.m(c,null)):Ue&&(yc(),ln(Ue,1,1,()=>{Ue=null}),vc()),xi[6]?Ye?wt&64&&$i(Ye,1):(Ye=xC(),Ye.c(),$i(Ye,1),Ye.m(x,P)):Ye&&(yc(),ln(Ye,1,1,()=>{Ye=null}),vc()),xi[7]?Kt?wt&128&&$i(Kt,1):(Kt=bC(),Kt.c(),$i(Kt,1),Kt.m(x,null)):Kt&&(yc(),ln(Kt,1,1,()=>{Kt=null}),vc());const ni={};!Ae&&wt&4&&(Ae=!0,ni.map=xi[2],qa(()=>Ae=!1)),fe.$set(ni);const Ve={};!ht&&wt&1&&(ht=!0,Ve.hiddenDrawer=xi[0],qa(()=>ht=!1)),we.$set(Ve);const ne={};wt&536870912&&(ne.$$scope={dirty:wt,ctx:xi}),!mt&&wt&32&&(mt=!0,ne.hiddenDrawer=xi[5],qa(()=>mt=!1)),Xe.$set(ne);const pe={};wt&536870930&&(pe.$$scope={dirty:wt,ctx:xi}),!ei&&wt&8&&(ei=!0,pe.showModal=xi[3],qa(()=>ei=!1)),tt.$set(pe)},i(xi){ki||($i(Xt),$i(kt),$i(Ue),$i(s.$$.fragment,xi),$i(Ye),$i(Kt),$i(fe.$$.fragment,xi),$i(We.$$.fragment,xi),$i(we.$$.fragment,xi),$i(Xe.$$.fragment,xi),$i(tt.$$.fragment,xi),ki=!0)},o(xi){ln(Xt),ln(kt),ln(Ue),ln(s.$$.fragment,xi),ln(Ye),ln(Kt),ln(fe.$$.fragment,xi),ln(We.$$.fragment,xi),ln(we.$$.fragment,xi),ln(Xe.$$.fragment,xi),ln(tt.$$.fragment,xi),ki=!1},d(xi){xi&&ze(i),Xt&&Xt.d(),kt&&kt.d(),Ue&&Ue.d(),lo(s),Ye&&Ye.d(),Kt&&Kt.d(),lo(fe),lo(We),lo(we),lo(Xe),lo(tt),rt=!1,rs(yt)}}}function dH(r,i,o){let c,h,m,_,x,s,M,P,L,F,V,X,q,Y,J;Fi(r,Sc,tt=>o(0,c=tt)),Fi(r,$x,tt=>o(13,h=tt)),Fi(r,Kx,tt=>o(1,m=tt)),Fi(r,B_,tt=>o(14,_=tt)),Fi(r,Jx,tt=>o(15,x=tt)),Fi(r,ty,tt=>o(23,s=tt)),Fi(r,ey,tt=>o(24,M=tt)),Fi(r,Cy,tt=>o(25,P=tt)),Fi(r,em,tt=>o(26,L=tt)),Fi(r,du,tt=>o(5,F=tt)),Fi(r,Jd,tt=>o(6,V=tt)),Fi(r,Yd,tt=>o(7,X=tt)),Fi(r,tm,tt=>o(8,q=tt)),Fi(r,Ph,tt=>o(9,Y=tt)),Fi(r,Hp,tt=>o(10,J=tt));let ue,ce=!1,fe,Ae,Ce;an(tm,q=!0,q),an(Yd,X=!1,X),an(Sc,c=!1,c),an(Jd,V=!1,V),an(du,F=!0,F),an(em,L="fires_viirs_24",L),setTimeout(()=>{fe=Ae.getContext("2d"),Ce=new Sl(fe,{type:"bar",options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{ticks:{font:{size:10},type:"time",autoSkip:!0,maxTicksLimit:3,autoSkipPadding:10},gridLines:{display:!1}},y:{ticks:{font:{size:10}},title:{display:!0,text:"PM 2.5",font:{size:10}}}}},data:{labels:[],datasets:[{label:"PM2.5",backgroundColor:"rgb(126, 58, 242)",borderColor:"rgb(126, 58, 242)",data:[],backgroundColor:[],lineTension:.3}]}})},200);async function He(tt,ei){let ki=vx+"/mapclient";const rt=P.replace("-","").replace("-","");console.log(tt);let yt={action:"get-chartData",freq_chart:"3dayrecent",geom_data:tt,interaction:ei,run_date_chart:rt+".nc",run_type_chart:"geos",variable:"BC_MLPM25"};const Xt=await Gr.get(ki,{params:yt,headers:{Authorization:"admin.KRg06uWinwXAL5SRRCBSmH2HON4tZKdpCItHpbZh7HghJFFH6mIizlNM01"}});if(Xt.data){let Ue=Xt.data.data.plot,Ye=Ue.map(Li=>new Date(Li[0]).toLocaleString("en-GB",{hour12:!1})),Kt=Ue.map(function(Li){return Li[1]<20?"#8b81ba":Li[1]<40?"#6ca7cc":Li[1]<60?"#91d2bd":Li[1]<80?"#fbfbcf":Li[1]<100?"#b44674":"#ddd"});console.log(Kt);let vi=Ue.map(Li=>Li[1]);Kk(Ce),Jk(Ce,Ye,vi);let en=document.querySelector(".mapboxgl-popup-content");en.innerHTML+='<div class="point-popup-val">'+vi[0]+' gm<sup>3</sup> <span id="open-statistic-button"  style="float: right; cursor: pointer;"><i class="fa fa-signal mr-2 text-sm from-purple-600 to-blue-500 to-blue-600 bg-gradient-to-r bg-clip-text text-transparent" aria-hidden="true"></i></span> </div>',document.getElementById("open-statistic-button").addEventListener("click",function(Li){o(3,ce=!0)})}console.log(Xt.data)}async function We(){let tt=vx+"/mapclient",ei=M+"+"+s.replace("h","")+":00:00";console.log(ei);let ki={action:"get-stations",obs_date:"2024-01-09+11:00:00"};const rt=await Gr.get(tt,{params:ki,paramsSerializer:Xt=>P4.stringify(Xt,{encode:!1}),headers:{Authorization:"admin.KRg06uWinwXAL5SRRCBSmH2HON4tZKdpCItHpbZh7HghJFFH6mIizlNM01"}});let yt=NV(rt.data.data);BV(ue,kd,yt)}function nt(){let tt=ue.getZoom();ue.setZoom(tt+1)}function we(){let tt=ue.getZoom();ue.setZoom(tt-1)}function ht(tt){ue=tt,o(2,ue)}function pt(tt){c=tt,Sc.set(c)}function Xe(tt){F=tt,du.set(F)}function mt(tt){Zr[tt?"unshift":"push"](()=>{Ae=tt,o(4,Ae)})}function Ft(tt){ce=tt,o(3,ce),o(14,_)}return r.$$.update=()=>{r.$$.dirty&32768&&x&&We(),r.$$.dirty&16384&&_&&o(3,ce=!0),r.$$.dirty&8194&&m!==""&&He(m,h),r.$$.dirty&1&&(c||(document.querySelectorAll("#right-component").forEach(tt=>tt.style.right="330px"),document.querySelectorAll("#timeslider").forEach(tt=>tt.style.justifyContent="right"))),r.$$.dirty&1&&c&&(document.querySelectorAll("#right-component").forEach(tt=>tt.style.right="30px"),document.querySelectorAll("#timeslider").forEach(tt=>tt.style.justifyContent="center"))},[c,m,ue,ce,Ae,F,V,X,q,Y,J,nt,we,h,_,x,ht,pt,Xe,mt,Ft]}class yH extends _o{constructor(i){super(),yo(this,i,dH,hH,go,{})}}export{yH as component,_H as universal};
